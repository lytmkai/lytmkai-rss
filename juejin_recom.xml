<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ğŸš€ Vue3 å“åº”å¼è¿›é˜¶ï¼šå¤šå±‚åµŒå¥—æ•°æ®ä¸æ›´æ–°ï¼Ÿåˆ«è®©æ•°æ®"èººå¹³"äº†ï¼]]></title>    <link>https://juejin.cn/post/7598490039489691683</link>    <guid>https://juejin.cn/post/7598490039489691683</guid>    <pubDate>2026-01-25T06:15:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598490039489691683" data-draft-id="7598588085596995624" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ Vue3 å“åº”å¼è¿›é˜¶ï¼šå¤šå±‚åµŒå¥—æ•°æ®ä¸æ›´æ–°ï¼Ÿåˆ«è®©æ•°æ®&quot;èººå¹³&quot;äº†ï¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2026-01-25T06:15:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­å…®æ›°"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ Vue3 å“åº”å¼è¿›é˜¶ï¼šå¤šå±‚åµŒå¥—æ•°æ®ä¸æ›´æ–°ï¼Ÿåˆ«è®©æ•°æ®"èººå¹³"äº†ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­å…®æ›°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T06:15:25.000Z" title="Sun Jan 25 2026 06:15:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€ï¼šå°æ˜çš„è¡¨å•å™©æ¢¦</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯å°æ˜ï¼Œä¸€ä¸ªåˆšè½¬å‰ç«¯çš„åç«¯å·¥ç¨‹å¸ˆã€‚è€å¤§è®©ä½ åšä¸ªå¤æ‚çš„è¡¨å•é¡µé¢ï¼Œç”¨æˆ·ä¿¡æ¯ã€åœ°å€ã€æ”¯ä»˜æ–¹å¼ï¼Œä¸€å±‚å¥—ä¸€å±‚ã€‚ä½ ä¿¡å¿ƒæ»¡æ»¡åœ°ç”¨ reactive å†™äº†ä¸ªå¯¹è±¡ï¼Œç»“æœå‘ç°ä¿®æ”¹åœ°å€å­—æ®µæ—¶ï¼Œç•Œé¢å±…ç„¶çº¹ä¸ä¸åŠ¨ï¼ä½ æ€€ç–‘äººç”Ÿäº†ï¼šæ˜¯ä¸æ˜¯ Vue3 åäº†ï¼Ÿæ˜¯ä¸æ˜¯è‡ªå·±çš„ä»£ç å†™é”™äº†ï¼Ÿåˆ«æ€¥ï¼Œä»Šå¤©å’±ä»¬å°±æŠŠ Vue3 å“åº”å¼çš„å¤šå±‚åµŒå¥—é—®é¢˜å½»åº•ææ˜ç™½ã€‚</p>
<h2 data-id="heading-1">æŠ€æœ¯èƒŒæ™¯ï¼šVue3 çš„å“åº”å¼ä¸æ˜¯é­”æ³•</h2>
<p>Vue3 ç”¨ Proxy å®ç°å“åº”å¼ç³»ç»Ÿï¼Œè¿™æ¯” Vue2 çš„ Object.defineProperty å¼ºå¤§å¤ªå¤šã€‚Proxy å¯ä»¥æ‹¦æˆªå¯¹è±¡çš„å„ç§æ“ä½œï¼Œæ¯”å¦‚ getã€setã€deleteProperty ç­‰ã€‚ä½†è¿™ä¸ªç³»ç»Ÿæœ‰ä¸ªå‘çˆ¹çš„åœ°æ–¹ï¼šå½“ä½ è§£æ„æˆ–è€…æ·±å±‚åµŒå¥—æ—¶ï¼Œå“åº”å¼é“¾æ¡å¯èƒ½å°±æ–­äº†ã€‚</p>
<p>ç®€å•è¯´ï¼Œreactive è¿”å›çš„æ˜¯ä¸ª Proxy å¯¹è±¡ï¼Œå®ƒç›‘å¬æ‰€æœ‰å±æ€§è®¿é—®ã€‚ä½†å¦‚æœä½ ç”¨ toRefs è§£æ„åµŒå¥—å¯¹è±¡ï¼Œé‚£äº›åµŒå¥—å±æ€§å°±å˜æˆäº†æ™®é€šçš„ Refï¼Œä¸å†æ˜¯åŸå¯¹è±¡çš„å¼•ç”¨äº†ã€‚ä¿®æ”¹å®ƒä»¬ï¼ŒåŸå¯¹è±¡å½“ç„¶ä¸ä¼šå˜ï¼Œç•Œé¢ä¹Ÿä¸ä¼šæ›´æ–°ã€‚</p>
<h2 data-id="heading-2">æ ¸å¿ƒé—®é¢˜ï¼šä¸‰å±‚åµŒå¥—ï¼Œå“åº”å¼é“¾æ–­è£‚</h2>
<h3 data-id="heading-3">é—®é¢˜ 1ï¼štoRefs è§£æ„åµŒå¥—å¯¹è±¡</h3>
<p>è¿™æ˜¯æœ€å¸¸è§çš„å‘ã€‚çœ‹è¿™ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é”™è¯¯ç¤ºèŒƒ âŒ</span>
<span class="hljs-keyword">import</span> { reactive, toRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">userInfo</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
    <span class="hljs-attr">address</span>: {
      <span class="hljs-attr">city</span>: <span class="hljs-string">'åŒ—äº¬'</span>,
      <span class="hljs-attr">street</span>: <span class="hljs-string">'æœé˜³åŒº'</span>
    }
  }
})

<span class="hljs-keyword">const</span> { userInfo } = <span class="hljs-title function_">toRefs</span>(state)
<span class="hljs-keyword">const</span> { address } = <span class="hljs-title function_">toRefs</span>(userInfo.<span class="hljs-property">value</span>) <span class="hljs-comment">// è¿™é‡Œå°±æ–­é“¾äº†ï¼</span>

<span class="hljs-comment">// ä¿®æ”¹ addressï¼Œç•Œé¢ä¸ä¼šæ›´æ–°</span>
address.<span class="hljs-property">value</span>.<span class="hljs-property">city</span> = <span class="hljs-string">'ä¸Šæµ·'</span> <span class="hljs-comment">// âŒ æ— æ•ˆ</span>
</code></pre>
<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸º <code>toRefs(userInfo.value)</code> åˆ›å»ºçš„æ˜¯æ–°çš„ Ref å¯¹è±¡ï¼Œå®ƒä»¬å’ŒåŸå¯¹è±¡çš„å“åº”å¼é“¾å·²ç»æ–­äº†ã€‚ä½ æ”¹çš„æ˜¯è¿™äº›æ–°çš„ Refï¼Œè€Œä¸æ˜¯ state é‡Œçš„æ•°æ®ã€‚</p>
<h3 data-id="heading-4">é—®é¢˜ 2ï¼šç›´æ¥èµ‹å€¼æ–°å¯¹è±¡</h3>
<p>å¦ä¸€ä¸ªå¸¸è§é”™è¯¯æ˜¯ç»™åµŒå¥—å±æ€§èµ‹å€¼æ–°å¯¹è±¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é”™è¯¯ç¤ºèŒƒ âŒ</span>
<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
  }
})

<span class="hljs-comment">// ä» API è·å–æ•°æ®åç›´æ¥èµ‹å€¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> newData = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å°çº¢'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">26</span>
  }
  form.<span class="hljs-property">user</span> = newData <span class="hljs-comment">// âœ… è¿™æ ·å¯ä»¥æ›´æ–°</span>
  <span class="hljs-comment">// ä½†å¦‚æœç›´æ¥ä¿®æ”¹æ–°å¯¹è±¡çš„å±æ€§ï¼Œç•Œé¢ä¸ä¼šç«‹å³æ›´æ–°</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    form.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'å°åˆš'</span> <span class="hljs-comment">// âŒ å¯èƒ½ä¸æ›´æ–°</span>
  }, <span class="hljs-number">1000</span>)
}
</code></pre>
<p>è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œè™½ç„¶ <code>form.user = newData</code> å¯ä»¥è§¦å‘æ›´æ–°ï¼Œä½†åç»­ä¿®æ”¹æ–°å¯¹è±¡çš„å±æ€§æ—¶ï¼ŒVue å¯èƒ½å·²ç»å¤±å»äº†å¯¹æ–°å¯¹è±¡çš„ç›‘å¬ã€‚</p>
<h3 data-id="heading-5">é—®é¢˜ 3ï¼šæ•°ç»„æ“ä½œä¸å½“</h3>
<p>æ•°ç»„æ“ä½œä¹Ÿæ˜¯ä¸ªé‡ç¾åŒºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é”™è¯¯ç¤ºèŒƒ âŒ</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">items</span>: [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å•†å“1'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å•†å“2'</span> }
  ]
})

<span class="hljs-comment">// ç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹</span>
list.<span class="hljs-property">items</span>[<span class="hljs-number">0</span>] = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æ–°å•†å“'</span> } <span class="hljs-comment">// å¯èƒ½ä¸æ›´æ–°</span>

<span class="hljs-comment">// æˆ–è€…ç›´æ¥ç»™å±æ€§èµ‹æ–°æ•°ç»„</span>
list.<span class="hljs-property">items</span> = [...list.<span class="hljs-property">items</span>, { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å•†å“3'</span> }] <span class="hljs-comment">// è¿™æ ·å¯ä»¥</span>
</code></pre>
<h2 data-id="heading-6">è§£å†³æ–¹æ¡ˆï¼šäº”ç§å§¿åŠ¿æ‹¯æ•‘åµŒå¥—æ•°æ®</h2>
<h3 data-id="heading-7">æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ toRef è€Œä¸æ˜¯è§£æ„</h3>
<p>å¦‚æœä½ éœ€è¦å•ç‹¬è®¿é—®åµŒå¥—å±æ€§ï¼Œç”¨ toRefï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ­£ç¡®ç¤ºèŒƒ âœ…</span>
<span class="hljs-keyword">import</span> { reactive, toRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">userInfo</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
    <span class="hljs-attr">address</span>: {
      <span class="hljs-attr">city</span>: <span class="hljs-string">'åŒ—äº¬'</span>
    }
  }
})

<span class="hljs-comment">// åˆ›å»ºåˆ°åµŒå¥—å±æ€§çš„å“åº”å¼å¼•ç”¨</span>
<span class="hljs-keyword">const</span> city = <span class="hljs-title function_">toRef</span>(state.<span class="hljs-property">userInfo</span>, <span class="hljs-string">'address'</span>)

<span class="hljs-comment">// ä¿®æ”¹ä¼šè§¦å‘æ›´æ–°</span>
city.<span class="hljs-property">value</span>.<span class="hljs-property">city</span> = <span class="hljs-string">'ä¸Šæµ·'</span> <span class="hljs-comment">// âœ… ç•Œé¢ä¼šæ›´æ–°</span>

<span class="hljs-comment">// æˆ–è€…ç›´æ¥ç”¨ç‚¹å·è®¿é—®</span>
state.<span class="hljs-property">userInfo</span>.<span class="hljs-property">address</span>.<span class="hljs-property">city</span> = <span class="hljs-string">'ä¸Šæµ·'</span> <span class="hljs-comment">// âœ… æœ€ç®€å•çš„æ–¹å¼</span>
</code></pre>
<p>toRef åˆ›å»ºçš„æ˜¯åˆ°åŸå¯¹è±¡çš„å“åº”å¼é“¾æ¥ï¼Œä¿®æ”¹å®ƒä¼šå½±å“åŸå¯¹è±¡ï¼Œè§¦å‘æ›´æ–°ã€‚</p>
<h3 data-id="heading-8">æ–¹æ¡ˆ 2ï¼šåªè§£æ„é¡¶å±‚ï¼Œç›´æ¥è®¿é—®åµŒå¥—</h3>
<p>ä¿æŒåµŒå¥—ç»“æ„ä¸æ‹†å¼€ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ­£ç¡®ç¤ºèŒƒ âœ…</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">userInfo</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
    <span class="hljs-attr">address</span>: {
      <span class="hljs-attr">city</span>: <span class="hljs-string">'åŒ—äº¬'</span>,
      <span class="hljs-attr">detail</span>: {
        <span class="hljs-attr">street</span>: <span class="hljs-string">'æœé˜³åŒº'</span>,
        <span class="hljs-attr">number</span>: <span class="hljs-number">123</span>
      }
    }
  }
})

<span class="hljs-comment">// åªè§£æ„é¡¶å±‚</span>
<span class="hljs-keyword">const</span> { userInfo } = <span class="hljs-title function_">toRefs</span>(state)

<span class="hljs-comment">// ç›´æ¥è®¿é—®åµŒå¥—ï¼Œä¿æŒå“åº”å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateCity</span>(<span class="hljs-params">newCity</span>) {
  userInfo.<span class="hljs-property">value</span>.<span class="hljs-property">address</span>.<span class="hljs-property">city</span> = newCity <span class="hljs-comment">// âœ… ç•Œé¢ä¼šæ›´æ–°</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateStreet</span>(<span class="hljs-params">newStreet</span>) {
  userInfo.<span class="hljs-property">value</span>.<span class="hljs-property">address</span>.<span class="hljs-property">detail</span>.<span class="hljs-property">street</span> = newStreet <span class="hljs-comment">// âœ… ç•Œé¢ä¼šæ›´æ–°</span>
}
</code></pre>
<p>è¿™æ ·è™½ç„¶è®¿é—®è·¯å¾„é•¿ç‚¹ï¼Œä½†å“åº”å¼é“¾æ¡å®Œæ•´ï¼Œä¸ä¼šå‡ºé—®é¢˜ã€‚</p>
<h3 data-id="heading-9">æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ computed æ´¾ç”Ÿå€¼</h3>
<p>å¦‚æœåªéœ€è¦è¯»å–åµŒå¥—æ•°æ®ï¼Œç”¨ computedï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ­£ç¡®ç¤ºèŒƒ âœ…</span>
<span class="hljs-keyword">import</span> { reactive, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">userInfo</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
    <span class="hljs-attr">address</span>: {
      <span class="hljs-attr">city</span>: <span class="hljs-string">'åŒ—äº¬'</span>,
      <span class="hljs-attr">district</span>: <span class="hljs-string">'æœé˜³åŒº'</span>
    }
  }
})

<span class="hljs-comment">// åˆ›å»º computed å±æ€§</span>
<span class="hljs-keyword">const</span> fullAddress = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${state.userInfo.address.city}</span> <span class="hljs-subst">${state.userInfo.address.district}</span>`</span>
})

<span class="hljs-comment">// åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ {{ fullAddress }}ï¼Œä¼šè‡ªåŠ¨æ›´æ–°</span>
state.<span class="hljs-property">userInfo</span>.<span class="hljs-property">address</span>.<span class="hljs-property">city</span> = <span class="hljs-string">'ä¸Šæµ·'</span> <span class="hljs-comment">// âœ… fullAddress ä¼šè‡ªåŠ¨æ›´æ–°</span>
</code></pre>
<p>computed çš„å¥½å¤„æ˜¯è‡ªåŠ¨è¿½è¸ªä¾èµ–ï¼Œåªè¦æœ‰ä»»ä½•ä¾èµ–å˜åŒ–å°±ä¼šé‡æ–°è®¡ç®—ã€‚</p>
<h3 data-id="heading-10">æ–¹æ¡ˆ 4ï¼šä½¿ç”¨ markRaw æ ‡è®°ä¸éœ€è¦å“åº”å¼çš„æ•°æ®</h3>
<p>å¦‚æœåµŒå¥—å¯¹è±¡å¾ˆå¤§ä¸”ä¸éœ€è¦å“åº”å¼ï¼Œç”¨ markRawï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ­£ç¡®ç¤ºèŒƒ âœ…</span>
<span class="hljs-keyword">import</span> { reactive, markRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// å¤§å¯¹è±¡ä¸éœ€è¦å“åº”å¼</span>
<span class="hljs-keyword">const</span> bigConfig = <span class="hljs-title function_">markRaw</span>({
  <span class="hljs-comment">// å‡ åƒè¡Œçš„é…ç½®</span>
  <span class="hljs-attr">theme</span>: { <span class="hljs-comment">/* ... */</span> },
  <span class="hljs-attr">plugins</span>: [<span class="hljs-comment">/* ... */</span> ],
  <span class="hljs-attr">settings</span>: { <span class="hljs-comment">/* ... */</span> }
})

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">config</span>: bigConfig, <span class="hljs-comment">// ä¸ä¼šå˜æˆå“åº”å¼</span>
  <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span> }
})

<span class="hljs-comment">// ä¿®æ”¹ bigConfig ä¸ä¼šè§¦å‘æ›´æ–°</span>
app.<span class="hljs-property">config</span>.<span class="hljs-property">theme</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'red'</span> <span class="hljs-comment">// âŒ ä¸ä¼šè§¦å‘æ›´æ–°</span>

<span class="hljs-comment">// ä½†å¯ä»¥æ‰‹åŠ¨è§¦å‘æ›´æ–°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTheme</span>(<span class="hljs-params">newColor</span>) {
  app.<span class="hljs-property">config</span> = { ...app.<span class="hljs-property">config</span>, <span class="hljs-attr">theme</span>: { ...app.<span class="hljs-property">config</span>.<span class="hljs-property">theme</span>, <span class="hljs-attr">color</span>: newColor } }
  <span class="hljs-comment">// âœ… è¿™æ ·ä¼šè§¦å‘æ›´æ–°</span>
}
</code></pre>
<p>markRaw å¯ä»¥é¿å…å¤§å¯¹è±¡å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œä½†è¦ç”¨å¯¹åœºæ™¯ã€‚</p>
<h3 data-id="heading-11">æ–¹æ¡ˆ 5ï¼šä½¿ç”¨ shallowReactive/shallowRef</h3>
<p>å¦‚æœåªéœ€è¦é¡¶å±‚å“åº”å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ­£ç¡®ç¤ºèŒƒ âœ…</span>
<span class="hljs-keyword">import</span> { shallowReactive, shallowRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// åªç›‘å¬ç¬¬ä¸€å±‚</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">shallowReactive</span>({
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
    <span class="hljs-attr">profile</span>: { <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> }
  }
})

<span class="hljs-comment">// ä¿®æ”¹é¡¶å±‚ä¼šè§¦å‘æ›´æ–°</span>
state.<span class="hljs-property">user</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'å°çº¢'</span> } <span class="hljs-comment">// âœ… ç•Œé¢ä¼šæ›´æ–°</span>

<span class="hljs-comment">// ä¿®æ”¹åµŒå¥—ä¸ä¼šè§¦å‘æ›´æ–°</span>
state.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'å°åˆš'</span> <span class="hljs-comment">// âŒ ä¸ä¼šæ›´æ–°</span>
state.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">age</span> = <span class="hljs-number">26</span> <span class="hljs-comment">// âŒ ä¸ä¼šæ›´æ–°</span>

<span class="hljs-comment">// éœ€è¦è§¦å‘æ›´æ–°æ—¶ï¼Œæ›¿æ¢æ•´ä¸ªå¯¹è±¡</span>
state.<span class="hljs-property">user</span> = { ...state.<span class="hljs-property">user</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å°åˆš'</span> } <span class="hljs-comment">// âœ… ä¼šæ›´æ–°</span>
</code></pre>
<p>shallowReactive é€‚åˆæ•°æ®é‡å¤§ã€æ·±å±‚ä¸éœ€è¦å“åº”å¼çš„åœºæ™¯ï¼Œæ¯”å¦‚åªç›‘å¬æ•´ä¸ªå¯¹è±¡æ˜¯å¦æ›¿æ¢ã€‚</p>
<h2 data-id="heading-12">å®æˆ˜æ¡ˆä¾‹ï¼šäº”ä¸ªçœŸå®åœºæ™¯</h2>
<h3 data-id="heading-13">æ¡ˆä¾‹ 1ï¼šç”µå•†åœ°å€è¡¨å•</h3>
<p>ä¹‹å‰åšç”µå•†é¡¹ç›®ï¼Œç”¨æˆ·åœ°å€è¡¨å•æœ‰ä¸‰çº§è”åŠ¨ï¼šçœã€å¸‚ã€åŒºã€‚ç”¨ reactive åµŒå¥—å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ°å€è¡¨å•å®ç°</span>
<span class="hljs-keyword">import</span> { reactive, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> addressForm = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">province</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">city</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">district</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">detail</span>: {
    <span class="hljs-attr">street</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">zipCode</span>: <span class="hljs-string">''</span>
  }
})

<span class="hljs-comment">// è®¡ç®—å®Œæ•´åœ°å€</span>
<span class="hljs-keyword">const</span> fullAddress = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> { province, city, district } = addressForm
  <span class="hljs-keyword">const</span> { street, zipCode } = addressForm.<span class="hljs-property">detail</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${province?.name || <span class="hljs-string">''</span>}</span><span class="hljs-subst">${city?.name || <span class="hljs-string">''</span>}</span><span class="hljs-subst">${district?.name || <span class="hljs-string">''</span>}</span><span class="hljs-subst">${street}</span> <span class="hljs-subst">${zipCode}</span>`</span>
})

<span class="hljs-comment">// ä¿®æ”¹è¯¦ç»†åœ°å€</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateStreet</span>(<span class="hljs-params">street</span>) {
  addressForm.<span class="hljs-property">detail</span>.<span class="hljs-property">street</span> = street <span class="hljs-comment">// âœ… ç•Œé¢ä¼šæ›´æ–°</span>
}

<span class="hljs-comment">// æ›´æ–°é‚®æ”¿ç¼–ç </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateZipCode</span>(<span class="hljs-params">zipCode</span>) {
  addressForm.<span class="hljs-property">detail</span>.<span class="hljs-property">zipCode</span> = zipCode <span class="hljs-comment">// âœ… ç•Œé¢ä¼šæ›´æ–°</span>
}
</code></pre>
<p>å…³é”®æ˜¯ä¸è¦è§£æ„ detailï¼Œç›´æ¥é€šè¿‡ç‚¹å·è®¿é—®ï¼Œä¿æŒå“åº”å¼é“¾æ¡å®Œæ•´ã€‚</p>
<h3 data-id="heading-14">æ¡ˆä¾‹ 2ï¼šè¡¨å•éªŒè¯çŠ¶æ€</h3>
<p>è¡¨å•éªŒè¯éœ€è¦è®°å½•æ¯ä¸ªå­—æ®µçš„é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¡¨å•éªŒè¯å®ç°</span>
<span class="hljs-keyword">import</span> { reactive, toRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> formData = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">confirmPassword</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">validation</span>: {
    <span class="hljs-attr">username</span>: { <span class="hljs-attr">isValid</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">''</span> },
    <span class="hljs-attr">password</span>: { <span class="hljs-attr">isValid</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">''</span> },
    <span class="hljs-attr">confirmPassword</span>: { <span class="hljs-attr">isValid</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">''</span> }
  }
})

<span class="hljs-comment">// ä½¿ç”¨ toRef è·å–éªŒè¯çŠ¶æ€çš„å¼•ç”¨</span>
<span class="hljs-keyword">const</span> usernameValidation = <span class="hljs-title function_">toRef</span>(formData.<span class="hljs-property">validation</span>, <span class="hljs-string">'username'</span>)
<span class="hljs-keyword">const</span> passwordValidation = <span class="hljs-title function_">toRef</span>(formData.<span class="hljs-property">validation</span>, <span class="hljs-string">'password'</span>)

<span class="hljs-comment">// éªŒè¯å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateUsername</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (formData.<span class="hljs-property">username</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">3</span>) {
    usernameValidation.<span class="hljs-property">value</span>.<span class="hljs-property">isValid</span> = <span class="hljs-literal">false</span>
    usernameValidation.<span class="hljs-property">value</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦'</span> <span class="hljs-comment">// âœ… ä¼šè§¦å‘æ›´æ–°</span>
  } <span class="hljs-keyword">else</span> {
    usernameValidation.<span class="hljs-property">value</span>.<span class="hljs-property">isValid</span> = <span class="hljs-literal">true</span>
    usernameValidation.<span class="hljs-property">value</span>.<span class="hljs-property">message</span> = <span class="hljs-string">''</span>
  }
}
</code></pre>
<p>è¿™é‡Œç”¨ toRef åˆ›å»ºåˆ°éªŒè¯å¯¹è±¡çš„å“åº”å¼å¼•ç”¨ï¼Œä¿®æ”¹åç•Œé¢ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p>
<h3 data-id="heading-15">æ¡ˆä¾‹ 3ï¼šå•†å“è§„æ ¼é€‰æ‹©</h3>
<p>ç”µå•†çš„å•†å“è§„æ ¼æ˜¯ä¸ªç»å…¸åµŒå¥—åœºæ™¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å•†å“è§„æ ¼å®ç°</span>
<span class="hljs-keyword">import</span> { reactive, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> product = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">info</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone 15'</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-number">5999</span>
  },
  <span class="hljs-attr">specs</span>: {
    <span class="hljs-attr">color</span>: <span class="hljs-string">'é»‘è‰²'</span>,
    <span class="hljs-attr">storage</span>: <span class="hljs-string">'128GB'</span>,
    <span class="hljs-attr">version</span>: <span class="hljs-string">'æ ‡å‡†ç‰ˆ'</span>
  },
  <span class="hljs-attr">inventory</span>: {
    <span class="hljs-attr">total</span>: <span class="hljs-number">1000</span>,
    <span class="hljs-attr">detail</span>: {
      <span class="hljs-string">'é»‘è‰²-128GB'</span>: <span class="hljs-number">300</span>,
      <span class="hljs-string">'é»‘è‰²-256GB'</span>: <span class="hljs-number">200</span>,
      <span class="hljs-string">'ç™½è‰²-128GB'</span>: <span class="hljs-number">250</span>,
      <span class="hljs-string">'ç™½è‰²-256GB'</span>: <span class="hljs-number">250</span>
    }
  }
})

<span class="hljs-comment">// è®¡ç®—å½“å‰åº“å­˜</span>
<span class="hljs-keyword">const</span> currentStock = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> key = <span class="hljs-string">`<span class="hljs-subst">${product.specs.color}</span>-<span class="hljs-subst">${product.specs.storage}</span>`</span>
  <span class="hljs-keyword">return</span> product.<span class="hljs-property">inventory</span>.<span class="hljs-property">detail</span>[key] || <span class="hljs-number">0</span>
})

<span class="hljs-comment">// ä¿®æ”¹è§„æ ¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">selectColor</span>(<span class="hljs-params">color</span>) {
  product.<span class="hljs-property">specs</span>.<span class="hljs-property">color</span> = color <span class="hljs-comment">// âœ… currentStock ä¼šè‡ªåŠ¨æ›´æ–°</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">selectStorage</span>(<span class="hljs-params">storage</span>) {
  product.<span class="hljs-property">specs</span>.<span class="hljs-property">storage</span> = storage <span class="hljs-comment">// âœ… currentStock ä¼šè‡ªåŠ¨æ›´æ–°</span>
}
</code></pre>
<p>computed ä¼šè‡ªåŠ¨è¿½è¸ª product.specs çš„å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°è®¡ç®—åº“å­˜ã€‚</p>
<h3 data-id="heading-16">æ¡ˆä¾‹ 4ï¼šèŠå¤©æ¶ˆæ¯åˆ—è¡¨</h3>
<p>å³æ—¶é€šè®¯çš„æ¶ˆæ¯åˆ—è¡¨ä¹Ÿæ˜¯åµŒå¥—åœºæ™¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¶ˆæ¯åˆ—è¡¨å®ç°</span>
<span class="hljs-keyword">import</span> { reactive, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> chat = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">currentUserId</span>: <span class="hljs-string">'user1'</span>,
  <span class="hljs-attr">messages</span>: [
    {
      <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">senderId</span>: <span class="hljs-string">'user1'</span>,
      <span class="hljs-attr">content</span>: <span class="hljs-string">'ä½ å¥½'</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">read</span>: <span class="hljs-literal">true</span>
    },
    {
      <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">senderId</span>: <span class="hljs-string">'user2'</span>,
      <span class="hljs-attr">content</span>: <span class="hljs-string">'åœ¨å—'</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">1000</span>,
      <span class="hljs-attr">read</span>: <span class="hljs-literal">false</span>
    }
  ],
  <span class="hljs-attr">users</span>: {
    <span class="hljs-string">'user1'</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>, <span class="hljs-attr">avatar</span>: <span class="hljs-string">'...'</span> },
    <span class="hljs-string">'user2'</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'å°çº¢'</span>, <span class="hljs-attr">avatar</span>: <span class="hljs-string">'...'</span> }
  }
})

<span class="hljs-comment">// è®¡ç®—æœªè¯»æ¶ˆæ¯</span>
<span class="hljs-keyword">const</span> unreadCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> chat.<span class="hljs-property">messages</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> !msg.<span class="hljs-property">read</span>).<span class="hljs-property">length</span>
})

<span class="hljs-comment">// æ ‡è®°æ¶ˆæ¯å·²è¯»</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">markAsRead</span>(<span class="hljs-params">messageId</span>) {
  <span class="hljs-keyword">const</span> msg = chat.<span class="hljs-property">messages</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">id</span> === messageId)
  <span class="hljs-keyword">if</span> (msg) {
    msg.<span class="hljs-property">read</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// âœ… unreadCount ä¼šè‡ªåŠ¨æ›´æ–°</span>
  }
}

<span class="hljs-comment">// å‘é€æ–°æ¶ˆæ¯</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params">content</span>) {
  <span class="hljs-keyword">const</span> newMsg = {
    <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
    <span class="hljs-attr">senderId</span>: chat.<span class="hljs-property">currentUserId</span>,
    content,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
    <span class="hljs-attr">read</span>: <span class="hljs-literal">true</span>
  }
  chat.<span class="hljs-property">messages</span>.<span class="hljs-title function_">push</span>(newMsg) <span class="hljs-comment">// âœ… ç•Œé¢ä¼šæ›´æ–°</span>
}
</code></pre>
<p>è¿™é‡Œæ²¡æœ‰è§£æ„ï¼Œç›´æ¥è®¿é—®åµŒå¥—å±æ€§ï¼Œä¿æŒå“åº”å¼å®Œæ•´ã€‚</p>
<h3 data-id="heading-17">æ¡ˆä¾‹ 5ï¼šPinia Store åµŒå¥—çŠ¶æ€</h3>
<p>ç”¨ Pinia çš„ storeToRefs ä¹Ÿè¦æ³¨æ„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Pinia Store å®ç°</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">info</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
      <span class="hljs-attr">email</span>: <span class="hljs-string">'xiaoming@example.com'</span>
    },
    <span class="hljs-attr">preferences</span>: {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
      <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>
    }
  })

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTheme</span>(<span class="hljs-params">theme</span>) {
    state.<span class="hljs-property">preferences</span>.<span class="hljs-property">theme</span> = theme <span class="hljs-comment">// âœ… ä¼šè§¦å‘æ›´æ–°</span>
  }

  <span class="hljs-keyword">return</span> { state, updateTheme }
})

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> { storeToRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-keyword">const</span> { state } = <span class="hljs-title function_">storeToRefs</span>(userStore)

<span class="hljs-comment">// âŒ ä¸è¦è¿™æ ·åš</span>
<span class="hljs-keyword">const</span> { info, preferences } = <span class="hljs-title function_">toRefs</span>(state.<span class="hljs-property">value</span>)

<span class="hljs-comment">// âœ… ç›´æ¥è®¿é—®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeTheme</span>(<span class="hljs-params">newTheme</span>) {
  state.<span class="hljs-property">value</span>.<span class="hljs-property">preferences</span>.<span class="hljs-property">theme</span> = newTheme <span class="hljs-comment">// âœ… ä¼šè§¦å‘æ›´æ–°</span>
}

<span class="hljs-comment">// âœ… æˆ–è€…è°ƒç”¨ action</span>
userStore.<span class="hljs-title function_">updateTheme</span>(<span class="hljs-string">'light'</span>) <span class="hljs-comment">// âœ… ä¼šè§¦å‘æ›´æ–°</span>
</code></pre>
<p>storeToRefs å·²ç»å¤„ç†å¥½äº†å“åº”å¼ï¼Œä¸è¦å†æ¬¡ç”¨ toRefs è§£æ„åµŒå¥—å¯¹è±¡ã€‚</p>
<h2 data-id="heading-18">è¿›é˜¶æŠ€å·§ï¼šå“åº”å¼è°ƒè¯•</h2>
<p>å¦‚æœè¿˜æ˜¯æä¸æ‡‚ä¸ºä»€ä¹ˆä¸æ›´æ–°ï¼Œç”¨ devtoolsï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¼€å‘ç¯å¢ƒä¸‹è°ƒè¯•</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">nested</span>: {
      <span class="hljs-attr">data</span>: { <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> }
    }
  })

  <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘æ›´æ–°</span>
  <span class="hljs-keyword">import</span> { triggerRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">toRef</span>(app.<span class="hljs-property">nested</span>, <span class="hljs-string">'data'</span>)
  <span class="hljs-comment">// ä¿®æ”¹åæ‰‹åŠ¨è§¦å‘</span>
  ref.<span class="hljs-property">value</span>.<span class="hljs-property">value</span> = <span class="hljs-number">2</span>
  <span class="hljs-title function_">triggerRef</span>(ref)
}
</code></pre>
<p>Vue Devtools å¯ä»¥çœ‹åˆ°å“åº”å¼ä¾èµ–é“¾ï¼Œå¸®ä½ æ‰¾å‡ºé—®é¢˜ã€‚</p>
<h2 data-id="heading-19">å…¶ä»–å‘çˆ¹é—®é¢˜ï¼šåˆ«è¸©è¿™äº›é›·</h2>
<h3 data-id="heading-20">é—®é¢˜ 1ï¼šå¼‚æ­¥æ›´æ–°å¯¼è‡´çš„å»¶è¿Ÿ</h3>
<p>Vue3 çš„æ›´æ–°æ˜¯å¼‚æ­¥çš„ï¼Œæ‰¹é‡å¤„ç†ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">nested</span>: { <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> }
})

<span class="hljs-comment">// æ‰¹é‡ä¿®æ”¹</span>
state.<span class="hljs-property">count</span> = <span class="hljs-number">1</span>
state.<span class="hljs-property">nested</span>.<span class="hljs-property">value</span> = <span class="hljs-number">2</span>

<span class="hljs-comment">// ç«‹å³è¯»å–å¯èƒ½è¿˜æ˜¯æ—§å€¼</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state.<span class="hljs-property">count</span>) <span class="hljs-comment">// å¯èƒ½è¿˜æ˜¯ 0</span>

<span class="hljs-comment">// ç”¨ nextTick</span>
<span class="hljs-keyword">import</span> { nextTick } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">update</span>(<span class="hljs-params"/>) {
  state.<span class="hljs-property">count</span> = <span class="hljs-number">1</span>
  state.<span class="hljs-property">nested</span>.<span class="hljs-property">value</span> = <span class="hljs-number">2</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextTick</span>()
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state.<span class="hljs-property">count</span>) <span class="hljs-comment">// è‚¯å®šæ˜¯ 1</span>
}
</code></pre>
<h3 data-id="heading-21">é—®é¢˜ 2ï¼šObject.freeze å†»ç»“å¯¹è±¡</h3>
<p>å†»ç»“çš„å¯¹è±¡ä¸èƒ½å˜æˆå“åº”å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> frozen = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>({
  <span class="hljs-attr">nested</span>: { <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> }
})

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>(frozen)
<span class="hljs-comment">// âŒ state ä¸æ˜¯å“åº”å¼çš„ï¼Œä¿®æ”¹ä¸ä¼šè§¦å‘æ›´æ–°</span>
state.<span class="hljs-property">nested</span>.<span class="hljs-property">value</span> = <span class="hljs-number">2</span> <span class="hljs-comment">// ä¸ä¼šè§¦å‘æ›´æ–°</span>
</code></pre>
<h2 data-id="heading-22">æ€»ç»“ä¸å±•æœ›</h2>
<p>Vue3 çš„å“åº”å¼ç³»ç»Ÿå¾ˆå¼ºå¤§ï¼Œä½†å¤šå±‚åµŒå¥—ç¡®å®å®¹æ˜“è¸©å‘ã€‚è®°ä½å‡ ä¸ªè¦ç‚¹ï¼š</p>
<ol>
<li>ä¸è¦è§£æ„åµŒå¥—å¯¹è±¡ï¼Œç”¨ toRef æˆ–ç›´æ¥è®¿é—®</li>
<li>ä¿æŒå“åº”å¼é“¾æ¡å®Œæ•´ï¼Œä¸è¦æ–­é“¾</li>
<li>å¤§å¯¹è±¡ç”¨ markRaw é¿å…æ€§èƒ½é—®é¢˜</li>
<li>æ·±å±‚ä¸éœ€è¦å“åº”å¼ç”¨ shallowReactive</li>
<li>ç”¨ computed è‡ªåŠ¨è¿½è¸ªä¾èµ–</li>
</ol>
<p>æœªæ¥éšç€ Vue ç‰ˆæœ¬æ›´æ–°ï¼Œå“åº”å¼ç³»ç»Ÿä¼šè¶Šæ¥è¶Šæ™ºèƒ½ã€‚ä½†ç°åœ¨æŒæ¡è¿™äº›æŠ€å·§ï¼Œå°±èƒ½é¿å…å¤§éƒ¨åˆ†å‘ã€‚</p>
<p>ä¸‹æ¬¡é‡åˆ°åµŒå¥—æ•°æ®ä¸æ›´æ–°çš„é—®é¢˜ï¼Œåˆ«æ…Œï¼Œæ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯å“åº”å¼é“¾æ–­äº†ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« å¸®åˆ°äº†ä½ ï¼Œåˆ«å¿˜äº†ç‚¹èµæ”¶è—ã€‚æœ‰é—®é¢˜è¯„è®ºåŒºè§ï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Kotlinç³»åˆ—14ã€‘ç¼–è¯‘å™¨æ’ä»¶ä¸æ³¨è§£å¤„ç†å™¨å¼€å‘ï¼šåœ¨ç¼–è¯‘æœŸæ“æ§Kotlin]]></title>    <link>https://juejin.cn/post/7598532592455942171</link>    <guid>https://juejin.cn/post/7598532592455942171</guid>    <pubDate>2026-01-24T10:46:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598532592455942171" data-draft-id="7598499504171221030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ã€Kotlinç³»åˆ—14ã€‘ç¼–è¯‘å™¨æ’ä»¶ä¸æ³¨è§£å¤„ç†å™¨å¼€å‘ï¼šåœ¨ç¼–è¯‘æœŸæ“æ§Kotlin"/> <meta itemprop="keywords" content="Kotlin,Android,ç¼–ç¨‹è¯­è¨€"/> <meta itemprop="datePublished" content="2026-01-24T10:46:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ã€Kotlinç³»åˆ—14ã€‘ç¼–è¯‘å™¨æ’ä»¶ä¸æ³¨è§£å¤„ç†å™¨å¼€å‘ï¼šåœ¨ç¼–è¯‘æœŸæ“æ§Kotlin
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T10:46:31.000Z" title="Sat Jan 24 2026 10:46:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€ï¼šç¼–è¯‘æœŸçš„é­”æ³•</h2>
<p>è¿˜è®°å¾—ç¬¬ä¸€æ¬¡ä½¿ç”¨ <code>@Parcelize</code> æ³¨è§£æ—¶çš„æ„Ÿè§‰å—ï¼Ÿ</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Parcelize</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>) : Parcelable
</code></pre>
<p>åªéœ€è¦ä¸€ä¸ªæ³¨è§£ï¼Œç¼–è¯‘å™¨å°±è‡ªåŠ¨å¸®ä½ ç”Ÿæˆäº† <code>Parcelable</code> çš„æ‰€æœ‰æ¨¡æ¿ä»£ç ã€‚è¿™ä¸æ˜¯è¿è¡Œæ—¶åå°„ï¼Œè€Œæ˜¯<strong>ç¼–è¯‘æœŸä»£ç ç”Ÿæˆ</strong>â€”â€”ç¼–è¯‘å™¨æ’ä»¶çš„é­”æ³•ã€‚</p>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯ç¼–è¯‘å™¨æ’ä»¶å’Œæ³¨è§£å¤„ç†å™¨ï¼Ÿ</h3>























<table><thead><tr><th align="left">æŠ€æœ¯</th><th align="left">æ—¶æœº</th><th align="left">èƒ½åŠ›</th><th align="left">å…¸å‹åº”ç”¨</th></tr></thead><tbody><tr><td align="left"><strong>æ³¨è§£å¤„ç†å™¨</strong></td><td align="left">ç¼–è¯‘æœŸ</td><td align="left">è¯»å–æ³¨è§£ï¼Œç”Ÿæˆæ–°æ–‡ä»¶</td><td align="left">Roomã€Daggerã€Glide</td></tr><tr><td align="left"><strong>ç¼–è¯‘å™¨æ’ä»¶</strong></td><td align="left">ç¼–è¯‘æœŸ</td><td align="left">ä¿®æ”¹ASTï¼Œæ”¹å˜ä»£ç è¡Œä¸º</td><td align="left">Parcelizeã€Composeã€Serialization</td></tr></tbody></table>
<p>ä¸¤è€…éƒ½åœ¨ç¼–è¯‘æœŸå·¥ä½œï¼Œä½†ç¼–è¯‘å™¨æ’ä»¶æ›´å¼ºå¤§â€”â€”å®ƒå¯ä»¥<strong>ä¿®æ”¹ç°æœ‰ä»£ç </strong>ï¼Œè€Œä¸åªæ˜¯ç”Ÿæˆæ–°ä»£ç ã€‚</p>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆè¦å­¦ä¹ ç¼–è¯‘æœŸå…ƒç¼–ç¨‹ï¼Ÿ</h3>
<p><strong>âœ… ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>æ€§èƒ½</strong>ï¼šé›¶è¿è¡Œæ—¶å¼€é”€ï¼Œæ²¡æœ‰åå°„æŸè€—</li>
<li><strong>å®‰å…¨</strong>ï¼šç¼–è¯‘æœŸç±»å‹æ£€æŸ¥ï¼Œæå‰å‘ç°é”™è¯¯</li>
<li><strong>ç®€æ´</strong>ï¼šå‡å°‘æ ·æ¿ä»£ç ï¼Œæå‡å¼€å‘ä½“éªŒ</li>
<li><strong>å¼ºå¤§</strong>ï¼šå¯ä»¥å®ç°è¿è¡Œæ—¶æ— æ³•åšåˆ°çš„åŠŸèƒ½</li>
</ul>
<p><strong>ğŸ”§ åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼ˆBuilderã€DTOè½¬æ¢ã€åºåˆ—åŒ–ï¼‰</li>
<li>è‡ªå®šä¹‰ç¼–è¯‘å™¨æ£€æŸ¥ï¼ˆç¦æ­¢æŸäº›APIã€å¼ºåˆ¶å‘½åè§„èŒƒï¼‰</li>
<li>å­—èŠ‚ç å¢å¼ºï¼ˆAOPã€æ€§èƒ½ç›‘æ§ã€æ—¥å¿—æ³¨å…¥ï¼‰</li>
<li>DSLæ”¯æŒï¼ˆIDEæç¤ºã€è¯­æ³•æ£€æŸ¥ï¼‰</li>
</ul>
<blockquote>
<p><strong>ğŸ’¡ æç¤º</strong></p>
<p>æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹æ„å»ºKotlinç¼–è¯‘å™¨æ’ä»¶å’Œæ³¨è§£å¤„ç†å™¨ï¼Œæ¶µç›–ç†è®ºã€å®æˆ˜å’Œæœ€ä½³å®è·µã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">Kotlinç¼–è¯‘æµç¨‹</h2>
<p>åœ¨æ·±å…¥ç¼–è¯‘å™¨æ’ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£Kotlinçš„ç¼–è¯‘æµç¨‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe34bde061684804ac82fe6c38a28ebf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856390&amp;x-signature=HMRulqJWyiK7MKgkqeToQ3bGszM%3D" alt="14-01-kotlin-compilation-flow.png" loading="lazy"/></p>
<h3 data-id="heading-4">ç¼–è¯‘é˜¶æ®µ</h3>
<pre><code class="hljs language-scss" lang="scss">æºä»£ç  (.kt)
    â†“
ã€<span class="hljs-number">1</span>. å‰ç«¯ã€‘è§£æï¼ˆParseï¼‰
    â†’ ç”ŸæˆPSIï¼ˆProgram Structure Interfaceï¼‰æ ‘
    â†“
ã€<span class="hljs-number">2</span>. å‰ç«¯ã€‘è¯­ä¹‰åˆ†æï¼ˆSemantic Analysisï¼‰
    â†’ ç±»å‹æ¨æ–­ã€ç±»å‹æ£€æŸ¥
    â†’ ç”ŸæˆBinding Context
    â†“
ã€<span class="hljs-number">3</span>. å‰ç«¯ã€‘ç”ŸæˆIRï¼ˆIntermediate Representationï¼‰
    â†’ Kotlin IRæ ‘
    â†“
ã€<span class="hljs-number">4</span>. åç«¯ã€‘IRä¼˜åŒ–
    â†“
ã€<span class="hljs-number">5</span>. åç«¯ã€‘ä»£ç ç”Ÿæˆ
    â†’ JVMå­—èŠ‚ç  (.class)
    â†’ JSä»£ç  (.js)
    â†’ NativeäºŒè¿›åˆ¶ (.kexe)
</code></pre>
<h3 data-id="heading-5">æ’ä»¶ä»‹å…¥ç‚¹</h3>





























<table><thead><tr><th align="left">é˜¶æ®µ</th><th align="left">æ’ä»¶ç±»å‹</th><th align="left">èƒ½åŠ›</th><th align="left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left"><strong>è§£æå</strong></td><td align="left">æ³¨è§£å¤„ç†å™¨ï¼ˆKAPT/KSPï¼‰</td><td align="left">è¯»å–æ³¨è§£ï¼Œç”Ÿæˆæ–°æ–‡ä»¶</td><td align="left">Roomã€Dagger</td></tr><tr><td align="left"><strong>è¯­ä¹‰åˆ†æä¸­</strong></td><td align="left">ç¼–è¯‘å™¨æ’ä»¶ï¼ˆå‰ç«¯ï¼‰</td><td align="left">ä¿®æ”¹ç±»å‹ç³»ç»Ÿ</td><td align="left">Parcelizeã€Serialization</td></tr><tr><td align="left"><strong>IRç”Ÿæˆå</strong></td><td align="left">ç¼–è¯‘å™¨æ’ä»¶ï¼ˆåç«¯ï¼‰</td><td align="left">ä¿®æ”¹å­—èŠ‚ç é€»è¾‘</td><td align="left">Composeç¼–è¯‘å™¨æ’ä»¶</td></tr></tbody></table>
<blockquote>
<p><strong>âš ï¸ æ³¨æ„</strong></p>
<p>KAPTï¼ˆKotlin Annotation Processing Toolï¼‰åŸºäºJavaçš„APTï¼ˆAnnotation Processing Toolï¼‰ï¼Œéœ€è¦å°†Kotlinä»£ç è½¬æ¢ä¸ºJavaå­˜æ ¹ï¼ˆstubï¼‰ï¼Œæ•ˆç‡è¾ƒä½ã€‚KSPï¼ˆKotlin Symbol Processingï¼‰æ˜¯KotlinåŸç”Ÿçš„æ³¨è§£å¤„ç†æ–¹æ¡ˆï¼Œæ€§èƒ½æ›´å¥½ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">KSP vs KAPTï¼šæ³¨è§£å¤„ç†å™¨å¯¹æ¯”</h2>
<h3 data-id="heading-7">KAPTï¼ˆKotlin Annotation Processing Toolï¼‰</h3>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ol>
<li>å°†Kotlinä»£ç è½¬æ¢ä¸ºJavaå­˜æ ¹ï¼ˆåªä¿ç•™ç­¾åï¼Œä¸¢å¤±å®ç°ç»†èŠ‚ï¼‰</li>
<li>è°ƒç”¨Javaæ³¨è§£å¤„ç†å™¨å¤„ç†å­˜æ ¹</li>
<li>ç”Ÿæˆæ–°çš„Java/Kotlinä»£ç </li>
<li>é‡æ–°ç¼–è¯‘</li>
</ol>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li><strong>æ…¢</strong>ï¼šéœ€è¦ç”Ÿæˆå­˜æ ¹ï¼Œç¼–è¯‘ä¸¤æ¬¡</li>
<li><strong>ä¿¡æ¯ä¸¢å¤±</strong>ï¼šKotlinç‰¹æ€§ï¼ˆé»˜è®¤å‚æ•°ã€æ‰©å±•å‡½æ•°ç­‰ï¼‰åœ¨å­˜æ ¹ä¸­ä¸¢å¤±</li>
<li><strong>ç»´æŠ¤æˆæœ¬é«˜</strong>ï¼šä¾èµ–äºJava APT</li>
</ul>
<h3 data-id="heading-8">KSPï¼ˆKotlin Symbol Processingï¼‰</h3>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ol>
<li>ç›´æ¥è®¿é—®Kotlinç¼–è¯‘å™¨çš„ç¬¦å·ï¼ˆSymbolï¼‰</li>
<li>é€šè¿‡KSP APIè¯»å–ç±»å‹ä¿¡æ¯</li>
<li>ç”Ÿæˆæ–°ä»£ç </li>
<li>ç¼–è¯‘ä¸€æ¬¡å®Œæˆ</li>
</ol>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>å¿«</strong>ï¼šæ¯”KAPTå¿«2å€ä»¥ä¸Š</li>
<li><strong>å®Œæ•´</strong>ï¼šå®Œå…¨ç†è§£Kotlinè¯­ä¹‰</li>
<li><strong>ç°ä»£åŒ–</strong>ï¼šä¸“ä¸ºKotlinè®¾è®¡</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f449a5d047446bdbc17769f38ccae55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856390&amp;x-signature=LGzfstXkNxXuK57m7dHYNwLvd1g%3D" alt="14-02-ksp-vs-kapt.png" loading="lazy"/></p>
<h3 data-id="heading-9">è¿ç§»å»ºè®®</h3>





















<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">å»ºè®®</th></tr></thead><tbody><tr><td align="left">æ–°é¡¹ç›®</td><td align="left">ç›´æ¥ä½¿ç”¨KSP</td></tr><tr><td align="left">ç°æœ‰KAPTé¡¹ç›®</td><td align="left">é€æ­¥è¿ç§»åˆ°KSP</td></tr><tr><td align="left">ä¾èµ–KAPTçš„åº“</td><td align="left">ç­‰å¾…åº“ä½œè€…æ”¯æŒKSP</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">KSPå®æˆ˜ï¼šæ„å»ºè‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨</h2>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®é™…æ¡ˆä¾‹å­¦ä¹ KSPï¼šè‡ªåŠ¨ç”ŸæˆBuilderæ¨¡å¼ä»£ç ã€‚</p>
<h3 data-id="heading-11">ç›®æ ‡</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è¾“å…¥ï¼šä½¿ç”¨æ³¨è§£</span>
<span class="hljs-meta">@AutoBuilder</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>,
    <span class="hljs-keyword">val</span> email: String?
)

<span class="hljs-comment">// è¾“å‡ºï¼šè‡ªåŠ¨ç”ŸæˆBuilder</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBuilder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> name: String? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> age: <span class="hljs-built_in">Int</span>? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> email: String? = <span class="hljs-literal">null</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">name</span><span class="hljs-params">(value: <span class="hljs-type">String</span>)</span></span> = apply { name = value }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">age</span><span class="hljs-params">(value: <span class="hljs-type">Int</span>)</span></span> = apply { age = value }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">email</span><span class="hljs-params">(value: <span class="hljs-type">String</span>?)</span></span> = apply { email = value }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span>: User {
        requireNotNull(name) { <span class="hljs-string">"name is required"</span> }
        requireNotNull(age) { <span class="hljs-string">"age is required"</span> }
        <span class="hljs-keyword">return</span> User(name!!, age!!, email)
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> user = UserBuilder()
    .name(<span class="hljs-string">"Alice"</span>)
    .age(<span class="hljs-number">30</span>)
    .email(<span class="hljs-string">"alice@example.com"</span>)
    .build()
</code></pre>
<h3 data-id="heading-12">æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build.gradle.kts</span>
plugins {
    id(<span class="hljs-string">"com.google.devtools.ksp"</span>) version <span class="hljs-string">"1.9.0-1.0.13"</span>
}

dependencies {
    implementation(<span class="hljs-string">"com.google.devtools.ksp:symbol-processing-api:1.9.0-1.0.13"</span>)
}

<span class="hljs-comment">// åœ¨éœ€è¦ä½¿ç”¨æ³¨è§£çš„æ¨¡å—</span>
dependencies {
    ksp(project(<span class="hljs-string">":annotation-processor"</span>))
}
</code></pre>
<h3 data-id="heading-13">æ­¥éª¤2ï¼šå®šä¹‰æ³¨è§£</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// annotations/src/main/kotlin/AutoBuilder.kt</span>
<span class="hljs-meta">@Target(AnnotationTarget.CLASS)</span>
<span class="hljs-meta">@Retention(AnnotationRetention.SOURCE)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoBuilder</span>
</code></pre>
<h3 data-id="heading-14">æ­¥éª¤3ï¼šå®ç°KSPå¤„ç†å™¨</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// processor/src/main/kotlin/AutoBuilderProcessor.kt</span>
<span class="hljs-keyword">import</span> com.google.devtools.ksp.processing.*
<span class="hljs-keyword">import</span> com.google.devtools.ksp.symbol.*
<span class="hljs-keyword">import</span> com.google.devtools.ksp.validate
<span class="hljs-keyword">import</span> java.io.OutputStream

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoBuilderProcessor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> codeGenerator: CodeGenerator,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> logger: KSPLogger
) : SymbolProcessor {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(resolver: <span class="hljs-type">Resolver</span>)</span></span>: List&lt;KSAnnotated&gt; {
        <span class="hljs-comment">// 1. æŸ¥æ‰¾æ‰€æœ‰æ ‡æ³¨äº†@AutoBuilderçš„ç±»</span>
        <span class="hljs-keyword">val</span> symbols = resolver.getSymbolsWithAnnotation(<span class="hljs-string">"com.example.AutoBuilder"</span>)
        <span class="hljs-keyword">val</span> unprocessed = symbols.filterIsInstance&lt;KSClassDeclaration&gt;()
            .filter { !it.validate() }  <span class="hljs-comment">// è¿‡æ»¤æ‰æ— æ•ˆçš„ç¬¦å·</span>
            .toList()

        <span class="hljs-comment">// 2. å¤„ç†æ¯ä¸ªç±»</span>
        symbols.filterIsInstance&lt;KSClassDeclaration&gt;()
            .filter { it.validate() }
            .forEach { classDeclaration -&gt;
                generateBuilder(classDeclaration)
            }

        <span class="hljs-keyword">return</span> unprocessed
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateBuilder</span><span class="hljs-params">(classDeclaration: <span class="hljs-type">KSClassDeclaration</span>)</span></span> {
        <span class="hljs-keyword">val</span> className = classDeclaration.simpleName.asString()
        <span class="hljs-keyword">val</span> packageName = classDeclaration.packageName.asString()
        <span class="hljs-keyword">val</span> builderClassName = <span class="hljs-string">"<span class="hljs-subst">${className}</span>Builder"</span>

        <span class="hljs-comment">// 3. è·å–ä¸»æ„é€ å‡½æ•°çš„å‚æ•°</span>
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">constructor</span> = classDeclaration.primaryConstructor
            ?: run {
                logger.error(<span class="hljs-string">"No primary constructor found"</span>, classDeclaration)
                <span class="hljs-keyword">return</span>
            }

        <span class="hljs-keyword">val</span> parameters = <span class="hljs-keyword">constructor</span>.parameters

        <span class="hljs-comment">// 4. ç”ŸæˆBuilderä»£ç </span>
        <span class="hljs-keyword">val</span> fileContent = buildString {
            appendLine(<span class="hljs-string">"package <span class="hljs-variable">$packageName</span>"</span>)
            appendLine()
            appendLine(<span class="hljs-string">"class <span class="hljs-variable">$builderClassName</span> {"</span>)

            <span class="hljs-comment">// ç”Ÿæˆå±æ€§</span>
            parameters.forEach { param -&gt;
                <span class="hljs-keyword">val</span> paramName = param.name!!.asString()
                <span class="hljs-keyword">val</span> paramType = param.type.resolve().declaration.qualifiedName!!.asString()
                <span class="hljs-keyword">val</span> isNullable = param.type.resolve().isMarkedNullable
                <span class="hljs-keyword">val</span> nullableMark = <span class="hljs-keyword">if</span> (isNullable) <span class="hljs-string">"?"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"?"</span>
                appendLine(<span class="hljs-string">"    private var <span class="hljs-variable">$paramName</span>: <span class="hljs-variable">$paramType</span><span class="hljs-variable">$nullableMark</span> = null"</span>)
            }
            appendLine()

            <span class="hljs-comment">// ç”Ÿæˆsetteræ–¹æ³•</span>
            parameters.forEach { param -&gt;
                <span class="hljs-keyword">val</span> paramName = param.name!!.asString()
                <span class="hljs-keyword">val</span> paramType = param.type.resolve().declaration.qualifiedName!!.asString()
                <span class="hljs-keyword">val</span> isNullable = param.type.resolve().isMarkedNullable
                <span class="hljs-keyword">val</span> nullableMark = <span class="hljs-keyword">if</span> (isNullable) <span class="hljs-string">"?"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
                appendLine(<span class="hljs-string">"    fun <span class="hljs-variable">$paramName</span>(value: <span class="hljs-variable">$paramType</span><span class="hljs-variable">$nullableMark</span>) = apply { <span class="hljs-variable">$paramName</span> = value }"</span>)
            }
            appendLine()

            <span class="hljs-comment">// ç”Ÿæˆbuildæ–¹æ³•</span>
            appendLine(<span class="hljs-string">"    fun build(): <span class="hljs-variable">$className</span> {"</span>)
            parameters.forEach { param -&gt;
                <span class="hljs-keyword">val</span> paramName = param.name!!.asString()
                <span class="hljs-keyword">if</span> (!param.type.resolve().isMarkedNullable) {
                    appendLine(<span class="hljs-string">"        requireNotNull(<span class="hljs-variable">$paramName</span>) { \"<span class="hljs-variable">$paramName</span> is required\" }"</span>)
                }
            }
            <span class="hljs-keyword">val</span> paramList = parameters.joinToString(<span class="hljs-string">", "</span>) { param -&gt;
                <span class="hljs-keyword">val</span> paramName = param.name!!.asString()
                <span class="hljs-keyword">if</span> (param.type.resolve().isMarkedNullable) {
                    paramName
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-string">"<span class="hljs-variable">$paramName</span>!!"</span>
                }
            }
            appendLine(<span class="hljs-string">"        return <span class="hljs-variable">$className</span>(<span class="hljs-variable">$paramList</span>)"</span>)
            appendLine(<span class="hljs-string">"    }"</span>)
            appendLine(<span class="hljs-string">"}"</span>)
        }

        <span class="hljs-comment">// 5. å†™å…¥æ–‡ä»¶</span>
        <span class="hljs-keyword">val</span> file = codeGenerator.createNewFile(
            dependencies = Dependencies(<span class="hljs-literal">false</span>, classDeclaration.containingFile!!),
            packageName = packageName,
            fileName = builderClassName
        )

        file.write(fileContent.toByteArray())
        file.close()
    }
}

<span class="hljs-comment">// å¤„ç†å™¨å·¥å‚</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoBuilderProcessorProvider</span> : <span class="hljs-type">SymbolProcessorProvider</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(environment: <span class="hljs-type">SymbolProcessorEnvironment</span>)</span></span>: SymbolProcessor {
        <span class="hljs-keyword">return</span> AutoBuilderProcessor(environment.codeGenerator, environment.logger)
    }
}
</code></pre>
<h3 data-id="heading-15">æ­¥éª¤4ï¼šæ³¨å†Œå¤„ç†å™¨</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// processor/src/main/resources/META-INF/services/com.google.devtools.ksp.processing.SymbolProcessorProvider</span>
com.example.processor.AutoBuilderProcessorProvider
</code></pre>
<h3 data-id="heading-16">æ­¥éª¤5ï¼šä½¿ç”¨</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@AutoBuilder</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>,
    <span class="hljs-keyword">val</span> email: String?
)

<span class="hljs-comment">// ç¼–è¯‘åè‡ªåŠ¨ç”ŸæˆUserBuilderç±»</span>
<span class="hljs-keyword">val</span> user = UserBuilder()
    .name(<span class="hljs-string">"Alice"</span>)
    .age(<span class="hljs-number">30</span>)
    .build()
</code></pre>
<blockquote>
<p><strong>âœ… æœ€ä½³å®è·µ</strong></p>
<ol>
<li>ä½¿ç”¨ <code>Dependencies</code> è·Ÿè¸ªä¾èµ–ï¼Œç¡®ä¿å¢é‡ç¼–è¯‘æ­£ç¡®æ€§</li>
<li>ä½¿ç”¨ <code>validate()</code> è¿‡æ»¤æ— æ•ˆç¬¦å·ï¼Œé¿å…å¤šè½®å¤„ç†</li>
<li>ä½¿ç”¨ <code>logger</code> è¾“å‡ºé”™è¯¯å’Œè­¦å‘Šä¿¡æ¯</li>
<li>ç”Ÿæˆçš„ä»£ç åº”è¯¥æ˜“è¯»ï¼ŒåŒ…å«å¿…è¦çš„æ³¨é‡Š</li>
</ol>
</blockquote>
<hr/>
<h2 data-id="heading-17">ç¼–è¯‘å™¨æ’ä»¶å®æˆ˜ï¼šè‡ªå®šä¹‰ç¼–è¯‘å™¨æ£€æŸ¥</h2>
<p>KSPåªèƒ½ç”Ÿæˆæ–°ä»£ç ï¼Œæ— æ³•ä¿®æ”¹ç°æœ‰ä»£ç ã€‚å¦‚æœæƒ³åœ¨ç¼–è¯‘æœŸæ·»åŠ è‡ªå®šä¹‰æ£€æŸ¥ï¼ˆå¦‚ç¦æ­¢ä½¿ç”¨æŸäº›APIï¼‰ï¼Œéœ€è¦ç¼–è¯‘å™¨æ’ä»¶ã€‚</p>
<h3 data-id="heading-18">ç›®æ ‡</h3>
<p>ç¦æ­¢åœ¨ç”Ÿäº§ä»£ç ä¸­ä½¿ç”¨ <code>println</code>ï¼Œç¼–è¯‘æ—¶æŠ¥é”™ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">debugLog</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"Debug info"</span>)  <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼šç¦æ­¢ä½¿ç”¨println</span>
}
</code></pre>
<h3 data-id="heading-19">ç¼–è¯‘å™¨æ’ä»¶æ¶æ„</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7638c7f2c21c4cc7af95d4f6b8ea62c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856390&amp;x-signature=6QH794XvbHmo1P%2FA2LHUg8Vgrqc%3D" alt="14-03-compiler-plugin-arch.png" loading="lazy"/></p>
<p>ç¼–è¯‘å™¨æ’ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<ol>
<li><strong>Gradleæ’ä»¶</strong>ï¼šæ³¨å†Œç¼–è¯‘å™¨æ’ä»¶åˆ°Kotlinç¼–è¯‘å™¨</li>
<li><strong>ç¼–è¯‘å™¨æ’ä»¶</strong>ï¼šå®ç°ç¼–è¯‘æœŸé€»è¾‘</li>
</ol>
<h3 data-id="heading-20">æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ–</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build.gradle.kts</span>
plugins {
    kotlin(<span class="hljs-string">"jvm"</span>)
    id(<span class="hljs-string">"com.github.gmazzo.buildconfig"</span>) version <span class="hljs-string">"3.1.0"</span>
}

dependencies {
    compileOnly(<span class="hljs-string">"org.jetbrains.kotlin:kotlin-compiler-embeddable:1.9.0"</span>)
}
</code></pre>
<h3 data-id="heading-21">æ­¥éª¤2ï¼šå®ç°ç¼–è¯‘å™¨æ’ä»¶</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// compiler-plugin/src/main/kotlin/NoPrintlnChecker.kt</span>
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.backend.common.IrElementTransformerVoidWithContext
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.backend.common.extensions.IrPluginContext
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.ir.IrStatement
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.ir.expressions.IrCall
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.cli.common.messages.CompilerMessageSeverity
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.cli.common.messages.MessageCollector

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NoPrintlnChecker</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> messageCollector: MessageCollector
) : IrElementTransformerVoidWithContext() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visitCall</span><span class="hljs-params">(expression: <span class="hljs-type">IrCall</span>)</span></span>: IrStatement {
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯printlnè°ƒç”¨</span>
        <span class="hljs-keyword">val</span> callee = expression.symbol.owner
        <span class="hljs-keyword">if</span> (callee.name.asString() == <span class="hljs-string">"println"</span>) {
            messageCollector.report(
                CompilerMessageSeverity.ERROR,
                <span class="hljs-string">"Using println is not allowed in production code"</span>,
                expression.startOffset?.let {
                    <span class="hljs-comment">// è·å–æºä»£ç ä½ç½®</span>
                    it.getLineAndColumnInFile()
                } ?: CompilerMessageLocation.NO_LOCATION
            )
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.visitCall(expression)
    }
}
</code></pre>
<h3 data-id="heading-22">æ­¥éª¤3ï¼šåˆ›å»ºIRæ‰©å±•</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// compiler-plugin/src/main/kotlin/NoPrintlnExtension.kt</span>
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.backend.common.extensions.IrGenerationExtension
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.backend.common.extensions.IrPluginContext
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.ir.declarations.IrModuleFragment
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.cli.common.messages.MessageCollector

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NoPrintlnExtension</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> messageCollector: MessageCollector
) : IrGenerationExtension {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generate</span><span class="hljs-params">(moduleFragment: <span class="hljs-type">IrModuleFragment</span>, pluginContext: <span class="hljs-type">IrPluginContext</span>)</span></span> {
        <span class="hljs-comment">// éå†IRæ ‘ï¼Œåº”ç”¨æ£€æŸ¥</span>
        moduleFragment.transform(NoPrintlnChecker(messageCollector), <span class="hljs-literal">null</span>)
    }
}
</code></pre>
<h3 data-id="heading-23">æ­¥éª¤4ï¼šåˆ›å»ºç¼–è¯‘å™¨æ’ä»¶æ³¨å†Œå™¨</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// compiler-plugin/src/main/kotlin/NoPrintlnComponentRegistrar.kt</span>
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.backend.common.extensions.IrGenerationExtension
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.compiler.plugin.CompilerPluginRegistrar
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.config.CompilerConfiguration
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.cli.common.messages.MessageCollector

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NoPrintlnComponentRegistrar</span> : <span class="hljs-type">CompilerPluginRegistrar</span>() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> ExtensionStorage.<span class="hljs-title">registerExtensions</span><span class="hljs-params">(configuration: <span class="hljs-type">CompilerConfiguration</span>)</span></span> {
        <span class="hljs-keyword">val</span> messageCollector = configuration.<span class="hljs-keyword">get</span>(CLIConfigurationKeys.MESSAGE_COLLECTOR_KEY, MessageCollector.NONE)

        IrGenerationExtension.registerExtension(NoPrintlnExtension(messageCollector))
    }

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> supportsK2: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">true</span>
}
</code></pre>
<h3 data-id="heading-24">æ­¥éª¤5ï¼šåˆ›å»ºGradleæ’ä»¶</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// gradle-plugin/src/main/kotlin/NoPrintlnGradlePlugin.kt</span>
<span class="hljs-keyword">import</span> org.gradle.api.Project
<span class="hljs-keyword">import</span> org.gradle.api.provider.Provider
<span class="hljs-keyword">import</span> org.jetbrains.kotlin.gradle.plugin.*

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NoPrintlnGradlePlugin</span> : <span class="hljs-type">KotlinCompilerPluginSupportPlugin</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(target: <span class="hljs-type">Project</span>)</span></span> {
        <span class="hljs-comment">// Gradleæ’ä»¶åº”ç”¨é€»è¾‘</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCompilerPluginId</span><span class="hljs-params">()</span></span>: String = <span class="hljs-string">"no-println-plugin"</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getPluginArtifact</span><span class="hljs-params">()</span></span>: SubpluginArtifact {
        <span class="hljs-keyword">return</span> SubpluginArtifact(
            groupId = <span class="hljs-string">"com.example"</span>,
            artifactId = <span class="hljs-string">"no-println-compiler-plugin"</span>,
            version = <span class="hljs-string">"1.0.0"</span>
        )
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isApplicable</span><span class="hljs-params">(kotlinCompilation: <span class="hljs-type">KotlinCompilation</span>&lt;*&gt;)</span></span>: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">true</span>

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">applyToCompilation</span><span class="hljs-params">(
        kotlinCompilation: <span class="hljs-type">KotlinCompilation</span>&lt;*&gt;
    )</span></span>: Provider&lt;List&lt;SubpluginOption&gt;&gt; {
        <span class="hljs-keyword">return</span> kotlinCompilation.target.project.provider { emptyList() }
    }
}
</code></pre>
<h3 data-id="heading-25">æ­¥éª¤6ï¼šæ³¨å†ŒæœåŠ¡</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// gradle-plugin/src/main/resources/META-INF/services/org.jetbrains.kotlin.compiler.plugin.CompilerPluginRegistrar</span>
com.example.NoPrintlnComponentRegistrar

<span class="hljs-comment">// gradle-plugin/src/main/resources/META-INF/gradle-plugins/no-println-plugin.properties</span>
implementation-<span class="hljs-keyword">class</span>=com.example.NoPrintlnGradlePlugin
</code></pre>
<h3 data-id="heading-26">æ­¥éª¤7ï¼šä½¿ç”¨æ’ä»¶</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build.gradle.kts</span>
plugins {
    id(<span class="hljs-string">"no-println-plugin"</span>)
}

<span class="hljs-comment">// ç¼–è¯‘æ—¶ä¼šæ£€æŸ¥printlnè°ƒç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"Hello"</span>)  <span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼šUsing println is not allowed in production code</span>
}
</code></pre>
<blockquote>
<p><strong>âš ï¸ æ³¨æ„</strong></p>
<p>ç¼–è¯‘å™¨æ’ä»¶å¼€å‘éœ€è¦æ·±å…¥ç†è§£Kotlinç¼–è¯‘å™¨å†…éƒ¨å®ç°ï¼ŒAPIä¸ç¨³å®šï¼Œå‡çº§Kotlinç‰ˆæœ¬æ—¶å¯èƒ½éœ€è¦é€‚é…ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-27">å®æˆ˜æ¡ˆä¾‹ï¼šå­—èŠ‚ç å¢å¼º</h2>
<p>ç¼–è¯‘å™¨æ’ä»¶çš„å¦ä¸€ä¸ªå¼ºå¤§èƒ½åŠ›æ˜¯å­—èŠ‚ç å¢å¼ºï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹æ³¨å…¥é€»è¾‘ã€‚</p>
<h3 data-id="heading-28">æ¡ˆä¾‹ï¼šè‡ªåŠ¨æ—¥å¿—æ³¨å…¥</h3>
<p>è‡ªåŠ¨ä¸ºæ‰€æœ‰å‡½æ•°å…¥å£å’Œå‡ºå£æ·»åŠ æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åŸå§‹ä»£ç </span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateSum</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-comment">// ç¼–è¯‘åå®é™…è¡Œä¸º</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateSum</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
    println(<span class="hljs-string">"[ENTER] calculateSum(a=<span class="hljs-variable">$a</span>, b=<span class="hljs-variable">$b</span>)"</span>)
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">val</span> result = a + b
        println(<span class="hljs-string">"[EXIT] calculateSum -&gt; <span class="hljs-variable">$result</span>"</span>)
        <span class="hljs-keyword">return</span> result
    } <span class="hljs-keyword">catch</span> (e: Exception) {
        println(<span class="hljs-string">"[ERROR] calculateSum -&gt; <span class="hljs-variable">$e</span>"</span>)
        <span class="hljs-keyword">throw</span> e
    }
}
</code></pre>
<h3 data-id="heading-29">å®ç°æ€è·¯</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoLogTransformer</span> : <span class="hljs-type">IrElementTransformerVoidWithContext</span>() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visitFunction</span><span class="hljs-params">(declaration: <span class="hljs-type">IrFunction</span>)</span></span>: IrStatement {
        <span class="hljs-comment">// è·³è¿‡ç¼–è¯‘å™¨ç”Ÿæˆçš„å‡½æ•°</span>
        <span class="hljs-keyword">if</span> (declaration.origin != IrDeclarationOrigin.DEFINED) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.visitFunction(declaration)
        }

        <span class="hljs-keyword">val</span> body = declaration.body ?: <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.visitFunction(declaration)

        <span class="hljs-comment">// åœ¨å‡½æ•°å…¥å£æ³¨å…¥æ—¥å¿—</span>
        <span class="hljs-keyword">val</span> enterLog = buildStatement(declaration.startOffset, declaration.endOffset) {
            irCall(printlnFunction).apply {
                putValueArgument(<span class="hljs-number">0</span>, irString(<span class="hljs-string">"[ENTER] <span class="hljs-subst">${declaration.name}</span>(...)"</span>))
            }
        }

        <span class="hljs-comment">// åœ¨å‡½æ•°å‡ºå£æ³¨å…¥æ—¥å¿—</span>
        <span class="hljs-keyword">val</span> exitLog = buildStatement(declaration.startOffset, declaration.endOffset) {
            irCall(printlnFunction).apply {
                putValueArgument(<span class="hljs-number">0</span>, irString(<span class="hljs-string">"[EXIT] <span class="hljs-subst">${declaration.name}</span>"</span>))
            }
        }

        <span class="hljs-comment">// ä¿®æ”¹å‡½æ•°ä½“</span>
        declaration.body = IrBlockBodyImpl(
            startOffset = body.startOffset,
            endOffset = body.endOffset,
            statements = listOf(enterLog) + body.statements + listOf(exitLog)
        )

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.visitFunction(declaration)
    }
}
</code></pre>
<blockquote>
<p><strong>ğŸ’¡ åº”ç”¨åœºæ™¯</strong></p>
<ul>
<li>æ€§èƒ½ç›‘æ§ï¼šè‡ªåŠ¨ç»Ÿè®¡å‡½æ•°æ‰§è¡Œæ—¶é—´</li>
<li>AOPï¼šå®ç°åˆ‡é¢ç¼–ç¨‹ï¼ˆäº‹åŠ¡ã€æƒé™æ£€æŸ¥ï¼‰</li>
<li>ä»£ç æ³¨å…¥ï¼šè‡ªåŠ¨æ·»åŠ ç©ºå€¼æ£€æŸ¥ã€æ—¥å¿—</li>
<li>çƒ­ä¿®å¤ï¼šåœ¨ç¼–è¯‘æœŸæ’å…¥è¡¥ä¸é€»è¾‘</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-30">ç¼–è¯‘å™¨æ’ä»¶ vs æ³¨è§£å¤„ç†å™¨ï¼šå¦‚ä½•é€‰æ‹©</h2>








































<table><thead><tr><th align="left">ç»´åº¦</th><th align="left">æ³¨è§£å¤„ç†å™¨ï¼ˆKSPï¼‰</th><th align="left">ç¼–è¯‘å™¨æ’ä»¶</th></tr></thead><tbody><tr><td align="left"><strong>èƒ½åŠ›</strong></td><td align="left">ç”Ÿæˆæ–°ä»£ç </td><td align="left">ä¿®æ”¹ç°æœ‰ä»£ç ã€å­—èŠ‚ç </td></tr><tr><td align="left"><strong>éš¾åº¦</strong></td><td align="left">ç®€å•</td><td align="left">å¤æ‚</td></tr><tr><td align="left"><strong>ç¨³å®šæ€§</strong></td><td align="left">é«˜ï¼ˆKSP APIç¨³å®šï¼‰</td><td align="left">ä½ï¼ˆç¼–è¯‘å™¨APIä¸ç¨³å®šï¼‰</td></tr><tr><td align="left"><strong>æ€§èƒ½</strong></td><td align="left">å¿«ï¼ˆKSPä¼˜åŒ–è‰¯å¥½ï¼‰</td><td align="left">ä¸­ç­‰</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left">ä»£ç ç”Ÿæˆ</td><td align="left">è‡ªå®šä¹‰æ£€æŸ¥ã€å­—èŠ‚ç å¢å¼º</td></tr><tr><td align="left"><strong>ç»´æŠ¤æˆæœ¬</strong></td><td align="left">ä½</td><td align="left">é«˜</td></tr></tbody></table>
<h3 data-id="heading-31">é€‰æ‹©å»ºè®®</h3>
<p><strong>ä¼˜å…ˆä½¿ç”¨KSP</strong>ï¼š</p>
<ul>
<li>âœ… ä»£ç ç”Ÿæˆï¼ˆBuilderã€DTOè½¬æ¢ã€åºåˆ—åŒ–ï¼‰</li>
<li>âœ… åŸºäºæ³¨è§£çš„æ¡†æ¶ï¼ˆä¾èµ–æ³¨å…¥ã€ORMï¼‰</li>
<li>âœ… éœ€è¦ç¨³å®šAPIçš„é¡¹ç›®</li>
</ul>
<p><strong>è€ƒè™‘ç¼–è¯‘å™¨æ’ä»¶</strong>ï¼š</p>
<ul>
<li>âœ… ä¿®æ”¹ç°æœ‰ä»£ç è¡Œä¸ºï¼ˆå¦‚Parcelizeï¼‰</li>
<li>âœ… è‡ªå®šä¹‰ç¼–è¯‘å™¨æ£€æŸ¥</li>
<li>âœ… å­—èŠ‚ç å¢å¼ºï¼ˆAOPã€æ€§èƒ½ç›‘æ§ï¼‰</li>
<li>âš ï¸ èƒ½æ¥å—é«˜ç»´æŠ¤æˆæœ¬</li>
</ul>
<hr/>
<h2 data-id="heading-32">æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-33">1. å¢é‡ç¼–è¯‘å‹å¥½</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨Dependenciesè·Ÿè¸ªä¾èµ–</span>
<span class="hljs-keyword">val</span> file = codeGenerator.createNewFile(
    dependencies = Dependencies(
        aggregating = <span class="hljs-literal">false</span>,  <span class="hljs-comment">// éèšåˆä¾èµ–</span>
        sources = arrayOf(classDeclaration.containingFile!!)  <span class="hljs-comment">// æ˜ç¡®ä¾èµ–çš„æºæ–‡ä»¶</span>
    ),
    packageName = packageName,
    fileName = fileName
)

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šä¸è·Ÿè¸ªä¾èµ–</span>
<span class="hljs-keyword">val</span> file = codeGenerator.createNewFile(
    dependencies = Dependencies(<span class="hljs-literal">false</span>),  <span class="hljs-comment">// ç¼ºå°‘sources</span>
    packageName = packageName,
    fileName = fileName
)
</code></pre>
<h3 data-id="heading-34">2. é”™è¯¯å¤„ç†</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… ä½¿ç”¨loggerè¾“å‡ºé”™è¯¯</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">constructor</span> == <span class="hljs-literal">null</span>) {
    logger.error(<span class="hljs-string">"No primary constructor found"</span>, classDeclaration)
    <span class="hljs-keyword">return</span>
}

<span class="hljs-comment">// âœ… æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯</span>
logger.error(
    <span class="hljs-string">"Parameter <span class="hljs-subst">${param.name}</span> must be non-nullable"</span>,
    param
)

<span class="hljs-comment">// âŒ æŠ›å‡ºå¼‚å¸¸ï¼ˆä¼šä¸­æ–­ç¼–è¯‘ï¼Œæ— æ³•ç»§ç»­ï¼‰</span>
<span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"No constructor"</span>)
</code></pre>
<h3 data-id="heading-35">3. ç”Ÿæˆå¯è¯»ä»£ç </h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… ç”Ÿæˆæ ¼å¼åŒ–çš„ä»£ç </span>
<span class="hljs-keyword">val</span> fileContent = buildString {
    appendLine(<span class="hljs-string">"package <span class="hljs-variable">$packageName</span>"</span>)
    appendLine()
    appendLine(<span class="hljs-string">"/**"</span>)
    appendLine(<span class="hljs-string">" * Auto-generated by @AutoBuilder"</span>)
    appendLine(<span class="hljs-string">" * Do not modify this file manually"</span>)
    appendLine(<span class="hljs-string">" */"</span>)
    appendLine(<span class="hljs-string">"class <span class="hljs-variable">$builderClassName</span> {"</span>)
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// âŒ ç”Ÿæˆéš¾ä»¥é˜…è¯»çš„ä»£ç </span>
<span class="hljs-keyword">val</span> fileContent = <span class="hljs-string">"package <span class="hljs-variable">$packageName</span>\nclass <span class="hljs-variable">$builderClassName</span>{..."</span>
</code></pre>
<h3 data-id="heading-36">4. æ”¯æŒKotlinç‰¹æ€§</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®å¤„ç†å¯ç©ºç±»å‹</span>
<span class="hljs-keyword">val</span> isNullable = param.type.resolve().isMarkedNullable

<span class="hljs-comment">// âœ… æ­£ç¡®å¤„ç†é»˜è®¤å‚æ•°</span>
<span class="hljs-keyword">val</span> hasDefault = param.hasDefault

<span class="hljs-comment">// âœ… æ­£ç¡®å¤„ç†æ³›å‹</span>
<span class="hljs-keyword">val</span> typeArguments = param.type.resolve().arguments
</code></pre>
<h3 data-id="heading-37">5. æµ‹è¯•</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä½¿ç”¨kotlin-compile-testingæµ‹è¯•KSPå¤„ç†å™¨</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> `test AutoBuilder generation`<span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> result = KotlinCompilation().apply {
        sources = listOf(
            SourceFile.kotlin(<span class="hljs-string">"User.kt"</span>, <span class="hljs-string">"""
                @AutoBuilder
                data class User(val name: String, val age: Int)
            """</span>)
        )
        symbolProcessorProviders = listOf(AutoBuilderProcessorProvider())
        inheritClassPath = <span class="hljs-literal">true</span>
    }.compile()

    assertEquals(KotlinCompilation.ExitCode.OK, result.exitCode)

    <span class="hljs-comment">// éªŒè¯ç”Ÿæˆçš„ä»£ç </span>
    <span class="hljs-keyword">val</span> generatedFile = result.generatedFiles.find { it.name == <span class="hljs-string">"UserBuilder.kt"</span> }
    assertNotNull(generatedFile)
}
</code></pre>
<hr/>
<h2 data-id="heading-38">æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-39">1. ç¼“å­˜ç¬¦å·æŸ¥è¯¢</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ æ¯æ¬¡éƒ½æŸ¥è¯¢</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(resolver: <span class="hljs-type">Resolver</span>)</span></span> {
    resolver.getSymbolsWithAnnotation(<span class="hljs-string">"com.example.AutoBuilder"</span>).forEach { ... }
    resolver.getSymbolsWithAnnotation(<span class="hljs-string">"com.example.AutoBuilder"</span>).forEach { ... }  <span class="hljs-comment">// é‡å¤æŸ¥è¯¢</span>
}

<span class="hljs-comment">// âœ… ç¼“å­˜æŸ¥è¯¢ç»“æœ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoBuilderProcessor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cachedSymbols: List&lt;KSClassDeclaration&gt;? = <span class="hljs-literal">null</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(resolver: <span class="hljs-type">Resolver</span>)</span></span> {
        <span class="hljs-keyword">val</span> symbols = cachedSymbols ?: resolver.getSymbolsWithAnnotation(<span class="hljs-string">"com.example.AutoBuilder"</span>)
            .filterIsInstance&lt;KSClassDeclaration&gt;()
            .toList()
            .also { cachedSymbols = it }
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<h3 data-id="heading-40">2. é¿å…è¿‡åº¦éå†</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ éå†æ•´ä¸ªæ¨¡å—</span>
moduleFragment.acceptChildren(visitor, <span class="hljs-literal">null</span>)

<span class="hljs-comment">// âœ… åªéå†éœ€è¦çš„éƒ¨åˆ†</span>
moduleFragment.files.forEach { file -&gt;
    <span class="hljs-keyword">if</span> (shouldProcess(file)) {
        file.acceptChildren(visitor, <span class="hljs-literal">null</span>)
    }
}
</code></pre>
<h3 data-id="heading-41">3. å¹¶è¡Œå¤„ç†</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… ä½¿ç”¨åç¨‹å¹¶è¡Œç”Ÿæˆä»£ç </span>
runBlocking {
    symbols.map { symbol -&gt;
        async(Dispatchers.IO) {
            generateBuilder(symbol)
        }
    }.awaitAll()
}
</code></pre>
<hr/>
<h2 data-id="heading-42">å¸¸è§é™·é˜±</h2>
<h3 data-id="heading-43">1. å¿˜è®°å¤„ç†å¤šè½®ç¼–è¯‘</h3>
<p>KSPå¯èƒ½éœ€è¦å¤šè½®ç¼–è¯‘ï¼ˆå½“ç”Ÿæˆçš„ä»£ç åˆæœ‰æ³¨è§£æ—¶ï¼‰ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šè¿”å›æœªå¤„ç†çš„ç¬¦å·</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(resolver: <span class="hljs-type">Resolver</span>)</span></span>: List&lt;KSAnnotated&gt; {
    <span class="hljs-keyword">val</span> symbols = resolver.getSymbolsWithAnnotation(<span class="hljs-string">"com.example.AutoBuilder"</span>)
    <span class="hljs-keyword">val</span> (valid, invalid) = symbols.partition { it.validate() }

    valid.forEach { processSymbol(it) }

    <span class="hljs-keyword">return</span> invalid.toList()  <span class="hljs-comment">// è¿”å›æœªå¤„ç†çš„ç¬¦å·ï¼Œä¸‹ä¸€è½®ç»§ç»­å¤„ç†</span>
}
</code></pre>
<h3 data-id="heading-44">2. ä¾èµ–è·Ÿè¸ªä¸æ­£ç¡®</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šaggregating=falseä½†æ²¡æœ‰æŒ‡å®šsources</span>
<span class="hljs-keyword">val</span> file = codeGenerator.createNewFile(
    dependencies = Dependencies(aggregating = <span class="hljs-literal">false</span>),  <span class="hljs-comment">// ç¼ºå°‘sources</span>
    packageName = packageName,
    fileName = fileName
)

<span class="hljs-comment">// âœ… æ­£ç¡®</span>
<span class="hljs-keyword">val</span> file = codeGenerator.createNewFile(
    dependencies = Dependencies(
        aggregating = <span class="hljs-literal">false</span>,
        sources = arrayOf(classDeclaration.containingFile!!)
    ),
    packageName = packageName,
    fileName = fileName
)
</code></pre>
<h3 data-id="heading-45">3. ç”Ÿæˆçš„ä»£ç ä¸åŸä»£ç å†²çª</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ å¯èƒ½å†²çªï¼šç”Ÿæˆçš„ç±»ä¸ç°æœ‰ç±»åŒå</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBuilder</span> { ... }

<span class="hljs-comment">// âœ… ä½¿ç”¨å‘½åçº¦å®šé¿å…å†²çª</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserAutoGenBuilder</span> { ... }
</code></pre>
<hr/>
<h2 data-id="heading-46">å®æˆ˜é¡¹ç›®ï¼šå®Œæ•´çš„Room-like ORM</h2>
<p>è®©æˆ‘ä»¬æ•´åˆæ‰€æœ‰çŸ¥è¯†ï¼Œæ„å»ºä¸€ä¸ªç®€åŒ–ç‰ˆçš„Room ORMï¼š</p>
<h3 data-id="heading-47">åŠŸèƒ½</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. å®šä¹‰å®ä½“</span>
<span class="hljs-meta">@Entity(tableName = <span class="hljs-string">"users"</span>)</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-meta">@PrimaryKey</span> <span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Long</span>,
    <span class="hljs-meta">@ColumnInfo(name = <span class="hljs-string">"user_name"</span>)</span> <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>
)

<span class="hljs-comment">// 2. å®šä¹‰DAO</span>
<span class="hljs-meta">@Dao</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> {
    <span class="hljs-meta">@Query(<span class="hljs-string">"SELECT * FROM users WHERE age &gt; :minAge"</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsersOlderThan</span><span class="hljs-params">(minAge: <span class="hljs-type">Int</span>)</span></span>: List&lt;User&gt;

    <span class="hljs-meta">@Insert</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insert</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>

    <span class="hljs-meta">@Delete</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">delete</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>
}

<span class="hljs-comment">// 3. å®šä¹‰Database</span>
<span class="hljs-meta">@Database(entities = [User::class], version = 1)</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppDatabase</span> {
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">userDao</span><span class="hljs-params">()</span></span>: UserDao
}

<span class="hljs-comment">// 4. è‡ªåŠ¨ç”Ÿæˆå®ç°</span>
<span class="hljs-keyword">val</span> db = RoomDatabase.build&lt;AppDatabase&gt;(context, <span class="hljs-string">"app.db"</span>)
<span class="hljs-keyword">val</span> users = db.userDao().getUsersOlderThan(<span class="hljs-number">18</span>)
</code></pre>
<h3 data-id="heading-48">å®ç°æ€è·¯</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. è§£æ@Entityæ³¨è§£ï¼Œç”Ÿæˆè¡¨ç»“æ„SQL</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateTableCreationSQL</span><span class="hljs-params">(entity: <span class="hljs-type">KSClassDeclaration</span>)</span></span>: String {
    <span class="hljs-keyword">val</span> tableName = entity.getAnnotation&lt;Entity&gt;()?.tableName ?: entity.simpleName.asString()
    <span class="hljs-keyword">val</span> columns = entity.primaryConstructor!!.parameters.map { param -&gt;
        <span class="hljs-keyword">val</span> columnName = param.getAnnotation&lt;ColumnInfo&gt;()?.name ?: param.name!!.asString()
        <span class="hljs-keyword">val</span> columnType = mapKotlinTypeToSQLType(param.type.resolve())
        <span class="hljs-keyword">val</span> isPrimaryKey = param.hasAnnotation&lt;PrimaryKey&gt;()
        <span class="hljs-string">"<span class="hljs-variable">$columnName</span> <span class="hljs-variable">$columnType</span>"</span> + (<span class="hljs-keyword">if</span> (isPrimaryKey) <span class="hljs-string">" PRIMARY KEY"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"CREATE TABLE <span class="hljs-variable">$tableName</span> (<span class="hljs-subst">${columns.joinToString(<span class="hljs-string">", "</span>)}</span>)"</span>
}

<span class="hljs-comment">// 2. è§£æ@Queryæ³¨è§£ï¼Œç”ŸæˆæŸ¥è¯¢å®ç°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateQueryImplementation</span><span class="hljs-params">(method: <span class="hljs-type">KSFunctionDeclaration</span>)</span></span>: String {
    <span class="hljs-keyword">val</span> query = method.getAnnotation&lt;Query&gt;()!!.value
    <span class="hljs-keyword">val</span> returnType = method.returnType!!.resolve()

    <span class="hljs-keyword">return</span> <span class="hljs-string">"""
        override fun <span class="hljs-subst">${method.simpleName.asString()}</span>(...): <span class="hljs-subst">${returnType.toString()}</span> {
            val cursor = db.rawQuery("<span class="hljs-variable">$query</span>", arrayOf(...))
            return cursor.use {
                // è§£æCursorï¼Œæ„é€ è¿”å›å¯¹è±¡
            }
        }
    """</span>.trimIndent()
}

<span class="hljs-comment">// 3. ç”ŸæˆDAOå®ç°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateDaoImplementation</span><span class="hljs-params">(dao: <span class="hljs-type">KSClassDeclaration</span>)</span></span>: String {
    <span class="hljs-keyword">val</span> methods = dao.getAllFunctions()
    <span class="hljs-keyword">val</span> implementations = methods.map { method -&gt;
        <span class="hljs-keyword">when</span> {
            method.hasAnnotation&lt;Query&gt;() -&gt; generateQueryImplementation(method)
            method.hasAnnotation&lt;Insert&gt;() -&gt; generateInsertImplementation(method)
            method.hasAnnotation&lt;Delete&gt;() -&gt; generateDeleteImplementation(method)
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"Unknown annotation"</span>)
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-string">"""
        class <span class="hljs-subst">${dao.simpleName.asString()}</span>Impl(private val db: SQLiteDatabase) : <span class="hljs-subst">${dao.qualifiedName!!.asString()}</span> {
            <span class="hljs-subst">${implementations.joinToString(<span class="hljs-string">"\n\n"</span>)}</span>
        }
    """</span>.trimIndent()
}
</code></pre>
<blockquote>
<p><strong>ğŸ’¡ å®Œæ•´å®ç°</strong></p>
<p>å®Œæ•´çš„Room ORMå®ç°æ¶‰åŠæ›´å¤šç»†èŠ‚ï¼ˆäº‹åŠ¡ã€ç±»å‹è½¬æ¢å™¨ã€è¿ç§»ç­‰ï¼‰ï¼Œè¿™é‡Œå±•ç¤ºçš„æ˜¯æ ¸å¿ƒæ€è·¯ã€‚çœŸå®é¡¹ç›®ä¸­å»ºè®®ç›´æ¥ä½¿ç”¨å®˜æ–¹Roomåº“ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-49">æ€»ç»“</h2>
<h3 data-id="heading-50">æ ¸å¿ƒè¦ç‚¹</h3>





























<table><thead><tr><th align="left">æŠ€æœ¯</th><th align="left">ä½¿ç”¨åœºæ™¯</th><th align="left">ä¼˜åŠ¿</th><th align="left">åŠ£åŠ¿</th></tr></thead><tbody><tr><td align="left"><strong>KSP</strong></td><td align="left">ä»£ç ç”Ÿæˆ</td><td align="left">å¿«é€Ÿã€ç¨³å®šã€æ˜“ç”¨</td><td align="left">åªèƒ½ç”Ÿæˆæ–°ä»£ç </td></tr><tr><td align="left"><strong>KAPT</strong></td><td align="left">æ—§é¡¹ç›®å…¼å®¹</td><td align="left">å…¼å®¹Java APT</td><td align="left">æ…¢ã€ä¿¡æ¯ä¸¢å¤±</td></tr><tr><td align="left"><strong>ç¼–è¯‘å™¨æ’ä»¶</strong></td><td align="left">ä»£ç ä¿®æ”¹ã€æ£€æŸ¥</td><td align="left">å¼ºå¤§ã€çµæ´»</td><td align="left">å¤æ‚ã€ä¸ç¨³å®š</td></tr></tbody></table>
<h3 data-id="heading-51">æœ€ä½³å®è·µæ€»ç»“</h3>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨KSP</strong>ï¼šå¯¹äºä»£ç ç”Ÿæˆéœ€æ±‚ï¼ŒKSPæ˜¯é¦–é€‰</li>
<li><strong>å¢é‡ç¼–è¯‘å‹å¥½</strong>ï¼šæ­£ç¡®ä½¿ç”¨<code>Dependencies</code>è·Ÿè¸ªä¾èµ–</li>
<li><strong>é”™è¯¯å¤„ç†</strong>ï¼šä½¿ç”¨<code>logger</code>è€Œéå¼‚å¸¸ï¼Œæä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯</li>
<li><strong>ç”Ÿæˆå¯è¯»ä»£ç </strong>ï¼šæ ¼å¼åŒ–è¾“å‡ºï¼Œæ·»åŠ æ³¨é‡Š</li>
<li><strong>å……åˆ†æµ‹è¯•</strong>ï¼šä½¿ç”¨<code>kotlin-compile-testing</code>ç¼–å†™æµ‹è¯•</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç¼“å­˜æŸ¥è¯¢ã€é¿å…è¿‡åº¦éå†ã€å¹¶è¡Œå¤„ç†</li>
</ol>
<h3 data-id="heading-52">å­¦ä¹ èµ„æº</h3>
<ol>
<li><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fdocs%2Fksp-overview.html" target="_blank" title="https://kotlinlang.org/docs/ksp-overview.html" ref="nofollow noopener noreferrer">KSP Documentation</a></li>
<li><strong>å¼€æºé¡¹ç›®</strong>ï¼šRoomã€Daggerã€Moshiçš„KSPå®ç°</li>
<li><strong>ç¼–è¯‘å™¨æºç </strong>ï¼š<code>kotlin-compiler</code>æ¨¡å—</li>
<li><strong>ç¤¾åŒº</strong>ï¼šKotlin Slack #kspé¢‘é“</li>
</ol>
<hr/>
<p><strong>ç³»åˆ—æ–‡ç« å¯¼èˆª:</strong></p>
<ul>
<li>ğŸ‘‰ ä¸Šä¸€ç¯‡: <a href="https://juejin.cn/post/7598374376094302235" target="_blank" title="https://juejin.cn/post/7598374376094302235">DSLè®¾è®¡ï¼šæ„å»ºç±»å‹å®‰å…¨çš„é¢†åŸŸè¯­è¨€</a></li>
</ul>
<hr/>
<p><em>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©,æ¬¢è¿ç‚¹èµã€æ”¶è—ã€åˆ†äº«!æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®,æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€è®¨è®ºã€‚è®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ,ä¸€èµ·æˆé•¿!</em></p>
<p><em>ä¹Ÿæ¬¢è¿è®¿é—®æˆ‘çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a>å‘ç°æ›´å¤šå®è—èµ„æº</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIä¸“æ  | Prompt Engineering [é™„ç¯‡: å¤§æ¨¡å‹è§†è§’ä¸‹çš„å•ä¸€ä»»åŠ¡æ˜¯ä»€ä¹ˆ?]]]></title>    <link>https://juejin.cn/post/7598699872540901395</link>    <guid>https://juejin.cn/post/7598699872540901395</guid>    <pubDate>2026-01-24T12:06:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872540901395" data-draft-id="7598472744481194003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIä¸“æ  | Prompt Engineering [é™„ç¯‡: å¤§æ¨¡å‹è§†è§’ä¸‹çš„å•ä¸€ä»»åŠ¡æ˜¯ä»€ä¹ˆ?]"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-24T12:06:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŒ¿çŒ¿é•¿æˆè®°"/> <meta itemprop="url" content="https://juejin.cn/user/4232463136874240"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIä¸“æ  | Prompt Engineering [é™„ç¯‡: å¤§æ¨¡å‹è§†è§’ä¸‹çš„å•ä¸€ä»»åŠ¡æ˜¯ä»€ä¹ˆ?]
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4232463136874240/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŒ¿çŒ¿é•¿æˆè®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T12:06:37.000Z" title="Sat Jan 24 2026 12:06:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AIä¸“æ  | Prompt Engineering [é™„ç¯‡: å¤§æ¨¡å‹è§†è§’ä¸‹çš„å•ä¸€ä»»åŠ¡æ˜¯ä»€ä¹ˆ?]</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee4e93cb2c1946a29ffa42a43c8caee8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54y_54y_6ZW_5oiQ6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769861197&amp;x-signature=PVK9s61E2udOMsH5BvTvWenNoGo%3D" alt="2-1 é™„ç¯‡ ä»€ä¹ˆæ˜¯LLMçš„å•ä¸€ä»»åŠ¡-é»‘æ¿æŠ¥.png" loading="lazy"/></p>
<blockquote>
<p>éš¾åº¦ç³»æ•°ï¼šâ˜…â˜…â˜†â˜†â˜†</p>
</blockquote>
<blockquote>
<p>æœ¬ç« çŸ¥è¯†ï¼š</p>
<ul>
<li>ä» LLM è§†è§’åˆ¤æ–­ã€Œå•ä¸€ä»»åŠ¡ã€çš„å››ä¸ªç»´åº¦</li>
<li>å›åˆ°åŸä¾‹ï¼šâ€œæ–°é—»æŸ¥è¯¢ + ä¿¡æ¯æ ¼å¼åŒ–â€ä¸ºä½•é€šå¸¸æ˜¯å•ä¸€ä»»åŠ¡ï¼Ÿ</li>
<li>ä½•æ—¶ä¼šâ€œé€€åŒ–â€ä¸ºå¤šä»»åŠ¡ï¼Ÿ</li>
<li>ä¸€ä¸ªå®ç”¨çš„å¿«é€Ÿåˆ¤æ–­æ³•åˆ™</li>
<li>å·¥ç¨‹å®è·µä¸­çš„å…³é”®è®¤çŸ¥</li>
</ul>
</blockquote>
<p>ä¸Šä¸€ç« èŠ‚æˆ‘ä»¬ä»‹ç»äº†Prompt Engineeringçš„é«˜èƒ½å»ºè®®ï¼Œå…¶ä¸­æœ‰ä¸€æ¡å€¼å¾—å±•å¼€è¯´è¯´ã€‚</p>
<p>åœ¨ Prompt Engineering ä¸­ï¼Œâ€œå•ä¸€ä»»åŠ¡â€å¸¸è¢«è¯¯è§£ä¸ºâ€œåªåšä¸€ä»¶äº‹â€ã€‚ä½†å¯¹å¤§æ¨¡å‹è€Œè¨€ï¼Œ<strong>å…³é”®ä¸åœ¨äºåŠ¨ä½œæ•°é‡ï¼Œè€Œåœ¨äºç›®æ ‡æ˜¯å¦ç»Ÿä¸€</strong>ã€‚</p>
<p><strong>ä¸‹é¢ä»¥"æ–°é—»æŸ¥è¯¢å¹¶æ ¼å¼åŒ–è¾“å‡º"ä¸ºä¾‹</strong></p>
<blockquote>
<p><strong>ç»“è®ºå…ˆè¡Œï¼š</strong><br/>
<strong>å•ä¸€ä»»åŠ¡ â‰  åªæ‰§è¡Œä¸€ä¸ªæ“ä½œï¼Œè€Œæ˜¯æŒ‡æ¨¡å‹åœ¨ä¸€æ¬¡æ¨ç†ä¸­ï¼Œåªå›´ç»•ä¸€ä¸ªæ¸…æ™°ã€ç¨³å®šçš„ç›®æ ‡è¿›è¡Œä¼˜åŒ–ã€‚</strong></p>
</blockquote>
<p>å› æ­¤ï¼š</p>
<ul>
<li>âœ… â€œæ–°é—»æŸ¥è¯¢ + ä¿¡æ¯æ ¼å¼åŒ–â€åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ <strong>å±äºå•ä¸€ä»»åŠ¡</strong></li>
<li>å‰ææ˜¯ï¼š<strong>æ ¼å¼åŒ–ä»…ä½œä¸ºç»“æœçš„äº¤ä»˜å½¢å¼ï¼Œè€Œéç‹¬ç«‹çš„åˆ¤æ–­æˆ–å†³ç­–ç›®æ ‡</strong></li>
</ul>
<h3 data-id="heading-1">ä¸€ã€ä» LLM è§†è§’åˆ¤æ–­ã€Œå•ä¸€ä»»åŠ¡ã€çš„å››ä¸ªç»´åº¦</h3>
<h4 data-id="heading-2">1ï¸âƒ£ æ˜¯å¦åªæœ‰ä¸€ä¸ªâ€œä¸»è¦ç›®æ ‡â€ï¼Ÿ</h4>
<ul>
<li><strong>å•ä¸€ä»»åŠ¡ç‰¹å¾</strong>ï¼š
<ul>
<li>ä»…æœ‰ä¸€ä¸ªæˆåŠŸæ ‡å‡†</li>
<li>å…¶ä»–æ­¥éª¤ä»…ä¸ºè¾¾æˆè¯¥ç›®æ ‡çš„å¿…è¦æ‰‹æ®µ</li>
</ul>
</li>
<li><strong>å¤šä»»åŠ¡ç‰¹å¾</strong>ï¼š
<ul>
<li>æ¯ä¸ªå­ä»»åŠ¡æœ‰ç‹¬ç«‹è¯„ä»·ç»´åº¦</li>
<li>æ¨¡å‹éœ€åŒæ—¶å¤„ç†ä¸åŒç±»å‹çš„é—®é¢˜ï¼ˆå¦‚æ£€ç´¢ + åˆ†æ + å†³ç­–ï¼‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ“Œ åˆ¤æ–­å…³é”®ï¼šæ¨¡å‹æ˜¯å¦éœ€è¦åœ¨å¤šä¸ª<strong>ç‹¬ç«‹ç›®æ ‡</strong>ä¹‹é—´åˆ‡æ¢æˆ–æƒè¡¡ï¼Ÿ</p>
</blockquote>
<h4 data-id="heading-3">2ï¸âƒ£ å­æ­¥éª¤æ˜¯â€œæ‰‹æ®µâ€ï¼Œè¿˜æ˜¯â€œç›®çš„â€ï¼Ÿ</h4>
<p>è¿™æ˜¯ä¸€ä¸ªå®ç”¨çš„å·¥ç¨‹åˆ¤æ–­æ³•ã€‚</p>
<h5 data-id="heading-4">âœ… å…¸å‹å•ä¸€ä»»åŠ¡ç¤ºä¾‹ï¼š</h5>
<blockquote>
<p>â€œæŸ¥è¯¢æŸå…¬å¸è¿‘æœŸæ–°é—»ï¼Œå¹¶ä»¥ JSON æ ¼å¼è¾“å‡ºâ€</p>
</blockquote>
<ul>
<li>æŸ¥è¯¢æ–°é—» â†’ è·å–å†…å®¹ï¼ˆæ ¸å¿ƒç›®æ ‡ï¼‰</li>
<li>JSON æ ¼å¼ â†’ è¾“å‡ºåè®®ï¼ˆäº¤ä»˜å½¢å¼ï¼‰</li>
</ul>
<blockquote>
<p>æ¨¡å‹çœŸæ­£è¦è§£å†³çš„é—®é¢˜åªæœ‰ä¸€ä¸ªï¼š<strong>å¦‚ä½•æŠŠæŸ¥è¯¢ç»“æœæŒ‰æŒ‡å®šç»“æ„äº¤ä»˜</strong>ã€‚<br/>
æ ¼å¼åŒ–æœ¬èº«æ— ä¸šåŠ¡æ„ä¹‰ï¼Œä»…æ˜¯è½½ä½“ã€‚</p>
</blockquote>
<h5 data-id="heading-5">âŒ å…¸å‹å¤šä»»åŠ¡ç¤ºä¾‹ï¼š</h5>
<blockquote>
<p>â€œæŸ¥è¯¢æ–°é—»ï¼Œåˆ†æå…¶æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºæŠ•èµ„å»ºè®®â€</p>
</blockquote>
<p>åŒ…å«ä¸‰ä¸ªç‹¬ç«‹è®¤çŸ¥ä»»åŠ¡ï¼š</p>
<ol>
<li>ä¿¡æ¯æ£€ç´¢ï¼ˆæ­£ç¡®æ€§ï¼‰</li>
<li>æƒ…æ„Ÿåˆ¤æ–­ï¼ˆåˆ†æèƒ½åŠ›ï¼‰</li>
<li>æŠ•èµ„å»ºè®®ï¼ˆå†³ç­–èƒ½åŠ›ï¼‰</li>
</ol>
<h4 data-id="heading-6">3ï¸âƒ£ æ˜¯å¦è¦æ±‚æ¨¡å‹åˆ‡æ¢â€œè®¤çŸ¥æ¨¡å¼â€ï¼Ÿ</h4>
<p>ä¸åŒä»»åŠ¡è°ƒç”¨ä¸åŒçš„æ¨¡å‹èƒ½åŠ›ï¼š</p>





















<table><thead><tr><th>ä»»åŠ¡ç±»å‹</th><th>å¯¹åº”çš„è®¤çŸ¥æ¨¡å¼</th></tr></thead><tbody><tr><td>æŸ¥è¯¢ / å›å¿† / RAG</td><td>ä¸Šä¸‹æ–‡æå–ä¸æ•´åˆ</td></tr><tr><td>æ ¼å¼åŒ–è¾“å‡º</td><td>ç»“æ„åŒ–ç”Ÿæˆ</td></tr><tr><td>åˆ†æ / åˆ¤æ–­ / å»ºè®®</td><td>æ¨ç†ä¸å†³ç­–</td></tr></tbody></table>
<blockquote>
<p>è‹¥æ•´ä¸ª Prompt åªæ¿€æ´»ä¸€ç§ä¸»å¯¼è®¤çŸ¥æ¨¡å¼ï¼ˆå¦‚â€œæå–+ç»“æ„åŒ–â€ï¼‰ï¼Œå…¶ä½™ä¸ºçº¦æŸæ¡ä»¶ï¼Œåˆ™ä»å±å•ä¸€ä»»åŠ¡ã€‚</p>
</blockquote>
<h4 data-id="heading-7">4ï¸âƒ£ èšåˆç›®æ ‡æ˜¯å¦å…·æœ‰æ”¶æ•›æ€§ï¼Ÿ</h4>
<ul>
<li>âœ… <strong>æ”¶æ•›äºåŒä¸€é€»è¾‘å®ä½“</strong> â†’ å•ä¸€ä»»åŠ¡
<blockquote>
<p>ä¾‹ï¼šä»å¤šä¸ªç½‘é¡µèšåˆâ€œå¼ ä¸‰çš„ä¸ªäººå±¥å†â€</p>
</blockquote>
</li>
<li>âŒ <strong>å‘æ•£è‡³å¤šä¸ªæ— å…³å®ä½“</strong> â†’ å¤šä»»åŠ¡
<blockquote>
<p>ä¾‹ï¼šåŒæ—¶èšåˆâ€œå¼ ä¸‰çš„ç®€å†â€å’Œâ€œYYYå…¬å¸çš„è´¢æŠ¥â€</p>
</blockquote>
</li>
</ul>
<h3 data-id="heading-8">äºŒã€å›åˆ°åŸä¾‹ï¼šâ€œæ–°é—»æŸ¥è¯¢ + ä¿¡æ¯æ ¼å¼åŒ–â€ä¸ºä½•é€šå¸¸æ˜¯å•ä¸€ä»»åŠ¡ï¼Ÿ</h3>
<p>å› ä¸ºåœ¨æ¨¡å‹è§†è§’ä¸­ï¼š</p>
<ul>
<li><strong>ä¸»ç›®æ ‡</strong>ï¼šæä¾›å‡†ç¡®ã€å¯ç”¨çš„æ–°é—»å†…å®¹</li>
<li><strong>JSON æ ¼å¼</strong>ï¼šä»…æ˜¯ç»“æœçš„ç»“æ„åŒ–è¡¨è¾¾æ–¹å¼</li>
</ul>
<p>è¿™æœ¬è´¨ä¸Šç­‰åŒäºï¼š</p>
<blockquote>
<p>â€œè¯·ç”¨æŒ‡å®šçš„æ•°æ®ç»“æ„è¿”å›ç»“æœâ€</p>
</blockquote>
<p>è€Œéï¼š</p>
<blockquote>
<p>â€œè¯·å®Œæˆä¸¤ä»¶å½¼æ­¤ç‹¬ç«‹çš„äº‹â€</p>
</blockquote>
<h3 data-id="heading-9">ä¸‰ã€ä½•æ—¶ä¼šâ€œé€€åŒ–â€ä¸ºå¤šä»»åŠ¡ï¼Ÿ</h3>
<p>ä»¥ä¸‹æƒ…å†µä¼šä½¿çœ‹ä¼¼ç®€å•çš„ Prompt å˜å¾—ä¸ç¨³å®šï¼š</p>
<h4 data-id="heading-10">âŒ æƒ…å†µä¸€ï¼šæ ¼å¼åŒ–éšå«åˆ¤æ–­é€»è¾‘</h4>
<blockquote>
<p>â€œæŸ¥è¯¢æ–°é—»ï¼Œå¹¶æŒ‰é‡è¦æ€§ç­›é€‰åï¼Œä»¥ JSON è¾“å‡ºâ€<br/>
â†’ â€œé‡è¦æ€§ç­›é€‰â€æ˜¯ç‹¬ç«‹å†³ç­–ä»»åŠ¡ã€‚</p>
</blockquote>
<h4 data-id="heading-11">âŒ æƒ…å†µäºŒï¼šè¾“å‡ºç»“æ„è¿‡äºå¤æ‚</h4>
<ul>
<li>è¿‡æ·±åµŒå¥—</li>
<li>åŠ¨æ€å­—æ®µã€æ¡ä»¶è§„åˆ™</li>
<li>å¼º Schema çº¦æŸ + ä¸šåŠ¡è¯­ä¹‰<br/>
â†’ æ¨¡å‹éœ€åŒæ—¶å…¼é¡¾å†…å®¹ç”Ÿæˆä¸åè®®å¯¹é½ï¼Œæ³¨æ„åŠ›åˆ†æ•£ã€‚</li>
</ul>
<h4 data-id="heading-12">âŒ æƒ…å†µä¸‰ï¼šæ˜ç¡®å£°æ˜å¤šä¸ªä»»åŠ¡</h4>
<blockquote>
<p>â€œè¯·å®Œæˆä»¥ä¸‹ä¸¤ä¸ªä»»åŠ¡ï¼š1. æŸ¥è¯¢æ–°é—»ï¼›2. è®¾è®¡ JSON ç»“æ„â€<br/>
â†’ å·²æ˜¯æ˜¾å¼å¤šä»»åŠ¡æŒ‡ä»¤ã€‚</p>
</blockquote>
<h3 data-id="heading-13">å››ã€ä¸€ä¸ªå®ç”¨çš„å¿«é€Ÿåˆ¤æ–­æ³•åˆ™</h3>
<blockquote>
<p><strong>é—®è‡ªå·±ï¼šå¦‚æœåˆ é™¤å…¶ä¸­ä¸€ä¸ªæ­¥éª¤ï¼Œå¦ä¸€ä¸ªæ˜¯å¦ä»æœ‰ä¸šåŠ¡ä»·å€¼ï¼Ÿ</strong></p>
</blockquote>
<ul>
<li>åˆ é™¤â€œæ ¼å¼åŒ–â€ â†’ æ–°é—»æŸ¥è¯¢ä»æœ‰ä»·å€¼ âœ…</li>
<li>åˆ é™¤â€œæ–°é—»æŸ¥è¯¢â€ â†’ JSON ç»“æ„æ¯«æ— æ„ä¹‰ âŒ</li>
</ul>
<p>â†’ è¯´æ˜æ ¼å¼åŒ–ä¾é™„äºä¸»ç›®æ ‡ï¼Œå±äº<strong>å•ä¸€ä»»åŠ¡</strong>ã€‚</p>
<h3 data-id="heading-14">äº”ã€å·¥ç¨‹å®è·µä¸­çš„å…³é”®è®¤çŸ¥</h3>
<p>åœ¨ RAG æˆ– Agent ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œåº”ç‰¢è®°ï¼š</p>
<blockquote>
<p><strong>å•ä¸€ä»»åŠ¡ â‰  å•ä¸€ Prompt</strong><br/>
è€Œæ˜¯ï¼š<strong>ä¸€æ¬¡æ¨ç†åªè§£å†³ä¸€ä¸ªä¸å¯å†æ‹†çš„ä¸šåŠ¡å†³ç­–ç‚¹</strong></p>
</blockquote>
<p>æ›´ç¨³å¥çš„ç³»ç»Ÿæ¶æ„é€šå¸¸æ˜¯ï¼š</p>
<ul>
<li><strong>æ¯ä¸ª Prompt èšç„¦å•ä¸€ç›®æ ‡</strong></li>
<li><strong>é€šè¿‡å¤šä¸ªèŠ‚ç‚¹ä¸²è”å¤šä¸ªå•ä¸€ä»»åŠ¡</strong></li>
</ul>
<p>è¿™æ ·æ—¢èƒ½ä¿è¯æ¨¡å‹ä¸“æ³¨åº¦ï¼Œåˆä¾¿äºè°ƒè¯•ã€è¯„ä¼°ä¸è¿­ä»£ã€‚</p>
<hr/>
<p align="center">å…³æ³¨æœ¬ä¸“æ ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æŒæ¡æ–¹æ³•ã€å®è·µè½åœ°ã€å…±åŒå‘å±•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skillsï¼šè®© AI Agent è½»é‡æ‰©å±•çš„â€œå¸¦ç›®å½•è¯´æ˜ä¹¦â€]]></title>    <link>https://juejin.cn/post/7598827845965365274</link>    <guid>https://juejin.cn/post/7598827845965365274</guid>    <pubDate>2026-01-24T12:51:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598827845965365274" data-draft-id="7598532592456204315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skillsï¼šè®© AI Agent è½»é‡æ‰©å±•çš„â€œå¸¦ç›®å½•è¯´æ˜ä¹¦â€"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2026-01-24T12:51:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½å¼€æ°´518"/> <meta itemprop="url" content="https://juejin.cn/user/2436173495800087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skillsï¼šè®© AI Agent è½»é‡æ‰©å±•çš„â€œå¸¦ç›®å½•è¯´æ˜ä¹¦â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173495800087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½å¼€æ°´518
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T12:51:24.000Z" title="Sat Jan 24 2026 12:51:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“ä¸‹ AI åœˆæœ€çƒ­çš„è¯é¢˜ä¹‹ä¸€ï¼Œè«è¿‡äº Agent Skillã€‚
æœ€æ—©çš„å®è·µæ¥è‡ª Claude ä¸­çš„ä¸€ç±»â€œæ¨¡å—åŒ–èƒ½åŠ›â€ï¼Œéšå Codexã€Cursorã€OpenCode ç­‰ç¼–ç¨‹å·¥å…·ä¹Ÿå¼€å§‹è·Ÿè¿›å¹¶æ”¯æŒã€‚
è¶Šæ¥è¶Šå¤šå›¢é˜Ÿå°è¯•æŠŠ Skills å½“ä½œä¸€ç§ <strong>è·¨å¹³å°ã€é€šç”¨ã€å¯å¤ç”¨</strong> çš„èƒ½åŠ›æ‰©å±•æ–¹å¼ã€‚</p>
<p>æœ¬æ–‡ç»“åˆè¿‘æœŸå®è·µä¸ç¤¾åŒºç»éªŒï¼Œç³»ç»Ÿæ¢³ç† Agent Skills çš„å®šä¹‰ã€æœºåˆ¶ä¸è½åœ°æ–¹å¼ï¼Œå¹¶ç»™å‡ºå¯æ‰§è¡Œçš„å…¥é—¨è·¯å¾„ã€‚
ä¹Ÿæ˜¯éƒ¨é—¨å†…AIåˆ†äº«çš„ä¸€æ¬¡æŠ€æœ¯è®²ä¹‰ï¼ŒåŒæ—¶åœ¨åšæ–‡ä¸­ä½œä¸ºè®°å½•ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. Agent Skills æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>Agent Skills</strong> æ˜¯ä¸€ç§ lightweightã€å¼€æ”¾çš„èƒ½åŠ›æ‰©å±•æ ¼å¼ï¼Œç”¨â€œä¸“é—¨çš„çŸ¥è¯†ä¸å·¥ä½œæµâ€æ¥å¢å¼º AI Agentã€‚</p>
<p>å®ƒçš„æœ¬è´¨å¾ˆç®€å•ï¼š
<strong>ä¸€ä¸ªåŒ…å« <code>SKILL.md</code> çš„æ–‡ä»¶å¤¹</strong>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">my-skill/
â”œâ”€â”€ SKILL.md          <span class="hljs-comment"># å¿…é¡»: è¯´æ˜ + å…ƒæ•°æ®</span>
â”œâ”€â”€ scripts/          <span class="hljs-comment"># å¯é€‰: å¯æ‰§è¡Œè„šæœ¬</span>
â”œâ”€â”€ references/       <span class="hljs-comment"># å¯é€‰: å‚è€ƒæ–‡æ¡£</span>
â””â”€â”€ assets/           <span class="hljs-comment"># å¯é€‰: æ¨¡æ¿ä¸èµ„æº</span>
</code></pre>
<p>å¯ä»¥æŠŠ Skill ç†è§£ä¸ºï¼š
<strong>â€œå¸¦ç›®å½•çš„è¯´æ˜ä¹¦â€ = å…ƒæ•°æ® + æŒ‡ä»¤ + èµ„æº</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">2. å®ƒæ€ä¹ˆå·¥ä½œï¼Ÿå…³é”®æœºåˆ¶ï¼šæ¸è¿›å¼ä¸Šä¸‹æ–‡åŠ è½½</h2>
<p>Agent Skills çš„å…³é”®æœºåˆ¶æ˜¯ <strong>Progressive Disclosureï¼ˆæ¸è¿›å¼ä¸Šä¸‹æ–‡åŠ è½½ï¼‰</strong>ï¼š</p>
<ol>
<li><strong>å‘ç°</strong>ï¼šå¯åŠ¨æ—¶ä»…åŠ è½½ <code>name + description</code>ï¼Œå‘Šè¯‰ Agent â€œæœ‰å“ªäº›æŠ€èƒ½â€ã€‚</li>
<li><strong>æ¿€æ´»</strong>ï¼šä»»åŠ¡åŒ¹é…åˆ°æŸä¸ª skillï¼Œæ‰åŠ è½½å®Œæ•´ <code>SKILL.md</code>ã€‚</li>
<li><strong>æ‰§è¡Œ</strong>ï¼šæŒ‰æŠ€èƒ½æ­¥éª¤æ‰§è¡Œï¼Œå¿…è¦æ—¶å†åŠ è½½å¼•ç”¨æˆ–è¿è¡Œè„šæœ¬ã€‚</li>
</ol>
<p>è¿™ä¸€æœºåˆ¶çš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼š</p>
<ul>
<li><strong>é™ä½ token æ¶ˆè€—</strong></li>
<li><strong>å‡å°‘ prompt å¤æ‚åº¦</strong></li>
<li><strong>ä¿æŒ agent è½»é‡ï¼Œä½†ä»å¯æ·±åº¦æ‰©å±•</strong></li>
</ul>
<hr/>
<h2 data-id="heading-2">3. <code>SKILL.md</code> é•¿ä»€ä¹ˆæ ·ï¼Ÿ</h2>
<p>Skill çš„æ ¸å¿ƒæ˜¯ <code>SKILL.md</code>ï¼Œç»“æ„ä¸º <strong>YAML frontmatter + Markdown instructions</strong>ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">pdf-processing</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">Extract</span> <span class="hljs-string">text</span> <span class="hljs-string">and</span> <span class="hljs-string">tables</span> <span class="hljs-string">from</span> <span class="hljs-string">PDF</span> <span class="hljs-string">files,</span> <span class="hljs-string">fill</span> <span class="hljs-string">forms,</span> <span class="hljs-string">merge</span> <span class="hljs-string">documents.</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># PDF Processing</span>

<span class="hljs-comment">## When to use this skill</span>
<span class="hljs-string">Use</span> <span class="hljs-string">this</span> <span class="hljs-string">skill</span> <span class="hljs-string">when</span> <span class="hljs-string">the</span> <span class="hljs-string">user</span> <span class="hljs-string">needs</span> <span class="hljs-string">to</span> <span class="hljs-string">work</span> <span class="hljs-string">with</span> <span class="hljs-string">PDF</span> <span class="hljs-string">files...</span>

<span class="hljs-comment">## How to extract text</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">Use</span> <span class="hljs-string">pdfplumber</span> <span class="hljs-string">for</span> <span class="hljs-string">text</span> <span class="hljs-string">extraction...</span>
</code></pre>
<p>è¦ç‚¹ï¼š</p>
<ul>
<li><strong>frontmatter æ˜¯å¿…é¡»çš„</strong>ï¼šç”¨äºæŠ€èƒ½å‘ç°ä¸åŒ¹é…</li>
<li><strong>æ­£æ–‡æ˜¯æ‰§è¡Œè¯´æ˜</strong>ï¼šå¦‚ä½•åšã€åšä»€ä¹ˆã€æ³¨æ„äº‹é¡¹</li>
</ul>
<hr/>
<h2 data-id="heading-3">4. å®æ“ï¼šå…ˆåœ¨ Claude Code éªŒè¯</h2>
<p>å¦‚æœè¦å¿«é€Ÿä½“éªŒ Skillï¼Œå»ºè®®å…ˆç”¨ Claude Code åšéªŒè¯ã€‚</p>
<h3 data-id="heading-4">4.1 ä½¿ç”¨å›½å†…å‚å•† GLM ä½œä¸º Claude Code çš„åç«¯</h3>
<p>å¯å‚è€ƒæ™ºè°±å®˜æ–¹æ–‡æ¡£ï¼š
<code>https://docs.bigmodel.cn/cn/guide/develop/claude#claude-code</code></p>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1ï¼‰åœ¨ <code>~/.claude/</code> ä¸‹æ·»åŠ  <code>settings.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ANTHROPIC_AUTH_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your own token"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ANTHROPIC_BASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://open.bigmodel.cn/api/anthropic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"API_TIMEOUT_MS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3000000"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>2ï¼‰è·³è¿‡ç™»å½•ï¼šä¿®æ”¹ <code>~/.claude.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hasCompletedOnboarding"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">5. å®‰è£… Skillsï¼šä¸‰ç§è·¯å¾„</h2>
<p>ç»“åˆä¸Šé¢çš„æ¦‚å¿µï¼Œç›®å½•ç»“æ„å¦‚ä¸‹:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e0993fe99f749a2bb1bcd6d90aec5f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95byA5rC0NTE4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769863884&amp;x-signature=eiLzrXl76kxxewd%2Fnuj41M9Dz20%3D" alt="skill_struct.png" loading="lazy"/></p>
<h3 data-id="heading-6">5.1 ä½¿ç”¨ç°æˆçš„</h3>
<p>ä»¥ UI UX Pro ä¸ºä¾‹ï¼š
<code>https://ui-ux-pro-max-skill.nextlevelbuilder.io/</code></p>
<p>ä¸€ä¸ªå…¸å‹ä½“éªŒæµç¨‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm create vue@latest
claude
<span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ª vue3 ç©ºé¡¹ç›®ï¼Œå¸®æˆ‘å®ç°ä¸€ä¸ªç®€å•çš„ dashboard çš„é¡µé¢ï¼ŒåŒ…å«å¦‚ä¸‹å†…å®¹</span>
<span class="hljs-comment"># 1. é¡¶éƒ¨ titleï¼Œå·¦ä¾§ç³»ç»Ÿåï¼Œå³ä¾§ç”¨æˆ·ç™»å½•ä¿¡æ¯</span>
<span class="hljs-comment"># 2. å·¦ä¾§èœå•åŠŸèƒ½åˆ—è¡¨</span>
<span class="hljs-comment"># 3. ä¸­é—´å›¾æ ‡ä¿¡æ¯å±•ç¤ºæ¨¡å— + åˆ—è¡¨å±•ç¤º</span>
npm run dev
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70042025dd6d40aaa76425364b95478d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95byA5rC0NTE4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769863884&amp;x-signature=duWhZWYjfeJJlRSceq8KbAUImW0%3D" alt="demo.png" loading="lazy"/></p>
<p>å†ä½¿ç”¨ UI/UX skill è¿›è¡Œç¾åŒ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g uipro-cli
uipro init --ai claude
claude
<span class="hljs-comment"># ä½¿ç”¨ ui-ux skill å¸®æˆ‘æŠŠé¡µé¢å˜æˆæœ‰ç§‘æŠ€æ„Ÿçš„ UI</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/074f6004cef24a19a61aa405002b4f99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95byA5rC0NTE4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769863884&amp;x-signature=n03ch9LnCBiWQC2h2KSBwN5ujQA%3D" alt="after.png" loading="lazy"/></p>
<p>æ•ˆæœå› äººè€Œå¼‚ï¼Œä½†æ•´ä½“æµç¨‹å·²ç»éå¸¸æ¸…æ™°ï¼š
<strong>Skill å¯ä»¥æŠŠâ€œå¥½çš„æŒ‡ä»¤æ¨¡æ¿ + è®¾è®¡èµ„æº + è¿‡ç¨‹ç»éªŒâ€æ ‡å‡†åŒ–</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-7">5.2 Skills å¤§åˆé›†</h3>
<p>é›†åˆç«™ç‚¹ï¼š
<code>https://skills.sh/</code></p>
<p>ä»¥ OpenCode ä¸ºä¾‹ï¼š
<code>https://opencode.ai/</code></p>
<p>å®‰è£…ä¸€ä¸ªé›†åˆä¸­çš„ skillï¼Œå¦‚ <code>commit-work</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npx skills add https://github.com/softaworks/agent-toolkit --skill commit-work
</code></pre>
<p>åœ¨ CLI ä¸­ç›´æ¥ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">ä½¿ç”¨ commit skill æ¥å¸®æˆ‘æŠŠæœ¬åœ°å˜æ›´æäº¤
</code></pre>
<hr/>
<h3 data-id="heading-8">5.3 è‡ªå·±åˆ›å»º Skill</h3>
<p>ä¸€ä¸ªè´¦å•åˆ†æçš„ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: è´¦å•åˆ†æ
<span class="hljs-section">description: "è‡ªåŠ¨åŒ–çš„è´¦å•åˆ†æï¼Œå¹¶æ•´ç†æˆæ¶ˆè´¹åˆ—è¡¨ï¼Œç”¨äºæŠ¥é”€æ±‡æ€»"
---</span>

æ ¸å¿ƒåŠŸèƒ½ï¼š
<span class="hljs-bullet">1.</span> è¯»å–æœ¬åœ°å›¾ç‰‡ï¼ˆpng, jpg, pdfï¼‰æ•°æ®
<span class="hljs-bullet">2.</span> OCR æå–å›¾ç‰‡ä¸­çš„æ–‡å­—
<span class="hljs-bullet">3.</span> ä¿¡æ¯æŠ½å–ä¸æ¸…æ´—ï¼Œé‡å¤æ€§æ£€æµ‹
<span class="hljs-bullet">4.</span> å¯¼å‡º CSVï¼Œè¡¨å¤´ä¸ºï¼š| åºå· | å•†æˆ·åç§° | æ¶ˆè´¹æ—¥æœŸ | é‡‘é¢(å…ƒ) | æ”¯ä»˜æ–¹å¼ | å¤‡æ³¨ |

è¾“å…¥å‚æ•°:
<span class="hljs-bullet">-</span> å›¾ç‰‡æ–‡ä»¶è·¯å¾„æˆ–æ–‡ä»¶å¤¹è·¯å¾„

è¾“å‡ºç»“æœ:
<span class="hljs-bullet">-</span> æ ¼å¼åŒ–çš„ CSV æŠ¥é”€å•
</code></pre>
<p>è°ƒç”¨æ–¹å¼ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">@202601/ æ–‡ä»¶å¤¹ä¸­æ˜¯ä¸Šä¸ªæœˆçš„è´¦å•æˆªå›¾ï¼Œå¸®æˆ‘åˆ†ææ±‡æ€»ç”ŸæˆæŠ¥é”€æ±‡æ€»
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f562c525494342a68d743707aa0d907e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95byA5rC0NTE4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769863884&amp;x-signature=hmfrrn5e8EGrkRj2WGLUc3uRO7g%3D" alt="process.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-9">6. MCP ä¸ Skillï¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h2>





























<table><thead><tr><th/><th>ç±»æ¯”</th><th>ä¾§é‡ç‚¹</th><th>ä¸»ä½“</th><th>Token æ¶ˆè€—</th><th>ç¼–å†™éš¾åº¦</th></tr></thead><tbody><tr><td>Skills</td><td>å¸¦ç›®å½•çš„è¯´æ˜ä¹¦</td><td>æç¤ºè¯ä¸æµç¨‹</td><td>Markdown æ–‡ä»¶</td><td>ä½</td><td>ä½</td></tr><tr><td>MCP</td><td>æ ‡å‡†åŒ–çš„å·¥å…·ç®±</td><td>å·¥å…·è°ƒç”¨</td><td>è½¯ä»¶åŒ…</td><td>é«˜</td><td>é«˜</td></tr></tbody></table>
<p>è¡¥å……è¯´æ˜ï¼š</p>
<ul>
<li><strong>Skills æ›´ä¾èµ–æœ¬åœ°ç¯å¢ƒ</strong>ï¼ˆè„šæœ¬å’Œä¾èµ–å¯èƒ½å¤±è´¥ï¼‰</li>
<li><strong>å¤ç”¨æ€§ä½äº MCP</strong>ï¼Œä½†è½»é‡ã€ä¸Šæ‰‹å¿«</li>
<li><strong>ä¸¤è€…ç»„åˆ</strong> å¯ä»¥æå¤§æå‡ Agent çš„å®ç”¨æ€§</li>
</ul>
<hr/>
<h2 data-id="heading-10">7. AI æœªæ¥çš„æ ·å­</h2>
<p>å½“ Skillã€MCPã€Agent æ¡†æ¶å¼€å§‹å½¢æˆå…±è¯†åï¼ŒAI Native çš„å½¢æ€ä¼šè¶Šæ¥è¶Šåƒè¿‡å»äº‘åŸç”Ÿçš„å‘å±•è·¯å¾„ï¼š</p>
<ul>
<li><strong>æ ‡å‡†åŒ– + ç»„åˆå¼èƒ½åŠ›</strong></li>
<li><strong>å·¥å…·é“¾è¢«æ‹†åˆ†å†ç¼–æ’</strong></li>
<li><strong>ç”±â€œæç¤ºè¯å·¥ç¨‹â€èµ°å‘â€œèƒ½åŠ›å·¥ç¨‹â€</strong></li>
</ul>
<p>æœªæ¥çš„å…³é”®ä¸æ˜¯â€œæ¨¡å‹æœ‰å¤šå¼ºâ€ï¼Œè€Œæ˜¯ï¼š
<strong>â€œèƒ½åŠ›å¦‚ä½•è¢«ç»„ç»‡ã€å¤ç”¨ã€è¿ç§»ã€å…±äº«â€</strong>ã€‚</p>
<p>Skill å¾ˆå¯èƒ½æ˜¯è¿™ä¸ªè½¬æŠ˜ç‚¹çš„ç¬¬ä¸€æ­¥ã€‚</p>
<hr/>
<h2 data-id="heading-11">ç»“è¯­</h2>
<p>Agent Skills ä¸åªæ˜¯â€œæç¤ºè¯æ¨¡æ¿çš„è¿›åŒ–ç‰ˆâ€ï¼Œè€Œæ˜¯ <strong>ä¸€ç§è½»é‡ã€ä½æˆæœ¬ã€å¯è¿ç§»çš„ Agent èƒ½åŠ›å°è£…æ–¹å¼</strong>ã€‚</p>
<p>å¦‚æœä½ æ­£åœ¨ï¼š</p>
<ul>
<li>æ­å»ºè‡ªå·±çš„ AI å¼€å‘å·¥ä½œæµ</li>
<li>å¸Œæœ›æŠŠå›¢é˜Ÿç»éªŒæ ‡å‡†åŒ–</li>
<li>æœŸå¾…è·¨å¹³å°å¤ç”¨èƒ½åŠ›</li>
</ul>
<p>é‚£ä¹ˆä»å†™ä¸€ä¸ª <code>SKILL.md</code> å¼€å§‹ï¼Œæ˜¯æœ€ç®€å•ä¸”æœ‰æ•ˆçš„å°è¯•ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fkaidev.me%2Fposts%2Fagentskill%2F" target="_blank" title="https://kaidev.me/posts/agentskill/" ref="nofollow noopener noreferrer">åŸæ–‡åœ°å€</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChainå…¥é—¨-æ ¸å¿ƒæ¨¡å—åˆ†æ]]></title>    <link>https://juejin.cn/post/7598459769239257122</link>    <guid>https://juejin.cn/post/7598459769239257122</guid>    <pubDate>2026-01-24T14:08:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769239257122" data-draft-id="7598465042968805416" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChainå…¥é—¨-æ ¸å¿ƒæ¨¡å—åˆ†æ"/> <meta itemprop="keywords" content="LangChain,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-24T14:08:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·20963873743"/> <meta itemprop="url" content="https://juejin.cn/user/3300076588372683"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChainå…¥é—¨-æ ¸å¿ƒæ¨¡å—åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3300076588372683/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·20963873743
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T14:08:18.000Z" title="Sat Jan 24 2026 14:08:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">LangChain æ ¸å¿ƒæ¨¡å—åˆ†æ</h2>
<p><strong>ä½œè€…</strong>: åŠªåŠ›å­¦ä¹ AIçš„ç¨‹åºçŒ¿
<strong>æ—¥æœŸ</strong>: 2026-01-24</p>
<blockquote>
<p><strong>æ‘˜è¦</strong>: æ·±å…¥åˆ†æ LangChain çš„æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…æ‹¬ Runnable ç³»ç»Ÿã€è¯­è¨€æ¨¡å‹æŠ½è±¡ã€å·¥å…·ç³»ç»Ÿã€æ£€ç´¢ç³»ç»Ÿã€è®°å¿†ç³»ç»Ÿã€ä»£ç†ç³»ç»Ÿå’Œé“¾ç³»ç»Ÿçš„è®¾è®¡åŸç†ä¸å®ç°ç»†èŠ‚</p>
</blockquote>
<h2 data-id="heading-1">LangChain æ ¸å¿ƒæ¨¡å—åˆ†æ</h2>
<h3 data-id="heading-2">æ¦‚è¿°</h3>
<p>æœ¬æ–‡æ¡£æ·±å…¥åˆ†æ LangChain çš„æ ¸å¿ƒæ¨¡å—ï¼ŒåŒ…æ‹¬å…¶è®¾è®¡åŸç†ã€å®ç°ç»†èŠ‚å’Œä½¿ç”¨åœºæ™¯ã€‚</p>
<h3 data-id="heading-3">1. Runnable ç³»ç»Ÿ</h3>
<h4 data-id="heading-4">1.1 è®¾è®¡ç†å¿µ</h4>
<p><strong>é—®é¢˜</strong>: åœ¨ LLM åº”ç”¨ä¸­ï¼Œéœ€è¦ç»„åˆå¤šç§ç»„ä»¶ï¼ˆæç¤ºè¯ã€æ¨¡å‹ã€è§£æå™¨ç­‰ï¼‰ï¼Œå¦‚ä½•è®©å®ƒä»¬æ— ç¼åä½œï¼Ÿ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: å®šä¹‰ç»Ÿä¸€çš„ <code>Runnable</code> æ¥å£ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½å®ç°è¿™ä¸ªæ¥å£ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    I[Runnable æ¥å£] --&gt; P[æç¤ºæ¨¡æ¿]
    I --&gt; L[è¯­è¨€æ¨¡å‹]
    I --&gt; O[è¾“å‡ºè§£æå™¨]
    I --&gt; T[å·¥å…·]
    I --&gt; R[æ£€ç´¢å™¨]

    P --&gt;|ç»„åˆ| C[LCEL é“¾]
    L --&gt;|ç»„åˆ| C
    O --&gt;|ç»„åˆ| C
</code></pre>
<h4 data-id="heading-5">1.2 æ ¸å¿ƒæ¥å£</h4>
<p><strong>æ–‡ä»¶</strong>: <code>libs/core/langchain_core/runnables/base.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Runnable</span>(<span class="hljs-type">Generic</span>[Input, Output], ABC):
    <span class="hljs-string">"""æ‰€æœ‰ç»„ä»¶çš„åŸºç¡€æ¥å£"""</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span>: Input, config: <span class="hljs-type">Optional</span>[RunnableConfig] = <span class="hljs-literal">None</span></span>) -&gt; Output:
        <span class="hljs-string">"""åŒæ­¥æ‰§è¡Œï¼šå°†è¾“å…¥è½¬æ¢ä¸ºè¾“å‡º"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">batch</span>(<span class="hljs-params">self, inputs: <span class="hljs-built_in">list</span>[Input]</span>) -&gt; <span class="hljs-built_in">list</span>[Output]:
        <span class="hljs-string">"""æ‰¹é‡å¤„ç†ï¼šå¹¶è¡Œæ‰§è¡Œå¤šä¸ªè¾“å…¥"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">stream</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span>: Input</span>) -&gt; Iterator[Output]:
        <span class="hljs-string">"""æµå¼è¾“å‡ºï¼šé€æ­¥äº§ç”Ÿç»“æœ"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">ainvoke</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span>: Input</span>) -&gt; Output:
        <span class="hljs-string">"""å¼‚æ­¥æ‰§è¡Œ"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__or__</span>(<span class="hljs-params">self, other: Runnable</span>) -&gt; RunnableSequence:
        <span class="hljs-string">"""ç®¡é“æ“ä½œç¬¦ï¼šåˆ›å»ºé¡ºåºé“¾"""</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<h4 data-id="heading-6">1.3 ç±»å‹å±‚æ¬¡</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class Runnable {
        &lt;&lt;abstract&gt;&gt;
        +invoke()
        +batch()
        +stream()
        +ainvoke()
    }

    class RunnableLambda {
        +func Callable
        +invoke()
    }

    class RunnableSequence {
        +steps Sequence
        +invoke()
    }

    class RunnableParallel {
        +steps Mapping
        +invoke()
    }

    class RunnablePassthrough {
        +invoke()
    }

    Runnable &lt;|-- RunnableLambda
    Runnable &lt;|-- RunnableSequence
    Runnable &lt;|-- RunnableParallel
    Runnable &lt;|-- RunnablePassthrough
</code></pre>
<h4 data-id="heading-7">1.4 LCEL æ‰§è¡Œæµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant U as ç”¨æˆ·ä»£ç 
    participant S as RunnableSequence
    participant P as Prompt
    participant M as Model
    participant O as Parser

    U-&gt;&gt;S: chain.invoke({"topic": "AI"})
    S-&gt;&gt;P: prompt.invoke({"topic": "AI"})
    P--&gt;&gt;S: "Tell me about AI"
    S-&gt;&gt;M: model.invoke("Tell me about AI")
    M--&gt;&gt;S: AIMessage("AI is...")
    S-&gt;&gt;O: parser.invoke(AIMessage)
    O--&gt;&gt;S: "AI is..."
    S--&gt;&gt;U: "AI is..."
</code></pre>
<h4 data-id="heading-8">1.5 å®ç°ç»†èŠ‚</h4>
<p><strong>RunnableSequence çš„ invoke å®ç°</strong>:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span>: Input, config: <span class="hljs-type">Optional</span>[RunnableConfig] = <span class="hljs-literal">None</span></span>) -&gt; Output:
    <span class="hljs-string">"""
    é¡ºåºæ‰§è¡Œæ‰€æœ‰æ­¥éª¤

    å…³é”®ç‚¹ï¼š
    1. å°†æ¯ä¸ªæ­¥éª¤çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥
    2. å¤„ç†å¼‚å¸¸å¹¶æä¾›ä¸Šä¸‹æ–‡
    3. æ”¯æŒä¸­é—´ç»“æœçš„è¿½è¸ª
    """</span>
    value: <span class="hljs-type">Any</span> = <span class="hljs-built_in">input</span>

    <span class="hljs-keyword">for</span> i, step <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.steps):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ ¸å¿ƒé€»è¾‘ï¼šä¼ é€’å€¼åˆ°ä¸‹ä¸€æ­¥</span>
            value = step.invoke(value, config)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-comment"># æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯</span>
            <span class="hljs-keyword">raise</span> RuntimeError(
                <span class="hljs-string">f"Error in step <span class="hljs-subst">{i}</span> (<span class="hljs-subst">{step.get_name()}</span>): <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>
            ) <span class="hljs-keyword">from</span> e

    <span class="hljs-keyword">return</span> value
</code></pre>
<p><strong>RunnableParallel çš„å¹¶å‘æ‰§è¡Œ</strong>:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">ainvoke</span>(<span class="hljs-params">
    self,
    <span class="hljs-built_in">input</span>: Input,
    config: <span class="hljs-type">Optional</span>[RunnableConfig] = <span class="hljs-literal">None</span>,
</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
    <span class="hljs-string">"""
    å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰æ­¥éª¤

    å…³é”®ç‚¹ï¼š
    1. ä½¿ç”¨ asyncio.gather å¹¶è¡Œæ‰§è¡Œ
    2. æ‰€æœ‰æ­¥éª¤æ¥æ”¶ç›¸åŒçš„è¾“å…¥
    3. ç»“æœåˆå¹¶åˆ°å­—å…¸ä¸­
    """</span>
    <span class="hljs-comment"># ä¸ºæ¯ä¸ªæ­¥éª¤åˆ›å»ºå¼‚æ­¥ä»»åŠ¡</span>
    tasks = [
        step.ainvoke(<span class="hljs-built_in">input</span>, config)
        <span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> self.steps.values()
    ]

    <span class="hljs-comment"># å¹¶è¡Œç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span>
    results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)

    <span class="hljs-comment"># å°†ç»“æœæ˜ å°„åˆ°é”®</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(self.steps.keys(), results))
</code></pre>
<h4 data-id="heading-9">1.6 æœ€ä½³å®è·µ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># âœ“ æ¨èï¼šä½¿ç”¨ç±»å‹æ³¨è§£</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>

chain: Runnable[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>], <span class="hljs-built_in">str</span>] = prompt | model | parser

<span class="hljs-comment"># âœ“ æ¨èï¼šä½¿ç”¨ RunnablePassthrough ä¼ é€’æ•°æ®</span>
<span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnablePassthrough

chain = {
    <span class="hljs-string">"context"</span>: retriever | format_docs,
    <span class="hljs-string">"question"</span>: RunnablePassthrough(),  <span class="hljs-comment"># ä¿ç•™åŸå§‹é—®é¢˜</span>
} | prompt | model

<span class="hljs-comment"># âœ“ æ¨èï¼šä½¿ç”¨ RunnableBranch å¤„ç†æ¡ä»¶</span>
<span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableBranch

chain = RunnableBranch(
    (<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">"category"</span>] == <span class="hljs-string">"tech"</span>, tech_chain),
    (<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">"category"</span>] == <span class="hljs-string">"news"</span>, news_chain),
    default_chain
)

<span class="hljs-comment"># âœ— é¿å…ï¼šåœ¨é“¾ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ</span>
<span class="hljs-comment"># åº”è¯¥ä½¿ç”¨å¼‚æ­¥æˆ–æµå¼å¤„ç†</span>
</code></pre>
<h3 data-id="heading-10">2. è¯­è¨€æ¨¡å‹æŠ½è±¡</h3>
<h4 data-id="heading-11">2.1 è®¾è®¡ç†å¿µ</h4>
<p><strong>é—®é¢˜</strong>: ä¸åŒçš„ LLM æä¾›å•†ï¼ˆOpenAIã€Anthropicã€Google ç­‰ï¼‰æœ‰ä¸åŒçš„ APIï¼Œå¦‚ä½•ç»Ÿä¸€ä½¿ç”¨ï¼Ÿ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: å®šä¹‰ <code>BaseLanguageModel</code> æŠ½è±¡æ¥å£ï¼Œå„æä¾›å•†å®ç°æ­¤æ¥å£ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[BaseLanguageModel] --&gt; B[ChatOpenAI]
    A --&gt; C[ChatAnthropic]
    A --&gt; D[ChatGoogle]
    A --&gt; E[HuggingFace]

    F[åº”ç”¨ä»£ç ] -.-&gt;|ä½¿ç”¨| A
</code></pre>
<h4 data-id="heading-12">2.2 æ ¸å¿ƒæ¥å£</h4>
<p><strong>æ–‡ä»¶</strong>: <code>libs/core/langchain_core/language_models/base.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseLanguageModel</span>(RunnableSerializable[LanguageModelInput, LanguageModelOutputVar], ABC):
    <span class="hljs-string">"""æ‰€æœ‰è¯­è¨€æ¨¡å‹çš„æŠ½è±¡åŸºç±»"""</span>

    <span class="hljs-comment"># å¯é…ç½®çš„å­—æ®µ</span>
    cache: <span class="hljs-type">Union</span>[BaseCache, <span class="hljs-built_in">bool</span>, <span class="hljs-literal">None</span>]
    verbose: <span class="hljs-built_in">bool</span>
    callbacks: Callbacks
    tags: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]

    <span class="hljs-comment"># æ ¸å¿ƒæ–¹æ³•</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_prompt</span>(<span class="hljs-params">
        self,
        prompts: <span class="hljs-built_in">list</span>[PromptValue],
        stop: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        **kwargs: <span class="hljs-type">Any</span>,
    </span>) -&gt; LLMResult:
        <span class="hljs-string">"""ç”Ÿæˆæ–‡æœ¬çš„æ ¸å¿ƒæ–¹æ³•"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-comment"># Runnable å®ç°</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-params">
        self,
        <span class="hljs-built_in">input</span>: LanguageModelInput,
        config: <span class="hljs-type">Optional</span>[RunnableConfig] = <span class="hljs-literal">None</span>,
    </span>) -&gt; LanguageModelOutputVar:
        <span class="hljs-string">"""å°†è¾“å…¥è½¬æ¢ä¸º PromptValue å¹¶ç”Ÿæˆ"""</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<h4 data-id="heading-13">2.3 æ¶ˆæ¯ç±»å‹ç³»ç»Ÿ</h4>
<p><strong>æ–‡ä»¶</strong>: <code>libs/core/langchain_core/messages/</code></p>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class BaseMessage {
        &lt;&lt;abstract&gt;&gt;
        +content Any
        +type str
        +to_dict()
    }

    class HumanMessage {
        +content str
        +example bool
    }

    class AIMessage {
        +content str
        +tool_calls list
        +tool_call_id str
    }

    class SystemMessage {
        +content str
    }

    class ToolMessage {
        +content Any
        +tool_call_id str
    }

    BaseMessage &lt;|-- HumanMessage
    BaseMessage &lt;|-- AIMessage
    BaseMessage &lt;|-- SystemMessage
    BaseMessage &lt;|-- ToolMessage
</code></pre>
<h4 data-id="heading-14">2.4 å·¥å…·è°ƒç”¨æœºåˆ¶</h4>
<p><strong>ç»‘å®šå·¥å…·åˆ°æ¨¡å‹</strong>:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–‡ä»¶: libs/core/langchain_core/language_models/chat_models.py</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">bind_tools</span>(<span class="hljs-params">
    self,
    tools: <span class="hljs-type">Sequence</span>[BaseTool],
    **kwargs: <span class="hljs-type">Any</span>,
</span>) -&gt; <span class="hljs-string">"RunnableBinding"</span>:
    <span class="hljs-string">"""
    ç»‘å®šå·¥å…·åˆ°æ¨¡å‹

    æ­¥éª¤ï¼š
    1. å°†å·¥å…·è½¬æ¢ä¸ºæ¨¡å‹ç‰¹å®šçš„æ ¼å¼
    2. åˆ›å»º RunnableBinding åŒ…è£…å™¨
    3. åœ¨è°ƒç”¨æ—¶è‡ªåŠ¨æ·»åŠ å·¥å…·ä¿¡æ¯
    """</span>
    <span class="hljs-comment"># æ ¼å¼åŒ–å·¥å…·</span>
    formatted_tools = [self._format_tool(tool) <span class="hljs-keyword">for</span> tool <span class="hljs-keyword">in</span> tools]

    <span class="hljs-comment"># åˆ›å»ºç»‘å®š</span>
    <span class="hljs-keyword">return</span> RunnableBinding(
        bound=self,
        kwargs={**kwargs, <span class="hljs-string">"tools"</span>: formatted_tools}
    )
</code></pre>
<h4 data-id="heading-15">2.5 æµå¼ç”Ÿæˆ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">stream</span>(<span class="hljs-params">
    self,
    <span class="hljs-built_in">input</span>: LanguageModelInput,
    config: <span class="hljs-type">Optional</span>[RunnableConfig] = <span class="hljs-literal">None</span>,
</span>) -&gt; Iterator[BaseMessage]:
    <span class="hljs-string">"""
    æµå¼ç”Ÿæˆæ–‡æœ¬

    å…³é”®ç‚¹ï¼š
    1. ä¸æä¾›å•†å»ºç«‹ SSE è¿æ¥
    2. é€æ­¥æ¥æ”¶å’Œäº§ç”Ÿæ•°æ®å—
    3. ç´¯ç§¯å®Œæ•´çš„æ¶ˆæ¯
    """</span>
    accumulated_content = <span class="hljs-string">""</span>

    <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> self._stream(<span class="hljs-built_in">input</span>, config):
        accumulated_content += chunk.content
        <span class="hljs-keyword">yield</span> AIMessage(content=chunk.content)
</code></pre>
<h3 data-id="heading-16">3. å·¥å…·ç³»ç»Ÿ</h3>
<h4 data-id="heading-17">3.1 è®¾è®¡ç†å¿µ</h4>
<p><strong>é—®é¢˜</strong>: LLM åªèƒ½ç”Ÿæˆæ–‡æœ¬ï¼Œå¦‚ä½•è®©å®ƒæ‰§è¡Œå®é™…æ“ä½œï¼ˆæœç´¢ã€è®¡ç®—ç­‰ï¼‰ï¼Ÿ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: å®šä¹‰å·¥å…·æ¥å£ï¼ŒLLM å¯ä»¥é€‰æ‹©è°ƒç”¨å·¥å…·ï¼Œå·¥å…·æ‰§è¡Œç»“æœè¿”å›ç»™ LLMã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant U as ç”¨æˆ·
    participant L as LLM
    participant T as å·¥å…·
    participant S as å¤–éƒ¨ç³»ç»Ÿ

    U-&gt;&gt;L: "å·´é»å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
    L-&gt;&gt;L: åˆ†æéœ€è¦å¤©æ°”ä¿¡æ¯
    L-&gt;&gt;T: è°ƒç”¨ get_weather("å·´é»")
    T-&gt;&gt;S: è¯·æ±‚å¤©æ°”æ•°æ®
    S--&gt;&gt;T: {"temp": 20, "condition": "æ™´å¤©"}
    T--&gt;&gt;L: è¿”å›ç»“æœ
    L-&gt;&gt;L: æ ¹æ®ç»“æœç”Ÿæˆå›ç­”
    L--&gt;&gt;U: "å·´é»ä»Šå¤©20åº¦ï¼Œæ™´å¤©"
</code></pre>
<h4 data-id="heading-18">3.2 å·¥å…·ç»“æ„</h4>
<p><strong>æ–‡ä»¶</strong>: <code>libs/core/langchain_core/tools/base.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseTool</span>(RunnableSerializable[<span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">dict</span>], <span class="hljs-type">Any</span>], ABC):
    <span class="hljs-string">"""å·¥å…·çš„æŠ½è±¡åŸºç±»"""</span>

    <span class="hljs-comment"># å…ƒæ•°æ®</span>
    name: <span class="hljs-built_in">str</span>
    description: <span class="hljs-built_in">str</span>
    args_schema: <span class="hljs-type">Type</span>[BaseModel]

    <span class="hljs-comment"># æ‰§è¡Œæ–¹æ³•</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_run</span>(<span class="hljs-params">self, *args, **kwargs</span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""åŒæ­¥æ‰§è¡Œå·¥å…·"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">_arun</span>(<span class="hljs-params">self, *args, **kwargs</span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""å¼‚æ­¥æ‰§è¡Œå·¥å…·ï¼ˆå¯é€‰ï¼‰"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> asyncio.get_event_loop().run_in_executor(
            <span class="hljs-literal">None</span>, functools.partial(self._run, *args, **kwargs)
        )
</code></pre>
<h4 data-id="heading-19">3.3 å·¥å…·è°ƒç”¨æµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">stateDiagram-v2
    [*] --&gt; æ¥æ”¶è¾“å…¥
    æ¥æ”¶è¾“å…¥ --&gt; è§£æå‚æ•°: LLM è¾“å‡º
    è§£æå‚æ•° --&gt; éªŒè¯å‚æ•°: args_schema
    éªŒè¯å‚æ•° --&gt; æ‰§è¡Œå·¥å…·: _run/_arun
    æ‰§è¡Œå·¥å…· --&gt; æ ¼å¼åŒ–ç»“æœ: ToolMessage
    æ ¼å¼åŒ–ç»“æœ --&gt; [*]
</code></pre>
<h4 data-id="heading-20">3.4 è‡ªå®šä¹‰å·¥å…·ç¤ºä¾‹</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> StructuredTool
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field

<span class="hljs-comment"># å®šä¹‰è¾“å…¥æ¨¡å¼</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchInput</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    query: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"æœç´¢æŸ¥è¯¢"</span>)
    limit: <span class="hljs-built_in">int</span> = Field(default=<span class="hljs-number">10</span>, description=<span class="hljs-string">"ç»“æœæ•°é‡"</span>)

<span class="hljs-comment"># å®šä¹‰å·¥å…·å‡½æ•°</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_func</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span>, limit: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""æ‰§è¡Œæœç´¢"""</span>
    <span class="hljs-comment"># å®é™…çš„æœç´¢é€»è¾‘</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"æœç´¢ '<span class="hljs-subst">{query}</span>'ï¼Œè¿”å› <span class="hljs-subst">{limit}</span> ä¸ªç»“æœ"</span>

<span class="hljs-comment"># åˆ›å»ºå·¥å…·</span>
search_tool = StructuredTool(
    name=<span class="hljs-string">"search"</span>,
    description=<span class="hljs-string">"æœç´¢äº’è”ç½‘"</span>,
    func=search_func,
    args_schema=SearchInput,
)
</code></pre>
<h3 data-id="heading-21">4. æ£€ç´¢ç³»ç»Ÿ</h3>
<h4 data-id="heading-22">4.1 è®¾è®¡ç†å¿µ</h4>
<p><strong>é—®é¢˜</strong>: LLM æœ‰çŸ¥è¯†æˆªæ­¢æ—¥æœŸï¼Œå¦‚ä½•è®©å®ƒè®¿é—®æœ€æ–°æˆ–ç§æœ‰æ•°æ®ï¼Ÿ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) - å…ˆæ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œå†åŸºäºæ–‡æ¡£ç”Ÿæˆç­”æ¡ˆã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    Q[ç”¨æˆ·æŸ¥è¯¢] --&gt; R[æ£€ç´¢å™¨]
    R --&gt; VS[å‘é‡å­˜å‚¨]
    VS --&gt;|ç›¸ä¼¼åº¦æœç´¢| D[ç›¸å…³æ–‡æ¡£]
    D --&gt; P[æç¤ºè¯æ¨¡æ¿]
    P --&gt; L[LLM]
    L --&gt; A[æœ€ç»ˆç­”æ¡ˆ]
</code></pre>
<h4 data-id="heading-23">4.2 æ£€ç´¢å™¨æ¥å£</h4>
<p><strong>æ–‡ä»¶</strong>: <code>libs/core/langchain_core/retrievers.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseRetriever</span>(Runnable[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">list</span>[Document]], ABC):
    <span class="hljs-string">"""æ£€ç´¢å™¨çš„æŠ½è±¡åŸºç±»"""</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_relevant_documents</span>(<span class="hljs-params">
        self,
        query: <span class="hljs-built_in">str</span>,
        run_manager: CallbackManagerForChainRun,
    </span>) -&gt; <span class="hljs-built_in">list</span>[Document]:
        <span class="hljs-string">"""è·å–ç›¸å…³æ–‡æ¡£"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span>: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">list</span>[Document]:
        <span class="hljs-string">"""Runnable æ¥å£å®ç°"""</span>
        <span class="hljs-keyword">return</span> self._get_relevant_documents(<span class="hljs-built_in">input</span>, <span class="hljs-literal">None</span>)
</code></pre>
<h4 data-id="heading-24">4.3 å‘é‡å­˜å‚¨æ£€ç´¢å™¨</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–‡ä»¶: libs/langchain/langchain/vectorstores/base.py</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VectorStoreRetriever</span>(<span class="hljs-title class_ inherited__">BaseRetriever</span>):
    <span class="hljs-string">"""åŸºäºå‘é‡å­˜å‚¨çš„æ£€ç´¢å™¨"""</span>

    vectorstore: VectorStore
    search_type: <span class="hljs-built_in">str</span> = <span class="hljs-string">"similarity"</span>
    search_kwargs: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>] = Field(default_factory=<span class="hljs-built_in">dict</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_relevant_documents</span>(<span class="hljs-params">
        self,
        query: <span class="hljs-built_in">str</span>,
        run_manager: CallbackManagerForChainRun,
    </span>) -&gt; <span class="hljs-built_in">list</span>[Document]:
        <span class="hljs-string">"""æ‰§è¡Œå‘é‡ç›¸ä¼¼åº¦æœç´¢"""</span>
        <span class="hljs-keyword">if</span> self.search_type == <span class="hljs-string">"similarity"</span>:
            <span class="hljs-keyword">return</span> self.vectorstore.similarity_search(
                query,
                k=self.search_kwargs.get(<span class="hljs-string">"k"</span>, <span class="hljs-number">4</span>)
            )
        <span class="hljs-keyword">elif</span> self.search_type == <span class="hljs-string">"mmr"</span>:
            <span class="hljs-keyword">return</span> self.vectorstore.max_marginal_relevance_search(
                query,
                k=self.search_kwargs.get(<span class="hljs-string">"k"</span>, <span class="hljs-number">4</span>)
            )
</code></pre>
<h4 data-id="heading-25">4.4 RAG é“¾å®ç°</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser
<span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnablePassthrough

<span class="hljs-comment"># RAG æç¤ºè¯æ¨¡æ¿</span>
template = <span class="hljs-string">"""æ ¹æ®ä»¥ä¸‹ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ï¼š

ä¸Šä¸‹æ–‡ï¼š
{context}

é—®é¢˜ï¼š{question}

å›ç­”ï¼š"""</span>

prompt = ChatPromptTemplate.from_template(template)

<span class="hljs-comment"># æ ¼å¼åŒ–æ–‡æ¡£</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">format_docs</span>(<span class="hljs-params">docs</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">"\n\n"</span>.join(doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> docs)

<span class="hljs-comment"># æ„å»º RAG é“¾</span>
rag_chain = (
    {
        <span class="hljs-string">"context"</span>: retriever | format_docs,
        <span class="hljs-string">"question"</span>: RunnablePassthrough()
    }
    | prompt
    | llm
    | StrOutputParser()
)

<span class="hljs-comment"># ä½¿ç”¨</span>
result = rag_chain.invoke(<span class="hljs-string">"ä»€ä¹ˆæ˜¯ LangChainï¼Ÿ"</span>)
</code></pre>
<h3 data-id="heading-26">5. è®°å¿†ç³»ç»Ÿ</h3>
<h4 data-id="heading-27">5.1 è®¾è®¡ç†å¿µ</h4>
<p><strong>é—®é¢˜</strong>: LLM æ˜¯æ— çŠ¶æ€çš„ï¼Œå¦‚ä½•åœ¨å¤šè½®å¯¹è¯ä¸­ä¿æŒä¸Šä¸‹æ–‡ï¼Ÿ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: è®°å¿†ç»„ä»¶ - è‡ªåŠ¨ç®¡ç†å¯¹è¯å†å²å¹¶åœ¨æ¯æ¬¡è°ƒç”¨æ—¶æ³¨å…¥æç¤ºè¯ã€‚</p>
<h4 data-id="heading-28">5.2 è®°å¿†æ¥å£</h4>
<p><strong>æ–‡ä»¶</strong>: <code>libs/langchain/langchain/memory/base.py</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseMemory</span>(Serializable, ABC):
    <span class="hljs-string">"""è®°å¿†çš„æŠ½è±¡åŸºç±»"""</span>

<span class="hljs-meta">    @property</span>
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">memory_variables</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""è¿”å›æ­¤è®°å¿†ç®¡ç†çš„å˜é‡å"""</span>
        <span class="hljs-keyword">pass</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_memory_variables</span>(<span class="hljs-params">self, inputs: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""åŠ è½½è®°å¿†å˜é‡"""</span>
        <span class="hljs-keyword">pass</span>

<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_context</span>(<span class="hljs-params">self, inputs: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>], outputs: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""ä¿å­˜å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡"""</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<h4 data-id="heading-29">5.3 è®°å¿†ç±»å‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((è®°å¿†ç±»å‹))
    ç¼“å†²è®°å¿†
      ConversationBufferMemory
      ä¿å­˜æ‰€æœ‰æ¶ˆæ¯
    çª—å£è®°å¿†
      BufferWindowMemory
      åªä¿å­˜æœ€è¿‘ N æ¡
    æ‘˜è¦è®°å¿†
      SummaryMemory
      ä¿å­˜å¯¹è¯æ‘˜è¦
    å‘é‡è®°å¿†
      VectorStoreMemory
      åŸºäºå‘é‡æ£€ç´¢
    å®ä½“è®°å¿†
      EntityMemory
      è·Ÿè¸ªå®ä½“ä¿¡æ¯
</code></pre>
<h4 data-id="heading-30">5.4 åœ¨é“¾ä¸­ä½¿ç”¨è®°å¿†</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.memory <span class="hljs-keyword">import</span> ConversationBufferMemory

<span class="hljs-comment"># åˆ›å»ºè®°å¿†</span>
memory = ConversationBufferMemory(
    memory_key=<span class="hljs-string">"chat_history"</span>,
    return_messages=<span class="hljs-literal">True</span>
)

<span class="hljs-comment"># åˆ›å»ºå¸¦è®°å¿†çš„æç¤ºè¯</span>
prompt = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„åŠ©æ‰‹ã€‚"</span>),
    (<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{chat_history}"</span>),  <span class="hljs-comment"># è®°å¿†å ä½ç¬¦</span>
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>)
])

<span class="hljs-comment"># åˆ›å»ºé“¾</span>
chain = prompt | llm

<span class="hljs-comment"># ä½¿ç”¨ RunnableWithMessageHistory æ·»åŠ è®°å¿†</span>
<span class="hljs-keyword">from</span> langchain_core.runnables.history <span class="hljs-keyword">import</span> RunnableWithMessageHistory

chain_with_history = RunnableWithMessageHistory(
    chain,
    <span class="hljs-keyword">lambda</span> session_id: memory,  <span class="hljs-comment"># è·å–è®°å¿†çš„å‡½æ•°</span>
    input_messages_key=<span class="hljs-string">"input"</span>,
    history_messages_key=<span class="hljs-string">"chat_history"</span>
)
</code></pre>
<h3 data-id="heading-31">6. ä»£ç†ç³»ç»Ÿ</h3>
<h4 data-id="heading-32">6.1 è®¾è®¡ç†å¿µ</h4>
<p><strong>é—®é¢˜</strong>: å¦‚ä½•è®© LLM è‡ªä¸»å†³ç­–å’Œæ‰§è¡Œå¤æ‚ä»»åŠ¡ï¼Ÿ</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>: ä»£ç† - LLM ä½œä¸º"å¤§è„‘"ï¼Œå†³å®šè°ƒç”¨å“ªäº›å·¥å…·ä»¥åŠä½•æ—¶åœæ­¢ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">stateDiagram-v2
    [*] --&gt; æ¥æ”¶ä»»åŠ¡
    æ¥æ”¶ä»»åŠ¡ --&gt; æ€è€ƒ: LLM åˆ†æ
    æ€è€ƒ --&gt; å†³å®šåŠ¨ä½œ: é€‰æ‹©å·¥å…·
    å†³å®šåŠ¨ä½œ --&gt; æ‰§è¡Œå·¥å…·: è°ƒç”¨å·¥å…·
    æ‰§è¡Œå·¥å…· --&gt; è§‚å¯Ÿç»“æœ: è·å–è¾“å‡º
    è§‚å¯Ÿç»“æœ --&gt; æ€è€ƒ: ç»§ç»­æ¨ç†
    æ€è€ƒ --&gt; å®Œæˆä»»åŠ¡: æ»¡è¶³æ¡ä»¶
    å®Œæˆä»»åŠ¡ --&gt; [*]
</code></pre>
<h4 data-id="heading-33">6.2 ä»£ç†ç±»å‹</h4>






























<table><thead><tr><th>ç±»å‹</th><th>æè¿°</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>ReActAgent</td><td>æ¨ç†-è¡ŒåŠ¨å¾ªç¯</td><td>éœ€è¦å¤šæ­¥æ¨ç†</td></tr><tr><td>OpenAIToolsAgent</td><td>OpenAI å·¥å…·è°ƒç”¨</td><td>ä½¿ç”¨ OpenAI API</td></tr><tr><td>StructuredChatAgent</td><td>ç»“æ„åŒ–è¾“å…¥è¾“å‡º</td><td>å¤æ‚å·¥å…·å‚æ•°</td></tr><tr><td>SelfAskWithSearch</td><td>è‡ªé—®è‡ªç­”</td><td>éœ€è¦éªŒè¯äº‹å®</td></tr></tbody></table>
<h4 data-id="heading-34">6.3 ä»£ç†æ‰§è¡Œæµç¨‹</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–‡ä»¶: libs/langchain/langchain/agents/agent.py</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentExecutor</span>:
    <span class="hljs-string">"""ä»£ç†æ‰§è¡Œå™¨"""</span>

    agent: Agent
    tools: <span class="hljs-built_in">list</span>[BaseTool]
    max_iterations: <span class="hljs-built_in">int</span> = <span class="hljs-number">15</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-params">self, inputs: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>) -&gt; AgentFinish:
        <span class="hljs-string">"""æ‰§è¡Œä»£ç†å¾ªç¯"""</span>
        iterations = <span class="hljs-number">0</span>
        intermediate_steps = []

        <span class="hljs-keyword">while</span> iterations &lt; self.max_iterations:
            <span class="hljs-comment"># 1. è®©ä»£ç†å†³å®šä¸‹ä¸€æ­¥åŠ¨ä½œ</span>
            action = self.agent.plan(
                inputs,
                intermediate_steps
            )

            <span class="hljs-comment"># 2. æ£€æŸ¥æ˜¯å¦å®Œæˆ</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(action, AgentFinish):
                <span class="hljs-keyword">return</span> action

            <span class="hljs-comment"># 3. æ‰§è¡Œå·¥å…·</span>
            tool = self._get_tool(action.tool)
            observation = tool.invoke(action.tool_input)

            <span class="hljs-comment"># 4. è®°å½•è§‚å¯Ÿç»“æœ</span>
            intermediate_steps.append((action, observation))

            iterations += <span class="hljs-number">1</span>

        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"ä»£ç†è¶…è¿‡æœ€å¤§è¿­ä»£æ¬¡æ•°"</span>)
</code></pre>
<h3 data-id="heading-35">7. é“¾ç³»ç»Ÿ</h3>
<h4 data-id="heading-36">7.1 é“¾çš„ç±»å‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((é“¾ç±»å‹))
    åŸºç¡€é“¾
      LLMChain
      æœ€ç®€å•çš„ LLM è°ƒç”¨
    é¡ºåºé“¾
      SequentialChain
      SimpleSequentialChain
      æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªé“¾
    è·¯ç”±é“¾
      RouterChain
      MultiPromptChain
      æ ¹æ®è¾“å…¥è·¯ç”±åˆ°ä¸åŒé“¾
    é«˜çº§é“¾
      RetrievalQA
      ConversationalRetrievalChain
      TransformChain
</code></pre>
<h4 data-id="heading-37">7.2 ä½¿ç”¨ LCEL æ„å»ºé“¾</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä¼ ç»Ÿæ–¹å¼ï¼ˆå·²åºŸå¼ƒï¼‰</span>
<span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> LLMChain

chain = LLMChain(
    llm=llm,
    prompt=prompt,
    output_parser=parser
)
result = chain.run({<span class="hljs-string">"topic"</span>: <span class="hljs-string">"AI"</span>})

<span class="hljs-comment"># LCEL æ–¹å¼ï¼ˆæ¨èï¼‰</span>
chain = prompt | llm | parser
result = chain.invoke({<span class="hljs-string">"topic"</span>: <span class="hljs-string">"AI"</span>})
</code></pre>
<h4 data-id="heading-38">7.3 å¤æ‚é“¾ç¤ºä¾‹</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableBranch, RunnableParallel

<span class="hljs-comment"># æ¡ä»¶åˆ†æ”¯</span>
branch = RunnableBranch(
    (<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">"language"</span>] == <span class="hljs-string">"chinese"</span>, chinese_chain),
    (<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">"language"</span>] == <span class="hljs-string">"english"</span>, english_chain),
    default_chain
)

<span class="hljs-comment"># å¹¶è¡Œå¤„ç†</span>
parallel = RunnableParallel(
    translation=translation_chain,
    summary=summary_chain,
    sentiment=sentiment_chain
)

<span class="hljs-comment"># ç»„åˆåœ¨ä¸€èµ·</span>
complex_chain = {
    <span class="hljs-string">"input"</span>: RunnablePassthrough(),
    <span class="hljs-string">"language"</span>: detect_language_chain
} | branch | parallel | final_formatter
</code></pre>
<h3 data-id="heading-39">8. æ€§èƒ½ä¼˜åŒ–</h3>
<h4 data-id="heading-40">8.1 æ‰¹é‡å¤„ç†</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ‰¹é‡è°ƒç”¨å¯ä»¥æé«˜ååé‡</span>
results = chain.batch([
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"query 1"</span>},
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"query 2"</span>},
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"query 3"</span>}
], config={<span class="hljs-string">"max_concurrency"</span>: <span class="hljs-number">5</span>})
</code></pre>
<h4 data-id="heading-41">8.2 æµå¼å¤„ç†</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æµå¼å¤„ç†å¯ä»¥å‡å°‘å»¶è¿Ÿ</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chain.astream({<span class="hljs-string">"input"</span>: <span class="hljs-string">"é•¿æ–‡æœ¬"</span>}):
    <span class="hljs-built_in">print</span>(chunk, end=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
</code></pre>
<h4 data-id="heading-42">8.3 ç¼“å­˜</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.cache <span class="hljs-keyword">import</span> InMemoryCache

<span class="hljs-comment"># å¯ç”¨ç¼“å­˜</span>
llm = ChatOpenAI(cache=InMemoryCache())

<span class="hljs-comment"># ç¬¬ä¸€æ¬¡è°ƒç”¨ä¼šæ‰§è¡Œå®é™… API è°ƒç”¨</span>
result1 = llm.invoke(<span class="hljs-string">"Hello"</span>)

<span class="hljs-comment"># ç¬¬äºŒæ¬¡ä¼šè¿”å›ç¼“å­˜ç»“æœ</span>
result2 = llm.invoke(<span class="hljs-string">"Hello"</span>)
</code></pre>
<h3 data-id="heading-43">9. è°ƒè¯•å’Œç›‘æ§</h3>
<h4 data-id="heading-44">9.1 ä½¿ç”¨å›è°ƒ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.callbacks <span class="hljs-keyword">import</span> StdOutCallbackHandler

<span class="hljs-comment"># åœ¨é“¾æ‰§è¡Œæ—¶æ‰“å°è¯¦ç»†ä¿¡æ¯</span>
chain.invoke(
    {<span class="hljs-string">"input"</span>: <span class="hljs-string">"test"</span>},
    config={<span class="hljs-string">"callbacks"</span>: [StdOutCallbackHandler()]}
)
</code></pre>
<h4 data-id="heading-45">9.2 ä½¿ç”¨ LangSmith</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

<span class="hljs-comment"># é…ç½® LangSmith</span>
os.environ[<span class="hljs-string">"LANGCHAIN_TRACING_V2"</span>] = <span class="hljs-string">"true"</span>
os.environ[<span class="hljs-string">"LANGCHAIN_API_KEY"</span>] = <span class="hljs-string">"your-api-key"</span>

<span class="hljs-comment"># æ‰€æœ‰æ‰§è¡Œéƒ½ä¼šè¢«è¿½è¸ª</span>
result = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"test"</span>})
</code></pre>
<h3 data-id="heading-46">10. æ€»ç»“</h3>
<p>LangChain çš„æ ¸å¿ƒæ¨¡å—é€šè¿‡ç»Ÿä¸€çš„ Runnable æ¥å£å®ç°äº†é«˜åº¦çš„å¯ç»„åˆæ€§å’Œçµæ´»æ€§ï¼š</p>
<ol>
<li><strong>Runnable ç³»ç»Ÿ</strong>: ç»Ÿä¸€çš„æ‰§è¡Œæ¥å£å’Œç»„åˆèƒ½åŠ›</li>
<li><strong>è¯­è¨€æ¨¡å‹æŠ½è±¡</strong>: æä¾›å•†æ— å…³çš„æ¨¡å‹æ¥å£</li>
<li><strong>å·¥å…·ç³»ç»Ÿ</strong>: è®© LLM èƒ½æ‰§è¡Œå®é™…æ“ä½œ</li>
<li><strong>æ£€ç´¢ç³»ç»Ÿ</strong>: RAG æ¨¡å¼çš„æ ¸å¿ƒ</li>
<li><strong>è®°å¿†ç³»ç»Ÿ</strong>: å¤šè½®å¯¹è¯çš„çŠ¶æ€ç®¡ç†</li>
<li><strong>ä»£ç†ç³»ç»Ÿ</strong>: è‡ªä¸»å†³ç­–å’Œæ‰§è¡Œ</li>
<li><strong>é“¾ç³»ç»Ÿ</strong>: å·¥ä½œæµç¼–æ’</li>
</ol>
<p>ç†è§£è¿™äº›æ¨¡å—çš„è®¾è®¡å’Œå®ç°ï¼Œå°†å¸®åŠ©ä½ æ›´æœ‰æ•ˆåœ°ä½¿ç”¨å’Œæ‰©å±• LangChainã€‚</p>
<hr/>
<p>â€”â€” END â€”â€”
æœ¬æ–‡æ˜¯ LangChainæ¡†æ¶å­¦ä¹  ç³»åˆ—æ–‡ç« ä¹‹ä¸€ã€‚</p>
<p>æ›´å¤š Langflow æ•™ç¨‹å’Œå®æˆ˜æ¡ˆä¾‹ï¼Œ
å¯ä»¥æœç´¢å¾®ä¿¡å…¬ä¼—å·ã€ŒåŠªåŠ›å­¦ä¹ AIçš„ç¨‹åºçŒ¿ã€æŸ¥çœ‹ã€‚</p>
<p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€åœ¨çœ‹ã€è½¬å‘ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è‰æ ¹å¼€å‘è€…ç”¨AI VibeCodingé‡æ„ç…§ç‰‡èµ„äº§ç¡¬åˆšADOBEï¼ŒLifeFrameä½¿å‘½ï¼šç‚¹äº®æ¯æ®µå›å¿†]]></title>    <link>https://juejin.cn/post/7598490039489216547</link>    <guid>https://juejin.cn/post/7598490039489216547</guid>    <pubDate>2026-01-24T14:34:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598490039489216547" data-draft-id="7598464972912836648" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è‰æ ¹å¼€å‘è€…ç”¨AI VibeCodingé‡æ„ç…§ç‰‡èµ„äº§ç¡¬åˆšADOBEï¼ŒLifeFrameä½¿å‘½ï¼šç‚¹äº®æ¯æ®µå›å¿†"/> <meta itemprop="keywords" content="VibeCoding"/> <meta itemprop="datePublished" content="2026-01-24T14:34:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çœ‹å±±å…ˆç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/1672809653999114"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è‰æ ¹å¼€å‘è€…ç”¨AI VibeCodingé‡æ„ç…§ç‰‡èµ„äº§ç¡¬åˆšADOBEï¼ŒLifeFrameä½¿å‘½ï¼šç‚¹äº®æ¯æ®µå›å¿†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1672809653999114/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çœ‹å±±å…ˆç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T14:34:05.000Z" title="Sat Jan 24 2026 14:34:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è‰æ ¹å¼€å‘è€…ç”¨AIé‡æ„ç…§ç‰‡èµ„äº§ï¼ŒLifeFrameä½¿å‘½ï¼šç‚¹äº®æ¯æ®µå›å¿†</h2>
<blockquote>
<p>å½“Adobe Lightroomå¹´è´¹é«˜è¾¾888å…ƒï¼Œå½“ä½ çš„ç…§ç‰‡æ•£è½åœ¨æ‰‹æœºã€ç”µè„‘ã€ç½‘ç›˜å„ä¸ªè§’è½ï¼Œå½“ä¸€ä¸ªå¿åŸå°ä¼™å†³å®šç”¨AIå’Œä»£ç æ”¹å˜è¿™ä¸€åˆ‡...</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">æ•…äº‹çš„å¼€å§‹ï¼šä¸€ä¸ªæ‘„å½±çˆ±å¥½è€…çš„ç—›ç‚¹</h3>
<p>æˆ‘å«çœ‹å±±ï¼Œæ¥è‡ªä¸€ä¸ªæ™®é€šçš„å¿åŸã€‚å’Œå¾ˆå¤šæ‘„å½±çˆ±å¥½è€…ä¸€æ ·ï¼Œæˆ‘çƒ­çˆ±ç”¨é•œå¤´è®°å½•ç”Ÿæ´»ï¼Œä½†å¾ˆå¿«å°±è¢«ä¸€ä¸ªç°å®é—®é¢˜å›°æ‰°ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f50ac6ce0dee411f9c49776711a653f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5bGx5YWI55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769870044&amp;x-signature=Zu9K7j0%2BPkppF9Y6ikEiXQ2jvOs%3D" alt="æˆªå±2026-01-24 21.53.00.png" loading="lazy"/></p>
<p><strong>ç…§ç‰‡ç®¡ç†ï¼ŒçœŸçš„å¤ªç—›è‹¦äº†ã€‚</strong></p>
<p>æ‰‹æœºé‡Œå­˜äº†æ•°åƒå¼ ç…§ç‰‡ï¼Œç”µè„‘ç¡¬ç›˜é‡Œè¿˜æœ‰æ›´å¤šã€‚æƒ³è¦æ‰¾ä¸€å¼ å»å¹´åœ¨æŸä¸ªåœ°æ–¹æ‹çš„ç…§ç‰‡ï¼Ÿå¾—ç¿»éæ‰€æœ‰æ–‡ä»¶å¤¹ã€‚æƒ³è¦æ•´ç†æˆæ—¶é—´çº¿ï¼Ÿæ‰‹åŠ¨ä¸€å¼ å¼ åˆ†ç±»ï¼Œç´¯åˆ°æ€€ç–‘äººç”Ÿã€‚æƒ³è¦ä¸“ä¸šçš„ç…§ç‰‡ç‚¹è¯„ï¼Ÿè¦ä¹ˆèŠ±é’±è¯·æ‘„å½±å¸ˆï¼Œè¦ä¹ˆè‡ªå·±æ‘¸ç´¢ã€‚</p>
<p>æ›´è®©äººå¤´ç–¼çš„æ˜¯ï¼Œå¸‚é¢ä¸Šçš„ç…§ç‰‡ç®¡ç†è½¯ä»¶ï¼Œè¦ä¹ˆåŠŸèƒ½å•ä¸€ï¼Œè¦ä¹ˆä»·æ ¼æ˜‚è´µã€‚</p>
<p><strong>Adobe Lightroom</strong>ï¼Œä¸“ä¸šæ˜¯ä¸“ä¸šï¼Œä½†å¹´è´¹888å…ƒï¼Œå¯¹äºæˆ‘è¿™æ ·çš„æ™®é€šç”¨æˆ·æ¥è¯´ï¼Œç¡®å®æœ‰ç‚¹è‚‰ç–¼ã€‚è€Œä¸”ï¼Œå®ƒæ›´åå‘äºç…§ç‰‡åæœŸå¤„ç†ï¼Œå¯¹äº"ç…§ç‰‡ç®¡ç†+å›å¿†æ•´ç†+ä½œå“å±•ç¤º"è¿™æ ·çš„ç»¼åˆéœ€æ±‚ï¼Œæ€»è§‰å¾—ä¸å¤Ÿå®Œç¾ã€‚</p>
<p><strong>Google Photos</strong>ï¼Œå…è´¹ä½†æœ‰é™åˆ¶ï¼Œè€Œä¸”åœ¨å›½å†…ä½¿ç”¨ä¸ä¾¿ã€‚</p>
<p><strong>å„ç§ç½‘ç›˜</strong>ï¼Œåªæ˜¯å­˜å‚¨ï¼Œæ²¡æœ‰æ™ºèƒ½æ•´ç†ï¼Œæ›´æ²¡æœ‰ä¸“ä¸šçš„ç…§ç‰‡ç‚¹è¯„ã€‚</p>
<p>äºæ˜¯ï¼Œä¸€ä¸ªå¤§èƒ†çš„æƒ³æ³•åœ¨æˆ‘è„‘æµ·ä¸­èŒç”Ÿï¼š<strong>ä¸ºä»€ä¹ˆä¸èƒ½è‡ªå·±åšä¸€ä¸ªï¼Ÿ</strong></p>
<hr/>
<h3 data-id="heading-2">ç¡¬åˆšAdobeï¼šç”¨AIå’Œä»£ç é‡æ–°å®šä¹‰ç…§ç‰‡ç®¡ç†</h3>
<p>ä½œä¸ºä¸€ä¸ªéç§‘ç­å‡ºèº«çš„ç¨‹åºå‘˜ï¼Œæˆ‘æ·±çŸ¥è¿™æ¡è·¯ä¸å®¹æ˜“ã€‚ä½†AIæ—¶ä»£çš„åˆ°æ¥ï¼Œç»™äº†æˆ‘æ–°çš„æ­¦å™¨ã€‚</p>
<p>12æœˆä»½ï¼Œæ„ŸæŸ“ç”²æµå§ç—…åŠä¸ªæœˆï¼Œæˆ‘ç”¨VibeCodingæ‰‹æ“å‡ºæ¥äº†è¿™ä¸ªç…§ç‰‡æ‰˜ç®¡å°ç«™ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5c36a8e658c459d94311ef007a1ceb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5bGx5YWI55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769870044&amp;x-signature=KLWEE8HWggEMrLUndcd8ZnZI490%3D" alt="æˆªå±2026-01-19 19.28.55.png" loading="lazy"/></p>
<h4 data-id="heading-3">1. AIç…§ç‰‡ç‚¹è¯„ï¼šè®©æ¯å¼ ç…§ç‰‡éƒ½æœ‰ä¸“ä¸šç‚¹è¯„</h4>
<p>Adobe Lightroomèƒ½å¸®ä½ ä¿®å›¾ï¼Œä½†ä¸ä¼šå‘Šè¯‰ä½ "è¿™å¼ ç…§ç‰‡å“ªé‡Œæ‹å¾—å¥½ï¼Œå“ªé‡Œå¯ä»¥æ”¹è¿›"ã€‚</p>
<p>æˆ‘å†³å®šç”¨AIæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>é€šè¿‡é›†æˆ<strong>GPT</strong>ã€<strong>Claude</strong>ã€<strong>Gemini</strong>ç­‰å¤§æ¨¡å‹ï¼Œæˆ‘æ‰“é€ äº†ä¸€ä¸ªAIç…§ç‰‡ç‚¹è¯„ç³»ç»Ÿã€‚ä¸Šä¼ ä¸€å¼ ç…§ç‰‡ï¼ŒAIä¼šä»å¤šä¸ªç»´åº¦è¿›è¡Œåˆ†æï¼š</p>
<ul>
<li><strong>æ„å›¾åˆ†æ</strong>ï¼šä¸‰åˆ†æ³•ã€å¯¹ç§°æ„å›¾ã€å¼•å¯¼çº¿...</li>
<li><strong>å…‰çº¿è¯„ä»·</strong>ï¼šæ›å…‰æ˜¯å¦å‡†ç¡®ã€å…‰å½±æ˜¯å¦å’Œè°</li>
<li><strong>è‰²å½©ç‚¹è¯„</strong>ï¼šè‰²è°ƒæ˜¯å¦ç»Ÿä¸€ã€è‰²å½©æ­é…æ˜¯å¦åˆç†</li>
<li><strong>æŠ€æ³•å»ºè®®</strong>ï¼šå¦‚ä½•æ”¹è¿›æ„å›¾ã€å¦‚ä½•è°ƒæ•´å‚æ•°</li>
<li><strong>äº®ç‚¹æç‚¼</strong>ï¼šè¿™å¼ ç…§ç‰‡æœ€å€¼å¾—ç§°èµçš„åœ°æ–¹</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2881440faf4b4476831cbd8ee026e08f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5bGx5YWI55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769870044&amp;x-signature=kympnaTvv8pr40cZ%2BwojxMmGf1o%3D" alt="æˆªå±2026-01-24 21.58.33.png" loading="lazy"/></p>
<p>æ›´é…·çš„æ˜¯ï¼Œæˆ‘è¿˜è®¾è®¡äº†å¤šä¸ªAIåŠ©æ‰‹è§’è‰²ï¼š</p>
<ul>
<li><strong>æ‘„å½±å¤§å¸ˆ</strong>ï¼šä¸“ä¸šã€ä¸¥è°¨ï¼Œä»æŠ€æœ¯è§’åº¦æ·±åº¦åˆ†æ</li>
<li><strong>ç½‘ç«™åŒ¿åæ–‡è‰ºé’å¹´</strong>ï¼šå‹å–„ã€æ¸©æš–ç»™å‡ºé¼“åŠ±ï¼Œæ³¨é‡æƒ…æ„Ÿè¡¨è¾¾</li>
<li><strong>å™¨æå…šæ¯’èˆŒç‚¹è¯„</strong>ï¼šæ¯’èˆŒçŠ€åˆ©ï¼Œä¸€é’ˆè§è¡€æŒ‡å‡ºé—®é¢˜</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e97c8e55e784ebf8b30195136852935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5bGx5YWI55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769870044&amp;x-signature=kweSfXltxUWPAAoMO1I%2BgVCJhbI%3D" alt="æˆªå±2026-01-24 22.32.33.png" loading="lazy"/></p>
<p>ä¸€å¼ ç…§ç‰‡ï¼Œä¸‰ç§è§†è§’ï¼Œè®©ä½ å…¨æ–¹ä½äº†è§£è‡ªå·±çš„ä½œå“ã€‚åç»­éšç€AIèƒ½åŠ›çš„è¿›åŒ–ï¼Œè¿˜ä¼šå¢åŠ æ›´å¤šæœ‰è¶£çš„AIè¯„è®ºå‘˜ï¼Œæ¯”å¦‚ç½‘ä¸Šå¾ˆç«çš„â€œç‰›è€Œé€¼ä¹‹ï¼Œç›´æ¥å°ç¥â€ã€‚</p>
<h4 data-id="heading-4">2. æ™ºèƒ½æ—¶é—´çº¿ï¼šè®©å›å¿†è‡ªåŠ¨ä¸²è”</h4>
<p>Lightroomçš„æ—¶é—´çº¿åŠŸèƒ½å¾ˆåŸºç¡€ï¼Œåªæ˜¯æŒ‰æ—¶é—´æ’åºã€‚æˆ‘æƒ³è¦çš„æ˜¯ï¼š<strong>è®©ç…§ç‰‡è‡ªåŠ¨ä¸²è”æˆå›å¿†æ•…äº‹</strong>ã€‚</p>
<p>é€šè¿‡AIæ™ºèƒ½åˆ†ç»„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«ï¼š</p>
<ul>
<li>åŒä¸€æ—¶é—´æ®µæ‹æ‘„çš„ç…§ç‰‡ï¼ˆæ¯”å¦‚ä¸€æ¬¡æ—…è¡Œï¼‰</li>
<li>åŒä¸€åœ°ç‚¹æ‹æ‘„çš„ç…§ç‰‡ï¼ˆæ¯”å¦‚æŸä¸ªåŸå¸‚ï¼‰</li>
<li>åŒä¸€ä¸»é¢˜çš„ç…§ç‰‡ï¼ˆæ¯”å¦‚æ—¥è½ã€ç¾é£Ÿï¼‰</li>
</ul>
<p>ç„¶åè‡ªåŠ¨ç”Ÿæˆ<strong>å›å¿†ç›¸ç°¿ï¼ˆMemoryï¼‰</strong> ï¼Œæ¯å¼ ç…§ç‰‡éƒ½æœ‰EXIFä¿¡æ¯ï¼ˆæ‹æ‘„æ—¶é—´ã€åœ°ç‚¹ã€è®¾å¤‡ï¼‰ï¼Œå½¢æˆå®Œæ•´çš„æ—¶é—´çº¿ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c84eebbdbe534998acad05c4c3cb4905~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5bGx5YWI55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769870044&amp;x-signature=cv7N%2FwCprHC8lIWgghByskZqNtU%3D" alt="æˆªå±2026-01-24 22.00.46.png" loading="lazy"/></p>
<h4 data-id="heading-5">3. è¶³è¿¹åœ°å›¾ï¼šåœ¨åœ°å›¾ä¸Šçœ‹åˆ°ä½ çš„æ—…è¡Œè½¨è¿¹</h4>
<p>è¿™æ˜¯Lightroomæ²¡æœ‰çš„åŠŸèƒ½ã€‚</p>
<p>é€šè¿‡æå–ç…§ç‰‡çš„GPSä¿¡æ¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨åœ°å›¾ä¸Šæ ‡è®°ä½ çš„è¶³è¿¹ã€‚ç‚¹å‡»åœ°å›¾ä¸Šçš„ä»»æ„ä¸€ä¸ªç‚¹ï¼Œå°±èƒ½çœ‹åˆ°åœ¨é‚£ä¸ªåœ°æ–¹æ‹æ‘„çš„æ‰€æœ‰ç…§ç‰‡ã€‚</p>
<p><strong>å¯è§†åŒ–ä½ çš„æ—…è¡Œè½¨è¿¹</strong>ï¼Œè®©"åœ¨å“ªå„¿å‘ç”Ÿäº†ä»€ä¹ˆ"ä¸€ç›®äº†ç„¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/062f4a4502f54c489c9aa0f717ef4ab3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yL5bGx5YWI55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769870044&amp;x-signature=lB6mWdyzgdgmwaoinqH2GaPhP%2Bc%3D" alt="æˆªå±2026-01-24 22.12.56.png" loading="lazy"/></p>
<h4 data-id="heading-6">4. ä¸€æ¬¡ä¸Šä¼ ï¼Œå¤šå¤„å¤ç”¨ï¼šç…§ç‰‡å³èµ„äº§</h4>
<p>Lightroomçš„ç…§ç‰‡ç®¡ç†æ˜¯"æ–‡ä»¶å¤¹å¼"çš„ï¼Œä¸€å¼ ç…§ç‰‡åªèƒ½åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p>æˆ‘è®¾è®¡çš„ç†å¿µæ˜¯ï¼š<strong>ç…§ç‰‡æ˜¯æ•°å­—èµ„äº§ï¼Œä¸€æ¬¡ä¸Šä¼ ï¼Œå¤šå¤„å¤ç”¨</strong>ã€‚</p>
<ul>
<li>ä¸Šä¼ åˆ°äº‘å­˜å‚¨</li>
<li>è‡ªåŠ¨æå–EXIFä¿¡æ¯ï¼ˆæ—¶é—´ã€åœ°ç‚¹ã€è®¾å¤‡ã€å‚æ•°ï¼‰</li>
<li>æ—¶é—´çº¿ã€åœ°å›¾ã€ç›¸ç°¿ã€å¹¿åœºç»Ÿä¸€å¼•ç”¨åŒä¸€ä»½èµ„æº</li>
<li>æ”¯æŒDockerè‡ªæ‰˜ç®¡ï¼Œæ•°æ®å®Œå…¨æŒæ§</li>
</ul>
<h4 data-id="heading-7">5. å…¬å…±å¹¿åœºï¼šè®©ä½œå“è¢«æ›´å¤šäººçœ‹åˆ°</h4>
<p>Lightroomæ˜¯ä¸ªäººå·¥å…·ï¼Œæˆ‘çš„å¹³å°è¿˜æœ‰<strong>å…¬å…±å¹¿åœº</strong>åŠŸèƒ½ã€‚</p>
<p>ä½ å¯ä»¥é€‰æ‹©å°†ç…§ç‰‡åˆ†äº«åˆ°å¹¿åœºï¼Œè®©å…¨çƒç”¨æˆ·çœ‹åˆ°ä½ çš„ä½œå“ã€‚ä¹Ÿå¯ä»¥åˆ›å»ºå…¬å¼€ç›¸ç°¿ï¼Œå¯¹å¤–å±•ç¤ºä½ çš„æ‘„å½±ä½œå“é›†ã€‚</p>
<p><strong>æ—¢æ˜¯ä¸ªäººå›å¿†åº“ï¼Œä¹Ÿæ˜¯ä½œå“å±•ç¤ºå¹³å°ã€‚</strong></p>
<hr/>
<h3 data-id="heading-8">æŠ€æœ¯æ ˆï¼šç”¨æœ€å‰æ²¿çš„æŠ€æœ¯ï¼Œåšæœ€å®ç”¨çš„äº§å“</h3>
<p>ä½œä¸ºä¸€ä¸ªè‰æ ¹å¼€å‘è€…ï¼Œæˆ‘æ²¡æœ‰å¤§å…¬å¸çš„èµ„æºï¼Œä½†æˆ‘æœ‰å¯¹æŠ€æœ¯çš„çƒ­çˆ±å’Œå¯¹ç”¨æˆ·éœ€æ±‚çš„ç†è§£ã€‚</p>
<h4 data-id="heading-9">æ ¸å¿ƒæŠ€æœ¯</h4>
<ul>
<li><strong>Next.js 16 + React 18</strong>ï¼šç°ä»£åŒ–çš„Webæ¡†æ¶ï¼Œæ€§èƒ½ä¼˜å¼‚</li>
<li><strong>TypeScript</strong>ï¼šç±»å‹å®‰å…¨ï¼Œä»£ç æ›´å¯é </li>
<li><strong>Prisma + PostgreSQL</strong>ï¼šå¼ºå¤§çš„æ•°æ®åº“ORMï¼Œæ•°æ®ç®¡ç†æ›´é«˜æ•ˆ</li>
<li><strong>AI SDK</strong>ï¼šé›†æˆOpenAIã€Anthropicã€OpenRouterï¼Œæ”¯æŒ400+æ¨¡å‹</li>
<li><strong>Leafletåœ°å›¾</strong>ï¼šå¼€æºåœ°å›¾åº“ï¼Œè¶³è¿¹å¯è§†åŒ–</li>
<li><strong>Dockeréƒ¨ç½²</strong>ï¼šä¸€é”®éƒ¨ç½²ï¼Œæ”¯æŒè‡ªæ‰˜ç®¡</li>
</ul>
<h4 data-id="heading-10">æŠ€æœ¯äº®ç‚¹</h4>
<ol>
<li><strong>æµå¼AIå“åº”</strong>ï¼šç…§ç‰‡ç‚¹è¯„å®æ—¶æµå¼è¾“å‡ºï¼Œä½“éªŒæµç•…</li>
<li><strong>å¤šå°ºå¯¸ç­–ç•¥</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾ã€åˆ—è¡¨å›¾ã€è¯¦æƒ…å›¾ï¼ŒèŠ‚çœå¸¦å®½</li>
<li><strong>æ··åˆå­˜å‚¨</strong>ï¼šæ”¯æŒäº‘å­˜å‚¨ï¼ˆOSS/MinIOï¼‰å’Œæœ¬åœ°å­˜å‚¨ï¼Œçµæ´»é€‰æ‹©</li>
<li><strong>PWAæ”¯æŒ</strong>ï¼šå¯ä»¥å®‰è£…åˆ°æ‰‹æœºï¼ŒåƒåŸç”ŸAppä¸€æ ·ä½¿ç”¨</li>
<li><strong>å“åº”å¼è®¾è®¡</strong>ï¼šæ‰‹æœºã€å¹³æ¿ã€ç”µè„‘ï¼Œå®Œç¾é€‚é…</li>
</ol>
<hr/>
<h3 data-id="heading-11">å¯¹æ¯”Lightroomï¼šæˆ‘ä»¬æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h3>


















































<table><thead><tr><th>åŠŸèƒ½</th><th>Adobe Lightroom</th><th>LifeFrame</th></tr></thead><tbody><tr><td><strong>ä»·æ ¼</strong></td><td>å¹´è´¹888å…ƒ</td><td>å…è´¹5GBï¼Œä»˜è´¹ç‰ˆæ›´çµæ´»</td></tr><tr><td><strong>ç…§ç‰‡ç®¡ç†</strong></td><td>æ–‡ä»¶å¤¹å¼</td><td>èµ„äº§å¼ï¼Œä¸€æ¬¡ä¸Šä¼ å¤šå¤„å¤ç”¨</td></tr><tr><td><strong>AIç‚¹è¯„</strong></td><td>âŒ æ— </td><td>âœ… å¤šAIåŠ©æ‰‹ï¼Œä¸“ä¸šç‚¹è¯„</td></tr><tr><td><strong>æ—¶é—´çº¿</strong></td><td>åŸºç¡€æ’åº</td><td>âœ… æ™ºèƒ½åˆ†ç»„ï¼Œè‡ªåŠ¨ç”Ÿæˆå›å¿†</td></tr><tr><td><strong>è¶³è¿¹åœ°å›¾</strong></td><td>âŒ æ— </td><td>âœ… å¯è§†åŒ–æ—…è¡Œè½¨è¿¹</td></tr><tr><td><strong>ä½œå“å±•ç¤º</strong></td><td>âŒ æ— </td><td>âœ… å…¬å…±å¹¿åœºï¼Œä½œå“é›†å±•ç¤º</td></tr><tr><td><strong>è‡ªæ‰˜ç®¡</strong></td><td>âŒ æ— </td><td>âœ… Dockeréƒ¨ç½²ï¼Œæ•°æ®è‡ªä¸»</td></tr><tr><td><strong>åæœŸå¤„ç†</strong></td><td>âœ… å¼ºå¤§</td><td>âŒ ä¸“æ³¨ç®¡ç†ï¼Œä¸å¤„ç†</td></tr></tbody></table>
<p><strong>æˆ‘ä»¬çš„å®šä½ä¸åŒï¼š</strong></p>
<ul>
<li><strong>Lightroom</strong>ï¼šä¸“ä¸šçš„ç…§ç‰‡åæœŸå¤„ç†å·¥å…·</li>
<li><strong>LifeFrame</strong>ï¼šæ™ºèƒ½çš„ç…§ç‰‡ç®¡ç†+å›å¿†æ•´ç†+ä½œå“å±•ç¤ºå¹³å°</li>
</ul>
<p>æˆ‘ä»¬ä¸æ˜¯è¦æ›¿ä»£Lightroomï¼Œè€Œæ˜¯è¦<strong>å¡«è¡¥å®ƒç•™ä¸‹çš„ç©ºç™½</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-12">ä»æƒ³æ³•åˆ°äº§å“ï¼šä¸€ä¸ªå¼€å‘è€…çš„å¿ƒè·¯å†ç¨‹</h3>
<p>è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»é›¶å¼€å§‹ï¼Œç”¨äº†å‡ ä¸ªæœˆæ—¶é—´ã€‚</p>
<p><strong>æœ€éš¾çš„ä¸æ˜¯å†™ä»£ç ï¼Œè€Œæ˜¯ç†è§£ç”¨æˆ·éœ€æ±‚ã€‚</strong></p>
<ul>
<li>ç”¨æˆ·çœŸçš„éœ€è¦AIç‚¹è¯„å—ï¼Ÿâ†’ æµ‹è¯•åå‘ç°ï¼Œè¿™æ˜¯æœ€å—æ¬¢è¿çš„åŠŸèƒ½</li>
<li>æ—¶é—´çº¿åº”è¯¥æ€ä¹ˆåšï¼Ÿâ†’ å‚è€ƒäº†Instagramã€Google Photosï¼Œä½†åšäº†æ›´é€‚åˆå›½äººçš„ä¼˜åŒ–</li>
<li>åœ°å›¾åŠŸèƒ½æœ‰ç”¨å—ï¼Ÿâ†’ æ—…è¡Œçˆ±å¥½è€…åé¦ˆï¼šè¿™æ˜¯æœ€é…·çš„åŠŸèƒ½</li>
</ul>
<p><strong>æœ€å¼€å¿ƒçš„æ˜¯çœ‹åˆ°ç”¨æˆ·åé¦ˆï¼š</strong></p>
<blockquote>
<p>"ç»ˆäºæœ‰ä¸€ä¸ªå·¥å…·ï¼Œèƒ½å¸®æˆ‘æ•´ç†è¿™äº›å¹´æ•£è½çš„ç…§ç‰‡äº†"</p>
<p>"AIç‚¹è¯„çœŸçš„å¾ˆä¸“ä¸šï¼Œæ¯”æˆ‘è‡ªå·±æ‘¸ç´¢å¼ºå¤šäº†"</p>
<p>"åœ°å›¾åŠŸèƒ½å¤ªæ£’äº†ï¼Œçœ‹åˆ°è‡ªå·±çš„è¶³è¿¹å¾ˆæœ‰æˆå°±æ„Ÿ"</p>
</blockquote>
<p>è¿™äº›åé¦ˆï¼Œæ˜¯æˆ‘ç»§ç»­å‰è¿›çš„åŠ¨åŠ›ã€‚</p>
<hr/>
<h3 data-id="heading-13">æœªæ¥è§„åˆ’ï¼šè®©æ›´å¤šäººå—ç›Š</h3>
<p>ç›®å‰ï¼ŒLifeFrameè¿˜åœ¨æŒç»­è¿­ä»£ä¸­ã€‚æœªæ¥è®¡åˆ’ï¼š</p>
<ol>
<li><strong>æ›´æ™ºèƒ½çš„AI</strong>ï¼šæ”¯æŒæ›´å¤šAIæ¨¡å‹ï¼Œç‚¹è¯„æ›´ç²¾å‡†</li>
<li><strong>æ›´ä¸°å¯Œçš„åŠŸèƒ½</strong>ï¼šç…§ç‰‡æ ‡ç­¾ã€æ™ºèƒ½æœç´¢ã€æ‰¹é‡æ“ä½œ</li>
<li><strong>æ›´å¥½çš„ä½“éªŒ</strong>ï¼šç§»åŠ¨ç«¯ä¼˜åŒ–ã€ç¦»çº¿æ”¯æŒ</li>
<li><strong>æ›´å¼€æ”¾çš„ç”Ÿæ€</strong>ï¼šAPIå¼€æ”¾ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹é›†æˆ</li>
</ol>
<p><strong>æœ€é‡è¦çš„æ˜¯ï¼šä¿æŒåˆå¿ƒï¼Œåšä¸€ä¸ªçœŸæ­£æœ‰ç”¨çš„äº§å“ã€‚</strong></p>
<hr/>
<h3 data-id="heading-14">å†™åœ¨æœ€åï¼šæŠ€æœ¯æ”¹å˜ç”Ÿæ´»</h3>
<p>ä½œä¸ºä¸€ä¸ªæ¥è‡ªå¿åŸçš„å¼€å‘è€…ï¼Œæˆ‘æ²¡æœ‰å¤§å…¬å¸çš„èƒŒæ™¯ï¼Œæ²¡æœ‰é›„åšçš„èµ„é‡‘ï¼Œä½†æˆ‘æœ‰ï¼š</p>
<ul>
<li><strong>å¯¹æŠ€æœ¯çš„çƒ­çˆ±</strong></li>
<li><strong>å¯¹ç”¨æˆ·éœ€æ±‚çš„ç†è§£</strong></li>
<li><strong>ç”¨AIå’Œä»£ç æ”¹å˜ç”Ÿæ´»çš„å†³å¿ƒ</strong></li>
</ul>
<p>Adobe Lightroomå¾ˆå¼ºå¤§ï¼Œä½†å®ƒä¸æ˜¯ä¸‡èƒ½çš„ã€‚æˆ‘ä»¬ç”¨AIå’Œä»£ç ï¼Œæ‰“é€ äº†ä¸€ä¸ª<strong>æ›´é€‚åˆæ™®é€šç”¨æˆ·çš„ç…§ç‰‡ç®¡ç†å¹³å°</strong>ã€‚</p>
<p><strong>è¿™ä¸æ˜¯ç¡¬åˆšï¼Œè€Œæ˜¯äº’è¡¥ã€‚</strong></p>
<p>å¦‚æœä½ ä¹Ÿå’Œæˆ‘ä¸€æ ·ï¼Œæœ‰å¤§é‡ç…§ç‰‡éœ€è¦æ•´ç†ï¼Œæƒ³è¦ä¸“ä¸šçš„AIç‚¹è¯„ï¼Œæƒ³è¦å¯è§†åŒ–çš„æ—…è¡Œè½¨è¿¹ï¼Œæƒ³è¦ä¸€ä¸ªçœŸæ­£å¥½ç”¨çš„ç…§ç‰‡ç®¡ç†å·¥å…·...</p>
<p><strong>æ¬¢è¿æ¥ä½“éªŒ LifeFrameã€‚</strong></p>
<hr/>
<p><strong>Dockeræˆ–Nasç”¨æˆ·è‡ªéƒ¨ç½²å¿«é€Ÿå¼€å§‹</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lifeframe.cloud%2Fdocs%2Fdeployment%2Fnas-quickstart" target="_blank" title="https://www.lifeframe.cloud/docs/deployment/nas-quickstart" ref="nofollow noopener noreferrer">www.lifeframe.cloud/docs/deployâ€¦</a></p>
<p><strong>æŠ€æœ¯äº¤æµ</strong>ï¼šæ¬¢è¿ç•™è¨€ï¼Œå¼€æºä»“åº“æ­£åœ¨æ•´ç†å½’æ¡£ä¸­ï¼Œæ•¬è¯·æœŸå¾…</p>
<hr/>
<p><em>"è®°å½•ç”Ÿæ´»ï¼Œç”¨AIç‚¹äº®å›å¿†ã€‚è¿™å°±æ˜¯LifeFrameçš„ä½¿å‘½ã€‚"</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ç¯‡æ–‡ç« å½»åº•ææ‡‚è¿›ç¨‹å’Œçº¿ç¨‹çš„æœ¬è´¨]]></title>    <link>https://juejin.cn/post/7598499504171253798</link>    <guid>https://juejin.cn/post/7598499504171253798</guid>    <pubDate>2026-01-24T10:53:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504171253798" data-draft-id="7598499504171237414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ç¯‡æ–‡ç« å½»åº•ææ‡‚è¿›ç¨‹å’Œçº¿ç¨‹çš„æœ¬è´¨"/> <meta itemprop="keywords" content="é¢è¯•,ç¨‹åºå‘˜,Linux"/> <meta itemprop="datePublished" content="2026-01-24T10:53:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlp666hub"/> <meta itemprop="url" content="https://juejin.cn/user/2965810860569131"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ç¯‡æ–‡ç« å½»åº•ææ‡‚è¿›ç¨‹å’Œçº¿ç¨‹çš„æœ¬è´¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965810860569131/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlp666hub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T10:53:32.000Z" title="Sat Jan 24 2026 10:53:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»20åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. å¼•è¨€</h2>
<p>åœ¨æ“ä½œç³»ç»Ÿçš„é¢è¯•é¢˜åº“ä¸­ï¼Œ<strong>è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</strong>æ— ç–‘æ˜¯å‡ºç°é¢‘ç‡æœ€é«˜çš„é—®é¢˜ä¹‹ä¸€ï¼Œå¤§å¤šæ•°äººéƒ½å¯ä»¥èƒŒå‡ºæ ‡å‡†çš„å…«è‚¡æ–‡ç­”æ¡ˆï¼š<strong>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„åŸºæœ¬å•ä½</strong>ã€‚</p>
<p>ä½†åœ¨è¿™ç®€å•çš„èƒŒè¯µç­”æ¡ˆçš„èƒŒåï¼Œæ˜¯å¦èƒ½å¤ŸçœŸæ­£ç†è§£æ“ä½œç³»ç»Ÿè®¾è®¡è¿™ä¸¤ä¸ªæ¦‚å¿µçš„åˆè¡·ï¼Ÿä¸ºä»€ä¹ˆè¿›ç¨‹åˆ‡æ¢å¾ˆæ…¢è€Œçº¿ç¨‹å¾ˆå¿«ï¼Ÿä»–ä»¬åœ¨å†…å­˜ä¸­åˆ°åº•é•¿ä»€ä¹ˆæ ·å­ï¼ŸLinux å†…æ ¸ä¸­çœŸçš„æœ‰çº¿ç¨‹å—ï¼Ÿè¿™äº›é—®é¢˜æ‰æ˜¯æœ€å…³é”®çš„å†…å®¹ã€‚</p>
<p>è¦æƒ³åœ¨é«˜å¹¶å‘ç¼–ç¨‹å’Œé¢è¯•ä¸­è„±é¢–è€Œå‡ºï¼Œæˆ‘ä»¬å°±ä¸èƒ½ä»…ä»…åœç•™åœ¨æ¦‚å¿µå±‚é¢ã€‚</p>
<p>é¦–å…ˆè®©æˆ‘ä»¬å›åˆ°æ“ä½œç³»ç»Ÿè®¾è®¡çš„åŸç‚¹ï¼Œåœ¨ç»å…¸å·¨è‘— <strong>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ (CSAPP)ã€‹</strong> çš„ç¬¬å…«ç«  <strong>â€œå¼‚å¸¸æ§åˆ¶æµâ€</strong> ä¸­ï¼Œä½œè€… Randal E. Bryant ç»™å‡ºäº†ä¸€ä¸ªæå…·æ´å¯ŸåŠ›çš„å®šä¹‰ï¼š</p>
<p><strong>â€œè¿›ç¨‹æä¾›äº†ç»™åº”ç”¨ç¨‹åºä¸¤ä¸ªå…³é”®çš„æŠ½è±¡ï¼š</strong></p>
<ol>
<li><strong>ä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘æ§åˆ¶æµï¼Œå®ƒæä¾›ä¸€ä¸ªå‡è±¡ï¼Œå¥½åƒæˆ‘ä»¬çš„ç¨‹åºç‹¬å åœ°ä½¿ç”¨å¤„ç†å™¨ã€‚</strong></li>
<li><strong>ä¸€ä¸ªç§æœ‰çš„åœ°å€ç©ºé—´ï¼Œå®ƒæä¾›ä¸€ä¸ªå‡è±¡ï¼Œå¥½åƒæˆ‘ä»¬çš„ç¨‹åºç‹¬å åœ°ä½¿ç”¨å†…å­˜ç³»ç»Ÿã€‚â€</strong></li>
</ol>
<p>è¿™å¥è¯æè¿°çš„æ­£æ˜¯è¿›ç¨‹çš„æœ¬è´¨ï¼š<strong>éš”ç¦»</strong>ã€‚æ“ä½œç³»ç»Ÿé€šè¿‡è¿›ç¨‹ï¼Œä¸ºæ¯ä¸ªç¨‹åºæ„å»ºäº†ä¸€ä¸ªä¸å¤–ç•Œéš”ç»çš„ç‹¬ç«‹ä¸–ç•Œï¼Œä¿è¯äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</p>
<p>è¿™æ ·çœ‹æ¥ï¼Œè¿›ç¨‹ç¡®å®å‘æŒ¥äº†æå¤§çš„éš”ç¦»ä½œç”¨ï¼Œé‚£ä¸ºä»€ä¹ˆåæ¥åˆå‘æ˜äº†çº¿ç¨‹å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆåœ¨äº<strong>æˆæœ¬</strong>ã€‚è¿›ç¨‹çš„ä½“é‡å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œæ¯å½“æˆ‘ä»¬æƒ³è¦å¹¶å‘æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ„å‘³ç€è¦å¤åˆ¶æ•´ä¸ªé¡µè¡¨ï¼Œç»™æ¯ä¸ªè¿›ç¨‹åˆ†é…ç‹¬ç«‹çš„å †å’Œæ ˆï¼Œå»ºç«‹æ–°çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ç­‰ç­‰ã€‚</p>
<p>è¿™å°±åƒæ˜¯ä¸ºäº†è®©ä¸¤ä¸ªå·¥äººåŒæ—¶å¹²æ´»ï¼Œç»“æœç›–äº†ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„å·¥å‚ï¼ˆè¿›ç¨‹æ˜¯éš”ç¦»çš„ï¼‰ï¼Œæ—¢æµªè´¹èµ„æºï¼ˆå¤åˆ¶å“å æ®å†…å­˜ï¼‰ï¼Œæ²Ÿé€šï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰èµ·æ¥åˆååˆ†éº»çƒ¦ã€‚</p>
<p>äºæ˜¯ï¼Œ<strong>çº¿ç¨‹</strong>è¯ç”Ÿäº†ã€‚å®ƒæ‰“ç ´äº†è¿›ç¨‹å†…éƒ¨ä¸¥æ ¼çš„å°é—­ï¼Œå…è®¸åœ¨åŒä¸€è¿›ç¨‹å†…å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œç›¸å½“äºåŒä¸€å·¥å‚å†…å­˜åœ¨å¤šä¸ªå·¥äººï¼Œä»–ä»¬å…±äº«èµ„æºï¼Œå´åˆèƒ½ç‹¬ç«‹å·¥ä½œã€‚</p>
<p>æœ¬æ–‡ä¸ä¼šå±€é™äºæ•™ç§‘ä¹¦çš„å®šä¹‰ï¼Œè€Œæ˜¯ä»å†…å­˜å¸ƒå±€ï¼Œå†…æ ¸æ•°æ®ç»“æ„ï¼Œä»¥åŠèµ„æºåˆ†é…çš„åº•å±‚è§†è§’ï¼Œå½»åº•ææ‡‚è¿›ç¨‹å’Œçº¿ç¨‹çš„æœ¬è´¨ã€‚</p>
<h2 data-id="heading-1">2. è¿›ç¨‹å’Œçº¿ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µ</h2>
<p>ç¬¬ä¸€ç« ä¸­æˆ‘ä»¬ç†è§£äº†è¿›ç¨‹çš„<strong>éš”ç¦»æ€§</strong>ã€‚ä¸ºäº†æ·±å…¥çš„ç†è§£è¿›ç¨‹ä¸çº¿ç¨‹çš„å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´ç”ŸåŠ¨çš„ç±»æ¯”æ¥å¼„æ‡‚ä»–ä»¬çš„æ ¸å¿ƒæ¦‚å¿µã€‚</p>
<p>æˆ‘ä»¬æŠŠè¿›ç¨‹çœ‹åšä¸€ä¸ªå·¥å‚ï¼Œè€ŒæŠŠçº¿ç¨‹çœ‹åšå·¥å‚é‡Œé¢çš„å·¥äººï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹æ·±å…¥ã€‚</p>
<h3 data-id="heading-2">2.1 èµ„æºåˆ†ç»„ä¸æ‰§è¡Œ</h3>
<p>åœ¨ <strong>ã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹ï¼ˆç¬¬4ç‰ˆï¼‰</strong> çš„ç¬¬ 2 ç«  <strong>â€œè¿›ç¨‹ä¸çº¿ç¨‹â€</strong> ä¸­ï¼ŒTanenbaum æ•™æˆæå‡ºäº†ä¸€ä¸ªéå¸¸ç²¾è¾Ÿçš„è§‚ç‚¹ï¼š</p>
<p><strong>â€œè¿›ç¨‹æ¨¡å‹åŸºäºä¸¤ä¸ªç‹¬ç«‹çš„æ¦‚å¿µï¼šèµ„æºåˆ†ç»„ï¼ˆResource Groupingï¼‰å’Œæ‰§è¡Œï¼ˆExecutionï¼‰ã€‚æœ‰æ—¶ï¼Œå°†è¿™ä¸¤ä¸ªæ¦‚å¿µåˆ†å¼€æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œè¿™ä¾¿æ˜¯å¼•å…¥çº¿ç¨‹çš„åŸå› ã€‚â€</strong></p>
<p>è¿™å¥è¯äº‹å®ä¸Šé˜æ˜äº†è¿›ç¨‹å’Œçº¿ç¨‹äºŒè€…çš„åˆ†å·¥ã€‚</p>
<p><strong>è¿›ç¨‹ï¼ˆèµ„æºåˆ†ç»„ï¼‰ï¼šæ˜¯èµ„æºçš„å®¹å™¨ã€‚</strong></p>
<ol>
<li>å·¥å‚å æ®çš„é‚£ç‰‡åœ°çš®ï¼Œä»£è¡¨<strong>è™šæ‹Ÿåœ°å€ç©ºé—´</strong>ï¼Œä» 0 åˆ° 4G çš„è™šæ‹Ÿå†…å­˜éƒ½å½’è¿™ä¸ªè¿›ç¨‹ç®¡ç†ã€‚</li>
<li>å·¥å‚çš„è®¾å¤‡ä¸åŸææ–™ï¼Œä»£è¡¨æ‰“å¼€çš„æ–‡ä»¶ï¼Œå­è¿›ç¨‹ï¼Œå…¨å±€å˜é‡ç­‰ã€‚</li>
<li>å‘˜å·¥ç¼–å·ï¼Œä»£è¡¨ç”¨æˆ· ID å’Œç»„ IDï¼Œè¿™æ˜¯å·¥å‚è€æ¿èƒ½å¤Ÿè¯†åˆ«æ¯ä¸ªå‘˜å·¥å’Œä»–æ‰€åœ¨éƒ¨é—¨çš„å…³é”®ã€‚ç±»æ¯”å†…æ ¸è¦é€šè¿‡ç”¨æˆ· ID å’Œç»„ IDåŒºåˆ†æ¯ä¸ªè¿›ç¨‹å’Œå®ƒæ‰€åœ¨çš„è¿›ç¨‹ç»„ã€‚</li>
</ol>
<p>åªè¦å·¥å‚å­˜åœ¨ï¼Œè¿™äº›èµ„æºå°±æ”¾åœ¨é‚£é‡Œï¼Œä¾›é‡Œé¢çš„å·¥äººä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦è¿›ç¨‹å­˜åœ¨ï¼Œè¯¥è¿›ç¨‹å†…çš„çº¿ç¨‹å°±å¯ä»¥ä½¿ç”¨è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºã€‚</p>
<p><strong>çº¿ç¨‹ï¼ˆæ‰§è¡Œï¼‰ï¼šCPU è°ƒåº¦çš„å®ä½“ã€‚</strong></p>
<ol>
<li>å·¥äººä»£è¡¨çº¿ç¨‹ã€‚ä¸€ä¸ªå·¥å‚æœ€å°‘è¦æœ‰ä¸€ä¸ªå·¥äººï¼Œä¹Ÿå¯ä»¥æœ‰å‡ åä¸ªå·¥äººåŒæ—¶å¹²æ´»ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªè¿›ç¨‹è‡³å°‘è¦æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå³ä¸»çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºã€‚</li>
<li>å·¥äººçš„è®°å¿†ï¼Œä»£è¡¨<strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong> ã€‚ä½œä¸ºä¸€ä¸ªå·¥äººï¼Œå¿…é¡»è¦çŸ¥é“è‡ªå·±çš„æ´»å¹²åˆ°å“ªä¸€æ­¥äº†ï¼Œå¯¹åº”äºçº¿ç¨‹å¿…é¡»çŸ¥é“è‡ªå·±æ‰§è¡Œåˆ°å“ªäº†ã€‚</li>
<li>å·¥äººçš„å·¥ä½œå°ï¼Œä»£è¡¨<strong>å¯„å­˜å™¨</strong>ï¼Œå­˜æ”¾çº¿ç¨‹æ­£åœ¨åŠ å·¥çš„ä¸´æ—¶æ•°æ®ã€‚</li>
<li>å·¥äººçš„ç§æœ‰æ—¥å¿—ï¼Œä»£è¡¨<strong>æ ˆ</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨çš„å‡½æ•°ä¸åŒï¼Œå±€éƒ¨å˜é‡ä¹Ÿä¸åŒï¼Œå¿…é¡»æœ‰è‡ªå·±ç§æœ‰çš„æ ˆï¼Œä¸èƒ½æ··ç”¨ã€‚</li>
</ol>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æŠŠè¿›ç¨‹å’Œçº¿ç¨‹ä»¥åŠå®ƒä»¬æœ€é‡è¦çš„å†…å®¹ç±»æ¯”ä¸ºå·¥å‚ä¸å·¥äººçš„å…³ç³»ï¼Œç›¸ä¿¡è¿™ä¸ªç±»æ¯”èƒ½å¤Ÿæå‡å¤§å®¶å¯¹å®ƒä»¬çš„ç†è§£å’ŒåŒºåˆ†ã€‚</p>
<h3 data-id="heading-3">2.2 ä¸ºä»€ä¹ˆè¯´çº¿ç¨‹æ˜¯è½»é‡çº§çš„ï¼Ÿ</h3>
<p>ç†è§£äº†ä¸Šé¢çš„ç±»æ¯”ï¼Œå¦ä¸€ä¸ªç»å…¸çš„é¢è¯•é—®é¢˜ï¼šâ€œä¸ºä»€ä¹ˆçº¿ç¨‹åˆ‡æ¢æ¯”è¿›ç¨‹å—ï¼Ÿâ€ï¼Œç­”æ¡ˆå°±æ˜¾è€Œæ˜“è§äº†ã€‚</p>
<p>ä¸‹é¢çš„ç±»æ¯”å¯èƒ½æœ‰ç‚¹ä¸ç¬¦åˆæ­£å¸¸é€»è¾‘ï¼Œè¯·åŸè°…æˆ‘æƒ³ä¸åˆ°æ›´å¥½çš„æ¯”å–»äº†ï¼Œä½†æ˜¯æˆ‘ä¼šå°½å¯èƒ½çš„æŠŠå®ƒè§£é‡Šçš„åˆç†ä¸€ç‚¹ã€‚</p>
<p><strong>è¿›ç¨‹åˆ‡æ¢ï¼š</strong></p>
<p>ç°åœ¨è¯·æƒ³è±¡ä¸€ä¸‹å·¥å‚çš„è€æ¿ä¼šé­”æ³•ï¼Œä»–åªèƒ½ç«™åœ¨ä¸€ä¸ªå›ºå®šçš„ä½ç½®æ¥ç®¡ç†å·¥å‚çš„è¿ä½œï¼Œå¿…è¦æ—¶éœ€è¦ç®¡ç†ä¸åŒçš„å·¥å‚æ¥å®Œæˆä¸åŒçš„ä»»åŠ¡ï¼Œä½†æ˜¯å®ƒçš„é­”æ³•å¯ä»¥å¸®åŠ©ä»–æ¬è¿æ•´ä¸ªå·¥å‚ã€‚å¦‚æœè¦åˆ‡æ¢è¿›ç¨‹ï¼Œå°±ç›¸å½“äºæŠŠå½“å‰çš„æ•´ä¸ªå·¥å‚æ¬èµ°ï¼ŒæŠŠå¦ä¸€ä¸ªå·¥å‚æ¬è¿‡æ¥ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æŠŠè¦æ¬èµ°çš„å·¥å‚å«åšå·¥å‚ Aï¼Œè¦æ¬è¿‡æ¥çš„å«åšå·¥å‚ Bã€‚å’Œä»–ä»¬å¯¹åº”çš„æ˜¯è¿›ç¨‹ A å’Œè¿›ç¨‹ Bã€‚</p>
<p>æ¬è¿çš„è¿‡ç¨‹ä¸­éœ€è¦åˆ‡æ¢å†…å­˜æ˜ å°„è¡¨ï¼Œåˆ·æ–° CPU çš„ç¼“å­˜ï¼Œå› ä¸ºæ¬è¿‡æ¥çš„å·¥å‚ B ä¸­çš„è®¾æ–½å’Œå·¥å‚ A å®Œå…¨ä¸åŒï¼Œå¹¶ä¸”è€æ¿éœ€è¦ä¿è¯è¿™ä¸ªå·¥å‚ B çš„çŠ¶æ€å’Œä»–ä¸Šæ¬¡ç®¡ç†å®Œæ—¶å·¥å‚ B çš„çŠ¶æ€æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤è€æ¿éœ€è¦æ¶ˆè€—å¤§é‡çš„ç²¾åŠ›å°†å·¥å‚ B ä¸­çš„è®¾æ–½æ¢å¤åˆ°å·¥å‚ B æ¬è¿‡æ¥ä¹‹å‰çš„æ ·å­ã€‚</p>
<p>è¿™å¯¹äº CPU ï¼ˆè€æ¿ï¼‰æ¥è¯´ï¼Œä¸ä»…ä»…æ˜¯ç®€å•çš„æ•°æ®æ¬è¿ï¼Œè€Œæ˜¯ä¸Šä¸‹æ–‡ç¯å¢ƒçš„å‰§çƒˆå˜åŠ¨ã€‚</p>
<p><strong>çº¿ç¨‹åˆ‡æ¢ï¼š</strong></p>
<p>å¦‚æœåªæ˜¯åˆ‡æ¢çº¿ç¨‹ï¼Œè¿™ç›¸å½“äºåœ¨å½“å‰çš„å·¥å‚é‡Œé¢æ¢ä¸€ä¸ªå·¥äººå¹²æ´»ã€‚å·¥å‚æ²¡å˜ï¼Œåœ°çš®æ²¡å˜ï¼Œé‡Œé¢çš„è®¾å¤‡ä¹Ÿæ²¡å˜ã€‚</p>
<p>å¯¹äºæ¯ä¸ªå·¥äººï¼Œä»–ä»¬åªèƒ½å®Œæˆç‰¹å®šçš„å·¥ä½œå†…å®¹ï¼Œè€æ¿éœ€è¦å…¶ä»–çš„å·¥äººå®Œæˆå¦ä¸€ä¸ªä»»åŠ¡ã€‚è¿™æ—¶ï¼Œè€æ¿åªéœ€è¦æŠŠä¸Šä¸€ä¸ªå·¥äººçš„<strong>è®°å¿†ï¼ˆPCï¼‰</strong> å’Œ<strong>ç§æœ‰æ—¥å¿—ï¼ˆæ ˆæŒ‡é’ˆï¼‰</strong> ä¿å­˜ä¸€ä¸‹ï¼Œç„¶åæ¢ä¸Šä¸‹ä¸€ä¸ªå·¥äººçš„ã€‚<strong>å†…å­˜æ˜ å°„è¡¨ä¸éœ€è¦åˆ‡æ¢ï¼Œç¼“å­˜ä¹Ÿä¸å®¹æ˜“å¤±æ•ˆ</strong>ï¼Œå› ä¸ºå¤§å®¶è®¿é—®çš„æ•°æ®å¾ˆå¤šæ˜¯å…±ç”¨çš„ã€‚</p>
<p>è¿™æ ·çœ‹èµ·æ¥å…¶å®ç›´è§‚å¤šäº†ï¼Œå¯¹äº CPU æ¥è¯´ï¼Œ<strong>è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>éœ€è¦é‡æ–°æ„å»ºè¿›ç¨‹çš„å†…å­˜æ˜ å°„è¡¨ï¼ŒCPU Cache ä¹Ÿä¼šå¤±æ•ˆï¼ŒCPU åœ¨è®¿é—®æ•°æ®æ—¶ Cache Miss çš„æ¦‚ç‡å°±ä¼šå¤§å¤§å¢åŠ ï¼Œä»è€Œå¯¼è‡´è¿›ç¨‹åˆ‡æ¢çš„è€—è´¹æ›´å¤§ã€‚</p>
<p>ç›¸æ¯”è¿›ç¨‹æ¥è¯´ï¼Œçº¿ç¨‹çš„åˆ‡æ¢è‡ªç„¶å°±æ˜¯è½»é‡çº§çš„äº†ã€‚</p>
<h3 data-id="heading-4">2.3 è¿›ç¨‹ä¸çº¿ç¨‹å…³ç³»ç¤ºæ„å›¾</h3>
<p>å¤§å®¶å¯ä»¥ç»“åˆä¸Šæ–‡ç†è§£ä¸‹é¢çš„è¿™ä¸ªç®€å•çš„ç¤ºæ„å›¾ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47a0307318424a239d4f06d54d845f6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856811&amp;x-signature=TQcM61eYrgJJd4LFyIM5qn%2Byh08%3D" alt="1. è¿›ç¨‹çº¿ç¨‹å…³ç³».png" loading="lazy"/></p>
<p>æ­£å¦‚ Tanenbaum åœ¨ä¹¦ä¸­æ‰€è¿°ï¼š <strong>â€œçº¿ç¨‹å…±äº«åŒä¸€ä¸ªåœ°å€ç©ºé—´å’Œå…¶ä»–èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚â€</strong> è¿™å°±æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹æ—¢é«˜æ•ˆåˆå±é™©çš„æ ¹æºã€‚</p>
<p>é«˜æ•ˆæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå±é™©æ˜¯å› ä¸ºï¼Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹çŸ¥é“äº†å¦ä¸€ä¸ªçº¿ç¨‹çš„æ ˆåœ°å€ï¼Œæ˜¯å¯ä»¥å¯¹å…¶åšå‡ºä¿®æ”¹çš„ï¼Œä»è€Œå¯¼è‡´ä¸¥é‡çš„åæœã€‚</p>
<h2 data-id="heading-5">3. æ·±å…¥å†…å­˜</h2>
<p>åœ¨ææ¸…æ¥šäº†è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“è¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ PIDï¼Œè¿›ç¨‹ä¼˜å…ˆçº§ï¼Œè¿›ç¨‹çŠ¶æ€ç­‰ï¼Œä»–ä»¬åˆ°åº•å­˜æ”¾åœ¨è¿›ç¨‹çš„å“ªä¸ªä½ç½®ã€‚è¿™å°±æ¶‰åŠåˆ°äº†è¿›ç¨‹çš„<strong>ç”¨æˆ·ç©ºé—´</strong>å’Œ<strong>å†…æ ¸ç©ºé—´</strong>ã€‚</p>
<h3 data-id="heading-6">3.1 å†…å­˜ä¸­çš„ä¸€é“å±éšœ</h3>
<p>åœ¨ 32 ä½ Linux ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ 4GB çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿™ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯é€šè¿‡ <strong>MMU å†…å­˜ç®¡ç†å•å…ƒ</strong>æ˜ å°„åˆ°çœŸå®ç‰©ç†å†…å­˜ä¸­çš„ã€‚ä½†è¿™é‡Œæˆ‘ä»¬åªè®²åœ¨è¿›ç¨‹è§†è§’ä¸‹çœ‹åˆ°çš„ 4GB çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚</p>
<p>è¿™ 4GB è™šæ‹Ÿåœ°å€ç©ºé—´å…¶å®å¹¶ä¸å®Œå…¨å±äºè¿›ç¨‹ï¼Œç³»ç»Ÿåœ¨è¿™ 4GB ä¸­ç”»äº†ä¸€é“å±éšœã€‚å…¶ä¸­ï¼š</p>
<p><strong>0~3GB(User Space)</strong> ï¼šè¿™æ˜¯ç»™è¿›ç¨‹è‡ªå·±ç”¨çš„ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ 2.3 èŠ‚å›¾ä¸­ç”»çš„ä»£ç æ®µï¼Œæ•°æ®æ®µï¼Œè¿˜æœ‰å †ï¼Œæ ˆç­‰ç­‰ï¼Œè¿™é‡Œçš„ä»£ç è¿è¡Œåœ¨ä½æƒé™æ¨¡å¼ Ring 3 ã€‚</p>
<p><strong>3~4GB(Kernel Space)</strong> ï¼šè¿™éƒ¨åˆ†æ˜¯ç•™ç»™æ“ä½œç³»ç»Ÿçš„ï¼Œé‡Œé¢å­˜æ”¾ç€å†…æ ¸ä»£ç ã€é©±åŠ¨ç¨‹åºï¼Œä»¥åŠæˆ‘ä»¬æœ¬ç¯‡æ–‡ç« çš„ä¸»è§’â€”â€”<strong>è¿›ç¨‹æ§åˆ¶å—PCB</strong>ã€‚è¿™é‡Œçš„ä»£ç è¿è¡Œåœ¨é«˜æƒé™æ¨¡å¼ Ring 0 ã€‚</p>
<p>è¿™é‡Œç®€å•æä¸€å˜´ï¼Œæˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œè¯¦ç»†è®²äº†ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åº•å±‚åŸç†ï¼Œå¯¹è¿™éƒ¨åˆ†å†…å®¹è¿˜ä¸å¤ªäº†è§£çš„å°ä¼™ä¼´å¯ä»¥å»çœ‹çœ‹æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ã€Šä¸€ç¯‡æ–‡ç« å½»åº•ææ‡‚ç”¨æˆ·æ€ã€å†…æ ¸æ€å’Œä¸­æ–­å¤„ç†ã€‹ã€‚</p>
<h3 data-id="heading-7">3.2 ä¸ºä»€ä¹ˆ PCB è¦æ”¾åœ¨å†…æ ¸ç©ºé—´</h3>
<p>ä¸€ä¸ªç®€å•çš„é“ç†ï¼Œè¦ææ‡‚ PCB ä¸ºä»€ä¹ˆæ”¾åœ¨å†…æ ¸ç©ºé—´ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—çŸ¥é“ PCB æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ã€‚</p>
<p>æ•™ç§‘ä¹¦ä¸Šçš„å®šä¹‰å¤§æ¦‚æ„æ€å¦‚ä¸‹ï¼šè¿›ç¨‹åˆ›å»ºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¸ºå®ƒæ–°å»ºä¸€ä¸ª PCBï¼Œå¹¶åœ¨è¿›ç¨‹ç»“æŸæ—¶åˆ é™¤ï¼ŒPCB æ˜¯è¿›ç¨‹å®ä½“çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯è¿›ç¨‹å­˜åœ¨çš„<strong>å”¯ä¸€æ ‡å¿—</strong>ã€‚</p>
<p>PCB é€šå¸¸åŒ…å«çš„å†…å®¹å¦‚ä¸‹ï¼ˆåªåˆ—ä¸¾é‡è¦çš„ï¼‰ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d1121891b43458e8b0baf89b362ea8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856811&amp;x-signature=fVkgCPguSvYpZiRHEnNZXJAkukE%3D" alt="2. PCBåŒ…å«çš„å†…å®¹.png" loading="lazy"/></p>
<p>è¿™æ ·çœ‹æ¥ï¼Œå…¶å®å¯ä»¥æŠŠè¿›ç¨‹æ§åˆ¶å— PCB çœ‹åšæ˜¯è¿›ç¨‹çš„<strong>èº«ä»½è¯</strong>ã€‚åœ¨ Linux ä¸­å®ƒå¯¹åº”çš„ç»“æ„ä½“å«åš <code>task_struct</code>ã€‚</p>
<p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœ PCB å­˜æ”¾åœ¨ç”¨æˆ·ç©ºé—´çš„å †é‡Œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p>æ¶æ„ç¨‹åºåªéœ€è¦å†™ä¸€è¡Œä»£ç ï¼ŒæŠŠè‡ªå·±çš„ <code>priority</code>ä¼˜å…ˆçº§æ”¹æˆæœ€é«˜ï¼Œæˆ–è€…æŠŠ <code>uid</code> æ”¹æˆ <code>root</code>ï¼Œé‚£æ•´ä¸ªç³»ç»Ÿä¸å°±ä¹±å¥—äº†ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>PCB å¿…é¡»å­˜åœ¨äºå†…æ ¸ç©ºé—´</strong>ã€‚ç”¨æˆ·è¿›ç¨‹æƒ³è¦ä¿®æ”¹ PCB é‡Œé¢çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è°ƒç”¨ <code>setpriority</code> ä¿®æ”¹ä¼˜å…ˆçº§ï¼Œå¿…é¡»é€šè¿‡<strong>ç³»ç»Ÿè°ƒç”¨</strong>è¯·æ±‚å†…æ ¸å¸®å¿™ä¿®æ”¹ã€‚è¿™å°±å¥½åƒä½ å»é“¶è¡Œå–é’±ï¼Œä¸èƒ½è‡ªå·±ç›´æ¥å»æ‹¿ï¼Œå¿…é¡»éš”ç€ç»ç’ƒçª—è®©æŸœå‘˜å¸®ä½ æ“ä½œã€‚</p>
<p>åˆ°æ­¤ï¼Œä¸ºä»€ä¹ˆ PCB è¦æ”¾åœ¨å†…æ ¸ç©ºé—´ï¼Ÿè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆåº”è¯¥å·²ç»æ˜¾è€Œæ˜“è§äº†å§ã€‚</p>
<h3 data-id="heading-8">3.3 Linux ä¸­çš„ task_struct</h3>
<p>ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œè¿›ç¨‹æ§åˆ¶å— PCB åœ¨ Linux ä¸­å¯¹åº”çš„ç»“æ„ä½“æ˜¯<code>task_struct</code>ã€‚ç°åœ¨è®©æˆ‘ä»¬å»çœ‹çœ‹å®ƒçœŸå®çš„æ ·è²Œï¼Œè¿™ä¸ªç»“æ„ä½“é€šå¸¸åœ¨å†…æ ¸æºç ç›®å½•<code>include/linux/sched.h</code>æ–‡ä»¶ä¸­ï¼Œåœ¨ä¸åŒçš„å†…æ ¸ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸ªç»“æ„ä½“å æ®å‡ ç™¾åˆ°ä¸Šåƒè¡Œä¸ç­‰ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘æ— æ³•å°†è¿™ä¸ªç»“æ„ä½“çš„å…¨éƒ¨å†…å®¹æ”¾å‡ºæ¥ï¼Œæˆ‘åªå°†æ¯”è¾ƒé‡è¦çš„å†…å®¹æ”¾åœ¨ä¸‹é¢ä»£ç å—ä¸­ï¼Œæœ‰éœ€æ±‚çš„ä¼™ä¼´å¯ä»¥è‡ªå·±å»ç¿»çœ‹å†…æ ¸æºç ã€‚</p>
<p><code>task_struct</code> ä¸­å‡ ä¸ªå…³é”®çš„æˆå‘˜å˜é‡å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> {</span>
 Â  Â <span class="hljs-comment">//è¿›ç¨‹æ ‡è¯†ç¬¦</span>
 Â  Â <span class="hljs-type">pid_t</span> pid; Â <span class="hljs-comment">//è¿›ç¨‹ID</span>
 Â  Â <span class="hljs-type">pid_t</span> tgid; <span class="hljs-comment">//çº¿ç¨‹ç»„ID</span>
â€‹
 Â  Â <span class="hljs-comment">//è¿›ç¨‹çŠ¶æ€</span>
 Â  Â <span class="hljs-type">long</span> state; Â  <span class="hljs-comment">//è¿è¡Œã€ç¡çœ ã€åƒµå°¸ç­‰çŠ¶æ€</span>
â€‹
 Â  Â <span class="hljs-comment">//è¿›ç¨‹è°ƒåº¦ä¿¡æ¯</span>
 Â  Â <span class="hljs-type">int</span> prio; Â  Â  Â  <span class="hljs-comment">//ä¼˜å…ˆçº§</span>
 Â  Â <span class="hljs-type">int</span> static_prio; Â  Â <span class="hljs-comment">//é™æ€ä¼˜å…ˆçº§</span>
 Â  Â 
 Â  Â <span class="hljs-comment">//å†…å­˜ç®¡ç†ä¿¡æ¯(è¿™å°±æ˜¯æŒ‡å‘ç”¨æˆ·ç©ºé—´ 0-3G çš„æŒ‡é’ˆ)</span>
 Â  Â <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span>;</span> Â 
â€‹
 Â  Â <span class="hljs-comment">//æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯</span>
 Â  Â <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">files_struct</span> *<span class="hljs-title">files</span>;</span> <span class="hljs-comment">//æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦è¡¨</span>
â€‹
 Â  Â <span class="hljs-comment">//...çœç•¥å…¶ä»–å‡ ç™¾ä¸ªå­—æ®µ...</span>
};
</code></pre>
<p>å¤§å®¶å¯èƒ½æ³¨æ„åˆ°<code>tgid</code>ï¼ˆçº¿ç¨‹ç»„IDï¼‰è¿™ä¸ªå­—æ®µï¼Œä¸ºä»€ä¹ˆä¼šæœ‰çº¿ç¨‹ç»„ï¼Ÿè¿™å…¶å®æ­ç¤ºäº† Linux ä¸­çº¿ç¨‹çš„çœŸé¢ç›®ï¼Œæˆ‘ä»¬å°†åœ¨åç»­ç« èŠ‚è¯¦ç»†æ­ç§˜ã€‚</p>
<p>æ­¤å¤–ï¼Œå‰©ä¸‹çš„éƒ½æ˜¯é‡è¦çš„ä¸€äº›æˆå‘˜ï¼Œå®ƒä»¬çš„ä½œç”¨åœ¨ä¸Šæ–‡ä¸­æˆ–å¤šæˆ–å°‘éƒ½è®²è¿‡ä¸€äº›ï¼Œå¹¶ä¸”é™„ä¸Šäº†æ¯”è¾ƒè¯¦ç»†çš„æ³¨é‡Šï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p>
<h3 data-id="heading-9">3.4 é‡ç‚¹ï¼šmm_struct</h3>
<p>è¯·æ³¨æ„ä¸Šé¢ä»£ç å—ä¸­çš„<code>struct mm_struct *mm</code>ï¼Œè¿›ç¨‹æ§åˆ¶å—<strong>PCB (task_struct)</strong> å­˜æ”¾åœ¨<strong>å†…æ ¸ç©ºé—´</strong>ï¼Œè€Œ<code>task_struct</code>ä¸­çš„ <strong>mm æŒ‡é’ˆ</strong> æŒ‡å‘çš„ç»“æ„ä½“æè¿°äº†<strong>ç”¨æˆ·ç©ºé—´</strong>çš„å¸ƒå±€ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å†…æ ¸é€šè¿‡ä½äºé«˜åœ°å€å†…æ ¸ç©ºé—´çš„ PCBï¼ŒæŒæ¡äº†ä½äºä½åœ°å€ç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹æ‰€æœ‰èµ„æº</strong>ã€‚</p>
<h2 data-id="heading-10">4. å…±äº«ä¸ç‹¬äº«</h2>
<p>åœ¨ç†è§£äº†å†…æ ¸é€šè¿‡ <code>mm_struct</code> æŒ‡é’ˆç®¡ç†ç”¨æˆ·ç©ºé—´åï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥ï¼š<strong>å½“ä¸€ä¸ªè¿›ç¨‹ä¸­å­˜åœ¨å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œè¿™ 4GB çš„è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯å¦‚ä½•åˆ†é…çš„ï¼Ÿ</strong></p>
<h3 data-id="heading-11">4.1 æ ¸å¿ƒå¯¹æ¯”è¡¨æ ¼</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†æœ€å¸¸è§çš„èµ„æºå½’å±åšä¸€ä¸ªæ¸…æ™°çš„åˆ†ç±»ï¼Œå¹¶å¯¹æ¯ç§èµ„æºåšäº†ç®€å•çš„è¯´æ˜ï¼Œå¦‚ä¸‹è¡¨ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4d5ec7e09d54707ad64d255474000e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856811&amp;x-signature=J9awrjiKCOnNl2OZmTeFurEkBRo%3D" alt="3. èµ„æºè¡¨.png" loading="lazy"/></p>
<h3 data-id="heading-12">4.2 ä¸ºä»€ä¹ˆå †æ˜¯å…±äº«çš„</h3>
<p><strong>å †ï¼ˆHeapï¼‰</strong> æ˜¯è¿›ç¨‹ä¸­æœ€å¤§çš„ä¸€å—åŠ¨æ€å†…å­˜åŒºåŸŸï¼Œè®¾è®¡å †åˆè¡·å°±æ˜¯ä¸ºäº†å­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„æ•°æ®ã€‚</p>
<p>çº¿ç¨‹ä¹‹é—´é€šä¿¡æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯é€šè¿‡å †ï¼Œæ¯”å¦‚ä¸»çº¿ç¨‹ <code>malloc</code> äº†ä¸€å—ç¼“å†²åŒºï¼Œç„¶åæŠŠæŒ‡é’ˆä¼ ç»™å·¥ä½œçº¿ç¨‹ï¼Œå·¥ä½œçº¿ç¨‹æ‹¿åˆ°æŒ‡é’ˆåå°±èƒ½ç›´æ¥å¤„ç†æ•°æ®ï¼Œ<strong>æ— éœ€ä»»ä½•æ•°æ®æ‹·è´</strong>ã€‚</p>
<p>ä½†æ˜¯ç›¸åº”çš„ï¼Œå †å¸¦æ¥äº†æ–¹ä¾¿çš„åŒæ—¶ï¼Œä¹Ÿå­˜åœ¨ç€ä¸€äº›é—®é¢˜ï¼šæ—¢ç„¶æ‰€ä»¥çº¿ç¨‹éƒ½èƒ½é€šè¿‡æŒ‡é’ˆéšæ„è®¿é—®ï¼Œé‚£å°±å­˜åœ¨<strong>å¹¶å‘ç«äº‰</strong>çš„é—®é¢˜ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­éœ€è¦<strong>é”ï¼ˆLockï¼‰ï¼Œä¿¡å·é‡ï¼ˆSemaphoreï¼‰</strong> ç­‰åŒæ­¥æœºåˆ¶çš„åŸå› ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€å—å †å†…å­˜å¯¼è‡´æ•°æ®é”™ä¹±ã€‚</p>
<h3 data-id="heading-13">4.3 ä¸ºä»€ä¹ˆæ ˆæ˜¯ç‹¬äº«çš„</h3>
<p>è¿™æ˜¯æœ¬ç« æœ€æ ¸å¿ƒçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆçº¿ç¨‹ä¸èƒ½åƒå…±äº«å †ä¸€æ ·å…±äº«æ ˆï¼Ÿ</p>
<p><strong>æ ˆ</strong>çš„ä¸»è¦ä½œç”¨æ˜¯è®°å½•<strong>å‡½æ•°è°ƒç”¨é“¾</strong>ï¼Œå®ƒä¿å­˜äº†ï¼šå‡½æ•°çš„<strong>å±€éƒ¨å˜é‡</strong>ï¼Œå‡½æ•°çš„<strong>è¾“å…¥å‚æ•°</strong>å’Œ<strong>å‡½æ•°çš„è¿”å›åœ°å€</strong>ã€‚</p>
<p><strong>CPU åˆ‡æ¢çº¿ç¨‹æ—¶ï¼Œä¼šä¿å­˜å¯„å­˜å™¨ï¼ˆåŒ…æ‹¬æ ˆæŒ‡é’ˆ SPï¼‰ï¼Œä½†ä¸ä¼šæ¸…ç©ºå†…å­˜</strong>ã€‚</p>
<p>ä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾çº¿ç¨‹ A å’Œçº¿ç¨‹ B å…±ç”¨ä¸€ä¸ªæ ˆï¼š</p>
<ol>
<li>çº¿ç¨‹ A æ‰§è¡Œ <code>funcA()</code>ï¼Œå®ƒå¾€æ ˆé‡Œå‹å…¥äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ <code>int x = 10</code>ï¼Œæ­¤æ—¶æ ˆæŒ‡é’ˆæŒ‡å‘ <code>0x1FF0</code>ï¼Œè¯¥ä½ç½®å­˜æ”¾ç€æ•°æ® 10ï¼Œè¿™æ—¶å‘ç”Ÿç³»ç»Ÿå‘ç”Ÿ<strong>ä¸­æ–­</strong>ï¼Œåˆ‡æ¢åˆ°çº¿ç¨‹ Bï¼Œ æ“ä½œç³»ç»ŸæŠŠçº¿ç¨‹ A çš„<strong>æ ˆæŒ‡é’ˆ SP (0x1FF0)</strong> ä¿å­˜åˆ°è¿›ç¨‹æ§åˆ¶å— PCB é‡Œã€‚</li>
<li>ç„¶åçº¿ç¨‹ B å¼€å§‹è¿è¡Œï¼Œå› ä¸ºå®ƒå’Œ A å…±äº«æ ˆç©ºé—´ï¼Œè€Œä¸”å®ƒä¹Ÿæ˜¯åˆšå¯åŠ¨æˆ–è€…åˆšè°ƒç”¨å‡½æ•°ï¼Œéœ€è¦ç”¨æ ˆï¼Œçº¿ç¨‹ B ä¹Ÿå¾€æ ˆé‡Œå‹å…¥äº†ä¸€ä¸ªè‡ªå·±çš„å±€éƒ¨å˜é‡ <code>int y = 999</code>ï¼Œä½†æ˜¯çº¿ç¨‹ B å¹¶ä¸çŸ¥é“åœ°å€ <code>0x1FF0</code> æ˜¯ A çš„æ•°æ®ï¼Œç»“æœå°±æ˜¯çº¿ç¨‹ B æŠŠ 999 å†™åˆ°äº† <code>0x1FF0</code> è¿™ä¸ªä½ç½®ï¼Œ<strong>çº¿ç¨‹ A çš„æ•°æ®</strong> <strong>10</strong> <strong>è¢«è¦†ç›–æˆäº†</strong> <strong>999</strong>ã€‚</li>
<li>åˆ‡å›çº¿ç¨‹ Aï¼Œæ“ä½œç³»ç»Ÿæ¢å¤çº¿ç¨‹ A çš„ä¸Šä¸‹æ–‡ï¼ŒSP æ¢å¤æˆäº† <code>0x1FF0</code>ï¼Œçº¿ç¨‹ A å»è¯»å– 0x1FF0 çš„æ•°æ®ï¼Œç»“æœè¯»å‡ºæ¥æ˜¯ 999ï¼Œå‘ç”Ÿé”™è¯¯ã€‚</li>
</ol>
<p>å¦‚æœæ˜¯å‡½æ•°è°ƒç”¨é“¾æ›´æ·±çš„æƒ…å†µï¼Œè¢«è¦†ç›–çš„å°±ä¸ä»…ä»…æ˜¯å±€éƒ¨å˜é‡ï¼Œè€Œæ˜¯<strong>å‡½æ•°çš„è¿”å›åœ°å€</strong>ï¼Œå½“ CPU è·³è½¬åˆ°æŸä¸ªéšæœºåœ°å€æ—¶ï¼Œä¼šå¯¼è‡´<strong>éæ³•æŒ‡ä»¤è®¿é—®ï¼ˆSegfaultï¼‰</strong> ï¼Œç¨‹åºç›´æ¥å´©æºƒã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>æ¯ä¸ªçº¿ç¨‹å¿…é¡»æœ‰ä¸€å—å±äºè‡ªå·±çš„ã€åˆ«äººä¸ä¼šç¢°çš„æ ˆå†…å­˜åŒºåŸŸ</strong>ï¼Œè¿™æ ·å³ä½¿ CPU åˆ‡æ¢ï¼Œå†…å­˜é‡Œçš„æ•°æ®ä¾ç„¶å¾…åœ¨é‚£é‡Œï¼Œç­‰å¾…çº¿ç¨‹å†æ¬¡è¢«è°ƒåº¦ã€‚</p>
<h3 data-id="heading-14">4.4 çº¿ç¨‹ç§æœ‰çš„çœŸç›¸</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ç°åœ¨æ­£åœ¨é¢è¯•ï¼Œé¢è¯•å®˜è®©ä½ è®²ä¸€ä¸‹<strong>çº¿ç¨‹ç§æœ‰</strong>çš„ç»†èŠ‚ï¼Œä½ èƒ½æƒ³åˆ°çš„æœ€å…³é”®çš„ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>äº‹å®ä¸Šï¼Œçº¿ç¨‹ç§æœ‰å¹¶ä¸æ˜¯ç»å¯¹çš„ç§æœ‰ï¼Œè€Œæ˜¯<strong>é€»è¾‘ä¸Šç§æœ‰ï¼Œç‰©ç†ä¸Šä¸ç§æœ‰</strong>ã€‚</p>
<p>å›å¿†ä¸€ä¸‹æˆ‘ä»¬åœ¨ç¬¬ä¸‰ç« è®²çš„ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ª <code>mm_struct</code>ï¼Œæ„å‘³ç€å®ƒä»¬å…±äº«åŒä¸€ä¸ª<strong>é¡µè¡¨</strong>ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´<strong>åªè¦çŸ¥é“åœ°å€ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®</strong>ã€‚è™½ç„¶æ ˆæ˜¯åˆ†é…ç»™çº¿ç¨‹ A ä¸“ç”¨çš„ï¼Œä½†å¦‚æœçº¿ç¨‹ A æŠŠå®ƒæ ˆä¸Šçš„ä¸€ä¸ªå±€éƒ¨å˜é‡çš„<strong>åœ°å€</strong>ä¼ ç»™äº†çº¿ç¨‹ Bï¼Œçº¿ç¨‹ B <strong>å®Œå…¨å¯ä»¥</strong>è¯»å†™è¿™ä¸ªåœ°å€ã€‚</p>
<p>è¯·çœ‹ä¸‹é¢ä¼ªä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span>* <span class="hljs-title function_">thread_A_func</span><span class="hljs-params">(<span class="hljs-type">void</span>* arg)</span> 
{
 Â  Â <span class="hljs-type">int</span> local_var = <span class="hljs-number">100</span>; <span class="hljs-comment">//è¿™é‡Œçš„å˜é‡åœ¨çº¿ç¨‹ A çš„æ ˆä¸Š</span>
 Â  Â 
 Â  Â <span class="hljs-comment">//æŠŠæ ˆä¸Šå˜é‡çš„åœ°å€ä¼ ç»™å…¨å±€æŒ‡é’ˆï¼Œè®©çº¿ç¨‹ B çœ‹åˆ°</span>
 Â  Â global_ptr = &amp;local_var; 
 Â  Â 
 Â  Â sleep(<span class="hljs-number">5</span>); <span class="hljs-comment">//ç­‰å¾…çº¿ç¨‹ B ä¿®æ”¹</span>
 Â  Â <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, local_var); <span class="hljs-comment">//å¦‚æœçº¿ç¨‹ B æ”¹äº†ï¼Œè¿™é‡Œçš„å€¼å°±ä¸æ˜¯100äº†</span>
}
</code></pre>
<p>è¿™ç§æ“ä½œè™½ç„¶æŠ€æœ¯ä¸Šå¯è¡Œï¼Œä½†æå…¶å±é™©ï¼Œæ¯”å¦‚çº¿ç¨‹ A å‡½æ•°è¿”å›äº†ï¼Œä¸“ç”¨æ ˆå°±ä¼šè¢«é”€æ¯ï¼Œä½†æ­¤æ—¶çº¿ç¨‹ B è¿˜åœ¨è®¿é—®ï¼Œå°±ä¼šå¯¼è‡´å‘ç”Ÿé”™è¯¯ã€‚ä½†è¿™ç§æ–¹æ³•åœ¨æŸäº›é«˜æ€§èƒ½é€šä¿¡åœºæ™¯ä¸‹ç¡®å®ä¼šè¢«ç”¨åˆ°ã€‚</p>
<h2 data-id="heading-15">5. Linux å†…æ ¸ä¸­çš„è¿›ç¨‹å’Œçº¿ç¨‹</h2>
<p>è¯»å®Œå‰é¢çš„å†…å®¹ï¼Œå¤§å®¶å¯èƒ½ä¼šè§‰å¾—è¿›ç¨‹å’Œçº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿé‡Œé¢æ˜¯ä¸¤ä¸ªä¸åŒçš„ç‰©ç§ã€‚</p>
<p>ä½†åœ¨ Linux å†…æ ¸ä¸­ï¼Œäº‹æƒ…å®Œå…¨ä¸æ˜¯è¿™æ ·çš„ã€‚<strong>åœ¨ Linux å†…æ ¸ä¸­ï¼Œå…¶å®å¹¶æ²¡æœ‰ç‹¬ç«‹çš„â€œçº¿ç¨‹â€è¿™ä¸ªæ¦‚å¿µ</strong>ã€‚</p>
<p>å¤§å®¶å¯èƒ½ä¼šè§‰å¾—å¾ˆæƒŠè®¶ï¼Œé‚£æˆ‘åœ¨ä»£ç é‡Œå†™çš„ <code>pthread_create</code> åˆæ˜¯ä¸ªä»€ä¹ˆé¬¼ï¼Ÿ</p>
<p>ä¸‹é¢è®©æˆ‘ä»¬æ·±å…¥å†…æ ¸ï¼Œææ‡‚å®ƒã€‚</p>
<h3 data-id="heading-16">5.1 è½»é‡çº§è¿›ç¨‹</h3>
<p>åœ¨ Windows æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„ç¡®æ˜¯ä¸¤ç§ä¸åŒçš„å†…æ ¸æ•°æ®ç»“æ„ï¼Œå†…æ ¸é‡Œé¢æœ‰<strong>è¿›ç¨‹è¡¨</strong>ï¼Œä¹Ÿæœ‰<strong>çº¿ç¨‹è¡¨</strong>ã€‚</p>
<p>ä½†åœ¨ Linux æ“ä½œç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰çš„æ‰§è¡Œå®ä½“ï¼Œæ— è®ºæ˜¯è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹ï¼Œéƒ½åªæ˜¯ä¸€ç§ <strong>æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼Œå®ƒä»¬åœ¨å†…æ ¸ä¸­éƒ½ç”¨åŒä¸€ä¸ªç»“æ„ä½“æ¥è¡¨ç¤ºï¼Œå°±æ˜¯å‰é¢æˆ‘ä»¬è®²è¿‡çš„ <strong><code>task_struct</code></strong>ã€‚</p>
<p>Linux æŠŠçº¿ç¨‹çœ‹ä½œæ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿›ç¨‹ï¼š</p>
<p>é€šå¸¸æˆ‘ä»¬è¯´çš„<strong>è¿›ç¨‹</strong>æ˜¯èµ„æºç‹¬äº«çš„æ‰§è¡Œå®ä½“ï¼Œ<strong>çº¿ç¨‹</strong>æ˜¯<strong>ä¸å…¶ä»–è¿›ç¨‹å…±äº«åœ°å€ç©ºé—´</strong>çš„æ‰§è¡Œå®ä½“ã€‚</p>
<p>è¿™ç§çº¿ç¨‹ä½œä¸ºç‰¹æ®Šçš„è¿›ç¨‹ï¼Œåœ¨ Linux ä¸­æœ‰ä¸€ä¸ªå­¦æœ¯åç§°ï¼Œå«åš<strong>è½»é‡çº§è¿›ç¨‹</strong>ã€‚</p>
<h3 data-id="heading-17">5.2 fork å’Œ pthread_create æ®Šé€”åŒå½’</h3>
<p>ä¸Šé¢æˆ‘ä»¬è®²åˆ°äº†çº¿ç¨‹å…¶å®æ˜¯è½»é‡çº§è¿›ç¨‹ï¼Œä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åˆ›å»ºè¿›ç¨‹å’Œçº¿ç¨‹çš„åº•å±‚åŠ¨ä½œã€‚</p>
<p>æ— è®ºæ˜¯ä½¿ç”¨<code>fork</code>åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œè¿˜æ˜¯ä½¿ç”¨<code>pthread_create</code>åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåœ¨ Linux å†…æ ¸åº•å±‚ï¼Œæœ€ç»ˆè°ƒç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªæ ¸å¿ƒå‡½æ•°ï¼š<code>kernel_clone()</code>ã€‚</p>
<p>å®ƒä»¬çš„åŒºåˆ«ä»…ä»…åœ¨äºä¼ ç»™ <code>kernel_clone()</code> çš„å‚æ•°ä¸åŒã€‚</p>
<h4 data-id="heading-18">5.2.1 fork åˆ›å»ºè¿›ç¨‹</h4>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹æœ€ç†Ÿæ‚‰çš„ <code>fork</code>ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ <code>fork()</code> æ—¶ï¼Œå®ƒåœ¨å†…æ ¸ä¸­å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨æ˜¯ <code>sys_fork</code>ï¼Œç›¸åº”çš„å†…æ ¸æºç å¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10138eeb998049229cca7994c6b9ee8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856811&amp;x-signature=Kw7elAFbM14yTyjNu315Jo8dvpY%3D" alt="4. sys_forkæºç .png" loading="lazy"/></p>
<p>å®ƒæ„å»ºäº†ä¸€ä¸ª <code>kernel_clone_args</code> å‚æ•°ç»“æ„ä½“ï¼Œ<strong>æ²¡æœ‰</strong>è®¾ç½® <code>CLONE_VM</code>ã€<code>CLONE_FILES</code> ç­‰å…±äº«æ ‡å¿—ï¼Œåªåˆå§‹åŒ–äº†ä¸€ä¸ªå­—æ®µï¼Œå°±æ˜¯<code>.exit_signal = SIGCHLD</code>ï¼Œè¡¨ç¤ºå­è¿›ç¨‹é€€å‡ºæ—¶ï¼Œå‘çˆ¶è¿›ç¨‹å‘é€ <code>SIGCHLD</code> ä¿¡å·ï¼Œè¿™æ˜¯ä¼ ç»Ÿ <code>fork</code> çš„æ ‡å‡†è¡Œä¸ºï¼Œçˆ¶è¿›ç¨‹å¯ä»¥ç”¨ <code>wait()</code> æ•è·è¿™ä¸ªä¿¡å·ã€‚</p>
<p><code>kernel_clone(&amp;args)</code>æ˜¯çœŸæ­£æ‰§è¡Œäº†<strong>è¿›ç¨‹çš„åˆ›å»ºå·¥ä½œ</strong>ï¼Œè¿™é‡Œä¼ çš„ <code>args</code> åªè®¾ç½®äº† <code>exit_signal</code>ï¼Œå…¶ä»–å­—æ®µé»˜è®¤ 0ã€‚ç›¸å½“äºåˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å­è¿›ç¨‹ï¼Œä¸å…±äº«è™šæ‹Ÿå†…å­˜ï¼Œä¸å…±äº«æ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·å¤„ç†ç­‰ç­‰ã€‚è¿™å°±æ˜¯ç»å…¸çš„ <code>fork()</code>ï¼Œå­è¿›ç¨‹å¤åˆ¶çˆ¶è¿›ç¨‹çš„å…¨éƒ¨åœ°å€ç©ºé—´ã€èµ„æºï¼Œä½†çˆ¶å­å®Œå…¨ç‹¬ç«‹ã€‚</p>
<h4 data-id="heading-19">5.2.2 å†³å®šæ˜¯è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹çš„ Flags</h4>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿å†³å®šäº†åˆ›å»ºçš„æ˜¯è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹ã€‚ç­”æ¡ˆå°±åœ¨ä¼ ç»™å†…æ ¸çš„ <strong>Flags</strong> é‡Œï¼Œè¿™éƒ¨åˆ†å†…å®¹ä½äºå†…æ ¸æºç ç›®å½•<code>include/uapi/linux/sched.h</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb2f868c747e489984000a51e56303f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856811&amp;x-signature=4RQI8o87Ze9J%2BgJZezyZVG6ntiw%3D" alt="5. flagså‚æ•°.png" loading="lazy"/></p>
<p>æ˜¯ä¸æ˜¯å¾ˆå¤šï¼Ÿçœ‹çš„çœ¼ç›éƒ½èŠ±äº†ï¼Œä½†å…¶å®çœŸæ­£ç”¨åˆ°çš„è¿œæ²¡è¿™ä¹ˆå¤šã€‚è¿™äº›å®å®šä¹‰å°±æ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥åŒºåˆ†<strong>éš”ç¦»</strong>è¿˜æ˜¯<strong>å…±äº«</strong>çš„ã€‚ç®€å•è®²å‡ ä¸ªé‡è¦çš„ï¼š</p>
<ol>
<li><code>CLONE_VM</code>ï¼šå®ƒçš„ä½œç”¨æ˜¯<strong>å…±äº«è™šæ‹Ÿå†…å­˜</strong>ï¼Œçˆ¶å­ä»»åŠ¡å®Œå…¨å…±äº«åŒä¸€å—å†…å­˜ï¼Œè¿™æ˜¯çº¿ç¨‹æœ€æ ¹æœ¬çš„ä¸œè¥¿ï¼Œæ²¡æœ‰å®ƒå°±ä¸æ˜¯çº¿ç¨‹ï¼Œè€Œæ˜¯ç‹¬ç«‹è¿›ç¨‹ã€‚</li>
<li><code>CLONE_FS</code>ï¼šä½œç”¨æ˜¯<strong>å…±äº«æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯</strong>ï¼Œçº¿ç¨‹é€šå¸¸æ˜¯å…±äº«å·¥ä½œç›®å½•çš„ã€‚</li>
<li><code>CLONE_FILES</code>ï¼šå…±äº«æ‰“å¼€çš„<strong>æ–‡ä»¶æè¿°ç¬¦è¡¨</strong>ï¼Œæ‰€æœ‰ <code>open()</code> çš„æ–‡ä»¶åœ¨æ–°ä»»åŠ¡ä¸­ä¿æŒç›¸åŒ <code>fd</code> ã€‚</li>
<li><code>CLONE_SIGHAND</code>ï¼šå…±äº«<strong>ä¿¡å·å¤„ç†ç¨‹åº</strong>å’Œ<strong>é˜»å¡ä¿¡å·æ©ç </strong>ã€‚ä¸€ä¸ªçº¿ç¨‹æ”¶åˆ° <code>SIGSEGV</code> æ•´ä¸ªè¿›ç¨‹éƒ½ä¼šå´©æºƒã€‚</li>
<li><code>CLONE_THREAD</code>ï¼šè¡¨ç¤ºæŠŠæ–°ä»»åŠ¡æ”¾å…¥<strong>åŒä¸€çº¿ç¨‹ç»„</strong>ï¼Œè¿™æ˜¯ Linux å®ç°çº¿ç¨‹ç»„çš„å…³é”®ï¼Œåœ¨ <code>ps/top/htop</code> é‡Œæ˜¾ç¤ºä¸ºåŒä¸€è¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹ã€‚</li>
</ol>
<h4 data-id="heading-20">5.2.3 pthread_create åˆ›å»ºçº¿ç¨‹</h4>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ <code>pthread_create</code> æ˜¯æ€ä¹ˆåšçš„ã€‚ç›´æ¥ç¿»å¼€ <strong>Glibc</strong> åº“çš„æºç <code>nptl/pthread_create.c</code>ï¼Œçœ‹çœ‹ <code>pthread_create</code> åˆ°åº•åšäº†ä»€ä¹ˆã€‚</p>
<p>çº¿ç¨‹ä¸æ˜¯ç”±å†…æ ¸ç›´æ¥æä¾›çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ˜¯ç”± <code>GLIBC</code> åº“å°è£…çš„ï¼Œå½“ä½ åœ¨ä»£ç ä¸­è°ƒç”¨ <code>pthread_create</code> æ—¶ï¼Œ<code>GLIBC</code> å†…éƒ¨ä¼šå¯¹åº”åˆ° <code>__pthread_create_2_1</code>è¿™ä¸ªå‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°å†…éƒ¨åˆè°ƒç”¨äº† <code>create_thread</code>ï¼Œ<code>create_thread</code>å‡½æ•°è¿˜æ˜¯æ¯”è¾ƒé•¿çš„ï¼Œæˆ‘ä»¬åªéœ€è¦çœ‹çœ‹å…³é”®éƒ¨åˆ†ã€‚</p>
<p><code>create_thread</code>å‡½æ•°å†…éƒ¨æ„é€ äº†ä¸€ä¸ªåªè¯»å˜é‡ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e152a12a4e14825ad70fbede5f8fab5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856811&amp;x-signature=OBS2mV7mtW1AiEyahhsw6JaXJ2c%3D" alt="6. flagsç»“æ„ä½“.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨çš„éƒ½æ˜¯æˆ‘ä»¬ä¸Šé¢è®²è¿‡çš„é‚£äº›å®ï¼Œè¿™äº›å®ç²¾ç¡®å¯¹åº”äº†æˆ‘ä»¬ä¹‹å‰æåˆ°çš„<strong>èµ„æºå…±äº«</strong>æ¦‚å¿µã€‚<code>GLIBC</code>åœ¨è¿›è¡Œç³»ç»Ÿè°ƒç”¨ä¹‹å‰ï¼Œç¡¬ç¼–ç äº†ä¸€ç»„ <strong><code>Flags</code></strong>ï¼Œç”¨äºè®¾å®šè¦åˆ›å»ºçº¿ç¨‹çš„ä¸€äº›ç‰¹æ€§ï¼Œ<strong>è¿™äº› Flags æœ€ç»ˆéƒ½ä¼šè¢«åŸå°ä¸åŠ¨åœ°ä¼ é€’ç»™ Linux å†…æ ¸</strong>ã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da9237b4d3c9455c87b7afdf332bb296~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769856811&amp;x-signature=nPg5ZK5JapHS8DfTWdc0Q%2B8EpXc%3D" alt="7. ä¼ å‚æ•°.png" loading="lazy"/></p>
<p>è¿™éƒ¨åˆ†å†…å®¹å°†ä¸Šé¢çš„åªè¯»å˜é‡<code>clone_flags</code>ä¼ ç»™<code>struct clone_args</code>ç±»å‹çš„ç»“æ„ä½“<code>args</code>çš„<code>flags</code>æˆå‘˜ã€‚æœ€ç»ˆå†å°†<code>args</code>ç»“æ„ä½“çš„åœ°å€ä¼ ç»™ä¸€ä¸ªåä¸º<code>__clone_internal</code>çš„å‡½æ•°ã€‚</p>
<p>åœ¨è¿™ä¸ª<code>__clone_internal</code>å‡½æ•°ä¸­ï¼Œ<code>GLIBC</code> ä¼šæ ¹æ®å½“å‰ Linux å†…æ ¸çš„ç‰ˆæœ¬ï¼Œæ™ºèƒ½é€‰æ‹©è°ƒç”¨æ–°çš„ <code>clone3</code> æ¥å£è¿˜æ˜¯è€çš„ <code>clone</code> æ¥å£ï¼Œä½†æ— è®ºèµ°å“ªæ¡è·¯ï¼Œ<strong>æœ€ç»ˆéƒ½ä¼šé€šè¿‡æ±‡ç¼–æŒ‡ä»¤</strong> <strong>syscall</strong> <strong>é™·å…¥å†…æ ¸</strong>ï¼Œå¹¶å°†é‚£äº›æ ‡å¿—ä½ä¼ é€’ç»™ Linux å†…æ ¸ï¼Œè‡³æ­¤ï¼Œçº¿ç¨‹åˆ›å»ºçš„é—­ç¯å®Œæˆäº†ã€‚</p>
<h2 data-id="heading-21">6. æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“</h2>
<p>åœ¨å®è§‚å±‚é¢ï¼šè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</p>
<p>åœ¨å†…å­˜å±‚é¢ï¼š<code>task_struct</code>ä½äºå†…æ ¸ç©ºé—´ã€‚ä»£ç ã€æ•°æ®ã€å †ã€æ–‡ä»¶æ˜¯å…±äº«çš„ï¼Œä½äºç”¨æˆ·ç©ºé—´ï¼Œæ ˆæ˜¯ç§æœ‰çš„ã€‚</p>
<p>åœ¨å†…æ ¸å±‚é¢ï¼šLinux å†…æ ¸ä¸­æ²¡æœ‰çº¿ç¨‹ä¹‹è¯´ï¼Œåªæœ‰ <code>task_struct</code>ï¼Œçº¿ç¨‹æœ¬è´¨ä¸Šæ˜¯ <code>clone</code> ç³»ç»Ÿè°ƒç”¨åŠ ä¸Š <code>CLONE_VM</code> ç­‰å…±äº«æ ‡å¿—åˆ›å»ºå‡ºæ¥çš„<strong>è½»é‡çº§è¿›ç¨‹</strong>ã€‚</p>
<p>åˆ°æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« å°±è¿›å…¥å°¾å£°äº†ã€‚</p>
<p>å†™è¿™ç¯‡æ–‡ç« çš„åˆè¡·æ˜¯ä¸ºäº†èƒ½ä½¿æˆ‘è‡ªå·±åŠ æ·±å¯¹è¿›ç¨‹å’Œçº¿ç¨‹æœ¬è´¨çš„ç†è§£ï¼ŒåŒæ ·ï¼Œæˆ‘ä¹Ÿå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿç»™å¤§å®¶æä¾›ä¸€äº›å¸®åŠ©ã€‚</p>
<p>å½“æˆ‘ä»¬ä¸å†æ»¡è¶³äºè¿›ç¨‹ä¸çº¿ç¨‹è¡¨é¢çš„å®šä¹‰ï¼Œè€Œæ˜¯å»æ·±å…¥åº•å±‚çš„ <code>task_struct</code>ã€<code>clone</code> å’Œ <code>CLONE_VM</code>ç­‰å®æ—¶ï¼Œæ‰å‘ç°æ“ä½œç³»ç»Ÿè¯¾ç¨‹ä¸­é‚£äº›å†°å†·çš„æ¦‚å¿µçªç„¶å°±æœ‰äº†æ¸©åº¦ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elasticsearch èšåˆæ ¸å¿ƒåŸç†ä¸æ€§èƒ½è°ƒä¼˜å®æˆ˜]]></title>    <link>https://juejin.cn/post/7598464972913033256</link>    <guid>https://juejin.cn/post/7598464972913033256</guid>    <pubDate>2026-01-24T20:22:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598464972913033256" data-draft-id="7598490039489347619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearch èšåˆæ ¸å¿ƒåŸç†ä¸æ€§èƒ½è°ƒä¼˜å®æˆ˜"/> <meta itemprop="keywords" content="Elasticsearch,åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T20:22:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹¥æ°´ä¸å¦‚è¿œæ–¹"/> <meta itemprop="url" content="https://juejin.cn/user/1239904847665709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearch èšåˆæ ¸å¿ƒåŸç†ä¸æ€§èƒ½è°ƒä¼˜å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904847665709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹¥æ°´ä¸å¦‚è¿œæ–¹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T20:22:37.000Z" title="Sat Jan 24 2026 20:22:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. å¼•è¨€</h2>
<p>æåˆ° Elasticsearchï¼Œå¾ˆå¤šäººçš„ç¬¬ä¸€ååº”æ˜¯"æœç´¢å¼•æ“"ã€‚ç¡®å®ï¼ŒES å‡­å€Ÿå€’æ’ç´¢å¼•åœ¨å…¨æ–‡æ£€ç´¢é¢†åŸŸè¡¨ç°å‡ºè‰²ã€‚ä½†å®é™…ä¸Šï¼ŒES çš„å¦ä¸€é¡¹æ ¸å¿ƒèƒ½åŠ›â€”â€”<strong>èšåˆï¼ˆAggregationï¼‰</strong>â€”â€”æ‰æ˜¯è®©å®ƒæˆä¸ºæ•°æ®åˆ†æåˆ©å™¨çš„å…³é”®ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹è¿™äº›åœºæ™¯ï¼š</p>
<ul>
<li>ç”µå•†å¹³å°ç»Ÿè®¡"è¿‡å» 7 å¤©å„å“ç±»çš„é”€å”®é¢åˆ†å¸ƒ"</li>
<li>æ—¥å¿—ç³»ç»Ÿåˆ†æ"æ¯å°æ—¶é”™è¯¯æ—¥å¿—çš„æ•°é‡è¶‹åŠ¿"</li>
<li>ç”¨æˆ·ç”»åƒè®¡ç®—"å„å¹´é¾„æ®µç”¨æˆ·çš„æ´»è·ƒåº¦å æ¯”"</li>
</ul>
<p>è¿™äº›éœ€æ±‚çš„å…±åŒç‚¹æ˜¯ï¼šä¸å…³å¿ƒå…·ä½“æŸæ¡æ•°æ®ï¼Œè€Œæ˜¯è¦å¯¹æµ·é‡æ•°æ®åš<strong>åˆ†ç»„ã€è®¡æ•°ã€æ±‚å’Œã€æ’åº</strong>ã€‚è¿™æ­£æ˜¯èšåˆçš„ç”¨æ­¦ä¹‹åœ°ã€‚</p>
<h4 data-id="heading-1">é—®é¢˜</h4>
<p>å½“æ•°æ®é‡åœ¨ç™¾ä¸‡çº§æ—¶ï¼ŒèšåˆæŸ¥è¯¢é€šå¸¸æ¯«ç§’çº§è¿”å›ã€‚ä½†å½“æ•°æ®è†¨èƒ€åˆ°äº¿çº§ç”šè‡³åäº¿çº§ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™äº›é—®é¢˜ï¼š</p>

























<table><thead><tr><th>ç°è±¡</th><th>å¯èƒ½åŸå› </th></tr></thead><tbody><tr><td>æŸ¥è¯¢è€—æ—¶ä» 200ms æ¶¨åˆ° 10s+</td><td>æ‰«ææ•°æ®é‡è¿‡å¤§ï¼Œåˆ†ç‰‡ç»“æœåˆå¹¶å¼€é”€é«˜</td></tr><tr><td>å¶å‘ CircuitBreakingException</td><td>èšåˆæ¡¶æ•°çˆ†ç‚¸ï¼Œæ’‘çˆ†å†…å­˜ç†”æ–­å™¨</td></tr><tr><td>Terms èšåˆç»“æœä¸å‡†ç¡®</td><td>åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„ç²¾åº¦æŸå¤±</td></tr><tr><td>åè°ƒèŠ‚ç‚¹é¢‘ç¹ Full GC</td><td>ç»“æœå½’å¹¶é˜¶æ®µå †å†…å­˜å‹åŠ›è¿‡å¤§</td></tr></tbody></table>
<p>è¿™äº›é—®é¢˜çš„æ ¹æºåœ¨äºï¼š<strong>ä¸äº†è§£èšåˆçš„åº•å±‚æ‰§è¡Œæœºåˆ¶ï¼ŒåªæŠŠ ES å½“é»‘ç›’ä½¿ç”¨</strong>ã€‚</p>
<h4 data-id="heading-2">æœ¬æ–‡ç›®æ ‡</h4>
<p>æœ¬æ–‡å°†ä»ä¸‰ä¸ªå±‚é¢å»ºç«‹å¯¹ ES èšåˆçš„ç³»ç»Ÿè®¤çŸ¥ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     ä¼˜åŒ–æ–¹æ¡ˆ                          
          (æŸ¥è¯¢ä¼˜åŒ– / å»ºæ¨¡ä¼˜åŒ– / æ¶æ„ä¼˜åŒ–)                
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                     æ‰§è¡Œæµç¨‹                          
       (Scatter â†’ Map â†’ Reduce â†’ ç»“æœè¿”å›)             
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   æ•°æ®ç»“æ„åŸºç¡€                         
         (Doc Values / Global Ordinals)               
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>è‡ªåº•å‘ä¸Š</strong>ï¼šå…ˆç†è§£æ•°æ®æ˜¯æ€ä¹ˆå­˜çš„ï¼Œå†çœ‹æŸ¥è¯¢æ˜¯æ€ä¹ˆè·‘çš„ï¼Œæœ€åæ‰èƒ½æ˜ç™½ä¼˜åŒ–ä¸ºä»€ä¹ˆæœ‰æ•ˆã€‚</p>
<p>è¯»å®Œæœ¬æ–‡ï¼Œä½ å°†èƒ½å¤Ÿï¼š</p>
<ol>
<li>è¯´æ¸…æ¥šä¸€ä¸ªèšåˆè¯·æ±‚åœ¨é›†ç¾¤å†…éƒ¨çš„å®Œæ•´æ‰§è¡Œè·¯å¾„</li>
<li>å®šä½èšåˆæ…¢æŸ¥è¯¢çš„ç“¶é¢ˆæ‰€åœ¨</li>
<li>æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„ä¼˜åŒ–ç­–ç•¥</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»èšåˆçš„æ•°æ®ç»“æ„åŸºç¡€å¼€å§‹ã€‚</p>
<h2 data-id="heading-3">2. æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šèšåˆçš„åŸºçŸ³</h2>
<p>åœ¨æ·±å…¥æ‰§è¡Œæµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä¸€ä¸ªå…³é”®é—®é¢˜ï¼š**ES çš„æ•°æ®æ˜¯æ€ä¹ˆå­˜çš„ï¼Ÿ**è¿™å†³å®šäº†èšåˆèƒ½è·‘å¤šå¿«ã€‚</p>
<h3 data-id="heading-4">2.1 å€’æ’ç´¢å¼• vs Doc Values</h3>
<h4 data-id="heading-5">å€’æ’ç´¢å¼•ï¼šä¸ºæœç´¢è€Œç”Ÿ</h4>
<p>ES çš„æœç´¢èƒ½åŠ›æ¥è‡ªå€’æ’ç´¢å¼•ã€‚å®ƒçš„ç»“æ„æ˜¯"<strong>è¯é¡¹ï¼ˆTermï¼‰ â†’ æ–‡æ¡£åˆ—è¡¨</strong>"ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å€’æ’ç´¢å¼• (brand å­—æ®µ)

  Term        Posting List (DocId)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apple  â”‚  <span class="hljs-selector-attr">[1, 5, 8, 12, 99...]</span>  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Huawei â”‚  <span class="hljs-selector-attr">[2, 3, 7, 15, 88...]</span>  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Xiaomi â”‚  <span class="hljs-selector-attr">[4, 6, 9, 11, 23...]</span>  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<blockquote>
<p>âš ï¸è¿™é‡Œçš„DocIdæ˜¯ç‰©ç†ç¼–å·idï¼Œä¸æ˜¯æ–‡æ¡£çš„_id</p>
</blockquote>
<p>æŸ¥è¯¢ <code>brand = Apple</code> æ—¶ï¼Œç›´æ¥å®šä½åˆ° Apple è¿™ä¸€è¡Œï¼Œæ‹¿åˆ°æ–‡æ¡£ ID åˆ—è¡¨ï¼Œé€Ÿåº¦æå¿«ã€‚</p>
<p><strong>ä½†èšåˆçš„åœºæ™¯ä¸ä¸€æ ·</strong>ï¼š</p>
<p>ç»å¤§å¤šæ•°èšåˆæ˜¯åœ¨æœç´¢ä¹‹åè¿›è¡Œçš„ï¼Œå‡è®¾ç”¨æˆ·æœç´¢ <code>price &gt; 5000</code>ï¼ŒES ç­›é€‰å‡ºäº† Doc 1 å’Œ Doc 5ï¼Œç°åœ¨è¦ç»Ÿè®¡è¿™ä¸¤ä¸ªæ–‡æ¡£çš„å“ç‰Œåˆ†å¸ƒã€‚</p>
<p>å¦‚æœåªæœ‰å€’æ’ç´¢å¼•ï¼ŒES å¿…é¡»"ç›²çŒœ"ï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang"><span class="hljs-number">1</span>. å»æŸ¥ <span class="hljs-string">"Apple"</span> çš„ Posting Listï¼šé‡Œé¢æœ‰ Doc <span class="hljs-number">1</span> å—ï¼Ÿæœ‰ã€‚æœ‰ Doc <span class="hljs-number">5</span> å—ï¼Ÿæœ‰ã€‚
<span class="hljs-number">2</span>. å»æŸ¥ <span class="hljs-string">"Huawei"</span> çš„ Posting Listï¼šé‡Œé¢æœ‰ Doc <span class="hljs-number">1</span> å—ï¼Ÿæ²¡æœ‰ã€‚æœ‰ Doc <span class="hljs-number">5</span> å—ï¼Ÿæ²¡æœ‰ã€‚
<span class="hljs-number">3</span>. å»æŸ¥ <span class="hljs-string">"Vivo"</span> çš„ Posting Listï¼š...
   ...éå†æ‰€æœ‰å“ç‰Œ
</code></pre>
<p><strong>å½“å“ç‰Œæœ‰ä¸Šä¸‡ä¸ªæ—¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šéå¸¸æ…¢ã€‚</strong></p>
<h4 data-id="heading-6">Doc Valuesï¼šä¸ºèšåˆè€Œç”Ÿ</h4>
<p>Doc Values æ˜¯ ES ä¸“é—¨ä¸ºèšåˆå’Œæ’åºè®¾è®¡çš„<strong>åˆ—å¼å­˜å‚¨</strong>ç»“æ„ï¼š</p>
<pre><code class="hljs language-java" lang="java">Doc <span class="hljs-title function_">Values</span> <span class="hljs-params">(brand å­—æ®µ)</span>

  DocId       Value
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Doc <span class="hljs-number">1</span>  â”‚   Apple   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Doc <span class="hljs-number">2</span>  â”‚   Huawei  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Doc <span class="hljs-number">3</span>  â”‚   Huawei  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Doc <span class="hljs-number">4</span>  â”‚   Xiaomi  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Doc <span class="hljs-number">5</span>  â”‚   Apple   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<blockquote>
<p>âš ï¸Doc Valuesä¸­valueå­˜çš„å€¼å®é™…æ˜¯å®šé•¿çš„ï¼Œå˜é•¿çš„å€¼ä¼šç»è¿‡å¤šé‡æ˜ å°„å¾—åˆ°ä¸€ä¸ªå®šé•¿ç¼–å·å€¼</p>
</blockquote>
<p>ç°åœ¨ç»Ÿè®¡å“ç‰Œæ•°é‡å°±ç®€å•äº†ï¼šé¡ºåºæ‰«æä¸€éï¼Œé‡åˆ° Apple å°±ç»™ Apple è®¡æ•°å™¨ +1ã€‚</p>
<p><strong>ä¸¤è€…å¯¹æ¯”ï¼š</strong></p>

























<table><thead><tr><th>ç‰¹æ€§</th><th>å€’æ’ç´¢å¼•</th><th>Doc Values</th></tr></thead><tbody><tr><td>å­˜å‚¨æ–¹å‘</td><td>Term â†’ Doc IDs</td><td>Doc ID â†’ Value</td></tr><tr><td>é€‚åˆåœºæ™¯</td><td>æœç´¢ã€è¿‡æ»¤</td><td>èšåˆã€æ’åº</td></tr><tr><td>è®¿é—®æ¨¡å¼</td><td>éšæœºè¯»</td><td>é¡ºåºè¯»</td></tr></tbody></table>
<p>Doc Values é»˜è®¤å¯¹ keywordã€numericã€dateã€booleanã€geo_point ç­‰ç±»å‹å¼€å¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆèšåˆæ—¶åº”è¯¥ç”¨ keyword è€Œä¸æ˜¯ textã€‚</p>
<h4 data-id="heading-7">Doc Values çš„ç£ç›˜å‹å¥½æ€§</h4>
<p>Doc Values å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œé€šè¿‡ mmap æ˜ å°„åˆ°å†…å­˜ï¼Œç”±æ“ä½œç³»ç»Ÿç®¡ç†ç¼“å­˜ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% --- 1. å®šä¹‰ä¸‰å¥—ç®€å•çš„æ ·å¼ ---
    %% è“è‰²ï¼šJVMå±‚
    classDef jvm fill:#e3f2fd,stroke:#1565c0,stroke-width:2px;
    %% æ©™è‰²ï¼šOSç¼“å­˜å±‚
    classDef os fill:#fff3e0,stroke:#e65100,stroke-width:2px;
    %% ç°è‰²ï¼šç£ç›˜å±‚
    classDef disk fill:#eeeeee,stroke:#616161,stroke-width:2px;

    %% --- 2. åŸå›¾ç»“æ„ (å®Œå…¨ä¸å˜) ---
    subgraph JVM["ES è¿›ç¨‹ (JVM Heap)"]
        %% åº”ç”¨æ ·å¼
        A["ä¸šåŠ¡å¯¹è±¡ / Query è§£æ / ç»“æœåˆå¹¶"]:::jvm
    end
    
    subgraph OS["OS Page Cache (å †å¤–å†…å­˜)"]
        B["Doc Values æ•°æ®ç¼“å­˜"]:::os
    end
    
    subgraph Disk["ç£ç›˜"]
        C[".dvd / .dvm æ–‡ä»¶"]:::disk
    end
    
    JVM --&gt;|"mmap æ˜ å°„"| OS
    OS --&gt;|"ç¼“å­˜æœªå‘½ä¸­æ—¶è¯»å–"| Disk

    %% --- 3. å¾®è°ƒä¸€ä¸‹å­å›¾è¾¹æ¡†é¢œè‰²ä»¥åŒ¹é…å†…å®¹ (å¯é€‰) ---
    style JVM stroke:#1565c0,fill:none
    style OS stroke:#e65100,fill:none
    style Disk stroke:#616161,fill:none
</code></pre>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>çƒ­æ•°æ®è¢« OS è‡ªåŠ¨ç¼“å­˜ï¼Œè®¿é—®é€Ÿåº¦æ¥è¿‘å†…å­˜</li>
<li>å†·æ•°æ®è§¦å‘ç£ç›˜ I/Oï¼Œè¿™å°±æ˜¯å†·æ•°æ®èšåˆæ…¢çš„åŸå› </li>
<li>ä¸å ç”¨ JVM Heapï¼Œé¿å… GC å‹åŠ›</li>
</ul>
<h3 data-id="heading-8">2.2 Fielddataï¼šä¸å¾—å·²çš„é€‰æ‹©</h3>
<p>Doc Values ä¸æ”¯æŒ text ç±»å‹å­—æ®µã€‚text å­—æ®µä¼šè¢«åˆ†è¯ï¼ŒES ä¸ä¼šä¸ºåˆ†è¯ç»“æœæ„å»º Doc Valuesã€‚</p>
<p>å¦‚æœå¼ºè¡Œå¯¹ text å­—æ®µèšåˆï¼ŒES ä¼šå¯ç”¨ Fielddataâ€”â€”<strong>åœ¨è¿è¡Œæ—¶å°†å€’æ’ç´¢å¼•"åè½¬"ï¼Œæ„å»ºå‡º Doc ID â†’ åˆ†è¯è¯é¡¹çš„æ˜ å°„ï¼Œå¹¶åŠ è½½åˆ° JVM Heap ä¸­</strong>ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph Inverted["å€’æ’ç´¢å¼• (ç£ç›˜)"]
        I["apple â†’ [1,3,5]&lt;br/&gt;iphone â†’ [1,2,4]"]
    end
    
    subgraph Fielddata["Fielddata (JVM Heap)"]
        F["Doc 1 â†’ [apple, iphone]&lt;br/&gt;Doc 2 â†’ [åä¸º, pura, 70]"]
    end
    
    Inverted --&gt;|"é¦–æ¬¡èšåˆæ—¶åŠ è½½"| Fielddata

    %% --- æ ·å¼å®šä¹‰ (ä»…ä¿®æ”¹é¢œè‰²) ---
    %% ç°è‰²é£æ ¼ï¼šç£ç›˜
    style Inverted fill:#f5f5f5,stroke:#666,stroke-width:2px
    style I fill:#fff,stroke:#999

    %% æ©™è‰²é£æ ¼ï¼šå†…å­˜ (Fielddata)
    style Fielddata fill:#fff3e0,stroke:#e65100,stroke-width:2px
    style F fill:#fff,stroke:#ff9800
</code></pre>
<p><strong>Fielddata çš„é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong>å ç”¨ JVM Heap</strong>ï¼šä¸åƒ Doc Values åœ¨å †å¤–ï¼ŒFielddata ç›´æ¥åƒå †å†…å­˜</li>
<li><strong>åŠ è½½å³å¸¸é©»</strong>ï¼šä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼ŒæŒç»­æŒ¤å‹å†…å­˜ç©ºé—´</li>
<li><strong>é¦–æ¬¡åŠ è½½æ…¢</strong>ï¼šå…¨é‡æ„å»ºå¯èƒ½å¯¼è‡´æŸ¥è¯¢è¶…æ—¶</li>
</ul>
<p>å› æ­¤ ES 5.x èµ·<strong>é»˜è®¤ç¦ç”¨ Fielddata</strong>ï¼Œå¼ºè¡Œå¯¹ text èšåˆä¼šæŠ¥é”™ã€‚</p>
<h3 data-id="heading-9">2.3 Global Ordinalsï¼šå­—ç¬¦ä¸²èšåˆçš„åŠ é€Ÿå™¨</h3>
<p>Doc Values éœ€è¦æŒ‰ DocID ç›´æ¥å¯»å€ã€‚æ•°å€¼ç±»å‹å®šé•¿ï¼Œ<code>docId * å­—èŠ‚æ•°</code> ç›´æ¥ç®—åç§»é‡ï¼›ä½†å­—ç¬¦ä¸²å˜é•¿â€”â€”"Apple" 5 å­—èŠ‚ï¼Œ"Huawei" 6 å­—èŠ‚â€”â€”æ— æ³•ç›´æ¥å®šä½ã€‚</p>
<p><strong>Global Ordinals</strong> çš„æ–¹æ¡ˆæ˜¯ï¼š<strong>æŠŠå­—ç¬¦ä¸²æ˜ å°„æˆæ•´æ•°åºå·</strong>ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% === æ ·å¼å®šä¹‰ ===
    %% æ–‡æ¡£å±‚ï¼šæ™®é€šçš„å­˜å‚¨å•ä½
    classDef doc fill:#f5f5f5,stroke:#333,stroke-width:1px;
    %% åºå·å±‚ï¼šå…³é”®çš„ä¸­é—´ç´¢å¼• (æŒ‡é’ˆ)
    classDef ordinal fill:#e3f2fd,stroke:#2196f3,stroke-width:2px,shape:circle;
    %% è¯é¡¹å±‚ï¼šå®é™…çš„å­—ç¬¦ä¸²å†…å®¹ (å­—å…¸)
    classDef term fill:#fff9c4,stroke:#fbc02d,stroke-width:1px,shape:rect;

    %% === å·¦ä¾§ï¼šDoc Values å­˜å‚¨ (åªå­˜ ID) ===
    subgraph DV ["Doc Values (ä»…å­˜å‚¨åºå·)"]
        direction TB
        %% å°†æ–‡æ¡£å’Œå®ƒæŒæœ‰çš„åºå·åˆ†å¼€ç”»ï¼Œä½“ç°"æŒæœ‰"å…³ç³»
        D1[Doc 1] --&gt; O_D1((0)):::ordinal
        D2[Doc 2] --&gt; O_D2((1)):::ordinal
        D3[Doc 3] --&gt; O_D3((1)):::ordinal
        D4[Doc 4] --&gt; O_D4((2)):::ordinal
    end

    %% === å³ä¾§ï¼šGlobal Ordinals æ˜ å°„ (å­—å…¸) ===
    subgraph GO ["Global Ordinals (åºå· -&gt; è¯é¡¹)"]
        direction TB
        %% å­—å…¸çš„å®šä¹‰ï¼šåºå·æŒ‡å‘å…·ä½“çš„å€¼
        Key0((0)):::ordinal --&gt; Val0[Apple]:::term
        Key1((1)):::ordinal --&gt; Val1[Huawei]:::term
        Key2((2)):::ordinal --&gt; Val2[Xiaomi]:::term
    end

    %% === æ ¸å¿ƒé€»è¾‘ï¼šå…³è” (Lookup) ===
    %% ä½¿ç”¨è™šçº¿è¡¨ç¤ºè¿™æ˜¯"å¼•ç”¨"å…³ç³»ï¼Œä¸æ˜¯ç‰©ç†å­˜å‚¨åœ¨ä¸€èµ·
    O_D1 -.-&gt; Key0
    O_D2 -.-&gt; Key1
    O_D3 -.-&gt; Key1
    O_D4 -.-&gt; Key2

    %% æ ¼å¼å¾®è°ƒ
    linkStyle 4,5,6,7 stroke:#999,stroke-width:2px,stroke-dasharray: 5 5;
    class D1,D2,D3,D4 doc
</code></pre>
<p>è¿™å¸¦æ¥ä¸¤ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li><strong>å­˜å‚¨</strong>ï¼šDoc Values å˜æˆå®šé•¿æ•´æ•°æ•°ç»„ï¼Œæ”¯æŒ O(1) å¯»å€</li>
<li><strong>èšåˆ</strong>ï¼šåˆ†æ¡¶è®¡æ•°å˜æˆ <code>counts[ordinal]++</code>ï¼Œç”¨æ•°ç»„ä»£æ›¿ HashMapï¼Œæ›´å¿«æ›´çœå†…å­˜</li>
</ul>
<h4 data-id="heading-10">æ„å»ºæ—¶æœºä¸å¼€é”€</h4>
<p>Global Ordinals éœ€è¦éå†å­—æ®µçš„æ‰€æœ‰å”¯ä¸€å€¼æ¥æ„å»ºæ˜ å°„è¡¨ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph Default ["åœºæ™¯ä¸€ï¼šé»˜è®¤è¡Œä¸º (Global Ordinals)"]
        A1[èšåˆè¯·æ±‚] --&gt; A2{æ£€æŸ¥ç¼“å­˜}
        A2 --"é¦–æ¬¡/æœªå‘½ä¸­"--&gt; A3["æ„å»ºæ˜ å°„è¡¨(è€—æ—¶)"]
        A3 --&gt; A4[æ‰§è¡Œèšåˆ]
        A2 --"å·²ç¼“å­˜"--&gt; A4
    end

    subgraph Eager ["åœºæ™¯äºŒï¼šå¼€å¯ä¼˜åŒ– (Eager Global Ordinals)"]
        B1[Refresh] --&gt; B2["åå°é¢„æ„å»º(å¼‚æ­¥)"]
        B3[èšåˆè¯·æ±‚] --&gt; B4[ç›´æ¥å¯ç”¨/é›¶å»¶è¿Ÿ]
    end

    style A3 fill:#ffebee,stroke:#ef5350,stroke-width:2px
    style B2 fill:#e3f2fd,stroke:#2196f3,stroke-width:2px,stroke-dasharray: 5 5
    style B4 fill:#e8f5e9,stroke:#66bb6a,stroke-width:2px
</code></pre>
<p><strong>ä½•æ—¶å¼€å¯é¢„åŠ è½½ï¼Ÿ</strong></p>

















<table><thead><tr><th>åœºæ™¯</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>é«˜é¢‘èšåˆå­—æ®µï¼ˆå¦‚ brandã€categoryï¼‰</td><td>å¼€å¯ <code>eager_global_ordinals</code></td></tr><tr><td>ä½é¢‘èšåˆæˆ–é«˜åŸºæ•°å­—æ®µï¼ˆå¦‚ user_idï¼‰</td><td>ä¿æŒé»˜è®¤ï¼Œé¿å… Refresh å˜æ…¢</td></tr></tbody></table>
<p>é…ç½®æ–¹å¼ï¼š</p>
<pre><code class="hljs language-json" lang="json">PUT /index_name/_mapping
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"eager_global_ordinals"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-11">å°ç»“</h3>

























<table><thead><tr><th>ç»“æ„</th><th>ä½œç”¨</th><th>æ€§èƒ½å…³é”®ç‚¹</th></tr></thead><tbody><tr><td>Doc Values</td><td>åˆ—å¼å­˜å‚¨ï¼Œæ”¯æ’‘èšåˆè®¡ç®—</td><td>ä¾èµ– OS Cacheï¼Œå†·æ•°æ®è§¦å‘ç£ç›˜ I/O</td></tr><tr><td>Fielddata</td><td>text å­—æ®µèšåˆçš„å¤‡é€‰æ–¹æ¡ˆ</td><td>å ç”¨ Heapï¼Œåº”å°½é‡é¿å…</td></tr><tr><td>Global Ordinals</td><td>å­—ç¬¦ä¸²åˆ°æ•°å­—çš„æ˜ å°„</td><td>é¦–æ¬¡æ„å»ºæœ‰å¼€é”€ï¼Œé«˜é¢‘å­—æ®µå¯é¢„åŠ è½½</td></tr></tbody></table>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹èšåˆè¯·æ±‚åœ¨é›†ç¾¤ä¸­æ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚</p>
<h2 data-id="heading-12">3. èšåˆçš„æ‰§è¡Œæµç¨‹</h2>
<p>ç†è§£äº†æ•°æ®ç»“æ„ï¼Œç°åœ¨æ¥çœ‹ä¸€ä¸ªèšåˆè¯·æ±‚åœ¨é›†ç¾¤å†…éƒ¨æ˜¯æ€ä¹ˆè·‘çš„ã€‚</p>
<h3 data-id="heading-13">3.1 æ•´ä½“æµç¨‹ï¼šScatter-Gather æ¨¡å‹</h3>
<p>ES æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ•°æ®åˆ†æ•£åœ¨å¤šä¸ªåˆ†ç‰‡ä¸Šã€‚èšåˆé‡‡ç”¨ç»å…¸çš„ <strong>Scatter-Gather</strong> æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant Coord as åè°ƒèŠ‚ç‚¹
    participant S0 as åˆ†ç‰‡0
    participant S1 as åˆ†ç‰‡1
    participant S2 as åˆ†ç‰‡2

    Client-&gt;&gt;Coord: èšåˆè¯·æ±‚
    
    rect rgb(230, 245, 255)
        Note over Coord,S2: Scatter é˜¶æ®µ
        Coord-&gt;&gt;S0: è½¬å‘è¯·æ±‚
        Coord-&gt;&gt;S1: è½¬å‘è¯·æ±‚
        Coord-&gt;&gt;S2: è½¬å‘è¯·æ±‚
    end
    
    rect rgb(255, 245, 230)
        Note over S0,S2: Map é˜¶æ®µ (å„åˆ†ç‰‡æœ¬åœ°è®¡ç®—)
        S0-&gt;&gt;S0: æœ¬åœ°èšåˆ
        S1-&gt;&gt;S1: æœ¬åœ°èšåˆ
        S2-&gt;&gt;S2: æœ¬åœ°èšåˆ
    end
    
    rect rgb(230, 255, 230)
        Note over Coord,S2: Gather é˜¶æ®µ
        S0-&gt;&gt;Coord: è¿”å›æœ¬åœ°ç»“æœ
        S1-&gt;&gt;Coord: è¿”å›æœ¬åœ°ç»“æœ
        S2-&gt;&gt;Coord: è¿”å›æœ¬åœ°ç»“æœ
    end
    
    rect rgb(245, 230, 255)
        Note over Coord: Reduce é˜¶æ®µ (åˆå¹¶ç»“æœ)
        Coord-&gt;&gt;Coord: åˆå¹¶ + æ’åº + æˆªæ–­ + Pipelineè®¡ç®—
    end
    
    Coord-&gt;&gt;Client: è¿”å›æœ€ç»ˆç»“æœ
</code></pre>
<p>ç®€å•è¯´å°±æ˜¯å››æ­¥ï¼š<strong>åˆ†å‘ â†’ æœ¬åœ°ç®— â†’ æ”¶é›† â†’ åˆå¹¶</strong>ã€‚</p>
<h3 data-id="heading-14">3.2 åè°ƒèŠ‚ç‚¹é˜¶æ®µ</h3>
<p>åè°ƒèŠ‚ç‚¹ï¼ˆCoordinating Nodeï¼‰æ˜¯æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚çš„èŠ‚ç‚¹ï¼Œå®ƒè´Ÿè´£ï¼š</p>
<ol>
<li><strong>è§£æè¯·æ±‚</strong>ï¼šéªŒè¯ DSL è¯­æ³•ï¼Œæ„å»ºèšåˆæ‰§è¡Œè®¡åˆ’</li>
<li><strong>è·¯ç”±åˆ†å‘</strong>ï¼šç¡®å®šè¯·æ±‚éœ€è¦å‘å¾€å“ªäº›åˆ†ç‰‡ï¼ˆå— routingã€ç´¢å¼•åˆ«åç­‰å½±å“ï¼‰</li>
<li><strong>ç»“æœåˆå¹¶</strong>ï¼šæ”¶é›†å„åˆ†ç‰‡ç»“æœï¼Œæ‰§è¡Œæœ€ç»ˆçš„ Reduce æ“ä½œ</li>
</ol>
<p>åè°ƒèŠ‚ç‚¹æœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œä½†åœ¨ Reduce é˜¶æ®µä¼šæ¶ˆè€—å¤§é‡å†…å­˜ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤æ‚èšåˆå®¹æ˜“æŠŠåè°ƒèŠ‚ç‚¹æ‰“çˆ†ã€‚</p>
<h3 data-id="heading-15">3.3 æ•°æ®èŠ‚ç‚¹æ‰§è¡Œé˜¶æ®µ</h3>
<p>æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°ç‹¬ç«‹å®Œæˆèšåˆè®¡ç®—ï¼Œè¿™æ˜¯æœ€è€—æ—¶çš„é˜¶æ®µã€‚</p>
<h4 data-id="heading-16">å•å±‚èšåˆçš„æ‰§è¡Œ</h4>
<p>æ‰§è¡Œæµç¨‹å¾ˆç›´æ¥ï¼š</p>
<ol>
<li>éå†æŸ¥è¯¢å‘½ä¸­çš„æ–‡æ¡£</li>
<li>é€šè¿‡ Doc Values è¯»å–å­—æ®µå€¼</li>
<li>èšåˆè®¡ç®—</li>
</ol>
<h4 data-id="heading-17">åµŒå¥—èšåˆæ‰§è¡Œæ¨¡å¼ï¼šDFS vs BFS</h4>
<p>å¯¹äºåµŒå¥—èšåˆï¼ŒES æœ‰ä¸¤ç§éå†æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment">#ç¤ºä¾‹ï¼šæŒ‰å“ç‰Œåˆ†ç»„ï¼Œæ¯ä¸ªå“ç‰Œä¸‹å†æŒ‰ä»·æ ¼åŒºé—´åˆ†ç»„</span>
GET /products/_search
{
  <span class="hljs-string">"aggs"</span>: {
    <span class="hljs-string">"by_brand"</span>: {
      <span class="hljs-string">"terms"</span>: { <span class="hljs-string">"field"</span>: <span class="hljs-string">"brand"</span> },
      <span class="hljs-string">"aggs"</span>: {
        <span class="hljs-string">"by_price_range"</span>: {
          <span class="hljs-string">"range"</span>: {
            <span class="hljs-string">"field"</span>: <span class="hljs-string">"price"</span>,
            <span class="hljs-string">"ranges"</span>: [
              { <span class="hljs-string">"to"</span>: 100 },
              { <span class="hljs-string">"from"</span>: 100, <span class="hljs-string">"to"</span>: 500 },
              { <span class="hljs-string">"from"</span>: 500 }
            ]
          }
        }
      }
    }
  }
}
</code></pre>
<p>å‡è®¾ brand å­—æ®µæœ‰ 10000 ä¸ªä¸åŒçš„å€¼ï¼Œæ¯ä¸ªå“ç‰Œä¸‹æœ‰ 3 ä¸ªä»·æ ¼åŒºé—´æ¡¶ã€‚</p>
<h4 data-id="heading-18">æ·±åº¦ä¼˜å…ˆï¼ˆDFSï¼Œé»˜è®¤ï¼‰</h4>
<p>ES åªéå†ä¸€æ¬¡æ–‡æ¡£ï¼Œè¾¹éå†è¾¹æ„å»ºå®Œæ•´çš„èšåˆæ ‘ï¼š</p>
<pre><code class="hljs language-txt" lang="txt">éå† Doc 1 (brand=Apple, price=299)
  â†’ æ‰¾åˆ°/åˆ›å»º Apple æ¡¶ï¼Œè®¡æ•°+1
  â†’ åœ¨ Apple æ¡¶ä¸‹æ‰¾åˆ°/åˆ›å»º "100-500" å­æ¡¶ï¼Œè®¡æ•°+1

éå† Doc 2 (brand=Huawei, price=50)
  â†’ æ‰¾åˆ°/åˆ›å»º Huawei æ¡¶ï¼Œè®¡æ•°+1
  â†’ åœ¨ Huawei æ¡¶ä¸‹æ‰¾åˆ°/åˆ›å»º "&lt;100" å­æ¡¶ï¼Œè®¡æ•°+1

... ä¸€æ¬¡éå†å®Œæˆæ‰€æœ‰å·¥ä½œ
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph RAM [JVM Heap: æ‰€æœ‰èŠ‚ç‚¹åŒæ—¶é©»ç•™]
        direction TB
        Root((Root)) 
        
        %% ç¬¬ä¸€å±‚ï¼šå“ç‰Œ
        Root --&gt; A[Apple]
        Root --&gt; H[Huawei]
        Root -.-&gt; X["...å…± 1ä¸‡ä¸ªå“ç‰Œ..."]
        
        %% ç¬¬äºŒå±‚ï¼šä»·æ ¼åŒºé—´ï¼ˆå¼ºè°ƒè†¨èƒ€ï¼‰
        A --&gt; A1[&lt;100] &amp; A2[100-500] &amp; A3["\&gt;500"]
        H --&gt; H1[&lt;100] &amp; H2[100-500] &amp; H3["\&gt;500"]
        X -.-&gt; X1[&lt;100] &amp; X2[...] &amp; X3["\&gt;500"]
    end

    %% æ ·å¼
    style RAM fill:#fff0f0,stroke:#d32f2f,stroke-width:2px,stroke-dasharray: 5 5
    style Root fill:#333,color:#fff
    style A fill:#e3f2fd,stroke:#1565c0
    style H fill:#e3f2fd,stroke:#1565c0
    style X fill:#e3f2fd,stroke:#1565c0
    
    style A1 fill:#ffcdd2,stroke:#c62828
    style A2 fill:#ffcdd2,stroke:#c62828
    style A3 fill:#ffcdd2,stroke:#c62828
    style H1 fill:#ffcdd2,stroke:#c62828
    style H2 fill:#ffcdd2,stroke:#c62828
    style H3 fill:#ffcdd2,stroke:#c62828
    style X1 fill:#ffcdd2,stroke:#c62828
    style X2 fill:#ffcdd2,stroke:#c62828
    style X3 fill:#ffcdd2,stroke:#c62828
</code></pre>
<p><strong>å†…å­˜å³°å€¼</strong> = 10000 ä¸ªçˆ¶æ¡¶ + 30000 ä¸ªå­æ¡¶ = <strong>40000 ä¸ªæ¡¶åŒæ—¶å­˜åœ¨</strong></p>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ•°æ®åªæ‰«ä¸€éï¼ŒIO å¼€é”€æœ€å°ã€‚</p>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š<strong>ä¸å‰ªæ</strong>ã€‚å“ªæ€•ä½ è¦ Top 10ï¼Œå®ƒä¹Ÿä¼šå…ˆæŠŠ 1 ä¸‡ä¸ªå…¨ç®—å‡ºæ¥ï¼Œå†…å­˜å®¹æ˜“çˆ†ç‚¸ï¼ˆOOMï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-19"><strong>å¹¿åº¦ä¼˜å…ˆï¼ˆBFSï¼‰</strong></h4>
<p>éå†æ–‡æ¡£åˆ†ä¸¤è½®ï¼Œç¬¬ä¸€è½®åªæ„å»ºçˆ¶æ¡¶ï¼Œç¡®å®š Top N åé‡Šæ”¾å…¶ä»–çˆ¶æ¡¶ï¼›ç¬¬äºŒè½®åªå¯¹ Top N æ„å»ºå­æ¡¶ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    %% --- æ ·å¼å®šä¹‰ ---
    %% è“è‰²é£æ ¼ï¼šç¬¬ä¸€è½® (ç²—ç­›)
    classDef r1 fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    %% ç»¿è‰²é£æ ¼ï¼šç¬¬äºŒè½® (ç²¾ç®—)
    classDef r2 fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px

    %% --- ç»“æ„å®šä¹‰ ---
    subgraph Round1["ç¬¬ä¸€è½®ï¼šåªæ„å»ºçˆ¶æ¡¶ (BFS)"]
        D1["æ‰€æœ‰æ–‡æ¡£"]:::r1 --&gt; Parents["Apple: 5000&lt;br/&gt;Huawei: 3000&lt;br/&gt;... å…± 10000 ä¸ª"]:::r1
        Parents --&gt; TopN["å– Top N&lt;br/&gt;é‡Šæ”¾å…¶ä»–çˆ¶æ¡¶"]:::r1
    end
    
    subgraph Round2["ç¬¬äºŒè½®ï¼šå¯¹ Top N æ„å»ºå­æ¡¶"]
        TopN --&gt; Filter["å†æ¬¡éå†æ–‡æ¡£&lt;br/&gt;åªå¤„ç† Top N å“ç‰Œ"]:::r2
        Filter --&gt; Children["Apple çš„å­æ¡¶&lt;br/&gt;Huawei çš„å­æ¡¶&lt;br/&gt;... å…± N ä¸ªçˆ¶æ¡¶çš„å­æ¡¶"]:::r2
    end

    %% --- è™šçº¿æ¡†ç¾åŒ– ---
    style Round1 fill:#f9f9f9,stroke:#999,stroke-dasharray: 5 5
    style Round2 fill:#f9f9f9,stroke:#999,stroke-dasharray: 5 5
</code></pre>
<p><strong>å†…å­˜å³°å€¼</strong> = max(10000 çˆ¶æ¡¶, 10 çˆ¶æ¡¶ + 30 å­æ¡¶) = 10000ï¼Œè¿œå°äº DFS çš„ 40000ã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæå‰å‰ªæï¼Œå†…å­˜å ç”¨å°‘ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šéœ€è¦ä¸¤æ¬¡æ‰«æ<code>Doc Values</code>ï¼ŒCPUå’ŒIOå¼€é”€å¤§</li>
</ul>
<p><strong>DFS vs BFS å¯¹æ¯”ï¼š</strong></p>






























<table><thead><tr><th/><th>DFSï¼ˆé»˜è®¤ï¼‰</th><th>BFS</th></tr></thead><tbody><tr><td>éå†æ¬¡æ•°</td><td>1 æ¬¡</td><td>å¤šæ¬¡ï¼ˆåµŒå¥—å±‚æ•°ï¼‰</td></tr><tr><td>å†…å­˜å³°å€¼</td><td>æ‰€æœ‰çˆ¶æ¡¶ + æ‰€æœ‰å­æ¡¶</td><td>æ‰€æœ‰çˆ¶æ¡¶ æˆ– Top N çˆ¶æ¡¶ + å­æ¡¶</td></tr><tr><td>ä¼˜åŠ¿</td><td>ä¸€æ¬¡éå†ï¼Œçœ CPU å’Œ I/O</td><td>å†…å­˜å³°å€¼ä½</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>çˆ¶æ¡¶åŸºæ•°ä½ï¼ˆå¤§å¤šæ•°æƒ…å†µï¼‰</td><td>çˆ¶æ¡¶åŸºæ•°æé«˜ï¼ˆä¸Šä¸‡ï¼‰ï¼Œå­æ¡¶çˆ†ç‚¸</td></tr></tbody></table>
<p>é…ç½®æ–¹å¼ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"by_brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brand"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"collect_mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"breadth_first"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"by_price_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> ... <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-20">3.4 ç»“æœå½’å¹¶ä¸ç²¾åº¦é—®é¢˜</h3>
<p>åè°ƒèŠ‚ç‚¹æ”¶åˆ°å„åˆ†ç‰‡ç»“æœåï¼Œæ‰§è¡Œ Reduce æ“ä½œï¼šåˆå¹¶ã€æ’åºã€æˆªæ–­ã€‚</p>
<p>è¿™ä¸ªé˜¶æ®µæœ‰ä¸ªå…³é”®é—®é¢˜ï¼š<strong>ç²¾åº¦æŸå¤±</strong>ã€‚ä»¥ Terms èšåˆä¸ºä¾‹ï¼Œå‡è®¾è¦æŸ¥"é”€é‡ Top 3 çš„å“ç‰Œ"ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    %% --- æ ·å¼å®šä¹‰åŒº ---
    classDef shardStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,rx:5,ry:5;
    classDef coordStyle fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,rx:5,ry:5;
    classDef resultStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,rx:5,ry:5;
    
    %% å­å›¾æ ·å¼ (èƒŒæ™¯é€æ˜ï¼Œåªç•™æ–‡å­—æ ‡é¢˜å’Œè¾¹æ¡†)
    style Shard0 fill:none,stroke:#bbdefb,stroke-dasharray: 5 5
    style Shard1 fill:none,stroke:#bbdefb,stroke-dasharray: 5 5
    style Coord fill:none,stroke:#fff59d,stroke-dasharray: 5 5
    style Result fill:none,stroke:#c8e6c9,stroke-dasharray: 5 5

    %% --- å›¾è¡¨å†…å®¹åŒº (ä¿æŒåŸæ ·) ---
    subgraph Shard0["åˆ†ç‰‡ 0 æœ¬åœ° Top 3"]
        S0["Apple: 100&lt;br/&gt;Huawei: 80&lt;br/&gt;Xiaomi: 60"]:::shardStyle
    end
    
    subgraph Shard1["åˆ†ç‰‡ 1 æœ¬åœ° Top 3"]
        S1["Huawei: 90&lt;br/&gt;Vivo: 70&lt;br/&gt;Apple: 50"]:::shardStyle
    end
    
    subgraph Coord["åè°ƒèŠ‚ç‚¹åˆå¹¶"]
        C["Apple: 150&lt;br/&gt;Huawei: 170&lt;br/&gt;Xiaomi: 60&lt;br/&gt;Vivo: 70"]:::coordStyle
    end
    
    subgraph Result["æœ€ç»ˆ Top 3"]
        R["Huawei: 170&lt;br/&gt;Apple: 150&lt;br/&gt;Vivo: 70"]:::resultStyle
    end
    
    S0 --&gt; C
    S1 --&gt; C
    C --&gt; R
</code></pre>
<p><strong>é‚£ä¹ˆé—®é¢˜æ¥äº†</strong>ï¼šXiaomi åœ¨åˆ†ç‰‡ 1 å¯èƒ½æœ‰ 45 æ¡æ•°æ®ï¼ˆæ’ç¬¬ 4ï¼Œæ²¡è¿› Top 3ï¼‰ï¼ŒVivoåœ¨åˆ†ç‰‡ 0 æ²¡æ•°æ®ï¼Œä½†åˆå¹¶å Xiaomi æ€»æ•°åº”è¯¥æ˜¯ 105ï¼Œæœ¬åº”è¿›å…¥æœ€ç»ˆ Top 3ã€‚</p>
<p><strong>è¿™å°±æ˜¯åˆ†å¸ƒå¼èšåˆçš„ç²¾åº¦æŸå¤±</strong>ï¼šå„åˆ†ç‰‡åªè¿”å›æœ¬åœ° Top Nï¼Œå…¨å±€è§†è§’ä¸‹å¯èƒ½æ¼æ‰æ•°æ®ã€‚</p>
<h4 data-id="heading-21">shard_size å‚æ•°</h4>
<p>ES çš„è§£å†³æ–¹æ¡ˆæ˜¯<strong>è¿‡é‡‡æ ·</strong>ï¼šè®©æ¯ä¸ªåˆ†ç‰‡è¿”å›æ¯” <code>size</code> æ›´å¤šçš„ç»“æœï¼Œå‚æ•°ä¸º<strong>shard_size</strong>ï¼Œ åªå¯¹ Terms èšåˆæœ‰æ•ˆ</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"top_brands"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brand"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"shard_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><code>size</code>ï¼šæœ€ç»ˆè¿”å›çš„æ¡¶æ•°é‡</li>
<li><code>shard_size</code>ï¼šæ¯ä¸ªåˆ†ç‰‡è¿”å›çš„æ¡¶æ•°é‡ï¼ˆé»˜è®¤ <code>size * 1.5 + 10</code>ï¼‰</li>
</ul>
<p><code>shard_size</code> è¶Šå¤§ï¼Œç²¾åº¦è¶Šé«˜ï¼Œä½†åè°ƒèŠ‚ç‚¹å†…å­˜å‹åŠ›ä¹Ÿè¶Šå¤§ã€‚</p>
<h4 data-id="heading-22">è¯¯å·®æŒ‡æ ‡</h4>
<p>ES åœ¨å“åº”ä¸­è¿”å›ä¸¤ä¸ªè¯¯å·®æŒ‡æ ‡ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggregations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"top_brands"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"doc_count_error_upper_bound"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">46</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sum_other_doc_count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1256</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"buckets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>...<span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>

















<table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>doc_count_error_upper_bound</code></td><td>æœªè¿”å›çš„æ¡¶ä¸­ï¼Œæ–‡æ¡£æ•°é‡çš„æœ€å¤§å¯èƒ½è¯¯å·®</td></tr><tr><td><code>sum_other_doc_count</code></td><td>æœªè¿”å›çš„æ¡¶çš„æ–‡æ¡£æ€»æ•°</td></tr></tbody></table>
<p>å¦‚æœ <code>doc_count_error_upper_bound</code> å¾ˆå¤§ï¼Œè¯´æ˜ç»“æœå¯èƒ½ä¸å‡†ï¼Œè€ƒè™‘å¢å¤§ <code>shard_size</code>ã€‚</p>
<h3 data-id="heading-23">å°ç»“</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph CN ["åè°ƒèŠ‚ç‚¹ (Coordinating Node)"]
        direction TB
        Scatter([Scatter&lt;br/&gt;åˆ†å‘è¯·æ±‚])
        Gather([Gather&lt;br/&gt;æ”¶é›†ç»“æœ])
        Reduce([Reduce&lt;br/&gt;åˆå¹¶æ’åº])
    end

    subgraph DN ["æ•°æ®èŠ‚ç‚¹ (Data Node)"]
        Map[Map&lt;br/&gt;æœ¬åœ°è®¡ç®—]
    end

    %% æµç¨‹è¿æ¥
    Scatter --&gt;|"1.å¹¿æ’­è¯·æ±‚"| Map
    Map --&gt;|"2.è¿”å›ä¸­é—´ç»“æœ"| Gather
    Gather --&gt;|"3.æœ€ç»ˆèšåˆ"| Reduce

    %% å…³é”®ç‚¹æ ‡æ³¨ (ä½¿ç”¨è™šçº¿è¿æ¥æ³¨é‡Š)
    NoteDFS[DFS / BFS æ¨¡å¼&lt;br/&gt;åœ¨æ­¤é˜¶æ®µç”Ÿæ•ˆ] -.-&gt; Map
    Reduce -.-&gt; NoteLoss[å¯èƒ½äº§ç”Ÿ&lt;br/&gt;ç²¾åº¦æŸå¤±]

    %% æ ·å¼ç¾åŒ–
    classDef coord fill:#e3f2fd,stroke:#1565c0,stroke-width:2px;
    classDef data fill:#fff3e0,stroke:#e65100,stroke-width:2px;
    classDef note fill:#fff,stroke:#333,stroke-dasharray: 5 5;

    class Scatter,Gather,Reduce coord;
    class Map data;
    class NoteDFS,NoteLoss note;
</code></pre>
<p><strong>æ€§èƒ½å…³é”®ç‚¹ï¼š</strong></p>






























<table><thead><tr><th>é˜¶æ®µ</th><th>ç“¶é¢ˆ</th><th>åº”å¯¹</th></tr></thead><tbody><tr><td>Map</td><td>æ‰«ææ•°æ®é‡å¤§</td><td>å…ˆ filter ç¼©å°èŒƒå›´</td></tr><tr><td>Map</td><td>åµŒå¥—èšåˆå†…å­˜çˆ†ç‚¸</td><td>ä½¿ç”¨ <code>breadth_first</code></td></tr><tr><td>Reduce</td><td>åˆå¹¶ç»“æœé‡å¤§</td><td>æ§åˆ¶ <code>shard_size</code></td></tr><tr><td>Reduce</td><td>ç²¾åº¦ä¸è¶³</td><td>å¢å¤§ <code>shard_size</code> æˆ–ç”¨ Composite</td></tr></tbody></table>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸åŒç±»å‹èšåˆçš„å®ç°å·®å¼‚ã€‚</p>
<h2 data-id="heading-24">4. ä¸åŒèšåˆç±»å‹çš„å®ç°å·®å¼‚</h2>
<p>ES çš„èšåˆåˆ†ä¸ºä¸‰å¤§ç±»ï¼š<strong>Metricï¼ˆæŒ‡æ ‡ï¼‰ã€Bucketï¼ˆåˆ†æ¡¶ï¼‰ã€Pipelineï¼ˆç®¡é“ï¼‰</strong>ã€‚å®ƒä»¬çš„æ‰§è¡Œæ–¹å¼å’Œæ€§èƒ½ç‰¹å¾å·®å¼‚å¾ˆå¤§ã€‚</p>





























<table><thead><tr><th>ç±»å‹</th><th>ä»£è¡¨æ“ä½œ</th><th>è¾“å…¥</th><th>è¾“å‡º</th></tr></thead><tbody><tr><td>Metric</td><td>sumã€avgã€maxã€cardinalityã€stats</td><td>æ–‡æ¡£é›†</td><td>ç»Ÿè®¡æŒ‡æ ‡</td></tr><tr><td>Bucket</td><td>termsã€date_histogramã€range</td><td>æ–‡æ¡£é›†</td><td>å¤šä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶å«æ–‡æ¡£å­é›†</td></tr><tr><td>Pipeline</td><td>derivativeã€bucket_selector</td><td>å…¶ä»–èšåˆç»“æœ</td><td>äºŒæ¬¡è®¡ç®—ç»“æœ</td></tr></tbody></table>
<h3 data-id="heading-25">4.1 Metric èšåˆï¼šä¸€æ¬¡éå†å‡ºç»“æœ</h3>
<p>Metric èšåˆå¯¹æ–‡æ¡£é›†è®¡ç®—å•ä¸ªæŒ‡æ ‡å€¼ï¼Œå®ç°æœ€ä¸ºç®€å•ã€‚</p>
<h4 data-id="heading-26">sum / avg / max / min</h4>
<p>è¿™ç±»èšåˆåªéœ€è¦éå†ä¸€æ¬¡æ–‡æ¡£ï¼Œç»´æŠ¤ä¸€ä¸ªç´¯åŠ å™¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">åˆå§‹åŒ–: <span class="hljs-attr">sum</span>=<span class="hljs-number">0</span>, count=<span class="hljs-number">0</span>

éå†æ¯ä¸ªæ–‡æ¡£:
    sum += doc.price
    count++

è¿”å›: <span class="hljs-attr">avg</span> = sum / count
</code></pre>
<p><strong>æ€§èƒ½ç‰¹ç‚¹</strong>ï¼šO(N) æ—¶é—´å¤æ‚åº¦ï¼Œå†…å­˜å¼€é”€æå°ï¼ˆåªéœ€å‡ ä¸ªå˜é‡ï¼‰ã€‚</p>
<h4 data-id="heading-27">cardinalityï¼šå»é‡è®¡æ•°çš„æŒ‘æˆ˜</h4>
<p>ç»Ÿè®¡æŸä¸ªå­—æ®µæœ‰å¤šå°‘ä¸ªä¸åŒçš„å€¼ï¼ˆå¦‚"æœ‰å¤šå°‘ç‹¬ç«‹ç”¨æˆ·"ï¼‰ï¼Œçœ‹ä¼¼ç®€å•ï¼Œå®åˆ™æ˜¯ä¸ªéš¾é¢˜ã€‚</p>
<p><strong>ç²¾ç¡®è®¡ç®—çš„ä»£ä»·</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">ç²¾ç¡®å»é‡éœ€è¦ï¼š
<span class="hljs-number">1.</span> ç»´æŠ¤ä¸€ä¸ª <span class="hljs-title class_">Set</span> å­˜å‚¨æ‰€æœ‰å·²è§è¿‡çš„å€¼
<span class="hljs-number">2.</span> å†…å­˜å¼€é”€ = <span class="hljs-title function_">O</span>(åŸºæ•°)

å‡è®¾ user_id æœ‰ <span class="hljs-number">1</span> äº¿ä¸ªä¸åŒå€¼ï¼Œæ¯ä¸ª <span class="hljs-variable constant_">ID</span> å  <span class="hljs-number">20</span> å­—èŠ‚
â†’ éœ€è¦ 2GB å†…å­˜ï¼Œè¿˜æ²¡ç®— <span class="hljs-title class_">Set</span> çš„é¢å¤–å¼€é”€
</code></pre>
<p><strong>ES çš„è§£å†³æ–¹æ¡ˆï¼šHyperLogLog++ ç®—æ³•</strong></p>
<p>ç²¾ç¡®å»é‡éœ€å­˜æ‰€æœ‰å€¼ï¼Œ1äº¿ç”¨æˆ·è¦GBçº§å†…å­˜ã€‚HLL++ ç”¨æ¦‚ç‡ä¼°ç®—ï¼Œåªéœ€12KBã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph S1 ["æ­¥éª¤ä¸€ï¼šåˆ†æ¡¶"]
    Input(å€¼) --&gt; Hash[64ä½å“ˆå¸Œ]
    Hash --å‰14ä½--&gt; Bucket[16384ä¸ªæ¡¶]
    end

    subgraph S2 ["æ­¥éª¤äºŒï¼šè®°æœ€å¤§å‰å¯¼é›¶"]
    Hash --å50ä½--&gt; Zeros[å‰å¯¼é›¶ä¸ªæ•°]
    Zeros --&gt; Max{ä¿ç•™æœ€å¤§å€¼ R}
    end

    subgraph S3 ["æ­¥éª¤ä¸‰ï¼šå•æ¡¶ä¼°ç®—"]
    Max --"æ¦‚ç‡åæ¨"--&gt; Estimate["å•æ¡¶çº¦ 2^R ä¸ª"]
    end

    subgraph S4 ["æ­¥éª¤å››ï¼šæ±‡æ€»ä¿®æ­£"]
    Estimate --&gt; Harmonic["&lt;b&gt;è°ƒå’Œå¹³å‡&lt;/b&gt;&lt;br/&gt;(å¹³æ»‘ 2^R çš„æ³¢åŠ¨)"]
    Harmonic --&gt; Final["Ã— æ¡¶æ•° Ã— 0.7 (ä¿®æ­£)"] --&gt; Result(æ€»åŸºæ•°)
    end

    style Harmonic fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    style Max fill:#fff3e0,stroke:#f57c00
</code></pre>
<ol>
<li>
<p>æ­¥éª¤ä¸€ï¼šåˆ†æ¡¶ (Sharding)</p>
<p>æ¯ä¸ªå€¼å“ˆå¸Œæˆ 64ä½ï¼š</p>
<ul>
<li><strong>å‰ 14 ä½</strong>ï¼šå†³å®šè½å…¥å“ªä¸ªæ¡¶ï¼ˆå…± <strong>16384</strong> ä¸ªæ¡¶ï¼‰ã€‚</li>
<li><strong>å 50 ä½</strong>ï¼šç”¨äºåç»­ä¼°ç®—ã€‚</li>
</ul>
</li>
<li>
<p>æ­¥éª¤äºŒï¼šè®°å½•å‰å¯¼é›¶ (Leading Zeros)</p>
<p>å¯¹æ¯ä¸ªæ¡¶ï¼Œç»Ÿè®¡è½å…¥è¯¥æ¡¶æ‰€æœ‰å€¼çš„å 50 ä½å‰å¯¼é›¶ä¸ªæ•°ï¼Œ<strong>åªä¿ç•™æœ€å¤§å€¼ R</strong>ã€‚</p>
</li>
<li>
<p>æ­¥éª¤ä¸‰ï¼šä¼°ç®—å•æ¡¶åŸºæ•°</p>
<p>åˆ©ç”¨æ¦‚ç‡åæ¨ï¼š</p>
<ul>
<li>éšæœºå‡ºç°  n ä¸ªå‰å¯¼é›¶çš„æ¦‚ç‡æ˜¯1/2^nã€‚</li>
<li>è‹¥æŸæ¡¶è®°å½•çš„<strong>æœ€å¤§</strong>å‰å¯¼é›¶æ˜¯ Rï¼Œè¯´æ˜è¯¥æ¡¶çº¦æœ‰ 2^R ä¸ªä¸åŒå€¼ã€‚</li>
</ul>
</li>
<li>
<p>æ­¥éª¤å››ï¼šæ±‡æ€»å¾—åˆ°æ€»åŸºæ•°</p>
<p>æ•°æ®å‡åŒ€åˆ†å¸ƒåˆ°16384ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶çš„ä¼°ç®—å€¼æ˜¯2^Rã€‚ä½†2^Råªèƒ½æ˜¯2çš„å¹‚æ¬¡ï¼ˆ2ã€4ã€8ã€16...ï¼‰ï¼Œå•æ¡¶æ³¢åŠ¨å¤§ï¼Œç›´æ¥ç®—æœ¯å¹³å‡ä¼šè¢«æç«¯å€¼å¸¦åã€‚</p>
<p>HLL++ç”¨<strong>è°ƒå’Œå¹³å‡</strong>æ¥å‹åˆ¶æç«¯å€¼ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">è°ƒå’Œå¹³å‡ = n / (1/xâ‚ + 1/xâ‚‚ + ... + 1/xâ‚™)
</code></pre>
<p>æœ€ç»ˆç»“æœï¼š</p>
<pre><code class="hljs language-scss" lang="scss">æœ€ç»ˆå…¬å¼ï¼š
æ€»åŸºæ•° = <span class="hljs-number">0.7</span> Ã— <span class="hljs-number">16384</span> Ã— <span class="hljs-number">16384</span> / (<span class="hljs-number">1</span>/<span class="hljs-number">2</span>^Râ‚ + <span class="hljs-number">1</span>/<span class="hljs-number">2</span>^Râ‚‚ + ... + <span class="hljs-number">1</span>/<span class="hljs-number">2</span>^Râ‚â‚†â‚ƒâ‚ˆâ‚„)
</code></pre>
<p>å…¶ä¸­<code>0.7</code>æ˜¯ä¿®æ­£ç³»æ•°ï¼Œè¡¥å¿ç³»ç»Ÿæ€§åå·®ã€‚</p>
<p><strong>å†…å­˜</strong>ï¼šæ¯æ¡¶ 6bitï¼ˆå­˜0~63ï¼‰ï¼Œå…±12KBã€‚è¯¯å·®çº¦2%ã€‚</p>
</li>
</ol>
<p><strong>precision_threshold å‚æ•°</strong>ï¼š</p>
<p>æ§åˆ¶ HLL++ ä½¿ç”¨çš„æ¡¶æ•°é‡ã€‚æ¡¶è¶Šå¤šï¼Œä¼°ç®—è¶Šå‡†ï¼Œä½†å†…å­˜è¶Šå¤§ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"unique_users"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cardinality"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user_id"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"precision_threshold"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3000</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>

























<table><thead><tr><th>precision_threshold</th><th>å†…å­˜å ç”¨</th><th>ç²¾åº¦</th></tr></thead><tbody><tr><td>100</td><td>~1.6 KB</td><td>åŸºæ•° &lt; 100 æ—¶ç²¾ç¡®ï¼Œä¹‹åè¯¯å·®çº¦ 5%</td></tr><tr><td>3000ï¼ˆé»˜è®¤ï¼‰</td><td>~48 KB</td><td>åŸºæ•° &lt; 3000 æ—¶ç²¾ç¡®ï¼Œä¹‹åè¯¯å·®çº¦ 2%</td></tr><tr><td>40000ï¼ˆæœ€å¤§ï¼‰</td><td>~640 KB</td><td>åŸºæ•° &lt; 40000 æ—¶ç²¾ç¡®</td></tr></tbody></table>
<p><strong>æƒè¡¡</strong>ï¼š<code>precision_threshold</code> è¶Šå¤§ï¼Œç²¾åº¦è¶Šé«˜ï¼Œä½†å†…å­˜å¼€é”€ä¹Ÿè¶Šå¤§ã€‚å¯¹äº"ç»Ÿè®¡æ—¥æ´»ç”¨æˆ·"è¿™ç±»åœºæ™¯ï¼Œ3000 çš„é»˜è®¤å€¼é€šå¸¸å¤Ÿç”¨ã€‚</p>
<h3 data-id="heading-28">4.2 Bucket èšåˆï¼šåˆ†æ¡¶çš„è‰ºæœ¯</h3>
<p>Bucket èšåˆå°†æ–‡æ¡£åˆ’åˆ†åˆ°ä¸åŒçš„æ¡¶ä¸­ï¼Œæ¯ä¸ªæ¡¶å¯ä»¥ç»§ç»­åµŒå¥—å­èšåˆã€‚</p>
<h4 data-id="heading-29">termsï¼šåŸºäº Global Ordinals çš„åˆ†æ¡¶</h4>
<p>terms èšåˆæ˜¯æœ€å¸¸ç”¨çš„åˆ†æ¡¶æ–¹å¼ï¼Œå®ƒçš„æ‰§è¡Œä¾èµ–æˆ‘ä»¬åœ¨ 2.3 èŠ‚ä»‹ç»çš„ Global Ordinalsï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Doc as æ–‡æ¡£éå†
    participant GO as Global Ordinals
    participant Buckets as æ¡¶æ•°ç»„
    
    Doc-&gt;&gt;GO: Doc1.brand çš„åºå·æ˜¯ï¼Ÿ
    GO--&gt;&gt;Doc: åºå· = 2
    Doc-&gt;&gt;Buckets: buckets[2].count++
    
    Doc-&gt;&gt;GO: Doc2.brand çš„åºå·æ˜¯ï¼Ÿ
    GO--&gt;&gt;Doc: åºå· = 0
    Doc-&gt;&gt;Buckets: buckets[0].count++
    
    Note over Buckets: éå†å®Œæˆåï¼ŒæŒ‰ count æ’åºå– Top N
    
    Buckets-&gt;&gt;GO: åºå· 2 å¯¹åº”çš„å€¼æ˜¯ï¼Ÿ
    GO--&gt;&gt;Buckets: "Xiaomi"
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>åˆ†æ¡¶æ—¶ç”¨æ•´æ•°åºå·ï¼Œé¿å…å­—ç¬¦ä¸²æ¯”è¾ƒ</li>
<li>å†…å­˜ä¸­ç»´æŠ¤çš„æ˜¯ <code>int[] counts</code>ï¼Œæ¯ä¸ªæ¡¶åªå  4 å­—èŠ‚</li>
<li>æœ€åæ‰å°†åºå·è½¬å›å­—ç¬¦ä¸²</li>
</ul>
<h4 data-id="heading-30">date_histogramï¼šæ—¶é—´åŒºé—´åˆ’åˆ†</h4>
<p>date_histogram æŒ‰æ—¶é—´é—´éš”åˆ†æ¡¶ï¼ŒES ä¼šæ ¹æ® <code>calendar_interval</code> æˆ– <code>fixed_interval</code> è®¡ç®—æ¯ä¸ªæ–‡æ¡£è½å…¥å“ªä¸ªæ¡¶ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"orders_over_time"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"date_histogram"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"order_date"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"calendar_interval"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"month"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    %% --- æ ·å¼å®šä¹‰ ---
    classDef doc fill:#e3f2fd,stroke:#1565c0,stroke-width:2px;
    classDef bucket fill:#fff3e0,stroke:#ef6c00,stroke-width:2px;

    %% --- å›¾è¡¨å†…å®¹ ---
    subgraph Docs["åŸå§‹æ–‡æ¡£ (æ—¶é—´æˆ³)"]
        D1["2026-01-15"]:::doc
        D2["2026-01-28"]:::doc
        D3["2026-02-10"]:::doc
        D4["2026-03-05"]:::doc
    end
    
    subgraph Buckets["Date Histogram (æŒ‰æœˆåˆ†æ¡¶)"]
        B1["2026-01 : 2 æ¡"]:::bucket
        B2["2026-02 : 1 æ¡"]:::bucket
        B3["2026-03 : 1 æ¡"]:::bucket
    end
    
    %% --- è¿çº¿ ---
    D1 --&gt; B1
    D2 --&gt; B1
    D3 --&gt; B2
    D4 --&gt; B3
</code></pre>
<p><strong>ä¸¤ç§é—´éš”ç±»å‹çš„åŒºåˆ«</strong>ï¼š</p>




















<table><thead><tr><th>ç±»å‹</th><th>ç¤ºä¾‹</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>calendar_interval</td><td>month, quarter</td><td>è€ƒè™‘æ—¥å†è§„åˆ™ï¼ˆ2æœˆ28å¤©ï¼Œé—°å¹´ç­‰ï¼‰</td></tr><tr><td>fixed_interval</td><td>30d, 1h</td><td>å›ºå®šæ—¶é•¿ï¼Œä¸è€ƒè™‘æ—¥å†</td></tr></tbody></table>
<h4 data-id="heading-31">filters / rangeï¼šæ¡ä»¶åŒ¹é…åˆ†æ¡¶</h4>
<p><strong>filters èšåˆ</strong>ï¼šæ ¹æ®å¤šä¸ªæŸ¥è¯¢æ¡ä»¶åˆ†æ¡¶</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"status_breakdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"filters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"filters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"errors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"level"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"error"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"warnings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"level"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"warn"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ‰§è¡Œæ—¶ï¼ŒES ä¼šå¯¹æ¯ä¸ªæ–‡æ¡£ä¾æ¬¡æ£€æŸ¥æ˜¯å¦åŒ¹é…å„ä¸ª filterã€‚<strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼šå°†åŒ¹é…æ–‡æ¡£æ•°æœ€å¤šçš„ filter æ”¾åœ¨å‰é¢ï¼Œåˆ©ç”¨çŸ­è·¯æ±‚å€¼å‡å°‘è®¡ç®—ã€‚</p>
<p><strong>range èšåˆ</strong>ï¼šæ•°å€¼/æ—¥æœŸåŒºé—´åˆ†æ¡¶</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"price_ranges"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"range"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"price"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ranges"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"to"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"from"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"to"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">500</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"from"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">500</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>range èšåˆä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ç¡®å®šæ–‡æ¡£è½å…¥å“ªä¸ªåŒºé—´ï¼Œæ—¶é—´å¤æ‚åº¦ O(log K)ï¼ŒK ä¸ºåŒºé—´æ•°é‡ã€‚</p>
<h3 data-id="heading-32">4.3 Pipeline èšåˆï¼šå¯¹èšåˆç»“æœçš„äºŒæ¬¡è®¡ç®—</h3>
<p>Pipeline èšåˆä¸ç›´æ¥å¤„ç†æ–‡æ¡£ï¼Œè€Œæ˜¯å¯¹å…¶ä»–èšåˆçš„è¾“å‡ºåšè®¡ç®—ã€‚å®ƒæœ‰ä¸¤ç§æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    %% å®šä¹‰æ ·å¼ç±»
    classDef bucket fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,rx:5,ry:5;
    classDef metric fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,rx:5,ry:5;
    classDef pipeline fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,stroke-dasharray: 5 5,rx:5,ry:5;

    subgraph Parent["Parent Aggregation (çˆ¶çº§æ¨¡å¼)"]
        direction LR
        P1("fa:fa-chart-bar Date Histogram&lt;br/&gt;(æŒ‰æ—¶é—´åˆ†æ¡¶)"):::bucket 
        --&gt; P2("fa:fa-calculator Sum&lt;br/&gt;(è®¡ç®—æ¯ä¸ªæ¡¶çš„æ€»å’Œ)"):::metric
        --&gt; P3("fa:fa-chart-line Derivative&lt;br/&gt;(è®¡ç®—ä¸€é˜¶å¯¼æ•°/å·®å€¼)"):::pipeline
    end
    
    subgraph Sibling["Sibling Aggregation (å…„å¼Ÿæ¨¡å¼)"]
        direction LR
        S1("fa:fa-tags Terms&lt;br/&gt;(æŒ‰ç±»åˆ«åˆ†æ¡¶)"):::bucket
        --&gt; S2("fa:fa-dollar-sign Avg Price&lt;br/&gt;(è®¡ç®—å¹³å‡ä»·æ ¼)"):::metric
        
        %% Sibling èšåˆå®é™…ä¸Šæ˜¯åœ¨åŒçº§æ“ä½œï¼Œä½†æ•°æ®æµæ˜¯åŸºäº S2 çš„ç»“æœ
        S2 -.-&gt; S3("fa:fa-trophy Max Bucket&lt;br/&gt;(æ‰¾å‡º Avg æœ€é«˜çš„æ¡¶)"):::pipeline
    end

    %% æ·»åŠ æ³¨é‡Šè¿æ¥ï¼ˆå¯é€‰ï¼Œä¸ºäº†ç¾è§‚æ’ç‰ˆï¼‰
    Parent ~~~ Sibling
</code></pre>























<table><thead><tr><th>æ¨¡å¼</th><th>è¾“å…¥</th><th>è¾“å‡ºä½ç½®</th><th>å…¸å‹ç”¨æ³•</th></tr></thead><tbody><tr><td>Parent</td><td>çˆ¶æ¡¶å†…çš„å­èšåˆç»“æœ</td><td>åµŒå…¥åˆ°æ¯ä¸ªçˆ¶æ¡¶ä¸­</td><td>derivativeã€moving_avgã€cumulative_sum</td></tr><tr><td>Sibling</td><td>åŒçº§çš„å…¶ä»–èšåˆç»“æœ</td><td>ä¸å…„å¼Ÿèšåˆå¹¶åˆ—</td><td>max_bucketã€avg_bucketã€bucket_selector</td></tr></tbody></table>
<p><strong>å¸¸ç”¨æ–¹æ³•è¯´æ˜</strong>ï¼š</p>

































<table><thead><tr><th>æ–¹æ³•</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>derivative</td><td>è®¡ç®—ç›¸é‚»æ¡¶çš„å·®å€¼ï¼ˆç¯æ¯”å˜åŒ–é‡ï¼‰</td></tr><tr><td>moving_avg</td><td>æ»‘åŠ¨çª—å£å¹³å‡ï¼Œå¹³æ»‘æ›²çº¿æ³¢åŠ¨</td></tr><tr><td>cumulative_sum</td><td>ç´¯è®¡æ±‚å’Œ</td></tr><tr><td>max_bucket</td><td>æ‰¾å‡ºæŒ‡æ ‡å€¼æœ€å¤§çš„æ¡¶</td></tr><tr><td>avg_bucket</td><td>å¯¹æ‰€æœ‰æ¡¶çš„æŒ‡æ ‡å€¼æ±‚å¹³å‡</td></tr><tr><td>bucket_selector</td><td>æŒ‰æ¡ä»¶è¿‡æ»¤æ¡¶ï¼Œä¸¢å¼ƒä¸æ»¡è¶³æ¡ä»¶çš„æ¡¶</td></tr></tbody></table>
<h4 data-id="heading-33">ä¸ºä»€ä¹ˆ Pipeline åªåœ¨åè°ƒèŠ‚ç‚¹æ‰§è¡Œï¼Ÿ</h4>
<p>ä»¥ derivativeï¼ˆæ±‚å¯¼ï¼‰ä¸ºä¾‹ï¼Œå®ƒè¦è®¡ç®—ç›¸é‚»æ—¶é—´æ¡¶ä¹‹é—´çš„å·®å€¼ã€‚å•ä¸ªåˆ†ç‰‡åªæœ‰å±€éƒ¨æ•°æ®ï¼Œæ— æ³•å¾—åˆ°å®Œæ•´çš„æ—¶é—´åºåˆ—ï¼Œè‡ªç„¶ç®—ä¸å‡ºæ­£ç¡®çš„å¯¼æ•°ã€‚</p>
<p><strong>Pipeline èšåˆéœ€è¦å…¨å±€è§†è§’</strong>ï¼Œå› æ­¤å¿…é¡»ç­‰æ‰€æœ‰åˆ†ç‰‡ç»“æœåˆå¹¶åæ‰èƒ½æ‰§è¡Œã€‚è¿™ä¹Ÿæ„å‘³ç€ Pipeline èšåˆçš„å¼€é”€å…¨éƒ¨è½åœ¨åè°ƒèŠ‚ç‚¹ã€‚</p>
<h4 data-id="heading-34">å¸¸è§ Pipeline èšåˆç¤ºä¾‹</h4>
<p><strong>derivativeï¼ˆæ±‚å¯¼/ç¯æ¯”ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sales_per_month"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"date_histogram"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"date"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"calendar_interval"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"month"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"total_sales"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"sum"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"amount"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"sales_change"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"derivative"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"buckets_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"total_sales"</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¾“å‡ºä¸­æ¯ä¸ªæœˆä¼šå¤šä¸€ä¸ª <code>sales_change</code> å­—æ®µï¼Œè¡¨ç¤ºç›¸æ¯”ä¸Šæœˆçš„å˜åŒ–é‡ã€‚</p>
<p><strong>bucket_selectorï¼ˆæ¡¶è¿‡æ»¤ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sales_per_month"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"date_histogram"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"date"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"calendar_interval"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"month"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"total_sales"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"sum"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"amount"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"high_sales_only"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"bucket_selector"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"buckets_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"sales"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"total_sales"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"script"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"params.sales &gt; 10000"</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åªä¿ç•™ total_sales &gt; 10000 çš„æœˆä»½ï¼Œå…¶ä»–æ¡¶ä¼šè¢«ä¸¢å¼ƒã€‚</p>
<h3 data-id="heading-35">å°ç»“</h3>





























<table><thead><tr><th>èšåˆç±»å‹</th><th>æ‰§è¡Œä½ç½®</th><th>å†…å­˜ç‰¹å¾</th><th>æ€§èƒ½å…³é”®ç‚¹</th></tr></thead><tbody><tr><td>Metric</td><td>æ•°æ®èŠ‚ç‚¹</td><td>æå°ï¼ˆå‡ ä¸ªå˜é‡ï¼‰</td><td>cardinality çš„ precision è®¾ç½®</td></tr><tr><td>Bucket</td><td>æ•°æ®èŠ‚ç‚¹</td><td>ä¸æ¡¶æ•°é‡æˆæ­£æ¯”</td><td>æ§åˆ¶åŸºæ•°ï¼Œé¿å…æ¡¶çˆ†ç‚¸</td></tr><tr><td>Pipeline</td><td>åè°ƒèŠ‚ç‚¹</td><td>å–å†³äºè¾“å…¥èšåˆçš„ç»“æœå¤§å°</td><td>å¤æ‚è®¡ç®—å…¨å‹åœ¨åè°ƒèŠ‚ç‚¹</td></tr></tbody></table>
<p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p>
<ul>
<li>éœ€è¦ç²¾ç¡®å»é‡ä¸”åŸºæ•°ä¸é«˜ â†’ ç”¨ terms + è®¡æ•°</li>
<li>éœ€è¦ä¼°ç®—è¶…å¤§åŸºæ•° â†’ ç”¨ cardinality + åˆé€‚çš„ precision_threshold</li>
<li>éœ€è¦æ—¶é—´åºåˆ—åˆ†æ â†’ date_histogram + pipeline èšåˆ</li>
<li>éœ€è¦è¿‡æ»¤èšåˆç»“æœ â†’ bucket_selector æ¯”åœ¨åº”ç”¨å±‚è¿‡æ»¤æ›´é«˜æ•ˆ</li>
</ul>
<h2 data-id="heading-36">5. å¸¸è§æ€§èƒ½ç“¶é¢ˆåˆ†æ</h2>
<p>èšåˆæ…¢æˆ–å¤±è´¥ï¼Œé€šå¸¸æ˜¯ä¸‰ç±»èµ„æºå‡ºäº†é—®é¢˜ï¼šå†…å­˜ã€CPUã€I/Oã€‚</p>
<h3 data-id="heading-37">5.1 å†…å­˜ï¼šæ¡¶çˆ†ç‚¸</h3>
<p><strong>ç°è±¡</strong>ï¼šåè°ƒèŠ‚ç‚¹ OOM æˆ–è§¦å‘ç†”æ–­å™¨ï¼ˆCircuitBreakingExceptionï¼‰</p>
<p><strong>åŸå› </strong>ï¼šæ¡¶æ•°é‡å¤±æ§ã€‚å¸¸è§åœºæ™¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">é«˜åŸºæ•°å­—æ®µ terms èšåˆï¼š
  user_id æœ‰ <span class="hljs-number">1000</span> ä¸‡ä¸ªä¸åŒå€¼
  â†’ æ¯ä¸ªåˆ†ç‰‡è¿”å›å¤§é‡æ¡¶
  â†’ åè°ƒèŠ‚ç‚¹åˆå¹¶æ—¶å†…å­˜çˆ†ç‚¸

å¤šå±‚åµŒå¥—èšåˆï¼ˆé»˜è®¤ DFS æ¨¡å¼ï¼‰ï¼š
  å“ç‰Œ(<span class="hljs-number">1</span>ä¸‡) Ã— åŸå¸‚(<span class="hljs-number">300</span>) Ã— æ¸ é“(<span class="hljs-number">10</span>) = <span class="hljs-number">3000</span> ä¸‡ä¸ªæ¡¶
  â†’ åŒæ—¶é©»ç•™å†…å­˜
</code></pre>
<p><strong>æ’æŸ¥</strong>ï¼šçœ‹ <code>buckets</code> æ•°é‡å’Œ <code>doc_count_error_upper_bound</code></p>
<h3 data-id="heading-38">5.2 CPUï¼šè®¡ç®—å¯†é›†</h3>
<p><strong>ç°è±¡</strong>ï¼šèšåˆè€—æ—¶é•¿ï¼ŒCPU å ç”¨é«˜</p>
<p><strong>åŸå› </strong>ï¼š</p>





















<table><thead><tr><th>åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Script èšåˆ</td><td>æ¯ä¸ªæ–‡æ¡£éƒ½æ‰§è¡Œä¸€æ¬¡è„šæœ¬ï¼Œæ— æ³•åˆ©ç”¨ç´¢å¼•</td></tr><tr><td>æ­£åˆ™è¡¨è¾¾å¼</td><td><code>regexp</code> æŸ¥è¯¢æˆ–è„šæœ¬ä¸­çš„æ­£åˆ™åŒ¹é…</td></tr><tr><td>å¤§é‡ Pipeline èšåˆ</td><td>å…¨éƒ¨åœ¨åè°ƒèŠ‚ç‚¹æ‰§è¡Œï¼Œå•ç‚¹ç“¶é¢ˆ</td></tr></tbody></table>
<p><strong>å…¸å‹æ¡ˆä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// æ¯ä¸ªæ–‡æ¡£éƒ½è¦æ‰§è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¾ˆæ…¢</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"by_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"script"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doc['first_name'].value + ' ' + doc['last_name'].value"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-39">5.3 I/Oï¼šå†·æ•°æ®</h3>
<p><strong>ç°è±¡</strong>ï¼šåŒæ ·çš„èšåˆï¼Œæœ‰æ—¶å¿«æœ‰æ—¶æ…¢</p>
<p><strong>åŸå› </strong>ï¼šDoc Values ä¾èµ– OS Page Cacheã€‚</p>
<pre><code class="hljs">çƒ­æ•°æ®ï¼šå·²ç¼“å­˜åœ¨å†…å­˜ â†’ ç›´æ¥è¯»å– â†’ å¿«
å†·æ•°æ®ï¼šä¸åœ¨ç¼“å­˜ä¸­ â†’ è§¦å‘ç£ç›˜è¯»å–ï¼ˆPage Faultï¼‰ â†’ æ…¢
</code></pre>
<p><strong>æ’æŸ¥</strong>ï¼šç›‘æ§ Page Fault æ¬¡æ•°ï¼Œæˆ–å¯¹æ¯”å†·çƒ­æ•°æ®èšåˆè€—æ—¶ã€‚</p>
<h3 data-id="heading-40">å°ç»“</h3>

























<table><thead><tr><th>ç“¶é¢ˆç±»å‹</th><th>å…¸å‹ç°è±¡</th><th>å¸¸è§åŸå› </th></tr></thead><tbody><tr><td>å†…å­˜</td><td>OOMã€ç†”æ–­</td><td>é«˜åŸºæ•° termsã€å¤šå±‚åµŒå¥—èšåˆ</td></tr><tr><td>CPU</td><td>è€—æ—¶é•¿</td><td>Scriptã€æ­£åˆ™ã€å¤æ‚ Pipeline</td></tr><tr><td>I/O</td><td>æ—¶å¿«æ—¶æ…¢</td><td>å†·æ•°æ®æœªå‘½ä¸­ Page Cache</td></tr></tbody></table>
<p>å®šä½ç“¶é¢ˆåï¼Œä¸‹ä¸€èŠ‚è®²å…·ä½“æ€ä¹ˆä¼˜åŒ–ã€‚</p>
<h2 data-id="heading-41">6. ä¼˜åŒ–æ–¹æ¡ˆå…¨æ™¯</h2>
<p>é’ˆå¯¹ä¸ŠèŠ‚æåˆ°çš„ä¸‰ç±»ç“¶é¢ˆï¼Œä¼˜åŒ–æ€è·¯å¯ä»¥åˆ†ä¸ºå››ä¸ªå±‚é¢ï¼š</p>
<ul>
<li>
<p><strong>ç¡¬ä»¶ä¸æ¶æ„å±‚</strong>ï¼šå†·çƒ­åˆ†ç¦»ã€å†…å­˜é…ç½®ï¼ˆæ²»æœ¬ï¼‰</p>
</li>
<li>
<p><strong>å»ºæ¨¡ä¸é…ç½®ä¼˜åŒ–</strong>ï¼šeager_global_ordinalsã€Rollups é¢„èšåˆ</p>
</li>
<li>
<p><strong>ç¼“å­˜åˆ©ç”¨</strong>ï¼šShard Request Cache</p>
</li>
<li>
<p><strong>æŸ¥è¯¢ä¾§ä¼˜åŒ–</strong>ï¼šFilterã€Samplerã€Compositeã€é¿å… Scriptï¼ˆæ²»æ ‡ï¼‰</p>
</li>
</ul>
<h3 data-id="heading-42">6.1 æŸ¥è¯¢ä¾§ä¼˜åŒ–</h3>
<h4 data-id="heading-43">å…ˆè¿‡æ»¤å†èšåˆ</h4>
<p>èšåˆå‰ç”¨ Filter Context ç¼©å°æ•°æ®èŒƒå›´ï¼Œå‡å°‘æ‰«æé‡ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"bool"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"filter"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"term"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"completed"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"range"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"gte"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-01-01"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"by_brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brand"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-44">é‡‡æ ·èšåˆï¼ˆSamplerï¼‰</h4>
<p>åªå¯¹æ¯ä¸ªåˆ†ç‰‡çš„å‰ N ä¸ªæ–‡æ¡£åšèšåˆï¼Œé€‚åˆå¿«é€Ÿäº†è§£æ•°æ®åˆ†å¸ƒï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sample"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sampler"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"shard_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"by_brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brand"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šç»“æœåªåæ˜ æ ·æœ¬æ•°æ®ï¼Œä¸æ˜¯å¯¹å…¨é‡æ•°æ®çš„ä¼°ç®—ã€‚é€‚ç”¨äºæ¢ç´¢æ€§åˆ†æï¼Œä¸é€‚ç”¨äºç²¾ç¡®ç»Ÿè®¡ã€‚</p>
</blockquote>
<h4 data-id="heading-45">é¿å… Script</h4>
<p>Script èšåˆæ¯ä¸ªæ–‡æ¡£éƒ½è¦æ‰§è¡Œè„šæœ¬ï¼Œå¾ˆæ…¢ã€‚æ›¿ä»£æ–¹æ¡ˆï¼š</p>





















<table><thead><tr><th>åœºæ™¯</th><th>ä¼˜åŒ–æ–¹å¼</th></tr></thead><tbody><tr><td>å­—æ®µæ‹¼æ¥</td><td>å†™å…¥æ—¶ç”¨ <code>copy_to</code> é¢„å¤„ç†</td></tr><tr><td>å­—æ®µè½¬æ¢</td><td>ç”¨ Ingest Pipeline é¢„è®¡ç®—</td></tr><tr><td>æ¡ä»¶åˆ†æ¡¶</td><td>ç”¨ <code>filters</code> èšåˆæ›¿ä»£</td></tr></tbody></table>
<h4 data-id="heading-46">Terms èšåˆä¼˜åŒ–</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"by_brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brand"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"shard_size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"collect_mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"breadth_first"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><code>size</code>ï¼šæœ€ç»ˆè¿”å›æ¡¶æ•°</li>
<li><code>shard_size</code>ï¼šæ¯ä¸ªåˆ†ç‰‡è¿”å›çš„æ¡¶æ•°ï¼Œé€‚å½“è°ƒå¤§å¯æé«˜ç²¾åº¦</li>
<li><code>collect_mode</code>ï¼šé«˜åŸºæ•° + åµŒå¥—èšåˆæ—¶ç”¨ <code>breadth_first</code> æ§åˆ¶å†…å­˜</li>
</ul>
<h4 data-id="heading-47">Composite èšåˆï¼šæµ·é‡æ•°æ®åˆ†é¡µ</h4>
<p>Terms èšåˆä¸é€‚åˆéå†æ‰€æœ‰æ¡¶ã€‚Composite æ”¯æŒ<strong>æ¡¶keyåº</strong>æ¸¸æ ‡åˆ†é¡µæ‹‰å–ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// ç¬¬ä¸€æ¬¡è¯·æ±‚</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"all_brands"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"composite"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brand"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment">// åç»­è¯·æ±‚ï¼Œç”¨ after ç¿»é¡µ</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"all_brands"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"composite"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1000</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"after"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä¸Šä¸€é¡µæœ€åä¸€ä¸ªå€¼"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span>  <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span> <span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brand"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-48">6.2 å»ºæ¨¡ä¸é…ç½®ä¼˜åŒ–</h3>
<h4 data-id="heading-49">é¢„åŠ è½½ Global Ordinals</h4>
<p>Global Ordinals é»˜è®¤åœ¨é¦–æ¬¡èšåˆæ—¶æ„å»ºï¼Œé«˜åŸºæ•°å­—æ®µé¦–æ¬¡æŸ¥è¯¢ä¼šå¾ˆæ…¢ã€‚å¼€å¯é¢„åŠ è½½åï¼Œæ„å»ºå·¥ä½œè½¬ç§»åˆ° Refresh é˜¶æ®µï¼š</p>
<p>json</p>
<pre><code class="hljs language-json" lang="json">PUT /index/_mapping
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"keyword"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"eager_global_ordinals"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>é€‚ç”¨äºï¼šé«˜é¢‘èšåˆå­—æ®µã€‚ä¸é€‚ç”¨äºï¼šå†™å¤šè¯»å°‘çš„å­—æ®µï¼ˆä¼šæ‹–æ…¢å†™å…¥ï¼‰ã€‚</p>
<h4 data-id="heading-50">æ•°æ®é¢„èšåˆï¼ˆRollupsï¼‰</h4>
<p>å†å²æ•°æ®ä¸éœ€è¦æ˜ç»†ï¼Œå¯ä»¥é¢„èšåˆæˆç²—ç²’åº¦ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">åŸå§‹æ•°æ®ï¼šæ¯ç§’ä¸€æ¡ï¼Œä¿ç•™ <span class="hljs-number">7</span> å¤©
<span class="hljs-keyword">Rollup</span>ï¼šæŒ‰å°æ—¶èšåˆï¼Œä¿ç•™ <span class="hljs-number">1</span> å¹´
</code></pre>
<p>æŸ¥è¯¢è¿‘æœŸæ•°æ®èµ°åŸå§‹ç´¢å¼•ï¼ŒæŸ¥è¯¢å†å²èµ° Rollup ç´¢å¼•ï¼Œèšåˆç§’çº§å®Œæˆã€‚</p>
<h4 data-id="heading-51">åŸºæ•°æ§åˆ¶</h4>
<p>è¶…é«˜åŸºæ•°å­—æ®µï¼ˆå¦‚ user_idï¼‰ç›´æ¥ terms èšåˆä¼šå¾ˆæ…¢ã€‚æ–¹æ¡ˆï¼š</p>
<ul>
<li>ç”¨ <code>cardinality</code> + <code>precision_threshold</code> ä¼°ç®—</li>
<li>ä¸šåŠ¡ä¸Šé™åˆ¶æŸ¥è¯¢èŒƒå›´ï¼ˆå¦‚åªæŸ¥æŸä¸ªåŸå¸‚çš„ç”¨æˆ·ï¼‰</li>
</ul>
<h3 data-id="heading-52">6.3 ç¼“å­˜åˆ©ç”¨</h3>
<h4 data-id="heading-53">Shard Request Cache</h4>
<p>ES ä¼šç¼“å­˜ <code>size=0</code> çš„èšåˆè¯·æ±‚ç»“æœã€‚å‘½ä¸­æ¡ä»¶ï¼š</p>
<ul>
<li>è¯·æ±‚å®Œå…¨ç›¸åŒ</li>
<li>åˆ†ç‰‡æ•°æ®æœªå˜æ›´ï¼ˆæ— æ–°å†™å…¥ã€æ—  Refreshï¼‰</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// èƒ½å‘½ä¸­ç¼“å­˜</span>
<span class="hljs-punctuation">{</span> <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> ... <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>

<span class="hljs-comment">// ä¸èƒ½å‘½ä¸­ç¼“å­˜ï¼ˆsize &gt; 0ï¼‰</span>
<span class="hljs-punctuation">{</span> <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> ... <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-54">è®¾è®¡æŸ¥è¯¢ä»¥å‘½ä¸­ç¼“å­˜</h4>
<ul>
<li>å›ºå®šæ—¶é—´èŒƒå›´ï¼šç”¨ <code>"gte": "2024-01-01"</code> è€Œä¸æ˜¯ <code>"gte": "now-7d"</code></li>
<li>èšåˆå’Œæœç´¢åˆ†ç¦»ï¼šèšåˆè¯·æ±‚å•ç‹¬å‘ï¼Œè®¾ <code>size=0</code></li>
</ul>
<h3 data-id="heading-55">6.4 ç¡¬ä»¶ä¸æ¶æ„å±‚</h3>
<h4 data-id="heading-56">å†·çƒ­åˆ†ç¦»</h4>
<pre><code class="hljs">çƒ­èŠ‚ç‚¹ï¼šé«˜é€Ÿ SSD + å¤§å†…å­˜
  â†’ å­˜æ”¾è¿‘æœŸæ•°æ®ï¼ŒèšåˆæŸ¥è¯¢èµ°è¿™é‡Œ

å†·èŠ‚ç‚¹ï¼šæ™®é€šç¡¬ç›˜ + æ™®é€šé…ç½®
  â†’ å­˜æ”¾å†å²æ•°æ®ï¼Œä½é¢‘æŸ¥è¯¢
</code></pre>
<p>é«˜é¢‘èšåˆè·‘åœ¨çƒ­èŠ‚ç‚¹ï¼Œæ•°æ®åœ¨ Page Cache ä¸­ï¼Œé€Ÿåº¦å¿«ã€‚</p>
<h4 data-id="heading-57">å †å†…å­˜ vs å †å¤–å†…å­˜</h4>
<p>Doc Values å­˜åœ¨ç£ç›˜ï¼Œé€šè¿‡ mmap æ˜ å°„åˆ° OS Page Cacheï¼ˆå †å¤–å†…å­˜ï¼‰ã€‚</p>
<p><strong>å¸¸è§è¯¯åŒº</strong>ï¼šæŠŠ JVM Heap è°ƒå¾—å¾ˆå¤§ï¼Œåè€ŒæŒ¤å‹ Page Cache ç©ºé—´ï¼Œèšåˆå˜æ…¢ã€‚</p>
<p><strong>å»ºè®®</strong>ï¼šHeap ä¸è¶…è¿‡ç‰©ç†å†…å­˜çš„ 50%ï¼Œä¸”ä¸è¶…è¿‡ 32GBï¼Œå‰©ä½™ç•™ç»™ OS Cacheã€‚</p>
<h3 data-id="heading-58">å°ç»“</h3>






























<table><thead><tr><th>ä¼˜åŒ–å±‚é¢</th><th>æ–¹æ³•</th><th>è§£å†³çš„ç“¶é¢ˆ</th></tr></thead><tbody><tr><td>æŸ¥è¯¢ä¾§</td><td>Filterã€Samplerã€Compositeã€é¿å… Script</td><td>å‡å°‘æ‰«æé‡ã€æ§åˆ¶æ¡¶æ•°</td></tr><tr><td>å»ºæ¨¡é…ç½®</td><td>eager_global_ordinalsã€Rollups</td><td>å‡å°‘é¦–æ¬¡æ„å»ºå¼€é”€ã€å‡å°‘æ•°æ®é‡</td></tr><tr><td>ç¼“å­˜</td><td>Shard Request Cache</td><td>ç›¸åŒè¯·æ±‚ç›´æ¥è¿”å›</td></tr><tr><td>ç¡¬ä»¶æ¶æ„</td><td>å†·çƒ­åˆ†ç¦»ã€åˆç†é…ç½® Heap</td><td/></tr></tbody></table>
<h2 data-id="heading-59">7. æ¡ˆä¾‹åˆ†æ</h2>
<h3 data-id="heading-60">åœºæ™¯</h3>
<p>7000 ä¸‡æ–‡æ¡£ï¼Œæ¯ä¸ªæ–‡æ¡£æœ‰ <code>categories</code>ï¼ˆå¤šå€¼å­—æ®µï¼Œå…± 140 å¤šä¸ªæ ‡ç­¾ï¼‰å’Œ <code>contentType</code>ï¼ˆ6 ä¸ªå€¼ï¼‰ã€‚éœ€æ±‚ï¼šç»Ÿè®¡æŒ‡å®š 10 ä¸ªåˆ†ç±»æ ‡ç­¾ä¸‹ï¼Œå„ contentType çš„æ–‡æ¡£æ•°é‡ã€‚</p>
<h3 data-id="heading-61">é—®é¢˜</h3>
<p>ç¬¬ä¸€ç§å†™æ³•ï¼Œè€—æ—¶ 6-10 ç§’ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"bool"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"filter"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span> <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"æ ‡ç­¾1"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"æ ‡ç­¾2"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"...å…±10ä¸ª"</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"groupByTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"categories"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"æ ‡ç­¾1"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"æ ‡ç­¾2"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"...å…±10ä¸ª"</span><span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"groupByContentType"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"contentType"</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç¬¬äºŒç§å†™æ³•ï¼Œè€—æ—¶çº¦ 100ms ~ 600msï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"groupByTags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"filters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"filters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"æ ‡ç­¾1"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"term"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ ‡ç­¾1"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"æ ‡ç­¾2"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"term"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ ‡ç­¾2"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-attr">"æ ‡ç­¾10"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"term"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ ‡ç­¾10"</span> <span class="hljs-punctuation">}</span> 
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"groupByContentType"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"terms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"contentType"</span> <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åŒæ ·çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¸ºä»€ä¹ˆ<strong>æ€§èƒ½å·®å‡ å€ç”šè‡³å‡ åå€ï¼Ÿ</strong></p>
<h3 data-id="heading-62">åŸå› åˆ†æ</h3>
<p><strong>terms èšåˆçš„æ‰§è¡Œæ–¹å¼</strong></p>
<pre><code class="hljs language-makefile" lang="makefile">éå†æ‰€æœ‰åŒ¹é…æ–‡æ¡£ï¼ˆè‡³å°‘2000wä¸‡æ¡ï¼‰
  â†’ å¯¹æ¯ä¸ªæ–‡æ¡£ï¼Œè¯»å– categories çš„æ‰€æœ‰å€¼ï¼ˆå¤šå€¼å­—æ®µï¼‰
  â†’ ä¸ºæ¯ä¸ªå€¼åœ¨å¯¹åº”çš„æ¡¶é‡Œè®¡æ•°
  â†’ æœ€åç”¨ <span class="hljs-keyword">include</span> è¿‡æ»¤å‡º 10 ä¸ªæ¡¶è¿”å›
</code></pre>
<p>è™½ç„¶ include åªè¿”å› 10 ä¸ªæ¡¶ï¼Œä½†<strong>éå†å’Œè®¡æ•°çš„å·¥ä½œé‡æ˜¯å…¨é‡çš„</strong>ï¼Œè¦å¤„ç† 2000 ä¸‡æ–‡æ¡£çš„æ‰€æœ‰æ ‡ç­¾å€¼ã€‚</p>
<p><strong>filters èšåˆçš„æ‰§è¡Œæ–¹å¼</strong></p>
<pre><code class="hljs language-css" lang="css">æ‰§è¡Œ <span class="hljs-number">10</span> ä¸ªç‹¬ç«‹çš„ <span class="hljs-attribute">filter</span> æŸ¥è¯¢
  â†’ æ¯ä¸ª <span class="hljs-attribute">filter</span> èµ°å€’æ’ç´¢å¼•ï¼šæ ‡ç­¾ â†’ doc_ids
  â†’ ç›´æ¥æ‹¿åˆ°æ¯ä¸ªæ ‡ç­¾çš„æ–‡æ¡£é›†åˆ
  â†’ ä¸éœ€è¦éå†æ–‡æ¡£è¯»å–å­—æ®µå€¼
</code></pre>
<p>å€’æ’ç´¢å¼•æ˜¯é¢„æ„å»ºçš„ï¼ŒæŸ¥è¯¢æ—¶ç›´æ¥å‘½ä¸­ï¼Œä¸éœ€è¦éå†æ–‡æ¡£ã€‚</p>
<blockquote>
<p>å½“ç„¶ä¸Šé¢çš„ç¬¬äºŒç§æ–¹å¼èšåˆä¸­ï¼Œfilterè·å–åˆ°doc_idsåï¼Œå­èšåˆè¿˜æ˜¯è¦éå†doc_idsçš„æ–‡æ¡£ï¼Œä½† contentType åªæœ‰ 6 ä¸ªå€¼ï¼ŒåŸºæ•°ä½ï¼Œåˆ†æ¡¶å¾ˆå¿«ã€‚</p>
</blockquote>
<p><strong>æ ¸å¿ƒåŒºåˆ«</strong></p>




















<table><thead><tr><th>èšåˆæ–¹å¼</th><th>æ‰§è¡Œé€»è¾‘</th><th>æ•°æ®æ¥æº</th></tr></thead><tbody><tr><td>terms</td><td>éå†æ–‡æ¡£ â†’ è¯»å­—æ®µå€¼ â†’ åˆ†æ¡¶è®¡æ•°</td><td>Doc Valuesï¼ˆæ­£æ’ï¼‰</td></tr><tr><td>filters</td><td>æŸ¥å€’æ’ç´¢å¼• â†’ ç›´æ¥æ‹¿ doc_ids</td><td>å€’æ’ç´¢å¼•</td></tr></tbody></table>
<blockquote>
<p>å½“åªéœ€è¦èšåˆ<strong>å°‘é‡å·²çŸ¥å€¼</strong>æ—¶ï¼Œ<code>filters</code> èšåˆæ¯” <code>terms</code> + <code>include</code> æ›´é«˜æ•ˆã€‚<code>terms</code> é€‚åˆ"ä¸çŸ¥é“æœ‰å“ªäº›å€¼ï¼Œæƒ³çœ‹ Top N"çš„åœºæ™¯ï¼›<code>filters</code> é€‚åˆ"æ˜ç¡®çŸ¥é“è¦å“ªå‡ ä¸ªå€¼"çš„åœºæ™¯ã€‚</p>
</blockquote>
<h2 data-id="heading-63">8. æ€»ç»“</h2>
<p>æœ¬æ–‡ä»åŸç†åˆ°åº”ç”¨ï¼Œç³»ç»Ÿè®²è§£äº† ES èšåˆçš„æ ¸å¿ƒçŸ¥è¯†ï¼š</p>
<p><strong>æ•°æ®ç»“æ„å±‚</strong>ï¼šèšåˆä¾èµ– Doc Valuesï¼ˆåˆ—å¼å­˜å‚¨ï¼‰å’Œ Global Ordinalsï¼ˆå­—ç¬¦ä¸²è½¬æ•°å­—æ˜ å°„ï¼‰ï¼Œç†è§£å®ƒä»¬æ˜¯ä¼˜åŒ–çš„åŸºç¡€ã€‚</p>
<p><strong>æ‰§è¡Œæµç¨‹</strong>ï¼šScatter-Gather æ¨¡å‹ï¼Œå„åˆ†ç‰‡æœ¬åœ°è®¡ç®—ååè°ƒèŠ‚ç‚¹åˆå¹¶ã€‚DFS/BFS ä¸¤ç§æ¨¡å¼å½±å“å†…å­˜å³°å€¼ï¼Œåˆ†å¸ƒå¼èšåˆå­˜åœ¨ç²¾åº¦æŸå¤±ã€‚</p>
<p><strong>èšåˆç±»å‹</strong>ï¼šMetric èšåˆè®¡ç®—æŒ‡æ ‡ï¼ŒBucket èšåˆåˆ†æ¡¶ï¼ŒPipeline èšåˆåšäºŒæ¬¡è®¡ç®—ã€‚cardinality ä½¿ç”¨ HLL++ ç®—æ³•åœ¨ 12KB å†…å­˜å†…ä¼°ç®—ä»»æ„åŸºæ•°ã€‚</p>
<p><strong>æ€§èƒ½ç“¶é¢ˆ</strong>ï¼šå†…å­˜ï¼ˆæ¡¶çˆ†ç‚¸ï¼‰ã€CPUï¼ˆScript/æ­£åˆ™ï¼‰ã€I/Oï¼ˆå†·æ•°æ®ï¼‰ã€‚</p>
<p><strong>ä¼˜åŒ–æ€è·¯</strong>ï¼š</p>
<ul>
<li>å‡å°‘æ‰«æèŒƒå›´ï¼šå…ˆè¿‡æ»¤å†èšåˆ</li>
<li>æ§åˆ¶æ¡¶æ•°é‡ï¼šComposite åˆ†é¡µã€breadth_first</li>
<li>åˆ©ç”¨é¢„è®¡ç®—å’Œç¼“å­˜ï¼šeager_global_ordinalsã€Rollupsã€Shard Request Cache</li>
<li>åˆç†é…ç½®èµ„æºï¼šå†·çƒ­åˆ†ç¦»ï¼ŒHeap ç•™ç©ºé—´ç»™ Page Cache</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[7.7 ä¸‡ä¸ª Claude Code Skillsï¼Œè¿™ä¸ªç½‘ç«™å¸®ä½ æ‰¾åˆ°æƒ³è¦çš„]]></title>    <link>https://juejin.cn/post/7598459769239126050</link>    <guid>https://juejin.cn/post/7598459769239126050</guid>    <pubDate>2026-01-24T12:33:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769239126050" data-draft-id="7598490039488938019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="7.7 ä¸‡ä¸ª Claude Code Skillsï¼Œè¿™ä¸ªç½‘ç«™å¸®ä½ æ‰¾åˆ°æƒ³è¦çš„"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,Claude"/> <meta itemprop="datePublished" content="2026-01-24T12:33:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿è¡¡Eve"/> <meta itemprop="url" content="https://juejin.cn/user/254742428393310"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            7.7 ä¸‡ä¸ª Claude Code Skillsï¼Œè¿™ä¸ªç½‘ç«™å¸®ä½ æ‰¾åˆ°æƒ³è¦çš„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/254742428393310/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿è¡¡Eve
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T12:33:34.000Z" title="Sat Jan 24 2026 12:33:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>ğŸ’ å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯é˜¿è¡¡ï¼Œ 10å¹´+æ¸¸æˆåç«¯å¼€å‘ï¼Œç°åœ¨æ˜¯è‡ªç”±èŒä¸šã€ç‹¬ç«‹æ¸¸æˆå¼€å‘è€…ã€‚</p>
<p>éä¸“ä¸š AI ç©å®¶ï¼Œæ—¥å¸¸å…³æ³¨ AI ç¼–ç¨‹æ–¹å‘çš„å†…å®¹ã€‚</p>
</blockquote>
<p><strong>ğŸ¯ è¿™æ˜¯ Claude Code Skills ç³»åˆ—ï¼Œä»Šå¤©ä»‹ç»ä¸€ä¸ªç½‘ç«™ â€”â€” ç”¨æ¥å‘ç°å¥½ç”¨çš„ Skillã€‚</strong></p>
<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬èŠäº†æ€ä¹ˆæ£€æŸ¥ Skill æ›´æ–°ã€‚ä½†è¿˜æœ‰ä¸ªæ›´åŸºç¡€çš„é—®é¢˜â€”â€” æˆ‘æ€ä¹ˆçŸ¥é“æœ‰ä»€ä¹ˆå¥½ç”¨çš„ Skillï¼Ÿ</p>
<hr/>
<h2 data-id="heading-0">Skills å¤ªå¤šï¼Œæ‰¾ä¸åˆ°</h2>
<p>Claude Code çš„ Skill ç”Ÿæ€å‘å±•å¾—å¾ˆå¿«ï¼Œç°åœ¨å·²ç»æœ‰å¥½å‡ ä¸‡ä¸ªäº†ã€‚</p>
<p>é—®é¢˜æ˜¯ï¼Œè¿™äº› Skill åˆ†æ•£åœ¨ GitHub å„ä¸ªè§’è½ã€‚ä½ æƒ³æ‰¾ä¸ªå¥½ç”¨çš„ï¼Œå¾—è‡ªå·±ä¸€ä¸ªä¸€ä¸ªç¿»ä»“åº“ã€çœ‹ READMEã€åˆ¤æ–­è´¨é‡â€”â€”è¿™ä¹Ÿå¤ªç´¯äº†ã€‚</p>
<p>å°±å¥½æ¯”ä½ æƒ³ä¸‹ä¸ª Appï¼Œç»“æœæ²¡æœ‰åº”ç”¨å•†åº—ï¼Œåªèƒ½åœ¨ç½‘ä¸Šåˆ°å¤„æœå®‰è£…åŒ…ã€‚</p>
<p>è¿™ä¸¤å¤©æ‰¾åˆ°äº†ä¸€ä¸ªç½‘ç«™ï¼Œä¸“é—¨è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-1">Skills.Homes æ˜¯ä»€ä¹ˆ</h2>
<p>ç®€å•è¯´ï¼Œè¿™æ˜¯ Claude Code Skills çš„"åº”ç”¨å•†åº—"ã€‚</p>
<p>ç½‘å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.homes" target="_blank" title="https://skills.homes" ref="nofollow noopener noreferrer">skills.homes</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1176ad17cdf648069a7d5b15e9cc6909~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6KGhRXZl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769862814&amp;x-signature=Rj3iJN3GpQ4I%2Fjnw8xX4vzzrO54%3D" alt="writing-system/outputs/2026-01-24-Skills-Homes-Claude-Skills-å¸‚åœº/images/img_1.png" loading="lazy"/></p>
<p>å®ƒæŠŠåˆ†æ•£åœ¨ GitHub ä¸Šçš„ Skill éƒ½èšåˆåˆ°ä¸€èµ·ï¼Œæä¾›ç»Ÿä¸€çš„æœç´¢å’Œæµè§ˆã€‚</p>
<p>çœ‹æ•°æ®ï¼š</p>
<p><strong>77,492</strong>Â ä¸ªæŠ€èƒ½â€”â€”ç›®å‰æœ€å…¨çš„ Skill ç´¢å¼•</p>
<p><strong>120 ä¸‡+</strong>Â æ¬¡ä¸‹è½½â€”â€”ç¡®å®æœ‰äººåœ¨ç”¨ï¼Œæˆ‘ä¹Ÿæ˜¯è¢«åˆ«äººæ¨èçš„</p>
<p><strong>99.9%</strong>Â æ­£å¸¸è¿è¡Œæ—¶é—´â€”â€”ç¨³å®šæ€§è¿˜è¡Œ</p>
<p>é™¤äº† Claude Codeï¼Œå®ƒè¿˜æ”¯æŒ Eloquent å’Œå…¶ä»–å…¼å®¹ MCP çš„ Agentã€‚ä¸è¿‡æˆ‘æƒ³å¤§å®¶ä¹Ÿä¸»è¦ç”¨æ¥æ‰¾ Claude Code çš„ Skillã€‚</p>
<hr/>
<h2 data-id="heading-2">èƒ½å¹²å˜›</h2>
<h3 data-id="heading-3">å…³é”®è¯æœç´¢</h3>
<p>æœ€ç›´æ¥çš„æ–¹å¼ã€‚ä½ æƒ³è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œç›´æ¥æœã€‚</p>
<p>æ¯”å¦‚æœ "web scraper"ï¼Œä¼šå‡ºæ¥ä¸€å †è·Ÿç½‘é¡µæŠ“å–ç›¸å…³çš„ Skillã€‚æœ "pdf"ï¼Œå°±æ˜¯å¤„ç† PDF çš„ã€‚æœ "git"ï¼Œå°±æ˜¯ Git å·¥ä½œæµç›¸å…³çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c652264176f4d139c8f99043b6dfea5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6KGhRXZl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769862814&amp;x-signature=INO9GsyNBkMYHLhhuzK88R5vc%2BM%3D" alt="writing-system/outputs/2026-01-24-Skills-Homes-Claude-Skills-å¸‚åœº/images/img_2.png" loading="lazy"/></p>
<h3 data-id="heading-4">åˆ†ç±»æµè§ˆ</h3>
<p>å¦‚æœä½ ä¸çŸ¥é“æƒ³æ‰¾ä»€ä¹ˆï¼Œå¯ä»¥æŒ‰åˆ†ç±»é€›ã€‚</p>
<p>å®ƒæœ‰å‡ ä¸ªå¤§ç±»ï¼šå¼€å‘å·¥å…·ã€AI/æ•°æ®ã€DevOpsã€å•†ä¸šåº”ç”¨ç­‰ç­‰ã€‚ç‚¹è¿›å»å°±èƒ½çœ‹åˆ°è¿™ä¸ªç±»åˆ«ä¸‹çš„çƒ­é—¨ Skillã€‚</p>
<p>æœ‰ç‚¹åƒé€›å•†åº—ï¼Œä¸ä¸€å®šè¦ä¹°ä»€ä¹ˆï¼Œå…ˆçœ‹çœ‹æœ‰ä»€ä¹ˆã€‚</p>
<h3 data-id="heading-5">ç²¾é€‰æ¨è</h3>
<p>é¦–é¡µä¼šå±•ç¤ºä¸€äº›çƒ­é—¨æŠ€èƒ½ï¼Œéƒ½æ˜¯ä¸‹è½½é‡å’Œè¯„åˆ†æ¯”è¾ƒé«˜çš„ã€‚</p>
<p>çœå»ä½ è‡ªå·±ç­›é€‰çš„æ—¶é—´ï¼Œç›´æ¥çœ‹å¤§å®¶éƒ½åœ¨ç”¨ä»€ä¹ˆã€‚</p>
<hr/>
<h2 data-id="heading-6">å‡ ä¸ªå€¼å¾—ä¸€è¯•çš„ Skill</h2>
<p>é€›äº†ä¸€åœˆï¼ŒæŒ‘å‡ ä¸ªæˆ‘è§‰å¾—ä¸é”™çš„ï¼š</p>
<p><strong>create-pr</strong>Â â€”â€” Git å·¥ä½œæµå¿…å¤‡ã€‚å¸®ä½ åˆ›å»ºè§„èŒƒçš„ Pull Requestï¼Œæ ‡é¢˜æ ¼å¼éƒ½å¸®ä½ æå®šã€‚17 ä¸‡çš„çƒ­åº¦ï¼ŒåŸºæœ¬æ˜¯æœ€çƒ­é—¨çš„ Skill ä¹‹ä¸€ã€‚</p>
<p><strong>skill-lookup</strong>Â â€”â€” æœ‰ç‚¹å¥—å¨ƒï¼Œè¿™æ˜¯ä¸€ä¸ªå¸®ä½ æ‰¾ Skill çš„ Skillã€‚å½“ä½ åœ¨ Claude Code é‡Œæƒ³æ‰¾æŸä¸ªåŠŸèƒ½ä½†ä¸çŸ¥é“æœ‰æ²¡æœ‰ç°æˆçš„ï¼Œå¯ä»¥ç›´æ¥é—®å®ƒã€‚</p>
<p><strong>review-pr</strong>Â â€”â€” ä»£ç å®¡æŸ¥å·¥å…·ã€‚è®© Claude å¸®ä½  review Pull Requestï¼Œæ‰¾é—®é¢˜ã€æå»ºè®®ã€‚</p>
<p><strong>nextjs-caching</strong>Â â€”â€” åš Next.js çš„åº”è¯¥ä¼šç”¨å¾—ä¸Šï¼Œä¸“é—¨å¤„ç†ç¼“å­˜ç›¸å…³çš„æœ€ä½³å®è·µã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c5e6db071a14c9a8d960fc6ddd315db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6KGhRXZl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769862814&amp;x-signature=cEvudX1CUJcRhdbDbytr2TO6INw%3D" alt="writing-system/outputs/2026-01-24-Skills-Homes-Claude-Skills-å¸‚åœº/images/img_3.png" loading="lazy"/></p>
<p>è¿™äº›åªæ˜¯å†°å±±ä¸€è§’ã€‚7 ä¸‡å¤šä¸ª Skillï¼Œæ€»æœ‰é€‚åˆä½ çš„åœºæ™¯çš„ã€‚</p>
<hr/>
<h2 data-id="heading-7">å®é™…ä½“éªŒ + å°åæ§½</h2>
<p>æ•´ä½“ç”¨ä¸‹æ¥ï¼Œä½“éªŒè¿˜ä¸é”™ã€‚</p>
<p>ç½‘ç«™æœ‰ä¸­æ–‡ç•Œé¢ï¼Œä¸è¿‡ Skill çš„æè¿°åŸºæœ¬éƒ½æ˜¯è‹±æ–‡ã€‚æ¯•ç«Ÿå¤§éƒ¨åˆ† Skill æ˜¯å›½å¤–å¼€å‘è€…å†™çš„ï¼Œè¿™ä¹Ÿæ²¡åŠæ³•ã€‚</p>
<p>åŠ è½½é€Ÿåº¦è¿˜è¡Œï¼Œä¸ç®—å¿«ä½†ä¹Ÿä¸å¡ã€‚</p>
<p>å¦å¤–ï¼Œå®ƒè·Ÿæˆ‘ä¹‹å‰ä»‹ç»çš„ skills-updater å¯ä»¥é…åˆä½¿ç”¨ï¼šskills-updater å¸®ä½ æ£€æŸ¥æ›´æ–°ï¼ŒSkills.Homes å¸®ä½ å‘ç°æ–°çš„å¥½ä¸œè¥¿ã€‚</p>
<p>ä¸€ä¸ªæ˜¯"ç»´æŠ¤"ï¼Œä¸€ä¸ªæ˜¯"å‘ç°"ï¼Œæ­£å¥½äº’è¡¥ã€‚</p>
<hr/>
<h2 data-id="heading-8">å°ç»“</h2>
<p>éœ€è¦æ‰¾ Claude Code Skillï¼Ÿå…ˆæ¥è¿™é‡Œé€›é€›ï¼š</p>
<p>ğŸ‘‰ Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.homes%2Fzh-CN%25C2%25A0%25EF%25BC%2588%25E4%25B8%25AD%25E6%2596%2587%25E7%2589%2588%25EF%25BC%2589" target="_blank" title="https://skills.homes/zh-CN%C2%A0%EF%BC%88%E4%B8%AD%E6%96%87%E7%89%88%EF%BC%89" ref="nofollow noopener noreferrer">skills.homes/zh-CNÂ ï¼ˆä¸­æ–‡ç‰ˆï¼‰</a></p>
<p>7 ä¸‡å¤šä¸ªæŠ€èƒ½éšä¾¿æŒ‘ï¼Œæ€»æ¯”è‡ªå·±åœ¨ GitHub ä¸Šçæ‰¾å¼ºã€‚</p>
<hr/>
<p>ğŸ’¬ ä½ æœ‰ä»€ä¹ˆå¥½ç”¨çš„ Skill æ¨èï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ï¼</p>
<p>ğŸ‘ è§‰å¾—æœ‰ç”¨çš„è¯ï¼Œè®°å¾—ç‚¹èµæ”¶è—ï¼Œè®©æ›´å¤šäººçœ‹åˆ°è¿™ç¯‡æ–‡ç« ï¼</p>
<ul>
<li>#å…¬ä¼—å·ï¼šé˜¿è¡¡çš„AIæ—¥å¸¸</li>
<li>#å°çº¢ä¹¦ï¼šé˜¿è¡¡çš„AIæ—¥å¸¸</li>
<li>#CSDNï¼šDebugEve</li>
<li>#æ˜é‡‘ï¼šé˜¿è¡¡Eve</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€JS ä¸ºä»€ä¹ˆèƒ½è·‘è¿™ä¹ˆå¿«ï¼Ÿä¸€æ–‡æŠŠ V8 â€œç¿»è¯‘å®˜ + åŠ é€Ÿå™¨â€ æœºåˆ¶è®²é€ï¼ˆAST / å­—èŠ‚ç  / JIT / å»ä¼˜åŒ–ï¼‰]]></title>    <link>https://juejin.cn/post/7598574507347165219</link>    <guid>https://juejin.cn/post/7598574507347165219</guid>    <pubDate>2026-01-25T04:05:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598574507347165219" data-draft-id="7598588085596815400" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€JS ä¸ºä»€ä¹ˆèƒ½è·‘è¿™ä¹ˆå¿«ï¼Ÿä¸€æ–‡æŠŠ V8 â€œç¿»è¯‘å®˜ + åŠ é€Ÿå™¨â€ æœºåˆ¶è®²é€ï¼ˆAST / å­—èŠ‚ç  / JIT / å»ä¼˜åŒ–ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-25T04:05:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="swipe"/> <meta itemprop="url" content="https://juejin.cn/user/858052674727959"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€JS ä¸ºä»€ä¹ˆèƒ½è·‘è¿™ä¹ˆå¿«ï¼Ÿä¸€æ–‡æŠŠ V8 â€œç¿»è¯‘å®˜ + åŠ é€Ÿå™¨â€ æœºåˆ¶è®²é€ï¼ˆAST / å­—èŠ‚ç  / JIT / å»ä¼˜åŒ–ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/858052674727959/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    swipe
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T04:05:15.000Z" title="Sun Jan 25 2026 04:05:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä½ çš„ JS åˆ°åº•æ€ä¹ˆè·‘èµ·æ¥çš„ï¼Ÿä¸€æ–‡çœ‹æ‡‚ V8ï¼šä»æºç åˆ°æœºå™¨ç çš„â€œæµæ°´çº¿â€ï¼ˆå«å›¾è§£ï¼‰</h2>
<blockquote>
<p>å†™ä¸‹ <code>console.log('hi')</code> çš„é‚£ä¸€åˆ»ï¼ŒCPU å…¶å®å®Œå…¨çœ‹ä¸æ‡‚ã€‚<br/>
çœŸæ­£è®© JS â€œè·‘èµ·æ¥â€çš„ï¼Œæ˜¯ <strong>JavaScript å¼•æ“</strong>â€”â€”å°¤å…¶æ˜¯ Chrome/Node.js èƒŒåçš„ <strong>V8</strong>ã€‚<br/>
è¿™ç¯‡æ–‡ç« ç”¨ä¸€æ¡æ¸…æ™°çš„æµæ°´çº¿ï¼ŒæŠŠ V8 çš„æ ¸å¿ƒæœºåˆ¶è®²é€ï¼š<strong>Parse â†’ AST â†’ Ignition(å­—èŠ‚ç ) â†’ TurboFan(æœºå™¨ç ) â†’ Deopt(å»ä¼˜åŒ–å›é€€)</strong> ã€‚</p>
</blockquote>
<hr/>
<p>æ–‡ç« æ¨èï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com.cn%2Fdeveloper%2Farticle%2F2453762%3FpolicyId%3D1%26traceId%3D" target="_blank" title="https://cloud.tencent.com.cn/developer/article/2453762?policyId=1&amp;traceId=" ref="nofollow noopener noreferrer">ä»£ç 10å€æé€Ÿï¼åƒé€åº•å±‚æ¶æ„å°±æ˜¯å¦‚æ­¤ç®€å•-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a></p>
<h3 data-id="heading-1">å…ˆå»ºç«‹ç›´è§‰ï¼šV8 æ˜¯ä¸€æ¡â€œç¿»è¯‘+åŠ é€Ÿâ€çš„æµæ°´çº¿</h3>
<p>å¯ä»¥æŠŠ V8 æƒ³è±¡æˆä¸€ä¸ªâ€œä¼šå­¦ä¹ çš„ç¿»è¯‘å®˜â€ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€ç›®æ ‡ï¼šè®©ä»£ç å°½å¿«è·‘èµ·æ¥</strong>ï¼ˆå¯åŠ¨å¿«ï¼‰</li>
<li><strong>ç¬¬äºŒç›®æ ‡ï¼šæŠŠç»å¸¸è·‘çš„ä»£ç è¶Šè·‘è¶Šå¿«</strong>ï¼ˆçƒ­ç‚¹ä¼˜åŒ–ï¼‰</li>
<li><strong>ç¬¬ä¸‰ç›®æ ‡ï¼šå‘ç°å‡è®¾é”™äº†å°±å›é€€é‡æ¥</strong>ï¼ˆå»ä¼˜åŒ– Deoptï¼‰</li>
</ul>
<p>æ¥ä¸‹æ¥æ‰€æœ‰ç»†èŠ‚ï¼Œéƒ½å›´ç»•è¿™ä¸‰å¥è¯å±•å¼€ã€‚</p>
<hr/>
<h3 data-id="heading-2">01ï½œä¸ºä»€ä¹ˆ CPU æ‰æ˜¯æœ€ç»ˆæ‰§è¡Œè€…</h3>
<p>CPUï¼ˆä¸­å¤®å¤„ç†å™¨ï¼‰æ‰§è¡Œçš„æ˜¯æœºå™¨è¯­è¨€â€”â€”ä¸€ä¸²äºŒè¿›åˆ¶æŒ‡ä»¤ã€‚å®ƒä¸è®¤è¯† JavaScriptã€ä¹Ÿä¸è®¤è¯†â€œé«˜çº§è¯­è¨€â€çš„è¯­æ³•ç³–ã€‚</p>
<blockquote>
<p>æ‰€ä»¥ï¼š<strong>CPU æ˜¯â€œæ‰§è¡Œè€…â€ï¼ŒV8 æ˜¯â€œç¿»è¯‘å®˜ + åŠ é€Ÿå™¨â€ã€‚</strong></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f4846426c134e34af3ccec60e3e6cf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=%2BOzkmdSbC3VFvv0KUgfB1g%2FiBew%3D" alt="" loading="lazy"/></p>
<p>å†çœ‹ä¸€å¼ æ›´ç›´è§‚çš„å›¾ï¼šä»£ç æœ€ç»ˆä¸€å®šè¦è½åˆ° CPU å¯æ‰§è¡Œçš„æœºå™¨ç ä¸Šã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06f1b60e9f034fad8e4d2edc2d03d402~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=q71VYhJ%2BQMNiP4mFut9H5HClWwE%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-3">02ï½œJavaScript å¼•æ“åœ¨æµè§ˆå™¨é‡Œå¤„åœ¨ä»€ä¹ˆä½ç½®</h3>
<p>æµè§ˆå™¨å†…æ ¸å¹¶ä¸æ˜¯â€œåªæœ‰æ¸²æŸ“â€ï¼Œå®ƒé€šå¸¸è‡³å°‘åŒ…å«ä¸¤å¤§å—ï¼š</p>
<ul>
<li><strong>æ¸²æŸ“ç›¸å…³</strong>ï¼šHTML/CSS è§£æã€å¸ƒå±€ã€ç»˜åˆ¶</li>
<li><strong>è„šæœ¬ç›¸å…³</strong>ï¼šè§£æå¹¶æ‰§è¡Œ JavaScript</li>
</ul>
<p>ä»¥ WebKit ä¸¾ä¾‹ï¼šå®ƒå¯ä»¥æ‹†æˆ <code>WebCore</code> å’Œ <code>JavaScriptCore</code> ä¸¤éƒ¨åˆ†ï¼ˆJS å¼•æ“å°±æ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94eef3ea00f74d1284ef9ff43da40019~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=2b48w9Gt65H1C8iCBOemSdGPA10%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">03ï½œV8 å…¨æµç¨‹ï¼šä»æºç åˆ°æœºå™¨ç </h3>
<p>æŠŠ V8 çš„æ‰§è¡Œæµç¨‹æµ“ç¼©æˆ 6 æ­¥ï¼Œä¼šéå¸¸æ¸…æ™°ï¼š</p>
<ol>
<li><strong>Parseï¼ˆè§£æï¼‰</strong> ï¼šæºç  â†’ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œå¹¶é‡‡ç”¨ <strong>Lazy Parsing</strong>ï¼ˆå‡½æ•°å³å°†æ‰§è¡Œæ—¶æ‰å®Œæ•´è§£æï¼‰</li>
<li><strong>Ignitionï¼ˆè§£é‡Šå™¨ï¼‰</strong> ï¼šAST â†’ <strong>å­—èŠ‚ç  Bytecode</strong></li>
<li><strong>æ‰§è¡Œå­—èŠ‚ç </strong>ï¼šå…ˆè·‘èµ·æ¥ï¼Œå¹¶æ”¶é›†è¿è¡Œä¿¡æ¯ï¼ˆç±»å‹ã€åˆ†æ”¯ã€è°ƒç”¨é¢‘ç‡â€¦ï¼‰</li>
<li><strong>TurboFanï¼ˆä¼˜åŒ–ç¼–è¯‘å™¨ï¼‰</strong> ï¼šçƒ­ç‚¹ä»£ç  â†’ <strong>ä¼˜åŒ–åçš„æœºå™¨ç </strong></li>
<li><strong>Deoptï¼ˆå»ä¼˜åŒ–ï¼‰</strong> ï¼šå‡è®¾ä¸æˆç«‹ï¼ˆå¸¸è§æ˜¯ç±»å‹å˜åŒ–ï¼‰â†’ å›é€€åˆ°å­—èŠ‚ç </li>
<li><strong>æœºå™¨ç æ‰§è¡Œ</strong>ï¼šæœ€ç»ˆäº¤ç»™ CPU</li>
</ol>
<p>ç”¨ä¸€å¼ å›¾æŠŠè¿™æ¡æµæ°´çº¿é’‰æ­»åœ¨è„‘å­é‡Œï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d331e1cca4fd4142bdae3d2dc7f2372f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=W5wmirSfN7cAePmlct4OMGyAwao%3D" alt="" loading="lazy"/></p>
<p>åŒæ—¶ï¼ŒAST é•¿ä»€ä¹ˆæ ·ï¼Ÿå¤§æ¦‚æ˜¯è¿™ç§ç»“æ„åŒ–æ ‘å½¢è¡¨ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f20e5336bdb04b4dbffc38ae4a7044ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=%2F0S31f98DDWGKMd%2FjFERc3oyCsM%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">04ï½œParse ç»†èŠ‚ï¼šè¯æ³•åˆ†æã€è¯­æ³•åˆ†æä¸ AST</h3>
<p>å¾ˆå¤šäººå¡åœ¨â€œParse è§£æâ€è¿™ä¸€æ­¥ï¼ŒåŸå› æ˜¯ï¼š<strong>æ¦‚å¿µåè¯å¤šï¼Œä½†ç›´è§‰ä¸å¤Ÿ</strong>ã€‚</p>
<h4 data-id="heading-6">4.1 è¯æ³•åˆ†æï¼šæŠŠä»£ç æ‹†æˆ tokenï¼ˆæœ€å°è¯­æ³•å•å…ƒï¼‰</h4>
<p>å¯ä»¥ç†è§£ä¸ºâ€œæ‹†è¯â€â€”â€”æŠŠä¸€æ®µ JS æºç æ‹†æˆä¸€ä¸ªä¸ªæœ€å°çš„è®°å·ï¼ˆtokenï¼‰ï¼š</p>
<ul>
<li>å…³é”®å­— <code>function</code></li>
<li>æ ‡è¯†ç¬¦ <code>sayHi</code></li>
<li>è¿ç®—ç¬¦ <code>=</code>, <code>+</code></li>
<li>æ ‡ç‚¹ç¬¦å· <code>()</code>, <code>{}</code>, <code>;</code></li>
<li>å­—é¢é‡ <code>"Hi "</code></li>
</ul>
<h4 data-id="heading-7">4.2 è¯­æ³•åˆ†æï¼šæŠŠ token é‡æ–°ç»„è£…æˆæ ‘ï¼ˆASTï¼‰</h4>
<p>å¯ä»¥ç†è§£ä¸ºâ€œé€ å¥â€â€”â€”æŠŠ token æŒ‰è¯­æ³•è§„åˆ™ç»„è£…æˆç»“æ„åŒ–è¡¨è¾¾ï¼Œè¿™æ£µæ ‘å°±æ˜¯ ASTã€‚</p>
<p>ä¸€ä¸ªå¥½è®°çš„å£è¯€ï¼š</p>
<blockquote>
<p><strong>å…ˆè¯åè¯­</strong>ï¼šå…ˆæŠŠâ€œå•è¯â€æ‹†å‡ºæ¥ï¼Œå†æŠŠâ€œè¯­å¥ç»“æ„â€æ­èµ·æ¥ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">05ï½œä¸ºä»€ä¹ˆè¦ä¿ç•™â€œå­—èŠ‚ç â€è¿™ä¸€å±‚</h3>
<p>ç›´è§‰ä¸Šä¼šè§‰å¾—ï¼š<strong>å°‘ä¸€å±‚è½¬æ¢å°±æ›´å¿«</strong>ï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ AST â†’ æœºå™¨ç ï¼Ÿ</p>
<p>å› ä¸ºå·¥ç¨‹é‡ŒçœŸæ­£çš„ç›®æ ‡ä¸æ˜¯â€œæŸä¸€æ­¥æœ€å¿«â€ï¼Œè€Œæ˜¯â€œæ•´ä½“æ›´å¿«ã€æ›´ç¨³ã€æ›´å¯æ§â€ã€‚ä¿ç•™å­—èŠ‚ç ä¸»è¦å¸¦æ¥ï¼š</p>
<ol>
<li><strong>è·¨å¹³å°</strong>ï¼šå­—èŠ‚ç ä¸ç»‘å®šæŸä¸€ç§ CPU æŒ‡ä»¤é›†</li>
<li><strong>ä¼˜åŒ–æ›´èªæ˜</strong>ï¼šå…ˆè·‘å­—èŠ‚ç ï¼Œæ”¶é›†è¿è¡Œæ•°æ®ï¼Œå†å†³å®šæ€ä¹ˆç”Ÿæˆæ›´ä¼˜æœºå™¨ç </li>
<li><strong>æ›´å®‰å…¨ã€æ›´å¯æ§</strong>ï¼šæ›´å®¹æ˜“åšéš”ç¦»ã€ç­–ç•¥ã€å†…å­˜ç®¡ç†</li>
<li><strong>æ›´å®¹æ˜“è°ƒè¯•</strong>ï¼šæ–­ç‚¹/å•æ­¥åœ¨å­—èŠ‚ç å±‚æ›´å®¹æ˜“å®ç°</li>
</ol>
<p>é…åˆè¿™å¼ å›¾ç†è§£ï¼Œä¼šå¾ˆé¡ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1c22d73a1974c83a354868f97bffadc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=yYBoTvjbHeeNkEkdkyAMkHZRjRI%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-9">06ï½œæ¶æ„æ‹†è§£ï¼šParse / Ignition / TurboFan å„åšä»€ä¹ˆ</h3>
<p>ç”¨â€œå²—ä½èŒè´£â€æ¥è®°ï¼š</p>
<ul>
<li><strong>Parse</strong>ï¼šæŠŠ JS ä»£ç å˜æˆ ASTï¼ˆè§£é‡Šå™¨ä¸ç›´æ¥è®¤è¯† JS æºç ï¼‰</li>
<li><strong>Ignition</strong>ï¼šæŠŠ AST å˜æˆå­—èŠ‚ç å¹¶æ‰§è¡Œï¼ŒåŒæ—¶æ”¶é›† TurboFan éœ€è¦çš„è¿è¡Œä¿¡æ¯ï¼ˆæ¯”å¦‚ç±»å‹ä¿¡æ¯ï¼‰</li>
<li><strong>TurboFan</strong>ï¼šæŠŠçƒ­ç‚¹å­—èŠ‚ç ç¼–è¯‘æˆæ›´å¿«çš„æœºå™¨ç ï¼ˆå¹¶æŒç»­è¿­ä»£ä¼˜åŒ–ï¼‰</li>
</ul>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸å…³é”®çš„è¿è¡Œè§„å¾‹ï¼š</p>
<blockquote>
<p><strong>çƒ­ç‚¹å‡½æ•°ä¼šè¢«ä¼˜åŒ–</strong>ï¼Œä½†<strong>ç±»å‹å˜åŒ–ç­‰æƒ…å†µä¼šè§¦å‘å»ä¼˜åŒ–å›é€€</strong>ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-10">07ï½œé¢„è§£æ vs å…¨é‡è§£æï¼šLazy Parsing ä¸ºä»€ä¹ˆèƒ½è®©å¯åŠ¨æ›´å¿«</h3>
<p>V8 å¹¶ä¸ä¼šâ€œä¸Šæ¥å°±æŠŠä¸€åˆ‡éƒ½è§£æå¾—å·¨ç»†æ— é—â€ï¼Œå®ƒä¼šåšå–èˆï¼š</p>
<h4 data-id="heading-11">7.1 é¢„è§£æï¼ˆPre-parsingï¼‰</h4>
<ul>
<li>ç›®æ ‡ï¼š<strong>å¿«é€Ÿæ‰«æ</strong>ï¼Œæå–ç»“æ„ä¿¡æ¯ï¼ˆå˜é‡/å‡½æ•°å£°æ˜ç­‰ï¼‰</li>
<li>ç‰¹ç‚¹ï¼šä¸æ·±æŒ–å‡½æ•°ä½“å†…éƒ¨é€»è¾‘ â†’ <strong>æ›´å¿«</strong></li>
</ul>
<h4 data-id="heading-12">7.2 å…¨é‡è§£æï¼ˆFull parsingï¼‰</h4>
<ul>
<li>ç›®æ ‡ï¼šæŠŠå‡½æ•°ä½“ã€è¡¨è¾¾å¼ã€è¯­å¥ç»†èŠ‚å…¨éƒ¨å»ºå‡ºæ¥</li>
<li>ç‰¹ç‚¹ï¼šAST æ›´å®Œæ•´ â†’ ä¾¿äºåç»­ç”Ÿæˆå­—èŠ‚ç ä¸ä¼˜åŒ–</li>
</ul>
<p>å› æ­¤ï¼Œâ€œå‡½æ•°æ²¡æ‰§è¡Œä¼šä¸ä¼šç”Ÿæˆ ASTï¼Ÿâ€æ›´å‡†ç¡®çš„å›ç­”æ˜¯ï¼š</p>
<ul>
<li>ä¼šç”Ÿæˆä¸€ä¸ª<strong>ç®€åŒ–çš„ç»“æ„æ¶å­</strong>ï¼ˆé¢„è§£æï¼‰</li>
<li>çœŸè¦æ‰§è¡Œä¹‹å‰ï¼Œä¼šè¡¥é½ä¸º<strong>å®Œæ•´ AST</strong>ï¼ˆå…¨é‡è§£æï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-13">08ï½œèµ°ä¸€éå®˜æ–¹å›¾ï¼štokenã€ASTã€å­—èŠ‚ç åˆ°åº•æ€ä¹ˆæ¥çš„</h3>
<p>å…ˆå‡†å¤‡ä¸€æ®µæ¨¡æ¿ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">name = <span class="hljs-string">"XiaoWu"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name)

<span class="hljs-keyword">function</span> <span class="hljs-title function_">sayHi</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hi "</span> + name)
}

<span class="hljs-title function_">sayHi</span>(name)
</code></pre>
<h4 data-id="heading-14">8.1 å®˜æ–¹æµç¨‹å›¾ï¼šä»è¾“å…¥åˆ°å­—èŠ‚ç </h4>
<p>è¿™å¼ å›¾éå¸¸ç»å…¸ï¼Œå»ºè®®æ”¶è—ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb56f664de504858a28148774bbce437~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=u7hcfXy0wvU6JoM52PV5NCW%2BGeI%3D" alt="" loading="lazy"/></p>
<p>æŒ‰å›¾ç†è§£å°±æ˜¯ï¼š</p>
<ul>
<li><strong>Scanner</strong>ï¼šæ‰«æå­—ç¬¦æµ â†’ ç”Ÿæˆ tokens</li>
<li><strong>PreParser</strong>ï¼šåšé¢„è§£æï¼ˆå¿«é€Ÿåˆ¤æ–­ç»“æ„ï¼‰</li>
<li><strong>Parser</strong>ï¼šæ„å»º AST</li>
<li><strong>Bytecode</strong>ï¼šAST â†’ å­—èŠ‚ç </li>
</ul>
<h4 data-id="heading-15">8.2 token é•¿ä»€ä¹ˆæ ·ï¼ˆè¯æ³•åˆ†æç»“æœï¼‰</h4>
<p>ä¸‹é¢æ˜¯å…¸å‹ token å½¢æ€ï¼ˆæ‘˜å–å…³é”®ç±»å‹ï¼Œæ–¹ä¾¿ç†è§£ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Keyword'</span>, value=<span class="hljs-string">'const'</span>)            // å…³é”®å­—
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Identifier'</span>, value=<span class="hljs-string">'name'</span>)          // æ ‡è¯†ç¬¦
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Operator'</span>, value=<span class="hljs-string">'='</span>)               // è¿ç®—ç¬¦
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'StringLiteral'</span>, value=<span class="hljs-string">'"coderwhy and XiaoYu"'</span>) // å­—ç¬¦ä¸²å­—é¢é‡
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Punctuation'</span>, value=<span class="hljs-string">';'</span>)            // æ ‡ç‚¹ç¬¦å·

Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Identifier'</span>, value=<span class="hljs-string">'console'</span>)
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Punctuation'</span>, value=<span class="hljs-string">'.'</span>)
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Identifier'</span>, value=<span class="hljs-string">'log'</span>)
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Punctuation'</span>, value=<span class="hljs-string">'('</span>)
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Identifier'</span>, value=<span class="hljs-string">'name'</span>)
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Punctuation'</span>, value=<span class="hljs-string">')'</span>)
Token(<span class="hljs-attr">type</span>=<span class="hljs-string">'Punctuation'</span>, value=<span class="hljs-string">';'</span>)
</code></pre>
<h4 data-id="heading-16">8.3 è¯­æ³•åˆ†æï¼šé¢„è§£æå¦‚ä½•å‚ä¸</h4>
<p>è¿™å¼ å›¾ä¸“é—¨è§£é‡Šâ€œé¢„è§£æ/è§£æâ€çš„å…³ç³»ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69d4f091bbd44a128203c9a3397c469a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=BX4sf3Gu16qsnoFqomP1hVFGcjg%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-17">09ï½œçƒ­ç‚¹ä¼˜åŒ–ä¸å»ä¼˜åŒ–ï¼šä¸ºä»€ä¹ˆâ€œæœ‰æ—¶çªç„¶å˜æ…¢â€</h3>
<p>V8 ä¼šæŠŠè¢«é¢‘ç¹æ‰§è¡Œçš„å‡½æ•°æ ‡è®°ä¸º <strong>çƒ­ç‚¹å‡½æ•°</strong>ï¼Œç„¶åäº¤ç»™ TurboFan ç¼–è¯‘ä¸ºæ›´å¿«çš„æœºå™¨ç ã€‚</p>
<p>ä½†æ³¨æ„ï¼š<strong>ä¼˜åŒ–æ˜¯æœ‰å‰æå‡è®¾çš„</strong>ã€‚æœ€å¸¸è§çš„å‡è®¾å°±æ˜¯â€œç±»å‹ç¨³å®šâ€ã€‚</p>
<p>æ¥çœ‹è¿™ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">function sum (num1,num2){
  return num1 + num2
}

<span class="hljs-comment">// å¤šæ¬¡è°ƒç”¨ -&gt; å¯èƒ½æˆä¸ºçƒ­ç‚¹å‡½æ•° -&gt; è¢«ä¼˜åŒ–</span>
<span class="hljs-built_in">sum</span>(<span class="hljs-number">20</span>,<span class="hljs-number">20</span>)
<span class="hljs-built_in">sum</span>(<span class="hljs-number">20</span>,<span class="hljs-number">20</span>)

<span class="hljs-comment">// ç±»å‹çªç„¶å˜åŒ– -&gt; ä¹‹å‰çš„æœºå™¨ç å‡è®¾ä¸æˆç«‹ -&gt; å»ä¼˜åŒ–å›é€€</span>
<span class="hljs-built_in">sum</span>('xiaoyu','coderwhy')
</code></pre>
<p>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>å‰ä¸¤æ¬¡ä¼ å…¥ <code>number</code>ï¼Œä¼˜åŒ–å™¨å¯èƒ½ä¼šå‡è®¾â€œè¿™é‡Œä¸€ç›´æ˜¯ number åŠ æ³•â€</li>
<li>ç¬¬ä¸‰æ¬¡çªç„¶å˜æˆ <code>string</code> æ‹¼æ¥ï¼Œæœºå™¨ç å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç† â†’ <strong>å›é€€åˆ°å­—èŠ‚ç é‡æ–°æ”¶é›†ä¿¡æ¯ï¼Œå†å†³å®šæ˜¯å¦é‡æ–°ä¼˜åŒ–</strong></li>
</ul>
<p>è¿™å°±æ˜¯æ€§èƒ½â€œæŠ–ä¸€ä¸‹â€çš„æ ¹æºä¹‹ä¸€ï¼š<strong>Deoptï¼ˆå»ä¼˜åŒ–ï¼‰</strong> ã€‚</p>
<hr/>
<h3 data-id="heading-18">10ï½œå­—èŠ‚ç ä¸æœºå™¨ç ï¼ˆäº†è§£å³å¯ï¼‰ï¼šJIT åˆ°åº•åšäº†ä»€ä¹ˆ</h3>
<p>æœºå™¨ç çš„ç”Ÿæˆé€šå¸¸ä¾èµ– <strong>JITï¼ˆJust-In-Time Compilationï¼Œå³æ—¶ç¼–è¯‘ï¼‰</strong> ï¼š</p>
<ul>
<li>æŠŠå­—èŠ‚ç è½¬æ¢æˆæœ¬åœ°æœºå™¨ç </li>
<li>æŠŠç»“æœç¼“å­˜èµ·æ¥</li>
<li>åç»­æ‰§è¡Œç›´æ¥å¤ç”¨ç¼“å­˜çš„æœºå™¨ç ï¼ˆæ›´å¿«ï¼‰</li>
</ul>
<p>TurboFan ä½œä¸ºä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œä¼šåŸºäº IRï¼ˆä¸­é—´è¡¨ç¤ºï¼‰åšå¤šå±‚ä¼˜åŒ–ï¼ˆç±»å‹ã€å†…è”ã€æ§åˆ¶æµç­‰ï¼‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9026bf89ba4e4ae293a03753ebf02b23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=gyVYCGNPq8MZK6g4Dk2MGB1%2BqpM%3D" alt="" loading="lazy"/></p>
<p>åŒæ—¶ï¼Œå­—èŠ‚ç åˆ°æœºå™¨ç çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨ä¸åŒä¼˜åŒ–ç­–ç•¥ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5f87e40aeb04e599978ce8cf1a20903~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=%2Fzr3siXqiQ8b2LQdwewqn5Fn0mA%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œè¿˜æœ‰ä¸¤å¼ é…å›¾ï¼ˆä¿æŒåŸæ ·ä¿ç•™ï¼‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca7fe53e26f54a30beb3daaf60c0d034~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=9PGR9PBzituMzUOMMsuZasHTcQo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/346599b792034889bd49dfada16ae9c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918715&amp;x-signature=4JKFy2eKYoblhAIs%2FA23eK35qH4%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-19">ç»“å°¾ï¼šæŠŠçŸ¥è¯†ç”¨èµ·æ¥</h3>
<p>ç†è§£ V8 çš„æ„ä¹‰ï¼Œä¸æ˜¯ä¸ºäº†èƒŒåè¯ï¼Œè€Œæ˜¯ä¸ºäº†å½¢æˆâ€œæ€§èƒ½ç›´è§‰â€ï¼š</p>
<ul>
<li><strong>è®©çƒ­ç‚¹å‡½æ•°æ›´å®¹æ˜“è¢«ä¼˜åŒ–</strong>ï¼šå‚æ•°ç±»å‹å°½é‡ç¨³å®š</li>
<li><strong>å‡å°‘å»ä¼˜åŒ–å›é€€</strong>ï¼šé¿å…åŒä¸€æ®µçƒ­ç‚¹è·¯å¾„é‡Œé¢‘ç¹å‡ºç°ç±»å‹æ¼‚ç§»</li>
<li><strong>ç†è§£å¯åŠ¨æ€§èƒ½</strong>ï¼šLazy Parsing çš„ç­–ç•¥å†³å®šäº†â€œå…ˆè·‘èµ·æ¥â€çš„å¿«æ…¢</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025ï¼šä»å¿ƒå‡ºå‘]]></title>    <link>https://juejin.cn/post/7598732691769868339</link>    <guid>https://juejin.cn/post/7598732691769868339</guid>    <pubDate>2026-01-25T04:12:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598732691769868339" data-draft-id="7598699872552091684" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025ï¼šä»å¿ƒå‡ºå‘"/> <meta itemprop="keywords" content="å¹´ç»ˆæ€»ç»“"/> <meta itemprop="datePublished" content="2026-01-25T04:12:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹¬æ³ªäº†æ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2981531265546328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025ï¼šä»å¿ƒå‡ºå‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2981531265546328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹¬æ³ªäº†æ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T04:12:22.000Z" title="Sun Jan 25 2026 04:12:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç¯‡</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17632fc6f8f54654a916f83027b14ae9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769919142&amp;x-signature=4x8%2FghK1TkFu80teOmasYH1xZGI%3D" alt="image" loading="lazy"/></p>
<p>æ—¶å…‰è½»è¯­ï¼Œå²æœˆç•™ç—•ï¼›</p>
<p>æ„Ÿæ©åŒè¡Œç‚¹æ»´ï¼Œå…±èµ´æ˜æ—¥æ™´ç©ºã€‚</p>
<p>æ„¿å¿ƒä¹‹æ‰€å‘ï¼Œèº«ä¹‹æ‰€å¾€ï¼Œçš†ç¿è‹¥æ˜Ÿè¾°âœ¨</p>
<h2 data-id="heading-1">â€œåæµªâ€æ¥äº†ï¼šæ–°æŠ€æœ¯æµªæ½®ä¸‹çš„é‡æ–°æ´—ç‰Œ</h2>
<p>â€ƒâ€ƒ2025å¹´çš„æ˜¥å¤©ï¼Œå¾ˆå¤š Java ç¨‹åºå‘˜éƒ½æ„Ÿå—åˆ°äº†å¯’æ„ã€‚ä»ä¸€çº¿å¤§å‚åˆ°å¤–åŒ…å…¬å¸ï¼Œä»é‡‘èåˆ°åˆ¶é€ ä¸šï¼Œé¡¹ç›®å»¶æœŸã€ä¸šåŠ¡æ”¶ç¼©ã€é¢„ç®—å‰Šå‡ï¼Œæˆäº†èŒåœºçš„å…³é”®è¯ã€‚è¿‡å»æˆ‘ä»¬ä»¥ä¸ºâ€œåªè¦ä¼šSpring Bootã€MyBatisã€Redisã€Kafkaï¼Œå°±èƒ½åƒä¸€è¾ˆå­é¥­â€ï¼Œä½†ç°åœ¨å´å‘ç°ï¼Œè¿™äº›åªæ˜¯â€œå…¥é—¨æ ‡é…â€ï¼ŒAIã€ä½ä»£ç ã€äº‘åŸç”Ÿã€å¾®æœåŠ¡æ¶æ„ã€DevOpsã€ç®—æ³•ä¼˜åŒ–â€¦â€¦å“ªä¸€æ ·ä¸åœ¨é€¼ç€æˆ‘ä»¬é‡æ–°å­¦ä¹ ï¼Ÿ</p>
<p>â€ƒâ€ƒ2015 å¹´ï¼Œæˆ‘ä»¬æ‹¼çš„æ˜¯æ¡†æ¶å’Œè¯­æ³•ï¼ŒSpringã€MyBatisã€Dubboã€Kafkaï¼Œè°æŒæ¡å¿«ï¼Œè°å‡å¾—å¿«ã€‚2020 å¹´ï¼Œæˆ‘ä»¬æ‹¼çš„æ˜¯æ¶æ„å’Œç»éªŒï¼Œå¾®æœåŠ¡ã€åˆ†å¸ƒå¼ã€ç½‘å…³ã€é“¾è·¯è¿½è¸ªâ€¦â€¦é‚£æ—¶çš„åç«¯ï¼Œä¾ç„¶åƒé¦™ã€‚å¯ 2025 å¹´ä¸åŒäº†ï¼Œä¼ä¸šæ‹›è˜éœ€æ±‚çš„å…³é”®è¯å·²ç»æ‚„æ‚„å˜äº†ï¼Œç®€å•å†™ CRUD çš„ Java ç¨‹åºå‘˜ï¼Œæ­£åœ¨è¢«AIæ›¿ä»£ï¼Œè€Œé‚£äº›æ‡‚æ¶æ„ã€æ‡‚ä¸šåŠ¡ã€èƒ½é©¾é©­ç³»ç»Ÿå¤æ‚æ€§çš„å¼€å‘è€…ï¼Œæ­£åœ¨æˆä¸ºæ–°çš„é¦™é¥½é¥½ã€‚è¿™ä¸æ˜¯â€œåç«¯å¤±ä¸šè®ºâ€ï¼Œè€Œæ˜¯åç«¯è¿›åŒ–è®ºï¼šä½ ä¸å˜ï¼Œå°±ä¼šè¢«æ—¶ä»£è¿›åŒ–æ‰ã€‚</p>
<p>â€ƒâ€ƒè¿™ä¸€å¹´ï¼Œå‡ ä¹æ¯ä¸ªç”²æ–¹éƒ½åœ¨å–Šâ€œä¿¡åˆ›é€‚é…â€ï¼Œéº’éºŸã€é‡‘ä»“ã€è¾¾æ¢¦ã€ç»Ÿä¿¡ã€ç€šé«˜â€¦â€¦å›½äº§ç³»ç»Ÿå…¨é¢æ¥ç®¡æ”¿ä¼é¡¹ç›®ã€‚è¿™ä¸æ˜¯ç®€å•çš„â€œæ¢ç³»ç»Ÿâ€ï¼Œè€Œæ˜¯æ•´ä¸ªç”Ÿæ€çš„é‡æ„ã€‚è€Œè¿™ï¼Œä¹Ÿç»™åç«¯å¸¦æ¥äº†æ–°çš„ç”Ÿæœºã€‚æœªæ¥çš„åç«¯ï¼Œä¸æ˜¯â€œå†™æ¥å£çš„äººâ€ï¼Œè€Œæ˜¯â€œæ‡‚ç³»ç»Ÿã€æ‡‚æ¶æ„ã€æ‡‚ä¸šåŠ¡â€çš„äººã€‚</p>
<h2 data-id="heading-2">æˆ‘ä»¬åœ¨å¤¹ç¼ä¸­ç”Ÿé•¿ï¼Œå´è¶Šæ¥è¶Šå¼º</h2>
<p>â€ƒâ€ƒæœ‰äººè¯´â€œç¨‹åºå‘˜æŒºå¥½ï¼ŒæŠ€æœ¯ç¨³å®šã€æ”¶å…¥é«˜ã€ä¸ç”¨ç¤¾äº¤â€ï¼Œå¯ä»–ä»¬æ²¡çœ‹åˆ°ï¼šæ¯å¤©å‡Œæ™¨çš„ä½ ï¼Œå¯¹ç€æ—¥å¿—å“­ç¬‘ä¸å¾—ï¼›æ¯æ¬¡é‡æ„å‰çš„ä½ ï¼Œå¯¹æœªæ¥å……æ»¡ç„¦è™‘ï¼›æ¯å½“çœ‹åˆ°â€œAIè¦å–ä»£ç¨‹åºå‘˜â€çš„æ–°é—»æ—¶ï¼Œä½ å¿ƒé‡Œé‚£ç§éšéšçš„ä¸å®‰ã€‚æ¯ä¸€ä¸ªç¨‹åºå‘˜ï¼Œéƒ½æœ‰ä¸€ä»½æ‰§å¿µã€‚ä¸æ˜¯ä¸ºäº†å·¥èµ„ï¼Œè€Œæ˜¯ä¸ºäº†<strong>é‚£ç§æ§åˆ¶ä¸–ç•Œçš„å¿«æ„Ÿ</strong>ã€‚å½“ä½ çš„æ¥å£ç¬¬ä¸€æ¬¡è·‘é€šï¼Œä½ åˆ›é€ äº†ä¸€ä¸ªä¸–ç•Œçš„â€œæ•°æ®é€šé“â€ï¼›å½“ä½ çš„å‰ç«¯ç”»é¢ç¬¬ä¸€æ¬¡ç‚¹äº®ï¼Œä½ æ„å»ºäº†ä¸€ä¸ªä¸–ç•Œçš„â€œè§†è§‰å…¥å£â€ï¼›å½“ä½ çš„ç³»ç»Ÿæ‰¿è½½äº†ä¸‡äººè®¿é—®ï¼Œä½ æ’‘èµ·äº†ä¸€ä¸ªä¸–ç•Œçš„â€œç§©åºéª¨æ¶â€ã€‚è¿™ä¸æ˜¯æ•²ä»£ç ï¼Œè¿™æ˜¯å†™å‘½è¿ã€‚<strong>ä½ åœ¨æ”¹å˜ä¸–ç•Œçš„åŒæ—¶ï¼Œä¹Ÿåœ¨ä¹¦å†™è‡ªå·±çš„æœªæ¥</strong>ã€‚</p>
<p>â€ƒâ€ƒæ˜¯çš„ï¼Œæˆ‘ä»¬åœ¨ä¸ºç³»ç»Ÿä¼˜åŒ–ï¼Œå¯æ²¡äººæ¥ä¼˜åŒ–æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚æˆ‘ä»¬è®©äº§å“æ›´æ™ºèƒ½ï¼Œå´è®©è‡ªå·±è¶Šæ¥è¶Šæœºæ¢°ã€‚æˆ‘ä»¬ç»™åˆ«äººé€ æœªæ¥ï¼Œå´æŠŠè‡ªå·±å›°åœ¨ä»Šå¤©ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦å­¦ä¼šåå‡»ã€‚åå‡»ä»€ä¹ˆï¼Ÿåå‡»ä¸å°Šé‡æŠ€æœ¯çš„æ–‡åŒ–ã€åå‡»è¢«åŠ¨æ‰§è¡Œçš„æ€ç»´â€¦â€¦åå‡»ï¼Œä¸æ˜¯è¾èŒï¼›åå‡»ï¼Œæ˜¯è®©è‡ªå·±å˜å¾—è¶³å¤Ÿå¼ºå¤§ï¼Œä¸å†è¢«å®šä¹‰ã€‚</p>
<p>â€ƒâ€ƒä½ ä»¥ä¸ºJavaè€äº†ï¼Ÿç»“æœSpring 6 + JDK 21 è¿˜åœ¨ç–¯ç‹‚æ›´æ–°ï¼ŒKubernetesã€å¾®æœåŠ¡ã€äº‘åŸç”Ÿâ€¦â€¦èƒŒåè¿è¡Œçš„æ ¸å¿ƒé€»è¾‘ï¼Œè¿˜æ˜¯Javaã€‚Java ä¸å†æ˜¯â€œå†™é¡µé¢+Controllerâ€çš„é‚£ç§ Javaï¼Œè€Œæ˜¯æ‡‚åˆ†å¸ƒå¼æ¶æ„ã€å¼‚æ­¥æ¶ˆæ¯ã€ç³»ç»Ÿè°ƒä¼˜ã€äº‘è®¡ç®—èåˆçš„æ–° Javaã€‚çœŸæ­£çš„é«˜æ‰‹ï¼Œè„‘å­é‡Œæœ‰ç³»ç»Ÿï¼Œæ‰‹é‡Œæœ‰é€»è¾‘ï¼Œå¿ƒé‡Œæœ‰æ–¹å‘ã€‚ç¨‹åºå‘˜ä¸æ˜¯å¼±åŠ¿ç¾¤ä½“ï¼Œæˆ‘ä»¬åªæ˜¯è¿˜æ²¡æ„è¯†åˆ°ï¼Œè‡ªå·±æ‹¥æœ‰**åˆ›é€ è§„åˆ™çš„æƒåŠ›ã€‚**ä½ å†™çš„æ¯ä¸€è¡Œä»£ç ï¼Œéƒ½å¯èƒ½æ˜¯ä¸€ä¸ªæ–°çš„å•†ä¸šæ¨¡å¼ã€ä¸€ç§æ–°çš„å·¥ä½œæ–¹å¼ã€ç”šè‡³â€”â€”ä¸€ä¸ªæ–°çš„æœªæ¥ã€‚</p>
<h2 data-id="heading-3">å†™åœ¨æœ€åï¼šæ¯”AIæ›´å¯æ€•çš„ï¼Œæ˜¯æ­¢æ­¥ä¸å‰</h2>
<p>â€ƒâ€ƒåˆ«æ€•AIèƒ½å†™ä»£ç ï¼Œè¦æ€•çš„ï¼Œæ˜¯ä½ å†™çš„ä»£ç å’Œæ˜¨å¤©ä¸€æ¨¡ä¸€æ ·ã€‚åˆ«æ€• Java è€ï¼Œè¦æ€•çš„ï¼Œæ˜¯ä½ è¿˜åœ¨ç”¨äº”å¹´å‰çš„å†™æ³•æ··æ—¥å­ã€‚ä¸€ä¸ªçœŸæ­£çš„ç¨‹åºå‘˜ï¼Œä¸æ˜¯å†™ä»£ç çš„äººï¼Œè€Œæ˜¯èƒ½æŠŠç³»ç»Ÿè·‘èµ·æ¥ã€èƒ½è§£å†³é—®é¢˜ã€èƒ½è®©ä¸šåŠ¡æŒ£é’±çš„äººã€‚å½“ä½ åšåˆ°è¿™ä¸‰ç‚¹ï¼Œæ— è®ºAIå¤šèªæ˜ï¼Œå®ƒéƒ½åªæ˜¯ä½ çš„å·¥å…·ã€‚ä½ å†™ä¸‹çš„æ¯ä¸€ä¸ªé€»è¾‘ï¼Œå¯èƒ½å°±æ˜¯æœªæ¥ç¤¾ä¼šçš„ç§©åºã€‚ä½ æ•²ä¸‹çš„æ¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯èƒ½æ­£åœ¨æ”¹å˜åˆ«äººçš„ç”Ÿæ´»ã€‚ä½ å†™ä¸‹çš„æ¯ä¸€è¡Œä»£ç ï¼Œéƒ½åœ¨è¯æ˜â€œæˆ‘ä¸åªæ˜¯ä¸ªå¼€å‘è€…ï¼Œæˆ‘æ˜¯é€ æ¢¦çš„äººâ€ã€‚æ‰€ä»¥ï¼Œä»ä»Šå¤©èµ·ï¼Œåˆ«å†é—®â€˜ç³»ç»Ÿä»€ä¹ˆæ—¶å€™ä¸Šçº¿â€™ï¼Œé—®è‡ªå·±ä¸€å¥â€”â€”ä½ ï¼Œä»€ä¹ˆæ—¶å€™ä¸Šçº¿ï¼Ÿ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e893c06b0907483996a542d8bd9204e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769919142&amp;x-signature=Wi8ptuWsZVmTks3HbKNnEzXul4I%3D" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBootè‡ªåŠ¨é…ç½®åŸç†æ­ç§˜ï¼š90%å¼€å‘è€…ä¸çŸ¥é“çš„3ä¸ªéšè—æŠ€å·§]]></title>    <link>https://juejin.cn/post/7598459769239666722</link>    <guid>https://juejin.cn/post/7598459769239666722</guid>    <pubDate>2026-01-25T04:18:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598459769239666722" data-draft-id="7598490039489626147" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBootè‡ªåŠ¨é…ç½®åŸç†æ­ç§˜ï¼š90%å¼€å‘è€…ä¸çŸ¥é“çš„3ä¸ªéšè—æŠ€å·§"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-25T04:18:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBootè‡ªåŠ¨é…ç½®åŸç†æ­ç§˜ï¼š90%å¼€å‘è€…ä¸çŸ¥é“çš„3ä¸ªéšè—æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T04:18:47.000Z" title="Sun Jan 25 2026 04:18:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBootè‡ªåŠ¨é…ç½®åŸç†æ­ç§˜ï¼š90%å¼€å‘è€…ä¸çŸ¥é“çš„3ä¸ªéšè—æŠ€å·§</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>SpringBootçš„è‡ªåŠ¨é…ç½®ï¼ˆAuto-Configurationï¼‰æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿæ„å»ºåº”ç”¨çš„å…³é”®ã€‚ç„¶è€Œï¼Œå°½ç®¡å¤§å¤šæ•°å¼€å‘è€…æ¯å¤©éƒ½åœ¨ä½¿ç”¨SpringBootï¼Œä½†å¯¹å…¶è‡ªåŠ¨é…ç½®çš„åº•å±‚åŸç†å’Œéšè—æŠ€å·§å´çŸ¥ä¹‹ç”šå°‘ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æSpringBootè‡ªåŠ¨é…ç½®çš„å·¥ä½œåŸç†ï¼Œå¹¶æ­ç¤ºä¸‰ä¸ªé²œä¸ºäººçŸ¥ä½†æå…¶å®ç”¨çš„æŠ€å·§ï¼Œå¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°åˆ©ç”¨è¿™ä¸€å¼ºå¤§åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-2">1. SpringBootè‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒåŸç†</h3>
<h4 data-id="heading-3">1.1 <code>@EnableAutoConfiguration</code>ä¸<code>spring.factories</code></h4>
<p>SpringBootçš„è‡ªåŠ¨é…ç½®æ˜¯é€šè¿‡<code>@EnableAutoConfiguration</code>æ³¨è§£è§¦å‘çš„ã€‚è¯¥æ³¨è§£ä¼šå¯¼å…¥<code>AutoConfigurationImportSelector</code>ç±»ï¼Œåè€…é€šè¿‡æ‰«æ<code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>æ–‡ä»¶ï¼ˆSpringBoot 2.7+ï¼‰æˆ–ä¼ ç»Ÿçš„<code>spring.factories</code>æ–‡ä»¶ï¼ˆSpringBoot 2.6åŠä»¥ä¸‹ï¼‰ï¼ŒåŠ è½½æ‰€æœ‰å£°æ˜çš„è‡ªåŠ¨é…ç½®ç±»ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Inherited</span>
<span class="hljs-meta">@AutoConfigurationPackage</span>
<span class="hljs-meta">@Import(AutoConfigurationImportSelector.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>è¿™äº›è‡ªåŠ¨é…ç½®ç±»é€šå¸¸åŒ…å«æ¡ä»¶æ³¨è§£ï¼ˆå¦‚<code>@ConditionalOnClass</code>ã€<code>@ConditionalOnMissingBean</code>ï¼‰ï¼Œç”¨äºåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
<span class="hljs-meta">@ConditionalOnClass({DataSource.class, EmbeddedDatabaseType.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceAutoConfiguration</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h4 data-id="heading-4">1.2 æ¡ä»¶æ³¨è§£çš„ä¼˜å…ˆçº§ä¸è¦†ç›–æœºåˆ¶</h4>
<p>SpringBootçš„æ¡ä»¶æ³¨è§£éµå¾ªä¸¥æ ¼çš„ä¼˜å…ˆçº§è§„åˆ™ï¼š</p>
<ol>
<li><code>@ConditionalOnBean</code>å’Œ<code>@ConditionalOnMissingBean</code>ä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€æ£€æŸ¥å®¹å™¨ä¸­çš„Beanæ˜¯å¦å­˜åœ¨ã€‚</li>
<li><code>@ConditionalOnClass</code>å’Œ<code>@ConditionalOnMissingClass</code>ä¼šåœ¨ç±»åŠ è½½é˜¶æ®µæ£€æŸ¥ç±»çš„å­˜åœ¨æ€§ã€‚</li>
<li><code>@ConditionalOnProperty</code>ä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§å€¼å†³å®šæ˜¯å¦ç”Ÿæ•ˆã€‚</li>
</ol>
<p>å¼€å‘è€…å¯ä»¥é€šè¿‡å®šä¹‰è‡ªå·±çš„Beanæ¥è¦†ç›–é»˜è®¤çš„è‡ªåŠ¨é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å®šä¹‰ä¸€ä¸ªè‡ªå·±çš„<code>DataSource</code> Beanï¼Œé‚£ä¹ˆé»˜è®¤çš„æ•°æ®åº“é…ç½®å°†ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<hr/>
<h3 data-id="heading-5">2. éšè—æŠ€å·§ä¸€ï¼šå¦‚ä½•ç²¾ç¡®æ§åˆ¶è‡ªåŠ¨é…ç½®çš„é¡ºåº</h3>
<h4 data-id="heading-6">2.1 ä½¿ç”¨<code>@AutoConfigureOrder</code>ä¸è‡ªå®šä¹‰é¡ºåº</h4>
<p>è™½ç„¶SpringBootä¼šè‡ªåŠ¨æ’åºé…ç½®ç±»ï¼ˆé€šè¿‡ä¾èµ–å…³ç³»å’Œæ¡ä»¶åˆ¤æ–­ï¼‰ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨æ§åˆ¶é¡ºåºã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li><strong>å…¨å±€é¡ºåºæ§åˆ¶</strong>ï¼šåœ¨è‡ªå®šä¹‰çš„è‡ªåŠ¨é…ç½®ç±»ä¸Šæ·»åŠ  <code>org.springframework.boot.autoconfigure.AutoConfigureOrder</code>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomAutoConfiguration</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
</li>
<li><strong>å±€éƒ¨é¡ºåºæ§åˆ¶</strong>ï¼šç»“åˆ <code>org.springframework.core.annotation.Order</code></li>
</ol>
<h4 data-id="heading-7">2.2 <strong>ä¾èµ–é©±åŠ¨çš„æ’åº</strong></h4>
<p>å¦‚æœå¤šä¸ªè‡ªåŠ¨é…ç½®ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼ˆæ¯”å¦‚Aä¾èµ–äºBï¼‰ï¼Œå¯ä»¥æ˜¾å¼å£°æ˜ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Bå…ˆäºAåŠ è½½</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoConfigureB</span> {}

<span class="hljs-comment">// Aä¾èµ–äºB</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoConfigureA</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AutoConfigureAfter</span>&lt;AutoConfigureB&gt; {}
</code></pre>
<hr/>
<h3 data-id="heading-8">3. éšè—æŠ€å·§äºŒï¼šåŠ¨æ€ç¦ç”¨ç‰¹å®šè‡ªåŠ¨é…ç½®</h3>
<h4 data-id="heading-9">3.1 <strong>é€šè¿‡é…ç½®æ–‡ä»¶ç²¾ç¡®æ’é™¤</strong></h4>
<p>é™¤äº†å¸¸è§çš„ <code>spring.autoconfigure.exclude</code>, SpringBootè¿˜æ”¯æŒæ›´ç»†ç²’åº¦çš„æ’é™¤æ–¹å¼ï¼š</p>
<pre><code class="hljs language-properties" lang="properties"># application.propertiesä¸­ç¦ç”¨ç‰¹å®šæ¨¡å—
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration

# YAMLæ ¼å¼åŒæ ·æ”¯æŒï¼š
spring:
autoconfigure:
exclude:
- org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration 
</code></pre>
<h4 data-id="heading-10">3.2 <strong>ç¼–ç¨‹å¼æ’é™¤</strong></h4>
<p>åœ¨æµ‹è¯•æˆ–åŠ¨æ€åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•°æ’é™¤ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplicationBuilder</span>()
.source(MyApp.class) 
.profiles(<span class="hljs-string">"dev"</span>) 
.exclude(DataSourceAutoConfiguration.class) 
.run(args);
</code></pre>
<hr/>
<h3 data-id="heading-11">4. éšè—æŠ€å·§ä¸‰ï¼šæ·±åº¦å®šåˆ¶Starterçš„è¡Œä¸º</h3>
<h4 data-id="heading-12">4.1 <strong>è¦†ç›–é»˜è®¤å±æ€§ç»‘å®š</strong></h4>
<p>æ¯ä¸ªStarteré€šå¸¸é€šè¿‡ <code>xxxProperties.java</code>
ä½ å¯ä»¥ç›´æ¥åœ¨application.ymlä¸­è¦†ç›–ä»»ä½•å±æ€§ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
<span class="hljs-attr">datasource:</span> 
<span class="hljs-attr">url:</span> <span class="hljs-string">"jdbc:h2:mem:testdb"</span>
<span class="hljs-attr">username:</span> <span class="hljs-string">"custom-user"</span>
</code></pre>
<h4 data-id="heading-13">4.2 <strong>ç›‘å¬è‡ªåŠ¨é…ç½®äº‹ä»¶</strong></h4>
<p>å®ç°æ¥å£å¯è·å–è¯¦ç»†çš„åŠ è½½è¿‡ç¨‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AutoConfigurationImportListener</span> {
<span class="hljs-meta">@Override</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAutoConfigurationImportEvent</span><span class="hljs-params">(
AutoConfigurationImportEvent event)</span> {
<span class="hljs-comment">// event.getCandidateConfigurations()è·å–å€™é€‰åˆ—è¡¨</span>
} 
}
</code></pre>
<hr/>
<h3 data-id="heading-14">5. Debugå®æˆ˜ï¼šå¦‚ä½•åˆ†æç”Ÿæ•ˆçš„è‡ªåŠ¨é…ç½®</h3>
<p>å¯ç”¨debugæ¨¡å¼æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Šï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">--debug=true 

<span class="hljs-section">//è¾“å‡ºç¤ºä¾‹ï¼š
=========================</span>
<span class="hljs-section">AUTO-CONFIGURATION REPORT
=========================</span>

<span class="hljs-section">Positive matches:
-----------------</span>
DataSourceAutoConfiguration matched:
<span class="hljs-bullet">-</span> @ConditionalOnClass found required classes 'javax.sql.DataSource', 'org.springframework.jdbc.datasource...
</code></pre>
<hr/>
<p>###æ€»ç»“</p>
<p>æŒæ¡è¿™ä¸‰ä¸ªéšè—æŠ€å·§åï¼š</p>
<ul>
<li>ç²¾ç¡®æ’åºèƒ½è§£å†³ç»„ä»¶åˆå§‹åŒ–å†²çªé—®é¢˜ï¼›</li>
<li>åŠ¨æ€ç¦ç”¨å¯æå‡æµ‹è¯•æ€§èƒ½ï¼›</li>
<li>å±æ€§è¦†ç›–å’Œäº‹ä»¶ç›‘å¬æä¾›äº†æ·±åº¦å®šåˆ¶èƒ½åŠ›ï¼›</li>
</ul>
<p>å»ºè®®ç»“åˆæºç é˜…è¯» (<code>org.springframework.boot.autoconfigure</code>)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…³äºCVTEç¨‹åºå‘˜çŒæ­»äº‹ä»¶çš„ä¸€ç‚¹æƒ³æ³•]]></title>    <link>https://juejin.cn/post/7598827641307283507</link>    <guid>https://juejin.cn/post/7598827641307283507</guid>    <pubDate>2026-01-25T05:03:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598827641307283507" data-draft-id="7598732691769901107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…³äºCVTEç¨‹åºå‘˜çŒæ­»äº‹ä»¶çš„ä¸€ç‚¹æƒ³æ³•"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-25T05:03:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é™†ä¸šèª"/> <meta itemprop="url" content="https://juejin.cn/user/13629904404157"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…³äºCVTEç¨‹åºå‘˜çŒæ­»äº‹ä»¶çš„ä¸€ç‚¹æƒ³æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/13629904404157/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é™†ä¸šèª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T05:03:38.000Z" title="Sun Jan 25 2026 05:03:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">32å²ï¼Œä»£ç è¿˜æ²¡å†™å®Œï¼Œäººæ²¡äº†</h2>
<p>å‰å‡ å¤©åˆ·åˆ°è¿™æ¡æ–°é—»çš„æ—¶å€™ï¼Œæˆ‘æ­£åœ¨å…¬å¸æ”¹ä¸€ä¸ªçº¿ä¸Šbugï¼Œæ”¹ç€æ”¹ç€æ‰‹å°±åœäº†ã€‚</p>
<p>å¹¿å·ï¼Œ32å²ï¼Œç¨‹åºå‘˜ï¼ŒçŒæ­»ã€‚</p>
<p>è¿™å‡ ä¸ªè¯ç»„åˆåœ¨ä¸€èµ·ï¼Œå·²ç»ä¸æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°åœ¨çƒ­æœä¸Šäº†ã€‚ä½†è¿™æ¬¡çš„ç»†èŠ‚ï¼ŒçœŸçš„è®©äººåèƒŒå‘å‡‰â€”â€”<strong>äººåœ¨åŒ»é™¢æŠ¢æ•‘çš„æ—¶å€™ï¼Œè¢«æ‹‰è¿›äº†æŠ€æœ¯ç¾¤ï¼Œç¾¤é‡Œè¿˜æœ‰äºº@ä»–å¤„ç†è®¢å•ã€‚æ­»äº¡8å°æ—¶åï¼Œå¾®ä¿¡åˆæ”¶åˆ°æ¶ˆæ¯ï¼šã€Œå‘¨ä¸€ä¸€æ—©æœ‰æ€¥ä»»åŠ¡ã€ã€‚</strong></p>
<p>æˆ‘ä¸çŸ¥é“å‘è¿™äº›æ¶ˆæ¯çš„åŒäº‹çŸ¥ä¸çŸ¥é“æƒ…å†µï¼Œä¹Ÿè®¸ä»–ä»¬çœŸçš„ä¸çŸ¥é“ã€‚ä½†è¿™æ°æ°è¯´æ˜äº†ä¸€ä¸ªæ›´å¯æ€•çš„äº‹å®ï¼š<strong>åœ¨è¿™ä¸ªç³»ç»Ÿé‡Œï¼Œä½ åªæ˜¯ä¸€ä¸ªéšæ—¶å¯ä»¥è¢«@çš„å·¥å…·äººï¼Œæ²¡æœ‰äººå…³å¿ƒä½ ç°åœ¨æ˜¯åœ¨åƒé¥­ã€ç¡è§‰ã€è¿˜æ˜¯èººåœ¨ICUã€‚</strong></p>
<h3 data-id="heading-1">ã€Œç®¡ç†è€…è¦é™ªå›¢é˜Ÿä¸€èµ·æ‰›å‹åŠ›ã€</h3>
<p>æ®è¯´è¿™æ˜¯é«˜å¹¿è¾‰ç”Ÿå‰è¯´è¿‡çš„è¯ã€‚</p>
<p>è¯´å®è¯ï¼Œçœ‹åˆ°è¿™å¥è¯çš„æ—¶å€™æˆ‘æ„£äº†ä¸€ä¸‹ã€‚è¿™è¯æœ¬èº«æ²¡æ¯›ç—…ï¼Œç”šè‡³å¯ä»¥è¯´æ˜¯ä¸ªå¥½é¢†å¯¼è¯¥æœ‰çš„æ‹…å½“ã€‚ä½†é—®é¢˜æ˜¯â€”â€”<strong>æ‰›å‹åŠ›æ‰›åˆ°çŒæ­»ï¼Œè¿™è¿˜å«æ‰›å‹åŠ›å—ï¼Ÿè¿™å«ç©å‘½ã€‚</strong></p>
<p>ä»–çŒæ­»å‰ä¸€å‘¨çš„ä½œæ¯ï¼šå·¥ä½œæ—¥æœ€æ—©9ç‚¹38åˆ°å®¶ï¼Œæœ€æ™š10ç‚¹47ã€‚å‘¨æœ«è¿˜è¦åŠ ç­ã€‚</p>
<p>æˆ‘ææŒ‡ä¸€ç®—ï¼Œå°±ç®—æ—©ä¸Š9ç‚¹åˆ°å…¬å¸ï¼Œæ¯å¤©å·¥ä½œ12-14ä¸ªå°æ—¶æ˜¯æœ‰çš„ã€‚ä¸€å‘¨å¹²ä¸‹æ¥ï¼Œç­‰äºåˆ«äººä¸¤å‘¨çš„å·¥ä½œé‡ã€‚èº«ä½“æ˜¯è‚‰åšçš„ï¼Œä¸æ˜¯æœåŠ¡å™¨ï¼Œ7x24å°æ—¶è·‘è¿Ÿæ—©è¦å®•æœºçš„ã€‚</p>
<h3 data-id="heading-2">å¿ƒç”µå›¾æ­£å¸¸â‰ æ²¡äº‹</h3>
<p>æ–°é—»é‡Œæåˆ°ï¼Œä»–2024å¹´6æœˆä½“æ£€å¿ƒç”µå›¾æ­£å¸¸ã€‚</p>
<p>è¿™å…¶å®æ˜¯ä¸ªå¾ˆå¤§çš„è®¤çŸ¥è¯¯åŒºã€‚<strong>å¿ƒç”µå›¾åªèƒ½æ•æ‰æ£€æŸ¥é‚£å‡ åˆ†é’Ÿçš„å¿ƒè„çŠ¶æ€ï¼Œå¾ˆå¤šéšæ‚£å®ƒæ ¹æœ¬æŸ¥ä¸å‡ºæ¥ã€‚</strong> å†µä¸”ï¼Œé•¿æœŸé«˜å‹ã€ç¡çœ ä¸è¶³ã€ç¼ºä¹è¿åŠ¨å¸¦æ¥çš„æŸä¼¤ï¼Œæ˜¯ä¸€ä¸ªæ…¢æ€§ç´¯ç§¯çš„è¿‡ç¨‹ã€‚ç­‰åˆ°å‡ºé—®é¢˜çš„æ—¶å€™ï¼Œå¾€å¾€å°±æ˜¯è‡´å‘½ä¸€å‡»ã€‚</p>
<p>æˆ‘ä»¬è¿™è¡Œçš„äººï¼Œå¾ˆå¤šéƒ½æœ‰ç§å¥‡æ€ªçš„è‡ªä¿¡ï¼šã€Œæˆ‘è¿˜å¹´è½»ã€ã€Œæˆ‘èº«ä½“åº•å­å¥½ã€ã€Œç†¬ä¸€ç†¬å°±è¿‡å»äº†ã€ã€‚</p>
<p>ä½†å¿ƒè„ä¸è·Ÿä½ è®²é“ç†ï¼Œå®ƒåªçœ‹ä½ æ¬ äº†å¤šå°‘å€ºã€‚</p>
<h3 data-id="heading-3">å·¥ä¼¤è®¤å®šï¼Ÿ</h3>
<p>å…¬å¸å·²ç»æäº¤äº†å·¥ä¼¤è®¤å®šç”³è¯·ï¼Œè¿™ç®—æ˜¯æ€åº¦è¿˜è¡Œã€‚ä½†è¯´å®è¯ï¼Œå°±ç®—è®¤å®šäº†åˆæ€æ ·å‘¢ï¼Ÿäººå·²ç»æ²¡äº†ï¼Œè®¤å®šå·¥ä¼¤èƒ½èµ”å¤šå°‘é’±ï¼Ÿå‡ åä¸‡ï¼Ÿä¸Šç™¾ä¸‡ï¼Ÿ</p>
<p>ä¸€ä¸ª32å²çš„äººï¼Œä¸Šæœ‰è€ä¸‹æœ‰å°ï¼Œæ­£æ˜¯å®¶é‡Œé¡¶æ¢æŸ±çš„å¹´çºªã€‚è¿™ç‚¹é’±å¤Ÿå¹²å˜›çš„ï¼Ÿ</p>
<p><strong>æ³•å¾‹èƒ½ä¿éšœçš„ï¼Œæ°¸è¿œåªæ˜¯åº•çº¿ã€‚çœŸæ­£çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬è¿™ä¸ªè¡Œä¸šçš„"æ­£å¸¸å·¥ä½œèŠ‚å¥"ï¼Œæœ¬èº«å°±æ˜¯ä¸æ­£å¸¸çš„ã€‚</strong></p>
<h3 data-id="heading-4">å†™ç»™è¿˜åœ¨å·çš„å…„å¼Ÿä»¬</h3>
<p>æˆ‘ä¸æ˜¯è¦è´©å–ç„¦è™‘ï¼Œä¹Ÿä¸æ˜¯è¯´å¤§å®¶éƒ½åˆ«å¹²äº†ã€‚æ¯•ç«Ÿæˆ¿è´·è½¦è´·è€å©†å­©å­ï¼Œå“ªä¸ªä¸éœ€è¦é’±ã€‚</p>
<p>ä½†æœ‰å‡ ç‚¹ï¼Œæˆ‘è§‰å¾—çœŸçš„è¦è®¤çœŸæƒ³æƒ³ï¼š</p>
<ol>
<li>
<p><strong>å®šæœŸä½“æ£€ï¼Œè€Œä¸”è¦æŸ¥å…¨é¢çš„ã€‚</strong> åˆ«åªåšå…¬å¸é‚£ç§åŸºç¡€å¥—é¤ï¼Œå¿ƒè„å½©è¶…ã€é¢ˆåŠ¨è„‰è¶…å£°ã€è¡€è„‚è¡€ç³–è¿™äº›è¯¥æŸ¥çš„æŸ¥ã€‚å‡ ç™¾å—é’±èƒ½ä¹°ä¸ªå¿ƒå®‰ã€‚</p>
</li>
<li>
<p><strong>å­¦ä¼šè¯†åˆ«èº«ä½“çš„è­¦æŠ¥ã€‚</strong> èƒ¸é—·ã€å¿ƒæ‚¸ã€æŒç»­æ€§å¤´ç—›ã€ç¡çœ éšœç¢ï¼Œè¿™äº›éƒ½æ˜¯ä¿¡å·ã€‚åˆ«ç¡¬æ‰›ï¼Œæ‰›ä¸ä½çš„ã€‚</p>
</li>
<li>
<p><strong>å·¥ä½œæ˜¯åšä¸å®Œçš„ã€‚</strong> ä»Šå¤©ä¸ä¸Šçº¿æ˜å¤©ä¸Šçº¿ï¼Œå¤©å¡Œä¸ä¸‹æ¥ã€‚ä½†ä½ å€’ä¸‹äº†ï¼Œè¿™ä¸ªå®¶å°±çœŸå¡Œäº†ã€‚è€æ¿ä¼šç»™ä½ å¼€è¿½æ‚¼ä¼šï¼Œç„¶åå‘æ‹›è˜å¯äº‹ã€‚</p>
</li>
<li>
<p><strong>å­˜æ¬¾æ¯”æœŸæƒå®åœ¨ã€‚</strong> æˆ‘è§è¿‡å¤ªå¤šäººä¸ºäº†é‚£ç‚¹æœŸæƒç”»é¥¼ç©å‘½åŠ ç­ï¼Œæœ€åå…¬å¸é»„äº†æˆ–è€…è¢«è£äº†ï¼Œå•¥ä¹Ÿæ²¡æç€ã€‚èº«ä½“å®äº†æ›´æ˜¯è¡€æœ¬æ— å½’ã€‚</p>
</li>
</ol>
<h3 data-id="heading-5">æœ€åè¯´ä¸¤å¥</h3>
<p>æˆ‘æ— æ„å»æŒ‡è´£è°ã€‚é‚£ä¸ªåœ¨ç¾¤é‡Œå‘æ¶ˆæ¯çš„åŒäº‹ï¼Œé‚£ä¸ªæ­»å8å°æ—¶è¿˜åœ¨å‚¬ä»»åŠ¡çš„äººï¼Œä»–ä»¬å¯èƒ½çœŸçš„ä¸çŸ¥é“æƒ…å†µã€‚ä»–ä»¬ä¹Ÿåªæ˜¯è¿™ä¸ªç³»ç»Ÿé‡Œçš„èºä¸é’‰ï¼Œè¢«KPIå’Œdeadlineè¿½ç€è·‘ã€‚</p>
<p><strong>ä½†æˆ‘ä»¬å¾—æƒ³æƒ³ï¼Œæ˜¯ä»€ä¹ˆè®©æˆ‘ä»¬å˜æˆäº†è¿™æ ·ï¼Ÿ</strong> è®©ä¸€ä¸ªäººåœ¨æŠ¢æ•‘çš„æ—¶å€™è¿˜èƒ½è¢«å·¥ä½œæ¶ˆæ¯æ·¹æ²¡ï¼Œè®©ä¸€ä¸ªäººæ­»äº†8å°æ—¶è¿˜æœ‰äººç»™ä»–æ´¾æ´»ã€‚</p>
<p>è¿™ä¸æ˜¯æŸä¸€å®¶å…¬å¸çš„é—®é¢˜ï¼Œæ˜¯æ•´ä¸ªè¡Œä¸šçš„ç—…ã€‚</p>
<p>é«˜å¹¿è¾‰èµ°äº†ã€‚å¸Œæœ›ä»–çš„äº‹æƒ…ï¼Œèƒ½è®©æ›´å¤šäººé†’ä¸€é†’ã€‚</p>
<p><strong>ä»£ç å¯ä»¥é‡æ„ï¼Œé¡¹ç›®å¯ä»¥é‡å¯ï¼Œéœ€æ±‚å¯ä»¥delayã€‚ä½†äººæ²¡äº†ï¼Œå°±æ˜¯çœŸçš„æ²¡äº†ã€‚</strong></p>
<hr/>
<p><em>ï¼ˆæ„¿é€è€…å®‰æ¯ã€‚ä¹Ÿæ„¿æ¯ä¸€ä¸ªè¿˜åœ¨æ·±å¤œåŠ ç­çš„ç¨‹åºå‘˜ï¼Œéƒ½èƒ½å¹³å®‰å›å®¶ã€‚ï¼‰</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŠŠAIç”¨æˆç¥ï¼Œä½ åªéœ€è¦ä¸€ä¸ªSkillså•†åº—]]></title>    <link>https://juejin.cn/post/7598699872552009764</link>    <guid>https://juejin.cn/post/7598699872552009764</guid>    <pubDate>2026-01-25T03:07:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872552009764" data-draft-id="7598537739516067882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŠŠAIç”¨æˆç¥ï¼Œä½ åªéœ€è¦ä¸€ä¸ªSkillså•†åº—"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-25T03:07:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«¥æ¬§å·´"/> <meta itemprop="url" content="https://juejin.cn/user/3491704662669469"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŠŠAIç”¨æˆç¥ï¼Œä½ åªéœ€è¦ä¸€ä¸ªSkillså•†åº—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3491704662669469/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«¥æ¬§å·´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T03:07:07.000Z" title="Sun Jan 25 2026 03:07:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>å‰ä¸¤å¤©ï¼Œåˆšè·Ÿå¤§å®¶å” å®Œ Skills è¿™ä¸ªäº‹å„¿ã€‚</p>
<p>ï¼ˆçŒ›æˆ³å›é¡¾ğŸ‘‰ï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FpZ9qp-Wy1N4sEBwH7eigyQ" target="_blank" title="https://mp.weixin.qq.com/s/pZ9qp-Wy1N4sEBwH7eigyQ" ref="nofollow noopener noreferrer">Skillsç«äº†ï¼Œä¸€ç¯‡å¸¦ä½ çœ‹æ‡‚æ¥é¾™å»è„‰</a></p>
<p>æ–‡æœ«æ¨èäº†å¾ˆå¤šå¥½ç”¨çš„ç²¾é€‰ Skillsï¼Œç¾¤å‹ä»¬è¯´å·²ç»æŒ‘èŠ±çœ¼äº†ã€‚</p>
<p>åˆšå¥½ï¼Œæœ€è¿‘ Vercel ä¸Šçº¿äº†ä¸€ä¸ª Skills å•†åº—ã€‚</p>
<p>å¥½å®¶ä¼™ï¼Œå·²ç»æ”¶å½•äº† 12500 å¤šä¸ªæŠ€èƒ½åº“ï¼Œè¿˜åšäº† 24 å°æ—¶è¶‹åŠ¿å’Œçƒ­é—¨æ’åºã€‚</p>
<p>æœ€ç«çš„ä¸€ä¸ªï¼Œå±…ç„¶å·²ç»è¢«ä¸‹è½½äº†å°†è¿‘ 4 ä¸‡æ¬¡ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bc1b6c8fc8542c99acac75bf6f19700~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=8hmXJ1%2F8P%2BXdLQ9JifOPU0PXfXs%3D" alt="" loading="lazy"/></p>
<p>åœ°å€åœ¨è¿™ã€‚</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.sh%2F" target="_blank" title="https://skills.sh/" ref="nofollow noopener noreferrer">skills.sh/</a></p>
</blockquote>
<p>æœ€çˆ½çš„æ˜¯ï¼Œä½ å¯ä»¥ä¸€é”®è¿›è¡Œå®‰è£…ã€‚</p>
<p>ä¸»æµçš„ç¼–ç¨‹æ™ºèƒ½ä½“ï¼Œåƒ Claude Codeï¼ŒTraeï¼ŒCursor ç­‰ç­‰éƒ½èƒ½æ— ç¼å¯¹æ¥ã€‚</p>
<p>å¦‚æœè¿™äº›ç¼–ç¨‹æ™ºèƒ½ä½“ä½ éƒ½ä¸æƒ³æŠ˜è…¾ï¼Œæ–‡æœ«æˆ‘æ”¾äº†æ›´ç®€å•çš„ä½¿ç”¨ Skills çš„æ–¹æ³•ã€‚</p>
<p>ææŠ€æœ¯çš„éƒ½çŸ¥é“ï¼ŒVercel æ˜¯ç¡…è°·åšå‰ç«¯åŸºå»ºçš„æ‰›æŠŠå­ã€‚</p>
<p>å±äºé‚£ç§ï¼Œå¤§å‚å‡ºå“ï¼Œå¿…æ˜¯ç²¾å“çš„å…¸å‹ã€‚</p>
<p>è¿™èƒŒåï¼Œå…¶å®ä¹Ÿé‡Šæ”¾äº†ä¸€ä¸ªæå…¶ç¡¬æ ¸çš„ä¿¡å·ã€‚</p>
<p>é€šç”¨ AI çš„èƒ½åŠ›ä¸å€¼é’±äº†ï¼Œèƒ½è¢«è°ƒç”¨çš„ä¸“å®¶ç»éªŒæ‰å€¼é’±ã€‚</p>
<p>ä»Šå¤©ï¼Œå’±ä»¬å°±æ¥ç›˜ä¸€ç›˜å®ƒã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2746ae985755423f9e89663da7feda68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=%2FbhfZhytP8NS42IpyIo8EnGhIqk%3D" alt="" loading="lazy"/></p>
<p>æˆ‘æŠŠæ’åå‰ 10 çš„ Skills æ‘˜äº†å‡ºæ¥ï¼Œå¤§å®¶æ„Ÿå—ä¸€ä¸‹ã€‚</p>







































































<table><thead><tr><th align="center">æ’å</th><th align="left">Skills åç§°</th><th align="left">ä¸‹è½½é‡</th><th align="left">ç”¨é€”</th></tr></thead><tbody><tr><td align="center">1</td><td align="left">vercel-react-best-practices</td><td align="left">39.6K</td><td align="left"><strong>[ç¼–ç¨‹]</strong> React æœ€ä½³å®è·µï¼Œå†™å‡ºè¡Œä¸šæ ‡å‡†çš„ç½‘é¡µä»£ç </td></tr><tr><td align="center">2</td><td align="left">web-design-guidelines</td><td align="left">30.1K</td><td align="left"><strong>[è®¾è®¡]</strong> æä¾›ä¸“ä¸šçš„ç½‘é¡µè®¾è®¡è§„èŒƒ</td></tr><tr><td align="center">3</td><td align="left">remotion-best-practices</td><td align="left">21.5K</td><td align="left"><strong>[è§†é¢‘]</strong> ç”¨ä»£ç è‡ªåŠ¨ç”Ÿæˆè§†é¢‘</td></tr><tr><td align="center">4</td><td align="left">frontend-design</td><td align="left">8.6K</td><td align="left"><strong>[è®¾è®¡]</strong> ä¼˜åŒ–ç•Œé¢å®¡ç¾ä¸å¸ƒå±€</td></tr><tr><td align="center">5</td><td align="left">skill-creator</td><td align="left">4.3K</td><td align="left"><strong>[å·¥å…·]</strong> è‡ªåŠ¨ç”Ÿæˆæ–°çš„æŠ€èƒ½åŒ…</td></tr><tr><td align="center">6</td><td align="left">agent-browser</td><td align="left">3.1K</td><td align="left"><strong>[å·¥å…·]</strong> è®© AI è‡ªåŠ¨æ“ä½œæµè§ˆå™¨</td></tr><tr><td align="center">7</td><td align="left">building-native-ui</td><td align="left">3.0K</td><td align="left"><strong>[ç¼–ç¨‹]</strong> å¼€å‘ç±»åŸç”Ÿ App ç•Œé¢</td></tr><tr><td align="center">8</td><td align="left">seo-audit</td><td align="left">2.6K</td><td align="left"><strong>[è¥é”€]</strong> è¯Šæ–­ç½‘ç«™ SEO æœç´¢æ’åé—®é¢˜</td></tr><tr><td align="center">9</td><td align="left">better-auth-best-practices</td><td align="left">2.6K</td><td align="left"><strong>[ç¼–ç¨‹]</strong> å®ç°å®‰å…¨çš„ç”¨æˆ·ç™»å½•</td></tr><tr><td align="center">10</td><td align="left">audit-website</td><td align="left">2.5K</td><td align="left"><strong>[ç¼–ç¨‹]</strong> æ£€æµ‹ç½‘ç«™æ€§èƒ½ä¸æ¼æ´</td></tr></tbody></table>
<p>ä½ çœ‹ï¼Œè¿™é‡Œé¢éƒ½æ˜¯è¡Œä¸šé¡¶å°–çš„è§„èŒƒï¼Œæ— æ•°äººè¸©å‘æ‰æ¢æ¥çš„è¡€æ³ªç»éªŒã€‚</p>
<p>ç°åœ¨ï¼Œä½ åŠ¨åŠ¨æ‰‹æŒ‡å¤´ï¼Œå°±èƒ½ä¸€é”®è°ƒç”¨ã€‚</p>
<p>è™½ç„¶å¤§éƒ¨åˆ†æ˜¯ç¼–ç¨‹å’Œç½‘é¡µè®¾è®¡ç›¸å…³çš„ï¼Œä½†æˆ‘å‘ç°äº†å¾ˆå¤šé€‚åˆæ™®é€šäººç”¨çš„ Skillsã€‚</p>
<p>æ¯”å¦‚ç¬¬ä¸‰ä¸ª remotion-best-practicesï¼Œéå¸¸æœ‰æ„æ€ã€‚</p>
<p>å’±ä»¬æ¥å®æµ‹ä¸‹ã€‚</p>
<h2 data-id="heading-0">è‡ªåŠ¨ç”Ÿæˆè§†é¢‘</h2>
<p>æˆ‘ç”¨çš„æ˜¯ Traeï¼Œä¸ç†Ÿæ‚‰çš„è¯å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç« ã€‚</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FDbUFnhU_i_hEzBfiXgzBDA" target="_blank" title="https://mp.weixin.qq.com/s/DbUFnhU_i_hEzBfiXgzBDA" ref="nofollow noopener noreferrer">å­—èŠ‚ TRAE åˆšä¸Šçº¿ SOLO æ¨¡å¼ï¼Œå“åˆ°æˆ‘äº†</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPjtZaBXD3laN44HwGQULAQ" target="_blank" title="https://mp.weixin.qq.com/s/PjtZaBXD3laN44HwGQULAQ" ref="nofollow noopener noreferrer">å­—èŠ‚ TRAE å›½å†…ç‰ˆä¸Šçº¿ï¼Œå°ç™½å…¥é—¨ AI ç¼–ç¨‹ç¥å™¨</a></li>
</ul>
<p>æƒ³å®ç°è‡ªåŠ¨ç”Ÿæˆè§†é¢‘ï¼Œéœ€è¦å®‰è£…ä¸‹é¢ä¸¤ä¸ª Skillsã€‚</p>
<p>ä¸€ä¸ªè´Ÿè´£ä¸‹è½½èµ„æºï¼Œä¸€ä¸ªè´Ÿè´£ç”Ÿæˆè§†é¢‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23e5922068bc4402a892f0951c941334~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=%2F1fJJM1YqvPEnJFpN5S5MKB%2B8FU%3D" alt="" loading="lazy"/></p>
<p>å‡†å¤‡å°±ç»ªä¹‹åï¼Œç›´æ¥å‘Šè¯‰ AI ä¸‹é¢è¿™å¥è¯ã€‚</p>
<blockquote>
<p>æç¤ºè¯ï¼šä½¿ç”¨ yt-dlp ä¸‹è½½ä¸€äº›é»‘å®¢å¸å›½çš„ç”µå½±ç‰‡æ®µï¼Œå¹¶ä½¿ç”¨ remotion-best-practices å‰ªè¾‘æˆä¸€ä¸ªé«˜ç‡ƒçš„çŸ­è§†é¢‘ã€‚</p>
</blockquote>
<p>ä»¥å‰è¦æ˜¯å¹²è¿™æ´»å„¿ï¼Œä½ å¾—è‡ªå·±å‡†å¤‡èµ„æºï¼Œæ‰“å¼€è§†é¢‘å‰ªè¾‘è½¯ä»¶ï¼Œåœ¨é‚£ä¸€å¸§ä¸€å¸§çš„ç£¨ã€‚</p>
<p>ç°åœ¨ï¼Œåªéœ€è¦ 2 ä¸ª Skills å’Œ 1 å¥è¯ã€‚</p>
<p>æ²¡ä¸€ä¼šå„¿ï¼Œè§†é¢‘å°±åšå®Œäº†ã€‚</p>
<p>ä¸ä»…è‡ªåŠ¨ä¸‹è½½äº†èµ„æºï¼Œè¿˜æˆªå–äº†é«˜æ½®ç‰‡æ®µï¼Œç”šè‡³è¿˜é¡ºæ‰‹æ·»åŠ äº†æ–‡å­—å’Œè§†è§‰ç‰¹æ•ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16b0d7be50b741e89ea80d93da02be34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=CQDrEJ5Gaapz5vuLVUDj6tABbZE%3D" alt="" loading="lazy"/></p>
<p>ä½ ä¹Ÿå¯ä»¥è¿è¡Œ npm run devï¼Œå®ƒè¿˜ä¼šç»™ä½ å¼¹å‡ºä¸€ä¸ªé¢„è§ˆç•Œé¢ï¼Œä½ å¯ä»¥è¿›è¡Œåœ¨çº¿ç¼–è¾‘ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebf760d530804da188adacae1eb15884~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=0xE5dYJJinnKZ6JP7GIL0688m14%3D" alt="" loading="lazy"/></p>
<p>æ·»åŠ å­—å¹•å®ƒä¹Ÿèƒ½æå¾—å®šï¼Œä½ åªéœ€è¦è·Ÿä»–è¯´ã€‚</p>
<blockquote>
<p>æç¤ºè¯ï¼šç»§ç»­å°†è§†é¢‘ä½¿ç”¨ remotion-best-practices æ·»åŠ ä¸­æ–‡å­—å¹•</p>
</blockquote>
<p>å¾ˆå¤šäººè§‰å¾—ï¼Œè¿™ä¸å°±æ˜¯ä¸ªå·¥å…·å—ï¼Ÿè·Ÿæˆ‘æœ‰å•¥å…³ç³»ï¼Ÿ</p>
<p>å…³ç³»å¤§äº†å»äº†ã€‚</p>
<p>è¿™èƒŒåçš„é€»è¾‘æ˜¯ï¼Œä¸ªäººå†…å®¹ç”Ÿæˆçš„é—¨æ§›ï¼Œå·²ç»è¢«ç¢¾å¹³äº†ã€‚</p>
<p>è¿‡å»åšè‡ªåª’ä½“ï¼Œå…‰æ˜¯å‰ªè¾‘çš„é—¨æ§›å°±èƒ½åŠé€€ç»å¤§éƒ¨åˆ†äººã€‚</p>
<p>ç°åœ¨ä½ æ‰‹é‡Œæœ‰äº†è¿™äº› Skillsï¼Œåªéœ€è¦ä¸€ä¸ªå¥½ç‚¹å­å°±è¡Œã€‚</p>
<p>å‰©ä¸‹çš„è®© AI è‡ªåŠ¨å»æŠ“ç´ æï¼Œè‡ªåŠ¨å‰ªè¾‘ï¼Œè‡ªåŠ¨åŠ å­—å¹•ã€‚</p>
<p>è¿™ï¼Œå°±æ˜¯æˆ‘å¸¸è¯´çš„æŠ€æœ¯å¹³æƒã€‚</p>
<p>å®ƒè®©ä¸€ä¸ªæ™®é€šäººï¼Œç¬é—´æ‹¥æœ‰äº†ä¸€ä¸ªé¡¶çº§åˆ¶ä½œå›¢é˜Ÿã€‚</p>
<h2 data-id="heading-1">å†™ä½œ</h2>
<p>æœ€çˆ½çš„æ˜¯ï¼ŒSkills å•†åº—è¿˜æä¾›äº†æœç´¢åŠŸèƒ½ã€‚</p>
<p>å“ªé‡Œä¸ä¼šæœå“ªé‡Œï¼Œso easyã€‚</p>
<p>æ¯”å¦‚å†™ä½œï¼Œé‡Œé¢æœ‰å¦‚ä½•å»æ‰ AI å‘³å„¿ï¼Œå¦‚ä½•å†™å¤ç›˜æŠ¥å‘Šï¼Œå¦‚ä½•å†™è¥é”€æ–‡æ¡ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f62eb84581a34e6294008b716a44e30c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=3OwtAYknxm8GaEaNENckwUqPhC0%3D" alt="" loading="lazy"/></p>
<p>è¿‡å»æ†‹äº†ä¸€æ™šä¸Šçš„æ–‡æ¡ˆï¼Œç°åœ¨æœä¸€ä¸‹å¯¹åº”çš„ Skillsã€‚</p>
<p>ç„¶åï¼Œè°ƒç”¨é‚£ä¸ªå·²ç»æŠŠå†™ä½œé€»è¾‘æ‘¸é€çš„ä¸“å®¶æ¥å£å°±è¡Œã€‚</p>
<p>è¿™ç§æ„Ÿè§‰æ€ä¹ˆè¯´å‘¢ï¼Ÿ</p>
<p>å°±åƒä½ è¿˜åœ¨ç”¨æ‰‹æŠ åœŸï¼Œéš”å£ç‹äºŒå°å·²ç»å¼€ä¸Šäº†æŒ–æ˜æœºã€‚</p>
<p>æœ‰çš„æ—¶å€™çœŸçš„ä¸æ˜¯ä½ ä¸å¤ŸåŠªåŠ›ï¼Œæ˜¯äººå®¶é€‰å¯¹äº†å¤–æŒ‚ã€‚</p>
<h2 data-id="heading-2">è¥é”€</h2>
<p>æˆ‘éšæ‰‹åˆæœäº†ä¸€ä¸‹å…³äºè¥é”€ç›¸å…³çš„æŠ€èƒ½ï¼Œæ²¡æƒ³åˆ°å±…ç„¶æœ‰è¿™ä¹ˆå¤šã€‚</p>
<p>æ•´æ•´é½é½ä¸€æ’ï¼ŒåŸºæœ¬ä¸ŠæŠŠä¸€ä¸ªäº’è”ç½‘äº§å“çš„ç”Ÿå‘½å‘¨æœŸéƒ½ç»™æ‰¿åŒ…äº†ã€‚</p>
<p>è¿™å›åšäº§å“ï¼Œè¿è¥ï¼Œè¿˜æœ‰è‡ªåª’ä½“çš„åŒå­¦æœ‰ç¦äº†ã€‚</p>
<p>é¡¶çº§è¥é”€äººçš„æ€ç»´æ¨¡å‹ï¼Œä½ å¯ä»¥ä¸€é”®è°ƒç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de90c52197644e229ad458ae2738a2ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=k5hrbC4z4SrXBKRu6OvH4F8MZ0c%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">åŠå…¬</h2>
<p>å…³äºæ‰“å·¥äººæœ€å¤´ç–¼çš„ PDFï¼ŒPPTï¼ŒWord å’Œ Excelã€‚</p>
<p>Skills å•†åº—é‡Œä¹Ÿéƒ½èƒ½æœåˆ°è§£å†³æ–¹æ¡ˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/017962287c894f15a8c14550037deb9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=Hm30ld5MfcKhdu7fooHGK%2B8y55c%3D" alt="" loading="lazy"/></p>
<p>æ—¥å¸¸çç¢çš„æ–‡æ¡£ç±»å·¥ä½œï¼Œéƒ½å·²ç»è¢«æ ‡å‡†åŒ–æˆå¯¹åº”çš„æ“ä½œäº†ã€‚</p>
<p>ä»Šåï¼Œäº¤ç»™è¿™ä¸ªç²¾é€š Office å…¨å®¶æ¡¶çš„è¶…çº§ç‰¹å·¥å°±è¡Œã€‚</p>
<p>å¥½äº†ï¼Œå›ç­”ä¸‹å¼€å¤´çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-4">å¦‚ä½•æ›´ç®€å•çš„ä½¿ç”¨ Skillsï¼Ÿ</h2>
<p>æˆ‘å»å¹´ 9 æœˆå†™è¿‡ä¸€ç¯‡é˜¶è·ƒ AI æ¡Œé¢ä¼™ä¼´ã€‚</p>
<p>ï¼ˆçŒ›æˆ³å›é¡¾ğŸ‘‰ï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FhBEB0Dgjz5dmt9Zx6_pqEQ" target="_blank" title="https://mp.weixin.qq.com/s/hBEB0Dgjz5dmt9Zx6_pqEQ" ref="nofollow noopener noreferrer">é˜¶è·ƒAIæ¡Œé¢ä¼™ä¼´ï¼Œè®©ä½ å’Œåˆ«äººæ‹‰å¼€å·®è·çš„ç­”æ¡ˆ</a></p>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™å“¥ä»¬è¿›åŒ–çš„é€Ÿåº¦æ¯”æˆ‘æƒ³è±¡ä¸­å¿«å¾ˆå¤šã€‚</p>
<p>ç°åœ¨çš„ç§’è®¡ï¼Œå·²ç»æ­£å¼æ”¯æŒå¯¼å…¥ Skillï¼ŒMac å’Œ Windows éƒ½å·²ç»å®‰æ’ä¸Šäº†ã€‚</p>
<p>æ“ä½œä¹Ÿæå…¶ç®€å•ï¼Œä½ ä¸éœ€è¦ä¼šå†™ä»£ç ã€‚</p>
<p>åªéœ€è¦ä¸‹è½½å¯¹åº”çš„ Skill åŒ…ï¼Œç„¶åæŠŠ Skill.md ä¸­çš„ name å’Œ description å¤åˆ¶ç²˜è´´åˆ°å¦™è®¡çš„æŒ‡ä»¤ä¸­ï¼Œç„¶ååœ¨åé¢åŠ ä¸Šè¿™å¥è¯å°±è¡Œã€‚</p>
<blockquote>
<p>æç¤ºè¯ï¼šå½“éœ€è¦é˜…è¯» Skill.md æ—¶ï¼Œè¯·æŸ¥é˜… Skill.md å…¨éƒ¨å†…å®¹ï¼Œå¹¶åŸºäº Skill.md çš„æŒ‡å¼•æŸ¥çœ‹å…¶ä½™æ–‡ä»¶ï¼Œä¸¥æ ¼éµå®ˆ Skill.md çš„æŒ‡å¼•ä½¿ç”¨ scripts å’Œ referenceã€‚</p>
<p>ä¸‹é¢æ˜¯æˆ‘çš„æŒ‡ä»¤ï¼š</p>
</blockquote>
<p>åˆ›å»ºç§’è®¡æ—¶ï¼Œå¯ä»¥åƒ Skill ä¸€æ ·ï¼Œé™„å¸¦ä¸Šæœ¬åœ°æ–‡ä»¶ï¼ŒåŒ…æ‹¬å„ç§å†…ç½®çš„å·¥å…·ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ad1032a21604989b4ad1ef7f40fefd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769915227&amp;x-signature=N%2BbUlTUHAHsl8pETcUQqlRUY3QM%3D" alt="" loading="lazy"/></p>
<p>æœ‰æ—¶å€™ï¼Œçº¯ç²¹çš„å¿«ä¹ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p>
<p>æ•´ä½“çœ‹ä¸‹æ¥ï¼Œé˜¶è·ƒ AI æ¡Œé¢ä¼™ä¼´ç®€ç›´å°±æ˜¯æœ€è¿‘å¾ˆç«çš„ Claude Cowork å›½äº§ç‰ˆã€‚</p>
<p>ç›®å‰ä¾ç„¶å®Œå…¨å…è´¹ã€‚</p>
<p>é‡è¦çš„æ˜¯ï¼Œé˜¶è·ƒè¿™å¥—ä¸œè¥¿ï¼Œæ—©åœ¨å»å¹´ 9 æœˆå°±åšå‡ºæ¥äº†ã€‚</p>
<p>è¿™æ¬¡çš„åˆ›æ–°ï¼Œå±å®æ˜¯å’±ä»¬é¥é¥é¢†å…ˆå•¦ã€‚</p>
<h2 data-id="heading-5">å°¾å£°</h2>
<p>æœ€åè¯´å‡ å¥æå¿ƒçªå­çš„è¯ã€‚</p>
<p>çœ‹ç€è¿™äº›ç²ç…æ»¡ç›®çš„ Skillsï¼Œæˆ‘æœ€æ·±çš„æ„Ÿè§¦æ˜¯ã€‚</p>
<p>äººä¸äººä¹‹é—´çš„å·®è·ï¼Œå·²ç»ä¸å†æ˜¯ä½ åˆ°åº•ä¼šä»€ä¹ˆï¼Œè€Œæ˜¯å˜æˆäº†ä½ ä¼šè°ƒç”¨ä»€ä¹ˆã€‚</p>
<p>å½“ Skills å•†åº—é‡Œï¼Œå¤§å¸ˆä»¬çš„ç»éªŒè¢«æ•°å­—åŒ–ï¼Œé¢—ç²’åŒ–ã€‚</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦ç†Ÿèƒ½ç”Ÿå·§ï¼Œéœ€è¦ 10000 å°æ—¶å®šå¾‹å—ï¼Ÿ</p>
<p>æŸç§ç¨‹åº¦ä¸Šï¼Œè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œå·²ç»ä¸å†é‚£ä¹ˆç¬ƒå®šäº†ã€‚</p>
<p>è¿™ä¸–ç•Œå˜åŒ–çœŸçš„å¤ªå¿«ï¼Œå¦‚æœä½ è¿˜åœ¨çº ç»“ AI åˆ°åº•ä¼šä¸ä¼šå–ä»£æˆ‘ï¼Ÿ</p>
<p>é‚£ä½ å¯èƒ½å¿«è¦è¢«æ—¶ä»£ç”©åœ¨èº«åäº†ã€‚</p>
<p>çœŸæ­£çš„ç‹ äººï¼Œå·²ç»å¼€å§‹åœ¨è¿™äº›æŠ€èƒ½åº“é‡Œæ·˜é‡‘ï¼ŒæŠŠè‡ªå·±æ­¦è£…æˆä¸€æ”¯å•å…µä½œæˆ˜çš„ç‰¹ç§éƒ¨é˜Ÿã€‚</p>
<p>æ²¡é”™ï¼Œä½ è¦æ˜¯èƒ½åœ¨é‡Œé¢æŒ‘å‡ºä¸¤ä»¶è¶æ‰‹çš„å…µåˆƒï¼Œä½ ä»Šå¹´çš„ç”Ÿäº§åŠ›èµ·ç èƒ½ç¿»ä¸ªå‡ å€ã€‚</p>
<p>æ‰€ä»¥åƒä¸‡åˆ«è®©è‡ªå·±æˆä¸ºå·¥å…·ï¼Œè¦è®©è‡ªå·±æˆä¸ºè°ƒç”¨ä¸‡åƒå·¥å…·çš„æŒ‡æŒ¥å®˜ã€‚</p>
<p>è¿™æ‰æ˜¯è¿™ä¸ªæ—¶ä»£ï¼Œä½ æœ€åšå›ºçš„æŠ¤åŸæ²³ã€‚</p>
<h2 data-id="heading-6">â¤ï¸çˆ±å¿ƒä¸‰è¿å‡»</h2>
<p>1.å¦‚æœä½ è§‰å¾—æ¬§å·´çš„æ–‡ç« è¿˜åˆèƒƒå£ï¼Œå°±ç‚¹ä¸ªèµæ”¯æŒä¸‹å§ï¼Œä½ çš„<strong>èµ</strong>æ˜¯æˆ‘æœ€å¤§çš„åŠ¨åŠ›ã€‚</p>
<p>2.å…³æ³¨&gt;&gt;&gt;<a href="https://link.juejin.cn?target=https%3A%2F%2Fraw.githubusercontent.com%2FGeekhyt%2Ffront-end-canteen%2Frefs%2Fheads%2Fmaster%2Fimages%2Fqrcode.jpg" target="_blank" title="https://raw.githubusercontent.com/Geekhyt/front-end-canteen/refs/heads/master/images/qrcode.jpg" ref="nofollow noopener noreferrer">å…¬ä¼—å·æ¬§å·´èŠAI</a>ï¼ŒAI æ—¶ä»£é™ªä½ ä¸€èµ·æˆé•¿ã€‚</p>
<p>3.ç‚¹èµã€è¯„è®ºã€è½¬å‘ === å‚¬æ›´ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SQLæ•°æ®ç±»å‹è½¬æ¢ï¼šCASTè¯¦è§£åŠå®è·µ]]></title>    <link>https://juejin.cn/post/7598827641307021363</link>    <guid>https://juejin.cn/post/7598827641307021363</guid>    <pubDate>2026-01-25T03:22:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598827641307021363" data-draft-id="7598574507347116067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SQLæ•°æ®ç±»å‹è½¬æ¢ï¼šCASTè¯¦è§£åŠå®è·µ"/> <meta itemprop="keywords" content="æ•°æ®åº“,SQL"/> <meta itemprop="datePublished" content="2026-01-25T03:22:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹¬æ³ªäº†æ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2981531265546328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SQLæ•°æ®ç±»å‹è½¬æ¢ï¼šCASTè¯¦è§£åŠå®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2981531265546328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹¬æ³ªäº†æ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T03:22:57.000Z" title="Sun Jan 25 2026 03:22:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b714db443b264b439cf8dc2d789cc35e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916177&amp;x-signature=1sV7hHv0m1fb7EZUJSH9s%2BDrqgo%3D" alt="image" loading="lazy"/></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>â€ƒâ€ƒåœ¨ SQL æ•°æ®å¤„ç†ä¸­ï¼Œæ•°æ®ç±»å‹è½¬æ¢æ˜¯å¸¸è§éœ€æ±‚ï¼Œå°¤å…¶åœ¨è·¨ç³»ç»Ÿæ•°æ®äº¤äº’æ—¶ã€‚åœ¨SQLçš„ä¸–ç•Œé‡Œï¼Œæ•°æ®ç±»å‹è½¬æ¢æ˜¯ä¸€ä¸ªåŸºç¡€ä¸”å…³é”®çš„æ“ä½œï¼Œå®ƒè´¯ç©¿äºæ•°æ®åº“å¼€å‘ã€ç®¡ç†ä¸æ•°æ®åˆ†æçš„å„ä¸ªç¯èŠ‚ï¼Œæ·±åˆ»ç†è§£å®ƒä»¬å¯¹äºç¼–å†™é«˜æ•ˆã€ç¨³å®šçš„SQLä»£ç è‡³å…³é‡è¦ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€æ¦‚è¿°</h2>
<h3 data-id="heading-2">1.1 CAST å‡½æ•°æ˜¯ä»€ä¹ˆ</h3>
<p>â€ƒâ€ƒåœ¨å®é™…æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦åœ¨ä¸åŒæ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬ä»ç”¨æˆ·å¤„è·å–æ•°æ®æ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„æ•°æ®å¯èƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ—¶ï¼Œå¯èƒ½éœ€è¦è½¬æ¢ä¸ºå¯¹åº”çš„æ•°å€¼ç±»å‹æˆ–æ—¥æœŸç±»å‹ã€‚åˆæˆ–è€…åœ¨è¿›è¡Œæ•°æ®æŸ¥è¯¢å’Œåˆ†ææ—¶ï¼Œä¸ºäº†æ»¡è¶³ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘å’Œè®¡ç®—éœ€æ±‚ï¼Œä¹Ÿéœ€è¦å¯¹æ•°æ®ç±»å‹è¿›è¡Œè½¬æ¢ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»Ÿè®¡é”€å”®æ•°æ®æ—¶ï¼Œé”€å”®é‡‘é¢å¯èƒ½å­˜å‚¨ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼Œä½†åœ¨è¿›è¡Œæ±‚å’Œæˆ–å¹³å‡å€¼è®¡ç®—æ—¶ï¼Œå°±éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ•°å€¼ç±»å‹ã€‚</p>
<p>â€ƒâ€ƒÂ åœ¨æ•°æ®å¤„ç†çš„æˆ˜åœºä¸Šï¼ŒCAST å‡½æ•°å ªç§°æ˜¯æ•°æ®ç±»å‹è½¬æ¢çš„[<strong>ç‘å£«å†›åˆ€</strong>]ã€‚ä½œä¸º SQL æ ‡å‡†å‡½æ•°ï¼Œç”¨äºå°†ä¸€ä¸ªæ•°æ®ç±»å‹çš„å€¼è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹ï¼Œå®ƒæ—¢èƒ½è§£å†³æ•°å€¼ä¸å­—ç¬¦çš„â€œè·¨ç•ŒçŸ›ç›¾â€ï¼Œä¹Ÿèƒ½åŒ–è§£æ—¥æœŸæ ¼å¼çš„â€œæ—¶ç©ºé”™ä¹±â€ã€‚è¿™åœ¨å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®æ—¶éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œæˆ–è€…å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´æ•°ç­‰ã€‚</p>
<h3 data-id="heading-3">1.2 CAST å‡½æ•°çš„åŸºæœ¬è¯­æ³•</h3>
<p>â€ƒâ€ƒCAST å‡½æ•°çš„åŸºæœ¬è¯­æ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-built_in">CAST</span>(expression <span class="hljs-keyword">AS</span> data_type)
</code></pre>





















<table><thead><tr><th align="left">å‚æ•°</th><th align="left">ç®€è¦è¯´æ˜</th></tr></thead><tbody><tr><td align="left">expression</td><td align="left">è¦è½¬æ¢çš„åŸå§‹è¡¨è¾¾å¼</td></tr><tr><td align="left">AS</td><td align="left">ç”¨äºåˆ†éš”ä¸¤ä¸ªå‚æ•°ï¼Œåœ¨ASä¹‹å‰çš„æ˜¯è¦å¤„ç†çš„æ•°æ®ï¼Œåœ¨ASä¹‹åæ˜¯è¦è½¬æ¢çš„æ•°æ®ç±»å‹ã€‚</td></tr><tr><td align="left">data_type</td><td align="left">è¦è½¬æ¢æˆçš„æ•°æ®ç±»å‹ã€‚æ•°æ®åº“ä¸åŒï¼Œæ”¯æŒçš„æ•°æ®ç±»å‹ä¸åŒï¼Œä½¿ç”¨æ—¶éœ€æ³¨æ„ã€‚</td></tr></tbody></table>

































































<table><thead><tr><th align="left">ç±»å‹</th><th align="left">ç®€è¦è¯´æ˜</th><th align="center">æ ¼å¼</th></tr></thead><tbody><tr><td align="left">DATE</td><td align="left">å°† value è½¬åŒ–ä¸º DATE ç±»å‹</td><td align="center">YYYY-MM-DD</td></tr><tr><td align="left">DATETIME</td><td align="left">å°† value è½¬åŒ–ä¸º DATETIME ç±»å‹</td><td align="center">YYYY-MM-DD HH:MM:SS</td></tr><tr><td align="left">DECIMAL[(M[,D])]</td><td align="left">å°† value è½¬åŒ–ä¸º DECIMAL ç±»å‹ã€‚<br/>ä½¿ç”¨å¯é€‰çš„ M å’Œ D å‚æ•°æŒ‡å®šæœ€å¤§ä½æ•°ï¼ˆMï¼‰å’Œå°æ•°ç‚¹ï¼ˆDï¼‰åçš„ä½æ•°</td><td align="center"/></tr><tr><td align="left">TIME</td><td align="left">å°† value è½¬åŒ–ä¸º TIME ç±»å‹</td><td align="center">HH:MM:SS</td></tr><tr><td align="left">CHAR</td><td align="left">å°† value è½¬åŒ–ä¸º CHAR ç±»å‹ (å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²)</td><td align="center"/></tr><tr><td align="left">NCHAR</td><td align="left">å°† value è½¬åŒ–ä¸º NCHAR</td><td align="center"/></tr><tr><td align="left">SIGNED</td><td align="left">å°† value è½¬åŒ–ä¸º SIGNED (æœ‰ç¬¦å·çš„ 64 ä½æ•´æ•°)</td><td align="center"/></tr><tr><td align="left">UNSIGNED</td><td align="left">å°† value è½¬åŒ–ä¸º UNSIGNED (æ— ç¬¦å· 64 ä½æ•´æ•°)</td><td align="center"/></tr><tr><td align="left">BINARY</td><td align="left">å°† value è½¬åŒ–ä¸º BINARY (äºŒè¿›åˆ¶å­—ç¬¦ä¸²)</td><td align="center"/></tr><tr><td align="left">DOUBLE</td><td align="left">å°† value è½¬åŒ–ä¸º DOUBLE ç±»å‹</td><td align="center"/></tr><tr><td align="left">FLOAT</td><td align="left">å°† value è½¬åŒ–ä¸º FLOAT ç±»å‹</td><td align="center"/></tr></tbody></table>
<p>â€ƒâ€ƒä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå­—ç¬¦ä¸² <code>'2026-01-23'</code>ï¼Œæƒ³æŠŠå®ƒè½¬æˆæ—¥æœŸç±»å‹ï¼Œå°±å¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'2023-01-01'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">DATE</span>)
</code></pre>
<p>â€ƒâ€ƒè¿™åœ¨å¤„ç†åŸå§‹æ•°æ®ä¸æ˜¯æ ‡å‡†æ ¼å¼æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œæ¯”å¦‚ä»æ–‡æœ¬æ–‡ä»¶å¯¼å…¥æ•°æ®åï¼Œéœ€è¦æŠŠæŸäº›å­—æ®µè½¬æ¢æˆæ•°å€¼æˆ–è€…æ—¥æœŸç±»å‹ã€‚å®ƒç®€å•ç›´æ¥ï¼Œä½†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œç‰¹åˆ«æ˜¯ä¸åŒç±»å‹ä¹‹é—´çš„è½¬æ¢è§„åˆ™ã€‚å¦‚æœè½¬æ¢å¤±è´¥ï¼ˆæ¯”å¦‚æŠŠ ABC è½¬æˆæ•´æ•°ï¼‰ï¼Œå¤§å¤šæ•°æ•°æ®åº“ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥ä½¿ç”¨å‰æœ€å¥½ç¡®è®¤æ•°æ®æ˜¯å¯ä»¥å®‰å…¨è½¬æ¢çš„ã€‚</p>
<h2 data-id="heading-4">äºŒã€CAST çš„å®æˆ˜åœºæ™¯</h2>
<p>â€ƒâ€ƒCAST å‡½æ•°åœ¨ SQL ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨åœºæ™¯ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<h3 data-id="heading-5">2.1 æ•°æ®ç±»å‹è½¬æ¢</h3>
<p>â€ƒâ€ƒCAST å‡½æ•°æœ€å¸¸è§çš„ç”¨æ³•å°±æ˜¯è¿›è¡Œæ•°æ®ç±»å‹çš„è½¬æ¢ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œä½†éœ€è¦å°†å…¶è½¬æ¢ä¸ºæ•°å­—ç±»å‹è¿›è¡Œè®¡ç®—ï¼Œè¿™å°±å¯ä»¥ç”¨ CAST å‡½æ•°æ¥å®ç°ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"># å­—ç¬¦ä¸²è½¬æ•´æ•°
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'123'</span> <span class="hljs-keyword">AS</span> SIGNED);

# å­—ç¬¦ä¸²è½¬æµ®ç‚¹å‹æ•°å­—
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'123.456'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">FLOAT</span>);
</code></pre>
<h3 data-id="heading-6">2.2 å­—ç¬¦ä¸²è½¬æ¢</h3>
<p>â€ƒâ€ƒé™¤äº†æ•°æ®ç±»å‹çš„è½¬æ¢ï¼ŒCAST å‡½æ•°è¿˜å¯ä»¥ç”¨äºå­—ç¬¦ä¸²çš„è½¬æ¢ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"># å°†å½“å‰æ—¶é—´è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(NOW() <span class="hljs-keyword">AS</span> <span class="hljs-type">CHAR</span>);

# æ•´æ•°è½¬å­—ç¬¦ä¸²
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-number">123</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">CHAR</span>);

# æµ®ç‚¹æ•°è½¬å­—ç¬¦ä¸²
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-number">123.456</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">CHAR</span>);
</code></pre>
<p>â€ƒâ€ƒåœ¨è¿›è¡Œå­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œéœ€è¦æ³¨æ„ç›®æ ‡æ•°æ®ç±»å‹çš„é•¿åº¦é™åˆ¶ã€‚å¦‚æœè½¬æ¢åçš„å­—ç¬¦ä¸²é•¿åº¦è¶…è¿‡äº†ç›®æ ‡æ•°æ®ç±»å‹çš„é•¿åº¦é™åˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æˆªæ–­é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨LEFTå‡½æ•°æ¥æˆªå–æŒ‡å®šé•¿åº¦çš„å­å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LEFT</span>(<span class="hljs-built_in">CAST</span>(<span class="hljs-string">'He1lo,World'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">CHAR</span>(<span class="hljs-number">5</span>)), <span class="hljs-number">5</span>);
</code></pre>
<blockquote>
<p>ä½¿ç”¨CASTå‡½æ•°æ—¶éœ€è¦æ³¨æ„ï¼Œä¸åŒæ•°æ®åº“å¯¹æ•°æ®ç±»å‹çš„å†™æ³•ç•¥æœ‰å·®å¼‚ã€‚ä¾‹å¦‚ï¼ŒMySQLä¸­ç”¨CHARæˆ–VARCHARï¼Œè€ŒSQL Serverä¸­å¸¸ç”¨NVARCHARã€‚</p>
</blockquote>
<h3 data-id="heading-7">2.3 æ—¥æœŸæ—¶é—´è½¬æ¢</h3>
<p>â€ƒâ€ƒåœ¨ SQL ä¸­ï¼Œæ—¥æœŸçš„æ ¼å¼æœ‰å¾ˆå¤šç§ï¼Œæœ‰æ—¶å€™éœ€è¦å°†æ—¥æœŸè½¬æ¢ä¸ºç‰¹å®šçš„æ ¼å¼ï¼Œè¿™æ—¶å€™å¯ä»¥å°è¯•è½¬æ¢ä¸º DATEã€TIMEã€DATETIME ç±»å‹ã€‚CAST å‡½æ•°å¯ä»¥ç”¨äºæ—¥æœŸçš„è½¬æ¢ï¼Œä»¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªæ—¥æœŸç±»å‹çš„å­—æ®µï¼Œä½†éœ€è¦å°†å…¶è½¬æ¢ä¸ºå¦ä¸€ç§æ—¥æœŸæ ¼å¼ï¼Œè¿™å°±å¯ä»¥ç”¨ CAST å‡½æ•°æ¥å®ç°ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"># å°†å€¼è½¬æ¢ä¸º<span class="hljs-type">TIME</span>æ•°æ®ç±»å‹
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(NOW() <span class="hljs-keyword">AS</span> <span class="hljs-type">time</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'2026-01-25'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">time</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'2026-01-25 10:30:00'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">time</span>);

# å°†å€¼è½¬æ¢ä¸º<span class="hljs-type">DATE</span>æ•°æ®ç±»å‹
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(NOW() <span class="hljs-keyword">AS</span> <span class="hljs-type">date</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'2026-01-25'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">date</span>);
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'2026-01-25 10:30:00'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">date</span>);

# å°†å€¼è½¬æ¢ä¸ºDATETIMEæ•°æ®ç±»å‹
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(NOW() <span class="hljs-keyword">AS</span> datetime);
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'2026-01-25'</span> <span class="hljs-keyword">AS</span> datetime);
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'2026-01-25 10:30:00'</span> <span class="hljs-keyword">AS</span> datetime);
</code></pre>
<h3 data-id="heading-8">2.4 æ•°å€¼ä¸å­—ç¬¦çš„â€œå˜å½¢è®°â€</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å­—ç¬¦ä¸²è½¬æ•´æ•°</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'123'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">INTEGER</span>) <span class="hljs-keyword">AS</span> string_to_int;

<span class="hljs-comment">-- å­—ç¬¦ä¸²è½¬å°æ•°(æŒ‡å®šç²¾åº¦)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'123.45'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">5</span>,<span class="hljs-number">2</span>)) <span class="hljs-keyword">AS</span> string_to_decimal;

<span class="hljs-comment">-- ç§‘å­¦è®¡æ•°æ³•å­—ç¬¦ä¸²è½¬æµ®ç‚¹</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'1.23E+5'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">FLOAT</span>) <span class="hljs-keyword">AS</span> scientific_to_float;

<span class="hljs-comment">-- å¸¦è´§å¸ç¬¦å·å­—ç¬¦ä¸²è½¬æ•°å€¼(éœ€æ•°æ®åº“æ”¯æŒ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'$123.45'</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)) <span class="hljs-keyword">AS</span> currency_to_decimal;
</code></pre>
<p>â€ƒâ€ƒåœ¨ SQL ä¸­ï¼Œå½“éœ€è¦å¯¹å­˜å‚¨ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„æ•°å€¼å­—æ®µè¿›è¡Œæ’åºæ—¶ï¼Œç›´æ¥ä½¿ç”¨ ORDER BY ä¼šå¯¼è‡´å­—å…¸åºæ’åºè€Œéæ•°å€¼æ’åºã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-number">123.456</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>));
</code></pre>
<p>â€ƒâ€ƒæœ‰æ—¶å€™æˆ‘ä»¬ä¼šä»æ—¥å¿—æˆ–è€…å…¶ä»–ç³»ç»Ÿä¸­æ‹¿åˆ°ç±»ä¼¼ <code>'100'</code> è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œä½†å®é™…æƒ³è¦åšåŠ å‡ä¹˜é™¤æ“ä½œï¼Œè¿™æ—¶å€™å°±éœ€è¦è½¬æ¢æˆæ•°å­—ç±»å‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">CAST</span>(<span class="hljs-string">'100'</span> <span class="hljs-keyword">AS</span> SIGNED)
</code></pre>
<p>â€ƒâ€ƒå¦‚æœå­—ç¬¦ä¸²é‡Œæœ‰éæ•°å­—å­—ç¬¦ï¼Œæ¯”å¦‚ <code>'100å…ƒ'</code>ï¼Œé‚£å°±ä¼šå‡ºé”™ã€‚æ‰€ä»¥åœ¨è½¬æ¢ä¹‹å‰å¯ä»¥ç”¨ä¸€äº›å‡½æ•°é¢„å¤„ç†ï¼Œæ¯”å¦‚ <code>TRIM()</code> æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤æ‰éæ•°å­—éƒ¨åˆ†ã€‚</p>
<h2 data-id="heading-9">ä¸‰ã€é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-10">3.1 ç©ºå­—ç¬¦é™·é˜±</h3>
<p>â€ƒâ€ƒä¸åŒæ•°æ®åº“å¯¹  CAST å‡½æ•°çš„å¤„ç†å„æœ‰å·®å¼‚ï¼Œä¾‹å¦‚ <code>CAST('' AS DATE)</code>ï¼ŒMySQL ä¼šç›´æ¥æŠ¥é”™ï¼ŒPostgreSQL è¿”å›æ— æ•ˆæ—¥æœŸé”™è¯¯ï¼ŒOracle åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚å»ºè®®å…ˆç”¨ <code>CASE WHEN</code> è¿‡æ»¤ç©ºå€¼ï¼Œæˆ–è€…ç»“åˆ<code>COALESCE(NULLIF(column,''), 'é»˜è®¤å€¼')</code>å¤„ç†ã€‚</p>
<h3 data-id="heading-11">3.2 ç²¾åº¦ä¸¢å¤±</h3>
<p>â€ƒâ€ƒå°† DECIMAL è½¬ INT ä¼šç›´æ¥æˆªæ–­å°æ•°ï¼Œéœ€é¢„å…ˆç”¨<code>ROUND()</code> æˆ–è€… <code>CEILING()</code>å¤„ç†æ›´å®‰å…¨ã€‚</p>
<h2 data-id="heading-12">å››ã€æ€»ç»“</h2>
<p>â€ƒâ€ƒCAST å‡½æ•°åœ¨æ•°æ®å¤„ç†å’Œè½¬æ¢ä¸­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®å¯¼å…¥å’ŒæŠ¥å‘Šç”Ÿæˆæ—¶ï¼Œå¯ä»¥ç¡®ä¿æ•°æ®ç±»å‹çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbfdbaeb3ac34bce8873f6f698fa4ac7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54us5rOq5LqG5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916177&amp;x-signature=fQL93axESmVpDFnm9zv0ljLPJsQ%3D" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HonoXï¼šä¸‹ä¸€ä»£å…¨æ ˆ Web æ¡†æ¶æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7598818096753164339</link>    <guid>https://juejin.cn/post/7598818096753164339</guid>    <pubDate>2026-01-25T03:29:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598818096753164339" data-draft-id="7598827641307037747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HonoXï¼šä¸‹ä¸€ä»£å…¨æ ˆ Web æ¡†æ¶æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="è¾¹ç¼˜è®¡ç®—,JavaScript,Bun"/> <meta itemprop="datePublished" content="2026-01-25T03:29:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jump_jump"/> <meta itemprop="url" content="https://juejin.cn/user/4230576474692765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HonoXï¼šä¸‹ä¸€ä»£å…¨æ ˆ Web æ¡†æ¶æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576474692765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jump_jump
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T03:29:40.000Z" title="Sun Jan 25 2026 03:29:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>ä¸€ä¸ªåŸºäº Hono çš„å…¨æ ˆ Web æ¡†æ¶ï¼Œç»“åˆäº† Islands æ¶æ„å’Œè¾¹ç¼˜è®¡ç®—çš„å¼ºå¤§èƒ½åŠ›</p>
</blockquote>
<h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é¢ä¸´ç€ä¸€ä¸ªæ°¸æ’çš„æŒ‘æˆ˜ï¼šå¦‚ä½•åœ¨æä¾›ä¸°å¯Œäº¤äº’ä½“éªŒçš„åŒæ—¶ï¼Œä¿æŒå¿«é€Ÿçš„åŠ è½½é€Ÿåº¦å’Œä¼˜ç§€çš„æ€§èƒ½ï¼Ÿä¼ ç»Ÿçš„å•é¡µåº”ç”¨ï¼ˆSPAï¼‰è™½ç„¶äº¤äº’æµç•…ï¼Œä½†é¦–å±åŠ è½½æ…¢ã€SEO å›°éš¾ï¼›è€Œä¼ ç»Ÿçš„æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰è™½ç„¶é¦–å±å¿«ï¼Œä½†ç¼ºä¹ç°ä»£å‰ç«¯æ¡†æ¶çš„å¼€å‘ä½“éªŒã€‚</p>
<p>HonoX çš„å‡ºç°ï¼Œä¸ºè¿™ä¸ªé—®é¢˜æä¾›äº†ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒæ˜¯åŸºäºè¶…å¿«çš„ Hono Web æ¡†æ¶æ„å»ºçš„å…¨æ ˆæ¡†æ¶ï¼Œé‡‡ç”¨ Islands æ¶æ„ï¼Œå®Œç¾å¹³è¡¡äº†æ€§èƒ½å’Œå¼€å‘ä½“éªŒã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯ HonoXï¼Ÿ</h2>
<p>HonoX æ˜¯ä¸€ä¸ªå…¨æ ˆ Web æ¡†æ¶ï¼Œå®ƒå»ºç«‹åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhono.dev%2F" target="_blank" title="https://hono.dev/" ref="nofollow noopener noreferrer">Hono</a> ä¹‹ä¸Šã€‚Hono æ˜¯ä¸€ä¸ªè½»é‡çº§ã€è¶…å¿«é€Ÿçš„ Web æ¡†æ¶ï¼Œå¯ä»¥è¿è¡Œåœ¨ä»»ä½• JavaScript è¿è¡Œæ—¶ï¼ˆCloudflare Workersã€Denoã€Bunã€Node.js ç­‰ï¼‰ã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒç‰¹æ€§</h3>
<ol>
<li><strong>Islands æ¶æ„</strong> - æ¸è¿›å¼æ°´åˆï¼Œåªåœ¨éœ€è¦çš„åœ°æ–¹åŠ è½½ JavaScript</li>
<li><strong>æ–‡ä»¶è·¯ç”±ç³»ç»Ÿ</strong> - åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ç›´è§‚è·¯ç”±</li>
<li><strong>è¾¹ç¼˜ä¼˜å…ˆ</strong> - ä¸º Cloudflare Workers ç­‰è¾¹ç¼˜è¿è¡Œæ—¶ä¼˜åŒ–</li>
<li><strong>ç±»å‹å®‰å…¨</strong> - å®Œæ•´çš„ TypeScript æ”¯æŒ</li>
<li><strong>é›¶é…ç½®</strong> - å¼€ç®±å³ç”¨çš„æœ€ä½³å®è·µ</li>
<li><strong>æè‡´æ€§èƒ½</strong> - ç»§æ‰¿ Hono çš„è¶…å¿«æ€§èƒ½</li>
</ol>
<h2 data-id="heading-3">Islands æ¶æ„ï¼šé‡æ–°æ€è€ƒå‰ç«¯æ°´åˆ</h2>
<h3 data-id="heading-4">ä»€ä¹ˆæ˜¯ Islands æ¶æ„ï¼Ÿ</h3>
<p>Islands æ¶æ„æ˜¯ä¸€ç§ç°ä»£å‰ç«¯æ¶æ„æ¨¡å¼ï¼Œæœ€æ—©ç”± Etsy çš„å‰ç«¯æ¶æ„å¸ˆ Katie Sylor-Miller æå‡ºï¼Œåæ¥è¢« Astroã€Fresh ç­‰æ¡†æ¶é‡‡ç”¨ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸ªç½‘é¡µæ˜¯ä¸€ç‰‡æµ·æ´‹ï¼Œè€Œéœ€è¦äº¤äº’çš„ç»„ä»¶æ˜¯æµ·æ´‹ä¸­çš„"å²›å±¿"ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é™æ€ <span class="hljs-selector-tag">HTML</span>ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰          â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Island  â”‚      â”‚ Island  â”‚  â”‚
â”‚  â”‚ (äº¤äº’)  â”‚      â”‚ (äº¤äº’)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚ Island  â”‚             â”‚
â”‚         â”‚ (äº¤äº’)  â”‚             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>è¿™ç§æ¶æ„çš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<ul>
<li><strong>å‡å°‘ JavaScript è´Ÿè½½</strong> - åªåŠ è½½çœŸæ­£éœ€è¦çš„ JavaScript</li>
<li><strong>æå‡é¦–å±æ€§èƒ½</strong> - é™æ€å†…å®¹ç«‹å³å¯è§</li>
<li><strong>æ¸è¿›å¼å¢å¼º</strong> - äº¤äº’ç»„ä»¶é€æ­¥åŠ è½½å’Œæ¿€æ´»</li>
<li><strong>æ›´å¥½çš„ SEO</strong> - å®Œæ•´çš„æœåŠ¡ç«¯æ¸²æŸ“å†…å®¹</li>
</ul>
<h3 data-id="heading-5">HonoX ä¸­çš„ Islands</h3>
<p>åœ¨ HonoX ä¸­ä½¿ç”¨ Islands éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// app/islands/Counter.tsx</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono/jsx'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params">{ initialCount = <span class="hljs-number">0</span> }</span>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(initialCount)

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count - 1)}&gt;-<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>åªéœ€å°†ç»„ä»¶æ”¾åœ¨ <code>app/islands/</code> ç›®å½•ä¸‹ï¼ŒHonoX ä¼šè‡ªåŠ¨å¤„ç†ï¼š</p>
<ul>
<li>æœåŠ¡ç«¯æ¸²æŸ“</li>
<li>å®¢æˆ·ç«¯ä»£ç åˆ†å‰²</li>
<li>æŒ‰éœ€æ°´åˆ</li>
</ul>
<p>åœ¨é¡µé¢ä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// app/routes/index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Counter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../islands/Counter'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æˆ‘çš„é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è¿™æ®µæ–‡å­—æ˜¯çº¯é™æ€çš„ï¼Œä¸éœ€è¦ JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Counter</span> <span class="hljs-attr">initialCount</span>=<span class="hljs-string">{0}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h2 data-id="heading-6">æ–‡ä»¶è·¯ç”±ç³»ç»Ÿï¼šçº¦å®šä¼˜äºé…ç½®</h2>
<p>HonoX é‡‡ç”¨åŸºäºæ–‡ä»¶çš„è·¯ç”±ç³»ç»Ÿï¼Œè®©è·¯ç”±ç®¡ç†å˜å¾—ç›´è§‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">app/routes/
â”œâ”€â”€ index.tsx           â†’ /
â”œâ”€â”€ about.tsx           â†’ /about
â”œâ”€â”€ blog/
â”‚   â”œâ”€â”€ index.tsx       â†’ /blog
â”‚   â””â”€â”€ [slug].tsx      â†’ /blog/:slug
â””â”€â”€ api/
    â”œâ”€â”€ users.ts        â†’ /api/users
    â””â”€â”€ <span class="hljs-built_in">users</span>/
        â””â”€â”€ [<span class="hljs-built_in">id</span>].ts     â†’ /api/users/:<span class="hljs-built_in">id</span>
</code></pre>
<h3 data-id="heading-7">åŠ¨æ€è·¯ç”±</h3>
<p>ä½¿ç”¨æ–¹æ‹¬å·å®šä¹‰åŠ¨æ€è·¯ç”±å‚æ•°ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// app/routes/blog/[slug].tsx</span>
<span class="hljs-keyword">import</span> { createRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'honox/factory'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createRoute</span>(<span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { slug } = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">param</span>()

  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">render</span>(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ–‡ç« ï¼š{slug}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span></span>
  )
})
</code></pre>
<h3 data-id="heading-8">API è·¯ç”±</h3>
<p>API è·¯ç”±è¿”å› JSON æ•°æ®ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// app/routes/api/users/[id].ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Hono</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>
<span class="hljs-keyword">import</span> { zValidator } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hono/zod-validator'</span>
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hono</span>()

<span class="hljs-comment">// GET /api/users/:id</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/:id'</span>, <span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> id = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">param</span>(<span class="hljs-string">'id'</span>)
  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ id, <span class="hljs-attr">name</span>: <span class="hljs-string">'User '</span> + id })
})

<span class="hljs-comment">// POST /api/users/:id</span>
<span class="hljs-keyword">const</span> schema = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>),
  <span class="hljs-attr">email</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">email</span>(),
})

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/:id'</span>, <span class="hljs-title function_">zValidator</span>(<span class="hljs-string">'json'</span>, schema), <span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> data = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">valid</span>(<span class="hljs-string">'json'</span>)
  <span class="hljs-keyword">const</span> id = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">param</span>(<span class="hljs-string">'id'</span>)

  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({
    id,
    ...data,
    <span class="hljs-attr">updated</span>: <span class="hljs-literal">true</span>
  })
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> app
</code></pre>
<h2 data-id="heading-9">ä¸­é—´ä»¶ç³»ç»Ÿï¼šå¼ºå¤§ä¸”çµæ´»</h2>
<p>HonoX ç»§æ‰¿äº† Hono çš„ä¸­é—´ä»¶ç³»ç»Ÿï¼Œè®©ä½ å¯ä»¥è½»æ¾å¤„ç†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// app/routes/_middleware.tsx</span>
<span class="hljs-keyword">import</span> { createRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'honox/factory'</span>
<span class="hljs-keyword">import</span> { compress } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono/compress'</span>
<span class="hljs-keyword">import</span> { logger } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono/logger'</span>
<span class="hljs-keyword">import</span> { secureHeaders } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono/secure-headers'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createRoute</span>(<span class="hljs-function">(<span class="hljs-params">c, next</span>) =&gt;</span> {
  <span class="hljs-comment">// æ—¥å¿—è®°å½•</span>
  <span class="hljs-title function_">logger</span>()(c, next)

  <span class="hljs-comment">// å®‰å…¨å¤´</span>
  <span class="hljs-title function_">secureHeaders</span>()(c, next)

  <span class="hljs-comment">// å“åº”å‹ç¼©</span>
  <span class="hljs-title function_">compress</span>()(c, next)

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>()
})
</code></pre>
<h3 data-id="heading-10">è‡ªå®šä¹‰ä¸­é—´ä»¶</h3>
<p>åˆ›å»ºè‡ªå®šä¹‰ä¸­é—´ä»¶ä¹Ÿå¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ€§èƒ½è®¡æ—¶ä¸­é—´ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> timing = <span class="hljs-title function_">createMiddleware</span>(<span class="hljs-keyword">async</span> (c, next) =&gt; {
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>()
  <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()

  c.<span class="hljs-title function_">header</span>(<span class="hljs-string">'Server-Timing'</span>, <span class="hljs-string">`total;dur=<span class="hljs-subst">${end - start}</span>`</span>)
})

<span class="hljs-comment">// è®¤è¯ä¸­é—´ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> auth = <span class="hljs-title function_">createMiddleware</span>(<span class="hljs-keyword">async</span> (c, next) =&gt; {
  <span class="hljs-keyword">const</span> token = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">header</span>(<span class="hljs-string">'Authorization'</span>)

  <span class="hljs-keyword">if</span> (!token) {
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Unauthorized'</span> }, <span class="hljs-number">401</span>)
  }

  <span class="hljs-comment">// éªŒè¯ token...</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>()
})
</code></pre>
<h2 data-id="heading-11">æ€§èƒ½ä¼˜åŒ–ï¼šä»æ¡†æ¶å±‚é¢å¼€å§‹</h2>
<p>HonoX å†…ç½®äº†å¤šç§æ€§èƒ½ä¼˜åŒ–ï¼š</p>
<h3 data-id="heading-12">1. è‡ªåŠ¨ä»£ç åˆ†å‰²</h3>
<p>æ¯ä¸ª Island ç»„ä»¶è‡ªåŠ¨åˆ†å‰²æˆç‹¬ç«‹çš„ chunkï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è‡ªåŠ¨ç”Ÿæˆç±»ä¼¼è¿™æ ·çš„è¾“å‡º</span>
dist/
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ island-<span class="hljs-title class_">Counter</span>.<span class="hljs-property">js</span>    (3KB)
â”‚   â”œâ”€â”€ island-<span class="hljs-title class_">Search</span>.<span class="hljs-property">js</span>     (5KB)
â”‚   â””â”€â”€ island-<span class="hljs-title class_">Modal</span>.<span class="hljs-property">js</span>      (4KB)
â””â”€â”€ server/
    â””â”€â”€ index.<span class="hljs-property">js</span>
</code></pre>
<h3 data-id="heading-13">2. æµå¼ SSR</h3>
<p>ä½¿ç”¨ Suspense å®ç°æµå¼æ¸²æŸ“ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono/jsx'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AsyncData</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../islands/AsyncData'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ç«‹å³æ˜¾ç¤ºçš„æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">AsyncData</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<p>é¡µé¢æ¸²æŸ“æµç¨‹ï¼š</p>
<ol>
<li>ç«‹å³å‘é€ HTML å¤´éƒ¨å’Œé™æ€å†…å®¹</li>
<li>å¼‚æ­¥ç»„ä»¶å‡†å¤‡å¥½åæµå¼å‘é€</li>
<li>æœ€åå‘é€æ¿€æ´»è„šæœ¬</li>
</ol>
<h3 data-id="heading-14">3. æ™ºèƒ½ç¼“å­˜ç­–ç•¥</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// é™æ€èµ„æºé•¿æœŸç¼“å­˜</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/static/*'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
  c.<span class="hljs-title function_">header</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'public, max-age=31536000, immutable'</span>)
  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">next</span>()
})

<span class="hljs-comment">// API å“åº” ETag ç¼“å­˜</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>()
  <span class="hljs-keyword">const</span> etag = <span class="hljs-title function_">generateETag</span>(data)

  <span class="hljs-keyword">if</span> (c.<span class="hljs-property">req</span>.<span class="hljs-title function_">header</span>(<span class="hljs-string">'If-None-Match'</span>) === etag) {
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">body</span>(<span class="hljs-literal">null</span>, <span class="hljs-number">304</span>)
  }

  c.<span class="hljs-title function_">header</span>(<span class="hljs-string">'ETag'</span>, etag)
  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>(data)
})
</code></pre>
<h2 data-id="heading-15">ç±»å‹å®‰å…¨ï¼šç«¯åˆ°ç«¯çš„ TypeScript</h2>
<p>HonoX æä¾›å®Œæ•´çš„ç±»å‹å®‰å…¨ï¼Œä»è·¯ç”±åˆ° APIï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®šä¹‰ API ç±»å‹</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-comment">// API è·¯ç”±è‡ªåŠ¨æ¨æ–­ç±»å‹</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hono</span>&lt;{ <span class="hljs-title class_">Variables</span>: { <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> } }&gt;()

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user'</span>, <span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> user = c.<span class="hljs-title function_">get</span>(<span class="hljs-string">'user'</span>) <span class="hljs-comment">// ç±»å‹ï¼šUser</span>
  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>(user)
})

<span class="hljs-comment">// åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ç±»å‹</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
</code></pre>
<h2 data-id="heading-16">éƒ¨ç½²ï¼šè¾¹ç¼˜ä¼˜å…ˆ</h2>
<p>HonoX é’ˆå¯¹è¾¹ç¼˜è¿è¡Œæ—¶ä¼˜åŒ–ï¼Œç‰¹åˆ«æ˜¯ Cloudflare Workersï¼š</p>
<h3 data-id="heading-17">Cloudflare Pages éƒ¨ç½²</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ„å»º</span>
npm run build

<span class="hljs-comment"># éƒ¨ç½²</span>
npm run deploy
</code></pre>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>å…¨çƒ CDN</strong> - 300+ ä¸ªè¾¹ç¼˜èŠ‚ç‚¹</li>
<li><strong>é›¶å†·å¯åŠ¨</strong> - Workers å³æ—¶å“åº”</li>
<li><strong>è‡ªåŠ¨æ‰©å±•</strong> - æ— éœ€é…ç½®</li>
<li><strong>ä½æˆæœ¬</strong> - å…è´¹å±‚æ¯å¤© 100,000 è¯·æ±‚</li>
</ul>
<h3 data-id="heading-18">å…¶ä»–å¹³å°</h3>
<p>HonoX ä¹Ÿæ”¯æŒéƒ¨ç½²åˆ°ï¼š</p>
<ul>
<li><strong>Vercel</strong> - ä½¿ç”¨ Node.js é€‚é…å™¨</li>
<li><strong>Netlify</strong> - Edge Functions</li>
<li><strong>Deno Deploy</strong> - åŸç”Ÿæ”¯æŒ</li>
<li><strong>ä¼ ç»ŸæœåŠ¡å™¨</strong> - Node.js</li>
</ul>
<h2 data-id="heading-19">å®æˆ˜æ¡ˆä¾‹ï¼šæ„å»ºä¸€ä¸ªåšå®¢</h2>
<p>è®©æˆ‘ä»¬ç”¨ HonoX æ„å»ºä¸€ä¸ªå®Œæ•´çš„åšå®¢ç³»ç»Ÿï¼š</p>
<h3 data-id="heading-20">1. æ–‡ç« åˆ—è¡¨é¡µ</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// app/routes/blog/index.tsx</span>
<span class="hljs-keyword">import</span> { createRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'honox/factory'</span>
<span class="hljs-keyword">import</span> { getPosts } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../lib/posts'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createRoute</span>(<span class="hljs-keyword">async</span> (c) =&gt; {
  <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPosts</span>()

  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">render</span>(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"blog"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>åšå®¢æ–‡ç« <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {posts.map(post =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{post.slug}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{</span>`/<span class="hljs-attr">blog</span>/${<span class="hljs-attr">post.slug</span>}`}&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{post.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">time</span>&gt;</span>{post.date}<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
})
</code></pre>
<h3 data-id="heading-21">2. æ–‡ç« è¯¦æƒ…é¡µ</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// app/routes/blog/[slug].tsx</span>
<span class="hljs-keyword">import</span> { createRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'honox/factory'</span>
<span class="hljs-keyword">import</span> { getPost } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../lib/posts'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CommentSection</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../../islands/CommentSection'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createRoute</span>(<span class="hljs-keyword">async</span> (c) =&gt; {
  <span class="hljs-keyword">const</span> { slug } = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">param</span>()
  <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPost</span>(slug)

  <span class="hljs-keyword">if</span> (!post) {
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">notFound</span>()
  }

  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">render</span>(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{post.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">time</span>&gt;</span>{post.date}<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{post.author}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">post.content</span> }} /&gt;</span>

      {/* è¯„è®ºåŒºä½¿ç”¨ Island å®ç°äº¤äº’ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">CommentSection</span> <span class="hljs-attr">postId</span>=<span class="hljs-string">{slug}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span></span>,
    {
      <span class="hljs-attr">title</span>: post.<span class="hljs-property">title</span>,
      <span class="hljs-attr">description</span>: post.<span class="hljs-property">excerpt</span>,
    }
  )
})
</code></pre>
<h3 data-id="heading-22">3. äº¤äº’å¼è¯„è®ºç»„ä»¶</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// app/islands/CommentSection.tsx</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono/jsx'</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Comment</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">author</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">createdAt</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CommentSection</span>(<span class="hljs-params">{ postId }: { postId: <span class="hljs-built_in">string</span> }</span>) {
  <span class="hljs-keyword">const</span> [comments, setComments] = useState&lt;<span class="hljs-title class_">Comment</span>[]&gt;([])
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadComments</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>)
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/comments/<span class="hljs-subst">${postId}</span>`</span>)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()
    <span class="hljs-title function_">setComments</span>(data.<span class="hljs-property">comments</span>)
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>)
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">submitComment</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e: Event</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>()
    <span class="hljs-keyword">const</span> form = e.<span class="hljs-property">target</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLFormElement</span>
    <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(form)

    <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/comments/<span class="hljs-subst">${postId}</span>`</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">author</span>: formData.<span class="hljs-title function_">get</span>(<span class="hljs-string">'author'</span>),
        <span class="hljs-attr">content</span>: formData.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content'</span>),
      }),
    })

    form.<span class="hljs-title function_">reset</span>()
    <span class="hljs-title function_">loadComments</span>()
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"comments"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>è¯„è®º<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{loadComments}</span>&gt;</span>
        {loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½è¯„è®º'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

      {comments.map(comment =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{comment.id}</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"comment"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{comment.author}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{comment.content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">time</span>&gt;</span>{comment.createdAt}<span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}

      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{submitComment}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"author"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"æ‚¨çš„åå­—"</span> <span class="hljs-attr">required</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯„è®ºå†…å®¹"</span> <span class="hljs-attr">required</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>æäº¤è¯„è®º<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span>
  )
}
</code></pre>
<h3 data-id="heading-23">4. è¯„è®º API</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// app/routes/api/comments/[postId].ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Hono</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'hono'</span>
<span class="hljs-keyword">import</span> { zValidator } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hono/zod-validator'</span>
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hono</span>()

<span class="hljs-keyword">const</span> commentSchema = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">author</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">50</span>),
  <span class="hljs-attr">content</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">max</span>(<span class="hljs-number">1000</span>),
})

<span class="hljs-comment">// è·å–è¯„è®º</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/:postId'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
  <span class="hljs-keyword">const</span> { postId } = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">param</span>()

  <span class="hljs-comment">// ä»æ•°æ®åº“è·å–è¯„è®º</span>
  <span class="hljs-keyword">const</span> comments = <span class="hljs-keyword">await</span> db.<span class="hljs-property">comments</span>
    .<span class="hljs-title function_">where</span>(<span class="hljs-string">'postId'</span>, postId)
    .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'createdAt'</span>, <span class="hljs-string">'desc'</span>)
    .<span class="hljs-title function_">get</span>()

  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ comments })
})

<span class="hljs-comment">// æ·»åŠ è¯„è®º</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/:postId'</span>, <span class="hljs-title function_">zValidator</span>(<span class="hljs-string">'json'</span>, commentSchema), <span class="hljs-keyword">async</span> (c) =&gt; {
  <span class="hljs-keyword">const</span> { postId } = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">param</span>()
  <span class="hljs-keyword">const</span> data = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">valid</span>(<span class="hljs-string">'json'</span>)

  <span class="hljs-keyword">const</span> comment = <span class="hljs-keyword">await</span> db.<span class="hljs-property">comments</span>.<span class="hljs-title function_">create</span>({
    postId,
    ...data,
    <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
  })

  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>(comment, <span class="hljs-number">201</span>)
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> app
</code></pre>
<h2 data-id="heading-24">ä¸å…¶ä»–æ¡†æ¶å¯¹æ¯”</h2>
<h3 data-id="heading-25">HonoX vs Next.js</h3>
<p><strong>HonoX çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ›´è½»é‡ï¼ˆæ ¸å¿ƒæ›´å°ï¼‰</li>
<li>è¾¹ç¼˜ä¼˜å…ˆè®¾è®¡</li>
<li>æ›´ç®€å•çš„å­¦ä¹ æ›²çº¿</li>
<li>æ›´å¿«çš„å†·å¯åŠ¨</li>
</ul>
<p><strong>Next.js çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ›´æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿ</li>
<li>æ›´å¤šçš„å®˜æ–¹é›†æˆ</li>
<li>React Server Components</li>
<li>æ›´å¼ºå¤§çš„å›¾åƒä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-26">HonoX vs Astro</h3>
<p><strong>ç›¸ä¼¼ç‚¹ï¼š</strong></p>
<ul>
<li>éƒ½ä½¿ç”¨ Islands æ¶æ„</li>
<li>éƒ½æ³¨é‡æ€§èƒ½</li>
<li>éƒ½æ”¯æŒå¤šæ¡†æ¶</li>
</ul>
<p><strong>HonoX çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ›´å¥½çš„ API è·¯ç”±</li>
<li>åŸç”Ÿæ”¯æŒè¾¹ç¼˜è¿è¡Œæ—¶</li>
<li>æ›´è½»é‡çš„è¿è¡Œæ—¶</li>
</ul>
<p><strong>Astro çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>å¯ä»¥æ··ç”¨å¤šä¸ªå‰ç«¯æ¡†æ¶</li>
<li>æ›´ä¸°å¯Œçš„å†…å®¹å¤„ç†åŠŸèƒ½</li>
<li>æ›´å¥½çš„é™æ€ç«™ç‚¹ç”Ÿæˆ</li>
</ul>
<h3 data-id="heading-27">HonoX vs Fresh</h3>
<p><strong>ç›¸ä¼¼ç‚¹ï¼š</strong></p>
<ul>
<li>éƒ½åŸºäº Islands æ¶æ„</li>
<li>éƒ½ä½¿ç”¨æ–‡ä»¶è·¯ç”±</li>
<li>éƒ½æ³¨é‡æ€§èƒ½</li>
</ul>
<p><strong>HonoX çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ”¯æŒæ›´å¤šè¿è¡Œæ—¶</li>
<li>æ›´çµæ´»çš„ä¸­é—´ä»¶ç³»ç»Ÿ</li>
<li>åŸºäº Hono çš„å¼ºå¤§ç”Ÿæ€</li>
</ul>
<p><strong>Fresh çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>Deno åŸç”Ÿé›†æˆ</li>
<li>Preact é»˜è®¤æ”¯æŒ</li>
<li>æ›´ç®€å•çš„é…ç½®</li>
</ul>
<h2 data-id="heading-28">æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-29">1. åˆç†ä½¿ç”¨ Islands</h3>
<p><strong>âœ… å¥½çš„åšæ³•ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// åªå°†éœ€è¦äº¤äº’çš„éƒ¨åˆ†åšæˆ Island</span>
&lt;article&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ShareButtons</span> /&gt;</span></span> {<span class="hljs-comment">/* Island */</span>}
  &lt;<span class="hljs-title class_">CommentSection</span> /&gt; {<span class="hljs-comment">/* Island */</span>}
&lt;/article&gt;
</code></pre>
<p><strong>âŒ é¿å…ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ä¸è¦æŠŠæ•´ä¸ªé¡µé¢éƒ½åšæˆ Island</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>()
  <span class="hljs-comment">// æ•´ä¸ªé¡µé¢éƒ½ä¼šåœ¨å®¢æˆ·ç«¯æ°´åˆ</span>
}
</code></pre>
<h3 data-id="heading-30">2. ä¼˜åŒ–æ•°æ®è·å–</h3>
<p><strong>âœ… å¥½çš„åšæ³•ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// åœ¨æœåŠ¡ç«¯å¹¶è¡Œè·å–æ•°æ®</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createRoute</span>(<span class="hljs-keyword">async</span> (c) =&gt; {
  <span class="hljs-keyword">const</span> [user, posts, comments] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    <span class="hljs-title function_">getUser</span>(),
    <span class="hljs-title function_">getPosts</span>(),
    <span class="hljs-title function_">getComments</span>(),
  ])

  <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Page</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> <span class="hljs-attr">posts</span>=<span class="hljs-string">{posts}</span> <span class="hljs-attr">comments</span>=<span class="hljs-string">{comments}</span> /&gt;</span></span>)
})
</code></pre>
<p><strong>âŒ é¿å…ï¼š</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// é¿å…ä¸²è¡Œè¯·æ±‚</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUser</span>()
<span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPosts</span>() <span class="hljs-comment">// ç­‰å¾…ä¸Šä¸€ä¸ªå®Œæˆ</span>
<span class="hljs-keyword">const</span> comments = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getComments</span>() <span class="hljs-comment">// åˆè¦ç­‰å¾…</span>
</code></pre>
<h3 data-id="heading-31">3. ä½¿ç”¨æµå¼æ¸²æŸ“</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// å¯¹äºæ…¢é€Ÿæ•°æ®ä½¿ç”¨ Suspense</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span> {/* å¿«é€Ÿæ¸²æŸ“ */}

      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Skeleton</span> /&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">SlowData</span> /&gt;</span> {/* å¼‚æ­¥åŠ è½½ */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}
</code></pre>
<h3 data-id="heading-32">4. å®ç°æœ‰æ•ˆç¼“å­˜</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆ†å±‚ç¼“å­˜ç­–ç•¥</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hono</span>()

<span class="hljs-comment">// 1. è¾¹ç¼˜ç¼“å­˜</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api/*'</span>, <span class="hljs-title function_">cache</span>({
  <span class="hljs-attr">cacheName</span>: <span class="hljs-string">'api-cache'</span>,
  <span class="hljs-attr">cacheControl</span>: <span class="hljs-string">'max-age=60'</span>,
}))

<span class="hljs-comment">// 2. æµè§ˆå™¨ç¼“å­˜</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/static/*'</span>, <span class="hljs-keyword">async</span> (c, next) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>()
  c.<span class="hljs-title function_">header</span>(<span class="hljs-string">'Cache-Control'</span>, <span class="hljs-string">'public, max-age=31536000, immutable'</span>)
})

<span class="hljs-comment">// 3. æ¡ä»¶è¯·æ±‚</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/data/*'</span>, <span class="hljs-title function_">etag</span>())
</code></pre>
<h2 data-id="heading-33">æœªæ¥å±•æœ›</h2>
<p>HonoX è¿˜åœ¨å¿«é€Ÿå‘å±•ä¸­ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä»¤äººæœŸå¾…çš„æ–¹å‘ï¼š</p>
<ol>
<li><strong>æ›´å¤šçš„è¿è¡Œæ—¶æ”¯æŒ</strong> - åŒ…æ‹¬ AWS Lambdaã€Azure Functions ç­‰</li>
<li><strong>å¢å¼ºçš„å¼€å‘å·¥å…·</strong> - æ›´å¥½çš„è°ƒè¯•ä½“éªŒã€æ€§èƒ½åˆ†æå·¥å…·</li>
<li><strong>æ›´ä¸°å¯Œçš„ç”Ÿæ€</strong> - å®˜æ–¹æ’ä»¶ã€ç¬¬ä¸‰æ–¹é›†æˆ</li>
<li><strong>æ¡†æ¶æ— å…³çš„ Islands</strong> - æ”¯æŒ Reactã€Vueã€Svelte ç­‰</li>
<li><strong>å¢é‡é™æ€ç”Ÿæˆ</strong> - ç±»ä¼¼ Next.js çš„ ISR</li>
</ol>
<h2 data-id="heading-34">ç»“è®º</h2>
<p>HonoX ä»£è¡¨äº†ç°ä»£å…¨æ ˆæ¡†æ¶çš„ä¸€ä¸ªé‡è¦æ–¹å‘ï¼š</p>
<ul>
<li><strong>æ€§èƒ½ä¼˜å…ˆ</strong> - Islands æ¶æ„å’Œè¾¹ç¼˜è®¡ç®—</li>
<li><strong>å¼€å‘ä½“éªŒ</strong> - ç®€å•ç›´è§‚çš„ API</li>
<li><strong>çµæ´»æ€§</strong> - æ”¯æŒå¤šç§è¿è¡Œæ—¶å’Œéƒ¨ç½²æ–¹å¼</li>
<li><strong>ç±»å‹å®‰å…¨</strong> - å®Œæ•´çš„ TypeScript æ”¯æŒ</li>
</ul>
<p>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªè½»é‡ã€å¿«é€Ÿã€ç°ä»£çš„å…¨æ ˆæ¡†æ¶ï¼Œç‰¹åˆ«æ˜¯éœ€è¦éƒ¨ç½²åˆ°è¾¹ç¼˜è¿è¡Œæ—¶ï¼ŒHonoX æ˜¯ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„é€‰æ‹©ã€‚</p>
<p>è™½ç„¶å®ƒè¿˜æ¯”è¾ƒå¹´è½»ï¼Œç”Ÿæ€ç³»ç»Ÿä¸å¦‚ Next.js é‚£æ ·æˆç†Ÿï¼Œä½†å®ƒçš„è®¾è®¡ç†å¿µå’ŒæŠ€æœ¯æ–¹å‘éƒ½éå¸¸æ­£ç¡®ã€‚éšç€ Hono ç”Ÿæ€çš„å‘å±•ï¼ŒHonoX ä¹Ÿå°†å˜å¾—è¶Šæ¥è¶Šå¼ºå¤§ã€‚</p>
<h2 data-id="heading-35">èµ„æºé“¾æ¥</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhonojs%2Fhonox" target="_blank" title="https://github.com/honojs/honox" ref="nofollow noopener noreferrer">HonoX GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhono.dev%2F" target="_blank" title="https://hono.dev/" ref="nofollow noopener noreferrer">Hono å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.patterns.dev%2Fposts%2Fislands-architecture" target="_blank" title="https://www.patterns.dev/posts/islands-architecture" ref="nofollow noopener noreferrer">Islands æ¶æ„ä»‹ç»</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.cloudflare.com%2Fworkers%2F" target="_blank" title="https://developers.cloudflare.com/workers/" ref="nofollow noopener noreferrer">Cloudflare Workers æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyourusername%2Fhonox-demo" target="_blank" title="https://github.com/yourusername/honox-demo" ref="nofollow noopener noreferrer">æœ¬é¡¹ç›®ç¤ºä¾‹ä»£ç </a></li>
</ul>
<hr/>
<p>æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ å¯¹ HonoX çš„çœ‹æ³•å’Œä½¿ç”¨ç»éªŒï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hono è·¯ç”±å™¨ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598801700050337830</link>    <guid>https://juejin.cn/post/7598801700050337830</guid>    <pubDate>2026-01-25T03:39:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598801700050337830" data-draft-id="7598818096753229875" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hono è·¯ç”±å™¨ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ"/> <meta itemprop="keywords" content="Bun,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-25T03:39:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jump_jump"/> <meta itemprop="url" content="https://juejin.cn/user/4230576474692765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hono è·¯ç”±å™¨ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576474692765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jump_jump
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T03:39:19.000Z" title="Sun Jan 25 2026 03:39:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä»åº•å±‚å¼•æ“ä¼˜åŒ–è§’åº¦ï¼Œæ·±å…¥å‰–æ Hono è·¯ç”±å™¨çš„æè‡´æ€§èƒ½å¥¥ç§˜</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ä¼—å¤š JavaScript Web æ¡†æ¶ä¸­ï¼ŒHono ä»¥å…¶æè‡´çš„æ€§èƒ½è¡¨ç°è„±é¢–è€Œå‡ºã€‚ç‰¹åˆ«æ˜¯åœ¨ <strong>Cloudflare Workersã€Deno ç­‰è¾¹ç¼˜è®¡ç®—ç¯å¢ƒ</strong>ä¸­ï¼ŒHono çš„è·¯ç”±åŒ¹é…é€Ÿåº¦åœ¨åŒç±»æ¡†æ¶ä¸­ååˆ—å‰èŒ…ã€‚è¿™èƒŒåçš„ç§˜å¯†æ˜¯ä»€ä¹ˆï¼Ÿç­”æ¡ˆå°±è—åœ¨å®ƒçš„ <strong>RegExpRouter</strong> å®ç°ä¸­ã€‚</p>
<blockquote>
<p><strong>âš ï¸ é‡è¦æç¤º</strong>ï¼šæœ¬æ–‡é‡ç‚¹è®¨è®º RegExpRouter çš„æ ¸å¿ƒåŸç†ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒHono ä½¿ç”¨ SmartRouter è‡ªåŠ¨ç»„åˆå¤šç§è·¯ç”±å™¨ï¼ˆRegExpRouterã€TrieRouterã€LinearRouterï¼‰ä»¥è¾¾åˆ°æœ€ä½³æ€§èƒ½ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªç²¾ç®€çš„å®ç°ï¼Œæ·±å…¥å‰–æ Hono è·¯ç”±å™¨çš„æ ¸å¿ƒåŸç†ï¼Œå¸®åŠ©ä½ ç†è§£ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆ RegExp è·¯ç”±æ¯”ä¼ ç»Ÿè·¯ç”±å¿«</li>
<li>è·¯ç”±æ˜¯å¦‚ä½•é¢„ç¼–è¯‘çš„</li>
<li>å‚æ•°æå–çš„å·§å¦™è®¾è®¡</li>
</ul>
<hr/>
<p><strong>ğŸ“Œ å…³é”®è¦ç‚¹</strong></p>





























<table><thead><tr><th>é¡¹ç›®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ ¸å¿ƒåŸç†</td><td>å°†è·¯ç”±é¢„ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ©ç”¨å¼•æ“åº•å±‚ä¼˜åŒ–</td></tr><tr><td>æ€§èƒ½ä¼˜åŠ¿</td><td>å‡å°‘ JS å±‚å¼€é”€ï¼Œä¸€æ¬¡åŸç”Ÿè°ƒç”¨å®ŒæˆåŒ¹é…</td></tr><tr><td>æœ€ä½³ç¯å¢ƒ</td><td>Cloudflare Workersã€Deno ç­‰è¾¹ç¼˜è®¡ç®—å¹³å°</td></tr><tr><td>å®é™…æ¶æ„</td><td>SmartRouter + RegExpRouter + TrieRouter ç»„åˆ</td></tr><tr><td>æƒè¡¡è€ƒè™‘</td><td>Node.js ç¯å¢ƒæ€§èƒ½æ‰“æŠ˜æ‰£ï¼Œè·¯ç”±æ³¨å†Œè¾ƒæ…¢</td></tr></tbody></table>
<h2 data-id="heading-1">ä¼ ç»Ÿè·¯ç”±çš„æ€§èƒ½ç“¶é¢ˆ</h2>
<p>åœ¨ç†è§£ Hono çš„ä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä¼ ç»Ÿè·¯ç”±çš„å¤„ç†æ–¹å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼ ç»Ÿè·¯ç”±çš„å…¸å‹å®ç°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">matchRoute</span>(<span class="hljs-params">path, routes</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> route <span class="hljs-keyword">of</span> routes) {
    <span class="hljs-comment">// 1. å­—ç¬¦ä¸²åˆ†å‰²</span>
    <span class="hljs-keyword">const</span> pathParts = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>);
    <span class="hljs-keyword">const</span> routeParts = route.<span class="hljs-property">path</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>);

    <span class="hljs-comment">// 2. é€æ®µæ¯”è¾ƒ</span>
    <span class="hljs-keyword">if</span> (pathParts.<span class="hljs-property">length</span> !== routeParts.<span class="hljs-property">length</span>) <span class="hljs-keyword">continue</span>;

    <span class="hljs-keyword">const</span> params = {};
    <span class="hljs-keyword">let</span> matched = <span class="hljs-literal">true</span>;

    <span class="hljs-comment">// 3. JS å±‚é¢çš„å¾ªç¯å’Œæ¡ä»¶åˆ¤æ–­</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; pathParts.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-keyword">if</span> (routeParts[i].<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">':'</span>)) {
        params[routeParts[i].<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>)] = pathParts[i];
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pathParts[i] !== routeParts[i]) {
        matched = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">break</span>;
      }
    }

    <span class="hljs-keyword">if</span> (matched) <span class="hljs-keyword">return</span> { route, params };
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>æ€§èƒ½é—®é¢˜åœ¨å“ªé‡Œï¼Ÿ</strong></p>
<ul>
<li>âŒ å¤§é‡çš„å­—ç¬¦ä¸²æ“ä½œï¼ˆ<code>split</code>ã€<code>slice</code>ï¼‰</li>
<li>âŒ å¤šå±‚å¾ªç¯å’Œæ¡ä»¶åˆ¤æ–­ï¼Œå…¨åœ¨ JavaScript å±‚é¢æ‰§è¡Œ</li>
<li>âŒ æ¯ä¸ªè¯·æ±‚éƒ½è¦é‡å¤è¿™äº›æ“ä½œ</li>
</ul>
<h2 data-id="heading-2">Hono çš„è§£å†³æ–¹æ¡ˆï¼šä¸‹æ²‰åˆ°å¼•æ“å±‚</h2>
<p>Hono çš„æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•å´æå…¶å·§å¦™ï¼š</p>
<blockquote>
<p><strong>å°†è·¯ç”±åŒ¹é…é€»è¾‘ä» JavaScript å±‚ä¸‹æ²‰åˆ° JavaScript å¼•æ“åº•å±‚ï¼ˆC++ å®ç°çš„æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼‰</strong></p>
</blockquote>
<h3 data-id="heading-3">1. é¢„ç¼–è¯‘é˜¶æ®µï¼ˆåº”ç”¨å¯åŠ¨æ—¶ï¼‰</h3>
<p>åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼ŒHono ä¼šå°†è·¯ç”±è·¯å¾„è½¬æ¢ä¸ºæ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è·¯ç”±è·¯å¾„ï¼š/user/:id/posts/:postId</span>
<span class="hljs-comment">// è½¬æ¢ä¸ºæ­£åˆ™ï¼š/^\/user\/([^/]+)\/posts\/([^/]+)$/</span>

<span class="hljs-keyword">const</span> <span class="hljs-attr">paramNames</span>: <span class="hljs-built_in">string</span>[] = [];

<span class="hljs-keyword">const</span> regexPath = path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/:([a-zA-Z0-9_]+)/g</span>, <span class="hljs-function">(<span class="hljs-params">_, paramName</span>) =&gt;</span> {
  paramNames.<span class="hljs-title function_">push</span>(paramName); <span class="hljs-comment">// è®°å½•å‚æ•°å</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">'([^/]+)'</span>;           <span class="hljs-comment">// æ›¿æ¢ä¸ºæ•è·ç»„</span>
});

<span class="hljs-keyword">const</span> pattern = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`^<span class="hljs-subst">${regexPath}</span>$`</span>);
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><code>:id</code> â†’ <code>([^/]+)</code>ï¼šåŒ¹é…é™¤ <code>/</code> å¤–çš„ä»»æ„å­—ç¬¦</li>
<li>å‚æ•°åè¢«ä¿å­˜åœ¨ <code>paramNames</code> æ•°ç»„ä¸­</li>
<li>è¿™ä¸ª"æ˜‚è´µ"çš„ç¼–è¯‘è¿‡ç¨‹åªåœ¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡</li>
</ul>
<h3 data-id="heading-4">2. åŒ¹é…é˜¶æ®µï¼ˆè¯·æ±‚åˆ°æ¥æ—¶ï¼‰</h3>
<p>å½“è¯·æ±‚åˆ°æ¥æ—¶ï¼Œåªéœ€è¦ä¸€è¡Œä»£ç ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> match = pattern.<span class="hljs-title function_">exec</span>(path);
</code></pre>
<p><strong>è¿™è¡Œä»£ç çš„é­”æ³•ï¼š</strong></p>
<ul>
<li>âœ… <code>exec</code> æ˜¯ JavaScript å¼•æ“çš„åŸç”Ÿæ–¹æ³•ï¼Œç”± C++ å®ç°</li>
<li>âœ… æ­£åˆ™å¼•æ“åœ¨åº•å±‚è¿›è¡Œäº†é«˜åº¦ä¼˜åŒ–ï¼ˆçŠ¶æ€æœºã€JIT ç¼–è¯‘ç­‰ï¼‰</li>
<li>âœ… æ— éœ€æ‰‹åŠ¨åˆ†å‰²å­—ç¬¦ä¸²ã€æ— éœ€ JS å±‚å¾ªç¯</li>
<li>âœ… å‚æ•°æå–é€šè¿‡æ•è·ç»„è‡ªåŠ¨å®Œæˆ</li>
</ul>
<h3 data-id="heading-5">3. å‚æ•°æå–</h3>
<p>åŒ¹é…æˆåŠŸåï¼Œå‚æ•°æå–ä¹Ÿéå¸¸ç®€æ´ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {};
route.<span class="hljs-property">paramNames</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">name, index</span>) =&gt;</span> {
  params[name] = match[index + <span class="hljs-number">1</span>]; <span class="hljs-comment">// match[0] æ˜¯å®Œæ•´åŒ¹é…</span>
});
</code></pre>
<h2 data-id="heading-6">å®Œæ•´å®ç°è§£æ</h2>
<p>è®©æˆ‘ä»¬çœ‹å®Œæ•´çš„ç®€åŒ–å®ç°ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦çš„ç±»å‹å®šä¹‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ============ ç±»å‹å®šä¹‰ ============</span>

<span class="hljs-comment">/**
 * è·¯ç”±å¤„ç†å‡½æ•°ç±»å‹
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">params</span> - ä» URL ä¸­æå–çš„å‚æ•°å¯¹è±¡
 */</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Handler</span> = <span class="hljs-function">(<span class="hljs-params">params: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">void</span>;

<span class="hljs-comment">/**
 * è·¯ç”±ä¿¡æ¯æ¥å£
 */</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Route</span> {
  <span class="hljs-attr">method</span>: <span class="hljs-built_in">string</span>;        <span class="hljs-comment">// HTTP æ–¹æ³•ï¼ˆGET, POST, etc.ï¼‰</span>
  <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>;          <span class="hljs-comment">// åŸå§‹è·¯å¾„æ¨¡å¼ï¼ˆå¦‚ /user/:idï¼‰</span>
  <span class="hljs-attr">handler</span>: <span class="hljs-title class_">Handler</span>;      <span class="hljs-comment">// è·¯ç”±å¤„ç†å‡½æ•°</span>
  <span class="hljs-attr">paramNames</span>: <span class="hljs-built_in">string</span>[];  <span class="hljs-comment">// å‚æ•°åæ•°ç»„ï¼ˆå¦‚ ['id', 'postId']ï¼‰</span>
}

<span class="hljs-comment">/**
 * åŒ¹é…ç»“æœæ¥å£
 */</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MatchResult</span> {
  <span class="hljs-attr">handler</span>: <span class="hljs-title class_">Handler</span>;
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;;
}

<span class="hljs-comment">// ============ æ ¸å¿ƒè·¯ç”±å™¨å®ç° ============</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoRegExpRouter</span> {
  <span class="hljs-comment">// å­˜å‚¨é¢„ç¼–è¯‘çš„æ­£åˆ™è¡¨è¾¾å¼å’Œè·¯ç”±ä¿¡æ¯</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">routes</span>: { <span class="hljs-attr">pattern</span>: <span class="hljs-title class_">RegExp</span>; <span class="hljs-attr">route</span>: <span class="hljs-title class_">Route</span> }[] = [];

  <span class="hljs-comment">// æ³¨å†Œè·¯ç”±ï¼šé¢„ç¼–è¯‘</span>
  <span class="hljs-title function_">add</span>(<span class="hljs-params">method: <span class="hljs-built_in">string</span>, path: <span class="hljs-built_in">string</span>, handler: Handler</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">paramNames</span>: <span class="hljs-built_in">string</span>[] = [];

    <span class="hljs-comment">// å°† :param è½¬ä¸ºæ­£åˆ™æ•è·ç»„</span>
    <span class="hljs-keyword">const</span> regexPath = path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/:([a-zA-Z0-9_]+)/g</span>, <span class="hljs-function">(<span class="hljs-params">_, paramName</span>) =&gt;</span> {
      paramNames.<span class="hljs-title function_">push</span>(paramName);
      <span class="hljs-keyword">return</span> <span class="hljs-string">'([^/]+)'</span>;
    });

    <span class="hljs-keyword">const</span> pattern = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`^<span class="hljs-subst">${regexPath}</span>$`</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>.<span class="hljs-title function_">push</span>({ pattern, <span class="hljs-attr">route</span>: { method, path, handler, paramNames } });
  }

  <span class="hljs-comment">// åŒ¹é…è·¯ç”±ï¼šæ‰§è¡Œæ­£åˆ™</span>
  <span class="hljs-title function_">match</span>(<span class="hljs-params">method: <span class="hljs-built_in">string</span>, path: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> { pattern, route } <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>) {
      <span class="hljs-keyword">if</span> (route.<span class="hljs-property">method</span> !== method &amp;&amp; route.<span class="hljs-property">method</span> !== <span class="hljs-string">'ALL'</span>) <span class="hljs-keyword">continue</span>;

      <span class="hljs-keyword">const</span> match = pattern.<span class="hljs-title function_">exec</span>(path); <span class="hljs-comment">// æ ¸å¿ƒï¼šåŸç”Ÿæ­£åˆ™åŒ¹é…</span>

      <span class="hljs-keyword">if</span> (match) {
        <span class="hljs-keyword">const</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {};
        route.<span class="hljs-property">paramNames</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">name, index</span>) =&gt;</span> {
          params[name] = match[index + <span class="hljs-number">1</span>];
        });
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">handler</span>: route.<span class="hljs-property">handler</span>, params };
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<h2 data-id="heading-7">å®æˆ˜ç¤ºä¾‹</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoRegExpRouter</span>();

<span class="hljs-comment">// æ³¨å†Œè·¯ç”±</span>
router.<span class="hljs-title function_">add</span>(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'/user/:id'</span>, <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·å–ç”¨æˆ·è¯¦æƒ…ï¼ŒID: <span class="hljs-subst">${params.id}</span>`</span>);
});

router.<span class="hljs-title function_">add</span>(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'/user/:id/posts/:postId'</span>, <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·å–ç”¨æˆ· <span class="hljs-subst">${params.id}</span> çš„æ–‡ç«  <span class="hljs-subst">${params.postId}</span>`</span>);
});

<span class="hljs-comment">// åŒ¹é…è¯·æ±‚</span>
<span class="hljs-keyword">const</span> result = router.<span class="hljs-title function_">match</span>(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'/user/123/posts/456'</span>);
<span class="hljs-keyword">if</span> (result) {
  result.<span class="hljs-title function_">handler</span>(result.<span class="hljs-property">params</span>);
  <span class="hljs-comment">// è¾“å‡º: è·å–ç”¨æˆ· 123 çš„æ–‡ç«  456</span>
}
</code></pre>
<h2 data-id="heading-8">æ€§èƒ½ä¼˜åŠ¿åˆ†æ</h2>
<p><strong>ä¸ºä»€ä¹ˆ RegExpRouter æ›´å¿«ï¼Ÿ</strong></p>
<ol>
<li><strong>å‡å°‘ JS æ‰§è¡Œå¼€é”€</strong>ï¼šä»å¤šå±‚å¾ªç¯é™åˆ°ä¸€æ¬¡åŸç”Ÿè°ƒç”¨</li>
<li><strong>å¼•æ“ä¼˜åŒ–</strong>ï¼šæ­£åˆ™å¼•æ“ç»è¿‡æ•°åå¹´ä¼˜åŒ–ï¼ŒåŒ…å« JITã€çŠ¶æ€æœºç­‰æŠ€æœ¯</li>
<li><strong>å‡å°‘å†…å­˜åˆ†é…</strong>ï¼šæ— éœ€é¢‘ç¹åˆ›å»ºæ•°ç»„ã€å¯¹è±¡</li>
<li><strong>ä¸€æ¬¡æ€§ç¼–è¯‘</strong>ï¼šé¢„ç¼–è¯‘é˜¶æ®µå®Œæˆæ‰€æœ‰å‡†å¤‡å·¥ä½œï¼Œè¯·æ±‚æ—¶é›¶é¢å¤–å¼€é”€</li>
</ol>
<p><strong>æ€§èƒ½å¯¹æ¯”æ¦‚è§ˆ</strong></p>























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å®ç°å±‚æ¬¡</th><th>æ‰§è¡Œæ•ˆç‡</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>ä¼ ç»Ÿè·¯ç”±</td><td>JavaScript å±‚</td><td>ä¸­ç­‰</td><td>é€šç”¨åœºæ™¯</td></tr><tr><td>RegExpRouter</td><td>å¼•æ“åº•å±‚</td><td>æå¿«</td><td>è¾¹ç¼˜è®¡ç®—ã€é«˜å¹¶å‘</td></tr></tbody></table>
<blockquote>
<p><strong>ğŸ“Š å®é™… Benchmark</strong>ï¼šæ ¹æ® <a href="https://link.juejin.cn?target=https%3A%2F%2Fhono.dev%2Fdocs%2Fconcepts%2Fbenchmarks" target="_blank" title="https://hono.dev/docs/concepts/benchmarks" ref="nofollow noopener noreferrer">Hono å®˜æ–¹æµ‹è¯•</a>ï¼Œåœ¨ Cloudflare Workers å’Œ Deno ç¯å¢ƒä¸­ï¼ŒHono æ˜¯åŒç±»æ¡†æ¶ä¸­æœ€å¿«çš„ã€‚ä½†åœ¨ Node.js ç¯å¢ƒä¸­ï¼Œç”±äºé€‚é…å™¨å¼€é”€ï¼Œæ€§èƒ½ä¼˜åŠ¿ä¼šæ‰“æŠ˜æ‰£ã€‚</p>
</blockquote>
<h2 data-id="heading-9">Hono çœŸå®å®ç°çš„è¿›ä¸€æ­¥ä¼˜åŒ–</h2>
<p>æœ¬æ–‡çš„ç®€åŒ–ç‰ˆæ¯ä¸ªè·¯ç”±éƒ½æ˜¯ç‹¬ç«‹çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚è€Œ Hono çš„çœŸå®å®ç°é‡‡ç”¨äº†<strong>å¤šè·¯ç”±å™¨ååŒ</strong>çš„ç­–ç•¥ï¼š</p>
<h3 data-id="heading-10">1. SmartRouterï¼ˆæ™ºèƒ½è·¯ç”±å™¨ï¼‰</h3>
<p>Hono é»˜è®¤ä½¿ç”¨ <strong>SmartRouter</strong>ï¼Œå®ƒä¼šï¼š</p>
<ul>
<li>æ ¹æ®è·¯ç”±ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€å¿«çš„è·¯ç”±å™¨</li>
<li>åŠ¨æ€ç»„åˆ RegExpRouterã€TrieRouterã€LinearRouter</li>
<li>æ£€æµ‹è·¯ç”±æ¨¡å¼å¹¶æŒç»­ä½¿ç”¨æœ€ä¼˜æ–¹æ¡ˆ</li>
</ul>
<h3 data-id="heading-11">2. è·¯ç”±å™¨åˆ†å·¥</h3>

























<table><thead><tr><th>è·¯ç”±å™¨</th><th>é€‚ç”¨åœºæ™¯</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>RegExpRouter</strong></td><td>åŠ¨æ€å‚æ•°è·¯ç”±</td><td>æœ€å¿«ï¼Œä½†ä¸æ”¯æŒæ‰€æœ‰æ¨¡å¼</td></tr><tr><td><strong>TrieRouter</strong></td><td>å¤æ‚è·¯ç”±æ¨¡å¼</td><td>æ”¯æŒæ‰€æœ‰æ¨¡å¼ï¼Œæ€§èƒ½ä¼˜ç§€</td></tr><tr><td><strong>LinearRouter</strong></td><td>å°‘é‡è·¯ç”±</td><td>ç®€å•å¯é ï¼Œè·¯ç”±å°‘æ—¶å¤Ÿç”¨</td></tr></tbody></table>
<h3 data-id="heading-12">3. å®é™…ä¼˜åŒ–ç­–ç•¥</h3>
<ul>
<li><strong>é™æ€è·¯ç”±ä¼˜å…ˆ</strong>ï¼š<code>/about</code>ã€<code>/contact</code> ç­‰ä½¿ç”¨ Map å¿«é€ŸæŸ¥æ‰¾</li>
<li><strong>è·¯ç”±é¢„åˆ†ç»„</strong>ï¼šæŒ‰ HTTP æ–¹æ³•åˆ†ç»„ï¼Œå‡å°‘åŒ¹é…æ¬¡æ•°</li>
<li><strong>å»¶è¿Ÿç¼–è¯‘</strong>ï¼šRegExpRouter ç¼–è¯‘è¾ƒæ…¢ï¼Œé€‚åˆåº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–ï¼Œä¸é€‚åˆæ— æœåŠ¡å™¨ç¯å¢ƒçš„å†·å¯åŠ¨</li>
</ul>
<p>è¿™äº›ä¼˜åŒ–ä½¿å¾— Hono åœ¨å¤„ç†æ•°ç™¾ä¸ªè·¯ç”±æ—¶ä»ç„¶ä¿æŒæé«˜æ€§èƒ½ã€‚</p>
<h2 data-id="heading-13">å±€é™æ€§ä¸æƒè¡¡</h2>
<p>RegExpRouter å¹¶éé“¶å¼¹ï¼Œåœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ä»¥ä¸‹é™åˆ¶ï¼š</p>
<h3 data-id="heading-14">RegExpRouter çš„å±€é™</h3>
<ul>
<li><strong>ä¸æ”¯æŒæ‰€æœ‰è·¯ç”±æ¨¡å¼</strong>ï¼šæŸäº›å¤æ‚çš„è·¯ç”±è§„åˆ™æ— æ³•ç”¨ç®€å•æ­£åˆ™è¡¨ç¤º</li>
<li><strong>æ³¨å†Œé˜¶æ®µè¾ƒæ…¢</strong>ï¼šè·¯ç”±ç¼–è¯‘éœ€è¦æ—¶é—´ï¼Œä¸é€‚åˆæ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°åˆå§‹åŒ–çš„ç¯å¢ƒï¼ˆå¦‚æŸäº›æ— æœåŠ¡å™¨å†·å¯åŠ¨åœºæ™¯ï¼‰</li>
<li><strong>è°ƒè¯•éš¾åº¦</strong>ï¼šç¼–è¯‘åçš„æ­£åˆ™è¡¨è¾¾å¼å¯è¯»æ€§è¾ƒå·®ï¼Œå‡ºé”™æ—¶éš¾ä»¥å®šä½</li>
<li><strong>æ¨¡å¼çº¦æŸ</strong>ï¼šå¦‚å¸¦ä¸¥æ ¼çº¦æŸçš„å‚æ•° <code>/:id(\\d+)</code> éœ€è¦é¢å¤–å¤„ç†</li>
</ul>
<h3 data-id="heading-15">è¿è¡Œç¯å¢ƒå·®å¼‚</h3>






























<table><thead><tr><th>ç¯å¢ƒ</th><th>æ€§èƒ½è¡¨ç°</th><th>åŸå› </th></tr></thead><tbody><tr><td>Cloudflare Workers</td><td>â­â­â­â­â­ æå¿«</td><td>åŸç”Ÿ Web æ ‡å‡† API</td></tr><tr><td>Deno</td><td>â­â­â­â­â­ æå¿«</td><td>åŸç”Ÿ Web æ ‡å‡† API</td></tr><tr><td>Bun</td><td>â­â­â­â­ å¾ˆå¿«</td><td>é«˜æ€§èƒ½ JS è¿è¡Œæ—¶</td></tr><tr><td>Node.js</td><td>â­â­â­ ä¸­ç­‰</td><td>éœ€è¦é€‚é…å™¨è½¬æ¢</td></tr></tbody></table>
<blockquote>
<p><strong>ğŸ’¡ é€‰å‹å»ºè®®</strong>ï¼šå¦‚æœä½ çš„åº”ç”¨è¿è¡Œåœ¨è¾¹ç¼˜è®¡ç®—ç¯å¢ƒï¼ˆCloudflare Workersã€Vercel Edge Functions ç­‰ï¼‰ï¼ŒHono æ˜¯ç»ä½³é€‰æ‹©ã€‚å¦‚æœæ˜¯ä¼ ç»Ÿ Node.js æœåŠ¡å™¨ï¼ŒFastify å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
</blockquote>
<p>ä½†å¯¹äºå¤§å¤šæ•° Web åº”ç”¨åœºæ™¯ï¼ŒRegExpRouter çš„æ€§èƒ½ä¸åŠŸèƒ½å¹³è¡¡å·²ç»è¶³å¤Ÿä¼˜ç§€ã€‚</p>
<h2 data-id="heading-16">æ€»ç»“</h2>
<p>Hono çš„ RegExpRouter é€šè¿‡"é¢„ç¼–è¯‘ + å¼•æ“ä¸‹æ²‰"çš„ç­–ç•¥ï¼Œåœ¨ç‰¹å®šç¯å¢ƒä¸­å°†è·¯ç”±åŒ¹é…æ€§èƒ½æå‡åˆ°æè‡´ï¼š</p>
<h3 data-id="heading-17">æ ¸å¿ƒä¼˜åŠ¿</h3>
<ol>
<li><strong>é¢„ç¼–è¯‘</strong>ï¼šå¯åŠ¨æ—¶ä¸€æ¬¡æ€§å°†è·¯ç”±è½¬ä¸ºæ­£åˆ™ï¼Œæ‘Šé”€æˆæœ¬</li>
<li><strong>å¼•æ“ä¸‹æ²‰</strong>ï¼šåˆ©ç”¨ C++ å®ç°çš„æ­£åˆ™å¼•æ“ï¼Œé¿å… JS å±‚å¼€é”€</li>
<li><strong>å‚æ•°æ•è·</strong>ï¼šå·§å¦™åˆ©ç”¨æ­£åˆ™æ•è·ç»„ï¼Œæ— éœ€æ‰‹åŠ¨è§£æ</li>
<li><strong>æ™ºèƒ½ç»„åˆ</strong>ï¼šSmartRouter è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜è·¯ç”±å™¨ï¼Œå…¼é¡¾æ€§èƒ½ä¸åŠŸèƒ½</li>
</ol>
<h3 data-id="heading-18">è®¾è®¡å“²å­¦</h3>
<p>è¿™ç§è®¾è®¡å“²å­¦å€¼å¾—æˆ‘ä»¬æ€è€ƒï¼š<strong>æ€§èƒ½ä¼˜åŒ–çš„ç»ˆæç›®æ ‡ï¼Œå¾€å¾€æ˜¯è®©"çƒ­è·¯å¾„"ä»£ç å°½å¯èƒ½å¤šåœ°è¿è¡Œåœ¨æ›´åº•å±‚çš„ä¼˜åŒ–ç¯å¢ƒä¸­</strong>ã€‚</p>
<p>å¯¹äº Web æ¡†æ¶æ¥è¯´ï¼Œè·¯ç”±åŒ¹é…å°±æ˜¯æœ€çƒ­çš„è·¯å¾„ä¹‹ä¸€ã€‚Hono åœ¨è¾¹ç¼˜è®¡ç®—ç¯å¢ƒä¸­æ‰¾åˆ°äº†è¿™ä¸ªé—®é¢˜çš„æœ€ä¼˜è§£ï¼ŒåŒæ—¶é€šè¿‡å¤šè·¯ç”±å™¨æ¶æ„ä¿è¯äº†å¹¿æ³›çš„é€‚ç”¨æ€§ã€‚</p>
<h3 data-id="heading-19">æœ€ä½³å®è·µ</h3>
<ul>
<li>âœ… <strong>è¾¹ç¼˜è®¡ç®—/Serverless</strong>ï¼šHono æ˜¯é¦–é€‰ï¼ˆCloudflare Workersã€Deno Deployï¼‰</li>
<li>âœ… <strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼šå……åˆ†å‘æŒ¥ RegExpRouter æ€§èƒ½ä¼˜åŠ¿</li>
<li>âš ï¸ <strong>Node.js ç¯å¢ƒ</strong>ï¼šè€ƒè™‘æ€§èƒ½æƒè¡¡ï¼Œæˆ–é€‰æ‹© Fastify ç­‰ä¸“é—¨ä¼˜åŒ–çš„æ¡†æ¶</li>
<li>âš ï¸ <strong>å¤æ‚è·¯ç”±è§„åˆ™</strong>ï¼šäº†è§£ RegExpRouter çš„é™åˆ¶ï¼Œå¿…è¦æ—¶ä½¿ç”¨ TrieRouter</li>
</ul>
<hr/>
<p><strong>å»¶ä¼¸é˜…è¯»ï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhono.dev%2F" target="_blank" title="https://hono.dev/" ref="nofollow noopener noreferrer">Hono å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhono.dev%2Fdocs%2Fconcepts%2Frouters" target="_blank" title="https://hono.dev/docs/concepts/routers" ref="nofollow noopener noreferrer">Hono Routers è¯¦è§£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhono.dev%2Fdocs%2Fconcepts%2Fbenchmarks" target="_blank" title="https://hono.dev/docs/concepts/benchmarks" ref="nofollow noopener noreferrer">Hono Benchmarks</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fv8.dev%2Fblog" target="_blank" title="https://v8.dev/blog" ref="nofollow noopener noreferrer">V8 æ­£åˆ™å¼•æ“ä¼˜åŒ–æŠ€æœ¯</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweb-frameworks-benchmark.netlify.app%2F" target="_blank" title="https://web-frameworks-benchmark.netlify.app/" ref="nofollow noopener noreferrer">Web æ¡†æ¶æ€§èƒ½å¯¹æ¯”å·¥å…·</a></li>
</ul>
<p><strong>æŠ€æœ¯èµ„æºï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhonojs%2Fhono" target="_blank" title="https://github.com/honojs/hono" ref="nofollow noopener noreferrer">Hono GitHub ä»“åº“</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fusualoma" target="_blank" title="https://github.com/usualoma" ref="nofollow noopener noreferrer">RegExpRouter åˆ›å»ºè€…ï¼šTaku Amano</a></li>
</ul>
<hr/>
<p><strong>ğŸ“ æ–‡ç« è¯´æ˜</strong></p>
<p>æœ¬æ–‡åŸºäºå¯¹ Hono æ¡†æ¶çš„å­¦ä¹ å’Œç ”ç©¶ç¼–å†™ï¼Œä»£ç ç¤ºä¾‹ä¸ºç®€åŒ–ç‰ˆå®ç°ï¼Œç”¨äºæ•™å­¦ç›®çš„ã€‚å®é™…çš„ Hono RegExpRouter å®ç°æ›´åŠ å¤æ‚å’Œä¼˜åŒ–ã€‚</p>
<p>æ€§èƒ½æ•°æ®å’Œå¯¹æ¯”æ¥è‡ª Hono å®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºæµ‹è¯•ï¼Œå…·ä½“æ•°å€¼ä¼šå› æµ‹è¯•ç¯å¢ƒã€è´Ÿè½½ç±»å‹ã€è¿è¡Œæ—¶ç‰ˆæœ¬ç­‰å› ç´ è€Œå¼‚ã€‚å®é™…ä½¿ç”¨æ—¶è¯·æ ¹æ®è‡ªå·±çš„åœºæ™¯è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>å¦‚æœæ‚¨å‘ç°æ–‡ä¸­æœ‰ä»»ä½•ä¸å‡†ç¡®ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAEå‘¨å¹´åº†å›é¦ˆï¼Œå›½é™…ç‰ˆç”¨æˆ·å¯ä»¥å…è´¹é¢†å–ä¸€ä¸ªæœˆä½¿ç”¨é¢åº¦]]></title>    <link>https://juejin.cn/post/7598818096753262643</link>    <guid>https://juejin.cn/post/7598818096753262643</guid>    <pubDate>2026-01-25T03:41:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598818096753262643" data-draft-id="7598827641306775603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAEå‘¨å¹´åº†å›é¦ˆï¼Œå›½é™…ç‰ˆç”¨æˆ·å¯ä»¥å…è´¹é¢†å–ä¸€ä¸ªæœˆä½¿ç”¨é¢åº¦"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-25T03:41:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æºªå½¼å²¸"/> <meta itemprop="url" content="https://juejin.cn/user/976781670357400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAEå‘¨å¹´åº†å›é¦ˆï¼Œå›½é™…ç‰ˆç”¨æˆ·å¯ä»¥å…è´¹é¢†å–ä¸€ä¸ªæœˆä½¿ç”¨é¢åº¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976781670357400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æºªå½¼å²¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T03:41:36.000Z" title="Sun Jan 25 2026 03:41:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å°ä¼™ä¼´ä»¬å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æºªï¼Œè§å­—å¦‚é¢ã€‚æœ€è¿‘æ”¶åˆ°Traeå›½é™…ç‰ˆçš„æ¨é€ï¼ŒTraeä¸€å‘¨å¹´å‘¨å¹´åº†å‘æ‰€æœ‰å›½é™…ç‰ˆç”¨æˆ·å…è´¹èµ é€ä¸€ä¸ªæœˆçš„ä½¿ç”¨é¢åº¦ï¼Œè¿™æ¬¡å›é¦ˆæ´»åŠ¨ä½¿ç”¨æœŸæœ‰é™ï¼Œæœ‰éœ€è¦çš„å°ä¼™ä¼´é€Ÿæ¥ã€‚</p>
<h2 data-id="heading-1">é¢†å–æ–¹å¼</h2>
<p>è¿›å…¥Traeå›½é™…ç‰ˆå®˜ç½‘ï¼Œå®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.trae.ai%25EF%25BC%258C%25E7%2599%25BB%25E5%25BD%2595%25E6%258E%2588%25E6%259D%2583%25E5%2590%258E%25EF%25BC%258C%25E7%2582%25B9%25E5%2587%25BB%25E3%2580%2590Claim" target="_blank" title="https://www.trae.ai%EF%BC%8C%E7%99%BB%E5%BD%95%E6%8E%88%E6%9D%83%E5%90%8E%EF%BC%8C%E7%82%B9%E5%87%BB%E3%80%90Claim" ref="nofollow noopener noreferrer">www.trae.aiï¼Œç™»å½•æˆæƒåï¼Œç‚¹å‡»ã€Claim</a> Anniversary Giftã€‘è¿›å…¥é¢†å–é¡µé¢</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fc594673dda44deadadde409c871ce2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769917295&amp;x-signature=aVd0PvsBu%2Fu2%2Bcz5azWNb0UR9JE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é¢†å–é¡µé¢è¯¦æƒ…å¦‚ä¸‹ï¼Œç‚¹å‡»åº•éƒ¨çš„ã€Claimã€‘é¢†å–ï¼Œæ¯ä¸ªç”¨æˆ·é™é¢†ä¸€æ¬¡ï¼Œæˆ‘å·²ç»é¢†å–è¿‡äº†ï¼Œè¿™é‡Œæ˜¾ç¤ºã€Claimedã€‘æ— æ³•å†æ¬¡é¢†å–</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74b7cb7782914d1eb6cbfe1da8c51932~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769917295&amp;x-signature=cQsgIZAt9%2FPGAxPRudAaWmFovn4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ­¤æ¬¡Traeçš„å‘¨å¹´å›é¦ˆæä¾› 2ç§ èµ é€æ–¹å¼ï¼š</p>
<ul>
<li>å…è´¹ç”¨æˆ·ï¼š600æ¬¡ é¢å¤–å¿«é€Ÿè¯·æ±‚ï¼Œæœ‰æ•ˆæœŸè‡³ 2026å¹´2æœˆ14æ—¥ ä¸–ç•Œæ ‡å‡†æ—¶é—´ 02:00</li>
<li>ä¸“ä¸šç”¨æˆ·ï¼ˆæ‰€æœ‰å¥—é¤ï¼‰ï¼š800æ¬¡ é¢å¤–å¿«é€Ÿè¯·æ±‚ï¼Œæœ‰æ•ˆæœŸè‡³ 2026å¹´3æœˆ14æ—¥ ä¸–ç•Œæ ‡å‡†æ—¶é—´ 02:00</li>
</ul>
<p>é¢†å–åï¼Œå¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒæŸ¥çœ‹å·²é¢†å–çš„é¢åº¦ï¼Œå®˜ç½‘åœ°å€ï¼š<a href="https://www.trae.ai/account-setting#usage" target="_blank" title="https://www.trae.ai/account-setting#usage" ref="nofollow noopener noreferrer">www.trae.ai/account-setâ€¦</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4799897b47a84549b14e87be59750098~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769917295&amp;x-signature=AZ7rW49%2FiVN2NiXFwaYsz%2F6tGfQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ³¨æ„æ­¤æ¬¡é¢†å–çš„å…è´¹é¢åº¦æœ‰ä½¿ç”¨æ—¶é—´é™åˆ¶ï¼Œä¸è¦é”™è¿‡äº†ä½¿ç”¨æœŸé™ã€‚</p>
<h2 data-id="heading-2">å‹æƒ…æç¤º</h2>
<p>è§åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FBOb8BmNX5Sy_w-RfucA-Pg" target="_blank" title="https://mp.weixin.qq.com/s/BOb8BmNX5Sy_w-RfucA-Pg" ref="nofollow noopener noreferrer">TRAEå‘¨å¹´åº†å›é¦ˆï¼Œå›½é™…ç‰ˆç”¨æˆ·å¯ä»¥å…è´¹é¢†å–ä¸€ä¸ªæœˆä½¿ç”¨é¢åº¦</a></p>
<blockquote>
<p>æœ¬æ–‡åŒæ­¥è‡ªå¾®ä¿¡å…¬ä¼—å· "<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FBOb8BmNX5Sy_w-RfucA-Pg" target="_blank" title="https://mp.weixin.qq.com/s/BOb8BmNX5Sy_w-RfucA-Pg" ref="nofollow noopener noreferrer">ç¨‹åºå‘˜å°æºª</a>" ï¼Œè¿™é‡Œåªæ˜¯åŒæ­¥ï¼Œæƒ³çœ‹åŠæ—¶æ¶ˆæ¯è¯·ç§»æ­¥æˆ‘çš„å…¬ä¼—å·ï¼Œä¸å®šæ—¶æ›´æ–°æˆ‘çš„å­¦ä¹ ç»éªŒã€‚å‹æƒ…æç¤ºå‹æƒ…æç¤º</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨Proxifierè§£å†³çƒ¦äººçš„Tun]]></title>    <link>https://juejin.cn/post/7598947628450119707</link>    <guid>https://juejin.cn/post/7598947628450119707</guid>    <pubDate>2026-01-25T03:31:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598947628450119707" data-draft-id="7598801700049911846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨Proxifierè§£å†³çƒ¦äººçš„Tun"/> <meta itemprop="keywords" content="macOS"/> <meta itemprop="datePublished" content="2026-01-25T03:31:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æºªå½¼å²¸"/> <meta itemprop="url" content="https://juejin.cn/user/976781670357400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨Proxifierè§£å†³çƒ¦äººçš„Tun
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976781670357400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æºªå½¼å²¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T03:31:51.000Z" title="Sun Jan 25 2026 03:31:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å°ä¼™ä¼´ä»¬å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æºªï¼Œè§å­—å¦‚é¢ã€‚ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è¿™æ ·çš„çƒ¦æ¼ï¼Œä½¿ç”¨Googleçš„ Antigravity éœ€è¦å¼€å¯tunæ¨¡å¼ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸ç™»å½•å’Œæ‹‰å–æ¨¡å‹ï¼Œå¼€å¯äº†tunæ¨¡å¼ååˆä¼šå¯¼è‡´å†…ç½‘ç¯å¢ƒæ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œä¸€å¤©ä¸‹æ¥è¦ä¸åœçš„åœ¨IDEå’Œå†…ç½‘ç¯å¢ƒä¸­å¼€å…³tunï¼ŒçœŸæ˜¯ç›¸å½“çƒ¦äººã€‚æœ€è¿‘äº†è§£åˆ°Proxifierå¯ä»¥è§£å†³è¿™ä¸€ç—›ç‚¹ï¼Œè®°å½•ä¸€ä¸‹é…ç½®ä½¿ç”¨æµç¨‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/364f7d1e0872421593e77b5c99de4677~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=kBAPw3i9NYi6%2FWwhv5H80DvH%2FEM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-1">å½“å‰ä½¿ç”¨ç‰ˆæœ¬</h2>
<p>Proxifier for Mac V3.15</p>
<h2 data-id="heading-2">å®‰è£…é…ç½®</h2>
<p>Proxifierè¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥ç›´æ¥åˆ°å®˜ç½‘äº†è§£ã€‚</p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.proxifier.com" target="_blank" title="https://www.proxifier.com" ref="nofollow noopener noreferrer">www.proxifier.com</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbacd91b3ce0458db12e727f7d04a64f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=mP9HdHxPe8cSr%2BTQa2zH53G%2BBj4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æˆ‘è¿™é‡Œåªæœ‰macOSï¼Œå°±ä»¥macOSä¸ºä¾‹æ¼”ç¤ºäº†ã€‚åœ¨Proxifierå®˜ç½‘é€‰æ‹©è‡ªå·±ç³»ç»Ÿå¯¹åº”çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½å®‰è£…ï¼Œå®‰è£…å®Œæˆåæ‰“å¼€ç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c706fa46e524a86b7a4b9c2dd45a920~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=bT1EuZ0phkxO3fFQ%2BUQNLDyw0eA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯ä»¥é€‰æ‹©ã€Continue Evaluationã€‘å…è´¹ä½¿ç”¨ä¸€ä¸ªæœˆï¼Œä¹Ÿå¯ä»¥ç‚¹å‡»ã€Enter Registration Keyã€‘è¾“å…¥æ³¨å†Œç è¿›è¡Œæ³¨å†Œï¼Œæ³¨å†ŒæˆåŠŸåçœ‹åˆ°å¦‚ä¸‹æç¤ºå°±è¡¨ç¤ºæˆåŠŸäº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dd157d49a484203978aa7fb2e0f101c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=JCYlQcnXLH5fx2LcPzhsxEkXpbM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é¦–æ¬¡ä½¿ç”¨ä¼šæç¤ºç½‘ç»œæƒé™æˆæƒï¼Œæ ¹æ®æç¤ºè¿›è¡Œæˆæƒ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad804726ad744f9e97609e888a93ebc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=l56uiaNjrhP%2F%2B4zYV54RwfxVvfE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æˆæƒå®Œæˆåé¦–é¡µç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c2ee45502274496b615c4a9815c97ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=tuCalO2b7c1JnBSC%2FoBMEghjC%2Bc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-3">åŸºæœ¬ä½¿ç”¨</h2>
<h3 data-id="heading-4">è®¾ç½®ä»£ç†æœåŠ¡å™¨</h3>
<p>ç‚¹å‡»èœå•æ çš„ã€Profileã€‘ã€Proxy Serversã€‘æˆ–è€…ã€Proxiesã€‘æ·»åŠ ä»£ç†æœåŠ¡å™¨</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74342fbcca71475987d6f1996dfed9b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=ZSspQGEkQz0ps4eInr7yoaBGj84%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç‚¹å‡»ã€Addã€‘æ·»åŠ ä¸€ä¸ªæ–°çš„ä»£ç†é…ç½®ï¼Œå¡«å†™ ä»£ç†åœ°å€ã€ç«¯å£å·ï¼Œç‚¹å‡»ã€Advanced Optionã€‘å‹¾é€‰ã€Use target hostname in proxy request if availableã€‘é€‰é¡¹è¿›è¡Œä¿å­˜</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cee9dab058124dbf900a1420e4b14c1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=6AaNjM1nETqf3hzYWT1%2B89iNtkU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ³¨æ„âš ï¸ï¼šç‚¹å‡»ä¿å­˜æ—¶æç¤ºçš„è®¾ç½®ä¸ºé»˜è®¤è§„åˆ™å¼¹çª—ï¼Œé€‰æ‹©ã€å¦ã€‘ï¼Œä¸ç”¨è®¾ç½®ä¸ºé»˜è®¤ä»£ç†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9d3a0bb70f84c949bf2891246f6f971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=Aw82pr117Yh%2FMldi6vd0qC%2FSb3M%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-5">è®¾ç½®ä»£ç†è§„åˆ™</h3>
<p>ç‚¹å‡»èœå•æ çš„ã€Profileã€‘ã€Proxification Rulesã€‘æˆ–è€…ã€Rulesã€‘æ·»åŠ ä»£ç†è§„åˆ™</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c376504fdcf54ab4afa83d89409deee5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=ZMR%2Bn3Yrd%2FeFGHkup9u9QC5xJUQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç‚¹å‡»ã€Addã€‘æ·»åŠ ä¸€æ¡æ–°è§„åˆ™ï¼Œè¾“å…¥è§„åˆ™åç§°ï¼Œé€‰æ‹©åº”ç”¨è§„åˆ™çš„åº”ç”¨</p>
<blockquote>
<p>æ³¨æ„âš ï¸ï¼šè¿™ä¸€æ­¥å¾ˆé‡è¦</p>
</blockquote>
<p>æ‰“å¼€ã€æ´»åŠ¨ç›‘è§†å™¨ã€‘ï¼Œæœç´¢ã€languageã€‘æ‰¾åˆ° language_server_macos_x64ï¼Œè¿™æ˜¯Antigravityçš„è¯­è¨€æœåŠ¡ï¼ŒåŠ è½½æ¨¡å‹éƒ½æ˜¯é€šè¿‡è¿™ä¸ªæœåŠ¡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eacf86e4821142f38695c0fa59164b5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=wNgeqFQNBRGOLu38RVYgyRuPL88%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å°† language_server_macos_x64 æ·»åŠ åˆ°åº”ç”¨é…ç½®åï¼Œå…·ä½“é…ç½®å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<blockquote>
<p>"Antigravity.app"; "Antigravity"; com.google.antigravity; language_server_macos_x64</p>
</blockquote>
<p>æœ€åActionéƒ¨åˆ†é€‰æ‹©å‰é¢åˆ›å»ºçš„ä»£ç†æœåŠ¡å™¨ã€Proxy SOCKS5 127.0.0.1:7897ã€‘ï¼Œç‚¹å‡»ã€Saveã€‘ä¿å­˜</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b792aec4d0db43be92475e89333e72de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=80CRmBoRAnUYUVz3Ksq73qB17i4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æœ€åå‹¾é€‰ã€Antigravityã€‘å¯ç”¨è§„åˆ™</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c10aced0a2df44c79f6d9d5aa7c218ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=b3MfC%2FZQp7uFS2Ty4bx5d5XIq5w%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>åˆ°æ­¤æˆ‘ä»¬çš„é…ç½®å°±å®Œæˆäº†ï¼Œå¯ä»¥å…³é—­tunæŸ¥çœ‹æ•ˆæœï¼Œå¯ä»¥çœ‹åˆ°Antigravityç›¸å…³çš„è¯­è¨€æœåŠ¡å’Œè¯·æ±‚éƒ½æ ¹æ®è®¾ç½®çš„è§„åˆ™èµ°äº†ä»£ç†æœåŠ¡å™¨</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4276e65e3554ded914c53fdb86f9eaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=rujmgg11YnVlSModJTJebSoR7Os%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Antigravity IDEä¸­ä¹Ÿå¯ä»¥æ­£å¸¸è·å–åˆ°æ¨¡å‹å’Œä½¿ç”¨</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b26ec4f4bf944f28233a81c7c4c2825~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769916711&amp;x-signature=Q8Rv6AdBUJJSd4HFJmSUV0tExkc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-6">å‹æƒ…æç¤º</h2>
<p>è§åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPidy8LtrjgsKmleGghdq4g" target="_blank" title="https://mp.weixin.qq.com/s/Pidy8LtrjgsKmleGghdq4g" ref="nofollow noopener noreferrer">ä½¿ç”¨Proxifierè§£å†³çƒ¦äººçš„Tun</a></p>
<blockquote>
<p>æœ¬æ–‡åŒæ­¥è‡ªå¾®ä¿¡å…¬ä¼—å· "<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPidy8LtrjgsKmleGghdq4g" target="_blank" title="https://mp.weixin.qq.com/s/Pidy8LtrjgsKmleGghdq4g" ref="nofollow noopener noreferrer">ç¨‹åºå‘˜å°æºª</a>" ï¼Œè¿™é‡Œåªæ˜¯åŒæ­¥ï¼Œæƒ³çœ‹åŠæ—¶æ¶ˆæ¯è¯·ç§»æ­¥æˆ‘çš„å…¬ä¼—å·ï¼Œä¸å®šæ—¶æ›´æ–°æˆ‘çš„å­¦ä¹ ç»éªŒã€‚å‹æƒ…æç¤ºå‹æƒ…æç¤º</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•å¿«é€Ÿè·å–ç½‘é¡µæ–‡æœ¬å†…å®¹]]></title>    <link>https://juejin.cn/post/7598537739516084266</link>    <guid>https://juejin.cn/post/7598537739516084266</guid>    <pubDate>2026-01-25T03:54:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598537739516084266" data-draft-id="7598472744481619987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•å¿«é€Ÿè·å–ç½‘é¡µæ–‡æœ¬å†…å®¹"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-25T03:54:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="indieAI"/> <meta itemprop="url" content="https://juejin.cn/user/4488643649743614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•å¿«é€Ÿè·å–ç½‘é¡µæ–‡æœ¬å†…å®¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4488643649743614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    indieAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T03:54:00.000Z" title="Sun Jan 25 2026 03:54:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œä»ç½‘é¡µæå–æ–‡æœ¬æ˜¯å¾ˆå¤šäººè€—æ—¶æœ€é•¿çš„ä»»åŠ¡ä¹‹ä¸€ã€‚68%çš„ç ”ç©¶äººå‘˜è¡¨ç¤ºï¼Œä»–ä»¬æ¯å¤©è¦èŠ±1.2å°æ—¶åœ¨ç½‘é¡µå†…å®¹æå–å’Œæ•´ç†ä¸Šã€‚å…¶ä¸­72%çš„æ—¶é—´éƒ½æµªè´¹åœ¨å»é™¤å¹¿å‘Šã€å¼¹çª—å’Œå¯¼èˆªæ è¿™äº›æ— å…³å…ƒç´ ä¸Šã€‚</p>
<p>å½“ä½ æƒ³æŠŠç½‘é¡µå†…å®¹å¤åˆ¶ç»™ChatGPTæˆ–Claudeåˆ†ææ—¶ï¼Œå¤šä½™çš„HTMLä»£ç å’Œæ ¼å¼ä¼šä¸¥é‡å½±å“æ¨¡å‹çš„å¤„ç†æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚è¿™åœ¨AIæ—¶ä»£å·²ç»æˆäº†æ™®éå­˜åœ¨çš„ç—›ç‚¹ã€‚</p>
<h2 data-id="heading-0">ä¼ ç»Ÿæ–¹æ³•çš„å±€é™</h2>
<p>ç›®å‰å¸¸è§çš„ç½‘é¡µæ–‡æœ¬æå–æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§ï¼Œä½†éƒ½å­˜åœ¨æ˜æ˜¾ç¼ºé™·ï¼š</p>
<h3 data-id="heading-1">æ‰‹åŠ¨å¤åˆ¶ç²˜è´´</h3>
<p>è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œä½†é—®é¢˜æœ€å¤šã€‚å¤åˆ¶çš„å†…å®¹ç»å¸¸å¤¹æ‚å¹¿å‘Šå’Œå¯¼èˆªé“¾æ¥ï¼Œæ ¼å¼æ··ä¹±ä¸å ªã€‚æ•´ç†ä¸€ç¯‡é•¿æ–‡ç« å¹³å‡è¦èŠ±8-12åˆ†é’Ÿï¼Œè¡¨æ ¼å’Œä»£ç å—è¿˜å®¹æ˜“å˜å½¢ä¸¢å¤±ã€‚</p>
<h3 data-id="heading-2">æµè§ˆå™¨æ’ä»¶</h3>
<p>å¸‚é¢ä¸Šæœ‰è¶…è¿‡400æ¬¾ç½‘é¡µæå–æ’ä»¶ï¼Œä½†å¤šæ•°éƒ½ä¸å¥½ç”¨ã€‚æœ‰äº›æ’ä»¶è¦æ±‚è¯»å–æ‰€æœ‰ç½‘é¡µå†…å®¹çš„æƒé™ï¼Œè®©äººæ‹…å¿ƒéšç§å®‰å…¨ã€‚å…è´¹ç‰ˆæœ¬è¿˜ç»å¸¸å¼¹å‡ºå¹¿å‘Šï¼Œå½±å“ä½¿ç”¨ä½“éªŒã€‚</p>
<h3 data-id="heading-3">Pythonè„šæœ¬</h3>
<p>æŠ€æœ¯äººå‘˜å¸¸ç”¨Pythonå†™è„šæœ¬æå–æ–‡æœ¬ï¼Œä½†éœ€è¦æŒæ¡æ­£åˆ™è¡¨è¾¾å¼å’ŒHTMLè§£æçŸ¥è¯†ã€‚ç½‘é¡µç»“æ„ä¸€å˜ï¼Œä»£ç å°±å¾—è·Ÿç€æ”¹ï¼Œå¤„ç†ä¸€ä¸ªé¡µé¢å¹³å‡è¦2-3åˆ†é’Ÿã€‚</p>
<h2 data-id="heading-4">LLM Readifyçš„è§£å†³æ–¹æ¡ˆ</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Freader.prompt-minder.com%2F" target="_blank" title="https://reader.prompt-minder.com/" ref="nofollow noopener noreferrer">LLM Readify</a> æ˜¯ä¸€æ¬¾ä¸“é—¨ä¸ºè§£å†³ç½‘é¡µæ–‡æœ¬æå–ç—›ç‚¹è®¾è®¡çš„å·¥å…·ã€‚å®ƒé€šè¿‡AIé©±åŠ¨çš„å†…å®¹è¯†åˆ«æŠ€æœ¯ï¼Œè§£å†³äº†ä¼ ç»Ÿæ–¹æ³•çš„ä¸»è¦é—®é¢˜ã€‚</p>
<h3 data-id="heading-5">æ ¸å¿ƒåŠŸèƒ½</h3>
<ol>
<li>
<p><strong>å¿«é€Ÿè½¬æ¢</strong>
ç²˜è´´ç½‘é¡µé“¾æ¥åï¼Œå·¥å…·ä¼šè‡ªåŠ¨è¯†åˆ«ä¸»è¦å†…å®¹åŒºåŸŸï¼Œå»é™¤å¹¿å‘Šå’Œå¯¼èˆªæ ï¼Œä¿ç•™åŸå§‹æ®µè½ç»“æ„ã€‚æ•´ä¸ªè¿‡ç¨‹åªéœ€3ç§’ï¼Œç”Ÿæˆçš„çº¯æ–‡æœ¬å¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ã€‚</p>
</li>
<li>
<p><strong>æ™ºèƒ½è¯†åˆ«</strong>
é‡‡ç”¨Transformeræ¨¡å‹åˆ†æå†…å®¹ï¼Œèƒ½è‡ªåŠ¨åŒºåˆ†æ­£æ–‡å’Œæ³¨é‡Šï¼Œä¿ç•™è¡¨æ ¼ã€ä»£ç å—å’Œæ•°å­¦å…¬å¼çš„æ ¼å¼ï¼Œæ”¯æŒå¤šè¯­è¨€æ–‡æœ¬æå–ã€‚</p>
</li>
<li>
<p><strong>éšç§å®‰å…¨</strong>
æ‰€æœ‰å¤„ç†éƒ½åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆï¼Œæ— éœ€ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ä¸å­˜å‚¨ä»»ä½•ç”¨æˆ·æ•°æ®ï¼Œæ”¯æŒHTTPSåŠ å¯†è¿æ¥ï¼Œæ— éœ€æ³¨å†Œæˆ–å®‰è£…è½¯ä»¶ã€‚</p>
</li>
</ol>
<h2 data-id="heading-6">å®é™…åº”ç”¨åœºæ™¯</h2>
<ul>
<li><strong>å­¦æœ¯ç ”ç©¶</strong>ï¼šæ–¯å¦ç¦å¤§å­¦çš„ç ”ç©¶äººå‘˜ç”¨LLM Readifyæå–è®ºæ–‡å†…å®¹ï¼Œæ–‡çŒ®ç»¼è¿°æ•ˆç‡æå‡äº†62%ã€‚ä»–ä»¬åªéœ€ç²˜è´´è®ºæ–‡é“¾æ¥ï¼Œå°±èƒ½ç›´æ¥æŠŠçº¯æ–‡æœ¬å¯¼å…¥Claudeè¿›è¡Œæ€»ç»“ã€‚</li>
<li><strong>å¸‚åœºåˆ†æ</strong>ï¼šéº¦è‚¯é”¡å…¬å¸çš„åˆ†æå¸ˆç”¨å®ƒå¿«é€Ÿæå–è¡Œä¸šæŠ¥å‘Šï¼Œåˆ†ææ—¶é—´ä»45åˆ†é’Ÿç¼©çŸ­åˆ°8åˆ†é’Ÿã€‚æŠŠçº¯æ–‡æœ¬è¾“å…¥ChatGPTåï¼Œèƒ½è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–çš„å¸‚åœºæ´å¯ŸæŠ¥å‘Šã€‚</li>
<li><strong>å†…å®¹åˆ›ä½œ</strong>ï¼šMediumå¹³å°çš„ä½œè€…ç”¨å®ƒæ”¶é›†ç´ æï¼Œå†™ä½œæ—¶é—´å¹³å‡å‡å°‘äº†35%ã€‚å¤šä¸ªç½‘é¡µçš„å†…å®¹å¯ä»¥åˆå¹¶åç›´æ¥å¯¼å…¥AIå·¥å…·è¿›è¡Œæ¶¦è‰²ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜æ€§èƒ½è½»é‡çº§AIèŠå¤©åŠ©æ‰‹ChatWise]]></title>    <link>https://juejin.cn/post/7598818096753311795</link>    <guid>https://juejin.cn/post/7598818096753311795</guid>    <pubDate>2026-01-25T03:54:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598818096753311795" data-draft-id="7598801700049944614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜æ€§èƒ½è½»é‡çº§AIèŠå¤©åŠ©æ‰‹ChatWise"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-25T03:54:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æºªå½¼å²¸"/> <meta itemprop="url" content="https://juejin.cn/user/976781670357400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜æ€§èƒ½è½»é‡çº§AIèŠå¤©åŠ©æ‰‹ChatWise
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976781670357400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æºªå½¼å²¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T03:54:20.000Z" title="Sun Jan 25 2026 03:54:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä½¿ç”¨è¿‡Cherry Studioç­‰AIèŠå¤©å·¥å…·çš„å°ä¼™ä¼´åº”è¯¥å¯ä»¥æ„Ÿå—åˆ°ï¼ŒCherry Studioè™½ç„¶å…è´¹åŠŸèƒ½å¼ºå¤§ï¼Œä½†è¿‡å¤šçš„åŠŸèƒ½æœ‰æ—¶ç»™äººçš„æ„Ÿè§‰å°±è¡¨ç°ä¸ºç¬¨é‡äº†ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰æ—¶åªéœ€è¦ä¸€äº›ç®€å•çš„é—®ç­”å’Œå·¥å…·è°ƒç”¨å´è¦é™„å¸¦å¾ˆå¤šå…¶å®ƒä¸éœ€è¦çš„åŠŸèƒ½ï¼Œå¦‚æœä½ ä¹Ÿæœ‰è¿™æ ·çš„å›°æƒ‘ï¼Œé‚£ä¹ˆChatWiseå¯èƒ½æ›´é€‚åˆä½ ã€‚å¯¹Cherry Studioè¿˜ä¸äº†è§£çš„å°ä¼™ä¼´å¯ä»¥çœ‹å¾€æœŸå†…å®¹ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU5Njg3ODUzOA%3D%3D%26mid%3D2247488816%26idx%3D1%26sn%3D84a962c9a3bc1b6ecb17fc0f4aec41cb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247488816&amp;idx=1&amp;sn=84a962c9a3bc1b6ecb17fc0f4aec41cb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€Cherry Studioã€‘Cherry Studioè®©äººçˆ±ä¸é‡Šæ‰‹çš„AI Chat</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU5Njg3ODUzOA%3D%3D%26mid%3D2247488849%26idx%3D1%26sn%3D5399663288413e300c57ebfb64d4877a%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247488849&amp;idx=1&amp;sn=5399663288413e300c57ebfb64d4877a&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€Cherry Studioã€‘Cherry Studioè¿™æ ·è®¾ç½®å¯èƒ½æ›´ä¸æ»‘</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU5Njg3ODUzOA%3D%3D%26mid%3D2247488864%26idx%3D1%26sn%3D9a53c485561692c0c66c8a14dc99b74c%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247488864&amp;idx=1&amp;sn=9a53c485561692c0c66c8a14dc99b74c&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€Cherry Studioã€‘Cherry Studioæ­å»ºæœ¬åœ°çŸ¥è¯†åº“</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU5Njg3ODUzOA%3D%3D%26mid%3D2247488886%26idx%3D1%26sn%3D569e2d4c1558badef366601225734cac%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247488886&amp;idx=1&amp;sn=569e2d4c1558badef366601225734cac&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€Cherry Studioã€‘Cherry Studioæ­å»ºä¸€ä¸ªAIç»˜å›¾åŠ©æ‰‹</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU5Njg3ODUzOA%3D%3D%26mid%3D2247489688%26idx%3D1%26sn%3D45c0c2b4b6d77e9baff0c70040bba187%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247489688&amp;idx=1&amp;sn=45c0c2b4b6d77e9baff0c70040bba187&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ã€Cherry Studioã€‘Cherry Studioä¸Šä½¿ç”¨MCP</a></li>
</ul>
<h2 data-id="heading-1">å½“å‰ç‰ˆæœ¬</h2>
<p>Version 0.8.102 (0.8.102)</p>
<h2 data-id="heading-2">ä¼˜åŠ¿</h2>
<ul>
<li>ä¸ªäººå…è´¹ä½¿ç”¨åŸºæœ¬èŠå¤©åŠŸèƒ½</li>
<li>è½»é‡çº§Chatå®¢æˆ·ç«¯</li>
<li>æœ¬åœ°æ•°æ®å­˜å‚¨ï¼Œéšç§ä¼˜å…ˆ</li>
<li>æ”¯æŒmacOSã€Windowsç³»ç»Ÿ</li>
<li>æ–°ç”¨æˆ·ç™»å½•ï¼Œæœ‰7å¤©è¯•ç”¨æ—¶é—´</li>
</ul>
<h2 data-id="heading-3">é™åˆ¶</h2>
<ul>
<li>å…è´¹ç‰ˆä¸æ”¯æŒ è”ç½‘æœç´¢ã€å›¾åƒç”Ÿæˆã€Artifacts ç­‰åŠŸèƒ½</li>
</ul>
<h2 data-id="heading-4">ç®€ä»‹</h2>
<p>ChatWiseæ˜¯ä¸€æ¬¾ä¸“é—¨ä¸ºæ¡Œé¢ç«¯è®¾è®¡çš„å¤šåŠŸèƒ½ã€é«˜æ€§èƒ½ AI èŠå¤©å·¥å…·ã€‚å®ƒæ”¯æŒå¤šç§ä¸»æµå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼Œå…·å¤‡å¤šæ¨¡æ€äº¤äº’èƒ½åŠ›ï¼Œå¹¶å¼ºè°ƒéšç§ä¿æŠ¤ä¸æœ¬åœ°åŒ–ä½¿ç”¨ä½“éªŒã€‚</p>
<p>å®˜ç½‘åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fchatwise.app%2F" target="_blank" title="https://chatwise.app/" ref="nofollow noopener noreferrer">chatwise.app/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ba28d9fac27463989e30fedd9c94e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=BYM1qkYcl6Dm8NrShFjH7HCDKyY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-5">å®‰è£…é…ç½®</h2>
<p>åŒå‡»å®‰è£…åŒ…ï¼Œå°†ã€ChatWiseã€‘æ‹–æ‹½åˆ°ã€Applicationsã€‘è¿›è¡Œå®‰è£…</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5a3e4e353624b6e9be9787d164f5f7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=RAqHybwUC42Dz74%2B%2Fo%2Fdsi4oeSg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å®‰è£…å®Œæˆåï¼Œå¯åŠ¨ChatWiseç•Œé¢å¦‚ä¸‹ï¼Œç•Œé¢ç®€æ´ç›´è§‚æ²¡æœ‰ä»»ä½•å¼•å¯¼å’Œé…ç½®æ“ä½œï¼ŒçœŸæ˜¯å¹²å‡€çš„ä¸èƒ½å†å¹²å‡€äº†ï¼Œç®€ç›´æ˜¯æç®€ç”¨æˆ·çš„ç¦éŸ³ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16ae7938d4844434b12133512e90d548~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=5p1gHTOk9QxSyo58gFJAFoym%2FFE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-6">åŸºæœ¬ä½¿ç”¨</h2>
<h3 data-id="heading-7">åŸºæœ¬é…ç½®</h3>
<p>ç‚¹å‡»ã€è®¾ç½®ã€‘è¿›å…¥è®¾ç½®é¡µé¢</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c38fa66f171472d988ac7ad46753836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=df8GHo13G1I8t0xbtnEOXx2H3f0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æä¾›äº† é€šç”¨ã€æä¾›å•†ã€æç¤ºè¯ã€MCPã€æ’ä»¶ å’Œ é«˜çº§ è®¾ç½®</p>
<ul>
<li>é€šç”¨ï¼šæä¾›äº†å¤–è§‚ã€ä¸»é¢˜ã€ä»£ç†ç­‰ç›¸å…³é…ç½®</li>
<li>æä¾›å•†ï¼šæ¨¡å‹æä¾›å•†å’Œæ¨¡å‹é…ç½®</li>
<li>æç¤ºè¯ï¼šæç¤ºè¯æ¨¡æ¿é…ç½®</li>
<li>MCPï¼šMCPé…ç½®</li>
<li>æ’ä»¶ï¼š å†…ç½®AIæ’ä»¶å·¥å…·é…ç½®</li>
<li>é«˜çº§ï¼šè½¯ä»¶åŠæ•°æ®ç›¸å…³é…ç½®</li>
</ul>
<p>æä¾›å•†è®¾ç½®å†…ç½®äº†å¾ˆå¤šæ¨¡å‹æä¾›å•†çš„å¿«é€Ÿé…ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b69dac58222d4e1398b179a4748b0b0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=uZRLwpE8MYAIGgO6My2R0G2uyWY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é»˜è®¤åˆ—è¡¨æ²¡æœ‰å±•ç¤ºçš„ï¼Œå¯ä»¥ç‚¹å‡»ã€+ã€‘æŸ¥çœ‹æ›´å¤š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f122b4f3700a40f798460ee2cd0205d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=3yH7Hf4SEMQZBUTT1JVADzpj2pM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æç¤ºè¯è®¾ç½®æä¾›äº†æ›´çµæ´»çš„æç¤ºè¯æ¨¡æ¿é…ç½®ï¼Œå¯ä»¥ é¢„ç½®æç¤ºè¯ã€é€‰æ‹©æ¨¡å‹ å’Œ æŒ‡å®šå˜é‡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1574e51244c54621b08dd7870ec21c29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=GiqVYVRt24dokOanMJSR%2Fr3NO98%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>MCPè®¾ç½®æä¾›äº†MCPæœåŠ¡ç›¸å…³é…ç½®ï¼Œæ”¯æŒ stdioã€httpã€sse åŠ jsonå½¢å¼ é…ç½®å’Œå¯¼å…¥</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60b2f01cd8dc4464ad0742da37b77f15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=EEKVZmSwMagCJ5UNxljgO5cU%2B%2FQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ’ä»¶è®¾ç½®å†…ç½®äº† ChatWiseæœç´¢ã€å¯¹è¯æ ‡é¢˜ã€æ–‡æœ¬è½¬è¯­éŸ³ã€è¾…åŠ©è§†è§‰æ¨¡å‹ã€è¾…åŠ©æ¨ç†æ¨¡å‹ è®¾ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65a57d0062f848dfa1779c71e85f157d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=O4G%2FioWmMw9qP5y97trSdFHvwGs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é«˜çº§è®¾ç½®æä¾›äº† è½¯ä»¶ã€éšç§ã€æ•°æ® å’Œ Markdown ç›¸å…³ä¿¡æ¯å±•ç¤ºå’Œè®¾ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2ac82e69ae94fa09d2b287dc030aebd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=g96o9PD1%2BQ4xuupX7y%2FbObqiejg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-8">æ·»åŠ æä¾›å•†å’Œæ¨¡å‹</h3>
<p>è¿›å…¥è®¾ç½®é¡µé¢ï¼Œåˆ‡æ¢åˆ°ã€æä¾›å•†ã€‘ï¼Œé¦–å…ˆä»¥Groqæä¾›å•†ä¸ºä¾‹è¿›è¡Œé…ç½®ï¼Œé€‰æ‹©ã€Groqã€‘é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼ˆGroqå¯¹ç½‘ç»œæœ‰è¦æ±‚ï¼Œéœ€è¦è¾ƒçº¯å‡€çš„ç§‘å­¦ä¸Šç½‘ç¯å¢ƒï¼‰ï¼š</p>
<ul>
<li>API Keyï¼šGroqä¸Šç”³è¯·çš„API Key</li>
<li>API Base URLï¼šé»˜è®¤ä¸å¡«å³å¯</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba181028dbf24e03b4e8606c8a116a96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=38%2F5vlryel6zdMSqgBMF1SpxW5w%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯¹Groqè¿˜ä¸äº†è§£çš„å°ä¼™ä¼´å¯ä»¥çœ‹å¾€æœŸå†…å®¹ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU5Njg3ODUzOA%3D%3D%26mid%3D2247487736%26idx%3D1%26sn%3D08d9672f61132ba163b047ceeb16f152%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU5Njg3ODUzOA==&amp;mid=2247487736&amp;idx=1&amp;sn=08d9672f61132ba163b047ceeb16f152&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">åˆè¯†Groq AI</a>ï¼Œå¦‚æœæ²¡æœ‰ç§‘å­¦ä¸Šç½‘ç¯å¢ƒï¼Œå¯ä»¥ç‚¹å‡»API Base URLå³ä¾§æŒ‰é’®ç”Ÿæˆä»£ç†æœåŠ¡å™¨åœ°å€è½¬å‘</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deee595f92724cf0af236fcbe01b90fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=kDwNl3QAMU5cjJi4Vw4FdNaQLPQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2345511c3b7446389d291d7ac852837~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=lFT5p5uCRB5Vg%2BNgNwq%2FvG2HtBU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å›åˆ°ChatWiseé¦–é¡µï¼Œç‚¹å‡»é¡¶éƒ¨ã€æ¨¡å‹é€‰æ‹©ã€‘å³å¯æŸ¥çœ‹å½“å‰æä¾›å•†æä¾›çš„æ‰€æœ‰æ¨¡å‹ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ¨¡å‹å³å¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3683fffaf0d544b3838292d01e2bc964~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=OkfCczQMLP1z8qC75sOq%2F6x5xN8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿˜å¯ä»¥å¯¹è‡ªå·±å–œæ¬¢çš„æ¨¡å‹è¿›è¡Œæ”¶è—å±•ç¤º</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca2f7cc10ce64a2fabe77f1d1e8bfe58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=D7df5Wgn0tHra8nyHBrCcI7Hia4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>OpenRouterçš„é…ç½®ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œå¡«å†™API Keyè·å–æ¨¡å‹æ·»åŠ </p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acad5dc7cb6b41888e4fa66643fde304~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=2Vi1grnNHCt6DOTzHwNNQWLPCfQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-9">è‡ªå®šä¹‰æç¤ºè¯</h3>
<p>è¿›å…¥è®¾ç½®é¡µé¢ï¼Œåˆ‡æ¢åˆ°ã€æç¤ºè¯ã€‘è®¾ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f643cd07093742b4ba1215a16761a0bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=O%2BrGS%2BvtuSy%2Fa4GignINLiBLiZk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç‚¹å‡»å·¦ä¸‹è§’ã€+ã€‘æ–°å»ºæç¤ºè¯æ¨¡æ¿ï¼Œæ·»åŠ æ¨¡æ¿é…ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8907c51ec018475ebd513f713beeee11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=U0i44gGJqB981F6uznogKZGLvO4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¨¡æ¿æ·»åŠ å®Œæˆå›åˆ°ChatWiseé¦–é¡µï¼Œç‚¹å‡»ã€å‘½ä»¤ä¸­å¿ƒã€‘æ‰¾åˆ°æç¤ºè¯æŒ‡ä»¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/907be8101a154adbb173ee8323c111e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=uqHpgASjRaswnB3no2VgaFHLwQM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¾“å…¥é“¾æ¥æäº¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f811f22291040cfb985d85a8e3811e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=YRxc5BsNaKpQnmWxtpdufsEVoZA%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¨¡å‹ä¼šè¯»å–é“¾æ¥å†…å®¹å¹¶æ ¹æ®å†…å®¹è¿›è¡Œæ€»ç»“</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dabe2d3dcb964c0cb30dea937a66ebec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=BN6bkDu4ChZhwliWjw733gn0K6g%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-10">ChatåŸºæœ¬ä½¿ç”¨</h3>
<p>ChatWiseçš„Chatç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06fa14d1cb6f46529a983875dd1e17e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=jC05BCTQ89myk8SNI9z%2BHpKfJoU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ChatWiseæä¾›äº†ä¸Šä¸‹æ–‡ã€æŒ‡ä»¤ã€Artifactsç­‰åŠŸèƒ½çš„å¿«æ·å…¥å£ï¼š</p>
<ul>
<li>æ·»åŠ é™„ä»¶ï¼šæ·»åŠ æœ¬åœ°é™„ä»¶æ–‡ä»¶</li>
<li>å‘½ä»¤ä¸­å¿ƒï¼šåŒ…å«å†…ç½®æŒ‡ä»¤å’Œè‡ªå®šä¹‰æç¤ºè¯æŒ‡ä»¤</li>
<li>æœç´¢ï¼ˆé¢„è§ˆï¼‰ï¼šè”ç½‘æœç´¢åŠŸèƒ½</li>
<li>Artifactsï¼ˆé¢„è§ˆï¼‰ï¼šä»¥åŠ¨æ€å·¥ä½œç©ºé—´çš„å½¢å¼å±•ç¤ºå·¥ç¨‹æ–‡ä»¶</li>
<li>å›¾åƒç”Ÿæˆï¼šæ–‡ç”Ÿå›¾</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ä»‹ç»ChatWiseçš„åŸºæœ¬ä½¿ç”¨ï¼Œæœç´¢ã€å›¾åƒç”Ÿæˆã€MCP ç­‰ç¨å¾®å¤æ‚çš„åŠŸèƒ½åé¢å•ç‹¬ä»‹ç»ã€‚è¾“å…¥æç¤ºè¯å³å¯å¼€å§‹å¯¹è¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ff1361163a94c798e75c21e067ce8d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=2K5k%2BsvqADZ8240aP8wtPnC%2BY8o%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ChatWiseé’ˆå¯¹AIç”Ÿæˆçš„å†…å®¹æä¾›äº†å¯¹åº”çš„æ“ä½œåŠŸèƒ½ï¼ŒåŒ…æ‹¬ å¤åˆ¶ã€æœ—è¯»ã€é‡æ–°ç”Ÿæˆ ç­‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1efbfb2b2ad94d95aa40f2de4790278c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=rrMA2qjxwmljV7FM8Eo2i3mXbVE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ·»åŠ ä¸Šä¸‹æ–‡å¯ä»¥å¯¹ä¸Šä¸‹æ–‡å†…å®¹è¿›è¡Œæé—®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e10e4a22086a4d4584a3a34aac5f8fd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=JJ%2BEfb0WNiDP6%2BSmw0dgoTNwPzo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç‚¹å‡»ã€å‘½ä»¤ä¸­å¿ƒã€‘å¯ä»¥çœ‹åˆ°è‡ªå®šä¹‰æç¤ºè¯å’Œå†…ç½®å‘½ä»¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f717ec21909f473ea4c80eecfb3ec3a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=q0XLSBmEBv8WtZLlz2eZaYwYAlw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™é‡Œä»¥â€œç¿»è¯‘â€æç¤ºè¯æŒ‡ä»¤ä¸ºä¾‹ï¼Œé€‰æ‹©ã€ç¿»è¯‘ã€‘ï¼Œé€‰æ‹©ç¿»è¯‘çš„è¯­éŸ³å’Œå†…å®¹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26218360e480462c93204b00f89af638~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=X%2FxY6YO8fIJYGE7fDUmyNHHCQSM%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ‰§è¡Œå³å¯æŸ¥çœ‹åˆ°æç¤ºè¯æŒ‡ä»¤æ¨¡æ¿è½¬æ¢ååˆ°æç¤ºè¯åŠç¿»è¯‘ç»“æœ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0149e7e5700a4c8f8d2a0a07b6ee243a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=5U0SdiDmX2Jw7Srjir8LAC1jhqE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å‹¾é€‰ã€Artifactsã€‘è¾“å…¥æç¤ºè¯ï¼ŒArtifactsæ¨¡å¼ä¼šä»¥äº¤äº’å¼ç¼–ç¨‹æ–¹å¼å±•ç¤ºä»£ç ï¼ˆä»˜è´¹åŠŸèƒ½ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c3f39fe26d4495b8e1a89513144702e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=nlbuDWXxQxmputb04BNttUD%2Fc0E%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å›¾åƒç”ŸæˆåŠŸèƒ½ç›®å‰åªæ”¯æŒ OpenAI å’Œ xAI æä¾›å•†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ae64130375543fe92d1345e33441d91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=Im9AflQVzziUcrnAtRBKrv3XvTg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è”ç½‘æœç´¢ï¼ˆä»˜è´¹åŠŸèƒ½ï¼‰</p>
<blockquote>
<p>ä¼˜å…ˆä½¿ç”¨æ¨¡å‹æœç´¢</p>
</blockquote>
<p>å½“æ¨¡å‹ä¸æ”¯æŒæœç´¢åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ChatWiseå†…ç½®çš„æœç´¢ä»£æ›¿ï¼Œè¿›å…¥ChatWiseè®¾ç½®é¡µé¢ï¼Œåˆ‡æ¢åˆ°ã€æ’ä»¶ã€‘ï¼Œåœ¨è¿™é‡Œå¯ä»¥è®¾ç½®ChatWiseæœç´¢ç›¸å…³é…ç½®ï¼Œã€æœç´¢å¼•æ“ã€‘æ”¯æŒå¤šç§ç±»å‹ï¼š</p>
<ul>
<li>å…è´¹ï¼šBingã€Google</li>
<li>API Keyï¼šTavilyã€Googleã€Brave Searchã€Jina AIã€Exa</li>
<li>è‡ªå®šä¹‰æœç´¢ï¼šé€šè¿‡APIå®ç°çš„æœç´¢æ¥å£</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b231780196b94efeb7c7a44561d6ade6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=bk0uNWNhZCrDTBdVHWb6LXUWHpE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¦‚æœæœ‰è‡ªå·±å®ç°çš„æœç´¢æ¥å£ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ã€è‡ªå®šä¹‰æœç´¢ã€‘æ·»åŠ æœç´¢åœ°å€å®ç°</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5408131bdc014598ad132513f71dd466~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=fTgVZ%2BGJOyTXy%2BQQZKOHics6WBY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æµè§ˆå™¨ä¸ºæœ¬åœ°å®‰è£…çš„æµè§ˆå™¨ç±»å‹ï¼ŒChatWiseä¼šè°ƒç”¨æœ¬åœ°æµè§ˆå™¨è¿›è¡Œæ£€ç´¢</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fd0989dd64a4c58aec3183c5cddbbe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=goNpON2%2Bc5cEORshGUgd0%2BynVS8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¦‚æœå‹¾é€‰ã€è¿è¡Œæ—¶æ˜¾ç¤ºã€‘å¯ä»¥æŸ¥çœ‹ChatWiseçš„æ£€ç´¢è¿‡ç¨‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be2a89f723c046bea871dbc02fb56dac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=Hmd0UxRiLUPPelVpCQL6FAt38Es%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å›åˆ°ChatWiseé¦–é¡µï¼Œç‚¹å‡»ã€æœç´¢ã€‘å¯ç”¨æœç´¢åŠŸèƒ½ï¼Œå¯¹äºä¸æ”¯æŒæœç´¢çš„æ¨¡å‹ä¼šé»˜è®¤åˆ‡æ¢åˆ°ChatWiseæœç´¢</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0b77e0dfb924518bde087a2e66baf10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=6hsN91HET2j5UEzQRhI7%2BEjq23k%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ChatWiseä¼šè°ƒç”¨æœ¬åœ°æµè§ˆå™¨è¿›è¡Œæ£€ç´¢</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f06e3955ffa4bc499bd5b0cd118b8c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=49jT%2BS4of9LymQbpoHwTuh92C2I%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ£€ç´¢å®Œæˆå¯ä»¥çœ‹åˆ°æ£€ç´¢å¯¹åº”çš„ç½‘é¡µå¼•ç”¨ä¿¡æ¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac739a6927a040f29d8dc2264dff7423~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=LfUyArkzDErWtGqqdbbL%2BHYG1To%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-11">MCPæœåŠ¡</h3>
<p>è¿›å…¥è®¾ç½®é¡µé¢ï¼Œåˆ‡æ¢åˆ°ã€MCPã€‘è®¾ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea618c613ac546bab9479b7c13be09e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=wDSiEsJLP9iQxbKUjZKlQvS22vI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç‚¹å‡»å·¦ä¸‹è§’ã€+ã€‘ï¼Œå¯ä»¥çœ‹åˆ°MCPæ”¯æŒ å¯è§†åŒ– å’Œ JSON 2ç§å½¢å¼é…ç½®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/189b6123eb3d48c2adb7e2d90ea9e095~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=UgzrvYkPGTr83oT7YnlNlU64SKk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è¿™é‡Œå…ˆä»¥å¯è§†åŒ–å’Œ Context7 MCPä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºï¼Œç‚¹å‡»ã€å‘½ä»¤è¡Œï¼ˆstdioï¼‰ã€‘</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7608c35c4a74a1b8475bc3335c3f3d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=spZhZ%2F7ea8KGBEzPr2dYE5liu9Y%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯è§†åŒ–é…ç½®æ–¹å¼å’Œå…¶ä»–ä¸»æµå·¥å…·çš„é…ç½®æ–¹å¼ç±»ä¼¼ï¼Œé…ç½®å®Œæˆåï¼Œç‚¹å‡»ã€éªŒè¯ï¼ˆæŸ¥çœ‹å·¥å…·ï¼‰ã€‘éªŒè¯MCPçš„è¿æ¥</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae798770e6db49c0ae6ba08cd6d87a52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=ewRSIejNHZcnKmVz8ymuFinxdSc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ä¸éœ€è¦ä½¿ç”¨MCPæ—¶ä¹Ÿå¯ä»¥ç›´æ¥å…³é—­MCP</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1666725cb82d4058ad87e3e037d70ab3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=C4Z719zZsrbXI4tXlxSxaz%2B6qic%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å†çœ‹çœ‹ä»¥JSONå½¢å¼çš„é…ç½®ï¼Œå…ˆæ‹·è´MCP JSONé…ç½®å‘½ä»¤ï¼Œé…ç½®å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">{
Â Â <span class="hljs-string">"mcpServers"</span>: {
Â  Â Â <span class="hljs-string">"context7"</span>: {
Â  Â  Â Â <span class="hljs-string">"command"</span>:Â <span class="hljs-string">"npx"</span>,
Â  Â  Â Â <span class="hljs-string">"args"</span>: [
Â  Â  Â  Â Â <span class="hljs-string">"-y"</span>,
Â  Â  Â  Â Â <span class="hljs-string">"@upstash/context7-mcp"</span>
Â  Â  Â  ]
Â  Â  }
Â  }
}
</code></pre>
<p>ç„¶åç‚¹å‡»ã€ä»å‰ªåˆ‡æ¿å¯¼å…¥JSONã€‘ï¼ŒChatWiseå°±ä¼šé»˜è®¤å¡«å……å¥½MCPé…ç½®ï¼Œç‚¹å‡»ã€éªŒè¯ï¼ˆæŸ¥çœ‹å·¥å…·ï¼‰ã€‘éªŒè¯MCPçš„è¿æ¥å³å¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0d80ac42ea94aab8e417aa24aebb35c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=Q%2Fd9sl%2BcO0Cc96px8PhbdqHSe%2BI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>MCPé…ç½®å®Œæˆï¼Œå›åˆ°ChatWiseé¦–é¡µï¼Œå¯ä»¥çœ‹åˆ°èŠå¤©çª—å£å¤šäº†ä¸€ä¸ªå·¥å…·èœå•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/513134bb8ff7477299475ba90476c4e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=R17bTjYUSqpvCcWG0KK4VM1uLjU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>ç‚¹å‡»å·¥å…·ï¼Œå¼€å¯MCPæœåŠ¡å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9979fb5f0fe54de38e55e598168ef1d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=uAYAdOlo8kKpThDOPTD%2FQQ%2BzT%2Bw%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>é»˜è®¤MCPçš„è°ƒç”¨éœ€è¦æ‰‹åŠ¨å…è®¸æ‰§è¡Œå·¥å…·</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07d2f0ff73db4cbfba31698c3c50b190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=%2B1xwebghBSZvuF64RckK7FQa8eo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ‰§è¡Œå®Œæˆåå³å¯å¾—åˆ°MCPå·¥å…·è°ƒç”¨çš„æ€»ç»“ç»“æœ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/060ce6d6b39d421291d6d9123fce10a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=96KCA3hzMuPaT01L12zcaPaeUoI%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¦‚æœä½ ä¸å–œæ¬¢æ¯æ¬¡éƒ½æ‰‹åŠ¨æ‰§è¡Œï¼Œä½ å¯ä»¥åœ¨MCPè®¾ç½®é¡µé¢å‹¾é€‰ã€å‘½ä»¤ã€‘ä¸‹æ–¹çš„ã€è‡ªåŠ¨æ‰§è¡Œå·¥å…·ã€‘ï¼ŒAgentå°±ä¼šè‡ªåŠ¨æ‰§è¡ŒMCPå·¥å…·çš„è°ƒç”¨</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/faa3c62e416f489297ba93aafdbb3cb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=UyRjvUnf8moRPNxNpvip89Az89U%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-12">äº§å“å®šä»·</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/296207986b614e61ae6eefb535840285~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rqq5b285bK4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769918060&amp;x-signature=yIXRaHTKHzDA2xkMPWYV6DtOS34%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å…è´¹ç‰ˆï¼š</p>
<ul>
<li>åŸºæœ¬èŠå¤©åŠŸèƒ½</li>
<li>å…è´¹ä¾›ä¸ªäººã€éå•†ä¸šç”¨é€”</li>
</ul>
<p>ä»˜è´¹ç‰ˆï¼š</p>
<ul>
<li>ä¸€æ¬¡ä»˜è´¹ï¼Œæ°¸ä¹…ä½¿ç”¨</li>
<li>èŠå¤©è®°å½•æœç´¢</li>
<li>è‡ªå®šä¹‰åŠ©æ‰‹</li>
<li>ç½‘ç»œæœç´¢</li>
<li>æ— é™å·¥å…· ï¼ˆMCPï¼‰</li>
</ul>
<h2 data-id="heading-13">å‹æƒ…æç¤º</h2>
<p>è§åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FlZWQjneS4Acq5M_wiCvE3A" target="_blank" title="https://mp.weixin.qq.com/s/lZWQjneS4Acq5M_wiCvE3A" ref="nofollow noopener noreferrer">é«˜æ€§èƒ½è½»é‡çº§AIèŠå¤©åŠ©æ‰‹ChatWise</a></p>
<blockquote>
<p>æœ¬æ–‡åŒæ­¥è‡ªå¾®ä¿¡å…¬ä¼—å· "<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FlZWQjneS4Acq5M_wiCvE3A" target="_blank" title="https://mp.weixin.qq.com/s/lZWQjneS4Acq5M_wiCvE3A" ref="nofollow noopener noreferrer">ç¨‹åºå‘˜å°æºª</a>" ï¼Œè¿™é‡Œåªæ˜¯åŒæ­¥ï¼Œæƒ³çœ‹åŠæ—¶æ¶ˆæ¯è¯·ç§»æ­¥æˆ‘çš„å…¬ä¼—å·ï¼Œä¸å®šæ—¶æ›´æ–°æˆ‘çš„å­¦ä¹ ç»éªŒã€‚å‹æƒ…æç¤ºå‹æƒ…æç¤º</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Golangè£…é¥°å™¨æ¨¡å¼ä½¿ç”¨è¯¯åŒº]]></title>    <link>https://juejin.cn/post/7598699872540868627</link>    <guid>https://juejin.cn/post/7598699872540868627</guid>    <pubDate>2026-01-24T11:24:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872540868627" data-draft-id="7598587406706688041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Golangè£…é¥°å™¨æ¨¡å¼ä½¿ç”¨è¯¯åŒº"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T11:24:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¿½å…‰è€…1995"/> <meta itemprop="url" content="https://juejin.cn/user/1444138868028331"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Golangè£…é¥°å™¨æ¨¡å¼ä½¿ç”¨è¯¯åŒº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1444138868028331/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¿½å…‰è€…1995
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T11:24:34.000Z" title="Sat Jan 24 2026 11:24:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">èƒŒæ™¯</h3>
<p>æœ€è¿‘åˆ©ç”¨ç¦»èŒç©ºçª—æœŸå¼€å‘äº†ä¸€ä¸ªä¸ªäººçš„golangå¾®æœåŠ¡é¡¹ç›®å‡†å¤‡è½¬Goå¼€å‘ï¼Œç”¨çš„æ¡†æ¶æ˜¯go micro 4.11.0ï¼Œæ¶æ„æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œé€šè¿‡å‘å¸ƒ/è®¢é˜…äº‹ä»¶æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚å¾®æœåŠ¡è‡ªç„¶å°‘ä¸äº†é‡è¯•ï¼Œæ°å¥½ä¹‹å‰å®‰è£…Opentelemetryé¡ºä¾¿å®‰è£…äº†æŒ‡æ•°é€€é¿é‡è¯•çš„ç»„ä»¶github.com/cenkalti/backoff/v4 ï¼Œä¸ºé‡è¯•æ‰“ä¸‹åŸºç¡€ã€‚</p>
<p>go microè®¢é˜…äº‹ä»¶åŒ…è£…å™¨ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰é€šè¿‡micro.WrapSubcriberå®ç°ï¼Œä¹‹å‰å·²ç»æœ‰3ä¸ªåŒ…è£…å™¨åˆ†åˆ«æ˜¯é“¾è·¯è¿½è¸ªã€prometheusã€æ—¥å¿—ã€‚èµ·åˆçš„æ–¹æ¡ˆæ˜¯ç”¨åŒ…è£…å™¨å®ç°ï¼ŒåŒ…è£…å™¨ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(next server.SubscriberFunc)</span></span> server.SubscriberFunc {
		<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, msg server.Message)</span></span> <span class="hljs-type">error</span> {
			err := next(ctx, msg)	
                  <span class="hljs-comment">// é‡è¯•</span>
                  <span class="hljs-keyword">return</span> err <span class="hljs-comment">//è¿”å›æœ€ç»ˆé”™è¯¯</span>
		}
	}
</code></pre>
<p>æ¥ç€åœ¨åº”ç”¨å±‚ç›´æ¥è¿”å›codes.Abortedè®©å®ƒé‡è¯•ï¼Œè®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°ä¸º3ï¼Œç»“æœæ—¥å¿—è¾“å‡º3æ¬¡ï¼Œé“¾è·¯è¿½è¸ªä¹Ÿå¤šäº†3æ¡ï¼ŒPrometheusæŒ‡æ ‡å…¨éƒ¨+3ã€‚
ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼ŸåŸå› åœ¨äºæ¡†æ¶ä¼šæŠŠæ‰€æœ‰åŒ…è£…å™¨å…¨éƒ¨ç»„åˆèµ·æ¥å†æ‰§è¡Œï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">for</span> i := <span class="hljs-built_in">len</span>(wrappers); i &gt; <span class="hljs-number">0</span>; i-- {
    fn = wrappers[i<span class="hljs-number">-1</span>](fn)
}
fn(ctx, msg)
</code></pre>
<p>æ‰€ä»¥æ‰§è¡Œé‡è¯•çš„æ—¶å€™ä¼šæŠŠæ‰€æœ‰åŒ…è£…å™¨ä»£ç å…¨éƒ¨æ‰§è¡Œä¸€éï¼Œé€ æˆæ—¥å¿—å’Œé“¾è·¯è¿½è¸ªç­‰æ–¹æ³•ä¹Ÿé‡å¤æ‰§è¡Œã€‚</p>
<h3 data-id="heading-1">æ­£ç¡®åšæ³•</h3>
<p>åœ¨é¡¹ç›®é‡Œè‡ªç¼–çš„serviceContextæ³¨å…¥ä¸€ä¸ªè‡ªç¼–çš„Retryæ¥å£ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-go" lang="go">
<span class="hljs-keyword">type</span> Policy <span class="hljs-keyword">interface</span> {
    Execute(ctx context.Context, fn <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span>) <span class="hljs-type">error</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *exponentialBackOff)</span></span> Execute(ctx context.Context, fn <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span>) <span class="hljs-type">error</span> {
    expBackoff := backoff.NewExponentialBackOff()
    expBackoff.InitialInterval = r.opts.initialInterval
    expBackoff.MaxInterval = r.opts.maxInterval
    expBackoff.MaxElapsedTime = r.opts.maxElapsedTime
    backoffPolicy := backoff.WithContext(
       backoff.WithMaxRetries(expBackoff, r.opts.maxRetries),
       ctx,
    )

    operation := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span> {
       err := fn()          <span class="hljs-comment">// åœ¨è¿™é‡Œæ‰§è¡Œä½ çš„åº”ç”¨å±‚æ–¹æ³•</span>
       <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
          <span class="hljs-keyword">if</span> r.isPermanentError(err) {
             <span class="hljs-keyword">return</span> backoff.Permanent(err)
          }
       }

       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
    <span class="hljs-keyword">if</span> err := backoff.RetryNotify(operation, backoffPolicy, r.notify(ctx)); err != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span> err
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<p>ç„¶åå°†Policyæ¥å£æ³¨å…¥åˆ°serviceContextï¼Œè®©åº”ç”¨å±‚è°ƒç”¨è¿™ä¸ªExecuteæ–¹æ³•ï¼Œåº”ç”¨å±‚çš„æ–¹æ³•åŒ…è£¹åˆ°fn() errorå‡½æ•°é‡Œï¼Œè¿™æ ·å°±èƒ½å®ç°æœåŠ¡çš„æŒ‡æ•°é€€é¿é‡è¯•ï¼ŒåŒ…è£…å™¨è¿”å›æœ€ç»ˆé”™è¯¯ï¼Œé‡è¯•åè¿˜æ˜¯é”™è¯¯åˆ™æ”¾å…¥æ­»ä¿¡ä¸»é¢˜ï¼Œå…³äºgo microçš„æ­»ä¿¡é˜Ÿåˆ—å¤„ç†å°†åœ¨åç»­æ–‡ç« åˆ†äº«ã€‚</p>
<h3 data-id="heading-2">æ€»ç»“</h3>
<p>go microç”¨è£…é¥°å™¨æ¨¡å¼å°è£…çš„åŒ…è£…å™¨å¯ä»¥é¢å¤–å¢åŠ å¾ˆå¤šä¿®é¥°æ–¹æ³•ï¼Œä½†å…¶æ‰§è¡Œé€»è¾‘æ˜¯æ‰€æœ‰åŒ…è£…å™¨å…¨å±€æ‰§è¡Œï¼Œé€‚ç”¨äºæ—¥å¿—ã€é“¾è·¯è¿½è¸ªç­‰ä¸å½±å“æœ€ç»ˆç»“æœçš„åœºæ™¯ï¼Œå¯¹äºå½±å“æœ€ç»ˆç»“æœçš„åœºæ™¯å¦‚é‡è¯•æœºåˆ¶åˆ™æ¨èåœ¨åº”ç”¨å±‚æ‰§è¡Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NestJS ä¹‹æœåŠ¡ (Services)]]></title>    <link>https://juejin.cn/post/7598499504171352102</link>    <guid>https://juejin.cn/post/7598499504171352102</guid>    <pubDate>2026-01-24T12:03:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598499504171352102" data-draft-id="7598374376094433307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NestJS ä¹‹æœåŠ¡ (Services)"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T12:03:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åƒæŸ¯æ©˜"/> <meta itemprop="url" content="https://juejin.cn/user/2010369939736343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NestJS ä¹‹æœåŠ¡ (Services)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2010369939736343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åƒæŸ¯æ©˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T12:03:44.000Z" title="Sat Jan 24 2026 12:03:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-dark">.hljs-comment,.hljs-quote{color:#898ea4}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#202746;color:#979db4}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥æµ…å‡º NestJS ä¹‹æœåŠ¡ (Services)</h2>
<p>åœ¨ NestJS çš„åˆ†å±‚æ¶æ„ä¸­ï¼ŒServiceï¼ˆæœåŠ¡ï¼‰ ä½œä¸ºæ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œæ‰¿æ‹…ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚å¾ˆå¤šåˆå­¦è€…å¯èƒ½ä¼šç–‘æƒ‘ï¼šService åˆ°åº•æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿå®ƒå’Œ Controller æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»Šå¤©æˆ‘ä»¬å°±æ¥æ·±å…¥å‰–æ NestJS ä¸­ Service çš„ä½œç”¨ï¼Œç»“åˆå®ä¾‹å¸¦ä½ æŒæ¡å…¶ä½¿ç”¨ç²¾é«“ã€‚</p>
<h3 data-id="heading-1">å…ˆææ‡‚ï¼šä¸ºä»€ä¹ˆéœ€è¦ Serviceï¼Ÿ</h3>
<p>å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæ²¡æœ‰ Serviceï¼ŒNestJS é¡¹ç›®ä¼šå˜æˆä»€ä¹ˆæ ·ï¼Ÿâ€‹
å‡è®¾æˆ‘ä»¬ç›´æ¥åœ¨ Controllerï¼ˆæ§åˆ¶å™¨ï¼‰ä¸­ç¼–å†™æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚æ•°æ®æŸ¥è¯¢ã€è®¡ç®—ã€ç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨ç­‰ã€‚è¿™æ ·åšä¼šå¯¼è‡´ä¸¤ä¸ªä¸¥é‡é—®é¢˜ï¼šâ€‹</p>
<ul>
<li>Controller èŒè´£è¿‡é‡ï¼šController çš„æ ¸å¿ƒèŒè´£æœ¬æ˜¯ â€œæ¥æ”¶è¯·æ±‚ã€è¿”å›å“åº”â€ï¼Œè‹¥æ··å…¥å¤§é‡ä¸šåŠ¡é€»è¾‘ï¼Œä¼šè®©ä»£ç å˜å¾—è‡ƒè‚¿ä¸å ªï¼Œéš¾ä»¥ç»´æŠ¤ã€‚â€‹</li>
<li>ä»£ç æ— æ³•å¤ç”¨ï¼šå½“å¤šä¸ª Controller éœ€è¦ç”¨åˆ°ç›¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼ˆæ¯”å¦‚ç”¨æˆ·æƒé™æ ¡éªŒã€æ•°æ®æ ¼å¼åŒ–ï¼‰æ—¶ï¼Œåªèƒ½é‡å¤ç¼–å†™ä»£ç ï¼Œè¿èƒŒ â€œDRYï¼ˆDon't Repeat Yourselfï¼‰â€ åŸåˆ™ã€‚â€‹</li>
</ul>
<p>è€Œ Service çš„å‡ºç°ï¼Œæ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ã€‚å®ƒå°±åƒä¸€ä¸ª â€œä¸šåŠ¡é€»è¾‘å¤„ç†å™¨â€ï¼Œä¸“é—¨è´Ÿè´£å°è£…å¤æ‚ä¸šåŠ¡ï¼Œè®© Controller å›å½’æœ¬èŒï¼ŒåŒæ—¶å®ç°ä»£ç çš„å¤ç”¨ä¸è§£è€¦ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb23fdd20bde4947914a11de4ae1d282~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y2D5p-v5qmY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769861023&amp;x-signature=WudqXZ2J0gSsex5DyU7hdUblnhQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">Service çš„æ ¸å¿ƒä½œç”¨ï¼š3 ä¸ªç»´åº¦</h3>
<p>åœ¨ NestJS ä¸­ï¼ŒService çš„ä½œç”¨å¯ä»¥æ¦‚æ‹¬ä¸º â€œå°è£…ä¸šåŠ¡ã€è§£è€¦èŒè´£ã€æ”¯æŒå¤ç”¨â€ï¼Œå…·ä½“å¯ä»ä»¥ä¸‹ 3 ä¸ªç»´åº¦å±•å¼€ï¼š</p>
<h5 data-id="heading-3"><strong>1. å°è£…ä¸šåŠ¡é€»è¾‘ï¼šè®© Controller è½»è£…ä¸Šé˜µ</strong></h5>
<p>Service çš„é¦–è¦ä½œç”¨æ˜¯æ‰¿è½½æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬æ•°æ®å¤„ç†ã€è®¡ç®—ã€è§„åˆ™æ ¡éªŒã€ç¬¬ä¸‰æ–¹æœåŠ¡è°ƒç”¨ç­‰ã€‚Controller åªéœ€è¦ â€œè°ƒç”¨ Service çš„æ–¹æ³•â€ï¼Œæ— éœ€å…³å¿ƒä¸šåŠ¡é€»è¾‘çš„å…·ä½“å®ç°ã€‚</p>
<h5 data-id="heading-4"><strong>2. å®ç°ä»£ç å¤ç”¨ï¼šä¸€å¤„ç¼–å†™ï¼Œå¤šå¤„è°ƒç”¨</strong></h5>
<p>Service çš„å¦ä¸€ä¸ªæ ¸å¿ƒä½œç”¨æ˜¯å¤ç”¨ã€‚å½“å¤šä¸ª Controller æˆ–å…¶ä»– Service éœ€è¦ç”¨åˆ°ç›¸åŒçš„ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œåªéœ€æ³¨å…¥å¯¹åº”çš„ Service å¹¶è°ƒç”¨æ–¹æ³•ï¼Œæ— éœ€é‡å¤ç¼–å†™ä»£ç ã€‚</p>
<h5 data-id="heading-5"><strong>3. æ”¯æŒä¾èµ–æ³¨å…¥ï¼šè§£è€¦ç»„ä»¶ä¾èµ–</strong></h5>
<p>NestJS åŸºäº ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection, DIï¼‰ è®¾è®¡ï¼Œè€Œ Service æ˜¯ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒè½½ä½“ã€‚é€šè¿‡ @Injectable() è£…é¥°å™¨æ ‡è®° Serviceï¼ŒNestJS ä¼šè‡ªåŠ¨ç®¡ç† Service çš„å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦æ—¶æ³¨å…¥åˆ° Controller æˆ–å…¶ä»– Service ä¸­ã€‚
è¿™ç§æœºåˆ¶å¸¦æ¥ä¸¤ä¸ªå¥½å¤„ï¼š</p>
<ul>
<li>è§£è€¦ä¾èµ–ï¼šController ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º Service å®ä¾‹ï¼Œåªéœ€å£°æ˜ â€œéœ€è¦å“ªä¸ª Serviceâ€ï¼Œç”± NestJS è´Ÿè´£æ³¨å…¥ï¼Œé™ä½äº†ç»„ä»¶é—´çš„è€¦åˆåº¦ã€‚</li>
<li>ä¾¿äºæµ‹è¯•ï¼šåœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œå¯ä»¥è½»æ¾æ›¿æ¢ Service çš„å®ç°ï¼ˆæ¯”å¦‚ç”¨æ¨¡æ‹Ÿæ•°æ®çš„ Service æ›¿ä»£çœŸå®æ•°æ®åº“æ“ä½œçš„ Serviceï¼‰ï¼Œæ— éœ€ä¿®æ”¹ Controller ä»£ç ã€‚</li>
</ul>
<p><strong>ä¾èµ–æ³¨å…¥çš„åº•å±‚é€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">Controller</span>(<span class="hljs-string">'user'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">private readonly userService: UserService</span>) {}

  <span class="hljs-comment">// å¦‚ä¸Šçš„ä»£ç ç±»ä¼¼äºå¦‚ä¸‹ä»£ç </span>
  <span class="hljs-comment">// private readonly userService: UserService;</span>

  <span class="hljs-comment">// constructor(userService: UserService) {</span>
  <span class="hljs-comment">//  this.userService = userService;</span>
  <span class="hljs-comment">// }</span>


  @<span class="hljs-title class_">Get</span>()
  <span class="hljs-title function_">findAll</span>(): <span class="hljs-title class_">User</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">findAll</span>();
  }
}
</code></pre>
<p>å½“æˆ‘ä»¬åœ¨ Controller çš„æ„é€ å‡½æ•°ä¸­å£°æ˜ <code>private userService: UserService</code> æ—¶ï¼ŒNestJS ä¼šï¼š</p>
<ul>
<li>æ‰«æè£…é¥°å™¨: æ£€æŸ¥ UserService æ˜¯å¦è¢« <code>@Injectable()</code> æ ‡è®°ï¼ˆç¡®ä¿å¯æ³¨å…¥ï¼‰ï¼›</li>
<li>åˆ†æä¾èµ–ï¼šåˆ†ææ„é€ å‡½æ•°çš„å‚æ•°ï¼Œç¡®å®šéœ€è¦æ³¨å…¥çš„ä¾èµ–</li>
<li>åˆ›å»ºå•ä¾‹ï¼šåˆ›å»º UserService çš„å•ä¾‹å®ä¾‹ï¼ˆé»˜è®¤æ˜¯å•ä¾‹ï¼Œå¯é…ç½®ä½œç”¨åŸŸï¼‰ï¼›</li>
<li>æ³¨å…¥ä¾èµ–ï¼šå°†å®ä¾‹æ³¨å…¥åˆ° UserController ä¸­ï¼Œä¾›å…¶è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨ this.userService è°ƒç”¨ Service çš„æ–¹æ³•ã€‚</li>
</ul>
<p>PS:ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§° DIï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒè®©ç±»ä¸éœ€è¦è‡ªå·±åˆ›å»ºä¾èµ–å¯¹è±¡ï¼Œè€Œæ˜¯ç”±å¤–éƒ¨ï¼ˆé€šå¸¸æ˜¯æ¡†æ¶ï¼‰æä¾›</p>
<h3 data-id="heading-6">Service çš„æœ€ä½³å®è·µï¼šé¿å…è¸©å‘</h3>
<h5 data-id="heading-7"><strong>éœ€éµå¾ªå•ä¸€èŒè´£</strong></h5>
<p>ä¸€ä¸ª Service åªè´Ÿè´£ä¸€ä¸ªé¢†åŸŸçš„ä¸šåŠ¡ï¼Œä¸è¦æŠŠæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½å¡è¿›ä¸€ä¸ª Serviceï¼ˆæ¯”å¦‚åˆ›å»ºä¸€ä¸ª CommonService å¤„ç†æ‰€æœ‰é€šç”¨é€»è¾‘ï¼‰ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼šæŒ‰ä¸šåŠ¡é¢†åŸŸæ‹†åˆ† Serviceï¼Œæ¯”å¦‚ UserServiceï¼ˆç”¨æˆ·ç›¸å…³ï¼‰ã€OrderServiceï¼ˆè®¢å•ç›¸å…³ï¼‰ã€AuthServiceï¼ˆæƒé™ç›¸å…³ï¼‰ï¼Œæ¯ä¸ª Service åªå¤„ç†è‡ªå·±é¢†åŸŸå†…çš„é€»è¾‘ã€‚</p>
<p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œä¾¿äºå®šä½é—®é¢˜ï¼Œä¹Ÿåˆ©äºå›¢é˜Ÿåä½œï¼ˆä¸åŒå¼€å‘è€…è´Ÿè´£ä¸åŒé¢†åŸŸçš„ Serviceï¼‰ã€‚</p>
<h5 data-id="heading-8"><strong>ä¸è¦åœ¨ Service ä¸­å¤„ç† HTTP ç›¸å…³é€»è¾‘</strong></h5>
<p>Service æ˜¯ <strong>â€œä¸šåŠ¡é€»è¾‘å±‚â€</strong>ï¼Œä¸åº”è¯¥ä¾èµ– HTTP ç›¸å…³çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ Requestã€Responseï¼‰ï¼Œä¹Ÿä¸åº”è¯¥ç›´æ¥è¿”å› HTTP çŠ¶æ€ç æˆ–å“åº”æ ¼å¼ã€‚è¿™äº›æ“ä½œåº”è¯¥ç”± Controller è´Ÿè´£ã€‚</p>
<h5 data-id="heading-9">é”™è¯¯(Service å¤„ç† HTTP é€»è¾‘)âŒ âŒ</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// é”™è¯¯ï¼šService ç›´æ¥è¿”å› HTTP å“åº”</span>
<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getUserById</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span>, res: Response</span>) { <span class="hljs-comment">// ä¾èµ– Response å¯¹è±¡</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">user</span>.<span class="hljs-title function_">findUnique</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-title class_">Number</span>(id) } });
    <span class="hljs-keyword">if</span> (!user) {
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'ç”¨æˆ·ä¸å­˜åœ¨'</span>); <span class="hljs-comment">// ç›´æ¥æ“ä½œå“åº”</span>
    }
    res.<span class="hljs-title function_">send</span>(user);
  }
}
</code></pre>
<h5 data-id="heading-10">æ­£ç¡®(Service å¤„ç† HTTP é€»è¾‘) âœ… âœ…</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æ­£ç¡®ï¼šService è¿”å›æ•°æ®æˆ–æŠ›å‡ºå¼‚å¸¸</span>
<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getUserById</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userRepo</span>.<span class="hljs-title function_">findUnique</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-title class_">Number</span>(id) } });
    <span class="hljs-keyword">if</span> (!user) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NotFoundException</span>(<span class="hljs-string">'ç”¨æˆ·ä¸å­˜åœ¨'</span>); <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸</span>
    }
    <span class="hljs-keyword">return</span> user; <span class="hljs-comment">// è¿”å›æ•°æ®</span>
  }
}

<span class="hljs-comment">// Controller å¤„ç† HTTP å“åº”</span>
<span class="hljs-meta">@Controller</span>(<span class="hljs-string">'users'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-meta">@Get</span>(<span class="hljs-string">':id'</span>)
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getUserById</span>(<span class="hljs-params"><span class="hljs-meta">@Param</span>(<span class="hljs-string">'id'</span>) id: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">getUserById</span>(id); <span class="hljs-comment">// NestJS è‡ªåŠ¨å¤„ç†å“åº”çŠ¶æ€ç </span>
  }
}
</code></pre>
<h5 data-id="heading-11">åˆç†ä½¿ç”¨ Service ä¹‹é—´çš„ä¾èµ–æ³¨å…¥</h5>
<p>å½“ä¸€ä¸ª Service éœ€è¦è°ƒç”¨å¦ä¸€ä¸ª Service çš„é€»è¾‘æ—¶ï¼Œå¯ä»¥ç›´æ¥åœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥å¯¹æ–¹çš„ Serviceï¼ˆæ³¨æ„é¿å…å¾ªç¯ä¾èµ–ï¼‰ã€‚</p>
<p>ç¤ºä¾‹ï¼šOrderService ä¾èµ– UserService</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
  <span class="hljs-comment">// æ³¨å…¥ UserService</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> userService: UserService, <span class="hljs-keyword">private</span> prisma: PrismaService</span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span>, productId: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-comment">// 1. å…ˆé€šè¿‡ UserService æ ¡éªŒç”¨æˆ·æ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">getUserById</span>(userId);

    <span class="hljs-comment">// 2. åˆ›å»ºè®¢å•, orderRepo é€šå¸¸å’Œ æ•°æ®æ‰“äº¤é“</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderRepo</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">userId</span>: <span class="hljs-title class_">Number</span>(userId),
      <span class="hljs-attr">productId</span>: <span class="hljs-title class_">Number</span>(productId),
      <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>
    });
  }
}
</code></pre>
<h3 data-id="heading-12">NestJS ä¸­åˆ›å»º Service</h3>
<h5 data-id="heading-13"><strong>1. nest g service name åˆ›å»º service ç±»</strong></h5>
<pre><code class="hljs language-ts" lang="ts">nest g service user <span class="hljs-comment">// user æ˜¯æœåŠ¡çš„åå­—</span>
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šï¼š</p>
<ol>
<li>åˆ›å»º src/user/user.service.ts æ–‡ä»¶</li>
<li>åˆ›å»º src/user/user.service.spec.ts æµ‹è¯•æ–‡ä»¶</li>
<li>å¦‚æœ user.module.ts å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åœ¨æ¨¡å—ä¸­æ³¨å†ŒæœåŠ¡</li>
</ol>
<h5 data-id="heading-14"><strong>2. ç¼–è¾‘ src/user/user.service.ts æ–‡ä»¶</strong></h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

<span class="hljs-meta">@Injectable</span>() <span class="hljs-comment">// æ˜¯èƒ½è¢«ä¾èµ–æ³¨å…¥çš„æ ‡è¯†</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> orderService: OrderService,<span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> userRepo: UserRepo</span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">findOne</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-comment">// åˆ›å»ºç”¨æˆ·é€»è¾‘</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userRepo</span>.<span class="hljs-title function_">find</span>(userData);
    <span class="hljs-comment">// å¯ä»¥è°ƒç”¨å…¶ä»–æœåŠ¡çš„æ–¹æ³•</span>
    <span class="hljs-keyword">const</span> order = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderService</span>.<span class="hljs-title function_">findOrderByUserId</span>(id);
    <span class="hljs-keyword">return</span> {
      ...user,
      order,
    };
  }
}
</code></pre>
<h6 data-id="heading-15"><code>@Injectable()</code> è£…é¥°å™¨ çš„ä½œç”¨</h6>
<ol>
<li>NestJS çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿé€šè¿‡ <code>@Injectable()</code>è£…é¥°å™¨æ ‡è®°çš„ç±»æ‰èƒ½è¢«æ³¨å…¥</li>
<li>å…ƒæ•°æ®ç”Ÿæˆï¼šè£…é¥°å™¨ä¼šç”Ÿæˆå…ƒæ•°æ®ï¼Œå¸®åŠ© NestJS äº†è§£ç±»çš„ä¾èµ–å…³ç³»</li>
</ol>
<h5 data-id="heading-16"><strong>3. ç¼–è¾‘ src/user/user.controller.ts æ–‡ä»¶</strong></h5>
<p>åœ¨ <code>src/user/user.controller.ts</code> æ³¨å…¥ æœåŠ¡</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

<span class="hljs-meta">@Controller</span>(<span class="hljs-string">'user'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> userService: UserService</span>) {}

  <span class="hljs-meta">@Get</span>(<span class="hljs-string">':id'</span>)
  <span class="hljs-title function_">findOne</span>(<span class="hljs-meta">@Param</span>(<span class="hljs-string">'id'</span>, <span class="hljs-title class_">ParseIntPipe</span>) <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">const</span> user = <span class="hljs-variable language_">this</span>.<span class="hljs-property">userService</span>.<span class="hljs-title function_">findOne</span>(id);

    <span class="hljs-keyword">if</span> (!user) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`User with id <span class="hljs-subst">${id}</span> not found`</span>);
    }

    <span class="hljs-keyword">return</span> user;
  }
}
</code></pre>
<h5 data-id="heading-17"><strong>4. ç¼–è¾‘ src/user/user.module.ts å’Œ src/app.module.ts æ–‡ä»¶</strong></h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// src/user/user.module.ts</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [],
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">UserController</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">UserService</span>],
  <span class="hljs-attr">exports</span>: [],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserModule</span> {}

<span class="hljs-comment">// src/app.module.ts</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-comment">// imports ç”¨æ¥å¯¼å…¥å…¶ä»–æ¨¡å—</span>
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">UserModule</span>],
  <span class="hljs-comment">// controllers ç”¨æ¥æ³¨å†Œæ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨è´Ÿè´£å¤„ç† HTTP è¯·æ±‚</span>
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AppController</span>, <span class="hljs-title class_">UserController</span>],
  <span class="hljs-comment">// providers ç”¨æ¥æ³¨å†Œæä¾›è€…ï¼Œé€šå¸¸æ˜¯æœåŠ¡ç±»ï¼ŒåŒ…å«ä¸šåŠ¡çš„é€»è¾‘</span>
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>, <span class="hljs-title class_">UserService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<h3 data-id="heading-18">æ€»ç»“ï¼šService æ˜¯ NestJS æ¶æ„çš„ â€œä¸šåŠ¡æ ¸å¿ƒâ€</h3>
<p>å¦‚æœæŠŠ NestJS é¡¹ç›®æ¯”ä½œä¸€å®¶å…¬å¸ï¼š</p>
<ul>
<li>Controller åƒæ˜¯ â€œå‰å°â€ï¼Œè´Ÿè´£æ¥å¾…å®¢æˆ·ï¼ˆæ¥æ”¶è¯·æ±‚ï¼‰ã€ä¼ é€’éœ€æ±‚ï¼ˆè°ƒç”¨ Serviceï¼‰ã€åé¦ˆç»“æœï¼ˆè¿”å›å“åº”ï¼‰ï¼›</li>
<li>Service åƒæ˜¯ â€œä¸šåŠ¡éƒ¨é—¨â€ï¼Œè´Ÿè´£å¤„ç†æ ¸å¿ƒä¸šåŠ¡ï¼ˆå°è£…é€»è¾‘ï¼‰ã€è·¨éƒ¨é—¨åä½œï¼ˆå¤ç”¨é€»è¾‘ï¼‰ã€æ”¯æ’‘å…¬å¸è¿è½¬ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ã€‚
ç†è§£ Service çš„ä½œç”¨ï¼Œä¸ä»…èƒ½è®©ä½ å†™å‡ºæ›´æ¸…æ™°ã€æ›´å¯ç»´æŠ¤çš„ä»£ç ï¼Œæ›´èƒ½å¸®åŠ©ä½ æŒæ¡ NestJS åˆ†å±‚æ¶æ„çš„è®¾è®¡æ€æƒ³ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œè®°å¾—å§‹ç»ˆéµå¾ª <strong>â€œController è´Ÿè´£è¯·æ±‚å“åº”ï¼ŒService è´Ÿè´£ä¸šåŠ¡é€»è¾‘â€ çš„åŸåˆ™</strong>ï¼Œè®©ä½ çš„é¡¹ç›®ç»“æ„æ›´ä¼˜é›…ã€æ‰©å±•æ€§æ›´å¼ºã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Caffeineç»“åˆRedisç©ºå€¼ç¼“å­˜å®ç°å¤šçº§ç¼“å­˜]]></title>    <link>https://juejin.cn/post/7598818096729374758</link>    <guid>https://juejin.cn/post/7598818096729374758</guid>    <pubDate>2026-01-24T12:03:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598818096729374758" data-draft-id="7598499504171335718" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Caffeineç»“åˆRedisç©ºå€¼ç¼“å­˜å®ç°å¤šçº§ç¼“å­˜"/> <meta itemprop="keywords" content="åç«¯,Redis"/> <meta itemprop="datePublished" content="2026-01-24T12:03:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰æ°´ä¸æ»´"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Caffeineç»“åˆRedisç©ºå€¼ç¼“å­˜å®ç°å¤šçº§ç¼“å­˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰æ°´ä¸æ»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T12:03:16.000Z" title="Sat Jan 24 2026 12:03:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SpringBoot + å¤šçº§ç¼“å­˜å®æˆ˜ï¼šCaffeine+Redis + ç©ºå€¼ç¼“å­˜ï¼Œæ”»å…‹ä¸‰é«˜éš¾é¢˜</h2>
<p>åœ¨é«˜å¹¶å‘ç³»ç»Ÿä¸­ï¼Œç¼“å­˜æ˜¯æå‡å“åº”é€Ÿåº¦ã€å‡è½»æ•°æ®åº“å‹åŠ›çš„æ ¸å¿ƒæ‰‹æ®µï¼Œä½†å•ä¸€ç¼“å­˜æ–¹æ¡ˆå¾€å¾€éš¾ä»¥åº”å¯¹å¤æ‚åœºæ™¯ â€”â€” æœ¬åœ°ç¼“å­˜ç¼ºä¹åˆ†å¸ƒå¼ä¸€è‡´æ€§ï¼ŒRedis ç¼“å­˜å­˜åœ¨ç½‘ç»œå¼€é”€ï¼Œè¿˜å¯èƒ½é­é‡ç©¿é€ã€é›ªå´©ã€å‡»ç©¿ç­‰è‡´å‘½é—®é¢˜ã€‚æœ¬æ–‡åŸºäºå®æˆ˜æ¡ˆä¾‹ï¼Œè¯¦è§£ SpringBoot æ•´åˆ<strong>Caffeine æœ¬åœ°ç¼“å­˜ + Redis åˆ†å¸ƒå¼ç¼“å­˜ + ç©ºå€¼ç¼“å­˜</strong>çš„ä¸‰çº§ç¼“å­˜æ–¹æ¡ˆï¼Œä»æ¶æ„è®¾è®¡åˆ°ä»£ç è½åœ°ï¼Œæ„å»ºé«˜å¯ç”¨ã€ä½å»¶è¿Ÿçš„ç¼“å­˜ä½“ç³»ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡ï¼šä¸ºä»€ä¹ˆè¦ â€œä¸‰çº§è”åŠ¨â€ï¼Ÿ</h3>
<p>ä¼ ç»Ÿç¼“å­˜æ–¹æ¡ˆè¦ä¹ˆä¾èµ–å•ä¸€æœ¬åœ°ç¼“å­˜ï¼ˆæ— æ³•åˆ†å¸ƒå¼å…±äº«ï¼‰ï¼Œè¦ä¹ˆä»…ç”¨ Redisï¼ˆç½‘ç»œ IO å¼€é”€å½±å“æ€§èƒ½ï¼‰ï¼Œè€Œä¸‰çº§ç¼“å­˜æ¶æ„é€šè¿‡ â€œæœ¬åœ°ç¼“å­˜ + åˆ†å¸ƒå¼ç¼“å­˜ + æ•°æ®åº“â€ çš„å±‚çº§è®¾è®¡ï¼Œå®ç°äº† â€œé€Ÿåº¦â€ ä¸ â€œä¸€è‡´æ€§â€ çš„å¹³è¡¡ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€çº§ï¼šCaffeine æœ¬åœ°ç¼“å­˜</strong>åŸºäº Java å†…å­˜çš„é«˜æ€§èƒ½ç¼“å­˜ï¼Œè¯»å†™å»¶è¿Ÿä½è‡³çº³ç§’çº§ï¼Œä¸“é—¨å­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼ˆå¦‚é«˜é¢‘è®¿é—®çš„å•†å“ä¿¡æ¯ã€é…ç½®å‚æ•°ï¼‰ï¼Œé¿å…é‡å¤æŸ¥è¯¢ Redis å’Œæ•°æ®åº“ï¼Œæå‡æ ¸å¿ƒæ¥å£å“åº”é€Ÿåº¦ã€‚</li>
<li><strong>ç¬¬äºŒçº§ï¼šRedis åˆ†å¸ƒå¼ç¼“å­˜</strong>åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å…±äº«ç¼“å­˜ï¼Œè§£å†³æœ¬åœ°ç¼“å­˜æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼ŒåŒæ—¶æ‰¿æ‹… â€œä¸­é—´ç¼“å†²â€ è§’è‰²ï¼Œå‡å°‘æ•°æ®åº“ç›´æ¥è®¿é—®å‹åŠ›ã€‚</li>
<li><strong>ç¬¬ä¸‰çº§ï¼šæ•°æ®åº“</strong>æ•°æ®æœ€ç»ˆå­˜å‚¨æºï¼Œä»…åœ¨ç¼“å­˜æœªå‘½ä¸­æ—¶è§¦å‘æŸ¥è¯¢ï¼Œä¿è¯æ•°æ®å¯é æ€§ã€‚</li>
</ol>
<h4 data-id="heading-2">æ ¸å¿ƒä¼˜åŠ¿</h4>
<ul>
<li>æ€§èƒ½æè‡´ï¼šæœ¬åœ°ç¼“å­˜å‘½ä¸­ç‡è¶… 90%ï¼ŒRedis ç¼“å­˜å‘½ä¸­ç‡è¶… 95%ï¼Œ99% è¯·æ±‚å“åº”æ—¶é—´ &lt; 10msï¼›</li>
<li>é«˜å¯ç”¨ï¼šæ•…éšœéš”ç¦»è®¾è®¡ï¼ŒæŸä¸€çº§ç¼“å­˜å¤±æ•ˆä¸å½±å“æ•´ä½“æœåŠ¡ï¼ˆå¦‚ Redis å®•æœºæ—¶ï¼Œæœ¬åœ°ç¼“å­˜å¯ä¸´æ—¶å…œåº•ï¼‰ï¼›</li>
<li>èµ„æºä¼˜åŒ–ï¼šå‡å°‘ Redis ç½‘ç»œ IO å’Œæ•°æ®åº“æŸ¥è¯¢å‹åŠ›ï¼Œé™ä½é›†ç¾¤éƒ¨ç½²æˆæœ¬ï¼›</li>
<li>å¤šå±‚é˜²æŠ¤ï¼šä»æ¶æ„å±‚é¢è§„é¿ç¼“å­˜ç©¿é€ã€é›ªå´©ã€å‡»ç©¿ä¸‰å¤§ç»å…¸é—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-3">äºŒã€æ ¸å¿ƒé—®é¢˜è§£å†³æ–¹æ¡ˆï¼šä¸‰å¤§ç¼“å­˜éš¾é¢˜é€ä¸ªå‡»ç ´</h3>
<h4 data-id="heading-4">1. ç¼“å­˜ç©¿é€ï¼šæ‹¦æˆªæ— æ•ˆæŸ¥è¯¢</h4>
<p><strong>é—®é¢˜</strong>ï¼šæ¶æ„è¯·æ±‚æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼ˆå¦‚ ID=-1 çš„å•†å“ï¼‰ï¼Œå¯¼è‡´ç¼“å­˜å¤±æ•ˆåç›´æ¥ç©¿é€åˆ°æ•°æ®åº“ï¼Œå¼•å‘æ€§èƒ½é—®é¢˜ã€‚<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç©ºå€¼ç¼“å­˜ + å¸ƒéš†è¿‡æ»¤å™¨åŒé‡é˜²æŠ¤</p>
<ul>
<li>ç©ºå€¼ç¼“å­˜ï¼šæ•°æ®åº“æŸ¥è¯¢æ— ç»“æœæ—¶ï¼Œåœ¨ Redis å’Œ Caffeine ä¸­ç¼“å­˜ç©ºå€¼ï¼ˆè®¾ç½®çŸ­æœŸè¿‡æœŸæ—¶é—´ï¼Œå¦‚ 5 åˆ†é’Ÿï¼‰ï¼Œé¿å…é‡å¤ç©¿é€ï¼›</li>
<li>å¸ƒéš†è¿‡æ»¤å™¨ï¼šé¢„å…ˆå°†æ•°æ®åº“ä¸­å­˜åœ¨çš„ä¸»é”®ï¼ˆå¦‚å•†å“ IDã€ç”¨æˆ· IDï¼‰å­˜å…¥å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè¯·æ±‚å…ˆç»è¿‡è¿‡æ»¤å™¨æ ¡éªŒï¼Œæ— æ•ˆ ID ç›´æ¥æ‹¦æˆªï¼Œä¸è¿›å…¥ç¼“å­˜å’Œæ•°æ®åº“ã€‚</li>
</ul>
<h4 data-id="heading-5">2. ç¼“å­˜é›ªå´©ï¼šé¿å…é›†ä¸­å¤±æ•ˆ</h4>
<p><strong>é—®é¢˜</strong>ï¼šå¤§é‡ç¼“å­˜æ•°æ®åœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œæˆ– Redis é›†ç¾¤å®•æœºï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚ç¬é—´æ¶Œå‘æ•°æ®åº“ï¼Œå¼•å‘æ•°æ®åº“é›ªå´©ã€‚<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šéšæœºè¿‡æœŸæ—¶é—´ + ä¼˜é›…é™çº§</p>
<ul>
<li>éšæœº TTLï¼šç¼“å­˜æ•°æ®æ—¶ï¼Œåœ¨åŸºç¡€è¿‡æœŸæ—¶é—´ï¼ˆå¦‚ 30 åˆ†é’Ÿï¼‰ä¸Šå¢åŠ éšæœºå€¼ï¼ˆ5-10 åˆ†é’Ÿï¼‰ï¼Œä½¿ç¼“å­˜è¿‡æœŸæ—¶é—´åˆ†æ•£ï¼Œé¿å…é›†ä¸­å¤±æ•ˆï¼›</li>
<li>ä¼˜é›…é™çº§ï¼šRedis å®•æœºæ—¶ï¼Œå¯ç”¨æœ¬åœ°ç¼“å­˜å…œåº•ï¼ŒåŒæ—¶è§¦å‘å‘Šè­¦æœºåˆ¶ï¼Œä¿éšœæœåŠ¡æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ã€‚</li>
</ul>
<h4 data-id="heading-6">3. ç¼“å­˜å‡»ç©¿ï¼šä¿æŠ¤çƒ­ç‚¹æ•°æ®</h4>
<p><strong>é—®é¢˜</strong>ï¼šçƒ­ç‚¹æ•°æ®ï¼ˆå¦‚ç§’æ€å•†å“ï¼‰ç¼“å­˜è¿‡æœŸç¬é—´ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚ç©¿é€åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›éª¤å¢ã€‚<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šçƒ­ç‚¹æ•°æ®é¢„çƒ­ + åˆ†å¸ƒå¼é”</p>
<ul>
<li>æ•°æ®é¢„çƒ­ï¼šç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œä¸»åŠ¨å°†çƒ­ç‚¹æ•°æ®åŠ è½½åˆ° Caffeine å’Œ Redis ä¸­ï¼Œé¿å…ç¼“å­˜å†·å¯åŠ¨ï¼›</li>
<li>åˆ†å¸ƒå¼é”ï¼šç¼“å­˜è¿‡æœŸåï¼Œé€šè¿‡ Redis åˆ†å¸ƒå¼é”ï¼ˆå¦‚ Redissonï¼‰æ§åˆ¶ï¼Œä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®åº“å¹¶æ›´æ–°ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ç¼“å­˜æ›´æ–°åå†æŸ¥è¯¢ï¼Œé˜²æ­¢å¹¶å‘ç©¿é€ã€‚</li>
</ul>
<h3 data-id="heading-7">ä¸‰ã€å®æˆ˜è½åœ°ï¼šSpringBoot æ•´åˆä¸‰çº§ç¼“å­˜</h3>
<h4 data-id="heading-8">1. ä¾èµ–é…ç½®</h4>
<p>é¦–å…ˆå¼•å…¥æ ¸å¿ƒä¾èµ–ï¼ˆMaven ç¤ºä¾‹ï¼‰ï¼ŒåŒ…å« SpringBoot ç¼“å­˜ starterã€Caffeineã€Redisã€Redissonï¼ˆåˆ†å¸ƒå¼é”ï¼‰ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- SpringBootç¼“å­˜æ ¸å¿ƒä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- Caffeineæœ¬åœ°ç¼“å­˜ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.ben-manes.caffeine<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>caffeine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- Redisä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!-- Redissonåˆ†å¸ƒå¼é” --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.redisson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>redisson-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.23.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-9">2. æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h4>
<p>é…ç½® Caffeine ç¼“å­˜å‚æ•°ã€Redis è¿æ¥ä¿¡æ¯ã€åˆ†å¸ƒå¼é”ç­‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># Redisé…ç½®</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">2</span>
        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">1000ms</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">3000ms</span>
  <span class="hljs-comment"># ç¼“å­˜é…ç½®</span>
  <span class="hljs-attr">cache:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">caffeine</span>
    <span class="hljs-attr">caffeine:</span>
      <span class="hljs-comment"># åˆå§‹å®¹é‡ã€æœ€å¤§å®¹é‡ã€è¿‡æœŸæ—¶é—´ï¼ˆå†™å…¥å30åˆ†é’Ÿè¿‡æœŸï¼‰</span>
      <span class="hljs-attr">initial-capacity:</span> <span class="hljs-number">100</span>
      <span class="hljs-attr">maximum-size:</span> <span class="hljs-number">1000</span>
      <span class="hljs-attr">expire-after-write:</span> <span class="hljs-string">30m</span>

<span class="hljs-comment"># è‡ªå®šä¹‰ç¼“å­˜é…ç½®</span>
<span class="hljs-attr">cache:</span>
  <span class="hljs-comment"># ç©ºå€¼ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆ5åˆ†é’Ÿï¼‰</span>
  <span class="hljs-attr">null-value-expire:</span> <span class="hljs-string">5m</span>
  <span class="hljs-comment"># çƒ­ç‚¹æ•°æ®é¢„çƒ­keyå‰ç¼€</span>
  <span class="hljs-attr">hot-data-prefix:</span> <span class="hljs-string">"hot:"</span>
  <span class="hljs-comment"># åˆ†å¸ƒå¼é”å‰ç¼€</span>
  <span class="hljs-attr">lock-prefix:</span> <span class="hljs-string">"cache:lock:"</span>
</code></pre>
<h4 data-id="heading-10">3. æ ¸å¿ƒä»£ç å®ç°</h4>
<h5 data-id="heading-11">ï¼ˆ1ï¼‰ç¼“å­˜é…ç½®ç±»ï¼šåˆå§‹åŒ– Caffeine å’Œ Redis ç¼“å­˜</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.github.benmanes.caffeine.cache.Caffeine;
<span class="hljs-keyword">import</span> org.springframework.cache.CacheManager;
<span class="hljs-keyword">import</span> org.springframework.cache.caffeine.CaffeineCacheManager;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;
<span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.RedisSerializationContext;
<span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;
<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> {

    <span class="hljs-comment">// Caffeineç¼“å­˜ç®¡ç†å™¨ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">caffeineCacheManager</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CaffeineCacheManager</span> <span class="hljs-variable">cacheManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaffeineCacheManager</span>();
        <span class="hljs-comment">// é…ç½®Caffeineç¼“å­˜å‚æ•°ï¼šåˆå§‹å®¹é‡100ï¼Œæœ€å¤§å®¹é‡1000ï¼Œå†™å…¥å30åˆ†é’Ÿè¿‡æœŸ</span>
        cacheManager.setCaffeine(Caffeine.newBuilder()
                .initialCapacity(<span class="hljs-number">100</span>)
                .maximumSize(<span class="hljs-number">1000</span>)
                .expireAfterWrite(Duration.ofMinutes(<span class="hljs-number">30</span>)));
        <span class="hljs-keyword">return</span> cacheManager;
    }

    <span class="hljs-comment">// Redisç¼“å­˜ç®¡ç†å™¨ï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedisCacheManager <span class="hljs-title function_">redisCacheManager</span><span class="hljs-params">(RedisConnectionFactory connectionFactory)</span> {
        <span class="hljs-comment">// åºåˆ—åŒ–é…ç½®ï¼ˆé¿å…Rediså­˜å‚¨ä¹±ç ï¼‰</span>
        <span class="hljs-type">RedisCacheConfiguration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofMinutes(<span class="hljs-number">30</span>)) <span class="hljs-comment">// é»˜è®¤è¿‡æœŸæ—¶é—´30åˆ†é’Ÿ</span>
                .serializeKeysWith(RedisSerializationContext.SerializationPair
                        .fromSerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>()))
                .serializeValuesWith(RedisSerializationContext.SerializationPair
                        .fromSerializer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericJackson2JsonRedisSerializer</span>()));

        <span class="hljs-comment">// è‡ªå®šä¹‰ä¸åŒç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼ˆå¦‚ç©ºå€¼ç¼“å­˜5åˆ†é’Ÿï¼‰</span>
        Map&lt;String, RedisCacheConfiguration&gt; cacheConfigs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        cacheConfigs.put(<span class="hljs-string">"nullValueCache"</span>, config.entryTtl(Duration.ofMinutes(<span class="hljs-number">5</span>)));

        <span class="hljs-keyword">return</span> RedisCacheManager.builder(connectionFactory)
                .cacheDefaults(config)
                .withInitialCacheConfigurations(cacheConfigs)
                .build();
    }
}
</code></pre>
<h5 data-id="heading-12">ï¼ˆ2ï¼‰ç¼“å­˜å·¥å…·ç±»ï¼šå°è£…ä¸‰çº§ç¼“å­˜æŸ¥è¯¢é€»è¾‘</h5>
<p>æ ¸å¿ƒé€»è¾‘ï¼šå…ˆæŸ¥ Caffeineâ†’å†æŸ¥ Redisâ†’æœ€åæŸ¥æ•°æ®åº“ï¼ŒåŒæ—¶å¤„ç†ç©ºå€¼ç¼“å­˜ã€åˆ†å¸ƒå¼é”ã€ç¼“å­˜æ›´æ–°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.redisson.api.RLock;
<span class="hljs-keyword">import</span> org.redisson.api.RedissonClient;
<span class="hljs-keyword">import</span> org.springframework.cache.Cache;
<span class="hljs-keyword">import</span> org.springframework.cache.CacheManager;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheUtil</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> CacheManager caffeineCacheManager;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> RedisCacheManager redisCacheManager;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> BloomFilterUtil bloomFilterUtil; <span class="hljs-comment">// å¸ƒéš†è¿‡æ»¤å™¨å·¥å…·ç±»</span>

    <span class="hljs-comment">// ç¼“å­˜æŸ¥è¯¢æ ¸å¿ƒæ–¹æ³•ï¼škey-ç¼“å­˜é”®ï¼Œclazz-è¿”å›ç±»å‹ï¼ŒdbLoader-æ•°æ®åº“æŸ¥è¯¢é€»è¾‘</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getCache</span><span class="hljs-params">(String key, Class&lt;T&gt; clazz, DataLoader&lt;T&gt; dbLoader)</span> {
        <span class="hljs-comment">// 1. å¸ƒéš†è¿‡æ»¤å™¨æ ¡éªŒï¼šæ— æ•ˆkeyç›´æ¥è¿”å›null</span>
        <span class="hljs-keyword">if</span> (!bloomFilterUtil.contains(key)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// 2. æŸ¥è¯¢Caffeineæœ¬åœ°ç¼“å­˜</span>
        <span class="hljs-type">Cache</span> <span class="hljs-variable">caffeineCache</span> <span class="hljs-operator">=</span> caffeineCacheManager.getCache(<span class="hljs-string">"localCache"</span>);
        <span class="hljs-type">T</span> <span class="hljs-variable">localValue</span> <span class="hljs-operator">=</span> caffeineCache.get(key, clazz);
        <span class="hljs-keyword">if</span> (localValue != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> localValue;
        }

        <span class="hljs-comment">// 3. æŸ¥è¯¢Redisåˆ†å¸ƒå¼ç¼“å­˜</span>
        <span class="hljs-type">Cache</span> <span class="hljs-variable">redisCache</span> <span class="hljs-operator">=</span> redisCacheManager.getCache(<span class="hljs-string">"redisCache"</span>);
        <span class="hljs-type">T</span> <span class="hljs-variable">redisValue</span> <span class="hljs-operator">=</span> redisCache.get(key, clazz);
        <span class="hljs-keyword">if</span> (redisValue != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// Rediså‘½ä¸­ï¼ŒåŒæ­¥åˆ°æœ¬åœ°ç¼“å­˜</span>
            caffeineCache.put(key, redisValue);
            <span class="hljs-keyword">return</span> redisValue;
        }

        <span class="hljs-comment">// 4. ç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ†å¸ƒå¼é”æ§åˆ¶æ•°æ®åº“æŸ¥è¯¢</span>
        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">"cache:lock:"</span> + key);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å°è¯•è·å–é”ï¼Œæœ€å¤šç­‰å¾…3ç§’ï¼ŒæŒæœ‰é”10ç§’</span>
            <span class="hljs-keyword">if</span> (lock.tryLock(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS)) {
                <span class="hljs-comment">// å†æ¬¡æŸ¥è¯¢Redisï¼ˆé˜²æ­¢å…¶ä»–çº¿ç¨‹å·²æ›´æ–°ç¼“å­˜ï¼‰</span>
                redisValue = redisCache.get(key, clazz);
                <span class="hljs-keyword">if</span> (redisValue != <span class="hljs-literal">null</span>) {
                    caffeineCache.put(key, redisValue);
                    <span class="hljs-keyword">return</span> redisValue;
                }

                <span class="hljs-comment">// 5. æŸ¥è¯¢æ•°æ®åº“</span>
                <span class="hljs-type">T</span> <span class="hljs-variable">dbValue</span> <span class="hljs-operator">=</span> dbLoader.load();
                <span class="hljs-keyword">if</span> (dbValue != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// æ•°æ®åº“æœ‰ç»“æœï¼Œæ›´æ–°å„çº§ç¼“å­˜</span>
                    redisCache.put(key, dbValue);
                    caffeineCache.put(key, dbValue);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// æ•°æ®åº“æ— ç»“æœï¼Œç¼“å­˜ç©ºå€¼ï¼ˆ5åˆ†é’Ÿè¿‡æœŸï¼‰</span>
                    <span class="hljs-type">Cache</span> <span class="hljs-variable">nullValueCache</span> <span class="hljs-operator">=</span> redisCacheManager.getCache(<span class="hljs-string">"nullValueCache"</span>);
                    nullValueCache.put(key, <span class="hljs-literal">null</span>);
                    caffeineCache.put(key, <span class="hljs-literal">null</span>);
                }
                <span class="hljs-keyword">return</span> dbValue;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// è·å–é”å¤±è´¥ï¼Œè¿”å›é»˜è®¤å€¼æˆ–æŠ›å‡ºå¼‚å¸¸</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç¼“å­˜æ›´æ–°ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•"</span>);
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// é‡Šæ”¾é”</span>
            <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread()) {
                lock.unlock();
            }
        }
    }

    <span class="hljs-comment">// æ•°æ®åŠ è½½å‡½æ•°å¼æ¥å£ï¼ˆå°è£…æ•°æ®åº“æŸ¥è¯¢é€»è¾‘ï¼‰</span>
    <span class="hljs-meta">@FunctionalInterface</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DataLoader</span>&lt;T&gt; {
        T <span class="hljs-title function_">load</span><span class="hljs-params">()</span>;
    }
}
</code></pre>
<h5 data-id="heading-13">ï¼ˆ3ï¼‰ç¼“å­˜æ›´æ–°ä¸æ¸…é™¤ï¼šä¿éšœæ•°æ®ä¸€è‡´æ€§</h5>
<p>å½“æ•°æ®åº“æ•°æ®å‘ç”Ÿå˜æ›´ï¼ˆæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ï¼‰æ—¶ï¼Œéœ€åŒæ­¥æ¸…é™¤å„çº§ç¼“å­˜ï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¼“å­˜æ¸…é™¤æ–¹æ³•ï¼ˆç”¨äºæ•°æ®åº“æ›´æ–°åï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearCache</span><span class="hljs-params">(String key)</span> {
    <span class="hljs-comment">// 1. æ¸…é™¤æœ¬åœ°ç¼“å­˜</span>
    <span class="hljs-type">Cache</span> <span class="hljs-variable">caffeineCache</span> <span class="hljs-operator">=</span> caffeineCacheManager.getCache(<span class="hljs-string">"localCache"</span>);
    caffeineCache.evict(key);
    <span class="hljs-comment">// 2. æ¸…é™¤Redisç¼“å­˜</span>
    <span class="hljs-type">Cache</span> <span class="hljs-variable">redisCache</span> <span class="hljs-operator">=</span> redisCacheManager.getCache(<span class="hljs-string">"redisCache"</span>);
    redisCache.evict(key);
    <span class="hljs-comment">// 3. æ¸…é™¤ç©ºå€¼ç¼“å­˜</span>
    <span class="hljs-type">Cache</span> <span class="hljs-variable">nullValueCache</span> <span class="hljs-operator">=</span> redisCacheManager.getCache(<span class="hljs-string">"nullValueCache"</span>);
    nullValueCache.evict(key);
}
</code></pre>
<h5 data-id="heading-14">ï¼ˆ4ï¼‰çƒ­ç‚¹æ•°æ®é¢„çƒ­ï¼šç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½</h5>
<p>é€šè¿‡<code>CommandLineRunner</code>å®ç°ç³»ç»Ÿå¯åŠ¨æ—¶é¢„çƒ­çƒ­ç‚¹æ•°æ®ï¼Œé¿å…ç¼“å­˜å†·å¯åŠ¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.boot.CommandLineRunner;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HotDataPreloader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> CacheUtil cacheUtil;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> ProductMapper productMapper; <span class="hljs-comment">// æ•°æ®åº“DAOå±‚</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// åŠ è½½çƒ­ç‚¹å•†å“æ•°æ®ï¼ˆå¦‚é”€é‡å‰100çš„å•†å“ï¼‰</span>
        List&lt;Product&gt; hotProducts = productMapper.selectHotProducts(<span class="hljs-number">100</span>);
        <span class="hljs-keyword">for</span> (Product product : hotProducts) {
            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + product.getId();
            <span class="hljs-comment">// å­˜å…¥æœ¬åœ°ç¼“å­˜å’ŒRedis</span>
            cacheUtil.caffeineCacheManager.getCache(<span class="hljs-string">"localCache"</span>).put(key, product);
            cacheUtil.redisCacheManager.getCache(<span class="hljs-string">"redisCache"</span>).put(key, product);
        }
        System.out.println(<span class="hljs-string">"çƒ­ç‚¹æ•°æ®é¢„çƒ­å®Œæˆï¼Œå…±åŠ è½½"</span> + hotProducts.size() + <span class="hljs-string">"æ¡æ•°æ®"</span>);
    }
}
</code></pre>
<h3 data-id="heading-15">å››ã€ä¼˜åŒ–ä¸ç›‘æ§ï¼šè®©ç¼“å­˜ä½“ç³»æ›´ç¨³å®š</h3>
<h4 data-id="heading-16">1. é…ç½®ä¼˜åŒ–å»ºè®®</h4>
<ul>
<li>Caffeine å‚æ•°ï¼šåˆå§‹å®¹é‡è®¾ä¸ºé¢„æœŸçƒ­ç‚¹æ•°æ®é‡çš„ 80%ï¼Œæœ€å¤§å®¹é‡é¿å…è¶…è¿‡ JVM å†…å­˜çš„ 30%ï¼ˆé˜²æ­¢ OOMï¼‰ï¼›</li>
<li>Redis ä¼˜åŒ–ï¼šå¼€å¯æŒä¹…åŒ–ï¼ˆAOF+RDBï¼‰ï¼Œé…ç½®ä¸»ä»å¤åˆ¶ï¼Œé¿å…å•ç‚¹æ•…éšœï¼›è°ƒæ•´è¿æ¥æ± å‚æ•°é€‚é…å¹¶å‘é‡ï¼›</li>
<li>è¿‡æœŸæ—¶é—´ï¼šæ ¹æ®æ•°æ®æ›´æ–°é¢‘ç‡è°ƒæ•´ï¼Œé«˜é¢‘æ›´æ–°æ•°æ®ï¼ˆå¦‚åº“å­˜ï¼‰è¿‡æœŸæ—¶é—´è®¾ä¸º 5-10 åˆ†é’Ÿï¼Œä½é¢‘æ•°æ®è®¾ä¸º 1-2 å°æ—¶ã€‚</li>
</ul>
<h4 data-id="heading-17">2. ç›‘æ§ä¸å‘Šè­¦</h4>
<ul>
<li>ç¼“å­˜å‘½ä¸­ç‡ï¼šé€šè¿‡ Spring Boot Actuator æš´éœ²ç¼“å­˜æŒ‡æ ‡ï¼Œç›‘æ§ Caffeine å’Œ Redis å‘½ä¸­ç‡ï¼ˆç›®æ ‡ï¼šå‡â‰¥90%ï¼‰ï¼›</li>
<li>å“åº”æ—¶é—´ï¼šç»Ÿè®¡æ¥å£ç¼“å­˜å‘½ä¸­ / æœªå‘½ä¸­çš„å“åº”æ—¶é—´ï¼Œè¶…è¿‡é˜ˆå€¼ï¼ˆå¦‚ 50msï¼‰è§¦å‘å‘Šè­¦ï¼›</li>
<li>å¼‚å¸¸ç›‘æ§ï¼šç›‘æ§ Redis è¿æ¥å¼‚å¸¸ã€åˆ†å¸ƒå¼é”è·å–å¤±è´¥ç­‰æƒ…å†µï¼ŒåŠæ—¶æ’æŸ¥é—®é¢˜ã€‚</li>
</ul>
<h4 data-id="heading-18">3. æ³¨æ„äº‹é¡¹</h4>
<ul>
<li>æ•°æ®ä¸€è‡´æ€§ï¼šç¼“å­˜æ¸…é™¤éœ€ä¸æ•°æ®åº“äº‹åŠ¡åŒæ­¥ï¼ˆå»ºè®®ç”¨äº‹åŠ¡æäº¤åå¼‚æ­¥æ¸…é™¤ï¼Œé¿å…é˜»å¡ä¸šåŠ¡ï¼‰ï¼›</li>
<li>å†…å­˜ç®¡ç†ï¼šCaffeine ç¼“å­˜é¿å…å­˜å‚¨å¤§å¯¹è±¡ï¼Œå®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®ï¼›Redis å¯ç”¨å†…å­˜æ·˜æ±°ç­–ç•¥ï¼ˆå¦‚ LRUï¼‰ï¼›</li>
<li>æ•æ„Ÿæ•°æ®ï¼šç¼“å­˜ä¸­ä¸å­˜å‚¨æ˜æ–‡æ•æ„Ÿæ•°æ®ï¼ˆå¦‚å¯†ç ã€æ‰‹æœºå·ï¼‰ï¼Œéœ€åŠ å¯†åå­˜å‚¨ï¼›</li>
<li>é™çº§ç­–ç•¥ï¼šRedis é›†ç¾¤æ•…éšœæ—¶ï¼Œå…³é—­ Redis ç¼“å­˜è¯»å–ï¼Œä»…ç”¨æœ¬åœ°ç¼“å­˜ + æ•°æ®åº“å…œåº•ï¼Œä¿éšœæ ¸å¿ƒåŠŸèƒ½å¯ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-19">äº”ã€æ€»ç»“</h3>
<p>SpringBoot+Caffeine+Redis + ç©ºå€¼ç¼“å­˜çš„ä¸‰çº§ç¼“å­˜æ–¹æ¡ˆï¼Œé€šè¿‡ â€œæœ¬åœ°ç¼“å­˜ææ•ˆã€åˆ†å¸ƒå¼ç¼“å­˜ä¿ä¸€è‡´ã€ç©ºå€¼ç¼“å­˜é˜²ç©¿é€â€ çš„è®¾è®¡ï¼Œå®Œç¾è§£å†³äº†é«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¼“å­˜æ ¸å¿ƒéš¾é¢˜ã€‚è¯¥æ–¹æ¡ˆä¸ä»…èƒ½å°†æ¥å£å“åº”æ—¶é—´å‹ç¼©è‡³æ¯«ç§’çº§ï¼Œè¿˜èƒ½å¤§å¹…é™ä½æ•°æ®åº“å‹åŠ›ï¼ŒåŒæ—¶å…·å¤‡æ•…éšœéš”ç¦»ã€ä¼˜é›…é™çº§çš„é«˜å¯ç”¨ç‰¹æ€§ï¼Œé€‚ç”¨äºç”µå•†ã€æ”¯ä»˜ã€ç¤¾äº¤ç­‰å„ç±»é«˜å¹¶å‘ç³»ç»Ÿã€‚</p>
<p>å®é™…è½åœ°æ—¶ï¼Œå¯æ ¹æ®ä¸šåŠ¡åœºæ™¯çµæ´»è°ƒæ•´ç¼“å­˜å‚æ•°ï¼ˆå¦‚è¿‡æœŸæ—¶é—´ã€æœ€å¤§å®¹é‡ï¼‰å’Œé¢„çƒ­ç­–ç•¥ï¼Œç»“åˆç›‘æ§å·¥å…·æŒç»­ä¼˜åŒ–ï¼Œè®©ç¼“å­˜ä½“ç³»çœŸæ­£æˆä¸ºç³»ç»Ÿçš„ â€œæ€§èƒ½åŠ é€Ÿå™¨â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šéƒ¨ç½² Node.js åº”ç”¨ â€”â€” PM2 ç®¡ç†ä¸å®ˆæŠ¤]]></title>    <link>https://juejin.cn/post/7598827641306759219</link>    <guid>https://juejin.cn/post/7598827641306759219</guid>    <pubDate>2026-01-25T02:12:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598827641306759219" data-draft-id="7598801700049879078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šéƒ¨ç½² Node.js åº”ç”¨ â€”â€” PM2 ç®¡ç†ä¸å®ˆæŠ¤"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,Node.js"/> <meta itemprop="datePublished" content="2026-01-25T02:12:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šéƒ¨ç½² Node.js åº”ç”¨ â€”â€” PM2 ç®¡ç†ä¸å®ˆæŠ¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T02:12:32.000Z" title="Sun Jan 25 2026 02:12:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å½“æˆ‘ä»¬å®Œæˆäº† Node.js åº”ç”¨çš„å¼€å‘ï¼Œæœ¬åœ°è¿è¡Œä¸€åˆ‡æ­£å¸¸ä¹‹åï¼Œæ¥ä¸‹æ¥é¢ä¸´çš„ä¸€ä¸ªå…³é”®é—®é¢˜æ˜¯ï¼š
<strong>å¦‚ä½•è®©åº”ç”¨åœ¨æœåŠ¡å™¨ä¸Šé•¿æœŸã€ç¨³å®šåœ°è¿è¡Œï¼Ÿ</strong></p>
</blockquote>
<p>å¦‚æœç›´æ¥ä½¿ç”¨ <code>node app.js</code> å¯åŠ¨è¿›ç¨‹ï¼Œä¸€æ—¦æœåŠ¡å™¨é‡å¯ã€ç»ˆç«¯æ–­å¼€æˆ–è¿›ç¨‹å¼‚å¸¸å´©æºƒï¼ŒæœåŠ¡å°±ä¼šç«‹åˆ»åœæ­¢ï¼Œè¿™åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯å®Œå…¨ä¸å¯æ¥å—çš„ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç”Ÿäº§ç¯å¢ƒä¸­æœ€å¸¸ç”¨çš„å·¥å…·ä¹‹ä¸€å°±æ˜¯ <strong>PM2</strong>ã€‚æœ¬æ–‡å°†ä»å®æˆ˜è§’åº¦ï¼Œç³»ç»Ÿè®²è§£å¦‚ä½•ä½¿ç”¨ PM2 å¯¹ Node.js åº”ç”¨è¿›è¡Œ<strong>è¿›ç¨‹ç®¡ç†ã€å®ˆæŠ¤ã€æ—¥å¿—ç®¡ç†ä¸è‡ªåŠ¨é‡å¯</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ PM2</h2>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ Node.js æœåŠ¡ï¼Œé€šå¸¸ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>ç»ˆç«¯æ–­å¼€ï¼Œè¿›ç¨‹éšä¹‹é€€å‡º</li>
<li>ä»£ç å¼‚å¸¸å¯¼è‡´æœåŠ¡å´©æºƒ</li>
<li>æœåŠ¡å™¨é‡å¯åéœ€è¦æ‰‹åŠ¨æ‹‰èµ·æœåŠ¡</li>
<li>å¤šå®ä¾‹éƒ¨ç½²éš¾ä»¥ç®¡ç†</li>
<li>æ—¥å¿—é›¶æ•£ï¼Œä¸ä¾¿æ’æŸ¥é—®é¢˜</li>
</ul>
<p>PM2 æ­£æ˜¯ä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œç”Ÿï¼Œå®ƒå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ul>
<li>è¿›ç¨‹å®ˆæŠ¤ä¸è‡ªåŠ¨é‡å¯</li>
<li>å¤šå®ä¾‹é›†ç¾¤æ¨¡å¼</li>
<li>ç»Ÿä¸€æ—¥å¿—ç®¡ç†</li>
<li>å¯åŠ¨è„šæœ¬ä¸å¼€æœºè‡ªå¯</li>
<li>è¿›ç¨‹ç›‘æ§ä¸æ€§èƒ½ç»Ÿè®¡</li>
</ul>
<p>åœ¨ç»å¤§å¤šæ•° Node.js ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒPM2 éƒ½æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†æ–¹æ¡ˆã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€å®‰è£… PM2</h2>
<h3 data-id="heading-2">1. å…¨å±€å®‰è£…</h3>
<pre><code class="hljs language-bash" lang="bash">npm install -g pm2
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œç¡®è®¤ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pm2 -v
</code></pre>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€ä½¿ç”¨ PM2 å¯åŠ¨åº”ç”¨</h2>
<p>å‡è®¾ä½ çš„å…¥å£æ–‡ä»¶æ˜¯ <code>app.js</code> æˆ– <code>server.js</code>ã€‚</p>
<h3 data-id="heading-4">1. åŸºæœ¬å¯åŠ¨æ–¹å¼</h3>
<pre><code class="hljs language-bash" lang="bash">pm2 start app.js --name my-app
</code></pre>
<p>è¿™é‡Œï¼š</p>
<ul>
<li><code>app.js</code> æ˜¯å…¥å£æ–‡ä»¶</li>
<li><code>my-app</code> æ˜¯è¿›ç¨‹åç§°ï¼Œä¾¿äºåç»­ç®¡ç†</li>
</ul>
<hr/>
<h3 data-id="heading-5">2. æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨</h3>
<pre><code class="hljs language-bash" lang="bash">pm2 list
</code></pre>
<p>ä½ å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>è¿›ç¨‹åç§°</li>
<li>è¿›ç¨‹ ID</li>
<li>è¿è¡ŒçŠ¶æ€</li>
<li>CPU / å†…å­˜å ç”¨</li>
</ul>
<hr/>
<h3 data-id="heading-6">3. æŸ¥çœ‹æ—¥å¿—</h3>
<pre><code class="hljs language-bash" lang="bash">pm2 logs my-app
</code></pre>
<p>æˆ–è€…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pm2 logs
</code></pre>
<p>PM2 ä¼šè‡ªåŠ¨å°† stdout ä¸ stderr å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œä¾¿äºçº¿ä¸Šæ’é”™ã€‚</p>
<hr/>
<h2 data-id="heading-7">å››ã€è¿›ç¨‹å®ˆæŠ¤ä¸è‡ªåŠ¨é‡å¯</h2>
<h3 data-id="heading-8">1. åº”ç”¨å´©æºƒè‡ªåŠ¨æ‹‰èµ·</h3>
<p>å½“ Node.js è¿›ç¨‹å› å¼‚å¸¸é€€å‡ºæ—¶ï¼ŒPM2 ä¼šè‡ªåŠ¨é‡å¯è¿›ç¨‹ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡äººä¸ºåˆ¶é€ ä¸€ä¸ªå¼‚å¸¸æ¥éªŒè¯ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'crash test'</span>);
}, <span class="hljs-number">3000</span>);
</code></pre>
<p>å‡ ç§’åï¼ŒPM2 ä¼šé‡æ–°æ‹‰èµ·è¯¥è¿›ç¨‹ã€‚</p>
<hr/>
<h3 data-id="heading-9">2. æœ€å¤§é‡å¯æ¬¡æ•°é™åˆ¶</h3>
<pre><code class="hljs language-bash" lang="bash">pm2 start app.js --name my-app --max-restarts 5
</code></pre>
<p>å½“åº”ç”¨åœ¨çŸ­æ—¶é—´å†…é¢‘ç¹å´©æºƒæ—¶ï¼ŒPM2 ä¼šåœæ­¢é‡å¯ï¼Œé˜²æ­¢æ— é™å¾ªç¯ã€‚</p>
<hr/>
<h2 data-id="heading-10">äº”ã€é›†ç¾¤æ¨¡å¼ï¼ˆå¤šè¿›ç¨‹ï¼‰</h2>
<p>åœ¨å¤šæ ¸æœåŠ¡å™¨ä¸Šï¼Œæ¨èä½¿ç”¨ PM2 çš„ <strong>cluster æ¨¡å¼</strong> æé«˜å¹¶å‘èƒ½åŠ›ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">pm2 start app.js --name my-app -i max
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>-i max</code> è¡¨ç¤ºæ ¹æ® CPU æ ¸å¿ƒæ•°è‡ªåŠ¨å¯åŠ¨å¤šä¸ªå®ä¾‹</li>
<li>æ‰€æœ‰å®ä¾‹å…±äº«åŒä¸€ç«¯å£</li>
<li>PM2 å†…éƒ¨å®ç°è´Ÿè½½å‡è¡¡</li>
</ul>
<p>æŸ¥çœ‹æ•ˆæœï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pm2 list
</code></pre>
<p>ä½ ä¼šçœ‹åˆ°å¤šä¸ª <code>my-app</code> å®ä¾‹åœ¨åŒæ—¶è¿è¡Œã€‚</p>
<hr/>
<h2 data-id="heading-11">å…­ã€ä½¿ç”¨ ecosystem é…ç½®æ–‡ä»¶</h2>
<p>å½“é¡¹ç›®å‚æ•°è¾ƒå¤šæ—¶ï¼Œæ¨èä½¿ç”¨ <code>ecosystem.config.js</code> ç»Ÿä¸€ç®¡ç†ã€‚</p>
<h3 data-id="heading-12">1. åˆ›å»ºé…ç½®æ–‡ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash">pm2 init
</code></pre>
<p>ç”Ÿæˆ <code>ecosystem.config.js</code>ã€‚</p>
<hr/>
<h3 data-id="heading-13">2. ç¤ºä¾‹é…ç½®</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">apps</span>: [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'my-app'</span>,
      <span class="hljs-attr">script</span>: <span class="hljs-string">'app.js'</span>,
      <span class="hljs-attr">instances</span>: <span class="hljs-string">'max'</span>,
      <span class="hljs-attr">exec_mode</span>: <span class="hljs-string">'cluster'</span>,
      <span class="hljs-attr">env</span>: {
        <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">'development'</span>,
        <span class="hljs-attr">PORT</span>: <span class="hljs-number">3000</span>
      },
      <span class="hljs-attr">env_production</span>: {
        <span class="hljs-attr">NODE_ENV</span>: <span class="hljs-string">'production'</span>,
        <span class="hljs-attr">PORT</span>: <span class="hljs-number">3000</span>
      },
      <span class="hljs-attr">max_restarts</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">watch</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">autorestart</span>: <span class="hljs-literal">true</span>
    }
  ]
};
</code></pre>
<hr/>
<h3 data-id="heading-14">3. ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨</h3>
<pre><code class="hljs language-bash" lang="bash">pm2 start ecosystem.config.js --<span class="hljs-built_in">env</span> production
</code></pre>
<hr/>
<h2 data-id="heading-15">ä¸ƒã€æ—¥å¿—ç®¡ç†ä¸åˆ‡å‰²</h2>
<h3 data-id="heading-16">1. é»˜è®¤æ—¥å¿—ä½ç½®</h3>
<p>PM2 é»˜è®¤æ—¥å¿—ç›®å½•ï¼š</p>
<pre><code class="hljs language-text" lang="text">~/.pm2/logs/
</code></pre>
<p>æ¯ä¸ªåº”ç”¨ä¼šç”Ÿæˆï¼š</p>
<ul>
<li><code>my-app-out.log</code></li>
<li><code>my-app-error.log</code></li>
</ul>
<hr/>
<h3 data-id="heading-17">2. æ—¥å¿—åˆ‡å‰²æ’ä»¶</h3>
<p>é•¿æ—¶é—´è¿è¡Œåï¼Œæ—¥å¿—æ–‡ä»¶ä¼šä¸æ–­å¢å¤§ï¼Œæ¨èå®‰è£…æ—¥å¿—åˆ‡å‰²æ¨¡å—ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pm2 install pm2-logrotate
</code></pre>
<p>å¸¸ç”¨é…ç½®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pm2 <span class="hljs-built_in">set</span> pm2-logrotate:max_size 50M
pm2 <span class="hljs-built_in">set</span> pm2-logrotate:retain 10
pm2 <span class="hljs-built_in">set</span> pm2-logrotate:compress <span class="hljs-literal">true</span>
</code></pre>
<hr/>
<h2 data-id="heading-18">å…«ã€å¼€æœºè‡ªå¯</h2>
<p>ä¸ºäº†åœ¨æœåŠ¡å™¨é‡å¯åè‡ªåŠ¨æ‹‰èµ·æœåŠ¡ï¼Œéœ€è¦è®¾ç½® PM2 å¼€æœºè‡ªå¯ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">pm2 startup
</code></pre>
<p>æŒ‰ç…§ç»ˆç«¯æç¤ºæ‰§è¡Œç”Ÿæˆçš„å‘½ä»¤ã€‚</p>
<p>ç„¶åä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pm2 save
</code></pre>
<p>è¿™æ ·åœ¨æœåŠ¡å™¨é‡å¯åï¼ŒPM2 ä¼šè‡ªåŠ¨æ¢å¤æ‰€æœ‰è¿›ç¨‹ã€‚</p>
<hr/>
<h2 data-id="heading-19">ä¹ã€å¸¸ç”¨ç®¡ç†å‘½ä»¤æ±‡æ€»</h2>
<pre><code class="hljs language-bash" lang="bash">pm2 start app.js
pm2 stop my-app
pm2 restart my-app
pm2 reload my-app
pm2 delete my-app
pm2 list
pm2 logs my-app
pm2 monit
</code></pre>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>restart</code> ä¼šä¸­æ–­æœåŠ¡</li>
<li><code>reload</code> æ”¯æŒé›¶åœæœºé‡å¯ï¼ˆcluster æ¨¡å¼ä¸‹ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-20">åã€ç”Ÿäº§ç¯å¢ƒå®æˆ˜å»ºè®®</h2>
<p>åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œä½¿ç”¨ PM2 ç®¡ç† Node.js åº”ç”¨æ—¶ï¼Œå»ºè®®éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨ ecosystem é…ç½®æ–‡ä»¶
ç»Ÿä¸€ç®¡ç†å‚æ•°ï¼Œé¿å…å‘½ä»¤è¿‡é•¿ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ cluster æ¨¡å¼
å……åˆ†åˆ©ç”¨å¤šæ ¸ CPUï¼Œæé«˜å¹¶å‘èƒ½åŠ›ã€‚</p>
</li>
<li>
<p>å¼€å¯æ—¥å¿—åˆ‡å‰²
é˜²æ­¢ç£ç›˜è¢«æ—¥å¿—æ’‘æ»¡ã€‚</p>
</li>
<li>
<p>é…åˆ Nginx ä½¿ç”¨
è®© Nginx è´Ÿè´£åå‘ä»£ç†ä¸ HTTPSã€‚</p>
</li>
<li>
<p>é…åˆ CI/CD
å®ç°è‡ªåŠ¨éƒ¨ç½²ä¸å¹³æ»‘é‡å¯ã€‚</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-21">åä¸€ã€æ€»ç»“</h2>
<p>åœ¨ Node.js åº”ç”¨éƒ¨ç½²é˜¶æ®µï¼Œ<strong>PM2 æ˜¯ä¸å¯æˆ–ç¼ºçš„åŸºç¡€è®¾æ–½å·¥å…·</strong>ã€‚å®ƒè§£å†³äº†è¿›ç¨‹å®ˆæŠ¤ã€è‡ªåŠ¨é‡å¯ã€æ—¥å¿—ç®¡ç†ã€å¤šå®ä¾‹éƒ¨ç½²ç­‰ä¸€ç³»åˆ—ç”Ÿäº§ç¯å¢ƒæ ¸å¿ƒé—®é¢˜ã€‚</p>
<p>é€šè¿‡åˆç†ä½¿ç”¨ PM2ï¼Œä½ å¯ä»¥è·å¾—ï¼š</p>
<ul>
<li>ç¨³å®šçš„æœåŠ¡è¿è¡Œç¯å¢ƒ</li>
<li>è‡ªåŠ¨å®¹ç¾èƒ½åŠ›</li>
<li>æ›´é«˜çš„å¹¶å‘å¤„ç†èƒ½åŠ›</li>
<li>å¯è§‚æµ‹çš„è¿›ç¨‹çŠ¶æ€</li>
</ul>
<p>åœ¨ã€ŠNode.js ç¼–ç¨‹å®æˆ˜ã€‹ç³»åˆ—ä¸­ï¼ŒPM2 æ˜¯ä»â€œå¼€å‘æ€â€è¿ˆå‘â€œç”Ÿäº§æ€â€çš„å…³é”®ä¸€æ­¥ï¼Œä¸ºåç»­çš„ Nginx éƒ¨ç½²ã€HTTPS é…ç½®ä¸é«˜å¯ç”¨æ¶æ„æ‰“ä¸‹äº†åšå®åŸºç¡€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å·§å¦™åˆ©ç”¨RabbitMQå¸¸è§äº¤æ¢æœºä¸é˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯ï¼Œè§£å†³å¼‚æ­¥é€šä¿¡ã€å‰Šå³°å¡«è°·ã€å¹¿æ’­é€šçŸ¥ã€å®šæ—¶ä»»åŠ¡ç­‰é—®é¢˜]]></title>    <link>https://juejin.cn/post/7598818096729456678</link>    <guid>https://juejin.cn/post/7598818096729456678</guid>    <pubDate>2026-01-24T12:48:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598818096729456678" data-draft-id="7598477092197335078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å·§å¦™åˆ©ç”¨RabbitMQå¸¸è§äº¤æ¢æœºä¸é˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯ï¼Œè§£å†³å¼‚æ­¥é€šä¿¡ã€å‰Šå³°å¡«è°·ã€å¹¿æ’­é€šçŸ¥ã€å®šæ—¶ä»»åŠ¡ç­‰é—®é¢˜"/> <meta itemprop="keywords" content="åç«¯,RabbitMQ"/> <meta itemprop="datePublished" content="2026-01-24T12:48:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰æ°´ä¸æ»´"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å·§å¦™åˆ©ç”¨RabbitMQå¸¸è§äº¤æ¢æœºä¸é˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯ï¼Œè§£å†³å¼‚æ­¥é€šä¿¡ã€å‰Šå³°å¡«è°·ã€å¹¿æ’­é€šçŸ¥ã€å®šæ—¶ä»»åŠ¡ç­‰é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰æ°´ä¸æ»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T12:48:54.000Z" title="Sat Jan 24 2026 12:48:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RabbitMQå…¨é¢å®æˆ˜ï¼šäº¤æ¢æœºã€é˜Ÿåˆ—ã€åœºæ™¯è½åœ°ä¸æºç å®ç°</h2>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯ä¸­é—´ä»¶æ˜¯å®ç°å¼‚æ­¥é€šä¿¡ã€è§£è€¦æœåŠ¡ã€å‰Šå³°å¡«è°·çš„æ ¸å¿ƒç»„ä»¶ã€‚è€Œ RabbitMQ ä½œä¸ºåŸºäº AMQPï¼ˆé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰çš„å¼€æºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå‡­å€Ÿå…¶çµæ´»çš„è·¯ç”±æœºåˆ¶ã€å¯é çš„æ¶ˆæ¯æŠ•é€’ã€ä¸°å¯Œçš„åŠŸèƒ½ç‰¹æ€§ï¼Œæˆä¸ºä¼ä¸šçº§åº”ç”¨çš„é¦–é€‰ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒæ¦‚å¿µå‡ºå‘ï¼Œè¯¦ç»†æ‹†è§£ RabbitMQ çš„å¤šç§äº¤æ¢æœºã€é˜Ÿåˆ—ç±»å‹ï¼Œç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯æä¾›è§£å†³æ–¹æ¡ˆï¼Œå¹¶é™„ä¸Šå¯ç›´æ¥å¤ç”¨çš„ SpringBoot æ•´åˆæºç ï¼ŒåŠ©åŠ›å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹å¹¶è½åœ°ç”Ÿäº§ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€RabbitMQ æ ¸å¿ƒä»·å€¼ä¸æ ¸å¿ƒæ¦‚å¿µ</h3>
<h4 data-id="heading-2">1.1 ä¸ºä»€ä¹ˆé€‰æ‹© RabbitMQï¼Ÿ</h4>
<ul>
<li><strong>å¼‚æ­¥è§£è€¦</strong>ï¼šæ‰“ç ´æœåŠ¡é—´åŒæ­¥ä¾èµ–ï¼Œæ¯”å¦‚è®¢å•ç³»ç»Ÿæ— éœ€ç­‰å¾…æ”¯ä»˜ç³»ç»Ÿå“åº”å³å¯å®Œæˆä¸‹å•ï¼Œé€šè¿‡æ¶ˆæ¯å¼‚æ­¥é€šçŸ¥åç»­æµç¨‹ï¼›</li>
<li><strong>å‰Šå³°å¡«è°·</strong>ï¼šåº”å¯¹é«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚ç§’æ€ã€ä¿ƒé”€ï¼‰ï¼Œå°†çªå‘æµé‡ç¼“å­˜åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…æŒ‰èƒ½åŠ›å¹³æ»‘å¤„ç†ï¼Œé¿å…æœåŠ¡é›ªå´©ï¼›</li>
<li><strong>å¯é æŠ•é€’</strong>ï¼šæ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ã€ç”Ÿäº§è€…ç¡®è®¤ã€æ¶ˆè´¹è€… ACKã€æ­»ä¿¡é˜Ÿåˆ—ç­‰æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ã€ä¸é‡å¤ï¼›</li>
<li><strong>çµæ´»è·¯ç”±</strong>ï¼šé€šè¿‡å¤šç§äº¤æ¢æœºå®ç°å¤æ‚è·¯ç”±è§„åˆ™ï¼Œæ»¡è¶³å¹¿æ’­ã€ç²¾å‡†åŒ¹é…ã€æ¨¡ç³ŠåŒ¹é…ç­‰ä¸åŒéœ€æ±‚ï¼›</li>
<li><strong>å¤šè¯­è¨€æ”¯æŒ</strong>ï¼šå…¼å®¹ Javaã€Pythonã€Go ç­‰å¤šç§è¯­è¨€ï¼Œé€‚é…å¼‚æ„ç³»ç»Ÿé›†æˆã€‚</li>
</ul>
<h4 data-id="heading-3">1.2 æ ¸å¿ƒæ¦‚å¿µé€Ÿé€š</h4>
<p>åœ¨æ·±å…¥å®æˆ˜å‰ï¼Œéœ€å…ˆæŒæ¡ 5 ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç†è§£æ¶ˆæ¯æµè½¬é“¾è·¯ï¼š</p>
<ul>
<li><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong> ï¼šå‘é€æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºï¼›</li>
<li><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong> ï¼šæ¥æ”¶å¹¶å¤„ç†æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºï¼›</li>
<li><strong>äº¤æ¢æœºï¼ˆExchangeï¼‰</strong> ï¼šæ¥æ”¶ç”Ÿäº§è€…æ¶ˆæ¯ï¼Œæ ¹æ®è·¯ç”±è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±åˆ°ç»‘å®šçš„é˜Ÿåˆ—ï¼ˆæ ¸å¿ƒè·¯ç”±ç»„ä»¶ï¼Œä¸å­˜å‚¨æ¶ˆæ¯ï¼‰ï¼›</li>
<li><strong>é˜Ÿåˆ—ï¼ˆQueueï¼‰</strong> ï¼šå­˜å‚¨æ¶ˆæ¯çš„å®¹å™¨ï¼Œä¸æ¶ˆè´¹è€…ç»‘å®šï¼ŒæŒ‰é¡ºåºæŠ•é€’æ¶ˆæ¯ï¼›</li>
<li><strong>ç»‘å®šï¼ˆBindingï¼‰</strong> ï¼šå°†äº¤æ¢æœºä¸é˜Ÿåˆ—å…³è”ï¼ŒåŒæ—¶æŒ‡å®šã€Œç»‘å®šé”®ï¼ˆBinding Keyï¼‰ã€ï¼Œäº¤æ¢æœºæ ¹æ®ã€Œè·¯ç”±é”®ï¼ˆRouting Keyï¼‰ã€ä¸ç»‘å®šé”®çš„åŒ¹é…è§„åˆ™è·¯ç”±æ¶ˆæ¯ï¼›</li>
<li><strong>è™šæ‹Ÿä¸»æœºï¼ˆVirtual Hostï¼‰</strong> ï¼šéš”ç¦»ä¸åŒç¯å¢ƒçš„èµ„æºï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ï¼‰ï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºæœ‰ç‹¬ç«‹çš„äº¤æ¢æœºã€é˜Ÿåˆ—ã€ç”¨æˆ·æƒé™ã€‚</li>
</ul>
<p>æ¶ˆæ¯æµè½¬é“¾è·¯ï¼šç”Ÿäº§è€… â†’ äº¤æ¢æœºï¼ˆæŒ‰è·¯ç”±è§„åˆ™ï¼‰â†’ ç»‘å®šçš„é˜Ÿåˆ— â†’ æ¶ˆè´¹è€…</p>
<h3 data-id="heading-4">äºŒã€RabbitMQ å››å¤§æ ¸å¿ƒäº¤æ¢æœºï¼šç‰¹ç‚¹ã€åœºæ™¯ä¸æºç </h3>
<p>äº¤æ¢æœºæ˜¯ RabbitMQ è·¯ç”±æœºåˆ¶çš„æ ¸å¿ƒï¼Œä¸åŒäº¤æ¢æœºå¯¹åº”ä¸åŒè·¯ç”±ç­–ç•¥ã€‚ä»¥ä¸‹è¯¦è§£å››ç§å¸¸ç”¨äº¤æ¢æœºçš„ä½¿ç”¨åœºæ™¯ä¸å®æˆ˜æºç ï¼ˆåŸºäº SpringBoot 2.7.xï¼‰ã€‚</p>
<h4 data-id="heading-5">2.1 Direct äº¤æ¢æœºï¼šç²¾å‡†è·¯ç”±ï¼ˆä¸€å¯¹ä¸€åŒ¹é…ï¼‰</h4>
<h5 data-id="heading-6">æ ¸å¿ƒç‰¹ç‚¹</h5>
<ul>
<li>è·¯ç”±è§„åˆ™ï¼šæ¶ˆæ¯çš„ã€Œè·¯ç”±é”®ï¼ˆRouting Keyï¼‰ã€å¿…é¡»ä¸é˜Ÿåˆ—çš„ã€Œç»‘å®šé”®ï¼ˆBinding Keyï¼‰ã€å®Œå…¨ä¸€è‡´ï¼Œæ‰ä¼šè·¯ç”±åˆ°å¯¹åº”é˜Ÿåˆ—ï¼›</li>
<li>æœ¬è´¨ï¼šä¸€å¯¹ä¸€æˆ–å¤šå¯¹ä¸€ï¼ˆå¤šä¸ªé˜Ÿåˆ—ç»‘å®šåŒä¸€ç»‘å®šé”®ï¼‰çš„ç²¾å‡†åŒ¹é…ã€‚</li>
</ul>
<h5 data-id="heading-7">é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>å•ä¸€ç›®æ ‡è·¯ç”±ï¼šå¦‚è®¢å•æ”¯ä»˜æˆåŠŸåï¼Œä»…é€šçŸ¥è®¢å•ç³»ç»Ÿæ›´æ–°çŠ¶æ€ï¼›</li>
<li>ä»»åŠ¡åˆ†å‘ï¼šå°†ç‰¹å®šä»»åŠ¡åˆ†é…ç»™æŒ‡å®šæ¶ˆè´¹è€…å¤„ç†ï¼ˆå¦‚ä¸åŒç±»å‹çš„ä»»åŠ¡è·¯ç”±åˆ°ä¸åŒæ¶ˆè´¹è€…é˜Ÿåˆ—ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-8">å®æˆ˜æºç </h5>
<h6 data-id="heading-9">1. ä¾èµ–é…ç½®ï¼ˆpom.xmlï¼‰</h6>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- RabbitMQ æ ¸å¿ƒä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h6 data-id="heading-10">2. é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h6>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span>
    <span class="hljs-attr">publisher-confirm-type:</span> <span class="hljs-string">correlated</span> <span class="hljs-comment"># ç”Ÿäº§è€…ç¡®è®¤</span>
    <span class="hljs-attr">publisher-returns:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># æ¶ˆæ¯è¿”å›å›è°ƒ</span>
    <span class="hljs-attr">listener:</span>
      <span class="hljs-attr">simple:</span>
        <span class="hljs-attr">acknowledge-mode:</span> <span class="hljs-string">manual</span> <span class="hljs-comment"># æ‰‹åŠ¨ACK</span>
        <span class="hljs-attr">concurrency:</span> <span class="hljs-number">3</span>
        <span class="hljs-attr">max-concurrency:</span> <span class="hljs-number">5</span>
</code></pre>
<h6 data-id="heading-11">3. äº¤æ¢æœºä¸é˜Ÿåˆ—é…ç½®</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectExchangeConfig</span> {
    <span class="hljs-comment">// äº¤æ¢æœºåç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DIRECT_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"direct_order_exchange"</span>;
    <span class="hljs-comment">// è®¢å•çŠ¶æ€æ›´æ–°é˜Ÿåˆ—</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_STATUS_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order_status_queue"</span>;
    <span class="hljs-comment">// æ”¯ä»˜é€šçŸ¥é˜Ÿåˆ—</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PAY_NOTIFY_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"pay_notify_queue"</span>;
    <span class="hljs-comment">// ç»‘å®šé”®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_STATUS_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.status.update"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PAY_NOTIFY_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"pay.notify.send"</span>;

    <span class="hljs-comment">// 1. å£°æ˜ Direct äº¤æ¢æœº</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">directOrderExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// durable: æŒä¹…åŒ–ï¼›autoDelete: æ— ç»‘å®šåè‡ªåŠ¨åˆ é™¤ï¼›internal: æ˜¯å¦å†…éƒ¨äº¤æ¢æœºï¼ˆä¸€èˆ¬ä¸ºfalseï¼‰</span>
        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(DIRECT_EXCHANGE_NAME)
                .durable(<span class="hljs-literal">true</span>)
                .autoDelete(<span class="hljs-literal">false</span>)
                .internal(<span class="hljs-literal">false</span>)
                .build();
    }

    <span class="hljs-comment">// 2. å£°æ˜é˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">orderStatusQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// durable: æŒä¹…åŒ–ï¼›exclusive: æ’ä»–é˜Ÿåˆ—ï¼ˆä»…å½“å‰è¿æ¥å¯ç”¨ï¼‰ï¼›autoDelete: æ— æ¶ˆè´¹è€…åè‡ªåŠ¨åˆ é™¤</span>
        <span class="hljs-keyword">return</span> QueueBuilder.durable(ORDER_STATUS_QUEUE)
                .exclusive(<span class="hljs-literal">false</span>)
                .autoDelete(<span class="hljs-literal">false</span>)
                .build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">payNotifyQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(PAY_NOTIFY_QUEUE)
                .exclusive(<span class="hljs-literal">false</span>)
                .autoDelete(<span class="hljs-literal">false</span>)
                .build();
    }

    <span class="hljs-comment">// 3. ç»‘å®šäº¤æ¢æœºä¸é˜Ÿåˆ—ï¼ˆæŒ‡å®šç»‘å®šé”®ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">orderStatusBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(orderStatusQueue())
                .to(directOrderExchange())
                .with(ORDER_STATUS_ROUTING_KEY);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">payNotifyBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(payNotifyQueue())
                .to(directOrderExchange())
                .with(PAY_NOTIFY_ROUTING_KEY);
    }
}
</code></pre>
<h6 data-id="heading-12">4. ç”Ÿäº§è€…ï¼ˆæ¶ˆæ¯å‘é€ï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectProducer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-comment">/**
     * å‘é€è®¢å•çŠ¶æ€æ›´æ–°æ¶ˆæ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOrderStatusMessage</span><span class="hljs-params">(Long orderId, String status)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"è®¢å•[%s]çŠ¶æ€æ›´æ–°ä¸ºï¼š%s"</span>, orderId, status);
        <span class="hljs-comment">// å‘é€æ¶ˆæ¯ï¼šäº¤æ¢æœºåç§° + è·¯ç”±é”® + æ¶ˆæ¯å†…å®¹</span>
        rabbitTemplate.convertAndSend(
                DirectExchangeConfig.DIRECT_EXCHANGE_NAME,
                DirectExchangeConfig.ORDER_STATUS_ROUTING_KEY,
                message,
                correlationData -&gt; {
                    correlationData.setId(orderId.toString()); <span class="hljs-comment">// å…³è”IDï¼ˆç”¨äºç”Ÿäº§è€…ç¡®è®¤ï¼‰</span>
                    <span class="hljs-keyword">return</span> correlationData;
                }
        );
        log.info(<span class="hljs-string">"Directäº¤æ¢æœºå‘é€è®¢å•çŠ¶æ€æ¶ˆæ¯æˆåŠŸï¼š{}"</span>, message);
    }

    <span class="hljs-comment">/**
     * å‘é€æ”¯ä»˜é€šçŸ¥æ¶ˆæ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendPayNotifyMessage</span><span class="hljs-params">(Long orderId, String payType)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"è®¢å•[%s]é€šè¿‡%sæ”¯ä»˜æˆåŠŸï¼Œå·²å‘é€é€šçŸ¥"</span>, orderId, payType);
        rabbitTemplate.convertAndSend(
                DirectExchangeConfig.DIRECT_EXCHANGE_NAME,
                DirectExchangeConfig.PAY_NOTIFY_ROUTING_KEY,
                message,
                correlationData -&gt; {
                    correlationData.setId(orderId.toString());
                    <span class="hljs-keyword">return</span> correlationData;
                }
        );
        log.info(<span class="hljs-string">"Directäº¤æ¢æœºå‘é€æ”¯ä»˜é€šçŸ¥æ¶ˆæ¯æˆåŠŸï¼š{}"</span>, message);
    }
}
</code></pre>
<h6 data-id="heading-13">5. æ¶ˆè´¹è€…ï¼ˆæ¶ˆæ¯æ¥æ”¶ï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.amqp.support.AmqpHeaders;
<span class="hljs-keyword">import</span> org.springframework.messaging.handler.annotation.Header;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectConsumer</span> {

    <span class="hljs-comment">/**
     * æ¶ˆè´¹è®¢å•çŠ¶æ€æ›´æ–°æ¶ˆæ¯
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = DirectExchangeConfig.ORDER_STATUS_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeOrderStatusMessage</span><span class="hljs-params">(String message, Channel channel,
                                          <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"æ¥æ”¶è®¢å•çŠ¶æ€æ¶ˆæ¯ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†ï¼šæ›´æ–°è®¢å•çŠ¶æ€åˆ°æ•°æ®åº“</span>
            <span class="hljs-comment">// orderService.updateStatus(orderId, status);</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>); <span class="hljs-comment">// æ‰‹åŠ¨ACKç¡®è®¤æ¶ˆè´¹æˆåŠŸ</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹è®¢å•çŠ¶æ€æ¶ˆæ¯å¤±è´¥"</span>, e);
            <span class="hljs-comment">// æ¶ˆè´¹å¤±è´¥ï¼Œé‡æ–°å…¥é˜Ÿï¼ˆæœ€å¤šé‡è¯•3æ¬¡ï¼Œå¯ç»“åˆæ­»ä¿¡é˜Ÿåˆ—ä¼˜åŒ–ï¼‰</span>
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }
    }

    <span class="hljs-comment">/**
     * æ¶ˆè´¹æ”¯ä»˜é€šçŸ¥æ¶ˆæ¯
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = DirectExchangeConfig.PAY_NOTIFY_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumePayNotifyMessage</span><span class="hljs-params">(String message, Channel channel,
                                        <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"æ¥æ”¶æ”¯ä»˜é€šçŸ¥æ¶ˆæ¯ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†ï¼šå‘é€çŸ­ä¿¡/é‚®ä»¶é€šçŸ¥ç”¨æˆ·</span>
            <span class="hljs-comment">// notifyService.sendSms(message);</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹æ”¯ä»˜é€šçŸ¥æ¶ˆæ¯å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }
    }
}
</code></pre>
<h6 data-id="heading-14">6. æµ‹è¯•æ¥å£</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectTestController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DirectProducer directProducer;

    <span class="hljs-meta">@GetMapping("/direct/sendOrderStatus")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendOrderStatus</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Long orderId, <span class="hljs-meta">@RequestParam</span> String status)</span> {
        directProducer.sendOrderStatusMessage(orderId, status);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"è®¢å•çŠ¶æ€æ¶ˆæ¯å‘é€æˆåŠŸ"</span>;
    }

    <span class="hljs-meta">@GetMapping("/direct/sendPayNotify")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendPayNotify</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Long orderId, <span class="hljs-meta">@RequestParam</span> String payType)</span> {
        directProducer.sendPayNotifyMessage(orderId, payType);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ”¯ä»˜é€šçŸ¥æ¶ˆæ¯å‘é€æˆåŠŸ"</span>;
    }
}
</code></pre>
<h4 data-id="heading-15">2.2 Topic äº¤æ¢æœºï¼šæ¨¡ç³Šè·¯ç”±ï¼ˆå¤šæ¡ä»¶åŒ¹é…ï¼‰</h4>
<h5 data-id="heading-16">æ ¸å¿ƒç‰¹ç‚¹</h5>
<ul>
<li>è·¯ç”±è§„åˆ™ï¼šæ”¯æŒé€šé…ç¬¦åŒ¹é…ï¼Œè·¯ç”±é”®å’Œç»‘å®šé”®é‡‡ç”¨ã€Œ.ã€åˆ†éš”çš„å¤šçº§ç»“æ„ï¼ˆå¦‚ <code>order.status.paid</code>ï¼‰ï¼›</li>
<li>é€šé…ç¬¦ï¼š<code>*</code> åŒ¹é…å•ä¸ªå±‚çº§ï¼Œ<code>#</code> åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå±‚çº§ï¼ˆå¦‚ç»‘å®šé”® <code>order.#</code> å¯åŒ¹é… <code>order.status</code>ã€<code>order.status.paid</code>ï¼‰ï¼›</li>
<li>æœ¬è´¨ï¼šå¤šå¯¹å¤šçš„æ¨¡ç³ŠåŒ¹é…ï¼Œçµæ´»æ€§æœ€é«˜ã€‚</li>
</ul>
<h5 data-id="heading-17">é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>å¤šçº§åˆ†ç±»è·¯ç”±ï¼šå¦‚å•†å“æ¶ˆæ¯æŒ‰ã€Œå“ç±»ã€‚æ“ä½œã€è·¯ç”±ï¼ˆ<code>electronics.add</code>ã€<code>clothes.update</code>ï¼‰ï¼›</li>
<li>æ‰¹é‡é€šçŸ¥ï¼šå¦‚é€šçŸ¥æŸç±»ç”¨æˆ·çš„æ‰€æœ‰å­ç³»ç»Ÿï¼ˆ<code>user.#</code> åŒ¹é…ç”¨æˆ·ç›¸å…³çš„æ‰€æœ‰æ¶ˆæ¯ï¼‰ï¼›</li>
<li>æ—¥å¿—åˆ†çº§è·¯ç”±ï¼šå¦‚æ—¥å¿—æŒ‰ã€Œç³»ç»Ÿã€‚çº§åˆ«ã€è·¯ç”±ï¼ˆ<code>order.info</code>ã€<code>pay.error</code>ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-18">å®æˆ˜æºç </h5>
<h6 data-id="heading-19">1. äº¤æ¢æœºä¸é˜Ÿåˆ—é…ç½®</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TopicExchangeConfig</span> {
    <span class="hljs-comment">// äº¤æ¢æœºåç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOPIC_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"topic_log_exchange"</span>;
    <span class="hljs-comment">// è®¢å•æ—¥å¿—é˜Ÿåˆ—ï¼ˆåŒ¹é…orderç›¸å…³æ‰€æœ‰æ—¥å¿—ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_LOG_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order_log_queue"</span>;
    <span class="hljs-comment">// æ”¯ä»˜é”™è¯¯æ—¥å¿—é˜Ÿåˆ—ï¼ˆä»…åŒ¹é…payçš„erroræ—¥å¿—ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PAY_ERROR_LOG_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"pay_error_log_queue"</span>;
    <span class="hljs-comment">// ç»‘å®šé”®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ORDER_LOG_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.#"</span>; <span class="hljs-comment">// åŒ¹é…orderå¼€å¤´çš„æ‰€æœ‰è·¯ç”±é”®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PAY_ERROR_LOG_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"pay.*.error"</span>; <span class="hljs-comment">// åŒ¹é…pay.xxx.error</span>

    <span class="hljs-comment">// 1. å£°æ˜ Topic äº¤æ¢æœº</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> TopicExchange <span class="hljs-title function_">topicLogExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ExchangeBuilder.topicExchange(TOPIC_EXCHANGE_NAME)
                .durable(<span class="hljs-literal">true</span>)
                .autoDelete(<span class="hljs-literal">false</span>)
                .build();
    }

    <span class="hljs-comment">// 2. å£°æ˜é˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">orderLogQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(ORDER_LOG_QUEUE).build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">payErrorLogQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(PAY_ERROR_LOG_QUEUE).build();
    }

    <span class="hljs-comment">// 3. ç»‘å®š</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">orderLogBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(orderLogQueue()).to(topicLogExchange()).with(ORDER_LOG_ROUTING_KEY);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">payErrorLogBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(payErrorLogQueue()).to(topicLogExchange()).with(PAY_ERROR_LOG_ROUTING_KEY);
    }
}
</code></pre>
<h6 data-id="heading-20">2. ç”Ÿäº§è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TopicProducer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-comment">/**
     * å‘é€æ—¥å¿—æ¶ˆæ¯
     * <span class="hljs-doctag">@param</span> routingKey è·¯ç”±é”®ï¼ˆå¦‚order.infoã€pay.system.errorï¼‰
     * <span class="hljs-doctag">@param</span> logContent æ—¥å¿—å†…å®¹
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendLog</span><span class="hljs-params">(String routingKey, String logContent)</span> {
        rabbitTemplate.convertAndSend(
                TopicExchangeConfig.TOPIC_EXCHANGE_NAME,
                routingKey,
                logContent,
                correlationData -&gt; {
                    correlationData.setId(System.currentTimeMillis() + <span class="hljs-string">""</span>);
                    <span class="hljs-keyword">return</span> correlationData;
                }
        );
        log.info(<span class="hljs-string">"Topicäº¤æ¢æœºå‘é€æ—¥å¿—æ¶ˆæ¯ï¼šroutingKey={}, content={}"</span>, routingKey, logContent);
    }
}
</code></pre>
<h6 data-id="heading-21">3. æ¶ˆè´¹è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.amqp.support.AmqpHeaders;
<span class="hljs-keyword">import</span> org.springframework.messaging.handler.annotation.Header;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TopicConsumer</span> {

    <span class="hljs-comment">/**
     * æ¶ˆè´¹è®¢å•ç›¸å…³æ‰€æœ‰æ—¥å¿—
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = TopicExchangeConfig.ORDER_LOG_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeOrderLog</span><span class="hljs-params">(String message, Channel channel,
                                <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"ã€è®¢å•æ—¥å¿—ã€‘æ¥æ”¶æ¶ˆæ¯ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šå­˜å‚¨è®¢å•æ—¥å¿—åˆ°æ•°æ®åº“</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹è®¢å•æ—¥å¿—å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// å¤±è´¥ä¸é‡æ–°å…¥é˜Ÿï¼Œåç»­å¯ç»“åˆæ­»ä¿¡é˜Ÿåˆ—</span>
        }
    }

    <span class="hljs-comment">/**
     * æ¶ˆè´¹æ”¯ä»˜é”™è¯¯æ—¥å¿—
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = TopicExchangeConfig.PAY_ERROR_LOG_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumePayErrorLog</span><span class="hljs-params">(String message, Channel channel,
                                   <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"ã€æ”¯ä»˜é”™è¯¯æ—¥å¿—ã€‘æ¥æ”¶æ¶ˆæ¯ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šå‘é€å‘Šè­¦é€šçŸ¥è¿ç»´äººå‘˜</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹æ”¯ä»˜é”™è¯¯æ—¥å¿—å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
        }
    }
}
</code></pre>
<h6 data-id="heading-22">4. æµ‹è¯•æ¥å£</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TopicTestController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TopicProducer topicProducer;

    <span class="hljs-meta">@GetMapping("/topic/sendLog")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendLog</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String routingKey, <span class="hljs-meta">@RequestParam</span> String logContent)</span> {
        topicProducer.sendLog(routingKey, logContent);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ—¥å¿—æ¶ˆæ¯å‘é€æˆåŠŸ"</span>;
    }
}
</code></pre>
<h4 data-id="heading-23">2.3 Fanout äº¤æ¢æœºï¼šå¹¿æ’­è·¯ç”±ï¼ˆæ— å·®åˆ«åˆ†å‘ï¼‰</h4>
<h5 data-id="heading-24">æ ¸å¿ƒç‰¹ç‚¹</h5>
<ul>
<li>è·¯ç”±è§„åˆ™ï¼šå¿½ç•¥è·¯ç”±é”®å’Œç»‘å®šé”®ï¼Œå°†æ¶ˆæ¯å¹¿æ’­åˆ°æ‰€æœ‰ä¸è¯¥äº¤æ¢æœºç»‘å®šçš„é˜Ÿåˆ—ï¼›</li>
<li>æœ¬è´¨ï¼šä¸€å¯¹å¤šçš„æ— å·®åˆ«åˆ†å‘ï¼Œæ¶ˆæ¯å‘é€æ•ˆç‡æœ€é«˜ï¼ˆæ— éœ€è·¯ç”±åŒ¹é…ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-25">é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>ç³»ç»Ÿå…¬å‘Šï¼šå¦‚å¹³å°å‘å¸ƒå…¨å±€é€šçŸ¥ï¼Œæ‰€æœ‰æœåŠ¡éƒ½éœ€æ¥æ”¶ï¼›</li>
<li>æ•°æ®åŒæ­¥ï¼šå¦‚ç”¨æˆ·ä¿¡æ¯æ›´æ–°åï¼ŒåŒæ­¥åˆ°ç¼“å­˜ã€æœç´¢ã€ç»Ÿè®¡ç­‰å¤šä¸ªå­ç³»ç»Ÿï¼›</li>
<li>æ—¥å¿—æ”¶é›†ï¼šå¦‚å°†åº”ç”¨æ—¥å¿—åŒæ—¶å‘é€åˆ°æ—¥å¿—å­˜å‚¨ã€ç›‘æ§å‘Šè­¦ã€å®æ—¶åˆ†æç­‰é˜Ÿåˆ—ã€‚</li>
</ul>
<h5 data-id="heading-26">å®æˆ˜æºç </h5>
<h6 data-id="heading-27">1. äº¤æ¢æœºä¸é˜Ÿåˆ—é…ç½®</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FanoutExchangeConfig</span> {
    <span class="hljs-comment">// äº¤æ¢æœºåç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FANOUT_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"fanout_notice_exchange"</span>;
    <span class="hljs-comment">// ç¼“å­˜åŒæ­¥é˜Ÿåˆ—</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CACHE_SYNC_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"cache_sync_queue"</span>;
    <span class="hljs-comment">// æœç´¢åŒæ­¥é˜Ÿåˆ—</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SEARCH_SYNC_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"search_sync_queue"</span>;
    <span class="hljs-comment">// ç»Ÿè®¡åŒæ­¥é˜Ÿåˆ—</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">STATISTICS_SYNC_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"statistics_sync_queue"</span>;

    <span class="hljs-comment">// 1. å£°æ˜ Fanout äº¤æ¢æœº</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> FanoutExchange <span class="hljs-title function_">fanoutNoticeExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ExchangeBuilder.fanoutExchange(FANOUT_EXCHANGE_NAME)
                .durable(<span class="hljs-literal">true</span>)
                .autoDelete(<span class="hljs-literal">false</span>)
                .build();
    }

    <span class="hljs-comment">// 2. å£°æ˜é˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">cacheSyncQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(CACHE_SYNC_QUEUE).build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">searchSyncQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(SEARCH_SYNC_QUEUE).build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">statisticsSyncQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(STATISTICS_SYNC_QUEUE).build();
    }

    <span class="hljs-comment">// 3. ç»‘å®šï¼ˆFanoutäº¤æ¢æœºæ— éœ€æŒ‡å®šç»‘å®šé”®ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">cacheSyncBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(cacheSyncQueue()).to(fanoutNoticeExchange());
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">searchSyncBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(searchSyncQueue()).to(fanoutNoticeExchange());
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">statisticsSyncBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(statisticsSyncQueue()).to(fanoutNoticeExchange());
    }
}
</code></pre>
<h6 data-id="heading-28">2. ç”Ÿäº§è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FanoutProducer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-comment">/**
     * å‘é€ç”¨æˆ·ä¿¡æ¯åŒæ­¥é€šçŸ¥ï¼ˆå¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šé˜Ÿåˆ—ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendUserSyncNotice</span><span class="hljs-params">(Long userId, String userName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"ç”¨æˆ·ä¿¡æ¯æ›´æ–°ï¼šuserId=%s, userName=%s"</span>, userId, userName);
        <span class="hljs-comment">// Fanoutäº¤æ¢æœºæ— éœ€æŒ‡å®šè·¯ç”±é”®ï¼ˆä¼ ç©ºå­—ç¬¦ä¸²å³å¯ï¼‰</span>
        rabbitTemplate.convertAndSend(
                FanoutExchangeConfig.FANOUT_EXCHANGE_NAME,
                <span class="hljs-string">""</span>,
                message,
                correlationData -&gt; {
                    correlationData.setId(userId.toString());
                    <span class="hljs-keyword">return</span> correlationData;
                }
        );
        log.info(<span class="hljs-string">"Fanoutäº¤æ¢æœºå‘é€ç”¨æˆ·åŒæ­¥é€šçŸ¥ï¼š{}"</span>, message);
    }
}
</code></pre>
<h6 data-id="heading-29">3. æ¶ˆè´¹è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.amqp.support.AmqpHeaders;
<span class="hljs-keyword">import</span> org.springframework.messaging.handler.annotation.Header;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FanoutConsumer</span> {

    <span class="hljs-comment">/**
     * ç¼“å­˜åŒæ­¥æ¶ˆè´¹
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = FanoutExchangeConfig.CACHE_SYNC_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeCacheSync</span><span class="hljs-params">(String message, Channel channel,
                                 <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"ã€ç¼“å­˜åŒæ­¥ã€‘æ¥æ”¶æ¶ˆæ¯ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šæ›´æ–°Redisç¼“å­˜ä¸­çš„ç”¨æˆ·ä¿¡æ¯</span>
            <span class="hljs-comment">// redisService.set("user:" + userId, userInfo);</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ç¼“å­˜åŒæ­¥å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }
    }

    <span class="hljs-comment">/**
     * æœç´¢åŒæ­¥æ¶ˆè´¹
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = FanoutExchangeConfig.SEARCH_SYNC_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeSearchSync</span><span class="hljs-params">(String message, Channel channel,
                                  <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"ã€æœç´¢åŒæ­¥ã€‘æ¥æ”¶æ¶ˆæ¯ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šæ›´æ–°Elasticsearchä¸­çš„ç”¨æˆ·ç´¢å¼•</span>
            <span class="hljs-comment">// esService.updateUserIndex(userId, userInfo);</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æœç´¢åŒæ­¥å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }
    }

    <span class="hljs-comment">/**
     * ç»Ÿè®¡åŒæ­¥æ¶ˆè´¹
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = FanoutExchangeConfig.STATISTICS_SYNC_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeStatisticsSync</span><span class="hljs-params">(String message, Channel channel,
                                      <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"ã€ç»Ÿè®¡åŒæ­¥ã€‘æ¥æ”¶æ¶ˆæ¯ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šæ›´æ–°ç”¨æˆ·ç»Ÿè®¡æ•°æ®</span>
            <span class="hljs-comment">// statisticsService.updateUserStat(userId);</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ç»Ÿè®¡åŒæ­¥å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }
    }
}
</code></pre>
<h6 data-id="heading-30">4. æµ‹è¯•æ¥å£</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FanoutTestController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FanoutProducer fanoutProducer;

    <span class="hljs-meta">@GetMapping("/fanout/sendUserSync")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendUserSync</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Long userId, <span class="hljs-meta">@RequestParam</span> String userName)</span> {
        fanoutProducer.sendUserSyncNotice(userId, userName);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ç”¨æˆ·åŒæ­¥é€šçŸ¥å‘é€æˆåŠŸï¼ˆæ‰€æœ‰ç»‘å®šé˜Ÿåˆ—å‡ä¼šæ¥æ”¶ï¼‰"</span>;
    }
}
</code></pre>
<h4 data-id="heading-31">2.4 Headers äº¤æ¢æœºï¼šå±æ€§è·¯ç”±ï¼ˆéè·¯ç”±é”®åŒ¹é…ï¼‰</h4>
<h5 data-id="heading-32">æ ¸å¿ƒç‰¹ç‚¹</h5>
<ul>
<li>è·¯ç”±è§„åˆ™ï¼šå¿½ç•¥è·¯ç”±é”®ï¼Œæ ¹æ®æ¶ˆæ¯çš„ã€Œheaders å±æ€§ã€åŒ¹é…é˜Ÿåˆ—çš„ç»‘å®šæ¡ä»¶ï¼ˆå¦‚ <code>x-match=all</code> è¡¨ç¤ºæ‰€æœ‰å±æ€§éƒ½åŒ¹é…ï¼Œ<code>x-match=any</code> è¡¨ç¤ºä»»æ„ä¸€ä¸ªå±æ€§åŒ¹é…ï¼‰ï¼›</li>
<li>é€‚ç”¨åœºæ™¯ï¼šæ¶ˆæ¯è·¯ç”±æ¡ä»¶ä¸é€‚åˆç”¨è·¯ç”±é”®è¡¨ç¤ºçš„åœºæ™¯ï¼ˆå¦‚å¤šç»´åº¦å±æ€§åŒ¹é…ï¼‰ï¼Œä½†å®é™…ä½¿ç”¨é¢‘ç‡ä½äºå‰ä¸‰ç§äº¤æ¢æœºã€‚</li>
</ul>
<h5 data-id="heading-33">é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>å¤šç»´åº¦è¿‡æ»¤ï¼šå¦‚æ ¹æ®ã€Œåœ°åŒº = åŒ—äº¬ã€ã€Œç»ˆç«¯ = APPã€ã€Œç‰ˆæœ¬ = V2ã€ç­‰å¤šä¸ªå±æ€§è·¯ç”±æ¶ˆæ¯ï¼›</li>
<li>å¤æ‚æ¡ä»¶è·¯ç”±ï¼šè·¯ç”±è§„åˆ™æ— æ³•é€šè¿‡ç®€å•çš„è·¯ç”±é”®é€šé…ç¬¦è¡¨è¾¾çš„åœºæ™¯ã€‚</li>
</ul>
<h5 data-id="heading-34">å®æˆ˜æºç </h5>
<h6 data-id="heading-35">1. äº¤æ¢æœºä¸é˜Ÿåˆ—é…ç½®</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadersExchangeConfig</span> {
    <span class="hljs-comment">// äº¤æ¢æœºåç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">HEADERS_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"headers_filter_exchange"</span>;
    <span class="hljs-comment">// APPç»ˆç«¯é˜Ÿåˆ—ï¼ˆåŒ¹é…åœ°åŒº=åŒ—äº¬ä¸”ç»ˆç«¯=APPï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">APP_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"app_queue"</span>;
    <span class="hljs-comment">// Webç»ˆç«¯é˜Ÿåˆ—ï¼ˆåŒ¹é…åœ°åŒº=ä¸Šæµ·æˆ–ç»ˆç«¯=Webï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">WEB_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"web_queue"</span>;

    <span class="hljs-comment">// 1. å£°æ˜ Headers äº¤æ¢æœº</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> HeadersExchange <span class="hljs-title function_">headersFilterExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ExchangeBuilder.headersExchange(HEADERS_EXCHANGE_NAME)
                .durable(<span class="hljs-literal">true</span>)
                .autoDelete(<span class="hljs-literal">false</span>)
                .build();
    }

    <span class="hljs-comment">// 2. å£°æ˜é˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">appQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(APP_QUEUE).build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">webQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(WEB_QUEUE).build();
    }

    <span class="hljs-comment">// 3. ç»‘å®šï¼šAPPé˜Ÿåˆ—ï¼ˆx-match=allï¼Œæ‰€æœ‰å±æ€§éƒ½åŒ¹é…ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">appBinding</span><span class="hljs-params">()</span> {
        Map&lt;String, Object&gt; headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        headers.put(<span class="hljs-string">"region"</span>, <span class="hljs-string">"Beijing"</span>); <span class="hljs-comment">// åœ°åŒº=åŒ—äº¬</span>
        headers.put(<span class="hljs-string">"terminal"</span>, <span class="hljs-string">"APP"</span>); <span class="hljs-comment">// ç»ˆç«¯=APP</span>
        <span class="hljs-keyword">return</span> BindingBuilder.bind(appQueue())
                .to(headersFilterExchange())
                .whereAll(headers).match(); <span class="hljs-comment">// æ‰€æœ‰å±æ€§åŒ¹é…</span>
    }

    <span class="hljs-comment">// 4. ç»‘å®šï¼šWebé˜Ÿåˆ—ï¼ˆx-match=anyï¼Œä»»æ„å±æ€§åŒ¹é…ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">webBinding</span><span class="hljs-params">()</span> {
        Map&lt;String, Object&gt; headers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        headers.put(<span class="hljs-string">"region"</span>, <span class="hljs-string">"Shanghai"</span>); <span class="hljs-comment">// åœ°åŒº=ä¸Šæµ·</span>
        headers.put(<span class="hljs-string">"terminal"</span>, <span class="hljs-string">"Web"</span>); <span class="hljs-comment">// ç»ˆç«¯=Web</span>
        <span class="hljs-keyword">return</span> BindingBuilder.bind(webQueue())
                .to(headersFilterExchange())
                .whereAny(headers).match(); <span class="hljs-comment">// ä»»æ„å±æ€§åŒ¹é…</span>
    }
}
</code></pre>
<h6 data-id="heading-36">2. ç”Ÿäº§è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.MessageProperties;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadersProducer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-comment">/**
     * å‘é€å¸¦Headerså±æ€§çš„æ¶ˆæ¯
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendHeadersMessage</span><span class="hljs-params">(String content, String region, String terminal)</span> {
        <span class="hljs-comment">// è®¾ç½®æ¶ˆæ¯Headerså±æ€§</span>
        <span class="hljs-type">MessageProperties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageProperties</span>();
        properties.setHeader(<span class="hljs-string">"region"</span>, region);
        properties.setHeader(<span class="hljs-string">"terminal"</span>, terminal);
        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(content.getBytes(), properties);

        <span class="hljs-comment">// Headersäº¤æ¢æœºæ— éœ€æŒ‡å®šè·¯ç”±é”®</span>
        rabbitTemplate.convertAndSend(
                HeadersExchangeConfig.HEADERS_EXCHANGE_NAME,
                <span class="hljs-string">""</span>,
                message,
                correlationData -&gt; {
                    correlationData.setId(System.currentTimeMillis() + <span class="hljs-string">""</span>);
                    <span class="hljs-keyword">return</span> correlationData;
                }
        );
        log.info(<span class="hljs-string">"Headersäº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼šcontent={}, region={}, terminal={}"</span>, content, region, terminal);
    }
}
</code></pre>
<h6 data-id="heading-37">3. æ¶ˆè´¹è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.amqp.support.AmqpHeaders;
<span class="hljs-keyword">import</span> org.springframework.messaging.handler.annotation.Header;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadersConsumer</span> {

    <span class="hljs-comment">/**
     * æ¶ˆè´¹APPé˜Ÿåˆ—æ¶ˆæ¯
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = HeadersExchangeConfig.APP_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeAppQueue</span><span class="hljs-params">(Message message, Channel channel,
                                <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody());
            <span class="hljs-type">String</span> <span class="hljs-variable">region</span> <span class="hljs-operator">=</span> (String) message.getMessageProperties().getHeader(<span class="hljs-string">"region"</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">terminal</span> <span class="hljs-operator">=</span> (String) message.getMessageProperties().getHeader(<span class="hljs-string">"terminal"</span>);
            log.info(<span class="hljs-string">"ã€APPé˜Ÿåˆ—ã€‘æ¥æ”¶æ¶ˆæ¯ï¼šcontent={}, region={}, terminal={}"</span>, content, region, terminal);
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹APPé˜Ÿåˆ—æ¶ˆæ¯å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }
    }

    <span class="hljs-comment">/**
     * æ¶ˆè´¹Webé˜Ÿåˆ—æ¶ˆæ¯
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = HeadersExchangeConfig.WEB_QUEUE)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeWebQueue</span><span class="hljs-params">(Message message, Channel channel,
                                <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody());
            <span class="hljs-type">String</span> <span class="hljs-variable">region</span> <span class="hljs-operator">=</span> (String) message.getMessageProperties().getHeader(<span class="hljs-string">"region"</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">terminal</span> <span class="hljs-operator">=</span> (String) message.getMessageProperties().getHeader(<span class="hljs-string">"terminal"</span>);
            log.info(<span class="hljs-string">"ã€Webé˜Ÿåˆ—ã€‘æ¥æ”¶æ¶ˆæ¯ï¼šcontent={}, region={}, terminal={}"</span>, content, region, terminal);
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹Webé˜Ÿåˆ—æ¶ˆæ¯å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }
    }
}
</code></pre>
<h6 data-id="heading-38">4. æµ‹è¯•æ¥å£</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeadersTestController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HeadersProducer headersProducer;

    <span class="hljs-meta">@GetMapping("/headers/sendMessage")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String content,
                              <span class="hljs-meta">@RequestParam</span> String region,
                              <span class="hljs-meta">@RequestParam</span> String terminal)</span> {
        headersProducer.sendHeadersMessage(content, region, terminal);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Headersæ¶ˆæ¯å‘é€æˆåŠŸ"</span>;
    }
}
</code></pre>
<h3 data-id="heading-39">ä¸‰ã€RabbitMQ å¸¸ç”¨é˜Ÿåˆ—ç±»å‹ï¼šåœºæ™¯ä¸å®ç°</h3>
<p>é™¤äº†åŸºç¡€é˜Ÿåˆ—ï¼ŒRabbitMQ æä¾›äº†å¤šç§ç‰¹æ®Šé˜Ÿåˆ—ï¼Œæ»¡è¶³å¤æ‚ä¸šåŠ¡éœ€æ±‚ã€‚ä»¥ä¸‹ä»‹ç»å››ç§æ ¸å¿ƒé˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯ä¸æºç å®ç°ã€‚</p>
<h4 data-id="heading-40">3.1 æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰ï¼šå¤±è´¥æ¶ˆæ¯å¤„ç†</h4>
<h5 data-id="heading-41">æ ¸å¿ƒæ¦‚å¿µ</h5>
<ul>
<li>æ­»ä¿¡ï¼šæ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼ˆå¦‚æ¶ˆè´¹é‡è¯•æ¬¡æ•°è€—å°½ã€æ¶ˆæ¯è¿‡æœŸã€é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼‰ï¼›</li>
<li>æ­»ä¿¡é˜Ÿåˆ—ï¼šå­˜å‚¨æ­»ä¿¡çš„é˜Ÿåˆ—ï¼Œéœ€é€šè¿‡ã€Œæ­»ä¿¡äº¤æ¢æœºï¼ˆDLXï¼‰ã€è·¯ç”±æ­»ä¿¡ï¼›</li>
<li>æ ¸å¿ƒä»·å€¼ï¼šé¿å…å¤±è´¥æ¶ˆæ¯ä¸¢å¤±ï¼Œä¾¿äºåç»­æ’æŸ¥é—®é¢˜æˆ–äººå·¥é‡è¯•ã€‚</li>
</ul>
<h5 data-id="heading-42">é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>è®¢å•æ”¯ä»˜è¶…æ—¶æœªæ”¯ä»˜ï¼ˆæ¶ˆæ¯è¿‡æœŸåè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œè§¦å‘è®¢å•å…³é—­ï¼‰ï¼›</li>
<li>æ¶ˆè´¹å¤±è´¥çš„æ¶ˆæ¯ï¼ˆé‡è¯• 3 æ¬¡åè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œé¿å…é‡å¤é‡è¯•å ç”¨èµ„æºï¼‰ï¼›</li>
<li>é˜Ÿåˆ—æ»¡äº†æ— æ³•æ¥æ”¶æ–°æ¶ˆæ¯ï¼ˆè¶…å‡ºé•¿åº¦çš„æ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-43">å®æˆ˜æºç ï¼ˆåŸºäº Direct äº¤æ¢æœºå®ç°ï¼‰</h5>
<h6 data-id="heading-44">1. é…ç½®ç±»</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadLetterQueueConfig</span> {
    <span class="hljs-comment">// æ™®é€šäº¤æ¢æœº</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"normal_order_exchange"</span>;
    <span class="hljs-comment">// æ­»ä¿¡äº¤æ¢æœº</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DLX_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"dlx_order_exchange"</span>;
    <span class="hljs-comment">// æ™®é€šé˜Ÿåˆ—ï¼ˆè®¢å•æ”¯ä»˜é˜Ÿåˆ—ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"normal_order_queue"</span>;
    <span class="hljs-comment">// æ­»ä¿¡é˜Ÿåˆ—ï¼ˆè®¢å•å…³é—­é˜Ÿåˆ—ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DLX_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"dlx_order_queue"</span>;
    <span class="hljs-comment">// ç»‘å®šé”®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">NORMAL_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.pay"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DLX_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.dlx"</span>;

    <span class="hljs-comment">// 1. å£°æ˜æ­»ä¿¡äº¤æ¢æœºï¼ˆDirectç±»å‹ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">dlxOrderExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(DLX_EXCHANGE_NAME).durable(<span class="hljs-literal">true</span>).build();
    }

    <span class="hljs-comment">// 2. å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">dlxOrderQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(DLX_QUEUE_NAME).build();
    }

    <span class="hljs-comment">// 3. ç»‘å®šæ­»ä¿¡äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">dlxBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(dlxOrderQueue()).to(dlxOrderExchange()).with(DLX_ROUTING_KEY);
    }

    <span class="hljs-comment">// 4. å£°æ˜æ™®é€šé˜Ÿåˆ—ï¼ˆé…ç½®æ­»ä¿¡ç›¸å…³å‚æ•°ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">normalOrderQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(NORMAL_QUEUE_NAME)
                .withArgument(<span class="hljs-string">"x-dead-letter-exchange"</span>, DLX_EXCHANGE_NAME) <span class="hljs-comment">// ç»‘å®šæ­»ä¿¡äº¤æ¢æœº</span>
                .withArgument(<span class="hljs-string">"x-dead-letter-routing-key"</span>, DLX_ROUTING_KEY) <span class="hljs-comment">// æ­»ä¿¡è·¯ç”±é”®</span>
                .withArgument(<span class="hljs-string">"x-message-ttl"</span>, <span class="hljs-number">60000</span>) <span class="hljs-comment">// æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼ˆ1åˆ†é’Ÿï¼‰</span>
                .withArgument(<span class="hljs-string">"x-max-length"</span>, <span class="hljs-number">1000</span>) <span class="hljs-comment">// é˜Ÿåˆ—æœ€å¤§é•¿åº¦ï¼ˆ1000æ¡ï¼‰</span>
                .build();
    }

    <span class="hljs-comment">// 5. å£°æ˜æ™®é€šäº¤æ¢æœº</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">normalOrderExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(NORMAL_EXCHANGE_NAME).durable(<span class="hljs-literal">true</span>).build();
    }

    <span class="hljs-comment">// 6. ç»‘å®šæ™®é€šäº¤æ¢æœºä¸æ™®é€šé˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">normalBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(normalOrderQueue()).to(normalOrderExchange()).with(NORMAL_ROUTING_KEY);
    }
}
</code></pre>
<h6 data-id="heading-45">2. ç”Ÿäº§è€…ï¼ˆå‘é€è®¢å•æ”¯ä»˜æ¶ˆæ¯ï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DlxProducer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendOrderPayMessage</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"è®¢å•[%s]å¾…æ”¯ä»˜ï¼Œ1åˆ†é’Ÿå†…æœªæ”¯ä»˜å°†è‡ªåŠ¨å…³é—­"</span>, orderId);
        rabbitTemplate.convertAndSend(
                DeadLetterQueueConfig.NORMAL_EXCHANGE_NAME,
                DeadLetterQueueConfig.NORMAL_ROUTING_KEY,
                message,
                correlationData -&gt; {
                    correlationData.setId(orderId.toString());
                    <span class="hljs-keyword">return</span> correlationData;
                }
        );
        log.info(<span class="hljs-string">"å‘é€è®¢å•æ”¯ä»˜æ¶ˆæ¯ï¼š{}"</span>, message);
    }
}
</code></pre>
<h6 data-id="heading-46">3. æ¶ˆè´¹è€…ï¼ˆæ™®é€šé˜Ÿåˆ—æ¶ˆè´¹ + æ­»ä¿¡é˜Ÿåˆ—æ¶ˆè´¹ï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.amqp.support.AmqpHeaders;
<span class="hljs-keyword">import</span> org.springframework.messaging.handler.annotation.Header;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DlxConsumer</span> {
    <span class="hljs-comment">// é‡è¯•æ¬¡æ•°ä¸Šé™</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRY_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

    <span class="hljs-comment">/**
     * æ¶ˆè´¹æ™®é€šé˜Ÿåˆ—ï¼ˆè®¢å•æ”¯ä»˜æ¶ˆæ¯ï¼‰
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = DeadLetterQueueConfig.NORMAL_QUEUE_NAME)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeNormalQueue</span><span class="hljs-params">(String message, Channel channel,
                                   <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag,
                                   <span class="hljs-meta">@Header(AmqpHeaders.REDELIVERED)</span> <span class="hljs-type">boolean</span> redelivered)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// è§£æè®¢å•IDï¼ˆå®é™…ä¸šåŠ¡ä¸­å¯é€šè¿‡æ¶ˆæ¯ä½“ä¼ é€’ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> message.split(<span class="hljs-string">"\["</span>)[<span class="hljs-number">1</span>].split(<span class="hljs-string">"\]"</span>)[<span class="hljs-number">0</span>];
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> redelivered ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>; <span class="hljs-comment">// é‡è¯•æ¬¡æ•°ï¼ˆredeliveredä¸ºtrueè¡¨ç¤ºé‡æ–°å…¥é˜Ÿï¼‰</span>

        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"æ¥æ”¶è®¢å•æ”¯ä»˜æ¶ˆæ¯ï¼š{}ï¼Œé‡è¯•æ¬¡æ•°ï¼š{}"</span>, message, retryCount);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šæŸ¥è¯¢è®¢å•æ”¯ä»˜çŠ¶æ€</span>
            <span class="hljs-comment">// boolean isPaid = orderService.checkPayStatus(Long.parseLong(orderId));</span>
            <span class="hljs-comment">// if (isPaid) {</span>
            <span class="hljs-comment">//     channel.basicAck(deliveryTag, false); // å·²æ”¯ä»˜ï¼Œç¡®è®¤æ¶ˆè´¹</span>
            <span class="hljs-comment">// } else {</span>
            <span class="hljs-comment">//     throw new RuntimeException("è®¢å•æœªæ”¯ä»˜ï¼Œéœ€è¦é‡è¯•");</span>
            <span class="hljs-comment">// }</span>

            <span class="hljs-comment">// æ¨¡æ‹Ÿæ¶ˆè´¹å¤±è´¥ï¼ˆå®é™…ä¸šåŠ¡ä¸­æ ¹æ®æ”¯ä»˜çŠ¶æ€åˆ¤æ–­ï¼‰</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¢å•æœªæ”¯ä»˜"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹è®¢å•æ”¯ä»˜æ¶ˆæ¯å¤±è´¥"</span>, e);
            <span class="hljs-keyword">if</span> (retryCount &gt;= MAX_RETRY_COUNT) {
                <span class="hljs-comment">// é‡è¯•æ¬¡æ•°è€—å°½ï¼Œæ‹’ç»æ¶ˆæ¯ï¼Œè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
                log.info(<span class="hljs-string">"é‡è¯•æ¬¡æ•°è€—å°½ï¼Œæ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼š{}"</span>, message);
                channel.basicReject(deliveryTag, <span class="hljs-literal">false</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// é‡æ–°å…¥é˜Ÿï¼Œé‡è¯•</span>
                channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
            }
        }
    }

    <span class="hljs-comment">/**
     * æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—ï¼ˆè®¢å•å…³é—­æ¶ˆæ¯ï¼‰
     */</span>
    <span class="hljs-meta">@RabbitListener(queues = DeadLetterQueueConfig.DLX_QUEUE_NAME)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeDlxQueue</span><span class="hljs-params">(String message, Channel channel,
                                <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"æ¥æ”¶æ­»ä¿¡æ¶ˆæ¯ï¼Œæ‰§è¡Œè®¢å•å…³é—­ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šå…³é—­è®¢å•ã€é‡Šæ”¾åº“å­˜</span>
            <span class="hljs-comment">// orderService.closeOrder(Long.parseLong(orderId));</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"å¤„ç†æ­»ä¿¡æ¶ˆæ¯å¤±è´¥"</span>, e);
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>); <span class="hljs-comment">// æ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯ä¸å†é‡è¯•ï¼Œé¿å…æ­»å¾ªç¯</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-47">3.2 å»¶è¿Ÿé˜Ÿåˆ—ï¼šå®šæ—¶ä»»åŠ¡å®ç°</h4>
<h5 data-id="heading-48">æ ¸å¿ƒæ¦‚å¿µ</h5>
<ul>
<li>
<p>å»¶è¿Ÿé˜Ÿåˆ—ï¼šæ¶ˆæ¯å‘é€åï¼Œå»¶è¿ŸæŒ‡å®šæ—¶é—´æ‰è¢«æ¶ˆè´¹çš„é˜Ÿåˆ—ï¼›</p>
</li>
<li>
<p>å®ç°æ–¹å¼ï¼š</p>
<ol>
<li>TTL + æ­»ä¿¡é˜Ÿåˆ—ï¼ˆåŸºäº RabbitMQ åŸç”ŸåŠŸèƒ½ï¼Œé€‚ç”¨äºå»¶è¿Ÿæ—¶é—´å›ºå®šçš„åœºæ™¯ï¼‰ï¼›</li>
<li>å»¶è¿Ÿäº¤æ¢æœºæ’ä»¶ï¼ˆrabbitmq-delayed-message-exchangeï¼Œæ”¯æŒåŠ¨æ€å»¶è¿Ÿæ—¶é—´ï¼Œæ¨èç”Ÿäº§ä½¿ç”¨ï¼‰ã€‚</li>
</ol>
</li>
</ul>
<h5 data-id="heading-49">é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>è®¢å•è¶…æ—¶å…³é—­ï¼ˆå»¶è¿Ÿ 30 åˆ†é’Ÿï¼‰ï¼›</li>
<li>å®šæ—¶é€šçŸ¥ï¼ˆå¦‚ä¼šè®®å¼€å§‹å‰ 10 åˆ†é’Ÿæé†’ï¼‰ï¼›</li>
<li>ä»»åŠ¡é‡è¯•ï¼ˆå»¶è¿Ÿ 5 åˆ†é’Ÿåé‡è¯•å¤±è´¥ä»»åŠ¡ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-50">å®æˆ˜æºç ï¼ˆåŸºäºå»¶è¿Ÿæ’ä»¶å®ç°ï¼‰</h5>
<h6 data-id="heading-51">1. å®‰è£…å»¶è¿Ÿæ’ä»¶</h6>
<ul>
<li>ä¸‹è½½æ’ä»¶ï¼šä» <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.rabbitmq.com%2Fcommunity-plugins.html" target="_blank" title="https://www.rabbitmq.com/community-plugins.html" ref="nofollow noopener noreferrer">RabbitMQ å®˜æ–¹æ’ä»¶åº“</a> ä¸‹è½½ <code>rabbitmq_delayed_message_exchange</code> æ’ä»¶ï¼›</li>
<li>å®‰è£…æ’ä»¶ï¼šå°†æ’ä»¶å¤åˆ¶åˆ° RabbitMQ æ’ä»¶ç›®å½•ï¼ˆå¦‚ <code>/usr/lib/rabbitmq/lib/rabbitmq_server-3.12.0/plugins</code>ï¼‰ï¼Œæ‰§è¡Œå‘½ä»¤ <code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code>ï¼›</li>
<li>é‡å¯ RabbitMQï¼š<code>systemctl restart rabbitmq-server</code>ã€‚</li>
</ul>
<h6 data-id="heading-52">2. é…ç½®ç±»</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayedQueueConfig</span> {
    <span class="hljs-comment">// å»¶è¿Ÿäº¤æ¢æœºåç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DELAYED_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"delayed_notice_exchange"</span>;
    <span class="hljs-comment">// å»¶è¿Ÿé˜Ÿåˆ—åç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DELAYED_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"delayed_notice_queue"</span>;
    <span class="hljs-comment">// ç»‘å®šé”®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DELAYED_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"notice.delayed"</span>;

    <span class="hljs-comment">// 1. å£°æ˜å»¶è¿Ÿäº¤æ¢æœºï¼ˆç±»å‹ä¸º x-delayed-messageï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CustomExchange <span class="hljs-title function_">delayedNoticeExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// é…ç½®äº¤æ¢æœºç±»å‹å’Œå»¶è¿Ÿå‚æ•°</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomExchange</span>(
                DELAYED_EXCHANGE_NAME,
                <span class="hljs-string">"x-delayed-message"</span>, <span class="hljs-comment">// å»¶è¿Ÿäº¤æ¢æœºç±»å‹</span>
                <span class="hljs-literal">true</span>, <span class="hljs-comment">// æŒä¹…åŒ–</span>
                <span class="hljs-literal">false</span>, <span class="hljs-comment">// è‡ªåŠ¨åˆ é™¤</span>
                Map.of(<span class="hljs-string">"x-delayed-type"</span>, <span class="hljs-string">"direct"</span>) <span class="hljs-comment">// å»¶è¿Ÿäº¤æ¢æœºçš„è·¯ç”±ç±»å‹ï¼ˆDirect/Topicç­‰ï¼‰</span>
        );
    }

    <span class="hljs-comment">// 2. å£°æ˜å»¶è¿Ÿé˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">delayedNoticeQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(DELAYED_QUEUE_NAME).build();
    }

    <span class="hljs-comment">// 3. ç»‘å®šå»¶è¿Ÿäº¤æ¢æœºä¸é˜Ÿåˆ—</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">delayedBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(delayedNoticeQueue())
                .to(delayedNoticeExchange())
                .with(DELAYED_ROUTING_KEY)
                .noargs();
    }
}
</code></pre>
<h6 data-id="heading-53">3. ç”Ÿäº§è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.AmqpException;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.MessagePostProcessor;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayedProducer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-comment">/**
     * å‘é€å»¶è¿Ÿæ¶ˆæ¯
     * <span class="hljs-doctag">@param</span> content æ¶ˆæ¯å†…å®¹
     * <span class="hljs-doctag">@param</span> delayTime å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendDelayedMessage</span><span class="hljs-params">(String content, <span class="hljs-type">long</span> delayTime)</span> {
        rabbitTemplate.convertAndSend(
                DelayedQueueConfig.DELAYED_EXCHANGE_NAME,
                DelayedQueueConfig.DELAYED_ROUTING_KEY,
                content,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePostProcessor</span>() {
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> Message <span class="hljs-title function_">postProcessMessage</span><span class="hljs-params">(Message message)</span> <span class="hljs-keyword">throws</span> AmqpException {
                        <span class="hljs-comment">// è®¾ç½®å»¶è¿Ÿæ—¶é—´ï¼ˆæ ¸å¿ƒï¼‰</span>
                        message.getMessageProperties().setHeader(<span class="hljs-string">"x-delay"</span>, delayTime);
                        <span class="hljs-keyword">return</span> message;
                    }
                },
                correlationData -&gt; {
                    correlationData.setId(System.currentTimeMillis() + <span class="hljs-string">""</span>);
                    <span class="hljs-keyword">return</span> correlationData;
                }
        );
        log.info(<span class="hljs-string">"å‘é€å»¶è¿Ÿæ¶ˆæ¯ï¼šcontent={}, å»¶è¿Ÿæ—¶é—´={}ms"</span>, content, delayTime);
    }
}
</code></pre>
<h6 data-id="heading-54">4. æ¶ˆè´¹è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.amqp.support.AmqpHeaders;
<span class="hljs-keyword">import</span> org.springframework.messaging.handler.annotation.Header;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayedConsumer</span> {

    <span class="hljs-meta">@RabbitListener(queues = DelayedQueueConfig.DELAYED_QUEUE_NAME)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeDelayedQueue</span><span class="hljs-params">(String message, Channel channel,
                                    <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"å»¶è¿Ÿæ¶ˆæ¯åˆ°æœŸï¼Œæ¥æ”¶æ¶ˆæ¯ï¼š{}"</span>, message);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šå‘é€å®šæ—¶é€šçŸ¥</span>
            <span class="hljs-comment">// notifyService.sendReminder(message);</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹å»¶è¿Ÿæ¶ˆæ¯å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
        }
    }
}
</code></pre>
<h6 data-id="heading-55">5. æµ‹è¯•æ¥å£</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayedTestController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DelayedProducer delayedProducer;

    <span class="hljs-meta">@GetMapping("/delayed/sendMessage")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendMessage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String content, <span class="hljs-meta">@RequestParam</span> <span class="hljs-type">long</span> delayTime)</span> {
        delayedProducer.sendDelayedMessage(content, delayTime);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"å»¶è¿Ÿæ¶ˆæ¯å‘é€æˆåŠŸ"</span>;
    }
}
</code></pre>
<h4 data-id="heading-56">3.3 ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼šæ¶ˆæ¯ä¼˜å…ˆçº§æ’åº</h4>
<h5 data-id="heading-57">æ ¸å¿ƒæ¦‚å¿µ</h5>
<ul>
<li>ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼šæ”¯æŒä¸ºæ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§ï¼ˆ0-255ï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ï¼Œæ¶ˆè´¹è€…ä¼˜å…ˆæ¶ˆè´¹é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ï¼›</li>
<li>æ ¸å¿ƒä»·å€¼ï¼šç¡®ä¿é‡è¦æ¶ˆæ¯è¢«ä¼˜å…ˆå¤„ç†ï¼ˆå¦‚ VIP ç”¨æˆ·çš„è®¢å•ã€ç´§æ€¥å‘Šè­¦ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-58">é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>è®¢å•ä¼˜å…ˆçº§ï¼šVIP ç”¨æˆ·çš„è®¢å•ä¼˜å…ˆå¤„ç†ï¼›</li>
<li>å‘Šè­¦ä¼˜å…ˆçº§ï¼šä¸¥é‡å‘Šè­¦ï¼ˆP0 çº§ï¼‰ä¼˜å…ˆäºæ™®é€šå‘Šè­¦ï¼ˆP3 çº§ï¼‰ï¼›</li>
<li>ä»»åŠ¡ä¼˜å…ˆçº§ï¼šç´§æ€¥ä»»åŠ¡ï¼ˆå¦‚æ•°æ®ä¿®å¤ï¼‰ä¼˜å…ˆäºæ™®é€šä»»åŠ¡ï¼ˆå¦‚æ•°æ®ç»Ÿè®¡ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-59">å®æˆ˜æºç </h5>
<h6 data-id="heading-60">1. é…ç½®ç±»</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityQueueConfig</span> {
    <span class="hljs-comment">// äº¤æ¢æœºåç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PRIORITY_EXCHANGE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"priority_order_exchange"</span>;
    <span class="hljs-comment">// ä¼˜å…ˆçº§é˜Ÿåˆ—åç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PRIORITY_QUEUE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"priority_order_queue"</span>;
    <span class="hljs-comment">// ç»‘å®šé”®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PRIORITY_ROUTING_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order.priority"</span>;

    <span class="hljs-comment">// 1. å£°æ˜äº¤æ¢æœºï¼ˆDirectç±»å‹ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DirectExchange <span class="hljs-title function_">priorityOrderExchange</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(PRIORITY_EXCHANGE_NAME).durable(<span class="hljs-literal">true</span>).build();
    }

    <span class="hljs-comment">// 2. å£°æ˜ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆè®¾ç½®æœ€å¤§ä¼˜å…ˆçº§ï¼‰</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title function_">priorityOrderQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> QueueBuilder.durable(PRIORITY_QUEUE_NAME)
                .withArgument(<span class="hljs-string">"x-max-priority"</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// æœ€å¤§ä¼˜å…ˆçº§ï¼ˆ0-10ï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼‰</span>
                .build();
    }

    <span class="hljs-comment">// 3. ç»‘å®š</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Binding <span class="hljs-title function_">priorityBinding</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> BindingBuilder.bind(priorityOrderQueue()).to(priorityOrderExchange()).with(PRIORITY_ROUTING_KEY);
    }
}
</code></pre>
<h6 data-id="heading-61">2. ç”Ÿäº§è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.AmqpException;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.MessagePostProcessor;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityProducer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RabbitTemplate rabbitTemplate;

    <span class="hljs-comment">/**
     * å‘é€å¸¦ä¼˜å…ˆçº§çš„è®¢å•æ¶ˆæ¯
     * <span class="hljs-doctag">@param</span> orderId è®¢å•ID
     * <span class="hljs-doctag">@param</span> userType ç”¨æˆ·ç±»å‹ï¼ˆVIP/NORMALï¼‰
     * <span class="hljs-doctag">@param</span> priority ä¼˜å…ˆçº§ï¼ˆ1-10ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendPriorityOrderMessage</span><span class="hljs-params">(Long orderId, String userType, <span class="hljs-type">int</span> priority)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"ç”¨æˆ·ç±»å‹ï¼š%sï¼Œè®¢å•[%s]å¾…å¤„ç†"</span>, userType, orderId);
        rabbitTemplate.convertAndSend(
                PriorityQueueConfig.PRIORITY_EXCHANGE_NAME,
                PriorityQueueConfig.PRIORITY_ROUTING_KEY,
                message,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessagePostProcessor</span>() {
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> Message <span class="hljs-title function_">postProcessMessage</span><span class="hljs-params">(Message message)</span> <span class="hljs-keyword">throws</span> AmqpException {
                        <span class="hljs-comment">// è®¾ç½®æ¶ˆæ¯ä¼˜å…ˆçº§</span>
                        message.getMessageProperties().setPriority(priority);
                        <span class="hljs-keyword">return</span> message;
                    }
                },
                correlationData -&gt; {
                    correlationData.setId(orderId.toString());
                    <span class="hljs-keyword">return</span> correlationData;
                }
        );
        log.info(<span class="hljs-string">"å‘é€ä¼˜å…ˆçº§è®¢å•æ¶ˆæ¯ï¼šcontent={}, ä¼˜å…ˆçº§={}"</span>, message, priority);
    }
}
</code></pre>
<h6 data-id="heading-62">3. æ¶ˆè´¹è€…</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.amqp.support.AmqpHeaders;
<span class="hljs-keyword">import</span> org.springframework.messaging.handler.annotation.Header;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;

<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityConsumer</span> {

    <span class="hljs-meta">@RabbitListener(queues = PriorityQueueConfig.PRIORITY_QUEUE_NAME)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumePriorityQueue</span><span class="hljs-params">(String message, Channel channel,
                                     <span class="hljs-meta">@Header(AmqpHeaders.DELIVERY_TAG)</span> <span class="hljs-type">long</span> deliveryTag,
                                     <span class="hljs-meta">@Header("priority")</span> Integer priority)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"æ¥æ”¶ä¼˜å…ˆçº§è®¢å•æ¶ˆæ¯ï¼šcontent={}, ä¼˜å…ˆçº§={}"</span>, message, priority);
            <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡ï¼šå¤„ç†è®¢å•ï¼ˆé«˜ä¼˜å…ˆçº§è®¢å•ä¼˜å…ˆæ‰§è¡Œï¼‰</span>
            <span class="hljs-comment">// orderService.processOrder(orderId);</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¶ˆè´¹ä¼˜å…ˆçº§è®¢å•æ¶ˆæ¯å¤±è´¥"</span>, e);
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
        }
    }
}
</code></pre>
<h6 data-id="heading-63">4. æµ‹è¯•æ¥å£</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriorityTestController</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PriorityProducer priorityProducer;

    <span class="hljs-meta">@GetMapping("/priority/sendOrder")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sendOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> Long orderId,
                            <span class="hljs-meta">@RequestParam</span> String userType,
                            <span class="hljs-meta">@RequestParam</span> <span class="hljs-type">int</span> priority)</span> {
        priorityProducer.sendPriorityOrderMessage(orderId, userType, priority);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ä¼˜å…ˆçº§è®¢å•æ¶ˆæ¯å‘é€æˆåŠŸ"</span>;
    }
}
</code></pre>
<h4 data-id="heading-64">3.4 é•œåƒé˜Ÿåˆ—ï¼šé«˜å¯ç”¨éƒ¨ç½²</h4>
<h5 data-id="heading-65">æ ¸å¿ƒæ¦‚å¿µ</h5>
<ul>
<li>é•œåƒé˜Ÿåˆ—ï¼šå°†é˜Ÿåˆ—å¤åˆ¶åˆ° RabbitMQ é›†ç¾¤çš„å¤šä¸ªèŠ‚ç‚¹ï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºæ—¶ï¼Œä»èŠ‚ç‚¹è‡ªåŠ¨æ¥ç®¡é˜Ÿåˆ—ï¼Œç¡®ä¿æœåŠ¡ä¸ä¸­æ–­ï¼›</li>
<li>æ ¸å¿ƒä»·å€¼ï¼šé¿å…é˜Ÿåˆ—å•ç‚¹æ•…éšœï¼Œæå‡ RabbitMQ é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</li>
</ul>
<h5 data-id="heading-66">é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼šæ‰€æœ‰æ ¸å¿ƒä¸šåŠ¡é˜Ÿåˆ—ï¼ˆå¦‚è®¢å•ã€æ”¯ä»˜ï¼‰éƒ½éœ€é…ç½®é•œåƒé˜Ÿåˆ—ï¼›</li>
<li>é«˜å¯ç”¨è¦æ±‚é«˜çš„åœºæ™¯ï¼šä¸å…è®¸å› èŠ‚ç‚¹å®•æœºå¯¼è‡´é˜Ÿåˆ—ä¸å¯ç”¨ã€‚</li>
</ul>
<h5 data-id="heading-67">å®ç°æ–¹å¼ï¼ˆé›†ç¾¤é…ç½®ï¼‰</h5>
<ol>
<li>
<p><strong>æ­å»º RabbitMQ é›†ç¾¤</strong>ï¼ˆç•¥ï¼Œå‚è€ƒ RabbitMQ å®˜æ–¹æ–‡æ¡£ï¼‰ï¼›</p>
</li>
<li>
<p><strong>é…ç½®é•œåƒé˜Ÿåˆ—ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>
<p>å‘½ä»¤è¡Œæ–¹å¼ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸ºæ‰€æœ‰é˜Ÿåˆ—é…ç½®é•œåƒç­–ç•¥ï¼ˆå¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼‰</span>
rabbitmqctl set_policy ha-all <span class="hljs-string">"^"</span> <span class="hljs-string">'{"ha-mode":"all"}'</span>
<span class="hljs-comment"># ä¸ºç‰¹å®šé˜Ÿåˆ—é…ç½®é•œåƒç­–ç•¥ï¼ˆå¤åˆ¶åˆ°2ä¸ªèŠ‚ç‚¹ï¼‰</span>
rabbitmqctl set_policy ha-two <span class="hljs-string">"^ha."</span> <span class="hljs-string">'{"ha-mode":"exactly","ha-params":2,"ha-sync-mode":"automatic"}'</span>
</code></pre>
</li>
<li>
<p>ç®¡ç†ç•Œé¢æ–¹å¼ï¼šè¿›å…¥ RabbitMQ Management â†’ Admin â†’ Policies â†’ Add /update a policyï¼Œé…ç½®ç­–ç•¥å‚æ•°ï¼š</p>
<ul>
<li>Nameï¼šç­–ç•¥åç§°ï¼ˆå¦‚ ha-allï¼‰ï¼›</li>
<li>Patternï¼šé˜Ÿåˆ—åç§°åŒ¹é…è§„åˆ™ï¼ˆå¦‚ ^ åŒ¹é…æ‰€æœ‰é˜Ÿåˆ—ï¼‰ï¼›</li>
<li>Apply toï¼šQueuesï¼›</li>
<li>Definitionï¼šha-mode=allï¼ˆå¤åˆ¶åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€ha-sync-mode=automaticï¼ˆè‡ªåŠ¨åŒæ­¥é˜Ÿåˆ—æ•°æ®ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-68">å››ã€RabbitMQ å…¸å‹ä½¿ç”¨åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-69">4.1 åœºæ™¯ 1ï¼šå¼‚æ­¥é€šä¿¡ï¼ˆæœåŠ¡è§£è€¦ï¼‰</h4>
<h5 data-id="heading-70">ä¸šåŠ¡ç—›ç‚¹</h5>
<ul>
<li>è®¢å•ç³»ç»Ÿåˆ›å»ºè®¢å•åï¼Œéœ€è°ƒç”¨æ”¯ä»˜ã€åº“å­˜ã€æ—¥å¿—ã€é€šçŸ¥ç­‰å¤šä¸ªæœåŠ¡ï¼ŒåŒæ­¥è°ƒç”¨å¯¼è‡´å“åº”æ…¢ã€è€¦åˆåº¦é«˜ï¼›</li>
<li>æŸä¸€ä¸ªæœåŠ¡æ•…éšœï¼ˆå¦‚é€šçŸ¥æœåŠ¡å®•æœºï¼‰ï¼Œä¼šå¯¼è‡´æ•´ä¸ªè®¢å•æµç¨‹å¤±è´¥ã€‚</li>
</ul>
<h5 data-id="heading-71">è§£å†³æ–¹æ¡ˆ</h5>
<ul>
<li>é‡‡ç”¨ RabbitMQ å¼‚æ­¥é€šä¿¡ï¼Œè®¢å•ç³»ç»Ÿå‘é€æ¶ˆæ¯åç›´æ¥è¿”å›ï¼Œå…¶ä»–æœåŠ¡å¼‚æ­¥æ¶ˆè´¹ï¼›</li>
<li>äº¤æ¢æœºé€‰å‹ï¼šDirect äº¤æ¢æœºï¼ˆç²¾å‡†è·¯ç”±åˆ°ä¸åŒæœåŠ¡é˜Ÿåˆ—ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-72">æ¶æ„è®¾è®¡</h5>
<pre><code class="hljs language-markdown" lang="markdown">è®¢å•ç³»ç»Ÿï¼ˆç”Ÿäº§è€…ï¼‰â†’ Directäº¤æ¢æœº â†’ åº“å­˜é˜Ÿåˆ—ï¼ˆåº“å­˜æœåŠ¡ï¼‰
<span class="hljs-code">                                  â†’ æ”¯ä»˜é˜Ÿåˆ—ï¼ˆæ”¯ä»˜æœåŠ¡ï¼‰
                                  â†’ é€šçŸ¥é˜Ÿåˆ—ï¼ˆé€šçŸ¥æœåŠ¡ï¼‰
                                  â†’ æ—¥å¿—é˜Ÿåˆ—ï¼ˆæ—¥å¿—æœåŠ¡ï¼‰
</span></code></pre>
<h5 data-id="heading-73">æ ¸å¿ƒæºç </h5>
<p>å‚è€ƒ 2.1 èŠ‚ Direct äº¤æ¢æœºçš„å®æˆ˜æºç ï¼Œåªéœ€æ‰©å±•é˜Ÿåˆ—å’Œæ¶ˆè´¹è€…å³å¯ã€‚</p>
<h4 data-id="heading-74">4.2 åœºæ™¯ 2ï¼šå‰Šå³°å¡«è°·ï¼ˆç§’æ€é«˜å¹¶å‘ï¼‰</h4>
<h5 data-id="heading-75">ä¸šåŠ¡ç—›ç‚¹</h5>
<ul>
<li>ç§’æ€æ´»åŠ¨å³°å€¼ QPS è¾¾ 10 ä¸‡ +ï¼Œç›´æ¥è°ƒç”¨æ•°æ®åº“ä¼šå¯¼è‡´æ•°æ®åº“å®•æœºï¼›</li>
<li>å¤§é‡è¯·æ±‚åŒæ—¶åˆ°è¾¾ï¼ŒæœåŠ¡çº¿ç¨‹æ± è€—å°½ï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€‚</li>
</ul>
<h5 data-id="heading-76">è§£å†³æ–¹æ¡ˆ</h5>
<ul>
<li>é‡‡ç”¨ RabbitMQ ä½œä¸ºç¼“å†²ï¼Œç§’æ€è¯·æ±‚å…ˆå†™å…¥é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…æŒ‰æ•°æ®åº“å¤„ç†èƒ½åŠ›å¹³æ»‘æ¶ˆè´¹ï¼›</li>
<li>äº¤æ¢æœºé€‰å‹ï¼šDirect äº¤æ¢æœºï¼›</li>
<li>é˜Ÿåˆ—é…ç½®ï¼šæ™®é€šé˜Ÿåˆ— + é™æµï¼ˆæ¶ˆè´¹è€… prefetch é…ç½®ä¸º 10ï¼Œæ§åˆ¶æ¯ç§’æ¶ˆè´¹é€Ÿåº¦ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-77">æ¶æ„è®¾è®¡</h5>
<pre><code class="hljs">ç”¨æˆ·ç§’æ€è¯·æ±‚ â†’ APIç½‘å…³ â†’ ç§’æ€æœåŠ¡ï¼ˆç”Ÿäº§è€…ï¼‰â†’ Directäº¤æ¢æœº â†’ ç§’æ€é˜Ÿåˆ— â†’ ç§’æ€æ¶ˆè´¹è€…ï¼ˆæŒ‰èƒ½åŠ›æ¶ˆè´¹ï¼‰â†’ æ•°æ®åº“
</code></pre>
<h5 data-id="heading-78">æ ¸å¿ƒä¼˜åŒ–</h5>
<ul>
<li>ç”Ÿäº§è€…é™æµï¼šAPI ç½‘å…³å±‚é™åˆ¶æ¯ç§’è¯·æ±‚æ•°ï¼Œé¿å…é˜Ÿåˆ—å †ç§¯è¿‡å¤šï¼›</li>
<li>æ¶ˆè´¹è€…é™æµï¼š<code>spring.rabbitmq.listener.simple.prefetch=10</code>ï¼ˆæ¯ä¸ªæ¶ˆè´¹è€…æ¯æ¬¡æ‹‰å– 10 æ¡æ¶ˆæ¯ï¼‰ï¼›</li>
<li>é˜Ÿåˆ—æŒä¹…åŒ–ï¼šé¿å…æœåŠ¡å®•æœºå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚</li>
</ul>
<h4 data-id="heading-79">4.3 åœºæ™¯ 3ï¼šå¹¿æ’­é€šçŸ¥ï¼ˆç³»ç»Ÿå…¬å‘Šï¼‰</h4>
<h5 data-id="heading-80">ä¸šåŠ¡ç—›ç‚¹</h5>
<ul>
<li>ç³»ç»Ÿå‘å¸ƒå…¨å±€å…¬å‘Šï¼Œéœ€é€šçŸ¥æ‰€æœ‰åœ¨çº¿æœåŠ¡ï¼ˆå¦‚ç¼“å­˜æœåŠ¡ã€æœç´¢æœåŠ¡ã€ç»Ÿè®¡æœåŠ¡ï¼‰ï¼›</li>
<li>æ–°å¢æœåŠ¡åï¼Œéœ€ä¿®æ”¹å‘å¸ƒå…¬å‘Šçš„ä»£ç ï¼Œè€¦åˆåº¦é«˜ã€‚</li>
</ul>
<h5 data-id="heading-81">è§£å†³æ–¹æ¡ˆ</h5>
<ul>
<li>é‡‡ç”¨ Fanout äº¤æ¢æœºï¼Œå‘å¸ƒå…¬å‘Šæ—¶å¹¿æ’­åˆ°æ‰€æœ‰ç»‘å®šé˜Ÿåˆ—ï¼Œæ–°å¢æœåŠ¡åªéœ€ç»‘å®šé˜Ÿåˆ—å³å¯ï¼›</li>
<li>äº¤æ¢æœºé€‰å‹ï¼šFanout äº¤æ¢æœºã€‚</li>
</ul>
<h5 data-id="heading-82">æ¶æ„è®¾è®¡</h5>
<pre><code class="hljs language-markdown" lang="markdown">å…¬å‘ŠæœåŠ¡ï¼ˆç”Ÿäº§è€…ï¼‰â†’ Fanoutäº¤æ¢æœº â†’ ç¼“å­˜æœåŠ¡é˜Ÿåˆ—
<span class="hljs-code">                                  â†’ æœç´¢æœåŠ¡é˜Ÿåˆ—
                                  â†’ ç»Ÿè®¡æœåŠ¡é˜Ÿåˆ—
                                  â†’ å…¶ä»–æœåŠ¡é˜Ÿåˆ—
</span></code></pre>
<h5 data-id="heading-83">æ ¸å¿ƒæºç </h5>
<p>å‚è€ƒ 2.3 èŠ‚ Fanout äº¤æ¢æœºçš„å®æˆ˜æºç ã€‚</p>
<h4 data-id="heading-84">4.4 åœºæ™¯ 4ï¼šå®šæ—¶ä»»åŠ¡ï¼ˆè®¢å•è¶…æ—¶å…³é—­ï¼‰</h4>
<h5 data-id="heading-85">ä¸šåŠ¡ç—›ç‚¹</h5>
<ul>
<li>è®¢å•åˆ›å»ºå 30 åˆ†é’Ÿæœªæ”¯ä»˜éœ€è‡ªåŠ¨å…³é—­ï¼Œä¼ ç»Ÿå®šæ—¶ä»»åŠ¡ï¼ˆå¦‚ Quartzï¼‰å­˜åœ¨ç²¾åº¦ä½ã€èµ„æºå ç”¨é«˜çš„é—®é¢˜ï¼›</li>
<li>å¤§é‡è®¢å•åŒæ—¶è¶…æ—¶ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›çªå¢ã€‚</li>
</ul>
<h5 data-id="heading-86">è§£å†³æ–¹æ¡ˆ</h5>
<ul>
<li>é‡‡ç”¨ RabbitMQ å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè®¢å•åˆ›å»ºæ—¶å‘é€å»¶è¿Ÿ 30 åˆ†é’Ÿçš„æ¶ˆæ¯ï¼Œåˆ°æœŸåæ¶ˆè´¹æ¶ˆæ¯å…³é—­è®¢å•ï¼›</li>
<li>å®ç°æ–¹å¼ï¼šå»¶è¿Ÿäº¤æ¢æœºæ’ä»¶ï¼ˆæ”¯æŒåŠ¨æ€å»¶è¿Ÿæ—¶é—´ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-87">æ¶æ„è®¾è®¡</h5>
<pre><code class="hljs">è®¢å•ç³»ç»Ÿï¼ˆç”Ÿäº§è€…ï¼‰â†’ å»¶è¿Ÿäº¤æ¢æœº â†’ å»¶è¿Ÿé˜Ÿåˆ— â†’ æ¶ˆè´¹è€…ï¼ˆåˆ°æœŸå…³é—­è®¢å•ï¼‰â†’ æ•°æ®åº“
</code></pre>
<h5 data-id="heading-88">æ ¸å¿ƒæºç </h5>
<p>å‚è€ƒ 3.2 èŠ‚å»¶è¿Ÿé˜Ÿåˆ—çš„å®æˆ˜æºç ã€‚</p>
<h3 data-id="heading-89">äº”ã€RabbitMQ å¯é æ€§ä¸æ€§èƒ½ä¼˜åŒ–</h3>
<h4 data-id="heading-90">5.1 å¯é æ€§ä¿éšœ</h4>
<ol>
<li><strong>æ¶ˆæ¯æŒä¹…åŒ–</strong>ï¼šäº¤æ¢æœºã€é˜Ÿåˆ—ã€æ¶ˆæ¯å‡è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼ˆdurable=trueï¼‰ï¼Œé¿å… RabbitMQ é‡å¯åæ¶ˆæ¯ä¸¢å¤±ï¼›</li>
<li><strong>ç”Ÿäº§è€…ç¡®è®¤</strong>ï¼šå¼€å¯ <code>publisher-confirm-type: correlated</code>ï¼Œç¡®ä¿æ¶ˆæ¯æˆåŠŸå‘é€åˆ°äº¤æ¢æœºï¼›</li>
<li><strong>æ¶ˆè´¹è€… ACK</strong>ï¼šå¼€å¯æ‰‹åŠ¨ ACKï¼ˆ<code>acknowledge-mode: manual</code>ï¼‰ï¼Œé¿å…æ¶ˆè´¹å¤±è´¥å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼›</li>
<li><strong>æ­»ä¿¡é˜Ÿåˆ—</strong>ï¼šå¤„ç†æ— æ³•æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ï¼›</li>
<li><strong>å¹‚ç­‰æ€§å¤„ç†</strong>ï¼šé€šè¿‡æ¶ˆæ¯ ID å»é‡ï¼ˆå¦‚æ•°æ®åº“å”¯ä¸€é”®ã€Redis ç¼“å­˜ï¼‰ï¼Œé¿å…é‡å¤æ¶ˆè´¹ã€‚</li>
</ol>
<h4 data-id="heading-91">5.2 æ€§èƒ½ä¼˜åŒ–</h4>
<ol>
<li><strong>è¿æ¥æ± ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ Spring AMQP è‡ªå¸¦çš„è¿æ¥æ± ï¼Œé…ç½®åˆç†çš„æœ€å¤§è¿æ¥æ•°å’Œé€šé“æ•°ï¼›</li>
<li><strong>æ¶ˆè´¹è€…é™æµ</strong>ï¼šé€šè¿‡ <code>prefetch</code> å‚æ•°æ§åˆ¶æ¶ˆè´¹è€…æ¯æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ•°ï¼Œé¿å…æ¶ˆè´¹è€…è¿‡è½½ï¼›</li>
<li><strong>åºåˆ—åŒ–ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ Protobuf æ›¿ä»£ JSONï¼Œå‡å°‘æ¶ˆæ¯ä½“ç§¯ï¼Œæå‡åºåˆ—åŒ–æ•ˆç‡ï¼›</li>
<li><strong>é˜Ÿåˆ—æ‹†åˆ†</strong>ï¼šå°†ä¸åŒä¸šåŠ¡çš„é˜Ÿåˆ—æ‹†åˆ†åˆ°ä¸åŒäº¤æ¢æœºï¼Œé¿å…é˜Ÿåˆ—å †ç§¯å½±å“å…¶ä»–ä¸šåŠ¡ï¼›</li>
<li><strong>é›†ç¾¤éƒ¨ç½²</strong>ï¼šé‡‡ç”¨ RabbitMQ é›†ç¾¤ + é•œåƒé˜Ÿåˆ—ï¼Œæå‡å¹¶å‘å¤„ç†èƒ½åŠ›å’Œé«˜å¯ç”¨æ€§ã€‚</li>
</ol>
<h3 data-id="heading-92">å…­ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h3>
<p>RabbitMQ çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºçµæ´»çš„è·¯ç”±æœºåˆ¶ï¼ˆå››ç§äº¤æ¢æœºï¼‰å’Œä¸°å¯Œçš„é˜Ÿåˆ—ç±»å‹ï¼ˆæ­»ä¿¡ã€å»¶è¿Ÿã€ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰ï¼Œèƒ½å¤Ÿé€‚é…å¤šç§åˆ†å¸ƒå¼åœºæ™¯ã€‚ä½¿ç”¨æ—¶éœ€éµå¾ªä»¥ä¸‹æœ€ä½³å®è·µï¼š</p>
<ol>
<li><strong>äº¤æ¢æœºé€‰å‹</strong>ï¼šç²¾å‡†è·¯ç”±ç”¨ Directï¼Œæ¨¡ç³Šè·¯ç”±ç”¨ Topicï¼Œå¹¿æ’­ç”¨ Fanoutï¼Œå¤šå±æ€§åŒ¹é…ç”¨ Headersï¼›</li>
<li><strong>é˜Ÿåˆ—é€‰å‹</strong>ï¼šå¤±è´¥æ¶ˆæ¯ç”¨æ­»ä¿¡é˜Ÿåˆ—ï¼Œå®šæ—¶ä»»åŠ¡ç”¨å»¶è¿Ÿé˜Ÿåˆ—ï¼Œé‡è¦æ¶ˆæ¯ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼›</li>
<li><strong>å¯é æ€§ä¼˜å…ˆ</strong>ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»å¼€å¯æŒä¹…åŒ–ã€ç”Ÿäº§è€…ç¡®è®¤ã€æ¶ˆè´¹è€… ACKã€æ­»ä¿¡é˜Ÿåˆ—ï¼›</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåˆç†é…ç½®è¿æ¥æ± ã€prefetch å‚æ•°ï¼Œé¿å…é˜Ÿåˆ—å †ç§¯ï¼Œé‡‡ç”¨é›†ç¾¤éƒ¨ç½²æå‡å¹¶å‘ï¼›</li>
<li><strong>ç›‘æ§è¿ç»´</strong>ï¼šä½¿ç”¨ RabbitMQ Management ç›‘æ§é˜Ÿåˆ—å †ç§¯ã€æ¶ˆæ¯ååé‡ï¼Œç»“åˆ Prometheus + Grafana å®ç°å‘Šè­¦ã€‚</li>
</ol>
<p>æœ¬æ–‡æä¾›çš„æºç å¯ç›´æ¥å¤ç”¨ï¼Œåªéœ€æ ¹æ®å®é™…ä¸šåŠ¡è°ƒæ•´äº¤æ¢æœºã€é˜Ÿåˆ—åç§°å’Œä¸šåŠ¡é€»è¾‘å³å¯å¿«é€Ÿè½åœ°ã€‚RabbitMQ ä½œä¸ºæˆç†Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­åº”ç”¨å¹¿æ³›ï¼ŒæŒæ¡å…¶æ ¸å¿ƒç‰¹æ€§å’Œå®æˆ˜æŠ€å·§ï¼Œèƒ½æœ‰æ•ˆè§£å†³å¼‚æ­¥é€šä¿¡ã€è§£è€¦ã€å‰Šå³°å¡«è°·ç­‰æ ¸å¿ƒé—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty æºç æ·±åº¦è§£æï¼šä¸ºä»€ä¹ˆå®ƒæ˜¯ Java ä¸–ç•Œé‡Œé¢å‘å¯¹è±¡è®¾è®¡çš„â€œå·…å³°ä¹‹ä½œâ€ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598827845965398042</link>    <guid>https://juejin.cn/post/7598827845965398042</guid>    <pubDate>2026-01-24T13:04:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598827845965398042" data-draft-id="7598614012183494683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty æºç æ·±åº¦è§£æï¼šä¸ºä»€ä¹ˆå®ƒæ˜¯ Java ä¸–ç•Œé‡Œé¢å‘å¯¹è±¡è®¾è®¡çš„â€œå·…å³°ä¹‹ä½œâ€ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,æ¶æ„,Java"/> <meta itemprop="datePublished" content="2026-01-24T13:04:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç ç¬”è€•"/> <meta itemprop="url" content="https://juejin.cn/user/3984285868763117"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty æºç æ·±åº¦è§£æï¼šä¸ºä»€ä¹ˆå®ƒæ˜¯ Java ä¸–ç•Œé‡Œé¢å‘å¯¹è±¡è®¾è®¡çš„â€œå·…å³°ä¹‹ä½œâ€ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285868763117/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç ç¬”è€•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T13:04:49.000Z" title="Sat Jan 24 2026 13:04:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨å¾ˆå¤šå¼€å‘è€…çš„åˆ»æ¿å°è±¡é‡Œï¼Œâ€œé«˜æ€§èƒ½â€å’Œâ€œé¢å‘å¯¹è±¡â€æ˜¯é±¼ä¸ç†ŠæŒä¸å¯å…¼å¾—ã€‚ä¸ºäº†æè‡´çš„é€Ÿåº¦ï¼Œä»£ç å°±åº”è¯¥å†™çš„åƒâ€œå¤©ä¹¦â€ä¸€æ ·ã€‚ç„¶è€Œï¼Œ<strong>Netty</strong> å½»åº•æ‰“ç ´äº†è¿™ç§åˆ»æ¿å°è±¡ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªå•æœºèƒ½æ”¯æ’‘ç™¾ä¸‡å¹¶å‘çš„åº•å±‚é€šä¿¡æ¡†æ¶ï¼ŒNetty çš„æºç ç®€ç›´å°±æ˜¯ä¸€æœ¬â€œè®¾è®¡æ¨¡å‹å®æˆ˜æ‰‹å†Œâ€ã€‚å®ƒä¸ä»…æ²¡æœ‰å› ä¸ºè¿½æ±‚æ€§èƒ½è€Œæ”¾å¼ƒå¯¹è±¡æ¨¡å‹ï¼Œåè€Œé€šè¿‡ç²¾å¦™çš„å¯¹è±¡æŠ½è±¡ï¼Œè§£å†³äº†ç½‘ç»œç¼–ç¨‹ä¸­æœ€è®©äººå¤´ç–¼çš„å¤æ‚æ€§é—®é¢˜ã€‚</p>
<p>ä»Šå¤©ï¼Œè®©æˆ‘ä»¬æ¥æ‹†è§£ Netty çš„æ ¸å¿ƒæºç ï¼Œçœ‹çœ‹ä»€ä¹ˆæ˜¯çœŸæ­£çš„â€œå·¥ä¸šçº§é¢å‘å¯¹è±¡â€ã€‚</p>
<h3 data-id="heading-1">å®ƒä¸æ˜¯â€œæ“ä½œ Socketâ€ï¼Œè€Œæ˜¯â€œå’Œå¯¹è±¡å¯¹è¯â€</h3>
<p>ä¹‹å‰æ–‡ç« ä¸­æåˆ°ï¼š<strong>ä¸è¦å›´ç»•æ•°æ®å†™ä»£ç ï¼Œè€Œæ˜¯å›´ç»•å¯¹è±¡å†™ä»£ç </strong>ã€‚</p>
<p>Netty åœ¨æœ€åº•å±‚å°±è´¯å½»äº†è¿™ä¸€ç‚¹ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (key.isReadable()) {
    <span class="hljs-type">SOcketChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> (SocketChannel) key.channel();
    <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> channel.read(buffer);
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>è¿™å°±æ˜¯å…¸å‹çš„æ¶è¿‡ç¨‹å¼æ€ç»´ã€‚ä½ åœ¨ä¸æ–­åœ°é—®ï¼šâ€œç°åœ¨èƒ½ä¸èƒ½è¯»ï¼Ÿâ€ï¼Œâ€œchannel æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿâ€ã€‚</p>
<pre><code class="hljs language-java" lang="java">channel.pipeline().fireChannelRead(msg);
</code></pre>
<p>Netty å‡ ä¹ä»ä¸è®©ä½ åˆ¤æ–­çŠ¶æ€ç„¶åè‡ªå·±å¤„ç†ï¼Œè€Œæ˜¯æŠŠâ€œäº‹ä»¶â€å°è£…æˆå¯¹è±¡ï¼ŒæŠŠâ€œè¡Œä¸ºâ€äº¤ç»™å¯¹è±¡è‡ªå·±å¤„ç†ã€‚ä½ åªéœ€è¦å‘Šè¯‰ç³»ç»Ÿï¼šâ€œå½“æ•°æ®æ¥çš„æ—¶å€™ï¼Œè¯·æ‰§è¡Œè¿™ä¸ªå¯¹è±¡çš„è¿™ä¸ªé€»è¾‘â€ã€‚è‡³äºç°åœ¨ Socket æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Œé‚£æ˜¯å¯¹è±¡è‡ªå·±è¦æ“å¿ƒçš„äº‹æƒ…ï¼Œä¸æ˜¯ä½ çš„äº‹ã€‚</p>
<h3 data-id="heading-2">Channel / Pipeline / Handlerï¼šèŒè´£è¾¹ç•Œçš„è‰ºæœ¯</h3>
<p>ä¹‹å‰åœ¨æ–‡ç« ä¸­ï¼Œæ‰¹åˆ¤è¿‡ä¸€ç§ä»£ç ï¼š</p>
<blockquote>
<p>Service å˜æˆäº†ä¸Šå¸ç±»ï¼Œä»€ä¹ˆéƒ½è¦çŸ¥é“ï¼Œä»€ä¹ˆéƒ½è¦ç®¡</p>
</blockquote>
<p>è€Œä¸”å¾ˆå¤šäººå¯¹è¿™ç§æ‰¹åˆ¤å—¤ä¹‹ä»¥é¼»ã€‚</p>
<p>Netty çš„è®¾è®¡ï¼Œå‡ ä¹æ˜¯å Service ä¸Šå¸ç±»çš„å…¸èŒƒã€‚</p>
<h4 data-id="heading-3">Channelï¼šâ€œè¿æ¥â€æ¦‚å¿µçš„å¯¹è±¡åŒ–</h4>
<p>Netty é¦–å…ˆå°†"è¿æ¥"è¿™ä¸ªæ¦‚å¿µï¼Œè¿›è¡Œäº†å°è£…ï¼Œå°è£…ä¸ºä¸€ä¸ª <code>Channel</code>ã€‚å®ƒä»£è¡¨äº†ä¸€æ¬¡â€œè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸâ€ã€‚</p>
<p>å®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼ŒçŸ¥é“è‡ªå·±æ˜¯å¦ activeï¼ŒçŸ¥é“ä»€ä¹ˆæ—¶å€™å¯ä»¥ writeã€‚ä½ ä¸å†éœ€è¦å†™è¿™ç§ä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (channel.isActive()) {
    <span class="hljs-keyword">if</span> (channel.isWritable()) {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p>è€Œæ˜¯åªéœ€è¦ï¼š</p>
<pre><code class="hljs language-java" lang="java">channel.writeAndFlush(msg);
</code></pre>
<p>"èƒ½ä¸èƒ½å†™ï¼Ÿ"ï¼Œâ€œä»€ä¹ˆæ—¶å€™å†™ï¼Ÿâ€ï¼Œâ€œå†™å¤±è´¥æ€ä¹ˆåŠï¼Ÿâ€ï¼Œè¿™éƒ½æ˜¯ <code>Channel</code> è‡ªå·±çš„äº‹æƒ…ï¼Œä¸æ˜¯è°ƒç”¨è€…çš„äº‹ã€‚</p>
<p>æ­£æ˜¯ä¹‹å‰æ–‡ç« ä¸­å†™è¿‡çš„ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>æŠŠè¡Œä¸ºè¿˜ç»™å¯¹è±¡ï¼Œè®©å®ƒå¯¹è‡ªå·±è´Ÿè´£ã€‚</p>
</blockquote>
<h4 data-id="heading-4">Pipelineï¼šé€»è¾‘çš„æµæ°´çº¿</h4>
<p>å°è£…å¥½â€œè¿æ¥â€ä¹‹åï¼Œæ¥ä¸‹æ¥è¦å¤„ç†çš„æ˜¯æ•°æ®é€»è¾‘ã€‚å¦‚æœç”¨ä¼ ç»Ÿçš„æ–¹å¼ç¼–å†™ç½‘ç»œæ¡†æ¶ï¼Œä»£ç å¾€å¾€ä¼šé€€åŒ–ä¸ºâ€œé«˜çº§ C è¯­è¨€â€é£æ ¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">if</span> (isHttp) {
    decodeHttp();
    <span class="hljs-keyword">if</span> (isAuth) {
        <span class="hljs-keyword">if</span> (isBusiness) {
            doBiz();
        }
    } <span class="hljs-keyword">else</span> {
        auth();
    }
}
</code></pre>
<p>Netty ç”¨ <code>ChannelPipeline</code> æŠŠè¿™ä»¶äº‹å½»åº•å¯¹è±¡åŒ–äº†ï¼Œä»è€Œç»ˆç»“äº†è¿™ç§æ··ä¹±ã€‚</p>
<pre><code class="hljs language-java" lang="java">pipeline
    .addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpDecoder</span>())
    .addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthHandler</span>())
    .addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BizHandler</span>());
</code></pre>
<p>Netty é¦–å…ˆæŠŠâ€œç½‘ç»œè¯·æ±‚å¤„ç†â€æŠ½è±¡æˆäº†ä¸€ä¸ª <code>ChannelPipeline</code>ï¼Œå®ƒåƒæ˜¯ä¸€æ¡å·¥ä¸šæµæ°´çº¿ï¼Œä¸Šé¢æŒ‚æ»¡äº† <code>ChannelHandler</code>ã€‚</p>
<p>æ¯ä¸€ä¸ª <code>Handler</code> éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œä¸”åªå…³å¿ƒä¸€ä»¶äº‹ï¼Œåªå¤„ç†è‡ªå·±è´Ÿè´£çš„é‚£ä¸€å°æ®µé€»è¾‘ï¼Œæœ‰çš„åªè´Ÿè´£æŠŠ <code>ByteBuf</code> è½¬æˆ <code>String</code>ï¼Œæœ‰çš„åªè´Ÿè´£å¿ƒè·³â€¦â€¦ä»–ä»¬æ— éœ€çŸ¥é“å‰åæ˜¯è°ï¼Œä¹Ÿæ— éœ€å…³å¿ƒæ•´ä½“æµç¨‹ã€‚</p>
<p><code>Handler</code> åªæ‰¿è½½å…·ä½“è§„åˆ™ï¼Œå…·ä½“çš„ç¼–æ’ç”± <code>Pipeline</code> æ¥å®ç°ï¼Œè¿™ç§è®¾è®¡è®©åŠŸèƒ½çš„å¢åˆ å˜æˆäº†â€œæ‹”æ’ç§¯æœ¨â€ï¼Œè€Œä¸æ˜¯åœ¨â€œå±å±±â€é‡ŒåŠ¨æ‰‹æœ¯ã€‚</p>
<h3 data-id="heading-5">EventLoopï¼šæŠŠå¹¶å‘â€œå…³è¿›å¯¹è±¡é‡Œâ€</h3>
<p>å‰é¢æ–‡ç« æœ‰æåˆ°ï¼š**<code>String</code> å’Œ <code>Integer</code> åœ¨ç³»ç»Ÿä¸­è£¸å¥”ï¼Œæ˜¯å¾ˆå¤šæ··ä¹±çš„æ ¹æºã€‚**è¿™é‡Œçš„â€œåŸºç¡€ç±»å‹è£¸å¥”â€ï¼Œå…¶å®ä¸åªæ˜¯å•æŒ‡ <code>String</code> / <code>int</code>ï¼Œè€Œæ˜¯æ›´å¹¿ä¹‰çš„ï¼š</p>
<blockquote>
<p>æ²¡æœ‰è¯­ä¹‰çº¦æŸã€æ²¡æœ‰è¡Œä¸ºã€åªæœ‰èƒ½åŠ›çš„ä¸œè¥¿ï¼Œè¢«åˆ°å¤„ä¼ æ¥ä¼ å»ã€‚</p>
</blockquote>
<p>è€Œåœ¨å¹¶å‘çš„é¢†åŸŸï¼Œè¿™ä¸ªâ€œè£¸å¥”â€çš„å°±æ˜¯ <code>Thread</code>ã€<code>Runnable</code>ã€<code>ExecutorService</code>ã€‚æƒ³ä¸€ä¸‹å¹³æ—¶å¤šçº¿ç¨‹çš„ä»£ç ï¼Œç»å¸¸éœ€è¦è€ƒè™‘å‡ ä¸ªé—®é¢˜ï¼šâ€œè¿™ä¸ªä»»åŠ¡å±äºè°ï¼Ÿâ€ã€â€œå®ƒä¼šä¸ä¼šå’Œåˆ«çš„ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Ÿâ€ã€â€œæœ‰æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿâ€ã€â€œéœ€è¦åŠ é”å—ï¼Ÿâ€ï¼Œè¿™äº›é—®é¢˜ï¼Œå…¨éƒ½å‹åœ¨äº†å†™ä»£ç äººçš„è„‘å­é‡Œã€‚</p>
<p><strong><code>EventLoop</code> çš„å‡ºç°ï¼Œæœ¬è´¨ä¸Šæ˜¯ Netty ä¸ºäº†æ¶ˆé™¤è¿™ç§â€œå¹¶å‘ææƒ§â€è€Œåšå‡ºçš„å¯¹è±¡å»ºæ¨¡ã€‚</strong></p>
<p>å®ƒæ—¢ä¸æ˜¯çº¿ç¨‹ï¼Œä¹Ÿä¸æ˜¯â€œçº¿ç¨‹æ± â€ï¼Œè€Œæ˜¯ä¸€ä¸ªâ€œ<strong>è´Ÿè´£ä¸²è¡Œæ‰§è¡Œä»»åŠ¡çš„æŠ½è±¡å¯¹è±¡</strong>â€ã€‚</p>
<p>ä½œä¸ºä½¿ç”¨è€…ï¼Œä¸éœ€è¦å…³å¿ƒâ€œå“ªä¸ªçº¿ç¨‹â€ã€â€œä»€ä¹ˆæ—¶å€™åˆ‡æ¢â€ã€â€œæœ‰æ²¡æœ‰é”â€ï¼Œåªéœ€è¦å…³å¿ƒä¸€ä»¶äº‹ï¼šâ€œæŠŠè¿™ä¸ªä»»åŠ¡äº¤ç»™è´Ÿè´£è¿™ä¸ª Channel çš„ EventLoopâ€ã€‚</p>
<p><code>EventLoop</code> çš„è®¾è®¡ï¼Œæœ‰å‡ ä¸ªéå¸¸å¼ºçš„çº¦æŸï¼š</p>
<ul>
<li>
<p>ç”±æ¡†æ¶ç»Ÿä¸€ç®¡ç†ï¼Œä¸å¯éšæœºåˆ›å»º</p>
</li>
<li>
<p>ä¸¥æ ¼ç»‘å®šï¼Œä¸å¯éšæ„åˆ‡æ¢</p>
</li>
<li>
<p>ä¸€ä¸ª Channel ç»ˆç”Ÿåªç»‘å®šäº†ä¸€ä¸ª EventLoopã€‚</p>
</li>
</ul>
<p>è¿™æ„å‘³ç€ï¼Œä¸€ä¸ª Channel çš„æ‰€æœ‰ I/O äº‹ä»¶å’Œ Handler å›è°ƒæ°¸è¿œåœ¨åŒä¸€ä¸ª EventLoop ä¸Šä¸²è¡Œæ‰§è¡Œï¼Œæ‰€ä»¥ï¼Œåœ¨ <code>Handler</code> ä¸­ï¼Œé»˜è®¤ä¸éœ€è¦å†™ä»»ä½•å¹¶å‘æ§åˆ¶çš„ä»£ç ã€‚</p>
<p>å¹¶å‘é—®é¢˜åœ¨ Netty ä¸­ä¸æ˜¯è¢«â€œç®¡ç†â€çš„ï¼Œè€Œæ˜¯ä»è®¾è®¡å±‚é¢è¢«â€œæ¶ˆç­â€çš„ï¼Œè¿™ä¸æ˜¯çº¿ç¨‹æ± èƒ½åšåˆ°çš„äº‹æƒ…ï¼Œæ˜¯å¯¹è±¡å»ºæ¨¡çš„èƒœåˆ©ã€‚</p>
<h3 data-id="heading-6">Netty ä¸ºä»€ä¹ˆå‡ ä¹æ²¡æœ‰â€œä¸‡èƒ½å¯¹è±¡â€ï¼Ÿ</h3>
<p>Netty çš„ç±»åº“æå…¶åºå¤§ï¼Œä½†ä½ ä¼šå‘ç°ï¼Œå®ƒå‡ ä¹æ²¡æœ‰ä¸€ä¸ªå¯¹è±¡æ˜¯â€œæƒ³å¹²æ‰€æœ‰äº‹æƒ…â€çš„ã€‚</p>
<p>åŒæ ·æ˜¯â€œä¸Šä¸‹æ–‡â€ï¼ŒNetty æ‹†å‡ºäº†å¤šä¸ªèŒè´£æ˜ç¡®çš„å¯¹è±¡ï¼š<code>Channel</code>ï¼ˆè¿æ¥ï¼‰ã€<code>ChannelHandlerContext</code>ï¼ˆå½“å‰ handler çš„ä¸Šä¸‹æ–‡ï¼‰ã€<code>ByteBuf</code>ï¼ˆæ•°æ®å®¹å™¨ï¼‰ã€‚</p>
<p>æ¯ä¸ªå¯¹è±¡çš„ä½¿ç”¨åœºæ™¯éƒ½æå…¶æ˜ç¡®ï¼Œæ²¡æœ‰ä¸€ä¸ªå¯¹è±¡æƒ³â€œè¦†ç›–æ‰€æœ‰åœºæ™¯â€ï¼Œç”¨å¯¹è±¡è¾¹ç•Œï¼Œé™åˆ¶ä½¿ç”¨è€…çš„è‡ªç”±ï¼Œæ¢å–ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚æ€»æœ‰äººè¯´é¢å‘å¯¹è±¡ä¼šé€ æˆç³»ç»Ÿæ··ä¹±ï¼Œåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œå®Œå…¨æ˜¯ä¸€ç§å¼€å‘äººå‘˜æŠ½è±¡è®¾è®¡èƒ½åŠ›ç¼ºé™·çš„ç”©é”…è¡Œä¸ºã€‚</p>
<p>Netty æœ‰ä¸€ä¸ªéšå½¢çš„åŸåˆ™ï¼šâ€œé”™è¯¯çš„ä»£ç å¾ˆéš¾å†™å‡ºæ¥â€ã€‚<strong>é«˜çº§çš„è®¾è®¡ï¼Œæ˜¯é å¯¹è±¡è¾¹ç•Œæ¥çº¦æŸäººçš„è¡Œä¸ºï¼Œä»è€Œæ¢å–ç³»ç»Ÿçš„é•¿æœŸå¯ç»´æŠ¤æ€§</strong>ã€‚</p>
<h3 data-id="heading-7">ç»“è¯­</h3>
<p>Netty çš„è®¾è®¡å‘Šè¯‰æˆ‘ä»¬ï¼Œé¢å‘å¯¹è±¡ä»æ¥ä¸æ˜¯ä¸ºäº†è£…é…·ï¼Œä¹Ÿä¸æ˜¯ä¸ºäº†å¢åŠ é‚£ä¸€ä¸¤å±‚çš„è°ƒç”¨å¼€é”€ã€‚å®ƒå­˜åœ¨çš„å”¯ä¸€ç›®çš„ï¼Œæ˜¯<strong>ä¸ºäº†ä½¿å¤æ‚æ€§å—æ§</strong>ã€‚Netty ä»ä¸è¦æ±‚ä½ â€œç†è§£æ•´ä¸ªç³»ç»Ÿâ€ï¼Œåªæ˜¯è¦æ±‚ä½ â€œæŠŠè¯¥åšçš„äº‹æƒ…äº¤ç»™è¯¥è´Ÿè´£çš„å¯¹è±¡â€ã€‚</p>
<p>å½“ä½ é¢å¯¹çš„æ˜¯å•æœºç™¾ä¸‡è¿æ¥ã€æ˜¯æå…¶å¤æ‚çš„ç½‘ç»œåè®®è§£æã€æ˜¯ç¬æ¯ä¸‡å˜çš„å¹¶å‘çŠ¶æ€æ—¶ï¼Œè¿‡ç¨‹å¼çš„æ€ç»´ä¼šè¿…é€Ÿæ¯ç«­ï¼ŒæŠŠä½ æ‹–å…¥â€œä¿®ä¸å®Œçš„ Bugâ€å’Œâ€œçœ‹ä¸æ‡‚çš„é€»è¾‘â€ä¸­ã€‚è€Œä¸€å¥—æ¸…æ™°çš„å¯¹è±¡æ¨¡å‹ï¼Œèƒ½è®©ä½ åœ¨æƒŠæ¶›éª‡æµªçš„åº•å±‚å¼€å‘ä¸­ï¼Œä¾ç„¶åƒåœ¨å†™ç®€å•çš„ä¸šåŠ¡é€»è¾‘ä¸€æ ·ä¼˜é›…ã€‚</p>
<p>é¢å‘å¯¹è±¡è®¾è®¡ï¼Œä¸æ˜¯ä¸ºäº†è®©ç®€å•çš„äº‹æƒ…å˜å¤æ‚ï¼Œè€Œæ˜¯ä¸ºäº†è®©å¤æ‚çš„äº‹æƒ…ï¼Œåœ¨æˆ‘ä»¬çš„è„‘å­é‡Œå˜ç®€å•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»åˆ†ç±»ã€æ•ˆç‡å¯¹æ¯”ã€ä¼˜åŒ–æ–¹æ¡ˆä»¥åŠå®æˆ˜åœºæ™¯æ·±å…¥ç†è§£MySQLç´¢å¼•]]></title>    <link>https://juejin.cn/post/7598435950411661322</link>    <guid>https://juejin.cn/post/7598435950411661322</guid>    <pubDate>2026-01-24T13:14:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598435950411661322" data-draft-id="7598435950411644938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»åˆ†ç±»ã€æ•ˆç‡å¯¹æ¯”ã€ä¼˜åŒ–æ–¹æ¡ˆä»¥åŠå®æˆ˜åœºæ™¯æ·±å…¥ç†è§£MySQLç´¢å¼•"/> <meta itemprop="keywords" content="åç«¯,MySQL"/> <meta itemprop="datePublished" content="2026-01-24T13:14:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰æ°´ä¸æ»´"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»åˆ†ç±»ã€æ•ˆç‡å¯¹æ¯”ã€ä¼˜åŒ–æ–¹æ¡ˆä»¥åŠå®æˆ˜åœºæ™¯æ·±å…¥ç†è§£MySQLç´¢å¼•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰æ°´ä¸æ»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T13:14:05.000Z" title="Sat Jan 24 2026 13:14:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»19åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MySQL ç´¢å¼•å…¨æ™¯æŒ‡å—ï¼šåˆ†ç±»ã€æ•ˆç‡å¯¹æ¯”ã€ä¼˜åŒ–æ–¹æ¡ˆä¸å®æˆ˜åœºæ™¯</h2>
<p>åœ¨ MySQL æ•°æ®åº“ä¸­ï¼Œç´¢å¼•æ˜¯æå‡æŸ¥è¯¢æ•ˆç‡çš„æ ¸å¿ƒæ‰‹æ®µï¼Œå¦‚åŒä¹¦ç±çš„ç›®å½•ï¼Œèƒ½è®©æ•°æ®åº“å¿«é€Ÿå®šä½æ•°æ®ï¼Œé¿å…å…¨è¡¨æ‰«æã€‚ä½†ç´¢å¼•è®¾è®¡å¹¶é â€œè¶Šå¤šè¶Šå¥½â€ï¼Œä¸åˆç†çš„ç´¢å¼•ä¼šå¯¼è‡´æ’å…¥ / æ›´æ–°æ€§èƒ½ä¸‹é™ã€å­˜å‚¨ç©ºé—´æµªè´¹ã€‚æœ¬æ–‡å°†ä»ç´¢å¼•åˆ†ç±»ã€æ•ˆç‡å¯¹æ¯”ã€ä¼˜åŒ–æ–¹æ¡ˆã€æºç å®ç°åˆ°å®æˆ˜åœºæ™¯ï¼Œå…¨é¢æ‹†è§£ MySQL ç´¢å¼•çš„è®¾è®¡ä¸ä½¿ç”¨ï¼ŒåŠ©åŠ›å¼€å‘è€…æ‰“é€ é«˜æ•ˆæ•°æ®åº“ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€MySQL ç´¢å¼•æ ¸å¿ƒåˆ†ç±»è¯¦è§£ï¼ˆç»“æ„ + è®¾è®¡ + åœºæ™¯ + æºç ï¼‰</h3>
<p>MySQL ç´¢å¼•çš„åˆ†ç±»ç»´åº¦å¤šæ ·ï¼Œæ ¸å¿ƒå¯æŒ‰ã€Œæ•°æ®ç»“æ„ã€ã€ŒåŠŸèƒ½ç”¨é€”ã€ã€Œç‰©ç†å­˜å‚¨ã€ä¸‰å¤§ç»´åº¦åˆ’åˆ†ï¼Œä¸åŒåˆ†ç±»çš„ç´¢å¼•é€‚é…ä¸åŒä¸šåŠ¡åœºæ™¯ã€‚</p>
<h4 data-id="heading-2">1.1 æŒ‰æ•°æ®ç»“æ„åˆ†ç±»ï¼ˆåº•å±‚å®ç°æ ¸å¿ƒï¼‰</h4>
<h5 data-id="heading-3">1.1.1 B + æ ‘ç´¢å¼•ï¼ˆé»˜è®¤é¦–é€‰ï¼Œæ”¯æŒæ‰€æœ‰å­˜å‚¨å¼•æ“ï¼‰</h5>
<ul>
<li>
<p><strong>ç»“æ„è®¾è®¡</strong>ï¼š</p>
<ul>
<li>å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œéå¶å­èŠ‚ç‚¹ä»…å­˜ç´¢å¼•é”®å’ŒæŒ‡é’ˆï¼›</li>
<li>å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæ’åºï¼Œé€‚é… MySQL æœ€å¸¸ç”¨çš„ç­‰å€¼ã€èŒƒå›´ã€æ’åºæŸ¥è¯¢åœºæ™¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æŸ¥æ‰¾æ•ˆç‡ç¨³å®šï¼ˆO (log n)ï¼‰ï¼Œä¸å—æ•°æ®åˆ†å¸ƒå½±å“ï¼›</li>
<li>æ”¯æŒç­‰å€¼æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢ã€æ’åºã€åˆ†ç»„ï¼›</li>
<li>ç´¢å¼•æ–‡ä»¶å°ï¼ŒIO æ•ˆç‡é«˜ï¼ˆä¸€æ¬¡ IO å¯åŠ è½½å¤šä¸ªç´¢å¼•é¡¹ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç»å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚å•†å“æŸ¥è¯¢ã€è®¢å•æŸ¥è¯¢ã€ç”¨æˆ·æŸ¥è¯¢ï¼‰ï¼Œæ˜¯ MySQL é»˜è®¤ç´¢å¼•ç±»å‹ã€‚</p>
</li>
<li>
<p><strong>æºç å®ç°ï¼ˆåˆ›å»ºè¯­å¥ï¼‰</strong> ï¼š</p>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ™®é€šB+æ ‘ç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_name <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">user</span>`(user_name);

<span class="hljs-comment">-- ä¸»é”®ç´¢å¼•ï¼ˆç‰¹æ®ŠB+æ ‘ç´¢å¼•ï¼Œèšç°‡ç´¢å¼•ï¼‰</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">PRIMARY</span> KEY (user_id);

<span class="hljs-comment">-- å”¯ä¸€ç´¢å¼•ï¼ˆB+æ ‘ç»“æ„ï¼Œå€¼å”¯ä¸€ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_user_phone <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">user</span>`(phone);
</code></pre>
<h5 data-id="heading-4">1.1.2 å“ˆå¸Œç´¢å¼•ï¼ˆä»… Memory å¼•æ“æ”¯æŒï¼ŒInnoDB ä¸ºè‡ªé€‚åº”å“ˆå¸Œï¼‰</h5>
<ul>
<li>
<p><strong>ç»“æ„è®¾è®¡</strong>ï¼šåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œé€šè¿‡ç´¢å¼•é”®è®¡ç®—å“ˆå¸Œå€¼ï¼Œç›´æ¥æ˜ å°„åˆ°æ•°æ®å­˜å‚¨åœ°å€ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ç­‰å€¼æŸ¥è¯¢æå¿«ï¼ˆO (1)ï¼‰ï¼Œæ— éœ€éå†æ ‘ç»“æ„ï¼›</li>
<li>ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€æ’åºã€æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆå“ˆå¸Œå€¼æ— åºï¼‰ï¼›</li>
<li>å­˜åœ¨å“ˆå¸Œå†²çªï¼Œéœ€é“¾è¡¨è§£å†³ï¼Œå†²çªè¿‡å¤šä¼šå½±å“æ€§èƒ½ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šä»…é€‚ç”¨äºã€Œé«˜é¢‘ç­‰å€¼æŸ¥è¯¢ã€æ— èŒƒå›´ / æ’åºéœ€æ±‚ã€çš„åœºæ™¯ï¼ˆå¦‚ç¼“å­˜ key æŸ¥è¯¢ã€å­—å…¸æ˜ å°„ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æºç å®ç°ï¼ˆä»… Memory å¼•æ“ï¼‰</strong> ï¼š</p>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºMemoryå¼•æ“è¡¨ï¼ŒæŒ‡å®šå“ˆå¸Œç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `cache_table` (
  `cache_key` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `cache_value` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`cache_key`) <span class="hljs-keyword">USING</span> HASH
) ENGINE<span class="hljs-operator">=</span>MEMORY <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;

<span class="hljs-comment">-- æ‰‹åŠ¨åˆ›å»ºå“ˆå¸Œç´¢å¼•ï¼ˆMemoryå¼•æ“ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_cache_key <span class="hljs-keyword">ON</span> `cache_table`(cache_key) <span class="hljs-keyword">USING</span> HASH;
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šInnoDB ä¸æ”¯æŒæ‰‹åŠ¨åˆ›å»ºå“ˆå¸Œç´¢å¼•ï¼Œä¼šæ ¹æ®æŸ¥è¯¢é¢‘ç‡è‡ªåŠ¨ä¸ºçƒ­ç‚¹ B + æ ‘ç´¢å¼•åˆ›å»ºã€Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€ï¼Œæå‡ç­‰å€¼æŸ¥è¯¢æ•ˆç‡ã€‚</p>
</blockquote>
<h5 data-id="heading-5">1.1.3 å…¨æ–‡ç´¢å¼•ï¼ˆæ”¯æŒæ–‡æœ¬æ¨¡ç³ŠåŒ¹é…ï¼‰</h5>
<ul>
<li>
<p><strong>ç»“æ„è®¾è®¡</strong>ï¼šåŸºäºã€Œå€’æ’ç´¢å¼•ã€å®ç°ï¼Œå°†æ–‡æœ¬å†…å®¹æ‹†åˆ†ä¸ºå…³é”®è¯ï¼ˆåˆ†è¯ï¼‰ï¼Œæ˜ å°„åˆ°åŒ…å«è¯¥å…³é”®è¯çš„è®°å½•è¡Œã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒå…¨æ–‡æ¨¡ç³ŠåŒ¹é…ï¼ˆ<code>MATCH AGAINST</code>ï¼‰ï¼Œæ¯”<code>LIKE '%xxx%'</code>æ•ˆç‡é«˜ 10 å€ä»¥ä¸Šï¼›</li>
<li>æ”¯æŒè‡ªç„¶è¯­è¨€æœç´¢ã€å¸ƒå°”æœç´¢ï¼ˆå¦‚<code>+å…³é”®è¯ -æ’é™¤è¯</code>ï¼‰ï¼›</li>
<li>ä»…æ”¯æŒ CHARã€VARCHARã€TEXT ç±»å‹å­—æ®µã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ–‡æœ¬å†…å®¹æœç´¢ï¼ˆå¦‚å•†å“æè¿°æœç´¢ã€æ–‡ç« å†…å®¹æœç´¢ã€è¯„è®ºå…³é”®è¯æœç´¢ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æºç å®ç°</strong>ï¼š</p>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼ˆå•å­—æ®µï¼‰</span>
<span class="hljs-keyword">CREATE</span> FULLTEXT INDEX idx_goods_desc <span class="hljs-keyword">ON</span> `goods`(goods_desc);

<span class="hljs-comment">-- åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼ˆå¤šå­—æ®µè”åˆï¼‰</span>
<span class="hljs-keyword">CREATE</span> FULLTEXT INDEX idx_article_title_content <span class="hljs-keyword">ON</span> `article`(title, content);

<span class="hljs-comment">-- å…¨æ–‡æœç´¢æŸ¥è¯¢ï¼ˆè‡ªç„¶è¯­è¨€æ¨¡å¼ï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `goods` 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(goods_desc) AGAINST(<span class="hljs-string">'é«˜æ€§èƒ½ æ™ºèƒ½æ‰‹æœº'</span> <span class="hljs-keyword">IN</span> <span class="hljs-keyword">NATURAL</span> <span class="hljs-keyword">LANGUAGE</span> MODE);

<span class="hljs-comment">-- å…¨æ–‡æœç´¢æŸ¥è¯¢ï¼ˆå¸ƒå°”æ¨¡å¼ï¼Œæ”¯æŒ+/-é€»è¾‘ï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `article` 
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(title, content) AGAINST(<span class="hljs-string">'+MySQL -å…¥é—¨'</span> <span class="hljs-keyword">IN</span> <span class="hljs-type">BOOLEAN</span> MODE);
</code></pre>
<h5 data-id="heading-6">1.1.4 R æ ‘ç´¢å¼•ï¼ˆç©ºé—´ç´¢å¼•ï¼Œæ”¯æŒåœ°ç†ä½ç½®æŸ¥è¯¢ï¼‰</h5>
<ul>
<li>
<p><strong>ç»“æ„è®¾è®¡</strong>ï¼šä¸“ä¸ºç©ºé—´æ•°æ®è®¾è®¡çš„ç´¢å¼•ï¼Œé€šè¿‡æœ€å°è¾¹ç•ŒçŸ©å½¢ï¼ˆMBRï¼‰ç»„ç»‡ç©ºé—´æ•°æ®ï¼Œæ”¯æŒå¤šç»´æ•°æ®æŸ¥è¯¢ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒç©ºé—´å…³ç³»æŸ¥è¯¢ï¼ˆå¦‚è·ç¦»ã€åŒ…å«ã€ç›¸äº¤ï¼‰ï¼›</li>
<li>ä»…é€‚ç”¨äº GISï¼ˆåœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼‰ç›¸å…³å­—æ®µï¼ˆå¦‚ POINTã€POLYGONï¼‰ï¼›</li>
<li>ä»… InnoDBã€MyISAM å¼•æ“æ”¯æŒã€‚</li>
</ul>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåœ°ç†ä½ç½®ç›¸å…³æŸ¥è¯¢ï¼ˆå¦‚é™„è¿‘åº—é“ºã€èŒƒå›´å›´æ ã€è·¯çº¿è§„åˆ’ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æºç å®ç°</strong>ï¼š</p>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. åˆ›å»ºåŒ…å«ç©ºé—´å­—æ®µçš„è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `shop` (
  `shop_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
  `shop_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `location` POINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- å­˜å‚¨ç»çº¬åº¦ï¼ˆçº¬åº¦ï¼Œç»åº¦ï¼‰</span>
  SPATIAL INDEX idx_shop_location (location) <span class="hljs-comment">-- åˆ›å»ºRæ ‘ç©ºé—´ç´¢å¼•</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;

<span class="hljs-comment">-- 2. æ’å…¥æ•°æ®ï¼ˆç»çº¬åº¦ï¼šåŒ—äº¬å¤©å®‰é—¨ 39.9042, 116.4074ï¼‰</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `shop` (shop_name, location)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'å¤©å®‰é—¨åº—'</span>, ST_GeomFromText(<span class="hljs-string">'POINT(39.9042 116.4074)'</span>));

<span class="hljs-comment">-- 3. æŸ¥è¯¢é™„è¿‘1å…¬é‡Œå†…çš„åº—é“ºï¼ˆå•ä½ï¼šç±³ï¼‰</span>
<span class="hljs-keyword">SELECT</span> shop_name, 
       ST_Distance_Sphere(location, ST_GeomFromText(<span class="hljs-string">'POINT(39.9052 116.4084)'</span>)) <span class="hljs-keyword">AS</span> distance
<span class="hljs-keyword">FROM</span> `shop`
<span class="hljs-keyword">WHERE</span> ST_Distance_Sphere(location, ST_GeomFromText(<span class="hljs-string">'POINT(39.9052 116.4084)'</span>)) <span class="hljs-operator">&lt;=</span> <span class="hljs-number">1000</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> distance;
</code></pre>
<h4 data-id="heading-7">1.2 æŒ‰åŠŸèƒ½ç”¨é€”åˆ†ç±»ï¼ˆå®é™…å¼€å‘å¸¸ç”¨ï¼‰</h4>
<h5 data-id="heading-8">1.2.1 ä¸»é”®ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ï¼‰</h5>
<ul>
<li><strong>è®¾è®¡ç‰¹ç‚¹</strong>ï¼šå”¯ä¸€æ ‡è¯†è¡¨ä¸­è®°å½•ï¼Œå­—æ®µéç©ºä¸”å”¯ä¸€ï¼ŒInnoDB ä¸­ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨æ•´è¡Œæ•°æ®ï¼ˆèšç°‡ç´¢å¼•ç‰¹æ€§ï¼‰ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰€æœ‰è¡¨å¿…é¡»åˆ›å»ºä¸»é”®ï¼ˆå”¯ä¸€æ ‡è¯†è®°å½•ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ï¼‰ï¼Œä¼˜å…ˆä½¿ç”¨è‡ªå¢ bigint ç±»å‹ï¼ˆé¿å…é¡µåˆ†è£‚ï¼‰ã€‚</li>
<li><strong>æºç å®ç°</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å»ºè¡¨æ—¶æŒ‡å®šä¸»é”®</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">order</span>` (
  `order_id` <span class="hljs-type">bigint</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY, <span class="hljs-comment">-- è‡ªå¢ä¸»é”®ï¼ˆæ¨èï¼‰</span>
  `user_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `order_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);

<span class="hljs-comment">-- å·²æœ‰è¡¨æ·»åŠ ä¸»é”®</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">order</span>` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">PRIMARY</span> KEY (order_id);
</code></pre>
<h5 data-id="heading-9">1.2.2 å”¯ä¸€ç´¢å¼•</h5>
<ul>
<li><strong>è®¾è®¡ç‰¹ç‚¹</strong>ï¼šå­—æ®µå€¼å”¯ä¸€ï¼ˆå…è®¸ NULLï¼Œæœ€å¤šä¸€ä¸ª NULLï¼‰ï¼Œé¿å…é‡å¤æ•°æ®ï¼ŒB + æ ‘ç»“æ„ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€ä¿è¯å­—æ®µå”¯ä¸€æ€§çš„åœºæ™¯ï¼ˆå¦‚æ‰‹æœºå·ã€èº«ä»½è¯å·ã€ç”¨æˆ·åã€è®¢å•ç¼–å·ï¼‰ã€‚</li>
<li><strong>æºç å®ç°</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_user_phone <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">user</span>`(phone);
<span class="hljs-comment">-- æˆ–å»ºè¡¨æ—¶æŒ‡å®š</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">user</span>` (
  `user_id` <span class="hljs-type">bigint</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
  `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">UNIQUE</span> KEY idx_user_phone (phone)
);
</code></pre>
<h5 data-id="heading-10">1.2.3 æ™®é€šç´¢å¼•ï¼ˆå•åˆ—ç´¢å¼•ï¼‰</h5>
<ul>
<li><strong>è®¾è®¡ç‰¹ç‚¹</strong>ï¼šæœ€åŸºç¡€çš„ç´¢å¼•ï¼Œä»…åŒ…å«å•ä¸ªå­—æ®µï¼Œæ— å”¯ä¸€æ€§çº¦æŸã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå•ä¸ªå­—æ®µçš„ç­‰å€¼æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚æŒ‰ç”¨æˆ· ID æŸ¥è¯¢è®¢å•ã€æŒ‰æ—¶é—´æŸ¥è¯¢æ—¥å¿—ï¼‰ã€‚</li>
<li><strong>æºç å®ç°</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_order_user_id <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">order</span>`(user_id);
<span class="hljs-keyword">CREATE</span> INDEX idx_log_create_time <span class="hljs-keyword">ON</span> `sys_log`(create_time);
</code></pre>
<h5 data-id="heading-11">1.2.4 ç»„åˆç´¢å¼•ï¼ˆå¤šåˆ—ç´¢å¼•ï¼‰</h5>
<ul>
<li><strong>è®¾è®¡ç‰¹ç‚¹</strong>ï¼šåŒ…å«å¤šä¸ªå­—æ®µçš„ç´¢å¼•ï¼Œéµå¾ªã€Œæœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ã€ï¼ŒB + æ ‘æŒ‰å­—æ®µé¡ºåºæ’åºã€‚</li>
<li><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šå°†æŸ¥è¯¢é¢‘ç‡é«˜ã€åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å‰é¢ï¼ˆå¦‚<code>(user_id, order_time)</code>æ¯”<code>(order_time, user_id)</code>æ›´ä¼˜ï¼Œè‹¥é«˜é¢‘æŸ¥è¯¢<code>WHERE user_id=? AND order_time&gt;?</code>ï¼‰ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¤šå­—æ®µè”åˆæŸ¥è¯¢ï¼ˆå¦‚ç”µå•†å•†å“åˆ—è¡¨ï¼š<code>WHERE category_id=? AND price BETWEEN ? AND ?</code>ï¼‰ã€‚</li>
<li><strong>æºç å®ç°</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç»„åˆç´¢å¼•ï¼ˆcategory_idï¼šé«˜é¢‘æŸ¥è¯¢å­—æ®µï¼Œpriceï¼šèŒƒå›´æŸ¥è¯¢å­—æ®µï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_goods_category_price <span class="hljs-keyword">ON</span> `goods`(category_id, price);

<span class="hljs-comment">-- æœ‰æ•ˆæŸ¥è¯¢ï¼ˆåŒ¹é…æœ€å·¦å‰ç¼€ï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `goods` <span class="hljs-keyword">WHERE</span> category_id<span class="hljs-operator">=</span><span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> price <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">2000</span>; <span class="hljs-comment">-- å‘½ä¸­ç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `goods` <span class="hljs-keyword">WHERE</span> category_id<span class="hljs-operator">=</span><span class="hljs-number">100</span>; <span class="hljs-comment">-- å‘½ä¸­ç´¢å¼•ï¼ˆä»…ç”¨å‰1åˆ—ï¼‰</span>

<span class="hljs-comment">-- æ— æ•ˆæŸ¥è¯¢ï¼ˆä¸åŒ¹é…æœ€å·¦å‰ç¼€ï¼Œå…¨è¡¨æ‰«æï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `goods` <span class="hljs-keyword">WHERE</span> price <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">2000</span>; <span class="hljs-comment">-- æœªå‘½ä¸­ç´¢å¼•</span>
</code></pre>
<h5 data-id="heading-12">1.2.5 å‰ç¼€ç´¢å¼•ï¼ˆå­—ç¬¦ä¸²æˆªå–ç´¢å¼•ï¼‰</h5>
<ul>
<li><strong>è®¾è®¡ç‰¹ç‚¹</strong>ï¼šæˆªå–å­—ç¬¦ä¸²çš„å‰ N ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼Œå‡å°‘ç´¢å¼•å­˜å‚¨ç©ºé—´ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡ã€‚</li>
<li><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šé€šè¿‡<code>COUNT(DISTINCT LEFT(column, N))/COUNT(*)</code>è®¡ç®—åŒºåˆ†åº¦ï¼Œç¡®ä¿ N è¶³å¤Ÿå¤§ï¼ˆåŒºåˆ†åº¦â‰¥90%ï¼‰ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé•¿å­—ç¬¦ä¸²å­—æ®µï¼ˆå¦‚æ‰‹æœºå·ã€é‚®ç®±ã€URLï¼‰ï¼Œæ— éœ€å®Œæ•´åŒ¹é…çš„åœºæ™¯ã€‚</li>
<li><strong>æºç å®ç°</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ‰‹æœºå·å‰ç¼€ç´¢å¼•ï¼ˆå‰11ä½å³å®Œæ•´æ‰‹æœºå·ï¼ŒåŒºåˆ†åº¦100%ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_phone_prefix <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">user</span>`(<span class="hljs-keyword">LEFT</span>(phone, <span class="hljs-number">11</span>));

<span class="hljs-comment">-- é‚®ç®±å‰ç¼€ç´¢å¼•ï¼ˆå‰20ä½åŒºåˆ†åº¦è¶³å¤Ÿï¼Œé¿å…å­˜å‚¨å®Œæ•´é‚®ç®±ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_email_prefix <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">user</span>`(<span class="hljs-keyword">LEFT</span>(email, <span class="hljs-number">20</span>));

<span class="hljs-comment">-- æŸ¥è¯¢ï¼ˆè‡ªåŠ¨åŒ¹é…å‰ç¼€ç´¢å¼•ï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">WHERE</span> phone<span class="hljs-operator">=</span><span class="hljs-string">'13800138000'</span>; <span class="hljs-comment">-- å‘½ä¸­å‰ç¼€ç´¢å¼•</span>
</code></pre>
<h5 data-id="heading-13">1.2.6 è¦†ç›–ç´¢å¼•</h5>
<ul>
<li><strong>è®¾è®¡ç‰¹ç‚¹</strong>ï¼šç´¢å¼•åŒ…å«æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰å­—æ®µï¼ˆæ— éœ€å›è¡¨æŸ¥è¯¢èšç°‡ç´¢å¼•ï¼‰ï¼ŒæŸ¥è¯¢æ•ˆç‡æœ€é«˜ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šé«˜é¢‘æŸ¥è¯¢ä¸”å­—æ®µè¾ƒå°‘çš„åœºæ™¯ï¼ˆå¦‚ç”¨æˆ·ç™»å½•ï¼š<code>SELECT user_id, password FROM user WHERE phone=?</code>ï¼‰ã€‚</li>
<li><strong>æºç å®ç°</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¦†ç›–ç´¢å¼•ï¼ˆåŒ…å«phoneã€user_idã€passwordï¼ŒæŸ¥è¯¢æ— éœ€å›è¡¨ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_phone_cover <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">user</span>`(phone, user_id, password);

<span class="hljs-comment">-- å‘½ä¸­è¦†ç›–ç´¢å¼•ï¼ˆEXPLAINæ˜¾ç¤ºExtra=Using indexï¼‰</span>
<span class="hljs-keyword">SELECT</span> user_id, password <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">WHERE</span> phone<span class="hljs-operator">=</span><span class="hljs-string">'13800138000'</span>;
</code></pre>
<h4 data-id="heading-14">1.3 æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»ï¼ˆInnoDB æ ¸å¿ƒï¼‰</h4>
<h5 data-id="heading-15">1.3.1 èšç°‡ç´¢å¼•ï¼ˆClustered Indexï¼‰</h5>
<ul>
<li>
<p><strong>ç»“æ„è®¾è®¡</strong>ï¼šInnoDB çš„æ ¸å¿ƒç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨ã€Œæ•´è¡Œæ•°æ®ã€ï¼Œè¡¨ä¸­åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•ã€‚</p>
</li>
<li>
<p><strong>é»˜è®¤è§„åˆ™</strong>ï¼š</p>
<ul>
<li>æœ‰ä¸»é”®æ—¶ï¼Œä¸»é”®ç´¢å¼•å³ä¸ºèšç°‡ç´¢å¼•ï¼›</li>
<li>æ— ä¸»é”®æ—¶ï¼Œé€‰æ‹©å”¯ä¸€éç©ºç´¢å¼•ä½œä¸ºèšç°‡ç´¢å¼•ï¼›</li>
<li>æ— ä¸Šè¿°ç´¢å¼•æ—¶ï¼ŒInnoDB è‡ªåŠ¨åˆ›å»ºéšè—çš„<code>row_id</code>ä½œä¸ºèšç°‡ç´¢å¼•ã€‚</li>
</ul>
</li>
<li>
<p><strong>æŸ¥è¯¢è·¯å¾„</strong>ï¼šé€šè¿‡èšç°‡ç´¢å¼•æŸ¥è¯¢ç›´æ¥è·å–æ•°æ®ï¼Œæ— éœ€å›è¡¨ã€‚</p>
</li>
</ul>
<h5 data-id="heading-16">1.3.2 éèšç°‡ç´¢å¼•ï¼ˆSecondary Indexï¼‰</h5>
<ul>
<li><strong>ç»“æ„è®¾è®¡</strong>ï¼šå¶å­èŠ‚ç‚¹å­˜å‚¨ã€Œèšç°‡ç´¢å¼•é”®ï¼ˆä¸»é”®ï¼‰ã€ï¼Œè€Œéæ•´è¡Œæ•°æ®ã€‚</li>
<li><strong>æŸ¥è¯¢è·¯å¾„</strong>ï¼šéèšç°‡ç´¢å¼•æŸ¥è¯¢ â†’ è·å–ä¸»é”® â†’ èšç°‡ç´¢å¼•æŸ¥è¯¢ â†’ è·å–æ•°æ®ï¼ˆéœ€å›è¡¨ï¼Œé™¤éæ˜¯è¦†ç›–ç´¢å¼•ï¼‰ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šæ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€ç»„åˆç´¢å¼•å‡ä¸ºéèšç°‡ç´¢å¼•ã€‚</li>
</ul>
<h3 data-id="heading-17">äºŒã€å„ç±»ç´¢å¼•æŸ¥è¯¢æ•ˆç‡å¯¹æ¯”ï¼ˆç›´è§‚è¡¨æ ¼ï¼‰</h3>








































































































<table><thead><tr><th>ç´¢å¼•ç±»å‹</th><th>ç­‰å€¼æŸ¥è¯¢</th><th>èŒƒå›´æŸ¥è¯¢</th><th>æ’åºæŸ¥è¯¢</th><th>æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆæ–‡æœ¬ï¼‰</th><th>ç©ºé—´æŸ¥è¯¢</th><th>å­˜å‚¨æˆæœ¬</th><th>æ’å…¥ / æ›´æ–°æ•ˆç‡</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>B + æ ‘ç´¢å¼•ï¼ˆä¸»é”®ï¼‰</td><td>æé«˜</td><td>æé«˜</td><td>æé«˜</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸­</td><td>ä¸­</td><td>å”¯ä¸€æ ‡è¯†ã€é«˜é¢‘ä¸»é”®æŸ¥è¯¢</td></tr><tr><td>B + æ ‘ç´¢å¼•ï¼ˆæ™®é€šï¼‰</td><td>é«˜</td><td>é«˜</td><td>é«˜</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸­</td><td>ä¸­</td><td>å•åˆ—ç­‰å€¼ / èŒƒå›´æŸ¥è¯¢</td></tr><tr><td>B + æ ‘ç´¢å¼•ï¼ˆç»„åˆï¼‰</td><td>é«˜</td><td>é«˜</td><td>é«˜</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸­é«˜</td><td>ä¸­ä½</td><td>å¤šå­—æ®µè”åˆæŸ¥è¯¢ã€æ’åº</td></tr><tr><td>å“ˆå¸Œç´¢å¼•</td><td>æé«˜</td><td>æä½ï¼ˆä¸æ”¯æŒï¼‰</td><td>æä½ï¼ˆä¸æ”¯æŒï¼‰</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä½</td><td>é«˜</td><td>é«˜é¢‘ç­‰å€¼æŸ¥è¯¢ï¼ˆå¦‚ç¼“å­˜ï¼‰</td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>ä½</td><td>ä½</td><td>ä¸æ”¯æŒ</td><td>æé«˜</td><td>ä¸æ”¯æŒ</td><td>é«˜</td><td>ä½</td><td>æ–‡æœ¬å†…å®¹æœç´¢ï¼ˆæè¿°ã€è¯„è®ºï¼‰</td></tr><tr><td>R æ ‘ç´¢å¼•</td><td>ä½</td><td>ä¸­</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æé«˜</td><td>é«˜</td><td>ä½</td><td>åœ°ç†ä½ç½®æŸ¥è¯¢ï¼ˆé™„è¿‘ã€å›´æ ï¼‰</td></tr><tr><td>å‰ç¼€ç´¢å¼•</td><td>ä¸­é«˜</td><td>ä¸­</td><td>ä¸­</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä½</td><td>é«˜</td><td>é•¿å­—ç¬¦ä¸²å­—æ®µç­‰å€¼æŸ¥è¯¢</td></tr><tr><td>è¦†ç›–ç´¢å¼•</td><td>æé«˜</td><td>æé«˜</td><td>æé«˜</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸­é«˜</td><td>ä¸­ä½</td><td>é«˜é¢‘å°‘å­—æ®µæŸ¥è¯¢ï¼ˆæ— éœ€å›è¡¨ï¼‰</td></tr></tbody></table>
<blockquote>
<p>æ ¸å¿ƒç»“è®ºï¼šB + æ ‘ç´¢å¼•ï¼ˆå«ä¸»é”®ã€æ™®é€šã€ç»„åˆã€è¦†ç›–ï¼‰æ˜¯é€šç”¨æ€§æœ€å¼ºã€æ•ˆç‡æœ€å‡è¡¡çš„ç´¢å¼•ï¼Œé€‚ç”¨äº 90% ä»¥ä¸Šçš„ä¸šåŠ¡åœºæ™¯ï¼›å…¶ä»–ç´¢å¼•ä»…åœ¨ç‰¹å®šåœºæ™¯ï¼ˆæ–‡æœ¬æœç´¢ã€ç©ºé—´æŸ¥è¯¢ï¼‰ä¸­å‘æŒ¥ä¼˜åŠ¿ã€‚</p>
</blockquote>
<h3 data-id="heading-18">ä¸‰ã€æé«˜ MySQL æŸ¥è¯¢æ•ˆç‡çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæºç  + å®æ“ï¼‰</h3>
<h4 data-id="heading-19">3.1 ç´¢å¼•ä¼˜åŒ–ï¼ˆæ ¸å¿ƒæ–¹æ¡ˆï¼‰</h4>
<h5 data-id="heading-20">3.1.1 åˆ›å»ºé«˜æ•ˆç´¢å¼•çš„åŸåˆ™ä¸æºç </h5>
<ul>
<li>åŸåˆ™ 1ï¼šä¼˜å…ˆåˆ›å»ºèšç°‡ç´¢å¼•ï¼ˆä¸»é”®ï¼‰ï¼Œä½¿ç”¨è‡ªå¢ bigint ç±»å‹ï¼ˆé¿å…é¡µåˆ†è£‚ï¼‰ï¼›</li>
<li>åŸåˆ™ 2ï¼šé«˜é¢‘æŸ¥è¯¢å­—æ®µä¼˜å…ˆåˆ›å»ºç´¢å¼•ï¼ŒåŒºåˆ†åº¦ä½çš„å­—æ®µï¼ˆå¦‚æ€§åˆ«ã€çŠ¶æ€ï¼‰æ— éœ€åˆ›å»ºç´¢å¼•ï¼›</li>
<li>åŸåˆ™ 3ï¼šå¤šå­—æ®µæŸ¥è¯¢åˆ›å»ºç»„åˆç´¢å¼•ï¼Œéµå¾ªã€Œæœ€å·¦å‰ç¼€åŒ¹é…ã€ï¼Œé«˜é¢‘å­—æ®µæ”¾å‰é¢ï¼›</li>
<li>åŸåˆ™ 4ï¼šé•¿å­—ç¬¦ä¸²ç”¨å‰ç¼€ç´¢å¼•ï¼Œå¹³è¡¡åŒºåˆ†åº¦å’Œå­˜å‚¨æˆæœ¬ï¼›</li>
<li>åŸåˆ™ 5ï¼šé¿å…è¿‡åº¦ç´¢å¼•ï¼ˆç´¢å¼•æ•°é‡â‰¤5 ä¸ª / è¡¨ï¼‰ï¼Œå‡å°‘æ’å…¥ / æ›´æ–°å¼€é”€ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åä¾‹ï¼šåŒºåˆ†åº¦ä½çš„å­—æ®µåˆ›å»ºç´¢å¼•ï¼ˆæ€§åˆ«ï¼šç”·/å¥³ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_gender <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">user</span>`(gender); <span class="hljs-comment">-- æ— æ•ˆï¼ŒæŸ¥è¯¢ä¼˜åŒ–æœ‰é™</span>

<span class="hljs-comment">-- æ­£ä¾‹ï¼šç»„åˆç´¢å¼•ä¼˜åŒ–å¤šå­—æ®µæŸ¥è¯¢</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_order_userid_time_status <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">order</span>`(user_id, order_time, status);
<span class="hljs-comment">-- æ”¯æŒæŸ¥è¯¢ï¼šWHERE user_id=? AND order_time&gt;? AND status=?ï¼ˆå‘½ä¸­ç´¢å¼•ï¼‰</span>
</code></pre>
<h5 data-id="heading-21">3.1.2 é¿å…ç´¢å¼•å¤±æ•ˆçš„å…³é”®æŠ€å·§ï¼ˆæºç å¯¹æ¯”ï¼‰</h5>
<p>ç´¢å¼•å¤±æ•ˆä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œä»¥ä¸‹æ˜¯å¸¸è§å¤±æ•ˆåœºæ™¯åŠä¼˜åŒ–æ–¹æ¡ˆï¼š</p>



































<table><thead><tr><th>å¤±æ•ˆåœºæ™¯</th><th>åä¾‹ SQL</th><th>ä¼˜åŒ–å SQLï¼ˆå‘½ä¸­ç´¢å¼•ï¼‰</th></tr></thead><tbody><tr><td>å‡½æ•°æ“ä½œç´¢å¼•å­—æ®µ</td><td>SELECT * FROM <code>goods</code> WHERE LEFT (name,3)=' æ‰‹æœº ';</td><td>CREATE INDEX idx_goods_name_prefix ON <code>goods</code>(LEFT(name,3));SELECT * FROM <code>goods</code> WHERE LEFT (name,3)=' æ‰‹æœº ';</td></tr><tr><td>éšå¼ç±»å‹è½¬æ¢</td><td>SELECT * FROM <code>user</code> WHERE phone=13800138000;ï¼ˆphone ä¸º varcharï¼‰</td><td>SELECT * FROM <code>user</code> WHERE phone='13800138000';</td></tr><tr><td>ç»„åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦å‰ç¼€</td><td>SELECT * FROM <code>goods</code> WHERE price&gt;1000;ï¼ˆç»„åˆç´¢å¼•ï¼šcategory_id, priceï¼‰</td><td>è°ƒæ•´ç´¢å¼•é¡ºåºä¸º (price, category_id) æˆ– è¡¥å…… category_id æ¡ä»¶</td></tr><tr><td>ä½¿ç”¨ OR è¿æ¥éç´¢å¼•å­—æ®µ</td><td>SELECT * FROM <code>user</code> WHERE user_id=1 OR age=20;ï¼ˆage æ— ç´¢å¼•ï¼‰</td><td>SELECT * FROM <code>user</code> WHERE user_id=1UNION ALLSELECT * FROM <code>user</code> WHERE age=20;ï¼ˆæˆ–ç»™ age åˆ›å»ºç´¢å¼•ï¼‰</td></tr><tr><td>LIKE ä»¥ % å¼€å¤´</td><td>SELECT * FROM <code>goods</code> WHERE name LIKE '% æ‰‹æœº ';</td><td>ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼šCREATE FULLTEXT INDEX idx_goods_name ON <code>goods</code>(name);SELECT * FROM <code>goods</code> WHERE MATCH (name) AGAINST (' æ‰‹æœº ');</td></tr></tbody></table>
<h4 data-id="heading-22">3.2 SQL è¯­å¥ä¼˜åŒ–ï¼ˆæºç å¯¹æ¯”ï¼‰</h4>
<h5 data-id="heading-23">3.2.1 é¿å…å…¨è¡¨æ‰«æ</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åä¾‹ï¼šæ— ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">order</span>` <span class="hljs-keyword">WHERE</span> order_time<span class="hljs-operator">&gt;</span><span class="hljs-string">'2024-01-01'</span>;

<span class="hljs-comment">-- æ­£ä¾‹ï¼šåˆ›å»ºç´¢å¼•ï¼Œå‘½ä¸­ç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_order_time <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">order</span>`(order_time);
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">order</span>` <span class="hljs-keyword">WHERE</span> order_time<span class="hljs-operator">&gt;</span><span class="hljs-string">'2024-01-01'</span>;
</code></pre>
<h5 data-id="heading-24">3.2.2 ä¼˜åŒ– JOIN æŸ¥è¯¢ï¼ˆé¿å…ç¬›å¡å°”ç§¯ï¼‰</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åä¾‹ï¼šå¤šè¡¨JOINæ— ç´¢å¼•ï¼Œç¬›å¡å°”ç§¯å¯¼è‡´æ•ˆç‡æä½</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">order</span>` o <span class="hljs-keyword">JOIN</span> `order_item` oi <span class="hljs-keyword">ON</span> o.order_id<span class="hljs-operator">=</span>oi.order_id <span class="hljs-keyword">WHERE</span> o.user_id<span class="hljs-operator">=</span><span class="hljs-number">100</span>;

<span class="hljs-comment">-- æ­£ä¾‹ï¼šç»™JOINå­—æ®µå’ŒæŸ¥è¯¢æ¡ä»¶åˆ›å»ºç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_order_user_id <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">order</span>`(user_id); <span class="hljs-comment">-- æŸ¥è¯¢æ¡ä»¶ç´¢å¼•</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_order_item_order_id <span class="hljs-keyword">ON</span> `order_item`(order_id); <span class="hljs-comment">-- JOINå­—æ®µç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> o.order_id, o.order_time, oi.goods_id <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">order</span>` o <span class="hljs-keyword">JOIN</span> `order_item` oi <span class="hljs-keyword">ON</span> o.order_id<span class="hljs-operator">=</span>oi.order_id <span class="hljs-keyword">WHERE</span> o.user_id<span class="hljs-operator">=</span><span class="hljs-number">100</span>;
</code></pre>
<h5 data-id="heading-25">3.2.3 ä¼˜åŒ–å­æŸ¥è¯¢ï¼ˆè½¬ JOINï¼‰</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åä¾‹ï¼šå­æŸ¥è¯¢æ•ˆç‡ä½ï¼Œå¤šæ¬¡æ‰«æè¡¨</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `goods` <span class="hljs-keyword">WHERE</span> category_id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> category_id <span class="hljs-keyword">FROM</span> `category` <span class="hljs-keyword">WHERE</span> parent_id<span class="hljs-operator">=</span><span class="hljs-number">10</span>);

<span class="hljs-comment">-- æ­£ä¾‹ï¼šå­æŸ¥è¯¢è½¬JOINï¼Œä¸€æ¬¡æ‰«æ</span>
<span class="hljs-keyword">SELECT</span> g.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `goods` g <span class="hljs-keyword">JOIN</span> `category` c <span class="hljs-keyword">ON</span> g.category_id<span class="hljs-operator">=</span>c.category_id <span class="hljs-keyword">WHERE</span> c.parent_id<span class="hljs-operator">=</span><span class="hljs-number">10</span>;
</code></pre>
<h5 data-id="heading-26">3.2.4 åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–ï¼ˆé¿å… offset è¿‡å¤§ï¼‰</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åä¾‹ï¼šoffset=10000ï¼Œå…¨è¡¨æ‰«æåˆ°ç¬¬10000æ¡ï¼Œæ•ˆç‡ä½</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">order</span>` <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">100</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> order_time <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10000</span>, <span class="hljs-number">10</span>;

<span class="hljs-comment">-- æ­£ä¾‹ï¼šç”¨ç´¢å¼•è¦†ç›–+ä¸»é”®è¿‡æ»¤ï¼Œé¿å…å…¨è¡¨æ‰«æ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">order</span>` 
<span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> order_id <span class="hljs-operator">&lt;</span> (<span class="hljs-keyword">SELECT</span> order_id <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">order</span>` <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">100</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> order_time <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10000</span>, <span class="hljs-number">1</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> order_time <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>;
</code></pre>
<h4 data-id="heading-27">3.3 è¡¨ç»“æ„ä¼˜åŒ–ï¼ˆæºç å®ç°ï¼‰</h4>
<h5 data-id="heading-28">3.3.1 èŒƒå¼è®¾è®¡ï¼ˆé¿å…å†—ä½™ï¼‰</h5>
<ul>
<li>åŸåˆ™ï¼šéµå¾ªç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼Œå°†å†—ä½™æ•°æ®æ‹†åˆ†åˆ°å­è¡¨ï¼ˆå¦‚è®¢å•è¡¨ä¸è®¢å•æ˜ç»†è¡¨æ‹†åˆ†ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è®¢å•ä¸»è¡¨</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">order</span>` (
  `order_id` <span class="hljs-type">bigint</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
  `user_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `order_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `total_amount` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);

<span class="hljs-comment">-- è®¢å•æ˜ç»†è¡¨ï¼ˆæ‹†åˆ†å†—ä½™æ•°æ®ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `order_item` (
  `item_id` <span class="hljs-type">bigint</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
  `order_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `goods_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `goods_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `price` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `quantity` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  INDEX idx_order_item_order_id (order_id)
);
</code></pre>
<h5 data-id="heading-29">3.3.2 åˆ†åº“åˆ†è¡¨ï¼ˆè§£å†³å¤§æ•°æ®é‡é—®é¢˜ï¼‰</h5>
<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šå•è¡¨æ•°æ®é‡â‰¥1000 ä¸‡è¡Œï¼ŒæŸ¥è¯¢æ•ˆç‡ä¸‹é™ã€‚</li>
<li>å®ç°æ–¹å¼ï¼šSharding-JDBCï¼ˆå®¢æˆ·ç«¯åˆ†ç‰‡ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. å¼•å…¥Sharding-JDBCä¾èµ–ï¼ˆpom.xmlï¼‰</span>
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
    &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;<span class="hljs-number">4.1</span><span class="hljs-number">.1</span>&lt;/version&gt;
&lt;/dependency&gt;

<span class="hljs-comment">// 2. é…ç½®åˆ†åº“åˆ†è¡¨ï¼ˆapplication.ymlï¼‰</span>
spring:
  shardingsphere:
    datasource:
      names: db0, db1
      db0:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql:<span class="hljs-comment">//localhost:3306/order_db0?useSSL=false</span>
        username: root
        password: <span class="hljs-number">123456</span>
      db1:
        type: com.zaxxer.hikari.HikariDataSource
        driver-class-name: com.mysql.cj.jdbc.Driver
        url: jdbc:mysql:<span class="hljs-comment">//localhost:3306/order_db1?useSSL=false</span>
        username: root
        password: <span class="hljs-number">123456</span>
    rules:
      sharding:
        tables:
          `order`:
            actual-data-nodes: db${<span class="hljs-number">0.</span><span class="hljs-number">.1</span>}.order_${<span class="hljs-number">0.</span><span class="hljs-number">.3</span>} # <span class="hljs-number">2</span>åº“<span class="hljs-number">4</span>è¡¨
            database-strategy:
              inline:
                sharding-column: user_id # åˆ†åº“é”®
                algorithm-expression: db${user_id % <span class="hljs-number">2</span>} # åˆ†åº“ç®—æ³•ï¼ˆç”¨æˆ·IDå–æ¨¡ï¼‰
            table-strategy:
              inline:
                sharding-column: order_id # åˆ†è¡¨é”®
                algorithm-expression: order_${order_id % <span class="hljs-number">4</span>} # åˆ†è¡¨ç®—æ³•ï¼ˆè®¢å•IDå–æ¨¡ï¼‰
</code></pre>
<h5 data-id="heading-30">3.3.3 åˆ†åŒºè¡¨ï¼ˆæŒ‰æ—¶é—´ / èŒƒå›´åˆ†åŒºï¼‰</h5>
<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šæ•°æ®æŒ‰æ—¶é—´ / èŒƒå›´åˆ’åˆ†ï¼ˆå¦‚æ—¥å¿—è¡¨ã€è®¢å•è¡¨ï¼‰ï¼Œéœ€æ‰¹é‡åˆ é™¤å†å²æ•°æ®ã€‚</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŒ‰æ—¶é—´åˆ†åŒºçš„æ—¥å¿—è¡¨ï¼ˆæ¯æœˆä¸€ä¸ªåˆ†åŒºï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `sys_log` (
  `log_id` <span class="hljs-type">bigint</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
  `user_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `operation` <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `create_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (TO_DAYS(create_time)) (
  <span class="hljs-keyword">PARTITION</span> p202401 <span class="hljs-keyword">VALUES</span> LESS THAN (TO_DAYS(<span class="hljs-string">'2024-02-01'</span>)),
  <span class="hljs-keyword">PARTITION</span> p202402 <span class="hljs-keyword">VALUES</span> LESS THAN (TO_DAYS(<span class="hljs-string">'2024-03-01'</span>)),
  <span class="hljs-keyword">PARTITION</span> p202403 <span class="hljs-keyword">VALUES</span> LESS THAN (TO_DAYS(<span class="hljs-string">'2024-04-01'</span>)),
  <span class="hljs-keyword">PARTITION</span> p202404 <span class="hljs-keyword">VALUES</span> LESS THAN MAXVALUE
);

<span class="hljs-comment">-- æŸ¥è¯¢2024å¹´1æœˆçš„æ—¥å¿—ï¼ˆä»…æ‰«æp202401åˆ†åŒºï¼Œæ•ˆç‡é«˜ï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `sys_log` <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-01-31'</span>;

<span class="hljs-comment">-- åˆ é™¤2024å¹´1æœˆçš„æ—¥å¿—ï¼ˆç›´æ¥åˆ é™¤åˆ†åŒºï¼Œæ¯”DELETEå¿«100å€ï¼‰</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `sys_log` <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PARTITION</span> p202401;
</code></pre>
<h4 data-id="heading-31">3.4 é…ç½®ä¼˜åŒ–ï¼ˆå…³é”®å‚æ•°ï¼‰</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># MySQLé…ç½®æ–‡ä»¶ï¼ˆmy.cnfï¼‰</span>
[<span class="hljs-string">mysqld</span>]
<span class="hljs-string">innodb_buffer_pool_size</span> <span class="hljs-string">=</span> <span class="hljs-string">4G</span> <span class="hljs-comment"># ç¼“å­˜æ± å¤§å°ï¼ˆå»ºè®®ä¸ºç‰©ç†å†…å­˜çš„50%-70%ï¼‰</span>
<span class="hljs-string">innodb_log_buffer_size</span> <span class="hljs-string">=</span> <span class="hljs-string">64M</span> <span class="hljs-comment"># æ—¥å¿—ç¼“å­˜å¤§å°</span>
<span class="hljs-string">innodb_flush_log_at_trx_commit</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span> <span class="hljs-comment"># äº‹åŠ¡æäº¤æ—¶åˆ·æ—¥å¿—ï¼ˆä¿è¯ACIDï¼‰</span>
<span class="hljs-string">join_buffer_size</span> <span class="hljs-string">=</span> <span class="hljs-string">2M</span> <span class="hljs-comment"># JOINç¼“å­˜å¤§å°</span>
<span class="hljs-string">sort_buffer_size</span> <span class="hljs-string">=</span> <span class="hljs-string">2M</span> <span class="hljs-comment"># æ’åºç¼“å­˜å¤§å°</span>
<span class="hljs-string">max_connections</span> <span class="hljs-string">=</span> <span class="hljs-number">1000</span> <span class="hljs-comment"># æœ€å¤§è¿æ¥æ•°</span>
<span class="hljs-string">query_cache_type</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span> <span class="hljs-comment"># å…³é—­æŸ¥è¯¢ç¼“å­˜ï¼ˆMySQL8.0å·²ç§»é™¤ï¼‰</span>
</code></pre>
<h4 data-id="heading-32">3.5 ç¡¬ä»¶ä¼˜åŒ–</h4>
<ul>
<li>å­˜å‚¨ï¼šä½¿ç”¨ SSD æ›¿ä»£ HDDï¼Œæå‡ IO é€Ÿåº¦ï¼ˆéšæœºè¯»å†™æå‡ 10 å€ä»¥ä¸Šï¼‰ï¼›</li>
<li>å†…å­˜ï¼šå¢å¤§ç‰©ç†å†…å­˜ï¼Œè®© InnoDB ç¼“å†²æ± ï¼ˆinnodb_buffer_pool_sizeï¼‰èƒ½ç¼“å­˜å…¨è¡¨æ•°æ®ï¼›</li>
<li>CPUï¼šé€‰æ‹©å¤šæ ¸ CPUï¼Œæå‡å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</li>
</ul>
<h3 data-id="heading-33">å››ã€å®æˆ˜åœºæ™¯æ¡ˆä¾‹ï¼ˆç´¢å¼•è®¾è®¡ + SQL ä¼˜åŒ–ï¼‰</h3>
<h4 data-id="heading-34">4.1 åœºæ™¯ 1ï¼šç”µå•†å•†å“åˆ—è¡¨æŸ¥è¯¢ï¼ˆé«˜é¢‘å¤šæ¡ä»¶ï¼‰</h4>
<h5 data-id="heading-35">éœ€æ±‚ï¼š</h5>
<p>ç”¨æˆ·åœ¨ç”µå•†å¹³å°ç­›é€‰å•†å“ï¼Œæ”¯æŒæŒ‰åˆ†ç±»ã€ä»·æ ¼åŒºé—´ã€é”€é‡æ’åºï¼Œåˆ†é¡µå±•ç¤ºï¼ˆå¦‚<code>WHERE category_id=100 AND price BETWEEN 1000 AND 2000 ORDER BY sales DESC LIMIT 0,20</code>ï¼‰ã€‚</p>
<h5 data-id="heading-36">ç´¢å¼•è®¾è®¡ï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç»„åˆç´¢å¼•ï¼ˆcategory_idï¼šç­›é€‰æ¡ä»¶ï¼Œpriceï¼šèŒƒå›´æ¡ä»¶ï¼Œsalesï¼šæ’åºæ¡ä»¶ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_goods_category_price_sales <span class="hljs-keyword">ON</span> `goods`(category_id, price, sales);
</code></pre>
<h5 data-id="heading-37">ä¼˜åŒ– SQLï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‘½ä¸­ç»„åˆç´¢å¼•ï¼Œæ— éœ€å›è¡¨ï¼ˆè¦†ç›–ç´¢å¼•ï¼‰</span>
<span class="hljs-keyword">SELECT</span> goods_id, goods_name, price, sales <span class="hljs-keyword">FROM</span> `goods`
<span class="hljs-keyword">WHERE</span> category_id<span class="hljs-operator">=</span><span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> price <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">2000</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sales <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">20</span>;
</code></pre>
<h5 data-id="heading-38">æ•ˆç‡åˆ†æï¼š</h5>
<p>ç»„åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŒ¹é…ï¼Œ<code>category_id</code>ç²¾å‡†åŒ¹é…ï¼Œ<code>price</code>èŒƒå›´åŒ¹é…ï¼Œ<code>sales</code>æ’åºç›´æ¥ä½¿ç”¨ç´¢å¼•é¡ºåºï¼Œæ— éœ€é¢å¤–æ’åºï¼ˆ<code>Extra=Using index</code>ï¼‰ï¼ŒæŸ¥è¯¢æ•ˆç‡æå‡ 10 å€ä»¥ä¸Šã€‚</p>
<h4 data-id="heading-39">4.2 åœºæ™¯ 2ï¼šç”¨æˆ·ç™»å½•éªŒè¯ï¼ˆé«˜é¢‘ç­‰å€¼æŸ¥è¯¢ï¼‰</h4>
<h5 data-id="heading-40">éœ€æ±‚ï¼š</h5>
<p>ç”¨æˆ·é€šè¿‡æ‰‹æœºå·ç™»å½•ï¼ŒæŸ¥è¯¢æ‰‹æœºå·å¯¹åº”çš„ç”¨æˆ· ID å’Œå¯†ç ï¼ˆ<code>WHERE phone=?</code>ï¼‰ï¼Œéœ€é«˜é¢‘æŸ¥è¯¢ä¸”å“åº”å¿«ã€‚</p>
<h5 data-id="heading-41">ç´¢å¼•è®¾è®¡ï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¦†ç›–ç´¢å¼•ï¼ˆphoneï¼šæŸ¥è¯¢æ¡ä»¶ï¼Œuser_id+passwordï¼šæŸ¥è¯¢å­—æ®µï¼Œæ— éœ€å›è¡¨ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX idx_user_phone_cover <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">user</span>`(phone, user_id, password);
</code></pre>
<h5 data-id="heading-42">ä¼˜åŒ– SQLï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‘½ä¸­è¦†ç›–ç´¢å¼•ï¼ŒæŸ¥è¯¢æ•ˆç‡æé«˜</span>
<span class="hljs-keyword">SELECT</span> user_id, password <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">user</span>` <span class="hljs-keyword">WHERE</span> phone<span class="hljs-operator">=</span><span class="hljs-string">'13800138000'</span>;
</code></pre>
<h5 data-id="heading-43">æ•ˆç‡åˆ†æï¼š</h5>
<p>å”¯ä¸€ç´¢å¼•ç¡®ä¿æ‰‹æœºå·ä¸é‡å¤ï¼Œè¦†ç›–ç´¢å¼•é¿å…å›è¡¨ï¼ŒæŸ¥è¯¢ä»…æ‰«æç´¢å¼•æ ‘ï¼Œå“åº”æ—¶é—´â‰¤1msã€‚</p>
<h4 data-id="heading-44">4.3 åœºæ™¯ 3ï¼šè®¢å•å¤šæ¡ä»¶æŸ¥è¯¢ï¼ˆæ—¶é—´èŒƒå›´ + ç”¨æˆ· + çŠ¶æ€ï¼‰</h4>
<h5 data-id="heading-45">éœ€æ±‚ï¼š</h5>
<p>åå°ç®¡ç†ç³»ç»ŸæŸ¥è¯¢ç”¨æˆ·è¿‘ 30 å¤©çš„è®¢å•ï¼Œæ”¯æŒæŒ‰ç”¨æˆ· IDã€è®¢å•çŠ¶æ€ç­›é€‰ï¼ˆ<code>WHERE user_id=100 AND order_time BETWEEN '2024-01-01' AND '2024-01-31' AND status=2</code>ï¼‰ã€‚</p>
<h5 data-id="heading-46">ç´¢å¼•è®¾è®¡ï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç»„åˆç´¢å¼•ï¼ˆuser_idï¼šç²¾å‡†æŸ¥è¯¢ï¼Œorder_timeï¼šèŒƒå›´æŸ¥è¯¢ï¼Œstatusï¼šç²¾å‡†æŸ¥è¯¢ï¼‰</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_order_userid_time_status <span class="hljs-keyword">ON</span> `<span class="hljs-keyword">order</span>`(user_id, order_time, status);
</code></pre>
<h5 data-id="heading-47">ä¼˜åŒ– SQLï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‘½ä¸­ç»„åˆç´¢å¼•ï¼Œé«˜æ•ˆæŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> order_id, order_time, total_amount <span class="hljs-keyword">FROM</span> `<span class="hljs-keyword">order</span>`
<span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> order_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-01-31'</span> <span class="hljs-keyword">AND</span> status<span class="hljs-operator">=</span><span class="hljs-number">2</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> order_time <span class="hljs-keyword">DESC</span>;
</code></pre>
<h5 data-id="heading-48">æ•ˆç‡åˆ†æï¼š</h5>
<p><code>user_id</code>ç²¾å‡†åŒ¹é…ç´¢å¼•ï¼Œ<code>order_time</code>èŒƒå›´è¿‡æ»¤å‡å°‘æ•°æ®é‡ï¼Œ<code>status</code>è¿›ä¸€æ­¥ç­›é€‰ï¼Œç´¢å¼•é¡ºåºä¸æŸ¥è¯¢æ¡ä»¶ä¸€è‡´ï¼Œæ— éœ€é¢å¤–æ’åºã€‚</p>
<h4 data-id="heading-49">4.4 åœºæ™¯ 4ï¼šå•†å“è¯„è®ºæ–‡æœ¬æœç´¢ï¼ˆå…³é”®è¯åŒ¹é…ï¼‰</h4>
<h5 data-id="heading-50">éœ€æ±‚ï¼š</h5>
<p>ç”¨æˆ·æœç´¢å•†å“è¯„è®ºä¸­çš„å…³é”®è¯ï¼ˆå¦‚ â€œç»­èˆªå¼ºâ€â€œæ‹ç…§æ¸…æ™°â€ï¼‰ï¼Œéœ€å¿«é€Ÿè¿”å›åŒ¹é…ç»“æœã€‚</p>
<h5 data-id="heading-51">ç´¢å¼•è®¾è®¡ï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å…¨æ–‡ç´¢å¼•ï¼ˆè¯„è®ºå†…å®¹å­—æ®µï¼‰</span>
<span class="hljs-keyword">CREATE</span> FULLTEXT INDEX idx_comment_content <span class="hljs-keyword">ON</span> `comment`(content);
</code></pre>
<h5 data-id="heading-52">ä¼˜åŒ– SQLï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å…¨æ–‡æœç´¢ï¼ˆè‡ªç„¶è¯­è¨€æ¨¡å¼ï¼Œæ”¯æŒå…³é”®è¯åŒ¹é…ï¼‰</span>
<span class="hljs-keyword">SELECT</span> comment_id, goods_id, content <span class="hljs-keyword">FROM</span> `comment`
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(content) AGAINST(<span class="hljs-string">'ç»­èˆªå¼º æ‹ç…§æ¸…æ™°'</span> <span class="hljs-keyword">IN</span> <span class="hljs-keyword">NATURAL</span> <span class="hljs-keyword">LANGUAGE</span> MODE)
LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">20</span>;
</code></pre>
<h5 data-id="heading-53">æ•ˆç‡åˆ†æï¼š</h5>
<p>å…¨æ–‡ç´¢å¼•åŸºäºå€’æ’ç´¢å¼•ï¼Œæ¯”<code>LIKE '%ç»­èˆªå¼º%'</code>æ•ˆç‡é«˜ 10 å€ä»¥ä¸Šï¼Œæ”¯æŒå¤šå…³é”®è¯åŒ¹é…ï¼Œé€‚åˆæ–‡æœ¬æœç´¢åœºæ™¯ã€‚</p>
<h4 data-id="heading-54">4.5 åœºæ™¯ 5ï¼šé™„è¿‘åº—é“ºæŸ¥è¯¢ï¼ˆåœ°ç†ä½ç½®ï¼‰</h4>
<h5 data-id="heading-55">éœ€æ±‚ï¼š</h5>
<p>ç”¨æˆ·æ‰“å¼€ APP æŸ¥è¯¢é™„è¿‘ 1 å…¬é‡Œå†…çš„åº—é“ºï¼ŒæŒ‰è·ç¦»æ’åºï¼ˆå¦‚å¤–å–ã€æœ¬åœ°ç”Ÿæ´»æœåŠ¡ï¼‰ã€‚</p>
<h5 data-id="heading-56">ç´¢å¼•è®¾è®¡ï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç©ºé—´ç´¢å¼•ï¼ˆRæ ‘ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `shop` (
  `shop_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
  `shop_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `location` POINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  SPATIAL INDEX idx_shop_location (location)
);
</code></pre>
<h5 data-id="heading-57">ä¼˜åŒ– SQLï¼š</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢é™„è¿‘1å…¬é‡Œåº—é“ºï¼ŒæŒ‰è·ç¦»æ’åº</span>
<span class="hljs-keyword">SELECT</span> shop_name, 
       ST_Distance_Sphere(location, ST_GeomFromText(<span class="hljs-string">'POINT(39.9052 116.4084)'</span>)) <span class="hljs-keyword">AS</span> distance
<span class="hljs-keyword">FROM</span> `shop`
<span class="hljs-keyword">WHERE</span> ST_Distance_Sphere(location, ST_GeomFromText(<span class="hljs-string">'POINT(39.9052 116.4084)'</span>)) <span class="hljs-operator">&lt;=</span> <span class="hljs-number">1000</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> distance
LIMIT <span class="hljs-number">0</span>,<span class="hljs-number">10</span>;
</code></pre>
<h5 data-id="heading-58">æ•ˆç‡åˆ†æï¼š</h5>
<p>R æ ‘ç´¢å¼•ä¼˜åŒ–ç©ºé—´æŸ¥è¯¢ï¼Œé¿å…å…¨è¡¨è®¡ç®—è·ç¦»ï¼ŒæŸ¥è¯¢æ•ˆç‡æ¯”æ— ç´¢å¼•æå‡ 100 å€ä»¥ä¸Šï¼Œæ”¯æŒå¿«é€Ÿç­›é€‰é™„è¿‘åº—é“ºã€‚</p>
<h3 data-id="heading-59">äº”ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h3>
<p>MySQL ç´¢å¼•çš„æ ¸å¿ƒæ˜¯ã€Œå¹³è¡¡æŸ¥è¯¢æ•ˆç‡ä¸å†™å…¥æˆæœ¬ã€ï¼Œç›²ç›®åˆ›å»ºç´¢å¼•ä¼šå¯¼è‡´æ’å…¥ / æ›´æ–°å˜æ…¢ï¼Œç¼ºä¹ç´¢å¼•åˆ™ä¼šå¯¼è‡´æŸ¥è¯¢å…¨è¡¨æ‰«æã€‚ä»¥ä¸‹æ˜¯æœ€ä½³å®è·µï¼š</p>
<ol>
<li>
<p><strong>ç´¢å¼•è®¾è®¡ä¼˜å…ˆåŸåˆ™</strong>ï¼š</p>
<ul>
<li>ä¼˜å…ˆåˆ›å»ºèšç°‡ç´¢å¼•ï¼ˆè‡ªå¢ä¸»é”®ï¼‰ï¼Œå†åˆ›å»ºéèšç°‡ç´¢å¼•ï¼›</li>
<li>å¤šå­—æ®µæŸ¥è¯¢ä¼˜å…ˆç”¨ç»„åˆç´¢å¼•ï¼Œéµå¾ªã€Œæœ€å·¦å‰ç¼€åŒ¹é…ã€ï¼›</li>
<li>é«˜é¢‘å°‘å­—æ®µæŸ¥è¯¢ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨ï¼›</li>
<li>æ–‡æœ¬æœç´¢ç”¨å…¨æ–‡ç´¢å¼•ï¼Œç©ºé—´æŸ¥è¯¢ç”¨ R æ ‘ç´¢å¼•ï¼Œä¸æ»¥ç”¨ B + æ ‘ç´¢å¼•ã€‚</li>
</ul>
</li>
<li>
<p><strong>æŸ¥è¯¢ä¼˜åŒ–æ ¸å¿ƒæŠ€å·§</strong>ï¼š</p>
<ul>
<li>é¿å…ç´¢å¼•å¤±æ•ˆï¼ˆä¸å‡½æ•°æ“ä½œç´¢å¼•å­—æ®µã€ä¸éšå¼ç±»å‹è½¬æ¢ï¼‰ï¼›</li>
<li>å¤æ‚æŸ¥è¯¢ç”¨ JOIN æ›¿ä»£å­æŸ¥è¯¢ï¼Œåˆ†é¡µæŸ¥è¯¢ä¼˜åŒ– offset è¿‡å¤§é—®é¢˜ï¼›</li>
<li>å¤§è¡¨ç”¨åˆ†åº“åˆ†è¡¨æˆ–åˆ†åŒºè¡¨ï¼Œæå‡æ•°æ®æ“ä½œæ•ˆç‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¿å‘æŒ‡å—</strong>ï¼š</p>
<ul>
<li>åŒºåˆ†åº¦ä½çš„å­—æ®µï¼ˆæ€§åˆ«ã€çŠ¶æ€ï¼‰ä¸åˆ›å»ºç´¢å¼•ï¼›</li>
<li>ç´¢å¼•æ•°é‡æ§åˆ¶åœ¨ 5 ä¸ªä»¥å†… / è¡¨ï¼Œé¿å…è¿‡åº¦ç´¢å¼•ï¼›</li>
<li>InnoDB ä¸­é¿å…ä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼ˆå¦‚ UUIDï¼‰ï¼Œé˜²æ­¢é¡µåˆ†è£‚ã€‚</li>
</ul>
</li>
</ol>
<p>é€šè¿‡åˆç†çš„ç´¢å¼•è®¾è®¡ã€SQL ä¼˜åŒ–å’Œè¡¨ç»“æ„ä¼˜åŒ–ï¼ŒMySQL æŸ¥è¯¢æ•ˆç‡å¯æå‡ 10-100 å€ï¼Œè¶³ä»¥æ”¯æ’‘ç™¾ä¸‡çº§ã€åƒä¸‡çº§æ•°æ®é‡çš„ä¸šåŠ¡åœºæ™¯ã€‚å®é™…å¼€å‘ä¸­ï¼Œéœ€ç»“åˆä¸šåŠ¡éœ€æ±‚å’Œæ•°æ®åˆ†å¸ƒï¼Œé€šè¿‡<code>EXPLAIN</code>åˆ†ææ‰§è¡Œè®¡åˆ’ï¼ŒæŒç»­ä¼˜åŒ–ç´¢å¼•å’Œ SQLã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NestJS æ¨¡å—ä½œç”¨ã€ç±»å‹]]></title>    <link>https://juejin.cn/post/7598818096729538598</link>    <guid>https://juejin.cn/post/7598818096729538598</guid>    <pubDate>2026-01-24T13:32:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598818096729538598" data-draft-id="7598614012183642139" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NestJS æ¨¡å—ä½œç”¨ã€ç±»å‹"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-24T13:32:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åƒæŸ¯æ©˜"/> <meta itemprop="url" content="https://juejin.cn/user/2010369939736343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NestJS æ¨¡å—ä½œç”¨ã€ç±»å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2010369939736343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åƒæŸ¯æ©˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T13:32:01.000Z" title="Sat Jan 24 2026 13:32:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-dark">.hljs-comment,.hljs-quote{color:#898ea4}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#202746;color:#979db4}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">NestJS ä¹‹æ¨¡å—ï¼ˆModule)</h2>
<p>æ¨¡å—æ˜¯ NestJS åº”ç”¨ç»“æ„çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œé€šè¿‡ <code>@Module(metadata)</code> è£…é¥°å™¨å®šä¹‰ï¼Œè£…é¥°å™¨æ¥æ”¶çš„å¯¹è±¡å±æ€§æè¿°äº†æ¨¡å—å†…çš„æä¾›è€…ã€æ§åˆ¶å™¨ã€å¯¼å…¥å’Œå¯¼å‡ºå†…å®¹</p>
<h3 data-id="heading-1">æ¨¡å—(Module)çš„ä½œç”¨</h3>
<p>æˆ‘ä»¬ç›´æ¥çœ‹ NestJS çš„ <code>@Module</code> çš„å‚æ•°ç±»å‹</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [], <span class="hljs-comment">// imports ç”¨æ¥å¯¼å…¥å…¶ä»–æ¨¡å—</span>
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">UserController</span>], <span class="hljs-comment">// æ³¨å†Œæ§åˆ¶å™¨</span>
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">UserService</span>], <span class="hljs-comment">// æ³¨å†Œæä¾›è€…ï¼Œä¾›å½“å‰æ¨¡å—å†…ä½¿ç”¨</span>
  <span class="hljs-attr">exports</span>: [], <span class="hljs-comment">// å¯¼å‡ºå¤–éƒ¨éœ€è¦çš„æä¾›è€…ï¼ˆå¯¼å…¥å½“å‰æ¨¡å—çš„æ—¶å€™ å¯¹å¤–ä¿ç•™çš„ æä¾›è€…</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserModule</span> {}
</code></pre>
<p>ä»æ•´ä½“é…ç½®æ¥çœ‹ï¼Œæ¨¡å—çš„ä½œç”¨æœ‰ï¼š</p>
<ul>
<li>ç»„ç»‡ä»£ç ï¼Œå°†ç›¸å…³çš„åŠŸèƒ½ç»„ç»‡åœ¨ä¸€èµ·</li>
<li>ç®¡ç†ä¾èµ–ï¼Œå®šä¹‰æ¨¡å—ä¹‹é—´çš„å¯¼å…¥å¯¼å‡ºå…³ç³»</li>
</ul>
<h5 data-id="heading-2"><strong>providers å’Œ exports çš„åŒºåˆ«</strong></h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6ae8b10aa9483d8b8044f384f8ec61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y2D5p-v5qmY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769866321&amp;x-signature=4ah%2FH6aGRvUHb8NUssx5pT31QBM%3D" alt="" loading="lazy"/></p>
<h6 data-id="heading-3">ä»…æ¨¡å—å†…éƒ¨ä½¿ç”¨çš„æä¾›è€…</h6>
<p>å¦‚æœä¸€ä¸ªæœåŠ¡åªåœ¨å½“å‰æ¨¡å—çš„æ§åˆ¶å™¨ / å…¶ä»–æœåŠ¡ä¸­ä½¿ç”¨ï¼Œåªéœ€å£°æ˜åœ¨ providersï¼Œæ— éœ€å£°æ˜åœ¨ <code>exports</code> ä¸­</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">CatsController</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">CatsService</span>, <span class="hljs-title class_">CatsPrivateUtilService</span>] <span class="hljs-comment">// CatsPrivateUtilService ä»…å†…éƒ¨ä½¿ç”¨</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsModule</span> {}
<span class="hljs-comment">// CatsPrivateUtilService æ— æ³•è¢«å¤–éƒ¨æ¨¡å—è®¿é—®ï¼Œå› ä¸ºæ²¡æœ‰å†™å…¥åˆ° exports é…ç½®é‡Œï¼Œå› æ­¤å®ç°ç§æœ‰é€»è¾‘éš”ç¦»</span>
</code></pre>
<h6 data-id="heading-4">éœ€è¦è·¨æ¨¡å—å…±äº«çš„æä¾›è€…</h6>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 1. Cats æ¨¡å—å¯¼å‡º CatsService</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">CatsService</span>],
  <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">CatsService</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CatsModule</span> {}

<span class="hljs-comment">// 2. Orders æ¨¡å—å¯¼å…¥ CatsModuleï¼Œå³å¯æ³¨å…¥ä½¿ç”¨ CatsService</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">CatsModule</span>], <span class="hljs-comment">// å¯¼å…¥åï¼ŒCatsService å¯¹ OrdersModule å¯ç”¨</span>
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">OrdersController</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">OrdersService</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrdersModule</span> {}
</code></pre>
<p><code>exports</code> å’Œ <code>providers</code> çš„æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>ç›´æ¥å¯¼å‡ºæœªåœ¨ providers å£°æ˜çš„æä¾›è€…. Nest ä¼šæŠ¥é”™ï¼Œå› ä¸º exports æ˜¯å¯¹å·²æœ‰æä¾›è€…çš„æš´éœ²ï¼Œè€Œéå£°æ˜ã€‚</li>
<li>è®¤ä¸º exports ä¼šé‡æ–°å®ä¾‹åŒ–æä¾›è€…. Nest ä¸­æ¨¡å—é»˜è®¤æ˜¯å•ä¾‹ï¼Œexports åªæ˜¯æš´éœ²å·²æœ‰å®ä¾‹çš„è®¿é—®æƒé™ï¼Œä¸ä¼šä¸ºå¤–éƒ¨æ¨¡å—é‡æ–°åˆ›å»ºæä¾›è€…å®ä¾‹ï¼Œæ‰€æœ‰å¯¼å…¥æ¨¡å—å…±äº«åŒä¸€ä¸ªå®ä¾‹</li>
<li>æ»¥ç”¨ exportsï¼šå¯¼å‡ºæ‰€æœ‰æä¾›è€…. ä¼šç ´åæ¨¡å—çš„å°è£…æ€§ï¼Œä»…å¯¼å‡ºå¤–éƒ¨æ¨¡å—çœŸæ­£éœ€è¦çš„æä¾›è€…å³å¯ã€‚</li>
</ul>
<h3 data-id="heading-5">æ ¹æ¨¡å—çš„ä½œç”¨</h3>
<p>NestJS ä¸­çš„æ ¹æ¨¡å— AppModule æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒå…¥å£ï¼Œä½œç”¨ä¸ºï¼š</p>
<ul>
<li>å¯¼å…¥æ‰€æœ‰åŠŸèƒ½æ¨¡å—ï¼Œå³ä½¿ç”¨ imports å¯¼å…¥æ‰€æœ‰åŠŸèƒ½æ¨¡å—</li>
<li>ç®¡ç†å…¨å±€é…ç½®ã€æ‹¦æˆªæ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨ã€è¿æ¥æ•°æ®åº“ç­‰åŠŸèƒ½</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// AppModule å¯¼å…¥å…¶ä»–æ¨¡å—ï¼Œå½¢æˆæ¨¡å—æ ‘ã€‚ </span>
<span class="hljs-comment">// TypeORM å®ç°äº† Node.js å¯¹æ•°æ®åº“çš„ ORM æ“ä½œ</span>
<span class="hljs-comment">// è€Œ TypeOrmModule è®© TypeORM é€‚é… NestJS çš„æ¨¡å—åŒ–å’Œ DI æœºåˆ¶</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">UsersModule</span>, <span class="hljs-title class_">CatsModule</span>, <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forRoot</span>(<span class="hljs-variable constant_">DB_CONFIG</span>)], <span class="hljs-comment">// å­æ¨¡å—æŒ‚é æ ¹æ¨¡å—</span>
  <span class="hljs-attr">controllers</span>: [<span class="hljs-title class_">AppController</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">AppService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<h3 data-id="heading-6">å…¨å±€æ¨¡å—</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Global</span>, <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/config'</span>;

<span class="hljs-meta">@Global</span>()
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">ConfigModule</span>.<span class="hljs-title function_">forRoot</span>()],
  <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">ConfigModule</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomConfigModule</span> {}
</code></pre>
<p>å…¨å±€æ¨¡å—æ˜¯å¯ä»¥åœ¨ä»»ä½•å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨ï¼Œä¸”ä¸éœ€è¦åœ¨æ¯ä¸ªæ¨¡å—ä¸­å¯¼å…¥
ä½¿ç”¨ <code>@Global()</code> è£…é¥°å™¨åˆ›å»ºå…¨å±€æ¨¡å—,å…¨å±€æ¨¡å—çš„ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å…¨å±€é…ç½®æ¨¡å— å¦‚ <code>ConfigModule</code>, åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯èƒ½ç”¨åˆ°</li>
<li>æ•°æ®åº“æ¨¡å—é…ç½®ï¼Œå³å…¨å±€æ€§å€¼çš„é…ç½®</li>
</ul>
<h3 data-id="heading-7">åŠ¨æ€æ¨¡å—ï¼ˆDynamic Moduleï¼‰</h3>
<p>æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€é…ç½®çš„æ¨¡å—ï¼Œå¯é€šè¿‡é™æ€æ–¹æ³•ï¼ˆå¦‚forRoot/forFeatureï¼‰æ¥æ”¶å‚æ•°ï¼ŒåŠ¨æ€ç”Ÿæˆæä¾›è€…ã€å¯¼å…¥ / å¯¼å‡ºå†…å®¹ï¼Œæ˜¯ Nest å®ç°çµæ´»é…ç½®çš„æ ¸å¿ƒæ–¹å¼ã€‚</p>
<h5 data-id="heading-8">åŠ¨æ€æ¨¡å—çš„ç‰¹ç‚¹</h5>
<ul>
<li>é™æ€æ–¹æ³•è¿”å›DynamicModuleå¯¹è±¡ï¼ŒåŒ…å« module/imports/providers/exportsç­‰å…ƒæ•°æ®ï¼›</li>
<li>å¯æ¥æ”¶è‡ªå®šä¹‰å‚æ•°ï¼Œé€‚é…ä¸åŒåœºæ™¯çš„é…ç½®éœ€æ±‚ï¼›</li>
<li>å®˜æ–¹ç¬¬ä¸‰æ–¹æ¨¡å—ï¼ˆConfigModule/TypeOrmModuleï¼‰å‡å®ç°äº†åŠ¨æ€æ¨¡å—ã€‚</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// FileUtilsModuleï¼ˆåŠ¨æ€æ¨¡å— demoï¼‰</span>
<span class="hljs-meta">@Module</span>({})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUtilsModule</span> {
  <span class="hljs-comment">// é™æ€æ–¹æ³•æ¥æ”¶é…ç½®ï¼Œè¿”å›åŠ¨æ€æ¨¡å—</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">forRoot</span>(<span class="hljs-attr">config</span>: <span class="hljs-title class_">FileConfig</span>): <span class="hljs-title class_">DynamicModule</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">module</span>: <span class="hljs-title class_">FileModule</span>,
      <span class="hljs-attr">providers</span>: [
        { <span class="hljs-attr">provide</span>: <span class="hljs-variable constant_">FILE_CONFIG</span>, <span class="hljs-attr">useValue</span>: config }, <span class="hljs-comment">// æ³¨å…¥é…ç½®</span>
        <span class="hljs-title class_">FileService</span>,
      ],
      <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">FileService</span>],
    };
  }
}

<span class="hljs-comment">// æ ¹æ¨¡å—ä¼ å…¥é…ç½®åˆå§‹åŒ–</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">FileUtilsModule</span>.<span class="hljs-title function_">forRoot</span>({<span class="hljs-attr">maxSize</span>: <span class="hljs-string">'10MB'</span>, <span class="hljs-attr">uploadPath</span>: <span class="hljs-string">'./uploads'</span>})],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<h3 data-id="heading-9">å…±äº«æ¨¡å—ï¼ˆShared Moduleï¼‰</h3>
<p>æä¾›é€šç”¨èƒ½åŠ›ã€ä¾›å¤šä¸ªæ¨¡å—å¤ç”¨çš„æ¨¡å—ï¼Œæ ¸å¿ƒä»·å€¼æ˜¯è§£å†³ä»£ç é‡å¤é—®é¢˜ï¼Œå®ç°è·¨æ¨¡å—ä¾èµ–å¤ç”¨, åŠ å¯†ã€æ—¶é—´å¤„ç†å·¥å…·ç±» åœ¨è®¢å•å’Œè´¦åŠ¡æ¨¡å—éƒ½éœ€è¦ç”¨åˆ°æ—¶å¯ä»¥å°†ä¸¤è€…ç»“åˆæˆä¸€ä¸ªå…±äº«æ¨¡å—</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// UtilsModuleï¼ˆå…±äº«æ¨¡å—ï¼‰</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">EncryptService</span>, <span class="hljs-title class_">TimeService</span>],
  <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">EncryptService</span>, <span class="hljs-title class_">TimeService</span>], <span class="hljs-comment">// æš´éœ²é€šç”¨å·¥å…·æœåŠ¡</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UtilsModule</span> {}

<span class="hljs-comment">// å…¶ä»–æ¨¡å—å¯¼å…¥å³å¯å¤ç”¨</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">UtilsModule</span>],
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">OrderService</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderModule</span> {}
</code></pre>
<h3 data-id="heading-10">å¼‚æ­¥æ¨¡å—ï¼ˆAsync Moduleï¼‰</h3>
<p>åŠ¨æ€æ¨¡å—çš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œé€šè¿‡ <code>forRootAsync</code>/<code>forFeatureAsync</code> å®ç°å¼‚æ­¥é…ç½®åŠ è½½ï¼Œè§£å†³ â€œé…ç½®ä¾èµ–å‰ç½®â€ é—®é¢˜ï¼ˆå¦‚ä»é…ç½®æœåŠ¡ã€æ•°æ®åº“ã€è¿œç¨‹æ¥å£è¯»å–é…</p>
<h5 data-id="heading-11">å¼‚æ­¥æ¨¡å—çš„ç‰¹ç‚¹</h5>
<ul>
<li>åŠ¨æ€æ¨¡å—å®ç°ï¼Œè¿”å›Promiseï¼›</li>
<li>æ”¯æŒé€šè¿‡ <code>@Inject</code> æ³¨å…¥å…¶ä»–æä¾›è€…ï¼ˆå¦‚ConfigServiceï¼‰ï¼Œå¼‚æ­¥è·å–é…ç½®ï¼›</li>
<li>å¼€å‘ä¸­é«˜é¢‘ä½¿ç”¨ï¼Œæ˜¯ä¼˜é›…ç®¡ç†é…ç½®çš„æ ‡å‡†æ–¹å¼</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// æ ¹æ¨¡å—ä¸­å¼‚æ­¥åˆå§‹åŒ–TypeORMï¼ˆä»ConfigServiceè¯»å–é…ç½®ï¼‰</span>
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">TypeOrmModule</span>.<span class="hljs-title function_">forRootAsync</span>({
      <span class="hljs-attr">useFactory</span>: <span class="hljs-function">(<span class="hljs-params">configService: ConfigService</span>) =&gt;</span> ({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'postgres'</span>,
        <span class="hljs-attr">host</span>: configService.<span class="hljs-title function_">get</span>(<span class="hljs-string">'DB_HOST'</span>),
        <span class="hljs-attr">port</span>: configService.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'DB_PORT'</span>),
        <span class="hljs-attr">database</span>: configService.<span class="hljs-title function_">get</span>(<span class="hljs-string">'DB_DATABASE'</span>),
        <span class="hljs-attr">autoLoadEntities</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">synchronize</span>: <span class="hljs-literal">false</span>,
      }),
      <span class="hljs-attr">inject</span>: [<span class="hljs-title class_">ConfigService</span>], <span class="hljs-comment">// æ³¨å…¥ConfigServiceï¼Œå¼‚æ­¥è·å–é…ç½®</span>
    }),
  ],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> {}
</code></pre>
<h3 data-id="heading-12">å„ç±»æ¨¡å—çš„ä½¿ç”¨åŸåˆ™</h3>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨ç‰¹æ€§æ¨¡å—ï¼ˆæ¯”å¦‚ Order, User æ¨¡å—ï¼‰ + å…±äº«æ¨¡å—</li>
<li>å…¨å±€æ¨¡å—ä»…ç”¨äºé«˜é¢‘é€šç”¨èƒ½åŠ›ï¼šé¿å…æ‰€æœ‰æ¨¡å—éƒ½è®¾ä¸ºå…¨å±€ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¾èµ–å…³ç³»æ··ä¹±ï¼›</li>
<li>åŠ¨æ€ / å¼‚æ­¥æ¨¡å—ç”¨äºå¸¦é…ç½®çš„åˆå§‹åŒ–ï¼šå®˜æ–¹ç¬¬ä¸‰æ–¹æ¨¡å—ä¼˜å…ˆç”¨å…¶æä¾›çš„forRoot/forRootAsyncï¼›</li>
<li>æŒ‰éœ€å¯¼å‡ºï¼šæ— è®ºå“ªç§æ¨¡å—ï¼Œä»…å¯¼å‡ºå¤–éƒ¨æ¨¡å—çœŸæ­£éœ€è¦çš„æä¾›è€…ï¼Œé¿å…è¿‡åº¦æš´éœ²ã€‚</li>
<li>å»ºè®®æŒ‰åŠŸèƒ½ç»„ç»‡ï¼Œæ¯”å¦‚ modules/user æ”¾æ‰€æœ‰æœ‰å…³ user æ¨¡å—ã€æ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€æœåŠ¡ï¼ˆService), modules/order æ”¾ order ç›¸å…³çš„æ¨¡å—</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# ä¸­ Lock é”ï¼šçº¿ç¨‹åŒæ­¥çš„æ ¸å¿ƒæœºåˆ¶]]></title>    <link>https://juejin.cn/post/7598480267218288674</link>    <guid>https://juejin.cn/post/7598480267218288674</guid>    <pubDate>2026-01-24T13:53:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598480267218288674" data-draft-id="7596874823722336290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" C# ä¸­ Lock é”ï¼šçº¿ç¨‹åŒæ­¥çš„æ ¸å¿ƒæœºåˆ¶"/> <meta itemprop="keywords" content="åç«¯,C#,.NET"/> <meta itemprop="datePublished" content="2026-01-24T13:53:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç ç¼–åŒ "/> <meta itemprop="url" content="https://juejin.cn/user/1308876155395739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             C# ä¸­ Lock é”ï¼šçº¿ç¨‹åŒæ­¥çš„æ ¸å¿ƒæœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1308876155395739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç ç¼–åŒ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T13:53:14.000Z" title="Sat Jan 24 2026 13:53:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹å·²æˆä¸ºæå‡ç¨‹åºæ€§èƒ½å’Œå“åº”èƒ½åŠ›çš„é‡è¦æ‰‹æ®µã€‚ç„¶è€Œï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„èµ„æºå…±äº«è‹¥ç¼ºä¹æœ‰æ•ˆçš„åŒæ­¥æœºåˆ¶ï¼Œææ˜“å¼•å‘æ•°æ®ä¸ä¸€è‡´ã€ç«æ€æ¡ä»¶ç”šè‡³æ­»é”ç­‰é—®é¢˜ã€‚C# æä¾›äº†å¤šç§çº¿ç¨‹åŒæ­¥å·¥å…·ï¼Œå…¶ä¸­ <code>lock</code> å…³é”®å­—å› å…¶ç®€æ´æ€§å’Œé«˜æ•ˆæ€§ï¼Œæˆä¸ºå¼€å‘è€…æœ€å¸¸ä½¿ç”¨çš„äº’æ–¥é”æœºåˆ¶ã€‚</p>
<p>æœ¬æ–‡å°†ç³»ç»Ÿè®²è§£ <code>lock</code> çš„åŸç†ã€ä½¿ç”¨æ–¹æ³•ã€æœ€ä½³å®è·µåŠæ›¿ä»£æ–¹æ¡ˆï¼Œå¹¶é€šè¿‡ä»£ç ç¤ºä¾‹å¸®åŠ©è¯»è€…æ·±å…¥ç†è§£å…¶åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦é”ï¼Ÿ</h3>
<p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªå…±äº«èµ„æºï¼ˆå¦‚å˜é‡ã€é›†åˆæˆ–æ–‡ä»¶ï¼‰æ—¶ï¼Œè‹¥æ²¡æœ‰åŒæ­¥æ§åˆ¶ï¼Œå¯èƒ½å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>
<p><strong>ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰</strong>ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹å…±äº«æ•°æ®ï¼Œå¯¼è‡´ç»“æœä¸å¯é¢„æµ‹ã€‚</p>
</li>
<li>
<p><strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šéƒ¨åˆ†å†™å…¥æœªå®Œæˆå³è¢«å…¶ä»–çº¿ç¨‹è¯»å–ï¼Œé€ æˆä¸­é—´çŠ¶æ€æš´éœ²ã€‚</p>
</li>
<li>
<p><strong>æ­»é”ï¼ˆDeadlockï¼‰</strong>ï¼šçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œç¨‹åºé™·å…¥åœæ»ã€‚</p>
</li>
</ol>
<p>ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒC# å¼•å…¥äº† <code>lock</code> æœºåˆ¶ï¼Œé€šè¿‡äº’æ–¥é”ç¡®ä¿åŒä¸€æ—¶é—´ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ã€‚</p>
<blockquote>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªèµ„æºï¼Œè€Œè¯¥èµ„æºåœ¨è¢«å†™ï¼ˆä¿®æ”¹ï¼‰æ—¶ä¸èƒ½åŒæ—¶è¢«å…¶ä»–çº¿ç¨‹å†™ï¼ˆä¿®æ”¹ï¼‰ï¼Œå°±å¿…é¡»åŠ é”ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹ç¤ºä¾‹ï¼Œå±•ç¤ºäº†ä¸åŠ é”ä¸åŠ é”å¯¹ç»“æœçš„å½±å“ï¼š</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">namespace</span> <span class="hljs-title">C_</span>ä¹‹<span class="hljs-title">Lock</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Form1</span> : <span class="hljs-title">Form</span>
    {
        <span class="hljs-comment">//é”ï¼šobjectå¯¹è±¡</span>
        <span class="hljs-comment">//static:é™æ€ï¼šè¿™ä¸ªå¯¹è±¡åœ¨ç¨‹åºå¯åŠ¨ä¹‹å‰å°±ç”Ÿæˆï¼Œåœ¨ç¨‹åºæ¶ˆå¤±ä¹‹ååœ¨é”€æ¯</span>
        <span class="hljs-comment">//å…¨å±€å”¯ä¸€å­˜åœ¨</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">object</span> lockObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> è®¡æ•°å˜é‡</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Count = <span class="hljs-number">0</span>;
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Form1</span>()</span>
        {
            InitializeComponent();
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">button1_Click</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EventArgs e</span>)</span>
        {
            Thread thread1 = <span class="hljs-keyword">new</span> Thread(method);
            Thread thread2 = <span class="hljs-keyword">new</span> Thread(method);
            Thread thread3 = <span class="hljs-keyword">new</span> Thread(method);
            thread1.Start();
            thread2.Start();
            thread3.Start();
            <span class="hljs-comment">//ç­‰å¾…ç°çº¿ç¨‹ç»“æŸ</span>
            thread1.Join();
            thread2.Join();
            thread3.Join();
            MessageBox.Show(<span class="hljs-string">$"æœ€åçš„æ•°å­— <span class="hljs-subst">{Count}</span>"</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>? obj</span>)</span>
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++)
            {
                <span class="hljs-comment">//é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®ä¸‹é¢ä»£ç çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¼šè¢«é˜»æŒ¡åœ¨å¤–é¢</span>
                <span class="hljs-comment">//ä¸åŠ é”ï¼Œä¸èƒ½æ­£å¸¸å®Œæˆè®¡æ•°</span>
                <span class="hljs-keyword">lock</span> (lockObj)
                {
                    Count++;
                }
            }
        }

    }
}
</code></pre>
<p>è‹¥ç§»é™¤ <code>lock (lockObj)</code>ï¼Œæœ€ç»ˆ <code>Count</code> çš„å€¼é€šå¸¸å°äº 300,000ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ <code>Count++</code> æ“ä½œé€ æˆè¦†ç›–ï¼›è€ŒåŠ é”åï¼Œç»“æœç¨³å®šä¸º 300,000ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚</p>
<h3 data-id="heading-2">äºŒã€Lock åŸºæœ¬è¯­æ³•ä¸å·¥ä½œåŸç†</h3>
<h4 data-id="heading-3">2.1 åŸºæœ¬è¯­æ³•</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">lock</span> (lockObject)
{
    <span class="hljs-comment">// ä¸´ç•ŒåŒºä»£ç </span>
    <span class="hljs-comment">// åªæœ‰è·å¾—é”çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œè¿™éƒ¨åˆ†ä»£ç </span>
}
</code></pre>
<ul>
<li>
<p><code>lockObject</code> å¿…é¡»æ˜¯<strong>å¼•ç”¨ç±»å‹</strong>ï¼ˆé€šå¸¸æ˜¯ <code>object</code> å®ä¾‹ï¼‰ã€‚</p>
</li>
<li>
<p>åŒä¸€æ—¶é—´ä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºã€‚</p>
</li>
<li>
<p>çº¿ç¨‹é€€å‡º <code>lock</code> å—æ—¶è‡ªåŠ¨é‡Šæ”¾é”ï¼ˆå³ä½¿å‘ç”Ÿå¼‚å¸¸ï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-4">2.2 å·¥ä½œåŸç†</h4>
<ul>
<li>
<p><strong>äº’æ–¥æ€§</strong>ï¼šç¡®ä¿ä¸´ç•ŒåŒºä»£ç ä¸²è¡Œæ‰§è¡Œã€‚</p>
</li>
<li>
<p><strong>é‡å…¥æ€§</strong>ï¼šåŒä¸€çº¿ç¨‹å¯å¤šæ¬¡è·å–åŒä¸€æŠŠé”ï¼ˆä¸ä¼šæ­»é”ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é˜»å¡æœºåˆ¶</strong>ï¼šæœªè·é”çš„çº¿ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚</p>
</li>
</ul>
<h4 data-id="heading-5">2.3 åŸºç¡€ç¤ºä¾‹</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">button2_Click</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> sender, EventArgs e</span>)</span>
{
    Counter counter = <span class="hljs-keyword">new</span> Counter();
    <span class="hljs-comment">//åˆ›å»ºå¤šä¸ªçº¿ç¨‹åŒæ—¶å¢åŠ è®¡æ•°å™¨</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)
    {
        <span class="hljs-keyword">new</span> Thread(() =&gt;
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++)
            {
                counter.Increment();
            }
        }).Start();
    }
    <span class="hljs-comment">//ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ</span>
    Thread.Sleep(<span class="hljs-number">1000</span>);
    MessageBox.Show(<span class="hljs-string">$"æœ€ç»ˆè®¡æ•°ï¼š<span class="hljs-subst">{counter.GetCount()}</span>"</span>);<span class="hljs-comment">//åº”è¯¥è¾“å‡º10000</span>
}
<span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _count = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> _lockObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>(); <span class="hljs-comment">// ä¸“ç”¨é”å¯¹è±¡</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Increment</span>()</span>
    {
        <span class="hljs-keyword">lock</span> (_lockObj) <span class="hljs-comment">// è·å–é”</span>
        {
            _count++; <span class="hljs-comment">// ä¸´ç•ŒåŒº</span>
        } <span class="hljs-comment">// è‡ªåŠ¨é‡Šæ”¾é”</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetCount</span>()</span>
    {
        <span class="hljs-keyword">lock</span> (_lockObj)
        {
            <span class="hljs-keyword">return</span> _count;
        }
    }
}
</code></pre>
<h3 data-id="heading-6">ä¸‰ã€Lock çš„æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-7">3.1 ä½¿ç”¨ä¸“ç”¨é”å¯¹è±¡</h4>
<p>âœ… <strong>æ­£ç¡®åšæ³•</strong></p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> _lockObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();
</code></pre>
<p>âŒ <strong>é”™è¯¯åšæ³•</strong></p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">lock</span> (<span class="hljs-number">1</span>) { ... }       <span class="hljs-comment">// å€¼ç±»å‹è£…ç®±ï¼Œæ¯æ¬¡ä¸åŒå¯¹è±¡</span>
<span class="hljs-keyword">lock</span> (<span class="hljs-string">"string"</span>) { ... } <span class="hljs-comment">// å­—ç¬¦ä¸²é©»ç•™å¯èƒ½å¯¼è‡´æ„å¤–å…±äº«</span>
</code></pre>
<h4 data-id="heading-8">3.2 ç¼©å°é”çš„èŒƒå›´</h4>
<p>åªé”å®šçœŸæ­£éœ€è¦ä¿æŠ¤çš„ä»£ç ï¼Œé¿å…é•¿æ—¶é—´æŒæœ‰é”ï¼š</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// å‡†å¤‡æ•°æ®ï¼ˆæ— éœ€é”ï¼‰</span>
<span class="hljs-keyword">var</span> data = PrepareData();

<span class="hljs-keyword">lock</span> (_lockObj)
{
    UpdateSharedData(data); <span class="hljs-comment">// ä»…æ­¤å¤„éœ€åŒæ­¥</span>
}

ProcessData(data); <span class="hljs-comment">// åç»­å¤„ç†æ— éœ€é”</span>
</code></pre>
<h4 data-id="heading-9">3.3 é¿å…åœ¨é”å†…è°ƒç”¨æœªçŸ¥ä»£ç </h4>
<p>è™½ç„¶ <code>lock</code> ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼ˆå³ä½¿å¼‚å¸¸ï¼‰ï¼Œä½†ä»åº”è°¨æ…ï¼š</p>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">lock</span> (_lockObj)
{
    <span class="hljs-keyword">try</span>
    {
        ExternalMethod(); <span class="hljs-comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸</span>
    }
    <span class="hljs-keyword">catch</span>
    {
        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸ï¼Œé”ä»ä¼šé‡Šæ”¾</span>
        <span class="hljs-keyword">throw</span>;
    }
}
</code></pre>
<h4 data-id="heading-10">3.4 é˜²æ­¢æ­»é”</h4>
<ul>
<li>
<p>ä¿æŒå¤šé”è·å–é¡ºåºä¸€è‡´ã€‚</p>
</li>
<li>
<p>é¿å…åµŒå¥—é”ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>Monitor.TryEnter</code> è®¾ç½®è¶…æ—¶ï¼š</p>
</li>
</ul>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">if</span> (Monitor.TryEnter(_lockObj, TimeSpan.FromSeconds(<span class="hljs-number">1</span>)))
{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-comment">// ä¸´ç•ŒåŒº</span>
    }
    <span class="hljs-keyword">finally</span>
    {
        Monitor.Exit(_lockObj);
    }
}
<span class="hljs-keyword">else</span>
{
    <span class="hljs-comment">// è¶…æ—¶å¤„ç†</span>
}
</code></pre>
<h3 data-id="heading-11">å››ã€Lock çš„æ›¿ä»£æ–¹æ¡ˆ</h3>






























<table><thead><tr><th>åœºæ™¯</th><th>æ›¿ä»£æ–¹æ¡ˆ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è·¨è¿›ç¨‹åŒæ­¥</td><td><code>Mutex</code></td><td>æ”¯æŒå‘½åäº’æ–¥ä½“</td></tr><tr><td>é™åˆ¶å¹¶å‘æ•°</td><td><code>SemaphoreSlim</code></td><td>å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼ˆä¸Šé™å¯æ§ï¼‰</td></tr><tr><td>è¯»å¤šå†™å°‘</td><td><code>ReaderWriterLockSlim</code></td><td>è¯»æ“ä½œå¯å¹¶å‘ï¼Œå†™æ“ä½œç‹¬å </td></tr><tr><td>å¼‚æ­¥ç¯å¢ƒ</td><td><code>SemaphoreSlim.WaitAsync()</code></td><td><code>lock</code> ä¸æ”¯æŒ <code>await</code></td></tr></tbody></table>
<h4 data-id="heading-12">å¼‚æ­¥åœºæ™¯ç¤ºä¾‹ï¼ˆä¸èƒ½ç”¨ <code>lock</code>ï¼‰ï¼š</h4>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-comment">// âŒ ç¼–è¯‘é”™è¯¯</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">BadAsyncMethod</span>()</span>
{
    <span class="hljs-keyword">lock</span> (_lockObj)
    {
        <span class="hljs-keyword">await</span> SomeAsyncOperation(); <span class="hljs-comment">// ä¸å…è®¸</span>
    }
}

<span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SemaphoreSlim _asyncLock = <span class="hljs-keyword">new</span> SemaphoreSlim(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SafeAsyncMethod</span>()</span>
{
    <span class="hljs-keyword">await</span> _asyncLock.WaitAsync();
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">await</span> SomeAsyncOperation();
    }
    <span class="hljs-keyword">finally</span>
    {
        _asyncLock.Release();
    }
}
</code></pre>
<h3 data-id="heading-13">äº”ã€å®é™…æ¡ˆä¾‹ï¼šçº¿ç¨‹å®‰å…¨ç¼“å­˜</h3>
<pre><code class="hljs language-cs" lang="cs"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.Threading;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadSafeCache</span>&lt;<span class="hljs-title">TKey</span>, <span class="hljs-title">TValue</span>&gt;
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Dictionary&lt;TKey, TValue&gt; _cache = <span class="hljs-keyword">new</span> Dictionary&lt;TKey, TValue&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">object</span> _lockObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();

    <span class="hljs-function"><span class="hljs-keyword">public</span> TValue <span class="hljs-title">GetOrAdd</span>(<span class="hljs-params">TKey key, Func&lt;TKey, TValue&gt; valueFactory</span>)</span>
    {
        <span class="hljs-comment">// å…ˆå°è¯•æ— é”è¯»å–ï¼ˆä¹è§‚è¯»ï¼‰</span>
        <span class="hljs-keyword">if</span> (_cache.TryGetValue(key, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span>))
        {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span>;
        }

        <span class="hljs-comment">// åŠ é”é˜²æ­¢é‡å¤è®¡ç®—</span>
        <span class="hljs-keyword">lock</span> (_lockObj)
        {
            <span class="hljs-comment">// åŒé‡æ£€æŸ¥ï¼ˆDouble-Checkï¼‰</span>
            <span class="hljs-keyword">if</span> (_cache.TryGetValue(key, <span class="hljs-keyword">out</span> <span class="hljs-keyword">value</span>))
            {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span>;
            }

            <span class="hljs-keyword">value</span> = valueFactory(key);
            _cache[key] = <span class="hljs-keyword">value</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Remove</span>(<span class="hljs-params">TKey key</span>)</span>
    {
        <span class="hljs-keyword">lock</span> (_lockObj)
        {
            _cache.Remove(key);
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        <span class="hljs-keyword">var</span> cache = <span class="hljs-keyword">new</span> ThreadSafeCache&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">int</span>&gt;();

        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)
        {
            <span class="hljs-keyword">new</span> Thread(() =&gt;
            {
                <span class="hljs-keyword">var</span> result = cache.GetOrAdd(<span class="hljs-string">"test"</span>, key =&gt;
                {
                    Console.WriteLine(<span class="hljs-string">$"è®¡ç®—å€¼ for <span class="hljs-subst">{key}</span>"</span>);
                    <span class="hljs-keyword">return</span> key.Length;
                });

                Console.WriteLine(<span class="hljs-string">$"çº¿ç¨‹ <span class="hljs-subst">{Thread.CurrentThread.ManagedThreadId}</span> è·å–çš„å€¼: <span class="hljs-subst">{result}</span>"</span>);
            }).Start();
        }

        Thread.Sleep(<span class="hljs-number">1000</span>);
    }
}
</code></pre>
<h3 data-id="heading-14">æ€»ç»“</h3>
<p><code>lock</code> æ˜¯ C# ä¸­å®ç°çº¿ç¨‹åŒæ­¥æœ€ç›´è§‚ã€æœ€å¸¸ç”¨çš„å·¥å…·ï¼Œé€‚ç”¨äºç»å¤§å¤šæ•°éœ€è¦äº’æ–¥è®¿é—®å…±äº«èµ„æºçš„åœºæ™¯ã€‚ç„¶è€Œï¼Œåˆç†ä½¿ç”¨ <code>lock</code> éœ€éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ä¸“ç”¨çš„ <code>readonly object</code> ä½œä¸ºé”å¯¹è±¡ï¼›</p>
</li>
<li>
<p>å°½é‡ç¼©å°ä¸´ç•ŒåŒºèŒƒå›´ï¼›</p>
</li>
<li>
<p>é¿å…åœ¨é”å†…æ‰§è¡Œè€—æ—¶æˆ–å¯èƒ½å¼‚å¸¸çš„æ“ä½œï¼›</p>
</li>
<li>
<p>åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸­æ”¹ç”¨ <code>SemaphoreSlim</code>ï¼›</p>
</li>
<li>
<p>å¯¹äºé«˜å¹¶å‘è¯»åœºæ™¯ï¼Œè€ƒè™‘ <code>ReaderWriterLockSlim</code> æˆ–æ— é”ç»“æ„ã€‚</p>
</li>
</ul>
<p>é€šè¿‡æŒæ¡ <code>lock</code> çš„åŸç†ä¸æœ€ä½³å®è·µï¼Œå¹¶ç»“åˆå…¶ä»–åŒæ­¥åŸè¯­ï¼Œå¼€å‘è€…èƒ½å¤Ÿæ„å»ºå‡ºæ—¢çº¿ç¨‹å®‰å…¨åˆé«˜æ€§èƒ½çš„å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºã€‚</p>
<h3 data-id="heading-15">å…³é”®è¯</h3>
<p>lockã€çº¿ç¨‹åŒæ­¥ã€äº’æ–¥é”ã€ä¸´ç•ŒåŒºã€ç«æ€æ¡ä»¶ã€æ­»é”ã€Monitorã€Mutexã€SemaphoreSlimã€ReaderWriterLockSlimã€çº¿ç¨‹å®‰å…¨ã€C#ã€å¤šçº¿ç¨‹ã€å¼‚æ­¥é”ã€åŒé‡æ£€æŸ¥</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FByHOJiyC-0vpTSzXp6BQ4w" target="_blank" title="https://mp.weixin.qq.com/s/ByHOJiyC-0vpTSzXp6BQ4w" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/ByHOJiyC-â€¦</a></p>
<h3 data-id="heading-16">æœ€å</h3>
<p>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸å¦¨ç‚¹ä¸ªèµæ”¯æŒä¸€ä¸‹ï¼ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­åˆ†äº«çŸ¥è¯†çš„åŠ¨åŠ›ã€‚å¦‚æœæœ‰ä»»ä½•ç–‘é—®æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œæ¬¢è¿éšæ—¶ç•™è¨€ã€‚</p>
<p>ä¹Ÿå¯ä»¥åŠ å…¥å¾®ä¿¡å…¬ä¼—å· <strong>[DotNetæŠ€æœ¯åŒ ]</strong> ç¤¾åŒºï¼Œä¸å…¶ä»–çƒ­çˆ±æŠ€æœ¯çš„åŒè¡Œä¸€èµ·äº¤æµå¿ƒå¾—ï¼Œå…±åŒæˆé•¿ï¼</p>
<p><strong>ä¼˜ç§€æ˜¯ä¸€ç§ä¹ æƒ¯ï¼Œæ¬¢è¿å¤§å®¶ç•™è¨€å­¦ä¹ ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux Kernelï¼šäº‘åŸç”Ÿæ—¶ä»£çš„æ“ä½œç³»ç»Ÿå†…æ ¸]]></title>    <link>https://juejin.cn/post/7598699872541212691</link>    <guid>https://juejin.cn/post/7598699872541212691</guid>    <pubDate>2026-01-24T15:05:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872541212691" data-draft-id="7598587406706999337" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux Kernelï¼šäº‘åŸç”Ÿæ—¶ä»£çš„æ“ä½œç³»ç»Ÿå†…æ ¸"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-24T15:05:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äº‘æ ˆå¼€æºæ—¥è®°"/> <meta itemprop="url" content="https://juejin.cn/user/3643150216729880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux Kernelï¼šäº‘åŸç”Ÿæ—¶ä»£çš„æ“ä½œç³»ç»Ÿå†…æ ¸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3643150216729880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äº‘æ ˆå¼€æºæ—¥è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T15:05:47.000Z" title="Sat Jan 24 2026 15:05:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å®¹å™¨ä¸ºä»€ä¹ˆèƒ½éš”ç¦»è¿›ç¨‹ï¼ŸKubernetes æ€ä¹ˆé™åˆ¶ Pod èµ„æºï¼ŸeBPF ç›‘æ§çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ è¿™äº›é—®é¢˜çš„ç­”æ¡ˆï¼Œéƒ½æŒ‡å‘åŒä¸€ä¸ªå¼€æºé¡¹ç›®â€”â€”Linux Kernelã€‚å®ƒæ˜¯ Linus Torvalds åœ¨ 1991 å¹´åˆ›å»ºçš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå¦‚ä»Šå·²æˆä¸ºäº‘è®¡ç®—åŸºç¡€è®¾æ–½çš„æŠ€æœ¯åŸºçŸ³ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f52064a34fd4466ca4e55476a86e74c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqR5qCI5byA5rqQ5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769873929&amp;x-signature=rWp8NskQql%2FZeoqs19tU06cSXZw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯ Linux Kernel</h2>
<p>Linux Kernel æ˜¯ Linux æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†ç¡¬ä»¶èµ„æºã€è°ƒåº¦è¿›ç¨‹ã€åˆ†é…å†…å­˜ã€å¤„ç†ç½‘ç»œæ•°æ®åŒ…ã€‚æ‰€æœ‰è¿è¡Œåœ¨ Linux ç³»ç»Ÿä¸Šçš„åº”ç”¨ç¨‹åºï¼Œéƒ½éœ€è¦é€šè¿‡å†…æ ¸æ‰èƒ½ä½¿ç”¨ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘å¡ç­‰ç¡¬ä»¶èµ„æºã€‚</p>
<p>å¯¹äºè¿ç»´å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œç†è§£å†…æ ¸å·¥ä½œåŸç†æ„å‘³ç€ï¼š</p>
<ul>
<li>æ’æŸ¥æ•…éšœæ—¶èƒ½ç›´è¾¾é—®é¢˜æ ¹æº</li>
<li>æ€§èƒ½è°ƒä¼˜æ—¶çŸ¥é“ç“¶é¢ˆåœ¨å“ª</li>
<li>å®¹å™¨åŒ–éƒ¨ç½²æ—¶æ˜ç™½åº•å±‚æœºåˆ¶</li>
</ul>
<h2 data-id="heading-1">äº”å¤§æ ¸å¿ƒå­ç³»ç»Ÿ</h2>
<h3 data-id="heading-2">1. è¿›ç¨‹è°ƒåº¦å™¨</h3>
<p>é‡‡ç”¨ CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦å™¨ï¼‰ç®—æ³•ï¼Œå†³å®šå“ªä¸ªè¿›ç¨‹è·å¾— CPU æ—¶é—´ã€è¿è¡Œå¤šä¹…ã€‚è¿™æ˜¯å®¹å™¨ CPU é…é¢ç®¡ç†çš„åº•å±‚å®ç°ã€‚</p>
<p><strong>å®é™…åº”ç”¨</strong>ï¼šé€šè¿‡ <code>nice</code> å‘½ä»¤è°ƒæ•´æ•°æ®åº“è¿›ç¨‹ä¼˜å…ˆçº§ï¼Œä¿è¯æ ¸å¿ƒä¸šåŠ¡å“åº”é€Ÿåº¦ã€‚Kubernetes çš„ CPU Limit æœ€ç»ˆä¹Ÿæ˜¯ç”±è°ƒåº¦å™¨æ‰§è¡Œã€‚</p>
<h3 data-id="heading-3">2. å†…å­˜ç®¡ç†</h3>
<p>æä¾›è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œè®©æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œäº’ä¸å¹²æ‰°ã€‚å½“å†…å­˜ä¸è¶³æ—¶ï¼ŒOOM Killer ä¼šé€‰æ‹©ç»ˆæ­¢éƒ¨åˆ†è¿›ç¨‹é‡Šæ”¾èµ„æºã€‚</p>
<p><strong>è¿ç»´è¦ç‚¹</strong>ï¼š</p>
<ul>
<li>ç›‘æ§ <code>/proc/meminfo</code> æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>è°ƒæ•´ <code>vm.swappiness</code> å‚æ•°æ§åˆ¶ Swap ä½¿ç”¨</li>
<li>é…åˆ Kubernetes Memory QoS é¿å…å®¹å™¨ OOM</li>
</ul>
<p>äº‘æ ˆç¤¾åŒºåœ¨å®è·µä¸­å‘ç°ï¼Œåˆç†é…ç½®å†…å­˜å‚æ•°èƒ½æ˜¾è‘—é™ä½å®¹å™¨è¢«é©±é€çš„æ¦‚ç‡ã€‚</p>
<h3 data-id="heading-4">3. ç½‘ç»œåè®®æ ˆ</h3>
<p>ä»åº”ç”¨å±‚çš„ Socket åˆ°ç½‘ç»œè®¾å¤‡é©±åŠ¨çš„å®Œæ•´å®ç°ï¼Œæ”¯æŒ TCP/IPã€UDPã€Netfilterï¼ˆiptables å’Œ nftablesï¼‰ã€eBPF ç­‰æŠ€æœ¯ã€‚</p>
<p><strong>DevOps åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>tc</code> å‘½ä»¤è¿›è¡Œæµé‡æ•´å½¢</li>
<li>éƒ¨ç½² Cilium å®ç°åŸºäº eBPF çš„å®¹å™¨ç½‘ç»œ</li>
<li>è°ƒä¼˜ <code>net.core.somaxconn</code> æ”¯æŒé«˜å¹¶å‘è¿æ¥</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é«˜å¹¶å‘æœåŠ¡å™¨ç½‘ç»œä¼˜åŒ–</span>
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_tw_reuse = 1
</code></pre>
<h3 data-id="heading-5">4. è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</h3>
<p>æä¾›ç»Ÿä¸€çš„æ–‡ä»¶æ“ä½œæ¥å£ï¼Œå±è”½åº•å±‚æ–‡ä»¶ç³»ç»Ÿå·®å¼‚ï¼ˆext4ã€xfsã€btrfsï¼‰ã€‚Docker çš„å­˜å‚¨é©±åŠ¨ overlay2ã€devicemapper éƒ½åŸºäº VFS å®ç°ã€‚</p>
<p><strong>å…³é”®æŒ‡æ ‡</strong>ï¼š</p>
<ul>
<li>ç”¨ <code>df -i</code> ç›‘æ§ inode ä½¿ç”¨ç‡</li>
<li>è°ƒæ•´ <code>fs.file-max</code> æ”¯æŒå¤§è§„æ¨¡è¿æ¥</li>
<li>é€‰æ‹©åˆé€‚çš„å®¹å™¨å­˜å‚¨é©±åŠ¨</li>
</ul>
<p>æƒ³æ·±å…¥äº†è§£å­˜å‚¨æŠ€æœ¯ï¼Œå¯ä»¥è®¿é—®äº‘åŸç”Ÿ / IaaS å­¦ä¹ è·¯å¾„è·å–ç³»ç»ŸåŒ–èµ„æ–™ã€‚</p>
<h3 data-id="heading-6">5. è®¾å¤‡é©±åŠ¨</h3>
<p>æä¾›ç¡¬ä»¶æŠ½è±¡å±‚ï¼Œæ”¯æŒ GPUï¼ˆNVIDIAã€AMDï¼‰ã€RDMA ç½‘ç»œã€NVMe å­˜å‚¨ç­‰é«˜æ€§èƒ½è®¾å¤‡çš„ç»Ÿä¸€ç®¡ç†ã€‚</p>
<h2 data-id="heading-7">ä¸‰ä¸ªå…¸å‹è¿ç»´åœºæ™¯</h2>
<h3 data-id="heading-8">åœºæ™¯ä¸€ï¼šå†…æ ¸å‚æ•°è°ƒä¼˜</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># /etc/sysctl.conf é…ç½®ç¤ºä¾‹</span>
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 8192
fs.file-max = 2097152
vm.swappiness = 10
vm.dirty_ratio = 15
</code></pre>
<p>è¿™äº›å‚æ•°ç›´æ¥å½±å“ Web æœåŠ¡å™¨ã€æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—çš„æ€§èƒ½ä¸Šé™ã€‚æ‰§è¡Œ <code>sysctl -p</code> ä½¿é…ç½®ç”Ÿæ•ˆã€‚</p>
<h3 data-id="heading-9">åœºæ™¯äºŒï¼šå®¹å™¨éš”ç¦»æœºåˆ¶</h3>
<p>Docker çš„åº•å±‚å®ç°å°±æ˜¯ Namespaceï¼ˆéš”ç¦»è¿›ç¨‹ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿï¼‰åŠ  Cgroupsï¼ˆé™åˆ¶ CPUã€å†…å­˜ã€I/Oï¼‰ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‰‹åŠ¨åˆ›å»ºå®¹å™¨éš”ç¦»ç¯å¢ƒ</span>
unshare --pid --net --mount --uts --ipc /bin/bash

<span class="hljs-comment"># ä½¿ç”¨ Cgroups é™åˆ¶èµ„æº</span>
cgcreate -g cpu,memory:myapp
cgset -r cpu.shares=512 myapp
cgset -r memory.limit_in_bytes=1G myapp
</code></pre>
<p>ç†è§£è¿™äº›æœºåˆ¶ï¼Œæ‰èƒ½æ·±åº¦æ’æŸ¥å®¹å™¨ç½‘ç»œæ•…éšœã€èµ„æºäº‰æŠ¢é—®é¢˜ã€‚</p>
<h3 data-id="heading-10">åœºæ™¯ä¸‰ï¼šeBPF æ€§èƒ½ç›‘æ§</h3>
<p>é€šè¿‡å†…æ ¸çš„ eBPF æŠ€æœ¯ï¼Œå¯ä»¥é›¶ä¾µå…¥ç›‘æ§ç”Ÿäº§ç¯å¢ƒçš„ç³»ç»Ÿè°ƒç”¨ã€ç½‘ç»œæµé‡ã€å®‰å…¨äº‹ä»¶ã€‚Falcoã€Ciliumã€Pixie ç­‰å·¥å…·éƒ½åŸºäºæ­¤å®ç°ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ bpftrace è¿½è¸ª TCP è¿æ¥</span>
bpftrace -e <span class="hljs-string">'kprobe:tcp_v4_connect { 
  printf("PID %d connecting\n", pid); 
}'</span>
</code></pre>
<h2 data-id="heading-11">æ€§èƒ½åˆ†æå·¥å…·</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># CPU è°ƒåº¦å»¶è¿Ÿåˆ†æ</span>
perf <span class="hljs-built_in">sched</span> latency

<span class="hljs-comment"># è¿½è¸ªç³»ç»Ÿè°ƒç”¨</span>
strace -c -p &lt;pid&gt;

<span class="hljs-comment"># ç½‘ç»œè¿æ¥ç»Ÿè®¡</span>
ss -s &amp;&amp; nstat -az

<span class="hljs-comment"># I/O æ€§èƒ½ç›‘æ§</span>
iostat -x 1 &amp;&amp; iotop -o
</code></pre>
<p>è¿™äº›å·¥å…·ç›´æ¥è¯»å–å†…æ ¸æš´éœ²çš„æ€§èƒ½æŒ‡æ ‡ï¼Œæ˜¯æ•…éšœæ’æŸ¥çš„ç¬¬ä¸€æ‰‹èµ„æ–™ã€‚æ›´å¤šè¿ç»´å®æˆ˜æŠ€å·§å¯ä»¥æŸ¥çœ‹è¿ç»´ / DevOps / SRE å­¦ä¹ è·¯å¾„ã€‚</p>
<h2 data-id="heading-12">ç‰ˆæœ¬é€‰æ‹©å»ºè®®</h2>
<p>ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ LTSï¼ˆé•¿æœŸæ”¯æŒï¼‰ç‰ˆæœ¬ï¼š</p>
<ul>
<li><strong>6.6.x</strong>ï¼šæœ€æ–° LTSï¼Œæ”¯æŒåˆ° 2026 å¹´</li>
<li><strong>6.1.x</strong>ï¼šç¨³å®š LTSï¼Œæ”¯æŒåˆ° 2026 å¹´</li>
<li><strong>5.15.x</strong>ï¼šç»å…¸ LTSï¼Œæ”¯æŒåˆ° 2027 å¹´</li>
</ul>
<p>LTS ç‰ˆæœ¬æä¾›è‡³å°‘ 2 å¹´çš„å®‰å…¨è¡¥ä¸æ”¯æŒï¼ŒAPI æ¥å£ç¨³å®šï¼Œç»è¿‡ç¤¾åŒºå……åˆ†éªŒè¯ã€‚å¯¹äºè¿½æ±‚æè‡´æ€§èƒ½çš„åœºæ™¯ï¼ˆå¦‚é«˜é¢‘äº¤æ˜“ã€å®æ—¶éŸ³è§†é¢‘ï¼‰ï¼Œå¯è¯„ä¼°ä½¿ç”¨ Mainline ç‰ˆæœ¬çš„æ–°ç‰¹æ€§ï¼ˆå¦‚ io_uringã€MPTCPï¼‰ã€‚</p>
<h2 data-id="heading-13">å­¦ä¹ è·¯å¾„</h2>
<p><strong>åˆçº§é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>æŒæ¡ <code>sysctl</code> å‚æ•°è°ƒä¼˜</li>
<li>ä½¿ç”¨ <code>dmesg</code> åˆ†æå†…æ ¸æ—¥å¿—</li>
<li>ç†è§£è¿›ç¨‹ã€å†…å­˜ã€ç½‘ç»œåŸºæœ¬æ¦‚å¿µ</li>
</ul>
<p><strong>ä¸­çº§é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>perf</code>ã€<code>ftrace</code> å®šä½æ€§èƒ½ç“¶é¢ˆ</li>
<li>æŒæ¡ iptables å’Œ tc æµé‡æ§åˆ¶</li>
<li>ç¼–å†™ç®€å•çš„å†…æ ¸æ¨¡å—</li>
</ul>
<p><strong>é«˜çº§é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ç¼–å†™ eBPF ç¨‹åºå®ç°è‡ªå®šä¹‰ç›‘æ§</li>
<li>ä½¿ç”¨ kgdb å’Œ crash è°ƒè¯•å†…æ ¸</li>
<li>å‚ä¸ä¸Šæ¸¸ç¤¾åŒºè´¡çŒ®ä»£ç </li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyunpan.plus" target="_blank" title="https://yunpan.plus" ref="nofollow noopener noreferrer">äº‘æ ˆç¤¾åŒº</a>ï¼ˆ <code>https://yunpan.plus</code> ï¼‰æ•´ç†äº†å®Œæ•´çš„è®¡ç®—æœºåŸºç¡€å­¦ä¹ èµ„æ–™ï¼Œæ¶µç›–æ“ä½œç³»ç»Ÿã€ç½‘ç»œã€ç¼–è¯‘åŸç†ç­‰æ ¸å¿ƒçŸ¥è¯†ã€‚</p>
<h2 data-id="heading-14">ä¸ºä»€ä¹ˆè¿ç»´å¿…é¡»æ‡‚å†…æ ¸</h2>
<p>äº‘åŸç”Ÿæ—¶ä»£ï¼Œå®¹å™¨ã€å¾®æœåŠ¡ã€Service Mesh å±‚å‡ºä¸ç©·ï¼Œä½†å®ƒä»¬éƒ½è¿è¡Œåœ¨ Linux Kernel ä¹‹ä¸Šã€‚å½“ä½ ç†è§£äº†è¿›ç¨‹è°ƒåº¦ã€å†…å­˜ç®¡ç†ã€ç½‘ç»œåè®®æ ˆçš„å·¥ä½œåŸç†ï¼Œå°±èƒ½ï¼š</p>
<ul>
<li><strong>å¿«é€Ÿå®šä½æ•…éšœ</strong>ï¼šçŸ¥é“é—®é¢˜å‡ºåœ¨åº”ç”¨å±‚è¿˜æ˜¯å†…æ ¸å±‚</li>
<li><strong>ç²¾å‡†æ€§èƒ½è°ƒä¼˜</strong>ï¼šæ‰¾åˆ°çœŸæ­£çš„ç“¶é¢ˆè€Œä¸æ˜¯ç›²ç›®è°ƒå‚</li>
<li><strong>æ·±åº¦ç†è§£å®¹å™¨</strong>ï¼šæ˜ç™½ Docker å’Œ Kubernetes çš„åº•å±‚æœºåˆ¶</li>
<li><strong>æŒæ¡æ–°æŠ€æœ¯</strong>ï¼šeBPFã€io_uring ç­‰æ–°ç‰¹æ€§çš„åŸç†å’Œåº”ç”¨</li>
</ul>
<p>æŒæ¡å†…æ ¸ï¼Œå°±æ˜¯æŒæ¡äº‘åŸç”ŸåŸºç¡€è®¾æ–½çš„åº•å±‚é€»è¾‘ã€‚</p>
<p>ğŸ“Œ <strong>é¡¹ç›®åœ°å€</strong>ï¼š<code>github.com/torvalds/linux</code><br/>
ğŸ“– <strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š<code>kernel.org/doc</code><br/>
ğŸ› ï¸ <strong>æ€§èƒ½å·¥å…·</strong>ï¼š<code>github.com/iovisor/bcc</code><br/>
ğŸ“– <strong>Linuxå†…æ ¸å¼€å‘è¯¾</strong>ï¼š<code>https://yunpan.plus/t/574</code></p>
<hr/>
<p><strong>å…³æ³¨ã€Šäº‘æ ˆè¿ç»´äº‘åŸç”Ÿã€‹ï¼Œè·å–æ›´å¤šè¿ç»´ã€SREã€DevOps æŠ€æœ¯å¹²è´§ï¼</strong></p>
<p><strong>æ ‡ç­¾ï¼š</strong> #LinuxKernel #Github #äº‘åŸç”Ÿ #DevOps #å®¹å™¨æŠ€æœ¯ #eBPF #è¿ç»´</p>
<p>ä½œè€…ï¼š<code>https://yunpan.plus/t/1349-1-1</code> ç‰ˆæƒæ‰€æœ‰</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DOM-Offsetï¼šç²¾å‡†å®šä½ä¸å°ºå¯¸æµ‹é‡çš„åŸºçŸ³]]></title>    <link>https://juejin.cn/post/7598827845965496346</link>    <guid>https://juejin.cn/post/7598827845965496346</guid>    <pubDate>2026-01-24T13:42:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598827845965496346" data-draft-id="7598537377472069670" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DOM-Offsetï¼šç²¾å‡†å®šä½ä¸å°ºå¯¸æµ‹é‡çš„åŸºçŸ³"/> <meta itemprop="keywords" content="JavaScript,é¢è¯•,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T13:42:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‘ç°ä¸€åªå¤§å‘†ç“œ"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DOM-Offsetï¼šç²¾å‡†å®šä½ä¸å°ºå¯¸æµ‹é‡çš„åŸºçŸ³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‘ç°ä¸€åªå¤§å‘†ç“œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T13:42:11.000Z" title="Sat Jan 24 2026 13:42:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>åœ¨å®ç°æ‹–æ‹½ã€å¸é¡¶æ•ˆæœæˆ–è‡ªåŠ¨å®šä½ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦çŸ¥é“å…ƒç´ åœ¨é¡µé¢ä¸Šçš„ç¡®åˆ‡ä½ç½®å’Œå¤§å°ã€‚JavaScript æä¾›çš„ä¸€ç³»åˆ— <code>offset</code> å±æ€§æ­£æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚æœ¬æ–‡å°†å¸¦ä½ ç³»ç»Ÿç›˜ç‚¹è¿™äº›å±æ€§ï¼Œå¹¶å˜æ¸…å®ƒä»¬èƒŒåå¤æ‚çš„â€œå‚è€ƒç³»â€é€»è¾‘ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ æ ¸å¿ƒå±æ€§è¯¦è§£</h2>
<p><code>offset</code> å±æ€§æ˜¯åªè¯»çš„æ•°å­—ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ï¼Œåæ˜ äº†å…ƒç´ åœ¨é¡µé¢å¸ƒå±€ä¸­çš„ç‰©ç†çŠ¶æ€ã€‚</p>
<h3 data-id="heading-2">1. offsetWidth &amp; offsetHeight (å¸ƒå±€å°ºå¯¸)</h3>
<p>è¿™ä¸¤ä¸ªå±æ€§è¿”å›å…ƒç´ åœ¨é¡µé¢ä¸Šå ç”¨çš„å®é™…ç©ºé—´å¤§å°ã€‚</p>
<ul>
<li><strong>åŒ…å«å†…å®¹</strong>ï¼šå†…å®¹ï¼ˆContentï¼‰+ å†…è¾¹è·ï¼ˆPaddingï¼‰+ <strong>è¾¹æ¡†ï¼ˆBorderï¼‰</strong> + æ»šåŠ¨æ¡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼š<strong>ä¸åŒ…å«å¤–è¾¹è·ï¼ˆMarginï¼‰</strong> ã€‚</li>
</ul>
<h3 data-id="heading-3">2. offsetLeft &amp; offsetTop (ç›¸å¯¹ä½ç½®)</h3>
<ul>
<li><strong><code>offsetLeft</code></strong>ï¼šå…ƒç´ å·¦å¤–è¾¹æ¡†ç›¸å¯¹äºå…¶ <code>offsetParent</code> å·¦å†…è¾¹æ¡†çš„è·ç¦»ã€‚</li>
<li><strong><code>offsetTop</code></strong>ï¼šå…ƒç´ ä¸Šå¤–è¾¹æ¡†ç›¸å¯¹äºå…¶ <code>offsetParent</code> ä¸Šå†…è¾¹æ¡†çš„è·ç¦»ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">äºŒã€ å…³é”®ç‚¹ï¼šè°æ˜¯ offsetParentï¼Ÿ</h2>
<p><code>offsetLeft/Top</code> çš„å€¼å‡†ç¡®ä¸å¦ï¼Œå®Œå…¨å–å†³äºå®ƒçš„â€œå‚ç…§ç‰©â€â€”â€”<code>offsetParent</code>ã€‚</p>
<p><strong>ç¡®å®š <code>offsetParent</code> çš„è§„åˆ™ï¼š</strong></p>
<ol>
<li><strong>å®šä½ä¼˜å…ˆ</strong>ï¼šè·ç¦»å½“å‰å…ƒç´ æœ€è¿‘çš„ <code>position</code> å±æ€§ä¸ä¸º <code>static</code> çš„ç¥–å…ˆå…ƒç´ ã€‚</li>
<li><strong>ç‰¹æ®Šå®¹å™¨</strong>ï¼šå¦‚æœç¥–å…ˆå…ƒç´ éƒ½æœªå®šä½ï¼Œåˆ™æŒ‡å‘æœ€è¿‘çš„ <code>table</code>ã€<code>td</code>ã€<code>th</code> å…ƒç´ ã€‚</li>
<li><strong>åŒ…å«å—æ‰©å±•</strong>ï¼šè®¾ç½®äº† <code>transform</code>ã€<code>perspective</code> æˆ– <code>filter</code> å±æ€§çš„ç¥–å…ˆå…ƒç´ ã€‚</li>
<li><strong>æ ¹èŠ‚ç‚¹</strong>ï¼šè‹¥ä»¥ä¸Šçš†æ— ï¼Œåˆ™æŒ‡å‘ <code>&lt;body&gt;</code>ã€‚</li>
<li><strong>ä¾‹å¤–</strong>ï¼šå¦‚æœæ˜¯ <code>display: none</code> çš„å…ƒç´ æˆ– <code>fixed</code> å®šä½çš„å…ƒç´ ï¼ˆåœ¨æŸäº›æµè§ˆå™¨ä¸­ï¼‰ï¼Œè¿”å› <code>null</code>ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ å®æˆ˜ï¼šè®¡ç®—å…ƒç´ åœ¨é¡µé¢ä¸Šçš„ç»å¯¹ä½ç½®</h2>
<p>ç”±äº <code>offsetLeft</code> åªèƒ½è·å–ç›¸å¯¹äºçˆ¶çº§çš„è·ç¦»ï¼Œå¦‚æœæˆ‘ä»¬è¦è·å–å…ƒç´ ç›¸å¯¹äº<strong>æ•´ä¸ªæ–‡æ¡£</strong>çš„ç»å¯¹ä½ç½®ï¼Œéœ€è¦é€’å½’å åŠ ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getElementActualPos</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-keyword">let</span> actualLeft = element.<span class="hljs-property">offsetLeft</span>;
    <span class="hljs-keyword">let</span> actualTop = element.<span class="hljs-property">offsetTop</span>;
    <span class="hljs-keyword">let</span> current = element.<span class="hljs-property">offsetParent</span>;

    <span class="hljs-keyword">while</span> (current !== <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// ç´¯åŠ çˆ¶çº§çš„åç§»</span>
        actualLeft += current.<span class="hljs-property">offsetLeft</span> + current.<span class="hljs-property">clientLeft</span>; 
        actualTop += current.<span class="hljs-property">offsetTop</span> + current.<span class="hljs-property">clientTop</span>;
        current = current.<span class="hljs-property">offsetParent</span>;
    }

    <span class="hljs-keyword">return</span> { <span class="hljs-attr">left</span>: actualLeft, <span class="hljs-attr">top</span>: actualTop };
}
</code></pre>
<hr/>
<h2 data-id="heading-6">å››ã€ offset vs style (é¢è¯•é«˜é¢‘)</h2>






























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>offsetWidth / offsetTop</strong></th><th><strong>element.style.width / top</strong></th></tr></thead><tbody><tr><td><strong>è¯»å†™æ€§</strong></td><td><strong>åªè¯»</strong></td><td>å¯è¯»ã€å¯å†™</td></tr><tr><td><strong>è¿”å›å€¼ç±»å‹</strong></td><td>æ•°å€¼ï¼ˆå¦‚ <code>100</code>ï¼‰</td><td>å­—ç¬¦ä¸²ï¼ˆå¦‚ <code>"100px"</code>ï¼‰</td></tr><tr><td><strong>è·å–èŒƒå›´</strong></td><td>åŒ…å«è¾¹æ¡†ã€å†…è¾¹è·ç­‰</td><td>ä»…å–å†³äº CSS è®¾ç½®çš„å€¼</td></tr><tr><td><strong>å³æ—¶æ€§</strong></td><td>è·å–çš„æ˜¯æ¸²æŸ“åçš„æœ€ç»ˆåƒç´ å€¼</td><td>åªèƒ½è·å–å†…è”æ ·å¼ï¼ˆStyle å±æ€§ä¸­å†™çš„ï¼‰</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">äº”ã€ é¢è¯•æ¨¡æ‹Ÿé¢˜</h2>
<h3 data-id="heading-8">Q1ï¼šä¸ºä»€ä¹ˆ <code>offset</code> å±æ€§æ˜¯åªè¯»çš„ï¼Ÿ</h3>
<p><strong>å‚è€ƒå›ç­”ï¼š</strong></p>
<p><code>offset</code> å±æ€§æ˜¯æµè§ˆå™¨æ ¹æ®å½“å‰é¡µé¢çš„å¸ƒå±€è®¡ç®—å‡ºæ¥çš„ç»“æœã€‚å¦‚æœå…è®¸ç›´æ¥ä¿®æ”¹ <code>offsetWidth</code>ï¼Œæµè§ˆå™¨æ— æ³•ç¡®å®šä½ æ˜¯æƒ³æ”¹å˜ <code>padding</code>ã€<code>border</code> è¿˜æ˜¯ <code>content</code> å®½åº¦ã€‚ä¿®æ”¹å¸ƒå±€åº”é€šè¿‡ <code>style.width</code> ç­‰å±æ€§è¿›è¡Œã€‚</p>
<h3 data-id="heading-9">Q2ï¼š<code>offsetWidth</code> å’Œ <code>getBoundingClientRect().width</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p><strong>å‚è€ƒå›ç­”ï¼š</strong></p>
<ul>
<li><code>offsetWidth</code> å§‹ç»ˆè¿”å›<strong>æ•´æ•°</strong>ã€‚</li>
<li><code>getBoundingClientRect()</code> è¿”å›<strong>æµ®ç‚¹æ•°</strong>ï¼Œåœ¨å¤„ç†ç¼©æ”¾ï¼ˆCSS transform scaleï¼‰åçš„å…ƒç´ æ—¶æ›´ç²¾ç¡®ï¼Œå®ƒè¿”å›çš„æ˜¯å±å¹•æ¸²æŸ“çš„è§†è§‰å°ºå¯¸ï¼Œè€Œ <code>offsetWidth</code> è¿”å›çš„æ˜¯å¸ƒå±€å°ºå¯¸ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS3 æ˜Ÿçƒå¤§æˆ˜ï¼šç”¨çº¯ CSS å®ç°ç»å…¸ç‰‡å¤´å­—å¹•åŠ¨ç”»]]></title>    <link>https://juejin.cn/post/7598480413804085290</link>    <guid>https://juejin.cn/post/7598480413804085290</guid>    <pubDate>2026-01-24T14:05:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598480413804085290" data-draft-id="7598587406706851881" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS3 æ˜Ÿçƒå¤§æˆ˜ï¼šç”¨çº¯ CSS å®ç°ç»å…¸ç‰‡å¤´å­—å¹•åŠ¨ç”»"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T14:05:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·411924458439"/> <meta itemprop="url" content="https://juejin.cn/user/221443581553930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS3 æ˜Ÿçƒå¤§æˆ˜ï¼šç”¨çº¯ CSS å®ç°ç»å…¸ç‰‡å¤´å­—å¹•åŠ¨ç”»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/221443581553930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·411924458439
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T14:05:05.000Z" title="Sat Jan 24 2026 14:05:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>å‰ç«¯æ˜¯ä»£ç ç•Œçš„å¯¼æ¼”</strong>Â â€”â€” æ— éœ€è§†é¢‘ã€æ— éœ€ JavaScriptï¼Œä»…å‡­ HTML ç»“æ„ä¸ CSS3 åŠ¨ç”»ï¼Œæˆ‘ä»¬å°±èƒ½é‡ç°ã€Šæ˜Ÿçƒå¤§æˆ˜ã€‹é‚£ä»¤äººéš¾å¿˜çš„ 3D é‡‘è‰²å­—å¹•ç¼“ç¼“é£å‘æ˜Ÿç©ºçš„ç»å…¸å¼€åœºã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œç”¨ç°ä»£å‰ç«¯æŠ€æœ¯å®ç°è¿™ä¸€æ ‡å¿—æ€§æ•ˆæœï¼Œæ·±å…¥ç†è§£Â <strong>è¯­ä¹‰åŒ– HTML</strong>ã€<strong>CSS3 3D å˜æ¢</strong>Â ä¸Â <strong>å…³é”®å¸§åŠ¨ç”»</strong>Â çš„æ ¸å¿ƒåŸç†ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€é¡¹ç›®ç›®æ ‡ä¸æŠ€æœ¯é€‰å‹</h2>
<p>æˆ‘ä»¬è¦å¤åˆ»çš„æ•ˆæœæ˜¯ï¼š</p>
<ul>
<li>é»‘è‰²å®‡å®™èƒŒæ™¯</li>
<li>é‡‘è‰² â€œSTAR WARSâ€ Logoï¼ˆSVGï¼‰</li>
<li>å±…ä¸­é»„è‰²ç”µå½±å‰¯æ ‡é¢˜ï¼ˆå¦‚ â€œEPISODE VIIâ€ï¼‰</li>
<li>13 è¡Œç™½è‰²æ»šåŠ¨å­—å¹•ï¼ˆâ€œA long time ago...â€ï¼‰</li>
</ul>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼š</p>
<ul>
<li>HTML5ï¼šæ„å»ºè¯­ä¹‰åŒ–ç»“æ„</li>
<li>CSS3ï¼š<code>@keyframes</code>ã€<code>transform</code>ã€<code>perspective</code>ã€<code>3D transforms</code></li>
<li>çº¯é™æ€å®ç°ï¼Œ<strong>é›¶ JavaScript</strong></li>
</ul>
<hr/>
<h2 data-id="heading-1">äºŒã€HTML ç»“æ„ï¼šè¯­ä¹‰ä¼˜å…ˆï¼Œç»“æ„æ¸…æ™°</h2>
<p>è‰¯å¥½çš„ HTML æ˜¯åŠ¨ç”»çš„åŸºç¡€ã€‚æˆ‘ä»¬æŒ‰å†…å®¹å±‚çº§ç»„ç»‡ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CSS3 Star Wars<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"reset.css"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"style.css"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"starwars"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- STAR WARS Logo --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./star.svg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"STAR"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"star"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./wars.svg"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"WARS"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"wars"</span> /&gt;</span>

    <span class="hljs-comment">&lt;!-- ç”µå½±å‰¯æ ‡é¢˜ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"byline"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"byline"</span>&gt;</span>EPISODE VII<span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span>THE FORCE AWAKENS<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- æ»šåŠ¨å­—å¹•ï¼ˆ13è¡Œï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"crawl"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>A long time ago, in a galaxy far, far away....<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>It is a period of civil war.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>Rebel spaceships, striking from a hidden base,<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>have won their first victory against the evil Galactic Empire.<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- ... å…±13ä¸ª span ... --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>

























<table><thead><tr><th>å…ƒç´ </th><th>è¯­ä¹‰ç†ç”±</th></tr></thead><tbody><tr><td>div class="starwars"</td><td>å®¹å™¨ï¼ŒåŒ…è£¹æ•´ä¸ªåœºæ™¯</td></tr><tr><td><code>&lt;img&gt;</code>Â withÂ <code>alt</code></td><td>SVG å›¾æ ‡éœ€å¯è®¿é—®æ€§æè¿°</td></tr><tr><td>h2 class="byline"</td><td>å‰¯æ ‡é¢˜å±äºäºŒçº§æ ‡é¢˜ï¼Œ<code>byline</code>Â è¡¨ç¤ºç”µå½±ä¿¡æ¯</td></tr><tr><td><code>&lt;div class="crawl"&gt;</code>Â +Â <code>&lt;span&gt;</code></td><td>å­—å¹•æ˜¯è¿ç»­æ–‡æœ¬å—ï¼Œæ¯ä¸ªÂ <code>&lt;span&gt;</code>Â ä»£è¡¨ä¸€è¡Œï¼ˆä¾¿äºæ§åˆ¶è¡Œé«˜å’ŒåŠ¨ç”»ï¼‰</td></tr></tbody></table>
<blockquote>
<p>ğŸ“ŒÂ <strong>ä¸ºä»€ä¹ˆç”¨ 13 ä¸ªÂ <code>&lt;span&gt;</code>ï¼Ÿ</strong><br/>
å› ä¸ºåŸç‰‡å­—å¹•å…±çº¦ 13 è¡Œï¼Œæ¯è¡Œç‹¬ç«‹æ§åˆ¶æ›´çµæ´»ï¼ˆå¦‚è¡Œé—´è·ã€æ·¡å‡ºæ•ˆæœï¼‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€CSS Resetï¼šç»Ÿä¸€æµè§ˆå™¨é»˜è®¤æ ·å¼</h2>
<p>åœ¨Â <code>reset.css</code>Â ä¸­ä½¿ç”¨æ ‡å‡†é‡ç½®ï¼ˆå‚è€ƒå‰æ–‡ï¼‰ï¼Œç¡®ä¿ï¼š</p>
<ul>
<li>æ‰€æœ‰å…ƒç´ Â <code>margin/padding</code>Â ä¸º 0</li>
<li><code>box-sizing: border-box</code></li>
<li>å›¾ç‰‡å“åº”å¼ï¼š<code>max-width: 100%</code></li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* reset.css */</span>
*, *<span class="hljs-selector-pseudo">::before</span>, *<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Arial'</span>, sans-serif;
}
<span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">100%</span>;
}
</code></pre>
<h2 data-id="heading-3">å››ã€æ ¸å¿ƒåŠ¨ç”»å®ç°ï¼šCSS3 3D æ»šåŠ¨å­—å¹•</h2>
<h3 data-id="heading-4">1. è®¾ç½®å…¨å±€ 3D ç¯å¢ƒ</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* style.css */</span>
<span class="hljs-selector-class">.starwars</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-comment">/* åˆ›å»º 3D é€è§†ç©ºé—´ */</span>
  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>;
}
</code></pre>
<ul>
<li><code>perspective: 400px</code>ï¼šå®šä¹‰ 3D ç©ºé—´çš„â€œé•œå¤´è·ç¦»â€ï¼Œå€¼è¶Šå°ï¼Œçºµæ·±æ„Ÿè¶Šå¼ºã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">2. Logo åŠ¨ç”»ï¼šSTAR ä¸ WARS åˆ†ç¦»é£å…¥</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.star</span>, <span class="hljs-selector-class">.wars</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">animation</span>: logoAppear <span class="hljs-number">4s</span> forwards;
}

<span class="hljs-selector-class">.wars</span> {
  <span class="hljs-attribute">animation-delay</span>: <span class="hljs-number">1s</span>; <span class="hljs-comment">/* WARS ç¨åå‡ºç° */</span>
}

<span class="hljs-keyword">@keyframes</span> logoAppear {
  <span class="hljs-number">0%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>); }
  <span class="hljs-number">70%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.2</span>); }
  <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>); }
}
</code></pre>
<h3 data-id="heading-6">3. å‰¯æ ‡é¢˜Â <code>.byline</code>ï¼šå±…ä¸­æ·¡å…¥</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.byline</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">60%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">50%</span>);
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffcc00</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2.5em</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">animation</span>: bylineFadeIn <span class="hljs-number">2s</span> <span class="hljs-number">3s</span> forwards; <span class="hljs-comment">/* 3ç§’åå¼€å§‹ */</span>
}

<span class="hljs-keyword">@keyframes</span> bylineFadeIn {
  <span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
}
</code></pre>
<h3 data-id="heading-7">4. æ ¸å¿ƒï¼š<code>.crawl</code>Â å­—å¹• 3D æ»šåŠ¨åŠ¨ç”»</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.crawl</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-comment">/* å…³é”®ï¼šå¯ç”¨ 3D å˜æ¢ */</span>
  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d;
  <span class="hljs-attribute">animation</span>: crawlUp <span class="hljs-number">60s</span> linear infinite;
}

<span class="hljs-selector-class">.crawl</span> <span class="hljs-selector-tag">span</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5em</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.8em</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.4</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
}

<span class="hljs-keyword">@keyframes</span> crawlUp {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>) <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">25deg</span>);
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2000px</span>) <span class="hljs-built_in">rotateX</span>(<span class="hljs-number">25deg</span>);
  }
}
</code></pre>
<h3 data-id="heading-8">ğŸ”‘ åŠ¨ç”»åŸç†ï¼š</h3>
<ul>
<li><code>rotateX(25deg)</code>ï¼šè®©æ–‡å­—å¹³é¢å€¾æ–œï¼Œæ¨¡æ‹Ÿâ€œé£å‘è¿œæ–¹â€çš„é€è§†æ•ˆæœï¼›</li>
<li><code>translateY(-2000px)</code>ï¼šå°†æ•´ä¸ªå­—å¹•å—å‘ä¸Šç§»åŠ¨ï¼Œè¶…å‡ºè§†å£åå¾ªç¯ï¼›</li>
<li><code>animation: 60s linear infinite</code>ï¼šåŒ€é€Ÿæ»šåŠ¨ 60 ç§’ï¼Œæ— é™å¾ªç¯ã€‚</li>
</ul>
<blockquote>
<p>ğŸ’¡Â <strong>ä¸ºä»€ä¹ˆä¸ç”¨Â <code>scroll</code>ï¼Ÿ</strong><br/>
å› ä¸º CSS æ»šåŠ¨æ— æ³•å®ç° 3D é€è§†ï¼Œå¿…é¡»ç”¨Â <code>transform</code>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">äº”ã€ä¼˜åŒ–ç»†èŠ‚ï¼šæå‡æ²‰æµ¸æ„Ÿ</h2>
<h3 data-id="heading-10">1. å­—ä½“é€‰æ‹©</h3>
<p>ä½¿ç”¨ç±»ä¼¼åŸç‰‡çš„å­—ä½“ï¼ˆå¦‚Â <code>Orbitron</code>Â æˆ–Â <code>Arial Black</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Orbitron'</span>, <span class="hljs-string">'Arial Black'</span>, sans-serif;
}
</code></pre>
<h3 data-id="heading-11">2. æ¸éšæ•ˆæœ</h3>
<p>è®©é¡¶éƒ¨å­—å¹•é€æ¸æ¶ˆå¤±ï¼ˆæ¨¡æ‹Ÿè¿œå»ï¼‰ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.crawl</span> {
  <span class="hljs-attribute">mask-image</span>: <span class="hljs-built_in">linear-gradient</span>(to top, transparent <span class="hljs-number">0%</span>, black <span class="hljs-number">30%</span>, black <span class="hljs-number">90%</span>, transparent <span class="hljs-number">100%</span>);
}
</code></pre>
<h3 data-id="heading-12">3. å“åº”å¼é€‚é…</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.byline</span> { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.8em</span>; }
  <span class="hljs-selector-class">.crawl</span> <span class="hljs-selector-tag">span</span> { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.4em</span>; }
}
</code></pre>
<h2 data-id="heading-13">å…­ã€å®Œæ•´é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-txt" lang="txt">css-starwars/
â”œâ”€â”€ index.html
â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ reset.css
â”‚   â””â”€â”€ style.css
â””â”€â”€ star.svg
â””â”€â”€ wars.svg
</code></pre>
<h2 data-id="heading-14">ä¸ƒã€æ€»ç»“ï¼šCSS3 çš„å¼ºå¤§è¡¨ç°åŠ›</h2>
<p>é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬éªŒè¯äº†ï¼š</p>
<ul>
<li><strong>HTML è¯­ä¹‰åŒ–</strong>Â æ˜¯å¯ç»´æŠ¤æ€§çš„åŸºçŸ³ï¼›</li>
<li><strong>CSS3 åŠ¨ç”»</strong>Â èƒ½å®ç°å¤æ‚è§†è§‰æ•ˆæœï¼Œæ— éœ€ JSï¼›</li>
<li><strong>3D Transforms + Keyframes</strong>Â æ˜¯åˆ›å»ºæ²‰æµ¸å¼ä½“éªŒçš„æ ¸å¿ƒï¼›</li>
<li><strong>æ€§èƒ½ä¼˜å¼‚</strong>ï¼šçº¯ CSS åŠ¨ç”»ç”± GPU åŠ é€Ÿï¼Œæµç•…åº¦é«˜ã€‚</li>
</ul>
<blockquote>
<p>ğŸŒŸÂ <strong>å‰ç«¯å³å¯¼æ¼”</strong>ï¼šä½ ç”¨ä»£ç ç¼–å†™å‰§æœ¬ï¼ˆHTMLï¼‰ï¼Œç”¨æ ·å¼è®¾è®¡é•œå¤´ï¼ˆCSSï¼‰ï¼Œæœ€ç»ˆåœ¨ç”¨æˆ·çš„å±å¹•ä¸Šâ€œæ”¾æ˜ â€ä¸€åœºè§†è§‰ç››å®´ã€‚</p>
</blockquote>
<p>ç°åœ¨ï¼Œæ‰“å¼€ä½ çš„ç¼–è¾‘å™¨ï¼Œç”¨å‡ è¡Œ CSSï¼Œå¸¦ç”¨æˆ·ç©¿è¶Šåˆ°é‚£ä¸ªâ€œé¥è¿œçš„é“¶æ²³ç³»â€å§ï¼</p>
<blockquote>
<p><strong>å½©è›‹</strong>ï¼šå°†Â <code>background</code>Â æ”¹ä¸ºæ˜Ÿç©ºå›¾ç‰‡ï¼Œæˆ–æ·»åŠ æ˜Ÿæ˜Ÿé—ªçƒåŠ¨ç”»ï¼Œæ•ˆæœæ›´éœ‡æ’¼ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter å®ç°ä¸€ä¸ªå®¹å™¨å†…éƒ¨å…ƒç´ å¯å¹³ç§»ã€ç¼©æ”¾å’Œæ—‹è½¬ç­‰åŠŸèƒ½ï¼ˆåä¸€ï¼‰]]></title>    <link>https://juejin.cn/post/7598699872541245459</link>    <guid>https://juejin.cn/post/7598699872541245459</guid>    <pubDate>2026-01-24T15:07:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598699872541245459" data-draft-id="7598480413804167210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter å®ç°ä¸€ä¸ªå®¹å™¨å†…éƒ¨å…ƒç´ å¯å¹³ç§»ã€ç¼©æ”¾å’Œæ—‹è½¬ç­‰åŠŸèƒ½ï¼ˆåä¸€ï¼‰"/> <meta itemprop="keywords" content="Flutter,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T15:07:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åå­—è¢«ä½ ä»¬æƒ³å®Œäº†"/> <meta itemprop="url" content="https://juejin.cn/user/3065854916834782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter å®ç°ä¸€ä¸ªå®¹å™¨å†…éƒ¨å…ƒç´ å¯å¹³ç§»ã€ç¼©æ”¾å’Œæ—‹è½¬ç­‰åŠŸèƒ½ï¼ˆåä¸€ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3065854916834782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åå­—è¢«ä½ ä»¬æƒ³å®Œäº†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T15:07:56.000Z" title="Sat Jan 24 2026 15:07:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter å®ç°ä¸€ä¸ªå®¹å™¨å†…éƒ¨å…ƒç´ å¯å¹³ç§»ã€ç¼©æ”¾å’Œæ—‹è½¬ç­‰åŠŸèƒ½ï¼ˆåä¸€ï¼‰</h2>
<p>Flutter: 3.35.7</p>
<p>å‰é¢æˆ‘ä»¬å®ç°äº†ç½‘æ ¼è¾…åŠ©çº¿ç­‰åŠŸèƒ½ï¼Œæ‹¥æœ‰è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±èƒ½å¾ˆå¥½çš„å®šä½å…ƒç´ åœ¨å®¹å™¨å†…çš„ä½ç½®ã€‚ä»Šå¤©æˆ‘ä»¬å°±ä¸»è¦å®ç°å…ƒç´ å±‚çº§çš„ç›¸å…³æ“ä½œã€‚</p>
<p>åœ¨æˆ‘ä»¬ä¹‹å‰çš„åŠŸèƒ½ä¸­ï¼Œå…ƒç´ ä¸ªæ•°æ¯”è¾ƒå°‘ï¼Œå½“å…ƒç´ ä¸ªæ•°è¾¾åˆ°ä¸€å®šæ•°é‡åï¼Œè‚¯å®šä¼šå­˜åœ¨è¦†ç›–çš„æƒ…å†µï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯éœ€è¦æ“ä½œçš„å…ƒç´ ä¸€å®šæ˜¯åœ¨é¡¶å±‚ï¼Œæ‰€ä»¥å°±éœ€è¦å¯¹å±‚çº§è¿›è¡Œè¾…åŠ©æ§åˆ¶ã€‚è€Œä¸”å±‚çº§æ“ä½œä¸»è¦æ˜¯é’ˆå¯¹å½“å‰é€‰ä¸­çš„å…ƒç´ ï¼Œæ‰€ä»¥åœ¨æœªé€‰ä¸­å…ƒç´ çš„æ—¶å€™å°±ä¸å…è®¸ç‚¹å‡»ã€‚</p>
<p>å…ƒç´ å±‚çº§çš„æ§åˆ¶ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š</p>
<ol>
<li>æ“ä½œå½“å‰é€‰ä¸­å…ƒç´ çš„å±‚çº§</li>
<li>é€‰ä¸­ç‚¹å‡»åæ ‡å†…çš„æŸä¸ªå±‚çº§çš„å…ƒç´ ï¼Œä¸è‡³äºä¸€å®šè¦ä¿è¯å®ƒåœ¨é¡¶å±‚ä¹Ÿå¯é€‰ä¸­è¿›è¡Œæ“ä½œ</li>
</ol>
<p>å› ä¸ºå…ƒç´ å±‚çº§çš„æ“ä½œæ¶‰åŠåˆ°å‡ ä¸ªï¼Œä»¥å¼€å¯æŒ‰é’®ä½ç½®ä¸ºåŸºå‡†å®šä½å±•ç¤ºï¼Œæ‰€ä»¥è¦ä½¿ç”¨åˆ°OverlayEntryï¼Œæˆ‘ä»¬å•ç‹¬æŠ½å–ç»“æ„ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'base_icon_button.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LevelBar</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> LevelBar({
    <span class="hljs-keyword">super</span>.key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onChangeUsePosition,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.usePosition,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.disabled,
  });

  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>() onChangeUsePosition;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> usePosition;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> disabled;

  <span class="hljs-meta">@override</span>
  State&lt;LevelBar&gt; createState() =&gt; _LevelBarState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_LevelBarState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">LevelBar</span>&gt; </span>{
  <span class="hljs-comment">/// <span class="markdown">ç”¨äºè·å–å®šä½ä¿¡æ¯</span></span>
  <span class="hljs-keyword">final</span> GlobalKey _globalKey = GlobalKey();
  <span class="hljs-comment">/// <span class="markdown">å®¹å™¨</span></span>
  OverlayEntry? _overlayEntry;
  <span class="hljs-comment">/// <span class="markdown">å®½é«˜å®šä½ä¿¡æ¯ç”¨äºå®šä½å®¹å™¨</span></span>
  <span class="hljs-built_in">double</span> _barWidth = <span class="hljs-number">0</span>;
  <span class="hljs-built_in">double</span> _barHeight = <span class="hljs-number">0</span>;
  <span class="hljs-built_in">double</span> _barTop = <span class="hljs-number">0</span>;
  <span class="hljs-built_in">double</span> _barLeft = <span class="hljs-number">0</span>;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> didUpdateWidget(<span class="hljs-keyword">covariant</span> LevelBar oldWidget) {
    <span class="hljs-keyword">super</span>.didUpdateWidget(oldWidget);

    <span class="hljs-comment">// å½“ä½¿ç”¨å±‚çº§å·¥å…·ï¼Œå±•ç¤ºï¼Œä¸ä½¿ç”¨ï¼Œéšè—</span>
    <span class="hljs-keyword">if</span> (oldWidget.usePosition != widget.usePosition) {
      <span class="hljs-keyword">if</span> (widget.usePosition == <span class="hljs-keyword">false</span>) {
        _hideLevelBar();
      } <span class="hljs-keyword">else</span> {
        WidgetsBinding.instance.addPostFrameCallback((_) {
          _showLevelBar();
        });
      }
    }
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> dispose() {
    _globalKey.currentState?.dispose();
    _hideLevelBar();
    <span class="hljs-keyword">super</span>.dispose();
  }

  <span class="hljs-comment">/// <span class="markdown">éšè—å±‚çº§å·¥å…·æ </span></span>
  <span class="hljs-keyword">void</span> _hideLevelBar() {
    <span class="hljs-keyword">if</span> (_overlayEntry != <span class="hljs-keyword">null</span>) {
      _overlayEntry?.remove();
      _overlayEntry = <span class="hljs-keyword">null</span>;
    }
  }

  <span class="hljs-comment">/// <span class="markdown">å±•ç¤ºå±‚çº§å·¥å…·æ </span></span>
  <span class="hljs-keyword">void</span> _showLevelBar() {
    _getDimensions();
    _hideLevelBar();

    <span class="hljs-comment">// åˆ›å»º OverlayEntry</span>
    _overlayEntry = OverlayEntry(
      builder: (context) =&gt; Positioned(
        top: _barHeight + _barTop,
        left: _barLeft - <span class="hljs-number">100</span> + _barWidth / <span class="hljs-number">2</span>,
        child: Material(
          borderRadius: BorderRadius.circular(<span class="hljs-number">10</span>),
          child: Container(
            width: <span class="hljs-number">200</span>,
            decoration: BoxDecoration(
              color: Color(<span class="hljs-number">0xFFF0F0F0</span>),
              border: Border.all(
                color: Colors.blueAccent,
                width: <span class="hljs-number">2</span>,
              ),
              borderRadius: BorderRadius.circular(<span class="hljs-number">10</span>),
            ),
            child: Row(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                BaseIconButton(
                  iconSrc: <span class="hljs-string">'assets/images/icon_top.png'</span>,
                  onPressed: () {},
                ),
                BaseIconButton(
                  iconSrc: <span class="hljs-string">'assets/images/icon_upper_level.png'</span>,
                  onPressed: () {},
                ),
                BaseIconButton(
                  iconSrc: <span class="hljs-string">'assets/images/icon_next_level.png'</span>,
                  onPressed: () {},
                ),
                BaseIconButton(
                  iconSrc: <span class="hljs-string">'assets/images/icon_bottom.png'</span>,
                  onPressed: () {},
                ),
              ],
            ),
          ),
        ),
      ),
    );

    <span class="hljs-comment">// æ’å…¥ Overlay</span>
    Overlay.of(context).insert(_overlayEntry!);
  }

  <span class="hljs-comment">/// <span class="markdown">è·å–å°ºå¯¸å’Œå¸ƒå±€ä¿¡æ¯</span></span>
  <span class="hljs-keyword">void</span> _getDimensions() {
    RenderBox? renderBox = _globalKey.currentContext?.findRenderObject() <span class="hljs-keyword">as</span> RenderBox?;

    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æˆåŠŸè·å–</span>
    <span class="hljs-keyword">if</span> (renderBox != <span class="hljs-keyword">null</span>) {
      _barWidth = renderBox.size.width;
      _barHeight = renderBox.size.height;
      Offset offset = renderBox.localToGlobal(Offset.zero);
      _barTop = offset.dy;
      _barLeft = offset.dx;
    }
  }

  <span class="hljs-keyword">void</span> _onTap() {
    <span class="hljs-keyword">if</span> (!widget.disabled) {
      widget.onChangeUsePosition();
    }
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> BaseIconButton(
      key: _globalKey,
      iconSrc: <span class="hljs-string">'assets/images/icon_level.png'</span>,
      onPressed: _onTap,
      isSelected: widget.usePosition,
      disabled: widget.disabled,
    );
  }
}
</code></pre>
<p>å±•ç¤ºæ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84a32ee42b714943b792a50d1c691b9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769872075&amp;x-signature=23eaBfEAhnnRnHPIX2mvUKa%2FG0E%3D" alt="image01.gif" loading="lazy"/></p>
<p>è¿™æ ·å°±ç®€å•å®ç°äº†å±‚çº§å·¥å…·æ çš„å±•ç¤ºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å®ç°åŠŸèƒ½ã€‚å±‚çº§æ“ä½œçš„åŠŸèƒ½æ— éå°±æ˜¯é‚£å‡ ç§ï¼Œä¸ç›¸é‚»çš„äº¤æ¢ï¼ˆä¸Šä¸€å±‚æˆ–è€…ä¸‹ä¸€å±‚ï¼‰ï¼Œç½®é¡¶æˆ–è€…ç½®åº•ã€‚</p>
<p>ç®€å•åˆ†æä¸€ä¸‹ï¼š</p>
<ul>
<li>ä¸Šä¸€å±‚ï¼šå½“å…ƒç´ å¹¶ä¸æ˜¯å¤„äºæœ€é¡¶å±‚çš„æ—¶å€™ï¼Œå°†å½“å‰å…ƒç´ ä¸åä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½®</li>
<li>ä¸‹ä¸€å±‚ï¼šå½“å…ƒç´ å¹¶ä¸æ˜¯å¤„äºæœ€åº•å±‚çš„æ—¶å€™ï¼Œå°†å½“å‰å…ƒç´ ä¸å‰ä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½®</li>
<li>ç½®é¡¶ï¼šå½“å…ƒç´ å¹¶ä¸æ˜¯å¤„äºé¡¶å±‚çš„æ—¶å€™ï¼Œå°†å½“å‰å…ƒç´ æåˆ°æœ€é¡¶å±‚</li>
<li>ç½®åº•ï¼šå½“å…ƒç´ å¹¶ä¸æ˜¯å¤„äºåº•å±‚çš„æ—¶å€™ï¼Œå°†å½“å‰å…ƒç´ æåˆ°æœ€åº•å±‚</li>
</ul>
<p>Stack ä¸­å…ƒç´ çš„å †å é¡ºåºæ˜¯å†™å…¥çš„å­å…ƒç´ çš„é¡ºåºï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ“ä½œå…ƒç´ åˆ—è¡¨å³å¯ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">å¤„ç†å±‚çº§</span></span>
<span class="hljs-keyword">void</span> _onLevel(LevelType type) {
  <span class="hljs-keyword">final</span> index = _elementList.indexWhere((ele) =&gt; ele.id == _currentElement?.id);
  <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">-1</span>) {
    <span class="hljs-keyword">final</span> len = _elementList.length;
    <span class="hljs-keyword">final</span> tempItem = _elementList[index];

    <span class="hljs-keyword">if</span> (type == LevelType.top &amp;&amp; index != (len <span class="hljs-number">-1</span>)) {
      _elementList.removeAt(index);
      _elementList.insert(len - <span class="hljs-number">1</span>, tempItem);
      setState(() {});
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == LevelType.bottom &amp;&amp; index != <span class="hljs-number">0</span>) {
      _elementList.removeAt(index);
      _elementList.insert(<span class="hljs-number">0</span>, tempItem);
      setState(() {});
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == LevelType.upper &amp;&amp; index &lt; (len <span class="hljs-number">-1</span>)) {
      _elementList[index] = _elementList[index + <span class="hljs-number">1</span>];
      _elementList[index + <span class="hljs-number">1</span>] = tempItem;
      setState(() {});
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == LevelType.next &amp;&amp; index &gt; <span class="hljs-number">0</span>) {
      _elementList[index] = _elementList[index - <span class="hljs-number">1</span>];
      _elementList[index - <span class="hljs-number">1</span>] = tempItem;
      setState(() {});
    }
  }
}
</code></pre>
<p>æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ad464f832524c20b75246460b212867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769872075&amp;x-signature=IkaPu%2FGDoNwelg%2BBbekqmM6wYb0%3D" alt="image02.gif" loading="lazy"/></p>
<p>è¿™æ ·å°±ç®€å•å®ç°äº†å±‚çº§çš„å˜åŒ–ï¼Œæ¥ä¸‹é‡Œæˆ‘ä»¬å°±æ¥å®ç°é€‰ä¸­ã€‚å½“æˆ‘ä»¬ç‚¹å‡»æŸä¸ªåŒºåŸŸæƒ³é€‰ä¸­å…¶ä¸­çš„æŸä¸ªå…ƒç´ å¹¶è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯å¹¶ä¸æƒ³è°ƒæ•´å…ƒç´ çš„å±‚çº§ï¼Œæ°å¥½è¿™ä¸ªå…ƒç´ éœ²å‡ºæ¥çš„ä¸œè¥¿å¾ˆå°‘ï¼Œæˆ–è€…å¹²è„†å°±æ˜¯ä¸€ä¸ªé€æ˜çš„ç›¸æ¡†ï¼Œæˆ‘æƒ³è¦æ“ä½œç›¸æ¡†ä¸‹é¢çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦é¢å¤–çš„åŠŸèƒ½æ¥è¾…åŠ©æˆ‘ä»¬å®ç°è¿™å—åŠŸèƒ½ã€‚ç›®å‰æˆ‘ä»¬å“åº”æ‰‹åŠ¿çš„åŒºåŸŸè™½ç„¶æ˜¯æ•´ä¸ªå˜æ¢åŒºåŸŸï¼Œä½†æ˜¯å®é™…ä¸Šåªæœ‰æ‰‹æŒ‡åœ¨å…ƒç´ å†…éƒ¨çš„æ—¶å€™æ‰èƒ½æ‰§è¡Œæ“ä½œï¼Œå½“å…ƒç´ å †å åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œå˜æ¢æ“ä½œå°†ä¼šå˜å¾—å¾ˆä¸æµç•…ï¼Œå› ä¸ºå“åº”æ‰‹åŠ¿çš„å…ƒç´ å§‹ç»ˆæ˜¯æœ€é¡¶å±‚å…ƒç´ ï¼Œå…ƒç´ ä¹‹å¤–å°±è‡ªåŠ¨æ‰§è¡Œäº†æ¸…ç©ºæ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆå¯¹è¿™å—è¿›è¡Œæ”¹å˜ã€‚</p>
<p>æ”¹å˜æ‰‹åŠ¿é€»è¾‘ï¼š</p>
<ul>
<li>ç‚¹å‡»
<ul>
<li>å¦‚æœæ²¡æœ‰é€‰ä¸­å…ƒç´ ï¼Œåˆ™ä¸åšä»»ä½•äº‹æƒ…ï¼›</li>
<li>å¦‚æœå­˜åœ¨é€‰ä¸­å…ƒç´ ï¼Œåˆ™è®°å½•ç‚¹å‡»ç‚¹å’Œåˆå§‹åŒ–æ•°æ®ï¼Œåˆ¤æ–­å½“å‰ç‚¹å‡»ç‚¹è½åœ¨å“ªä¸ªå“åº”åŒºåŸŸï¼Œå¦‚æœæ²¡æœ‰åœ¨ä»»ä½•çš„å“åº”åŒºåŸŸï¼Œåˆ™é»˜è®¤ä¸ºç§»åŠ¨</li>
</ul>
</li>
<li>æ»‘åŠ¨
<ul>
<li>åªåˆ¤æ–­æ˜¯å¦å­˜åœ¨å½“å‰å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥æ‰§è¡Œæ»‘åŠ¨ï¼Œä¸è®ºæ˜¯åœ¨å…ƒç´ å†…éƒ¨æˆ–è€…å…ƒç´ å¤–éƒ¨ï¼ˆä¸ºäº†æ–¹ä¾¿åœ¨å…ƒç´ å¾ˆå°æˆ–è€…å †å åœ¨ä¸€èµ·çš„æ—¶å€™éœ€è¦å¾®è°ƒï¼Œè¿™æ ·å¯ä»¥æ›´æ¸…æ¥šçš„çœ‹åˆ°æ ·å¼ï¼‰ï¼›</li>
<li>åªè¦å‘ç”Ÿäº†å¤§äº1ä¸ªå•ä½çš„ç§»åŠ¨ï¼Œåˆ™æ ‡è®°å½“å‰å·²ç»æ‰§è¡Œäº†ç§»åŠ¨ï¼›</li>
</ul>
</li>
<li>æŠ¬èµ·
<ul>
<li>å¦‚æœä¸å­˜åœ¨é€‰ä¸­çš„å…ƒç´ 
<ul>
<li>åˆ¤æ–­æŠ¬èµ·ç‚¹åŒºåŸŸèŒƒå›´å†…æ˜¯å¦å­˜åœ¨å…ƒç´ ï¼Œå­˜åœ¨å°±é€‰ä¸­ï¼›</li>
</ul>
</li>
<li>å¦‚æœå­˜åœ¨é€‰ä¸­çš„å…ƒç´ 
<ul>
<li>æ²¡æœ‰æ‰§è¡Œç§»åŠ¨æ“ä½œ
<ul>
<li>åˆ¤æ–­å“åº”çš„åŒºåŸŸæ˜¯å¦å­˜åœ¨å…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ç½®ç©ºï¼›</li>
<li>åˆ¤æ–­å­˜åœ¨çš„å…ƒç´ å’Œé€‰ä¸­çš„å…ƒç´ æ˜¯å¦æ˜¯åŒä¸€ä¸ªï¼Œå¦‚æœä¸æ˜¯åŒä¸€ä¸ªï¼Œåˆ™é€‰ä¸­è¿™ä¸ªå…ƒç´ ï¼›</li>
<li>å¦‚æœæ˜¯åœ¨å“åº”å…ƒç´ çš„downè§¦å‘æ–¹å¼çš„åŒºåŸŸï¼Œåˆ™æ‰§è¡Œè¿™äº›åŒºåŸŸçš„ç‰¹å®šäº‹ä»¶ï¼ˆä¾‹å¦‚åˆ é™¤ä¹‹ç±»çš„æ“ä½œï¼‰ï¼›</li>
<li>å¦‚æœæ˜¯åœ¨å“åº”å…ƒç´ çš„åŒºåŸŸå†…ï¼Œä¸”ä¸åœ¨downè§¦å‘çš„åŒºåŸŸï¼Œåˆ™æ‰§è¡Œç½®ç©ºï¼ˆæœ¬æ¥å­˜åœ¨å“åº”çš„å…ƒç´ ï¼Œå†æ¬¡æŒ‰åœ¨å“åº”çš„åŒºåŸŸï¼Œåˆ™è¯´æ˜æ˜¯ç¬¬äºŒæ¬¡ç‚¹å‡»ï¼Œå°±ç½®ç©ºã€‚è¿™ç§æ˜¯ä¸ºäº†é˜²æ­¢åœ¨å˜æ¢åŒºåŸŸå†…ä¸å­˜åœ¨æ²¡æœ‰å…ƒç´ çš„ç©ºç™½åŒºåŸŸï¼Œæ­¤æ—¶å°±æ— æ³•å–æ¶ˆé€‰ä¸­ï¼Œæ‰€ä»¥åŠ å…¥ç‚¹å‡»ä¸¤æ¬¡å°±å–æ¶ˆé€‰ä¸­çš„é€»è¾‘ï¼‰ï¼›</li>
</ul>
</li>
<li>æ‰§è¡Œäº†ç§»åŠ¨åˆ™ä¸åšä»»ä½•æ“ä½œï¼Œåªæ‰§è¡ŒåŸºç¡€é€»è¾‘</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé€»è¾‘ç†æ¸…æ¥šäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®ç°äº†ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">æŒ‰ä¸‹äº‹ä»¶</span></span>
<span class="hljs-keyword">void</span> _onPanDown(DragDownDetails details) {
  <span class="hljs-comment">// å½“å­˜åœ¨é€‰ä¸­å…ƒç´ çš„æ—¶å€™ï¼Œè®°å½•ç‚¹å‡»ç‚¹å’Œåˆå§‹åŒ–æ•°æ®</span>
  <span class="hljs-keyword">if</span> (_currentElement != <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> dx = details.localPosition.dx;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> dy = details.localPosition.dy;
    <span class="hljs-keyword">final</span> (<span class="hljs-built_in">String</span>, TriggerMethod)? status = _onDownZone(
      x: dx,
      y: dy,
      item: _currentElement!,
    );

    _temporary = TemporaryModel(
      x: _currentElement!.x,
      y: _currentElement!.y,
      width: _currentElement!.elementWidth,
      height: _currentElement!.elementHeight,
      rotationAngle: _currentElement!.rotationAngle,
      status: status?.$<span class="hljs-number">1</span> ?? ElementStatus.move.value,
      trigger: status?.$<span class="hljs-number">2</span> ?? TriggerMethod.move,
    );
    _startPosition = Offset(dx, dy);
    
    setState(() {});
  }
}
</code></pre>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">æŒ‰ä¸‹ç§»åŠ¨äº‹ä»¶</span></span>
<span class="hljs-keyword">void</span> _onPanUpdate(DragUpdateDetails details) {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> x = details.localPosition.dx;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> y = details.localPosition.dy;

  <span class="hljs-keyword">if</span> (
    _currentElement == <span class="hljs-keyword">null</span>
      || _temporary == <span class="hljs-keyword">null</span>
      || ((x - _startPosition.dx).abs() &lt; <span class="hljs-number">1</span> &amp;&amp; (y - _startPosition.dy).abs() &lt; <span class="hljs-number">1</span> &amp;&amp; !_isMove)
  ) {
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-comment">// æ–°å¢ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœå‘ç”Ÿäº†ä¸€ä¸ªå•ä½çš„ç§»åŠ¨ä¸”ç§»åŠ¨çŠ¶æ€æœªfalseï¼Œåˆ™æ ‡è®°ç§»åŠ¨ä¸ºtrue</span>
  _isMove = <span class="hljs-keyword">true</span>;

  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function?</span> fn = _onElementStatus(x: x, y: y)[_temporary?.status];

  <span class="hljs-keyword">if</span> (_temporary?.trigger == TriggerMethod.move) {
    <span class="hljs-keyword">if</span> (fn != <span class="hljs-keyword">null</span>) {
      fn();
    } <span class="hljs-keyword">else</span> {
      _onCustomFn(
        element: _currentElement!,
        tapPoint: _startPosition,
        movePoint: Offset(x, y),
        status: _temporary?.status,
      );
    }
  }
}
</code></pre>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">ç»“æŸäº‹ä»¶</span></span>
<span class="hljs-keyword">void</span> _onPanEnd(DragEndDetails details) {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> dx = details.localPosition.dx;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> dy = details.localPosition.dy;

  ElementModel? currentElement;

  <span class="hljs-comment">// åˆ¤æ–­æŠ¬èµ·ç‚¹çš„åŒºåŸŸæ˜¯å¦å­˜åœ¨å…ƒç´ </span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = (_elementList.length - <span class="hljs-number">1</span>); i &gt;= <span class="hljs-number">0</span>; i--) {
    <span class="hljs-keyword">final</span> item = _elementList[i];
    <span class="hljs-keyword">final</span> (<span class="hljs-built_in">String</span>, TriggerMethod)? status = _onDownZone(
      x: dx,
      y: dy,
      item: item,
    );

    <span class="hljs-keyword">if</span> (status != <span class="hljs-keyword">null</span>) {
      currentElement = item;
      <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-keyword">if</span> (_currentElement == <span class="hljs-keyword">null</span> &amp;&amp; currentElement != <span class="hljs-keyword">null</span>) {
    <span class="hljs-comment">// å¦‚æœä¸å­˜åœ¨å½“å‰å…ƒç´ ï¼Œä½†æ˜¯æŠ¬èµ·çš„åŒºåŸŸå†…å­˜åœ¨å…ƒç´ ï¼Œ</span>
    <span class="hljs-comment">// åˆ™é€‰ä¸­è¿™ä¸ªå…ƒç´ </span>
    _currentElement = currentElement;
    setState(() {});
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (!_isMove) {
      <span class="hljs-keyword">if</span> (currentElement == <span class="hljs-keyword">null</span>) {
        <span class="hljs-comment">// å¦‚æœæŠ¬èµ·çš„åŒºåŸŸå†…ä¸å­˜åœ¨ä»»ä½•çš„å…ƒç´ ï¼Œ</span>
        <span class="hljs-comment">// åˆ™è¯´æ˜æ˜¯ç©ºç™½åŒºåŸŸï¼Œè¿™æ‰§è¡Œæ¸…ç©º</span>
        _clean();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (currentElement.id == _currentElement?.id) {
          <span class="hljs-comment">// å¦‚æœå“åº”åŒºåŸŸçš„å…ƒç´ å’Œé€‰ä¸­çš„å…ƒç´ æ˜¯åŒä¸€ä¸ªï¼Œ</span>
          <span class="hljs-comment">// åˆ™åˆ¤æ–­ç‚¹å‡»åŒºåŸŸï¼Œå¦‚æœç‚¹å‡»åŒºåŸŸæ˜¯å“åº”downçš„åŒºåŸŸï¼Œ</span>
          <span class="hljs-comment">// åˆ™æ‰§è¡Œå¯¹åº”çš„downæ–¹æ³•</span>
          <span class="hljs-keyword">final</span> (<span class="hljs-built_in">String</span>, TriggerMethod)? status = _onDownZone(
            x: dx,
            y: dy,
            item: _currentElement!,
          );

          <span class="hljs-keyword">if</span> (status != <span class="hljs-keyword">null</span> &amp;&amp; status.$<span class="hljs-number">2</span> == TriggerMethod.down) {
            <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function?</span> fn = _onElementStatus(x: dx, y: dy)[status.$<span class="hljs-number">1</span>];

            <span class="hljs-keyword">if</span> (fn != <span class="hljs-keyword">null</span>) {
              fn();
            } <span class="hljs-keyword">else</span> {
              _onCustomFn(
                element: _currentElement!,
                tapPoint: Offset(dx, dy),
                status: status.$<span class="hljs-number">1</span>,
              );
            }

            <span class="hljs-keyword">if</span> (status.$<span class="hljs-number">1</span> == ElementStatus.deleteStatus.value) {
              <span class="hljs-comment">// å› ä¸ºæ˜¯åˆ é™¤ï¼Œå°±ç½®ç©ºé€‰ä¸­ï¼Œè®©ä¸‹é¢ä»£ç æ‰§è¡Œæœ€åçš„æ¸…é™¤</span>
              _clean();
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// å¦‚æœä¸å­˜åœ¨downæ–¹æ³•ï¼Œåˆ™è¯´æ˜æ˜¯äºŒæ¬¡ç‚¹å‡»ï¼Œ</span>
            <span class="hljs-comment">// åˆ™å–æ¶ˆé€‰ä¸­</span>
            _clean();
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// å¦‚æœä¸æ˜¯åŒä¸€ä¸ªå…ƒç´ ï¼Œåˆ™é€‰ä¸­å¦å¤–çš„é‚£ä¸ªå…ƒç´ </span>
          _currentElement = currentElement;
          setState(() {});
        }
      }
    }
  }

  <span class="hljs-comment">// ä¹‹å‰çš„é€»è¾‘</span>
  <span class="hljs-keyword">if</span> (_currentElement?.type != ElementType.textType.type &amp;&amp; _isShowTextOptions) {
    setState(() {
      _isShowTextOptions = <span class="hljs-keyword">false</span>;
    });
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_currentElement?.type == ElementType.textType.type &amp;&amp; !_isShowTextOptions) {
    setState(() {
      _isShowTextOptions = <span class="hljs-keyword">true</span>;
    });
  }

  <span class="hljs-comment">// é‡ç½®ç§»åŠ¨çŠ¶æ€</span>
  _isMove = <span class="hljs-keyword">false</span>;
}
</code></pre>
<p>æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6924f34ea90744d4a3862cf081e6589c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769872075&amp;x-signature=V53muWDqW%2BsW02g0agtzsI7VyHw%3D" alt="image03.gif" loading="lazy"/></p>
<p>è¿™æ ·æˆ‘ä»¬å°±ç®€å•æ›´æ”¹äº†æ‰‹åŠ¿çš„é€»è¾‘ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿å…ƒç´ å †å åœ¨ä¸€èµ·äº†ï¼Œæˆ‘ä¹ˆä¹Ÿå¯ä»¥åœ¨å¦å¤–çš„åŒºåŸŸå“åº”ç§»åŠ¨æ‰‹åŠ¿ï¼Œè€Œä¸æ˜¯éœ€è¦åœ¨å…ƒç´ åŒºåŸŸå†…ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ¥å®ç°å †å å…ƒç´ çš„é€‰ä¸­äº†ï¼Œå¤§è‡´æ˜¯ä¸ºäº†å¥½æ“ä½œä¸‹é¢è¿™ç§æƒ…å†µï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef637c8a7527462d8495d998f017886a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769872075&amp;x-signature=8T6%2BpF85NyUWl309jydyEELozrk%3D" alt="image04.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸‹é¢é‚£å¼ å›¾ç‰‡åœ¨å®é™…ä¸­ç”¨æ‰‹å»ç‚¹å‡»å¾ˆéš¾ç‚¹å‡»åˆ°ï¼Œå¦‚æœæˆ‘ä»¬å°±åƒæ“ä½œä¸‹é¢é‚£å¼ å›¾ç‰‡ï¼Œå°±å¿…é¡»å°†ä¸Šé¢å›¾ç‰‡ç§»å¼€ç„¶åå†é€‰ä¸­æ“ä½œï¼Œè¿™é‡Œå¸ƒå±€è¾ƒä¸ºç®€å•ï¼Œå¦‚æœæˆ‘ä»¬è¾›è¾›è‹¦è‹¦çš„å®Œæˆäº†ä¸€ä¸ªå¾ˆå¥½çœ‹çš„æµ·æŠ¥ï¼Œå°±å› ä¸ºè¿™ç‚¹å°å°çš„ç‘•ç–µï¼Œå°±è¦ç§»å¼€ä¸Šé¢çš„å…ƒç´ å»æ“ä½œä¸‹é¢çš„å…ƒç´ ç„¶åé‡æ–°æ’ç‰ˆï¼Œè¿™æ ·çš„æ“ä½œå¾ˆè®©äººå¤´ç–¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åœ¨è¿™ä¸ªç‚¹å‡»ç‚¹å†…çš„æ‰€æœ‰å…ƒç´ éƒ½ç½—åˆ—å‡ºæ¥ï¼Œé»˜è®¤é€‰ä¸­é¡¶å±‚çš„å…ƒç´ ï¼Œå…¶ä»–å…ƒç´ æ’åˆ—åˆ°ä¸€æ—ï¼Œæƒ³é€‰ä¸­è°å°±é€‰ä¸­è°ï¼Œè¿™æ ·å°±èƒ½æå¤§çš„æ–¹ä¾¿æˆ‘ä»¬æ“ä½œï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">ç»“æŸäº‹ä»¶</span></span>
<span class="hljs-keyword">void</span> _onPanEnd(DragEndDetails details) {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> dx = details.localPosition.dx;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> dy = details.localPosition.dy;

  <span class="hljs-comment">// æ¯æ¬¡ç»“æŸåç½®ç©ºé€‰ä¸­</span>
  setState(() {
    _allOptionalElement.clear();
  });
  ElementModel? currentElement;

  <span class="hljs-comment">// åˆ¤æ–­æŠ¬èµ·ç‚¹çš„åŒºåŸŸæ˜¯å¦å­˜åœ¨å…ƒç´ </span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = (_elementList.length - <span class="hljs-number">1</span>); i &gt;= <span class="hljs-number">0</span>; i--) {
    <span class="hljs-keyword">final</span> item = _elementList[i];
    <span class="hljs-keyword">final</span> (<span class="hljs-built_in">String</span>, TriggerMethod)? status = _onDownZone(
      x: dx,
      y: dy,
      item: item,
    );

    <span class="hljs-keyword">if</span> (status != <span class="hljs-keyword">null</span>) {
      <span class="hljs-comment">// æ–°å¢å¦‚æœæ˜¯åœ¨ç‚¹å‡»åŒºåŸŸå†…å¯é€‰ä¸­çš„å…ƒç´ ï¼Œåˆ™åŠ å…¥å¯é€‰åˆ—è¡¨</span>
      _allOptionalElement.add(item);
      currentElement ??= item;
      <span class="hljs-comment">// break;</span>
    }
  }
  
  <span class="hljs-comment">// å…¶ä»–åˆ é™¤...</span>
}
</code></pre>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'models/element_model.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AllOptionalElementList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> AllOptionalElementList({
    <span class="hljs-keyword">super</span>.key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onSelected,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.list,
  });

  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;ElementModel&gt; list;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Function</span>(ElementModel) onSelected;

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Container(
      width: <span class="hljs-number">60</span>,
      padding: EdgeInsets.symmetric(vertical: <span class="hljs-number">20</span>),
      decoration: BoxDecoration(
        color: Color(<span class="hljs-number">0xFFF0F0F0</span>),
        border: Border.all(
          color: Colors.blueAccent,
          width: <span class="hljs-number">2</span>,
        ),
        borderRadius: BorderRadius.circular(<span class="hljs-number">10</span>),
      ),
      constraints: BoxConstraints(
        maxHeight: <span class="hljs-number">200</span>,
      ),
      child: SingleChildScrollView(
        child: Column(
          spacing: <span class="hljs-number">10</span>,
          children: [
            ...list.map((item) =&gt; GestureDetector(
              onTap: () =&gt; onSelected(item),
              child: Row(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  <span class="hljs-keyword">if</span> (item.type == ElementType.imageType.type) Image.file(
                    File(item.imagePath!),
                    width: <span class="hljs-number">50</span>,
                    height: <span class="hljs-number">50</span>,
                    fit: BoxFit.scaleDown,
                  ),

                  <span class="hljs-keyword">if</span> (item.type == ElementType.textType.type &amp;&amp; item.textOptions != <span class="hljs-keyword">null</span>) SizedBox(
                    width: <span class="hljs-number">50</span>,
                    child: Text(
                      item.textOptions!.text,
                      style: TextStyle(
                        fontSize: <span class="hljs-number">10</span>,
                      ),
                      maxLines: <span class="hljs-number">2</span>,
                      overflow: TextOverflow.ellipsis,
                    ),
                  ),
                ],
              ),
            )),
          ],
        ),
      ),
    );
  }
}
</code></pre>
<p>æ•ˆæœï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81bd0d23be7e4de9b01c4ede303af28d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769872075&amp;x-signature=5kSavcnvGyWcz488QjRmpgsM9hU%3D" alt="image05.gif" loading="lazy"/></p>
<p>ç²—ç³™çš„å®ç°äº†åŠŸèƒ½ï¼Œå¤§è‡´çš„æ•ˆæœå°±æ˜¯å¦‚æ­¤ï¼Œè¿™æ ·å°±å¯ä»¥è®©æˆ‘ä»¬é€‰ä¸­éé¡¶å±‚å…ƒç´ äº†ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥å¾ˆå¥½çš„æ“ä½œã€‚</p>
<p>ä»Šå¤©çš„åˆ†äº«å°±åˆ°æ­¤ç»“æŸäº†ï¼Œæ„Ÿè°¢é˜…è¯»ï½æ‹œæ‹œï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1. Vue3å¿…å­¦ï¼šdefineAsyncComponentå››å¤§é…ç½®å…¨æ”»ç•¥ï¼Œç»„ä»¶æ‡’åŠ è½½ç§’ä¸Šæ‰‹]]></title>    <link>https://juejin.cn/post/7598614012183887899</link>    <guid>https://juejin.cn/post/7598614012183887899</guid>    <pubDate>2026-01-24T15:41:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598614012183887899" data-draft-id="7598947628449054747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1. Vue3å¿…å­¦ï¼šdefineAsyncComponentå››å¤§é…ç½®å…¨æ”»ç•¥ï¼Œç»„ä»¶æ‡’åŠ è½½ç§’ä¸Šæ‰‹"/> <meta itemprop="keywords" content="JavaScript,Vue.js,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-24T15:41:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="boooooooom"/> <meta itemprop="url" content="https://juejin.cn/user/3078273283917399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1. Vue3å¿…å­¦ï¼šdefineAsyncComponentå››å¤§é…ç½®å…¨æ”»ç•¥ï¼Œç»„ä»¶æ‡’åŠ è½½ç§’ä¸Šæ‰‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3078273283917399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    boooooooom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T15:41:29.000Z" title="Sat Jan 24 2026 15:41:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Vue 3 ä¸­ï¼Œ<code>defineAsyncComponent</code> æ˜¯å®ç°ç»„ä»¶æ‡’åŠ è½½çš„æ ¸å¿ƒ APIï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬æŒ‰éœ€åŠ è½½ç»„ä»¶ã€ä¼˜åŒ–åº”ç”¨é¦–å±åŠ è½½é€Ÿåº¦ï¼Œå°¤å…¶é€‚ç”¨äºå¤§å‹åº”ç”¨ä¸­ç»„ä»¶æ•°é‡å¤šã€ä½“ç§¯å¤§çš„åœºæ™¯ã€‚æœ¬æ–‡å°†ä»åŸºç¡€ç”¨æ³•å…¥æ‰‹ï¼Œè¯¦ç»†æ‹†è§£å…¶ loadingã€errorã€delayã€timeout å››å¤§é…ç½®çš„åŠŸèƒ½ä¸å®è·µï¼Œå¸®ä½ å½»åº•æŒæ¡ç»„ä»¶å¼‚æ­¥åŠ è½½çš„ç²¾é«“ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€defineAsyncComponent åŸºç¡€ç”¨æ³•</h2>
<p>ç»„ä»¶æ‡’åŠ è½½çš„æ ¸å¿ƒé€»è¾‘æ˜¯â€œåœ¨éœ€è¦æ—¶æ‰åŠ è½½ç»„ä»¶ä»£ç â€ï¼Œè€Œéåº”ç”¨åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰ç»„ä»¶ã€‚Vue 3 æä¾›äº† <code>defineAsyncComponent</code> æ–¹æ³•å°è£…å¼‚æ­¥ç»„ä»¶ï¼Œæ”¯æŒä¸¤ç§åŸºç¡€ç”¨æ³•ï¼šç®€å•è¯­æ³•å’Œå®Œæ•´é…ç½®è¯­æ³•ã€‚</p>
<h3 data-id="heading-1">1. ç®€å•è¯­æ³•ï¼ˆä»…æŒ‡å®šåŠ è½½å‡½æ•°ï¼‰</h3>
<p>æœ€ç®€æ´çš„ç”¨æ³•æ˜¯ä¼ å…¥ä¸€ä¸ªè¿”å› Promise çš„åŠ è½½å‡½æ•°ï¼Œè¯¥å‡½æ•°å†…éƒ¨é€šè¿‡åŠ¨æ€ import åŠ è½½ç»„ä»¶ã€‚å½“ç»„ä»¶è¢«æ¸²æŸ“æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡ŒåŠ è½½å‡½æ•°ï¼ŒåŠ è½½å®Œæˆåæ¸²æŸ“ç»„ä»¶ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-comment">// å¼•å…¥ defineAsyncComponent</span>
<span class="hljs-keyword">import</span> { defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// å®šä¹‰å¼‚æ­¥ç»„ä»¶ï¼ˆç®€å•è¯­æ³•ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncDemo</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> 
  <span class="hljs-comment">// åŠ¨æ€ import åŠ è½½ç»„ä»¶ï¼Œè¿”å› Promise</span>
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/AsyncDemo.vue'</span>)
)

<span class="hljs-comment">// åœ¨ç»„ä»¶ä¸­æ­£å¸¸ä½¿ç”¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: {
    <span class="hljs-title class_">AsyncDemo</span>
  }
}
</code></pre>
<p>æ³¨æ„ï¼šåŠ¨æ€ import() æ˜¯ ES è¯­æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼ŒVue å†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç† Promise çš„æˆåŠŸä¸å¤±è´¥çŠ¶æ€ã€‚</p>
<h3 data-id="heading-2">2. å®Œæ•´é…ç½®è¯­æ³•ï¼ˆæ”¯æŒåŠ è½½/é”™è¯¯çŠ¶æ€ç­‰é…ç½®ï¼‰</h3>
<p>å½“éœ€è¦è‡ªå®šä¹‰åŠ è½½çŠ¶æ€ã€é”™è¯¯å¤„ç†ã€åŠ è½½å»¶è¿Ÿç­‰åœºæ™¯æ—¶ï¼Œå¯ä¼ å…¥ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯å®é™…å¼€å‘ä¸­æ›´å¸¸ç”¨çš„æ–¹å¼ã€‚å®Œæ•´é…ç½®åŒ…å« <code>loader</code>ã€<code>loadingComponent</code>ã€<code>errorComponent</code>ã€<code>delay</code>ã€<code>timeout</code> ç­‰å±æ€§ï¼Œåç»­å°†é€ä¸€è¯¦è§£ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncDemo</span> = <span class="hljs-title function_">defineAsyncComponent</span>({
  <span class="hljs-comment">// åŠ è½½å‡½æ•°ï¼ˆå¿…é€‰ï¼‰ï¼ŒåŒç®€å•è¯­æ³•çš„åŠ è½½å‡½æ•°</span>
  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/AsyncDemo.vue'</span>),
  <span class="hljs-comment">// åŠ è½½ä¸­æ˜¾ç¤ºçš„ç»„ä»¶</span>
  <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title class_">Loading</span>,
  <span class="hljs-comment">// åŠ è½½å¤±è´¥æ˜¾ç¤ºçš„ç»„ä»¶</span>
  <span class="hljs-attr">errorComponent</span>: <span class="hljs-title class_">Error</span>,
  <span class="hljs-comment">// å»¶è¿Ÿæ˜¾ç¤ºåŠ è½½ç»„ä»¶çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
  <span class="hljs-attr">delay</span>: <span class="hljs-number">200</span>,
  <span class="hljs-comment">// åŠ è½½è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">3000</span>,
  <span class="hljs-comment">// å…¶ä»–å¯é€‰é…ç½®...</span>
})
</code></pre>
<h2 data-id="heading-3">äºŒã€å››å¤§æ ¸å¿ƒé…ç½®è¯¦è§£</h2>
<p>ä¸‹é¢é’ˆå¯¹å®Œæ•´é…ç½®ä¸­çš„å››å¤§æ ¸å¿ƒå±æ€§ï¼ˆloading/error/delay/timeoutï¼‰ï¼Œç»“åˆåœºæ™¯ä¸å®ä¾‹é€ä¸€æ‹†è§£ï¼Œè¯´æ˜å…¶ä½œç”¨ã€ç”¨æ³•åŠæ³¨æ„äº‹é¡¹ã€‚</p>
<h3 data-id="heading-4">1. loadingComponentï¼šåŠ è½½ä¸­çŠ¶æ€ç»„ä»¶</h3>
<p>å½“å¼‚æ­¥ç»„ä»¶æ­£åœ¨åŠ è½½æ—¶ï¼ŒVue ä¼šæ¸²æŸ“ <code>loadingComponent</code> æŒ‡å®šçš„ç»„ä»¶ï¼Œç”¨äºæç¤ºç”¨æˆ·â€œåŠ è½½ä¸­â€ï¼ˆå¦‚éª¨æ¶å±ã€åŠ è½½åŠ¨ç”»ç­‰ï¼‰ã€‚</p>
<h4 data-id="heading-5">ä½¿ç”¨è¦ç‚¹ï¼š</h4>
<ul>
<li><code>loadingComponent</code> éœ€æ˜¯ä¸€ä¸ªå·²å®šä¹‰çš„ Vue ç»„ä»¶ï¼Œå¯å…¨å±€æ³¨å†Œæˆ–å±€éƒ¨å¼•å…¥ã€‚</li>
<li>åŠ è½½æˆåŠŸåï¼ŒåŠ è½½ç»„ä»¶ä¼šè‡ªåŠ¨è¢«æ›¿æ¢ä¸ºç›®æ ‡å¼‚æ­¥ç»„ä»¶ã€‚</li>
<li>è‹¥åŠ è½½æ—¶é—´æçŸ­ï¼ˆå¦‚å°äº <code>delay</code> é…ç½®çš„æ—¶é—´ï¼‰ï¼ŒåŠ è½½ç»„ä»¶å¯èƒ½ä¸ä¼šæ˜¾ç¤ºï¼Œé¿å…é¢‘ç¹åˆ‡æ¢å¯¼è‡´çš„é—ªçƒã€‚</li>
</ul>
<h4 data-id="heading-6">å®ä¾‹ï¼š</h4>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-comment">// å¼•å…¥åŠ è½½ç»„ä»¶å’Œé”™è¯¯ç»„ä»¶</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Loading</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Loading.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Error</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Error.vue'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncDemo</span> = <span class="hljs-title function_">defineAsyncComponent</span>({
  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/AsyncDemo.vue'</span>),
  <span class="hljs-comment">// åŠ è½½ä¸­æ˜¾ç¤º Loading ç»„ä»¶</span>
  <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title class_">Loading</span>,
  <span class="hljs-comment">// åŠ è½½å¤±è´¥æ˜¾ç¤º Error ç»„ä»¶</span>
  <span class="hljs-attr">errorComponent</span>: <span class="hljs-title class_">Error</span>
})
</code></pre>
<p>Loading.vue ç¤ºä¾‹ï¼ˆç®€å•åŠ è½½åŠ¨ç”»ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.loading</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-7">2. errorComponentï¼šåŠ è½½å¤±è´¥çŠ¶æ€ç»„ä»¶</h3>
<p>å½“å¼‚æ­¥ç»„ä»¶åŠ è½½å¤±è´¥ï¼ˆå¦‚ç½‘ç»œé”™è¯¯ã€ç»„ä»¶è·¯å¾„é”™è¯¯ï¼‰æ—¶ï¼ŒVue ä¼šæ¸²æŸ“ <code>errorComponent</code> æŒ‡å®šçš„ç»„ä»¶ï¼Œç”¨äºæç¤ºç”¨æˆ·åŠ è½½å¤±è´¥ï¼Œå¹¶å¯æä¾›é‡è¯•ç­‰äº¤äº’ã€‚</p>
<h4 data-id="heading-8">ä½¿ç”¨è¦ç‚¹ï¼š</h4>
<ul>
<li>åŠ è½½å¤±è´¥çš„åŸå› åŒ…æ‹¬ï¼šç½‘ç»œä¸­æ–­ã€åŠ¨æ€ import è·¯å¾„é”™è¯¯ã€ç»„ä»¶å†…éƒ¨æŠ¥é”™ç­‰ã€‚</li>
<li>Vue ä¼šå‘ <code>errorComponent</code> ä¼ é€’ä¸€ä¸ª <code>error</code> å±æ€§ï¼ŒåŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œå¯åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ã€‚</li>
<li>å¯åœ¨é”™è¯¯ç»„ä»¶ä¸­æä¾›â€œé‡è¯•åŠ è½½â€æŒ‰é’®ï¼Œé€šè¿‡è°ƒç”¨ <code>error.retry()</code> é‡æ–°è§¦å‘åŠ è½½å‡½æ•°ï¼›è°ƒç”¨ <code>error.fail()</code> æ ‡è®°åŠ è½½å¤±è´¥ï¼ˆä¸å†é‡è¯•ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-9">å®ä¾‹ï¼ˆå¸¦é‡è¯•åŠŸèƒ½çš„é”™è¯¯ç»„ä»¶ï¼‰ï¼š</h4>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-comment">// Error.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ç»„ä»¶åŠ è½½å¤±è´¥ï¼š{{ error.message }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"error.retry()"</span>&gt;</span>é‡è¯•åŠ è½½<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"error.fail()"</span>&gt;</span>ç¡®è®¤å¤±è´¥<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// æ¥æ”¶ Vue ä¼ é€’çš„ error å±æ€§</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">error</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
  }
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.error</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#ff4d4f</span>;
}
<span class="hljs-selector-tag">button</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">12px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-10">3. delayï¼šå»¶è¿Ÿæ˜¾ç¤ºåŠ è½½ç»„ä»¶çš„æ—¶é—´</h3>
<p><code>delay</code> ç”¨äºè®¾ç½®â€œå»¶è¿Ÿå¤šä¹…åæ˜¾ç¤ºåŠ è½½ç»„ä»¶â€ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼ˆé»˜è®¤å€¼ä¸º 200ï¼‰ã€‚å…¶æ ¸å¿ƒä½œç”¨æ˜¯é¿å…â€œåŠ è½½ç»„ä»¶é—ªçƒâ€â€”â€”è‹¥ç»„ä»¶åŠ è½½é€Ÿåº¦æå¿«ï¼ˆå¦‚æœ¬åœ°èµ„æºã€ç¼“å­˜èµ„æºï¼‰ï¼ŒåŠ è½½ç»„ä»¶ä»…æ˜¾ç¤ºå‡ æ¯«ç§’å°±æ¶ˆå¤±ï¼Œä¼šç»™ç”¨æˆ·å¸¦æ¥ä¸è‰¯ä½“éªŒã€‚</p>
<h4 data-id="heading-11">é€»è¾‘è¯´æ˜ï¼š</h4>
<ul>
<li>è‹¥ç»„ä»¶åŠ è½½æ—¶é—´ â‰¤ <code>delay</code>ï¼šä¸æ˜¾ç¤ºåŠ è½½ç»„ä»¶ï¼Œç›´æ¥æ¸²æŸ“ç›®æ ‡ç»„ä»¶ã€‚</li>
<li>è‹¥ç»„ä»¶åŠ è½½æ—¶é—´ ï¼ <code>delay</code>ï¼šä»åŠ è½½å¼€å§‹ç»è¿‡ <code>delay</code> æ¯«ç§’åï¼Œæ˜¾ç¤ºåŠ è½½ç»„ä»¶ï¼Œç›´åˆ°åŠ è½½å®Œæˆæˆ–å¤±è´¥ã€‚</li>
</ul>
<h4 data-id="heading-12">å®ä¾‹ï¼š</h4>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncDemo</span> = <span class="hljs-title function_">defineAsyncComponent</span>({
  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/AsyncDemo.vue'</span>),
  <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title class_">Loading</span>,
  <span class="hljs-attr">errorComponent</span>: <span class="hljs-title class_">Error</span>,
  <span class="hljs-comment">// å»¶è¿Ÿ 300 æ¯«ç§’æ˜¾ç¤ºåŠ è½½ç»„ä»¶ï¼Œé¿å…å¿«é€ŸåŠ è½½æ—¶çš„é—ªçƒ</span>
  <span class="hljs-attr">delay</span>: <span class="hljs-number">300</span>
})
</code></pre>
<h3 data-id="heading-13">4. timeoutï¼šåŠ è½½è¶…æ—¶æ—¶é—´</h3>
<p><code>timeout</code> ç”¨äºè®¾ç½®ç»„ä»¶åŠ è½½çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼ˆé»˜è®¤æ— è¶…æ—¶é™åˆ¶ï¼‰ã€‚è‹¥åŠ è½½æ—¶é—´è¶…è¿‡è®¾å®šå€¼ï¼ŒVue ä¼šåˆ¤å®šä¸ºåŠ è½½å¤±è´¥ï¼Œæ¸²æŸ“ <code>errorComponent</code>ã€‚</p>
<h4 data-id="heading-14">ä½¿ç”¨è¦ç‚¹ï¼š</h4>
<ul>
<li>è‹¥ç½‘ç»œç¯å¢ƒè¾ƒå·®ï¼Œå»ºè®®è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼ˆå¦‚ 5000 æ¯«ç§’ï¼‰ï¼Œé¿å…ç”¨æˆ·é•¿æ—¶é—´ç­‰å¾…æ— åé¦ˆã€‚</li>
<li>è¶…æ—¶åè§¦å‘çš„é”™è¯¯ï¼Œå¯é€šè¿‡é”™è¯¯ç»„ä»¶çš„ <code>error.retry()</code> é‡è¯•åŠ è½½ã€‚</li>
<li>è‹¥éœ€ç¦ç”¨è¶…æ—¶é™åˆ¶ï¼Œå¯è®¾ç½® <code>timeout: Infinity</code>ã€‚</li>
</ul>
<h4 data-id="heading-15">å®ä¾‹ï¼š</h4>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncDemo</span> = <span class="hljs-title function_">defineAsyncComponent</span>({
  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/AsyncDemo.vue'</span>),
  <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title class_">Loading</span>,
  <span class="hljs-attr">errorComponent</span>: <span class="hljs-title class_">Error</span>,
  <span class="hljs-attr">delay</span>: <span class="hljs-number">300</span>,
  <span class="hljs-comment">// åŠ è½½è¶…æ—¶æ—¶é—´è®¾ä¸º 5 ç§’ï¼Œè¶…è¿‡åˆ™æ˜¾ç¤ºé”™è¯¯ç»„ä»¶</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>
})
</code></pre>
<h2 data-id="heading-16">ä¸‰ã€è¿›é˜¶ç”¨æ³•ä¸æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-17">1. ç»“åˆ Suspense ä½¿ç”¨</h3>
<p>Vue 3 çš„ <code>Suspense</code> ç»„ä»¶å¯ä¸ <code>defineAsyncComponent</code> é…åˆï¼Œå®ç°æ›´çµæ´»çš„å¼‚æ­¥ç»„ä»¶æ§åˆ¶ã€‚<code>Suspense</code> æä¾› <code>&lt;template #default&gt;</code>ï¼ˆå¼‚æ­¥ç»„ä»¶æˆåŠŸæ¸²æŸ“å†…å®¹ï¼‰å’Œ <code>&lt;template #fallback&gt;</code>ï¼ˆåŠ è½½ä¸­å†…å®¹ï¼‰ï¼Œæ­¤æ—¶å¯çœç•¥ <code>loadingComponent</code>é…ç½®ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">AsyncDemo</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineAsyncComponent, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncDemo</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/AsyncDemo.vue'</span>))
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h3 data-id="heading-18">2. åŠ¨æ€æ§åˆ¶åŠ è½½å‡½æ•°</h3>
<p>åŠ è½½å‡½æ•°å¯æ ¹æ®æ¡ä»¶åŠ¨æ€è¿”å›ä¸åŒçš„ç»„ä»¶ï¼Œå®ç°â€œæŒ‰éœ€åŠ è½½ä¸åŒç»„ä»¶â€çš„åœºæ™¯ï¼ˆå¦‚æ ¹æ®ç”¨æˆ·æƒé™åŠ è½½ä¸åŒç»„ä»¶ï¼‰ã€‚</p>
<pre><code class="hljs language-ts" lang="ts">
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncComponent</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// æ ¹æ®æƒé™åŠ¨æ€åŠ è½½ç»„ä»¶</span>
  <span class="hljs-keyword">if</span> (userRole === <span class="hljs-string">'admin'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/AdminComponent.vue'</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/UserComponent.vue'</span>)
  }
})
</code></pre>
<h3 data-id="heading-19">3. æ³¨æ„äº‹é¡¹</h3>
<ul>
<li>å¼‚æ­¥ç»„ä»¶ä¸èƒ½ç›´æ¥åœ¨ <code>&lt;script setup&gt;</code> ä¸­é€šè¿‡ <code>import</code> å¼•å…¥åç«‹å³ä½¿ç”¨ï¼Œéœ€é€šè¿‡<code>defineAsyncComponent</code> å°è£…ã€‚</li>
<li>åŠ è½½å‡½æ•°è¿”å›çš„ Promise è‹¥è¢« rejectï¼Œä¼šè§¦å‘åŠ è½½å¤±è´¥ï¼Œæ¸²æŸ“é”™è¯¯ç»„ä»¶ã€‚</li>
<li>ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒåŠ¨æ€ import() ä¼šè¢«æ‰“åŒ…å·¥å…·ï¼ˆå¦‚ Viteã€Webpackï¼‰åˆ†å‰²ä¸ºç‹¬ç«‹çš„ä»£ç å—ï¼Œå®ç°çœŸæ­£çš„æŒ‰éœ€åŠ è½½ã€‚</li>
</ul>
<h2 data-id="heading-20">å››ã€æ€»ç»“</h2>
<p><code>defineAsyncComponent</code> æ˜¯ Vue 3 ä¼˜åŒ–åº”ç”¨æ€§èƒ½çš„é‡è¦å·¥å…·ï¼Œé€šè¿‡åŸºç¡€åŠ è½½å‡½æ•°å®ç°ç»„ä»¶æ‡’åŠ è½½ï¼Œå†ç»“åˆ loadingã€errorã€delayã€timeout å››å¤§é…ç½®ï¼Œå¯è¦†ç›–ç»å¤§å¤šæ•°å¼‚æ­¥ç»„ä»¶çš„ä½¿ç”¨åœºæ™¯ï¼šloading ç»„ä»¶æå‡ç”¨æˆ·ç­‰å¾…ä½“éªŒï¼Œerror ç»„ä»¶å¤„ç†åŠ è½½å¼‚å¸¸ï¼Œdelay é¿å…ç»„ä»¶é—ªçƒï¼Œtimeout é˜²æ­¢æ— é™ç­‰å¾…ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå»ºè®®æ ¹æ®ç»„ä»¶çš„ä½“ç§¯ã€åŠ è½½åœºæ™¯ï¼ˆå¦‚é¦–å±ã€å¼¹çª—ï¼‰åˆç†é…ç½®å‚æ•°ï¼Œç»“åˆ <code>Suspense</code> ç»„ä»¶å®ç°æ›´çµæ´»çš„å¼‚æ­¥æ§åˆ¶ï¼Œè®©åº”ç”¨åŠ è½½æ›´å¿«ã€ä½“éªŒæ›´ä¼˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Router v6 å…¨é¢æŒ‡å—ï¼šä»å…¥é—¨åˆ°å®æˆ˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†]]></title>    <link>https://juejin.cn/post/7598480413804249130</link>    <guid>https://juejin.cn/post/7598480413804249130</guid>    <pubDate>2026-01-24T15:56:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598480413804249130" data-draft-id="7598699872551731236" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" React Router v6 å…¨é¢æŒ‡å—ï¼šä»å…¥é—¨åˆ°å®æˆ˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº† "/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2026-01-24T15:56:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             React Router v6 å…¨é¢æŒ‡å—ï¼šä»å…¥é—¨åˆ°å®æˆ˜ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº† 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T15:56:54.000Z" title="Sat Jan 24 2026 15:56:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æœ¬æ–‡åŸºäº React Router v6 ç¼–å†™ï¼Œå·²å‰”é™¤è¿‡æ—¶çš„ v5 è¯­æ³•ï¼Œè¯·æ”¾å¿ƒé£Ÿç”¨ã€‚</strong> Â </p>
</blockquote>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ React Routerï¼Ÿ</h2>
<p>åœ¨å¼€å§‹å†™ä»£ç ä¹‹å‰ï¼Œå’±ä»¬å…ˆé€šä¿—åœ°èŠèŠ React Router åˆ°åº•æ˜¯å¹²å˜›çš„ï¼Œä»¥åŠä¸ºä»€ä¹ˆç°åœ¨çš„ React é¡¹ç›®ç¦»ä¸å¼€å®ƒã€‚</p>
<h3 data-id="heading-1">æ‰“ä¸ªæ¯”æ–¹ï¼šä»â€œç¿»ä¹¦â€åˆ°â€œPPTâ€</h3>
<p>æƒ³è±¡ä¸€ä¸‹ä½ æ­£åœ¨çœ‹å†…å®¹å±•ç¤ºï¼š</p>
<ul>
<li>
<p><strong>æ²¡æœ‰è·¯ç”±çš„ä¼ ç»Ÿç½‘é¡µ (MPA)</strong> ï¼š<br/>
å°±åƒåœ¨<strong>çœ‹ä¹¦</strong>ã€‚æ¯å½“ä½ ç‚¹å‡»é“¾æ¥ï¼ˆç¿»é¡µï¼‰ï¼Œæµè§ˆå™¨éƒ½è¦æŠŠå½“å‰è¿™é¡µçº¸æ’•æ‰ï¼Œé‡æ–°å»æœåŠ¡å™¨æ‹¿ä¸€å¼ æ–°çº¸ï¼Œé‡æ–°æ’ç‰ˆã€é‡æ–°æ¸²æŸ“ã€‚ä½ ä¼šçœ‹åˆ°å±å¹•<strong>ç™½å±é—ªçƒ</strong>ä¸€ä¸‹ï¼Œä½“éªŒæ–­å±‚ï¼Œæ•ˆç‡ä¹Ÿä½ã€‚</p>
</li>
<li>
<p><strong>ä½¿ç”¨äº† React Router çš„å•é¡µåº”ç”¨ (SPA)</strong> ï¼š<br/>
å°±åƒåœ¨<strong>æ’­æ”¾ PPT</strong>ã€‚ä½ çš„æµè§ˆå™¨çª—å£å°±æ˜¯é‚£ä¸ªæŠ•å½±å¹•å¸ƒï¼ˆå®¹å™¨ï¼‰ï¼Œå®ƒå§‹ç»ˆä¸åŠ¨ã€‚å½“ä½ ç‚¹å‡»å¯¼èˆªæ—¶ï¼ŒReact Router è¿™ä¸ªâ€œæ”¾æ˜ å‘˜â€åªæ˜¯<strong>ä¸ä»…åˆ·æ–°åœ°æŠŠ PPT çš„æŸä¸€é¡µå†…å®¹ï¼ˆç»„ä»¶ï¼‰æ›¿æ¢åˆ°äº†å±å¹•ä¸­é—´</strong>ã€‚</p>
<p><strong>å¹•å¸ƒæ²¡å˜ï¼Œåªæœ‰å†…å®¹åœ¨å˜ã€‚</strong> Â è¿™ç§ä½“éªŒå°±åƒåŸç”Ÿ App ä¸€æ ·ä¸æ»‘ï¼Œæ²¡æœ‰ç™½å±ï¼Œæ— éœ€ç­‰å¾…æ•´ä¸ªé¡µé¢é‡è½½ã€‚</p>
</li>
</ul>
<h3 data-id="heading-2">å®ƒçš„ä¸‰å¤§æ ¸å¿ƒè¶…èƒ½åŠ›</h3>
<ol>
<li>
<p><strong>æ— æ„Ÿåˆ‡æ¢ (No Refresh)</strong> ï¼š<br/>
è¿™æ˜¯æœ€ç›´è§‚çš„ä½“éªŒã€‚ç”¨æˆ·åœ¨é¡µé¢é—´è·³è½¬æ—¶ï¼Œæµè§ˆå™¨ä¸ä¼šé‡æ–°åŠ è½½æ•´ä¸ª HTMLã€‚è¿™å¯¹äºç”¨æˆ·ä½“éªŒæ˜¯è´¨çš„é£è·ƒã€‚</p>
</li>
<li>
<p><strong>URL ä¹Ÿå°±æ˜¯åœ°å›¾ (Source of Truth)</strong> ï¼š<br/>
ä½ å¯èƒ½ä¼šé—®ï¼šâ€œæ—¢ç„¶æ˜¯æ¢ç»„ä»¶ï¼Œæˆ‘è‡ªå·±å†™ä¸ªÂ if-elseÂ æ¸²æŸ“ä¸å°±è¡Œäº†ï¼Ÿâ€<br/>
ä¸è¡Œï¼å› ä¸º Router å¸®ä½ ä¿æŒäº†Â <strong>UI å’Œ URL çš„åŒæ­¥</strong>ã€‚</p>
<ul>
<li>æ¯”å¦‚ä½ åœ¨äº¬ä¸œçœ‹åˆ°ä¸€ä¸ªå•†å“çš„è¯¦æƒ…é¡µï¼Œå¤åˆ¶ URL å‘ç»™æœ‹å‹ï¼Œæœ‹å‹æ‰“å¼€åçœ‹åˆ°çš„å¿…é¡»æ˜¯<strong>åŒä¸€ä¸ªå•†å“</strong>ï¼Œè€Œä¸æ˜¯é¦–é¡µã€‚React Router ç¡®ä¿äº† URL å˜äº†ï¼ŒUI è·Ÿç€å˜ï¼›UI å˜äº†ï¼ŒURL ä¹Ÿè·Ÿç€å˜ã€‚</li>
</ul>
</li>
<li>
<p><strong>å†å²è®°å½•ç®¡ç† (Time Travel)</strong> ï¼š<br/>
å®ƒè‡ªåŠ¨å¸®ä½ å¤„ç†äº†æµè§ˆå™¨çš„â€œåé€€â€å’Œâ€œå‰è¿›â€æŒ‰é’®ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œä½ åœ¨å•é¡µåº”ç”¨é‡Œç‚¹åé€€ï¼Œå¯èƒ½ç›´æ¥å°±é€€å‡ºäº†æ•´ä¸ªç½‘ç«™ï¼Œç”¨æˆ·ç»å¯¹ä¼šæŠ“ç‹‚ã€‚</p>
</li>
</ol>
<h3 data-id="heading-3">é€‚ç”¨åœºæ™¯</h3>
<p>React Router å‡ ä¹æ˜¯ React å¼€å‘çš„æ ‡å‡†é…ç½®ï¼Œç‰¹åˆ«æ˜¯ä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li><strong>åå°ç®¡ç†ç³»ç»Ÿ (Admin Dashboard)</strong> ï¼šéœ€è¦ä¾§è¾¹æ å¸¸é©»ï¼Œåªæœ‰å³ä¾§å†…å®¹åŒºåˆ‡æ¢ï¼ˆåµŒå¥—è·¯ç”±çš„ç»ä½³èˆå°ï¼‰ã€‚</li>
<li><strong>å†…å®¹å‹å¹³å° (å¦‚æ˜é‡‘ã€çŸ¥ä¹)</strong> ï¼šéœ€è¦åœ¨åˆ—è¡¨é¡µã€è¯¦æƒ…é¡µã€ä¸ªäººä¸­å¿ƒä¹‹é—´æµç•…è·³è½¬ã€‚</li>
<li><strong>SaaS å·¥å…·ç±»åº”ç”¨</strong>ï¼šæ“ä½œé€»è¾‘å¤æ‚ï¼Œéœ€è¦ä¿æŒåº”ç”¨çŠ¶æ€ä¸ä¸¢å¤±ã€‚</li>
</ul>
<p>ä¸€å¥è¯æ€»ç»“ï¼šå¦‚æœä½ åœ¨å†™ä¸€ä¸ª React åº”ç”¨ï¼Œå¹¶ä¸”å¸Œæœ›å®ƒæœ‰å¤šä¸ªâ€œé¡µé¢â€ï¼Œåˆ«çŠ¹è±«ï¼ŒReact Router å°±æ˜¯ä½ çš„å¿…é€‰è£…å¤‡,ç°åœ¨è®©æˆ‘ä»¬å¿«é€Ÿå…¥é—¨React Routerã€‚</p>
<hr/>
<h2 data-id="heading-4">1. å¿«é€Ÿä¸Šæ‰‹ä¸åŸºæœ¬é…ç½®</h2>
<p>é¦–å…ˆï¼Œç¡®ä¿ä½ çš„é¡¹ç›®å·²ç»å®‰è£…äº†æœ€æ–°ç‰ˆçš„è·¯ç”±åº“ï¼š</p>
<p>Bash</p>
<pre><code class="hljs language-csharp" lang="csharp">npm install react-router-dom
<span class="hljs-meta"># æˆ–è€…</span>
yarn <span class="hljs-keyword">add</span> react-router-dom
</code></pre>
<h3 data-id="heading-5">æ ¸å¿ƒç»„ä»¶é…ç½®</h3>
<p>åœ¨ v6 ä¸­ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨Â BrowserRouterÂ åŒ…è£¹åº”ç”¨ï¼Œä½†<strong>æœ€å¤§çš„å˜åŒ–</strong>åœ¨äºè·¯ç”±çš„å®šä¹‰æ–¹å¼ï¼š</p>
<ol>
<li><strong>SwitchÂ å·²æ­»ï¼ŒRoutesÂ å½“ç«‹</strong>ï¼šä¸å†ä½¿ç”¨Â Switchï¼Œæ”¹ç”¨Â <code>&lt;Router&gt;</code></li>
<li><strong>componentÂ å±æ€§è¢«å¼ƒç”¨</strong>ï¼šç°åœ¨ç»Ÿä¸€ä½¿ç”¨Â elementÂ å±æ€§ï¼Œå¹¶ä¸”ä¼ é€’çš„æ˜¯<strong>ç»„ä»¶å®ä¾‹</strong>ï¼ˆå³Â <code>&lt;Home /&gt;</code>ï¼‰ï¼Œè€Œä¸æ˜¯ç»„ä»¶ç±»æˆ–å‡½æ•°åã€‚</li>
</ol>
<p><strong>App.js æ ‡å‡†é…ç½®ç¤ºä¾‹</strong></p>
<p>Jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./pages/Home'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./pages/About'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NotFound</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./pages/NotFound'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span>&gt;</span>
      {/* Routes æ›¿ä»£äº† Switch */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
        {/* element å±æ€§æ›¿ä»£äº† componentï¼Œæ³¨æ„è¿™é‡Œä¼ çš„æ˜¯ JSX */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
        
        {/* v6 ç§»é™¤äº† exactï¼Œé»˜è®¤å°±æ˜¯ç²¾ç¡®åŒ¹é… */}
        
        {/* 404 é¡µé¢é…ç½®ï¼Œpath="*" åŒ¹é…æ‰€æœ‰æœªå®šä¹‰çš„è·¯å¾„ */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"*"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">NotFound</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<hr/>
<h2 data-id="heading-6">2. å¯¼èˆªä¸è·³è½¬</h2>
<p>é¡µé¢è·³è½¬æ˜¯è·¯ç”±çš„çµé­‚ã€‚v6 åœ¨å£°æ˜å¼å¯¼èˆªå’Œç¼–ç¨‹å¼å¯¼èˆªä¸Šéƒ½æœ‰ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-7">å£°æ˜å¼å¯¼èˆªï¼šLink ä¸ NavLink</h3>
<p>æ™®é€šçš„è·³è½¬ä½¿ç”¨Â ï¼Œè¿™å’Œä»¥å‰ä¸€æ ·ï¼š</p>
<p>Jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>å»å…³äºé¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
</code></pre>
<p><strong>é‡ç‚¹ï¼šNavLink çš„é«˜äº®æ ·å¼</strong><br/>
åœ¨ v5 ä¸­æˆ‘ä»¬ä½¿ç”¨Â activeClassNameï¼Œä½†åœ¨ v6 ä¸­è¿™ä¸ªå±æ€§è¢«ç§»é™¤äº†ã€‚classNameÂ ç°åœ¨æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œé€šè¿‡Â isActiveÂ å‚æ•°æ¥åˆ¤æ–­çŠ¶æ€ï¼š</p>
<p>Jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NavLink</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./Nav.css'</span>; <span class="hljs-comment">// å‡è®¾ä½ å®šä¹‰äº† .active ç±»</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">NavBar</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> 
        <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span> 
        <span class="hljs-attr">className</span>=<span class="hljs-string">{({</span> <span class="hljs-attr">isActive</span> }) =&gt;</span> isActive ? "nav-item active" : "nav-item"}
      &gt;
        é¦–é¡µ
      <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">NavLink</span> 
        <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">{({</span> <span class="hljs-attr">isActive</span> }) =&gt;</span> isActive ? "nav-item active" : "nav-item"}
      &gt;
        å…³äº
      <span class="hljs-tag">&lt;/<span class="hljs-name">NavLink</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-8">ç¼–ç¨‹å¼å¯¼èˆªï¼šuseNavigate (å†è§ useHistory)</h3>
<p>è¿™æ˜¯å¾ˆå¤šè€æ‰‹æœ€ä¸ä¹ æƒ¯çš„åœ°æ–¹ï¼šuseHistoryÂ æ²¡äº†ï¼ç°åœ¨ä½¿ç”¨Â useNavigateÂ Hookã€‚</p>
<p>Jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useNavigate } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// ç™»å½•é€»è¾‘...</span>
    
    <span class="hljs-comment">// 1. æ™®é€šè·³è½¬</span>
    <span class="hljs-title function_">navigate</span>(<span class="hljs-string">'/dashboard'</span>);
    
    <span class="hljs-comment">// 2. æ›¿æ¢è·¯ç”± (ä¸ç•™å†å²è®°å½•ï¼Œç±»ä¼¼ history.replace)</span>
    <span class="hljs-comment">// navigate('/dashboard', { replace: true });</span>
    
    <span class="hljs-comment">// 3. ä¼ å…¥æ•°å­—å®ç°å‰è¿›/åé€€</span>
    <span class="hljs-comment">// navigate(-1); // åé€€ä¸€æ­¥</span>
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleLogin}</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-9">3. è¿›é˜¶è·¯ç”±ï¼šåŠ¨æ€ä¸åµŒå¥—</h2>
<h3 data-id="heading-10">åŠ¨æ€è·¯ç”±ä¸å‚æ•°è·å–</h3>
<p>é…ç½®å¸¦å‚æ•°çš„è·¯å¾„éå¸¸ç®€å•ï¼š</p>
<p>Jsx</p>
<pre><code class="hljs language-ini" lang="ini">// è·¯ç”±é…ç½®
&lt;Route <span class="hljs-attr">path</span>=<span class="hljs-string">"/article/:id"</span> element={&lt;ArticleDetail /&gt;} /&gt;
</code></pre>
<p>åœ¨ç»„ä»¶ä¸­è·å–å‚æ•°ï¼Œä¾ç„¶ä½¿ç”¨Â useParamsÂ Hookï¼š</p>
<p>Jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useParams } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ArticleDetail</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// è·å– URL ä¸­çš„ id å‚æ•°</span>
  <span class="hljs-keyword">const</span> { id } = <span class="hljs-title function_">useParams</span>();
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ­£åœ¨é˜…è¯»æ–‡ç«  ID: {id}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}
</code></pre>
<h3 data-id="heading-11">åµŒå¥—è·¯ç”±ä¸ Outlet (æ ¸å¿ƒç‰¹æ€§)</h3>
<p>åœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦â€œä¾§è¾¹æ  + é¡¶éƒ¨æ  + å†…å®¹åŒºâ€çš„å¸ƒå±€ã€‚v6 å¼•å…¥äº†Â Â ç»„ä»¶ï¼Œè®©åµŒå¥—è·¯ç”±çš„å®ç°å˜å¾—å¼‚å¸¸ä¸æ»‘ã€‚</p>
<p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼šÂ å°±åƒä¸€ä¸ªå ä½ç¬¦ï¼Œå‘Šè¯‰ React Routerï¼šâ€œå­è·¯ç”±çš„å†…å®¹å°±æ¸²æŸ“åœ¨è¿™é‡Œï¼â€</p>
<p><strong>1. é…ç½®åµŒå¥—è·¯ç”±ç»“æ„ï¼š</strong></p>
<p>Jsx</p>
<pre><code class="hljs language-xml" lang="xml">// App.js
<span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
  
  {/* çˆ¶è·¯ç”±ï¼š/admin */}
  <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/admin"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">AdminLayout</span> /&gt;</span>}&gt;
    {/* å­è·¯ç”±ï¼š/admin/users */}
    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"users"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">UserList</span> /&gt;</span>} /&gt;
    {/* å­è·¯ç”±ï¼š/admin/settings */}
    <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"settings"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Settings</span> /&gt;</span>} /&gt;
  <span class="hljs-tag">&lt;/<span class="hljs-name">Route</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
</code></pre>
<p><strong>2. åœ¨çˆ¶ç»„ä»¶ä¸­æ”¾ç½® Outletï¼š</strong></p>
<p>Jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// AdminLayout.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Outlet</span>, <span class="hljs-title class_">Link</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">AdminLayout</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"layout"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">aside</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"users"</span>&gt;</span>ç”¨æˆ·ç®¡ç†<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"settings"</span>&gt;</span>ç³»ç»Ÿè®¾ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
        {/*  è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼šå­è·¯ç”±ç»„ä»¶å°†æ¸²æŸ“åœ¨è¿™é‡Œ  */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<hr/>
<h2 data-id="heading-12">4. è·¯ç”±å®ˆå«ä¸æƒé™æ§åˆ¶</h2>
<p>v5 ä¸­æˆ‘ä»¬è¦ä¹ˆå†™Â Â åŒ…è£…å™¨ï¼Œè¦ä¹ˆç”¨Â renderÂ å±æ€§ã€‚<strong>v6 ä¸æ”¯æŒ render å±æ€§äº†</strong>ã€‚</p>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šä½¿ç”¨**é«˜é˜¶ç»„ä»¶ï¼ˆWrapper Componentï¼‰**é…åˆÂ Â ç»„ä»¶ã€‚</p>
<h3 data-id="heading-13">å®ç° RequireAuth ç»„ä»¶</h3>
<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç»„ä»¶ï¼Œç”¨æ¥æ‹¦æˆªæœªç™»å½•çš„è®¿é—®ï¼š</p>
<p>Jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// components/RequireAuth.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Navigate</span>, useLocation } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">RequireAuth</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> isLogin = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿé‰´æƒé€»è¾‘</span>
  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();

  <span class="hljs-keyword">if</span> (!isLogin) {
    <span class="hljs-comment">// æœªç™»å½•ï¼Œå¼ºåˆ¶è·³è½¬åˆ°ç™»å½•é¡µ</span>
    <span class="hljs-comment">// replace: true ç¡®ä¿ç”¨æˆ·ç™»å½•åç‚¹åé€€ä¸ä¼šåˆå›åˆ°å—ä¿æŠ¤é¡µé¢</span>
    <span class="hljs-comment">// state: ä¿å­˜å½“å‰ä½ç½®ï¼Œç™»å½•åå¯ä»¥è·³å›æ¥</span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/login"</span> <span class="hljs-attr">state</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">from:</span> <span class="hljs-attr">location</span> }} <span class="hljs-attr">replace</span> /&gt;</span></span>;
  }

  <span class="hljs-comment">// å·²ç™»å½•ï¼Œæ¸²æŸ“å­ç»„ä»¶</span>
  <span class="hljs-keyword">return</span> children;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">RequireAuth</span>;
</code></pre>
<h3 data-id="heading-14">åœ¨è·¯ç”±ä¸­ä½¿ç”¨</h3>
<p>ç”¨Â RequireAuthÂ åŒ…è£¹éœ€è¦ä¿æŠ¤çš„é¡µé¢ç»„ä»¶ï¼š</p>
<p>Jsx</p>
<pre><code class="hljs language-xml" lang="xml">// App.js
<span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/login"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Login</span> /&gt;</span>} /&gt;
  
  <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> 
    <span class="hljs-attr">path</span>=<span class="hljs-string">"/dashboard"</span> 
    <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
      &lt;<span class="hljs-attr">RequireAuth</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Dashboard</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">RequireAuth</span>&gt;</span>
    } 
  /&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
</code></pre>
<p>è¿™æ ·å†™é€»è¾‘è§£è€¦ï¼Œæ¸…æ™°æ˜äº†ï¼</p>
<hr/>
<h2 data-id="heading-15">5. å¸¸ç”¨ Hooks è¡¥å……ï¼šå¤„ç†æŸ¥è¯¢å‚æ•°</h2>
<p>åœ¨ v6 ä¸­ï¼Œè·å– URL ä¸Šçš„æŸ¥è¯¢å‚æ•°ï¼ˆå¦‚Â ?q=react&amp;sort=ascï¼‰æ¨èä½¿ç”¨Â useSearchParamsã€‚å®ƒçš„ç”¨æ³•å’ŒÂ useStateÂ éå¸¸åƒã€‚</p>
<p>Jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useSearchParams } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [searchParams, setSearchParams] = <span class="hljs-title function_">useSearchParams</span>();
  
  <span class="hljs-comment">// è·å–å‚æ•°</span>
  <span class="hljs-keyword">const</span> query = searchParams.<span class="hljs-title function_">get</span>(<span class="hljs-string">'q'</span>); 

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æœç´¢å…³é”®è¯: {query}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setSearchParams({ q: 'vue' })}&gt;
        æ”¹ä¸ºæœç´¢ Vue
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<hr/>
<h2 data-id="heading-16">6. æ€»ç»“ï¼šv5 è¿ç§» v6 é€ŸæŸ¥è¡¨</h2>
<p>ä¸ºäº†æ–¹ä¾¿è€ç©å®¶è¿ç§»ï¼Œæˆ‘æ•´ç†äº†è¿™å¼ æ ¸å¿ƒ API å¯¹ç…§è¡¨ï¼š</p>





















































<table><thead><tr><th>åŠŸèƒ½</th><th>React Router v5</th><th>React Router v6</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><strong>è·¯ç”±å®¹å™¨</strong></td><td><code>&lt;Switch&gt;</code></td><td><code>&lt;Routes&gt;</code></td><td>å¿…é¡»ä½¿ç”¨</td></tr><tr><td><strong>å®šä¹‰è·¯ç”±</strong></td><td><code>&lt;Route component={Home} /&gt;</code></td><td><code>&lt;Route element={&lt;Home /&gt;} /&gt;</code></td><td>ä¼ ç»„ä»¶å®ä¾‹ (JSX)</td></tr><tr><td><strong>é‡å®šå‘</strong></td><td><code>&lt;Redirect to="/home" /&gt;</code></td><td><code>&lt;Navigate to="/home" /&gt;</code></td><td>ç»„ä»¶åå˜æ›´</td></tr><tr><td><strong>å¯¼èˆª Hook</strong></td><td><code>useHistory</code></td><td><code>useNavigate</code></td><td>API å®Œå…¨é‡è®¾è®¡</td></tr><tr><td><strong>å½“å‰è·¯ç”±æ ·å¼</strong></td><td><code>activeClassName</code></td><td><code>className={(isActive) =&gt; ...}</code></td><td>å˜ä¸ºå‡½æ•°å¼æ§åˆ¶</td></tr><tr><td><strong>åµŒå¥—è·¯ç”±</strong></td><td>æ‰‹åŠ¨é…ç½®è·¯å¾„</td><td><code>&lt;Outlet /&gt;</code>Â ç»„ä»¶</td><td>æ›´åŠ å£°æ˜å¼å’Œç®€æ´</td></tr><tr><td><strong>ç²¾ç¡®åŒ¹é…</strong></td><td>éœ€è¦Â exactÂ å±æ€§</td><td>é»˜è®¤ç²¾ç¡®åŒ¹é…</td><td>ä¸å†éœ€è¦ exact</td></tr></tbody></table>
<hr/>
<p><strong>ç»“è¯­</strong></p>
<p>React Router v6 çš„è®¾è®¡ç†å¿µæ˜¯<strong>Compositionï¼ˆç»„åˆï¼‰<strong>å’Œ</strong>Simplificationï¼ˆç®€åŒ–ï¼‰</strong> ã€‚è™½ç„¶åˆšå¼€å§‹ä» v5 è¿ç§»è¿‡æ¥ä¼šæœ‰ç‚¹ä¸ä¹ æƒ¯ï¼Œä½†ä¸€æ—¦ä¸Šæ‰‹ï¼Œä½ ä¼šå‘ç°å®ƒçš„ API è®¾è®¡æ›´åŠ ç¬¦åˆ React Hooks çš„å¿ƒæ™ºæ¨¡å‹ï¼ŒåµŒå¥—è·¯ç”±çš„å¤„ç†ä¹Ÿæ›´åŠ ä¼˜é›…,é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œæ‚¨ä¸ä»…æŒæ¡äº† React Router çš„åŸºæœ¬æ¦‚å¿µå’Œå®‰è£…æ–¹æ³•ï¼Œè¿˜å­¦ä¼šäº†å¦‚ä½•é…ç½®å’Œå¯¼èˆªè·¯ç”±ï¼Œå®ç°äº†åŠ¨æ€è·¯ç”±å’ŒåµŒå¥—è·¯ç”±ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨è·¯ç”±å®ˆå«å’Œæƒé™æ§åˆ¶ç¡®ä¿åº”ç”¨çš„å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚è¿™äº›æŠ€èƒ½å°†å¸®åŠ©æ‚¨åœ¨å®é™…é¡¹ç›®ä¸­æ„å»ºç»“æ„æ¸…æ™°ã€åŠŸèƒ½å®Œå–„çš„è·¯ç”±ç³»ç»Ÿï¼Œæé«˜åº”ç”¨çš„å¯ç”¨æ€§å’Œå®‰å…¨æ€§ã€‚å¸Œæœ›è¿™äº›å†…å®¹å¯¹æ‚¨åœ¨å®é™…é¡¹ç›®ä¸­çš„å¼€å‘å·¥ä½œæœ‰æ‰€å¸®åŠ©ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€æ·±åº¦å­¦ä¹ Day16ã€‘ä¸‡ç‰©çš†å¯å›¾ï¼MATLABè€é¸Ÿå¸¦ä½ ç§’æ‡‚å›¾ç¥ç»ç½‘ç»œ (GNN) ä¸ GCN æ ¸å¿ƒåŸç†]]></title>    <link>https://juejin.cn/post/7598532592456040475</link>    <guid>https://juejin.cn/post/7598532592456040475</guid>    <pubDate>2026-01-24T11:13:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598532592456040475" data-draft-id="7597701762904834094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€æ·±åº¦å­¦ä¹ Day16ã€‘ä¸‡ç‰©çš†å¯å›¾ï¼MATLABè€é¸Ÿå¸¦ä½ ç§’æ‡‚å›¾ç¥ç»ç½‘ç»œ (GNN) ä¸ GCN æ ¸å¿ƒåŸç†"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-24T11:13:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æŸ æŸ é…±"/> <meta itemprop="url" content="https://juejin.cn/user/3739876675556569"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€æ·±åº¦å­¦ä¹ Day16ã€‘ä¸‡ç‰©çš†å¯å›¾ï¼MATLABè€é¸Ÿå¸¦ä½ ç§’æ‡‚å›¾ç¥ç»ç½‘ç»œ (GNN) ä¸ GCN æ ¸å¿ƒåŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3739876675556569/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æŸ æŸ é…±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T11:13:21.000Z" title="Sat Jan 24 2026 11:13:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>CNN å’Œ Transformer åˆ†åˆ«æ“…é•¿å¤„ç†æ ¼å­å’Œåºåˆ—æ•°æ®ï¼Œä½†å½“é¢å¯¹â€˜å…³ç³»â€™æ•°æ®æ—¶ï¼Œå®ƒä»¬éƒ½æ˜¾å¾—æ— èƒ½ä¸ºåŠ›ã€‚å›¾ç¥ç»ç½‘ç»œ (GNN) é€šè¿‡å›¾å·ç§¯ (GCN) æŠ€æœ¯ï¼ŒæˆåŠŸè§£å†³äº†è¿™ä¸€éš¾é¢˜ã€‚</p>
</blockquote>
<p><strong>æ‘˜è¦</strong>ï¼šå‰å‡ å¤©æˆ‘ä»¬ç©è½¬äº† CNNï¼ˆå¤„ç†æ ¼å­çš„ç‹è€…ï¼‰å’Œ Transformerï¼ˆå¤„ç†åºåˆ—çš„éœ¸ä¸»ï¼‰ã€‚ä½†å½“ä½ ç¯é¡¾å››å‘¨ï¼Œä¼šå‘ç°è¿™ä¸ªä¸–ç•Œå…¶å®æ˜¯ç”±â€œå…³ç³»â€æ„æˆçš„ï¼šç¤¾äº¤ç½‘ç»œæ˜¯äººä¸äººçš„å…³ç³»ï¼ŒåŒ–å­¦åˆ†å­æ˜¯åŸå­ä¸åŸå­çš„å…³ç³»ï¼ŒçŸ¥è¯†å›¾è°±æ˜¯å®ä½“ä¸å®ä½“çš„å…³ç³»ã€‚è¿™äº›æ•°æ®æ—¢ä¸æ˜¯æ ¼å­ä¹Ÿä¸æ˜¯åºåˆ—ï¼Œè€Œæ˜¯<strong>å›¾ (Graph)</strong> ã€‚ CNN é¢å¯¹è¿™ç§â€œæ‚ä¹±æ— ç« â€çš„è¿æ¥ç»“æ„ç›´æ¥æ‡µåœˆï¼ŒTransformer è™½ç„¶èƒ½ç”¨ä½†æ²¡æœ‰æ˜¾å¼çš„æ‹“æ‰‘ç»“æ„ã€‚ äºæ˜¯ï¼Œ<strong>å›¾ç¥ç»ç½‘ç»œ (GNN)</strong> åº”è¿è€Œç”Ÿã€‚ä»Šå¤©ï¼Œæˆ‘è¦ç”¨æœ€æ¥åœ°æ°”çš„â€œæ‘å£å…«å¦ç†è®ºâ€ï¼Œå¸¦ä½ æ‹†è§£ <strong>GCN (å›¾å·ç§¯ç½‘ç»œ)</strong> çš„æ•°å­¦æœ¬è´¨ï¼Œå¹¶ç”¨ PyTorch Geometric (PyG) æ‰‹æ’¸ä¸€ä¸ªåŸºäºå›¾ç»“æ„çš„èŠ‚ç‚¹åˆ†ç±»ä»»åŠ¡ï¼</p>
<p><em>å…³é”®è¯ï¼šPyTorch, GNN, GCN, å›¾è®º, é‚»æ¥çŸ©é˜µ, æ¶ˆæ¯ä¼ é€’, PyG</em></p>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆè¦æä¸ªâ€œå›¾â€ç¥ç»ç½‘ç»œï¼Ÿ</h2>
<p>åœ¨ MATLAB çš„ä¸–ç•Œé‡Œï¼ŒçŸ©é˜µæ˜¯ä¸‡èƒ½çš„ã€‚å›¾ç‰‡æ˜¯çŸ©é˜µï¼Œå£°éŸ³æ˜¯å‘é‡ã€‚ä½†åœ¨ç°å®ä¸­ï¼Œæœ‰ä¸€ç§æ•°æ®ç»“æ„è®©ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ¨¡å‹éå¸¸å¤´å¤§ï¼Œé‚£å°±æ˜¯<strong>éæ¬§å‡ é‡Œå¾—æ•°æ® (Non-Euclidean Data)</strong> ã€‚</p>
<h3 data-id="heading-1">1.1 ä»€ä¹ˆæ˜¯â€œæ¬§å‡ é‡Œå¾—â€æ•°æ®ï¼Ÿ</h3>
<p>å°±æ˜¯<strong>æ‹“æ‰‘å›ºå®šã€ç»“æ„è§„æ•´</strong>çš„æ•°æ®ï¼Œæ ¸å¿ƒç‰¹å¾æ˜¯â€œå¹³ç§»ä¸å˜æ€§â€ï¼š</p>
<ul>
<li><strong>å›¾ç‰‡ (Image)</strong> ï¼šæ ‡å‡†çš„ç½‘æ ¼ç»“æ„ã€‚æ¯ä¸ªåƒç´ ç‚¹éƒ½æœ‰å›ºå®šçš„ 8 ä¸ªé‚»å±…ï¼ˆä¸Šä¸‹å·¦å³+å¯¹è§’ï¼‰ã€‚CNN çš„å·ç§¯æ ¸å¯ä»¥åœ¨ä¸Šé¢èˆ’æœåœ°æ»‘åŠ¨ï¼Œå› ä¸ºç»“æ„æ˜¯å›ºå®šçš„ã€‚</li>
<li><strong>æ–‡æœ¬ (Text)</strong> ï¼šæ ‡å‡†çš„åºåˆ—ç»“æ„ã€‚æ¯ä¸ªè¯åªæœ‰å‰ä¸€ä¸ªå’Œåä¸€ä¸ªé‚»å±…ã€‚Transformer/RNN å¤„ç†èµ·æ¥å¾—å¿ƒåº”æ‰‹ã€‚</li>
</ul>
<h3 data-id="heading-2">1.2 ä»€ä¹ˆæ˜¯â€œå›¾â€æ•°æ®ï¼Ÿ</h3>
<p>å°±æ˜¯<strong>æ‹“æ‰‘æ— å›ºå®šè§„åˆ™ã€èŠ‚ç‚¹é‚»åŸŸå¤§å°ä¸ä¸€</strong>çš„éè§„æ•´æ•°æ®ï¼š</p>
<ul>
<li><strong>ç¤¾äº¤ç½‘ç»œ</strong>ï¼šæ™®é€šç”¨æˆ·å¯èƒ½åªæœ‰ 3 ä¸ªå¥½å‹ï¼Œä½†å¤§ V çš„å¥½å‹æœ‰åƒä¸‡å¥½å‹ã€‚æ¯ä¸ªèŠ‚ç‚¹çš„â€œé‚»å±…æ•°é‡â€æ˜¯ä¸å›ºå®šçš„ã€‚</li>
<li><strong>åŒ–å­¦åˆ†å­</strong>ï¼šè‹¯ç¯æ˜¯å…­è¾¹å½¢ï¼Œç”²çƒ·æ˜¯å››é¢ä½“ï¼Œæ— å›ºå®šâ€œç½‘æ ¼/åºåˆ—â€å½¢æ€ï¼›</li>
<li><strong>çŸ¥è¯†å›¾è°±</strong>ï¼šâ€œé©¬äº‘ -&gt; åˆ›ç«‹ -&gt; é˜¿é‡Œå·´å·´ -&gt; æ€»éƒ¨ -&gt; æ­å·â€çš„å…³è”é“¾ï¼Œæ— ç©ºé—´/æ—¶åºçš„å›ºå®šæ’åˆ—ã€‚</li>
</ul>
<p><strong>CNN çš„å´©æºƒæ—¶åˆ»</strong>ï¼š å¦‚æœä½ æƒ³ç”¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>Ã—</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">3 \times 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> çš„å·ç§¯æ ¸å»å·ä¸€ä¸ªç¤¾äº¤ç½‘ç»œï¼Œä½ ä¼šå‘ç°æ ¹æœ¬æ²¡æ³•å·ã€‚</p>
<ul>
<li>èŠ‚ç‚¹ A æœ‰ 2 ä¸ªé‚»å±…ï¼Œå·ç§¯æ ¸æ€ä¹ˆå¯¹é½ï¼Ÿ</li>
<li>èŠ‚ç‚¹ B æœ‰ 100 ä¸ªé‚»å±…ï¼Œå·ç§¯æ ¸æ€ä¹ˆå¯¹é½ï¼Ÿ</li>
<li>å›¾é‡Œçš„èŠ‚ç‚¹æ²¡æœ‰â€œä¸Šä¸‹å·¦å³â€ä¹‹åˆ†ï¼Œåªæœ‰â€œè¿ç€â€å’Œâ€œæ²¡è¿ç€â€ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–°çš„ç¥ç»ç½‘ç»œï¼Œå®ƒä¸ä»…è¦çœ‹<strong>èŠ‚ç‚¹æœ¬èº«çš„ç‰¹å¾</strong>ï¼ˆæ¯”å¦‚ä½ çš„å¹´é¾„ã€æ€§åˆ«ï¼‰ï¼Œè¿˜è¦çœ‹<strong>èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»</strong>ï¼ˆä½ çš„æœ‹å‹æ˜¯è°ï¼‰ã€‚è¿™å°±æ˜¯ <strong>GNN (Graph Neural Network)</strong> ã€‚</p>
<h2 data-id="heading-3">2. æ ¸å¿ƒåŸç†ï¼šä»â€œé‚»æ¥çŸ©é˜µâ€åˆ°â€œæ‘å£å…«å¦â€</h2>
<p>ä½œä¸ºMATLABç”¨æˆ·ï¼Œä½ å¯¹å›¾çš„â€œçŸ©é˜µè¡¨ç¤ºâ€ç»ä¸é™Œç”Ÿâ€”â€”å›¾åœ¨MATLABä¸­æ ¸å¿ƒç”¨<strong>é‚»æ¥çŸ©é˜µ (Adjacency Matrix)</strong> æè¿°ï¼Œè¿™ä¹Ÿæ˜¯GCNçš„æ•°å­¦æ ¹åŸºã€‚</p>
<h3 data-id="heading-4">2.1 GCN çš„ç›´è§‰ï¼šç”¨â€œæ‘å£å…«å¦â€ç†è§£æ¶ˆæ¯ä¼ é€’</h3>
<p>CNNçš„å·ç§¯æ˜¯â€œèšåˆå±€éƒ¨ç½‘æ ¼ä¿¡æ¯æ›´æ–°è‡ªèº«ç‰¹å¾â€ï¼ŒGNNçš„â€œå›¾å·ç§¯â€æ ¸å¿ƒé€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œä¸šç•Œç§°ä¹‹ä¸º<strong>æ¶ˆæ¯ä¼ é€’ (Message Passing)</strong> ã€‚</p>
<blockquote>
<p><strong>é€šä¿—æ¯”å–»ï¼šæ‘å£æƒ…æŠ¥ç½‘</strong></p>
<p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªæ‘æ°‘ï¼ˆèŠ‚ç‚¹ï¼‰ï¼Œä½ æƒ³çŸ¥é“è‡ªå·±çš„â€œç¤¾ä¼šåœ°ä½â€ï¼ˆç‰¹å¾ï¼‰ã€‚ä½ è‡ªå·±å¯èƒ½ä¸å¤ªæ¸…æ¥šï¼Œä½†ä½ å¯ä»¥é—®ä½ çš„é‚»å±…ã€‚</p>
<p><strong>Step 1 (Aggregate)</strong> ï¼šä½ æŠŠä½ æ‰€æœ‰æœ‹å‹çš„â€œç¤¾ä¼šåœ°ä½â€æ”¶é›†èµ·æ¥ã€‚</p>
<p><strong>Step 2 (Update)</strong> ï¼šæŠŠæœ‹å‹ä»¬çš„ä¿¡æ¯å’Œä½ è‡ªå·±çš„ä¿¡æ¯åŠ æƒå¹³å‡ä¸€ä¸‹ï¼Œç®—å‡ºä½ æ–°çš„â€œç¤¾ä¼šåœ°ä½â€ã€‚</p>
</blockquote>
<p>è¿™æ­£æ˜¯GCNçš„çµé­‚ï¼š <strong>â€œä½ æ˜¯ä½ æœ€äº²å¯†çš„Nä¸ªé‚»å±…çš„åŠ æƒå¹³å‡â€</strong> â€”â€”æœ¬è´¨æ˜¯é€šè¿‡æ‹“æ‰‘å…³ç³»å®ç°ç‰¹å¾çš„é‚»åŸŸèšåˆã€‚</p>
<h3 data-id="heading-5">2.2 GCNçš„æ•°å­¦æœ¬è´¨ï¼šMATLABçŸ©é˜µè§†è§’çš„æ¨å¯¼</h3>
<p>æˆ‘ä»¬ç”¨MATLABç†Ÿæ‚‰çš„çŸ©é˜µè¯­è¨€æ‹†è§£è¿™ä¸ªâ€œå…«å¦è¿‡ç¨‹â€ï¼Œå…ˆæ˜ç¡®æ ¸å¿ƒç¬¦å·å®šä¹‰ï¼š</p>






























<table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th><th>MATLABç»´åº¦è§£è¯»</th></tr></thead><tbody><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>H</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">H^{(l)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></td><td>ç¬¬<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span></span>å±‚èŠ‚ç‚¹ç‰¹å¾çŸ©é˜µ</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mi>F</mi></mrow><annotation encoding="application/x-tex">N \times F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span></span>ï¼ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span>=èŠ‚ç‚¹æ•°ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span></span>=ç‰¹å¾ç»´åº¦ï¼‰</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span></td><td>é‚»æ¥çŸ©é˜µ</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">N \times N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span>ï¼ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">A_{ij}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>è¡¨ç¤ºèŠ‚ç‚¹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>ä¸<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></span>ç›¸è¿ï¼Œå¦åˆ™ä¸º0ï¼‰</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span></td><td>å•ä½çŸ©é˜µ</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">N \times N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span>ï¼ˆå¯¹è§’çº¿ä¸º1ï¼Œå…¶ä½™ä¸º0ï¼‰</td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi></mrow><annotation encoding="application/x-tex">D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span></span></td><td>åº¦çŸ©é˜µ</td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>Ã—</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">N \times N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span>ï¼ˆå¯¹è§’çŸ©é˜µï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>i</mi><mi>i</mi></mrow></msub><mo>=</mo><msub><mo>âˆ‘</mo><mi>j</mi></msub><msub><mover accent="true"><mi>A</mi><mo>~</mo></mover><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">D_{ii}=\sum_j \tilde{A}_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ii</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.356em;vertical-align:-0.4358em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.162em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">A</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1111em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>ï¼Œå³èŠ‚ç‚¹<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>çš„åº¦ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-6">ç¬¬ä¸€æ­¥ï¼šèšåˆé‚»å±…ä¿¡æ¯ï¼ˆåŸºç¡€ç‰ˆï¼‰</h4>
<p>è¦æŠŠé‚»å±…ç‰¹å¾èšåˆåˆ°è‡ªèº«ï¼Œåœ¨MATLABä¸­åªéœ€ä¸€è¡ŒçŸ©é˜µä¹˜æ³•ï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Sum_Neighbor</mtext><mo>=</mo><mi>A</mi><mo>Ã—</mo><msup><mi>H</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\text{Sum\_Neighbor} = A \times H^{(l)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">Sum_Neighbor</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>âœ… <strong>MATLABé€»è¾‘è§£è¯»</strong>ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>çš„ç¬¬<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>è¡Œä»…åœ¨â€œä¸<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>ç›¸è¿çš„èŠ‚ç‚¹åˆ—â€ä¸º1ï¼Œå› æ­¤<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>Ã—</mo><mi>H</mi></mrow><annotation encoding="application/x-tex">A \times H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span></span>çš„ç¬¬<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>è¡Œ = æ‰€æœ‰ä¸<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"/><span class="mord mathnormal">i</span></span></span></span></span>ç›¸è¿çš„é‚»å±…ç‰¹å¾ä¹‹å’Œã€‚</p>
<h4 data-id="heading-7">ç¬¬äºŒæ­¥ï¼šä¿ç•™è‡ªèº«ä¿¡æ¯ï¼ˆåŠ è‡ªç¯ï¼‰</h4>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>çš„å¯¹è§’çº¿é»˜è®¤æ˜¯0ï¼ˆèŠ‚ç‚¹ä¸è‡ªè¿ï¼‰ï¼Œç›´æ¥ç›¸ä¹˜ä¼šä¸¢å¤±è‡ªèº«ç‰¹å¾â€”â€”è§£å†³æ–¹æ¡ˆæ˜¯ç»™<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>åŠ å•ä½çŸ©é˜µ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span>ï¼ˆè‡ªç¯ï¼‰ï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>A</mi><mo>~</mo></mover><mo>=</mo><mi>A</mi><mo>+</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">\tilde{A} = A + I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9202em;"/><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">A</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1111em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span></p>
<p>âœ… <strong>MATLABå®æ“</strong>ï¼š<code>A_tilde = A + eye(N);</code>ï¼ˆ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span>ä¸ºèŠ‚ç‚¹æ•°ï¼‰ï¼Œæ­¤æ—¶<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>A</mi><mo>~</mo></mover><mrow><mi>i</mi><mi>i</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\tilde{A}_{ii}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0702em;vertical-align:-0.15em;"/><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">A</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1111em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ii</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œèšåˆç»“æœåŒæ—¶åŒ…å«é‚»å±…+è‡ªèº«ã€‚</p>
<h4 data-id="heading-8">ç¬¬ä¸‰æ­¥ï¼šå½’ä¸€åŒ–ï¼ˆé¿å…æ•°å€¼çˆ†ç‚¸ï¼‰</h4>
<p><strong>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šæœ‰çš„äººæœ‹å‹å¤šï¼Œæœ‰çš„äººæœ‹å‹å°‘ã€‚</strong> å¦‚æœç›´æ¥ç›¸åŠ ï¼Œæœ‹å‹å¤šçš„ç‰¹å¾å€¼ä¼šçˆ†ç‚¸ï¼ˆå› ä¸ºåŠ äº†å‡ åƒä¸ªäººçš„ï¼‰ï¼Œæœ‹å‹å°‘çš„ç‰¹å¾å€¼å¾ˆå°ã€‚è¿™ä¼šå¯¼è‡´æ•°å€¼ä¸ç¨³å®šï¼Œæ¢¯åº¦çˆ†ç‚¸ã€‚ <strong>è§£å†³åŠæ³•</strong>ï¼šå½’ä¸€åŒ– (Normalization)ã€‚æˆ‘ä»¬è¦é™¤ä»¥èŠ‚ç‚¹çš„<strong>åº¦ (Degree)</strong> ã€‚ åœ¨çŸ©é˜µé‡Œï¼Œå°±æ˜¯ä¹˜ä¸Šåº¦çŸ©é˜µçš„é€† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>D</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">D^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span>ã€‚</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>H</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><msup><mi>D</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mover accent="true"><mi>A</mi><mo>~</mo></mover><msup><mi>H</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H^{(l+1)} = \sigma(D^{-1}\tilde{A}H^{(l)}W^{(l)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1702em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">A</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1111em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">W^{(l)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span>ï¼šå¯å­¦ä¹ æƒé‡çŸ©é˜µï¼ˆå¯¹åº”å…¨è¿æ¥å±‚ï¼ŒMATLABä¸­ä¸º<code>W = randn(F, F_new);</code>ï¼‰ï¼›</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span></span></span></span></span>ï¼šæ¿€æ´»å‡½æ•°ï¼ˆå¦‚ReLUï¼ŒMATLABä¸­ä¸º<code>relu()</code>ï¼‰ï¼›</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>D</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">D^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span>ï¼šåº¦çŸ©é˜µçš„é€†ï¼ˆMATLABä¸­ä¸º<code>D_inv = diag(1./diag(D));</code>ï¼‰ã€‚</li>
</ul>
<p>è¿™åŸºæœ¬ä¸Šå°±æ˜¯ GCN çš„é›å½¢äº†ï¼æ„æ€æ˜¯ï¼š<strong>æŠŠé‚»å±…å’Œè‡ªå·±çš„ç‰¹å¾åŠ æƒå¹³å‡ï¼Œä¹˜ä¸ªæƒé‡ï¼Œè¿‡ä¸ªæ¿€æ´»å‡½æ•°ã€‚</strong></p>
<p>âœ… <strong>MATLABæ ¸å¿ƒä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-matlab" lang="matlab"><span class="hljs-comment">% å‡è®¾Aæ˜¯é‚»æ¥çŸ©é˜µï¼ŒHæ˜¯èŠ‚ç‚¹ç‰¹å¾çŸ©é˜µï¼ŒWæ˜¯æƒé‡çŸ©é˜µ</span>
N = <span class="hljs-built_in">size</span>(A, <span class="hljs-number">1</span>);
A_tilde = A + <span class="hljs-built_in">eye</span>(N);          <span class="hljs-comment">% åŠ è‡ªç¯</span>
D = <span class="hljs-built_in">diag</span>(sum(A_tilde, <span class="hljs-number">2</span>));     <span class="hljs-comment">% è®¡ç®—åº¦çŸ©é˜µ</span>
D_inv = <span class="hljs-built_in">diag</span>(<span class="hljs-number">1.</span>/<span class="hljs-built_in">diag</span>(D));      <span class="hljs-comment">% åº¦çŸ©é˜µé€†</span>
H_new = relu(D_inv * A_tilde * H * W); <span class="hljs-comment">% èšåˆ+æ›´æ–°</span>
</code></pre>
<h3 data-id="heading-9">2.3 æ ‡å‡†GCN å…¬å¼ï¼šKipf &amp; Welling çš„å¯¹ç§°å½’ä¸€åŒ–</h3>
<p>2017 å¹´ï¼ŒKipf å’Œ Welling æå‡ºäº†æ ‡å‡†çš„ GCN å…¬å¼ã€‚ä»–ä»¬è§‰å¾—ç®€å•çš„â€œå¹³å‡â€ (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>D</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mi>A</mi></mrow><annotation encoding="application/x-tex">D^{-1}A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span></span></span></span></span>) ä¸å¤Ÿå¯¹ç§°ï¼Œäºæ˜¯æäº†ä¸ª<strong>å¯¹ç§°å½’ä¸€åŒ–</strong>ï¼š</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>H</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><munder><munder><mrow><msup><mover accent="true"><mi>D</mi><mo>~</mo></mover><mrow><mo>âˆ’</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></msup><mover accent="true"><mi>A</mi><mo>~</mo></mover><msup><mover accent="true"><mi>D</mi><mo>~</mo></mover><mrow><mo>âˆ’</mo><mfrac><mn>1</mn><mn>2</mn></mfrac></mrow></msup></mrow><mo stretchy="true">âŸ</mo></munder><mtext>å½’ä¸€åŒ–çš„é‚»æ¥çŸ©é˜µ</mtext></munder><msup><mi>H</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H^{(l+1)} = \sigma(\underbrace{\tilde{D}^{-\frac{1}{2}}\tilde{A}\tilde{D}^{-\frac{1}{2}}}_{\text{å½’ä¸€åŒ–çš„é‚»æ¥çŸ©é˜µ}} H^{(l)} W^{(l)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.3304em;vertical-align:-1.3263em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span style="top:-1.6777em;"><span class="pstrut" style="height:3.004em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">å½’ä¸€åŒ–çš„é‚»æ¥çŸ©é˜µ</span></span></span></span></span><span style="top:-3.004em;"><span class="pstrut" style="height:3.004em;"/><span class="mord munder"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span class="svg-align" style="top:-2.356em;"><span class="pstrut" style="height:3.004em;"/><span class="stretchy" style="height:0.548em;min-width:1.6em;"><span class="brace-left" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMinYMin slice"><path d="M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13&#10; 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688&#10; 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7&#10;-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z"/></svg></span><span class="brace-center" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMidYMin slice"><path d="M199572 214&#10;c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14&#10; 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3&#10; 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0&#10;-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z"/></svg></span><span class="brace-right" style="height:0.548em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.548em" viewbox="0 0 400000 548" preserveaspectratio="xMaxYMin slice"><path d="M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3&#10; 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237&#10;-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z"/></svg></span></span></span><span style="top:-3.004em;"><span class="pstrut" style="height:3.004em;"/><span class="mord"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"/><span class="frac-line mtight" style="border-bottom-width:0.049em;"/></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span/></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"/></span></span></span></span></span></span></span></span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">A</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1111em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"/><span class="frac-line mtight" style="border-bottom-width:0.049em;"/></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span/></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"/></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.648em;"><span/></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.3263em;"><span/></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>ğŸ“ <strong>MATLABè€é¸Ÿä¸“å±è§£è¯»</strong>ï¼š</p>
<ul>
<li>æ™®é€šå½’ä¸€åŒ–<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>D</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mover accent="true"><mi>A</mi><mo>~</mo></mover></mrow><annotation encoding="application/x-tex">D^{-1}\tilde{A}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9202em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">A</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1111em;"><span class="mord">~</span></span></span></span></span></span></span></span></span></span></span>ï¼šä»…å¯¹è¡Œå½’ä¸€åŒ–ï¼ˆæ¯è¡Œé™¤ä»¥èŠ‚ç‚¹åº¦ï¼‰ï¼ˆRow Normalizationï¼‰ï¼›</li>
<li>å¯¹ç§°å½’ä¸€åŒ–<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mover accent="true"><mi>D</mi><mo>~</mo></mover><mrow><mo>âˆ’</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msup><mover accent="true"><mi>A</mi><mo>~</mo></mover><msup><mover accent="true"><mi>D</mi><mo>~</mo></mover><mrow><mo>âˆ’</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\tilde{D}^{-1/2}\tilde{A}\tilde{D}^{-1/2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9202em;"/><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">A</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1111em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span></span></span></span></span>ï¼šè¡Œ+åˆ—éƒ½é™¤ä»¥â€œåº¦çš„å¹³æ–¹æ ¹â€ï¼Œè®©é‚»æ¥çŸ©é˜µæ›´å¯¹ç§°ï¼›</li>
<li>MATLABè®¡ç®—<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mover accent="true"><mi>D</mi><mo>~</mo></mover><mrow><mo>âˆ’</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\tilde{D}^{-1/2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9202em;"/><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span></span></span></span></span>ï¼š<code>D_sqrt_inv = diag(1./sqrt(diag(D)));</code>ã€‚</li>
</ul>
<p>ğŸ’¡ <strong>æ ¸å¿ƒç»“è®º</strong>ï¼šæ— è®ºå…¬å¼å¤šå¤æ‚ï¼ŒGCNçš„æœ¬è´¨åªæœ‰ä¸€ä¸ªâ€”â€”<strong>æŒ‰æ‹“æ‰‘å…³ç³»åŠ æƒèšåˆé‚»åŸŸç‰¹å¾ï¼Œå†é€šè¿‡å…¨è¿æ¥å±‚æ›´æ–°è‡ªèº«ç‰¹å¾</strong>ã€‚</p>
<h2 data-id="heading-10">3. å·¥å…·å‡†å¤‡ï¼šPyTorch Geometric (PyG)</h2>
<p>åœ¨ PyTorch ä¸–ç•Œåšå›¾ç¥ç»ç½‘ç»œï¼Œä¸æ¨èæ‰‹å†™çŸ©é˜µä¹˜æ³•ï¼ˆè™½ç„¶èƒ½å†™ï¼Œä½†å¤„ç†ç¨€ç–çŸ©é˜µå¾ˆéº»çƒ¦ï¼Œæ•ˆç‡ä½ï¼‰ã€‚ä¸šç•Œæ ‡å‡†åº“æ˜¯ <strong>PyTorch Geometric (PyG)</strong>â€”â€”ç›¸å½“äºCVé¢†åŸŸçš„<code>torchvision</code>ï¼Œä¸“ä¸ºå›¾æ•°æ®è®¾è®¡ ã€‚</p>
<h3 data-id="heading-11">3.1 å®‰è£… (é¿å‘æŒ‡å—)</h3>
<p>PyG ä¾èµ–å¾ˆå¤šåº•å±‚ C++ åº“ï¼ˆscatter, sparseï¼‰ï¼Œå®‰è£…æ—¶å¿…é¡»å’Œä½ çš„ CUDA ç‰ˆæœ¬ä¸¥æ ¼åŒ¹é…ã€‚ å»ºè®®å» <a href="https://link.juejin.cn?target=https%3A%2F%2Fpytorch-geometric.readthedocs.io%2Fen%2Flatest%2Finstall%2Finstallation.html" target="_blank" title="https://pytorch-geometric.readthedocs.io/en/latest/install/installation.html" ref="nofollow noopener noreferrer">PyGå®˜ç½‘</a>å¤åˆ¶å¯¹åº”çš„ pip å‘½ä»¤ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ç”¨åˆ°çš„å®‰è£…å‘½ä»¤ï¼ˆPyTorch2.7 + cuda11.8ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># CPUç‰ˆæœ¬</span>
pip install pyg_lib torch_scatter torch_sparse torch_cluster torch_spline_conv -f https://data.pyg.org/whl/torch-2.7.0+cpu.html

<span class="hljs-comment"># CUDA 11.8ç‰ˆæœ¬ï¼ˆPyTorch 2.7ï¼‰</span>
pip install pyg_lib torch_scatter torch_sparse torch_cluster torch_spline_conv -f https://data.pyg.org/whl/torch-2.7.0+cu118.html
</code></pre>
<p>âš ï¸ <strong>å‘ç‚¹æç¤º</strong>ï¼šè‹¥å®‰è£…å¤±è´¥ï¼Œå…ˆå‡çº§<code>pip</code>ï¼ˆ<code>pip install --upgrade pip</code>ï¼‰ï¼Œå†å»<a href="https://link.juejin.cn?target=https%3A%2F%2Fpytorch-geometric.readthedocs.io%2Fen%2Flatest%2Finstall%2Finstallation.html" target="_blank" title="https://pytorch-geometric.readthedocs.io/en/latest/install/installation.html" ref="nofollow noopener noreferrer">PyGå®˜ç½‘</a>å¤åˆ¶å¯¹åº”ç‰ˆæœ¬å‘½ä»¤ã€‚</p>
<h3 data-id="heading-12">3.2 PyG çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼šDataå¯¹è±¡</h3>
<p>MATLABä¸­ç”¨<code>G = graph(s,t)</code>å®šä¹‰å›¾ï¼ŒPyGä¸­ç”¨<code>Data</code>å¯¹è±¡å°è£…å›¾çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆæ ¸å¿ƒæ˜¯â€œè¾¹ç´¢å¼•â€+â€œèŠ‚ç‚¹ç‰¹å¾â€ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> torch_geometric.data <span class="hljs-keyword">import</span> Data

<span class="hljs-comment"># 1. å®šä¹‰è¾¹ç´¢å¼•ï¼ˆCOOæ ¼å¼ï¼šç¨€ç–çŸ©é˜µçš„åæ ‡è¡¨ç¤ºï¼‰</span>
<span class="hljs-comment"># ç¬¬ä¸€è¡Œ=æºèŠ‚ç‚¹ï¼Œç¬¬äºŒè¡Œ=ç›®æ ‡èŠ‚ç‚¹ï¼Œæ— å‘å›¾éœ€æ˜¾å¼æ·»åŠ åå‘è¾¹</span>
edge_index = torch.tensor([
    [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>],  <span class="hljs-comment"># æºèŠ‚ç‚¹</span>
    [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]   <span class="hljs-comment"># ç›®æ ‡èŠ‚ç‚¹</span>
], dtype=torch.long)

<span class="hljs-comment"># 2. å®šä¹‰èŠ‚ç‚¹ç‰¹å¾ï¼ˆ3ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹1ç»´ç‰¹å¾ï¼‰</span>
x = torch.tensor([[-<span class="hljs-number">1</span>], [<span class="hljs-number">0</span>], [<span class="hljs-number">1</span>]], dtype=torch.<span class="hljs-built_in">float</span>)

<span class="hljs-comment"># 3. å°è£…ä¸ºDataå¯¹è±¡</span>
data = Data(x=x, edge_index=edge_index)

<span class="hljs-comment"># æŸ¥çœ‹æ ¸å¿ƒå±æ€§</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"èŠ‚ç‚¹æ•°ï¼š<span class="hljs-subst">{data.num_nodes}</span>"</span>)       <span class="hljs-comment"># è¾“å‡ºï¼š3</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¾¹æ•°ï¼š<span class="hljs-subst">{data.num_edges}</span>"</span>)         <span class="hljs-comment"># è¾“å‡ºï¼š4ï¼ˆæ— å‘å›¾åŒå‘è®¡æ•°ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"èŠ‚ç‚¹ç‰¹å¾ç»´åº¦ï¼š<span class="hljs-subst">{data.num_features}</span>"</span>) <span class="hljs-comment"># è¾“å‡ºï¼š1</span>
</code></pre>
<p>âœ… <strong>å…³é”®è§£é‡Š</strong>ï¼šCOOæ ¼å¼é€šè¿‡â€œåæ ‡å¯¹â€å­˜å‚¨éé›¶è¾¹ï¼Œç›¸æ¯”é‚»æ¥çŸ©é˜µèŠ‚çœå†…å­˜ï¼Œå°¤å…¶é€‚åˆç™¾ä¸‡çº§èŠ‚ç‚¹çš„å¤§è§„æ¨¡å›¾ã€‚</p>
<h2 data-id="heading-13">4. å®æˆ˜ï¼šæ‰å…‹ä¼¯æ ¼ç©ºæ‰‹é“ä¿±ä¹éƒ¨ (Karate Club)</h2>
<p>è¿™æ˜¯ GNN ç•Œçš„ "Hello World"ï¼š</p>
<p><strong>æ•…äº‹èƒŒæ™¯</strong>ï¼š20ä¸–çºª70å¹´ä»£ï¼Œä¸€ä¸ªç©ºæ‰‹é“ä¿±ä¹éƒ¨çš„æ•™ç»ƒï¼ˆMr. Hiï¼‰å’Œç®¡ç†å‘˜ï¼ˆOfficerï¼‰åµæ¶äº†ï¼Œä¿±ä¹éƒ¨è£‚å˜æˆäº†ä¸¤ä¸ªå¸®æ´¾ã€‚ç§‘å­¦å®¶è®°å½•äº† 34 ä¸ªæˆå‘˜ä¹‹é—´çš„ç¤¾äº¤å…³ç³»ã€‚</p>
<p><strong>ä»»åŠ¡</strong>ï¼šåªç»™ä½ å…¶ä¸­å‡ ä¸ªäººçš„å¸®æ´¾æ ‡ç­¾ï¼Œè®©ä½ é¢„æµ‹å‰©ä¸‹çš„æ‰€æœ‰äººç«™å“ªè¾¹çš„é˜Ÿï¼Ÿï¼ˆåŠç›‘ç£èŠ‚ç‚¹åˆ†ç±»ï¼‰ã€‚</p>
<h3 data-id="heading-14">4.1 æ•°æ®åŠ è½½ä¸å¯è§†åŒ–</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> torch_geometric.datasets <span class="hljs-keyword">import</span> KarateClub
<span class="hljs-keyword">from</span> torch_geometric.utils <span class="hljs-keyword">import</span> to_networkx
<span class="hljs-keyword">import</span> networkx <span class="hljs-keyword">as</span> nx
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. åŠ è½½æ•°æ®é›†ï¼ˆPyGå†…ç½®ï¼‰</span>
dataset = KarateClub()
data = dataset[<span class="hljs-number">0</span>]  <span class="hljs-comment"># è¯¥æ•°æ®é›†ä»…åŒ…å«1å¼ å›¾</span>

<span class="hljs-comment"># æ‰“å°æ ¸å¿ƒä¿¡æ¯</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'èŠ‚ç‚¹æ•°é‡: <span class="hljs-subst">{data.num_nodes}</span>'</span>)          <span class="hljs-comment"># 34</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'è¾¹æ•°é‡: <span class="hljs-subst">{data.num_edges}</span>'</span>)            <span class="hljs-comment"># 156ï¼ˆæ— å‘å›¾åŒå‘è®¡æ•°ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'èŠ‚ç‚¹ç‰¹å¾ç»´åº¦: <span class="hljs-subst">{data.num_features}</span>'</span>)   <span class="hljs-comment"># 34ï¼ˆOne-hotç¼–ç ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f'ç±»åˆ«æ•°é‡: <span class="hljs-subst">{data.y.<span class="hljs-built_in">max</span>().item() + <span class="hljs-number">1</span>}</span>'</span>) <span class="hljs-comment"># 4ï¼ˆ4ä¸ªå°å¸®æ´¾ï¼‰</span>

<span class="hljs-comment"># 2. å¯è§†åŒ–å›¾ç»“æ„ï¼ˆNetworkXï¼‰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">visualize_graph</span>(<span class="hljs-params">G, color</span>):
    plt.figure(figsize=(<span class="hljs-number">7</span>,<span class="hljs-number">7</span>))
    plt.xticks([])
    plt.yticks([])
    pos = nx.spring_layout(G, seed=<span class="hljs-number">42</span>) 
    nx.draw_networkx(G, pos=pos, with_labels=<span class="hljs-literal">False</span>,
                     node_color=color, cmap=<span class="hljs-string">"Set2"</span>, node_size=<span class="hljs-number">300</span>)
    plt.show()
    plt.close() 
G = to_networkx(data, to_undirected=<span class="hljs-literal">True</span>)
visualize_graph(G, data.y)
</code></pre>
<h3 data-id="heading-15">4.2 æ­å»º GCN æ¨¡å‹</h3>
<p>PyGçš„<code>GCNConv</code>å·²å°è£…å¥½å›¾å·ç§¯é€»è¾‘ï¼Œæ­å»ºæ¨¡å‹å’ŒCNNå‡ ä¹ä¸€è‡´ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F
<span class="hljs-keyword">from</span> torch_geometric.nn <span class="hljs-keyword">import</span> GCNConv

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GCN</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>().__init__()
        <span class="hljs-comment"># ç¬¬ä¸€å±‚å›¾å·ç§¯ï¼š34ç»´è¾“å…¥ â†’ 16ç»´éšè—ç‰¹å¾</span>
        self.conv1 = GCNConv(dataset.num_features, <span class="hljs-number">16</span>)
        <span class="hljs-comment"># ç¬¬äºŒå±‚å›¾å·ç§¯ï¼š16ç»´éšè— â†’ 4ç»´è¾“å‡ºï¼ˆå¯¹åº”4ä¸ªç±»åˆ«ï¼‰</span>
        self.conv2 = GCNConv(<span class="hljs-number">16</span>, dataset.num_classes)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, edge_index</span>):
        <span class="hljs-comment"># x: èŠ‚ç‚¹ç‰¹å¾ [N, F]ï¼Œedge_index: è¾¹ç´¢å¼• [2, E]</span>
        <span class="hljs-comment"># ç¬¬ä¸€å±‚å·ç§¯ + ReLUæ¿€æ´» + Dropoutæ­£åˆ™åŒ–</span>
        x = self.conv1(x, edge_index)  <span class="hljs-comment"># ç»´åº¦ï¼š[34,34] â†’ [34,16]</span>
        x = F.relu(x)
        x = F.dropout(x, p=<span class="hljs-number">0.5</span>, training=self.training) 
        
        <span class="hljs-comment"># ç¬¬äºŒå±‚å·ç§¯ï¼ˆæ— æ¿€æ´»ï¼Œè¾“å‡ºlogitsï¼‰</span>
        x = self.conv2(x, edge_index)  <span class="hljs-comment"># ç»´åº¦ï¼š[34,16] â†’ [34,4]</span>
        <span class="hljs-keyword">return</span> x

model = GCN()
</code></pre>
<h3 data-id="heading-16">4.3 è®­ç»ƒåŠç›‘ç£GCNæ¨¡å‹</h3>
<p>æˆ‘ä»¬è™½ç„¶æœ‰æ‰€æœ‰äººçš„æ ‡ç­¾ (<code>data.y</code>)ï¼Œä½†æˆ‘ä»¬å‡è£…åªçŸ¥é“å…¶ä¸­å‡ ä¸ªäººçš„ï¼ˆé€šè¿‡ <code>data.train_mask</code> æ¥æ§åˆ¶ï¼‰ã€‚æˆ‘ä»¬è¦è®© GCN é€šè¿‡å›¾ç»“æ„ï¼ŒæŠŠè¿™å‡ ä¸ªäººçš„æ ‡ç­¾ä¿¡æ¯â€œä¼ æ’­â€ç»™é‚»å±…ï¼Œä»è€ŒçŒœå‡ºå…¶ä»–äººçš„æ ‡ç­¾ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡å›¾æ‹“æ‰‘å°†æ ‡ç­¾ä¿¡æ¯â€œæ‰©æ•£â€åˆ°æœªæ ‡æ³¨èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span>
criterion = nn.CrossEntropyLoss() <span class="hljs-comment"># åˆ†ç±»ä»»åŠ¡æ ‡é…</span>
optimizer = torch.optim.Adam(
    model.parameters(), 
    lr=<span class="hljs-number">0.01</span>,          
    weight_decay=<span class="hljs-number">5e-4</span> <span class="hljs-comment"># L2æ­£åˆ™åŒ–ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</span>
)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">train</span>():
    model.train()
    optimizer.zero_grad() <span class="hljs-comment"># æ¸…ç©ºæ¢¯åº¦</span>
    <span class="hljs-comment"># å‰å‘ä¼ æ’­ï¼šè¾“å…¥æ•´å¼ å›¾ï¼ˆGCNé»˜è®¤Full-Batchè®­ç»ƒï¼‰</span>
    out = model(data.x, data.edge_index)
    <span class="hljs-comment"># ä»…è®¡ç®—æ ‡æ³¨èŠ‚ç‚¹çš„æŸå¤±ï¼ˆåŠç›‘ç£æ ¸å¿ƒï¼‰</span>
    loss = criterion(out[data.train_mask], data.y[data.train_mask])
    <span class="hljs-comment"># åå‘ä¼ æ’­ + æ¢¯åº¦æ›´æ–°</span>
    loss.backward()
    optimizer.step()
    <span class="hljs-keyword">return</span> loss.item()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():
    model.<span class="hljs-built_in">eval</span>() <span class="hljs-comment"># è¯„ä¼°æ¨¡å¼ï¼Œå…³é—­Dropout</span>
    <span class="hljs-keyword">with</span> torch.no_grad(): <span class="hljs-comment"># ç¦ç”¨æ¢¯åº¦è®¡ç®—ï¼ŒèŠ‚çœå†…å­˜</span>
        out = model(data.x, data.edge_index)
    pred = out.argmax(dim=<span class="hljs-number">1</span>) <span class="hljs-comment"># å–logitsæœ€å¤§çš„ç±»åˆ«ä¸ºé¢„æµ‹ç»“æœ</span>
    <span class="hljs-comment"># è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡ï¼ˆæœªæ ‡æ³¨èŠ‚ç‚¹ï¼‰</span>
    test_correct = pred[data.test_mask] == data.y[data.test_mask]
    test_acc = <span class="hljs-built_in">int</span>(test_correct.<span class="hljs-built_in">sum</span>()) / <span class="hljs-built_in">int</span>(data.test_mask.<span class="hljs-built_in">sum</span>())
    <span class="hljs-keyword">return</span> test_acc

<span class="hljs-comment"># å¼€å§‹è®­ç»ƒ</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\nå¼€å§‹è®­ç»ƒ GCN..."</span>)
<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">101</span>):
    loss = train()
    <span class="hljs-keyword">if</span> epoch % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:
        acc = test()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Epoch <span class="hljs-subst">{epoch:03d}</span>, Loss: <span class="hljs-subst">{loss:<span class="hljs-number">.4</span>f}</span>, Test Acc: <span class="hljs-subst">{acc:<span class="hljs-number">.4</span>f}</span>'</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"ğŸ‰ è®­ç»ƒå®Œæˆï¼GCN æˆåŠŸé€šè¿‡æ‹“æ‰‘å…³ç³»æ‰©æ•£æ ‡ç­¾ä¿¡æ¯ï¼"</span>)
</code></pre>
<h3 data-id="heading-17">4.4 ç»“æœå¯è§†åŒ–ï¼šEmbeddingé™ç»´åˆ†æ</h3>
<p>ç”¨TSNEé™ç»´ç›´è§‚å±•ç¤ºGCNå­¦ä¹ åˆ°çš„èŠ‚ç‚¹ç‰¹å¾èšç±»æ•ˆæœï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b24e22e29055453bb887fe6606630deb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-g5p-g6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769858001&amp;x-signature=Ds0lXmNLPn6euuih7hpw%2FZxtDa4%3D" alt="GCN_Node_Embedding.png" loading="lazy"/>
ğŸ“Œ <strong>ç»“æœè§£è¯»</strong>ï¼šå³ä½¿ä»…ç”¨å°‘é‡æ ‡æ³¨èŠ‚ç‚¹ï¼ŒGCNå­¦ä¹ åˆ°çš„Embeddingä»ä¼šè®©åŒå¸®æ´¾èŠ‚ç‚¹è‡ªåŠ¨èšç±»â€”â€”è¿™æ˜¯å›¾å·ç§¯â€œæ‹“æ‰‘ç‰¹å¾æå–â€çš„æ ¸å¿ƒä»·å€¼ã€‚</p>
<h2 data-id="heading-18">5. é¢è¯•é¿å‘æŒ‡å— (GNN ä¸“åœº)</h2>
<h3 data-id="heading-19">Q1: GCN å’Œ CNN çš„æœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>ç­”ï¼šâ‘  <strong>å¤„ç†æ•°æ®ç±»å‹</strong>ï¼šCNNå¤„ç†æ¬§å‡ é‡Œå¾—æ•°æ®ï¼ˆå›ºå®šæ‹“æ‰‘ï¼Œå¦‚ç½‘æ ¼ï¼‰ï¼ŒGCNå¤„ç†éæ¬§å‡ é‡Œå¾—æ•°æ®ï¼ˆæ— å›ºå®šæ‹“æ‰‘ï¼‰ï¼›
â‘¡ <strong>é‚»åŸŸå®šä¹‰</strong>ï¼šCNNçš„é‚»åŸŸæ˜¯â€œå›ºå®šå¤§å°çš„ç©ºé—´çª—å£â€ï¼ˆå¦‚3Ã—3ï¼‰ï¼ŒGCNçš„é‚»åŸŸæ˜¯â€œèŠ‚ç‚¹çš„æ‹“æ‰‘é‚»å±…â€ï¼ˆæ•°é‡ä¸å›ºå®šï¼‰ï¼›
â‘¢ <strong>å·ç§¯æœ¬è´¨</strong>ï¼šCNNæ˜¯â€œç©ºé—´å±€éƒ¨å·ç§¯â€ï¼ˆä¾èµ–å¹³ç§»ä¸å˜æ€§ï¼‰ï¼ŒGCNæ˜¯â€œæ‹“æ‰‘å±€éƒ¨å·ç§¯â€ï¼ˆä¾èµ–é‚»æ¥å…³ç³»ï¼Œæ— å¹³ç§»ä¸å˜æ€§ï¼‰ï¼›
â‘£ <strong>æƒé‡å…±äº«</strong>ï¼šä¸¤è€…å‡å…±äº«æƒé‡ï¼Œä½†GCNå¤šäº†â€œé‚»æ¥çŸ©é˜µå½’ä¸€åŒ–â€çš„èšåˆæ­¥éª¤ã€‚</p>
<h3 data-id="heading-20">Q2: ä¸ºä»€ä¹ˆ GCN ä¸èƒ½å †å¾ˆæ·±ï¼Ÿ(Over-smoothing é—®é¢˜)ï¼ˆé«˜é¢‘è€ƒç‚¹ï¼‰</h3>
<p>ç­”ï¼šGCNæ¯ä¸€å±‚éƒ½ä¼šèšåˆæ›´å¤§èŒƒå›´çš„é‚»åŸŸç‰¹å¾ï¼Œå †å å‡ åå±‚åï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šèšåˆ<strong>å…¨å›¾æ‰€æœ‰èŠ‚ç‚¹</strong>çš„ä¿¡æ¯ï¼ˆæœ‹å‹çš„æœ‹å‹çš„æœ‹å‹â€¦æœ€åè®¤è¯†äº†å…¨åœ°çƒäººï¼‰ã€‚æ ¹æ®æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘åŸç†ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„ç‰¹å¾ä¼šé€æ¸è¶‹åŒï¼ˆå˜å¾—ä¸€æ¨¡ä¸€æ ·ï¼‰ï¼Œæ— æ³•åŒºåˆ†ç±»åˆ«â€”â€”è¿™å°±æ˜¯<strong>è¿‡å¹³æ»‘ (Over-smoothing)</strong> ã€‚å› æ­¤GCNé€šå¸¸ä»…ç”¨2-3å±‚ï¼Œè§£å†³æ€è·¯åŒ…æ‹¬ï¼šåŠ å…¥æ®‹å·®è¿æ¥ã€ä½¿ç”¨GATï¼ˆæ³¨æ„åŠ›åŠ æƒèšåˆï¼‰ã€é™åˆ¶èšåˆèŒƒå›´ã€‚</p>
<h3 data-id="heading-21">Q3: é‚»æ¥çŸ©é˜µ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>ä¸ºä»€ä¹ˆè¦åŠ è‡ªç¯ (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>+</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">A+I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span>) å’Œå½’ä¸€åŒ– (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mover accent="true"><mi>D</mi><mo>~</mo></mover><mrow><mo>âˆ’</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msup><mover accent="true"><mi>A</mi><mo>~</mo></mover><msup><mover accent="true"><mi>D</mi><mo>~</mo></mover><mrow><mo>âˆ’</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\tilde{D}^{-1/2}\tilde{A}\tilde{D}^{-1/2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9202em;"/><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal">A</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1111em;"><span class="mord">~</span></span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9202em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span><span style="top:-3.6023em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">~</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span></span></span></span></span>)?</h3>
<p>ç­”ï¼š1.  <strong>åŠ è‡ªç¯</strong>ï¼šé¿å…èšåˆæ—¶ä¸¢å¤±èŠ‚ç‚¹è‡ªèº«ç‰¹å¾ï¼Œä¿è¯â€œè‡ªå·±çš„ä¿¡æ¯â€å‚ä¸ç‰¹å¾æ›´æ–°ï¼›
2.  <strong>å½’ä¸€åŒ–</strong>ï¼šâ‘  é˜²æ­¢åº¦å¤§çš„èŠ‚ç‚¹ç‰¹å¾å€¼çˆ†ç‚¸ï¼ˆå¦‚å¤§Vèšåˆåƒä¸‡é‚»å±…ç‰¹å¾ï¼‰ï¼›â‘¡ è®©é‚»æ¥çŸ©é˜µæ»¡è¶³å¯¹ç§°åˆ†å¸ƒï¼Œæå‡è®­ç»ƒç¨³å®šæ€§ï¼›â‘¢ ç»Ÿä¸€ä¸åŒèŠ‚ç‚¹çš„ç‰¹å¾å°ºåº¦ï¼Œç±»ä¼¼BatchNormçš„ä½œç”¨ã€‚</p>
<h3 data-id="heading-22">Q4: é™¤äº†GCNçš„å¹³å‡èšåˆï¼ŒGNNè¿˜æœ‰å“ªäº›å¸¸è§çš„æ¶ˆæ¯ä¼ é€’æ–¹å¼ï¼Ÿï¼ˆé«˜é¢‘è€ƒç‚¹ï¼‰</h3>
<p>ç­”ï¼š1.  <strong>GAT</strong>ï¼šæ³¨æ„åŠ›åŠ æƒèšåˆï¼ˆç»™ä¸åŒé‚»å±…åˆ†é…ä¸åŒæƒé‡ï¼Œè§£å†³GCNâ€œå¹³å‡èšåˆâ€çš„å…¬å¹³æ€§é—®é¢˜ï¼‰ï¼›
2.  <strong>GraphSAGE</strong>ï¼šé‡‡æ ·é‚»åŸŸèšåˆï¼ˆéšæœºé‡‡æ ·å›ºå®šæ•°é‡çš„é‚»å±…ï¼Œè§£å†³å¤§è§„æ¨¡å›¾çš„è®¡ç®—æ•ˆç‡é—®é¢˜ï¼‰ï¼›3. <strong>GIN</strong>ï¼šé€å…ƒç´ åŠ å’Œèšåˆï¼ˆå¯¹èŠ‚ç‚¹ç‰¹å¾åšéçº¿æ€§å˜æ¢ååŠ å’Œï¼Œæå‡è¡¨è¾¾èƒ½åŠ›ï¼‰ï¼›4.  <strong>æ± åŒ–èšåˆ</strong>ï¼šæœ€å¤§å€¼/æœ€å°å€¼èšåˆï¼ˆæ•æ‰é‚»åŸŸçš„æå€¼ç‰¹å¾ï¼‰ã€‚</p>
<h2 data-id="heading-23">ğŸ“Œ ä¸‹æœŸé¢„å‘Š</h2>
<p>æ­å–œä½ ï¼ä½ å·²ç»æŒæ¡äº†ç¥ç»ç½‘ç»œçš„ä¸‰å¤§æ”¯æŸ±ï¼š<strong>CNN (çœ‹å›¾)</strong> ã€<strong>Transformer (è¯»æ–‡)</strong> ã€<strong>GNN (ç†å…³ç³»)</strong> ã€‚ç†è®ºåŸºç¡€å·²ç»æ‰“å¾—éå¸¸ç‰¢å›ºäº†ã€‚
ä»ä¸‹ä¸€ç¯‡å¼€å§‹ï¼Œæˆ‘ä»¬å°†è¿›å…¥<strong>å®æˆ˜é˜¶æ®µ</strong>ï¼æ­å»ºä¸€ä¸ªèƒ½åƒç´ çº§è¯†åˆ«é©¬è·¯è½¦é“çº¿çš„æ¨¡å‹ã€‚è¿™å¯æ˜¯è‡ªåŠ¨é©¾é©¶çš„æ ¸å¿ƒæ¨¡å—å“¦ï¼å‡†å¤‡å¥½ä½ çš„ GPUï¼Œæˆ‘ä»¬è¦æå¤§äº‹äº†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring AI Gatewayï¼šä»å…¥é—¨åˆ°å®æˆ˜ï¼Œæ‰“é€ æ™ºèƒ½AIæœåŠ¡ç½‘å…³]]></title>    <link>https://juejin.cn/post/7598587406707179561</link>    <guid>https://juejin.cn/post/7598587406707179561</guid>    <pubDate>2026-01-25T01:49:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598587406707179561" data-draft-id="7598699872541114387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring AI Gatewayï¼šä»å…¥é—¨åˆ°å®æˆ˜ï¼Œæ‰“é€ æ™ºèƒ½AIæœåŠ¡ç½‘å…³"/> <meta itemprop="keywords" content="Java,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-25T01:49:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring AI Gatewayï¼šä»å…¥é—¨åˆ°å®æˆ˜ï¼Œæ‰“é€ æ™ºèƒ½AIæœåŠ¡ç½‘å…³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T01:49:05.000Z" title="Sun Jan 25 2026 01:49:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring AI Gatewayï¼šä»å…¥é—¨åˆ°å®æˆ˜ï¼Œæ‰“é€ æ™ºèƒ½AIæœåŠ¡ç½‘å…³</h2>
<h2 data-id="heading-1">å‰è¨€</h2>
<p>éšç€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å¿«é€Ÿå‘å±•ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå¼€å§‹å°†AIèƒ½åŠ›é›†æˆåˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­ã€‚ç„¶è€Œï¼Œç›´æ¥åœ¨ä¸šåŠ¡ä»£ç ä¸­è°ƒç”¨AI APIä¼šå¸¦æ¥è¯¸å¤šé—®é¢˜ï¼šAPIå¯†é’¥ç®¡ç†å›°éš¾ã€è¯·æ±‚é™æµéš¾ä»¥æ§åˆ¶ã€æˆæœ¬æ— æ³•è¿½è¸ªã€å“åº”ç¼ºä¹ç»Ÿä¸€å¤„ç†ç­‰ã€‚</p>
<p>Spring AI Gateway åº”è¿è€Œç”Ÿï¼Œå®ƒæ˜¯åŸºäºSpringç”Ÿæ€ç³»ç»Ÿæ„å»ºçš„AIæœåŠ¡ç½‘å…³ï¼Œæä¾›äº†ç»Ÿä¸€çš„AIæœåŠ¡è°ƒç”¨å…¥å£ã€æ™ºèƒ½è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­é™çº§ç­‰ä¼ä¸šçº§ç‰¹æ€§ã€‚æœ¬æ–‡å°†ä»é›¶å¼€å§‹ï¼Œå¸¦ä½ æ·±å…¥äº†è§£Spring AI Gatewayçš„è®¾è®¡ç†å¿µã€æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶é€šè¿‡å®é™…æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•æ„å»ºä¸€ä¸ªé«˜å¯ç”¨çš„AIæœåŠ¡ç½‘å…³ã€‚</p>
<h2 data-id="heading-2">ä¸€ã€ä»€ä¹ˆæ˜¯Spring AI Gateway</h2>
<h3 data-id="heading-3">1.1 æ ¸å¿ƒæ¦‚å¿µ</h3>
<p>Spring AI Gateway æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºAIæœåŠ¡è®¾è®¡çš„APIç½‘å…³ï¼Œå®ƒä½äºä¸šåŠ¡ç³»ç»Ÿå’ŒAIæ¨¡å‹æä¾›å•†ï¼ˆå¦‚OpenAIã€Azure OpenAIã€é€šä¹‰åƒé—®ç­‰ï¼‰ä¹‹é—´ï¼Œæä¾›ç»Ÿä¸€çš„è°ƒç”¨æ¥å£å’Œç®¡ç†èƒ½åŠ›ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š</strong></p>
<ul>
<li><strong>ç»Ÿä¸€æ¥å£</strong>ï¼šå±è”½ä¸åŒAIå‚å•†çš„APIå·®å¼‚ï¼Œæä¾›æ ‡å‡†åŒ–è°ƒç”¨æ–¹å¼</li>
<li><strong>æ™ºèƒ½è·¯ç”±</strong>ï¼šæ ¹æ®è¯·æ±‚ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å‹</li>
<li><strong>æµé‡æ§åˆ¶</strong>ï¼šæ”¯æŒé™æµã€ç†”æ–­ã€é™çº§ï¼Œä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§</li>
<li><strong>æˆæœ¬ä¼˜åŒ–</strong>ï¼šé€šè¿‡æ™ºèƒ½ç¼“å­˜å’Œè¯·æ±‚åˆå¹¶é™ä½AIè°ƒç”¨æˆæœ¬</li>
<li><strong>å¯è§‚æµ‹æ€§</strong>ï¼šå®Œæ•´çš„è¯·æ±‚è¿½è¸ªã€æ€§èƒ½ç›‘æ§å’Œæˆæœ¬åˆ†æ</li>
<li><strong>å®‰å…¨åŠ å›º</strong>ï¼šAPIå¯†é’¥é›†ä¸­ç®¡ç†ã€è¯·æ±‚å†…å®¹è¿‡æ»¤ã€è®¿é—®æ§åˆ¶</li>
</ul>
<h3 data-id="heading-4">1.2 ä¸ä¼ ç»ŸAPIç½‘å…³çš„åŒºåˆ«</h3>
<p>ä¼ ç»ŸAPIç½‘å…³ï¼ˆå¦‚Spring Cloud Gatewayã€Kongï¼‰ä¸»è¦é¢å‘RESTful APIæœåŠ¡ï¼Œè€ŒSpring AI Gatewayé’ˆå¯¹AIæœåŠ¡çš„ç‰¹æ®Šéœ€æ±‚è¿›è¡Œäº†ä¼˜åŒ–ï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>ä¼ ç»ŸAPIç½‘å…³</th><th>Spring AI Gateway</th></tr></thead><tbody><tr><td>åè®®æ”¯æŒ</td><td>HTTP/REST</td><td>HTTP/WebSocket/SSE</td></tr><tr><td>å“åº”å¤„ç†</td><td>åŒæ­¥å“åº”ä¸ºä¸»</td><td>æ”¯æŒæµå¼å“åº”</td></tr><tr><td>æ™ºèƒ½è·¯ç”±</td><td>åŸºäºURL/å‚æ•°</td><td>åŸºäºå†…å®¹è¯­ä¹‰ã€æˆæœ¬</td></tr><tr><td>ç¼“å­˜ç­–ç•¥</td><td>ç»“æœç¼“å­˜</td><td>è¯­ä¹‰ç¼“å­˜ã€å»é‡</td></tr><tr><td>æˆæœ¬ç®¡ç†</td><td>æ— </td><td>Tokenè®¡è´¹ã€é¢„ç®—æ§åˆ¶</td></tr><tr><td>æ¨¡å‹ç®¡ç†</td><td>å•ä¸€åç«¯</td><td>å¤šæ¨¡å‹åŠ¨æ€åˆ‡æ¢</td></tr></tbody></table>
<h3 data-id="heading-5">1.3 åº”ç”¨åœºæ™¯</h3>
<p>Spring AI Gatewayé€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li><strong>ä¼ä¸šå†…éƒ¨AIå¹³å°</strong>ï¼šç»Ÿä¸€ç®¡ç†å¤šä¸ªéƒ¨é—¨çš„AIè°ƒç”¨</li>
<li><strong>SaaSåº”ç”¨</strong>ï¼šä¸ºä¸åŒç§Ÿæˆ·æä¾›éš”ç¦»çš„AIæœåŠ¡</li>
<li><strong>AIåº”ç”¨å¼€å‘</strong>ï¼šå¿«é€Ÿé›†æˆå¤šç§AIèƒ½åŠ›</li>
<li><strong>æˆæœ¬æ•æ„Ÿé¡¹ç›®</strong>ï¼šéœ€è¦ç²¾ç¡®æ§åˆ¶AIè°ƒç”¨æˆæœ¬</li>
<li><strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼šéœ€è¦é™æµå’Œæ™ºèƒ½é™çº§</li>
</ul>
<h2 data-id="heading-6">äºŒã€ç¯å¢ƒå‡†å¤‡</h2>
<h3 data-id="heading-7">2.1 æŠ€æœ¯æ ˆ</h3>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- JDK 8+</span>
<span class="hljs-deletion">- Spring Boot 2.7.x</span>
<span class="hljs-deletion">- Spring Cloud Gateway</span>
<span class="hljs-deletion">- Redisï¼ˆç”¨äºç¼“å­˜ï¼‰</span>
</code></pre>
<h3 data-id="heading-8">2.2 é¡¹ç›®åˆå§‹åŒ–</h3>
<p>åˆ›å»ºgateway-demoé¡¹ç›®ï¼Œæ·»åŠ æ ¸å¿ƒä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Boot --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Cloud Gateway --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Redis for Caching --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Circuit Breaker --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-circuitbreaker-reactor-resilience4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Lombok --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Jackson --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h2 data-id="heading-9">ä¸‰ã€æ ¸å¿ƒæ¶æ„è®¾è®¡</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60f63ea4ecc0469caab879fa74f427e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769910545&amp;x-signature=PG9Uk03on0NzE9rnPB9rinFoh14%3D" alt="" loading="lazy"/></p>
<p>Spring AI Gatewayé‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºï¼š</p>
<p><strong>æ¥å…¥å±‚</strong>ï¼šå¤„ç†å¤–éƒ¨è¯·æ±‚ï¼Œè¿›è¡Œè®¤è¯æˆæƒ <strong>è·¯ç”±å±‚</strong>ï¼šæ ¹æ®è¯·æ±‚ç‰¹å¾è¿›è¡Œæ™ºèƒ½è·¯ç”± <strong>å¤„ç†å±‚</strong>ï¼šæ‰§è¡Œè¯·æ±‚è½¬æ¢ã€ç¼“å­˜ã€é™æµç­‰é€»è¾‘ <strong>é€‚é…å±‚</strong>ï¼šå¯¹æ¥ä¸åŒAIå‚å•†çš„API <strong>æ•°æ®å±‚</strong>ï¼šå­˜å‚¨é…ç½®ã€ç¼“å­˜ã€ç›‘æ§æ•°æ®</p>
<h3 data-id="heading-10">3.1 æ ¸å¿ƒç»„ä»¶</h3>
<p><strong>AiRouteLocator</strong>ï¼šAIè·¯ç”±å®šä½å™¨ï¼Œè´Ÿè´£åŒ¹é…è¯·æ±‚ä¸åç«¯æ¨¡å‹ <strong>AiRequestFilter</strong>ï¼šè¯·æ±‚è¿‡æ»¤å™¨ï¼Œå¤„ç†è¯·æ±‚é¢„å¤„ç†å’Œåå¤„ç† <strong>ModelAdapter</strong>ï¼šæ¨¡å‹é€‚é…å™¨ï¼Œç»Ÿä¸€ä¸åŒå‚å•†çš„APIè°ƒç”¨æ–¹å¼ <strong>TokenManager</strong>ï¼šTokenç®¡ç†å™¨ï¼Œè·Ÿè¸ªä½¿ç”¨é‡å’Œæˆæœ¬ <strong>SemanticCache</strong>ï¼šè¯­ä¹‰ç¼“å­˜ï¼ŒåŸºäºç›¸ä¼¼åº¦çš„æ™ºèƒ½ç¼“å­˜</p>
<h2 data-id="heading-11">å››ã€å®ç°æ ¸å¿ƒåŠŸèƒ½</h2>
<h3 data-id="heading-12">4.1 æ™ºèƒ½è·¯ç”±é…ç½®</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64b44b21e95b4a959a9854dcd276c6f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769910545&amp;x-signature=ma0L2nEh5dtREvq1cJnxvW%2FNZNw%3D" alt="" loading="lazy"/></p>
<p>æ™ºèƒ½è·¯ç”±æ˜¯Spring AI Gatewayçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå®ƒå¯ä»¥æ ¹æ®è¯·æ±‚å†…å®¹ã€ç”¨æˆ·åå¥½ã€æˆæœ¬é¢„ç®—ç­‰å› ç´ ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„AIæ¨¡å‹ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/**
 * AIè·¯ç”±é…ç½®
 */</span>
<span class="hljs-variable">@Configuration</span>
public class AiRouteConfig {

    <span class="hljs-variable">@Bean</span>
    public RouteLocator <span class="hljs-built_in">customRouteLocator</span>(RouteLocatorBuilder builder) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">builder</span><span class="hljs-selector-class">.routes</span>()
            <span class="hljs-comment">// GPT-4 è·¯ç”± - ç”¨äºå¤æ‚æ¨ç†ä»»åŠ¡</span>
            <span class="hljs-selector-class">.route</span>(<span class="hljs-string">"gpt4-route"</span>, r -&gt; r
                .<span class="hljs-built_in">path</span>(<span class="hljs-string">"/api/ai/chat/completions"</span>)
                .<span class="hljs-built_in">and</span>()
                .<span class="hljs-built_in">readBody</span>(ChatRequest.class, req -&gt;
                    req.<span class="hljs-built_in">getModel</span>().<span class="hljs-built_in">equals</span>(<span class="hljs-string">"gpt-4"</span>) ||
                    req.<span class="hljs-built_in">getMaxTokens</span>() &gt; <span class="hljs-number">2000</span>
                )
                .<span class="hljs-built_in">filters</span>(f -&gt; f
                    .<span class="hljs-built_in">stripPrefix</span>(<span class="hljs-number">2</span>)
                    .<span class="hljs-built_in">filter</span>(aiGatewayFilter)
                    .<span class="hljs-built_in">circuitBreaker</span>(c -&gt; c.<span class="hljs-built_in">setName</span>(<span class="hljs-string">"gpt4-cb"</span>))
                )
                .<span class="hljs-built_in">uri</span>(<span class="hljs-string">"lb://openai-gpt4-service"</span>))

            <span class="hljs-comment">// GPT-3.5 è·¯ç”± - ç”¨äºä¸€èˆ¬å¯¹è¯</span>
            <span class="hljs-selector-class">.route</span>(<span class="hljs-string">"gpt35-route"</span>, r -&gt; r
                .<span class="hljs-built_in">path</span>(<span class="hljs-string">"/api/ai/chat/completions"</span>)
                .<span class="hljs-built_in">and</span>()
                .<span class="hljs-built_in">readBody</span>(ChatRequest.class, req -&gt;
                    req.<span class="hljs-built_in">getModel</span>().<span class="hljs-built_in">equals</span>(<span class="hljs-string">"gpt-3.5-turbo"</span>)
                )
                .<span class="hljs-built_in">filters</span>(f -&gt; f
                    .<span class="hljs-built_in">stripPrefix</span>(<span class="hljs-number">2</span>)
                    .<span class="hljs-built_in">filter</span>(aiGatewayFilter)
                    .<span class="hljs-built_in">requestRateLimiter</span>(c -&gt; c
                        .<span class="hljs-built_in">setRateLimiter</span>(<span class="hljs-built_in">redisRateLimiter</span>())
                        .<span class="hljs-built_in">setKeyResolver</span>(<span class="hljs-built_in">userKeyResolver</span>())
                    )
                )
                .<span class="hljs-built_in">uri</span>(<span class="hljs-string">"lb://openai-gpt35-service"</span>))

            <span class="hljs-comment">// é»˜è®¤è·¯ç”± - æˆæœ¬ä¼˜åŒ–</span>
            <span class="hljs-selector-class">.route</span>(<span class="hljs-string">"default-route"</span>, r -&gt; r
                .<span class="hljs-built_in">path</span>(<span class="hljs-string">"/api/ai/**"</span>)
                .<span class="hljs-built_in">filters</span>(f -&gt; f
                    .<span class="hljs-built_in">stripPrefix</span>(<span class="hljs-number">2</span>)
                    .<span class="hljs-built_in">filter</span>(aiGatewayFilter)
                    .<span class="hljs-built_in">filter</span>(costOptimizationFilter)
                )
                .<span class="hljs-built_in">uri</span>(<span class="hljs-string">"lb://ai-model-service"</span>))
            <span class="hljs-selector-class">.build</span>();
    }
}
</code></pre>
<h3 data-id="heading-13">4.2 ç»Ÿä¸€è¯·æ±‚å¤„ç†</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1231d1b126014baf8dde4a8b93ab1ce8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769910545&amp;x-signature=K2%2FRWiveIhH0W83XiKqlcDeCDjM%3D" alt="" loading="lazy"/></p>
<p>é€šè¿‡GlobalFilterå®ç°ç»Ÿä¸€çš„è¯·æ±‚æ‹¦æˆªå’Œå¤„ç†ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * AIç½‘å…³ç»Ÿä¸€è¿‡æ»¤å™¨
 */</span>
<span class="hljs-keyword">@Component</span>
<span class="hljs-keyword">@Slf</span>4j
public class AiGatewayFilter implements GlobalFilter, Ordered {

    <span class="hljs-keyword">@Autowired</span>
    private TokenManager tokenManager;

    <span class="hljs-keyword">@Autowired</span>
    private SemanticCache semanticCache;

    <span class="hljs-keyword">@Autowired</span>
    private AiMetrics metrics;

    <span class="hljs-keyword">@Override</span>
    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        long startTime = System<span class="hljs-selector-class">.currentTimeMillis</span>();
        String path = exchange<span class="hljs-selector-class">.getRequest</span>()<span class="hljs-selector-class">.getPath</span>()<span class="hljs-selector-class">.value</span>();

        <span class="hljs-comment">// 1. è®°å½•è¯·æ±‚ä¿¡æ¯</span>
        String requestId = UUID<span class="hljs-selector-class">.randomUUID</span>()<span class="hljs-selector-class">.toString</span>();
        exchange<span class="hljs-selector-class">.getAttributes</span>()<span class="hljs-selector-class">.put</span>("requestId", requestId);
        exchange<span class="hljs-selector-class">.getAttributes</span>()<span class="hljs-selector-class">.put</span>("startTime", startTime);

        log<span class="hljs-selector-class">.info</span>("AI Gateway Request [{}] - Path: {}, Method: {}",
            requestId, path, exchange.getRequest()<span class="hljs-selector-class">.getMethod</span>());

        <span class="hljs-comment">// 2. æ£€æŸ¥ç¼“å­˜</span>
        if (isCacheableRequest(exchange)) {
            String cacheKey = <span class="hljs-built_in">generateCacheKey</span>(exchange);
            String cachedResponse = semanticCache<span class="hljs-selector-class">.get</span>(cacheKey);
            if (cachedResponse != null) {
                log<span class="hljs-selector-class">.info</span>("Cache hit for request [{}]", requestId);
                metrics<span class="hljs-selector-class">.recordCacheHit</span>();
                return <span class="hljs-built_in">buildCachedResponse</span>(exchange, cachedResponse);
            }
            metrics<span class="hljs-selector-class">.recordCacheMiss</span>();
        }

        <span class="hljs-comment">// 3. Tokené¢„æ£€æŸ¥</span>
        return tokenManager<span class="hljs-selector-class">.checkAndReserveTokens</span>(exchange)
            <span class="hljs-selector-class">.flatMap</span>(reserved -&gt; {
                if (!reserved) {
                    log<span class="hljs-selector-class">.warn</span>("Token quota exceeded for request [{}]", requestId);
                    return <span class="hljs-built_in">buildErrorResponse</span>(exchange, <span class="hljs-number">429</span>,
                        "Token quota exceeded, please try again later");
                }
                return chain<span class="hljs-selector-class">.filter</span>(exchange);
            })
            <span class="hljs-selector-class">.doOnSuccess</span>(aVoid -&gt; {
                // <span class="hljs-number">4</span>. åå¤„ç†ï¼šæ›´æ–°ç»Ÿè®¡
                long duration = System.currentTimeMillis() - startTime;
                metrics<span class="hljs-selector-class">.recordRequestDuration</span>(path, duration);
                log<span class="hljs-selector-class">.info</span>("AI Gateway Request [{}] completed in {}ms", requestId, duration);
            })
            <span class="hljs-selector-class">.doOnError</span>(error -&gt; {
                log.error("AI Gateway Request [{}] failed", requestId, error);
                metrics<span class="hljs-selector-class">.recordError</span>(path, error);
            });
    }

    <span class="hljs-keyword">@Override</span>
    public int getOrder() {
        return -<span class="hljs-number">100</span>; <span class="hljs-comment">// é«˜ä¼˜å…ˆçº§</span>
    }

    private boolean <span class="hljs-built_in">isCacheableRequest</span>(ServerWebExchange exchange) {
        String method = exchange<span class="hljs-selector-class">.getRequest</span>()<span class="hljs-selector-class">.getMethod</span>()<span class="hljs-selector-class">.name</span>();
        String path = exchange<span class="hljs-selector-class">.getRequest</span>()<span class="hljs-selector-class">.getPath</span>()<span class="hljs-selector-class">.value</span>();
        return "POST"<span class="hljs-selector-class">.equals</span>(method) &amp;&amp; path<span class="hljs-selector-class">.contains</span>("/chat/completions");
    }

    private String <span class="hljs-built_in">generateCacheKey</span>(ServerWebExchange exchange) {
        <span class="hljs-comment">// åŸºäºè¯·æ±‚å†…å®¹ç”Ÿæˆè¯­ä¹‰ç¼“å­˜key</span>
        return SemanticCache<span class="hljs-selector-class">.generateKey</span>(exchange.getRequest());
    }
}
</code></pre>
<h3 data-id="heading-14">4.3 æ¨¡å‹é€‚é…å™¨</h3>
<p>ç»Ÿä¸€ä¸åŒAIå‚å•†çš„APIè°ƒç”¨æ–¹å¼ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * AIæ¨¡å‹é€‚é…å™¨æ¥å£
 */</span>
<span class="hljs-keyword">public</span> interface ModelAdapter {

    <span class="hljs-comment">/**
     * è½¬æ¢è¯·æ±‚æ ¼å¼
     */</span>
    <span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">adaptRequest</span><span class="hljs-params">(<span class="hljs-type">String</span> originalRequest, ModelConfig config)</span></span>;

    <span class="hljs-comment">/**
     * è½¬æ¢å“åº”æ ¼å¼
     */</span>
    <span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">adaptResponse</span><span class="hljs-params">(<span class="hljs-type">String</span> originalResponse, ModelConfig config)</span></span>;

    <span class="hljs-comment">/**
     * è®¡ç®—Tokenä½¿ç”¨é‡
     */</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">calculateTokens</span><span class="hljs-params">(<span class="hljs-type">String</span> request, <span class="hljs-type">String</span> response)</span></span>;

    <span class="hljs-comment">/**
     * è®¡ç®—æˆæœ¬
     */</span>
    <span class="hljs-function">BigDecimal <span class="hljs-title">calculateCost</span><span class="hljs-params">(<span class="hljs-type">int</span> inputTokens, <span class="hljs-type">int</span> outputTokens, ModelConfig config)</span></span>;
}

<span class="hljs-comment">/**
 * OpenAIé€‚é…å™¨å®ç°
 */</span>
@Component
@Slf4j
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenAIModelAdapter</span> implements ModelAdapter {

    @<span class="hljs-function">Override
    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">adaptRequest</span><span class="hljs-params">(<span class="hljs-type">String</span> originalRequest, ModelConfig config)</span> </span>{
        <span class="hljs-comment">// è½¬æ¢ä¸ºOpenAIæ ¼å¼</span>
        ObjectMapper mapper = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ObjectMapper</span>();
        <span class="hljs-keyword">try</span> {
            JsonNode root = mapper.<span class="hljs-built_in">readTree</span>(originalRequest);
            ObjectNode adapted = mapper.<span class="hljs-built_in">createObjectNode</span>();

            adapted.<span class="hljs-built_in">put</span>(<span class="hljs-string">"model"</span>, config.<span class="hljs-built_in">getModelName</span>());
            adapted.<span class="hljs-built_in">set</span>(<span class="hljs-string">"messages"</span>, root.<span class="hljs-built_in">get</span>(<span class="hljs-string">"messages"</span>));
            adapted.<span class="hljs-built_in">put</span>(<span class="hljs-string">"temperature"</span>, config.<span class="hljs-built_in">getTemperature</span>());
            adapted.<span class="hljs-built_in">put</span>(<span class="hljs-string">"max_tokens"</span>, config.<span class="hljs-built_in">getMaxTokens</span>());

            <span class="hljs-keyword">if</span> (config.<span class="hljs-built_in">getFunctions</span>() != null) {
                adapted.<span class="hljs-built_in">set</span>(<span class="hljs-string">"functions"</span>, mapper.<span class="hljs-built_in">valueToTree</span>(config.<span class="hljs-built_in">getFunctions</span>()));
            }

            <span class="hljs-keyword">return</span> mapper.<span class="hljs-built_in">writeValueAsString</span>(adapted);
        } <span class="hljs-built_in">catch</span> (Exception e) {
            log.<span class="hljs-built_in">error</span>(<span class="hljs-string">"Failed to adapt request"</span>, e);
            <span class="hljs-keyword">return</span> originalRequest;
        }
    }

    @<span class="hljs-function">Override
    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">adaptResponse</span><span class="hljs-params">(<span class="hljs-type">String</span> originalResponse, ModelConfig config)</span> </span>{
        <span class="hljs-comment">// OpenAIæ ¼å¼å·²ç»æ˜¯æ ‡å‡†æ ¼å¼ï¼Œç›´æ¥è¿”å›</span>
        <span class="hljs-keyword">return</span> originalResponse;
    }

    @<span class="hljs-function">Override
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">calculateTokens</span><span class="hljs-params">(<span class="hljs-type">String</span> request, <span class="hljs-type">String</span> response)</span> </span>{
        <span class="hljs-comment">// ç®€åŒ–è®¡ç®—ï¼šè‹±æ–‡æŒ‰4å­—ç¬¦/tokenï¼Œä¸­æ–‡æŒ‰2å­—ç¬¦/token</span>
        <span class="hljs-type">int</span> requestTokens = <span class="hljs-built_in">estimateTokens</span>(request);
        <span class="hljs-type">int</span> responseTokens = <span class="hljs-built_in">estimateTokens</span>(response);

        log.<span class="hljs-built_in">debug</span>(<span class="hljs-string">"Token calculation - Request: {}, Response: {}, Total: {}"</span>,
            requestTokens, responseTokens, requestTokens + responseTokens);

        <span class="hljs-keyword">return</span> requestTokens + responseTokens;
    }

    @<span class="hljs-function">Override
    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title">calculateCost</span><span class="hljs-params">(<span class="hljs-type">int</span> inputTokens, <span class="hljs-type">int</span> outputTokens, ModelConfig config)</span> </span>{
        BigDecimal inputCost = config.<span class="hljs-built_in">getInputPrice</span>()
            .<span class="hljs-built_in">multiply</span>(BigDecimal.<span class="hljs-built_in">valueOf</span>(inputTokens))
            .<span class="hljs-built_in">divide</span>(BigDecimal.<span class="hljs-built_in">valueOf</span>(<span class="hljs-number">1000</span>)); <span class="hljs-comment">// æŒ‰åƒtokensè®¡è´¹</span>

        BigDecimal outputCost = config.<span class="hljs-built_in">getOutputPrice</span>()
            .<span class="hljs-built_in">multiply</span>(BigDecimal.<span class="hljs-built_in">valueOf</span>(outputTokens))
            .<span class="hljs-built_in">divide</span>(BigDecimal.<span class="hljs-built_in">valueOf</span>(<span class="hljs-number">1000</span>));

        <span class="hljs-keyword">return</span> inputCost.<span class="hljs-built_in">add</span>(outputCost);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title">estimateTokens</span><span class="hljs-params">(<span class="hljs-type">String</span> text)</span> </span>{
        <span class="hljs-keyword">if</span> (text == null || text.<span class="hljs-built_in">isEmpty</span>()) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-comment">// ç®€å•ä¼°ç®—ï¼šä¸­æ–‡å­—ç¬¦*2 + è‹±æ–‡å­—ç¬¦/4</span>
        <span class="hljs-type">int</span> chineseChars = text.<span class="hljs-built_in">replaceAll</span>(<span class="hljs-string">"[^\u4e00-\u9fa5]"</span>, <span class="hljs-string">""</span>).<span class="hljs-built_in">length</span>();
        <span class="hljs-type">int</span> otherChars = text.<span class="hljs-built_in">length</span>() - chineseChars;
        <span class="hljs-keyword">return</span> chineseChars * <span class="hljs-number">2</span> + otherChars / <span class="hljs-number">4</span>;
    }
}
</code></pre>
<h3 data-id="heading-15">4.4 Tokenç®¡ç†å’Œæˆæœ¬è¿½è¸ª</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * Tokenç®¡ç†å™¨
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenManager</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; redisTemplate;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ModelAdapter</span>&gt; adapters;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${ai.quota.default:100000}"</span>)
    <span class="hljs-keyword">private</span> int defaultQuota;

    <span class="hljs-comment">/**
     * æ£€æŸ¥å¹¶é¢„ç•™Token
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Mono</span>&lt;<span class="hljs-title class_">Boolean</span>&gt; <span class="hljs-title function_">checkAndReserveTokens</span>(<span class="hljs-params">ServerWebExchange exchange</span>) {
        <span class="hljs-title class_">String</span> userId = <span class="hljs-title function_">getUserId</span>(exchange);
        <span class="hljs-title class_">String</span> requestBody = <span class="hljs-title function_">getRequestBody</span>(exchange);

        <span class="hljs-keyword">return</span> <span class="hljs-title function_">estimateRequestTokens</span>(requestBody)
            .<span class="hljs-title function_">flatMap</span>(estimatedTokens -&gt; {
                <span class="hljs-title class_">String</span> key = <span class="hljs-string">"token:quota:"</span> + userId;
                <span class="hljs-title class_">Integer</span> remaining = (<span class="hljs-title class_">Integer</span>) redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(key);

                <span class="hljs-keyword">if</span> (remaining == <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// é¦–æ¬¡ä½¿ç”¨ï¼Œåˆå§‹åŒ–é…é¢</span>
                    redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(key, defaultQuota, <span class="hljs-number">1</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">DAYS</span>);
                    remaining = defaultQuota;
                }

                <span class="hljs-keyword">if</span> (remaining &lt; estimatedTokens) {
                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Mono</span>.<span class="hljs-title function_">just</span>(<span class="hljs-literal">false</span>);
                }

                <span class="hljs-comment">// é¢„ç•™tokens</span>
                redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">decrement</span>(key, estimatedTokens);
                exchange.<span class="hljs-title function_">getAttributes</span>().<span class="hljs-title function_">put</span>(<span class="hljs-string">"reservedTokens"</span>, estimatedTokens);
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Mono</span>.<span class="hljs-title function_">just</span>(<span class="hljs-literal">true</span>);
            });
    }

    <span class="hljs-comment">/**
     * æ›´æ–°å®é™…ä½¿ç”¨é‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">updateActualUsage</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> requestId, int actualTokens</span>) {
        <span class="hljs-title class_">String</span> key = <span class="hljs-string">"token:usage:"</span> + requestId;
        redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(key, actualTokens, <span class="hljs-number">24</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">HOURS</span>);
    }

    <span class="hljs-comment">/**
     * è·å–ç”¨æˆ·ä½¿ç”¨ç»Ÿè®¡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">UserUsageStats</span> <span class="hljs-title function_">getUserStats</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> userId</span>) {
        <span class="hljs-title class_">String</span> quotaKey = <span class="hljs-string">"token:quota:"</span> + userId;
        <span class="hljs-title class_">Integer</span> remaining = (<span class="hljs-title class_">Integer</span>) redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(quotaKey);

        <span class="hljs-title class_">String</span> usageKey = <span class="hljs-string">"token:usage:"</span> + userId + <span class="hljs-string">":*"</span>;
        <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">String</span>&gt; usageKeys = redisTemplate.<span class="hljs-title function_">keys</span>(usageKey);

        int totalUsed = usageKeys.<span class="hljs-title function_">stream</span>()
            .<span class="hljs-title function_">mapToInt</span>(key -&gt; {
                <span class="hljs-title class_">Integer</span> value = (<span class="hljs-title class_">Integer</span>) redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(key);
                <span class="hljs-keyword">return</span> value != <span class="hljs-literal">null</span> ? value : <span class="hljs-number">0</span>;
            })
            .<span class="hljs-title function_">sum</span>();

        <span class="hljs-keyword">return</span> <span class="hljs-title class_">UserUsageStats</span>.<span class="hljs-title function_">builder</span>()
            .<span class="hljs-title function_">userId</span>(userId)
            .<span class="hljs-title function_">totalQuota</span>(defaultQuota)
            .<span class="hljs-title function_">remainingQuota</span>(remaining != <span class="hljs-literal">null</span> ? remaining : defaultQuota)
            .<span class="hljs-title function_">totalUsed</span>(totalUsed)
            .<span class="hljs-title function_">build</span>();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Mono</span>&lt;<span class="hljs-title class_">Integer</span>&gt; <span class="hljs-title function_">estimateRequestTokens</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> requestBody</span>) {
        <span class="hljs-comment">// ç®€å•ä¼°ç®—</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Mono</span>.<span class="hljs-title function_">just</span>(requestBody.<span class="hljs-title function_">length</span>() / <span class="hljs-number">3</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUserId</span>(<span class="hljs-params">ServerWebExchange exchange</span>) {
        <span class="hljs-keyword">return</span> exchange.<span class="hljs-title function_">getRequest</span>().<span class="hljs-title function_">getHeaders</span>().<span class="hljs-title function_">getFirst</span>(<span class="hljs-string">"X-User-Id"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getRequestBody</span>(<span class="hljs-params">ServerWebExchange exchange</span>) {
        <span class="hljs-keyword">return</span> exchange.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">"cachedRequestBody"</span>);
    }
}
</code></pre>
<h3 data-id="heading-16">4.5 è¯­ä¹‰ç¼“å­˜</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/227b62bfbe0a49c9955ea8634624377a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769910545&amp;x-signature=FYtopBQOtWp1IWDKtAbZn%2FEHOq4%3D" alt="" loading="lazy"/></p>
<p>åŸºäºç›¸ä¼¼åº¦çš„æ™ºèƒ½ç¼“å­˜ï¼Œæé«˜å“åº”é€Ÿåº¦ï¼Œé™ä½æˆæœ¬ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * è¯­ä¹‰ç¼“å­˜å®ç°
 */</span>
@Component
@Slf4j
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemanticCache</span> {

    @Autowired
    <span class="hljs-keyword">private</span> RedisTemplate&lt;<span class="hljs-type">String</span>, <span class="hljs-type">String</span>&gt; redisTemplate;

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> SIMILARITY_THRESHOLD = <span class="hljs-number">0.85</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> CACHE_TTL_HOURS = <span class="hljs-number">24</span>;

    <span class="hljs-comment">/**
     * ç”Ÿæˆç¼“å­˜key
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">String</span> <span class="hljs-title">generateKey</span><span class="hljs-params">(ServerHttpRequest request)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> body = request.<span class="hljs-built_in">getBody</span>()
                .<span class="hljs-built_in">map</span>(dataBuffer -&gt; {
                    <span class="hljs-type">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-type">byte</span>[dataBuffer.<span class="hljs-built_in">readableByteCount</span>()];
                    dataBuffer.<span class="hljs-built_in">read</span>(bytes);
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">String</span>(bytes, StandardCharsets.UTF_8);
                })
                .<span class="hljs-built_in">blockFirst</span>();

            <span class="hljs-keyword">if</span> (body != null) {
                <span class="hljs-comment">// æå–æ ¸å¿ƒå¯¹è¯å†…å®¹ç”Ÿæˆkey</span>
                ObjectMapper mapper = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ObjectMapper</span>();
                JsonNode root = mapper.<span class="hljs-built_in">readTree</span>(body);
                JsonNode messages = root.<span class="hljs-built_in">get</span>(<span class="hljs-string">"messages"</span>);

                <span class="hljs-keyword">if</span> (messages != null &amp;&amp; messages.<span class="hljs-built_in">isArray</span>() &amp;&amp; messages.<span class="hljs-built_in">size</span>() &gt; <span class="hljs-number">0</span>) {
                    JsonNode lastMessage = messages.<span class="hljs-built_in">get</span>(messages.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);
                    <span class="hljs-type">String</span> content = lastMessage.<span class="hljs-built_in">get</span>(<span class="hljs-string">"content"</span>).<span class="hljs-built_in">asText</span>();

                    <span class="hljs-comment">// ä½¿ç”¨å†…å®¹hashä½œä¸ºkey</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"ai:cache:"</span> + DigestUtils.<span class="hljs-built_in">md5DigestAsHex</span>(content.<span class="hljs-built_in">getBytes</span>());
                }
            }
        } <span class="hljs-built_in">catch</span> (Exception e) {
            log.<span class="hljs-built_in">error</span>(<span class="hljs-string">"Failed to generate cache key"</span>, e);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-string">"ai:cache:"</span> + UUID.<span class="hljs-built_in">randomUUID</span>().<span class="hljs-built_in">toString</span>();
    }

    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">String</span> key)</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> cached = redisTemplate.<span class="hljs-built_in">opsForValue</span>().<span class="hljs-built_in">get</span>(key);
            <span class="hljs-keyword">if</span> (cached != null) {
                log.<span class="hljs-built_in">debug</span>(<span class="hljs-string">"Cache hit for key: {}"</span>, key);
                <span class="hljs-keyword">return</span> cached;
            }
        } <span class="hljs-built_in">catch</span> (Exception e) {
            log.<span class="hljs-built_in">error</span>(<span class="hljs-string">"Cache get error"</span>, e);
        }
        <span class="hljs-keyword">return</span> null;
    }

    <span class="hljs-comment">/**
     * è®¾ç½®ç¼“å­˜
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">put</span><span class="hljs-params">(<span class="hljs-type">String</span> key, <span class="hljs-type">String</span> value)</span> </span>{
        <span class="hljs-keyword">try</span> {
            redisTemplate.<span class="hljs-built_in">opsForValue</span>().<span class="hljs-built_in">set</span>(key, value, CACHE_TTL_HOURS, TimeUnit.HOURS);
            log.<span class="hljs-built_in">debug</span>(<span class="hljs-string">"Cache set for key: {}"</span>, key);
        } <span class="hljs-built_in">catch</span> (Exception e) {
            log.<span class="hljs-built_in">error</span>(<span class="hljs-string">"Cache set error"</span>, e);
        }
    }

    <span class="hljs-comment">/**
     * è®¡ç®—æ–‡æœ¬ç›¸ä¼¼åº¦
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title">calculateSimilarity</span><span class="hljs-params">(<span class="hljs-type">String</span> text1, <span class="hljs-type">String</span> text2)</span> </span>{
        <span class="hljs-comment">// ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦</span>
        Map&lt;<span class="hljs-type">String</span>, Integer&gt; vector1 = <span class="hljs-built_in">buildTextVector</span>(text1);
        Map&lt;<span class="hljs-type">String</span>, Integer&gt; vector2 = <span class="hljs-built_in">buildTextVector</span>(text2);

        <span class="hljs-keyword">return</span> <span class="hljs-built_in">cosineSimilarity</span>(vector1, vector2);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> Map&lt;<span class="hljs-type">String</span>, Integer&gt; <span class="hljs-title">buildTextVector</span><span class="hljs-params">(<span class="hljs-type">String</span> text)</span> </span>{
        Map&lt;<span class="hljs-type">String</span>, Integer&gt; vector = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        <span class="hljs-type">String</span>[] words = text.<span class="hljs-built_in">toLowerCase</span>().<span class="hljs-built_in">split</span>(<span class="hljs-string">"\s+"</span>);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> <span class="hljs-type">word</span> : words) {
            vector.<span class="hljs-built_in">put</span>(<span class="hljs-type">word</span>, vector.<span class="hljs-built_in">getOrDefault</span>(<span class="hljs-type">word</span>, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);
        }

        <span class="hljs-keyword">return</span> vector;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">double</span> <span class="hljs-title">cosineSimilarity</span><span class="hljs-params">(Map&lt;<span class="hljs-type">String</span>, Integer&gt; v1, Map&lt;<span class="hljs-type">String</span>, Integer&gt; v2)</span> </span>{
        Set&lt;<span class="hljs-type">String</span>&gt; allWords = <span class="hljs-keyword">new</span> HashSet&lt;&gt;();
        allWords.<span class="hljs-built_in">addAll</span>(v1.<span class="hljs-built_in">keySet</span>());
        allWords.<span class="hljs-built_in">addAll</span>(v2.<span class="hljs-built_in">keySet</span>());

        <span class="hljs-type">double</span> dotProduct = <span class="hljs-number">0</span>;
        <span class="hljs-type">double</span> norm1 = <span class="hljs-number">0</span>;
        <span class="hljs-type">double</span> norm2 = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-type">String</span> <span class="hljs-type">word</span> : allWords) {
            <span class="hljs-type">int</span> f1 = v1.<span class="hljs-built_in">getOrDefault</span>(<span class="hljs-type">word</span>, <span class="hljs-number">0</span>);
            <span class="hljs-type">int</span> f2 = v2.<span class="hljs-built_in">getOrDefault</span>(<span class="hljs-type">word</span>, <span class="hljs-number">0</span>);

            dotProduct += f1 * f2;
            norm1 += f1 * f1;
            norm2 += f2 * f2;
        }

        <span class="hljs-keyword">return</span> dotProduct / (Math.<span class="hljs-built_in">sqrt</span>(norm1) * Math.<span class="hljs-built_in">sqrt</span>(norm2));
    }
}
</code></pre>
<h2 data-id="heading-17">äº”ã€ç”Ÿäº§å®è·µæ¡ˆä¾‹</h2>
<h3 data-id="heading-18">5.1 æ™ºèƒ½å®¢æœç³»ç»Ÿ</h3>
<p>æŸç”µå•†å…¬å¸ä½¿ç”¨Spring AI Gatewayæ„å»ºæ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œå¤„ç†ä»¥ä¸‹åœºæ™¯ï¼š</p>
<p><strong>åœºæ™¯1ï¼šç®€å•å’¨è¯¢è‡ªåŠ¨å“åº”</strong></p>
<pre><code class="hljs language-bash" lang="bash">ç”¨æˆ·é—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™èƒ½æ”¶åˆ°è´§ï¼Ÿ
Gatewayåˆ¤æ–­ï¼šç®€å•é—®é¢˜ï¼Œä½¿ç”¨GPT-3.5
è·¯ç”±é€‰æ‹©ï¼šä½å»¶è¿Ÿæ¨¡å‹
æˆæœ¬ï¼š<span class="hljs-variable">$0</span>.0005/æ¬¡
</code></pre>
<p><strong>åœºæ™¯2ï¼šå¤æ‚é—®é¢˜è½¬äººå·¥</strong></p>
<pre><code class="hljs language-bash" lang="bash">ç”¨æˆ·é—®é¢˜ï¼šæˆ‘çš„è®¢å•å‡ºäº†é—®é¢˜ï¼Œé€€æ¬¾åä¼˜æƒ åˆ¸æ€ä¹ˆå¤„ç†ï¼Ÿ
Gatewayåˆ¤æ–­ï¼šå¤æ‚é—®é¢˜ï¼Œä½¿ç”¨GPT-4
è·¯ç”±é€‰æ‹©ï¼šé«˜è´¨é‡æ¨¡å‹
å¦‚æœæ¨¡å‹ç½®ä¿¡åº¦&lt;80%ï¼Œè½¬äººå·¥å®¢æœ
æˆæœ¬ï¼š<span class="hljs-variable">$0</span>.03/æ¬¡
</code></pre>
<p><strong>å®ç°ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * æ™ºèƒ½å®¢æœè·¯ç”±ç­–ç•¥
 */</span>
@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomerServiceRoutingStrategy</span> {

    @Autowired
    <span class="hljs-keyword">private</span> SemanticCache semanticCache;

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> List&lt;<span class="hljs-type">String</span>&gt; SIMPLE_KEYWORDS = Arrays.<span class="hljs-built_in">asList</span>(
        <span class="hljs-string">"å‘è´§"</span>, <span class="hljs-string">"ç‰©æµ"</span>, <span class="hljs-string">"é€€è´§"</span>, <span class="hljs-string">"ä»·æ ¼"</span>, <span class="hljs-string">"åº“å­˜"</span>
    );

    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> List&lt;<span class="hljs-type">String</span>&gt; COMPLEX_KEYWORDS = Arrays.<span class="hljs-built_in">asList</span>(
        <span class="hljs-string">"é€€æ¬¾"</span>, <span class="hljs-string">"æŠ•è¯‰"</span>, <span class="hljs-string">"èµ”å¿"</span>, <span class="hljs-string">"åˆåŒ"</span>, <span class="hljs-string">"æ³•å¾‹"</span>
    );

    <span class="hljs-comment">/**
     * é€‰æ‹©åˆé€‚çš„æ¨¡å‹
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">selectModel</span><span class="hljs-params">(<span class="hljs-type">String</span> userQuestion)</span> </span>{
        <span class="hljs-comment">// 1. æ£€æŸ¥ç¼“å­˜</span>
        <span class="hljs-type">String</span> cached = semanticCache.<span class="hljs-built_in">get</span>(<span class="hljs-string">"cs:model:"</span> + DigestUtils.<span class="hljs-built_in">md5DigestAsHex</span>(userQuestion.<span class="hljs-built_in">getBytes</span>()));
        <span class="hljs-keyword">if</span> (cached != null) {
            <span class="hljs-keyword">return</span> cached;
        }

        <span class="hljs-comment">// 2. åˆ¤æ–­é—®é¢˜å¤æ‚åº¦</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">containsAny</span>(userQuestion, COMPLEX_KEYWORDS)) {
            <span class="hljs-comment">// å¤æ‚é—®é¢˜ä½¿ç”¨GPT-4</span>
            semanticCache.<span class="hljs-built_in">put</span>(<span class="hljs-string">"cs:model:"</span> + DigestUtils.<span class="hljs-built_in">md5DigestAsHex</span>(userQuestion.<span class="hljs-built_in">getBytes</span>()), <span class="hljs-string">"gpt-4"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"gpt-4"</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">containsAny</span>(userQuestion, SIMPLE_KEYWORDS)) {
            <span class="hljs-comment">// ç®€å•é—®é¢˜ä½¿ç”¨GPT-3.5</span>
            semanticCache.<span class="hljs-built_in">put</span>(<span class="hljs-string">"cs:model:"</span> + DigestUtils.<span class="hljs-built_in">md5DigestAsHex</span>(userQuestion.<span class="hljs-built_in">getBytes</span>()), <span class="hljs-string">"gpt-3.5-turbo"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"gpt-3.5-turbo"</span>;
        }

        <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨GPT-3.5</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"gpt-3.5-turbo"</span>;
    }

    <span class="hljs-comment">/**
     * åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬äººå·¥
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">needsHumanAgent</span><span class="hljs-params">(<span class="hljs-type">String</span> userQuestion, <span class="hljs-type">double</span> confidence)</span> </span>{
        <span class="hljs-comment">// å¤æ‚é—®é¢˜ä¸”ç½®ä¿¡åº¦ä½ï¼Œè½¬äººå·¥</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">containsAny</span>(userQuestion, COMPLEX_KEYWORDS) &amp;&amp; confidence &lt; <span class="hljs-number">0.8</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// åŒ…å«æ•æ„Ÿè¯ï¼Œè½¬äººå·¥</span>
        List&lt;<span class="hljs-type">String</span>&gt; sensitiveWords = Arrays.<span class="hljs-built_in">asList</span>(<span class="hljs-string">"èµ·è¯‰"</span>, <span class="hljs-string">"æŠ¥è­¦"</span>, <span class="hljs-string">"æ¶ˆå"</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">containsAny</span>(userQuestion, sensitiveWords)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title">containsAny</span><span class="hljs-params">(<span class="hljs-type">String</span> text, List&lt;<span class="hljs-type">String</span>&gt; keywords)</span> </span>{
        <span class="hljs-keyword">return</span> keywords.<span class="hljs-built_in">stream</span>().<span class="hljs-built_in">anyMatch</span>(keyword -&gt; text.<span class="hljs-built_in">contains</span>(keyword));
    }
}
</code></pre>
<h3 data-id="heading-19">5.2 ä»£ç åŠ©æ‰‹æœåŠ¡</h3>
<p>æŸå¼€å‘å·¥å…·å…¬å¸ä½¿ç”¨Spring AI Gatewayæä¾›ä»£ç åŠ©æ‰‹åŠŸèƒ½ï¼š</p>
<p><strong>ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ä»£ç è¡¥å…¨ï¼šä½¿ç”¨è½»é‡çº§æ¨¡å‹ï¼Œå¿«é€Ÿå“åº”</li>
<li>ä»£ç è§£é‡Šï¼šä½¿ç”¨ä¸­ç­‰æ¨¡å‹ï¼Œå¹³è¡¡é€Ÿåº¦å’Œè´¨é‡</li>
<li>ä»£ç å®¡æŸ¥ï¼šä½¿ç”¨é«˜çº§æ¨¡å‹ï¼Œç¡®ä¿è´¨é‡</li>
</ul>
<p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">ai:</span>
  <span class="hljs-attr">gateway:</span>
    <span class="hljs-attr">routes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">code-completion</span>
        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://api.openai.com/v1/chat/completions</span>
        <span class="hljs-attr">predicates:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/api/code/complete</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">Header:X-Task-Type=completion</span>
        <span class="hljs-attr">model:</span> <span class="hljs-string">gpt-3.5-turbo</span>
        <span class="hljs-attr">max-tokens:</span> <span class="hljs-number">500</span>
        <span class="hljs-attr">timeout:</span> <span class="hljs-number">5000</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">code-explain</span>
        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://api.openai.com/v1/chat/completions</span>
        <span class="hljs-attr">predicates:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/api/code/explain</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">Header:X-Task-Type=explain</span>
        <span class="hljs-attr">model:</span> <span class="hljs-string">gpt-3.5-turbo-16k</span>
        <span class="hljs-attr">max-tokens:</span> <span class="hljs-number">2000</span>
        <span class="hljs-attr">timeout:</span> <span class="hljs-number">10000</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">code-review</span>
        <span class="hljs-attr">uri:</span> <span class="hljs-string">https://api.openai.com/v1/chat/completions</span>
        <span class="hljs-attr">predicates:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/api/code/review</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">Header:X-Task-Type=review</span>
        <span class="hljs-attr">model:</span> <span class="hljs-string">gpt-4</span>
        <span class="hljs-attr">max-tokens:</span> <span class="hljs-number">4000</span>
        <span class="hljs-attr">timeout:</span> <span class="hljs-number">30000</span>
</code></pre>
<h3 data-id="heading-20">5.3 æˆæœ¬ä¼˜åŒ–å®æˆ˜</h3>
<p>é€šè¿‡ä»¥ä¸‹ç­–ç•¥é™ä½80%çš„AIè°ƒç”¨æˆæœ¬ï¼š</p>
<p><strong>1. æ™ºèƒ½ç¼“å­˜ç­–ç•¥</strong></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- FAQé—®é¢˜å®Œå…¨ç¼“å­˜ï¼šå‘½ä¸­ç‡60%</span>
<span class="hljs-deletion">- ç›¸ä¼¼é—®é¢˜å¤ç”¨ï¼šå‘½ä¸­ç‡20%</span>
<span class="hljs-deletion">- æ€»ç¼“å­˜å‘½ä¸­ç‡ï¼š80%</span>
</code></pre>
<p><strong>2. æ¨¡å‹åˆ†å±‚ä½¿ç”¨</strong></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- 70%è¯·æ±‚ä½¿ç”¨GPT-3.5ï¼š$0.0005/1K tokens</span>
<span class="hljs-deletion">- 25%è¯·æ±‚ä½¿ç”¨GPT-4ï¼š$0.03/1K tokens</span>
<span class="hljs-deletion">- 5%è¯·æ±‚ä½¿ç”¨äººå·¥æœåŠ¡ï¼š$0</span>
<span class="hljs-deletion">- å¹³å‡æˆæœ¬é™ä½ï¼š75%</span>
</code></pre>
<p><strong>3. Tokenä¼˜åŒ–</strong></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">- Promptä¼˜åŒ–ï¼šå‡å°‘30%è¾“å…¥tokens</span>
<span class="hljs-deletion">- å“åº”å‹ç¼©ï¼šå‡å°‘20%è¾“å‡ºtokens</span>
<span class="hljs-deletion">- æ€»ä½“èŠ‚çœï¼š50% tokensä½¿ç”¨é‡</span>
</code></pre>
<p><strong>å®ç°ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * æˆæœ¬ä¼˜åŒ–è¿‡æ»¤å™¨
 */</span>
<span class="hljs-keyword">@Component</span>
<span class="hljs-keyword">@Slf</span>4j
public class CostOptimizationFilter implements GlobalFilter, Ordered {

    <span class="hljs-keyword">@Autowired</span>
    private SemanticCache semanticCache;

    <span class="hljs-keyword">@Override</span>
    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        String requestBody = exchange<span class="hljs-selector-class">.getAttribute</span>("cachedRequestBody");

        return Mono<span class="hljs-selector-class">.just</span>(requestBody)
            <span class="hljs-selector-class">.map</span>(this::optimizeRequest)
            <span class="hljs-selector-class">.map</span>(optimized -&gt; {
                exchange.getAttributes()<span class="hljs-selector-class">.put</span>("optimizedRequestBody", optimized);
                return exchange;
            })
            <span class="hljs-selector-class">.flatMap</span>(chain::filter)
            <span class="hljs-selector-class">.then</span>();
    }

    <span class="hljs-comment">/**
     * ä¼˜åŒ–è¯·æ±‚ä»¥å‡å°‘tokenä½¿ç”¨
     */</span>
    private String <span class="hljs-built_in">optimizeRequest</span>(String originalRequest) {
        try {
            ObjectMapper mapper = new <span class="hljs-built_in">ObjectMapper</span>();
            JsonNode root = mapper<span class="hljs-selector-class">.readTree</span>(originalRequest);
            ObjectNode optimized = mapper<span class="hljs-selector-class">.createObjectNode</span>();

            <span class="hljs-comment">// 1. å¤åˆ¶å¿…è¦å­—æ®µ</span>
            optimized<span class="hljs-selector-class">.put</span>("model", root.get("model")<span class="hljs-selector-class">.asText</span>());

            <span class="hljs-comment">// 2. ä¼˜åŒ–messagesï¼šç§»é™¤å†—ä½™ä¿¡æ¯</span>
            ArrayNode messages = mapper<span class="hljs-selector-class">.createArrayNode</span>();
            root<span class="hljs-selector-class">.get</span>("messages")<span class="hljs-selector-class">.forEach</span>(msg -&gt; {
                ObjectNode optimizedMsg = messages.addObject();
                optimizedMsg<span class="hljs-selector-class">.put</span>("role", msg.get("role")<span class="hljs-selector-class">.asText</span>());

                <span class="hljs-comment">// å‹ç¼©å†…å®¹</span>
                String <span class="hljs-attribute">content</span> = msg<span class="hljs-selector-class">.get</span>("content")<span class="hljs-selector-class">.asText</span>();
                optimizedMsg<span class="hljs-selector-class">.put</span>("content", compressContent(content));
            });

            <span class="hljs-comment">// 3. é™åˆ¶messagesæ•°é‡ï¼Œåªä¿ç•™æœ€è¿‘6æ¡</span>
            ArrayNode finalMessages = mapper<span class="hljs-selector-class">.createArrayNode</span>();
            int start = Math<span class="hljs-selector-class">.max</span>(<span class="hljs-number">0</span>, messages.size() - <span class="hljs-number">6</span>);
            for (int i = start; i &lt; messages.size(); <span class="hljs-selector-tag">i</span>++) {
                finalMessages<span class="hljs-selector-class">.add</span>(messages.get(i));
            }
            optimized<span class="hljs-selector-class">.set</span>("messages", finalMessages);

            <span class="hljs-comment">// 4. ä¼˜åŒ–temperature</span>
            optimized<span class="hljs-selector-class">.put</span>("temperature", Math.min(root.get("temperature")<span class="hljs-selector-class">.asDouble</span>(), <span class="hljs-number">0.7</span>));

            <span class="hljs-comment">// 5. è®¾ç½®åˆç†çš„max_tokens</span>
            optimized<span class="hljs-selector-class">.put</span>("max_tokens", Math.min(root.get("max_tokens")<span class="hljs-selector-class">.asInt</span>(), <span class="hljs-number">2000</span>));

            String result = mapper<span class="hljs-selector-class">.writeValueAsString</span>(optimized);
            log<span class="hljs-selector-class">.debug</span>("Request optimized: {} -&gt; {} bytes",
                originalRequest.length(), result<span class="hljs-selector-class">.length</span>());

            return result;
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("Request optimization failed", e);
            return originalRequest;
        }
    }

    <span class="hljs-comment">/**
     * å‹ç¼©å†…å®¹
     */</span>
    private String <span class="hljs-built_in">compressContent</span>(String content) {
        <span class="hljs-comment">// ç§»é™¤å¤šä½™ç©ºæ ¼</span>
        <span class="hljs-attribute">content</span> = <span class="hljs-attribute">content</span><span class="hljs-selector-class">.replaceAll</span>("\s+", " ")<span class="hljs-selector-class">.trim</span>();

        <span class="hljs-comment">// å¦‚æœå†…å®¹è¿‡é•¿ï¼Œè¿›è¡Œæ‘˜è¦</span>
        if (content.length() &gt; <span class="hljs-number">1000</span>) {
            <span class="hljs-attribute">content</span> = <span class="hljs-attribute">content</span><span class="hljs-selector-class">.substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">500</span>) + "...<span class="hljs-selector-attr">[çœç•¥]</span>" + <span class="hljs-attribute">content</span><span class="hljs-selector-class">.substring</span>(content.length() - <span class="hljs-number">500</span>);
        }

        return <span class="hljs-attribute">content</span>;
    }

    <span class="hljs-keyword">@Override</span>
    public int getOrder() {
        return -<span class="hljs-number">99</span>;
    }
}
</code></pre>
<h2 data-id="heading-21">å…­ã€éƒ¨ç½²å’Œæ‰©å±•</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0179e3fc16f544ad976b7d7b99bfda44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769910545&amp;x-signature=vp6AfWW%2FCP9pfoI5LEfbVGdtnAM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">6.1 Dockeréƒ¨ç½²</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">FROM</span> <span class="hljs-string">openjdk:8-jdk-alpine</span>
<span class="hljs-string">VOLUME</span> <span class="hljs-string">/tmp</span>
<span class="hljs-string">COPY</span> <span class="hljs-string">target/gateway-demo.jar</span> <span class="hljs-string">app.jar</span>
<span class="hljs-string">ENTRYPOINT</span> [<span class="hljs-string">"java"</span>,<span class="hljs-string">"-jar"</span>,<span class="hljs-string">"/app.jar"</span>]

<span class="hljs-comment"># docker-compose.yml</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">ai-gateway:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:8080"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SPRING_PROFILES_ACTIVE=prod</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">REDIS_HOST=redis</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">AI_OPENAI_API_KEY=${OPENAI_API_KEY}</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7-alpine</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"6379:6379"</span>

  <span class="hljs-attr">prometheus:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">prom/prometheus</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9090:9090"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./prometheus.yml:/etc/prometheus/prometheus.yml</span>

  <span class="hljs-attr">grafana:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">grafana/grafana</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3000:3000"</span>
</code></pre>
<h2 data-id="heading-23">ä¸ƒã€æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-24">7.1 å®‰å…¨é…ç½®</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/**
 * å®‰å…¨é…ç½®
 */</span>
<span class="hljs-keyword">@Configuration</span>
<span class="hljs-keyword">@EnableWebFluxSecurity</span>
public class SecurityConfig {

    <span class="hljs-keyword">@Bean</span>
    public SecurityWebFilterChain securityWebFilterChain(ServerHttpSecurity http) {
        return http
            <span class="hljs-selector-class">.authorizeExchange</span>()
            <span class="hljs-selector-class">.pathMatchers</span>("/actuator/**")<span class="hljs-selector-class">.hasRole</span>("ADMIN")
            <span class="hljs-selector-class">.pathMatchers</span>("/api/ai/**")<span class="hljs-selector-class">.authenticated</span>()
            <span class="hljs-selector-class">.anyExchange</span>()<span class="hljs-selector-class">.permitAll</span>()
            <span class="hljs-selector-class">.and</span>()
            <span class="hljs-selector-class">.httpBasic</span>()
            <span class="hljs-selector-class">.and</span>()
            <span class="hljs-selector-class">.csrf</span>()<span class="hljs-selector-class">.disable</span>()
            <span class="hljs-selector-class">.build</span>();
    }
}
</code></pre>
<h3 data-id="heading-25">7.2 æ€§èƒ½ä¼˜åŒ–</h3>
<ol>
<li><strong>è¿æ¥æ± é…ç½®</strong></li>
</ol>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">webflux:</span>
    <span class="hljs-attr">client:</span>
      <span class="hljs-attr">max-connections:</span> <span class="hljs-number">500</span>
      <span class="hljs-attr">max-idle-time:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">max-life-time:</span> <span class="hljs-string">5m</span>
</code></pre>
<ol>
<li><strong>ç¼“å­˜ç­–ç•¥</strong></li>
</ol>
<ul>
<li>FAQå®Œå…¨ç¼“å­˜</li>
<li>ç›¸ä¼¼é—®é¢˜å¤ç”¨</li>
<li>å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜</li>
</ul>
<h2 data-id="heading-26">å…«ã€æ€»ç»“</h2>
<p>Spring AI Gatewayä¸ºAIåº”ç”¨æä¾›äº†ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„åŸºç¡€è®¾æ–½å±‚ã€‚éšç€AIæŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒSpring AI Gatewayä¹Ÿå°†æŒç»­æ¼”è¿›ï¼Œä¸ºå¼€å‘è€…æä¾›æ›´å¥½çš„AIåº”ç”¨å¼€å‘ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®æˆ˜æ•™ç¨‹ï¼šç”¨AI SDK + Open Responses APIæ‰“é€ ä½ çš„æ–°æ—¶ä»£AIæ™ºèƒ½ä½“]]></title>    <link>https://juejin.cn/post/7598480267218698274</link>    <guid>https://juejin.cn/post/7598480267218698274</guid>    <pubDate>2026-01-25T01:59:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598480267218698274" data-draft-id="7598480267218665506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®æˆ˜æ•™ç¨‹ï¼šç”¨AI SDK + Open Responses APIæ‰“é€ ä½ çš„æ–°æ—¶ä»£AIæ™ºèƒ½ä½“"/> <meta itemprop="keywords" content="OpenAI,äººå·¥æ™ºèƒ½,AIGC"/> <meta itemprop="datePublished" content="2026-01-25T01:59:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºé’é“œä¸‰"/> <meta itemprop="url" content="https://juejin.cn/user/2942757076730455"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®æˆ˜æ•™ç¨‹ï¼šç”¨AI SDK + Open Responses APIæ‰“é€ ä½ çš„æ–°æ—¶ä»£AIæ™ºèƒ½ä½“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2942757076730455/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºé’é“œä¸‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T01:59:49.000Z" title="Sun Jan 25 2026 01:59:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯<strong>å€”å¼ºé’é“œä¸‰</strong>ã€‚æ¬¢è¿å…³æ³¨æˆ‘ï¼Œ<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šå€”å¼ºé’é“œä¸‰</strong>ã€‚æ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä¸€é”®ä¸‰è¿ï¼ï¼ï¼</p>
<h2 data-id="heading-1">å¼€å§‹ä½¿ç”¨ OpenAI Responses API</h2>
<p>éšç€ <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenresponses-cn.top%2F" target="_blank" title="https://openresponses-cn.top/" ref="nofollow noopener noreferrer">OpenAI Responses API</a> çš„å‘å¸ƒï¼Œç°åœ¨æ­£æ˜¯å¼€å§‹æ„å»º AI åº”ç”¨çš„æœ€ä½³æ—¶æœºï¼Œç‰¹åˆ«æ˜¯é‚£äº›éœ€è¦æ·±å…¥ç†è§£ä¸–ç•ŒçŸ¥è¯†çš„åº”ç”¨ã€‚</p>
<blockquote>
<p>å¦‚æœä½ è¿˜ä¸çŸ¥é“ä»€ä¹ˆæ˜¯<code>OpenAI Responses API</code>ï¼Œå¯ä»¥é˜…è¯»æˆ‘ä¹‹å‰å†™çš„ä¸€ç¯‡ä»‹ç»æ–‡ç« <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FhY2XJn5pTsydqwsJiiCn7g" target="_blank" title="https://mp.weixin.qq.com/s/hY2XJn5pTsydqwsJiiCn7g" ref="nofollow noopener noreferrer">2026å¹´AIå¼€å‘æ–°æ ‡å‡†æ¥äº†ï¼Chat Completionå·²è¿‡æ—¶ï¼ŒOpen Responsesæ¨ªç©ºå‡ºä¸–</a>äº†è§£æ›´å¤šè¯¦æƒ…ï¼</p>
</blockquote>
<blockquote>
<p>æ­¤å¤–ï¼Œæˆ‘å·²ç»å¼„äº†ä¸€ä¸ª<code>Open Responses </code>ä¸­æ–‡é•œåƒç«™ç‚¹<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenresponses-cn.top%2F" target="_blank" title="https://openresponses-cn.top/" ref="nofollow noopener noreferrer">openresponses-cn.top</a>ï¼ŒæŠŠ<code>Open Responses</code>æ–‡æ¡£è¿›è¡Œäº†ä¸­æ–‡ç¿»è¯‘ï¼Œæ–¹ä¾¿å¤§å®¶å­¦ä¹ ï¼</p>
</blockquote>
<p>AI SDK æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ TypeScript å·¥å…·åŒ…ï¼Œå¯å¸®åŠ©å¼€å‘è€…ä½¿ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ„å»º AI åº”ç”¨ï¼ŒåŒæ—¶æ”¯æŒ Reactã€Next.jsã€Vueã€Svelteã€Node.js ç­‰çƒ­é—¨æ¡†æ¶ï¼Œäº†è§£æ›´å¤šAI SDKçš„ç”¨æ³•å¯ä»¥è®¿é—®å®˜ç½‘ <a href="https://link.juejin.cn?target=https%3A%2F%2Fai-sdk.dev%2F%25E3%2580%2582" target="_blank" title="https://ai-sdk.dev/%E3%80%82" ref="nofollow noopener noreferrer">ai-sdk.dev/ã€‚</a></p>
<p>OpenAI æœ€è¿‘å‘å¸ƒäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenresponses-cn.top%2F" target="_blank" title="https://openresponses-cn.top/" ref="nofollow noopener noreferrer">OpenAI Responses API</a>ï¼Œè¿™æ˜¯åœ¨ OpenAI å¹³å°ä¸Šæ„å»ºåº”ç”¨çš„ä¸€ç§å…¨æ–°æ–¹å¼ã€‚æ–° API æä¾›äº†æŒä¹…åŒ–èŠå¤©å†å²ã€ç”¨äºå¢å¼º LLM å›ç­”å‡†ç¡®æ€§çš„ç½‘ç»œæœç´¢å·¥å…·ã€ç”¨äºæŸ¥æ‰¾ç›¸å…³æ–‡ä»¶çš„æ–‡ä»¶æœç´¢å·¥å…·ï¼Œä»¥åŠç”¨äºæ„å»ºèƒ½å¤Ÿä¸è®¡ç®—æœºäº¤äº’å’Œæ“ä½œçš„ Agent çš„è®¡ç®—æœºä½¿ç”¨å·¥å…·ã€‚è®©æˆ‘ä»¬æ¢ç´¢å¦‚ä½•ä½¿ç”¨ AI SDK æ¥ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenresponses-cn.top%2F" target="_blank" title="https://openresponses-cn.top/" ref="nofollow noopener noreferrer">OpenAI Responses API</a>ã€‚</p>
<h2 data-id="heading-2">AI SDK å…¥é—¨æŒ‡å—</h2>
<p>AI SDK æ˜¯ä¸“ä¸ºå¸®åŠ©å¼€å‘è€…ä½¿ç”¨ Reactã€Next.jsã€Vueã€Svelteã€Node.js ç­‰æ¡†æ¶æ„å»º AI é©±åŠ¨åº”ç”¨è€Œè®¾è®¡çš„ TypeScript å·¥å…·åŒ…ã€‚å°† LLM é›†æˆåˆ°åº”ç”¨ä¸­æ—¢å¤æ‚ï¼Œåˆä¸¥é‡ä¾èµ–äºä½ ä½¿ç”¨çš„ç‰¹å®šæ¨¡å‹æä¾›å•†ã€‚</p>
<p>AI SDK æŠ½è±¡äº†ä¸åŒæ¨¡å‹æä¾›å•†ä¹‹é—´çš„å·®å¼‚ï¼Œæ¶ˆé™¤äº†æ„å»ºèŠå¤©æœºå™¨äººçš„æ ·æ¿ä»£ç ï¼Œå¹¶å…è®¸ä½ è¶…è¶Šæ–‡æœ¬è¾“å‡ºï¼Œç”Ÿæˆä¸°å¯Œã€äº¤äº’å¼çš„ç»„ä»¶ã€‚</p>
<p>AI SDK çš„æ ¸å¿ƒæ˜¯ AI SDK Coreï¼Œå®ƒæä¾›ç»Ÿä¸€çš„ API æ¥è°ƒç”¨ä»»ä½• LLMã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µå°±æ˜¯ä½¿ç”¨ AI SDK é€šè¿‡æ–°çš„ Responses API è°ƒç”¨ GPT-4o æ‰€éœ€çš„å…¨éƒ¨ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;
<span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;

<span class="hljs-keyword">const</span> { text } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'è§£é‡Šé‡å­çº ç¼ çš„æ¦‚å¿µã€‚'</span>,
});
</code></pre>
<h3 data-id="heading-3">ç”Ÿæˆç»“æ„åŒ–æ•°æ®</h3>
<p>è™½ç„¶æ–‡æœ¬ç”Ÿæˆå¾ˆæœ‰ç”¨ï¼Œä½†ä½ å¯èƒ½å¸Œæœ›ç”Ÿæˆç»“æ„åŒ–çš„ JSON æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›ä»æ–‡æœ¬ä¸­æå–ä¿¡æ¯ã€åˆ†ç±»æ•°æ®æˆ–ç”Ÿæˆåˆæˆæ•°æ®ã€‚AI SDK Core æä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼ˆ<code>generateObject</code> å’Œ <code>streamObject</code>ï¼‰æ¥ç”Ÿæˆç»“æ„åŒ–æ•°æ®ï¼Œå…è®¸ä½ å°†æ¨¡å‹è¾“å‡ºé™åˆ¶ä¸ºç‰¹å®šæ¨¡å¼ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { generateObject } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;
<span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">const</span> { object } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateObject</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o'</span>),
  <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({
    <span class="hljs-attr">recipe</span>: z.<span class="hljs-title function_">object</span>({
      <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>(),
      <span class="hljs-attr">ingredients</span>: z.<span class="hljs-title function_">array</span>(z.<span class="hljs-title function_">object</span>({ <span class="hljs-attr">name</span>: z.<span class="hljs-title function_">string</span>(), <span class="hljs-attr">amount</span>: z.<span class="hljs-title function_">string</span>() })),
      <span class="hljs-attr">steps</span>: z.<span class="hljs-title function_">array</span>(z.<span class="hljs-title function_">string</span>()),
    }),
  }),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'ç”Ÿæˆä¸€ä¸ªåƒå±‚é¢é£Ÿè°±ã€‚'</span>,
});
</code></pre>
<p>æ­¤ä»£ç ç‰‡æ®µå°†ç”Ÿæˆä¸€ä¸ªç¬¦åˆæŒ‡å®š zod æ¨¡å¼çš„ç±»å‹å®‰å…¨é£Ÿè°±ã€‚</p>
<h3 data-id="heading-4">ä½¿ç”¨ AI SDK çš„å·¥å…·</h3>
<p>Responses API åŸç”Ÿæ”¯æŒå·¥å…·è°ƒç”¨ï¼Œå…è®¸å…¶ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’å¹¶æ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ AI SDK è¿›è¡Œå·¥å…·è°ƒç”¨çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { generateText, tool } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;
<span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;
<span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">const</span> { text } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'ä»Šå¤©æ—§é‡‘å±±çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ'</span>,
  <span class="hljs-attr">tools</span>: {
    <span class="hljs-attr">getWeather</span>: <span class="hljs-title function_">tool</span>({
      <span class="hljs-attr">description</span>: <span class="hljs-string">'è·å–æŸä¸ªåœ°ç‚¹çš„å¤©æ°”'</span>,
      <span class="hljs-attr">inputSchema</span>: z.<span class="hljs-title function_">object</span>({
        <span class="hljs-attr">location</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">'è¦è·å–å¤©æ°”çš„åœ°ç‚¹'</span>),
      }),
      <span class="hljs-attr">execute</span>: <span class="hljs-keyword">async</span> ({ location }) =&gt; ({
        location,
        <span class="hljs-attr">temperature</span>: <span class="hljs-number">72</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">21</span>) - <span class="hljs-number">10</span>,
      }),
    }),
  },
  <span class="hljs-attr">stopWhen</span>: <span class="hljs-title function_">stepCountIs</span>(<span class="hljs-number">5</span>), <span class="hljs-comment">// å¯ç”¨å¤šæ­¥éª¤'Agent' LLM è°ƒç”¨</span>
});
</code></pre>
<p>æ­¤ç¤ºä¾‹æ¼”ç¤ºäº† <code>stopWhen</code> å¦‚ä½•å°†å•ä¸ª LLM è°ƒç”¨è½¬æ¢ä¸º Agentã€‚<code>stopWhen: stepCountIs(5)</code> å‚æ•°å…è®¸æ¨¡å‹è‡ªä¸»è°ƒç”¨å·¥å…·ã€åˆ†æç»“æœï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œé¢å¤–çš„å·¥å…·è°ƒç”¨â€”â€”è¿™å°†åŸæœ¬ç®€å•çš„ä¸€æ¬¡æ€§å®Œæˆè½¬å˜ä¸ºæ™ºèƒ½ Agentï¼Œå¯ä»¥å°†å¤šä¸ªæ“ä½œé“¾æ¥åœ¨ä¸€èµ·ä»¥å®Œæˆå¤æ‚ä»»åŠ¡ã€‚</p>
<h3 data-id="heading-5">ç½‘ç»œæœç´¢å·¥å…·</h3>
<p>Responses API å¼•å…¥äº†ä¸€ä¸ªç”¨äºå¢å¼ºå›ç­”å‡†ç¡®æ€§çš„å†…ç½®å·¥å…·ï¼Œç§°ä¸º <code>webSearch</code>ã€‚ä½¿ç”¨æ­¤å·¥å…·ï¼Œæ¨¡å‹å¯ä»¥è®¿é—®äº’è”ç½‘ä»¥æŸ¥æ‰¾ä¸å…¶å›ç­”ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;
<span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o-mini'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'ä¸Šå‘¨æ—§é‡‘å±±å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ'</span>,
  <span class="hljs-attr">tools</span>: {
    <span class="hljs-attr">web_search_preview</span>: openai.<span class="hljs-property">tools</span>.<span class="hljs-title function_">webSearchPreview</span>(),
  },
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">text</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">sources</span>);
</code></pre>
<p><code>webSearch</code> å·¥å…·è¿˜å…è®¸ä½ æŒ‡å®šç‰¹å®šäºæŸ¥è¯¢çš„å…ƒæ•°æ®ï¼Œå¯ç”¨äºæé«˜æœç´¢ç»“æœçš„è´¨é‡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o-mini'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'ä¸Šå‘¨æ—§é‡‘å±±å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ'</span>,
  <span class="hljs-attr">tools</span>: {
    <span class="hljs-attr">web_search_preview</span>: openai.<span class="hljs-property">tools</span>.<span class="hljs-title function_">webSearchPreview</span>({
      <span class="hljs-attr">searchContextSize</span>: <span class="hljs-string">'high'</span>,
      <span class="hljs-attr">userLocation</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'approximate'</span>,
        <span class="hljs-attr">city</span>: <span class="hljs-string">'San Francisco'</span>,
        <span class="hljs-attr">region</span>: <span class="hljs-string">'California'</span>,
      },
    }),
  },
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">text</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">sources</span>);
</code></pre>
<h3 data-id="heading-6">MCP å·¥å…·</h3>
<p>Responses API è¿˜æ”¯æŒè¿æ¥åˆ°æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰æœåŠ¡å™¨ã€‚è¿™å…è®¸æ¨¡å‹è°ƒç”¨è¿œç¨‹ MCP æœåŠ¡å™¨æˆ–æœåŠ¡è¿æ¥å™¨æš´éœ²çš„å·¥å…·ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;
<span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-5-mini'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'åœ¨ç½‘ä¸Šæœç´¢æœ€æ–°çš„çº½çº¦å¸‚é•¿é€‰ä¸¾ç»“æœ'</span>,
  <span class="hljs-attr">tools</span>: {
    <span class="hljs-attr">mcp</span>: openai.<span class="hljs-property">tools</span>.<span class="hljs-title function_">mcp</span>({
      <span class="hljs-attr">serverLabel</span>: <span class="hljs-string">'web-search'</span>,
      <span class="hljs-attr">serverUrl</span>: <span class="hljs-string">'https://mcp.exa.ai/mcp'</span>,
      <span class="hljs-attr">serverDescription</span>: <span class="hljs-string">'é¢å‘ AI Agent çš„ç½‘ç»œæœç´¢ API'</span>,
    }),
  },
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">text</span>);
</code></pre>
<p>æœ‰å…³é…ç½® MCP å·¥å…·çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯ã€å·¥å…·è¿‡æ»¤å’Œè¿æ¥å™¨æ”¯æŒï¼Œè¯·å‚é˜… OpenAI æä¾›å•†æ–‡æ¡£ã€‚</p>
<h2 data-id="heading-7">ä½¿ç”¨æŒä¹…åŒ–åŠŸèƒ½</h2>
<p>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenresponses-cn.top%2F" target="_blank" title="https://openresponses-cn.top/" ref="nofollow noopener noreferrer">OpenAI Responses API</a>ï¼Œä½ å¯ä»¥è·¨è¯·æ±‚åœ¨ OpenAI ç«¯æŒä¹…åŒ–èŠå¤©å†å²ã€‚è¿™å…è®¸ä½ ä»…å‘é€ç”¨æˆ·çš„æœ€åä¸€æ¡æ¶ˆæ¯ï¼ŒOpenAI å³å¯è®¿é—®æ•´ä¸ªèŠå¤©å†å²ã€‚</p>
<p>æœ‰ä¸¤ç§é€‰é¡¹å¯ç”¨äºä½¿ç”¨æŒä¹…åŒ–åŠŸèƒ½ï¼š</p>
<h3 data-id="heading-8">ä½¿ç”¨ previousResponseId</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;
<span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;

<span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o-mini'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'å‘æ˜ä¸€ä¸ªæ–°èŠ‚æ—¥å¹¶æè¿°å…¶ä¼ ç»Ÿã€‚'</span>,
});

<span class="hljs-keyword">const</span> result2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o-mini'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'ç”¨ä¸¤å¥è¯æ€»ç»“'</span>,
  <span class="hljs-attr">providerOptions</span>: {
    <span class="hljs-attr">openai</span>: {
      <span class="hljs-attr">previousResponseId</span>: result1.<span class="hljs-property">providerMetadata</span>?.<span class="hljs-property">openai</span>.<span class="hljs-property">responseId</span> <span class="hljs-keyword">as</span> string,
    },
  },
});
</code></pre>
<h3 data-id="heading-9">ä½¿ç”¨å¯¹è¯</h3>
<p>ä½ å¯ä»¥ä½¿ç”¨å¯¹è¯ API æ¥åˆ›å»ºå¯¹è¯ã€‚</p>
<p>åˆ›å»ºå¯¹è¯åï¼Œä½ å¯ä»¥ç»§ç»­å®ƒï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;
<span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o-mini'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'ç”¨ä¸¤å¥è¯æ€»ç»“'</span>,
  <span class="hljs-attr">providerOptions</span>: {
    <span class="hljs-attr">openai</span>: {
      <span class="hljs-comment">// é€šè¿‡ OpenAI API åˆ›å»ºçš„å¯¹è¯ ID ç”¨äºç»§ç»­</span>
      <span class="hljs-attr">conversation</span>: <span class="hljs-string">'conv_123'</span>,
    },
  },
});
</code></pre>
<h2 data-id="heading-10">ä» Completions API è¿ç§»</h2>
<p>ä» OpenAI Completions APIï¼ˆé€šè¿‡ AI SDKï¼‰è¿ç§»åˆ°æ–°çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenresponses-cn.top%2F" target="_blank" title="https://openresponses-cn.top/" ref="nofollow noopener noreferrer">OpenAI Responses API</a> éå¸¸ç®€å•ã€‚è¦è¿ç§»ï¼Œåªéœ€å°†æä¾›å•†å®ä¾‹ä» <code>openai(modelId)</code> æ›´æ”¹ä¸º <code>openai.responses(modelId)</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;
<span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;

<span class="hljs-comment">// Completions API</span>
<span class="hljs-keyword">const</span> { text } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-title function_">openai</span>(<span class="hljs-string">'gpt-4o'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'è§£é‡Šé‡å­çº ç¼ çš„æ¦‚å¿µã€‚'</span>,
});

<span class="hljs-comment">// Responses API</span>
<span class="hljs-keyword">const</span> { text } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'è§£é‡Šé‡å­çº ç¼ çš„æ¦‚å¿µã€‚'</span>,
});
</code></pre>
<p>ä½¿ç”¨ Responses API æ—¶ï¼Œä¹‹å‰åœ¨æ¨¡å‹æä¾›å•†å®ä¾‹ä¸ŠæŒ‡å®šçš„ç‰¹å®šäºæä¾›å•†çš„é€‰é¡¹ç°åœ¨å·²ç§»è‡³ <code>providerOptions</code> å¯¹è±¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { generateText } <span class="hljs-keyword">from</span> <span class="hljs-string">'ai'</span>;
<span class="hljs-keyword">import</span> { openai } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ai-sdk/openai'</span>;

<span class="hljs-comment">// Completions API</span>
<span class="hljs-keyword">const</span> { text } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-title function_">openai</span>(<span class="hljs-string">'gpt-4o'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'è§£é‡Šé‡å­çº ç¼ çš„æ¦‚å¿µã€‚'</span>,
  <span class="hljs-attr">providerOptions</span>: {
    <span class="hljs-attr">openai</span>: {
      <span class="hljs-attr">parallelToolCalls</span>: <span class="hljs-literal">false</span>,
    },
  },
});

<span class="hljs-comment">// Responses API</span>
<span class="hljs-keyword">const</span> { text } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateText</span>({
  <span class="hljs-attr">model</span>: openai.<span class="hljs-title function_">responses</span>(<span class="hljs-string">'gpt-4o'</span>),
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">'è§£é‡Šé‡å­çº ç¼ çš„æ¦‚å¿µã€‚'</span>,
  <span class="hljs-attr">providerOptions</span>: {
    <span class="hljs-attr">openai</span>: {
      <span class="hljs-attr">parallelToolCalls</span>: <span class="hljs-literal">false</span>,
    },
  },
});
</code></pre>
<h2 data-id="heading-11">å¼€å§‹ä½¿ç”¨</h2>
<p>å‡†å¤‡å¥½å¼€å§‹äº†å—ï¼Ÿä»¥ä¸‹æ˜¯å¦‚ä½•å¼€å§‹çš„æ–¹æ³•ï¼š</p>
<ol>
<li>è®¿é—® ai-sdk.dev/docs æ¢ç´¢æ–‡æ¡£ï¼Œäº†è§£ AI SDK çš„å…¨éƒ¨åŠŸèƒ½ã€‚</li>
<li>æŸ¥çœ‹ ai-sdk.dev/examples ä¸Šçš„å®ç”¨ç¤ºä¾‹ï¼Œçœ‹çœ‹ SDK çš„å®é™…åº”ç”¨ï¼Œå¹¶ä¸ºä½ çš„é¡¹ç›®è·å¾—çµæ„Ÿã€‚</li>
<li>é€šè¿‡ ai-sdk.dev/docs/guides ä¸Šçš„é«˜çº§æŒ‡å—æ·±å…¥äº†è§£æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰å’Œå¤šæ¨¡æ€èŠå¤©ç­‰ä¸»é¢˜ã€‚</li>
<li>æŸ¥çœ‹ vercel.com/templates?type=ai ä¸Šå³ç”¨å‹ AI æ¨¡æ¿ã€‚</li>
</ol>
<blockquote>
<p>æˆ‘å·²ç»å¼„äº†ä¸€ä¸ª<code>Open Responses </code>ä¸­æ–‡é•œåƒç«™ç‚¹<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenresponses-cn.top%2F" target="_blank" title="https://openresponses-cn.top/" ref="nofollow noopener noreferrer">openresponses-cn.top</a>ï¼ŒæŠŠ<code>Open Responses</code>æ–‡æ¡£è¿›è¡Œäº†ä¸­æ–‡ç¿»è¯‘ï¼Œæ–¹ä¾¿å¤§å®¶å­¦ä¹ ï¼</p>
</blockquote>
<p><strong>æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼šå€”å¼ºé’é“œä¸‰ï¼Œè·å–æ›´å¤š AI è‡ªåŠ¨åŒ–å’Œå¼€å‘æŠ€å·§åˆ†äº«ï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonå¼‚æ­¥ç¼–ç¨‹ï¼šä¸ºä»€ä¹ˆ90%çš„å¼€å‘è€…éƒ½ç”¨é”™äº†è¿™3ä¸ªå…³é”®ç‚¹ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598480267218485282</link>    <guid>https://juejin.cn/post/7598480267218485282</guid>    <pubDate>2026-01-25T00:19:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598480267218485282" data-draft-id="7598588085596602408" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonå¼‚æ­¥ç¼–ç¨‹ï¼šä¸ºä»€ä¹ˆ90%çš„å¼€å‘è€…éƒ½ç”¨é”™äº†è¿™3ä¸ªå…³é”®ç‚¹ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-25T00:19:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonå¼‚æ­¥ç¼–ç¨‹ï¼šä¸ºä»€ä¹ˆ90%çš„å¼€å‘è€…éƒ½ç”¨é”™äº†è¿™3ä¸ªå…³é”®ç‚¹ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T00:19:46.000Z" title="Sun Jan 25 2026 00:19:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Pythonå¼‚æ­¥ç¼–ç¨‹ï¼šä¸ºä»€ä¹ˆ90%çš„å¼€å‘è€…éƒ½ç”¨é”™äº†è¿™3ä¸ªå…³é”®ç‚¹ï¼Ÿ</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>å¼‚æ­¥ç¼–ç¨‹å·²ç»æˆä¸ºç°ä»£Pythonå¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯åœ¨I/Oå¯†é›†å‹å’Œé«˜å¹¶å‘åœºæ™¯ä¸‹ã€‚éšç€<code>asyncio</code>åº“çš„æˆç†Ÿå’ŒPythonå¯¹å¼‚æ­¥æ”¯æŒçš„ä¸æ–­å¢å¼ºï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…å¼€å§‹å°è¯•åˆ©ç”¨å¼‚æ­¥ç¼–ç¨‹æ¥æå‡æ€§èƒ½ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œè®¸å¤šå¼€å‘è€…å¹¶æœªçœŸæ­£ç†è§£å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå¯¼è‡´ä»£ç æ•ˆç‡ä½ä¸‹ã€éš¾ä»¥ç»´æŠ¤ç”šè‡³å‡ºç°éš¾ä»¥è°ƒè¯•çš„é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨Pythonå¼‚æ­¥ç¼–ç¨‹ä¸­æœ€å®¹æ˜“è¢«è¯¯è§£æˆ–é”™è¯¯ä½¿ç”¨çš„3ä¸ªå…³é”®ç‚¹ï¼š<strong>äº‹ä»¶å¾ªç¯çš„ç†è§£ä¸ä½¿ç”¨</strong>ã€<strong>åç¨‹çš„æ­£ç¡®è°ƒåº¦</strong>ä»¥åŠ<strong>èµ„æºç®¡ç†ä¸çº¿ç¨‹å®‰å…¨</strong>ã€‚é€šè¿‡åˆ†æè¿™äº›å¸¸è§è¯¯åŒºï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°æŒæ¡å¼‚æ­¥ç¼–ç¨‹çš„ç²¾é«“ã€‚</p>
<hr/>
<h3 data-id="heading-2">1. äº‹ä»¶å¾ªç¯ï¼šä¸ä»…ä»…æ˜¯â€œåå°ä»»åŠ¡è°ƒåº¦å™¨â€</h3>
<h4 data-id="heading-3">è¯¯åŒºï¼šäº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªé»‘åŒ£å­</h4>
<p>è®¸å¤šå¼€å‘è€…å°†äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ç®€å•åœ°è§†ä¸ºä¸€ä¸ªâ€œåå°ä»»åŠ¡è°ƒåº¦å™¨â€ï¼Œè®¤ä¸ºåªè¦å°†ä»»åŠ¡ä¸¢ç»™<code>asyncio.run()</code>æˆ–<code>loop.run_until_complete()</code>å°±èƒ½è‡ªåŠ¨å®ç°å¼‚æ­¥æ‰§è¡Œã€‚è¿™ç§ç†è§£è¿‡äºè‚¤æµ…ï¼Œå¿½ç•¥äº†äº‹ä»¶å¾ªç¯çš„æ ¸å¿ƒä½œç”¨ï¼š<strong>åè°ƒå’Œç®¡ç†æ‰€æœ‰åç¨‹çš„æ‰§è¡Œé¡ºåºå’Œèµ„æºåˆ†é…</strong>ã€‚</p>
<h4 data-id="heading-4">æ·±å…¥è§£æ</h4>
<ul>
<li><strong>äº‹ä»¶å¾ªç¯çš„æœ¬è´¨</strong>ï¼šäº‹ä»¶å¾ªç¯æ˜¯å•çº¿ç¨‹çš„ï¼Œå®ƒé€šè¿‡è½®è¯¢I/Oäº‹ä»¶å’Œåç¨‹çš„çŠ¶æ€æ¥å†³å®šä¸‹ä¸€æ­¥æ‰§è¡Œå“ªä¸ªä»»åŠ¡ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯â€œéé˜»å¡â€å’Œâ€œåä½œå¼å¤šä»»åŠ¡â€ã€‚</li>
<li><strong>å¸¸è§é”™è¯¯</strong>ï¼š
<ol>
<li><strong>é˜»å¡äº‹ä»¶å¾ªç¯</strong>ï¼šåœ¨åç¨‹ä¸­è°ƒç”¨åŒæ­¥é˜»å¡æ“ä½œï¼ˆå¦‚<code>time.sleep()</code>æˆ–CPUå¯†é›†å‹è®¡ç®—ï¼‰ï¼Œå¯¼è‡´æ•´ä¸ªäº‹ä»¶å¾ªç¯è¢«å¡ä½ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨<code>await asyncio.sleep()</code>æˆ–å°†CPUå¯†é›†å‹ä»»åŠ¡äº¤ç»™<code>loop.run_in_executor()</code>ã€‚</li>
<li><strong>æ»¥ç”¨å¤šä¸ªäº‹ä»¶å¾ªç¯</strong>ï¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºå¤šä¸ªäº‹ä»¶å¾ªç¯ï¼ˆå¦‚æ‰‹åŠ¨è°ƒç”¨<code>asyncio.new_event_loop()</code>ï¼‰ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚é€šå¸¸ï¼Œä¸€ä¸ªçº¿ç¨‹åªéœ€è¦ä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚</li>
</ol>
</li>
</ul>
<h4 data-id="heading-5">æœ€ä½³å®è·µ</h4>
<ul>
<li>å§‹ç»ˆä½¿ç”¨<code>asyncio.run()</code>ä½œä¸ºå…¥å£ç‚¹ï¼ˆPython 3.7+ï¼‰ï¼Œé¿å…æ‰‹åŠ¨ç®¡ç†äº‹ä»¶å¾ªç¯çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>å¯¹äºéœ€è¦å¹¶è¡Œæ‰§è¡Œçš„I/Oæ“ä½œï¼Œä¼˜å…ˆä½¿ç”¨<code>asyncio.gather()</code>æˆ–<code>asyncio.create_task()</code>ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨æ“ä½œäº‹ä»¶å¾ªç¯ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">2. åç¨‹çš„æ­£ç¡®è°ƒåº¦ï¼šä»â€œFire-and-Forgetâ€åˆ°ç»“æ„åŒ–å¹¶å‘</h3>
<h4 data-id="heading-7">è¯¯åŒºï¼šâ€œå¯åŠ¨å³å¿˜â€çš„åç¨‹ç®¡ç†</h4>
<p>è®¸å¤šå¼€å‘è€…ä¹ æƒ¯ç›´æ¥è°ƒç”¨<code>asyncio.create_task()</code>è€Œä¸ä¿å­˜è¿”å›çš„Taskå¯¹è±¡ï¼Œå¯¼è‡´æ— æ³•è·Ÿè¸ªä»»åŠ¡çŠ¶æ€æˆ–å¤„ç†å¼‚å¸¸ã€‚è¿™ç§â€œFire-and-Forgetâ€æ¨¡å¼ä¼šå¼•å‘ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li><strong>æ— æ³•æ•è·å¼‚å¸¸</strong>ï¼šæœªè¢«ç­‰å¾…çš„Taskå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œå¯èƒ½ä¸ä¼šè§¦å‘ä»»ä½•é”™è¯¯å¤„ç†é€»è¾‘ã€‚</li>
<li><strong>èµ„æºæ³„æ¼</strong>ï¼šæœªå®Œæˆçš„ä»»åŠ¡å¯èƒ½æŒæœ‰èµ„æºï¼ˆå¦‚æ•°æ®åº“è¿æ¥ï¼‰ï¼Œä½†æ— æ³•è¢«åŠæ—¶æ¸…ç†ã€‚</li>
</ol>
<h4 data-id="heading-8">æ·±å…¥è§£æ</h4>
<ul>
<li><strong>ç»“æ„åŒ–å¹¶å‘çš„é‡è¦æ€§</strong>ï¼šå¼‚æ­¥ä»£ç åº”è¯¥åƒåŒæ­¥ä»£ç ä¸€æ ·å…·æœ‰æ˜ç¡®çš„ä»»åŠ¡è¾¹ç•Œå’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚Python 3.11å¼•å…¥çš„<code>TaskGroup</code>ï¼ˆé€šè¿‡<code>asyncio.TaskGroup</code>ï¼‰æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ã€‚</li>
<li><strong>å¸¸è§é”™è¯¯åœºæ™¯</strong>ï¼š
<ol>
<li><strong>æœªå¤„ç†çš„Taskå¼‚å¸¸</strong>ï¼šå¦‚æœä¸€ä¸ªTaskæœªè¢«æ˜¾å¼ç­‰å¾…ï¼Œå…¶å¼‚å¸¸ä¼šè¢«é™é»˜ä¸¢å¼ƒï¼ˆé™¤éè°ƒç”¨<code>.exception()</code>æˆ–<code>.result()</code>ï¼‰ã€‚</li>
<li><strong>å–æ¶ˆä¼ æ’­é—®é¢˜</strong>ï¼šç›´æ¥å–æ¶ˆçˆ¶Taskä¸ä¼šè‡ªåŠ¨å–æ¶ˆå­Taskï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†å–æ¶ˆé€»è¾‘ã€‚</li>
</ol>
</li>
</ul>
<h4 data-id="heading-9">æœ€ä½³å®è·µ</h4>
<ul>
<li>ä½¿ç”¨<code>asyncio.TaskGroup</code>ï¼ˆPython 3.11+ï¼‰æˆ–ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚<code>trio</code>ï¼‰å®ç°ç»“æ„åŒ–å¹¶å‘ï¼š
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> asyncio.TaskGroup() <span class="hljs-keyword">as</span> tg:
        tg.create_task(task1())
        tg.create_task(task2())
    <span class="hljs-comment"># æ‰€æœ‰ä»»åŠ¡å®Œæˆåç»§ç»­æ‰§è¡Œ</span>
</code></pre>
</li>
<li>å¯¹äºæ—§ç‰ˆæœ¬Pythonï¼Œè‡³å°‘è¦é€šè¿‡<code>asyncio.gather(return_exceptions=True)</code>æ•è·æ‰€æœ‰ä»»åŠ¡çš„å¼‚å¸¸ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-10">3. èµ„æºç®¡ç†ä¸çº¿ç¨‹å®‰å…¨ï¼šâ€œå¼‚æ­¥ä¸Šä¸‹æ–‡â€ä¸æ˜¯ä¸‡èƒ½çš„</h3>
<h4 data-id="heading-11">è¯¯åŒºï¼šè®¤ä¸ºå¼‚æ­¥ä»£ç å¤©ç„¶çº¿ç¨‹å®‰å…¨</h4>
<p>ç”±äºå¼‚æ­¥ç¼–ç¨‹åŸºäºåç¨‹çš„å•çº¿ç¨‹æ¨¡å‹ï¼Œè®¸å¤šå¼€å‘è€…è¯¯ä»¥ä¸ºä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ç„¶è€Œï¼Œåœ¨ä»¥ä¸‹åœºæ™¯ä¸­ä»ç„¶å­˜åœ¨é£é™©ï¼š</p>
<ol>
<li><strong>æ··åˆåŒæ­¥ä¸å¼‚æ­¥ä»£ç </strong>ï¼šä¾‹å¦‚åœ¨åç¨‹ä¸­è°ƒç”¨åŒæ­¥æ•°æ®åº“é©±åŠ¨ï¼ˆå¦‚psycopg2ï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ­»é”æˆ–ç«äº‰æ¡ä»¶ã€‚</li>
<li><strong>å…±äº«çŠ¶æ€è®¿é—®</strong>ï¼šå³ä½¿æ˜¯å•çº¿ç¨‹ç¯å¢ƒï¼Œå¦‚æœå¤šä¸ªåç¨‹åŒæ—¶ä¿®æ”¹å…±äº«å˜é‡ï¼ˆå¦‚å…¨å±€å­—å…¸ï¼‰ï¼Œä¹Ÿå¯èƒ½å› ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li>
</ol>
<h4 data-id="heading-12">æ·±å…¥è§£æ</h4>
<ul>
<li><strong>GILçš„é™åˆ¶</strong>ï¼šè™½ç„¶GILé¿å…äº†çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œï¼Œä½†åç¨‹çš„åˆ‡æ¢æ˜¯æ˜¾å¼çš„ï¼ˆé€šè¿‡<code>await</code>ï¼‰ï¼Œå› æ­¤å…±äº«çŠ¶æ€çš„ä¿®æ”¹ä»éœ€è¦åŒæ­¥æœºåˆ¶ï¼ˆå¦‚<code>asyncio.Lock</code>ï¼‰ã€‚</li>
<li><strong>å¸¸è§é™·é˜±æ¡ˆä¾‹</strong>ï¼š
<ol>
<li><strong>é˜»å¡I/Oç ´åå¼‚æ­¥æ€§</strong>ï¼šåœ¨åç¨‹ä¸­ä½¿ç”¨åŒæ­¥Rediså®¢æˆ·ç«¯ä¼šå¯¼è‡´æ•´ä¸ªäº‹ä»¶å¾ªç¯é˜»å¡ï¼›åº”æ”¹ç”¨å¼‚æ­¥å®¢æˆ·ç«¯ï¼ˆå¦‚<code>aioredis</code>ï¼‰ã€‚</li>
<li><strong>æœªå—ä¿æŠ¤çš„å…±äº«çŠ¶æ€</strong>ï¼šå³ä½¿æ˜¯æ— ç«äº‰çš„å…¨å±€å˜é‡ä¿®æ”¹ä¹Ÿéœ€è¦é”ä¿æŠ¤ï¼ˆä¾‹å¦‚è®¡æ•°å™¨é€’å¢æ“ä½œï¼‰ã€‚</li>
</ol>
</li>
</ul>
<h4 data-id="heading-13">æœ€ä½³å®è·µ</h4>
<ul>
<li><strong>ä¸¥æ ¼åˆ†ç¦»åŒæ­¥ä¸å¼‚æ­¥ä»£ç è¾¹ç•Œ</strong>ï¼šä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†åŒæ­¥ä»£ç å°è£…ä¸ºå¼‚æ­¥æ¥å£ï¼ˆå¦‚é€šè¿‡çº¿ç¨‹æ± æ‰§è¡Œï¼‰ã€‚</li>
<li><strong>æ˜¾å¼åŒæ­¥æœºåˆ¶é€‰æ‹©åŸåˆ™</strong>ï¼š
<ul>
<li><code>asyncio.Lock</code>:Â é€‚ç”¨äºå•è¿›ç¨‹å†…çš„åç¨‹é—´äº’æ–¥ã€‚</li>
<li><code>threading.Lock</code>:Â ä»…ç”¨äºä¸åŒæ­¥ä»£ç äº¤äº’çš„åœºæ™¯ã€‚</li>
<li><code>multiprocessing.Lock</code>:Â è·¨è¿›ç¨‹å…±äº«çŠ¶æ€æ—¶ä½¿ç”¨ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-14">æ€»ç»“</h3>
<p>Pythonå¼‚æ­¥ç¼–ç¨‹çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶é«˜æ•ˆå’Œéé˜»å¡çš„ç‰¹æ€§ï¼Œä½†åŒæ—¶ä¹Ÿå¯¹å¼€å‘è€…çš„è®¾è®¡èƒ½åŠ›æå‡ºäº†æ›´é«˜è¦æ±‚ã€‚æœ¬æ–‡åˆ†æçš„ä¸‰ä¸ªå…³é”®ç‚¹â€”â€”äº‹ä»¶å¾ªç¯ã€åç¨‹è°ƒåº¦å’Œèµ„æºç®¡ç†â€”â€”æ˜¯å¤§å¤šæ•°é—®é¢˜çš„æ ¹æºæ‰€åœ¨ã€‚è¦çœŸæ­£æŒæ¡å¼‚æ­¥ç¼–ç¨‹ï¼Œå¿…é¡»ç†è§£å…¶åº•å±‚åŸç†å¹¶éµå¾ªç»“æ„åŒ–å¹¶å‘çš„æœ€ä½³å®è·µï¼š</p>
<ol>
<li><strong>å°Šé‡äº‹ä»¶å¾ªç¯çš„å•çº¿ç¨‹æœ¬è´¨</strong>ï¼Œé¿å…é˜»å¡æ“ä½œã€‚</li>
<li><strong>é‡‡ç”¨ç»“æ„åŒ–å¹¶å‘æ¨¡å¼ç®¡ç†ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</li>
<li><strong>æ˜ç¡®åŒºåˆ†åŒæ­¥ä¸å¼‚æ­¥è¾¹ç•Œå¹¶æ­£ç¡®ä½¿ç”¨é”æœºåˆ¶</strong>.</li>
</ol>
<p>åªæœ‰å°†è¿™äº›åŸåˆ™èå…¥æ—¥å¸¸å¼€å‘ä¹ æƒ¯æ‰èƒ½çœŸæ­£å‘æŒ¥å‡ºPythonå¼‚æ­¥ç¼–ç¨‹çš„å…¨éƒ¨æ½œåŠ›ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ63ï¼‰å¦‚ä½•åœ¨Springä¸­é›†æˆHibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598588085596667944</link>    <guid>https://juejin.cn/post/7598588085596667944</guid>    <pubDate>2026-01-25T00:49:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598588085596667944" data-draft-id="7598588085596651560" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ63ï¼‰å¦‚ä½•åœ¨Springä¸­é›†æˆHibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-25T00:49:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ63ï¼‰å¦‚ä½•åœ¨Springä¸­é›†æˆHibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T00:49:17.000Z" title="Sun Jan 25 2026 00:49:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨Springä¸­é›†æˆHibernateé€šå¸¸æ¶‰åŠä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>æ·»åŠ å¿…è¦çš„ä¾èµ–é¡¹</strong></li>
<li><strong>é…ç½®æ•°æ®æº</strong></li>
<li><strong>é…ç½®Hibernateçš„SessionFactory</strong></li>
<li><strong>é…ç½®äº‹åŠ¡ç®¡ç†å™¨</strong></li>
<li><strong>å®šä¹‰å®ä½“ç±»å’ŒDAO</strong></li>
<li><strong>ç¼–å†™æœåŠ¡å±‚ä»£ç </strong></li>
</ol>
<p>ä¸‹é¢å°†è¯¦ç»†è¯´æ˜æ¯ä¸ªæ­¥éª¤ï¼Œå¹¶ç»“åˆä»£ç ç¤ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>
<h3 data-id="heading-0">1. æ·»åŠ å¿…è¦çš„ä¾èµ–é¡¹</h3>
<p>åœ¨ä½ çš„Maven <code>pom.xml</code> æ–‡ä»¶ä¸­æ·»åŠ Springå’ŒHibernateçš„ä¾èµ–ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Core --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring ORM --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-orm<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Hibernate Core --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.32.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Spring Transaction --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-tx<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- C3P0 Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mchange<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>c3p0<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. é…ç½®æ•°æ®æº</h3>
<p>åœ¨Springçš„Javaé…ç½®ç±»æˆ–XMLé…ç½®æ–‡ä»¶ä¸­é…ç½®æ•°æ®æºã€‚</p>
<h4 data-id="heading-2">Javaé…ç½®æ–¹å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;

<span class="hljs-keyword">import</span> javax.sql.DataSource;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> {
        <span class="hljs-type">DriverManagerDataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DriverManagerDataSource</span>();
        dataSource.setDriverClassName(<span class="hljs-string">"com.mysql.cj.jdbc.Driver"</span>);
        dataSource.setUrl(<span class="hljs-string">"jdbc:mysql://localhost:3306/mydb"</span>);
        dataSource.setUsername(<span class="hljs-string">"myuser"</span>);
        dataSource.setPassword(<span class="hljs-string">"mypassword"</span>);
        <span class="hljs-keyword">return</span> dataSource;
    }
}
</code></pre>
<h3 data-id="heading-3">3. é…ç½®Hibernateçš„SessionFactory</h3>
<p>é…ç½®Hibernateçš„<code>SessionFactory</code>ï¼ŒåŒ…æ‹¬Hibernateçš„å±æ€§å’Œæ•°æ®æºã€‚</p>
<h4 data-id="heading-4">Javaé…ç½®æ–¹å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.orm.hibernate5.LocalSessionFactoryBean;
<span class="hljs-keyword">import</span> org.springframework.orm.hibernate5.HibernateTransactionManager;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;

<span class="hljs-keyword">import</span> javax.sql.DataSource;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> LocalSessionFactoryBean <span class="hljs-title function_">sessionFactory</span><span class="hljs-params">(DataSource dataSource)</span> {
        <span class="hljs-type">LocalSessionFactoryBean</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalSessionFactoryBean</span>();
        sessionFactory.setDataSource(dataSource);
        sessionFactory.setPackagesToScan(<span class="hljs-string">"com.example.model"</span>);
        sessionFactory.setHibernateProperties(hibernateProperties());
        <span class="hljs-keyword">return</span> sessionFactory;
    }

    <span class="hljs-keyword">private</span> Properties <span class="hljs-title function_">hibernateProperties</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();
        properties.put(<span class="hljs-string">"hibernate.dialect"</span>, <span class="hljs-string">"org.hibernate.dialect.MySQL5Dialect"</span>);
        properties.put(<span class="hljs-string">"hibernate.show_sql"</span>, <span class="hljs-string">"true"</span>);
        properties.put(<span class="hljs-string">"hibernate.format_sql"</span>, <span class="hljs-string">"true"</span>);
        properties.put(<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>, <span class="hljs-string">"update"</span>);
        <span class="hljs-keyword">return</span> properties;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> HibernateTransactionManager <span class="hljs-title function_">transactionManager</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HibernateTransactionManager</span>(sessionFactory);
    }
}
</code></pre>
<h3 data-id="heading-5">4. é…ç½®äº‹åŠ¡ç®¡ç†å™¨</h3>
<p>åœ¨Springé…ç½®ä¸­å¯ç”¨äº‹åŠ¡ç®¡ç†ï¼Œå¹¶é…ç½®äº‹åŠ¡ç®¡ç†å™¨ã€‚</p>
<h4 data-id="heading-6">Javaé…ç½®æ–¹å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionConfig</span> {
    <span class="hljs-comment">// é…ç½®ç±»ä¸­å·²ç»åŒ…å«äº†äº‹åŠ¡ç®¡ç†å™¨çš„é…ç½®</span>
}
</code></pre>
<h3 data-id="heading-7">5. å®šä¹‰å®ä½“ç±»å’ŒDAO</h3>
<h4 data-id="heading-8">å®ä½“ç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-comment">// getters and setters</span>
}
</code></pre>
<h4 data-id="heading-9">DAOç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDao</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SessionFactory sessionFactory;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> {
        sessionFactory.getCurrentSession().save(user);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> sessionFactory.getCurrentSession().get(User.class, id);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory.getCurrentSession().createQuery(<span class="hljs-string">"from User"</span>, User.class).list();
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> findById(id);
        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
            sessionFactory.getCurrentSession().delete(user);
        }
    }
}
</code></pre>
<h3 data-id="heading-10">6. ç¼–å†™æœåŠ¡å±‚ä»£ç </h3>
<p>æœåŠ¡å±‚é€šå¸¸ç”¨äºå°è£…ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶è°ƒç”¨DAOå±‚æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserDao userDao;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(User user)</span> {
        userDao.save(user);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> userDao.findById(id);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> userDao.findAll();
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long id)</span> {
        userDao.delete(id);
    }
}
</code></pre>
<h3 data-id="heading-11">æµ‹è¯•</h3>
<p>å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„å•å…ƒæµ‹è¯•æ¥éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;

<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceTest</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testUserService</span><span class="hljs-params">()</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setName(<span class="hljs-string">"John Doe"</span>);
        user.setEmail(<span class="hljs-string">"john.doe@example.com"</span>);

        userService.saveUser(user);

        <span class="hljs-type">User</span> <span class="hljs-variable">retrievedUser</span> <span class="hljs-operator">=</span> userService.getUserById(user.getId());
        <span class="hljs-keyword">assert</span> retrievedUser != <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">assert</span> <span class="hljs-string">"John Doe"</span>.equals(retrievedUser.getName());
        <span class="hljs-keyword">assert</span> <span class="hljs-string">"john.doe@example.com"</span>.equals(retrievedUser.getEmail());

        userService.deleteUser(user.getId());
    }
}
</code></pre>
<p>é€šè¿‡è¿™äº›æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼Œä½ å¯ä»¥åœ¨Springä¸­æˆåŠŸé›†æˆHibernateï¼Œå¹¶è¿›è¡ŒåŸºæœ¬çš„CRUDæ“ä½œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ64ï¼‰å¦‚ä½•åœ¨Java EEä¸­ä½¿ç”¨Hibernateï¼Ÿ]]></title>    <link>https://juejin.cn/post/7598574507346886691</link>    <guid>https://juejin.cn/post/7598574507346886691</guid>    <pubDate>2026-01-25T00:50:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598574507346886691" data-draft-id="7598588085596684328" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ64ï¼‰å¦‚ä½•åœ¨Java EEä¸­ä½¿ç”¨Hibernateï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-25T00:50:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ64ï¼‰å¦‚ä½•åœ¨Java EEä¸­ä½¿ç”¨Hibernateï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T00:50:04.000Z" title="Sun Jan 25 2026 00:50:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨Java EEä¸­ä½¿ç”¨Hibernateæ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬é…ç½®é¡¹ç›®ä¾èµ–ã€è®¾ç½®æ•°æ®æºã€é…ç½®Hibernateã€å®šä¹‰å®ä½“ç±»ã€åˆ›å»ºDAOå±‚ã€åˆ›å»ºæœåŠ¡å±‚ï¼Œä»¥åŠç¼–å†™åº”ç”¨é€»è¾‘ã€‚ä¸‹é¢æ˜¯è¯¦ç»†çš„å®ç°æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼š</p>
<h3 data-id="heading-0">1. æ·»åŠ å¿…è¦çš„ä¾èµ–é¡¹</h3>
<p>åœ¨<code>pom.xml</code>æ–‡ä»¶ä¸­æ·»åŠ Hibernateã€JPAå’Œå…¶ä»–ç›¸å…³ä¾èµ–é¡¹ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Hibernate Core --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.32.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- JPA API --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.persistence<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.persistence-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- MySQL Connector --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.26<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- C3P0 Connection Pooling --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mchange<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>c3p0<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2. é…ç½®æ•°æ®æº</h3>
<p>åœ¨<code>persistence.xml</code>ä¸­é…ç½®æ•°æ®æºå’ŒHibernateå±æ€§ã€‚</p>
<h4 data-id="heading-2"><code>persistence.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">persistence</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://xmlns.jcp.org/xml/ns/persistence"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
             <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd"</span>
             <span class="hljs-attr">version</span>=<span class="hljs-string">"2.2"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">persistence-unit</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"examplePU"</span> <span class="hljs-attr">transaction-type</span>=<span class="hljs-string">"JTA"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">jta-data-source</span>&gt;</span>java:/comp/env/jdbc/MyDataSource<span class="hljs-tag">&lt;/<span class="hljs-name">jta-data-source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"org.hibernate.dialect.MySQLDialect"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"true"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"update"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">persistence-unit</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">persistence</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">3. é…ç½®Hibernateçš„SessionFactory</h3>
<p>åœ¨<code>persistence.xml</code>ä¸­å·²ç»é…ç½®äº†æ•°æ®æºå’ŒHibernateå±æ€§ï¼Œä¸éœ€è¦å†å•ç‹¬é…ç½®<code>SessionFactory</code>ã€‚</p>
<h3 data-id="heading-4">4. å®šä¹‰å®ä½“ç±»</h3>
<p>å®šä¹‰ä¸€ä¸ªç®€å•çš„å®ä½“ç±»ï¼Œä¾‹å¦‚<code>User</code>ã€‚</p>
<h4 data-id="heading-5"><code>User.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "username", nullable = false)</span>
    <span class="hljs-keyword">private</span> String username;

    <span class="hljs-meta">@Column(name = "password", nullable = false)</span>
    <span class="hljs-keyword">private</span> String password;

    <span class="hljs-comment">// Getters and Setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> username;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-built_in">this</span>.username = username;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> password;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> {
        <span class="hljs-built_in">this</span>.password = password;
    }
}
</code></pre>
<h3 data-id="heading-6">5. åˆ›å»ºDAOå±‚</h3>
<p>åˆ›å»ºä¸€ä¸ªæ•°æ®è®¿é—®å¯¹è±¡ï¼ˆDAOï¼‰ç±»ï¼Œç”¨äºè®¿é—®æ•°æ®åº“ã€‚</p>
<h4 data-id="heading-7"><code>UserDAO.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.EntityManager;
<span class="hljs-keyword">import</span> javax.persistence.PersistenceContext;
<span class="hljs-keyword">import</span> javax.transaction.Transactional;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAO</span> {

    <span class="hljs-meta">@PersistenceContext</span>
    <span class="hljs-keyword">private</span> EntityManager entityManager;

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> {
        entityManager.persist(user);
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> entityManager.find(User.class, id);
    }

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> entityManager.createQuery(<span class="hljs-string">"SELECT u FROM User u"</span>, User.class).getResultList();
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(User user)</span> {
        entityManager.merge(user);
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> findById(id);
        <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
            entityManager.remove(user);
        }
    }
}
</code></pre>
<h3 data-id="heading-8">6. åˆ›å»ºæœåŠ¡å±‚</h3>
<p>åˆ›å»ºä¸€ä¸ªæœåŠ¡ç±»ï¼Œç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h4 data-id="heading-9"><code>UserService.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.ejb.Stateless;
<span class="hljs-keyword">import</span> javax.inject.Inject;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Stateless</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-meta">@Inject</span>
    <span class="hljs-keyword">private</span> UserDAO userDAO;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createUser</span><span class="hljs-params">(User user)</span> {
        userDAO.save(user);
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> userDAO.findById(id);
    }

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">getAllUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> userDAO.findAll();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(User user)</span> {
        userDAO.update(user);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long id)</span> {
        userDAO.delete(id);
    }
}
</code></pre>
<h3 data-id="heading-10">7. ç¼–å†™åº”ç”¨é€»è¾‘</h3>
<p>åˆ©ç”¨ä¸Šè¿°æœåŠ¡ç±»æ¥ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚åœ¨Servletä¸­ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-11"><code>UserServlet.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.inject.Inject;
<span class="hljs-keyword">import</span> javax.servlet.ServletException;
<span class="hljs-keyword">import</span> javax.servlet.annotation.WebServlet;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServlet;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@WebServlet("/users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> {

    <span class="hljs-meta">@Inject</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException {
        List&lt;User&gt; users = userService.getAllUsers();
        req.setAttribute(<span class="hljs-string">"users"</span>, users);
        req.getRequestDispatcher(<span class="hljs-string">"/userList.jsp"</span>).forward(req, resp);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException {
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">"username"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">"password"</span>);

        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setUsername(username);
        user.setPassword(password);

        userService.createUser(user);

        resp.sendRedirect(req.getContextPath() + <span class="hljs-string">"/users"</span>);
    }
}
</code></pre>
<h3 data-id="heading-12">æ€»ç»“</h3>
<p>ä»¥ä¸Šæ­¥éª¤å±•ç¤ºäº†å¦‚ä½•åœ¨Java EEé¡¹ç›®ä¸­ä½¿ç”¨Hibernateï¼Œä»é…ç½®ä¾èµ–åˆ°ç¼–å†™å®Œæ•´çš„CRUDæ“ä½œã€‚é€šè¿‡éµå¾ªè¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥åœ¨Java EEåº”ç”¨ä¸­æœ‰æ•ˆåœ°åˆ©ç”¨Hibernateè¿›è¡ŒORMæ“ä½œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python å®šæ—¶ä»»åŠ¡åˆ©å™¨ï¼šBackgroundScheduler ä»å…¥é—¨åˆ°æºç ]]></title>    <link>https://juejin.cn/post/7598447519824658473</link>    <guid>https://juejin.cn/post/7598447519824658473</guid>    <pubDate>2026-01-24T16:13:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598447519824658473" data-draft-id="7598699872551829540" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python å®šæ—¶ä»»åŠ¡åˆ©å™¨ï¼šBackgroundScheduler ä»å…¥é—¨åˆ°æºç  "/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-24T16:13:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆé‡Œè°¢é¡¿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python å®šæ—¶ä»»åŠ¡åˆ©å™¨ï¼šBackgroundScheduler ä»å…¥é—¨åˆ°æºç  
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆé‡Œè°¢é¡¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T16:13:59.000Z" title="Sat Jan 24 2026 16:13:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å…³é”®è¯ï¼šAPSchedulerã€BackgroundSchedulerã€å®šæ—¶ä»»åŠ¡ã€éé˜»å¡ã€çº¿ç¨‹æ± ã€è§¦å‘å™¨ã€ä»»åŠ¡æŒä¹…åŒ–<br/>
é€‚ç”¨ç‰ˆæœ¬ï¼šAPScheduler 3.x / 4.xï¼ˆPython 3.8+ï¼‰</p>
</blockquote>
<hr/>
<ol start="0">
<li>å¼€åœº 30 ç§’<br/>
å†™ Web é¡¹ç›®æ—¶ï¼Œä½ æ˜¯ä¸æ˜¯ä¹Ÿé‡åˆ°è¿‡è¿™æ ·çš„éœ€æ±‚ï¼š</li>
</ol>
<ul>
<li>æ¯ 30 åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡ç¼“å­˜</li>
<li>æ¯å¤© 2:00 æ¸…ç†ä¸´æ—¶æ–‡ä»¶</li>
<li>ç”¨æˆ·ä¸‹å•å 15 åˆ†é’Ÿæœªæ”¯ä»˜åˆ™è‡ªåŠ¨å…³é—­è®¢å•</li>
</ul>
<p>å¦‚æœå†ç”¨ <code>while True + sleep</code> æ‰‹å†™çº¿ç¨‹ï¼Œä¸ä»…è´¹ç”µï¼Œè¿˜å®¹æ˜“ç¿»è½¦ã€‚<br/>
<code>APScheduler</code> å®˜æ–¹ç»™å‡ºçš„ã€Œåå°è°ƒåº¦å™¨ã€â€”â€”<code>BackgroundScheduler</code>ï¼Œ30 è¡Œä»£ç å°±èƒ½è®©å®šæ—¶ä»»åŠ¡åœ¨<strong>ç‹¬ç«‹çº¿ç¨‹</strong>é‡Œä¹–ä¹–è·‘ï¼Œ<strong>ä¸»çº¿ç¨‹å®Œå…¨ä¸è¢«é˜»å¡</strong>ã€‚ä»Šå¤©è¿™ç¯‡åšå®¢å¸¦ä½ ä»å®‰è£…ã€é…ç½®ã€è§¦å‘å™¨ã€æŒä¹…åŒ–ã€çº¿ç¨‹æ¨¡å‹ä¸€è·¯è®²åˆ°æºç ï¼ŒåŒ…æ•™åŒ…ä¼šã€‚</p>
<hr/>
<ol>
<li>å®‰è£… &amp; Hello World</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install apscheduler
</code></pre>
<p>æœ€å°å¯è¿è¡Œç¤ºä¾‹ï¼ˆæ¯ 3 ç§’æ‰“å°ä¸€æ¬¡æ—¶é—´ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> apscheduler.schedulers.background <span class="hljs-keyword">import</span> BackgroundScheduler
<span class="hljs-keyword">import</span> time, datetime

<span class="hljs-keyword">def</span> <span class="hljs-title function_">tick</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Tick! The time is: %s'</span> % datetime.datetime.now())

scheduler = BackgroundScheduler()
scheduler.add_job(tick, <span class="hljs-string">'interval'</span>, seconds=<span class="hljs-number">3</span>)
scheduler.start()

<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:                 <span class="hljs-comment"># ä¸»çº¿ç¨‹å®Œå…¨ç©ºé—²ï¼Œå¯ä»¥å¹²åˆ«çš„</span>
        time.sleep(<span class="hljs-number">2</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'Main thread is free...'</span>)
<span class="hljs-keyword">except</span> (KeyboardInterrupt, SystemExit):
    scheduler.shutdown()
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">Main thread <span class="hljs-keyword">is</span> free...
Tick! The time <span class="hljs-keyword">is</span>: <span class="hljs-number">2026</span><span class="hljs-number">-01</span><span class="hljs-number">-24</span> <span class="hljs-number">14</span>:<span class="hljs-number">21</span>:<span class="hljs-number">12</span>
Main thread <span class="hljs-keyword">is</span> free...
Tick! The time <span class="hljs-keyword">is</span>: <span class="hljs-number">2026</span><span class="hljs-number">-01</span><span class="hljs-number">-24</span> <span class="hljs-number">14</span>:<span class="hljs-number">21</span>:<span class="hljs-number">15</span>
...
</code></pre>
<p><strong>ç»“è®º</strong>ï¼šè°ƒåº¦ä»»åŠ¡å‘ç”Ÿåœ¨<strong>åå°çº¿ç¨‹</strong>ï¼Œä¸»çº¿ç¨‹ç»§ç»­å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå®ç°çœŸæ­£çš„ã€Œéé˜»å¡ã€ã€‚</p>
<hr/>
<ol start="2">
<li>æ¶æ„é¸Ÿç°å›¾ï¼ˆ3 å¤§æ ¸å¿ƒ + 1 ä¸ªä»“åº“ï¼‰</li>
</ol>
<pre><code class="hljs language-sql" lang="sql">â”Œ<span class="hljs-comment">--------------â”      add_job()       â”Œ-------------â”</span>
â”‚  Scheduler   â”‚<span class="hljs-comment">--------------------â–ºâ”‚ JobStore    â”‚  â† ä¿å­˜ä»»åŠ¡å…ƒæ•°æ®</span>
â”‚  (è°ƒåº¦å™¨)     â”‚                     â””<span class="hljs-comment">-------------â”˜</span>
â””<span class="hljs-comment">------â”¬-------â”˜</span>
       â”‚submit
       â–¼
â”Œ<span class="hljs-comment">--------------â”      run_job()       â”Œ-------------â”</span>
â”‚  Executor    â”‚<span class="hljs-comment">--------------------â–ºâ”‚  ä¸šåŠ¡å‡½æ•°    â”‚</span>
â”‚ (çº¿ç¨‹<span class="hljs-operator">/</span>è¿›ç¨‹æ± )  â”‚                     â””<span class="hljs-comment">-------------â”˜</span>
â””<span class="hljs-comment">--------------â”˜</span>
       â–²
       â”‚<span class="hljs-keyword">trigger</span>
â”Œ<span class="hljs-comment">--------------â”</span>
â”‚  <span class="hljs-keyword">Trigger</span>     â”‚  å†³å®šã€Œä¸‹ä¸€æ¬¡ã€ä½•æ—¶è§¦å‘
â””<span class="hljs-comment">--------------â”˜</span>
</code></pre>
<ul>
<li><strong>Scheduler</strong>ï¼šå¤§è„‘ï¼Œè´Ÿè´£ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶å¾ªç¯ã€‚</li>
<li><strong>Trigger</strong>ï¼šé—¹é’Ÿï¼Œæœ‰ä¸‰ç§å£å‘³ï¼š
<ul>
<li><code>date</code> åªé—¹ä¸€æ¬¡</li>
<li><code>interval</code> å›ºå®šé—´éš”</li>
<li><code>cron</code> ç±» Linux crontab è¡¨è¾¾å¼</li>
</ul>
</li>
<li><strong>Executor</strong>ï¼šå¹²æ´»çš„ï¼ŒæŠŠä»»åŠ¡ä¸¢è¿›<strong>çº¿ç¨‹æ± </strong>ï¼ˆé»˜è®¤ï¼‰æˆ–<strong>è¿›ç¨‹æ± </strong>ã€‚</li>
<li><strong>JobStore</strong>ï¼šä»“åº“ï¼Œé»˜è®¤æ”¾å†…å­˜ï¼Œä¹Ÿå¯æ¢æˆ MySQLã€Redisã€MongoDB å®ç°<strong>å®•æœºç»­è·‘</strong>ã€‚</li>
</ul>
<hr/>
<ol start="3">
<li>è§¦å‘å™¨æ·±åº¦æ‹†è§£</li>
</ol>
<p>3.1 dateâ€”â€”ä¸€æ¬¡æ€§ä»»åŠ¡</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> apscheduler.triggers.date <span class="hljs-keyword">import</span> DateTrigger
trigger = DateTrigger(run_date=<span class="hljs-string">'2026-02-14 15:30:00'</span>)
scheduler.add_job(tick, trigger)
</code></pre>
<p>3.2 intervalâ€”â€”å¾ªç¯é—´éš”</p>
<pre><code class="hljs language-python" lang="python">scheduler.add_job(tick, <span class="hljs-string">'interval'</span>, hours=<span class="hljs-number">2</span>, minutes=<span class="hljs-number">30</span>, seconds=<span class="hljs-number">15</span>,
                  start_date=<span class="hljs-string">'2026-01-24 14:00:00'</span>,
                  end_date=<span class="hljs-string">'2026-12-31 23:59:59'</span>)
</code></pre>
<p>3.3 cronâ€”â€”æœ€å¼ºæ—¥å†</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¯å‘¨å…­ 05:30 &amp; 20:30 è¿è¡Œ</span>
scheduler.add_job(tick, <span class="hljs-string">'cron'</span>,
                  day_of_week=<span class="hljs-string">'sat'</span>,
                  hour=<span class="hljs-string">'5,20'</span>,
                  minute=<span class="hljs-number">30</span>,
                  timezone=<span class="hljs-string">'Asia/Shanghai'</span>)
</code></pre>
<p>æ”¯æŒæ ‡å‡† crontab å†™æ³•ï¼š<code>* */3 1-5 2-6</code>ã€‚</p>
<hr/>
<ol start="4">
<li>Executorï¼šçº¿ç¨‹ or è¿›ç¨‹ï¼Ÿ<br/>
é»˜è®¤ <code>ThreadPoolExecutor(max_workers=10)</code>ï¼ŒIO å¯†é›†å‹è¶³å¤Ÿã€‚<br/>
å¦‚æœä»»åŠ¡æ˜¯ CPU å¯†é›†å‹ï¼Œæ¢è¿›ç¨‹æ± ï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> apscheduler.executors.pool <span class="hljs-keyword">import</span> ProcessPoolExecutor
executors = {
    <span class="hljs-string">'default'</span>: ProcessPoolExecutor(<span class="hljs-number">4</span>)   <span class="hljs-comment"># 4 æ ¸å¹¶è¡Œ</span>
}
scheduler = BackgroundScheduler(executors=executors)
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šè¿›ç¨‹æ± è¦æ±‚å‡½æ•°<strong>å¯åºåˆ—åŒ–</strong>ï¼Œå³åœ¨ <code>if __name__ == '__main__':</code> é‡Œå®šä¹‰ã€‚</p>
</blockquote>
<hr/>
<ol start="5">
<li>JobStoreï¼šè®©ä»»åŠ¡ã€Œé‡å¯ä¸ä¸¢ã€<br/>
å†…å­˜ä»“åº“å­˜æ”¾åœ¨ <code>dict</code>ï¼Œè¿›ç¨‹é‡å¯ç°é£çƒŸç­ã€‚<br/>
ç”Ÿäº§ç¯å¢ƒè¯·æŠŠä»»åŠ¡è½åº“ï¼Œä»¥ MySQL ä¸ºä¾‹ï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> apscheduler.jobstores.sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemyJobStore
jobstores = {
    <span class="hljs-string">'default'</span>: SQLAlchemyJobStore(url=<span class="hljs-string">'mysql+pymysql://user:pwd@127.0.0.1/apscheduler'</span>)
}
scheduler = BackgroundScheduler(jobstores=jobstores)
</code></pre>
<ul>
<li>è°ƒåº¦å™¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æŠŠæœªå®Œæˆä»»åŠ¡<strong>åŠ è½½å›æ¥</strong>ï¼›</li>
<li>é…åˆ <code>misfire_grace_time</code> å¯è¡¥å¿å› å®•æœºé”™è¿‡çš„æ‰§è¡Œã€‚</li>
</ul>
<hr/>
<ol start="6">
<li>å¸¸ç”¨é…ç½®å‚æ•°é€ŸæŸ¥è¡¨<br/>
| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|----|------|------|
| <code>coalesce</code> | å®•æœºæœŸé—´ç§¯å‹å¤šæ¬¡ï¼Œåˆå¹¶ä¸ºä¸€æ¬¡æ‰§è¡Œ | <code>coalesce=True</code> |
| <code>max_instances</code> | åŒä¸€ä»»åŠ¡å¹¶å‘å®ä¾‹æ•° | <code>max_instances=3</code> |
| <code>misfire_grace_time</code> | å®¹é”™çª—å£ï¼ˆç§’ï¼‰ | <code>misfire_grace_time=600</code> |
| <code>replace_existing</code> | é‡å¤ <code>add_job</code> æ˜¯å¦è¦†ç›– | <code>replace_existing=True</code> |</li>
</ol>
<hr/>
<ol start="7">
<li>æºç èµ°é©¬è§‚èŠ±ï¼ˆ3.10 ç‰ˆæœ¬ï¼‰<br/>
7.1 å¯åŠ¨æµç¨‹<br/>
<code>scheduler.start()</code> â†’<br/>
<code>_real_add_job()</code> å†™ JobStore â†’<br/>
<code>_main_loop()</code> åœ¨ä¸€ä¸ª<strong>å®ˆæŠ¤çº¿ç¨‹</strong>é‡Œå¾ªç¯ï¼š</li>
<li>è®¡ç®—ä¸‹ä¸€æ¬¡è§¦å‘æ—¶é—´ï¼ˆ<code>trigger.get_next_fire_time</code>ï¼‰</li>
<li>ç­‰å¾…æˆ–ç«‹å³æäº¤åˆ° Executor</li>
<li>ä»»åŠ¡æ‰§è¡Œå®Œæˆå›è°ƒ <code>_run_job_success()</code> æ›´æ–°ä¸‹æ¬¡è§¦å‘</li>
</ol>
<p>7.2 çº¿ç¨‹æ¨¡å‹</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># BackgroundScheduler ç»§æ‰¿ BaseScheduler</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BackgroundScheduler</span>(<span class="hljs-title class_ inherited__">BaseScheduler</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">self, *a, **kw</span>):
        self._main_thread = threading.Thread(target=self._main_loop, daemon=<span class="hljs-literal">True</span>)
        self._main_thread.start()
</code></pre>
<p>å®ˆæŠ¤çº¿ç¨‹æ„å‘³ç€ï¼šä¸»çº¿ç¨‹é€€å‡ºæ—¶ï¼Œè°ƒåº¦çº¿ç¨‹<strong>ä¸ä¼šé˜»æ­¢è¿›ç¨‹ç»“æŸ</strong>ï¼Œç¬¦åˆâ€œåå°â€è¯­ä¹‰ã€‚</p>
<hr/>
<ol start="8">
<li>å®æˆ˜ï¼šFlask åå°æ›´æ–°ç¼“å­˜</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> apscheduler.schedulers.background <span class="hljs-keyword">import</span> BackgroundScheduler

app = Flask(__name__)
scheduler = BackgroundScheduler()

CACHE = {}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">refresh_cache</span>():
    CACHE[<span class="hljs-string">'ts'</span>] = datetime.datetime.now().isoformat()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'[JOB] cache refreshed at'</span>, CACHE[<span class="hljs-string">'ts'</span>])

scheduler.add_job(refresh_cache, <span class="hljs-string">'interval'</span>, seconds=<span class="hljs-number">30</span>)
scheduler.start()

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():
    <span class="hljs-keyword">return</span> <span class="hljs-string">f'Cache ts: <span class="hljs-subst">{CACHE.get(<span class="hljs-string">"ts"</span>, <span class="hljs-string">"N/A"</span>)}</span>'</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run()
</code></pre>
<p>Flask ä¸»çº¿ç¨‹ä¸“æ³¨å¤„ç† HTTP è¯·æ±‚ï¼Œç¼“å­˜åˆ·æ–°åœ¨åå°æ‚„æ‚„å®Œæˆï¼Œå®Œç¾è§£è€¦ã€‚</p>
<hr/>
<ol start="9">
<li>å¸¸è§è¸©å‘ FAQ<br/>
| ç°è±¡ | åŸå›  | è§£å†³ |
|----|------|------|
| ä»»åŠ¡ä¸æ‰§è¡Œ | ä¸»çº¿ç¨‹ç¬é—´ç»“æŸ | åŠ  <code>while True</code> æˆ– <code>join()</code> |
| é‡å¤æ‰§è¡Œ | å¤šè¿›ç¨‹å¯åŠ¨æ—¶æ¯ä¸ªè¿›ç¨‹éƒ½ <code>start()</code> | ä¿è¯åªåœ¨ master è¿›ç¨‹ <code>start</code> |
| å‡½æ•°å†…æ—¥å¿—ä¸æ‰“å° | Executor çº¿ç¨‹é‡Œæœªé…ç½® logger | ç»™ APScheduler å•ç‹¬é… <code>logging</code> |
| ä¿®æ”¹ä»»åŠ¡æ—¶é—´ä¸ç”Ÿæ•ˆ | é»˜è®¤ <code>replace_existing=False</code> | <code>add_job(..., replace_existing=True)</code> |</li>
</ol>
<hr/>
<ol start="10">
<li>å°ç»“ &amp; æ€ç»´å¯¼å›¾</li>
<li>BackgroundScheduler = <strong>éé˜»å¡</strong> + <strong>çº¿ç¨‹æ± </strong> + <strong>å¯æŒä¹…åŒ–</strong></li>
<li>ä¸‰æ­¥èµ°ï¼šé€‰ Trigger â†’ é€‰ Executor â†’ é€‰ JobStore</li>
<li>ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…é…ç½®<strong>æ—¶åŒº</strong>ã€<strong>misfire_grace_time</strong> ä¸<strong>æ•°æ®åº“ä»“åº“</strong></li>
<li>æºç ç²¾é«“ï¼šå®ˆæŠ¤çº¿ç¨‹ <code>_main_loop</code> é©±åŠ¨äº‹ä»¶è¡¨ï¼ŒExecutor è´Ÿè´£ä»»åŠ¡æ‰§è¡Œ</li>
</ol>
<blockquote>
<p>æŠŠè¿™ç¯‡æ”¶è—èµ·æ¥ï¼Œä¸‹æ¬¡å†å†™ã€Œå®šæ—¶è„šæœ¬ã€æ—¶ï¼Œç›´æ¥ <code>pip install apscheduler</code>ï¼Œ30 ç§’ä¸Šçº¿ï¼Œå‡†ç‚¹ä¸‹ç­ï¼</p>
</blockquote>
<hr/>
<p>å‚è€ƒæ–‡çŒ®<br/>
51CTOã€Šä½¿ç”¨ Python BackgroundScheduler çš„å®Œæ•´æµç¨‹ã€‹<br/>
CSDNã€ŠPythonä»»åŠ¡è°ƒåº¦åº“ä¹‹apschedulerä½¿ç”¨è¯¦è§£ã€‹<br/>
CSDNã€ŠBackgroundScheduler ä½¿ç”¨åŸåˆ›ã€‹<br/>
CSDNã€ŠPythonä»»åŠ¡è°ƒåº¦æ¡†æ¶APSchedulerè¯¦è§£ã€‹<br/>
CSDNã€Špythonè°ƒåº¦æ¡†æ¶APSchedulerä½¿ç”¨è¯¦è§£ã€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.jsç¬¬äºŒåä¸‰ç« (Nexté…ç½®æ–‡ä»¶)]]></title>    <link>https://juejin.cn/post/7598614012184641563</link>    <guid>https://juejin.cn/post/7598614012184641563</guid>    <pubDate>2026-01-24T22:11:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598614012184641563" data-draft-id="7598614012184625179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.jsç¬¬äºŒåä¸‰ç« (Nexté…ç½®æ–‡ä»¶)"/> <meta itemprop="keywords" content="å‰ç«¯,Next.js"/> <meta itemprop="datePublished" content="2026-01-24T22:11:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æ»¡zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.jsç¬¬äºŒåä¸‰ç« (Nexté…ç½®æ–‡ä»¶)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æ»¡zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T22:11:22.000Z" title="Sat Jan 24 2026 22:11:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">next.config.jsé…ç½®</h2>
<p>æœ¬ç« ä¼šè®²è§£Next.jsçš„é…ç½®æ–‡ä»¶<code>next.config.js</code>çš„é…ç½®é¡¹ã€‚æ³¨ï¼šæœ¬ç« ä¸ä¼šè®²æ‰€æœ‰çš„é…ç½®é¡¹ï¼Œåªä¼šè®²ä½¿ç”¨ç‡<code>50%</code>çš„é…ç½®é¡¹ï¼Œä»¥åŠé¡¹ç›®ä¸­çœŸå®ä½¿ç”¨çš„é…ç½®é¡¹ã€‚</p>
<p>æŸ¥çœ‹å®Œæ•´ç‰ˆé…ç½®é¡¹è§‚çœ‹: <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapp%2Fapi-reference%2Fconfig%2Fnext-config-js%2FadapterPath" target="_blank" title="https://nextjs.org/docs/app/api-reference/config/next-config-js/adapterPath" ref="nofollow noopener noreferrer">next.config.jsé…ç½®</a></p>
<h4 data-id="heading-1">æ ¹æ®ä¸åŒç¯å¢ƒè¿›è¡Œé…ç½®</h4>
<p>ä¾‹å¦‚æˆ‘æƒ³åœ¨å¼€å‘ç¯å¢ƒé…ç½® XXXï¼Œæˆ–è€…ç”Ÿäº§ç¯å¢ƒé…ç½®YYYï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>next/constants</code>æ¥åˆ¤æ–­å½“å‰ç¯å¢ƒã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//Next.js next/constantså†…ç½®çš„å¸¸é‡</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PHASE_EXPORT</span> = <span class="hljs-string">"phase-export"</span>; <span class="hljs-comment">// å¯¼å‡ºé™æ€ç«™ç‚¹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PHASE_PRODUCTION_BUILD</span> = <span class="hljs-string">"phase-production-build"</span>; <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒæ„å»º</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PHASE_PRODUCTION_SERVER</span> = <span class="hljs-string">"phase-production-server"</span>; <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PHASE_DEVELOPMENT_SERVER</span> = <span class="hljs-string">"phase-development-server"</span>; <span class="hljs-comment">// å¼€å‘ç¯å¢ƒæœåŠ¡å™¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PHASE_TEST</span> = <span class="hljs-string">"phase-test"</span>; <span class="hljs-comment">// æµ‹è¯•ç¯å¢ƒ</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PHASE_INFO</span> = <span class="hljs-string">"phase-info"</span>; <span class="hljs-comment">// ä¿¡æ¯</span>
</code></pre>
<p>æˆ‘ä»¬è¦æ ¹æ®ä¸åŒç¯å¢ƒé…ç½®ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å‡½æ•°ä¸­ä¼šæ¥å—ä¸€ä¸ªå‚æ•°<code>phase</code>ï¼Œè¿™ä¸ªå‚æ•°æ˜¯Next.jsçš„ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªå‚æ•°æ¥åˆ¤æ–­å½“å‰ç¯å¢ƒã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//next.config.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">PHASE_DEVELOPMENT_SERVER</span>, <span class="hljs-variable constant_">PHASE_TYPE</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next/constants'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'next'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (<span class="hljs-attr">phase</span>: <span class="hljs-variable constant_">PHASE_TYPE</span>): <span class="hljs-function"><span class="hljs-params">NextConfig</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
     <span class="hljs-attr">reactCompiler</span>: <span class="hljs-literal">false</span>,
  }

  <span class="hljs-keyword">if</span> (phase === <span class="hljs-variable constant_">PHASE_DEVELOPMENT_SERVER</span>) {
    nextConfig.<span class="hljs-property">reactCompiler</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// å¼€å‘ç¯å¢ƒä½¿ç”¨reactCompiler</span>
  }

  <span class="hljs-comment">//if() å…¶ä»–ç¯å¢ƒ.....</span>

  <span class="hljs-keyword">return</span> nextConfig
}
</code></pre>
<h4 data-id="heading-2">Next.jsé…ç½®ç«¯å£å·</h4>
<p>è¿™æ˜¯Next.jså¾ˆè¿·çš„ä¸€ä¸ªæ“ä½œï¼Œé€šè¿‡ä¸€èˆ¬è„šæ‰‹æ¶æˆ–è€…å…¶ä»–é¡¹ç›®éƒ½ä¼šåœ¨é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ç«¯å£å·ï¼Œä½†æ˜¯Next.jså´æ²¡æœ‰ï¼Œè€Œæ˜¯åœ¨å¯åŠ¨å‘½ä»¤ä¸­è¿›è¡Œé…ç½®ã€‚(é»˜è®¤æ˜¯3000ç«¯å£)</p>
<pre><code class="hljs language-json" lang="json">  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"next dev -p 8888"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// å¼€å‘ç¯å¢ƒç«¯å£å·</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"next build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"next start -p 9999 "</span> <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒç«¯å£å·</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<h4 data-id="heading-3">Next.jså¯¼å‡ºé™æ€ç«™ç‚¹</h4>
<p>éœ€è¦åœ¨<code>next.config.js</code>æ–‡ä»¶ä¸­é…ç½®<code>output</code>ä¸º<code>export</code>ï¼Œè¡¨ç¤ºå¯¼å‡ºé™æ€ç«™ç‚¹ã€‚<code>distDir</code>è¡¨ç¤ºå¯¼å‡ºç›®å½•ï¼Œé»˜è®¤ä¸º<code>out</code>ã€‚</p>
<p>å…·ä½“ç”¨æ³•è¯·æŸ¥çœ‹: <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs-docs-henna-six.vercel.app%2Ftutorials%2Fssg" target="_blank" title="https://nextjs-docs-henna-six.vercel.app/tutorials/ssg" ref="nofollow noopener noreferrer">é™æ€å¯¼å‡ºSSG</a></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-comment">/* config options here */</span>
  <span class="hljs-attr">output</span>: <span class="hljs-string">"export"</span>, <span class="hljs-comment">// å¯¼å‡ºé™æ€ç«™ç‚¹</span>
  <span class="hljs-attr">distDir</span>: <span class="hljs-string">"dist"</span>, <span class="hljs-comment">// å¯¼å‡ºç›®å½•</span>
  <span class="hljs-attr">trailingSlash</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ·»åŠ å°¾éƒ¨æ–œæ ï¼Œç”Ÿæˆ /about/index.html è€Œä¸æ˜¯ /about.html</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<h4 data-id="heading-4">Next.jsé…ç½®å›¾ç‰‡ä¼˜åŒ–</h4>
<p>Next.js<code>Image</code>ç»„ä»¶é»˜è®¤åªå…è®¸åŠ è½½æœ¬åœ°å›¾ç‰‡ï¼Œå¦‚æœéœ€è¦åŠ è½½è¿œç¨‹å›¾ç‰‡ï¼Œéœ€è¦é…ç½®<code>next.config.js</code>æ–‡ä»¶ã€‚</p>
<p>è¯¦ç»†ç”¨æ³•è¯·æŸ¥çœ‹: <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs-docs-henna-six.vercel.app%2Ftutorials%2Fimage" target="_blank" title="https://nextjs-docs-henna-six.vercel.app/tutorials/image" ref="nofollow noopener noreferrer">å›¾ç‰‡ä¼˜åŒ–</a></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-comment">/* config options here */</span>
  <span class="hljs-attr">images</span>: {
    <span class="hljs-attr">remotePatterns</span>: [
      {
        <span class="hljs-attr">protocol</span>: <span class="hljs-string">'https'</span>, <span class="hljs-comment">// åè®®</span>
        <span class="hljs-attr">hostname</span>: <span class="hljs-string">'eo-img.521799.xyz'</span>, <span class="hljs-comment">// ä¸»æœºå</span>
        <span class="hljs-attr">pathname</span>: <span class="hljs-string">'/i/pc/**'</span>, <span class="hljs-comment">// è·¯å¾„</span>
        <span class="hljs-attr">port</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// ç«¯å£</span>
      },
    ],
    <span class="hljs-attr">formats</span>: [<span class="hljs-string">'image/avif'</span>, <span class="hljs-string">'image/webp'</span>], <span class="hljs-comment">//é»˜è®¤æ˜¯ ['image/webp']</span>
    <span class="hljs-attr">deviceSizes</span>: [<span class="hljs-number">640</span>, <span class="hljs-number">750</span>, <span class="hljs-number">828</span>, <span class="hljs-number">1080</span>, <span class="hljs-number">1200</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">2048</span>, <span class="hljs-number">3840</span>], <span class="hljs-comment">// è®¾å¤‡å°ºå¯¸</span>
    <span class="hljs-attr">imageSizes</span>: [<span class="hljs-number">16</span>, <span class="hljs-number">32</span>, <span class="hljs-number">48</span>, <span class="hljs-number">64</span>, <span class="hljs-number">96</span>, <span class="hljs-number">128</span>, <span class="hljs-number">256</span>, <span class="hljs-number">384</span>], <span class="hljs-comment">// å›¾ç‰‡å°ºå¯¸</span>
  },
};
</code></pre>
<h4 data-id="heading-5">è‡ªå®šä¹‰å“åº”æ ‡å¤´</h4>
<p>ä¾‹å¦‚é…ç½®<code>CORS</code>è·¨åŸŸï¼Œæˆ–è€…æ˜¯è‡ªå®šä¹‰å“åº”æ ‡å¤´ç­‰ï¼Œåªè¦æ˜¯httpæ”¯æŒçš„å“åº”å¤´éƒ½å¯ä»¥é…ç½®ã€‚</p>
<p>HTTPå“åº”å¤´å‚è€ƒ: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FHTTP%2FHeaders" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers" ref="nofollow noopener noreferrer">HTTPå“åº”å¤´</a></p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
     <span class="hljs-attr">headers</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> [
         {
          <span class="hljs-attr">source</span>: <span class="hljs-string">'/:path*'</span>, <span class="hljs-comment">// åŒ¹é…è·¯å¾„ æ‰€æœ‰è·¯å¾„ ä¹Ÿæ”¯æŒç²¾å‡†åŒ¹é… ä¾‹å¦‚/api/user åŒ…æ‹¬æ”¯æŒåŠ¨æ€è·¯ç”±ç­‰ /api/user/:id </span>
          <span class="hljs-attr">headers</span>: [
            {
              <span class="hljs-attr">key</span>: <span class="hljs-string">'Access-Control-Allow-Origin'</span>, <span class="hljs-comment">//å…è®¸è·¨åŸŸ</span>
              <span class="hljs-attr">value</span>: <span class="hljs-string">'*'</span> <span class="hljs-comment">// å…è®¸æ‰€æœ‰åŸŸåè®¿é—®</span>
            },
            {
              <span class="hljs-attr">key</span>: <span class="hljs-string">'Access-Control-Allow-Methods'</span>, <span class="hljs-comment">//å…è®¸çš„è¯·æ±‚æ–¹æ³•</span>
              <span class="hljs-attr">value</span>: <span class="hljs-string">'GET, POST, PUT, DELETE, OPTIONS'</span> <span class="hljs-comment">// å…è®¸çš„è¯·æ±‚æ–¹æ³•</span>
            },
            {
              <span class="hljs-attr">key</span>: <span class="hljs-string">'Access-Control-Allow-Headers'</span>, <span class="hljs-comment">//å…è®¸çš„è¯·æ±‚å¤´</span>
              <span class="hljs-attr">value</span>: <span class="hljs-string">'Content-Type, Authorization'</span> <span class="hljs-comment">// å…è®¸çš„è¯·æ±‚å¤´</span>
            }
          ]
         },
         {
          <span class="hljs-attr">source</span>: <span class="hljs-string">'/home'</span>, <span class="hljs-comment">// ç²¾å‡†åŒ¹é… /home è·¯å¾„</span>
          <span class="hljs-attr">headers</span>: [
            {
              <span class="hljs-attr">key</span>: <span class="hljs-string">'X-Custom-Header'</span>, <span class="hljs-comment">//è‡ªå®šä¹‰å“åº”å¤´</span>
              <span class="hljs-attr">value</span>: <span class="hljs-string">'123456'</span> <span class="hljs-comment">// å€¼</span>
            },
          ]
         }
      ]
    }
  }
</code></pre>
<h4 data-id="heading-6">assetsPrefixé…ç½®</h4>
<p>assetsPrefixé…ç½®ç”¨äºé…ç½®é™æ€èµ„æºå‰ç¼€ï¼Œä¾‹å¦‚ï¼šéƒ¨ç½²åˆ°CDNåï¼Œé™æ€èµ„æºè·¯å¾„ä¼šå‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦é…ç½®è¿™ä¸ªé…ç½®é¡¹ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-comment">/* config options here */</span>
  <span class="hljs-attr">assetsPrefix</span>: <span class="hljs-string">'https://cdn.example.com'</span>, <span class="hljs-comment">// é™æ€èµ„æºå‰ç¼€</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<p>æœªé…ç½®assetsPrefixæ—¶ï¼š</p>
<pre><code class="hljs language-txt" lang="txt">/_next/static/chunks/4b9b41aaa062cbbfeff4add70f256968c51ece5d.4d708494b3aed70c04f0.js
</code></pre>
<p>é…ç½®assetsPrefixåï¼š</p>
<pre><code class="hljs language-txt" lang="txt">https://cdn.example.com/_next/static/chunks/4b9b41aaa062cbbfeff4add70f256968c51ece5d.4d708494b3aed70c04f0.js
</code></pre>
<h4 data-id="heading-7">basePathé…ç½®</h4>
<p>åº”ç”¨å‰ç¼€ï¼šä¹Ÿå°±æ˜¯è·³è½¬è·¯å¾„ä¸­å¢åŠ å‰ç¼€ï¼Œä¾‹å¦‚å‰ç¼€æ˜¯<code>/docs</code>ï¼Œé‚£ä¹ˆè·³è½¬<code>/home</code>å°±éœ€è¦è·³è½¬åˆ°<code>/docs/home</code>ã€‚è®¿é—®æ ¹ç›®å½•ä¹Ÿéœ€è¦å¢åŠ å‰ç¼€ï¼Œä¾‹å¦‚è®¿é—®<code>/</code>å°±éœ€è¦è·³è½¬åˆ°<code>/docs</code>ã€‚è¿™å„¿å¯ä»¥ä½¿ç”¨é‡å®šå‘æ¥å®ç°ã€‚è®¿é—®<code>/</code>è‡ªåŠ¨è·³è½¬åˆ°<code>/docs</code>ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-comment">/* config options here */</span>
  <span class="hljs-attr">basePath</span>: <span class="hljs-string">'/docs'</span>, <span class="hljs-comment">// åŸºç¡€è·¯å¾„</span>
  <span class="hljs-title function_">redirects</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> [
      {
        <span class="hljs-attr">source</span>: <span class="hljs-string">'/'</span>, <span class="hljs-comment">// æºè·¯å¾„</span>
        <span class="hljs-attr">destination</span>: <span class="hljs-string">'/docs'</span>, <span class="hljs-comment">// ç›®æ ‡è·¯å¾„</span>
        <span class="hljs-attr">basePath</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// æ˜¯å¦ä½¿ç”¨basePath é»˜è®¤æƒ…å†µä¸‹ source å’Œ destination éƒ½ä¼šè‡ªåŠ¨åŠ ä¸Š basePath å‰ç¼€ å°±å˜æˆäº†/docs/docs æ‰€ä»¥è¿™å„¿ä¸éœ€è¦å¢åŠ </span>
        <span class="hljs-attr">permanent</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// æ˜¯å¦æ°¸ä¹…é‡å®šå‘</span>
      },
    ]
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<p>å¦‚æœä½¿ç”¨linkè·³è½¬çš„è¯ï¼Œæ— éœ€å¢åŠ <code>basePath</code>å‰ç¼€ï¼Œå› ä¸º<code>Link</code>ç»„ä»¶ä¼šè‡ªåŠ¨å¢åŠ <code>basePath</code>å‰ç¼€ã€‚
å½“ä»–è·³è½¬<code>/home</code>æ—¶ï¼Œä¼šè‡ªåŠ¨è·³è½¬åˆ°<code>/docs/home</code>ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Link</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'next/link'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>å°æ»¡zs Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/home"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)
}
</code></pre>
<h4 data-id="heading-8">compress</h4>
<p>compressé…ç½®ç”¨äºé…ç½®å‹ç¼©ï¼Œä¾‹å¦‚ï¼šå‹ç¼©js/css/htmlç­‰ã€‚é»˜è®¤æƒ…å†µæ˜¯å¼€å¯çš„ï¼Œå¦‚æœéœ€è¦å…³é—­ï¼Œå¯ä»¥é…ç½®ä¸ºfalseã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-attr">compress</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å‹ç¼©</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<h4 data-id="heading-9">æ—¥å¿—é…ç½®</h4>
<p>æ—¥å¿—é…ç½®ç”¨äºé…ç½®æ—¥å¿—ï¼Œä¾‹å¦‚ï¼šæ˜¾ç¤ºå®Œæ•´çš„URLç­‰ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-attr">logging</span>:{
    <span class="hljs-attr">fetches</span>: {
      <span class="hljs-attr">fullUrl</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¾ç¤ºå®Œæ•´çš„URL</span>
    },
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<h4 data-id="heading-10">é¡µé¢æ‰©å±•</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒNext.js æ¥å—ä»¥ä¸‹æ‰©å±•åçš„æ–‡ä»¶ï¼š.tsx.jsã€ .js .tsã€.jsx.mdã€.js.jsã€‚å¯ä»¥ä¿®æ”¹æ­¤è®¾ç½®ä»¥å…è®¸å…¶ä»–æ‰©å±•åï¼Œä¾‹å¦‚ markdownï¼ˆ.md.mdã€.md .mdxï¼‰ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-attr">pageExtensions</span>: [<span class="hljs-string">'js'</span>, <span class="hljs-string">'jsx'</span>, <span class="hljs-string">'md'</span>, <span class="hljs-string">'mdx'</span>, <span class="hljs-string">'ts'</span>, <span class="hljs-string">'tsx'</span>],
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<h4 data-id="heading-11">devIndicators</h4>
<p>å…³é—­è°ƒè¯•æŒ‡ç¤ºå™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å¼€å¯çš„ï¼Œå¦‚æœéœ€è¦å…³é—­ï¼Œå¯ä»¥é…ç½®ä¸ºfalseã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-attr">devIndicators</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å…³é—­å¼€å‘æŒ‡ç¤ºå™¨</span>
  <span class="hljs-comment">// devIndicators:{</span>
  <span class="hljs-comment">//   position:'bottom-right', //ä¹Ÿæ”¯æŒæ”¾å…¥å…¶ä»–ä½ç½® bottom-right bottom-left top-right top-left</span>
  <span class="hljs-comment">// },</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/365f45aca6c6429b98777ed11d5c453f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769897482&amp;x-signature=ImE2PAFfzWSnHx9mdvRAW4srFnw%3D" alt="image.png" width="100%" loading="lazy"/>
<h4 data-id="heading-12">generateEtags</h4>
<p>Next.jsä¼šä¸ºé™æ€æ–‡ä»¶ç”ŸæˆETagï¼Œç”¨äºç¼“å­˜æ§åˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼€å¯çš„ï¼Œå¦‚æœéœ€è¦å…³é—­ï¼Œå¯ä»¥é…ç½®ä¸ºfalseã€‚</p>
<p>æµè§ˆå™¨ä¼šæ ¹æ®ETagæ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œåˆ™é‡æ–°ä¸‹è½½æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-attr">generateEtags</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å…³é—­ç”ŸæˆETag é»˜è®¤å¼€å¯</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<h4 data-id="heading-13">turbopack</h4>
<p>Next.jså·²å†…ç½®turbopackè¿›è¡Œæ‰“åŒ…ç¼–è¯‘ç­‰æ“ä½œï¼Œæ‰€ä»¥å…è®¸é€ä¼ é…ç½®é¡¹ç»™turbopackã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸éœ€è¦åšå¤ªå¤šä¼˜åŒ–çš„ï¼Œå› ä¸ºå®ƒéƒ½å†…ç½®äº†ä¾‹å¦‚<code>tree-shaking</code>ã€<code>å‹ç¼©</code> <code>æŒ‰éœ€ç¼–è¯‘</code> <code>è¯­æ³•é™çº§</code> ç­‰ä¼˜åŒ–ã€‚</p>
<p>å…·ä½“ç”¨æ³•è¯·æŸ¥çœ‹: <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapp%2Fapi-reference%2Fconfig%2Fnext-config-js%2Fturbopack" target="_blank" title="https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack" ref="nofollow noopener noreferrer">turbopack</a></p>
<p>ä¾‹å¦‚æˆ‘ä»¬éœ€è¦ç¼–è¯‘å…¶ä»–æ–‡ä»¶<code>less</code>é…ç½®å¦‚ä¸‹:</p>
<pre><code class="hljs language-bash" lang="bash">npm i less-loader -D
</code></pre>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
    <span class="hljs-attr">turbopack</span>:{
     <span class="hljs-attr">rules</span>:{
          <span class="hljs-string">'*.less'</span>:{
          <span class="hljs-attr">loaders</span>:[<span class="hljs-string">'less-loader'</span>],
          <span class="hljs-attr">as</span>:<span class="hljs-string">'*.css'</span>,
        }
     }
  }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS å¸¸ç”¨è°ƒè¯•å·¥å…·å¤§å…¨-æ‰“é€ ä½ çš„è°ƒè¯•æ­¦å™¨åº“]]></title>    <link>https://juejin.cn/post/7598712670153883657</link>    <guid>https://juejin.cn/post/7598712670153883657</guid>    <pubDate>2026-01-24T16:55:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598712670153883657" data-draft-id="7598333055544623144" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS å¸¸ç”¨è°ƒè¯•å·¥å…·å¤§å…¨-æ‰“é€ ä½ çš„è°ƒè¯•æ­¦å™¨åº“"/> <meta itemprop="keywords" content="Debug"/> <meta itemprop="datePublished" content="2026-01-24T16:55:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sweetä¸¶"/> <meta itemprop="url" content="https://juejin.cn/user/3227821869921646"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS å¸¸ç”¨è°ƒè¯•å·¥å…·å¤§å…¨-æ‰“é€ ä½ çš„è°ƒè¯•æ­¦å™¨åº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821869921646/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sweetä¸¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T16:55:17.000Z" title="Sat Jan 24 2026 16:55:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿˜è®°å¾—ä½ ç¬¬ä¸€æ¬¡ä½¿ç”¨<code>NSLog(@"Hello, World!")</code>çš„æ—¶åˆ»å—ï¼Ÿé‚£æ˜¯è°ƒè¯•çš„èµ·ç‚¹ã€‚ä½†éšç€åº”ç”¨å¤æ‚åº¦å‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œæˆ‘ä»¬éœ€è¦çš„å·¥å…·ä¹Ÿç»å†äº†é©å‘½æ€§è¿›åŒ–ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€ä»£</strong>ï¼šåŸºç¡€è¾“å‡ºï¼ˆ<code>NSLog</code>ã€<code>print</code>ï¼‰</li>
<li><strong>ç¬¬äºŒä»£</strong>ï¼šå›¾å½¢åŒ–ç•Œé¢ï¼ˆXcodeè°ƒè¯•å™¨ã€Instrumentsï¼‰</li>
<li><strong>ç¬¬ä¸‰ä»£</strong>ï¼šè¿è¡Œæ—¶åŠ¨æ€è°ƒè¯•ï¼ˆFLEXã€Lookinï¼‰</li>
<li><strong>ç¬¬å››ä»£</strong>ï¼šæ™ºèƒ½åŒ–ç›‘æ§ï¼ˆæ€§èƒ½è¿½è¸ªã€è‡ªåŠ¨åŒ–æ£€æµ‹ï¼‰</li>
</ul>
<p>ä»Šå¤©ï¼Œä¸€ä¸ªæˆç†Ÿçš„iOSå¼€å‘è€…å·¥å…·ç®±ä¸­ï¼Œ<strong>è‡³å°‘éœ€è¦æŒæ¡3-5ç§æ ¸å¿ƒè°ƒè¯•å·¥å…·</strong>ï¼Œå®ƒä»¬å°±åƒå¤–ç§‘åŒ»ç”Ÿçš„æ‰‹æœ¯åˆ€â€”â€”ç²¾å‡†ã€é«˜æ•ˆã€å„æœ‰æ‰€é•¿ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€è¿è¡Œæ—¶è°ƒè¯•å·¥å…·</h2>
<h3 data-id="heading-1"><strong>1. FLEX (Flipboard Explorer)</strong></h3>
<p>åŠŸèƒ½æœ€å…¨çš„è¿è¡Œæ—¶è°ƒè¯•å¥—ä»¶ï¼Œé›†æˆåå¯ä»¥æµ‹è¯•æœŸé—´éšæ—¶å¼€å¯\å…³é—­å·¥å…·æ¡ï¼Œæ¯”å¦‚è®¾ç½®æ‘‡ä¸€æ‘‡åå¯åŠ¨ã€‚</p>
<pre><code class="hljs language-swift" lang="swift">ä¼˜ç‚¹: åŠŸèƒ½å…¨é¢ï¼Œæ— éœ€è¿æ¥ç”µè„‘
ç¼ºç‚¹: å†…å­˜å ç”¨ç¨å¤§
åœºæ™¯: æ—¥å¸¸å¼€å‘è°ƒè¯•<span class="hljs-operator">ã€</span><span class="hljs-type">UIé—®é¢˜æ’æŸ¥</span>
<span class="hljs-type">GitHub</span>: https:<span class="hljs-comment">//github.com/FLEXTool/FLEX?tab=readme-ov-file</span>
</code></pre>
<p>ä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li>æ‰‹æœºä¸Šæ£€æŸ¥å’Œä¿®æ”¹å±‚æ¬¡ç»“æ„ä¸­çš„è§†å›¾ã€‚</li>
<li>æŸ¥çœ‹å¯¹è±¡å†…å­˜åˆ†é…ï¼ŒæŸ¥çœ‹ä»»ä½•å¯¹è±¡çš„å±æ€§å’Œivarï¼ŒåŠ¨æ€ä¿®æ”¹è®¸å¤šå±æ€§å’Œivarï¼ŒåŠ¨æ€è°ƒç”¨å®ä¾‹å’Œç±»æ–¹æ³•ã€‚</li>
<li>æŸ¥çœ‹è¯¦ç»†çš„ç½‘ç»œè¯·æ±‚å†å²è®°å½•ï¼ŒåŒ…æ‹¬æ—¶é—´ã€æ ‡å¤´å’Œå®Œæ•´å“åº”ã€‚</li>
<li>æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—æ¶ˆæ¯ï¼ˆä¾‹å¦‚ï¼Œæ¥è‡ªNSLogï¼‰ã€‚</li>
<li>æŸ¥çœ‹æ²™ç›’ä¸­çš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹æ‰€æœ‰çš„bundleå’Œèµ„æºæ–‡ä»¶ï¼Œæµè§ˆæ–‡ä»¶ç³»ç»Ÿä¸­çš„SQLite/Rermæ•°æ®åº“ã€‚</li>
<li>åŠ¨æ€æŸ¥çœ‹å’Œä¿®æ”¹NSUserDefaultså€¼ã€‚</li>
</ul>
<h3 data-id="heading-2"><strong>2. Lookin</strong> - <strong>è…¾è®¯å‡ºå“</strong></h3>
<p>3Dè§†å›¾å±‚çº§å·¥å…·ï¼Œç±»Xcode Inspectorå’ŒRevealã€‚ç›¸æ¯”Xcodeä¸­æŸ¥çœ‹å›¾å±‚çš„ä¼˜åŠ¿æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>ç‹¬ç«‹äºXcodeè¿è¡Œï¼Œä¸ä¼šè¢«Xcodeé˜»æ–­ï¼Œèƒ½æ˜¾ç¤ºviewçš„è¢«å¼•ç”¨çš„å±æ€§åã€‚</li>
<li>é›†æˆäº†'LookinServer'åº“çš„APPå¯åŠ¨åï¼Œåœ¨Macä¸Šå¯åŠ¨<code>Lookin</code>åå³å¯åˆ·æ–°æ˜¾ç¤ºå½“å‰å›¾å±‚ã€‚ï¼ˆçœŸæœºéœ€è¿æ¥ç”µè„‘åæ‰å±•ç¤ºï¼‰</li>
</ul>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// é›†æˆæ­¥éª¤ä¸€ï¼šå®˜ç½‘ä¸‹è½½lookinï¼›</span>
<span class="hljs-operator">-</span>  å®˜ç½‘: https:<span class="hljs-comment">//lookin.work</span>
<span class="hljs-operator">-</span>  <span class="hljs-type">GitHub</span>: https:<span class="hljs-comment">//github.com/QMUI/LookinServer</span>

<span class="hljs-comment">// é›†æˆæ­¥éª¤äºŒï¼š</span>
<span class="hljs-type">CocoaPodså®‰è£…</span>:
<span class="hljs-comment">// 1.å¦‚æœæ˜¯OCå·¥ç¨‹</span>
pod '<span class="hljs-type">LookinServer</span>', :configurations <span class="hljs-operator">=&gt;</span> ['<span class="hljs-type">Debug</span>']
<span class="hljs-comment">// 2.å¦‚æœæ˜¯OCå·¥ç¨‹</span>
<span class="hljs-comment">// åœ¨ iOS é¡¹ç›®çš„ Podfile ä¸­ æ·»åŠ  â€œSwiftâ€ è¿™ä¸ª Subspec</span>
pod '<span class="hljs-type">LookinServer</span>', :subspecs <span class="hljs-operator">=&gt;</span> ['<span class="hljs-type">Swift</span>'], :configurations <span class="hljs-operator">=&gt;</span> ['<span class="hljs-type">Debug</span>']
<span class="hljs-comment">// æˆ–è€…æ·»åŠ  â€œSwiftAndNoHookâ€è¿™ä¸ª Subspec ä¹Ÿè¡Œ</span>
pod '<span class="hljs-type">LookinServer</span>', :subspecs <span class="hljs-operator">=&gt;</span> ['<span class="hljs-type">SwiftAndNoHook</span>'], :configurations <span class="hljs-operator">=&gt;</span> ['<span class="hljs-type">Debug</span>']

</code></pre>
<h2 data-id="heading-3">äºŒã€ç½‘ç»œè°ƒè¯•å·¥å…·</h2>
<h3 data-id="heading-4"><strong>1. Proxyman</strong> - <strong>ç°ä»£ç½‘ç»œè°ƒè¯•ç¥å™¨</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// å®˜ç½‘: https://proxyman.io</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> ç°ä»£<span class="hljs-type">UIï¼Œæ“ä½œæµç•…</span>
<span class="hljs-operator">âœ…</span> <span class="hljs-type">HTTPSè§£å¯†ï¼ˆæ— éœ€å®‰è£…è¯ä¹¦åˆ°ç³»ç»Ÿï¼‰</span>
<span class="hljs-operator">âœ…</span> é‡æ”¾<span class="hljs-operator">ã€</span>ä¿®æ”¹<span class="hljs-operator">ã€</span>æ‹¦æˆªè¯·æ±‚
<span class="hljs-operator">âœ…</span> <span class="hljs-type">Map</span> <span class="hljs-type">Local</span><span class="hljs-operator">/</span><span class="hljs-type">Map</span> <span class="hljs-type">RemoteåŠŸèƒ½</span>
<span class="hljs-operator">âœ…</span> è„šæœ¬æ”¯æŒï¼ˆ<span class="hljs-type">JavaScriptï¼‰</span>
<span class="hljs-operator">âœ…</span> æ”¯æŒ<span class="hljs-type">Apple</span> <span class="hljs-type">Silicon</span>

ä½¿ç”¨åœºæ™¯:
<span class="hljs-operator">â€¢</span> <span class="hljs-type">APIæ¥å£è°ƒè¯•</span>
<span class="hljs-operator">â€¢</span> å›¾ç‰‡<span class="hljs-operator">/</span>èµ„æºè¯·æ±‚ä¼˜åŒ–
<span class="hljs-operator">â€¢</span> æ¨¡æ‹Ÿæ…¢é€Ÿç½‘ç»œ
<span class="hljs-operator">â€¢</span> ä¿®æ”¹å“åº”æ•°æ®æµ‹è¯•
</code></pre>
<h3 data-id="heading-5"><strong>2. Charles</strong> - <strong>è€ç‰Œç½‘ç»œä»£ç†</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// å®˜ç½‘: https://www.charlesproxy.com</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> åŠŸèƒ½æå…¶å…¨é¢
<span class="hljs-operator">âœ…</span> è·¨å¹³å°æ”¯æŒ
<span class="hljs-operator">âœ…</span> è„šæœ¬åŠŸèƒ½å¼ºå¤§ï¼ˆ<span class="hljs-type">Charles</span> <span class="hljs-type">Proxy</span> <span class="hljs-type">Scriptï¼‰</span>
<span class="hljs-operator">âœ…</span> å¸¦å®½é™åˆ¶<span class="hljs-operator">ã€</span>æ–­ç‚¹è°ƒè¯•
<span class="hljs-operator">âœ…</span> æ”¯æŒ<span class="hljs-type">HTTP</span><span class="hljs-operator">/</span><span class="hljs-number">2</span><span class="hljs-operator">ã€</span><span class="hljs-type">HTTP</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>

è®¾ç½®æ­¥éª¤:
<span class="hljs-number">1</span>. å®‰è£…<span class="hljs-type">Charles</span>
<span class="hljs-number">2</span>. åœ¨iOSè®¾å¤‡è®¾ç½®ä»£ç†
<span class="hljs-number">3</span>. å®‰è£…<span class="hljs-type">Charlesæ ¹è¯ä¹¦</span>
<span class="hljs-number">4</span>. ä¿¡ä»»è¯ä¹¦ï¼ˆè®¾ç½®<span class="hljs-operator">â†’</span>é€šç”¨<span class="hljs-operator">â†’</span>å…³äº<span class="hljs-operator">â†’</span>è¯ä¹¦ä¿¡ä»»è®¾ç½®ï¼‰

<span class="hljs-comment">// å¸¸ç”¨åŠŸèƒ½:</span>
<span class="hljs-operator">â€¢</span> <span class="hljs-type">Breakpointsï¼ˆè¯·æ±‚æ‹¦æˆªä¿®æ”¹ï¼‰</span>
<span class="hljs-operator">â€¢</span> <span class="hljs-type">Rewriteï¼ˆè§„åˆ™é‡å†™ï¼‰</span>
<span class="hljs-operator">â€¢</span> <span class="hljs-type">Map</span> <span class="hljs-type">Localï¼ˆæœ¬åœ°æ–‡ä»¶æ˜ å°„ï¼‰</span>
<span class="hljs-operator">â€¢</span> <span class="hljs-type">Throttleï¼ˆç½‘ç»œé™é€Ÿï¼‰</span>
</code></pre>
<h3 data-id="heading-6"><strong>3. mitmproxy</strong> - <strong>å¼€æºå‘½ä»¤è¡Œå·¥å…·</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®˜ç½‘: https://mitmproxy.org</span>
<span class="hljs-comment"># ç‰¹ç‚¹:</span>
âœ… å®Œå…¨å¼€æºå…è´¹
âœ… å‘½ä»¤è¡Œæ“ä½œï¼Œé€‚åˆè‡ªåŠ¨åŒ–
âœ… è„šæœ¬æ‰©å±•ï¼ˆPythonï¼‰
âœ… æ”¯æŒé€æ˜ä»£ç†

<span class="hljs-comment"># å®‰è£…:</span>
brew install mitmproxy

<span class="hljs-comment"># ä½¿ç”¨:</span>
<span class="hljs-comment"># å¯åŠ¨ä»£ç†</span>
mitmproxy --mode transparent --showhost

<span class="hljs-comment"># iOSè®¾ç½®:</span>
<span class="hljs-comment"># 1. å®‰è£…è¯ä¹¦: mitm.it</span>
<span class="hljs-comment"># 2. é…ç½®Wi-Fiä»£ç†</span>
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€UI/å¸ƒå±€è°ƒè¯•å·¥å…·</h2>
<h3 data-id="heading-8"><strong>1. Reveal</strong> - <strong>ä¸“ä¸šçš„UIè°ƒè¯•å·¥å…·</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// å®˜ç½‘: https://revealapp.com</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> å®æ—¶3Dè§†å›¾å±‚çº§
<span class="hljs-operator">âœ…</span> è¯¦ç»†çš„<span class="hljs-type">AutoLayoutçº¦æŸæŸ¥çœ‹</span>
<span class="hljs-operator">âœ…</span> å†…å­˜å›¾æŸ¥çœ‹å™¨
<span class="hljs-operator">âœ…</span> æ”¯æŒ<span class="hljs-type">SwiftUIé¢„è§ˆ</span>
<span class="hljs-operator">âœ…</span> å¼ºå¤§çš„ç­›é€‰å’Œæœç´¢

<span class="hljs-comment">// é›†æˆ:</span>
<span class="hljs-comment">// æ–¹å¼1: é€šè¿‡Reveal Serveræ¡†æ¶</span>
pod '<span class="hljs-type">Reveal</span><span class="hljs-operator">-</span><span class="hljs-type">SDK</span>', :configurations <span class="hljs-operator">=&gt;</span> ['<span class="hljs-type">Debug</span>']

<span class="hljs-comment">// æ–¹å¼2: LLDBåŠ è½½ï¼ˆæ— éœ€é›†æˆä»£ç ï¼‰</span>
(lldb) expr (void)[[<span class="hljs-type">NSClassFromString</span>(@<span class="hljs-string">"IBARevealLoader"</span>) <span class="hljs-keyword">class</span>] <span class="hljs-title class_">revealApplication</span>];

// ä»·æ ¼: ä»˜è´¹ï¼ˆæä¾›å…è´¹è¯•ç”¨ï¼‰
</code></pre>
<h3 data-id="heading-9"><strong>2. InjectionIII</strong> - <strong>çƒ­é‡è½½ç¥å™¨</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GitHub: https://github.com/johnno1962/InjectionIII</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> ä»£ç ä¿®æ”¹åå®æ—¶ç”Ÿæ•ˆ
<span class="hljs-operator">âœ…</span> æ— éœ€é‡æ–°ç¼–è¯‘è¿è¡Œ
<span class="hljs-operator">âœ…</span> æ”¯æŒ<span class="hljs-type">Swiftå’ŒObjective</span><span class="hljs-operator">-</span><span class="hljs-type">C</span>
<span class="hljs-operator">âœ…</span> ä¿ç•™åº”ç”¨çŠ¶æ€

<span class="hljs-comment">// å®‰è£…:</span>
# <span class="hljs-type">App</span> <span class="hljs-type">Storeæœç´¢</span> <span class="hljs-string">"InjectionIII"</span>

<span class="hljs-comment">// é…ç½®:</span>
<span class="hljs-number">1</span>. ä¸‹è½½å®‰è£…<span class="hljs-type">InjectionIII</span>
<span class="hljs-number">2</span>. åœ¨<span class="hljs-type">AppDelegateä¸­é…ç½®</span>:
<span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span>
<span class="hljs-type">Bundle</span>(path: <span class="hljs-string">"/Applications/InjectionIII.app/Contents/Resources/iOSInjection.bundle"</span>)<span class="hljs-operator">?</span>.load()
<span class="hljs-keyword">#endif</span>

<span class="hljs-number">3</span>. é¡¹ç›®æ·»åŠ æ–‡ä»¶ç›‘è§†:
<span class="hljs-comment">// åœ¨InjectionIII Appä¸­æ·»åŠ é¡¹ç›®è·¯å¾„</span>
</code></pre>
<h2 data-id="heading-10">å››ã€æ€§èƒ½è°ƒè¯•å·¥å…·</h2>
<h3 data-id="heading-11"><strong>1. Xcode Instruments</strong> - <strong>å®˜æ–¹æ€§èƒ½åˆ†æå¥—ä»¶</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// æ ¸å¿ƒå·¥å…·é›†:</span>
<span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span>          <span class="hljs-type">Xcode</span> <span class="hljs-type">Instruments</span>          <span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Time</span> <span class="hljs-type">Profiler</span>    # <span class="hljs-type">CPUä½¿ç”¨åˆ†æ</span>       <span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Allocations</span>      # å†…å­˜åˆ†é…åˆ†æ      <span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Leaks</span>           # å†…å­˜æ³„æ¼æ£€æµ‹      <span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Network</span>         # ç½‘ç»œæ´»åŠ¨åˆ†æ      <span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Energy</span> <span class="hljs-type">Log</span>      # ç”µé‡æ¶ˆè€—åˆ†æ      <span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Metal</span> <span class="hljs-type">System</span>    # <span class="hljs-type">GPUæ€§èƒ½åˆ†æ</span>       <span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">SwiftUI</span>         # <span class="hljs-type">SwiftUIæ€§èƒ½åˆ†æ</span>   <span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>

<span class="hljs-comment">// ä½¿ç”¨æŠ€å·§:</span>
<span class="hljs-number">1</span>. å½•åˆ¶æ—¶è¿‡æ»¤ç³»ç»Ÿè°ƒç”¨:
   <span class="hljs-type">Call</span> <span class="hljs-type">Tree</span>: <span class="hljs-operator">âœ…</span> <span class="hljs-type">Hide</span> <span class="hljs-type">System</span> <span class="hljs-type">Libraries</span>
              <span class="hljs-operator">âœ…</span> <span class="hljs-type">Invert</span> <span class="hljs-type">Call</span> <span class="hljs-type">Tree</span>
              <span class="hljs-operator">âœ…</span> <span class="hljs-type">Flattern</span> <span class="hljs-type">Recursion</span>

<span class="hljs-number">2</span>. å†…å­˜å›¾è°ƒè¯•:
   <span class="hljs-type">Debug</span> <span class="hljs-type">Memory</span> <span class="hljs-type">GraphæŒ‰é’®</span>
   æŸ¥çœ‹å¾ªç¯å¼•ç”¨<span class="hljs-operator">ã€</span>å†…å­˜æ³„æ¼

<span class="hljs-number">3</span>. ä½¿ç”¨<span class="hljs-type">Markers</span>:
   <span class="hljs-keyword">import</span> os
   <span class="hljs-keyword">let</span> log <span class="hljs-operator">=</span> <span class="hljs-type">OSLog</span>(subsystem: <span class="hljs-string">"com.app"</span>, category: <span class="hljs-string">"performance"</span>)
   os_signpost(.begin, log: log, name: <span class="hljs-string">"Network Request"</span>)
   <span class="hljs-comment">// ... æ“ä½œ</span>
   os_signpost(.end, log: log, name: <span class="hljs-string">"Network Request"</span>)
</code></pre>
<h3 data-id="heading-12"><strong>2. MetricKit</strong> - <strong>çº¿ä¸Šæ€§èƒ½ç›‘æ§æ¡†æ¶</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// Appleå®˜æ–¹æ€§èƒ½æ•°æ®æ”¶é›†æ¡†æ¶</span>
<span class="hljs-keyword">import</span> MetricKit

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MetricKitManager</span>: <span class="hljs-title class_">MXMetricManagerSubscriber</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">MetricKitManager</span>()
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">init</span>() {
        <span class="hljs-keyword">let</span> manager <span class="hljs-operator">=</span> <span class="hljs-type">MXMetricManager</span>.shared
        manager.add(<span class="hljs-keyword">self</span>)
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didReceive</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">payloads</span>: [<span class="hljs-type">MXMetricPayload</span>]) {
        <span class="hljs-comment">// æ¥æ”¶æ€§èƒ½æ•°æ®</span>
        <span class="hljs-keyword">for</span> payload <span class="hljs-keyword">in</span> payloads {
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"CPU: <span class="hljs-subst">\(payload.cpuMetrics)</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"å†…å­˜: <span class="hljs-subst">\(payload.memoryMetrics)</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¯åŠ¨æ—¶é—´: <span class="hljs-subst">\(payload.launchMetrics)</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç£ç›˜IO: <span class="hljs-subst">\(payload.diskIOMetrics)</span>"</span>)
        }
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didReceive</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">payloads</span>: [<span class="hljs-type">MXDiagnosticPayload</span>]) {
        <span class="hljs-comment">// æ¥æ”¶è¯Šæ–­æ•°æ®ï¼ˆå´©æºƒã€å¡é¡¿ç­‰ï¼‰</span>
    }
}

<span class="hljs-comment">// éœ€è¦ç”¨æˆ·æˆæƒï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒç›‘æ§</span>
</code></pre>
<h3 data-id="heading-13"><strong>3. Tracy</strong> - <strong>è…¾è®¯å¼€æºçš„æ€§èƒ½ç›‘æ§</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GitHub: https://github.com/Tencent/tracy</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> å¡é¡¿ç›‘æ§ï¼ˆä¸»çº¿ç¨‹é˜»å¡æ£€æµ‹ï¼‰
<span class="hljs-operator">âœ…</span> å†…å­˜æ³„æ¼æ£€æµ‹
<span class="hljs-operator">âœ…</span> å¤§å¯¹è±¡åˆ†é…ç›‘æ§
<span class="hljs-operator">âœ…</span> ç½‘ç»œæ€§èƒ½ç›‘æ§
<span class="hljs-operator">âœ…</span> å´©æºƒæ”¶é›†

<span class="hljs-comment">// é›†æˆ:</span>
pod '<span class="hljs-type">Tracy</span>', :configurations <span class="hljs-operator">=&gt;</span> ['<span class="hljs-type">Debug</span>']

<span class="hljs-comment">// ä½¿ç”¨:</span>
<span class="hljs-type">Tracy</span>.start()
<span class="hljs-comment">// è‡ªåŠ¨ç›‘æ§å„ç§æ€§èƒ½æŒ‡æ ‡</span>
</code></pre>
<h2 data-id="heading-14">äº”ã€å†…å­˜/å´©æºƒè°ƒè¯•å·¥å…·</h2>
<h3 data-id="heading-15"><strong>1. MLeaksFinder</strong> - <strong>è…¾è®¯å‡ºå“çš„å†…å­˜æ³„æ¼æ£€æµ‹</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GitHub: https://github.com/Tencent/MLeaksFinder</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> è‡ªåŠ¨æ£€æµ‹è§†å›¾æ§åˆ¶å™¨å†…å­˜æ³„æ¼
<span class="hljs-operator">âœ…</span> æ— éœ€ç¼–å†™ä»»ä½•ä»£ç 
<span class="hljs-operator">âœ…</span> æ”¯æŒè‡ªå®šä¹‰ç™½åå•
<span class="hljs-operator">âœ…</span> ç²¾å‡†å®šä½æ³„æ¼å¯¹è±¡

<span class="hljs-comment">// åŸç†:</span>
<span class="hljs-comment">// ç›‘å¬UIViewControllerçš„pop/dismiss</span>
<span class="hljs-comment">// å»¶è¿Ÿæ£€æŸ¥æ˜¯å¦ä»ç„¶å­˜åœ¨</span>

<span class="hljs-comment">// é›†æˆ:</span>
pod '<span class="hljs-type">MLeaksFinder</span>'

<span class="hljs-comment">// è‡ªå®šä¹‰é…ç½®:</span>
<span class="hljs-comment">// 1. æ·»åŠ ç™½åå•</span>
[<span class="hljs-type">NSClassFromString</span>(@<span class="hljs-string">"WhiteListClass"</span>) <span class="hljs-keyword">class</span>]

// 2. å¿½ç•¥ç‰¹å®šæ³„æ¼
[<span class="hljs-title class_">MLeaksFinder</span> <span class="hljs-title class_">addIgnoreClass</span>:[<span class="hljs-title class_">IgnoreClass</span> <span class="hljs-title class_">class</span>]]
</code></pre>
<h3 data-id="heading-16"><strong>2. FBRetainCycleDetector</strong> - <strong>Facebookå¾ªç¯å¼•ç”¨æ£€æµ‹</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GitHub: https://github.com/facebook/FBRetainCycleDetector</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> æ£€æµ‹<span class="hljs-type">Objective</span><span class="hljs-operator">-</span><span class="hljs-type">Cå¯¹è±¡çš„å¾ªç¯å¼•ç”¨</span>
<span class="hljs-operator">âœ…</span> æ”¯æŒæ£€æµ‹<span class="hljs-type">NSTimerçš„å¼ºå¼•ç”¨</span>
<span class="hljs-operator">âœ…</span> å¯é›†æˆåˆ°å•å…ƒæµ‹è¯•ä¸­
<span class="hljs-operator">âœ…</span> <span class="hljs-type">Facebookå†…éƒ¨å¹¿æ³›ä½¿ç”¨</span>

<span class="hljs-comment">// ä½¿ç”¨:</span>
<span class="hljs-keyword">let</span> detector <span class="hljs-operator">=</span> <span class="hljs-type">FBRetainCycleDetector</span>()
detector.addCandidate(myObject)
<span class="hljs-keyword">let</span> cycles <span class="hljs-operator">=</span> detector.findRetainCycles()

<span class="hljs-comment">// è¾“å‡ºæ ¼å¼åŒ–çš„å¾ªç¯å¼•ç”¨é“¾</span>
<span class="hljs-keyword">for</span> cycle <span class="hljs-keyword">in</span> cycles {
    <span class="hljs-built_in">print</span>(<span class="hljs-type">FBRetainCycleDetectorFormatter</span>.format(cycle))
}
</code></pre>
<h3 data-id="heading-17"><strong>3. KSCrash</strong> - <strong>å¼ºå¤§çš„å´©æºƒæ”¶é›†æ¡†æ¶</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GitHub: https://github.com/kstenerud/KSCrash</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> æ•è·æ‰€æœ‰ç±»å‹å´©æºƒï¼ˆ<span class="hljs-type">OCå¼‚å¸¸</span><span class="hljs-operator">ã€</span><span class="hljs-type">C</span><span class="hljs-operator">++</span>å¼‚å¸¸<span class="hljs-operator">ã€</span><span class="hljs-type">Machå¼‚å¸¸ç­‰ï¼‰</span>
<span class="hljs-operator">âœ…</span> ç”Ÿæˆå®Œæ•´çš„å´©æºƒæŠ¥å‘Š
<span class="hljs-operator">âœ…</span> æ”¯æŒç¬¦å·åŒ–
<span class="hljs-operator">âœ…</span> å¯è‡ªå®šä¹‰ä¸ŠæŠ¥æœåŠ¡å™¨

<span class="hljs-comment">// é›†æˆ:</span>
pod '<span class="hljs-type">KSCrash</span>'

<span class="hljs-comment">// é…ç½®:</span>
<span class="hljs-keyword">import</span> KSCrash

<span class="hljs-keyword">let</span> installation <span class="hljs-operator">=</span> makeEmailInstallation(<span class="hljs-string">"crash@company.com"</span>)
installation.addConditionalAlert(withTitle: <span class="hljs-string">"Crash Detected"</span>,
                                message: <span class="hljs-string">"The app crashed last time"</span>)
<span class="hljs-type">KSCrash</span>.shared().install()

<span class="hljs-comment">// é«˜çº§åŠŸèƒ½:</span>
<span class="hljs-comment">// 1. ç”¨æˆ·æ•°æ®è®°å½•</span>
<span class="hljs-type">KSCrash</span>.shared().userInfo <span class="hljs-operator">=</span> [<span class="hljs-string">"user_id"</span>: <span class="hljs-string">"123"</span>]

<span class="hljs-comment">// 2. è‡ªå®šä¹‰æ—¥å¿—</span>
<span class="hljs-type">KSCrash</span>.shared().log.error(<span class="hljs-string">"Something went wrong"</span>)

<span class="hljs-comment">// 3. ç›‘æ§å¡é¡¿</span>
<span class="hljs-type">KSCrash</span>.shared().monitorDeadlock <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
</code></pre>
<h2 data-id="heading-18">å…­ã€æ—¥å¿—è°ƒè¯•å·¥å…·</h2>
<h3 data-id="heading-19"><strong>1. CocoaLumberjack</strong> - <strong>ä¸“ä¸šæ—¥å¿—æ¡†æ¶</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GitHub: https://github.com/CocoaLumberjack/CocoaLumberjack</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> é«˜æ€§èƒ½æ—¥å¿—è®°å½•
<span class="hljs-operator">âœ…</span> å¤šæ—¥å¿—çº§åˆ«ï¼ˆ<span class="hljs-type">Error</span>, <span class="hljs-type">Warn</span>, <span class="hljs-type">Info</span>, <span class="hljs-type">Debug</span>, <span class="hljs-type">Verboseï¼‰</span>
<span class="hljs-operator">âœ…</span> å¤šç§è¾“å‡ºç›®æ ‡ï¼ˆ<span class="hljs-type">Console</span>, <span class="hljs-type">File</span>, <span class="hljs-type">Databaseï¼‰</span>
<span class="hljs-operator">âœ…</span> æ—¥å¿—è½®è½¬å’Œæ¸…ç†
<span class="hljs-operator">âœ…</span> æ”¯æŒ<span class="hljs-type">Swiftå’ŒObjective</span><span class="hljs-operator">-</span><span class="hljs-type">C</span>

<span class="hljs-comment">// é›†æˆ:</span>
pod '<span class="hljs-type">CocoaLumberjack</span><span class="hljs-operator">/</span><span class="hljs-type">Swift</span>'

<span class="hljs-comment">// é…ç½®:</span>
<span class="hljs-keyword">import</span> CocoaLumberjackSwift

<span class="hljs-comment">// æ§åˆ¶å°æ—¥å¿—</span>
<span class="hljs-type">DDLog</span>.add(<span class="hljs-type">DDOSLogger</span>.sharedInstance)

<span class="hljs-comment">// æ–‡ä»¶æ—¥å¿—</span>
<span class="hljs-keyword">let</span> fileLogger <span class="hljs-operator">=</span> <span class="hljs-type">DDFileLogger</span>()
fileLogger.rollingFrequency <span class="hljs-operator">=</span> <span class="hljs-number">60</span> <span class="hljs-operator">*</span> <span class="hljs-number">60</span> <span class="hljs-operator">*</span> <span class="hljs-number">24</span> <span class="hljs-comment">// 24å°æ—¶</span>
fileLogger.logFileManager.maximumNumberOfLogFiles <span class="hljs-operator">=</span> <span class="hljs-number">7</span>
<span class="hljs-type">DDLog</span>.add(fileLogger)

<span class="hljs-comment">// ä½¿ç”¨:</span>
<span class="hljs-type">DDLogError</span>(<span class="hljs-string">"é”™è¯¯ä¿¡æ¯"</span>)
<span class="hljs-type">DDLogWarn</span>(<span class="hljs-string">"è­¦å‘Šä¿¡æ¯"</span>)
<span class="hljs-type">DDLogInfo</span>(<span class="hljs-string">"æ™®é€šä¿¡æ¯"</span>)
<span class="hljs-type">DDLogDebug</span>(<span class="hljs-string">"è°ƒè¯•ä¿¡æ¯"</span>)
<span class="hljs-type">DDLogVerbose</span>(<span class="hljs-string">"è¯¦ç»†ä¿¡æ¯"</span>)

<span class="hljs-comment">// ä¸Šä¸‹æ–‡è¿‡æ»¤:</span>
<span class="hljs-keyword">let</span> context <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
<span class="hljs-type">DDLogDebug</span>(<span class="hljs-string">"å¸¦ä¸Šä¸‹æ–‡çš„æ¶ˆæ¯"</span>, context: context)
</code></pre>
<h3 data-id="heading-20"><strong>2. SwiftyBeaver</strong> - <strong>Swiftä¸“ç”¨æ—¥å¿—æ¡†æ¶</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GitHub: https://github.com/SwiftyBeaver/SwiftyBeaver</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> çº¯<span class="hljs-type">Swiftå®ç°</span>
<span class="hljs-operator">âœ…</span> å½©è‰²æ§åˆ¶å°è¾“å‡º
<span class="hljs-operator">âœ…</span> å¤šç§ç›®çš„åœ°ï¼ˆ<span class="hljs-type">Console</span>, <span class="hljs-type">File</span>, <span class="hljs-type">Cloudï¼‰</span>
<span class="hljs-operator">âœ…</span> å¹³å°åŒæ­¥ï¼ˆmacOS <span class="hljs-type">Appï¼‰</span>
<span class="hljs-operator">âœ…</span> æ”¯æŒemojiå’Œæ ¼å¼åŒ–

<span class="hljs-comment">// ä½¿ç”¨:</span>
<span class="hljs-keyword">import</span> SwiftyBeaver
<span class="hljs-keyword">let</span> log <span class="hljs-operator">=</span> <span class="hljs-type">SwiftyBeaver</span>.<span class="hljs-keyword">self</span>

<span class="hljs-comment">// æ·»åŠ æ§åˆ¶å°ç›®çš„åœ°</span>
<span class="hljs-keyword">let</span> console <span class="hljs-operator">=</span> <span class="hljs-type">ConsoleDestination</span>()
console.format <span class="hljs-operator">=</span> <span class="hljs-string">"$DHH:mm:ss$d $L $M"</span>
log.addDestination(console)

<span class="hljs-comment">// æ·»åŠ æ–‡ä»¶ç›®çš„åœ°</span>
<span class="hljs-keyword">let</span> file <span class="hljs-operator">=</span> <span class="hljs-type">FileDestination</span>()
file.logFileURL <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(fileURLWithPath: <span class="hljs-string">"/path/to/file.log"</span>)
log.addDestination(file)

<span class="hljs-comment">// æ—¥å¿—çº§åˆ«:</span>
log.verbose(<span class="hljs-string">"è¯¦ç»†"</span>)    <span class="hljs-comment">// ç°è‰²</span>
log.debug(<span class="hljs-string">"è°ƒè¯•"</span>)      <span class="hljs-comment">// ç»¿è‰²</span>
log.info(<span class="hljs-string">"ä¿¡æ¯"</span>)       <span class="hljs-comment">// è“è‰²</span>
log.warning(<span class="hljs-string">"è­¦å‘Š"</span>)    <span class="hljs-comment">// é»„è‰²</span>
log.error(<span class="hljs-string">"é”™è¯¯"</span>)      <span class="hljs-comment">// çº¢è‰²</span>
</code></pre>
<h3 data-id="heading-21"><strong>3. XCGLogger</strong> - <strong>åŠŸèƒ½ä¸°å¯Œçš„æ—¥å¿—æ¡†æ¶</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GitHub: https://github.com/DaveWoodCom/XCGLogger</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> é«˜åº¦å¯é…ç½®
<span class="hljs-operator">âœ…</span> æ”¯æŒæ—¥å¿—è¿‡æ»¤
<span class="hljs-operator">âœ…</span> è‡ªå®šä¹‰æ—¥å¿—ç›®çš„åœ°
<span class="hljs-operator">âœ…</span> è‡ªåŠ¨æ—¥å¿—è½®è½¬
<span class="hljs-operator">âœ…</span> è¯¦ç»†çš„æ–‡æ¡£

<span class="hljs-comment">// ä½¿ç”¨:</span>
<span class="hljs-keyword">import</span> XCGLogger

<span class="hljs-keyword">let</span> log <span class="hljs-operator">=</span> <span class="hljs-type">XCGLogger</span>.default

<span class="hljs-comment">// é…ç½®</span>
log.setup(level: .debug,
          showLogIdentifier: <span class="hljs-literal">false</span>,
          showFunctionName: <span class="hljs-literal">true</span>,
          showThreadName: <span class="hljs-literal">true</span>,
          showLevel: <span class="hljs-literal">true</span>,
          showFileNames: <span class="hljs-literal">true</span>,
          showLineNumbers: <span class="hljs-literal">true</span>,
          showDate: <span class="hljs-literal">true</span>)

<span class="hljs-comment">// è‡ªå®šä¹‰è¿‡æ»¤å™¨</span>
log.filters <span class="hljs-operator">=</span> [
    <span class="hljs-type">Filter</span>.<span class="hljs-type">Level</span>(from: .debug),  <span class="hljs-comment">// åªæ˜¾ç¤º.debugåŠä»¥ä¸Š</span>
    <span class="hljs-type">Filter</span>.<span class="hljs-type">Path</span>(include: [<span class="hljs-string">"ViewController"</span>], exclude: [<span class="hljs-string">"ThirdParty"</span>])
]

log.debug(<span class="hljs-string">"è°ƒè¯•ä¿¡æ¯"</span>)
log.error(<span class="hljs-string">"é”™è¯¯ä¿¡æ¯"</span>)
</code></pre>
<h2 data-id="heading-22">ä¸ƒã€è‡ªåŠ¨åŒ–è°ƒè¯•å·¥å…·</h2>
<h3 data-id="heading-23"><strong>1. Fastlane</strong> - <strong>è‡ªåŠ¨åŒ–å·¥å…·é›†</strong></h3>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># å®˜ç½‘: https://fastlane.tools</span>
<span class="hljs-comment"># ç‰¹ç‚¹:</span>
âœ… è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²
âœ… ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€
âœ… ä¸<span class="hljs-variable constant_">CI</span>/<span class="hljs-variable constant_">CD</span>æ·±åº¦é›†æˆ
âœ… è·¨å¹³å°æ”¯æŒ

<span class="hljs-comment"># å¸¸ç”¨å‘½ä»¤:</span>
fastlane screenshots    <span class="hljs-comment"># è‡ªåŠ¨æˆªå›¾</span>
fastlane beta          <span class="hljs-comment"># å‘å¸ƒæµ‹è¯•ç‰ˆ</span>
fastlane release       <span class="hljs-comment"># å‘å¸ƒæ­£å¼ç‰ˆ</span>
fastlane match         <span class="hljs-comment"># è¯ä¹¦ç®¡ç†</span>

<span class="hljs-comment"># é›†æˆè°ƒè¯•åŠŸèƒ½:</span>
lane <span class="hljs-symbol">:debug_build</span> <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># 1. è®¾ç½®è°ƒè¯•é…ç½®</span>
  update_app_identifier(
    <span class="hljs-symbol">app_identifier:</span> <span class="hljs-string">"com.company.debug"</span>
  )
  
  <span class="hljs-comment"># 2. å¯ç”¨è°ƒè¯•åŠŸèƒ½</span>
  update_info_plist(
    <span class="hljs-symbol">plist_path:</span> <span class="hljs-string">"Info.plist"</span>,
    <span class="hljs-symbol">block:</span> <span class="hljs-built_in">proc</span> <span class="hljs-keyword">do</span> |<span class="hljs-params">plist</span>|
      plist[<span class="hljs-string">"FLEXEnabled"</span>] = <span class="hljs-literal">true</span>
      plist[<span class="hljs-string">"NSAllowsArbitraryLoads"</span>] = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">end</span>
  )
  
  <span class="hljs-comment"># 3. æ„å»º</span>
  gym(
    <span class="hljs-symbol">scheme:</span> <span class="hljs-string">"Debug"</span>,
    <span class="hljs-symbol">export_method:</span> <span class="hljs-string">"development"</span>
  )
<span class="hljs-keyword">end</span>
</code></pre>
<h3 data-id="heading-24"><strong>2. slather</strong> - <strong>ä»£ç è¦†ç›–ç‡å·¥å…·</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># GitHub: https://github.com/SlatherOrg/slather</span>
<span class="hljs-comment"># ç‰¹ç‚¹:</span>
âœ… ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Š
âœ… æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼ˆhtml, cobertura, jsonï¼‰
âœ… ä¸CIé›†æˆ
âœ… è¿‡æ»¤ç¬¬ä¸‰æ–¹åº“ä»£ç 

<span class="hljs-comment"># å®‰è£…:</span>
gem install slather

<span class="hljs-comment"># ä½¿ç”¨:</span>
<span class="hljs-comment"># 1. è¿è¡Œæµ‹è¯•å¹¶æ”¶é›†è¦†ç›–ç‡</span>
xcodebuild <span class="hljs-built_in">test</span> -scheme MyApp -destination <span class="hljs-string">'platform=iOS Simulator,name=iPhone 14'</span> -enableCodeCoverage YES

<span class="hljs-comment"># 2. ç”ŸæˆæŠ¥å‘Š</span>
slather coverage --html --show --scheme MyApp MyApp.xcodeproj

<span class="hljs-comment"># 3. åœ¨Jenkinsä¸­é›†æˆ</span>
slather coverage --input-format profdata --cobertura-xml --output-directory build/reports MyApp.xcodeproj
</code></pre>
<h2 data-id="heading-25">å…«ã€ç‰¹æ®Šåœºæ™¯è°ƒè¯•å·¥å…·</h2>
<h3 data-id="heading-26"><strong>1. SparkInspector</strong> - <strong>å®æ—¶å¯¹è±¡ç›‘æ§</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// å®˜ç½‘: https://sparkinspector.com</span>
<span class="hljs-comment">// ç‰¹ç‚¹:</span>
<span class="hljs-operator">âœ…</span> å®æ—¶ç›‘æ§æ‰€æœ‰å¯¹è±¡å®ä¾‹
<span class="hljs-operator">âœ…</span> æŸ¥çœ‹å¯¹è±¡å±æ€§å˜åŒ–
<span class="hljs-operator">âœ…</span> æ–¹æ³•è°ƒç”¨è¿½è¸ª
<span class="hljs-operator">âœ…</span> å†…å­˜æ³„æ¼æ£€æµ‹

<span class="hljs-comment">// é›†æˆ:</span>
<span class="hljs-comment">// 1. ä¸‹è½½Spark Inspectoråº”ç”¨</span>
<span class="hljs-comment">// 2. é›†æˆæ¡†æ¶åˆ°é¡¹ç›®</span>
<span class="hljs-comment">// 3. é€šè¿‡Spark Inspectorè¿æ¥è°ƒè¯•</span>

<span class="hljs-comment">// é€‚ç”¨åœºæ™¯:</span>
<span class="hljs-operator">â€¢</span> å¤æ‚çš„å¯¹è±¡å…³ç³»è°ƒè¯•
<span class="hljs-operator">â€¢</span> è§‚å¯Ÿæ¨¡å¼æ•°æ®æµ
<span class="hljs-operator">â€¢</span> å†…å­˜æ³„æ¼å®šä½
</code></pre>
<h3 data-id="heading-27"><strong>3. LLDB</strong> - <strong>åº•å±‚è°ƒè¯•ç¥å™¨</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Xcodeå†…ç½®ï¼Œä½†åŠŸèƒ½æå…¶å¼ºå¤§</span>
<span class="hljs-comment"># å¸¸ç”¨å‘½ä»¤:</span>

<span class="hljs-comment"># 1. æŸ¥çœ‹å˜é‡</span>
(lldb) po variable
(lldb) p variable
(lldb) v variable

<span class="hljs-comment"># 2. ä¿®æ”¹å˜é‡</span>
(lldb) <span class="hljs-built_in">expr</span> variable = newValue

<span class="hljs-comment"># 3. è°ƒç”¨æ–¹æ³•</span>
(lldb) <span class="hljs-built_in">expr</span> [self doSomething]
(lldb) <span class="hljs-built_in">expr</span> self.doSomething()

<span class="hljs-comment"># 4. æ–­ç‚¹å‘½ä»¤</span>
(lldb) breakpoint <span class="hljs-built_in">set</span> -n <span class="hljs-string">"[ClassName methodName]"</span>
(lldb) breakpoint <span class="hljs-built_in">command</span> add 1  <span class="hljs-comment"># ä¸ºæ–­ç‚¹1æ·»åŠ å‘½ä»¤</span>
&gt; po <span class="hljs-variable">$arg1</span>
&gt; <span class="hljs-built_in">continue</span>
&gt; DONE

<span class="hljs-comment"># 5. å†…å­˜æŸ¥çœ‹</span>
(lldb) memory <span class="hljs-built_in">read</span> 0x12345678
(lldb) memory write 0x12345678 0x42

<span class="hljs-comment"># 6. è‡ªå®šä¹‰LLDBå‘½ä»¤</span>
(lldb) <span class="hljs-built_in">command</span> regex rlook <span class="hljs-string">'s/(.+)/image lookup -rn %1/'</span>
(lldb) rlook methodName

<span class="hljs-comment"># 7. Swiftç‰¹å®šå‘½ä»¤</span>
(lldb) frame variable -L  <span class="hljs-comment"># æ˜¾ç¤ºå±€éƒ¨å˜é‡</span>
(lldb) <span class="hljs-built_in">type</span> lookup String <span class="hljs-comment"># æŸ¥çœ‹ç±»å‹ä¿¡æ¯</span>
</code></pre>
<h2 data-id="heading-28">ä¹ã€å·¥å…·çŸ©é˜µ</h2>


















































<table><thead><tr><th>éœ€æ±‚åœºæ™¯</th><th>æ¨èå·¥å…·</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><strong>æ—¥å¸¸å¼€å‘è°ƒè¯•</strong></td><td>FLEX + Proxyman</td><td>åŠŸèƒ½å…¨é¢ï¼Œæ— éœ€é¢å¤–ç¯å¢ƒ</td></tr><tr><td><strong>UI/å¸ƒå±€é—®é¢˜</strong></td><td>Lookin + Reveal</td><td>3Dè§†å›¾ï¼Œå®æ—¶ä¿®æ”¹</td></tr><tr><td><strong>æ€§èƒ½ä¼˜åŒ–</strong></td><td>Xcode Instruments + Tracy</td><td>å®˜æ–¹å·¥å…·+çº¿ä¸Šç›‘æ§</td></tr><tr><td><strong>å†…å­˜æ³„æ¼</strong></td><td>MLeaksFinder + FBRetainCycleDetector</td><td>è‡ªåŠ¨æ£€æµ‹+æ·±åº¦åˆ†æ</td></tr><tr><td><strong>ç½‘ç»œè°ƒè¯•</strong></td><td>Proxyman/Charles</td><td>åŠŸèƒ½ä¸“ä¸šï¼Œæ“ä½œå‹å¥½</td></tr><tr><td><strong>æ—¥å¿—ç®¡ç†</strong></td><td>CocoaLumberjack + SwiftyBeaver</td><td>åŠŸèƒ½å¼ºå¤§+ç¾è§‚è¾“å‡º</td></tr><tr><td><strong>è‡ªåŠ¨åŒ–</strong></td><td>Fastlane + slather</td><td>æµç¨‹è‡ªåŠ¨åŒ–+è´¨é‡ç›‘æ§</td></tr><tr><td><strong>åº•å±‚è°ƒè¯•</strong></td><td>LLDB + InjectionIII</td><td>æ·±åº¦æ§åˆ¶+çƒ­é‡è½½</td></tr></tbody></table>
<h3 data-id="heading-29"><strong>å›¢é˜Ÿè§„èŒƒå»ºè®®</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># iOSå›¢é˜Ÿè°ƒè¯•å·¥å…·è§„èŒƒ</span>

<span class="hljs-section">## å¿…è£…å·¥å…·ï¼ˆæ‰€æœ‰å¼€å‘è€…ï¼‰</span>
<span class="hljs-bullet">1.</span> Proxyman/Charles - ç½‘ç»œè°ƒè¯•
<span class="hljs-bullet">2.</span> Lookin - UIè°ƒè¯•  
<span class="hljs-bullet">3.</span> InjectionIII - çƒ­é‡è½½

<span class="hljs-section">## é¡¹ç›®é›†æˆï¼ˆPodfileï¼‰</span>
<span class="hljs-code">```ruby
target 'MyApp' do
  # è°ƒè¯•å·¥å…·ï¼ˆä»…Debugï¼‰
  pod 'FLEX', :configurations =&gt; ['Debug']
  pod 'CocoaLumberjack', :configurations =&gt; ['Debug']
  pod 'MLeaksFinder', :configurations =&gt; ['Debug']
end
</span></code></pre>
<h2 data-id="heading-30">æ€»ç»“</h2>
<p><strong>æ ¸å¿ƒå»ºè®®ï¼š</strong></p>
<ol>
<li><strong>ä¸è¦è¿‡åº¦ä¾èµ–å•ä¸€å·¥å…·</strong> - ä¸åŒå·¥å…·æœ‰ä¸åŒé€‚ç”¨åœºæ™¯</li>
<li><strong>æŒæ¡æ ¸å¿ƒåŸç†</strong> - ç†è§£å·¥å…·èƒŒåçš„å·¥ä½œåŸç†æ¯”å•çº¯ä½¿ç”¨æ›´é‡è¦</li>
<li><strong>å»ºç«‹ä¸ªäººè°ƒè¯•å·¥å…·ç®±</strong> - æ ¹æ®ä¹ æƒ¯ç»„åˆé€‚åˆè‡ªå·±çš„å·¥å…·é›†</li>
<li><strong>å…³æ³¨æ–°å·¥å…·å‘å±•</strong> - iOSå¼€å‘å·¥å…·ç”Ÿæ€åœ¨æŒç»­è¿›åŒ–</li>
<li><strong>é‡è§†è‡ªåŠ¨åŒ–</strong> - å°†é‡å¤è°ƒè¯•å·¥ä½œè‡ªåŠ¨åŒ–ï¼Œæé«˜æ•ˆç‡</li>
</ol>
<p><strong>ç»ˆæç›®æ ‡ï¼š</strong> å¿«é€Ÿå®šä½é—®é¢˜ â†’ æ·±å…¥åˆ†æåŸå›  â†’ æœ‰æ•ˆè§£å†³é—®é¢˜</p>
<p>è¿™äº›å·¥å…·å¤§å¤šæ•°éƒ½æœ‰å…è´¹ç‰ˆæœ¬æˆ–å¼€æºç‰ˆæœ¬ï¼Œå»ºè®®ä»æœ€å¸¸ç”¨çš„å‡ ä¸ªå¼€å§‹ï¼Œé€æ­¥å»ºç«‹è‡ªå·±çš„è°ƒè¯•èƒ½åŠ›ä½“ç³»ã€‚</p>
<p><strong>æŒæ¡è¿™äº›å·¥å…·ï¼Œä¸æ˜¯ä¸ºäº†ç‚«è€€æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸ºäº†è®©ä½ çš„ä»£ç æ›´å¥å£®ï¼Œè®©ä½ çš„ç”¨æˆ·æ›´æ»¡æ„ï¼Œè®©ä½ è‡ªå·±åœ¨æ·±å¤œåŠ ç­æ—¶å°‘æ‰å‡ æ ¹å¤´å‘ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VS code ç±»äº§ç‰©ä¸­ win11 ç»ˆç«¯å­—ä½“å†…å®¹å’Œé¢œè‰² åŠ ç²—ä¸åŒ¹é…é—®é¢˜]]></title>    <link>https://juejin.cn/post/7598465042968969256</link>    <guid>https://juejin.cn/post/7598465042968969256</guid>    <pubDate>2026-01-24T15:33:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598465042968969256" data-draft-id="7598465042968952872" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VS code ç±»äº§ç‰©ä¸­ win11 ç»ˆç«¯å­—ä½“å†…å®¹å’Œé¢œè‰² åŠ ç²—ä¸åŒ¹é…é—®é¢˜"/> <meta itemprop="keywords" content="Visual Studio Code"/> <meta itemprop="datePublished" content="2026-01-24T15:33:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°å…µå¼ å¥"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032405229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VS code ç±»äº§ç‰©ä¸­ win11 ç»ˆç«¯å­—ä½“å†…å®¹å’Œé¢œè‰² åŠ ç²—ä¸åŒ¹é…é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032405229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°å…µå¼ å¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T15:33:44.000Z" title="Sat Jan 24 2026 15:33:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æˆ‘å°è¯•äº†å„ç§æ–¹å¼,æ¢å­—ä½“,æ”¹é…ç½®,ç»“æœè¿˜æ˜¯ä¹±çš„,æœ‰äººçŸ¥é“æ€ä¹ˆæå—?è·ªæ±‚,Macå¥½åƒå¤©ç„¶å°±æ²¡é—®é¢˜,æ€¥æ€¥æ€¥å¤§ä½¬ä»¬</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14b10c217d9d47408dc733826f98fdc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769873624&amp;x-signature=8%2BcE%2BDM9fDLRxpbyU2flIgQkTvE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19391a06fd4541a788dae709478f1988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769873624&amp;x-signature=SPZ4lLxNZwqzVbtIoKoguPvPXqU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05cb66ebf33044c3921a2505f6115c4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769873624&amp;x-signature=kiSbLkzH%2Fg1RsMF5GT4MTBzNm44%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/880692bad4204f7abd40edcd529d99bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5YW15byg5YGl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769873624&amp;x-signature=FyyOw2wyPEtzDbLo3paICY1gQVU%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI D2C(è®¾è®¡è½¬ä»£ç )æ¢ç´¢åŠä½¿ç”¨ä½“éªŒ]]></title>    <link>https://juejin.cn/post/7598447519824543785</link>    <guid>https://juejin.cn/post/7598447519824543785</guid>    <pubDate>2026-01-24T14:41:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598447519824543785" data-draft-id="7598447519824527401" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI D2C(è®¾è®¡è½¬ä»£ç )æ¢ç´¢åŠä½¿ç”¨ä½“éªŒ"/> <meta itemprop="keywords" content="AIGC,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-24T14:41:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰é‡‘å¾—é‘«"/> <meta itemprop="url" content="https://juejin.cn/user/4406498335130216"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI D2C(è®¾è®¡è½¬ä»£ç )æ¢ç´¢åŠä½¿ç”¨ä½“éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498335130216/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰é‡‘å¾—é‘«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T14:41:48.000Z" title="Sat Jan 24 2026 14:41:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Helloï¼Œå¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ä¸‰é‡‘ï½</p>
<p>ä¸´è¿‘å¹´åº•ï¼Œéœ€æ±‚å¤šåˆ°è®©äººæ€€ç–‘äººç”Ÿï¼Œé¢†å¯¼ä¹Ÿæ˜¯è¿ç»­ä¸¤å‘¨éƒ½åœ¨å«Œæˆ‘æ‰“èºä¸æœ‰äº›æ…¢äº†ã€‚ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œæˆ‘æŠŠä¸€äº› UI ä¸Šçš„å·¥ä½œäº¤ç»™äº†å†…éƒ¨æä¾›çš„ D2C Agentï¼Œæ•ˆæœä»¤äººæƒŠè‰³ï¼</p>
<p>äº”ä¸ªé¡µé¢ + ä¸šåŠ¡é€»è¾‘å®ç°ï¼Œä¸€å…±ç”¨äº†ä¸åˆ°åŠå°æ—¶ï¼å…¶ä¸­ï¼š</p>
<ul>
<li>D2C äº§å‡ºåˆç‰ˆä»£ç èŠ±äº†åæ¥åˆ†é’Ÿå·¦å³ã€‚UI è¿˜åŸåº¦å¯ä»¥è¾¾åˆ° 80% ä»¥ä¸Šï¼Œä¸”ç”±äºåœ¨æç¤ºè¯ä¸­æˆ‘å·²ç»åŠ ä¸Šäº†ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ‰€ä»¥æœ€ç»ˆçš„åŠŸèƒ½å®Œæˆåº¦ä¹Ÿèƒ½è¾¾åˆ° 90% ä»¥ä¸Šï¼</li>
<li>å‰©ä¸‹åæ¥åˆ†é’Ÿçš„æ—¶é—´ï¼Œå°±æ˜¯ AI å–„åå·¥ç¨‹å¸ˆï¼ˆæ²¡é”™ï¼Œå°±æ˜¯æœ¬äººï¼‰çš„ show timeã€‚ä¸»è¦æ˜¯å°†ä¸€äº›æ ·å¼ç»†èŠ‚å’Œäº¤äº’ç»†èŠ‚è¿›è¡Œä¼˜åŒ–ï¼ˆæ„Ÿè§‰è‡ªå·±æˆäº†ä¸ªè¾¹è§’æ–™ğŸ˜­ï¼‰ã€‚</li>
</ul>
<p>è¿™é€Ÿåº¦ã€è¿™æ•ˆç‡ç®€ç›´è®©äººå¯æ€•ã€‚éš¾é“å‰ç«¯çœŸçš„è¦å¤±ä¸šäº†å—ï¼Ÿzengï½zengï½ å¯æ€•ğŸ˜¨</p>
<h3 data-id="heading-0">D2C ä»‹ç»</h3>
<p>è¯è¯´å›æ¥ï¼Œæœ‰äº›å°ä¼™ä¼´å¯èƒ½è¿˜ä¸æ›¾äº†è§£è¿‡ D2Cï¼Œè¿™é‡Œæˆ‘ç»™å¤§å®¶å†ä»‹ç»ä¸€ä¸‹ç›¸å…³æ¦‚å¿µï¼š</p>
<p>D2C å…¨ç§° <strong>Design To Code</strong>ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯å¯ä»¥å°†è®¾è®¡ç¨¿ç›´æ¥è½¬æ¢ä¸ºå‰ç«¯ä»£ç çš„æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯æ‰“ç ´äº†å‰ç«¯å¼€å‘äººå‘˜çš„ä¼ ç»Ÿå·¥ä½œæ¨¡å¼ï¼š</p>
<ul>
<li>ä¸åŒå›¾å±‚ä¹‹é—´â€œåƒç´ çº§åˆ«â€çš„è¿˜åŸï¼›</li>
<li>æ€è€ƒã€å†³ç­–åº”è¯¥ä½¿ç”¨å“ªç§é¡µé¢å¸ƒå±€ï¼›</li>
<li>è·¨ç«¯åº”ç”¨ä¸­ï¼Œå¦‚ä½•å®ç°å“åº”å¼ï¼›</li>
<li>ç­‰ç­‰</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒD2C åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ›´æ˜¯æ‰“ç ´äº†èŒè´£åˆ’åˆ†ï¼Œè®¾è®¡å¸ˆã€äº§å“ç”šè‡³åç«¯äººå‘˜ï¼Œéƒ½å¯ä»¥é€šè¿‡ D2C æŠ€æœ¯å®ç°å‰ç«¯ä»£ç ã€‚å¯¹äºæ•´ä¸ªå¼€å‘æµç¨‹æ¥è¯´ï¼Œè¿™æ— å¼‚æé«˜äº†å¼€å‘æ•ˆç‡ã€èŠ‚çœäº†å¤§é‡çš„å¼€å‘æ—¶é—´ã€‚</p>
<p>Screenshot-to-code æ˜¯åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ä»‹ç»è¿‡çš„ä¸€æ¬¾ D2C äº§å“ï¼Œå¦‚ä¹‹å‰çš„æ–‡ç« æ‰€è¯´ï¼Œè™½ç„¶å®ƒå­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œä½†å¹¶ä¸å¦¨ç¢å®ƒåœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹èƒ½å‘æŒ¥å‡ºæ„æƒ³ä¸åˆ°çš„ä½œç”¨ã€‚è¯¦ç»†å¯ä»¥æŸ¥çœ‹ğŸ‘‰ã€Š<a href="https://juejin.cn/post/7592823500416761882" target="_blank" title="https://juejin.cn/post/7592823500416761882">è™½ç„¶ V0 å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯ ScreenshotToCode ä¾æ—§æœ‰å¸‚åœº</a>ã€‹ã€‚</p>
<h3 data-id="heading-1">åŸç†</h3>
<p>æ²¡æœ‰ç»†ç©¶è¿‡è¿™ä¸ª Agent çš„å®ç°åŸç†ï¼ˆå†è¯´ç»†ç©¶äº†ä¹Ÿä¸èƒ½å‘å‡ºæ¥ğŸ˜„ï¼‰ï¼Œåªèƒ½çŒœæµ‹å’Œ ScreenshotToCode ä»¥åŠ Figma MCP å¤§å·®ä¸å·®ã€‚</p>
<ul>
<li>åœ¨ ScreenshotToCode ä¸­éœ€è¦å¤šæ¨¡æ€æ¨¡å‹ï¼Œè¿™æ˜¯å› ä¸ºéœ€è¦ AI å»åˆ†æç†è§£è¿™äº›å›¾ç‰‡ï¼Œç„¶åå†ç”Ÿæˆä»£ç ã€‚æ•´ä¸ªæµç¨‹æ˜¯ï¼š<strong>å›¾ç‰‡è¾“å…¥</strong> â†’ <strong>LLMç†è§£</strong> â†’ <strong>ç›´æ¥è¾“å‡ºä»£ç ã€‚</strong></li>
<li>Figma MCP + CCï¼ˆæˆ–è€…å…¶ä»– AI ç¼–è¾‘å™¨ï¼‰å¯ä»¥å°† Figma è®¾è®¡å›¾ç›´æ¥è½¬ä¸ºå¯ç”¨çš„ HTML/React/Vue/CSS ä»£ç ã€‚<strong>å…ˆé€šè¿‡ MCP å°† Figma è®¾è®¡ç¨¿è½¬ä¸ºç»“æ„åŒ–æ•°æ®ï¼Œå†å°†æ•°æ®äº¤ç»™ AI è¿›è¡Œä»£ç è½¬æ¢</strong>ã€‚è¯¦è§ã€Š<a href="https://juejin.cn/post/7597253913249038377" target="_blank" title="https://juejin.cn/post/7597253913249038377">D2C çš„å¦ä¸€ç§é€‰æ‹©â€”Figma MCP + Claude Code</a>ã€‹ ã€‚</li>
<li>è¿˜æœ‰ä¸€äº›æ—©å°±å­˜åœ¨çš„è½¬æ¢æŠ€æœ¯ï¼Œè¿™ç§å¹¶ä¸éœ€è¦å€ŸåŠ© AIï¼Œæ¯”å¦‚ 58 åŒåŸåœ¨ 20 å¹´ 9 æœˆå¼€æºçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpicassoui.58.com%2F" target="_blank" title="https://picassoui.58.com/" ref="nofollow noopener noreferrer">Picasso</a>ã€‚å®ƒçš„å·¥ä½œåŸç†å°±æ˜¯å…ˆè§£æ Sketch è®¾è®¡æ–‡ä»¶ï¼Œæå–å›¾å±‚ã€æ ·å¼ã€å¸ƒå±€ç­‰ä¿¡æ¯ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºå†…éƒ¨DSLï¼Œå¹¶å¯¹å…¶è¿›è¡Œæ ·å¼è½¬æ¢ï¼ŒåŒ…æ‹¬å•ä½è½¬æ¢ï¼ˆpxâ†’rem/rpxï¼‰ã€å¹³å°ç‰¹å®šå±æ€§å¤„ç†ç­‰ï¼Œæœ€åæ ¹æ®è½¬æ¢åçš„DSLç”Ÿæˆå¯¹åº”å¹³å°çš„å‰ç«¯ä»£ç ã€‚</li>
</ul>
<h3 data-id="heading-2">æ€»ç»“</h3>
<p>ä»æ¨¡å¼ä¸Šæ¥çœ‹ï¼ŒD2C çš„æ–¹å¼æœ‰å››ç§ï¼š</p>
<ul>
<li>æ—©æœŸç±»ä¼¼ Picasso è¿™ç§ï¼Œé€šè¿‡åº•å±‚ç®—æ³•å°†è®¾è®¡ç¨¿å…ˆè½¬ä¸º DSLï¼Œå†å°† DSL è½¬ä¸ºå‰ç«¯ä»£ç ï¼ˆä½†å®ƒåªæœåŠ¡äºå®‰å“ï¼‰ã€‚å³<strong>å…ˆå°†è®¾è®¡ç¨¿è½¬ä¸ºç‰¹å®šæ•°æ®ç»“æ„ï¼Œå†å°†å…¶è½¬ä¸ºä»£ç </strong>ã€‚</li>
<li><strong>ä½ä»£ç å¹³å°</strong>å…¶å®ä¹Ÿæ˜¯ D2C çš„ä¸€ç§ï¼Œè®¾è®¡å¸ˆæˆ–è€…äº§å“å¯ä»¥é€šè¿‡æ‰˜æ‹‰æ‹½çš„æ–¹å¼è¿›è¡Œä¸€äº›é¡µé¢è®¾è®¡ï¼Œå¹¶å¯¼å‡ºå¯¹åº”ä»£ç ã€‚</li>
<li>å†å°±æ˜¯<strong>åˆ©ç”¨å¤šæ¨¡æ€æ¨¡å‹ç†è§£å’Œåˆ†æå›¾ç‰‡ç»„æˆï¼Œå†é€šè¿‡ä»£ç è¿›è¡Œâ€œå¤åŸâ€</strong> ï¼Œä¾‹å¦‚ ScreenshotToCodeã€‚</li>
<li>æœ€åä¸€ç§å¯ä»¥è¯´æ˜¯ç¬¬ä¸€ç§æ–¹å¼çš„æ”¹è¿›ç‰ˆï¼Œ<strong>è®¾è®¡ç¨¿è¢«è½¬åŒ–ä¸ºç‰¹å®šæ•°æ®ç»“æ„ä¹‹åï¼Œé€šè¿‡ AI æ¥è¯»å–å’Œåˆ†æè¿™äº›å›¾å±‚æ•°æ®ï¼Œç„¶åè¾“å‡ºæˆç”¨æˆ·æŒ‡å®šçš„ä»£ç </strong>ã€‚æ¯”å¦‚é€šè¿‡ Figma MCP + Claude Code å®ç°è®¾è®¡ç¨¿è¿˜åŸã€‚</li>
</ul>
<p>D2C å¸¦æ¥çš„<strong>æ”¶ç›Š</strong>æ˜¯å·¨å¤§çš„ï¼š</p>
<ul>
<li>æ‰“ç ´äº†ä¼ ç»Ÿå¼€å‘ä¸­çš„åä½œå£å’å’Œè§’è‰²è¾¹ç•Œï¼š</li>
<li>ä¼ ç»Ÿå¼€å‘ä¸­ï¼Œä»è®¾è®¡ç¨¿åˆ°ä»£ç ï¼Œéœ€è¦äººå·¥æ ¡å¯¹ï¼Œæ•´ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šå‡ºç°ä¸€äº›ç»†å¾®åå·®ã€‚D2C é€šè¿‡ AI åŠ æŒï¼Œå®ç°äº†åƒç´ çº§åˆ«çš„è¿˜åŸï¼Œå‡å°‘äº†æ²Ÿé€šæˆæœ¬å’Œå¼€å‘æˆæœ¬ã€‚</li>
<li>ç”šè‡³è¯´äº§å“ç»ç†å¯ä»¥åœ¨åŸå‹è®¾è®¡é˜¶æ®µï¼Œå°±é€šè¿‡ D2C æŠ€æœ¯ç”Ÿæˆä¸€ä»½åŸºç¡€ä»£ç ï¼Œå‰ç«¯åªéœ€è¦è¿›è¡Œä¸€äº›â€œå–„åâ€å·¥ä½œã€‚</li>
<li>æˆå€å¢é•¿çš„å¼€å‘æ•ˆç‡ï¼šè¿˜åŸè®¾è®¡ç¨¿çš„æ—¶é—´è¢«å¤§å¤§ç¼©çŸ­ï¼Œå‰ç«¯å¼€å‘äººå‘˜å¯ä»¥å°†æ›´å¤šçš„ç²¾åŠ›æŠ•å…¥åˆ°ä¸šåŠ¡é€»è¾‘å’Œç»†èŠ‚è°ƒæ•´ä¸Š</li>
<li>æ‰“ç ´æŠ€æœ¯æ ˆçš„åƒµåŒ–è¾¹ç•Œï¼šå¯ä»¥æŒ‡å®šå®ƒç”¨ Vueã€Reactã€Angularã€å°ç¨‹åºç­‰æ¡†æ¶è¿›è¡Œå¼€å‘ã€‚</li>
</ul>
<p>åŒæ—¶ä¹Ÿå¸¦æ¥ä¸€äº›<strong>æŒ‘æˆ˜</strong>ï¼š</p>
<ul>
<li>é«˜æ•ˆçš„åŒæ—¶ï¼Œå¯èƒ½ä¼šä¼´éšç€äººå‘˜çš„å‡å°‘ã€‚æ¯•ç«Ÿå¹³æ—¶ä¸¤ä¸‰ä¸ªäººä¸€å‘¨çš„æ´»ï¼Œæœ‰äº† D2C ä»¥åä¸€ä¸ªäººä¸¤ä¸‰å¤©å°±æå®šäº†ï¼›</li>
<li>å‰ç«¯çš„è¾¹ç•Œè¢«æ¨¡ç³Šï¼Œå‰ç«¯äººéœ€è¦åœ¨ä¸“ä¸šèƒ½åŠ›å’Œä¸šåŠ¡èƒ½åŠ›ä¸ŠæŠ•å…¥æ›´å¤§çš„ç²¾åŠ›ï¼Œéœ€è¦å‘ä¸Šæ‰¿æ¥ä¸šåŠ¡é€»è¾‘æ•´åˆï¼Œå‘ä¸‹æ·±å…¥æ€§èƒ½ä¼˜åŒ–ï¼Œè§’è‰²æ›´åå‘â€œå‰ç«¯æ¶æ„å¸ˆâ€ï¼›</li>
</ul>
<p>å½“ç„¶è¿™å¹¶ä¸æ˜¯è¯´ä¼šå–ä»£å‰ç«¯å·¥ç¨‹å¸ˆï¼Œè€Œæ˜¯å°†å…¶ä»é‡å¤åŠ³åŠ¨ä¸­è§£æ”¾ï¼Œæ›´èšç„¦äºï¼š</p>
<ul>
<li>å¤æ‚ç³»ç»Ÿè®¾è®¡ä¸æ¶æ„</li>
<li>æ€§èƒ½ä¼˜åŒ–ä¸ç”¨æˆ·ä½“éªŒæ·±åŒ–</li>
<li>å·¥ç¨‹åŒ–ä¸åŸºç¡€è®¾æ–½æ­å»º</li>
<li>è·¨ç«¯æ•´åˆä¸æ–°æŠ€æœ¯æ¢ç´¢</li>
<li>ç­‰ç­‰</li>
</ul>
<p>AI çš„è¿­ä»£æ—¥æ–°æœˆå¼‚ï¼Œä¸ç®¡æ˜¯å‰ç«¯è¿˜æ˜¯åç«¯å¼€å‘ï¼Œéƒ½è¦ç´§è·Ÿæ­¥ä¼ï¼Œè¿™æ ·æ‰ä¸ä¼šè¢«æŠ€æœ¯æ›´æ–°æ‰€æ·˜æ±°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1.8GB å†…å­˜ä¹Ÿèƒ½è·‘å¤§æ¨¡å‹ï¼Ollama Docker éƒ¨ç½²å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7598480267218157602</link>    <guid>https://juejin.cn/post/7598480267218157602</guid>    <pubDate>2026-01-24T13:05:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598480267218157602" data-draft-id="7598465042968690728" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1.8GB å†…å­˜ä¹Ÿèƒ½è·‘å¤§æ¨¡å‹ï¼Ollama Docker éƒ¨ç½²å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-24T13:05:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€è¯ºæ»šé›ªçƒ"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1.8GB å†…å­˜ä¹Ÿèƒ½è·‘å¤§æ¨¡å‹ï¼Ollama Docker éƒ¨ç½²å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€è¯ºæ»šé›ªçƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T13:05:11.000Z" title="Sat Jan 24 2026 13:05:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æƒ³åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²ç§æœ‰ AI æ¨¡å‹ï¼Œä½†å†…å­˜ä¸å¤Ÿç”¨ï¼Ÿæœ¬æ–‡æ•™ä½ ç”¨ Docker + Swap ä¼˜åŒ–ï¼Œè®©ä½é…æœåŠ¡å™¨ä¹Ÿèƒ½æµç•…è¿è¡Œ Ollama å¤§æ¨¡å‹ã€‚</p>
</blockquote>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>ä¸ºä»€ä¹ˆé€‰æ‹© Docker éƒ¨ç½²ï¼Ÿ</p>
<p>å› ä¸ºç›´æ¥ä½¿ç”¨å‘½ä»¤ä¼šæŠ¥é”™ï¼Œæ— æ³•è¿è¡Œollamaã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffb57f08086847bfb1940e855e1ad8ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769864711&amp;x-signature=Xklf2G%2BpAmJv55iicHVXN9M4f6k%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">1. ç®€ä»‹</h2>
<h3 data-id="heading-2">1.1 ä¸ºä»€ä¹ˆä½¿ç”¨ Docker éƒ¨ç½²ï¼Ÿ</h3>





























<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>ç¯å¢ƒéš”ç¦»</strong></td><td>ä¸æ±¡æŸ“å®¿ä¸»æœºç¯å¢ƒï¼Œä¾èµ–é—®é¢˜å°‘</td></tr><tr><td><strong>ä¸€é”®éƒ¨ç½²</strong></td><td>å®¹å™¨åŒ–éƒ¨ç½²ï¼Œè·¨å¹³å°ä¸€è‡´æ€§å¥½</td></tr><tr><td><strong>æ˜“äºç®¡ç†</strong></td><td>é‡å¯ã€æ›´æ–°ã€è¿ç§»æ–¹ä¾¿</td></tr><tr><td><strong>èµ„æºæ§åˆ¶</strong></td><td>å¯é™åˆ¶å†…å­˜ã€CPU ä½¿ç”¨</td></tr><tr><td><strong>é€‚åˆç”Ÿäº§</strong></td><td>ç¨³å®šå¯é ï¼Œæ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 ç¡¬ä»¶è¦æ±‚</h3>

























<table><thead><tr><th>æ¨¡å‹è§„æ¨¡</th><th>å†…å­˜è¦æ±‚</th><th>æ¨èé…ç½®</th></tr></thead><tbody><tr><td>0.5B-3B</td><td>2-4GB</td><td>æœ€ä½ 2GB å¯ç”¨å†…å­˜</td></tr><tr><td>7B-14B</td><td>8-16GB</td><td>æœ€ä½ 8GB å¯ç”¨å†…å­˜</td></tr><tr><td>30B+</td><td>32GB+</td><td>æœ€ä½ 32GB å¯ç”¨å†…å­˜</td></tr></tbody></table>
<h3 data-id="heading-4">1.3 ä½é…æœåŠ¡å™¨ï¼ˆ&lt;2GB å†…å­˜ï¼‰</h3>
<p>å¦‚æœä½ çš„æœåŠ¡å™¨å†…å­˜ä¸è¶³ï¼ˆå¦‚ 1GB-2GBï¼‰ï¼Œè¿è¡Œå¤§æ¨¡å‹ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">Error</span>: <span class="hljs-number">500</span> Internal <span class="hljs-built_in">Server</span> <span class="hljs-keyword">Error</span>: llama runner process has terminated: signal: killed
</code></pre>
<h4 data-id="heading-5">ä»€ä¹ˆæ˜¯ Swapï¼Ÿ</h4>
<p>Swap æ˜¯ Linux ç³»ç»Ÿä¸­çš„ä¸€å—<strong>ç¡¬ç›˜ç©ºé—´</strong>ï¼Œå½“ä½œ"å¤‡ç”¨å†…å­˜"ä½¿ç”¨ã€‚å½“ç‰©ç†å†…å­˜ï¼ˆRAMï¼‰ä¸å¤Ÿç”¨æ—¶ï¼Œç³»ç»Ÿä¼šæŠŠæš‚æ—¶ä¸ç”¨çš„æ•°æ®ä»å†…å­˜æ¬åˆ° Swap ä¸­ï¼Œè…¾å‡ºç‰©ç†å†…å­˜ç»™éœ€è¦è¿è¡Œçš„ç¨‹åºã€‚</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰©ç†å†…å­˜ (RAM)     =  ä½ çš„åŠå…¬æ¡Œï¼ˆå¿«é€Ÿä½†å°ï¼‰    â”‚
â”‚  Swap (è™šæ‹Ÿå†…å­˜)    =  æ—è¾¹çš„å‚¨ç‰©æŸœï¼ˆæ…¢ä½†å¤§ï¼‰    â”‚
â”‚                                                 â”‚
â”‚  å½“åŠå…¬æ¡Œæ”¾æ»¡ä¸œè¥¿æ—¶ï¼š                            â”‚
â”‚  æŠŠä¸å¸¸ç”¨çš„æ–‡ä»¶ â†’ æ”¾åˆ°å‚¨ç‰©æŸœ (Swap)             â”‚
â”‚  è…¾å‡ºç©ºé—´ â†’ æ”¾ç½®æ­£åœ¨å¤„ç†çš„æ–‡ä»¶                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-6">Swap çš„ä½œç”¨</h4>





















<table><thead><tr><th>ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>é˜²æ­¢ç³»ç»Ÿå´©æºƒ</strong></td><td>å†…å­˜ä¸è¶³æ—¶ï¼Œç”¨ Swap è¡¥å……ï¼Œé¿å…è¿›ç¨‹è¢«æ€æ­»</td></tr><tr><td><strong>è¿è¡Œå¤§ç¨‹åº</strong></td><td>å…è®¸è¿è¡Œè¶…å‡ºç‰©ç†å†…å­˜çš„ç¨‹åºï¼ˆå¦‚å¤§è¯­è¨€æ¨¡å‹ï¼‰</td></tr><tr><td><strong>å†…å­˜å›æ”¶</strong></td><td>æŠŠä¸æ´»è·ƒçš„å†…å­˜é¡µé¢ç§»åˆ° Swapï¼Œé‡Šæ”¾ç‰©ç†å†…å­˜</td></tr></tbody></table>
<h4 data-id="heading-7">ä¸ºä»€ä¹ˆéœ€è¦ Swapï¼Ÿ</h4>
<pre><code class="hljs language-diff" lang="diff">ä½ çš„æœåŠ¡å™¨é…ç½®ï¼š
<span class="hljs-deletion">- ç‰©ç†å†…å­˜ï¼š1.8GB</span>
<span class="hljs-deletion">- æƒ³è¿è¡Œï¼š3b æ¨¡å‹ï¼ˆéœ€è¦ ~4GB å†…å­˜ï¼‰</span>

æ²¡æœ‰ Swapï¼š
1.8GB &lt; 4GB â†’ ç¨‹åºè¢«æ€æ­» âŒ

æœ‰ 5GB Swapï¼š
1.8GB + 5GB = 6.8GB &gt; 4GB â†’ å¯ä»¥è¿è¡Œ âœ…
</code></pre>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šä½¿ç”¨ Swap ä¼šç‰ºç‰²æ€§èƒ½ï¼ˆç¡¬ç›˜é€Ÿåº¦çº¦ä¸ºå†…å­˜çš„ 1/100ï¼‰ï¼Œä½†æ€»æ¯”ç¨‹åºå´©æºƒå¥½ã€‚</p>
</blockquote>
<h4 data-id="heading-8">æ·»åŠ  Swap è™šæ‹Ÿå†…å­˜</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»º 4GB swap æ–‡ä»¶</span>
<span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/swapfile bs=1M count=4096
<span class="hljs-built_in">chmod</span> 600 /swapfile
mkswap /swapfile
swapon /swapfile

<span class="hljs-comment"># æ°¸ä¹…ç”Ÿæ•ˆ</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'/swapfile none swap sw 0 0'</span> &gt;&gt; /etc/fstab

<span class="hljs-comment"># éªŒè¯</span>
free -h
</code></pre>
<h4 data-id="heading-9">ä¸åŒå†…å­˜é…ç½®çš„æ¨¡å‹æ¨è</h4>






























<table><thead><tr><th>æœåŠ¡å™¨å†…å­˜</th><th>æ¨èæ¨¡å‹</th><th>Swap éœ€æ±‚</th></tr></thead><tbody><tr><td>1GB</td><td>qwen2.5-coder:0.5b</td><td>å»ºè®® 2GB</td></tr><tr><td>2GB</td><td>qwen2.5-coder:0.5b / 1.5b</td><td>å»ºè®® 3GB</td></tr><tr><td>4GB</td><td>qwen2.5-coder:3b</td><td>ä¸éœ€è¦</td></tr><tr><td>8GB+</td><td>qwen2.5-coder:7b</td><td>ä¸éœ€è¦</td></tr></tbody></table>
<h4 data-id="heading-10">Swap æ€§èƒ½åˆ¤æ–­</h4>






























<table><thead><tr><th>Swap ä½¿ç”¨é‡</th><th>çŠ¶æ€</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>0-500MB</td><td>æ­£å¸¸</td><td>æ— éœ€å¤„ç†</td></tr><tr><td>500MB-1GB</td><td>ä¸€èˆ¬</td><td>æ³¨æ„æ€§èƒ½</td></tr><tr><td>1GB-2GB</td><td>è¾ƒæ…¢</td><td>è€ƒè™‘æ¢å°æ¨¡å‹</td></tr><tr><td>&gt;2GB</td><td>å¾ˆæ…¢</td><td>å¿…é¡»æ¢å°æ¨¡å‹</td></tr></tbody></table>
<h4 data-id="heading-11">å†…å­˜ç›‘æ§å‘½ä»¤</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰å†…å­˜å’Œ Swap çŠ¶æ€</span>
free -h

<span class="hljs-comment"># å®æ—¶ç›‘æ§å†…å­˜ï¼ˆæ¯ 1 ç§’åˆ·æ–°ï¼‰</span>
watch -n 1 free -h

<span class="hljs-comment"># æŸ¥çœ‹ Docker å®¹å™¨èµ„æºä½¿ç”¨</span>
docker stats ollama

<span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨å†…å­˜é™åˆ¶</span>
docker inspect ollama | grep -i memory

<span class="hljs-comment"># æŸ¥çœ‹ç³»ç»Ÿå†…å­˜é…ç½®</span>
<span class="hljs-built_in">cat</span> /proc/sys/vm/overcommit_memory
<span class="hljs-comment"># 0 = å¯å‘å¼è¿‡åº¦åˆ†é…ï¼ˆé»˜è®¤ï¼‰</span>
<span class="hljs-comment"># 1 = å§‹ç»ˆå…è®¸è¿‡åº¦åˆ†é…</span>
<span class="hljs-comment"># 2 = ä¸¥æ ¼æ§åˆ¶ï¼Œä¸å…è®¸è¿‡åº¦åˆ†é…</span>
</code></pre>
<h4 data-id="heading-12">è¿è¡Œæ¨¡å‹æ—¶å®æ—¶ç›‘æ§</h4>
<p>å¼€å¯ä¸¤ä¸ªç»ˆç«¯çª—å£ï¼š</p>
<p><strong>ç»ˆç«¯ 1ï¼šè¿è¡Œæ¨¡å‹</strong></p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it ollama ollama run qwen2.5-coder:0.5b
</code></pre>
<p><strong>ç»ˆç«¯ 2ï¼šå®æ—¶ç›‘æ§</strong></p>
<pre><code class="hljs language-bash" lang="bash">watch -n 1 <span class="hljs-string">'free -h &amp;&amp; echo "---" &amp;&amp; docker stats ollama --no-stream'</span>
</code></pre>
<h4 data-id="heading-13">å¸¸è§é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜ï¼šæ¨¡å‹è¿è¡Œæ—¶è¢«æ€æ­»</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æ£€æŸ¥å®¹å™¨å†…å­˜é™åˆ¶</span>
docker inspect ollama | grep -i memory

<span class="hljs-comment"># 2. å¦‚æœæœ‰å†…å­˜é™åˆ¶ï¼Œé‡æ–°åˆ›å»ºå®¹å™¨</span>
docker <span class="hljs-built_in">rm</span> -f ollama
docker run -d \
  -p 11434:11434 \
  --name ollama \
  --restart always \
  --memory-swap=-1 \
  ollama/ollama:latest

<span class="hljs-comment"># 3. å¯ç”¨å†…å­˜è¿‡åº¦åˆ†é…</span>
<span class="hljs-built_in">echo</span> 1 | sudo <span class="hljs-built_in">tee</span> /proc/sys/vm/overcommit_memory
<span class="hljs-built_in">echo</span> <span class="hljs-string">'vm.overcommit_memory = 1'</span> | sudo <span class="hljs-built_in">tee</span> -a /etc/sysctl.conf
sudo sysctl -p

<span class="hljs-comment"># 4. é‡å¯å®¹å™¨</span>
docker restart ollama
</code></pre>
<p><strong>é—®é¢˜ï¼šSwap ä½¿ç”¨è¿‡é«˜å¯¼è‡´å¡é¡¿</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ Swap ä½¿ç”¨</span>
free -h

<span class="hljs-comment"># å¦‚æœ Swap ä½¿ç”¨ &gt; 1GBï¼Œå»ºè®®åˆ‡æ¢åˆ°æ›´å°çš„æ¨¡å‹</span>
docker <span class="hljs-built_in">exec</span> -it ollama ollama run qwen2.5-coder:0.5b
</code></pre>
<hr/>
<h2 data-id="heading-14">2. å®‰è£… Docker</h2>
<h3 data-id="heading-15">2.1 Ubuntu/Debian</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€é”®å®‰è£… Docker</span>
curl -fsSL https://get.docker.com | sh

<span class="hljs-comment"># å°†å½“å‰ç”¨æˆ·åŠ å…¥ docker ç»„ï¼ˆå… sudoï¼‰</span>
sudo usermod -aG docker <span class="hljs-variable">$USER</span>

<span class="hljs-comment"># é‡æ–°ç™»å½•æˆ–æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä½¿ç»„æƒé™ç”Ÿæ•ˆ</span>
newgrp docker

<span class="hljs-comment"># éªŒè¯å®‰è£…</span>
docker --version
</code></pre>
<h3 data-id="heading-16">2.2 CentOS/RHEL</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£… Docker</span>
sudo yum install -y docker

<span class="hljs-comment"># å¯åŠ¨ Docker æœåŠ¡</span>
sudo systemctl start docker
sudo systemctl <span class="hljs-built_in">enable</span> docker

<span class="hljs-comment"># å°†å½“å‰ç”¨æˆ·åŠ å…¥ docker ç»„</span>
sudo usermod -aG docker <span class="hljs-variable">$user</span>

<span class="hljs-comment"># éªŒè¯å®‰è£…</span>
docker --version
</code></pre>
<h3 data-id="heading-17">2.3 éªŒè¯ Docker å®‰è£…</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿è¡Œæµ‹è¯•å®¹å™¨</span>
docker run hello-world

<span class="hljs-comment"># æŸ¥çœ‹ Docker ç‰ˆæœ¬</span>
docker --version
docker info
</code></pre>
<hr/>
<h2 data-id="heading-18">3. éƒ¨ç½² Ollama å®¹å™¨</h2>
<h3 data-id="heading-19">3.1 æ‹‰å–é•œåƒ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‹‰å–æœ€æ–°ç‰ˆ Ollama é•œåƒ</span>
docker pull ollama/ollama:latest

<span class="hljs-comment"># æˆ–æŒ‡å®šç‰ˆæœ¬</span>
docker pull ollama/ollama:0.5.7
</code></pre>
<h3 data-id="heading-20">3.2 å¯åŠ¨å®¹å™¨</h3>
<p><strong>CPU æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  -p 11434:11434 \
  --name ollama \
  --restart always \
  ollama/ollama:latest
</code></pre>
<p><strong>GPU æ¨¡å¼ï¼ˆéœ€è¦ NVIDIA GPUï¼‰ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é¦–å…ˆå®‰è£… NVIDIA Container Toolkit</span>
distribution=$(. /etc/os-release;<span class="hljs-built_in">echo</span> $ID<span class="hljs-variable">$VERSION_ID</span>)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/<span class="hljs-variable">$distribution</span>/nvidia-docker.list | \
  sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/nvidia-docker.list

sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit
sudo systemctl restart docker

<span class="hljs-comment"># å¯åŠ¨å¸¦ GPU çš„å®¹å™¨</span>
docker run -d \
  --gpus all \
  -p 11434:11434 \
  --name ollama \
  --restart always \
  ollama/ollama:latest
</code></pre>
<h3 data-id="heading-21">3.3 éªŒè¯å®¹å™¨è¿è¡Œ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨çŠ¶æ€</span>
docker ps

<span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span>
docker logs -f ollama

<span class="hljs-comment"># æµ‹è¯• API</span>
curl http://localhost:11434/api/tags
</code></pre>
<hr/>
<h2 data-id="heading-22">4. æ¨¡å‹ç®¡ç†</h2>
<h3 data-id="heading-23">4.1 æ‹‰å–æ¨¡å‹</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‹‰å– qwen2.5-coder:3b</span>
docker <span class="hljs-built_in">exec</span> -it ollama ollama pull qwen2.5-coder:3b

<span class="hljs-comment"># æ‹‰å–å…¶ä»–æ¨¡å‹</span>
docker <span class="hljs-built_in">exec</span> -it ollama ollama pull qwen2.5:7b
docker <span class="hljs-built_in">exec</span> -it ollama ollama pull deepseek-r1:7b
</code></pre>
<h3 data-id="heading-24">4.2 æŸ¥çœ‹å·²å®‰è£…æ¨¡å‹</h3>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it ollama ollama list
</code></pre>
<h3 data-id="heading-25">4.3 è¿è¡Œæ¨¡å‹ï¼ˆäº¤äº’å¼ï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it ollama ollama run qwen2.5-coder:3b
</code></pre>
<h3 data-id="heading-26">4.4 åˆ é™¤æ¨¡å‹</h3>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it ollama ollama <span class="hljs-built_in">rm</span> qwen2.5-coder:3b
</code></pre>
<h3 data-id="heading-27">4.5 æ¨èæ¨¡å‹</h3>



































<table><thead><tr><th>æ¨¡å‹</th><th>ç”¨é€”</th><th>å†…å­˜éœ€æ±‚</th></tr></thead><tbody><tr><td><code>qwen2.5-coder:0.5b</code></td><td>ä»£ç ç”Ÿæˆï¼ˆè½»é‡ï¼‰</td><td>~1GB</td></tr><tr><td><code>qwen2.5-coder:3b</code></td><td>ä»£ç ç”Ÿæˆï¼ˆæ¨èï¼‰</td><td>~4GB</td></tr><tr><td><code>qwen2.5-coder:7b</code></td><td>ä»£ç ç”Ÿæˆï¼ˆä¸“ä¸šï¼‰</td><td>~8GB</td></tr><tr><td><code>qwen2.5:3b</code></td><td>é€šç”¨å¯¹è¯</td><td>~4GB</td></tr><tr><td><code>qwen2.5:7b</code></td><td>é€šç”¨å¯¹è¯ï¼ˆæ¨èï¼‰</td><td>~8GB</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-28">5. API è°ƒç”¨</h2>
<h3 data-id="heading-29">5.1 åŸºç¡€è°ƒç”¨æ ¼å¼</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”Ÿæˆæ–‡æœ¬</span>
curl http://localhost:11434/api/generate -d <span class="hljs-string">'{
  "model": "qwen2.5-coder:3b",
  "prompt": "ç”¨pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åº",
  "stream": false
}'</span>

<span class="hljs-comment"># å¯¹è¯æ¨¡å¼</span>
curl http://localhost:11434/api/chat -d <span class="hljs-string">'{
  "model": "qwen2.5-coder:3b",
  "messages": [
    {"role": "user", "content": "ä½ å¥½"}
  ],
  "stream": false
}'</span>
</code></pre>
<h3 data-id="heading-30">5.2 å‚æ•°è¯´æ˜</h3>









































<table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>model</td><td>string</td><td>æ¨¡å‹åç§°</td><td>-</td></tr><tr><td>prompt</td><td>string</td><td>è¾“å…¥æ–‡æœ¬</td><td>-</td></tr><tr><td>stream</td><td>boolean</td><td>æ˜¯å¦æµå¼è¾“å‡º</td><td>true</td></tr><tr><td>temperature</td><td>number</td><td>æ¸©åº¦(0-1)ï¼Œè¶Šé«˜è¶Šéšæœº</td><td>0.8</td></tr><tr><td>num_ctx</td><td>number</td><td>ä¸Šä¸‹æ–‡é•¿åº¦</td><td>2048</td></tr></tbody></table>
<h3 data-id="heading-31">5.3 Python è°ƒç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

API_URL = <span class="hljs-string">"http://localhost:11434/api/generate"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_ollama</span>(<span class="hljs-params">prompt: <span class="hljs-built_in">str</span>, model: <span class="hljs-built_in">str</span> = <span class="hljs-string">"qwen2.5-coder:3b"</span></span>):
    response = requests.post(API_URL, json={
        <span class="hljs-string">"model"</span>: model,
        <span class="hljs-string">"prompt"</span>: prompt,
        <span class="hljs-string">"stream"</span>: <span class="hljs-literal">False</span>
    })
    <span class="hljs-keyword">return</span> response.json()[<span class="hljs-string">"response"</span>]

<span class="hljs-comment"># ä½¿ç”¨</span>
result = call_ollama(<span class="hljs-string">"ç”¨pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åº"</span>)
<span class="hljs-built_in">print</span>(result)
</code></pre>
<h3 data-id="heading-32">5.4 JavaScript è°ƒç”¨ç¤ºä¾‹</h3>
<h4 data-id="heading-33">æµè§ˆå™¨ç¯å¢ƒï¼ˆåŸç”Ÿ Fetchï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éæµå¼å“åº”</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callOllama</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"http://localhost:11434/api/generate"</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen2.5-coder:3b"</span>,
      <span class="hljs-attr">prompt</span>: prompt,
      <span class="hljs-attr">stream</span>: <span class="hljs-literal">false</span>
    })
  });

  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  <span class="hljs-keyword">return</span> data.<span class="hljs-property">response</span>;
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-title function_">callOllama</span>(<span class="hljs-string">"ç”¨pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åº"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>);
</code></pre>
<h4 data-id="heading-34">æµå¼å“åº”ï¼ˆæµè§ˆå™¨ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chatWithOllama</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"http://localhost:11434/v1/chat/completions"</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen2.5-coder:3b"</span>,
      <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: prompt }],
      <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>
    })
  });

  <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
  <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">""</span>;

  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;

    <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value);
    <span class="hljs-keyword">const</span> lines = chunk.<span class="hljs-title function_">split</span>(<span class="hljs-string">"\n"</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> line.<span class="hljs-title function_">trim</span>());

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
      <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"data: "</span>)) {
        <span class="hljs-keyword">const</span> data = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>);
        <span class="hljs-keyword">if</span> (data === <span class="hljs-string">"[DONE]"</span>) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
          <span class="hljs-keyword">const</span> content = json.<span class="hljs-property">choices</span>?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">delta</span>?.<span class="hljs-property">content</span>;
          <span class="hljs-keyword">if</span> (content) {
            result += content;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(content);  <span class="hljs-comment">// å®æ—¶è¾“å‡º</span>
          }
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-comment">// å¿½ç•¥è§£æé”™è¯¯</span>
        }
      }
    }
  }
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-title function_">chatWithOllama</span>(<span class="hljs-string">"ç”¨pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åº"</span>);
</code></pre>
<h4 data-id="heading-35">Node.js ç¯å¢ƒ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">"axios"</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callOllama</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(
    <span class="hljs-string">"http://localhost:11434/api/generate"</span>,
    {
      <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen2.5-coder:3b"</span>,
      <span class="hljs-attr">prompt</span>: prompt,
      <span class="hljs-attr">stream</span>: <span class="hljs-literal">false</span>
    }
  );

  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>.<span class="hljs-property">response</span>;
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-title function_">callOllama</span>(<span class="hljs-string">"ç”¨pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åº"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>);
</code></pre>
<h4 data-id="heading-36">å¸¦è®¤è¯çš„è°ƒç”¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¦‚æœè®¾ç½®äº† API å¯†é’¥</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callOllamaWithAuth</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"http://localhost:11434/api/generate"</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
      <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer your_api_key_here"</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen2.5-coder:3b"</span>,
      <span class="hljs-attr">prompt</span>: prompt,
      <span class="hljs-attr">stream</span>: <span class="hljs-literal">false</span>
    })
  });

  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  <span class="hljs-keyword">return</span> data.<span class="hljs-property">response</span>;
}
</code></pre>
<h3 data-id="heading-37">5.5 OpenAI å…¼å®¹æ ¼å¼ï¼ˆJavaScriptï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ OpenAI SDK è°ƒç”¨ Ollama</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;

<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"http://localhost:11434/v1"</span>,
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">"ollama"</span>  <span class="hljs-comment">// ä¸éœ€è¦çœŸå® key</span>
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen2.5-coder:3b"</span>,
    <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: prompt }]
  });

  <span class="hljs-keyword">return</span> response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>;
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-title function_">chat</span>(<span class="hljs-string">"ç”¨pythonå†™ä¸€ä¸ªå¿«é€Ÿæ’åº"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>);
</code></pre>
<h3 data-id="heading-38">5.6 å¤–ç½‘è°ƒç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¦‚æœé…ç½®äº†å¤–ç½‘è®¿é—®ï¼ˆéœ€è¦ HTTPS + API Keyï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callOllamaRemote</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://your-domain.com/api/generate"</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>,
      <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer your_secure_password"</span>
    },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"qwen2.5-coder:3b"</span>,
      <span class="hljs-attr">prompt</span>: prompt,
      <span class="hljs-attr">stream</span>: <span class="hljs-literal">false</span>
    })
  });

  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  <span class="hljs-keyword">return</span> data.<span class="hljs-property">response</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-39">6. å®¹å™¨ç®¡ç†</h2>
<h3 data-id="heading-40">6.1 æŸ¥çœ‹å®¹å™¨çŠ¶æ€</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</span>
docker ps

<span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰</span>
docker ps -a

<span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</span>
docker inspect ollama
</code></pre>
<h3 data-id="heading-41">6.2 æ—¥å¿—ç®¡ç†</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å®æ—¶æ—¥å¿—</span>
docker logs -f ollama

<span class="hljs-comment"># æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—</span>
docker logs --<span class="hljs-built_in">tail</span> 100 ollama

<span class="hljs-comment"># æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—</span>
docker logs -t ollama
</code></pre>
<h3 data-id="heading-42">6.3 å¯åœé‡å¯</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœæ­¢å®¹å™¨</span>
docker stop ollama

<span class="hljs-comment"># å¯åŠ¨å®¹å™¨</span>
docker start ollama

<span class="hljs-comment"># é‡å¯å®¹å™¨</span>
docker restart ollama

<span class="hljs-comment"># åˆ é™¤å®¹å™¨ï¼ˆéœ€å…ˆåœæ­¢ï¼‰</span>
docker <span class="hljs-built_in">rm</span> -f ollama
</code></pre>
<h3 data-id="heading-43">6.4 è¿›å…¥å®¹å™¨</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥å®¹å™¨ shell</span>
docker <span class="hljs-built_in">exec</span> -it ollama bash

<span class="hljs-comment"># åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</span>
docker <span class="hljs-built_in">exec</span> -it ollama ollama list
</code></pre>
<hr/>
<h2 data-id="heading-44">7. è¿›é˜¶é…ç½®</h2>
<h3 data-id="heading-45">7.1 æŒä¹…åŒ–æ¨¡å‹å­˜å‚¨</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å‹å­˜å‚¨åœ¨å®¹å™¨å†…éƒ¨ï¼Œåˆ é™¤å®¹å™¨åæ¨¡å‹ä¼šä¸¢å¤±ã€‚ä½¿ç”¨æŒ‚è½½å·æŒä¹…åŒ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ é™¤æ—§å®¹å™¨</span>
docker <span class="hljs-built_in">rm</span> -f ollama

<span class="hljs-comment"># é‡æ–°åˆ›å»ºï¼ŒæŒ‚è½½æœ¬åœ°ç›®å½•</span>
docker run -d \
  -p 11434:11434 \
  -v ollama_data:/root/.ollama \
  --name ollama \
  --restart always \
  ollama/ollama:latest
</code></pre>
<h3 data-id="heading-46">7.2 èµ„æºé™åˆ¶</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é™åˆ¶å†…å­˜ä½¿ç”¨ä¸º 4GB</span>
docker run -d \
  -p 11434:11434 \
  --memory=4g \
  --name ollama \
  --restart always \
  ollama/ollama:latest

<span class="hljs-comment"># é™åˆ¶ CPU ä½¿ç”¨</span>
docker run -d \
  -p 11434:11434 \
  --cpus=2.0 \
  --name ollama \
  --restart always \
  ollama/ollama:latest
</code></pre>
<h3 data-id="heading-47">7.3 ç¯å¢ƒå˜é‡é…ç½®</h3>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  -p 11434:11434 \
  -e OLLAMA_HOST=0.0.0.0:11434 \
  -e OLLAMA_NUM_PARALLEL=4 \
  -e OLLAMA_DEBUG=0 \
  -v ollama_data:/root/.ollama \
  --name ollama \
  --restart always \
  ollama/ollama:latest
</code></pre>
<h3 data-id="heading-48">7.4 ä½¿ç”¨ Docker Compose</h3>
<p>åˆ›å»º <code>docker-compose.yml</code>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">ollama:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">ollama/ollama:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">ollama</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"11434:11434"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ollama_data:/root/.ollama</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">OLLAMA_HOST=0.0.0.0:11434</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">OLLAMA_NUM_PARALLEL=4</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-comment"># GPU é…ç½®ï¼ˆéœ€è¦ nvidia-dockerï¼‰</span>
    <span class="hljs-comment"># deploy:</span>
    <span class="hljs-comment">#   resources:</span>
    <span class="hljs-comment">#     reservations:</span>
    <span class="hljs-comment">#       devices:</span>
    <span class="hljs-comment">#         - driver: nvidia</span>
    <span class="hljs-comment">#           count: all</span>
    <span class="hljs-comment">#           capabilities: [gpu]</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">ollama_data:</span>
</code></pre>
<p>å¯åŠ¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker-compose up -d
</code></pre>
<h3 data-id="heading-49">7.5 å›½å†…é•œåƒåŠ é€Ÿ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨å›½å†…é•œåƒæº</span>
docker pull registry.cn-hangzhou.aliyuncs.com/ollama/ollama:latest

<span class="hljs-comment"># æˆ–ä½¿ç”¨ä»£ç†</span>
docker pull ollama/ollama:latest
</code></pre>
<hr/>
<h2 data-id="heading-50">8. æ•…éšœæ’æŸ¥</h2>
<h3 data-id="heading-51">8.1 å®¹å™¨å¯åŠ¨å¤±è´¥</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span>
docker logs ollama

<span class="hljs-comment"># å¸¸è§é”™è¯¯ï¼šGPU é…ç½®é—®é¢˜</span>
<span class="hljs-comment"># è§£å†³æ–¹æ¡ˆï¼šåˆ é™¤å®¹å™¨ï¼Œä½¿ç”¨ CPU æ¨¡å¼é‡æ–°åˆ›å»º</span>
docker <span class="hljs-built_in">rm</span> -f ollama
docker run -d -p 11434:11434 --name ollama --restart always ollama/ollama:latest
</code></pre>
<h3 data-id="heading-52">8.2 æ— æ³•è®¿é—® API</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ</span>
docker ps

<span class="hljs-comment"># æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®æ˜ å°„</span>
docker port ollama

<span class="hljs-comment"># æµ‹è¯•å®¹å™¨å†…éƒ¨ API</span>
docker <span class="hljs-built_in">exec</span> ollama curl http://localhost:11434/api/tags

<span class="hljs-comment"># æ£€æŸ¥é˜²ç«å¢™</span>
sudo ufw status  <span class="hljs-comment"># Ubuntu</span>
sudo firewall-cmd --list-all  <span class="hljs-comment"># CentOS</span>
</code></pre>
<h3 data-id="heading-53">8.3 æ¨¡å‹åŠ è½½æ…¢</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ</span>
docker stats ollama

<span class="hljs-comment"># æ£€æŸ¥ç£ç›˜ IO</span>
docker <span class="hljs-built_in">exec</span> ollama <span class="hljs-built_in">df</span> -h
</code></pre>
<h3 data-id="heading-54">8.4 å†…å­˜ä¸è¶³</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨</span>
docker stats --no-stream

<span class="hljs-comment"># ä½¿ç”¨æ›´å°çš„æ¨¡å‹</span>
docker <span class="hljs-built_in">exec</span> -it ollama ollama pull qwen2.5-coder:0.5b

<span class="hljs-comment"># æˆ–é™åˆ¶å®¹å™¨å†…å­˜</span>
docker update --memory=4g ollama
</code></pre>
<hr/>
<h2 data-id="heading-55">9. ç”Ÿäº§éƒ¨ç½²å»ºè®®</h2>
<h3 data-id="heading-56">9.1 å®‰å…¨é…ç½®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç»‘å®šåˆ°æœ¬åœ°åœ°å€</span>
docker run -d \
  -p 127.0.0.1:11434:11434 \
  --name ollama \
  ollama/ollama:latest

<span class="hljs-comment"># ä½¿ç”¨åå‘ä»£ç†ï¼ˆNginxï¼‰é…ç½® HTTPS</span>
</code></pre>
<h3 data-id="heading-57">9.2 ç›‘æ§é…ç½®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ Prometheus + Grafana ç›‘æ§</span>
docker run -d \
  --name prometheus \
  -p 9090:9090 \
  prom/prometheus

<span class="hljs-comment"># é…ç½® cAdvisor ç›‘æ§å®¹å™¨</span>
docker run -d \
  --name cadvisor \
  -p 8080:8080 \
  google/cadvisor:latest
</code></pre>
<h3 data-id="heading-58">9.3 é«˜å¯ç”¨é…ç½®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨è´Ÿè½½å‡è¡¡</span>
<span class="hljs-comment"># éƒ¨ç½²å¤šä¸ª Ollama å®ä¾‹ï¼Œé€šè¿‡ Nginx è´Ÿè½½å‡è¡¡</span>

<span class="hljs-comment"># ä½¿ç”¨å¥åº·æ£€æŸ¥</span>
docker run -d \
  --name ollama \
  --health-cmd=<span class="hljs-string">"curl -f http://localhost:11434/api/tags || exit 1"</span> \
  --health-interval=30s \
  --health-timeout=10s \
  --health-retries=3 \
  ollama/ollama:latest
</code></pre>
<hr/>
<h2 data-id="heading-59">10. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‹‰å–æ¨¡å‹</span>
docker <span class="hljs-built_in">exec</span> -it ollama ollama pull qwen2.5-coder:3b

<span class="hljs-comment"># æŸ¥çœ‹æ¨¡å‹åˆ—è¡¨</span>
docker <span class="hljs-built_in">exec</span> -it ollama ollama list

<span class="hljs-comment"># è¿è¡Œæ¨¡å‹</span>
docker <span class="hljs-built_in">exec</span> -it ollama ollama run qwen2.5-coder:3b

<span class="hljs-comment"># æŸ¥çœ‹æ—¥å¿—</span>
docker logs -f ollama

<span class="hljs-comment"># é‡å¯å®¹å™¨</span>
docker restart ollama

<span class="hljs-comment"># è¿›å…¥å®¹å™¨</span>
docker <span class="hljs-built_in">exec</span> -it ollama bash

<span class="hljs-comment"># åˆ é™¤å®¹å™¨</span>
docker <span class="hljs-built_in">rm</span> -f ollama

<span class="hljs-comment"># æµ‹è¯• API</span>
curl http://localhost:11434/api/tags
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§£å†³ChocolateyåŠ¨æ€æ›´æ–°ç¯å¢ƒå˜é‡åŠŸèƒ½ RefreshEnv.cmdåœ¨æ–°ç‰ˆ Windows ä¸Šçš„å…¼å®¹æ€§é—®é¢˜]]></title>    <link>https://juejin.cn/post/7598464972912787496</link>    <guid>https://juejin.cn/post/7598464972912787496</guid>    <pubDate>2026-01-24T13:24:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598464972912787496" data-draft-id="7598459769239158818" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§£å†³ChocolateyåŠ¨æ€æ›´æ–°ç¯å¢ƒå˜é‡åŠŸèƒ½ RefreshEnv.cmdåœ¨æ–°ç‰ˆ Windows ä¸Šçš„å…¼å®¹æ€§é—®é¢˜"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-01-24T13:24:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§£å†³ChocolateyåŠ¨æ€æ›´æ–°ç¯å¢ƒå˜é‡åŠŸèƒ½ RefreshEnv.cmdåœ¨æ–°ç‰ˆ Windows ä¸Šçš„å…¼å®¹æ€§é—®é¢˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T13:24:49.000Z" title="Sat Jan 24 2026 13:24:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Windows 10/11 ç³»ç»Ÿä¸Šè¿è¡Œ Chocolatey çš„ç¯å¢ƒå˜é‡åˆ·æ–°è„šæœ¬ <code>RefreshEnv.cmd</code> æ—¶ï¼Œæœ‰æ—¶ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-string">'wmic'</span> ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº
æˆ–æ‰¹å¤„ç†æ–‡ä»¶ã€‚
Refreshing environment variables <span class="hljs-keyword">from</span> registry <span class="hljs-keyword">for</span> cmd.exe. Please wait...Finished..
</code></pre>
<h2 data-id="heading-0">é—®é¢˜åˆ†æ</h2>
<h3 data-id="heading-1">wmic æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p><code>wmic</code> (Windows Management Instrumentation Command-line) æ˜¯ Windows çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºé€šè¿‡ WMI æ¥å£æŸ¥è¯¢å’Œç®¡ç†ç³»ç»Ÿä¿¡æ¯ã€‚å®ƒå¯ä»¥ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿé…ç½®ã€ç®¡ç†è¿›ç¨‹å’ŒæœåŠ¡ç­‰ã€‚</p>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆä¼šæŠ¥é”™ï¼Ÿ</h3>
<p>å¾®è½¯åœ¨ Windows 10 21H2 å’Œ Windows 11 ä¸­å¼€å§‹å¼ƒç”¨ <code>wmic</code>ï¼Œè®¡åˆ’åœ¨æœªæ¥ç‰ˆæœ¬ä¸­å®Œå…¨ç§»é™¤å®ƒã€‚åœ¨è¾ƒæ–°çš„ Windows ç‰ˆæœ¬ï¼ˆå¦‚ Windows 10.0.26220ï¼‰ä¸­ï¼Œ<code>wmic</code> å‘½ä»¤å·²ç»ä¸å¯ç”¨ã€‚</p>
<h3 data-id="heading-3">è„šæœ¬åˆ†æ</h3>
<p><code>RefreshEnv.cmd</code> è„šæœ¬ä½¿ç”¨ <code>wmic</code> æ¥æ£€æµ‹çˆ¶è¿›ç¨‹ï¼Œä»¥ä¾¿ç¡®å®šè„šæœ¬æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ï¼ˆæ˜¯å¦è¢«å¤–éƒ¨è°ƒç”¨ï¼‰ã€‚ç›¸å…³ä»£ç ä½äºè„šæœ¬å¼€å¤´çš„è¿›ç¨‹æ£€æµ‹éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs language-batch" lang="batch">for /f "tokens=2 delims==" %%i in (
    'wmic Process WHERE "Name='!CmdExeName!' AND CommandLine LIKE '%%!uid!%%'" GET ParentProcessID /value'
) do (
    rem Get commandline of parent
    for /f "tokens=1,2,*" %%j in (
        'wmic Process WHERE "Handle='%%i'" GET CommandLine /value'
    ) do (
        ...
    )
)
</code></pre>
<h2 data-id="heading-4">è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-5">æ€è·¯</h3>
<p>ç”¨ PowerShell çš„ <code>Get-CimInstance</code> å‘½ä»¤æ›¿ä»£ <code>wmic</code> å‘½ä»¤ã€‚PowerShell çš„ CIM cmdlets æ˜¯å¾®è½¯æ¨èçš„ wmic æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-6">å®ç°æ­¥éª¤</h3>
<ol>
<li><strong>ä½¿ç”¨ Get-CimInstance è·å–çˆ¶è¿›ç¨‹ ID</strong></li>
</ol>
<pre><code class="hljs language-batch" lang="batch">REM Use PowerShell instead of wmic to get parent process ID
for /f "tokens=1" %%i in ('powershell -NoProfile -Command "$proc = Get-CimInstance Win32_Process | Where-Object { $_.Name -eq '!CmdExeName!' -and $_.CommandLine -like '*!uid!*' }; if ($proc) { $proc.ParentProcessId }"') do (
    set ParentPID=%%i
)
</code></pre>
<ol start="2">
<li><strong>ä½¿ç”¨ Get-CimInstance è·å–çˆ¶è¿›ç¨‹å‘½ä»¤è¡Œ</strong></li>
</ol>
<pre><code class="hljs language-batch" lang="batch">rem Get commandline of parent using PowerShell
for /f "tokens=*" %%l in ('powershell -NoProfile -Command "$proc = Get-CimInstance Win32_Process -Filter \"Handle = '!ParentPID!'\"; if ($proc) { $proc.CommandLine }"') do (
    set ParentCommandLine=%%l
)
</code></pre>
<ol start="3">
<li><strong>ä½¿ç”¨ Get-CimInstance è·å–çˆ¶è¿›ç¨‹è·¯å¾„</strong></li>
</ol>
<pre><code class="hljs language-batch" lang="batch">rem Get parent process path using PowerShell
for /f "tokens=*" %%p in ('powershell -NoProfile -Command "$proc = Get-CimInstance Win32_Process -Filter \"Handle = '!ParentPID!'\"; if ($proc) { $proc.ExecutablePath }"') do (
    set ParentPath=%%p
)
</code></pre>
<ol start="4">
<li><strong>ä¿ç•™åŸæœ‰çš„é€»è¾‘åˆ¤æ–­</strong></li>
</ol>
<pre><code class="hljs language-batch" lang="batch">rem Dequote parent path
set ParentPath=!ParentPath:"=!

rem Handle different invocations: C:\Windows\system32\cmd.exe , cmd.exe , cmd
for %%p in (!CmdPath! !CmdExeName! !CmdName!) do (
    if /i "!ParentPath!"=="%%p" set IsCmdParent=1
)

rem Check if we're running in cmd.exe with /c switch and this script path as argument
if !IsCmdParent!==1 (
    for /f "tokens=1,2,3*" %%a in ("!ParentCommandLine!") do (
        if /i "%%b"=="/c" (
            set ParentScriptPath=%%c
            set ParentScriptPath=!ParentScriptPath:"=!
            if "!ParentScriptPath!"=="%ScriptPath%" set IsExternal=1
        )
    )
)
</code></pre>
<h3 data-id="heading-7">éƒ¨ç½²æ–¹æ³•</h3>
<p>ç”±äº <code>RefreshEnv.cmd</code> ä½äºç³»ç»Ÿç›®å½• <code>C:\ProgramData\chocolatey\bin\redirects\</code>ï¼Œéœ€è¦ä½¿ç”¨ç®¡ç†å‘˜æƒé™è¿›è¡Œä¿®æ”¹ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ PowerShell å‘½ä»¤è¿›è¡Œéƒ¨ç½²ï¼š</p>
<pre><code class="hljs language-powershell" lang="powershell">Copy-Item 'ä¿®å¤åçš„æ–‡ä»¶è·¯å¾„' 'C:\ProgramData\chocolatey\bin\redirects\RefreshEnv.cmd' -Force
</code></pre>
<h2 data-id="heading-8">ç»“æœ</h2>
<p>ä¿®å¤åçš„ <code>RefreshEnv.cmd</code> è„šæœ¬å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸å†æŠ¥ <code>wmic</code> ä¸å¯ç”¨çš„é”™è¯¯ã€‚ç¯å¢ƒå˜é‡åˆ·æ–°åŠŸèƒ½æ¢å¤æ­£å¸¸ã€‚</p>
<h2 data-id="heading-9">æ€»ç»“</h2>
<ul>
<li><code>wmic</code> åœ¨æ–°ç‰ˆ Windows ä¸­å·²è¢«å¼ƒç”¨ï¼Œéœ€è¦ä½¿ç”¨ PowerShell çš„ CIM cmdlets æ›¿ä»£</li>
<li><code>Get-CimInstance Win32_Process</code> å¯ä»¥å®Œå…¨æ›¿ä»£ <code>wmic Process</code> çš„åŠŸèƒ½</li>
<li>ä¿®æ”¹è„šæœ¬æ—¶éœ€è¦ä¿ç•™åŸæœ‰çš„é€»è¾‘åˆ¤æ–­ï¼Œåªæ›¿æ¢æ•°æ®è·å–æ–¹å¼</li>
<li>éƒ¨ç½²åˆ°ç³»ç»Ÿç›®å½•éœ€è¦ç®¡ç†å‘˜æƒé™</li>
</ul>
<h2 data-id="heading-10">wmic ä¸ PowerShell æ›¿ä»£å¯¹ç…§è¡¨</h2>

























<table><thead><tr><th>wmic å‘½ä»¤</th><th>PowerShell æ›¿ä»£</th></tr></thead><tbody><tr><td><code>wmic cpu get name</code></td><td><code>Get-CimInstance Win32_Processor | Select Name</code></td></tr><tr><td><code>wmic os get version</code></td><td><code>Get-CimInstance Win32_OperatingSystem | Select Version</code></td></tr><tr><td><code>wmic process get name</code></td><td><code>Get-Process | Select Name</code></td></tr><tr><td><code>wmic Process WHERE "Name='cmd.exe'" GET ParentProcessID /value</code></td><td><code>Get-CimInstance Win32_Process | Where-Object { $_.Name -eq 'cmd.exe' } | Select ParentProcessId</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">å®Œæ•´ä¿®æ”¹åçš„ RefreshEnv.cmd æ–‡ä»¶</h2>
<pre><code class="hljs language-batch" lang="batch">@echo off
REM Code generously provided by @beatcracker: https://github.com/beatcracker/detect-batch-subshell

setlocal EnableDelayedExpansion

REM Dequote path to command processor and this script path
set ScriptPath=%~0
set CmdPath=%COMSPEC:"=%

REM Get command processor filename and filename with extension
for %%c in (!CmdPath!) do (
    set CmdExeName=%%~nxc
    set CmdName=%%~nc
)

REM Get this process' PID
REM Adapted from: http://www.dostips.com/forum/viewtopic.php?p=22675#p22675
set "uid="
for /l %%i in (1 1 128) do (
    set /a "bit=!random!&amp;1"
    set "uid=!uid!!bit!"
)

REM Use PowerShell instead of wmic to get parent process ID
for /f "tokens=1" %%i in ('powershell -NoProfile -Command "$proc = Get-CimInstance Win32_Process | Where-Object { $_.Name -eq '!CmdExeName!' -and $_.CommandLine -like '*!uid!*' }; if ($proc) { $proc.ParentProcessId }"') do (
    set ParentPID=%%i
)

if defined ParentPID (
    rem Get commandline of parent using PowerShell
    for /f "tokens=*" %%l in ('powershell -NoProfile -Command "$proc = Get-CimInstance Win32_Process -Filter \"Handle = '!ParentPID!'\"; if ($proc) { $proc.CommandLine }"') do (
        set ParentCommandLine=%%l
    )

    rem Get parent process path using PowerShell
    for /f "tokens=*" %%p in ('powershell -NoProfile -Command "$proc = Get-CimInstance Win32_Process -Filter \"Handle = '!ParentPID!'\"; if ($proc) { $proc.ExecutablePath }"') do (
        set ParentPath=%%p
    )

    rem Dequote parent path
    set ParentPath=!ParentPath:"=!

    rem Handle different invocations: C:\Windows\system32\cmd.exe , cmd.exe , cmd
    for %%p in (!CmdPath! !CmdExeName! !CmdName!) do (
        if /i "!ParentPath!"=="%%p" set IsCmdParent=1
    )

    rem Check if we're running in cmd.exe with /c switch and this script path as argument
    if !IsCmdParent!==1 (
        for /f "tokens=1,2,3*" %%a in ("!ParentCommandLine!") do (
            if /i "%%b"=="/c" (
                set ParentScriptPath=%%c
                set ParentScriptPath=!ParentScriptPath:"=!
                if "!ParentScriptPath!"=="%ScriptPath%" set IsExternal=1
            )
        )
    )
)

if !IsExternal!==1 (
    echo %~nx0 does not work when run from this process. If you're in PowerShell, please 'Import-Module $env:ChocolateyInstall\helpers\chocolateyProfile.psm1' and try again.
    exit 1
)

REM End code from @beatcracker
@echo off
REM
REM RefreshEnv.cmd
REM
REM Batch file to read environment variables from registry and
REM set session variables to these values.
REM
REM With this batch file, there should be no need to reload command
REM environment every time you want environment changes to propagate

REM echo "RefreshEnv.cmd only works from cmd.exe, please install the Chocolatey Profile to take advantage of refreshenv from PowerShell"
echo | set /p dummy="Refreshing environment variables from registry for cmd.exe. Please wait..."

goto main

REM Set one environment variable from registry key
:SetFromReg
    "%WinDir%\System32\Reg" QUERY "%~1" /v "%~2" &gt; "%TEMP%\_envset.tmp" 2&gt;NUL
    for /f "usebackq skip=2 tokens=2,*" %%A IN ("%TEMP%\_envset.tmp") do (
        set "tempvar=%%B"
        REM Remove double quotes from temporary value
        set "__tempvar=!tempvar:"=!"

        REM Only escape percentage signs when the value type
        REM is not defined as an expandable string.
        if /I NOT "%%~A"=="REG_EXPAND_SZ" (
            set "tempvar=!tempvar:%%=%%%%!"
        )

        REM If the dequoted string differs from the original string, the variable contains double quotes.
        REM Escape the | and &amp; in the variable to avoid errors.
        if NOT "!__tempvar!" == "!tempvar!" (
            set "tempvar=!tempvar:|=^|!"
            set "tempvar=!tempvar:&amp;=^&amp;!"
        )

        echo/set "%~3=!tempvar!"
    )
    goto :EOF

REM Get a list of environment variables from registry
:GetRegEnv
    "%WinDir%\System32\Reg" QUERY "%~1" &gt; "%TEMP%\_envget.tmp"
    for /f "usebackq skip=2" %%A IN ("%TEMP%\_envget.tmp") do (
        if /I not "%%~A"=="Path" (
            call :SetFromReg "%~1" "%%~A" "%%~A"
        )
    )
    goto :EOF

:main
    echo/@echo off &gt;"%TEMP%\_env.cmd"

    REM Slowly generating final file
    call :GetRegEnv "HKLM\System\CurrentControlSet\Control\Session Manager\Environment" &gt;&gt; "%TEMP%\_env.cmd"
    call :GetRegEnv "HKCU\Environment"&gt;&gt;"%TEMP%\_env.cmd" &gt;&gt; "%TEMP%\_env.cmd"

    REM Special handling for PATH - mix both User and System
    call :SetFromReg "HKLM\System\CurrentControlSet\Control\Session Manager\Environment" Path Path_HKLM &gt;&gt; "%TEMP%\_env.cmd"
    call :SetFromReg "HKCU\Environment" Path Path_HKCU &gt;&gt; "%TEMP%\_env.cmd"

    endlocal

    REM Caution: do not insert space-chars before &gt;&gt; redirection sign
    echo/set "Path=%%Path_HKLM%%;%%Path_HKCU%%" &gt;&gt; "%TEMP%\_env.cmd"

    REM Cleanup
    del /f /q "%TEMP%\_envset.tmp" 2&gt;nul
    del /f /q "%TEMP%\_envget.tmp" 2&gt;nul

    REM capture user / architecture
    SET "OriginalUserName=%USERNAME%"
    SET "OriginalArchitecture=%PROCESSOR_ARCHITECTURE%"

    REM Set these variables
    call "%TEMP%\_env.cmd"

    REM Cleanup
    del /f /q "%TEMP%\_env.cmd" 2&gt;nul

    REM reset user / architecture
    SET "USERNAME=%OriginalUserName%"
    SET "PROCESSOR_ARCHITECTURE=%OriginalArchitecture%"

    echo | set /p dummy="Finished."
    echo .
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>