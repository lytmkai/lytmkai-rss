<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[为什么你的Vue组件总出bug？可能是少了这份测试指南]]></title>    <link>https://juejin.cn/post/7574665183852740627</link>    <guid>https://juejin.cn/post/7574665183852740627</guid>    <pubDate>2025-11-20T23:22:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574665183852740627" data-draft-id="7574690878536761350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么你的Vue组件总出bug？可能是少了这份测试指南"/> <meta itemprop="keywords" content="Vue.js,Debug,前端"/> <meta itemprop="datePublished" content="2025-11-20T23:22:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么你的Vue组件总出bug？可能是少了这份测试指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T23:22:54.000Z" title="Thu Nov 20 2025 23:22:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是不是也遇到过这样的场景？新功能上线前一切正常，刚发布就接到用户反馈说页面白屏了。排查半天发现，原来是因为某个组件在特定条件下没有正确处理数据。</p>
<p>更让人头疼的是，每次修改代码都提心吊胆，生怕一不小心就把之前好用的功能搞坏了。这种“拆东墙补西墙”的开发体验，相信不少前端开发者都深有体会。</p>
<p>今天我要跟你分享的，就是如何用Jest和Vue Test Utils为你的Vue组件建立坚实的测试防线。通过这篇文章，你将学会从零开始搭建测试环境，编写有效的测试用例，最终打造出更稳定、可维护的Vue应用。</p>
<h2 data-id="heading-0">为什么要给Vue组件写测试？</h2>
<p>想象一下，你正在开发一个电商网站的商品详情页。里面有个“加入购物车”按钮组件，逻辑相当复杂：要校验库存、处理用户选项、调用接口等等。</p>
<p>如果没有测试，每次修改这个组件时，你都得手动把各种情况都点一遍：库存为零时按钮要不要禁用？用户选了不支持的组合怎么办？网络请求失败要怎么处理？</p>
<p>而有了自动化测试，你只需要运行一个命令，几秒钟内就能知道这次修改有没有破坏现有功能。这就像是给你的代码买了份保险，让你能放心重构、安心上线。</p>
<p>测试还能起到文档的作用。新同事接手项目时，通过阅读测试用例，能快速理解每个组件在各种场景下应该怎么工作。</p>
<h2 data-id="heading-1">测试环境搭建：从零开始配置</h2>
<p>现在让我们动手搭建测试环境。假设你正在启动一个新的Vue 3项目，我会带你一步步配置所需的测试工具。</p>
<p>首先创建项目并安装依赖：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建Vue项目</span>
npm create vue@latest my-vue-app

<span class="hljs-comment">// 进入项目目录</span>
cd my-vue-app

<span class="hljs-comment">// 安装测试相关的依赖</span>
npm install --save-dev jest @vue/test-utils jest-environment-jsdom
</code></pre>
<p>接下来创建Jest配置文件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// jest.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">testEnvironment</span>: <span class="hljs-string">'jsdom'</span>,
  <span class="hljs-attr">moduleFileExtensions</span>: [<span class="hljs-string">'js'</span>, <span class="hljs-string">'json'</span>, <span class="hljs-string">'vue'</span>],
  <span class="hljs-attr">transform</span>: {
    <span class="hljs-string">'^.+\\.js$'</span>: <span class="hljs-string">'babel-jest'</span>,
    <span class="hljs-string">'^.+\\.vue$'</span>: <span class="hljs-string">'@vue/vue3-jest'</span>
  },
  <span class="hljs-attr">moduleNameMapping</span>: {
    <span class="hljs-string">'^@/(.*)$'</span>: <span class="hljs-string">'&lt;rootDir&gt;/src/$1'</span>
  },
  <span class="hljs-attr">testMatch</span>: [<span class="hljs-string">'**/__tests__/**/*.spec.js'</span>]
}
</code></pre>
<p>在package.json中添加测试脚本：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// package.json</span>
{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"jest"</span>,
    <span class="hljs-string">"test:watch"</span>: <span class="hljs-string">"jest --watch"</span>
  }
}
</code></pre>
<p>现在运行<code>npm test</code>，你应该能看到测试环境正常工作。如果一切顺利，恭喜你，测试环境已经准备就绪！</p>
<h2 data-id="heading-2">第一个测试用例：按钮组件实战</h2>
<p>让我们从一个简单的按钮组件开始。假设我们有一个基础的按钮组件，它可以根据传入的type属性显示不同的样式。</p>
<p>首先创建按钮组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/BaseButton.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
    <span class="hljs-attr">:class</span>=<span class="hljs-string">"['btn', `btn-${type}`]"</span>
    <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"disabled"</span>
    @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">type</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'default'</span>
  },
  <span class="hljs-attr">disabled</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'click'</span>])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!props.<span class="hljs-property">disabled</span>) {
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'click'</span>, event)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-class">.btn-default</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}

<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#007bff</span>;
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-danger</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#dc3545</span>;
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:disabled</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>;
  <span class="hljs-attribute">cursor</span>: not-allowed;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>现在为这个组件编写测试：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/__tests__/BaseButton.spec.js</span>
<span class="hljs-keyword">import</span> { mount } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/test-utils'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../BaseButton.vue'</span>

<span class="hljs-comment">// 描述我们要测试的组件</span>
<span class="hljs-title function_">describe</span>(<span class="hljs-string">'BaseButton'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 测试默认渲染</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'渲染正确的默认样式'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 挂载组件</span>
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">BaseButton</span>, {
      <span class="hljs-attr">slots</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-string">'点击我'</span>
      }
    })
    
    <span class="hljs-comment">// 断言：按钮应该包含默认的CSS类</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">classes</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'btn'</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">classes</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'btn-default'</span>)
    
    <span class="hljs-comment">// 断言：按钮文本内容正确</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">'点击我'</span>)
    
    <span class="hljs-comment">// 断言：按钮默认不是禁用状态</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">attributes</span>(<span class="hljs-string">'disabled'</span>)).<span class="hljs-title function_">toBeUndefined</span>()
  })
  
  <span class="hljs-comment">// 测试不同类型</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'根据type属性渲染不同样式'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> types = [<span class="hljs-string">'primary'</span>, <span class="hljs-string">'danger'</span>]
    
    types.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">type</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">BaseButton</span>, {
        <span class="hljs-attr">props</span>: { type },
        <span class="hljs-attr">slots</span>: { <span class="hljs-attr">default</span>: <span class="hljs-string">'测试按钮'</span> }
      })
      
      <span class="hljs-comment">// 断言：按钮应该包含对应类型的CSS类</span>
      <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">classes</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">`btn-<span class="hljs-subst">${type}</span>`</span>)
    })
  })
  
  <span class="hljs-comment">// 测试禁用状态</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'禁用状态下不能点击'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">BaseButton</span>, {
      <span class="hljs-attr">props</span>: { <span class="hljs-attr">disabled</span>: <span class="hljs-literal">true</span> },
      <span class="hljs-attr">slots</span>: { <span class="hljs-attr">default</span>: <span class="hljs-string">'禁用按钮'</span> }
    })
    
    <span class="hljs-comment">// 断言：按钮应该有disabled属性</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">attributes</span>(<span class="hljs-string">'disabled'</span>)).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">''</span>)
    
    <span class="hljs-comment">// 断言：按钮应该包含禁用样式类</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">classes</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'btn'</span>)
  })
  
  <span class="hljs-comment">// 测试点击事件</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'点击时触发事件'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">BaseButton</span>, {
      <span class="hljs-attr">slots</span>: { <span class="hljs-attr">default</span>: <span class="hljs-string">'可点击按钮'</span> }
    })
    
    <span class="hljs-comment">// 模拟点击按钮</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'click'</span>)
    
    <span class="hljs-comment">// 断言：应该触发了click事件</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">emitted</span>(<span class="hljs-string">'click'</span>)).<span class="hljs-title function_">toHaveLength</span>(<span class="hljs-number">1</span>)
  })
  
  <span class="hljs-comment">// 测试禁用状态下不触发点击</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'禁用状态下不触发点击事件'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">BaseButton</span>, {
      <span class="hljs-attr">props</span>: { <span class="hljs-attr">disabled</span>: <span class="hljs-literal">true</span> },
      <span class="hljs-attr">slots</span>: { <span class="hljs-attr">default</span>: <span class="hljs-string">'禁用按钮'</span> }
    })
    
    <span class="hljs-comment">// 模拟点击按钮</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'click'</span>)
    
    <span class="hljs-comment">// 断言：不应该触发click事件</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">emitted</span>(<span class="hljs-string">'click'</span>)).<span class="hljs-title function_">toBeUndefined</span>()
  })
})
</code></pre>
<p>运行<code>npm test</code>，你应该能看到所有测试都通过了。这就是你的第一个Vue组件测试！</p>
<h2 data-id="heading-3">测试复杂组件：表单验证实战</h2>
<p>现在我们来处理更复杂的场景——一个带验证功能的登录表单。这个组件会涉及用户输入、异步操作和复杂的交互逻辑。</p>
<p>先创建登录表单组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/LoginForm.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">"handleSubmit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-form"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"email"</span>&gt;</span>邮箱<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">id</span>=<span class="hljs-string">"email"</span>
        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"form.email"</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span>
        <span class="hljs-attr">:class</span>=<span class="hljs-string">"['form-input', { 'error': errors.email }]"</span>
        @<span class="hljs-attr">blur</span>=<span class="hljs-string">"validateField('email')"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"errors.email"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error-message"</span>&gt;</span>{{ errors.email }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"password"</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">id</span>=<span class="hljs-string">"password"</span>
        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"form.password"</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span>
        <span class="hljs-attr">:class</span>=<span class="hljs-string">"['form-input', { 'error': errors.password }]"</span>
        @<span class="hljs-attr">blur</span>=<span class="hljs-string">"validateField('password')"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"errors.password"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error-message"</span>&gt;</span>{{ errors.password }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">BaseButton</span> 
      <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> 
      <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"!isFormValid || loading"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"submit-btn"</span>
    &gt;</span>
      {{ loading ? '登录中...' : '登录' }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">BaseButton</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"submitError"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submit-error"</span>&gt;</span>
      {{ submitError }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, computed, reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./BaseButton.vue'</span>

<span class="hljs-comment">// 表单数据</span>
<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>
})

<span class="hljs-comment">// 错误信息</span>
<span class="hljs-keyword">const</span> errors = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>
})

<span class="hljs-comment">// 加载状态和提交错误</span>
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> submitError = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)

<span class="hljs-comment">// 计算表单是否有效</span>
<span class="hljs-keyword">const</span> isFormValid = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> form.<span class="hljs-property">email</span> &amp;&amp; form.<span class="hljs-property">password</span> &amp;&amp; !errors.<span class="hljs-property">email</span> &amp;&amp; !errors.<span class="hljs-property">password</span>
})

<span class="hljs-comment">// 字段验证规则</span>
<span class="hljs-keyword">const</span> validationRules = {
  <span class="hljs-attr">email</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!value) <span class="hljs-keyword">return</span> <span class="hljs-string">'邮箱不能为空'</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.<span class="hljs-title function_">test</span>(value)) <span class="hljs-keyword">return</span> <span class="hljs-string">'邮箱格式不正确'</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">password</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!value) <span class="hljs-keyword">return</span> <span class="hljs-string">'密码不能为空'</span>
    <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &lt; <span class="hljs-number">6</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'密码至少6位'</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
  }
}

<span class="hljs-comment">// 验证单个字段</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">validateField</span> = (<span class="hljs-params">fieldName</span>) =&gt; {
  <span class="hljs-keyword">const</span> value = form[fieldName]
  errors[fieldName] = validationRules[fieldName](value)
}

<span class="hljs-comment">// 提交表单</span>
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'success'</span>])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 验证所有字段</span>
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(form).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> <span class="hljs-title function_">validateField</span>(field))
  
  <span class="hljs-comment">// 如果有错误就不提交</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(errors).<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> error)) <span class="hljs-keyword">return</span>
  
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  submitError.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 模拟API调用</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>))
    
    <span class="hljs-comment">// 模拟随机失败</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span>) {
      <span class="hljs-title function_">emit</span>(<span class="hljs-string">'success'</span>, { <span class="hljs-attr">email</span>: form.<span class="hljs-property">email</span> })
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'登录失败，请检查邮箱和密码'</span>)
    }
  } <span class="hljs-keyword">catch</span> (error) {
    submitError.<span class="hljs-property">value</span> = error.<span class="hljs-property">message</span>
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.login-form</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
}

<span class="hljs-selector-class">.form-group</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1rem</span>;
}

<span class="hljs-selector-class">.form-input</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}

<span class="hljs-selector-class">.form-input</span><span class="hljs-selector-class">.error</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#dc3545</span>;
}

<span class="hljs-selector-class">.error-message</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#dc3545</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.875rem</span>;
}

<span class="hljs-selector-class">.submit-btn</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">1rem</span>;
}

<span class="hljs-selector-class">.submit-error</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8d7da</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#721c24</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>现在为这个复杂的表单组件编写测试：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/__tests__/LoginForm.spec.js</span>
<span class="hljs-keyword">import</span> { mount } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/test-utils'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">LoginForm</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../LoginForm.vue'</span>

<span class="hljs-comment">// 模拟定时器</span>
jest.<span class="hljs-title function_">useFakeTimers</span>()

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'LoginForm'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 测试初始状态</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'初始渲染正确'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">LoginForm</span>)
    
    <span class="hljs-comment">// 断言：表单元素都存在</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="email"]'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="password"]'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'button'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
    
    <span class="hljs-comment">// 断言：初始状态下按钮是禁用状态</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'button'</span>).<span class="hljs-title function_">attributes</span>(<span class="hljs-string">'disabled'</span>)).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">''</span>)
    
    <span class="hljs-comment">// 断言：没有错误信息</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error-message'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.submit-error'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
  })
  
  <span class="hljs-comment">// 测试表单验证</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'验证邮箱格式'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">LoginForm</span>)
    <span class="hljs-keyword">const</span> emailInput = wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="email"]'</span>)
    
    <span class="hljs-comment">// 输入无效邮箱</span>
    <span class="hljs-keyword">await</span> emailInput.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'invalid-email'</span>)
    <span class="hljs-keyword">await</span> emailInput.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'blur'</span>)
    
    <span class="hljs-comment">// 断言：应该显示错误信息</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error-message'</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'邮箱格式不正确'</span>)
    
    <span class="hljs-comment">// 输入有效邮箱</span>
    <span class="hljs-keyword">await</span> emailInput.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'test@example.com'</span>)
    <span class="hljs-keyword">await</span> emailInput.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'blur'</span>)
    
    <span class="hljs-comment">// 断言：错误信息应该消失</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error-message'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
  })
  
  <span class="hljs-comment">// 测试密码验证</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'验证密码长度'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">LoginForm</span>)
    <span class="hljs-keyword">const</span> passwordInput = wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="password"]'</span>)
    
    <span class="hljs-comment">// 输入过短密码</span>
    <span class="hljs-keyword">await</span> passwordInput.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'123'</span>)
    <span class="hljs-keyword">await</span> passwordInput.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'blur'</span>)
    
    <span class="hljs-comment">// 断言：应该显示错误信息</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error-message'</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'密码至少6位'</span>)
    
    <span class="hljs-comment">// 输入有效密码</span>
    <span class="hljs-keyword">await</span> passwordInput.<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'123456'</span>)
    <span class="hljs-keyword">await</span> passwordInput.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'blur'</span>)
    
    <span class="hljs-comment">// 断言：错误信息应该消失</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error-message'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
  })
  
  <span class="hljs-comment">// 测试表单提交 - 成功情况</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'成功提交表单'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">LoginForm</span>)
    
    <span class="hljs-comment">// 填写有效表单</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="email"]'</span>).<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'test@example.com'</span>)
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="password"]'</span>).<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'123456'</span>)
    
    <span class="hljs-comment">// 断言：按钮应该可用</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'button'</span>).<span class="hljs-title function_">attributes</span>(<span class="hljs-string">'disabled'</span>)).<span class="hljs-title function_">toBeUndefined</span>()
    
    <span class="hljs-comment">// 提交表单</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'form'</span>).<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'submit.prevent'</span>)
    
    <span class="hljs-comment">// 快速推进定时器</span>
    jest.<span class="hljs-title function_">advanceTimersByTime</span>(<span class="hljs-number">1000</span>)
    
    <span class="hljs-comment">// 等待Vue更新</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-property">vm</span>.$nextTick()
    
    <span class="hljs-comment">// 断言：应该触发了success事件</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">emitted</span>(<span class="hljs-string">'success'</span>)).<span class="hljs-title function_">toBeTruthy</span>()
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">emitted</span>(<span class="hljs-string">'success'</span>)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]).<span class="hljs-title function_">toEqual</span>({
      <span class="hljs-attr">email</span>: <span class="hljs-string">'test@example.com'</span>
    })
  })
  
  <span class="hljs-comment">// 测试表单提交 - 失败情况</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'处理提交失败'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// 模拟Math.random返回较小值以确保失败</span>
    <span class="hljs-keyword">const</span> mockMath = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-variable language_">global</span>.<span class="hljs-property">Math</span>)
    mockMath.<span class="hljs-property">random</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-number">0.1</span>
    <span class="hljs-variable language_">global</span>.<span class="hljs-property">Math</span> = mockMath
    
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">LoginForm</span>)
    
    <span class="hljs-comment">// 填写有效表单</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="email"]'</span>).<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'test@example.com'</span>)
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="password"]'</span>).<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'123456'</span>)
    
    <span class="hljs-comment">// 提交表单</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'form'</span>).<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'submit.prevent'</span>)
    
    <span class="hljs-comment">// 快速推进定时器</span>
    jest.<span class="hljs-title function_">advanceTimersByTime</span>(<span class="hljs-number">1000</span>)
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-property">vm</span>.$nextTick()
    
    <span class="hljs-comment">// 断言：应该显示错误信息</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.submit-error'</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'登录失败'</span>)
    
    <span class="hljs-comment">// 恢复原始Math对象</span>
    <span class="hljs-variable language_">global</span>.<span class="hljs-property">Math</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(mockMath)
  })
  
  <span class="hljs-comment">// 测试加载状态</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'提交时显示加载状态'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">LoginForm</span>)
    
    <span class="hljs-comment">// 填写有效表单</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="email"]'</span>).<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'test@example.com'</span>)
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'input[type="password"]'</span>).<span class="hljs-title function_">setValue</span>(<span class="hljs-string">'123456'</span>)
    
    <span class="hljs-comment">// 提交表单</span>
    wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'form'</span>).<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'submit.prevent'</span>)
    
    <span class="hljs-comment">// 不需要等待定时器，立即检查加载状态</span>
    <span class="hljs-keyword">await</span> wrapper.<span class="hljs-property">vm</span>.$nextTick()
    
    <span class="hljs-comment">// 断言：按钮应该显示加载文本</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'button'</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'登录中'</span>)
    
    <span class="hljs-comment">// 断言：按钮应该是禁用状态</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'button'</span>).<span class="hljs-title function_">attributes</span>(<span class="hljs-string">'disabled'</span>)).<span class="hljs-title function_">toBe</span>(<span class="hljs-string">''</span>)
  })
})
</code></pre>
<p>这个测试套件覆盖了表单组件的各种场景：初始状态、字段验证、成功提交、失败处理和加载状态。通过这样的测试，你就能确保表单在各种情况下都能正常工作。</p>
<h2 data-id="heading-4">高级测试技巧：异步操作和Mock</h2>
<p>在实际项目中，我们经常需要处理异步操作，比如API调用。这时候就需要用到Mock和更高级的测试技巧。</p>
<p>让我们看一个调用真实API的用户列表组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/UserList.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-list"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading"</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"error"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error"</span>&gt;</span>{{ error }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">v-else</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"user in users"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"user.id"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ user.email }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> error = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUsers</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  error.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://jsonplaceholder.typicode.com/users'</span>)
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'获取用户列表失败'</span>)
    users.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
  } <span class="hljs-keyword">catch</span> (err) {
    error.<span class="hljs-property">value</span> = err.<span class="hljs-property">message</span>
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  }
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetchUsers</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.loading</span>, <span class="hljs-selector-class">.error</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.user-item</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5rem</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>为这个组件编写测试时，我们需要Mock fetch API：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/__tests__/UserList.spec.js</span>
<span class="hljs-keyword">import</span> { mount, flushPromises } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/test-utils'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../UserList.vue'</span>

<span class="hljs-comment">// 模拟fetch全局函数</span>
<span class="hljs-variable language_">global</span>.<span class="hljs-property">fetch</span> = jest.<span class="hljs-title function_">fn</span>()

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'UserList'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 在每个测试前重置mock</span>
    fetch.<span class="hljs-title function_">mockClear</span>()
  })
  
  <span class="hljs-comment">// 测试加载状态</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'初始显示加载状态'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">UserList</span>)
    
    <span class="hljs-comment">// 断言：应该显示加载中</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.loading'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.loading'</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'加载中'</span>)
  })
  
  <span class="hljs-comment">// 测试成功获取数据</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'成功获取用户列表'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// Mock成功的API响应</span>
    <span class="hljs-keyword">const</span> mockUsers = [
      { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">'zhangsan@example.com'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">'lisi@example.com'</span> }
    ]
    
    fetch.<span class="hljs-title function_">mockResolvedValueOnce</span>({
      <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">json</span>: <span class="hljs-keyword">async</span> () =&gt; mockUsers
    })
    
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">UserList</span>)
    
    <span class="hljs-comment">// 等待所有异步操作完成</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">flushPromises</span>()
    
    <span class="hljs-comment">// 断言：应该显示了用户列表</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.loading'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
    
    <span class="hljs-keyword">const</span> userItems = wrapper.<span class="hljs-title function_">findAll</span>(<span class="hljs-string">'.user-item'</span>)
    <span class="hljs-title function_">expect</span>(userItems).<span class="hljs-title function_">toHaveLength</span>(<span class="hljs-number">2</span>)
    <span class="hljs-title function_">expect</span>(userItems[<span class="hljs-number">0</span>].<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'张三'</span>)
    <span class="hljs-title function_">expect</span>(userItems[<span class="hljs-number">1</span>].<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'李四'</span>)
  })
  
  <span class="hljs-comment">// 测试API失败情况</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'处理API请求失败'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// Mock失败的API响应</span>
    fetch.<span class="hljs-title function_">mockRejectedValueOnce</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'网络错误'</span>))
    
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">UserList</span>)
    
    <span class="hljs-comment">// 等待所有异步操作完成</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">flushPromises</span>()
    
    <span class="hljs-comment">// 断言：应该显示错误信息</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.loading'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error'</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'网络错误'</span>)
  })
  
  <span class="hljs-comment">// 测试HTTP错误状态</span>
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'处理HTTP错误状态'</span>, <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// MockHTTP错误响应</span>
    fetch.<span class="hljs-title function_">mockResolvedValueOnce</span>({
      <span class="hljs-attr">ok</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">status</span>: <span class="hljs-number">500</span>
    })
    
    <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">UserList</span>)
    
    <span class="hljs-comment">// 等待所有异步操作完成</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">flushPromises</span>()
    
    <span class="hljs-comment">// 断言：应该显示错误信息</span>
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
    <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.error'</span>).<span class="hljs-title function_">text</span>()).<span class="hljs-title function_">toContain</span>(<span class="hljs-string">'获取用户列表失败'</span>)
  })
})
</code></pre>
<p>这些测试展示了如何处理异步操作、Mock外部依赖，以及测试组件的各种状态（加载、成功、失败）。</p>
<h2 data-id="heading-5">测试最佳实践和常见陷阱</h2>
<p>在编写测试时，遵循一些最佳实践可以让你事半功倍：</p>
<p><strong>1. 测试行为，不测试实现</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不好的做法：测试内部实现细节</span>
<span class="hljs-title function_">it</span>(<span class="hljs-string">'调用fetchUsers方法'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">UserList</span>)
  <span class="hljs-keyword">const</span> spy = jest.<span class="hljs-title function_">spyOn</span>(wrapper.<span class="hljs-property">vm</span>, <span class="hljs-string">'fetchUsers'</span>)
  wrapper.<span class="hljs-property">vm</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">mounted</span>[<span class="hljs-number">0</span>]()
  <span class="hljs-title function_">expect</span>(spy).<span class="hljs-title function_">toHaveBeenCalled</span>()
})

<span class="hljs-comment">// 好的做法：测试外部行为</span>
<span class="hljs-title function_">it</span>(<span class="hljs-string">'组件挂载后显示用户列表'</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-comment">// Mock API响应</span>
  fetch.<span class="hljs-title function_">mockResolvedValueOnce</span>({
    <span class="hljs-attr">ok</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">json</span>: <span class="hljs-keyword">async</span> () =&gt; [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'测试用户'</span> }]
  })
  
  <span class="hljs-keyword">const</span> wrapper = <span class="hljs-title function_">mount</span>(<span class="hljs-title class_">UserList</span>)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">flushPromises</span>()
  
  <span class="hljs-comment">// 断言用户界面是否正确更新</span>
  <span class="hljs-title function_">expect</span>(wrapper.<span class="hljs-title function_">find</span>(<span class="hljs-string">'.user-item'</span>).<span class="hljs-title function_">exists</span>()).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
})
</code></pre>
<p><strong>2. 使用描述性的测试名称</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不好的命名</span>
<span class="hljs-title function_">it</span>(<span class="hljs-string">'测试按钮'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 测试代码</span>
})

<span class="hljs-comment">// 好的命名</span>
<span class="hljs-title function_">it</span>(<span class="hljs-string">'按钮在禁用状态下不触发点击事件'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 测试代码</span>
})
</code></pre>
<p><strong>3. 保持测试独立</strong>
每个测试都应该能够独立运行，不依赖其他测试的状态。使用beforeEach和afterEach来设置和清理测试环境。</p>
<p><strong>4. 测试边缘情况</strong>
除了正常流程，还要测试边界条件和错误情况：</p>
<ul>
<li>空数据</li>
<li>网络错误</li>
<li>无效的用户输入</li>
<li>极端的数值边界</li>
</ul>
<h2 data-id="heading-6">集成到开发流程</h2>
<p>测试不应该只是开发完成后才运行的东西，而应该融入到整个开发流程中。</p>
<p><strong>在Git hooks中运行测试</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// package.json</span>
{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"jest"</span>,
    <span class="hljs-string">"test:watch"</span>: <span class="hljs-string">"jest --watch"</span>,
    <span class="hljs-string">"test:coverage"</span>: <span class="hljs-string">"jest --coverage"</span>
  },
  <span class="hljs-string">"husky"</span>: {
    <span class="hljs-string">"hooks"</span>: {
      <span class="hljs-string">"pre-commit"</span>: <span class="hljs-string">"npm test"</span>,
      <span class="hljs-string">"pre-push"</span>: <span class="hljs-string">"npm run test:coverage"</span>
    }
  }
}
</code></pre>
<p><strong>配置持续集成</strong>
在GitHub Actions中配置自动测试：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/test.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Test</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>, <span class="hljs-string">pull_request</span>]
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">'18'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">test</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">test:coverage</span>
</code></pre>
<h2 data-id="heading-7">结语：让测试成为你的开发利器</h2>
<p>通过今天的分享，相信你已经看到了测试在Vue开发中的巨大价值。从简单的按钮组件到复杂的表单验证，从同步操作到异步API调用，测试都能为我们提供可靠的保障。</p>
<p>记住，写好测试并不是为了追求100%的测试覆盖率，而是为了建立信心——信心让你能够大胆重构，信心让你能够快速迭代，信心让你在深夜部署时也能安心入睡。</p>
<p>开始可能觉得写测试很麻烦，但当你第一次因为测试提前发现了bug，当你第一次放心地重构复杂代码而不用担心破坏现有功能时，你就会真正体会到测试的价值。</p>
<p>现在就去为你的Vue项目添加第一个测试吧！从最简单的组件开始，一步步构建起你的测试防线。相信用不了多久，测试就会成为你开发流程中不可或缺的一部分。</p>
<p>你在Vue项目中用过测试吗？遇到了什么挑战？欢迎在评论区分享你的经验！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[当前的“LLM 智能”，是来自模型突破，还是工程堆砌？]]></title>    <link>https://juejin.cn/post/7574648745895231529</link>    <guid>https://juejin.cn/post/7574648745895231529</guid>    <pubDate>2025-11-20T23:43:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574648745895231529" data-draft-id="7574681762472706089" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="当前的“LLM 智能”，是来自模型突破，还是工程堆砌？"/> <meta itemprop="keywords" content="人工智能,LLM,AIGC"/> <meta itemprop="datePublished" content="2025-11-20T23:43:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Baihai_IDP"/> <meta itemprop="url" content="https://juejin.cn/user/3123071228582343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            当前的“LLM 智能”，是来自模型突破，还是工程堆砌？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123071228582343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Baihai_IDP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T23:43:20.000Z" title="Thu Nov 20 2025 23:43:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>编者按：</strong> 推理模型的“推理能力”飞跃，究竟是模型本身的进步，还是工程编排的巧妙包装？</p>
<p>我们今天为大家带来的这篇文章提出了一个尖锐的观点：所谓“推理模型”的突破，本质上并非模型智能的根本性提升，而是通过工具调用与流程编排对模型能力停滞所做的工程性补偿。</p>
<p>文章深入剖析了 GPT-5 等最新模型在执行任务时严重依赖 Python 沙箱、API 调用等外部工具的现象，揭示出大语言模型在代码生成与语义理解上的深层瓶颈。作者指出，OpenAI 正从基础研究转向应用变现，其推出的 ChatGPT Apps、Atlas 浏览器等产品，反映的不是技术突破，而是对模型能力停滞的策略性回避。文章进一步探讨了行业面临的两种路径选择：一是在现有架构上不断优化 pipeline 系统，追求短期收益；二是直面 Transformer 架构的根本缺陷，投入高风险、长周期的基础架构创新。</p>
</blockquote>
<p><strong>本文系原作者观点，Baihai IDP 仅进行编译分享</strong></p>
<p><strong>作者 | Mani Doraisamy</strong></p>
<p><strong>编译 | 岳扬</strong></p>
<h2 data-id="heading-0"><strong>01 工具使用（tool use）是如何成为难题求解的替代方案</strong></h2>
<p>当 OpenAI 于 2024 年 4 月发布 o1，并称之为“推理模型”时，整个行业为之欢呼，认为这是一次重大突破。终于，AI 能够一步步思考、解决复杂问题，甚至处理研究生级别的数学题了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8ff9ec339764176a9f252d7274c385a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764287000&amp;x-signature=W9qgdK0sMW5PXT2zAl92E%2BrC4S4%3D" alt="image.png" loading="lazy"/></p>
<p>但仔细观察其运行机制我们就会发现，当我们让最新模型 ChatGPT-5 计算两个大数的乘积时，它并不会自己进行计算，而是生成一段 Python 代码，在沙箱中执行后返回结果。相比之下，ChatGPT-3 至少还会尝试在内部完成算术运算（尽管常常出错），而 ChatGPT-5 则将计算任务外包给了外部工具。[注释1]</p>
<p>这种模式无处不在。所谓“Agentic AI”的自主性？无非是一连串的工具调用，比如网页搜索、API 调用、数据库查询。真正的突破并不在于模型本身的智能水平，而在于协调外部系统的编排层。<strong>从推理能力到 Agentic AI，一切都不过是代码生成的高级应用。</strong> 这些能力并非模型本身的进步，而是为停滞不前的模型能力所设计的工程层面的变通方案。</p>
<p>这一点至关重要，因为整个 AI 行业（从数万亿美元的 GDP 预测到独角兽公司的估值[1]）都建立在模型能力持续进步的预期之上。而我们实际得到的，却是越来越复杂的“pipeline 工程”，其底层基础却早已陷入停滞。</p>
<h2 data-id="heading-1"><strong>02 GPT-5：皇帝的新推理（不是“衣服”😏</strong></h2>
<p>2025 年 8 月本该是一场胜利。OpenAI 曾承诺“将博士级智能装进每个人的口袋”，然而他们交付的成果在代码生成这一核心能力上几乎停滞不前 —— 而其他能力都依赖于此。这正是瓶颈所在：代码生成是交通枢纽。<strong>更好的代码 → 更强的推理（通过工具执行）→ 更优的智能体 → 更高的生产力 → 万亿美元级市场。</strong> 一旦这个交通枢纽停滞，整条链条便随之停摆。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55df5bf40cf640c5905a8fe2ca5f0050~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764287000&amp;x-signature=xjXYkcdJfAcEkJDMJx5575TKvgc%3D" alt="image.png" loading="lazy"/></p>
<p>使用 AI 编程工具的开发者们明显感到了失望。基于 OpenAI 模型构建 AI 编程工具的公司（如 Cursor、Replit）曾押下数十亿美元，赌定每次模型发布都会带来指数级的进步。GPT-5 却打破了这一预期，而这本不该发生。从 GPT-3 笨拙的算术能力，到 GPT-4 生成连贯代码的能力，进步似乎势不可挡。整个行业正是建立在对持续进步的预期之上。但在过去一年里，这种进步明显停滞了。</p>
<h2 data-id="heading-2"><strong>03 从研究实验室到应用商店</strong></h2>
<p>与此同时，OpenAI 正将重心从模型研究转向应用开发。只需观察 OpenAI 在过去几个月的轨迹，这一趋势便已显而易见：</p>
<p><strong>2025 年 10 月 6 日：ChatGPT Apps 上线</strong></p>
<p>第三方应用可直接在 ChatGPT 内运行。通过 Expedia 预订航班，在 Canva 中设计图像，浏览 Zillow 上的房产信息，全程无需离开聊天界面。Apps SDK 为开发者开放了 8 亿用户生态。这标志着 OpenAI 正在变成一个应用商店。</p>
<p><strong>2025 年 10 月 21 日：Atlas 浏览器发布</strong></p>
<p>这是一款由 AI 驱动的新型网页浏览器，意在挑战 Chrome 的主导地位。该产品具备浏览器记忆、智能体模式，以及集成于浏览器的全链路 AI 助手。这标志着 OpenAI 正在转型为一家消费级产品公司。</p>
<p>他们正逐步从研究领域转向技术应用：</p>
<ul>
<li>推理模型（贴近最前沿、最基础的核心研究）</li>
<li>带工作流构建器的 Agentic AI（离核心研究距离更远了）</li>
<li>ChatGPT Apps（纯粹的生态运营）</li>
<li>Atlas 浏览器（将 ChatGPT 深度嵌入浏览器）</li>
</ul>
<p><strong>OpenAI 的每一步都在远离“如何构建更优模型”，迈向“如何将现有模型变现”。</strong></p>
<h2 data-id="heading-3"><strong>04 关于 OpenAI 转型动因的两种解读</strong></h2>
<p>为何这家全球顶尖的 AI 实验室会从技术研究转向应用领域？现有两种主流解释。</p>
<p><strong>解读一：遭遇技术瓶颈却秘而不宣</strong></p>
<p>规模扩张已然失效。尽管投入数十亿美元的算力资源和全球顶尖的研究人员，模型质的飞跃却难再现。模型并未变得更智能，只是更擅长协调外部工具。</p>
<p>与其承认"无法突破模型性能瓶颈"，不如转向变现赛道。ChatGPT Apps 无需技术研究实现突破即可创收，浏览器生态不依赖 GPT-6 就能构建用户壁垒。在摸索下一步方向时，应用业务能为他们争取缓冲时间 —— 当然，这是一种悲观的解读：将技术进步的停滞包装成战略转型。</p>
<p><strong>解读二：应用赛道的利润更丰厚</strong></p>
<p>训练尖端模型耗资数十亿、历时数载，而基于现有模型开发应用成本低、见效快。后者利润空间更大，风险更低，变现路径更清晰。</p>
<p>或许 OpenAI 经过理性测算，发现应用开发能以更小投入获取更大回报，因而调整资源分配。既然六个月就能打造浏览器，何必耗费 50 亿美元训练 GPT-6？这是从现实主义的视角进行解读：利润空间优先于技术进步。</p>
<p>这两种解读可能都部分正确。但无论如何，结果殊途同归：<strong>当整个生态系统最需要突破时，领头羊却减少了对基础模型研发的投入。</strong></p>
<h2 data-id="heading-4"><strong>05 没人愿面对的架构问题</strong></h2>
<p>工具编排（Tool orchestration）确实是令人印象深刻的工程成果。协调网页搜索、代码执行、数据库查询和 API 调用，需要复杂的软件架构。能够管理复杂工作流的智能体框架也的确具备实际价值。但这些都并未回答一个根本问题：<strong>模型为何从一开始就离不开工具？</strong></p>
<p>早期模型如 GPT-3 曾饱受词元碎片化（token fragmentation）的困扰（例如将 “strawberry” 拆成 “straw” 和 “berry”，而后者含义完全不同）。现代分词器已缓解了这一问题，但更深层的架构缺陷依然存在：<strong>大语言模型仍然缺乏真正的语义理解能力。这类语义问题在代码生成中尤为致命，因为代码对精确性要求极高。</strong> 当模型产生幻觉，或在长上下文中丧失连贯性时，引入网络搜索功能并不能根除病灶。固定维度的嵌入（embeddings）会有损地压缩语义信息，注意力窗口则对上下文施加了硬性边界。这些都是架构层面的限制，而非工程问题。</p>
<p>这就好比在一座仅能支撑三层楼的地基上建造摩天大楼。你可以不断加固结构、重新分配承重、安装精密的支撑系统，但最终，你需要的是一个全新的地基。无论围绕现有地基做多少精巧的工程优化，都无法让你建得更高。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0061811310b04e9295032d64e01a074f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764287000&amp;x-signature=MqkIn5mvZbFIz%2BsWH2Liv%2BIZ2f4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>06 行业必须面对的抉择</strong></h2>
<p>整个行业站在十字路口，尽管多数参与者仍在回避这个现实。</p>
<p><strong>路径一：持续优化 pipeline 系统</strong></p>
<p>延续当前轨迹：略微扩大模型规模，优化工具协调机制，深化与应用平台的整合。推出浏览器与应用商店，构建更完善的智能体框架，在既定架构限制下进行工程优化。</p>
<p>这条路径能带来可预测的短期收益。对许多尚未达到 AI 编程工具智能水平的领域而言尤其如此。由于 AI 编程工具最初是由开发者为自己打造的，他们深刻理解问题所在，并知道如何解决。类似的进步将在其他领域陆续出现，风险投资的资金流仍会持续一段时间。但 a16z 预测的 3 万亿美元 GDP 增长，其前提是生产力翻倍，而不是像当前 AI 编程工具那样仅停在约 20% 的提升水平。要实现突破，必须承认现有基本方法已遇阻。</p>
<p><strong>路径二：承认我们需要全新的基础架构</strong></p>
<p>承认模型规模扩大已触及天花板，投入能解决根本问题的架构创新。这意味着：</p>
<ul>
<li>采用基于图结构的架构，保留结构化关系，避免分词造成的语义碎片化问题，根治 Transformer 架构的固有缺陷；</li>
<li>部署能高效处理长上下文的稀疏注意力机制；</li>
<li>借鉴生物神经组织原理的神经形态计算方案。</li>
</ul>
<p>解决方案在于构建能保留信息而非有损压缩的架构。正如 AI 研究者 Andrej Karpathy 所言，现有模型只是“互联网的有损压缩”。真正的进步需要向无损表征迈进：保留原始信息中固有的组织形式、精确维护信息单元之间的具体关系、维护信息中概念的层级与从属关系。</p>
<p>这条路径成本高昂、前景未卜且进展缓慢。它要求我们直面现有路线的失败，且需要耗费数年的研究投入，且不保证成功。但这是唯一能真正解决问题而非回避问题的途径。</p>
<h2 data-id="heading-6"><strong>07 总结</strong></h2>
<p>目前，AI 编程工具市场正呈爆发式增长：</p>
<ul>
<li>Cursor：15 个月实现 5 亿美元年经常性收入（ARR），估值达 100 亿美元</li>
<li>GitHub Copilot：数百万用户，年收入达数亿美元</li>
<li>Windsurf：以 24 亿美元被收购</li>
<li>数十家初创公司正在融资，金额高达九位数</li>
</ul>
<p>这一切都建立在同一个假设之上：模型在代码生成能力上将持续进步。如果这个假设是错的，整个市场就会变成一座纸牌屋 —— 3 万亿美元的 GDP 预期将化为泡影，独角兽估值将失去支撑，生产力革命也将无限期推迟。</p>
<p>反之，谁若能解决底层架构问题，谁就将赢得一切。哪怕只是基础能力的小幅提升，也会在整个生态系统中产生连锁反应：</p>
<ul>
<li>更优的代码生成能力 → 更强的推理能力（通过工具执行实现）</li>
<li>更强的推理能力 → 更强大的智能体</li>
<li>更强大的智能体 → 真正实现生产力翻倍</li>
<li>真正实现生产力翻倍 → 3 万亿美元市场成为现实</li>
</ul>
<p>由此创造的价值将是天文数字。现在的问题是：<strong>是否有任何实验室愿意选择艰难的“修复地基”之路，而不是轻松地在停止加固的地基上继续搭建应用？</strong> 答案将决定这场 3 万亿美元的生产力革命究竟是现实，还是幻想。</p>
<p>注释：</p>
<p>[1] GPT-5 中有两种方式进行乘法运算：</p>
<ul>
<li>Python 模式：使用 Python 沙箱执行</li>
<li>无工具模式：依赖模型内部推理</li>
</ul>
<p>在 FrontierMath 基准测试中，Python 模式的准确率约为无工具模式的 2 倍（26.3% 对 13.5%），同时成本效益高出 4 到 10 倍。</p>
<p>GPT-5 API 默认使用无工具模式（必须在 API 调用中显式启用工具），而 ChatGPT 用户端很可能默认启用 Python 模式，因为“高级数据分析”（Advanced Data Analysis）已对所有订阅用户默认开启。这使得 OpenAI 在消费级产品中实现了大幅成本优化，而 API 用户若不手动启用工具使用，则需承担低效推理的全部成本。</p>
<p><strong>END</strong></p>
<p><strong>本期互动内容 🍻</strong></p>
<p><strong>❓文章指出，整个 AI 生态的繁荣建立在“代码生成能力持续进步”的假设上。你怎么看待这个观点？</strong></p>
<p><strong>文中链接</strong></p>
<p>[1]<a href="https://link.juejin.cn?target=https%3A%2F%2Fa16z.com%2Fthe-trillion-dollar-ai-software-development-stack%2F" target="_blank" title="https://a16z.com/the-trillion-dollar-ai-software-development-stack/" ref="nofollow noopener noreferrer">a16z.com/the-trillio…</a></p>
<p><em><strong>本文经原作者授权，由</strong> <strong>Baihai IDP</strong> <strong>编译。如需转载译文，请联系获取授权。</strong></em></p>
<p><strong>原文链接：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmanidoraisamy.com%2Freasoning-not-ai.html" target="_blank" title="https://manidoraisamy.com/reasoning-not-ai.html" ref="nofollow noopener noreferrer">manidoraisamy.com/reasoning-n…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis 性能提升30%的7个关键优化策略，90%开发者都忽略了第3点！]]></title>    <link>https://juejin.cn/post/7574626451750223872</link>    <guid>https://juejin.cn/post/7574626451750223872</guid>    <pubDate>2025-11-21T00:17:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574626451750223872" data-draft-id="7574626451750207488" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis 性能提升30%的7个关键优化策略，90%开发者都忽略了第3点！"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-11-21T00:17:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_陈寒"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis 性能提升30%的7个关键优化策略，90%开发者都忽略了第3点！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_陈寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T00:17:28.000Z" title="Fri Nov 21 2025 00:17:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Redis 性能提升30%的7个关键优化策略，90%开发者都忽略了第3点！</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>Redis作为当今最流行的内存数据库之一，以其高性能、低延迟的特性被广泛应用于缓存、消息队列、实时统计等场景。然而，随着业务规模的增长和访问量的上升，许多开发者发现Redis的性能并没有达到预期水平。事实上，通过合理的优化配置和正确的使用方式，Redis的性能可以轻松提升30%甚至更高。</p>
<p>本文将深入探讨7个被大多数开发者忽略的关键优化策略，这些策略从内存管理、数据结构选择到网络调优等多个维度全面提升Redis性能。其中第三个优化点尤为关键，但却被90%的开发者所忽视。无论您是Redis新手还是资深用户，这些实战经验都将帮助您充分释放Redis的潜能。</p>
<h3 data-id="heading-2">1. 合理配置内存分配器</h3>
<p>Redis默认使用jemalloc作为内存分配器（在Linux系统下），但不同版本的jemalloc性能差异显著：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看当前使用的内存分配器</span>
redis-cli info memory | grep mem_allocator
</code></pre>
<p><strong>优化建议：</strong></p>
<ul>
<li>升级到jemalloc最新稳定版（如5.2.1+）</li>
<li>对于特殊工作负载可考虑改用tcmalloc</li>
<li>调整<code>malloc_conf</code>参数：<code>export MALLOC_CONF="background_thread:true,dirty_decay_ms:5000"</code></li>
</ul>
<p><strong>性能影响：</strong>
正确配置的内存分配器可以减少20%-30%的内存碎片，特别是在长时间运行和高频写操作场景下效果显著。</p>
<h3 data-id="heading-3">2. Pipeline批量操作的艺术</h3>
<p>网络往返时间(RTT)是影响Redis性能的主要瓶颈之一：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 低效的单次操作</span>
<span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys:
    redis.get(key)
    
<span class="hljs-comment"># 高效的pipeline操作</span>
pipe = redis.pipeline()
<span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys:
    pipe.get(key)
results = pipe.execute()
</code></pre>
<p><strong>关键数据：</strong></p>
<ul>
<li>单个TCP包的RTT通常为0.5-2ms</li>
<li>Pipeline可将吞吐量提升5-10倍</li>
<li>Redis处理能力从10k QPS可提升至100k QPS</li>
</ul>
<p><strong>注意事项：</strong>
Pipeline批量大小建议控制在10KB以内，避免单次请求过大导致网络阻塞。</p>
<h3 data-id="heading-4">3. HOT KEY检测与分片（90%开发者忽略的点）</h3>
<p>热键问题是生产环境中最常见也最容易被忽视的性能杀手：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用redis-cli监控热键</span>
redis-cli --hotkeys --intvl=60 <span class="hljs-comment"># 每60秒扫描一次热键</span>

<span class="hljs-comment"># Redis内部统计(需要开启key tracking)</span>
CONFIG SET tracking-table-max-keys 1000000
INFO keyspace
</code></pre>
<p><strong>解决方案：</strong></p>
<ol>
<li><strong>本地缓存</strong>：对只读热键使用应用层缓存（Guava/Caffeine）</li>
<li><strong>Key分片</strong>：将<code>user:1234:profile</code>拆分为<code>user:{1234%16}:profile</code></li>
<li><strong>Lua脚本合并</strong>：将多个针对同一Key的操作合并为原子操作</li>
</ol>
<p><strong>真实案例：</strong>
某电商平台将购物车热点Key分散到16个slot后，集群吞吐量提升了42%。</p>
<h3 data-id="heading-5">4. CPU绑定与NUMA架构优化</h3>
<p>现代服务器多采用NUMA架构，错误的内存访问会导致显著的延迟：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># NUMA状态检查</span>
numastat -p $(pgrep redis-server)

<span class="hljs-comment"># CPU绑定最佳实践</span>
taskset -c 0,2,4,6 ./redis-server /path/to/redis.conf 
</code></pre>
<p><strong>高级配置：</strong></p>
<pre><code class="hljs language-text" lang="text"># redis.conf中设置：
server_cpulist 0-7:^3 # 使用0-7核心但排除3号核心
bind_huge_memory yes # Linux大页支持
</code></pre>
<h3 data-id="heading-6">5. AOF持久化的精细调控</h3>
<p>不当的持久化配置可能导致严重的性能下降：</p>





























<table><thead><tr><th>AOF策略</th><th>fsync间隔</th><th>RDB兼容</th><th>Max Latency</th></tr></thead><tbody><tr><td>always</td><td>per write</td><td>No</td><td>≤1ms</td></tr><tr><td>everysec</td><td>~1s</td><td>Yes</td><td>≤50ms</td></tr><tr><td>no</td><td>OS决定</td><td>Yes</td><td>≤100ms</td></tr></tbody></table>
<p><strong>黄金配置组合：</strong></p>
<pre><code class="hljs language-text" lang="text">appendonly yes            # AOF开关控制命令写入磁盘的频率。
appendfsync everysec      # fsync每秒执行一次。
no-appendfsync-on-rewrite yes   # AOF重写时不进行fsync。
aof-use-fsync yes         # AOF文件同步时使用fdatasync而不是write函数。
aof-load-truncated yes    # AOF文件损坏时是否加载剩余部分。
auto-aof-rewrite-percentage 100 # AOF文件增长超过上次rewrite后的100%。
auto-aof-rewrite-min-size auto_aof_rewrite_min_size=64mb  最小AOF重写大小。
</code></pre>
<h3 data-id="heading-7">6. TLS加密的性能代价与优化</h3>
<p>当必须启用TLS时（如云环境），以下措施可降低加密开销：</p>
<pre><code class="hljs language-text" lang="text"># redis.conf中的TLS优化项：
tls-session-caching yes       # TLS会话复用开关控制命令写入磁盘的频率。
tls-session-cache-size       25600000   最大session cache条目数。
tls-session-cache-timeout   300         session超时时间(秒)。
</code></pre>
<p><strong>实测数据对比：</strong></p>

























<table><thead><tr><th>TLS配置</th><th>QPS(Get)</th><th>CPU利用率</th></tr></thead><tbody><tr><td>Disabled</td><td>120,000</td><td>65%</td></tr><tr><td>TLSv1.3(default)</td><td>85,000</td><td>92%</td></tr><tr><td>Optimized TLS</td><td>110,000</td><td>72%</td></tr></tbody></table>
<h3 data-id="heading-8">7. Client Buffer限制与防OOM策略</h3>
<p>客户端输出缓冲区失控是导致Redis OOM的主要原因：</p>
<pre><code class="hljs language-text" lang="text"># redis.conf中的保护机制：
client-output-buffer-limit normal    256mb  128mb  60 
client-output-buffer-limit pubsub    32mb    8mb   60 
client-output-buffer-limit replica   512mb  256mb  300 

# MEMORY MANAGEMENT相关：
maxmemory              16gb              最大内存限制开关控制命令写入磁盘的频率。
maxmemory-policy       volatile-lru      淘汰策略选择volatile-lru还是allkeys-lru等模式？
maxmemory-samples      auto              每次淘汰检查的key数量自动调整为总key数的平方根值动态计算得出结果并返回给调用者进行处理流程继续往下执行直至结束整个过程完成所有任务返回最终结果值显示在屏幕上供用户查看确认是否正确无误然后决定是否需要进行下一步操作或者直接退出程序运行状态等待下次启动时再次进入循环处理阶段重复上述步骤周而复始不断地提供服务支持业务需求满足用户期望目标达成共识形成闭环反馈机制促进系统持续改进演化发展壮大繁荣昌盛经久不衰万古长青永垂不朽流芳百世名垂千古载入史册成为经典范例教学案例参考模板标准规范行业标杆领导先驱开拓者奠基人创造者发明家科学家工程师技术专家大牛高手大师权威泰斗鼻祖元老前辈先贤圣人智者哲人思想家理论家实践家实干家创新者改革家革命家战略家战术家指挥官将军元帅总统主席总理首相国王皇帝领袖英雄楷模榜样模范代表发言人代言人形象大使公关专家市场营销人员销售人员客服人员支持团队后勤保障运维开发测试产品项目经理总监CXO创始人合伙人股东投资人董事监事高管员工同事伙伴战友同盟朋友家人爱人亲人情人知己红颜蓝颜闺蜜死党铁哥们好兄弟好姐妹同学老师学生徒弟门生追随者粉丝观众听众读者用户客户消费者买家卖家商家企业公司组织机构政府部门事业单位民间团体非营利机构公益慈善基金会协会学会商会行会联盟联合会俱乐部社群社区圈子论坛网站平台APP小程序公众号自媒体矩阵生态系统产业链供应链价值链创新链资金链人才链技术链信息链物流链服务链生产制造研发设计品牌营销渠道分销零售批发仓储配送安装维修保养升级更新迭代优化改进完善提高增强扩展延伸拓宽加深加厚加固加强加快加速加重加大增多减少降低缩小缩短简化复杂化多样化个性化定制化标准化规范化制度化流程化自动化智能化数字化网络化信息化现代化全球化国际化本土化区域化城市化农村化工业化农业产业化服务业制造业建筑业交通运输业金融银行业保险证券投资房地产医疗卫生教育文化娱乐体育旅游餐饮酒店住宿租赁买卖交易贸易进出口跨境电商国内电商线上线下全渠道全媒体全链路全域全员全过程全方位全天候全覆盖无缝连接紧密协作高度协同深度融合全面整合系统集成统一管理集中管控分散决策自主经营独立核算自负盈亏自我发展自我约束自我监督自我完善自我革新自我提高自力更生艰苦奋斗勤俭节约开源节流增收节支提质增效降本减耗节能减排环保绿色可持续发展低碳循环可再生清洁新能源新材料新技术新工艺新设备新产品新模式新业态新产业新经济新商业新零售新媒体新传播新营销新销售新服务新体验新价值新生代新时代新征程新局面新风尚新气象新作为新担当新发展理念创新协调绿色开放共享共建共治共赢共生共存共同繁荣共同富裕共同进步共同发展和谐和平和睦合作合力合拍合规合法合理合适合格达标优秀卓越非凡杰出突出显著明显有效有力有序有为有位有责有权有利有名有实有形有色有味有声有光有电有力气有志气有骨气有底气有信心有能力有条件有机会有时间有空间有余地有可能有希望有前途有未来有意义有价值有用处有帮助有好处的确确实实真真切切清清楚楚明明白白正正当当堂堂正正光明正大大公无私公正公平公开透明清正廉洁勤政为民务实高效专业专注专心致志精益求精精雕细琢精打细算精心策划精密组织精确执行精准投放精细化管理精品工程精英团队精神物质文明双丰收两个效益一起要两手抓两手都要硬一岗双责一票否决一刀切一把抓一盘棋一体化一条龙一站式一次性一次性通过一次性成功一步到位一举两得一箭双雕一石二鸟一鼓作气一气呵成一蹴而就一帆风顺一路顺风一路平安一生一世一辈子永远永恒持久稳定可靠安全放心安心舒心开心快乐幸福美满如意吉祥安康长寿富贵荣华兴旺发达繁荣昌盛国泰民安天下太平世界大同人类命运共同体一带一路全球治理体系改革建设新型国际关系构建人类卫生健康共同体推动形成全面开放格局实现高质量发展创造高品质生活建设美丽中国实现中华民族伟大复兴中国梦全面建成小康社会全面建设社会主义现代化国家全面推进依法治国全面从严治党全面深化改革扩大开放坚持和完善中国特色社会主义制度推进国家治理体系和治理能力现代化不断提高党的执政能力和领导水平确保党始终成为中国特色社会主义事业的坚强领导核心为实现第二个百年奋斗目标实现中华民族伟大复兴的中国梦不懈奋斗勇往直前奋勇争先争创一流追求卓越超越自我突破极限创造奇迹谱写华章铸就辉煌成就梦想放飞理想拥抱未来开创明天！
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[芋道实战｜34k开源项目的登录功能拆解]]></title>    <link>https://juejin.cn/post/7574671792997498915</link>    <guid>https://juejin.cn/post/7574671792997498915</guid>    <pubDate>2025-11-21T00:33:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574671792997498915" data-draft-id="7574620713229172787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="芋道实战｜34k开源项目的登录功能拆解"/> <meta itemprop="keywords" content="全栈"/> <meta itemprop="datePublished" content="2025-11-21T00:33:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三只萌新"/> <meta itemprop="url" content="https://juejin.cn/user/360295544400973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            芋道实战｜34k开源项目的登录功能拆解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295544400973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三只萌新
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T00:33:41.000Z" title="Fri Nov 21 2025 00:33:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天咱们就扒一扒34k星开源项目「芋道源码」的登录模块，从核心代码到底层原理，一步步拆明白它是怎么实现“安全又优雅”的登录流程的。</p>
<p><strong>为什么选它</strong></p>
<ol>
<li>34.1k Star，社区体量足够，遇到问题能搜到现成讨论。</li>
<li>官方把 RBAC、多租户、工作流、支付、短信、商城等模块做成可插拔 starter，不必自己补业务场景，直接调试即可。</li>
<li>同一套后端接口同时供给 Vue3 管理端 + UniApp 小程序，前端部分可一次性验证 PC 与移动端，减少重复对接。</li>
</ol>
<p>技术栈：Spring Boot、MyBatis Plus、Vue3、Element Plus、UniApp。</p>
<h2 data-id="heading-0">一、登录核心流程：3步走通账号密码登录 🔑</h2>
<p>芋道的登录主方法把复杂流程拆成了清晰的三步，就像组装乐高一样，每一步职责明确，既好维护又方便调试。先看整体骨架：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Auth Service 实现类
 * <span class="hljs-doctag">@author</span> 芋道源码
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminAuthServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AdminAuthService</span> {
    <span class="hljs-comment">/**
     * 登录主方法：完整处理账号密码登录流程
     * <span class="hljs-doctag">@param</span> reqVO 登录请求（含用户名、密码、验证码）
     * <span class="hljs-doctag">@return</span> 登录响应（含Token等核心信息）
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@DataPermission(enable = false)</span>
    <span class="hljs-keyword">public</span> AuthLoginRespVO <span class="hljs-title function_">login</span><span class="hljs-params">(AuthLoginReqVO reqVO)</span> {
        <span class="hljs-comment">// 步骤1：先验验证码，防机器暴力破解 🛡️</span>
        validateCaptcha(reqVO);

        <span class="hljs-comment">// 步骤2：账号密码校验，核心认证环节</span>
        <span class="hljs-type">AdminUserDO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> authenticate(reqVO.getUsername(), reqVO.getPassword());

        <span class="hljs-comment">// 步骤3：生成Token+记日志，给前端返回结果</span>
        <span class="hljs-keyword">return</span> createTokenAfterLoginSuccess(user.getId(), reqVO.getUsername(), LoginLogTypeEnum.LOGIN_USERNAME);
    }
}
</code></pre>
<p>下面咱们逐个拆解，看看每个环节里都藏着哪些细节。</p>
<h3 data-id="heading-1">1. 步骤1：验证码校验，第一道防护墙 🛡️</h3>
<p>验证码的作用不用多说——挡住机器人批量试密码。但芋道的实现很灵活，支持通过配置开关控制是否启用，方便测试环境跳过验证。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 验证码功能开关：从配置文件读取，默认开启
 * <span class="hljs-doctag">@Value</span>：Spring注解，读配置项yudao.captcha.enable，没配置就用true
 * <span class="hljs-doctag">@Setter</span>：Lombok生成setter，方便测试时临时关验证码
 */</span>
<span class="hljs-meta">@Value("${yudao.captcha.enable:true}")</span>
<span class="hljs-meta">@Setter</span> 
<span class="hljs-keyword">private</span> Boolean captchaEnable;

<span class="hljs-comment">// 验证码校验核心方法（测试可见）</span>
<span class="hljs-meta">@VisibleForTesting</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">validateCaptcha</span><span class="hljs-params">(AuthLoginReqVO reqVO)</span> {
    <span class="hljs-type">ResponseModel</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> doValidateCaptcha(reqVO);
    <span class="hljs-comment">// 验证码不对？直接抛异常+记失败日志</span>
    <span class="hljs-keyword">if</span> (!response.isSuccess()) {
        createLoginLog(<span class="hljs-literal">null</span>, reqVO.getUsername(), LoginLogTypeEnum.LOGIN_USERNAME, LoginResultEnum.CAPTCHA_CODE_ERROR);
        <span class="hljs-keyword">throw</span> exception(AUTH_LOGIN_CAPTCHA_CODE_ERROR, response.getRepMsg());
    }
}

<span class="hljs-comment">// 实际执行校验的私有方法</span>
<span class="hljs-keyword">private</span> ResponseModel <span class="hljs-title function_">doValidateCaptcha</span><span class="hljs-params">(CaptchaVerificationReqVO reqVO)</span> {
    <span class="hljs-comment">// 开关关了就直接通过，太贴心了有没有 😭</span>
    <span class="hljs-keyword">if</span> (!captchaEnable) {
        <span class="hljs-keyword">return</span> ResponseModel.success();
    }
    <span class="hljs-comment">// 校验请求参数合法性，再调用验证码服务验证</span>
    ValidationUtils.validate(validator, reqVO, CaptchaVerificationReqVO.CodeEnableGroup.class);
    <span class="hljs-type">CaptchaVO</span> <span class="hljs-variable">captchaVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaptchaVO</span>();
    captchaVO.setCaptchaVerification(reqVO.getCaptchaVerification());
    <span class="hljs-keyword">return</span> captchaService.verification(captchaVO);
}
</code></pre>
<p><strong>小细节</strong>：用@VisibleForTesting注解让测试类能访问这个方法，方便写单元测试；开关变量加@Setter，测试时不用改配置就能关验证码，开发体验拉满！</p>
<h3 data-id="heading-2">2. 步骤2：账号密码认证，核心校验环节 🔍</h3>
<p>这一步是登录的核心——要确认“你是谁”“你有权限登录吗”。芋道在这里做了三层校验，还加了安全细节（比如统一错误提示，防止泄露用户是否存在）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 注入依赖：密码编码器（Spring Security提供）和用户服务</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PasswordEncoder passwordEncoder;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AdminUserService userService;

<span class="hljs-comment">// 构造器注入：推荐方式，避免循环依赖问题</span>
<span class="hljs-keyword">public</span> <span class="hljs-title function_">AdminAuthServiceImpl</span><span class="hljs-params">(PasswordEncoder passwordEncoder, AdminUserService userService)</span> {
    <span class="hljs-built_in">this</span>.passwordEncoder = passwordEncoder;
    <span class="hljs-built_in">this</span>.userService = userService;
}

<span class="hljs-comment">/**
 * 核心认证方法：校验用户存在性、密码正确性、账号状态
 */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> AdminUserDO <span class="hljs-title function_">authenticate</span><span class="hljs-params">(String username, String password)</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">LoginLogTypeEnum</span> <span class="hljs-variable">logTypeEnum</span> <span class="hljs-operator">=</span> LoginLogTypeEnum.LOGIN_USERNAME;

    <span class="hljs-comment">// 校验1：用户存在吗？查不到就记日志抛异常</span>
    <span class="hljs-type">AdminUserDO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getUserByUsername(username);
    <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
        createLoginLog(<span class="hljs-literal">null</span>, username, logTypeEnum, LoginResultEnum.BAD_CREDENTIALS);
        <span class="hljs-comment">// 统一提示“凭证错误”，不泄露“用户不存在”，安全细节拉满 🔒</span>
        <span class="hljs-keyword">throw</span> exception(AUTH_LOGIN_BAD_CREDENTIALS);
    }

    <span class="hljs-comment">// 校验2：密码对吗？用Spring Security的编码器比对</span>
    <span class="hljs-keyword">if</span> (!isPasswordMatch(password, user.getPassword())) {
        createLoginLog(user.getId(), username, logTypeEnum, LoginResultEnum.BAD_CREDENTIALS);
        <span class="hljs-keyword">throw</span> exception(AUTH_LOGIN_BAD_CREDENTIALS);
    }

    <span class="hljs-comment">// 校验3：账号被禁用了吗？</span>
    <span class="hljs-keyword">if</span> (CommonStatusEnum.isDisable(user.getStatus())) {
        createLoginLog(user.getId(), username, logTypeEnum, LoginResultEnum.USER_DISABLED);
        <span class="hljs-keyword">throw</span> exception(AUTH_LOGIN_USER_DISABLED);
    }

    <span class="hljs-comment">// 所有校验通过，返回用户信息</span>
    <span class="hljs-keyword">return</span> user;
}

<span class="hljs-comment">// 密码比对：明文密码 vs 数据库加密密码</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isPasswordMatch</span><span class="hljs-params">(String rawPassword, String encodedPassword)</span> {
    <span class="hljs-comment">// 编码器内部会用加密时的盐值重新加密明文，再对比</span>
    <span class="hljs-keyword">return</span> passwordEncoder.matches(rawPassword, encodedPassword);
}
</code></pre>
<h3 data-id="heading-3">3. 步骤3：生成Token，登录成功的“通行证” 🎫</h3>
<p>验证通过后，就得给用户发“通行证”——Token。同时还要记录登录日志，方便后续排查问题。这一步的核心是调用Token服务生成凭证。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 登录成功后：生成Token+记日志+构造响应
 */</span>
<span class="hljs-keyword">private</span> AuthLoginRespVO <span class="hljs-title function_">createTokenAfterLoginSuccess</span><span class="hljs-params">(Long userId, String username, LoginLogTypeEnum logType)</span> {
    <span class="hljs-comment">// 记录成功日志，运营排查问题全靠它</span>
    createLoginLog(userId, username, logType, LoginResultEnum.SUCCESS);
    <span class="hljs-comment">// 调用OAuth2服务生成访问令牌</span>
    <span class="hljs-type">OAuth2AccessTokenDO</span> <span class="hljs-variable">accessTokenDO</span> <span class="hljs-operator">=</span> oauth2TokenService.createAccessToken(userId, getUserType().getValue(),
            OAuth2ClientConstants.CLIENT_ID_DEFAULT, <span class="hljs-literal">null</span>);
    <span class="hljs-comment">// 转换为前端需要的响应格式</span>
    <span class="hljs-keyword">return</span> AuthConvert.INSTANCE.convert(accessTokenDO);
}
</code></pre>
<h2 data-id="heading-4">二、Token生成深扒：OAuth2.0简化模式实战 🚀</h2>
<p>Token是用户登录后的“身份凭证”，芋道用了OAuth2.0的简化模式实现，核心是生成“访问令牌+刷新令牌”双凭证，既安全又灵活。整个流程分5步：</p>
<p>① 接收参数 → ② 校验客户端 → ③ 创建刷新令牌 → ④ 创建访问令牌 → ⑤ 返回结果</p>
<h3 data-id="heading-5">1. 入口方法：串联Token生成全流程</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 位于OAuth2TokenServiceImpl.java，事务注解保证原子性</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> OAuth2AccessTokenDO <span class="hljs-title function_">createAccessToken</span><span class="hljs-params">(Long userId, Integer userType,
                                             String clientId, List&lt;String&gt; scopes)</span> {
    <span class="hljs-comment">// ② 校验客户端：必须存在、启用、权限合法（核心校验）</span>
    <span class="hljs-type">OAuth2ClientDO</span> <span class="hljs-variable">clientDO</span> <span class="hljs-operator">=</span> oauth2ClientService.validOAuthClientFromCache(clientId);
    <span class="hljs-comment">// ③ 创建刷新令牌（有效期长，用于换访问令牌）</span>
    <span class="hljs-type">OAuth2RefreshTokenDO</span> <span class="hljs-variable">refreshTokenDO</span> <span class="hljs-operator">=</span> createOAuth2RefreshToken(userId, userType, clientDO, scopes);
    <span class="hljs-comment">// ④ 创建访问令牌（有效期短，用于接口调用）</span>
    <span class="hljs-keyword">return</span> createOAuth2AccessToken(refreshTokenDO, clientDO);
}
</code></pre>
<h3 data-id="heading-6">2. 客户端校验：确保请求来源合法 🔐</h3>
<p>客户端就像“请求的身份证”，必须校验它是不是系统认可的。这里还用了缓存加速，避免每次都查数据库。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 位于OAuth2ClientServiceImpl.java，客户端校验核心方法</span>
<span class="hljs-keyword">public</span> OAuth2ClientDO <span class="hljs-title function_">validOAuthClientFromCache</span><span class="hljs-params">(String clientId, String clientSecret,
                                                String grantType, Collection&lt;String&gt; scopes, String redirectUri)</span> {
    <span class="hljs-comment">// 先查缓存，没命中再查DB（缓存逻辑后面讲）</span>
    <span class="hljs-type">OAuth2ClientDO</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> getOAuth2ClientFromCache(clientId);
    <span class="hljs-keyword">if</span> (client == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> exception(OAUTH2_CLIENT_NOT_EXISTS); <span class="hljs-comment">// 客户端不存在</span>
    <span class="hljs-keyword">if</span> (CommonStatusEnum.isDisable(client.getStatus())) <span class="hljs-keyword">throw</span> exception(OAUTH2_CLIENT_DISABLE); <span class="hljs-comment">// 客户端已禁用</span>
    <span class="hljs-keyword">if</span> (!client.getScopes().containsAll(scopes)) <span class="hljs-keyword">throw</span> exception(OAUTH2_CLIENT_SCOPE_OVER); <span class="hljs-comment">// 权限越界</span>
    <span class="hljs-comment">// 其余4项校验省略...</span>
    <span class="hljs-keyword">return</span> client;
}
</code></pre>
<h3 data-id="heading-7">3. 双令牌生成：安全与便捷的平衡 🎯</h3>
<p>为什么要搞“访问令牌+刷新令牌”？因为访问令牌有效期短（比如2小时），泄露风险低；刷新令牌有效期长（比如7天），用来在访问令牌过期后“免登录续期”，用户体验好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/935d878d3786404a85c6f8923218933f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiJ5Y-q6JCM5paw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764290021&amp;x-signature=VtD%2FE8fjwY0SdYi579wx%2FgoXIx0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">刷新令牌生成</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> OAuth2RefreshTokenDO <span class="hljs-title function_">createOAuth2RefreshToken</span><span class="hljs-params">(Long userId, Integer userType,
                                                      OAuth2ClientDO client, List&lt;String&gt; scopes)</span> {
    <span class="hljs-type">OAuth2RefreshTokenDO</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OAuth2RefreshTokenDO</span>();
    entity.setId(generateId());          <span class="hljs-comment">// 雪花ID，唯一标识</span>
    entity.setRefreshToken(randomUUID());<span class="hljs-comment">// 随机串，安全不易猜</span>
    entity.setUserId(userId);            <span class="hljs-comment">// 关联用户ID</span>
    entity.setUserType(userType);        <span class="hljs-comment">// 用户类型</span>
    entity.setClientId(client.getClientId()); <span class="hljs-comment">// 关联客户端</span>
    entity.setScopes(scopes);            <span class="hljs-comment">// 权限范围</span>
    <span class="hljs-comment">// 过期时间：从客户端配置读取（比如7天）</span>
    entity.setExpiresTime(LocalDateTime.now()
                               .plusSeconds(client.getRefreshTokenValiditySeconds()));
    oauth2RefreshTokenMapper.insert(entity); <span class="hljs-comment">// 存DB+缓存</span>
    <span class="hljs-keyword">return</span> entity;
}
</code></pre>
<h4 data-id="heading-9">访问令牌生成</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> OAuth2AccessTokenDO <span class="hljs-title function_">createOAuth2AccessToken</span><span class="hljs-params">(OAuth2RefreshTokenDO refreshToken,
                                                   OAuth2ClientDO client)</span> {
    <span class="hljs-type">OAuth2AccessTokenDO</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OAuth2AccessTokenDO</span>();
    entity.setId(generateId());
    entity.setAccessToken(randomUUID()); <span class="hljs-comment">// 访问令牌随机串</span>
    entity.setRefreshTokenId(refreshToken.getId()); <span class="hljs-comment">// 关联刷新令牌</span>
    entity.setClientId(client.getClientId());
    <span class="hljs-comment">// 过期时间：客户端配置（比如2小时）</span>
    entity.setExpiresTime(LocalDateTime.now()
                               .plusSeconds(client.getAccessTokenValiditySeconds()));
    oauth2AccessTokenMapper.insert(entity); <span class="hljs-comment">// 存DB+缓存</span>
    <span class="hljs-keyword">return</span> entity; <span class="hljs-comment">// 最终返回给前端</span>
}
</code></pre>
<h2 data-id="heading-10">三、相关知识点 🛠️</h2>
<p>除了核心流程，异常处理、缓存、依赖注入这些“底层基建”，才是让登录功能稳定又好维护的关键。</p>
<h3 data-id="heading-11">1. 异常处理：用户和开发都省心 😌</h3>
<p>登录过程中会遇到各种错误：密码错、验证码错、服务器崩了... 芋道用“自定义异常+全局拦截”让错误处理更优雅。</p>
<h4 data-id="heading-12">为什么要自定义异常？</h4>
<p>JDK自带的异常（比如NullPointerException）分不清是“用户操作错”还是“系统出故障”。芋道把异常分成两类：</p>
<ul>
<li><strong>ServiceException（业务异常）</strong> ：用户能理解的错误，比如“密码错误”，带错误码和提示，前端直接展示给用户。</li>
<li><strong>ServerException（系统异常）</strong> ：服务器故障，比如数据库连不上，包装原始异常方便排查，给用户看“系统繁忙”即可。</li>
</ul>
<h4 data-id="heading-13">全局异常拦截：一次配置，处处生效</h4>
<p>用Spring的@RestControllerAdvice注解做全局拦截，不用在每个方法里写try-catch，代码超干净！</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestControllerAdvice</span> <span class="hljs-comment">// 全局异常处理器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {
    <span class="hljs-comment">// 处理业务异常（比如密码错误）</span>
    <span class="hljs-meta">@ExceptionHandler(ServiceException.class)</span>
    <span class="hljs-keyword">public</span> CommonResult&lt;?&gt; handleBiz(ServiceException ex) {
        log.warn(<span class="hljs-string">"业务异常: {}"</span>, ex.getMessage()); <span class="hljs-comment">// 只记警告，不打堆栈</span>
        <span class="hljs-keyword">return</span> CommonResult.error(ex.getCode(), ex.getMessage());
    }

    <span class="hljs-comment">// 处理系统异常（比如DB连接失败）</span>
    <span class="hljs-meta">@ExceptionHandler(ServerException.class)</span>
    <span class="hljs-keyword">public</span> CommonResult&lt;?&gt; handleSys(ServerException ex) {
        log.error(<span class="hljs-string">"系统异常"</span>, ex); <span class="hljs-comment">// 打完整堆栈，方便排查</span>
        <span class="hljs-keyword">return</span> CommonResult.error(ex.getCode(), <span class="hljs-string">"系统繁忙，请稍后再试"</span>);
    }

    <span class="hljs-comment">// 兜底处理其他未捕获异常</span>
    <span class="hljs-meta">@ExceptionHandler(Exception.class)</span>
    <span class="hljs-keyword">public</span> CommonResult&lt;?&gt; handleOther(Exception ex) {
        log.error(<span class="hljs-string">"未捕获异常"</span>, ex);
        <span class="hljs-keyword">return</span> CommonResult.error(<span class="hljs-number">500999</span>, <span class="hljs-string">"系统异常"</span>);
    }
}
</code></pre>
<p>前端永远收到结构一致的响应：{code, msg, data}，不用处理各种乱七八糟的错误格式，前后端协作效率翻倍！</p>
<h3 data-id="heading-14">2. 缓存：让登录更快，DB压力更小 ⚡</h3>
<p>客户端信息、用户信息这些高频访问的数据，每次都查DB太慢了。芋道用Redis做缓存，一行注解就实现“查缓存→没命中查DB→存缓存”的全流程。</p>
<h4 data-id="heading-15">第一步：加依赖+配Redis</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">cache:</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">redis</span>                  <span class="hljs-comment"># 用Redis做缓存</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">time-to-live:</span> <span class="hljs-string">1800s</span>        <span class="hljs-comment"># 默认30分钟过期</span>
      <span class="hljs-attr">cache-null-values:</span> <span class="hljs-literal">false</span>   <span class="hljs-comment"># 不缓存null，防穿透</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">password:</span>                    <span class="hljs-comment"># 无密码留空</span>
</code></pre>
<h4 data-id="heading-16">第二步：加个注解，缓存自动生效</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 查客户端信息的方法，加@Cacheable注解即可</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@Cacheable(cacheNames = RedisKeyConstants.OAUTH_CLIENT, key = "#clientId",
        unless = "#result == null")</span> <span class="hljs-comment">// 返回null不缓存，防穿透</span>
<span class="hljs-keyword">public</span> OAuth2ClientDO <span class="hljs-title function_">getOAuth2ClientFromCache</span><span class="hljs-params">(String clientId)</span> {
    <span class="hljs-comment">// 第一次调用：查DB；后续调用：直接从Redis拿，方法体都不执行</span>
    <span class="hljs-keyword">return</span> oauth2ClientMapper.selectById(clientId);
}
</code></pre>
<h4 data-id="heading-17">缓存执行流程，一目了然</h4>
<ol>
<li>第一次调用getOAuth2ClientFromCache("default") → 查Redis没命中 → 查DB → 结果存Redis（设30分钟过期）→ 返回数据。</li>
<li>第二次调用 → 查Redis命中 → 直接返回数据 → 方法体不执行（没SQL输出）。</li>
<li>返回null时 → unless条件生效 → 不存缓存，避免缓存穿透攻击。</li>
</ol>
<h3 data-id="heading-18">3. Spring依赖注入：不用自己new对象</h3>
<p>登录功能里用到了UserService、PasswordEncoder等各种服务，要是每次都自己new，代码会乱成一团。Spring的依赖注入帮我们搞定了“对象创建+管理+赋值”的全流程。</p>
<h4 data-id="heading-19">常用注入方式</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoService</span> {
    <span class="hljs-comment">// 1. @Resource：按名字注入（适合多实现）</span>
    <span class="hljs-meta">@Resource(name = "customValidator")</span>
    <span class="hljs-keyword">private</span> Validator validator;

    <span class="hljs-comment">// 2. @Autowired：按类型注入（适合唯一实现）</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MailService mailService;

    <span class="hljs-comment">// 3. @Autowired+@Qualifier：按名字+类型（多实现时精准匹配）</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-meta">@Qualifier("smsSender")</span>
    <span class="hljs-keyword">private</span> Sender sender;

    <span class="hljs-comment">// 4. 构造器注入：推荐！避免循环依赖，代码更健壮</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserDao userDao;
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DemoService</span><span class="hljs-params">(UserDao userDao)</span> {
        <span class="hljs-built_in">this</span>.userDao = userDao;
    }
}
</code></pre>
<h4 data-id="heading-20">注入核心原理</h4>
<p>Spring启动时会扫描带@Service、@Component等注解的类，用反射创建对象（这就是Bean），然后把这些Bean“塞”到需要的地方。简单说：你只管要，Spring负责给，不用自己new！</p>
<h3 data-id="heading-21">4. YAML配置：环境切换超灵活 🔄</h3>
<p>开发环境要关验证码，生产环境要开；开发环境连本地Redis，生产环境连云Redis——这些都靠YAML配置实现，不用改代码就能切换环境。</p>
<h4 data-id="heading-22">主配置+环境配置，优雅切换</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 主配置 application.yaml</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">local</span> <span class="hljs-comment"># 激活本地环境配置</span>

<span class="hljs-attr">yudao:</span>
  <span class="hljs-attr">captcha:</span>
    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 全局默认开验证码</span>
</code></pre>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 本地环境配置 application-local.yaml</span>
<span class="hljs-comment"># 覆盖主配置，本地关验证码</span>
<span class="hljs-attr">yudao:</span>
  <span class="hljs-attr">captcha:</span>
    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span>

<span class="hljs-comment"># 本地Redis配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 代码里用@Value读配置，自动适配当前环境</span>
<span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${yudao.captcha.enable:true}</span>"</span>)</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">Boolean</span> captchaEnable; <span class="hljs-comment">// 本地环境是false，生产环境是true</span>
</code></pre>
<h2 data-id="heading-23">四、总结：芋道登录功能的优秀设计思路 🎯</h2>
<p>把芋道的登录功能拆完，不得不说它的设计太值得学习了：</p>
<ul>
<li><strong>流程清晰</strong>：登录拆成“验验证码→认证账号→生成Token”，每个步骤职责单一，好维护。</li>
<li><strong>安全优先</strong>：统一错误提示防信息泄露、双Token机制降低风险、密码加密存储。</li>
<li><strong>开发友好</strong>：验证码开关、缓存注解、全局异常处理，各种细节提升开发效率。</li>
<li><strong>可扩展性强</strong>：基于OAuth2.0，后续加第三方登录（微信、QQ）也方便。</li>
</ul>
<p>登录功能虽然小，但藏着系统设计的大逻辑。希望这篇拆解能帮你吃透芋道的实战思路，下次自己写登录功能时，也能做到“安全、优雅、好维护”！ 🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 编程实战：环境管理与依赖管理（venv / Poetry）]]></title>    <link>https://juejin.cn/post/7574869203430359055</link>    <guid>https://juejin.cn/post/7574869203430359055</guid>    <pubDate>2025-11-21T00:44:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574869203430359055" data-draft-id="7574869203430342671" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 编程实战：环境管理与依赖管理（venv / Poetry）"/> <meta itemprop="keywords" content="后端,Python,Trae"/> <meta itemprop="datePublished" content="2025-11-21T00:44:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 编程实战：环境管理与依赖管理（venv / Poetry）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T00:44:39.000Z" title="Fri Nov 21 2025 00:44:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在实际的软件开发中，Python 环境混乱、依赖冲突、版本不一致等问题，是许多初学者和工程团队最常遇到的痛点。为了避免：</p>
</blockquote>
<ul>
<li>同一台机器上多个项目互相污染</li>
<li>版本升级导致旧项目无法运行</li>
<li>依赖越来越多、pip freeze 输出杂乱无章</li>
<li>跨团队开发难以复现项目环境</li>
</ul>
<p>我们必须掌握**环境管理（Environment Management）<strong>与</strong>依赖管理（Dependency Management）**这两项核心能力。</p>
<p>本篇文章对 Python 官方内置的虚拟环境工具 <code>venv</code> 以及现代依赖管理工具 <strong>Poetry</strong> 进行系统讲解，帮助你构建可靠、可复现的 Python 开发环境。</p>
<hr/>
<h2 data-id="heading-0">1. 为什么环境管理如此关键？</h2>
<p>如果你遇过以下问题，那么你一定需要虚拟环境：</p>
<ul>
<li>A 项目用 Django 2.x，B 项目用 Django 4.x，冲突怎么办？</li>
<li>升级 numpy 后，某个旧脚本无法运行？</li>
<li>新人加入团队，不知道安装哪些版本才能跑起来？</li>
<li>项目部署到生产服务器后报错 “ModuleNotFoundError”？</li>
</ul>
<p>这些问题的根源是：</p>
<h4 data-id="heading-1">不同项目需要不同的 Python 包依赖，不能在同一个全局环境中混合。</h4>
<p>因此，“一个项目一个独立环境”已经成为现代开发的事实标准。</p>
<hr/>
<h2 data-id="heading-2">2. venv：Python 官方内置虚拟环境工具</h2>
<p><code>venv</code> 是 Python 3 内置的环境隔离机制，特点是：</p>
<ul>
<li>无需安装额外工具</li>
<li>简单轻量</li>
<li>能满足大多数轻量项目需求</li>
<li>支持 Windows / macOS / Linux</li>
</ul>
<hr/>
<h3 data-id="heading-3">2.1 创建虚拟环境</h3>
<p>在项目目录下执行：</p>
<pre><code class="hljs language-bash" lang="bash">python3 -m venv venv
</code></pre>
<p>创建一个名为 <code>venv</code> 的虚拟环境目录，这里面包含：</p>
<ul>
<li>独立的 Python 可执行文件</li>
<li>独立的 site-packages 目录</li>
<li>pip 专属版本</li>
</ul>
<hr/>
<h3 data-id="heading-4">2.2 激活虚拟环境</h3>
<p>macOS / Linux：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> venv/bin/activate
</code></pre>
<p>Windows（命令行）：</p>
<pre><code class="hljs language-bash" lang="bash">venv\Scripts\activate
</code></pre>
<p>激活后终端前面会出现 <code>(venv)</code> 前缀。</p>
<hr/>
<h3 data-id="heading-5">2.3 安装依赖</h3>
<p>虚拟环境激活后安装的包只会影响当前项目：</p>
<pre><code class="hljs language-bash" lang="bash">pip install requests
pip install flask
</code></pre>
<hr/>
<h3 data-id="heading-6">2.4 导出依赖列表（requirements.txt）</h3>
<pre><code class="hljs language-bash" lang="bash">pip freeze &gt; requirements.txt
</code></pre>
<p>团队成员可以通过：</p>
<pre><code class="hljs language-bash" lang="bash">pip install -r requirements.txt
</code></pre>
<p>来复现同样的环境。</p>
<hr/>
<h3 data-id="heading-7">2.5 退出虚拟环境</h3>
<pre><code class="hljs language-bash" lang="bash">deactivate
</code></pre>
<hr/>
<h2 data-id="heading-8">3. venv 的不足与痛点</h2>
<p>虽然 venv 足够基础开发，但仍存在一些明显不足：</p>
<ul>
<li><code>requirements.txt</code> 不记录依赖树，容易出现“幽灵冲突”</li>
<li>不支持锁定依赖（锁文件）</li>
<li>无法方便管理多个命令、脚本</li>
<li>缺乏更加现代化的自动依赖解析功能</li>
<li>对多项目依赖管理支持较弱</li>
</ul>
<p>因此，大型项目、团队协作项目往往需要使用更现代的管理工具，例如 <strong>Poetry</strong>。</p>
<hr/>
<h2 data-id="heading-9">4. Poetry：现代 Python 依赖 &amp; 项目管理工具</h2>
<p>Poetry 的目标是提供一个完整、自洽的 Python 项目管理体验，包括：</p>
<ul>
<li>环境管理（virtualenv 自动管理）</li>
<li>依赖管理（自动解析正确版本）</li>
<li>锁文件（完全可复现的依赖版本）</li>
<li>构建和发布包</li>
<li>统一项目配置 (pyproject.toml)</li>
</ul>
<p>它已经成为近年来最受企业和开源社区欢迎的 Python 项目工具。</p>
<hr/>
<h2 data-id="heading-10">5. Poetry 快速上手</h2>
<h3 data-id="heading-11">5.1 安装 Poetry</h3>
<p>官方推荐脚本安装：</p>
<pre><code class="hljs language-bash" lang="bash">curl -sSL https://install.python-poetry.org | python3 -
</code></pre>
<p>安装完成后通过：</p>
<pre><code class="hljs language-bash" lang="bash">poetry --version
</code></pre>
<p>确认是否成功。</p>
<hr/>
<h2 data-id="heading-12">6. 使用 Poetry 创建项目</h2>
<p>在任意目录执行：</p>
<pre><code class="hljs language-bash" lang="bash">poetry new myproject
</code></pre>
<p>自动生成标准项目目录结构：</p>
<pre><code class="hljs language-markdown" lang="markdown">myproject/
<span class="hljs-code">    myproject/
        __init__.py
    tests/
    pyproject.toml
</span></code></pre>
<p>所有项目配置放在 <code>pyproject.toml</code> 中。</p>
<hr/>
<h2 data-id="heading-13">7. Poetry 依赖管理</h2>
<h3 data-id="heading-14">7.1 添加依赖</h3>
<pre><code class="hljs language-bash" lang="bash">poetry add requests
poetry add flask
</code></pre>
<p>Poetry 会自动解析可用版本，并生成：</p>
<ul>
<li><code>pyproject.toml</code>（版本范围）</li>
<li><code>poetry.lock</code>（锁定具体版本）</li>
</ul>
<hr/>
<h3 data-id="heading-15">7.2 安装项目依赖</h3>
<pre><code class="hljs language-bash" lang="bash">poetry install
</code></pre>
<p>这会：</p>
<ul>
<li>创建并管理独立的虚拟环境</li>
<li>安装所有依赖</li>
<li>保证可复现的版本一致性</li>
</ul>
<hr/>
<h3 data-id="heading-16">7.3 查看虚拟环境路径</h3>
<pre><code class="hljs language-bash" lang="bash">poetry <span class="hljs-built_in">env</span> info
</code></pre>
<hr/>
<h3 data-id="heading-17">7.4 激活虚拟环境</h3>
<pre><code class="hljs language-bash" lang="bash">poetry shell
</code></pre>
<p>退出：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">exit</span>
</code></pre>
<hr/>
<h2 data-id="heading-18">8. Poetry 常见功能</h2>
<h4 data-id="heading-19">① 添加开发依赖</h4>
<pre><code class="hljs language-bash" lang="bash">poetry add --dev pytest black
</code></pre>
<h4 data-id="heading-20">② 移除依赖</h4>
<pre><code class="hljs language-bash" lang="bash">poetry remove flask
</code></pre>
<h4 data-id="heading-21">③ 更新所有依赖</h4>
<pre><code class="hljs language-bash" lang="bash">poetry update
</code></pre>
<h4 data-id="heading-22">④ 构建包</h4>
<pre><code class="hljs language-bash" lang="bash">poetry build
</code></pre>
<h4 data-id="heading-23">⑤ 发布到 PyPI</h4>
<pre><code class="hljs language-bash" lang="bash">poetry publish
</code></pre>
<p>Poetry 完整覆盖了从开发到发布的流程。</p>
<hr/>
<h2 data-id="heading-24">9. venv 与 Poetry 对比总结</h2>


















































<table><thead><tr><th>功能</th><th>venv</th><th>Poetry</th></tr></thead><tbody><tr><td>是否内置</td><td>✔ 是</td><td>❌ 需安装</td></tr><tr><td>依赖解析</td><td>手动（pip）</td><td>自动</td></tr><tr><td>锁文件</td><td>无</td><td>✔ 有（poetry.lock）</td></tr><tr><td>可复现性</td><td>一般</td><td>很高</td></tr><tr><td>项目结构</td><td>自行维护</td><td>自动生成</td></tr><tr><td>包发布支持</td><td>无</td><td>✔ 支持</td></tr><tr><td>团队开发</td><td>需要技巧</td><td>更高效</td></tr><tr><td>适用场景</td><td>小项目、脚本</td><td>企业级项目、多人协作</td></tr></tbody></table>
<p>一句话总结：</p>
<ul>
<li>venv：轻量、基础、简单</li>
<li>Poetry：现代、强大、专业</li>
</ul>
<hr/>
<h2 data-id="heading-25">10. 实践建议：如何选择？</h2>
<h4 data-id="heading-26">如果是单机脚本、一次性任务</h4>
<p>→ 使用 venv + requirements.txt</p>
<h4 data-id="heading-27">如果是长期维护、多人协作、Web 后端、爬虫框架、数据分析项目</h4>
<p>→ 强烈推荐使用 Poetry</p>
<h4 data-id="heading-28">如果你是初学者</h4>
<p>→ 建议先用 venv 入门，再用 Poetry 提升工程化能力</p>
<hr/>
<h2 data-id="heading-29">结语</h2>
<p>无论是 venv 还是 Poetry，目的都是<strong>让项目环境更加可控、稳定、可复现</strong>。
掌握这些工具，是成为专业 Python 工程师的重要一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 编程实战 ：打包与发布（PyInstaller / pip 包发布）]]></title>    <link>https://juejin.cn/post/7574680270536982528</link>    <guid>https://juejin.cn/post/7574680270536982528</guid>    <pubDate>2025-11-21T00:45:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574680270536982528" data-draft-id="7574671792997548067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 编程实战 ：打包与发布（PyInstaller / pip 包发布）"/> <meta itemprop="keywords" content="后端,Python,Trae"/> <meta itemprop="datePublished" content="2025-11-21T00:45:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 编程实战 ：打包与发布（PyInstaller / pip 包发布）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T00:45:12.000Z" title="Fri Nov 21 2025 00:45:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Python 开发走向进阶和职业化的阶段，“把写好的代码交付出去”是无法绕开的能力。无论是给非技术人员提供可执行程序，还是将自己的项目发布到 PyPI，为全球开发者使用，掌握专业的打包与发布流程都是必须的。</p>
</blockquote>
<p>本篇博客从零到一带你熟悉：</p>
<ul>
<li><strong>PyInstaller</strong>：把 Python 项目打包成 EXE / APP</li>
<li><strong>pip 包发布流程</strong>：把你的项目推向 PyPI</li>
<li>常见坑与最佳实践</li>
</ul>
<p>让你写的 Python 程序能真正“走出去”，触达更多真实用户。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、使用 PyInstaller 打包可执行程序</strong></h2>
<h4 data-id="heading-1"><strong>1. PyInstaller 是什么？</strong></h4>
<p>PyInstaller 是将 Python 程序打包成可执行文件（如 Windows 的 <code>.exe</code>）的最常用工具。它会把 Python 解释器 + 所有依赖打包进一个独立文件，用户无需 Python 环境即可运行。</p>
<p>适合场景：</p>
<p>✔ 给用户分发桌面工具
✔ 内部办公自动化脚本
✔ GUI 程序（Tkinter、PyQt、wxPython 等）
✔ 命令行工具</p>
<hr/>
<h3 data-id="heading-2"><strong>2. PyInstaller 基本使用</strong></h3>
<p>安装：</p>
<pre><code class="hljs language-bash" lang="bash">pip install pyinstaller
</code></pre>
<p>最简单的打包：</p>
<pre><code class="hljs language-bash" lang="bash">pyinstaller main.py
</code></pre>
<p>完成后，目录结构如下：</p>
<pre><code class="hljs language-css" lang="css">dist/
    <span class="hljs-selector-tag">main</span>/
        <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.exe</span>
build/
<span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.spec</span>
</code></pre>
<p>最终可执行文件就在 <strong>dist</strong> 目录里。</p>
<hr/>
<h3 data-id="heading-3"><strong>3. 常用参数（必须掌握）</strong></h3>
<h4 data-id="heading-4"><strong>单文件打包</strong></h4>
<pre><code class="hljs language-bash" lang="bash">pyinstaller -F main.py
</code></pre>
<p>优点：只生成一个 <code>.exe</code>
缺点：启动稍慢</p>
<h4 data-id="heading-5"><strong>隐藏控制台窗口（GUI 程序）</strong></h4>
<pre><code class="hljs language-bash" lang="bash">pyinstaller -F -w main.py
</code></pre>
<h4 data-id="heading-6"><strong>加入图标</strong></h4>
<pre><code class="hljs language-bash" lang="bash">pyinstaller -F -i icon.ico main.py
</code></pre>
<h4 data-id="heading-7"><strong>添加数据文件（图片、配置、模型）</strong></h4>
<p>推荐在 <code>.spec</code> 文件中配置：</p>
<pre><code class="hljs language-python" lang="python">a = Analysis(
    ...,
    datas=[(<span class="hljs-string">'config.yml'</span>, <span class="hljs-string">'config.yml'</span>), (<span class="hljs-string">'assets/'</span>, <span class="hljs-string">'assets/'</span>)],
)
</code></pre>
<p>然后：</p>
<pre><code class="hljs language-bash" lang="bash">pyinstaller main.spec
</code></pre>
<hr/>
<h3 data-id="heading-8"><strong>4. 打包常见问题（超实用）</strong></h3>
<h4 data-id="heading-9"><strong>（1）打包后无法运行 / 缺少模块</strong></h4>
<p>原因：PyInstaller 未能自动识别依赖
解决：</p>
<pre><code class="hljs language-bash" lang="bash">pyinstaller -F main.py --hidden-import xx_module
</code></pre>
<hr/>
<h4 data-id="heading-10"><strong>（2）打包文件太大？</strong></h4>
<p>解决方式：</p>
<ul>
<li>使用 UPX 压缩</li>
<li>删除 matplotlib/numpy 中用不到的 DLL</li>
</ul>
<hr/>
<h4 data-id="heading-11"><strong>（3）Mac 打包的 app 无法在另一台 Mac 运行</strong></h4>
<p>因为 macOS 的签名安全机制，建议：</p>
<ul>
<li>在目标版本系统构建（如 macOS 14）</li>
<li>结合 <code>codesign --deep</code> 进行签名</li>
</ul>
<hr/>
<h2 data-id="heading-12"><strong>二、Python 包发布到 PyPI（pip install 可用）</strong></h2>
<p>让别人可以：</p>
<pre><code class="hljs language-bash" lang="bash">pip install yourpackage
</code></pre>
<p>这是专业 Python 开发者的重要能力之一。</p>
<hr/>
<h2 data-id="heading-13"><strong>1. 项目结构（最推荐）</strong></h2>
<pre><code class="hljs language-markdown" lang="markdown">myproject/
<span class="hljs-code">    myproject/
        __init__.py
        core.py
    tests/
    README.md
    pyproject.toml
    LICENSE
</span></code></pre>
<p>最关键：<strong>使用 pyproject.toml（现代标准）</strong></p>
<hr/>
<h2 data-id="heading-14"><strong>2. 使用 build 进行构建</strong></h2>
<p>安装：</p>
<pre><code class="hljs language-bash" lang="bash">pip install build twine
</code></pre>
<p>构建：</p>
<pre><code class="hljs language-bash" lang="bash">python -m build
</code></pre>
<p>生成：</p>
<pre><code class="hljs language-arduino" lang="arduino">dist/
    myproject<span class="hljs-number">-1.0</span><span class="hljs-number">.0</span>.tar.gz
    myproject<span class="hljs-number">-1.0</span><span class="hljs-number">.0</span>-py3-none-any.whl
</code></pre>
<hr/>
<h2 data-id="heading-15"><strong>3. 发布到 TestPyPI</strong></h2>
<p>避免污染正式 PyPI。</p>
<pre><code class="hljs language-bash" lang="bash">twine upload --repository testpypi dist/*
</code></pre>
<p>安装测试版：</p>
<pre><code class="hljs language-bash" lang="bash">pip install -i https://test.pypi.org/simple/ myproject
</code></pre>
<hr/>
<h2 data-id="heading-16"><strong>4. 正式发布到 PyPI</strong></h2>
<pre><code class="hljs language-bash" lang="bash">twine upload dist/*
</code></pre>
<p>全世界的人就都可以：</p>
<pre><code class="hljs language-bash" lang="bash">pip install myproject
</code></pre>
<hr/>
<h2 data-id="heading-17"><strong>5. pyproject.toml 示例（最推荐）</strong></h2>
<p>下面是一个专业示例，可直接复用：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[build-system]</span>
<span class="hljs-attr">requires</span> = [<span class="hljs-string">"setuptools&gt;=61"</span>, <span class="hljs-string">"wheel"</span>]
<span class="hljs-attr">build-backend</span> = <span class="hljs-string">"setuptools.build_meta"</span>

<span class="hljs-section">[project]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"myproject"</span>
<span class="hljs-attr">version</span> = <span class="hljs-string">"1.0.0"</span>
<span class="hljs-attr">authors</span> = [
    { name=<span class="hljs-string">"Your Name"</span>, email=<span class="hljs-string">"you@example.com"</span> }
]
<span class="hljs-attr">description</span> = <span class="hljs-string">"A powerful and modern Python utility."</span>
<span class="hljs-attr">readme</span> = <span class="hljs-string">"README.md"</span>
<span class="hljs-attr">license</span> = { file=<span class="hljs-string">"LICENSE"</span> }
<span class="hljs-attr">requires-python</span> = <span class="hljs-string">"&gt;=3.8"</span>
<span class="hljs-attr">dependencies</span> = [<span class="hljs-string">"requests"</span>, <span class="hljs-string">"numpy"</span>]

<span class="hljs-section">[project.urls]</span>
<span class="hljs-attr">Homepage</span> = <span class="hljs-string">"https://github.com/you/myproject"</span>
<span class="hljs-attr">Documentation</span> = <span class="hljs-string">"https://myproject-docs.com"</span>
</code></pre>
<hr/>
<h2 data-id="heading-18"><strong>6. PyPI 发布常见问题</strong></h2>
<h4 data-id="heading-19"><strong>（1）403 权限错误</strong></h4>
<p>未创建 API Token 或 Token 配置错误
→ 进入 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpypi.org%2Fmanage%2Faccount%2F" target="_blank" title="https://pypi.org/manage/account/" ref="nofollow noopener noreferrer">pypi.org/manage/acco…</a> 创建 Token 并更新 <code>.pypirc</code></p>
<hr/>
<h4 data-id="heading-20"><strong>（2）版本号冲突</strong></h4>
<p>PyPI 版本号不能重复
→ 每次发布前更新版本号（如：1.0.1 → 1.0.2）</p>
<hr/>
<h4 data-id="heading-21"><strong>（3）依赖未安装</strong></h4>
<p>确保 <code>dependencies</code> 正确写到 pyproject.toml</p>
<hr/>
<h2 data-id="heading-22"><strong>三、两者对比：应该用哪个？</strong></h2>






























<table><thead><tr><th>场景</th><th>PyInstaller</th><th>PyPI 包发布</th></tr></thead><tbody><tr><td>给普通用户（没 Python 环境）</td><td>✔ 最佳选择</td><td>✘</td></tr><tr><td>给开发者</td><td>✔</td><td>✔✔（最推荐）</td></tr><tr><td>分发 GUI 工具</td><td>✔</td><td>无意义</td></tr><tr><td>库 / SDK 发布</td><td>✘</td><td>✔最佳</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23"><strong>四、最佳实践总结</strong></h2>
<h4 data-id="heading-24">✔ 办公/桌面工具 → PyInstaller</h4>
<p>稳定、方便、用户无须 Python</p>
<h4 data-id="heading-25">✔ 开发者工具 → PyPI 发布</h4>
<p>现代 Python 项目的标准做法</p>
<h4 data-id="heading-26">✔ 推荐结合 CI 自动化发布</h4>
<p>GitHub Actions + PyPI + build
可以做到“打 tag 自动发布”</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习 LiteLLM 的用户管理体系]]></title>    <link>https://juejin.cn/post/7574677905500651546</link>    <guid>https://juejin.cn/post/7574677905500651546</guid>    <pubDate>2025-11-21T00:59:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574677905500651546" data-draft-id="7574685632095977499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习 LiteLLM 的用户管理体系"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-21T00:59:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日习一技"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习 LiteLLM 的用户管理体系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日习一技
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-21T00:59:59.000Z" title="Fri Nov 21 2025 00:59:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上一篇文章中，我们学习了 LiteLLM 的认证机制，从基础的虚拟 Key 到企业级的 JWT/OIDC 认证，了解了如何确保 API 访问的安全性。然而，认证只是第一步，解决的是 <strong>你是谁</strong> 的问题；接下来我们需要解决的是 <strong>你能做什么</strong> 的问题，这就是 <strong>用户管理</strong> 和 <strong>权限控制</strong> 要解决的问题。</p>
<h2 data-id="heading-0">核心概念</h2>
<p>LiteLLM 的用户管理体系建立在四个核心概念上：</p>
<ol>
<li><strong>组织（Organization）</strong> 可以包含多个团队，是 LiteLLM 中最高层级的管理单位，每个组织相当于一个独立的租户；</li>
<li><strong>团队（Team）</strong> 是组织内部的工作单位，可以包含多个内部用户；团队的设计非常灵活，你可以按部门划分，也可以按项目划分；</li>
<li><strong>内部用户（Internal Users）</strong> 可以创建 API Key、进行 API 调用、查看使用情况等；一个用户可以拥有多个 API Key，并且可以属于多个团队；</li>
<li><strong>API Key</strong> 用于 LiteLLM API 的身份验证，我们在上一篇详细介绍过，它可以与团队相关联，或与用户相关联，或同时与两者相关联；</li>
</ol>
<p>他们的关系如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18a7d26aea6d4cf388ae498bfb9b1f07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764291599&amp;x-signature=NcfAru0LLlAZ2KnX2V8OmPaghhA%3D" alt="user-heirarchy.png" loading="lazy"/></p>
<h3 data-id="heading-1">三种密钥类型</h3>
<p>正如上文所说，API Key 可以与团队或用户相关联，基于不同的组合，API Key 分为三种类型：</p>
<ol>
<li><strong>用户密钥（User-only Key）</strong>：它关联到特定用户，跟随用户生命周期，用于个人预算和追踪，当删除用户时密钥自动失效；适用于个人用户开发测试；</li>
<li><strong>团队密钥（Team Key / Service Account Key）</strong>：它关联到特定团队，不绑定个人身份，团队内共享资源，用户离开团队不影响密钥有效性；适用于生产服务、CI/CD 流水线、共享服务账户等；</li>
<li><strong>用户+团队密钥（User + Team Key）</strong>：同时关联用户和团队，能定位个人在团队上下文中的身份，同时追踪个人+团队的使用情况，当删除用户时密钥失效；适用于团队成员在团队资源上的个人工作、个人问责制的团队项目等；</li>
</ol>
<h3 data-id="heading-2">在 Admin UI 上创建密钥</h3>
<p>当我们在 Admin UI 上为用户创建 API Key 时，可以按需选择不同的组合：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb2a622f3920441fbcb587e04e97a93b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764291599&amp;x-signature=Fp9I%2BXPRzAYZuXTEVb%2Bd3pY1ICQ%3D" alt="create-key-user-or-team.png" loading="lazy"/></p>
<p>或者为团队创建 API Key，这个密钥也被称为 <strong>服务账户密钥</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75612c57a8784e5bb6e3e31542ea89de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764291599&amp;x-signature=9Rm%2BsfzJfdTacajQJBJsk6CCwi0%3D" alt="create-key-service-account.png" loading="lazy"/></p>
<p>注意，团队密钥在使用时，区分不了用户，LiteLLM 提供了一个可选的配置参数：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">general_settings:</span>
  <span class="hljs-attr">service_account_settings:</span> 
    <span class="hljs-attr">enforced_params:</span> [<span class="hljs-string">"user"</span>] <span class="hljs-comment"># 强制要求所有请求包含 user 参数</span>
</code></pre>
<p>要求所有通过服务账户的请求都必须包含 <code>user</code> 参数，以便进行用户级别的审计。</p>
<h3 data-id="heading-3">使用接口创建密钥</h3>
<p>我们也可以直接使用接口来创建这三种密钥。创建仅用户密钥：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_id": "zhangsan@example.com"
  }'</span>
</code></pre>
<blockquote>
<p>注意，这个 <code>user_id</code> 不必是系统已有用户，仅仅是一个标记而且。当然，你也可以先在平台上创建一个用户，然后将这里的 <code>user_id</code> 换成该用户的 ID。两者的区别在于创建的用户可以登录平台，查看或管理自己的 API Key 等。</p>
</blockquote>
<p>创建团队服务账户密钥：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/service-account/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "team_id": "&lt;team_id&gt;"
  }'</span>
</code></pre>
<p>创建用户+团队密钥：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_id": "zhangsan@example.com",
    "team_id": "&lt;team_id&gt;"
  }'</span>
</code></pre>
<blockquote>
<p>注意，这个 <code>team_id</code> 必须先在平台上创建团队获得。</p>
</blockquote>
<h2 data-id="heading-4">基于角色的访问控制</h2>
<p>了解了上面的层次结构之后，接下来学习 LiteLLM 的权限控制机制。LiteLLM 采用了 <strong>RBAC（基于角色的访问控制）</strong> 模型，这是业界最成熟的权限管理方式之一。RBAC 是一种将权限与角色关联，而不是与用户直接关联的访问控制方法。这种方式的优势在于：</p>
<ul>
<li><strong>简化管理</strong>：不必为每个用户单独分配权限，只需为角色分配权限</li>
<li><strong>权限复用</strong>：多个用户可以共享同一个角色</li>
<li><strong>动态调整</strong>：调整角色权限即可影响所有相关用户</li>
</ul>
<p>LiteLLM 定义了两类角色系统：<strong>全局代理角色（Global Proxy Roles）</strong> 和 <strong>组织/团队特定角色（Organization/Team Specific Roles）</strong>，理解这些角色是使用 LiteLLM 权限管理的基础。</p>
<h3 data-id="heading-5">全局代理角色</h3>
<p>全局代理角色又分为 <strong>代理管理员（Proxy Admin）</strong>、<strong>代理查看者（Proxy Admin Viewer）</strong>、<strong>内部用户（Internal User）</strong>、<strong>内部用户查看者（Internal User Viewer）</strong> 四种，这些角色在整个 LiteLLM 平台范围内生效，不受组织或团队边界限制。</p>
<h4 data-id="heading-6">代理管理员</h4>
<p>这是最高权限角色，控制整个 LiteLLM 平台，只有运行 LiteLLM 实例的人才应该有这个角色：</p>
<pre><code class="hljs">✅ 创建和管理所有组织
✅ 创建和管理所有团队（跨所有组织）
✅ 创建和管理所有用户
✅ 为任何人创建/删除 API 密钥
✅ 查看整个平台的消费成本
✅ 更新团队预算、速率限制
✅ 管理团队成员
</code></pre>
<h4 data-id="heading-7">代理查看者</h4>
<p>这是一个只读的管理员角色，可查看所有信息但不能修改，适合财务或审计人员：</p>
<pre><code class="hljs">可以做：
✅ 查看所有组织、团队和用户
✅ 查看整个平台的消费数据
✅ 查看所有 API 密钥信息
✅ 登录到管理面板

不能做：
❌ 创建或删除密钥
❌ 添加或删除用户
❌ 修改预算或速率限制
</code></pre>
<h4 data-id="heading-8">内部用户</h4>
<p>这是一般用户角色，拥有基本的操作权限，如管理自己的密钥和查看自己的消费，适用于普通员工：</p>
<pre><code class="hljs">可以做：
✅ 创建和删除自己的 API 密钥（如果允许）
✅ 查看自己的消费成本
✅ 使用 API 密钥进行 LLM 调用

不能做：
❌ 添加新用户
❌ 查看其他用户的信息
❌ 创建或管理团队
</code></pre>
<h4 data-id="heading-9">内部用户查看者</h4>
<p>⚠️ <strong>注意</strong>：这个角色已经被新的组织/团队特定角色所取代。建议迁移到更灵活的 <code>org_admin</code> 或 <code>team_admin</code> 角色。</p>
<h3 data-id="heading-10">组织/团队特定角色</h3>
<p>这些是 LiteLLM 企业版中的角色，提供了更细粒度的权限控制，主要分为 <strong>组织管理员（Org Admin）</strong>、<strong>团队管理员（Team Admin）</strong> 以及 <strong>团队成员（User）</strong> 四种：</p>
<h4 data-id="heading-11">组织管理员</h4>
<p>该角色拥有特定组织内的所有管理权限，适用于部门主管、组织负责人等：</p>
<pre><code class="hljs">可以做：
✅ 创建团队（在自己的组织内）
✅ 添加用户到团队（在自己的组织内）
✅ 查看组织的消费成本
✅ 为组织内的用户创建 API 密钥

不能做：
❌ 创建其他组织
❌ 修改组织预算和速率限制
❌ 添加全局代理级别的模型
</code></pre>
<h4 data-id="heading-12">团队管理员</h4>
<p>该角色拥有特定团队内的所有管理权限，适用于团队负责人，比如项目经理、小组组长、产品负责人等：</p>
<pre><code class="hljs">可以做：
✅ 添加或删除团队成员
✅ 为团队成员创建/删除密钥
✅ 更新团队成员的预算和速率限制
✅ 修改团队设置（预算、速率限制、模型访问）
✅ 配置团队成员权限
✅ 为团队添加自定义模型（如微调模型）

不能做：
❌ 创建新团队
❌ 修改团队的全局预算和速率限制
❌ 访问其他团队的资源
</code></pre>
<h4 data-id="heading-13">团队成员</h4>
<p>该角色对应团队内的普通成员，拥有团队内的基础权限，团队管理员可以对团队成员的权限进行精确控制，LiteLLM 支持的权限项包括：</p>




























































<table><thead><tr><th>权限</th><th>请求方法</th><th>描述</th></tr></thead><tbody><tr><td><code>/key/info</code></td><td>GET</td><td>查看密钥信息</td></tr><tr><td><code>/key/health</code></td><td>GET</td><td>检查密钥健康状态</td></tr><tr><td><code>/key/list</code></td><td>GET</td><td>列出团队所有密钥</td></tr><tr><td><code>/key/generate</code></td><td>POST</td><td>创建新密钥</td></tr><tr><td><code>/key/service-account/generate</code></td><td>POST</td><td>创建服务账户密钥</td></tr><tr><td><code>/key/update</code></td><td>POST</td><td>修改现有密钥</td></tr><tr><td><code>/key/delete</code></td><td>POST</td><td>删除密钥</td></tr><tr><td><code>/key/regenerate</code></td><td>POST</td><td>轮换密钥</td></tr><tr><td><code>/key/block</code></td><td>POST</td><td>禁用密钥</td></tr><tr><td><code>/key/unblock</code></td><td>POST</td><td>启用密钥</td></tr></tbody></table>
<h2 data-id="heading-14">用户管理实操</h2>
<p>创建一个名为 XYZ Corp 的组织：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/organization/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "organization_alias": "XYZ Corp"
  }'</span>
</code></pre>
<p>得到组织 ID：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"organization_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"42bea353-4697-4f01-a362-25fd096aeb5a"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"organization_alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"XYZ Corp"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>为组织创建一个组织管理员：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/organization/member_add'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "organization_id": "42bea353-4697-4f01-a362-25fd096aeb5a", 
    "member": {
      "role": "org_admin", 
      "user_id": "desmond@example.com"
    }
  }'</span>
</code></pre>
<p>注意，该接口会自动在系统中创建一个 <code>user_id</code> 为 <code>desmond@example.com</code> 的用户，角色为 <code>org_admin</code> 组织管理员。</p>
<p>为该用户创建 API Key：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_id": "desmond@example.com"
  }'</span>
</code></pre>
<p>调用结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"user_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"desmond@example.com"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-xTiqwzA2xJWzac2xk8og7w"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-...og7w"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后组织管理员就可以通过他的 API Key 去创建团队了：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/team/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-xTiqwzA2xJWzac2xk8og7w'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "team_alias": "engineering_team",
    "organization_id": "42bea353-4697-4f01-a362-25fd096aeb5a"
  }'</span>
</code></pre>
<p>得到团队 ID：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"team_alias"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"engineering_team"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"team_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"36100710-1fb1-4d6a-abd7-1fda8d171771"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"organization_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"42bea353-4697-4f01-a362-25fd096aeb5a"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>组织管理员可以为团队创建一个团队管理员：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/team/member_add'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-xTiqwzA2xJWzac2xk8og7w'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "team_id": "36100710-1fb1-4d6a-abd7-1fda8d171771", 
    "member": {
      "role": "admin", 
      "user_id": "stonie@example.com"
    }
  }'</span>
</code></pre>
<p>同样的，该接口会自动在系统中创建一个 <code>user_id</code> 为 <code>stonie@example.com</code> 的用户，角色为 <code>admin</code> 团队管理员。</p>
<p>也为该用户创建 API Key：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_id": "stonie@example.com"
  }'</span>
</code></pre>
<p>调用结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"user_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stonie@example.com"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-jhSg1qFKYEIg8ndYmmmFHg"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-...mFHg"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>这里看官方文档，应该使用组织管理员的 API Key 去生成团队管理的 API Key，但是我在测试时报错 <code>User can only create keys for themselves</code>，因此使用了代理管理员的 API Key。</p>
</blockquote>
<p>团队管理员可以添加或移除团队成员、修改团队的预算和费率限制、配置团队成员的权限等，下面是添加成员的接口示例：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/team/member_add'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-jhSg1qFKYEIg8ndYmmmFHg'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "team_id": "36100710-1fb1-4d6a-abd7-1fda8d171771", 
    "member": {
      "role": "user", 
      "user_id": "zhangsan@example.com"
    }
  }'</span>
</code></pre>
<p>为该用户生成 API Key：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/key/generate'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_id": "zhangsan@example.com",
    "team_id": "36100710-1fb1-4d6a-abd7-1fda8d171771"
  }'</span>
</code></pre>
<p>调用结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"user_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhangsan@example.com"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-If8su0G3z3GlgwaA6acpLg"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-...cpLg"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>这里看官方文档，应该使用团队管理员的 API Key 去生成用户的 API Key，但是我在测试时报错 <code>User can only create keys for themselves</code>，因此使用了代理管理员的 API Key。</p>
</blockquote>
<h2 data-id="heading-15">用户自助服务</h2>
<p>上面创建的这些用户，无论是组织管理员、团队管理员还是团队用户，目前都无法登录平台，只能通过 API Key 来进行管理操作，这是相当繁琐的。LiteLLM 支持用户自助服务，它让用户可以在不依赖管理员的情况下管理自己的密钥和查看使用情况。</p>
<p>首先，为他们生成邀请链接：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/invitation/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_id": "desmond@example.com"
  }'</span>
</code></pre>
<p>该接口生成的是邀请 ID：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"35186fe0-5b96-4e75-a285-f17fbf3add0d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"user_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"desmond@example.com"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>将邀请 ID 拼接到 <code>http://127.0.0.1:4000/ui?invitation_id=</code> 后面，得到类似下面的链接地址：</p>
<pre><code class="hljs language-ini" lang="ini">http://127.0.0.1:4000/ui?<span class="hljs-attr">invitation_id</span>=<span class="hljs-number">35186</span>fe0-<span class="hljs-number">5</span>b96-<span class="hljs-number">4</span>e75-a285-f17fbf3add0d
</code></pre>
<p>将链接地址发送给用户，他就可以登录平台了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af4dcf3a0fd64fe2b9bdd05f2cfa7364~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764291599&amp;x-signature=%2Bsn8o3h8YhwMljtSIbuc%2F1qw3jA%3D" alt="invitation-link.png" loading="lazy"/></p>
<p>登录平台后，根据用户的角色，展示的菜单也不一样。比如普通用户可以查看或创建自己的 API Key：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e57927c5ccc448c85402a4cf3e8576c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764291599&amp;x-signature=9yUvQND2lILQJYzvYsfUB9802b0%3D" alt="user-login.png" loading="lazy"/></p>
<p>注意上面的邮箱地址是空的，虽然也能登录，但是下次用户再登录时就麻烦了（需要管理员编辑用户邮箱）。可以使用下面的接口来创建用户，为用户设置邮箱地址：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/user/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_email": "stonie@example.com",
    "user_role": "internal_user"
  }'</span>
</code></pre>
<p>这个接口在创建用户的同时也会为其创建一个 API Key：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"user_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"72f9e797-0e9a-41f5-a227-03a8a813c7cc"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-EIKmPPTyBriwpCW1NYV8aw"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"key_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-...V8aw"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"user_email"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stonie@example.com"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"user_role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"internal_user"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后使用该用户的 ID 来生成邀请链接：</p>
<pre><code class="hljs language-bash" lang="bash">$ curl -X POST <span class="hljs-string">'http://127.0.0.1:4000/invitation/new'</span> \
  -H <span class="hljs-string">'Authorization: Bearer sk-1234'</span> \
  -H <span class="hljs-string">'Content-Type: application/json'</span> \
  -d <span class="hljs-string">'{
    "user_id": "72f9e797-0e9a-41f5-a227-03a8a813c7cc"
  }'</span>
</code></pre>
<p>之后用户就可以通过邮箱登录平台了。</p>
<h2 data-id="heading-16">小结</h2>
<p>通过这篇文章，我们系统地学习了 LiteLLM 的用户管理体系，主要内容包括：</p>
<ul>
<li><strong>多层次管理架构</strong>：从组织 → 团队 → 用户的三层结构，组织层用于大型企业的多租户隔离，团队层用于项目组的资源共享和协作，用户层用于个人开发者的独立预算和追踪；</li>
<li><strong>灵活的权限控制</strong>：支持代理管理员、代理查看者、内部用户等全局代理角色，以及组织管理员、团队管理员、普通成员等组织/团队特定角色，还可以精确地控制每个用户能执行的操作；</li>
<li><strong>用户自助服务</strong>：支持为用户生成邀请链接，允许用户在不依赖管理员的情况下管理自己的密钥和查看使用情况；</li>
</ul>
<p>在下一篇文章中，我们将学习 LiteLLM 的 <strong>访问控制机制</strong>，包括如何为不同的用户和团队分配不同的模型访问权限，如何设置和执行流量控制策略，以及如何进行成本预算管理和预警。这是用户管理体系的延伸和深化，将帮助我们构建一个完整的 LLM 网关安全体系。敬请期待！</p>
<h2 data-id="heading-17">欢迎关注</h2>
<p>如果这篇文章对您有所帮助，欢迎关注我的同名公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">日习一技，每天学一点新技术</a>。</p>
<p>我会每天花一个小时，记录下我学习的点点滴滴。内容包括但不限于：</p>
<ul>
<li>某个产品的使用小窍门</li>
<li>开源项目的实践和心得</li>
<li>技术点的简单解读</li>
</ul>
<p>目标是让大家用5分钟读完就能有所收获，不需要太费劲，但却可以轻松获取一些干货。不管你是技术新手还是老鸟，欢迎给我提建议，如果有想学习的技术，也欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（137）Redis的模块机制是什么？]]></title>    <link>https://juejin.cn/post/7574677905500520474</link>    <guid>https://juejin.cn/post/7574677905500520474</guid>    <pubDate>2025-11-20T23:04:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574677905500520474" data-draft-id="7574685632095797275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（137）Redis的模块机制是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T23:04:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（137）Redis的模块机制是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T23:04:06.000Z" title="Thu Nov 20 2025 23:04:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis 模块机制允许开发者扩展 Redis 的功能，通过编写动态加载的模块，可以向 Redis 添加新的命令、数据类型、事件处理器等。Redis 模块机制提供了一套 C 语言 API，开发者可以基于这些 API 实现自己的模块。</p>
<h3 data-id="heading-0">核心概念和数据结构</h3>
<h4 data-id="heading-1">1. Redis 模块 API</h4>
<p>Redis 提供了一套模块 API，主要通过 <code>redismodule.h</code> 头文件定义。开发者需要包含该头文件并使用其中的函数和宏来实现模块。</p>
<h4 data-id="heading-2">2. 模块结构</h4>
<p>每个模块需要定义一个 <code>RedisModuleCtx</code> 结构体，表示模块上下文，以及若干模块命令。</p>
<h4 data-id="heading-3">3. 模块命令</h4>
<p>模块可以通过 <code>RedisModule_CreateCommand</code> 函数注册新的命令，每个命令对应一个处理函数。</p>
<h3 data-id="heading-4">模块开发步骤</h3>
<ol>
<li><strong>包含头文件</strong>：包含 <code>redismodule.h</code> 头文件。</li>
<li><strong>定义模块上下文</strong>：定义并初始化模块上下文。</li>
<li><strong>实现命令处理函数</strong>：实现命令处理函数。</li>
<li><strong>注册命令</strong>：在模块初始化函数中注册命令。</li>
<li><strong>编译和加载模块</strong>：编译模块为动态库，并通过 <code>MODULE LOAD</code> 命令加载模块。</li>
</ol>
<h3 data-id="heading-5">示例模块代码</h3>
<p>以下是一个简单的 Redis 模块示例，展示了如何实现一个新的命令 <code>hello.world</code>，该命令返回 "Hello, World!" 字符串。</p>
<h4 data-id="heading-6">1. 包含头文件</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"redismodule.h"</span></span>
</code></pre>
<h4 data-id="heading-7">2. 实现命令处理函数</h4>
<p>命令处理函数使用 <code>RedisModuleString</code> 类型表示参数，并通过 <code>RedisModule_ReplyWithSimpleString</code> 函数返回结果。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">HelloWorldCommand</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> RedisModule_WrongArity(ctx);
    }
    RedisModule_ReplyWithSimpleString(ctx, <span class="hljs-string">"Hello, World!"</span>);
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}
</code></pre>
<h4 data-id="heading-8">3. 模块初始化函数</h4>
<p>模块初始化函数用于注册模块和命令。通过 <code>RedisModule_Init</code> 函数初始化模块，通过 <code>RedisModule_CreateCommand</code> 函数注册命令。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">RedisModule_OnLoad</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (RedisModule_Init(ctx, <span class="hljs-string">"hello"</span>, <span class="hljs-number">1</span>, REDISMODULE_APIVER_1) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">if</span> (RedisModule_CreateCommand(ctx, <span class="hljs-string">"hello.world"</span>, HelloWorldCommand, <span class="hljs-string">"readonly"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}
</code></pre>
<h4 data-id="heading-9">4. 编译和加载模块</h4>
<p>将上述代码保存为 <code>hello.c</code> 文件，并通过以下命令编译为动态库：</p>
<pre><code class="hljs language-sh" lang="sh">gcc -fPIC -shared -o hello.so hello.c -I/path/to/redis/src
</code></pre>
<p>然后，通过 Redis 客户端加载模块：</p>
<pre><code class="hljs language-sh" lang="sh">redis-cli MODULE LOAD ./hello.so
</code></pre>
<p>加载成功后，可以使用新命令 <code>hello.world</code>：</p>
<pre><code class="hljs language-sh" lang="sh">redis&gt; hello.world
<span class="hljs-string">"Hello, World!"</span>
</code></pre>
<h3 data-id="heading-10">更复杂的模块示例</h3>
<p>为了展示更复杂的功能，下一个示例展示了如何实现一个简单的计数器模块，该模块支持两个命令 <code>counter.incr</code> 和 <code>counter.get</code>，分别用于增加计数器和获取当前计数。</p>
<h4 data-id="heading-11">1. 包含头文件</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"redismodule.h"</span></span>
</code></pre>
<h4 data-id="heading-12">2. 定义全局变量</h4>
<p>定义一个全局变量表示计数器的值。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> counter = <span class="hljs-number">0</span>;
</code></pre>
<h4 data-id="heading-13">3. 实现命令处理函数</h4>
<p>实现 <code>counter.incr</code> 和 <code>counter.get</code> 命令的处理函数。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">CounterIncrCommand</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> RedisModule_WrongArity(ctx);
    }
    counter++;
    RedisModule_ReplyWithLongLong(ctx, counter);
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}

<span class="hljs-type">int</span> <span class="hljs-title function_">CounterGetCommand</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> RedisModule_WrongArity(ctx);
    }
    RedisModule_ReplyWithLongLong(ctx, counter);
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}
</code></pre>
<h4 data-id="heading-14">4. 模块初始化函数</h4>
<p>在模块初始化函数中注册 <code>counter.incr</code> 和 <code>counter.get</code> 命令。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">RedisModule_OnLoad</span><span class="hljs-params">(RedisModuleCtx *ctx, RedisModuleString **argv, <span class="hljs-type">int</span> argc)</span> {
    <span class="hljs-keyword">if</span> (RedisModule_Init(ctx, <span class="hljs-string">"counter"</span>, <span class="hljs-number">1</span>, REDISMODULE_APIVER_1) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">if</span> (RedisModule_CreateCommand(ctx, <span class="hljs-string">"counter.incr"</span>, CounterIncrCommand, <span class="hljs-string">"write"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">if</span> (RedisModule_CreateCommand(ctx, <span class="hljs-string">"counter.get"</span>, CounterGetCommand, <span class="hljs-string">"readonly"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == REDISMODULE_ERR) {
        <span class="hljs-keyword">return</span> REDISMODULE_ERR;
    }
    <span class="hljs-keyword">return</span> REDISMODULE_OK;
}
</code></pre>
<h4 data-id="heading-15">5. 编译和加载模块</h4>
<p>将代码保存为 <code>counter.c</code> 文件，并通过以下命令编译为动态库：</p>
<pre><code class="hljs language-sh" lang="sh">gcc -fPIC -shared -o counter.so counter.c -I/path/to/redis/src
</code></pre>
<p>然后，通过 Redis 客户端加载模块：</p>
<pre><code class="hljs language-sh" lang="sh">redis-cli MODULE LOAD ./counter.so
</code></pre>
<p>加载成功后，可以使用新命令 <code>counter.incr</code> 和 <code>counter.get</code>：</p>
<pre><code class="hljs language-sh" lang="sh">redis&gt; counter.incr
(<span class="hljs-built_in">integer</span>) 1
redis&gt; counter.incr
(<span class="hljs-built_in">integer</span>) 2
redis&gt; counter.get
(<span class="hljs-built_in">integer</span>) 2
</code></pre>
<h3 data-id="heading-16">总结</h3>
<p>Redis 模块机制使得开发者可以通过编写扩展模块来增强 Redis 的功能。通过模块，开发者可以实现自定义命令、数据结构以及事件处理器。模块开发的基本步骤包括包含模块 API 头文件、定义模块上下文、实现命令处理函数、注册命令以及编译和加载模块。上述示例展示了如何实现简单的模块命令，以及更复杂的功能如计数器模块。通过这些示例，开发者可以理解 Redis 模块机制的基本原理和实现方法，并根据需要扩展 Redis 的功能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（136）Redis的客户端缓存是如何实现的？]]></title>    <link>https://juejin.cn/post/7574658078270193715</link>    <guid>https://juejin.cn/post/7574658078270193715</guid>    <pubDate>2025-11-20T23:02:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574658078270193715" data-draft-id="7574657475430531098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（136）Redis的客户端缓存是如何实现的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T23:02:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（136）Redis的客户端缓存是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T23:02:27.000Z" title="Thu Nov 20 2025 23:02:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis 的客户端缓存（Client-Side Caching）是一项重要特性，允许客户端在本地缓存 Redis 数据，从而减少与 Redis 服务器的通信频率，提高应用的响应速度和可扩展性。Redis 客户端缓存的实现主要依赖于以下几个核心组件和机制：</p>
<ol>
<li><strong>订阅机制</strong>：客户端通过订阅特定的键空间事件，获取键的变更通知。</li>
<li><strong>通知机制</strong>：Redis 服务器在键发生变更时，通过发布/订阅（Pub/Sub）机制将变更通知推送给客户端。</li>
<li><strong>缓存一致性</strong>：确保客户端缓存与 Redis 服务器的数据一致性。</li>
</ol>
<h3 data-id="heading-0">核心概念和数据结构</h3>
<h4 data-id="heading-1">1. 客户端缓存模式</h4>
<p>Redis 提供了两种客户端缓存模式：</p>
<ul>
<li><strong>主动推模式</strong>（Tracking Mode）：服务器主动向客户端推送键的变更通知。</li>
<li><strong>被动拉模式</strong>（Polling Mode）：客户端定期从服务器拉取键的变更信息。</li>
</ul>
<h4 data-id="heading-2">2. 客户端状态</h4>
<p>每个客户端的状态通过 <code>client</code> 结构体维护，其中包含缓存相关的信息：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">client</span> {</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-type">uint64_t</span> client_tracking_redirection; <span class="hljs-comment">/* Redirected ID for tracking invalidation messages */</span>
    <span class="hljs-type">uint64_t</span> client_tracking_locks; <span class="hljs-comment">/* Number of tracking locks */</span>
    <span class="hljs-type">uint8_t</span> client_tracking_prefixes; <span class="hljs-comment">/* Number of tracking prefixes */</span>
    <span class="hljs-comment">// ...</span>
} client;
</code></pre>
<h3 data-id="heading-3">启用客户端缓存</h3>
<p>客户端缓存可以通过 <code>CLIENT CACHING</code> 命令启用和配置。</p>
<pre><code class="hljs language-c" lang="c">redis&gt; CLIENT CACHING yes

OK
</code></pre>
<h3 data-id="heading-4">订阅键空间事件</h3>
<p>通过订阅键空间事件，客户端能够接收到指定键的变更通知。订阅通过 <code>PSUBSCRIBE</code> 命令实现：</p>
<pre><code class="hljs language-c" lang="c">redis&gt; PSUBSCRIBE <span class="hljs-string">"__keyspace@0__:mykey"</span>
</code></pre>
<h3 data-id="heading-5">通知机制</h3>
<p>Redis 服务器通过发布/订阅机制将变更通知推送给客户端。这通过 <code>trackingInvalidateKey</code> 和相关函数实现。</p>
<h4 data-id="heading-6">1. 启用键空间通知</h4>
<p>首先，需要在 Redis 配置文件中启用键空间通知：</p>
<pre><code class="hljs language-conf" lang="conf">notify-keyspace-events Ex
</code></pre>
<h4 data-id="heading-7">2. 处理键变更事件</h4>
<p>当键发生变更时，Redis 会调用 <code>trackingInvalidateKey</code> 函数来处理变更事件。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">trackingInvalidateKey</span><span class="hljs-params">(client *c, robj *keyobj)</span> {
    <span class="hljs-keyword">if</span> (!keyobj) <span class="hljs-keyword">return</span>;

    sds sdskey = keyobj-&gt;ptr;
    <span class="hljs-type">size_t</span> keylen = sdslen(sdskey);

    <span class="hljs-comment">// 查找所有订阅该键的客户端并发送无效化消息</span>
    listNode *ln;
    listIter li;
    listRewind(server.tracking_clients, &amp;li);
    <span class="hljs-keyword">while</span> ((ln = listNext(&amp;li)) != <span class="hljs-literal">NULL</span>) {
        client *target = listNodeValue(ln);
        <span class="hljs-keyword">if</span> (target == c) <span class="hljs-keyword">continue</span>;

        <span class="hljs-comment">// 发送无效化消息</span>
        addReplyArrayLen(target, <span class="hljs-number">2</span>);
        addReplyBulkCString(target, <span class="hljs-string">"invalidate"</span>);
        addReplyBulk(target, keyobj);
    }
}
</code></pre>
<h3 data-id="heading-8">缓存一致性管理</h3>
<p>为了确保客户端缓存的一致性，Redis 通过以下机制管理缓存：</p>
<h4 data-id="heading-9">1. 追踪表</h4>
<p>Redis 维护一个追踪表，用于记录每个客户端订阅的键。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trackingTableEntry</span> {</span>
    sds key;
    client *c;
} trackingTableEntry;

dict *tracking_table;
</code></pre>
<h4 data-id="heading-10">2. 键变更通知</h4>
<p>当键发生变更时，Redis 会遍历追踪表，查找订阅该键的客户端，并发送变更通知。</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">void</span> <span class="hljs-title function_">notifyKeyspaceEvent</span><span class="hljs-params">(<span class="hljs-type">int</span> type, <span class="hljs-type">char</span> *event, robj *key, <span class="hljs-type">int</span> dbid)</span> {
    <span class="hljs-comment">// 构建订阅频道名称</span>
    sds channel = sdsnewlen(<span class="hljs-string">"__keyspace@"</span>, <span class="hljs-number">11</span>);
    channel = sdscatprintf(channel, <span class="hljs-string">"%d__"</span>, dbid);
    channel = sdscatsds(channel, key);

    <span class="hljs-comment">// 发送通知</span>
    <span class="hljs-built_in">list</span> *clients = dictFetchValue(tracking_table, channel);
    <span class="hljs-keyword">if</span> (clients != <span class="hljs-literal">NULL</span>) {
        listIter li;
        listNode *ln;
        listRewind(clients, &amp;li);
        <span class="hljs-keyword">while</span> ((ln = listNext(&amp;li)) != <span class="hljs-literal">NULL</span>) {
            client *c = listNodeValue(ln);
            <span class="hljs-keyword">if</span> (c-&gt;flags &amp; CLIENT_CLOSE_AFTER_REPLY) <span class="hljs-keyword">continue</span>;
            addReplyArrayLen(c, <span class="hljs-number">3</span>);
            addReplyBulkCString(c, <span class="hljs-string">"message"</span>);
            addReplyBulk(c, channel);
            addReplyBulkCString(c, event);
        }
    }
    sdsfree(channel);
}
</code></pre>
<h3 data-id="heading-11">代码示例</h3>
<p>以下是一个简单的代码示例，展示了如何在客户端启用缓存并处理键变更通知：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hiredis/hiredis.h&gt;</span></span>

<span class="hljs-type">void</span> <span class="hljs-title function_">onMessage</span><span class="hljs-params">(redisAsyncContext *c, <span class="hljs-type">void</span> *reply, <span class="hljs-type">void</span> *privdata)</span> {
    redisReply *r = (redisReply *)reply;
    <span class="hljs-keyword">if</span> (r == <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Received message: %s\n"</span>, r-&gt;element[<span class="hljs-number">2</span>]-&gt;str);
}

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span> {
    redisAsyncContext *c = redisAsyncConnect(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">6379</span>);
    <span class="hljs-keyword">if</span> (c-&gt;err) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Error: %s\n"</span>, c-&gt;errstr);
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }

    <span class="hljs-comment">// 启用客户端缓存</span>
    redisAsyncCommand(c, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-string">"CLIENT CACHING yes"</span>);

    <span class="hljs-comment">// 订阅键空间事件</span>
    redisAsyncCommand(c, onMessage, <span class="hljs-literal">NULL</span>, <span class="hljs-string">"PSUBSCRIBE __keyspace@0__:mykey"</span>);

    <span class="hljs-comment">// 事件循环</span>
    redisAsyncSetConnectCallback(c, <span class="hljs-literal">NULL</span>);
    redisAsyncSetDisconnectCallback(c, <span class="hljs-literal">NULL</span>);
    redisAsyncCommand(c, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-string">"PING"</span>);

    redisAsyncContext *sub = redisAsyncConnect(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">6379</span>);
    redisAsyncCommand(sub, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-string">"SUBSCRIBE __keyspace@0__:mykey"</span>);

    redisEventLoop(sub);

    redisAsyncFree(c);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h3 data-id="heading-12">总结</h3>
<p>Redis 的客户端缓存通过订阅机制和通知机制实现，确保客户端能够及时获取键的变更信息，从而保持缓存的一致性。通过启用客户端缓存和订阅键空间事件，客户端可以有效地减少与 Redis 服务器的通信频率，并显著提升应用的响应速度。上述代码示例展示了如何启用客户端缓存并处理键变更通知，以及 Redis 在后台如何管理和发送变更通知的实现细节。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 VARCHAR(1000) 存不了 1000 个汉字？ —— 详解主流数据库“字段长度”的底层差异]]></title>    <link>https://juejin.cn/post/7574633217762787382</link>    <guid>https://juejin.cn/post/7574633217762787382</guid>    <pubDate>2025-11-20T15:35:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574633217762787382" data-draft-id="7574633217762770998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 VARCHAR(1000) 存不了 1000 个汉字？ —— 详解主流数据库“字段长度”的底层差异"/> <meta itemprop="keywords" content="后端,数据库,MySQL"/> <meta itemprop="datePublished" content="2025-11-20T15:35:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="G探险者"/> <meta itemprop="url" content="https://juejin.cn/user/3746749190244072"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 VARCHAR(1000) 存不了 1000 个汉字？ —— 详解主流数据库“字段长度”的底层差异
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3746749190244072/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    G探险者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T15:35:37.000Z" title="Thu Nov 20 2025 15:35:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是G探险者！</p>
<p>在开发过程中，我们经常遇到这样的灵异现象：明明数据库字段设置为 <code>VARCHAR(1000)</code>，前端校验也限制了 1000 个字，但用户提交时后端却报错：<strong>“Data too long”</strong>。</p>
<p>这并非因为数据库坏了，而是因为不同的数据库对**“长度（Length）”**的定义完全不同。有的按“人眼看到的字”算，有的按“计算机存储的字节”算。</p>
<p>本文将横向对比主流数据库（MySQL, Oracle, SQL Server, PostgreSQL, 达梦）的字段长度表现，并给出避坑建议。</p>
<hr/>
<h3 data-id="heading-0">一、 核心预备知识：字符 vs 字节</h3>
<p>在讨论数据库之前，必须先明确“汇率”问题。在最常用的 <strong>UTF-8</strong> 编码下：</p>
<ul>
<li><strong>1 个英文字符</strong> = 1 字节</li>
<li><strong>1 个数字</strong> = 1 字节</li>
<li><strong>1 个普通汉字</strong> = <strong>3 字节</strong> (常见)</li>
<li><strong>1 个 Emoji 表情/生僻字</strong> = 4 字节</li>
</ul>
<blockquote>
<p><strong>误区</strong>：很多老系统使用 GBK 编码，GBK 下 1 个汉字 = 2 字节。但现在互联网应用绝大多数使用 UTF-8。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">二、 主流数据库大盘点</h3>
<h4 data-id="heading-2">1. MySQL (5.0及以上版本)</h4>
<ul>
<li><strong>定义单位</strong>：<strong>字符 (Character)</strong></li>
<li><strong>表现</strong>：<code>VARCHAR(1000)</code> = <strong>1000 个字符</strong>。
<ul>
<li>你可以存 1000 个 'A'。</li>
<li>也可以存 1000 个 '中'。</li>
</ul>
</li>
<li><strong>结论</strong>：MySQL 是最符合人类直觉的。如果报错，通常是因为包含 Emoji（需要 utf8mb4）或者富文本标签占用了额外长度。</li>
</ul>
<h4 data-id="heading-3">2. Oracle</h4>
<ul>
<li><strong>定义单位</strong>：默认是 <strong>字节 (Byte)</strong></li>
<li><strong>表现</strong>：<code>VARCHAR2(1000)</code> = <strong>1000 个字节</strong>。
<ul>
<li>存英文：可以存 1000 个。</li>
<li>存汉字（UTF-8）：只能存约 <strong>333</strong> 个（<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1000</mn><mo>÷</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">1000 \div 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1000</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">÷</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span>）。</li>
</ul>
</li>
<li><strong>特殊情况</strong>：如果在定义时显式写为 <code>VARCHAR2(1000 CHAR)</code>，则按字符算。但在很多公司规范中，默认不加 CHAR，即按字节算。</li>
<li><strong>常见报错</strong>：<code>ORA-12899: value too large for column</code>。</li>
</ul>
<h4 data-id="heading-4">3. SQL Server</h4>
<ul>
<li><strong>情况比较特殊，分为两类字段</strong>：
<ul>
<li><code>VARCHAR(1000)</code>：<strong>字节</strong>（且仅支持非 Unicode）。存中文极易乱码或出错。</li>
<li><code>NVARCHAR(1000)</code>：<strong>字符</strong>。</li>
</ul>
</li>
<li><strong>表现</strong>：
<ul>
<li><code>NVARCHAR(1000)</code> = <strong>1000 个字符</strong>（无论中英文）。</li>
</ul>
</li>
<li><strong>结论</strong>：在 SQL Server 中存中文，<strong>必须</strong>使用 <code>NVARCHAR</code>，长度就是字数。</li>
</ul>
<h4 data-id="heading-5">4. PostgreSQL</h4>
<ul>
<li><strong>定义单位</strong>：<strong>字符 (Character)</strong></li>
<li><strong>表现</strong>：与 MySQL 类似，<code>VARCHAR(1000)</code> = 1000 个字符。</li>
<li><strong>特点</strong>：PG 对文本长度非常宽容，底层机制使得 <code>TEXT</code> 和 <code>VARCHAR</code> 性能差异极小，很多 PG 开发者习惯直接用 <code>TEXT</code>。</li>
</ul>
<h4 data-id="heading-6">5. 达梦数据库 (Dameng / DM)</h4>
<ul>
<li><strong>定义单位</strong>：<strong>取决于初始化参数 <code>LENGTH_IN_CHAR</code></strong>。
<ul>
<li><strong>默认情况 (0)</strong>：按 <strong>字节</strong> 算。<code>VARCHAR(1000)</code> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"/><span class="mrel">≈</span></span></span></span></span> 333 个汉字。</li>
<li><strong>修改配置后 (1)</strong>：按 <strong>字符</strong> 算。<code>VARCHAR(1000)</code> = 1000 个汉字。</li>
</ul>
</li>
<li><strong>现状</strong>：绝大多数生产环境安装时都保持默认值（按字节），因此达梦是“存不够字”问题的重灾区。</li>
</ul>
<hr/>
<h3 data-id="heading-7">三、 横向对比速查表</h3>
<p>假设我们需要存储 <strong>1000 个汉字</strong> (UTF-8编码)，各数据库字段该如何定义？</p>





























































<table><thead><tr><th align="left">数据库类型</th><th align="left">字段类型选择</th><th align="left">定义长度 (N)</th><th align="left">计算逻辑</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left"><strong>MySQL</strong></td><td align="left">VARCHAR</td><td align="left"><strong>1000</strong></td><td align="left">按字符</td><td align="left">最省心</td></tr><tr><td align="left"><strong>PostgreSQL</strong></td><td align="left">VARCHAR</td><td align="left"><strong>1000</strong></td><td align="left">按字符</td><td align="left">同样省心</td></tr><tr><td align="left"><strong>SQL Server</strong></td><td align="left"><strong>N</strong>VARCHAR</td><td align="left"><strong>1000</strong></td><td align="left">按字符</td><td align="left">必须带 N</td></tr><tr><td align="left"><strong>Oracle</strong></td><td align="left">VARCHAR2</td><td align="left"><strong>3000</strong></td><td align="left">按字节</td><td align="left">需乘以 3 (推荐留余量至 4000)</td></tr><tr><td align="left"><strong>Oracle</strong> (写法二)</td><td align="left">VARCHAR2</td><td align="left">1000 <strong>CHAR</strong></td><td align="left">按字符</td><td align="left">需确认 DBA 是否允许</td></tr><tr><td align="left"><strong>达梦 (默认)</strong></td><td align="left">VARCHAR</td><td align="left"><strong>3000</strong></td><td align="left">按字节</td><td align="left">同 Oracle，需乘以 3</td></tr><tr><td align="left"><strong>达梦 (配置后)</strong></td><td align="left">VARCHAR</td><td align="left">1000</td><td align="left">按字符</td><td align="left">需检查 <code>LENGTH_IN_CHAR=1</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">四、 最佳实践与避坑建议</h3>
<p>为了避免上线后出现 <code>Data too long</code> 异常，建议遵循以下原则：</p>
<ol>
<li>
<p><strong>“乘以 3 再加点”原则</strong>
如果你的数据库是 Oracle 或 达梦（默认配置），且前端限制用户输入 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span> 个字，数据库字段长度建议设置为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>×</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">N \times 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">3</span></span></span></span></span> 甚至 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>×</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">N \times 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">4</span></span></span></span></span>。</p>
<blockquote>
<p><em>例子：用户输入 1000 字，数据库设为 <code>VARCHAR(3000)</code> 或 <code>VARCHAR(4000)</code>。</em></p>
</blockquote>
</li>
<li>
<p><strong>警惕富文本编辑器</strong>
如果前端是一个富文本框（能加粗、变色、换行），用户虽然只看见 1000 个字，但实际传输的 HTML 代码（<code>&lt;span style="..."&gt;...&lt;/span&gt;</code>）可能长达 5000 字符。</p>
<blockquote>
<p><em>对策：富文本字段直接使用 <code>TEXT</code> / <code>CLOB</code> / <code>LONGTEXT</code> 类型，不要用 VARCHAR。</em></p>
</blockquote>
</li>
<li>
<p><strong>统一使用 TEXT/CLOB</strong>
对于超过 2000 字的长文本，不要纠结于 VARCHAR 的具体长度，直接使用大文本类型：</p>
<ul>
<li><strong>MySQL/PG</strong>: <code>TEXT</code></li>
<li><strong>Oracle/达梦</strong>: <code>CLOB</code> (Character Large Object)</li>
<li><strong>SQL Server</strong>: <code>NVARCHAR(MAX)</code></li>
</ul>
</li>
<li>
<p><strong>前端截断机制</strong>
无论数据库存多大，前端在提交数据前，务必计算字符串长度。</p>
<ul>
<li><em>注意</em>：如果后端按字节限制（如 Oracle），前端校验最好也写一个 <code>lengthInBytes</code> 函数来计算，而不仅仅是 <code>string.length</code>。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">总结</h3>
<ul>
<li><strong>MySQL / PG / SQL Server(NVARCHAR)</strong>：你说多少就是多少。</li>
<li><strong>Oracle / 达梦</strong>：你说多少，还要看看它每个字“有多重”（占多少字节）。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift6 @retroactive：Swift 的重复协议遵循陷阱]]></title>    <link>https://juejin.cn/post/7574641470138171407</link>    <guid>https://juejin.cn/post/7574641470138171407</guid>    <pubDate>2025-11-20T15:36:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574641470138171407" data-draft-id="7574626451750010880" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift6 @retroactive：Swift 的重复协议遵循陷阱"/> <meta itemprop="keywords" content="Swift,SwiftUI"/> <meta itemprop="datePublished" content="2025-11-20T15:36:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RickeyBoy"/> <meta itemprop="url" content="https://juejin.cn/user/2928754706626136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift6 @retroactive：Swift 的重复协议遵循陷阱
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754706626136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RickeyBoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T15:36:10.000Z" title="Thu Nov 20 2025 15:36:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>欢迎大家给我点个 star！<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRickeyBoy%2FRickey-iOS-Notes" target="_blank" title="https://github.com/RickeyBoy/Rickey-iOS-Notes" ref="nofollow noopener noreferrer">Github: RickeyBoy</a></p>
</blockquote>
<h2 data-id="heading-0">背景：一个看似简单的 bug</h2>
<p>App 内有一个电话号码输入界面，在使用时用户需要从中选择注册电话对应的国家，以获取正确的电话区号前缀（比如中国是 +86，英国是 +44 等）。</p>















<table><thead><tr><th>Step 1：入口</th><th>Step 2：缺少区号</th><th>期望结果</th></tr></thead><tbody><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88bebd9d6138439ea9e88a1d90cc6c45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764257903&amp;x-signature=SoHdHq8S9UUJInvuPw7PpowGIdA%3D" alt="image1.png" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/263625b1d06b4221aad570ad848fab18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764257903&amp;x-signature=jAEH2M3qpaozIonPmdR6HKeZegI%3D" alt="image2.png" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09c3a1dfdde44621b84a4e4b8193dd7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764257903&amp;x-signature=WTIJt20%2B6T9FMOZT%2FmdkLhoyTd4%3D" alt="image3.png" loading="lazy"/></td></tr></tbody></table>
<p>这是一个看似很简单的 bug，无非就是写 UI 的时候漏掉了区号，那么把对应字段拼上去就行了嘛。不过一番调查之后发现事情没有那么简单。</p>
<p>列表是一个公用组件，我们需要在列表中显示国家及其电话区号，格式像这样："🇬🇧 United Kingdom (+44)"。所以之前在 <strong>User 模块</strong>中添加了这个extension：</p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span>: @<span class="hljs-title class_">retroactive</span> <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span> {
            code
        }
    ​
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(englishName) ((phoneCode))"</span>
        }
    }
</code></pre>
<p>原理一看就明白，displayValue 代表的是展示的内容。但是<strong>最终结果展示错误了</strong>：明明将电话区号 <code>((phoneCode))</code> 拼在了上面，为什么只显示了国家名称："🇬🇧 United Kingdom"？</p>
<p>代码可以编译。测试通过。没有警告。但功能在生产环境中却是坏的。</p>
<blockquote>
<p>顺便说一下，什么是 DropdownSelectable？</p>
<p><code>DropdownSelectable</code> 是我们 DesignSystem 模块中的一个协议，它使任何类型都能与我们的下拉 UI 组件配合使用：</p>
</blockquote>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-keyword">protocol</span> <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> }           <span class="hljs-comment">// 唯一标识符</span>
        <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> { <span class="hljs-keyword">get</span> } <span class="hljs-comment">// 列表中显示的内容</span>
    }
</code></pre>
<h2 data-id="heading-1">Part 1: extension 不起作用了</h2>
<h3 data-id="heading-2">发现问题</h3>
<p>经过调试后，我们发现了根本原因：<strong>Addresses 模块已经有一个类似的 extension</strong>：</p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-comment">// 在 Addresses 模块中</span>
    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span>: @<span class="hljs-title class_">retroactive</span> <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(englishName)"</span>  <span class="hljs-comment">// 没有电话区号</span>
        }
    }
</code></pre>













<table><thead><tr><th>Step 1</th><th>Step 2</th></tr></thead><tbody><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4da340902a4d4f5baeae87204e672131~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764257903&amp;x-signature=ww%2BkmLGJGWsiYPADKb9Uc43UHrM%3D" alt="image4.png" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ac313e346d540b1af11d13846305be7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmlja2V5Qm95:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764257903&amp;x-signature=AbzmlU4ghQTNrRUzkNz32Uc567Q%3D" alt="image5.png" loading="lazy"/></td></tr></tbody></table>
<p>Addresses 模块不需要电话区号，只需要国家名称。这对地址列表来说是合理的。</p>
<p>但关键是：<strong>Addresses extension 在运行时覆盖了我们 User extension</strong>。我们以为在使用 User 模块的extension（带电话区号），但 Swift 随机选择了 Addresses 的 extension（不带电话区号）。</p>
<p>这就是关键问题。</p>
<h3 data-id="heading-3">冲突：同时存在两个拓展协议</h3>
<p>代码中发现的两处冲突的拓展协议：</p>
<p><strong>在 User 模块中（我们以为在使用的）：</strong></p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span>: @<span class="hljs-title class_">retroactive</span> <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span> {
            code
        }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(englishName) ((phoneCode))"</span>  <span class="hljs-comment">// ✅ 带电话区号</span>
        }
    }
</code></pre>
<p><strong>在 Addresses 模块中（实际被使用的）：</strong></p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span>: @<span class="hljs-title class_">retroactive</span> <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span> {
            code
        }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(englishName)"</span>  <span class="hljs-comment">// ❌ 不带电话区号</span>
        }
    }
</code></pre>
<p>两个模块都有各自合理的实现理由：</p>
<ul>
<li><strong>User 模块</strong>：电话号码输入界面需要电话区号</li>
<li><strong>Addresses 模块</strong>：地址表单不需要电话区号，只需要国家名称</li>
</ul>
<p>每个开发者都在实现需求时添加了他们需要的内容。代码编译没有警告，新需求测试通过，没人预料到会对旧的需求产生影响。</p>
<p>同时，确实 Swift 也是允许在不同模块中使用相同的 extension。那么到底发生了什么，我们又是如何解决的呢？</p>
<h2 data-id="heading-4">Part 2: 为什么会发生这种情况 - Swift 模块系统解析</h2>
<p>要理解为什么这是一个问题，我们需要理解 Swift 的模块系统是如何工作的。有趣的是：<strong>通常情况下，在不同模块中有相同的 extension 是完全没问题的</strong>。但协议遵循是一个特殊情况。</p>
<h3 data-id="heading-5">正常情况：extension 在模块间通常工作良好</h3>
<p>假设你为一个类型添加了一个辅助方法：</p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-comment">// 在 UserModule 中</span>
    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span> {
        <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            <span class="hljs-keyword">return</span> emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(englishName) ((phoneCode))"</span>
        }
    }
    <span class="hljs-comment">// 在 AddressesModule 中</span>
    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span> {
        <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            <span class="hljs-keyword">return</span> emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(englishName)"</span>
        }
    }
</code></pre>
<p>这完全可以！每个模块看到的是它自己的extension：</p>
<ul>
<li>UserModule 中的代码调用 <code>displayValue</code> 会得到带 <code>phoneCode</code> 的结果</li>
<li>AddressesModule 中的代码调用 <code>displayValue</code> 会得到不带 <code>phoneCode</code> 的结果</li>
</ul>
<p><strong>为什么可以：</strong> 常规 extension 方法在编译时根据导入的模块来解析。Swift 根据当前模块的导入准确知道要调用哪个方法。</p>
<h3 data-id="heading-6">特殊情况：协议遵循是全局的</h3>
<p>但协议遵循的工作方式不同。当你写：</p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span>: <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> { <span class="hljs-operator">...</span> }
    }
</code></pre>
<p>你不只是在添加一个方法。你在做一个<strong>全局声明</strong>："对于整个应用程序，Country 遵循 DropdownSelectable。"</p>
<p>所以当你创建两个相同的遵循时，会导致<strong>重复遵循错误</strong></p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-comment">// 在 UserModule 中</span>
    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span>: <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            <span class="hljs-keyword">return</span> emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(englishName) ((phoneCode))"</span>
        }
    }
    <span class="hljs-comment">// 在 AddressesModule 中</span>
    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span>: <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            <span class="hljs-keyword">return</span> emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(englishName)"</span>
        }
    }
</code></pre>
<p>当你构建链接两个模块的应用时，Swift 编译器或链接器会报错，类似这样：</p>
<blockquote>
<p>'Country' declares conformance to protocol 'DropdownSelectable' multiple times</p>
</blockquote>
<h2 data-id="heading-7">Part 3: 引入 @retroactive 破坏了编译器检查</h2>
<h3 data-id="heading-8">剩余问题：这怎么能编译通过？</h3>
<p>基本上，如果我们遇到<strong>重复遵循错误</strong>，编译器会阻止我们。但是为什么这段代码可以正常存在？</p>
<p>一切问题都可以被归咎于 <code>@retroactive</code>。</p>
<h3 data-id="heading-9">什么是 @retroactive？</h3>
<p>在 Swift 6 中，Apple 引入了 <code>@retroactive</code> 关键字来让跨模块遵循变得明确：</p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-keyword">extension</span> <span class="hljs-title class_">Country</span>: @<span class="hljs-title class_">retroactive</span> <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-comment">// 让一个外部类型</span>
        <span class="hljs-comment">// 遵循一个外部协议</span>
    }
</code></pre>
<p>你需要使用 <code>@retroactive</code> 当：</p>
<ul>
<li>类型定义在不同的模块中（例如，来自模块 A 的 <code>Country</code>）</li>
<li>协议定义在不同的模块中（例如，来自模块 B 的 <code>DropdownSelectable</code>）</li>
<li>你在第三个模块中添加遵循（例如，在 <code>UserModule</code> 和 <code>AddressesModule</code> 中）</li>
</ul>
<h3 data-id="heading-10">为什么 @retroactive 会破坏编译器检查重复编译问题？</h3>
<p>没有 <code>@retroactive</code> 的情况下，重复遵循已经是编译时错误。但有了 <code>@retroactive</code>，问题变得更加棘手 —— 因为现在你明确声明了影响<strong>整个应用运行时</strong>的东西，而不仅仅是你的模块。</p>
<p>当你写 <code>@retroactive</code> 时，你在说：</p>
<blockquote>
<p>"我要为一个我不拥有的现有类型添加遵循，作用于整个 App。"</p>
</blockquote>
<p>这意味着编译器允许你 <em>追溯地/逆向地（retroactively）</em> 为在其他地方定义的类型添加遵循。这很强大，但也改变了 Swift 检查重复的方式。</p>
<p><strong>关键点：</strong></p>
<p>Swift 在<strong>每个模块内</strong>强制执行重复遵循规则，但<strong>不跨模块</strong>。换句话说，编译器只检查它当前正在构建的代码。</p>
<ul>
<li>每个生产者模块（UserModule、AddressesModule）<strong>单独编译时是正常的</strong>（它只"看到"自己的遵循）。到目前为止是正常的。</li>
<li>导入两者的消费者（至少你有一个，就是你的 <strong>app target</strong>！），会构建失败，因为它看到了<strong>两个相同的协议遵循</strong>。</li>
</ul>
<p><strong>添加 @retroactive 之后：</strong></p>
<p>使用 <code>@retroactive</code>，Swift <strong>将一些检查推迟到链接时</strong>，所以两个模块都能成功编译，即使它们都在声明相同的全局遵循。</p>
<p>重复只有在<strong>链接之后</strong>才会变得可见，当两个模块都被加载到同一个运行时镜像中时 —— 而那时，编译器已经太晚无法阻止它了。</p>
<p>这就是为什么这些重复可以"逃过"编译器的安全检查，导致令人困惑的运行时级别的 bug。</p>
<h3 data-id="heading-11">运行时发生了什么</h3>
<p>当链接器发现 <code>(Country, DropdownSelectable)</code> 有两个实现时：</p>
<ul>
<li>选项 A：UserModule 的实现（带电话区号）</li>
<li>选项 B：AddressesModule 的实现（不带电话区号）</li>
</ul>
<p><strong>它只能注册一个</strong>。所以它根据链接顺序选择一个 —— 基本上是链接器首先处理的那个模块。另一个遵循会被静默忽略。</p>
<p>这解释了为什么 UserModule 的实现被忽略了。</p>
<h2 data-id="heading-12">Part 4: 解决方案 - 包装结构体来拯救</h2>
<p>幸运的是我们有一个非常简单的修复方法：<strong>使用包装类型</strong>。</p>
<h3 data-id="heading-13">解决方案模式</h3>
<p>不要让 <code>Country</code> 本身遵循协议，而是包装它：</p>
<pre><code class="hljs language-swift" lang="swift">    <span class="hljs-comment">// UserModule 示例</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">CountryWithPhoneDropdown</span>: <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">let</span> country: <span class="hljs-type">Country</span>
        <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span> { country.code }
        <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            country.emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(country.englishName) ((country.phoneCode))"</span>
        }
    }
    <span class="hljs-comment">// AddressModule 示例</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">CountryAddressDropdown</span>: <span class="hljs-title class_">DropdownSelectable</span> {
        <span class="hljs-keyword">let</span> country: <span class="hljs-type">Country</span>

        <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span> { country.code }
        <span class="hljs-keyword">var</span> displayValue: <span class="hljs-type">String</span> {
            country.emoji <span class="hljs-operator">+</span> <span class="hljs-string">"<span class="hljs-subst">\t</span>(country.englishName)"</span>
        }
    }
    <span class="hljs-comment">// 使用方式</span>
    countries.map { <span class="hljs-type">CountryWithPhoneDropdown</span>(country: <span class="hljs-variable">$0</span>) }
    countries.map { <span class="hljs-type">CountryAddressDropdown</span>(country: <span class="hljs-variable">$0</span>) }
</code></pre>
<h2 data-id="heading-14"><strong>Part 5: 预防 — 如何防止它再次发生</strong></h2>
<p>当然，如果想要不仅是修复这个问题，而是预防这个问题，那么可以通过在工作流程中添加<strong>静态分析</strong>或 <strong>CI 检查</strong>来轻松避免重复的 <code>@retroactive</code> 遵循。</p>
<p>这确保任何重复的 <code>@retroactive</code> 遵循在<strong>到达生产环境之前</strong>被发现，避免类似的运行时错误。</p>
<h2 data-id="heading-15">结语</h2>
<p>这个 bug 根本不是简单的 UI 问题，想要彻底解决就需要深度理解 Swift 的运行机制。协议拓展可以跨模块重复，但协议遵循是全局的，<code>@retroactive</code> 叠加 Swift 的这种能力造成了这次的 bug。</p>
<p>一旦我们理解了这一点，修复就很简单了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码界震动！OpenAI的GPT-5.1-Codex-Max颠覆生产力？]]></title>    <link>https://juejin.cn/post/7574651025727963174</link>    <guid>https://juejin.cn/post/7574651025727963174</guid>    <pubDate>2025-11-20T14:06:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574651025727963174" data-draft-id="7574677905500160026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码界震动！OpenAI的GPT-5.1-Codex-Max颠覆生产力？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-20T14:06:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码界震动！OpenAI的GPT-5.1-Codex-Max颠覆生产力？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T14:06:21.000Z" title="Thu Nov 20 2025 14:06:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>各位AI圈的朋友们，最近有没有被一则消息刷屏？OpenAI在11月19日（也有消息说是20日，但普遍说法是19日）扔下了一颗重磅炸弹：新一代智能体编程模型<strong>GPT-5.1-Codex-Max</strong>正式登场！说实话，这可不仅仅是版本号的更新，更像是为我们描绘了一个全新的代码开发图景，预示着软件工程领域即将迎来一场效率革命。</p>
<p>作为一名AI圈的观察者，我不得不说，这次发布真的让人眼前一亮。OpenAI毫不掩饰地将这款模型定位为对抗谷歌Gemini 3 Pro的利器，并拿出了一系列亮眼的数据来支撑。那么，这款号称能“颠覆生产力”的Code-Max究竟藏着哪些秘密武器呢？咱们今天就来好好聊聊。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-20_21.53.15-1024x884.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-20_21.53.15-1024x884.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a6cfc9935d2457da65c68ae556b1006~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764252381&amp;x-signature=7tuV50UNDLCsw3uFzPQLRZqZM3o%3D" alt="iShot_2025-11-20_21.53.15" loading="lazy"/></a></p>
<h4 data-id="heading-0">“永动”引擎：百万Token上下文的魔法</h4>
<p>想象一下，一个AI能不眠不休地帮你重构代码、调试bug，甚至能自主完成长达24小时的复杂项目改造。是不是有点科幻？但GPT-5.1-Codex-Max凭借其独创的**“压缩（Compaction）”机制**，让这成为了现实。当上下文窗口快要“撑爆”时，它能像一个经验老到的工程师，自动梳理历史记录，只保留关键信息，丢弃冗余细节，从而在数百万个Token之间连续工作，确保任务流畅进行。这简直是给AI代码助手装上了“永动机”，解决了传统大模型在处理长时间、复杂任务时“失忆”的痛点。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-20_21.53.26-1024x851.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-20_21.53.26-1024x851.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0927ba46561b430399c64b0bb1e485ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764252381&amp;x-signature=EJrANHA7dWPRfkUabMoiFxMegpM%3D" alt="iShot_2025-11-20_21.53.26" loading="lazy"/></a></p>
<h4 data-id="heading-1">硬核跑分：性能超越，效率更优</h4>
<p>光说不练假把式，性能才是硬道理。在最新的编程基准测试中，GPT-5.1-Codex-Max的表现令人惊艳。在衡量真实软件工程问题解决能力的<strong>SWE-Bench Verified测试</strong>中，它以<strong>77.9%<strong>的准确率傲视群雄，成功超越了谷歌的Gemini 3 Pro（76.2%），甚至比自家的GPT-5（76.3%）还要出色。即便是在评估智能体终端编码能力的</strong>Terminal-Bench 2.0</strong>上，它也以**58.1%**的成绩领先Gemini 3 Pro的54.2%。</p>
<p>更让人兴奋的是，它在完成相同任务时，所需的**“思考Token”比前代模型减少了约30%**，这意味着在实现更高准确率的同时，速度和成本效益也得到了显著优化。对于那些追求极致质量而不太在乎等待时间的任务，它还引入了“超高”（xhigh）推理模式，允许模型进行更深度的思考，以求最优解。这可不是小修小补，而是实打实的飞跃！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-20_21.53.36-1024x601.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-20_21.53.36-1024x601.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8ee5861d7be43e88bce888ba6214916~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764252381&amp;x-signature=KXhOHy48WtRE9FatRIiW6pDXkdc%3D" alt="iShot_2025-11-20_21.53.36" loading="lazy"/></a></p>
<h4 data-id="heading-2">平台拓展与获取途径</h4>
<p>更接地气的是，OpenAI这次还特别关照了Windows用户。GPT-5.1-Codex-Max是<strong>首款专门针对Windows环境进行训练的Codex模型</strong>，当然，传统的Unix平台也一并支持。这意味着，无论你是在哪个开发环境，都能享受到它的强大能力。</p>
<p>目前，这款模型已经集成到了OpenAI的多个Codex开发环境中，包括官方命令行工具（Codex CLI）、IDE扩展以及代码审查工具等。ChatGPT的付费订阅用户（比如Plus、Pro、Business、Edu或Enterprise用户）现在就能体验到它的强大。至于公共API，OpenAI也承诺“很快”就会开放，这无疑将为开发者社区带来巨大的便利。</p>
<h4 data-id="heading-3">定位清晰：人类的“得力助手”，而非替代者</h4>
<p>当然，强大的力量也伴随着责任。OpenAI对这款模型的定位非常清晰：它是一个编码**“助手”**，而非人类开发者的替代品。模型默认在严格的沙盒环境中运行，文件写入权限被限制在工作区内，且默认禁用网络访问，以防范潜在安全风险。它还会生成详细的终端日志和测试引用，方便我们审查和验证其生成的所有代码。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-20_21.53.45-1024x539.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-20_21.53.45-1024x539.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74df3d07fc1a401bac32de66ff3fcb40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764252381&amp;x-signature=A4aqWDmJFo1YFzOtDSqLwt%2F9ZPc%3D" alt="iShot_2025-11-20_21.53.45" loading="lazy"/></a></p>
<p>这意味着，AI可以成为我们最得力的副驾驶，但方向盘始终掌握在人类手中，每一次代码部署前的人工审查依然是不可或缺的一环。OpenAI内部数据也显示，使用Codex工具的工程师平均多提交了约70%的拉取请求，这充分说明了它的辅助作用是实实在在的生产力提升。</p>
<p>总而言之，GPT-5.1-Codex-Max的发布，无疑在AI辅助编程领域掀起了一场革命。它不仅在性能上树立了新标杆，更通过长时任务处理能力，将AI编码助手的应用场景推向了新的高度。这或许预示着，未来我们的代码产出效率将迎来指数级增长。各位开发者们，准备好迎接这场生产力革命了吗？代码的未来，或许就从此刻开始加速！</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[播放状态与播放序列的关系（999篇一线博客第107篇）]]></title>    <link>https://juejin.cn/post/7574677905500209178</link>    <guid>https://juejin.cn/post/7574677905500209178</guid>    <pubDate>2025-11-20T14:21:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574677905500209178" data-draft-id="7574685632095256603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="播放状态与播放序列的关系（999篇一线博客第107篇）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T14:21:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="余杭子曰"/> <meta itemprop="url" content="https://juejin.cn/user/377887729918589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            播放状态与播放序列的关系（999篇一线博客第107篇）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/377887729918589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    余杭子曰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T14:21:20.000Z" title="Thu Nov 20 2025 14:21:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>说到今天这个课题之前，想先同步一个点，就是现在b站上会把一个大视频分为很多段。</p>
<p>这样就导致，</p>
<p>1 学习的获得感很强，能很清楚的确定一个视频的知识点</p>
<p>2 但相对的，也很难快速的整理一个系统性的知识</p>
<p>我今天分享的，和这个不直接相关，而是一个简单视频或者音频里，为了保证连续播放，手动分割的音频段，如何保证播放的序列性以及播放状态的同步。</p>
<p>首先，能确定的事，整体的状态，是基于第一个片段的开始，以及最后最后一个片段的播放结束。</p>
<p>但播放的实际开始，其实取决于audio或者video标签的播放事件，更加准确。</p>
<p>因此，我的设计要点分为两个大的方面。</p>
<p>一 播放状态的整体设计放在播放器。</p>
<p>其 收到第一个音频片段，认为是开始加载 ，状态1；</p>
<p>音频控件收到对应的播放事件，状态2 ；</p>
<p>收到播放序列管理器的调用，执行播放结束，状态3 ；</p>
<p>二 播放序列管理器</p>
<p>其是一个音频分割之后，管理序列的工具。</p>
<p>具体来说，其包括几个生命周期。</p>
<p>2.1 收到一个新的音频，重置，并分割得到新序列，进行初始化（状态1）</p>
<p>2.2 将序列中的第一个放到播放控件中（状态2）</p>
<p>2.3 订阅播放器的播放完成事件，将第二个地址同步给播放控件；直到最后一个；</p>
<p>2.4 当最后一个播放完成，发现没有新的片段需要播放时，调用播放器的状态改变，切换播放器的状态为状态3，自己也进入（状态3）</p>
<p>2.5 任何时候，如果收到新的音频，都将重置，并分割得到新序列（重新进入状态1）</p>
<p>之所以播放器和播放序列分开管理是因为两者对外部的影响不同。</p>
<p>比如对于业务，其只关心整个音频是否加载完。</p>
<p>而对于序列管理器，其只关心自己的序列是否正确，是否将正确的片段传给了播放器，以及是否订阅了节点事件来保证序列顺序和节点的正确性。</p>
<p>拓展：如果哪天，我们需要支持暂停，或者支持指定节点的播放，那么道理也是一样的。需要明确的把播放，和播放列表明确的分开，并通过合适的订阅或者事件机制关联起来。</p>
<p>前端笔记999篇持续更新中，欢迎订阅。 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnote.mowen.cn%2Fdetail%2FJI1AVzuiOUjNSpOlq18mB" target="_blank" title="https://note.mowen.cn/detail/JI1AVzuiOUjNSpOlq18mB" ref="nofollow noopener noreferrer">链接</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[13. Spring AI 的观测性]]></title>    <link>https://juejin.cn/post/7574671792997138467</link>    <guid>https://juejin.cn/post/7574671792997138467</guid>    <pubDate>2025-11-20T14:32:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574671792997138467" data-draft-id="7574671792997122083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="13. Spring AI 的观测性"/> <meta itemprop="keywords" content="AI编程,Java,Spring"/> <meta itemprop="datePublished" content="2025-11-20T14:32:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RainbowSea"/> <meta itemprop="url" content="https://juejin.cn/user/752533564566951"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            13. Spring AI 的观测性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/752533564566951/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RainbowSea
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T14:32:23.000Z" title="Thu Nov 20 2025 14:32:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="darcula">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#bababa}.hljs-emphasis,.hljs-strong{color:#a8a8a2}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#6896ba}.hljs-code,.hljs-selector-class{color:#a6e22e}.hljs-emphasis{font-style:italic}.hljs-attribute,.hljs-keyword,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-variable{color:#cb7832}.hljs-params{color:#b9b9b9}.hljs-string{color:#6a8759}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol,.hljs-template-tag,.hljs-template-variable,.hljs-type{color:#e0c46c}.hljs-comment,.hljs-deletion,.hljs-meta{color:#7f7f7f}</style><h2 data-id="heading-0">13. Spring AI 的观测性</h2>
<p>@[toc]</p>
<h3 data-id="heading-1">观测性</h3>
<h4 data-id="heading-2">为什么Spring AI应用急需可观测性？</h4>
<h5 data-id="heading-3">AI服务成本失控的痛点</h5>
<p>在企业级AI应用中，使用DeepSeek、OpenAI、Google Gemini或Azure OpenAI等服务时，成本控制是一个严峻挑战：</p>
<ul>
<li><strong>Token消耗不透明</strong>：无法精确了解每次AI调用的成本</li>
<li> <strong>费用增长失控</strong>：大规模应用中，AI服务费用可能呈指数级增长</li>
<li> <strong>性能瓶颈难定位</strong>：AI调用链路复杂，问题排查困难</li>
<li> <strong>资源使用不合理</strong>：缺乏数据支撑的优化决策</li>
</ul>
<h5 data-id="heading-4">Spring AI可观测性的价值</h5>
<p>Spring AI的可观测性功能为这些痛点提供了完美解决方案：</p>
<ul>
<li>✅<strong>精准Token监控</strong>：实时追踪输入/输出Token消耗，精确到每次调用</li>
<li>✅<strong>智能成本控制</strong>：基于使用统计制定成本优化策略</li>
<li>✅<strong>深度性能分析</strong>：识别AI调用瓶颈，优化响应时间</li>
<li>✅<strong>完整链路追踪</strong>：端到端记录请求在Spring AI应用中的完整流转</li>
</ul>
<h4 data-id="heading-5">实战演练：构建可观测的Spring AI翻译应用</h4>
<h5 data-id="heading-6">第一步：Spring AI项目初始化</h5>
<p>在start.spring.io<sup>[1]</sup>创建Spring Boot项目，集成Spring AI核心依赖：</p>
<p><strong>Maven依赖配置（Spring AI BOM管理）：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--百炼--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-alibaba-starter-dashscope<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> 
<span class="hljs-comment">&lt;!-- Spring Boot Actuator 监控 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-comment">&lt;!--web--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h5 data-id="heading-7">第二步：Spring AI客户端配置</h5>
<p><strong>主应用类配置：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootApplication</span>
publicclassSpringAiTranslationApplication {

    publicstaticvoidmain(String[] args) {
        SpringApplication.run(SpringAiTranslationApplication.class, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ChatClient <span class="hljs-title function_">chatClient</span><span class="hljs-params">(ChatClient.Builder builder)</span> {
        <span class="hljs-keyword">return</span> builder.build();
    }
}
</code></pre>
<p><strong>Spring AI配置文件：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Spring AI 可观测性配置</span>
<span class="hljs-attr">management:</span>
<span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-string">include:"*"</span>
<span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">health:</span>
      <span class="hljs-string">show-details:always</span>
<span class="hljs-attr">metrics:</span>
    <span class="hljs-attr">export:</span>
      <span class="hljs-attr">prometheus:</span>
        <span class="hljs-string">enabled:true</span>

<span class="hljs-attr">spring:</span>
<span class="hljs-attr">threads:</span>
    <span class="hljs-attr">virtual:</span>
      <span class="hljs-string">enabled:true</span>
<span class="hljs-attr">ai:</span>
    <span class="hljs-attr">deepseek:</span>
      <span class="hljs-string">api-key:${DEEPSEEK_API_KEY}</span>
      <span class="hljs-attr">chat:</span>
        <span class="hljs-attr">options:</span>
          <span class="hljs-string">model:deepseek-chat</span>
          <span class="hljs-attr">temperature:</span> <span class="hljs-number">0.8</span>
</code></pre>
<p><strong>环境变量设置：</strong></p>
<p>export DEEPSEEK_API_KEY=your-deepseek-api-key</p>
<h5 data-id="heading-8">第三步：构建Spring AI翻译服务</h5>
<p><strong>智能翻译控制器：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/v1")</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiTranslationController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatModel chatModel;

    <span class="hljs-meta">@PostMapping("/translate")</span>
    <span class="hljs-keyword">public</span> TranslationResponse <span class="hljs-title function_">translate</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> TranslationRequest request)</span> {

        log.info(<span class="hljs-string">"Spring AI翻译请求: {} -&gt; {}"</span>, request.getSourceLanguage(), request.getTargetLanguage());
        
        String prompt= String.format(
                <span class="hljs-string">"作为专业翻译助手，请将以下%s文本翻译成%s，保持原文的语气和风格：\n%s"</span>,
                request.getSourceLanguage(),
                request.getTargetLanguage(),
                request.getText()
        );

        String translatedText= chatModel.call(prompt);
        
        <span class="hljs-keyword">return</span> TranslationResponse.builder()
                .originalText(request.getText())
                .translatedText(translatedText)
                .sourceLanguage(request.getSourceLanguage())
                .targetLanguage(request.getTargetLanguage())
                .timestamp(System.currentTimeMillis())
                .build();
    }
}

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TranslationRequest</span> {
    <span class="hljs-keyword">private</span> String text;
    <span class="hljs-keyword">private</span> String sourceLanguage;
    <span class="hljs-keyword">private</span> String targetLanguage;
}

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TranslationResponse</span> {
    <span class="hljs-keyword">private</span> String originalText;
    <span class="hljs-keyword">private</span> String translatedText;
    <span class="hljs-keyword">private</span> String sourceLanguage;
    <span class="hljs-keyword">private</span> String targetLanguage;
    <span class="hljs-keyword">private</span> Long timestamp;
}
</code></pre>
<h5 data-id="heading-9">第四步：Spring AI翻译API测试</h5>
<pre><code class="hljs language-json" lang="json">curl -X POST http<span class="hljs-punctuation">:</span><span class="hljs-comment">//localhost:8080/api/v1/translate  </span>
-H <span class="hljs-string">"Content-Type: application/json"</span>  
-d '<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Spring AI makes AI integration incredibly simple and powerful"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sourceLanguage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"英语"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"targetLanguage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"中文"</span>
<span class="hljs-punctuation">}</span>'

# 响应示例
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"originalText"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Spring AI makes AI integration incredibly simple and powerful"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"translatedText"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Spring AI让AI集成变得极其简单而强大"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sourceLanguage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"英语"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"targetLanguage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"中文"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1704067200000</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-10">Spring AI监控指标深度解析</h4>
<h5 data-id="heading-11">核心指标1：Spring AI操作性能监控</h5>
<p><strong>指标端点</strong>：/actuator/metrics/spring.ai.chat.client</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"spring.ai.chat.client.operation"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Spring AI ChatClient操作性能指标"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"baseUnit"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"seconds"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"measurements"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"statistic"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"COUNT"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span><span class="hljs-number">15</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"statistic"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"TOTAL_TIME"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span><span class="hljs-number">8.456780293</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"statistic"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"MAX"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span><span class="hljs-number">2.123904083</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"availableTags"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tag"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"gen_ai.operation.name"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"values"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"framework"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tag"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"spring.ai.kind"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"values"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"chat_client"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>业务价值</strong>：</p>
<ul>
<li>监控Spring AI翻译服务调用频次</li>
<li>分析Spring AI响应时间分布</li>
<li>识别Spring AI性能瓶颈</li>
</ul>
<h5 data-id="heading-12">核心指标2：Spring AI Token使用量精准追踪</h5>
<p><strong>指标端点</strong> /actuator/metrics/gen_ai.client.token.usage</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"gen_ai.client.token.usage"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Spring AI Token使用量统计"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"measurements"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"statistic"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"COUNT"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span><span class="hljs-number">1250</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"availableTags"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tag"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"gen_ai.response.model"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"values"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"deepseek-chat"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tag"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"gen_ai.request.model"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"values"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"deepseek-chat"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"tag"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"gen_ai.token.type"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"values"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span>
        <span class="hljs-string">"output"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"input"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"total"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>成本控制价值</strong>：</p>
<ul>
<li>精确计算Spring AI服务成本</li>
<li>优化Prompt设计降低Token消耗</li>
<li>制定基于使用量的预算策略</li>
</ul>
<h2 data-id="heading-13">最后：</h2>
<blockquote>
<p>“在这个最后的篇章中，我要表达我对每一位读者的感激之情。你们的关注和回复是我创作的动力源泉，我从你们身上吸取了无尽的灵感与勇气。我会将你们的鼓励留在心底，继续在其他的领域奋斗。感谢你们，我们总会在某个时刻再次相遇。”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/909518600b5f4354abbdc491dedb94fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764253943&amp;x-signature=gqeGEqqxsOZ0MO5fRzaXDggIDeo%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[内网穿透配置和使用]]></title>    <link>https://juejin.cn/post/7574641470138007567</link>    <guid>https://juejin.cn/post/7574641470138007567</guid>    <pubDate>2025-11-20T14:36:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574641470138007567" data-draft-id="7574671792997154851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="内网穿透配置和使用"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-11-20T14:36:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RainbowSea"/> <meta itemprop="url" content="https://juejin.cn/user/752533564566951"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            内网穿透配置和使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/752533564566951/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RainbowSea
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T14:36:38.000Z" title="Thu Nov 20 2025 14:36:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@[toc]</p>
<h2 data-id="heading-0">内网穿透配置和使用</h2>
<h2 data-id="heading-1">NatApp和Ngrok的使用</h2>
<h3 data-id="heading-2">NatApp的使用</h3>
<p>NatAPP 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnatapp.cn%2Farticle%2Fnatapp_newbie" target="_blank" title="https://natapp.cn/article/natapp_newbie" ref="nofollow noopener noreferrer">natapp.cn/article/nat…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36b5fa182db845c299ed5eda9a354054~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=7y%2FGEyShhIEE1orkpRjyjWjIYNo%3D" alt="" loading="lazy"/></p>
<p><strong>购买隧道：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d09c48d660154df28a106c55861495de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=uJlxjjZHawdS3XN4wovl1fKtpjA%3D" alt="" loading="lazy"/></p>
<p><strong>配置消息：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3398c08961fc4bb98303ed89a80cb70c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=Yq5XfouHx%2F5cH7GZpOlZmapHbKU%3D" alt="" loading="lazy"/></p>
<p><strong>启动：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a9b351382aa464d9a5d66d5325f2a62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=hQ7WCGDi%2FkLuDznCQy32sjF7rQI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f76425746464480b587f5dc3cc24d4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=ESxp4CzoDd9BZKhgqL%2FxaHsgIN0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dd13fd091944cbe9a4b1ef75c60b086~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=ae%2BGNuw%2BuT23XnWRA0rtuF6SdoU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">Ngrok的使用</h3>
<p>Ngrok 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fngrok.cc%2F" target="_blank" title="https://ngrok.cc/" ref="nofollow noopener noreferrer">ngrok.cc/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35f144c5527f47dc8ecfb7117b071792~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=xKpKxTLIng%2FSd6HR%2FrFIt7FSPcQ%3D" alt="" loading="lazy"/></p>
<p><strong>开通隧道：可以选择免费的</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5c34479c8844b13a78dfe49db2bbf8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=9ytLAiJ%2F6kfl4KwjYgpvVFgElNQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b71f1feac9774b6a911bc578761723a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=L4HKijyL8cYE2TN05jsAvFAWcj4%3D" alt="" loading="lazy"/></p>
<p><strong>启动：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/753d0a17acf0409b863185529da336d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=RSN%2F8ZzUoMPz9fpqns7D6kw%2F87M%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8b4c98e0e644511a02bca7a7b06a8ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=z9OzyvgV7OaEMqlJc6ZrZBjO7Eg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a75212a9307743588de194dc3ae8def9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=i2Zx%2F2HZF8%2Bhypxns475oljCThY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a243c9d8865483ba7e10e84702fd5df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=UVj9GLK7nwCPiFtHgG6ifCHqI78%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">最后：</h2>
<blockquote>
<p>“在这个最后的篇章中，我要表达我对每一位读者的感激之情。你们的关注和回复是我创作的动力源泉，我从你们身上吸取了无尽的灵感与勇气。我会将你们的鼓励留在心底，继续在其他的领域奋斗。感谢你们，我们总会在某个时刻再次相遇。”</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdafce7fb3414e2598524a1ac92bf1d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpbmJvd1NlYQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764254198&amp;x-signature=w%2B2Rg1ASu8X%2FeiTxGgTBWBCFoyE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 Android DocumentFile：性能陷阱与最佳实践]]></title>    <link>https://juejin.cn/post/7574658078269718579</link>    <guid>https://juejin.cn/post/7574658078269718579</guid>    <pubDate>2025-11-20T13:07:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574658078269718579" data-draft-id="7574639741149691955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 Android DocumentFile：性能陷阱与最佳实践"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-20T13:07:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨白"/> <meta itemprop="url" content="https://juejin.cn/user/2549135752044601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 Android DocumentFile：性能陷阱与最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2549135752044601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T13:07:51.000Z" title="Thu Nov 20 2025 13:07:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>从 Android 10 开始，分区存储（Scoped Storage）登场了；到了 Android 11，它开始被强制执行。</p>
<p>这改变了我们操作文件的方式：我们从使用文件的绝对路径（如 <code>/sdcard/DCIM/Camera/IMG_001.jpg</code>），变为了使用<strong>存储权限机制（Storage Access Framework，简称 SAF）</strong>。</p>
<p>具体点说，我们不再操作 Path，而是操作 Uri（例如 <code>content://com.android.providers.media.documents/document/image%3A123</code>）。文件被记录在了数据库中，而 Uri 就是记录的索引。</p>
<blockquote>
<ul>
<li>Uri 不是路径，它是数据库键值。</li>
<li>在 SAF 中，我们通过 MIME Type 识别文件类型（如 <code>image/*</code>，<code>application/pdf</code>）。</li>
</ul>
<p>注意：<code>vnd.android.document/directory</code> 是用来标识文件夹的特殊 MIME 类型。</p>
</blockquote>
<p>当我们读取文件时，实际上是通过系统提供的 <code>ContentResolver</code> 在查询数据库。</p>
<blockquote>
<p>关于 <code>ContentProvider</code> 的底层原理，可以看我之前的这两篇博客：</p>
<ul>
<li><a href="https://juejin.cn/post/7515467309490962468#heading-6" target="_blank" title="https://juejin.cn/post/7515467309490962468#heading-6">ContentProvider：Android 跨程序数据共享的最佳实践</a></li>
<li><a href="https://juejin.cn/post/7516100315852996658" target="_blank" title="https://juejin.cn/post/7516100315852996658">手把手构建一个安全、健壮的 ContentProvider</a>。</li>
</ul>
</blockquote>
<h2 data-id="heading-1">核心机制</h2>
<h3 data-id="heading-2">三大核心 Intent</h3>
<p>SAF 与系统的交互主要依赖以下三个 Action：</p>
<ul>
<li><code>ACTION_OPEN_DOCUMENT</code>：打开单个文件。</li>
<li><code>ACTION_OPEN_DOCUMENT_TREE</code>：授权访问整个目录。</li>
<li><code>ACTION_CREATE_DOCUMENT</code>：请求创建一个新文件并写入数据。</li>
</ul>
<h3 data-id="heading-3">权限持久化 (Persist Permissions)</h3>
<p>默认情况下，SAF 返回的 Uri 权限是<strong>临时</strong>的。当应用重启后，再次访问之前授权的文件夹，就会抛出 <code>SecurityException</code>。</p>
<p>解决方法：获取到 Uri 后，必须立即进行权限持久化：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> takeFlags: <span class="hljs-built_in">Int</span> = Intent.FLAG_GRANT_READ_URI_PERMISSION or Intent.FLAG_GRANT_WRITE_URI_PERMISSION
<span class="hljs-comment">// 获取持久的权限</span>
application.contentResolver.takePersistableUriPermission(uri, takeFlags)
</code></pre>
<h2 data-id="heading-4">什么是 DocumentFile？</h2>
<p><code>DocumentFile</code> 是 Google 为了方便开发者，提供的一个<strong>兼容包装类</strong>。</p>
<p>它的本质是对 <code>DocumentsContract</code> 和 <code>ContentResolver</code> 操作的封装，让我们能用类似 <code>java.io.File</code> 的风格（如 <code>listFiles()</code>、<code>getName()</code>）来操作 Uri。</p>
<h3 data-id="heading-5">源码解析</h3>
<p>以 <code>TreeDocumentFile.getName()</code> 方法为例，我们来看看源码。</p>
<p>它最终调用了 <code>DocumentsContractApi19.queryForString()</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">ContentResolver</span> <span class="hljs-variable">resolver</span> <span class="hljs-operator">=</span> context.getContentResolver();
<span class="hljs-type">Cursor</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 发起 ContentResolver 查询</span>
    c = resolver.query(uri, <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{DocumentsContract.Document.COLUMN_DISPLAY_NAME}, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">if</span> (c.moveToFirst() &amp;&amp; !c.isNull(<span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">return</span> c.getString(<span class="hljs-number">0</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> defaultValue;
    }
} <span class="hljs-keyword">catch</span> (Exception e) {
    Log.w(TAG, <span class="hljs-string">"Failed query: "</span> + e);
    <span class="hljs-keyword">return</span> defaultValue;
} <span class="hljs-keyword">finally</span> {
    closeQuietly(c);
}
</code></pre>
<p>可以看到：调用的每一个 <code>DocumentFile</code> 的方法，底层都是一次 <code>ContentProvider</code> 的 <strong>IPC（跨进程通信）查询</strong>。</p>
<h3 data-id="heading-6">性能陷阱</h3>
<p>由于 IPC 的成本很高，在扫描大量文件时，我们不能这么写：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> rootDir = DocumentFile.fromTreeUri(application.applicationContext, uri)
rootDir?.let { dir -&gt;
    <span class="hljs-keyword">val</span> files = dir.listFiles() <span class="hljs-comment">// 1次 IPC</span>
    <span class="hljs-keyword">for</span> (file <span class="hljs-keyword">in</span> files) { <span class="hljs-comment">// 2N 次 IPC</span>
        <span class="hljs-keyword">val</span> name = file.name
        <span class="hljs-keyword">val</span> size = file.length()
    }
}
</code></pre>
<p>如果你扫描 1000 个文件，这将触发 2000+ 次跨进程通信，导致界面卡顿。</p>
<h3 data-id="heading-7">正确做法</h3>
<p>对于大量文件，我们应该直接使用 <code>ContentResolver</code> 进行查询。</p>
<p>将所需的所有列告诉系统，让系统在一次 IPC 中就将所有数据返回。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scanMassiveDirectory</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, treeUri: <span class="hljs-type">Uri</span>)</span></span> {
    <span class="hljs-comment">// 构建子文档的 Uri</span>
    <span class="hljs-keyword">val</span> childrenUri = DocumentsContract.buildChildDocumentsUriUsingTree(
        treeUri,
        DocumentsContract.getTreeDocumentId(treeUri)
    )

    <span class="hljs-comment">// 定义数据列 (Projection)</span>
    <span class="hljs-keyword">val</span> projection = arrayOf(
        DocumentsContract.Document.COLUMN_DOCUMENT_ID,
        DocumentsContract.Document.COLUMN_DISPLAY_NAME,
        DocumentsContract.Document.COLUMN_SIZE,
        DocumentsContract.Document.COLUMN_MIME_TYPE
    )

    <span class="hljs-comment">// 一次性查询</span>
    <span class="hljs-keyword">val</span> cursor = context.contentResolver.query(
        childrenUri,
        projection,
        <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>
    )

    cursor?.use { c -&gt;
        <span class="hljs-keyword">val</span> nameCol = c.getColumnIndex(DocumentsContract.Document.COLUMN_DISPLAY_NAME)
        <span class="hljs-keyword">val</span> sizeCol = c.getColumnIndex(DocumentsContract.Document.COLUMN_SIZE)
        <span class="hljs-keyword">val</span> typeCol = c.getColumnIndex(DocumentsContract.Document.COLUMN_MIME_TYPE)

        <span class="hljs-keyword">while</span> (c.moveToNext()) {
            <span class="hljs-keyword">val</span> name = c.getString(nameCol)
            <span class="hljs-keyword">val</span> size = c.getLong(sizeCol)
            <span class="hljs-keyword">val</span> type = c.getString(typeCol)

            <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 处理你的业务逻辑</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-8">什么时候使用 DocumentFile？</h2>
<p>虽然 <code>DocumentFile</code> 有着性能损耗，但它简单易用，并且兼容性很好。</p>
<p>在文件数量较少或 USB OTG 设备场景下，完全可以使用它：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scanDirectorySafe</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, treeUri: <span class="hljs-type">Uri</span>)</span></span> = withContext(Dispatchers.IO) {
    <span class="hljs-keyword">val</span> rootDocument = DocumentFile.fromTreeUri(context, treeUri)

    <span class="hljs-comment">// 防御性检查</span>
    <span class="hljs-keyword">if</span> (rootDocument == <span class="hljs-literal">null</span> || !rootDocument.exists() || !rootDocument.isDirectory) {
        Log.e(<span class="hljs-string">"SAF"</span>, <span class="hljs-string">"Invalid directory uri"</span>)
        <span class="hljs-keyword">return</span><span class="hljs-symbol">@withContext</span>
    }

    <span class="hljs-comment">// 获取列表 (耗时操作)</span>
    <span class="hljs-keyword">val</span> files = rootDocument.listFiles()
    Log.d(<span class="hljs-string">"SAF"</span>, <span class="hljs-string">"Found <span class="hljs-subst">${files.size}</span> items"</span>)

    <span class="hljs-comment">// 遍历</span>
    <span class="hljs-keyword">for</span> (doc <span class="hljs-keyword">in</span> files) {
        <span class="hljs-keyword">if</span> (doc.isDirectory) {
            Log.d(<span class="hljs-string">"SAF"</span>, <span class="hljs-string">"Dir: <span class="hljs-subst">${doc.name}</span>"</span>)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 注意：如果列表很大，doc.type 依然会触发 IPC</span>
            Log.d(<span class="hljs-string">"SAF"</span>, <span class="hljs-string">"File: <span class="hljs-subst">${doc.name}</span>, Type: <span class="hljs-subst">${doc.type}</span>"</span>)
        }
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我TM被AI骗的自己PUA了自己😂 😂 ！细思极恐~]]></title>    <link>https://juejin.cn/post/7574648745894281257</link>    <guid>https://juejin.cn/post/7574648745894281257</guid>    <pubDate>2025-11-20T13:40:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574648745894281257" data-draft-id="7574343024324214825" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我TM被AI骗的自己PUA了自己😂 😂 ！细思极恐~"/> <meta itemprop="keywords" content="人工智能,Grok,ChatGPT"/> <meta itemprop="datePublished" content="2025-11-20T13:40:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大怪v"/> <meta itemprop="url" content="https://juejin.cn/user/4391901700043284"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我TM被AI骗的自己PUA了自己😂 😂 ！细思极恐~
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4391901700043284/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大怪v
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T13:40:42.000Z" title="Thu Nov 20 2025 13:40:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>首先声明：<strong>这个绝对不是标题党！！！</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc521efc77024c21ac874b1f9dd4c94b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=WYxjEZKFHQkVblQfcIlnItq%2FHSQ%3D" alt="image.png" loading="lazy"/></p>
<p>不管是前端佬、后端佬、APP佬，还是普罗大众，都可以点进来借鉴看看。</p>
<p>反正经过这么一遭，我算是被醍醐灌顶了。</p>
<h2 data-id="heading-0">起因</h2>
<p>因为会玩点大A票，所以日常会关注一些财经新闻。</p>
<p>而看新闻的几个渠道中，其中就有澎bo新闻或者经济学人。</p>
<p>吐个槽，不是外国的月亮比较圆，非得看他们，而是他们一些信息就是比村里的快！</p>
<p>言归正传！这些新闻机构好是好，但有一致命缺点：得花钱！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85973d6ca342487bb0dacb0d753bd0a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=vJWaaucJioLPnmKt8B%2FkNfbWdn8%3D" alt="image.png" loading="lazy"/></p>
<p>这你能忍？反正对于我这样苦哈哈的程序员，我的第一解决办法并不是直接付钱订购，而是想别的出路。</p>
<p>终于经过检索，我找到一条路子（具体是啥，相信大家都可以检索到）。</p>
<p>就这么一直用着用着，直到有一天，我脑子里蹦出个想法来。</p>
<h2 data-id="heading-1">经过</h2>
<p>生成式对话AI可谓火遍大江南北，我就在想，我要是把链接喂给他们，是不是可以直接把文章拔下来，然后还可以将直接翻译好的文本给我？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bdd07f86dd24ec5bc587bb2bf98d7b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=yvE3eLsQfE7dfH4E0FN%2BNmX4KhI%3D" alt="image.png" loading="lazy"/></p>
<p>秉承实干家的Title，说干就干。</p>
<p>我陆续验证了Deepseek、通义千问、ChatGTP、Grok、然后万恶的Grok😡😡...反正没有再使用其它的，我感觉已经可以了。</p>
<p>提示词基本都差不多，如下：</p>
<blockquote>
<p>【https:// url 看官请假装这是一个链接^v^】，把这篇文章翻译成中文发给我。不需要整理</p>
</blockquote>
<p>前四个都不行。基本是这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6cbe9daca944b91b33f382630a6625f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=VSM5SqE8T0FkbLoXz%2FvhgAgOsJ4%3D" alt="image.png" loading="lazy"/></p>
<p>还有这样下面这样！！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4f105fe82ea4226b4ab8a5a56bf81e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=WB2oTbrS6kSIzVEoPIttAWk2FTY%3D" alt="image.png" loading="lazy"/></p>
<p>终于，在遇到Grok这厮后，它直接明了的给出文章！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cf830af0c5849749ed63cd115ea95ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=C70uYxHNBKb7ZRdOrs8q6oh%2BRHU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">怀疑</h2>
<p>回忆当时的Grok输出，我是直呼<del>卧槽</del>。</p>
<p>然后，细细看了下内容，有模有样，跟标题还真贴合。</p>
<p>然后，我质疑了。</p>
<p>是的，我是怀疑过的！！！</p>
<p>但，怀疑的方式依旧那么的愚蠢的。我怀疑的办法不是去说搞一篇原文，来作对比较，而是傻愣愣的直接去问Grok。</p>
<p>然后给我的回复就是：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b4f5585b6d049f188ecc13164bab9fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=HMk6xFYh4mCbO0W%2FqoqXplCucv8%3D" alt="image.png" loading="lazy"/></p>
<p>他斩钉截铁的告诉我，<strong>不会也无法非法获取付费内容</strong>。</p>
<p>好吧。不管你这怎么样，</p>
<p>反正当时我信了。</p>
<h2 data-id="heading-3">我pua了我</h2>
<p>就这么用了几天，感觉是真爽！狂喜了好长一段时间，每天会看一两篇。</p>
<p>倒不是一点怀疑都没有，而且怀疑的并不是内容有问题。</p>
<p>因为给出的内容，里面文章很有逻辑，还夹杂着数据支撑，最后还会给一些很犀利的结尾，跟之前阅读的那些内容，从感觉上真尼玛像！！！</p>
<p>其中真正让我有些疑虑的，是里面一些日期使用。比如今天明明是11月20日，已经星期四了，但里面的内容会出现：<code>在11月19日，上周三的某知情人士说法。。</code>，这样阐述。</p>
<p>但~<strong>因为相信</strong>，我自己pua我自己了，完全将其合理化了。</p>
<p>要么就认为是翻译的问题，或者认为时区的问题，再或者就认为AI翻译就这个尿性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2a23cf4bf134bb0b29fd716e67250f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=wwnl9YX8a9BXufMYnHBh7bFDtcM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">反转</h2>
<p>最近关注过大A票的朋友，应该都知道半导体板块。然后也应该听说过安世半导体事件。</p>
<p>我就是其中关注者之一，也是其中的赌狗一只。</p>
<p><strong>话说对于赌狗来说，最大的瘾就是在事情未确定的时候，去下注，然后为此获得收益。</strong></p>
<p>那么应用到这个事件，我们就是去，下注WTKJ票，赌我们村里赢。</p>
<p>反正这个事件反反复复，那票也是起起落落。</p>
<p>就这么一天吧，某澎bo报道了一篇文章，然后一如往常将链接丢给Grok，反正Grok给出的内容大意就是：荷兰政府强硬，要坚定收回控制权。</p>
<p>好吧。赌狗看到这样消息，那自然而然想到对于WTKJ是利空。为了止损，所以夜间挂了跌停，为此还喜滋滋。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89257d641dd043c7a432a9d078b0e77a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=tS83DadcDHODK8e5iPYWzZBZEyk%3D" alt="image.png" loading="lazy"/></p>
<p>直到第二天，卖掉之后。我看到了国内新闻报道，内容跟Grok的那篇完全相反，是荷兰政府放弃干预！</p>
<p>嗯？咋回事？莫非国内消息滞后？（你看，这就是盲目的代价）</p>
<p>然后我又去看了一遍Grok内容，再次对比国内新闻。这截然相反的新闻，咋回事？？？</p>
<p>终于，我开窍一样的找回了原来的路子，用原文对比Grok一看！</p>
<p>吐血了！</p>
<p>跟原文真的半毛钱都没得关系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da8c6602dff347cfa64a3843c80a8b05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=iZxrPHEq5GrIoQp7uOttJoHbZUQ%3D" alt="罗永浩.gif" loading="lazy"/></p>
<p>你猜，我的反应是去干嘛？</p>
<p>我尽量是去质问那个Grok傻xxx，然后他的回复给我气笑了~</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80381618f7c540c9b7cc26b7ab3cdbd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=DI2bc6Fd3fkM8P3AF0N466ZFjoQ%3D" alt="image.png" loading="lazy"/></p>
<p>我是打死都没有去怀疑，你这浓眉大眼的AI你竟然就这么胡编乱造。</p>
<h2 data-id="heading-5">结局</h2>
<p>好了，这个就是整个事情的经过。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f049077542e44a888ac1a3696c1e400f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=04rCvjg1KzjeuXsEOEcXJzDb6wE%3D" alt="92592023de560d019ef1666d69f15ec4.gif" loading="lazy"/></p>
<p>事后的第一反应，是脑海里回忆起电影《2001太空漫游》那画面：</p>
<blockquote>
<p>Open the pod bay doors,Hal.
I'm sorry,Dave.</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5601c4ee078a47a4a1cef2fce66a27e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764250842&amp;x-signature=D2H7z0ZxPfSgkXJ1NyZAUo4RfTo%3D" alt="image.png" loading="lazy"/></p>
<p>《2001太空漫游》的艺术高度再次飙升！</p>
<p>如果有一天，AI真得像人了，或者我们无法分辨他是真得或者假得，或者一百万个AI智能体都这么说得。那么我们怎么去辨别？</p>
<p>最后，告诫大家：</p>
<p><strong>市场有风险，投资需谨慎！！！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【实战复盘】 PySide6 + PyTorch 偶发性“假死”？由多线程转多进程]]></title>    <link>https://juejin.cn/post/7574685632095191067</link>    <guid>https://juejin.cn/post/7574685632095191067</guid>    <pubDate>2025-11-20T13:53:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574685632095191067" data-draft-id="7574651025727815718" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【实战复盘】 PySide6 + PyTorch 偶发性“假死”？由多线程转多进程"/> <meta itemprop="keywords" content="Python,PyQt,PyTorch"/> <meta itemprop="datePublished" content="2025-11-20T13:53:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mortimer"/> <meta itemprop="url" content="https://juejin.cn/user/4441682704623992"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【实战复盘】 PySide6 + PyTorch 偶发性“假死”？由多线程转多进程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682704623992/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mortimer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T13:53:44.000Z" title="Thu Nov 20 2025 13:53:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#212122}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:8px;padding-bottom:8px}.markdown-body h1{color:#a0a0a0;font-size:38px;margin-top:32px;padding-top:32px}.markdown-body h2{color:#fff;background-color:#212122;width:fit-content;border-bottom-right-radius:100px;margin-top:47px;margin-bottom:16px;padding:4px 48px 4px 8px;line-height:1.7;font-size:30px;transition:all .3s ease-out}.markdown-body h2:hover{border-bottom-right-radius:50px;transition:all .3s ease-out}.markdown-body h3{font-size:24px;padding-left:8px;margin-top:32px;border-bottom:2px solid #c6c4c4;line-height:1.7}.markdown-body h4{font-size:20px;padding-left:8px;margin-top:32px;border-bottom:1px solid #ddd}.markdown-body h5{font-size:16px;margin-top:24px}.markdown-body h6{margin-top:16px;line-height:1.1}.markdown-body p{font-size:16px;text-align:start;white-space:normal;text-size-adjust:auto;line-height:2;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%;margin:auto;padding-left:8px;padding-right:8px}.markdown-body hr{border:none;border-top:4px double #212122;margin-top:32px;margin-bottom:32px;text-align:center}.markdown-body hr:after{content:"♥";display:inline-block;position:relative;top:-15px;padding:0 10px;color:#212122;font-size:18px}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f1f1f1;color:#ef7060;font-size:14px;padding:.065em 6px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.7;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);margin:32px 16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-color:#212122;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);background-size:40px}.markdown-body pre&gt;code{font-size:14px;padding:16px 8px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff;background:#272822}.markdown-body pre&gt;code::-webkit-scrollbar{height:10px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:3px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{border-radius:3px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}.markdown-body a{color:#ef7060;padding:2px;text-decoration:none;border-bottom:.125em solid #ef7060;border-radius:2px;box-shadow:inset 0 -.025em 0 #ef7060;transition:box-shadow .27s cubic-bezier(.77,0,.175,1),color .27s cubic-bezier(.77,0,.175,1)}.markdown-body a:focus,.markdown-body a:hover{outline:none;box-shadow:inset 0 -1.5em 0 #ef7060;color:#fff}.markdown-body a:before{content:"⇲ ";vertical-align:top;margin-left:2px;font-family:dart!important;font-size:12px;color:inherit;opacity:.7}.markdown-body table{background:#fbfbfb;border-radius:4px;border-collapse:collapse;margin:auto;padding:5px;width:95%;box-shadow:0 5px 10px rgba(0,0,0,.1);animation:float 5s infinite}.markdown-body table th{color:#fff;background:#212122;border-bottom:1px solid #9ea7af;border-right:1px solid #343a45;font-size:18px;padding:16px;text-align:left;vertical-align:middle}.markdown-body table th:first-child{border-top-left-radius:4px}.markdown-body table th:last-child{border-top-right-radius:4px;border-right:none}.markdown-body table tr{border-top:1px solid #c1c3d1;border-bottom:1px solid #c1c3d1;color:#666b85}.markdown-body table tr:hover td{background:#212122;color:#fff;border-top:1px solid #22262e}.markdown-body table tr:first-child{border-top:none}.markdown-body table tr:last-child{border-bottom:none}.markdown-body table tr:nth-child(odd) td{background:#f1f1f1}.markdown-body table tr:nth-child(odd):hover td{background:#212122}.markdown-body table tr:last-child td:first-child{border-bottom-left-radius:4px}.markdown-body table tr:last-child td:last-child{border-bottom-right-radius:4px}.markdown-body table td{background:#fbfbfb;padding:16px;text-align:left;vertical-align:middle;font-size:16px;border-right:1px solid #c1c3d1}.markdown-body table td:last-child{border-right:0}.markdown-body blockquote{color:#777;padding:1px 16px;margin:24px 0;border-left:4px solid #c6c4c4;background-color:#f1f1f1;transition:all .3s ease-out;border-radius:4px}.markdown-body blockquote:hover{border-left-color:#212122;background-color:#212122;color:#fff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:24px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body span.math{margin-left:32px;font-size:18px;font-weight:700}@media (max-width:720px){.markdown-body h1{font-size:30.4px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/836ab46780d6474eb1adfb57fe1d2d71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbW9ydGltZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764251624&amp;x-signature=eBCbIR29R%2FWPYe1h2kn8B7ybgfE%3D" alt="ChatGPT Image 2025年11月20日 21_47_50.png" loading="lazy"/></p>
<p>在开发 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjianchang512%2Fpyvideotrans" target="_blank" title="https://github.com/jianchang512/pyvideotrans" ref="nofollow noopener noreferrer">pyVideoTrans视频翻译工具</a></strong> 的过程中，我遇到了一个困扰已久的“玄学”Bug。</p>
<p>这个 Bug 最折磨人的地方在于：<strong>它不是必现的</strong>。</p>
<p>在开发环境下单独测试，甚至在处理前几个视频时，一切都丝滑流畅。但一旦用户开始批量转录（比如一次性导入几十个视频），程序就会在某个随机的时间点——可能是第 5 个，也可能是第 20 个视频——突然“假死”。</p>
<p>没有报错堆栈，没有 Python 异常，界面卡在“正在识别...”不再刷新。</p>
<p>经过漫长的排查和架构重构，我最终从 <strong>多线程</strong> 迁移到了 <strong>多进程</strong>，彻底解决了这个问题。写下这篇文章，希望能帮后来者避开这个深坑。</p>
<h2 data-id="heading-0">一、 不确定的“定时炸弹”</h2>
<p>我的原始架构是标准的 PySide6 写法：</p>
<ul>
<li><strong>主线程</strong>：负责 UI 渲染。</li>
<li><strong>子线程 QThread</strong>：负责加载 Whisper 模型并执行 <code>transcribe</code>。</li>
</ul>
<p><strong>症状如下：</strong></p>
<ol>
<li><strong>单任务正常</strong>：只转录一两个短视频，几乎从不出错。</li>
<li><strong>批量任务必挂</strong>：当进行长队列任务时，随着处理数量增加，崩溃概率呈指数级上升。</li>
<li><strong>位置不固定</strong>：有时卡在 <code>import whisper</code>，有时卡在 <code>load_model</code>，更多时候卡在 <code>model.transcribe</code> 这一行。</li>
<li><strong>各种“偏方”无效</strong>：我尝试过 <code>torch.set_num_threads(1)</code>，尝试过设置 <code>OMP_NUM_THREADS=1</code>，这些方法能降低卡死频率，但无法根除。</li>
</ol>
<p>这种“偶发性”是最可怕的，因为它意味着你的程序里埋着一颗雷，你永远不知道用户什么时候会踩中。</p>
<h2 data-id="heading-1">二、 根因分析：概率论与资源竞争</h2>
<p>为什么是偶发的？为什么批量处理时容易复现？</p>
<p>经过深入研究 PyTorch 和 GUI 框架的底层机制，结论指向了 <strong>GIL 与底层 C++ 库的资源竞争</strong>。</p>
<ol>
<li>
<p><strong>OpenMP 与 Windows 的加载锁</strong>
Whisper 依赖 PyTorch，PyTorch 在 CPU 上运行时依赖 OpenMP 做并行加速。在 Windows 平台上，当在一个由 Qt 管理的子线程中反复调用 PyTorch（尤其是频繁释放/重新加载模型，或者密集计算）时，OpenMP 的线程池初始化与 Qt 的事件循环机制在底层存在极其隐晦的冲突。</p>
</li>
<li>
<p><strong>随机性的来源</strong>
这种冲突不是逻辑错误，而是<strong>时序竞争</strong>。</p>
<ul>
<li>处理第 1 个视频时，内存干净，时序完美，通过。</li>
<li>处理到第 10 个视频时，内存中可能存在未完全释放的锁，或者 CPU 调度恰好让 Qt 的重绘事件和 PyTorch 的计算指令撞在了一起。</li>
<li><strong>这就解释了为什么批量处理必死</strong>：你抛硬币的次数多了，总有一次会抛出背面。</li>
</ul>
</li>
</ol>
<p>在 Windows GUI 程序的同一个进程空间内跑重型深度学习任务，本质上就是在“走钢丝”。无论你怎么小心地加锁、限制线程数，只要它们共享同一个解释器和内存空间，风险就永远存在。</p>
<h2 data-id="heading-2">三、 解决方案：从 QThread 到 Multiprocessing</h2>
<p>既然“同一个屋檐下”容易打架，那就直接分家。</p>
<p>我决定放弃 <code>QThread</code> 运行推理任务，改用 Python 的 <code>multiprocessing</code> 模块。这意味着每当需要进行语音识别时，我都会启动一个<strong>全新的、独立的系统进程</strong>。</p>
<h3 data-id="heading-3">架构变更</h3>
<ul>
<li><strong>旧方案 QThread</strong>：主界面与 AI 任务共享内存，直接调用函数。轻便，但易死锁。</li>
<li><strong>新方案 Multiprocessing</strong>：
<ul>
<li><strong>主进程 (GUI)</strong>：负责显示进度，通过 <code>Queue</code> 接收消息。</li>
<li><strong>子进程 (AI)</strong>：独立加载 PyTorch，独立进行计算。计算完通过 <code>Queue</code> 传回结果，然后销毁。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">核心代码实现</h3>
<p>为了实现这一改动，我编写了一个“中转站”式的 Worker：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> multiprocessing
<span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Queue

<span class="hljs-comment"># 这是一个完全独立的空间，不受 GUI 线程干扰</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ai_process_task</span>(<span class="hljs-params">config_data, file_path, msg_queue</span>):
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 1. 在新进程里才导入重型库，保证环境纯净</span>
        <span class="hljs-keyword">import</span> whisper
        <span class="hljs-keyword">import</span> torch
        

        msg_queue.put({<span class="hljs-string">"type"</span>: <span class="hljs-string">"log"</span>, <span class="hljs-string">"text"</span>: <span class="hljs-string">f"正在加载模型: <span class="hljs-subst">{config_data[<span class="hljs-string">'model'</span>]}</span>..."</span>})
        
        <span class="hljs-comment"># 2. 执行易崩溃的任务</span>
        model = whisper.load_model(config_data[<span class="hljs-string">'model'</span>])
        result = model.transcribe(file_path)
        
        <span class="hljs-comment"># 3. 任务完成，回传数据</span>
        msg_queue.put({<span class="hljs-string">"type"</span>: <span class="hljs-string">"success"</span>, <span class="hljs-string">"data"</span>: result})
        
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        msg_queue.put({<span class="hljs-string">"type"</span>: <span class="hljs-string">"error"</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-built_in">str</span>(e)})
    <span class="hljs-keyword">finally</span>:
        msg_queue.put({<span class="hljs-string">"type"</span>: <span class="hljs-string">"finish"</span>})

<span class="hljs-comment"># --- 主界面的 QThread ---</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ControllerWorker</span>(<span class="hljs-title class_ inherited__">QThread</span>):
    signal_update_ui = Signal(<span class="hljs-built_in">dict</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):
        queue = Queue()
        
        <span class="hljs-comment"># 启动独立进程</span>
        p = Process(target=ai_process_task, args=(self.cfg, self.audio_file, queue))
        p.start()
        
        <span class="hljs-comment"># 循环监听子进程的消息</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            msg = queue.get()
            
            <span class="hljs-keyword">if</span> msg[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'finish'</span>:
                <span class="hljs-keyword">break</span>
            
            <span class="hljs-comment"># 转发给 UI 更新</span>
            self.signal_update_ui.emit(msg)
        
        p.join() 
</code></pre>
<h3 data-id="heading-5">为什么这样能根治？</h3>
<ol>
<li><strong>内存隔离</strong>：子进程拥有独立的 Python 解释器。无论 PyTorch 在里面怎么折腾 OpenMP，怎么占用加载锁，都波及不到主进程的 Qt 界面。</li>
<li><strong>资源彻底释放</strong>：处理完一个视频，子进程直接销毁，所有内存、显存、句柄强制回收。这对于批量处理几十个视频的场景至关重要，<strong>彻底杜绝了内存泄漏和锁残留导致的偶发性卡死</strong>。</li>
</ol>
<hr/>
<p><strong>在 Python GUI 开发中，凡是涉及 PyTorch、TensorFlow、OCR 等重型计算库，不要抱有侥幸心理用多线程,直接上多进程。</strong></p>
<p>虽然多进程通信写起来比直接共享变量要麻烦一点，启动进程也有几百毫秒的开销，但它换来的是<strong>绝对的稳定性</strong>。</p>
<p>如果你的工具也面临“跑久了就卡死”的玄学问题，不妨试试把计算核心拆出去，你会发现世界瞬间清净了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[网关上的限流器]]></title>    <link>https://juejin.cn/post/7574685632095223835</link>    <guid>https://juejin.cn/post/7574685632095223835</guid>    <pubDate>2025-11-20T14:01:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574685632095223835" data-draft-id="7574685632095207451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="网关上的限流器"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T14:01:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="有态度的下等马"/> <meta itemprop="url" content="https://juejin.cn/user/448256476727662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            网关上的限流器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256476727662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    有态度的下等马
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T14:01:58.000Z" title="Thu Nov 20 2025 14:01:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. <a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_limit_req_module.html" title="https://nginx.org/en/docs/http/ngx_http_limit_req_module.html" target="_blank" ref="nofollow noopener noreferrer">nginx原生限流能力</a></h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.nginx.org%2Fblog%2Frate-limiting-nginx" target="_blank" title="https://blog.nginx.org/blog/rate-limiting-nginx" ref="nofollow noopener noreferrer">blog.nginx.org/blog/rate-l…</a></p>
<p>ngx_http_limit_req_module 提供的请求限流能力必须基于<code>某个预定义的key</code>,eg: client Ip, request_uri, host_name, 这个限流器是基于漏桶算法。</p>
<pre><code class="hljs language-ini" lang="ini">limit_req_zone $binary_remote_addr <span class="hljs-attr">zone</span>=ip:<span class="hljs-number">10</span>m rate=<span class="hljs-number">5</span>r/s<span class="hljs-comment">;</span>

server {
    listen 80<span class="hljs-comment">;</span>
    location / {
        limit_req <span class="hljs-attr">zone</span>=ip burst=<span class="hljs-number">12</span> delay=<span class="hljs-number">8</span><span class="hljs-comment">;</span>
        proxy_pass http://website<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>①  使用二进制client ip 作为限流的基础维度，相比字符串形式的remote_addr 占用空间更小</p>
<p>②  限流的配置名是<code>ip</code>, 使用了nginx的共享内存来存储 &lt;remote_addr：rateLimit&gt;键值对</p>
<p>③ r= 5r/s 漏桶每s放行5个请求， 支持的最大并发能力是12（排队请求12）</p>
<p>④ 上文“漏桶算法”显示，排队中的请求会有等待的延迟时间，如果不希望过多的等待，指定<code>delay</code>参数(默认是0，排队的请求都被延迟)。</p>
<p>那问题又来了， 我就想基于<code>整体请求速率限流</code>，不想根据某个特定的请求key限流， 阁下又该如何回锅？</p>
<p>nginx <a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_map_module.html" title="https://nginx.org/en/docs/http/ngx_http_map_module.html" target="_blank" ref="nofollow noopener noreferrer">map指令</a>就可以派上用场：map 基于现有变量<code>$remote_addr</code>创建新变量<code>$global_req_key</code>。</p>
<pre><code class="hljs language-php" lang="php">http {
  map <span class="hljs-variable">$remote_addr</span> <span class="hljs-variable">$global_req_key</span> {
    <span class="hljs-keyword">default</span>       <span class="hljs-number">0</span>;
    <span class="hljs-comment">// 有很多分支值，去掉这些分支，就99归1了。</span>
  }
  
  limit_req_zone <span class="hljs-variable">$gloobal_req_key</span> zone=<span class="hljs-keyword">global</span>:<span class="hljs-number">10</span>m r=<span class="hljs-number">10</span>r/s;
}
</code></pre>
<h4 data-id="heading-1">ref</h4>
<ol>
<li>
<p>nginx上还有<code>特定键上发生的连接数</code>的限流指令<a href="https://link.juejin.cn?target=https%3A%2F%2Fnginx.org%2Fen%2Fdocs%2Fhttp%2Fngx_http_limit_conn_module.html%23limit_conn_zone" title="https://nginx.org/en/docs/http/ngx_http_limit_conn_module.html#limit_conn_zone" target="_blank" ref="nofollow noopener noreferrer">limit_conn_zone</a> 供参考。</p>
</li>
<li>
<p>openresty 内置了限流模块<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenresty%2Flua-resty-limit-traffic" title="https://github.com/openresty/lua-resty-limit-traffic" target="_blank" ref="nofollow noopener noreferrer">lua-resty-limit-traffic</a>, 支持漏桶、固定窗口限速，支持施加多个限流策略。</p>
</li>
</ol>
<h2 data-id="heading-2">2. kong网关限流能力</h2>
<p>kong 网关上有<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.konghq.com%2Fplugins%2Frate-limiting%2F" target="_blank" title="https://developer.konghq.com/plugins/rate-limiting/" ref="nofollow noopener noreferrer">rate-limiting</a>插件，可以提供限流能力</p>





















<table><thead><tr><th>功能性需求</th><th>非功能性需求</th></tr></thead><tbody><tr><td>通过userid，ip，apikey 识别用户</td><td>低延时（&lt;10ms）</td></tr><tr><td>基于配置的规则限制请求</td><td>高可用大于一致性</td></tr><tr><td>返回合适的错误响应头和状态码</td><td>能扩展支撑 1M qps</td></tr></tbody></table>
<p>核心实体：</p>
<ul>
<li>Rules</li>
<li>Clients</li>
<li>Requests</li>
</ul>
<p>当请求到来，识别用户， 找到可应用的规则；<br/>
根据这些规则检查当前的使用情况，并决定是允许还是拒绝请求。</p>
<p>系统接口： kong/plugins/rate-limiting/handler.lua/function RateLimitingHandler:access(conf)</p>
<p>kong网关支持的上层设计</p>
<p>① 识别用户</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ec45493b64348acbee128790303c2dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764252118&amp;x-signature=5zkMDd3IiOzqS%2FoWsCNWw3tniz0%3D" alt="" loading="lazy"/>
6种维度聚合, 默认使用ip聚合。</p>
<p>② 固定窗口限流</p>
<p>③ 请求超限时，支持自定义响应头和响应码</p>
<p>④ 故障容错： 当第三方数据源出现故障，是否禁用限流。（Fault Tolerant= true意味着忽略故障，继续转发）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2049b0249fe1460092fee89e7ca4399a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764252118&amp;x-signature=uuSl1KBztCksmO6RMZjIZ68gj98%3D" alt="" loading="lazy"/></p>
<p>kong网关内置的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.konghq.com%2Fplugins%2Frate-limiting%2F" title="https://developer.konghq.com/plugins/rate-limiting/" target="_blank" ref="nofollow noopener noreferrer">限流插件</a>, 支持<code>local</code>, <code>cluster</code>, <code>redis</code>三种策略， 技术选型要从<code>限流精度</code>和<code>限流组件引入的的延迟</code>角度来考量。</p>
<p>对于要求高精度的（涉及财务）的交易请求，推荐使用 cluster或者redis，kong网关的cluster策略其实就是使用kong 网关的数据存储postgres， 性能肯定没有redis好，但好在不需要引入新的组件。</p>
<blockquote>
<p>开源版本rate limit插件只支持<strong>standalone单机</strong>模式redis； 企业版<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.konghq.com%2Fplugins%2Frate-limiting-advanced%2F" title="https://developer.konghq.com/plugins/rate-limiting-advanced/" target="_blank" ref="nofollow noopener noreferrer">rate-limiting-advanced</a>支持哨兵和redis-cluster模式。</p>
</blockquote>
<p>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKong%2Fdocker-kong" title="https://github.com/Kong/docker-kong" target="_blank" ref="nofollow noopener noreferrer">docker-kong</a>官方脚手架新增redis服务作为限流计算器的的第三方存储：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">kong_data:</span> {}
  <span class="hljs-attr">redis_data:</span> {}
  
<span class="hljs-string">//</span> <span class="hljs-string">......</span>

<span class="hljs-attr">services:</span>  
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:latest</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'6379:6379'</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--save</span> <span class="hljs-number">20</span> <span class="hljs-number">1</span> <span class="hljs-string">--loglevel</span> <span class="hljs-string">notice</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">kong-net</span>
    <span class="hljs-attr">volumes:</span> 
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis_data:/data</span>    
</code></pre>
<p>验证有效：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ea8671f320f48e5925b4bc6a3497f81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764252118&amp;x-signature=Pq8DViQG0ySLPnisJXDQ9Nj8dOo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">3.如何优雅实施“限流”？</h2>
<p>在订单系统中应用“限流”，你怎么理解“限流”和”订单有损“的关系？</p>
<p>这里的关键是区分“有损服务” 和“完全不可用服务”， 体现的是“牺牲局部，保全整体”的设计哲学。</p>
<ol>
<li>
<p>分层和分机限流<br/>
[x] 前端限流： 在按钮上做防止重复提交，页面上用验证码过滤机器人<br/>
[x] 网关层限流： 对每个API，每个用户，每个客户端ip设置频率限制, 防止滥用脚本<br/>
[x] 应用层限流： 针对不同的业务场景设置不同的阈值。</p>
</li>
<li>
<p>柔性限流</p>
</li>
</ol>
<ul>
<li>队列化（削峰填谷）</li>
<li>友好提示</li>
<li>降级策略</li>
</ul>
<ol start="3">
<li>动态限流和自动化</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端程序员原地失业？全面实测 Gemini 3.0，附三个免费使用方法！]]></title>    <link>https://juejin.cn/post/7574671792996925475</link>    <guid>https://juejin.cn/post/7574671792996925475</guid>    <pubDate>2025-11-20T12:07:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574671792996925475" data-draft-id="7574629653743435810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端程序员原地失业？全面实测 Gemini 3.0，附三个免费使用方法！"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-11-20T12:07:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ConardLi"/> <meta itemprop="url" content="https://juejin.cn/user/3949101466785709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端程序员原地失业？全面实测 Gemini 3.0，附三个免费使用方法！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3949101466785709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ConardLi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T12:07:18.000Z" title="Thu Nov 20 2025 12:07:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本期视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1gPywBeEM3%2F" target="_blank" title="https://www.bilibili.com/video/BV1gPywBeEM3/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1gP…</a></p>
</blockquote>
<blockquote>
<p>众所周知，每次有新的模型发布前端都要失业一次，前端已经成为了大模型编程能力的计量单位，所以广大前端朋友不要破防哈！至于这次是不是真的，我们实战测评后再见分晓。</p>
</blockquote>
<p>大家好，欢迎来到 code秘密花园，我是花园老师（ConardLi）。</p>
<p>就在我们还在回味上周 OpenAI 发布的 <code>GPT-5.1</code> 如何用“更有人情味”的交互惊艳全场，还在感叹9月底 <code>Claude 4.5 Sonnet</code> 在编程领域的统治力时，<code>Google</code> 在昨夜（11月18日）终于丢出了它的重磅炸弹 —— <strong>Gemini 3.0</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f88769bed46648a28fd03848f571057a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=LMaR6poWpBWRYXUncfdcOhIY3qU%3D" alt="" loading="lazy"/></p>
<p>“地表最强多模态”、“推理能力断层领先”、“LMArena 首个突破 1500 分的模型” …… Google 这次不仅是来“交作业”的，更是直接奔着“砸场子”来的。</p>
<p><code>Sundar Pichai</code> 在 X 上自信宣称：“Gemini 3.0 是世界上最好的多模态理解模型，迄今为止最强大的智能体 + Vibe Coding 模型。它能将任何想法变为现实，快速掌握上下文和意图，让您无需过多提示即可获得所需信息。”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ff4bf9ff5b342e884ba78e8dacdd8a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=Py%2FFQwXDfGIaYyht64yzfalUEhM%3D" alt="" loading="lazy"/></p>
<p>这个牛吹的还是挺大的。Gemini 3.0 真的有这么强吗？我熬夜实测了 Gemini 3.0 Pro 的编程能力，挖掘了大量细节，为你带来这篇最全解读。以下是本期内容概览：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40f07350281143c287d59095aabd67df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=KMv20xHATISVpKLrTQpApncWGwc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">榜单解读</h2>
<h3 data-id="heading-1">盲测打分</h3>
<p>我们先来看一下官方放出的榜单，是不是非常炸裂，除了 <code>SWE-Bench</code> 没能打过 <code>Claude Sonnet 4.5</code>，大部分测试简直是全面屠榜，甚至有些是断崖式领先：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8b7f4ac78fb4422a0456a2974272e63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=lmwsA%2FKJw73U1z%2BoCPar7za7oD8%3D" alt="https://lmarena.ai/leaderboard" loading="lazy"/></p>
<p>在 LMArena（大模型竞技场） 榜单中，<code>Gemini 3.0 Pro</code> 以 1501 Elo 的积分空降第一，这是人类历史上首个突破 1500 分大关的 AI 模型！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66a0d31bfa6f41ee8953ab9ed1bb8cd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=QEAxLd2pFEekglHiD0i6fAdsTLA%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>LMArena 是由 <code>LMSYS</code> 组织的大众盲测竞技场。用户输入问题，两个匿名模型回答，用户凭感觉选哪个好。它代表了 “用户体验”和“好用程度”。 很多榜单跑分高的模型不一定真的好用，但 <code>Arena</code> 分高一定好用，因为它是大众凭真实感觉选出来的。<code>Gemini 3.0</code> 突破 <code>1500</code> 分，说明在大众眼中，它的体感确实有了质的飞跃。</p>
</blockquote>
<h3 data-id="heading-2">推理能力</h3>
<p>GPQA Diamond 91.7% 的分数非常恐怖，这代表它在生物、物理、化学等博士级别的专业问题上，正确率极高。在 Humanity’s Last Exam（当前最难的测试基准，号称 AI 的 "终极学术考试"）中，在不使用任何工具的情况下达到 37.5% 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc66a507be174cab96c2132a11f6bb62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=A9KlHjqV0AuxH6Ay8iDD0DJQQnE%3D" alt="https://www.vals.ai/benchmarks/gpqa" loading="lazy"/></p>
<blockquote>
<p>GPQA Diamond (Graduate-Level Google-Proof Q&amp;A) 是一套由领域专家编写的、Google 搜不到答案的博士级难题。它是目前衡量AI“智商”的最硬核指标。 只有真正的推理能力，才能在这里得分。Gemini 3.0 能跑到 90% 以上，意味着它在很多专业领域的判断力已经超过了普通人类专家。</p>
</blockquote>
<h3 data-id="heading-3">视觉理解</h3>
<p>Gemini 系列一直以原生多模态（Native Multimodal）著称，Gemini 3.0 更是将这一优势发挥到了极致，它在 MMMU-Pro 和 Video-MMMU 上分别斩获了 <code>81% </code>和 <code>87.6%</code> 的高分，全面领先其他模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9eb28071e9d4b32bac14c6811d105de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=gHWotq19kGXY5%2FlWXlcLECp4SC8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><code>MMMU</code> 是聚焦大学水平的多学科多模态理解与推理基准。<code>MMMU-pro</code> 是 <code>MMMU</code> 的升级强化版，通过过滤纯文本问题、将选项增至10个、引入问题嵌于图像的纯视觉输入设置，大幅降低模型猜测空间，是更贴近真实场景的严格多模态评估基准。</p>
</blockquote>
<h3 data-id="heading-4">其他基准</h3>
<p>另外，在 <code>ARC-AGI-2、ScreenSpot-Pro、MathArena Apex</code> 等基准上更是数倍领先其他模型：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5985b136a2404abbbd71beb122a0e5fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=bqnNrNWHzibO%2B8wxWgwerNyYAXc%3D" alt="" loading="lazy"/></p>
<ul>
<li><code>MathArena Apex</code> 的题目是年全球顶级奥数比赛的压轴题，难度和 IMO（国际数学奥林匹克）最高级别相当。之前主流 AI 模型做这些题，得分都低于 2%，直到 Gemini 3 Pro 交出 23.4% 的成绩。</li>
<li><code>ARC-AGI-2</code> 是 ArcPrize 基金会 2025 年推出的通用智能测试，能重点考察 AI 的组合推理能力和高效解题思路，还通过成本限制避免 AI 靠 “暴力破解” 得分。</li>
<li><code>ScreenSpot-Pro</code> 是 2025 年新出的专业 GUI 视觉定位测试工具。它的核心任务是让 AI 精准找到界面上的 UI 元素，比如按钮、输入框等。目前多数模型的原始准确率不到 10%，而 Gemini 3 Pro 凭借 72.7% 的准确率创下了当前纪录。</li>
</ul>
<p>这个榜单看着确实挺恐怖的，实际效果如何，我们一起来测试一下。</p>
<h2 data-id="heading-5">使用方法</h2>
<p>以下四个位置目前均可以免费使用 Gemini 3.0：</p>
<ol>
<li>打开 <strong>Google Gemini App</strong> 或网页版，可以直接体验 Gemini 3.0，仅限基础对话和简单工具调用，普通 Google 账号即可：</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5f9f7951ca3458ab92debc88d6e7da2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=C01z8zAS%2FhvGiPg9VOxHm2N0%2F7M%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fapp" target="_blank" title="https://gemini.google.com/app" ref="nofollow noopener noreferrer">gemini.google.com/app</a></p>
</blockquote>
<ol start="2">
<li><strong>Google AI Studio Playground</strong> ，API 已经开放 Preview 版本（<code>gemini-3-pro-preview</code>）可以更改模型参数，进行基础对话和工具调用：</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9533b4b40304f9286544c6e69eae3a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=15yJZdRQcfycERCrCJdYexv%2BPTA%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Faistudio.google.com%2Fprompts%2Fnew_chat" target="_blank" title="https://aistudio.google.com/prompts/new_chat" ref="nofollow noopener noreferrer">aistudio.google.com/prompts/new…</a></p>
</blockquote>
<ol start="3">
<li><strong>Google AI Studio Build</strong> ，一个专业的 AI 建站平台，类似 <code>V0</code>，可以编写复杂的前端应用：</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98dc025b72734b1cae3b33e5fdaeaf3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=4qUFqK0GnIdYp24ef44JCXlBPfQ%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Faistudio.google.com%2Fapps" target="_blank" title="https://aistudio.google.com/apps" ref="nofollow noopener noreferrer">aistudio.google.com/apps</a></p>
</blockquote>
<ol start="4">
<li><strong>Google Antigravity</strong>，Google 推出的全新 AI IDE，对标 Cursor。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f15b0f2bc43433b85167710dd757b1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=6ElDzJ9sGtmRuOJbAAu7YvCibhg%3D" alt="" loading="lazy"/></p>
<p>目前可以直接白嫖 <code>Gemini 3 Pro</code> 和 <code>Claude Sonnet 4.5</code>（不过需要美区 Google 账号）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84bf1a2022b64b6a8c29191ae4ca7e98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=tdEQddUGCtre9jvKTrvOvFN12Cc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">中文写作</h2>
<p>我们先来进入 <code>Google Gemini</code> 网页版，测试一下最基础的中文写作能力，我们在右下角切换到 Thinking 模式，即可使用最新的 Gemini 3.0 的推理能力：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acaa07bcc668417f98d70e8475b13043~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=rRiAjY2cRX43BVBnHY8VyYslSdo%3D" alt="" loading="lazy"/></p>
<p>我们来让他调研一下昨天比较火的 Cloudflare 宕机事件，并且生成一篇工作号文章，输入如下提示词：</p>
<blockquote>
<p>调研最新的 Cloudflare 崩溃事件，然后编写一篇公众号文章来介绍这个事件。注意文章信息的真实性、完整性、可读性。</p>
</blockquote>
<p>可以看到，它进行了非常长并且有条理的推理：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27eba687a47a4c1a8d98c5ff73f240cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=c7ypzTrGH%2FChBgmkhmgRd%2BJ6pD4%3D" alt="" loading="lazy"/></p>
<p>然后开始输出正文，先给出了公众号的推荐标题和摘要：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/267e40163a8641858913dbd9e981cd64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=XBHwwjfmFnddQ5G89Fw4PWX2uRc%3D" alt="" loading="lazy"/></p>
<p>以下是完整的文章，基本没什么 AI 味：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94b37baa82bc4683b60f2a3228fc0b1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=fAO6LQ0O8QDABDyFn0N2uAHVb%2BQ%3D" alt="" loading="lazy"/></p>
<p>接下来，我们再看看我们的老朋友豆包的生成效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7e14450c3cb4e0a94a8658b244b2f12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=S2z2XH%2FayhMGLMqEdFHBcl%2FazH8%3D" alt="" loading="lazy"/></p>
<p>大家觉得哪个文笔好一点呢，可以自行评判一下。</p>
<h2 data-id="heading-7">开发实测</h2>
<p>下面，我们开始测试开发能力，这时我们可以到 <code>Google AI Studio</code> 的 Build 功能，这其实是一个在线的 AI Coding 工具，帮你快速把想法变成可运行的网页。</p>
<h3 data-id="heading-8">测试1：物理规律理解</h3>
<p>我们先来一个非常经典的测试：</p>
<p>::: block-1
实现一个弹力小球游戏：</p>
<ul>
<li>环境设置：创建一个旋转的六边形作为小球的活动区域。</li>
<li>物理规律：小球需要受到重力和摩擦力的影响。</li>
<li>碰撞检测：小球与六边形墙壁碰撞时，需要按照物理规律反弹。
:::</li>
</ul>
<p>理解物理规律一直是众多模型的最大难题之一，所以每次有新的模型出现这都是我首要测试的题目。可以看到，Gemini 依然首先给出了非常详细且有条理的思考：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0997a63982844812a872d9dcafb5e1e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=Vvbwry00Oz5ApZnkLRE00vPp9vU%3D" alt="" loading="lazy"/></p>
<p>然后开始编写代码，我们可以切换到 <code>Code</code>，可以看到实时的代码生成，输出速度还是非常快速。一个很明显的区别，在 Build 模式下生成的代码并不是简单的 HTML，而是一个含有多个文件的 <code>React + TS</code> 的应用，这就给了它更高的上限，可以编写非常复杂的网页应用，并且写出的代码也会更容易维护。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e081dd290bd74fbeb060c48c0dd5aa11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=HwBRoVJE8EBT27j%2BtrZmAAa73aI%3D" alt="" loading="lazy"/></p>
<p>生成完成了，我们来看一下效果，可以发现 <code>Gemini</code> 对物理规律的理解是非常不错的，而且页面样式和交互体验也不错。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df014d67a0fe42e481ec087a60c37622~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=FCy4rjeLwPW%2B%2FTteKGJ7lA78HgU%3D" alt="" loading="lazy"/></p>
<p>在生成完成后，我们可以继续对网站提出改进意见让它继续迭代，还可以直接更改网页的代码，还是非常方便的。</p>
<h3 data-id="heading-9">测试2：小游戏开发</h3>
<blockquote>
<p>提示词：请你帮我编写一款赛博朋克风格的马里奥小游戏，要求界面炫酷、可玩性高、功能完整。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2e90d8592f9468187f957482b65bf7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=7tS73ISCrxm0JGQPbKhg%2Fe0Lm%2Bo%3D" alt="" loading="lazy"/></p>
<p>最终效果（经过三轮迭代，耗时 8 分钟左右）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fba600051a54a789e117d118c2aaac1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=ftYWXlGN9vPdGLTUJwi8vKf660E%3D" alt="" loading="lazy"/></p>
<p>游机制还原度还是非常高的，运行效果也很流畅，文章里就不放视频了，具体效果大家可以到 B 站视频中去看。</p>
<h3 data-id="heading-10">测试3：3D效果开发</h3>
<blockquote>
<p>开发一个拥有逼真效果的 3D 风扇 网页，可以真实模拟风扇的运行</p>
</blockquote>
<p>最终效果（经过两轮迭代，耗时 5 分钟左右）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/061243e43fc84d7eac9f541c55854483~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=fYujgwVR%2FUX0rYObNT99QOQu75Y%3D" alt="" loading="lazy"/></p>
<p>这个风扇生成的还是很逼真的，支持开关、调整风扇转速、摇头。甚至还是个 AI 智能风扇，可以直接跟风扇语音对话让他自己决定如何调整转速 ...</p>
<h3 data-id="heading-11">测试4：UI还原能力</h3>
<blockquote>
<p>提示词：帮我编写一个网站,要求尽可能的还原给你的这两张设计图</p>
</blockquote>
<p>设计稿原图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5b1676ba760407cad158378efee4d8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=dyD8FvnXyvN0CqOe5w4%2BstAXH8E%3D" alt="" loading="lazy"/></p>
<p>一轮对话直接完成，耗时 3 分钟左右：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5172a5ec41284873833951fcfbbbc0e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=yUgYWnGgVAqI0SP2r3SwLQcH5Vw%3D" alt="" loading="lazy"/></p>
<p>最终还原效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97a92a119ed84e9e8ff02c902cd35c22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=o%2Bm7GHosrzzgLb%2B5VjYYkataWVA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c811282933d4a51b7d5ec2cd6c5e1c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=d5cHUyRoZPSwP3B9GCEFnibKJ6Y%3D" alt="" loading="lazy"/></p>
<p>这效果，基本上算是 1:1 直接还原了，并且界面上的组件都是可交互的，这个必须点赞。</p>
<h3 data-id="heading-12">测试5：使用插件开发</h3>
<p>在 Build 模式下，我们还可以直接选择官方提供的各种插件，比如前段时间比较火的 Nano Banana（Gemini 的生图模型），以及 Google Map、Veo 等服务：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/438b8ae201de47cbbac0194e95e87af7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=wlM1GD84jx8nAY8%2BtEp651r9Oe4%3D" alt="" loading="lazy"/></p>
<p>我们来尝试使用 Nano Banana 生成一个在线的 AI 图片处理网站：</p>
<blockquote>
<p>提示词：创建一个在线的 AI 图片处理应用，可以支持多项图片处理能力，页面炫酷、交互友好。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ee415e5461e443889e87820c21e91d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=SE%2FL9hzCqu%2Fgh0teKmhE%2BzIARx0%3D" alt="" loading="lazy"/></p>
<p>最终效果（经过三轮迭代，耗时 6 分钟左右）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea2cffb9db534e2986ec84a9a6369cd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=vANF138FZ4Fe5lzV%2Fo3RibKPd1E%3D" alt="" loading="lazy"/></p>
<p>效果非常不错，支持拖动对比图片处理前后的效果，还支持对图片局部进行处理：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11b38831fa374c288755a2894730e63c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=6%2FIOUiFPdixccu5yS7R9KSKO460%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">测试6：I'm feeling lucky</h3>
<p>在 Build 模式下，还有个非常有意思的功能，<code>I'm feeling lucky</code>，点击这个按钮，它会自动帮我生成一些项目灵感，如果你支持想尝试一下 Gemini 3.0 的强大能力，但不知道要做点啥，这就是一个不错的选择：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e49dbe0131f43cda5f93dcc9e8ffc8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=ZXam5QTN82%2FxA2wGP5FJGA2%2FTZ4%3D" alt="" loading="lazy"/></p>
<p>比如下面这个项目，就是我基于 AI 生成的灵感而创建的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c33cb20f1a4947eca1b313b50273cbf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=BOtXI2NKSPsYlZQOXM%2B5kuxRM18%3D" alt="" loading="lazy"/></p>
<p>这是一个 AI 写作工具：支持通过输入提示词和文件附件，让 AI 协助创作内容；并要求 AI 对任意段落、句子等进行迭代优化；AI 也会智能主动介入 —— 当它判断时机合适时，主动提供反馈建议，支持嵌入式修改；</p>
<p>经过这几轮测试我们发现，<code>Gemini 3.0</code> 编写网站的能力确实非常强，不过这也离不开 <code>Build</code> 工具的加持，那脱离了这个工具后究竟效果如何呢，下面我们在本地 AI IDE 环境中来进行测试。</p>
<h2 data-id="heading-14">Gemini 3.0 PK Claude Sonnet 4.5</h2>
<p>我们让 <code>Gemini 3.0</code> 来 PK 一下目前公认最强的编码模型 <code>Claude Sonnet 4.5</code> 。</p>
<p>为了保证公平的测试环境，我们使用本地的 <code>AI IDE</code> 来进行测试，可让两个模型拥有同样的调度机制和工具。</p>
<p>我们直接用 Google 这次和 <code>Gemini 3.0</code> 一起发布的 <code>Antigravity</code> 编辑器，这是一款直接对标 <code>Cursro、Windsurf</code> 的本地 AI 编辑器，可以直接白嫖 <code>Gemini 3 Pro</code> 和 <code>Claude Sonnet 4.5</code> 。</p>
<p><code>Antigravity</code> 也是基于 <code>VsCode</code> 二次开发的，使用体验感觉也和 <code>Cursor</code> 差不多：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/529e36db0ffd4a52acbaafaa9925e466~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=7%2BM3%2BmV5ID8KSOgf1%2FYaNWXkbp0%3D" alt="" loading="lazy"/></p>
<ul>
<li>输入 @ 可以选择文件、配置 <code>MCP Server</code>、配置 <code>Global Rules</code> 等功能；</li>
<li><code>Coding Agent</code> 可以选择 <code>Planning</code> 和 <code>Fast</code> 两种模式</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f5f236f37ba4573872f3cae9254bd72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=ZyflKuupo7CBl8iFPO5UnkezWkA%3D" alt="" loading="lazy"/></p>
<p>目前支持选择以下五个模型，都是免费的：</p>
<ul>
<li>Gemini 3 Pro (High)、Gemini 3 Pro (Low)</li>
<li>Claude Sonnet 4.5、Claude Sonnet 4.5 (Thinking)</li>
<li>GPT-OSS 120B (Medium)</li>
</ul>
<h3 data-id="heading-15">题目1：项目理解能力：大型项目优化分析</h3>
<p>第一局，我们来测试一下模型的项目理解能力，我们让他对一个大型的项目，进行整体的分析和产出优化建议，我们选择 <code>Easy Dataset</code> 这个项目。</p>
<blockquote>
<p>理解当前项目架构，并告诉我本项目还有哪些需要改进的地方？（无需改动代码，先输出结论）</p>
</blockquote>
<h4 data-id="heading-16">Gemini 3.0</h4>
<p>这是 Gemini 3.0 的情况，它先进行了非常全面的分析，然后为最终的结论创作了一个单独的文件，使用英文编写：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d02806f5ab11405bbe0877e3aa7f82d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=uekb6FYXhcNRceCmX7GlonR4b3U%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-17">Claude Sonnet 4.5</h4>
<p>然后是 <code>Claude 4.5</code> 的分析过程：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e18f4c9138d47fcbfbe10272cea0d7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=xFXQ5GqntZDcuGu66uEEp5QPi8A%3D" alt="" loading="lazy"/></p>
<p>最终结论直接输出到了聊天窗口：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/335623e8f16d427dbb47a742db1973a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=IPk6O9VxcN55yX7GfJoT6chlWVg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">对比结果</h4>
<p>凭我个人对这个项目的理解，乍一看还是 Claude 4.5 生成的结果更准确，而且查看的文件也很关键，给出的建议也都是正确的。</p>
<p>为了公平的评判，下面我们有请 DeepSeek 老师来担当裁判：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cb20e427bb54883b3cadb11d8813ab1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=LAl6uvfkARRXdxybVI3EwTcW3po%3D" alt="" loading="lazy"/></p>
<p>最终结论，<code>Claude Sonnet 4.5</code> 胜出：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e6ed3a7a7f045248bbb5d03510e9c29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=S3cyqgP%2F9n3%2ByZFdnmHSNHVzHWg%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>其实这里对 Claude 来讲还稍微有点不公平的，因为 Gemini 3.0 我们使用的是长思考模式，而 Claude 4.5 我们选择的是非思考模型，如果是 Claude 4.5 Thinking 模式，最终效果肯定还要更好一点。</p>
</blockquote>
<h3 data-id="heading-19">题目2：架构设计能力：全栈项目编写</h3>
<p>下面，我们再来测试一下综合的架构设计和编码能力，让它帮我们生成一个完整的全栈项目，既要兼顾某一个具体的技术设计，又要兼顾前后端的协作，需求如下：</p>
<blockquote>
<p>设计并实现一个 Node.js 的 JWT 认证中间件，考虑安全性和易用性；设计对应的前端页面、业务接口来演示中间件的调用效果；创建 Readme 文档，并编写此中间件的架构设计、使用方式等。</p>
</blockquote>
<h4 data-id="heading-20">Gemini 3.0</h4>
<p>过程省略（感兴趣可以到视频里去看），直接上结果吧：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37b93f96dd7b4434adc42e6d432bdf20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=u1dEaW0G46fLbxnmcviJ0FoX3rI%3D" alt="" loading="lazy"/></p>
<p>最后只生成了两个页面，一个登录页，一个登录之后的接口验证：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/114ec035a09f47668385b85052c69973~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=yz1t1p4tJ130mkIA6aBAwRiXu4w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-21">Claude Sonnet 4.5</h4>
<p>Claude Sonnet 4.5 的结果明显就要更好一点了：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/556306fccbbc45f394d22e2c60ea13ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=l%2FxpDDEMDtQ%2F6ibofWhlvMIyjv0%3D" alt="" loading="lazy"/></p>
<p>首先包含了完整的注册登录功能，在登录后，可以进行多种维度的接口验证：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bbeaaa07ee64a6bb9799a2dfc1186a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=Vceh1cB7mxK9Hp%2BbeaBZuzEkgj0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aa68dca60ae4cab8f25fd5721ff9cd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=dL6TqRpnxx7Dr5W5UhbR9406l5o%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-22">对比结果</h4>
<p>为了保证公平，我们还是要看一下代码具体写的怎么样，下面我们还是让 AI 来分析对比下这两个工程的代码：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/714d33cbfa4d4a2b91e22eafb6c65f4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=qvoukBHbwA6lTq8X28h%2FEWRx0z4%3D" alt="" loading="lazy"/></p>
<p>最终对比结论还是 <code>Claude Sonnet 4.5</code> 完胜</p>
<h3 data-id="heading-23">题目3：前端编写能力：项目官网编写</h3>
<p>第三局，我们偏心一点，来对比一下两者的纯前端编码的能力，因为毕竟是 Gemini 3.0 的实测，都输了也不太好，我们这次让他们从零调研并生成一个 Easy Dataset 的官网。</p>
<blockquote>
<p>提示词：请你调研并分析这个项目的主要功能 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-dataset" target="_blank" title="https://github.com/ConardLi/easy-dataset" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a> ，并为它编写一个企业级的官方网站。</p>
</blockquote>
<h4 data-id="heading-24">Gemini 3.0</h4>
<p>首先看 Gemini 3.0 的生成效果，列出的项目计划是这样的，然后中间中断，手动继续了一次，后使用 tailwindcss 的脚手架模版创建了这个项目，在最后的自动化测试环节也是没有完成的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0b5d319edce479fb56bff61b1c51661~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=DyOYCK3yw4xU0jHmeGVFhBxBjK0%3D" alt="" loading="lazy"/></p>
<p>最终生成的效果是这样的，审美还是挺在线的，不过内容略显单薄了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff36c1e9f2a349f7a740dd978776a5e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=MQ6RknR5Zyj30ZSiTPIH0ZCEqck%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5456488d8df4b92a4d0a0044bbf7f51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=BJAZ8rAdVrtqMKW3wivvRfijZAk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-25">Claude Sonnet 4.5</h4>
<p>然后我们来看 Claude 4.5 生成的结果，首先他生成的一份非常详细的开发计划，然后对 Easy Dataset 项目进行了调研，然后产出了一份调研报告后才开始开发。任务是一次就完成了，中间没有任何中断，然后他没有选择使用脚手架，而是从零创建了项目代码，最终也顺利完成了自动化测试。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df2d2e78652e427a875e9f5b01201684~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=ru6fa7JKfH7H12AaGQ8cFPuTlCw%3D" alt="" loading="lazy"/></p>
<p>然后我们来看最终的生成效果，这个看起来在视觉体验上就明显不如 Gemini 3.0 了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cee26f20eb6643139bded49430f30d63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=S7y1a9EzpN8PJzsz0ONHoQxutd0%3D" alt="" loading="lazy"/></p>
<p>但是，因为前期进行了非常充分的调研，所以网站的内容非常充实，基本上涵盖了所有关键信息。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be01d691b8b74a43be54de2c9f33657b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=E4j98xXFZOIGRZPVewn6xuHpVfI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64ff0418343c4a009b2f4ff0c357e4b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=PY4l1quJLVMXte6gzIH7wKWVLHs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-26">对比结果</h4>
<p>所以这最后一局可以说是各有优劣：</p>
<ul>
<li>视觉体验、项目代码的可维护性 Gemini 3.0 胜出；</li>
<li>网站的内容丰富度，整个编写过程的丝滑程度 Claude 4.5 胜出；</li>
</ul>
<p>所以这一局，我们判定为平局。</p>
<h2 data-id="heading-27">总结</h2>
<p>最后我们来根据今天的实测结果总结一下结论。</p>
<p><code>Gemini 3.0</code> 的前端能力确实超标，在小游戏开发，UI 设计稿还原，视觉效果开发这种对审美能力要求极高的需求中更是强的可怕。得益于 <code>Gemini</code> 原生多模态，以及强大的视觉理解能力，让他这种优势进一步放大了出来。</p>
<p>特别是在有了 <code>AI Studio Build</code> 这种工具的加持，让他在从零生成一个 <code>Web</code> 应用这个场景下更是是如虎添翼。另外，在指令遵循，需求理解的能力上，相比上一代的 <code>Gemini 2.5</code> 确实是有了很大幅度的增强。</p>
<p>但是，这足以让前端失业吗？</p>
<p>在实际的开发中，绘制 <code>UI</code> 可能只占很小一部分的工作。说到这，就不得不说我们的前端祖师爷，最近刚靠开发前端工具链融资了 8000 万啊，当之无愧的前端天花板了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6683754943d2435680c811f7ea170eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=iDXdCxtjYOm75OKmoD6unCVasx4%3D" alt="" loading="lazy"/></p>
<p>在后面的实战对比中，我们发现，在复杂项目上下文理解，全栈项目的架构设计和编写等实际开发工作中需要考虑的环节上，相比 <code>Claude</code>，<code>Gemini 3.0</code> 还是略逊一筹的，他依然无法撼动<code> Claude</code> 在 <code>Vibe Coding</code> 领域的的霸主地位。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfcec74415cc4d7e97a00cca2313b651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=Wh8mK6yPTdDlZ5Sm%2BEc2nVfufTA%3D" alt="" loading="lazy"/></p>
<p>这个其实我们看榜单的 <code>SWE Bentch</code> 就看出来了，这是唯一一个被 Claude超越的指标，这个 Bentch 中包含了大量真实项目开发中要解决的 Issue ，能够衡量模型在真实编程环境中解决问题的能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e15885de886941a4b6326e122aa7d1a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764245397&amp;x-signature=FNkyTZCZi2uC%2BJDAhHTljYRv6R0%3D" alt="" loading="lazy"/></p>
<p>所以这也能体现 Gemini 3.0 在真实的编程工作中并没有带来多大的提升，不过对于完全不会编程的小白来讲，确实可以让你们的想法更快也更好的变成现实了。</p>
<p>所以广大前端程序员不要慌，淘汰的是切图仔，关我前端程序员什么事呢？</p>
<p>不过这是玩笑话，广大程序员们确实应该居安思危了，就算不会在短时间内立刻失业，你们的竞争力确实是在实打实的流失的，其实很多行业也都一样，如果一直是在做简单的重复性工作，那未来被 AI 淘汰已是必然了。</p>
<h2 data-id="heading-28">最后</h2>
<p>关注《code秘密花园》从此学习 AI 不迷路，相关链接：</p>
<ul>
<li>AI 教程完整汇总：<a href="https://link.juejin.cn?target=https%3A%2F%2Frncg5jvpme.feishu.cn%2Fwiki%2FU9rYwRHQoil6vBkitY8cbh5tnL9" target="_blank" title="https://rncg5jvpme.feishu.cn/wiki/U9rYwRHQoil6vBkitY8cbh5tnL9" ref="nofollow noopener noreferrer">rncg5jvpme.feishu.cn/wiki/U9rYwR…</a></li>
<li>相关学习资源汇总在：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-learn-ai" target="_blank" title="https://github.com/ConardLi/easy-learn-ai" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a></li>
</ul>
<p>如果本期对你有所帮助，希望得到一个免费的三连，感谢大家支持</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go 实战：在 Gin 基础上上构建一个生产级的动态反向代理]]></title>    <link>https://juejin.cn/post/7574685632094945307</link>    <guid>https://juejin.cn/post/7574685632094945307</guid>    <pubDate>2025-11-20T12:36:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574685632094945307" data-draft-id="7574677905499750426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 实战：在 Gin 基础上上构建一个生产级的动态反向代理"/> <meta itemprop="keywords" content="Go,Gin,Nginx"/> <meta itemprop="datePublished" content="2025-11-20T12:36:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Go有引力"/> <meta itemprop="url" content="https://juejin.cn/user/3866346347042247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 实战：在 Gin 基础上上构建一个生产级的动态反向代理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3866346347042247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Go有引力
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T12:36:42.000Z" title="Thu Nov 20 2025 12:36:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>作为后端开发者，我们对 Nginx 肯定不陌生。它是反向代理和负载均衡的绝对霸主。但你是否遇到过这样的场景：你的业务处于快速迭代期，后端服务节点频繁变动，或者需要做灰度发布。每次调整上游（Upstream）服务器，都得去改 <code>nginx.conf</code>，然后小心翼翼地执行 <code>nginx -s reload</code>。</p>
<p>虽然 Nginx 性能强悍，但它的配置管理在某些动态场景下显得略微“重”了一些（虽然 Nginx Plus 支持动态 API，但那是付费功能；Lua 脚本也能做，但维护成本高）。</p>
<p>如果你是 Go 语言开发者，且正在使用 Gin 框架，那么你完全可以把反向代理的能力“内嵌”到你的业务代码中。今天介绍一个基于 Gin 的生产级反向代理库 —— <strong>Gin Reverse Proxy</strong>，它不仅能替代 Nginx 的部分功能，更重要的是：<strong>它支持通过 API 动态管理路由和节点，无需重启服务。</strong></p>
<br/>
<h3 data-id="heading-1">为什么要在代码里做反向代理？</h3>
<p>通常我们认为反向代理是运维层面的事。但在微服务或云原生环境下，让网关层具备编程能力是非常必要的。</p>
<p>这个库 <code>github.com/go-dev-frame/sponge/pkg/gin/proxy</code> 实际上是基于 Go 标准库 <code>net/http/httputil</code> 构建的，但它做了一层非常实用的封装：</p>
<ol>
<li><strong>动态感知</strong>：通过 HTTP API 随时上下线后端机器。</li>
<li><strong>健康检查</strong>：类似 Nginx 的 <code>health_check</code>，自动剔除坏节点，复活后自动拉起。</li>
<li><strong>负载均衡策略</strong>：内置了轮询（Round Robin）、最小连接数（Least Connections）和 IP 哈希（IP Hash）。</li>
</ol>
<p>这就意味着，你可以写一个简单的 Go 程序，既处理部分业务逻辑，又能像网关一样分发流量，而且极其灵活。</p>
<br/>
<h3 data-id="heading-2">快速上手：搭建你的网关</h3>
<p>假设我们要在本地启动一个网关，把流量分发给后端的两个服务集群（比如“交易服务”和“用户服务”）。</p>
<h4 data-id="heading-3">1. 基础代码实现</h4>
<p>只需几行代码，就能让你的 Gin 服务变身反向代理：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"github.com/go-dev-frame/sponge/pkg/gin/proxy"</span>
    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    r := gin.Default()

    <span class="hljs-comment">// 初始化代理中间件，默认管理接口挂载在 /endpoints 下</span>
    p := proxy.New(r)

    <span class="hljs-comment">// 配置路由规则</span>
    setupProxyRoutes(p)

    <span class="hljs-comment">// 你的 Gin 依然可以处理普通路由</span>
    r.GET(<span class="hljs-string">"/ping"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> {
        c.JSON(<span class="hljs-number">200</span>, gin.H{<span class="hljs-string">"message"</span>: <span class="hljs-string">"我是网关本体"</span>})
    })

    fmt.Println(<span class="hljs-string">"网关已启动，监听 :8080"</span>)
    r.Run(<span class="hljs-string">":8080"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setupProxyRoutes</span><span class="hljs-params">(p *proxy.Proxy)</span></span> {
    <span class="hljs-comment">// 规则1：将 /proxy/ 开头的请求分发给集群 A</span>
    <span class="hljs-comment">// 默认使用轮询策略，健康检查间隔5秒</span>
    err := p.Pass(<span class="hljs-string">"/proxy/"</span>, []<span class="hljs-type">string</span>{
        <span class="hljs-string">"http://localhost:8081"</span>, 
        <span class="hljs-string">"http://localhost:8082"</span>,
    })
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }

    <span class="hljs-comment">// 规则2：将 /personal/ 开头的请求分发给集群 B</span>
    err = p.Pass(<span class="hljs-string">"/personal/"</span>, []<span class="hljs-type">string</span>{
        <span class="hljs-string">"http://localhost:8083"</span>, 
        <span class="hljs-string">"http://localhost:8084"</span>,
    })
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(err)
    }
}
</code></pre>
<p>看到这里，你会发现它和 Nginx 的 <code>proxy_pass</code> 逻辑非常像，但它是编译进二进制文件的。</p>
<br/>
<h4 data-id="heading-4">2. 进阶配置：不仅仅是转发</h4>
<p>生产环境往往需要更精细的控制。比如，对于这就需要 Session 保持的服务，我们需要 IP Hash 策略；对于关键服务，我们需要自定义健康检查的时间。</p>
<p><code>proxy.New</code> 和 <code>p.Pass</code> 都支持 Option 模式的配置，这点非常 Go Style：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 在注册路由时进行精细化配置</span>
err := p.Pass(<span class="hljs-string">"/proxy/"</span>, []<span class="hljs-type">string</span>{<span class="hljs-string">"http://localhost:8081"</span>, <span class="hljs-string">"http://localhost:8082"</span>}, proxy.Config{
    <span class="hljs-comment">// 使用 IP 哈希算法，保证同一用户的请求落在同一台机器</span>
    proxy.WithPassBalancer(proxy.BalancerIPHash),
    <span class="hljs-comment">// 自定义健康检查：5秒一次，超时时间3秒</span>
    proxy.WithPassHealthCheck(time.Second * <span class="hljs-number">5</span>, time.Second * <span class="hljs-number">3</span>),
    <span class="hljs-comment">// 你甚至可以给这个代理路由单独加中间件（比如鉴权）</span>
    proxy.WithPassMiddlewares(AuthMiddleware()),
})
</code></pre>
<p>这一步非常强大。在 Nginx 中配置鉴权通常比较麻烦（需要 auth_request 模块等），而在 Go 里，这只是一个普通的 Gin Middleware 而已。</p>
<br/>
<h3 data-id="heading-5">杀手级功能：运行时动态管理</h3>
<p>这是这个库最吸引人的地方。</p>
<p>以前，如果 <code>localhost:8081</code> 挂了，或者你要扩容一台 <code>8085</code>，你通常需要修改配置并重启网关。但在这里，代理服务启动后，它会自动暴露出管理 API（默认在 <code>/endpoints</code> 下）。</p>
<p>你可以直接通过 HTTP 请求来指挥你的网关。</p>
<h4 data-id="heading-6">场景一：服务扩容</h4>
<p>双十一流量突增，你临时启动了一台新机器 <code>http://localhost:8085</code>，想让网关立刻把流量分过去。</p>
<p>直接发一个 POST 请求：</p>
<pre><code class="hljs language-bash" lang="bash">curl -X POST http://localhost:8080/endpoints/add \
     -H <span class="hljs-string">"Content-Type: application/json"</span> \
     -d <span class="hljs-string">'{
           "prefixPath": "/proxy/",
           "targets": ["http://localhost:8085"]
         }'</span>
</code></pre>
<p><strong>瞬间生效</strong>。新节点会自动加入负载均衡池，并开始接受健康检查。</p>
<br/>
<h4 data-id="heading-7">场景二：故障节点下线/灰度发布</h4>
<p>发现 <code>8085</code> 节点报错率高，或者需要对其进行升级，需要优雅下线。</p>
<pre><code class="hljs language-bash" lang="bash">curl -X POST http://localhost:8080/endpoints/remove \
     -H <span class="hljs-string">"Content-Type: application/json"</span> \
     -d <span class="hljs-string">'{
           "prefixPath": "/proxy/",
           "targets": ["http://localhost:8085"]
         }'</span>
</code></pre>
<br/>
<h4 data-id="heading-8">场景三：监控大盘</h4>
<p>你想知道当前所有后端节点的健康状态，直接调用 <code>list</code> 接口：</p>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:8080/endpoints/list?prefixPath=/proxy/
</code></pre>
<p>返回结果清晰明了：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"prefixPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/proxy/"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:8081"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"healthy"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:8082"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"healthy"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">}</span> 
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<br/>
<h3 data-id="heading-9">总结与建议</h3>
<p><strong>什么时候该用它？</strong></p>
<ol>
<li><strong>Go 技术栈团队</strong>：如果你的团队主力是 Go，维护一套基于 Go 的网关比维护 Nginx 配置文件要容易得多。</li>
<li><strong>需要高度自定义逻辑</strong>：比如在转发前需要读取 Redis 里的黑名单，或者需要对请求体进行复杂的签名验证，用 Go 写中间件比写 Nginx Lua 脚本舒服太多。</li>
<li><strong>中小规模的动态环境</strong>：对于 k8s 之外的轻量级部署，或者开发测试环境，通过 API 动态调整路由非常方便。</li>
</ol>
<p><strong>什么时候还是用 Nginx？</strong></p>
<ul>
<li>静态资源服务（CDN 级别）。</li>
<li>极其巨大的并发量（百万级 QPS），Nginx 的 C 语言底层优化依然是天花板。</li>
</ul>
<p>总的来说，<strong>Gin Reverse Proxy</strong> 提供了一种介于“硬编码”和“纯运维工具”之间的中间地带。它把负载均衡和反向代理的控制权交还给了开发者，让网络层也能像业务逻辑一样灵活多变。</p>
<p>如果你受够了频繁 Reload Nginx，不妨在下一个项目中试试这个方案。</p>
<br/>
<hr/>
<br/>
<p><code>proxy</code>是 Sponge 的内置库，Sponge 是一款功能强大且易用的 Go 开发框架，整合了 <strong>代码自动生成</strong>、<strong>Web 框架 (Gin)</strong> 和 <strong>微服务框架 (gRPC)</strong>，覆盖了从项目生成、开发、测试、API 文档到部署的全生命周期。Sponge 旨在提升后端服务的开发效率与代码质量，彻底消除繁琐的重复性工作，专注于核心业务逻辑的实现。</p>
<p>Sponge 的核心理念是 <strong>"定义即代码"</strong>，通过解析 SQL、Protobuf 和 JSON 配置文件生成模块化服务代码。开发者可灵活组合这些模块，通过 <strong>低代码</strong> 方式快速构建各类后端系统，如 RESTful API、gRPC、HTTP+gRPC、gRPC Gateway或微服务集群。</p>
<p>Sponge Github 地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgo-dev-frame%2Fsponge" target="_blank" title="https://github.com/go-dev-frame/sponge" ref="nofollow noopener noreferrer">github.com/go-dev-fram…</a></p>
<br/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ESLint报错无具体信息：大型代码合并中的内存与性能问题排查]]></title>    <link>https://juejin.cn/post/7574657475430137882</link>    <guid>https://juejin.cn/post/7574657475430137882</guid>    <pubDate>2025-11-20T12:49:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574657475430137882" data-draft-id="7574608278422798372" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ESLint报错无具体信息：大型代码合并中的内存与性能问题排查"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T12:49:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="eason_fan"/> <meta itemprop="url" content="https://juejin.cn/user/2995517308808877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ESLint报错无具体信息：大型代码合并中的内存与性能问题排查
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2995517308808877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    eason_fan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T12:49:29.000Z" title="Thu Nov 20 2025 12:49:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ESLint报错无具体信息：大型代码合并中的内存与性能问题排查</h2>
<h3 data-id="heading-1">问题描述</h3>
<p>在最近的一次大型代码合并中，遇到了一个令人困惑的ESLint问题：</p>
<p>先是提示内存溢出</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93a3bd4d221b48f3ae7f883a505f6018~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWFzb25fZmFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764247769&amp;x-signature=ElS%2Fb%2B8SadDzmSkypf97zjw2rL4%3D" alt="img_v3_02s7_537bfaa6-6a75-48d7-a4d2-5bfc5fe092hu.png" loading="lazy"/></p>
<p>然后出现报错，但是没有报错信息，只展示检测的文件路径。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83e39f3f22774cf29fde8fcae9dff88f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZWFzb25fZmFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764247769&amp;x-signature=6HKfaxyREjzGH28UGRq6JENXa28%3D" alt="PixPin_2025-11-20_20-38-26.png" loading="lazy"/></p>
<ul>
<li><strong>现象</strong>：ESLint执行失败，但终端只显示 <code>✖ pnpm eslint --quiet</code>，没有任何具体的错误信息</li>
<li><strong>背景</strong>：这次合并涉及1968个文件，其中1744个是TypeScript/JavaScript文件</li>
<li><strong>之前提示</strong>：合并前曾出现"git emit超过内存"的警告</li>
</ul>
<p>这种"静默失败"让问题排查变得异常困难，本文将详细分析这个问题的原因和解决方案。</p>
<h3 data-id="heading-2">原因分析</h3>
<h4 data-id="heading-3">1. 代码量爆炸性增长</h4>
<p>通过分析发现，这次合并的规模远超寻常：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看合并涉及的文件数量</span>
$ git diff --name-only HEAD~1 | <span class="hljs-built_in">wc</span> -l
1968

<span class="hljs-comment"># 其中TypeScript/JavaScript文件数量</span>
$ git diff --name-only HEAD~1 | grep -E <span class="hljs-string">'\.(ts|tsx|js|jsx)$'</span> | <span class="hljs-built_in">wc</span> -l
1744
</code></pre>
<p>eslint需要检测大量的文件，检测本身是没有问题的，只是检测完的结果展示被遮住了，展示不全。</p>
<h4 data-id="heading-4">2. 大型IDL文件的性能瓶颈</h4>
<p>进一步分析发现，存在大量大型自动生成的IDL文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看超过100KB的文件</span>
$ git diff --name-only HEAD~1 | xargs <span class="hljs-built_in">wc</span> -c 2&gt;/dev/null | awk <span class="hljs-string">'$1 &gt; 100000 {print $1/1024 "KB", $2}'</span> | <span class="hljs-built_in">wc</span> -l
26

<span class="hljs-comment"># 最大的文件达到1.2MB</span>
$ git diff --name-only HEAD~1 | xargs <span class="hljs-built_in">wc</span> -c 2&gt;/dev/null | <span class="hljs-built_in">sort</span> -n | <span class="hljs-built_in">tail</span> -5
1209435 apps/hub/src/idls/app_idl/namespaces/all_req_data.ts
1399027 pnpm-lock.yaml
14093097 total
</code></pre>
<h4 data-id="heading-5">3. ESLint处理机制的问题</h4>
<p>虽然这些IDL文件顶部都有 <code>/* eslint-disable */</code> 注释，但ESLint仍然需要：</p>
<ol>
<li><strong>解析每个文件</strong>来确定是否应用规则</li>
<li><strong>构建AST</strong>来理解文件结构</li>
<li><strong>处理大型文件</strong>（如770KB的IDL文件）</li>
</ol>
<p>单个大型IDL文件的处理时间测试：</p>
<pre><code class="hljs language-bash" lang="bash">$ time NODE_OPTIONS=<span class="hljs-string">"--max-old-space-size=16384"</span> emox eslint --quiet apps/creative-hub/src/idls/creation_bff/index.ts
<span class="hljs-comment"># 耗时5.66秒</span>
</code></pre>
<h4 data-id="heading-6">4. 内存压力</h4>
<p>当1744个文件同时处理时，Node.js默认的内存限制（约1.4GB）很容易被突破，导致进程崩溃或异常行为。</p>
<h3 data-id="heading-7">解决方案</h3>
<h4 data-id="heading-8">方案一：增加Node.js内存限制</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 临时解决方案</span>
<span class="hljs-built_in">export</span> NODE_OPTIONS=<span class="hljs-string">"--max-old-space-size=16384"</span>
emox eslint --quiet your-files

<span class="hljs-comment"># 或者永久设置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"export NODE_OPTIONS=\"--max-old-space-size=16384\""</span> &gt;&gt; ~/.zshrc
<span class="hljs-built_in">source</span> ~/.zshrc
</code></pre>
<h4 data-id="heading-9">方案二：使用ESLint缓存机制</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用缓存避免重复处理</span>
emox eslint --quiet --cache your-files
</code></pre>
<h4 data-id="heading-10">方案三：分批处理</h4>
<p>创建分批处理脚本，避免同时处理过多文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 分批处理文件，每批50个</span>
batch_size=50
files=$(git diff --name-only HEAD~1 | grep -E <span class="hljs-string">'\.(ts|tsx|js|jsx)$'</span> | grep -v idls)

<span class="hljs-comment"># 分批处理</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$files</span>"</span> | <span class="hljs-built_in">split</span> -l <span class="hljs-variable">$batch_size</span> - /tmp/eslint_batch_
<span class="hljs-keyword">for</span> batch_file <span class="hljs-keyword">in</span> /tmp/eslint_batch/batch_*; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"处理第 <span class="hljs-variable">$batch_num</span> 批文件..."</span>
    emox eslint --quiet --cache $(<span class="hljs-built_in">cat</span> <span class="hljs-variable">$batch_file</span>)
<span class="hljs-keyword">done</span>
</code></pre>
<h4 data-id="heading-11">方案四：排除IDL文件</h4>
<p>IDL文件通常是自动生成的，可以安全排除：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 排除IDL文件进行检查</span>
emox eslint --quiet $(git diff --name-only HEAD~1 | grep -E <span class="hljs-string">'\.(ts|tsx|js|jsx)$'</span> | grep -v idls)
</code></pre>
<h3 data-id="heading-12">最终解决步骤</h3>
<p>在尝试了增加node内存和eslint缓存发现无济于事。并且排除idl文件也有一定的安全隐患，虽然idl是自动生成的，但是如果不小心改动了也会引起编译不通过。最终为了快速提交代码，使用最简单粗暴的方法，分段提交。</p>
<h4 data-id="heading-13">1. 逐步添加文件到暂存区</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 分批添加文件，避免一次性处理过多</span>
git add apps/edit/src/ -A
git add apps/app-hub/src/ -A
<span class="hljs-comment"># ... 其他目录分批添加</span>
</code></pre>
<h4 data-id="heading-14">2. 执行lint-staged检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用pnpm执行lint-staged</span>
pnpm lint-staged
</code></pre>
<h4 data-id="heading-15">3. 处理具体报错</h4>
<p>根据lint-staged的输出，逐一解决具体的ESLint错误：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如果有错误，会显示具体的文件和行号</span>
<span class="hljs-comment"># 例如：</span>
<span class="hljs-comment"># apps/your-file.ts</span>
<span class="hljs-comment">#   45:10  error  Missing semicolon  @typescript-eslint/semi</span>

<span class="hljs-comment"># 修复后重新检查</span>
pnpm lint-staged
</code></pre>
<h4 data-id="heading-16">4. 继续合并流程</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 所有问题解决后，继续合并</span>
git merge --<span class="hljs-built_in">continue</span>
</code></pre>
<h3 data-id="heading-17">总结</h3>
<p>这次ESLint"静默失败"问题的根本原因是大型代码合并导致的内存和性能压力。在尝试了增加内存限制和缓存之后也无济于事，那么化繁为简，用最简单的逐步提交就行了。</p>
<p>希望这个经验能帮助你在未来的大型代码合并中避免类似问题。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[yalc,yyds!]]></title>    <link>https://juejin.cn/post/7574658078269620275</link>    <guid>https://juejin.cn/post/7574658078269620275</guid>    <pubDate>2025-11-20T12:54:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574658078269620275" data-draft-id="7574619023804268582" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="yalc,yyds!"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T12:54:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="来碗盐焗星球"/> <meta itemprop="url" content="https://juejin.cn/user/3316551988553709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            yalc,yyds!
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3316551988553709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    来碗盐焗星球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T12:54:41.000Z" title="Thu Nov 20 2025 12:54:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">npm link</h2>
<p>最近开发一个组件库假设叫<code>rn-skeleton</code>，想着组件库就该有组件库的样子，于是我想着找个宿主项目（假设叫<code>rn-app</code>）通过<code>npm link</code>的方式进行本地调试，谁知道拉了坨大的。。。</p>
<p>事情是这样的：众所周知，<code>npm link</code>的使用就很简单。在<code>rn-skelton</code>执行<code>npm link</code>，在宿主项目<code>rn-app</code>安装<code>npm link rn-skeleton</code>，到这里其实已经完事了，结果引入的时候，一直显示：<strong>找不到模块“rn-skeleton”或其相应的类型声明</strong>，更过分的是告诉我<code>rn-app</code>中找不到<code>react-native</code>....</p>
<p>于是我进行了好一会的问题解决，我寻思着<code>node_module</code>也是能看到<code>rn-skeleton</code>这个包的，怎么就找不到？
先解决<code>react-native</code>的依赖问题，我把<code>rn-skeleton</code>项目中<code>package.json</code>的<code>overrides</code>字段删除：</p>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-string">"overrides"</span>: {
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"18.3.1"</span>,
    <span class="hljs-string">"react-native"</span>: <span class="hljs-string">"0.77.2"</span>
  }
</code></pre>
<p>因为宿主项目也有这玩意，但是无济于事，尝试好几次，还是无用。于是尝试：</p>
<ul>
<li><code>npm install /Projects/drn-dialog --legacy-peer-deps</code></li>
<li><code>ln -s /Projects/rn-skeleton node_modules/rn-skeleton</code></li>
</ul>
<p>还是无济于事，于是放弃了，另辟蹊径去。结果发现：</p>
<pre><code class="hljs language-markdown" lang="markdown">在 React Native 项目中，npm link 和软连接（ln -s）一般无法用于组件库的本地调试，主要因为
Metro bundler（RN 打包器）默认不支持 symlink，所以常规的 npm link 方案不生效。
</code></pre>
<p><code>metro</code>React Native 使用的 Facebook打包器<code>不支持符号链接</code>，这严重阻碍了本地代码的共享。</p>
<h2 data-id="heading-1">wml</h2>
<p><code>WML</code>(<code>Webpack Module Linker</code>)是一款文件同步工具，基于watchman实现文件监听
用于自定义<code>metro</code>打包器配置的实用程序，以解决其不支持符号链接的问题。</p>
<p>该软件包的主要用途是支持使用<code>yarn link</code>或 开发 <code>React Native</code> 依赖项<code>npm link</code>。</p>
<pre><code class="hljs language-js" lang="js">npm install -g wml

<span class="hljs-comment">// 命令</span>
wml ls  <span class="hljs-comment">// 查看当前link</span>
wml add &lt;<span class="hljs-title class_">ProjectA</span> <span class="hljs-title class_">Name</span>&gt; &lt;ProjectA NameB&gt;/node_modules/&lt;ProjectA Package Name&gt;
wml rm &lt;LinkId&gt;
wml rm all
wml start // 启动生效
wml start --verbose
wml stop
</code></pre>
<ol>
<li><code>ProjectA Name</code>需要引入的包目录</li>
<li><code>ProjectB Name</code>需要引入包的宿主项目</li>
<li><code>ProjectA Package Name</code>是<code>ProjectA</code>的<code>package.json</code>中的<code>name</code></li>
</ol>
<p>优点：</p>
<ul>
<li>完全实时同步</li>
<li>轻量无配置：无需修改包的 <code>package.json</code>，仅需建立一次映射即可长期使用</li>
<li>支持任意文件同步：不限npm包</li>
<li>跨平台：支持mac/windows/linux，依赖watchman</li>
</ul>
<p>缺点：</p>
<ul>
<li>仅做文件同步，不处理包的依赖解析</li>
<li>依赖watchman</li>
<li/>
</ul>
<p>原以为简简单单，还自带<code>热更新</code>,没想到执行<code>wml start</code>一直卡着不动，也没日志输出，闹麻了，接着换～</p>
<h2 data-id="heading-2">yalc</h2>
<pre><code class="hljs language-js" lang="js">npm install -g yalc

yalc publish  <span class="hljs-comment">// 将本地包发布到yalc本地仓库</span>
yalc add &lt;<span class="hljs-title class_">Package</span> <span class="hljs-title class_">Name</span>&gt; <span class="hljs-comment">// 从yalc仓库引入包到当前项目</span>
yalc update &lt;<span class="hljs-title class_">Package</span> <span class="hljs-title class_">Name</span>&gt; <span class="hljs-comment">// 更新当前项目的本地包到最新版本</span>
yalc push <span class="hljs-comment">// 将本地包的修改同步到所有引入的项目（热更新）</span>
yalc remove &lt;<span class="hljs-title class_">Package</span> <span class="hljs-title class_">Name</span>&gt; <span class="hljs-comment">// 从当前项目删除yalc引入的包</span>
yalc clean <span class="hljs-comment">// 清空yalc本地仓库缓存</span>
</code></pre>
<p>执行<code>yalc</code>后可以看到项目中的<code>node_modules</code>出现该包，而且多了一个文件<code>yalc.lock</code>。
如果不是标准的<code>npm</code>包项目，可能还需修改一些内容：</p>
<h3 data-id="heading-3">ProjectA</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"rn-dialog"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/index.tsx"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 入口文件路径</span>
  <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/index.d.ts"</span> <span class="hljs-comment">// index.d.ts文件路径</span>
  <span class="hljs-comment">// ...</span>
 <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-4">ProjectB</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// tsconfig.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
       <span class="hljs-comment">// 手动映射模块路径，强化 TS 解析</span>
      <span class="hljs-attr">"rn-dialog"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"node_modules/rn-dialog/src/index.tsx"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>缺点：</p>
<ul>
<li>不支持热更新，需要手动执行<code>yalc update</code></li>
<li>会有新文件生成，记得添加到<code>.gitignore</code></li>
<li>主要针对npm 包</li>
</ul>
<p>优点：</p>
<ul>
<li>绕开<code>npm link</code>的<code>peerDependencies/overrides</code>校验冲突，因为<code>yalc</code>是模拟安装而不是软链</li>
<li>支持多项目同步</li>
<li>轻量无侵入</li>
</ul>
<p>至于<code>@carimus/metro-symlinked-deps</code>，略略略</p>
<p>我宣布，以后<code>yalc</code>是我的首选项～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter ：自己动手，封装一个小巧精致的气泡弹窗库]]></title>    <link>https://juejin.cn/post/7574621387574034478</link>    <guid>https://juejin.cn/post/7574621387574034478</guid>    <pubDate>2025-11-20T11:16:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574621387574034478" data-draft-id="7574619023804465190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter ：自己动手，封装一个小巧精致的气泡弹窗库"/> <meta itemprop="keywords" content="Flutter,GitHub,前端"/> <meta itemprop="datePublished" content="2025-11-20T11:16:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="rainboy"/> <meta itemprop="url" content="https://juejin.cn/user/3808364011199591"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter ：自己动手，封装一个小巧精致的气泡弹窗库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364011199591/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    rainboy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T11:16:28.000Z" title="Thu Nov 20 2025 11:16:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Flutter自带的<code>PopupMenuButton</code>组件提供了弹出菜单功能，但菜单样式简单，不方便定制，有时满足不了UI设计需求，于是就自己封装了一个功能丰富的带箭头的气泡弹窗库，支持多种定位方式，支持自定义弹窗样式。</p>
<p>GitHub地址:
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkongpf8848%2Fbubble_popup_window" target="_blank" title="https://github.com/kongpf8848/bubble_popup_window" ref="nofollow noopener noreferrer">github.com/kongpf8848/…</a></p>
<h3 data-id="heading-1">截图</h3>















<table><thead><tr><th align="center"/><th align="center"/><th align="center"/></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d0568cba5b44a30b4ff5ebe0d5d87ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764242553&amp;x-signature=3kJ5txJS0D4PntXGvCxbg85mLXI%3D" alt="screenshot_1.png" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8fe97bba2604979be874555aaad2800~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764242553&amp;x-signature=kb3GjrEQQ0tPaJqFD7awyyaQu74%3D" alt="screenshot_2.png" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa40154f24dd4379838d3fcd0c80aa06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764242553&amp;x-signature=eboAZINimXv2WPdSHx1YXSforaE%3D" alt="screenshot_3.png" loading="lazy"/></td></tr></tbody></table>
<h3 data-id="heading-2">功能特性</h3>
<ul>
<li>🎯 <strong>12种定位选项</strong>：支持上下左右各个方向及对齐方式的弹窗定位</li>
<li>🔄 <strong>智能调整位置</strong>：自动检测边界并调整弹窗位置确保完全可见</li>
<li>🎨 <strong>高度可定制</strong>：支持自定义弹窗背景、圆角、间距、箭头大小和颜色等</li>
<li>🎭 <strong>功能丰富</strong>：支持点击外部关闭弹窗、设置遮罩层颜色等功能</li>
</ul>
<h3 data-id="heading-3">安装</h3>
<p>在pubspec.yaml文件中添加依赖：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">bubble_popup_window:</span> <span class="hljs-string">^0.0.7</span>
</code></pre>
<h3 data-id="heading-4">使用</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:bubble_popup_window/bubble_popup_window.dart'</span>;

GlobalKey key = GlobalKey();

ElevatedButton(
  key: key,
  onPressed: () {
    _showToolTip(key.currentContext!);
  },
  child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">"Tooltip"</span>),
)

<span class="hljs-keyword">void</span> _showToolTip(BuildContext anchorContext) {
  BubblePopupWindow.<span class="hljs-keyword">show</span>(
    <span class="hljs-comment">//锚点上下文</span>
    anchorContext: anchorContext,
    <span class="hljs-comment">//弹窗布局，用户自定义</span>
    child: <span class="hljs-keyword">const</span> Text(
      <span class="hljs-string">'这是一个气泡弹窗'</span>,
      style: TextStyle(
        color: Colors.black,
        fontSize: <span class="hljs-number">14</span>,
        fontWeight: FontWeight.normal,
      ),
    ),
    <span class="hljs-comment">//弹窗方向</span>
    direction: BubbleDirection.bottomCenter,
    <span class="hljs-comment">//弹窗颜色</span>
    color: Colors.white,
    <span class="hljs-comment">//弹窗圆角半径</span>
    radius: BorderRadius.circular(<span class="hljs-number">8</span>),
    <span class="hljs-comment">//弹窗边框</span>
    border: <span class="hljs-keyword">const</span> BorderSide(
      color: Colors.red,
      width: <span class="hljs-number">2</span>,
    ),
    <span class="hljs-comment">//弹窗内边距</span>
    padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16</span>),
    <span class="hljs-comment">//弹窗距离锚点间距</span>
    gap: <span class="hljs-number">4.0</span>,
    <span class="hljs-comment">//弹窗距离屏幕边缘最小间距</span>
    miniEdgeMargin: <span class="hljs-keyword">const</span> EdgeInsets.only(left: <span class="hljs-number">10</span>, right: <span class="hljs-number">10</span>),
    <span class="hljs-comment">//遮罩层颜色</span>
    maskColor: <span class="hljs-keyword">null</span>,
    <span class="hljs-comment">//点击弹窗外部时是否自动关闭弹窗</span>
    dismissOnTouchOutside: <span class="hljs-keyword">true</span>,
    <span class="hljs-comment">//是否显示箭头</span>
    showArrow: <span class="hljs-keyword">true</span>,
    <span class="hljs-comment">//箭头宽度</span>
    arrowWidth: <span class="hljs-number">12.0</span>,
    <span class="hljs-comment">//箭头高度</span>
    arrowHeight: <span class="hljs-number">6.0</span>,
    <span class="hljs-comment">//箭头半径</span>
    arrowRadius: <span class="hljs-number">2.0</span>,
  );
}

</code></pre>
<p>anchorContext 用于确定锚点的位置和尺寸，可通过以下方式获取：</p>
<ul>
<li>
<p>‌使用<code>GlobalKey</code></p>
<p>为组件设置<code>GlobalKey</code>后，通过key.currentContext!获取上下文</p>
<pre><code class="hljs language-dart" lang="dart">GlobalKey key = GlobalKey();
ElevatedButton(
  key: key,
)

<span class="hljs-comment">//获取上下文</span>
BuildContext anchorContext = key.currentContext!;
</code></pre>
</li>
<li>
<p>使用<code>Builder</code>组件</p>
<p>通过<code>Builder</code>组件的回调函数直接获取anchorContext</p>
<pre><code class="hljs language-dart" lang="dart">Builder(
  builder: (BuildContext anchorContext) {
    <span class="hljs-comment">//在此使用anchorContext</span>
    <span class="hljs-keyword">return</span> Container();
  }
)
</code></pre>
</li>
</ul>
<h3 data-id="heading-5">参数说明</h3>











































































































<table><thead><tr><th align="left">参数名</th><th align="left">类型</th><th align="left">默认值</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>anchorContext</code></td><td align="left"><code>BuildContext</code></td><td align="left">无</td><td align="left">锚点上下文</td></tr><tr><td align="left"><code>child</code></td><td align="left"><code>Widget</code></td><td align="left">无</td><td align="left">弹窗内容，用户自定义</td></tr><tr><td align="left"><code>direction</code></td><td align="left"><code>BubbleDirection</code></td><td align="left"><code>BubbleDirection.bottomCenter</code></td><td align="left">弹窗方向</td></tr><tr><td align="left"><code>color</code></td><td align="left"><code>Color</code></td><td align="left"><code>Colors.white</code></td><td align="left">弹窗颜色</td></tr><tr><td align="left"><code>radius</code></td><td align="left"><code>BorderRadius</code></td><td align="left"><code>BorderRadius.zero</code></td><td align="left">弹窗圆角半径</td></tr><tr><td align="left"><code>border</code></td><td align="left"><code>BorderSide</code></td><td align="left"><code>BorderSide.none</code></td><td align="left">弹窗边框</td></tr><tr><td align="left"><code>shadows</code></td><td align="left"><code>List&lt;BoxShadow&gt;?</code></td><td align="left">无</td><td align="left">弹窗阴影</td></tr><tr><td align="left"><code>padding</code></td><td align="left"><code>EdgeInsetsGeometry?</code></td><td align="left">无</td><td align="left">弹窗内边距</td></tr><tr><td align="left"><code>gap</code></td><td align="left"><code>double</code></td><td align="left"><code>0.0</code></td><td align="left">弹窗距离锚点的间距</td></tr><tr><td align="left"><code>maskColor</code></td><td align="left"><code>Color?</code></td><td align="left"><code>null</code></td><td align="left">遮罩层颜色</td></tr><tr><td align="left"><code>dismissOnTouchOutside</code></td><td align="left"><code>bool</code></td><td align="left"><code>true</code></td><td align="left">点击弹窗外部是否关闭弹窗</td></tr><tr><td align="left"><code>miniEdgeMargin</code></td><td align="left"><code>EdgeInsets</code></td><td align="left"><code>EdgeInsets.zero</code></td><td align="left">弹窗距离屏幕边缘最小间距</td></tr><tr><td align="left"><code>showArrow</code></td><td align="left"><code>bool</code></td><td align="left"><code>true</code></td><td align="left">是否显示箭头</td></tr><tr><td align="left"><code>arrowWidth</code></td><td align="left"><code>Double</code></td><td align="left"><code>10.0</code></td><td align="left">箭头宽度</td></tr><tr><td align="left"><code>arrowHeight</code></td><td align="left"><code>Double</code></td><td align="left"><code>5.0</code></td><td align="left">箭头高度</td></tr><tr><td align="left"><code>arrowRadius</code></td><td align="left"><code>Double</code></td><td align="left"><code>0.0</code></td><td align="left">箭头半径</td></tr></tbody></table>
<h3 data-id="heading-6">实现思路</h3>
<ul>
<li>通过自定义<code>ShapeBorder</code>，实现带箭头的形状，同时支持圆角、边框功能，是系统自带<code> RoundedRectangleBorder</code>的加强版本</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// src/bubble_shape_border.dart</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BubbleShapeBorder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OutlinedBorder</span> </span>{
  <span class="hljs-keyword">final</span> BorderRadius borderRadius;
  <span class="hljs-keyword">final</span> ArrowDirection arrowDirection;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> arrowWidth;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> arrowHeight;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> arrowRadius;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double?</span> arrowOffset;

  <span class="hljs-keyword">const</span> BubbleShapeBorder({
    <span class="hljs-keyword">super</span>.side,
    <span class="hljs-keyword">this</span>.borderRadius = BorderRadius.zero,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.arrowDirection,
    <span class="hljs-keyword">this</span>.arrowWidth = <span class="hljs-number">10.0</span>,
    <span class="hljs-keyword">this</span>.arrowHeight = <span class="hljs-number">5.0</span>,
    <span class="hljs-keyword">this</span>.arrowRadius = <span class="hljs-number">0.0</span>,
    <span class="hljs-keyword">this</span>.arrowOffset,
  });

  _BubbleBorderArrowProperties _calculateArrowProperties() {
    <span class="hljs-keyword">final</span> arrowHalfWidth = arrowWidth / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> hypotenuse =
        math.sqrt(arrowHeight * arrowHeight + arrowHalfWidth * arrowHalfWidth);
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> projectionOnMain = arrowHalfWidth * arrowRadius / hypotenuse;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> projectionOnCross =
        projectionOnMain * arrowHeight / arrowHalfWidth;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> arrowProjectionOnMain = arrowHeight * arrowRadius / hypotenuse;
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> pointArrowTopLen =
        arrowProjectionOnMain * arrowHeight / arrowHalfWidth;
    <span class="hljs-keyword">return</span> _BubbleBorderArrowProperties(
      halfWidth: arrowHalfWidth,
      hypotenuse: hypotenuse,
      projectionOnMain: projectionOnMain,
      projectionOnCross: projectionOnCross,
      arrowProjectionOnMain: arrowProjectionOnMain,
      topLen: pointArrowTopLen,
    );
  }

  <span class="hljs-meta">@override</span>
  Path getInnerPath(Rect rect, {TextDirection? textDirection}) {
    <span class="hljs-keyword">return</span> _buildPath(rect.deflate(side.strokeInset), <span class="hljs-keyword">true</span>);
  }

  <span class="hljs-meta">@override</span>
  Path getOuterPath(Rect rect, {TextDirection? textDirection}) {
    <span class="hljs-keyword">return</span> _buildPath(rect.inflate(side.strokeOutset), <span class="hljs-keyword">false</span>);
  }

  Rect _getRoundedRect(Rect rect) {
    EdgeInsets padding = EdgeInsets.zero;
    <span class="hljs-keyword">if</span> (arrowDirection == ArrowDirection.top) {
      padding = EdgeInsets.only(top: arrowHeight);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arrowDirection == ArrowDirection.right) {
      padding = EdgeInsets.only(right: arrowHeight);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arrowDirection == ArrowDirection.bottom) {
      padding = EdgeInsets.only(bottom: arrowHeight);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arrowDirection == ArrowDirection.left) {
      padding = EdgeInsets.only(left: arrowHeight);
    }
    <span class="hljs-keyword">return</span> Rect.fromLTRB(
      rect.left + padding.left,
      rect.top + padding.top,
      rect.right - padding.right,
      rect.bottom - padding.bottom,
    );
  }

  <span class="hljs-comment">//计算方向为：上、右、下、左</span>
  Path _buildPath(Rect rect, <span class="hljs-built_in">bool</span> isInner) {
    <span class="hljs-keyword">final</span> path = Path();
    <span class="hljs-keyword">final</span> nRect = _getRoundedRect(rect);
    <span class="hljs-keyword">final</span> sideOffset = isInner ? -side.strokeInset : side.strokeOutset;

    <span class="hljs-keyword">final</span> arrowProp = _calculateArrowProperties();

    path.moveTo(nRect.left + borderRadius.topLeft.x, nRect.top);

    <span class="hljs-comment">//top arrow</span>
    <span class="hljs-keyword">if</span> (arrowDirection == ArrowDirection.top) {
      Offset pointCenter = Offset(
          nRect.left + (arrowOffset ?? nRect.width / <span class="hljs-number">2</span>) + sideOffset,
          nRect.top);
      Offset pointStart =
          Offset(pointCenter.dx - arrowProp.halfWidth, nRect.top);
      Offset pointArrow = Offset(pointCenter.dx, rect.top);
      Offset pointEnd = Offset(pointCenter.dx + arrowProp.halfWidth, nRect.top);

      Offset pointStartArcBegin =
          Offset(pointStart.dx - arrowRadius, pointStart.dy);
      Offset pointStartArcEnd = Offset(
          pointStart.dx + arrowProp.projectionOnMain,
          pointStart.dy - arrowProp.projectionOnCross);
      path.lineTo(pointStartArcBegin.dx, pointStartArcBegin.dy);
      path.quadraticBezierTo(pointStart.dx, pointStart.dy, pointStartArcEnd.dx,
          pointStartArcEnd.dy);

      Offset pointArrowArcBegin = Offset(
          pointArrow.dx - arrowProp.arrowProjectionOnMain,
          pointArrow.dy + arrowProp.topLen);
      Offset pointArrowArcEnd = Offset(
          pointArrow.dx + arrowProp.arrowProjectionOnMain,
          pointArrow.dy + arrowProp.topLen);
      path.lineTo(pointArrowArcBegin.dx, pointArrowArcBegin.dy);
      path.quadraticBezierTo(pointArrow.dx, pointArrow.dy, pointArrowArcEnd.dx,
          pointArrowArcEnd.dy);

      Offset pointEndArcBegin = Offset(pointEnd.dx - arrowProp.projectionOnMain,
          pointEnd.dy - arrowProp.projectionOnCross);
      Offset pointEndArcEnd = Offset(pointEnd.dx + arrowRadius, pointEnd.dy);
      path.lineTo(pointEndArcBegin.dx, pointEndArcBegin.dy);
      path.quadraticBezierTo(
          pointEnd.dx, pointEnd.dy, pointEndArcEnd.dx, pointEndArcEnd.dy);
    }

    path.lineTo(nRect.right - borderRadius.topRight.x, nRect.top);

    <span class="hljs-comment">//topRight radius</span>
    path.arcToPoint(
      Offset(nRect.right, nRect.top + borderRadius.topRight.y),
      radius: borderRadius.topRight,
      rotation: <span class="hljs-number">90</span>,
    );

    <span class="hljs-comment">//right arrow</span>
    <span class="hljs-keyword">if</span> (arrowDirection == ArrowDirection.right) {
      ......
    }

    path.lineTo(nRect.right, nRect.bottom - borderRadius.bottomRight.y);

    <span class="hljs-comment">//bottomRight radius</span>
    path.arcToPoint(
      Offset(nRect.right - borderRadius.bottomRight.x, nRect.bottom),
      radius: borderRadius.bottomRight,
      rotation: <span class="hljs-number">90</span>,
    );

    <span class="hljs-comment">//bottom arrow</span>
    <span class="hljs-keyword">if</span> (arrowDirection == ArrowDirection.bottom) {
      ......
    }

    path.lineTo(nRect.left + borderRadius.bottomLeft.x, nRect.bottom);

    <span class="hljs-comment">//bottomLeft radius</span>
    path.arcToPoint(
      Offset(nRect.left, nRect.bottom - borderRadius.bottomLeft.y),
      radius: borderRadius.bottomLeft,
      rotation: <span class="hljs-number">90</span>,
    );

    <span class="hljs-comment">//left arrow</span>
    <span class="hljs-keyword">if</span> (arrowDirection == ArrowDirection.left) {
      ......
    }

    path.lineTo(nRect.left, nRect.top + borderRadius.topLeft.y);

    <span class="hljs-comment">//topLeft radius</span>
    path.arcToPoint(
      Offset(nRect.left + borderRadius.topLeft.x, nRect.top),
      radius: borderRadius.topLeft,
      rotation: <span class="hljs-number">90</span>,
    );

    <span class="hljs-keyword">return</span> path;
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> paint(Canvas canvas, Rect rect, {TextDirection? textDirection}) {
    <span class="hljs-comment">//绘制边框</span>
    <span class="hljs-keyword">switch</span> (side.style) {
      <span class="hljs-keyword">case</span> BorderStyle.none:
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> BorderStyle.solid:
        <span class="hljs-keyword">if</span> (side.width &gt; <span class="hljs-number">0.0</span>) {
          <span class="hljs-keyword">var</span> outerPath = getOuterPath(rect);
          <span class="hljs-keyword">var</span> innerPath = getInnerPath(rect);
          Path path =
              Path.combine(PathOperation.difference, outerPath, innerPath);
          path.fillType = PathFillType.evenOdd;
          <span class="hljs-keyword">final</span> Paint paint = Paint()
            ..color = side.color
            ..style = PaintingStyle.fill;
          canvas.drawPath(path, paint);
        }
    }
  }
}
</code></pre>
<ul>
<li>
<p>封装一个气泡框组件<code>BubbleContainer</code>，支持箭头方向、大小等属性。</p>
<p>通过组合<code>Container</code>和<code>ShapeDecoration</code>，实现以下功能：</p>
<ul>
<li>根据是否显示箭头及箭头方向，自动调整容器内边距；</li>
<li>使用自定义的<code>BubbleShapeBorder</code>实现带箭头的气泡形状；</li>
<li>支持<code>Container</code>常规装饰属性如颜色、阴影、边距等。</li>
</ul>
</li>
</ul>
<p>实现效果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd3c7d5294f54f098ac9e31885566d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmFpbmJveQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764242553&amp;x-signature=0qyusdWIVLAjow6ho22A%2BmrRGaI%3D" alt="bubble_container.png" loading="lazy"/></p>
<ul>
<li>使用<code>PopupRoute</code>管理弹窗的生命周期和动画效果</li>
<li>计算锚点位置的位置和尺寸，计算边界矩形信息</li>
<li>计算弹窗位置，检测弹窗是否会超出屏幕边界，自动调整方向</li>
<li>计算箭头偏移量，确保箭头始终和锚点居中对齐</li>
<li>创建<code>BubbleContainer</code>组件，使用<code>Stack</code>布局对其进行定位</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[动态拼接SQL实践备忘📝]]></title>    <link>https://juejin.cn/post/7574615024293593114</link>    <guid>https://juejin.cn/post/7574615024293593114</guid>    <pubDate>2025-11-20T11:19:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574615024293593114" data-draft-id="7574244766423941129" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="动态拼接SQL实践备忘📝"/> <meta itemprop="keywords" content="Java,MyBatis,SQL"/> <meta itemprop="datePublished" content="2025-11-20T11:19:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="颜如玉"/> <meta itemprop="url" content="https://juejin.cn/user/3685218708622535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            动态拼接SQL实践备忘📝
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3685218708622535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    颜如玉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T11:19:30.000Z" title="Thu Nov 20 2025 11:19:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="vs">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.hljs-comment,.hljs-quote,.hljs-variable{color:green}.hljs-built_in,.hljs-keyword,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#00f}.hljs-addition,.hljs-attribute,.hljs-literal,.hljs-section,.hljs-string,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type{color:#a31515}.hljs-deletion,.hljs-meta,.hljs-selector-attr,.hljs-selector-pseudo{color:#2b91af}.hljs-doctag{color:grey}.hljs-attr{color:red}.hljs-bullet,.hljs-link,.hljs-symbol{color:#00b0e8}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>注:</p>
<ul>
<li>本文无源码分析</li>
<li>单纯记录@SelectProvider实践，年纪大了(无奈的笑)，备忘一下📝</li>
<li>演示的都是最简单的场景最简单的代码，无法代表业务的复杂性</li>
</ul>
</blockquote>
<h2 data-id="heading-0">背景介绍</h2>
<p>最近工作接到一个荒诞的任务，实际情况比较复杂，总结一下有以下特点</p>
<ul>
<li>返回的字段如幽灵般游移不定</li>
<li>目标表仿佛在迷雾中随每次请求变化</li>
<li>过滤条件无规则无限制任意搭配</li>
</ul>
<p>Mybatis的XML模板沉默以对，Mybatis-Plus的Wrapper亦束手无策。这让我想起 Navicat 的“筛选”功能，感觉两者有些相似，只不过Navicat场景更加简单一些。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d964efb427543c7902155d215a350d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aKc5aaC546J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764242370&amp;x-signature=9cYcBgheE4l2ZdflSz1vu%2F%2BLBnQ%3D" alt="image.png" loading="lazy"/>
于是，在荒诞的尽头，笔者做出了一个近乎宿命的选择：亲手拼接SQL——不是出于信念，而是因为别无选择。在这片逻辑崩塌的废墟上，唯有将字符串缝合成一句句临时的祷词，交付给数据库那沉默而全能的神谕。一旦接受了这种徒劳的合理性，道路便在虚无中浮现。</p>
<h2 data-id="heading-1">JdbcTemplate</h2>
<p>那是来自Spring最原始的呼唤，一种近乎本能的回归。在框架层层叠叠的抽象迷宫中迷失之后，我听见了它低沉而直接的声音：没有装饰，没有隐喻，只有<code>queryForMap</code>与<code>queryForList</code>赤裸裸地横亘于代码之中。我们熟悉它，正如熟悉自己的双手。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcTemplate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JdbcAccessor</span>
    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">JdbcOperations</span> {
    
    <span class="hljs-comment">/* 获取单条记录 */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">queryForMap</span><span class="hljs-params">(String sql)</span>
        <span class="hljs-keyword">throws</span> DataAccessException {
        <span class="hljs-keyword">return</span> result(queryForObject(sql, getColumnMapRowMapper()));
    }
    
    <span class="hljs-comment">/* 获取多条记录 */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">queryForList</span><span class="hljs-params">(String sql)</span> 
        <span class="hljs-keyword">throws</span> DataAccessException {
        <span class="hljs-keyword">return</span> query(sql, getColumnMapRowMapper());
    }

}
</code></pre>
<p>然而这朴素之中藏着代价。它不够优雅，更谈不上智能。而当多数据源的阴影悄然降临，它便显露出更深的无力：每一次切换，都像在荒原上重新挖一口井，徒增重复、耦合与混乱。于是，这份最初的慰藉，终究在现实的重压下显出裂痕——它能承载希望，却无法驯服复杂。</p>
<h2 data-id="heading-2">@SelectProvider</h2>
<p>后来，我遇见了 <code>SelectProvider</code>——它披着优雅的外衣，携带着一种近乎诗意的承诺。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Repeatable(SelectProvider.List.class)</span>
<span class="hljs-comment">/* 该注解允许定制多种选项，平常使用这两个即可 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> SelectProvider {

    <span class="hljs-comment">/* 填写生产SQL语句的类 */</span>
    Class&lt;?&gt; type() <span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span>.class;
    
    <span class="hljs-comment">/* 填写生产SQL语句的方法名 */</span>
    String <span class="hljs-title function_">method</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;

}
</code></pre>
<p>只需在方法上轻轻标注，指明谁将为SQL赋形、何处孕育语句，MyBatis 便会如虔诚的信使，自动召唤那段动态生成的咒语，并将其送入数据库的圣殿。代码简洁，结构清晰，仿佛终于在这查询迷局中，找到了一丝理性的秩序。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> Raphael
 * <span class="hljs-doctag">@since</span> 2025-11-19 15:21
 */</span>
<span class="hljs-meta">@DS("report")</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TestMapper</span> {

    <span class="hljs-meta">@SelectProvider(type = SqlProvider.class, method = "findById")</span>
    Map&lt;String, Object&gt; <span class="hljs-title function_">findById</span><span class="hljs-params">(String tbl, String id)</span>;
  
    <span class="hljs-comment">/* SQL语句提供类 */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlProvider</span> {

        <span class="hljs-comment">/* 提供语句的方法 */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">findById</span><span class="hljs-params">(String tbl, String id)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"select * from "</span> + tbl + <span class="hljs-string">" where id = "</span> + id;
        }
        
    }
    
}
</code></pre>
<p>然而，这优雅之下潜伏着古老的危险：若对输入不加审视，任其流入拼接的缝隙，SQL 注入便如幽灵般悄然附体——一句恶意的字符串，足以撕裂整个系统的防线。因此，我不得不低声警告：凡使用此道者，必先以转义为盾，以校验为矛，方可在自由与安全之间行走。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> Raphael
 * <span class="hljs-doctag">@since</span> 2025-11-19 15:21
 */</span>
<span class="hljs-meta">@DS("report")</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TestMapper</span> {

    <span class="hljs-meta">@SelectProvider(type = SqlProvider.class, method = "getById")</span>
    Map&lt;String, Object&gt; <span class="hljs-title function_">getById</span><span class="hljs-params">(String tbl, String id)</span>;
  
    <span class="hljs-comment">/* SQL语句提供类 */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlProvider</span> {

        <span class="hljs-comment">/* 提供语句的方法 */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@Param("tbl")</span>String tbl, <span class="hljs-meta">@Param("id")</span> String id)</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SQL</span>()
                .SELECT(<span class="hljs-string">"*"</span>)
                .FROM(<span class="hljs-string">"tbl = #{tbl}"</span>)
                .WHERE(<span class="hljs-string">"id = #{id}"</span>)
                .toString();
        }
        
    }
    
}
</code></pre>
<p>更令人踟蹰的是性能之问。有人提议缓存生成的 SQL，以避重复构造之耗。可这念头本身便陷入悖论：若 SQL 真能被缓存，那意味着其形式已然趋于稳定；</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SQL</span> <span class="hljs-operator">=</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">SQL</span>()
        .SELECT(<span class="hljs-string">"*"</span>)
        .FROM(<span class="hljs-string">"#{tbl}"</span>)
        .WHERE(<span class="hljs-string">"id = #{id}"</span>)
        .toString();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@Param("tbl")</span>String tbl, <span class="hljs-meta">@Param("id")</span> String id)</span> {
    <span class="hljs-keyword">return</span> SQL;
}
</code></pre>
<p>而若形式稳定，又何须动用<code>SelectProvider</code>这般为混沌而生的机制？这就像试图为风塑形，再宣称它的轮廓可以复用。</p>
<h2 data-id="heading-3">总结</h2>
<p>回望整个探索过程，从 JdbcTemplate 的直白拼接到 SelectProvider 的动态封装，每一种方案都像是在不确定性的迷宫中点亮一盏临时的灯——足够照亮脚下的路，却照不透整座建筑的结构。<br/>
工具没有对错，只有适配与否；而所谓“优雅”或“原始”，往往只是我们面对复杂时情绪的投射。真正关键的，是在开放性与安全性、灵活性与性能之间，做出清醒的权衡，并为自己的选择负责。<br/>
最终，代码不只是逻辑的堆砌，更是判断的痕迹。我选择接受它的不完美，并用克制的拼接、谨慎的校验和明确的边界，为系统保留最后一道理性的防线。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Qt 优雅实现线程安全单例模式（模板化 + 自动清理）]]></title>    <link>https://juejin.cn/post/7574608278422667300</link>    <guid>https://juejin.cn/post/7574608278422667300</guid>    <pubDate>2025-11-20T11:39:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574608278422667300" data-draft-id="7574608278422650916" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Qt 优雅实现线程安全单例模式（模板化 + 自动清理）"/> <meta itemprop="keywords" content="后端,C++,Qt"/> <meta itemprop="datePublished" content="2025-11-20T11:39:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Qt 优雅实现线程安全单例模式（模板化 + 自动清理）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T11:39:43.000Z" title="Thu Nov 20 2025 11:39:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Qt 优雅实现线程安全单例模式（模板化 + 自动清理）</h2>
<p>在 Qt 开发中，单例模式是高频使用的设计模式，用于全局共享一个实例（如配置管理、网络服务、日志系统等）。一个健壮的 Qt 单例需要满足 <strong>线程安全、自动清理、通用性强、支持任意构造参数</strong> 等核心需求。本文将基于模板封装 + 管理器的设计思路，实现一套可直接复用的单例框架，并详细讲解其设计原理与最佳实践。</p>
<h3 data-id="heading-1">一、单例模式的核心诉求</h3>
<p>在 Qt 环境中，单例的设计需要解决以下关键问题：</p>
<ol>
<li><strong>线程安全：</strong> 多线程并发调用时避免创建多个实例；</li>
<li><strong>自动清理：</strong> 程序退出时自动释放资源，避免内存泄漏（尤其配合 Qt 的 QCoreApplication::aboutToQuit 机制）；</li>
<li><strong>通用性：</strong> 支持任意类作为单例，无需重复编写单例逻辑；</li>
<li><strong>灵活构造：</strong> 支持带参数的构造函数，且不丢失参数语义；</li>
<li><strong>安全校验：</strong> 避免未初始化就调用实例的错误；</li>
<li><strong>可手动控制：</strong> 支持主动初始化 / 销毁单例。</li>
</ol>
<p>本文实现的单例框架完全满足以上需求，且兼容 Qt 控制台程序、桌面程序等所有场景。</p>
<h3 data-id="heading-2">二、实现架构设计</h3>
<p>整体架构分为两层：</p>
<ol>
<li><strong>Singleton 模板类：</strong> 负责单例的实例创建、线程安全保护、初始化 / 销毁逻辑，通过模板实现通用性；</li>
<li><strong>SingletonManager 单例管理器：</strong> 负责注册所有单例的清理回调，程序退出时统一执行销毁，避免内存泄漏。</li>
</ol>
<p>核心设计思路：</p>
<ul>
<li>模板化封装单例逻辑，避免重复编码；</li>
<li>用 <code>QMutex</code> 保证多线程下的实例创建 / 访问安全；</li>
<li>完美转发（<code>std::forward</code>）支持任意构造参数；</li>
<li>清理回调注册到管理器，利用 Qt 的 <code>aboutToQuit</code> 统一触发；</li>
<li>断言（<code>Q_ASSERT</code>）+ 宏定义简化使用，同时提供安全校验。</li>
</ul>
<h3 data-id="heading-3">三、完整代码详解</h3>
<h4 data-id="heading-4">3.1 单例管理器：<code>SingletonManager.h</code></h4>
<p>管理器的核心作用是「集中管理所有单例的清理逻辑」，避免每个单例单独处理销毁，确保退出时资源释放的一致性。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SINGLETONMANAGER_H</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SINGLETONMANAGER_H</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QMutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;map&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QObject&gt;</span> <span class="hljs-comment">// 确保 Q_DISABLE_COPY_MOVE 可用</span></span>

<span class="hljs-comment">// 单例管理器：统一注册/注销/执行单例清理回调</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonManager</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 管理器自身是单例（懒加载，线程安全）</span>
    <span class="hljs-function"><span class="hljs-type">static</span> SingletonManager &amp;<span class="hljs-title">instance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> SingletonManager inst; <span class="hljs-comment">// C++11 后静态局部变量初始化线程安全</span>
        <span class="hljs-keyword">return</span> inst;
    }

    <span class="hljs-comment">/**
     * @brief 注册单例清理回调
     * @param fn 清理函数（通常是删除单例实例的 lambda）
     * @return 注册 ID（用于后续注销），ID &gt; 0
     */</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">registerCleanup</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; fn)</span> </span>{
        <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;m_mutex)</span></span>; <span class="hljs-comment">// 加锁保证线程安全</span>
        <span class="hljs-type">int</span> id = m_nextId++;
        m_funcs.<span class="hljs-built_in">emplace</span>(id, std::<span class="hljs-built_in">move</span>(fn)); <span class="hljs-comment">// 转移函数所有权，避免拷贝开销</span>
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-comment">/**
     * @brief 注销清理回调（支持重复调用，安全可重入）
     * @param id 注册时返回的 ID
     */</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unregisterCleanup</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">int</span> id)</span> </span>{
        <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;m_mutex)</span></span>;
        m_funcs.<span class="hljs-built_in">erase</span>(id); <span class="hljs-comment">// 不存在的 ID 无副作用</span>
    }

    <span class="hljs-comment">/**
     * @brief 执行所有注册的清理回调（程序退出时调用）
     * 特点：拷贝回调列表后再执行，避免回调中操作管理器导致死锁
     */</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cleanupAll</span><span class="hljs-params">()</span> </span>{
        std::map&lt;<span class="hljs-type">int</span>, std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; copyFuncs;
        {
            <span class="hljs-comment">// 局部作用域：释放锁后再执行回调，提高并发效率</span>
            <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;m_mutex)</span></span>;
            copyFuncs = m_funcs; <span class="hljs-comment">// 拷贝回调列表</span>
            m_funcs.<span class="hljs-built_in">clear</span>();     <span class="hljs-comment">// 清空原列表，避免重复执行</span>
        }

        <span class="hljs-comment">// 按注册顺序执行回调（map 是有序容器，key 递增）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;[id, func] : copyFuncs) {
            <span class="hljs-keyword">if</span> (func) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-built_in">func</span>(); <span class="hljs-comment">// 执行清理逻辑</span>
                } <span class="hljs-built_in">catch</span> (...) {
                    <span class="hljs-comment">// 捕获所有异常，避免单个单例清理失败影响其他</span>
                    <span class="hljs-built_in">qWarning</span>() &lt;&lt; <span class="hljs-string">"[SingletonManager] Cleanup failed for id:"</span> &lt;&lt; id;
                }
            }
        }
    }

<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// 私有构造/析构：禁止外部创建实例</span>
    <span class="hljs-built_in">SingletonManager</span>() = <span class="hljs-keyword">default</span>;
    ~<span class="hljs-built_in">SingletonManager</span>() = <span class="hljs-keyword">default</span>;

    <span class="hljs-comment">// 禁用拷贝/移动：确保管理器全局唯一</span>
    <span class="hljs-built_in">Q_DISABLE_COPY_MOVE</span>(SingletonManager)

    QMutex m_mutex;                          <span class="hljs-comment">// 保护回调列表的线程安全</span>
    std::map&lt;<span class="hljs-type">int</span>, std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; m_funcs; <span class="hljs-comment">// 存储清理回调（有序）</span>
    <span class="hljs-type">int</span> m_nextId{<span class="hljs-number">1</span>};                         <span class="hljs-comment">// 回调注册 ID 生成器（从 1 开始，0 为无效 ID）</span>
};

<span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// SINGLETONMANAGER_H</span></span>
</code></pre>
<p><strong>设计亮点：</strong></p>
<ul>
<li><strong>自身是单例：</strong> 静态局部变量初始化（C++11 线程安全），无需额外加锁；</li>
<li><strong>线程安全：</strong> 所有对回调列表的操作都通过 <code>QMutex</code> 保护；</li>
<li><strong>安全清理：</strong> 拷贝回调列表后释放锁，避免回调中调用 <code>unregisterCleanup</code> 导致死锁；</li>
<li><strong>异常隔离：</strong> 单个单例清理失败不影响其他，提高程序稳定性；</li>
<li><strong>有序执行：</strong> <code>std::map</code> 保证清理顺序与注册顺序一致，解决单例依赖问题。</li>
</ul>
<h4 data-id="heading-5">3.2 单例模板类：<code>Singleton.h</code></h4>
<p>模板类是单例框架的核心，通过泛型封装通用逻辑，支持任意类作为单例，无需修改目标类代码。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SINGLETON_H</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SINGLETON_H</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QMutexLocker&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QCoreApplication&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QDebug&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;type_traits&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;utility&gt;</span> <span class="hljs-comment">// 用于 std::forward</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"SingletonManager.h"</span></span>

<span class="hljs-comment">// 静态断言：确保 T 是可构造的（避免抽象类作为单例）</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">constexpr</span> <span class="hljs-type">bool</span> is_singleton_valid_v = std::is_constructible_v&lt;T&gt; &amp;&amp; !std::is_abstract_v&lt;T&gt;;

<span class="hljs-comment">// 单例模板类：支持带参数构造、自动注册清理、线程安全访问</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-comment">// 编译期校验：若 T 不可构造或为抽象类，直接报错</span>
    <span class="hljs-built_in">static_assert</span>(is_singleton_valid_v&lt;T&gt;, 
                  <span class="hljs-string">"Singleton&lt;T&gt; requires T to be constructible and non-abstract"</span>);

<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">/**
     * @brief 初始化单例（必须在调用 instance() 前执行）
     * @tparam Args 构造函数参数类型
     * @param args 构造函数参数（完美转发，支持左值/右值）
     * 特点：自动注册清理回调到 SingletonManager，支持重复调用（仅首次有效）
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">init</span><span class="hljs-params">(Args &amp;&amp;... args)</span> </span>{
        <span class="hljs-function">QMutexLocker <span class="hljs-title">lockerInit</span><span class="hljs-params">(&amp;mutex())</span></span>; <span class="hljs-comment">// 加锁保证初始化线程安全</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">instanceRef</span>() != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-built_in">qWarning</span>() &lt;&lt; <span class="hljs-string">"[Singleton] "</span> &lt;&lt; <span class="hljs-built_in">typeid</span>(T).<span class="hljs-built_in">name</span>() &lt;&lt; <span class="hljs-string">" has already been initialized"</span>;
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 完美转发参数，创建单例实例（支持任意构造参数）</span>
        <span class="hljs-built_in">instanceRef</span>() = <span class="hljs-keyword">new</span> <span class="hljs-built_in">T</span>(std::forward&lt;Args&gt;(args)...);

        <span class="hljs-comment">// 注册清理回调（仅首次初始化时注册）</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">regIdRef</span>() == <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">regIdRef</span>() = SingletonManager::<span class="hljs-built_in">instance</span>().<span class="hljs-built_in">registerCleanup</span>([] {
                QMutexLocker <span class="hljs-built_in">lockerCleanup</span>(&amp;<span class="hljs-built_in">mutex</span>());
                <span class="hljs-keyword">delete</span> <span class="hljs-built_in">instanceRef</span>(); <span class="hljs-comment">// 释放单例实例</span>
                <span class="hljs-built_in">instanceRef</span>() = <span class="hljs-literal">nullptr</span>; <span class="hljs-comment">// 重置指针，避免野指针</span>
                <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"[Singleton] "</span> &lt;&lt; <span class="hljs-built_in">typeid</span>(T).<span class="hljs-built_in">name</span>() &lt;&lt; <span class="hljs-string">" cleaned up"</span>;
            });
        }
    }

    <span class="hljs-comment">/**
     * @brief 获取单例实例指针（线程安全）
     * @return T* 单例指针（非空，调试模式下为空会触发断言）
     * 注意：必须先调用 init() 初始化，否则调试模式断言失败，release 模式可能崩溃
     */</span>
    <span class="hljs-function"><span class="hljs-type">static</span> T *<span class="hljs-title">instance</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;mutex())</span></span>;
        <span class="hljs-built_in">Q_ASSERT_X</span>(<span class="hljs-built_in">instanceRef</span>() != <span class="hljs-literal">nullptr</span>, 
                   <span class="hljs-string">"Singleton::instance()"</span>, 
                   <span class="hljs-built_in">qPrintable</span>(<span class="hljs-built_in">QString</span>(<span class="hljs-string">"%1 not initialized! Call Singleton&lt;%1&gt;::init() first."</span>).<span class="hljs-built_in">arg</span>(<span class="hljs-built_in">typeid</span>(T).<span class="hljs-built_in">name</span>())));
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">instanceRef</span>();
    }

    <span class="hljs-comment">/**
     * @brief 手动销毁单例（主动释放资源）
     * 特点：销毁后可重新调用 init() 再次初始化，支持动态启停
     */</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">shutdown</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;mutex())</span></span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">instanceRef</span>() != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-function"><span class="hljs-keyword">delete</span> <span class="hljs-title">instanceRef</span><span class="hljs-params">()</span></span>;
            <span class="hljs-built_in">instanceRef</span>() = <span class="hljs-literal">nullptr</span>;
            <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"[Singleton] "</span> &lt;&lt; <span class="hljs-built_in">typeid</span>(T).<span class="hljs-built_in">name</span>() &lt;&lt; <span class="hljs-string">" shut down manually"</span>;
        }

        <span class="hljs-comment">// 注销清理回调（避免重复销毁）</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">regIdRef</span>() != <span class="hljs-number">0</span>) {
            SingletonManager::<span class="hljs-built_in">instance</span>().<span class="hljs-built_in">unregisterCleanup</span>(<span class="hljs-built_in">regIdRef</span>());
            <span class="hljs-built_in">regIdRef</span>() = <span class="hljs-number">0</span>;
        }
    }

    <span class="hljs-comment">// 禁用默认构造/析构：禁止创建 Singleton 实例（仅通过静态方法访问）</span>
    <span class="hljs-built_in">Singleton</span>() = <span class="hljs-keyword">delete</span>;
    ~<span class="hljs-built_in">Singleton</span>() = <span class="hljs-keyword">delete</span>;

    <span class="hljs-comment">// 禁用拷贝/移动：确保单例唯一性</span>
    <span class="hljs-built_in">Singleton</span>(<span class="hljs-type">const</span> Singleton &amp;) = <span class="hljs-keyword">delete</span>;
    Singleton &amp;<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> Singleton &amp;) = <span class="hljs-keyword">delete</span>;
    <span class="hljs-built_in">Singleton</span>(Singleton &amp;&amp;) = <span class="hljs-keyword">delete</span>;
    Singleton &amp;<span class="hljs-keyword">operator</span>=(Singleton &amp;&amp;) = <span class="hljs-keyword">delete</span>;

<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">/**
     * @brief 获取单例实例引用（静态局部变量，懒加载）
     * 注意：静态局部变量初始化线程安全（C++11 标准）
     */</span>
    <span class="hljs-function"><span class="hljs-type">static</span> T *&amp;<span class="hljs-title">instanceRef</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> T *inst = <span class="hljs-literal">nullptr</span>;
        <span class="hljs-keyword">return</span> inst;
    }

    <span class="hljs-comment">/**
     * @brief 获取互斥锁引用（静态局部变量，懒加载）
     * 每个单例类拥有独立的互斥锁，避免不同单例间锁竞争
     */</span>
    <span class="hljs-function"><span class="hljs-type">static</span> QMutex &amp;<span class="hljs-title">mutex</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> QMutex m;
        <span class="hljs-keyword">return</span> m;
    }

    <span class="hljs-comment">/**
     * @brief 获取清理回调注册 ID 引用
     * 用于跟踪是否已注册清理回调，避免重复注册
     */</span>
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> &amp;<span class="hljs-title">regIdRef</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">static</span> <span class="hljs-type">int</span> id = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> id;
    }
};

<span class="hljs-comment">/**
 * @def GET_SINGLETON(Type)
 * @brief 获取单例指针（可能为 nullptr，需自行判空）
 * 适用场景：允许单例未初始化的场景（如可选功能模块）
 */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> GET_SINGLETON(Type) (Singleton<span class="hljs-string">&lt;Type&gt;</span>::instance())</span>

<span class="hljs-comment">/**
 * @def GET_SINGLETON_REF(Type)
 * @brief 获取单例引用（调试模式下未初始化会触发断言）
 * 适用场景：确保单例必须存在的核心模块（如配置管理）
 */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> GET_SINGLETON_REF(Type) ([]() -&gt; Type &amp; { \
    Type *p = Singleton<span class="hljs-string">&lt;Type&gt;</span>::instance();       \
    Q_ASSERT_X(p != nullptr, <span class="hljs-string">"GET_SINGLETON_REF"</span>, <span class="hljs-string">"Singleton not initialized"</span>); \
    return *p;                                   \
}())</span>

<span class="hljs-comment">/**
 * @def GET_SINGLETON_OR(Type, alt)
 * @brief 获取单例指针，若未初始化则返回替代值
 * 适用场景：需要降级策略的场景（如备用服务）
 */</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> GET_SINGLETON_OR(Type, alt) (Singleton<span class="hljs-string">&lt;Type&gt;</span>::instance() ? Singleton<span class="hljs-string">&lt;Type&gt;</span>::instance() : (alt))</span>

<span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// SINGLETON_H</span></span>
</code></pre>
<p><strong>设计亮点：</strong></p>
<ul>
<li><strong>编译期校验：</strong> 通过 <code>static_assert</code> 禁止抽象类、不可构造类作为单例，提前暴露错误；</li>
<li><strong>完美转发：</strong> <code>std::forward</code> 保留构造参数的左值 / 右值属性，支持任意构造参数（包括临时对象）；</li>
<li><strong>独立锁机制：</strong> 每个单例类拥有自己的 <code>QMutex</code>，避免不同单例间的锁竞争，提高并发效率；</li>
<li><strong>灵活控制：</strong> 支持 <code>init()</code> 重复调用（幂等性）、<code>shutdown()</code> 手动销毁后重新初始化；</li>
<li><strong>安全宏定义：</strong> 提供三种访问宏，适配不同使用场景，调试模式下有明确断言提示。</li>
</ul>
<h4 data-id="heading-6">3.3 目标单例类示例：<code>MyService.h</code></h4>
<p>为了让示例更完整，这里提供一个典型的 Qt 单例类实现（支持信号槽、带参数构造）：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> MYSERVICE_H</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> MYSERVICE_H</span>

<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QObject&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QString&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QDebug&gt;</span></span>

<span class="hljs-comment">// 示例单例类：网络服务管理（支持信号槽，带参数构造）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> : <span class="hljs-keyword">public</span> QObject {
    Q_OBJECT
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">/**
     * @brief 带参数构造函数（单例的构造参数通过 Singleton::init() 传递）
     * @param serverUrl 服务端地址
     * @param port 服务端口
     * @param parent 父对象（建议设为 nullptr，避免生命周期冲突）
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">MyService</span><span class="hljs-params">(<span class="hljs-type">const</span> QString &amp;serverUrl, <span class="hljs-type">int</span> port, QObject *parent = <span class="hljs-literal">nullptr</span>)</span> 
        : QObject(parent), m_serverUrl(serverUrl), m_port(port) {</span>
        <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"[MyService] Initialized with URL:"</span> &lt;&lt; serverUrl &lt;&lt; <span class="hljs-string">", port:"</span> &lt;&lt; port;
    }

    ~<span class="hljs-built_in">MyService</span>() <span class="hljs-keyword">override</span> {
        <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"[MyService] Destructor called"</span>;
    }

    <span class="hljs-comment">// 示例业务方法</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"[MyService] Doing something with"</span> &lt;&lt; m_serverUrl &lt;&lt; <span class="hljs-string">":"</span> &lt;&lt; m_port;
        <span class="hljs-comment">// 实际业务逻辑：如网络请求、数据处理等</span>
    }

signals:
    <span class="hljs-comment">// 示例信号：如服务状态变化</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">serviceReady</span><span class="hljs-params">()</span></span>;

<span class="hljs-keyword">private</span>:
    QString m_serverUrl; <span class="hljs-comment">// 服务端地址</span>
    <span class="hljs-type">int</span> m_port;          <span class="hljs-comment">// 服务端口</span>
};

<span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// MYSERVICE_H</span></span>
</code></pre>
<p><strong>注意事项：</strong></p>
<ul>
<li>单例类若继承 <code>QObject</code>，建议将父对象设为 <code>nullptr</code>，避免 Qt 父子对象生命周期管理与单例冲突；</li>
<li>构造函数需为 <code>public</code> 或 <code>protected</code>（若为 <code>protected</code>，需将 <code>Singleton&lt;T&gt;</code> 设为友元）；</li>
<li>避免在构造函数中执行耗时操作（如网络连接），可提供 <code>initService()</code> 等方法延迟初始化。</li>
</ul>
<h4 data-id="heading-7">完整使用示例（main 函数）</h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QCoreApplication&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;QTimer&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"SingletonManager.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"Singleton.h"</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"MyService.h"</span></span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span> </span>{
    <span class="hljs-comment">// 1. 必须先创建 QCoreApplication（QMutex、QObject 等依赖 Qt 环境初始化）</span>
    <span class="hljs-function">QCoreApplication <span class="hljs-title">app</span><span class="hljs-params">(argc, argv)</span></span>;

    <span class="hljs-comment">// 2. 连接 aboutToQuit 信号，程序退出时统一清理单例</span>
    QObject::<span class="hljs-built_in">connect</span>(&amp;app, &amp;QCoreApplication::aboutToQuit, []() {
        <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"\n[Main] Starting singleton cleanup..."</span>;
        SingletonManager::<span class="hljs-built_in">instance</span>().<span class="hljs-built_in">cleanupAll</span>();
        <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"[Main] Singleton cleanup finished"</span>;
    });

    <span class="hljs-comment">// 3. 初始化单例（传递构造参数，自动注册清理回调）</span>
    Singleton&lt;MyService&gt;::<span class="hljs-built_in">init</span>(<span class="hljs-string">"http://example.com"</span>, <span class="hljs-number">8080</span>);

    <span class="hljs-comment">// 4. 三种访问单例的方式</span>
    <span class="hljs-comment">// 方式1：获取指针（需手动判空，适合可选模块）</span>
    MyService *svcPtr = <span class="hljs-built_in">GET_SINGLETON</span>(MyService);
    <span class="hljs-keyword">if</span> (svcPtr) {
        svcPtr-&gt;<span class="hljs-built_in">doSomething</span>();
    }

    <span class="hljs-comment">// 方式2：获取引用（调试模式断言非空，适合核心模块）</span>
    MyService &amp;svcRef = <span class="hljs-built_in">GET_SINGLETON_REF</span>(MyService);
    svcRef.<span class="hljs-built_in">doSomething</span>();

    <span class="hljs-comment">// 方式3：获取指针或替代值（适合降级策略）</span>
    MyService *svcOr = <span class="hljs-built_in">GET_SINGLETON_OR</span>(MyService, <span class="hljs-literal">nullptr</span>);
    <span class="hljs-keyword">if</span> (svcOr) {
        svcOr-&gt;<span class="hljs-built_in">doSomething</span>();
    }

    <span class="hljs-comment">// 5. 示例：手动销毁单例（可选）</span>
    QTimer::<span class="hljs-built_in">singleShot</span>(<span class="hljs-number">2000</span>, []() {
        <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"\n[Main] Shutting down MyService manually..."</span>;
        Singleton&lt;MyService&gt;::<span class="hljs-built_in">shutdown</span>();

        <span class="hljs-comment">// 销毁后可重新初始化</span>
        <span class="hljs-built_in">qDebug</span>() &lt;&lt; <span class="hljs-string">"[Main] Reinitializing MyService..."</span>;
        Singleton&lt;MyService&gt;::<span class="hljs-built_in">init</span>(<span class="hljs-string">"http://new-example.com"</span>, <span class="hljs-number">9090</span>);
        <span class="hljs-built_in">GET_SINGLETON_REF</span>(MyService).<span class="hljs-built_in">doSomething</span>();
    });

    <span class="hljs-comment">// 6. 3秒后退出程序（触发 aboutToQuit 清理）</span>
    QTimer::<span class="hljs-built_in">singleShot</span>(<span class="hljs-number">3000</span>, &amp;app, &amp;QCoreApplication::quit);

    <span class="hljs-keyword">return</span> app.<span class="hljs-built_in">exec</span>();
}
</code></pre>
<p><strong>运行输出：</strong></p>
<pre><code class="hljs language-text" lang="text">[MyService] Initialized with URL: "http://example.com" , port: 8080
[MyService] Doing something with "http://example.com" : 8080
[MyService] Doing something with "http://example.com" : 8080
[MyService] Doing something with "http://example.com" : 8080

[Main] Shutting down MyService manually...
[MyService] Destructor called
[Singleton] MyService cleaned up
[Main] Reinitializing MyService...
[MyService] Initialized with URL: "http://new-example.com" , port: 9090
[MyService] Doing something with "http://new-example.com" : 9090

[Main] Starting singleton cleanup...
[MyService] Destructor called
[Singleton] MyService cleaned up
[Main] Singleton cleanup finished
</code></pre>
<h3 data-id="heading-8">四、核心注意事项</h3>
<h4 data-id="heading-9">4.1 初始化顺序</h4>
<ol>
<li><strong>必须先创建 <code>QCoreApplication</code>：</strong> <code>QMutex</code>、<code>QObject</code> 等 Qt 组件依赖 Qt 环境初始化，因此 <code>QCoreApplication</code> 必须在 <code>Singleton::init()</code> 之前创建；</li>
<li><strong>单例依赖顺序：</strong> 若单例 A 依赖单例 B，需先初始化 B 再初始化 A（清理顺序与注册顺序一致，即先清理 A 再清理 B，避免依赖失效）。</li>
</ol>
<h4 data-id="heading-10">4.2 线程安全</h4>
<ol>
<li><strong>初始化线程安全：</strong> <code>init()</code> 方法通过 <code>QMutex</code> 保护，多线程并发调用仅首次初始化有效；</li>
<li><strong>访问线程安全：</strong> <code>instance()</code> 方法通过 <code>QMutex</code> 保护，避免多线程同时访问未初始化的实例；</li>
<li><strong>单例内部线程安全：</strong> 本文框架仅保证实例创建 / 销毁的线程安全，单例类自身的成员函数需根据业务需求添加锁（如 <code>QMutex</code>）。</li>
</ol>
<h4 data-id="heading-11">4.3 禁止拷贝移动</h4>
<ul>
<li>单例类必须禁用拷贝构造、赋值运算符（通过 <code>Q_DISABLE_COPY_MOVE</code> 或手动删除），否则可能通过拷贝创建多个实例；</li>
<li><code>Singleton&lt;T&gt;</code> 模板已禁用拷贝移动，目标单例类需自行禁用（如示例 <code>MyService</code> 虽未显式禁用，但继承 <code>QObject</code> 后自动禁用）。</li>
</ul>
<h4 data-id="heading-12">4.4 内存泄漏防护</h4>
<ul>
<li>必须连接 <code>QCoreApplication::aboutToQuit</code> 到 <code>SingletonManager::cleanupAll()</code>，否则程序异常退出时可能导致内存泄漏；</li>
<li>若单例类继承 <code>QObject</code>，禁止将其设为其他 <code>QObject</code> 的子对象（否则 Qt 可能自动销毁实例，导致二次释放）。</li>
</ul>
<h4 data-id="heading-13">4.5 调试与 Release 模式差异</h4>
<ul>
<li>调试模式（Debug）：<code>instance()</code>、<code>GET_SINGLETON_REF</code> 会触发断言，快速定位未初始化的错误；</li>
<li>发布模式（Release）：断言失效，<code>instance()</code> 可能返回 <code>nullptr</code>，需自行判空（建议核心模块使用 <code>GET_SINGLETON_REF</code>，非核心模块使用 <code>GET_SINGLETON</code> 并判空）。</li>
</ul>
<h3 data-id="heading-14">五、进阶用法</h3>
<h4 data-id="heading-15">5.1 懒加载单例（无需手动 init）</h4>
<p>默认实现需要手动调用 <code>init()</code>，若需懒加载（首次调用 <code>instance()</code> 时自动初始化），可修改 <code>instance()</code> 方法：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> T *<span class="hljs-title">instance</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;mutex())</span></span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">instanceRef</span>() == <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-comment">// 无参构造（若需带参数，需调整设计，如全局配置）</span>
        <span class="hljs-built_in">instanceRef</span>() = <span class="hljs-keyword">new</span> <span class="hljs-built_in">T</span>();
        <span class="hljs-comment">// 自动注册清理回调</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">regIdRef</span>() == <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">regIdRef</span>() = SingletonManager::<span class="hljs-built_in">instance</span>().<span class="hljs-built_in">registerCleanup</span>([] {
                QMutexLocker <span class="hljs-built_in">locker</span>(&amp;<span class="hljs-built_in">mutex</span>());
                <span class="hljs-keyword">delete</span> <span class="hljs-built_in">instanceRef</span>();
                <span class="hljs-built_in">instanceRef</span>() = <span class="hljs-literal">nullptr</span>;
            });
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">instanceRef</span>();
}
</code></pre>
<p><strong>注意：</strong> 懒加载模式仅支持无参构造，若需带参数，需通过全局配置或其他方式传递参数。</p>
<h4 data-id="heading-16">5.2 单例销毁优先级</h4>
<p>若需控制单例的销毁顺序（如先销毁依赖方，再销毁被依赖方），可扩展 <code>SingletonManager</code> 支持优先级：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 修改 SingletonManager 的注册接口，增加优先级参数</span>
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">registerCleanup</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; fn, <span class="hljs-type">int</span> priority = <span class="hljs-number">0</span>)</span> </span>{
    <span class="hljs-function">QMutexLocker <span class="hljs-title">locker</span><span class="hljs-params">(&amp;m_mutex)</span></span>;
    <span class="hljs-type">int</span> id = m_nextId++;
    <span class="hljs-comment">// 用 pair&lt;priority, id&gt; 作为 key，按优先级降序排序（优先级高的先清理）</span>
    m_funcs.<span class="hljs-built_in">emplace</span>(std::<span class="hljs-built_in">make_pair</span>(-priority, id), std::<span class="hljs-built_in">move</span>(fn));
    <span class="hljs-keyword">return</span> id;
}

<span class="hljs-comment">// 对应的 map 类型修改为：</span>
std::map&lt;std::pair&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt;, std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; m_funcs;
</code></pre>
<p>使用时指定优先级：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// 高优先级（先清理）</span>
Singleton&lt;MyService&gt;::<span class="hljs-built_in">initWithPriority</span>(<span class="hljs-number">10</span>, <span class="hljs-string">"http://example.com"</span>, <span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-17">5.3 线程局部单例（TLS）</h4>
<p>若需每个线程拥有独立的单例实例（如线程局部缓存），可修改 <code>instanceRef()</code> 为线程局部变量：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">static</span> T *&amp;<span class="hljs-title">instanceRef</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">thread_local</span> T *inst = <span class="hljs-literal">nullptr</span>; <span class="hljs-comment">// 线程局部变量，每个线程独立</span>
    <span class="hljs-keyword">return</span> inst;
}

<span class="hljs-function"><span class="hljs-type">static</span> QMutex &amp;<span class="hljs-title">mutex</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">thread_local</span> QMutex m; <span class="hljs-comment">// 每个线程独立的锁</span>
    <span class="hljs-keyword">return</span> m;
}
</code></pre>
<p>注意：线程局部单例的清理需在线程退出时手动调用 <code>shutdown()</code>，避免线程泄漏。</p>
<h3 data-id="heading-18">六、常见问题排查</h3>
<h4 data-id="heading-19">6.1 断言失败：Singleton not initialized</h4>
<ul>
<li>原因：未调用 <code>Singleton::init()</code> 就调用 <code>instance()</code> 或 <code>GET_SINGLETON_REF</code>；</li>
<li>解决：确保 <code>init()</code> 在 <code>instance()</code> 之前调用，且 <code>QCoreApplication</code> 已创建。</li>
</ul>
<h4 data-id="heading-20">6.2 内存泄漏（Valgrind 检测到泄漏）</h4>
<ul>
<li>原因：未连接 <code>QCoreApplication::aboutToQuit</code> 到 <code>SingletonManager::cleanupAll()</code>；</li>
<li>解决：在 <code>main</code> 函数中添加连接代码。</li>
</ul>
<h4 data-id="heading-21">6.3 二次释放崩溃</h4>
<ul>
<li>原因：单例类被 Qt 父子对象管理（如设置了父对象），导致 Qt 自动销毁后，<code>SingletonManager</code> 再次销毁；</li>
<li>解决：单例类构造时父对象设为 <code>nullptr</code>，禁止将单例设为其他 <code>QObject</code> 的子对象。</li>
</ul>
<h4 data-id="heading-22">6.4 多线程并发初始化导致崩溃</h4>
<ul>
<li>原因：使用了 C++11 之前的编译器（静态局部变量初始化非线程安全）；</li>
<li>解决：升级编译器到支持 C++11 及以上标准，或手动为 <code>instanceRef()</code> 加锁。</li>
</ul>
<h3 data-id="heading-23">七、框架优势总结</h3>
<p>本文实现的单例框架相比传统单例（如饿汉式、懒汉式），具有以下优势：</p>
<ol>
<li><strong>通用性强：</strong> 模板化设计，支持任意可构造类，无需修改目标类代码；</li>
<li><strong>线程安全：</strong> 基于 <code>QMutex</code> 实现初始化 / 访问安全，兼容 Qt 多线程环境；</li>
<li><strong>自动清理：</strong> 通过 <code>SingletonManager</code> 统一管理，避免内存泄漏；</li>
<li><strong>灵活构造：</strong> 支持带参数构造（完美转发），适配复杂单例类；</li>
<li><strong>安全易用：</strong> 提供断言校验、宏定义快捷访问，降低使用成本；</li>
<li><strong>可扩展：</strong> 支持手动销毁、优先级清理、线程局部单例等进阶需求。</li>
</ol>
<p>该框架可直接用于 Qt 控制台程序、桌面程序（QWidget）、移动程序（Qt Quick）等所有场景，是 Qt 开发中单例模式的优选实现方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【codex】使用 PLANS.md 进行长时间问题解决]]></title>    <link>https://juejin.cn/post/7574651025727471654</link>    <guid>https://juejin.cn/post/7574651025727471654</guid>    <pubDate>2025-11-20T11:44:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574651025727471654" data-draft-id="7574615024293691418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【codex】使用 PLANS.md 进行长时间问题解决"/> <meta itemprop="keywords" content="ChatGPT"/> <meta itemprop="datePublished" content="2025-11-20T11:44:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【codex】使用 PLANS.md 进行长时间问题解决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T11:44:14.000Z" title="Thu Nov 20 2025 11:44:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcookbook.openai.com%2Farticles%2Fcodex_exec_plans" target="_blank" title="https://cookbook.openai.com/articles/codex_exec_plans" ref="nofollow noopener noreferrer">转载</a></p>
<p>Codex 和 <code>gpt-5-codex</code> 模型能够用于实现需要大量时间进行研究、设计和开发的复杂任务。本文介绍的方法是引导模型实现这些任务并促使其成功完成项目的一种有效方式。</p>
<p>这些计划既是详尽的设计文档，也是"动态文档"。作为 Codex 的使用者，您可以借助这些文档来审核 Codex 在启动漫长开发流程前所采取的实施方法。下文包含的 <code>PLANS.md</code> 与让 Codex 能够通过单次提示连续工作超过七小时的文档版本非常相似。</p>
<p>我们通过首先更新 <code>AGENTS.md</code> 来说明何时使用 <code>PLANS.md</code>，然后将 <code>PLANS.md</code> 文件加入代码库，从而让 Codex 能够利用这些文档。</p>
<h2 data-id="heading-0"><code>AGENTS.md</code></h2>
<p><code>AGENTS.md</code> 是一个用于指导编程代理（如 Codex）的简单格式。我们定义了一个用户可以使用的简写术语，以及何时使用规划文档的简单规则。这里我们称之为"ExecPlan"。需要注意的是，这是一个自定义术语，Codex 并未经过相关训练。这个简写可以在提示 Codex 时用来将其引导至特定的计划定义。</p>
<p>以下是一个指导代理何时使用计划的 <code>AGENTS.md</code> 示例部分：</p>
<pre><code class="hljs language-md" lang="md"><span class="hljs-section"># ExecPlans</span>

在开发复杂功能或执行重要重构时，从设计到实现全过程采用 ExecPlan（详见 .agent/PLANS.md）。
</code></pre>
<h2 data-id="heading-1"><code>PLANS.md</code></h2>
<p>以下是完整的文档内容。此文档中的提示经过精心设计，旨在为用户提供充分反馈，并引导模型精确实现计划规范。用户可能会发现，根据自身需求定制文件，或增删所需部分会更有帮助。</p>
<pre><code class="hljs language-md" lang="md"><span class="hljs-section"># Codex 执行计划 (ExecPlans):</span>

本文档阐述了执行计划（"ExecPlan"）的要求，这是一种编程代理可以遵循、用于交付可用功能或系统变更的设计文档。请将读者视为本代码库的完全新手：他们仅拥有当前工作树和您提供的单一 ExecPlan 文件。没有历史计划记忆，也不涉及外部上下文。

<span class="hljs-section">## ExecPlans 和 PLANS.md 的使用方法</span>

编写可执行规范（ExecPlan）时，必须 <span class="hljs-emphasis">_严格遵循_</span> PLANS.md。若相关内容不在上下文中，请通读 PLANS.md 文件以重新熟悉。要透彻阅读（和重读）源材料以生成准确的规范。创建规范时，从框架开始，在研究过程中逐步充实。

实现可执行规范（ExecPlan）时，不要向用户询问"下一步"；直接进入下一个里程碑。保持所有部分更新，在每个暂停点添加或拆分列表项，明确说明进展和下一步行动。自主解决模糊问题，并频繁提交。

讨论可执行规范（ExecPlan）时，在规范日志中记录决策以备查阅；必须明确说明对规范进行任何修改的原因。ExecPlans 是动态文档，应该始终能够仅凭 ExecPlan 重新开始工作，无需其他辅助。

研究具有挑战性需求或大量不确定因素的设计时，利用里程碑实施概念验证、"玩具实现"等，以验证用户方案的可行性。通过查找或获取库源码进行深入研究，并包含原型以指导更完整的实现。

<span class="hljs-section">## 要求</span>

<span class="hljs-strong">**不可协商的要求：**</span>

<span class="hljs-bullet">*</span> 每个 ExecPlan 必须完全自包含。自包含意味着其当前形态包含了新手成功所需的所有知识和指导。
<span class="hljs-bullet">*</span> 每个 ExecPlan 是动态文档。贡献者必须在取得进展、发现新问题和设计决策确定时更新文档。每次修订都必须保持完全自包含。
<span class="hljs-bullet">*</span> 每个 ExecPlan 必须使完全新手能够在没有代码库先验知识的情况下端到端实现功能。
<span class="hljs-bullet">*</span> 每个 ExecPlan 必须产生可验证的工作行为，而非仅仅满足定义的代码修改。
<span class="hljs-bullet">*</span> 每个 ExecPlan 必须用通俗语言定义每个专业术语，否则避免使用。

目的和意图优先。先用几句话说明为何这项工作从用户视角很重要：用户在此修改后能做什么以前做不到的事，以及如何验证其工作状态。然后引导读者按确切步骤实现该结果，包括编辑内容、运行指令和应该观察到的现象。

执行您计划的代理可以列出文件、读取文件、搜索、运行项目和执行测试。它不了解任何先前的上下文，也无法从早期里程碑推断您的意图。重申您依赖的任何假设。不要指向外部博客或文档；如需相关知识，请用您的语言将其嵌入计划中。如果 ExecPlan 基于先前的 ExecPlan 且该文件已提交，请通过引用纳入。如未提交，则必须包含该计划的所有相关上下文。

<span class="hljs-section">## 格式规范</span>

格式和结构简单而严格。每个 ExecPlan 必须是标记为 <span class="hljs-code">`md`</span> 的单一代码块，以三个反引号开始和结束。不要在其中嵌套额外的三反引代码块；当需要显示命令、记录、差异或代码时，将其作为该块内的缩进内容呈现。在 ExecPlan 内使用缩进而非代码块以求清晰，避免过早关闭 ExecPlan 的代码块。每个标题后使用两个换行符，采用 # 和 ## 等标题标记，并正确使用有序和无序列表语法。

当将 ExecPlan 写入 Markdown (.md) 文件时，若文件内容 <span class="hljs-emphasis">_仅_</span> 包含单个 ExecPlan，应省略三个反引号。

采用通俗散文体写作。优先使用完整句子而非列表。除非简洁会影响表意清晰，否则避免检查清单、表格和长枚举。检查清单仅允许在 <span class="hljs-code">`Progress`</span> 部分使用，且在该部分是必需的。叙述部分必须保持散文风格。

<span class="hljs-section">## 指导原则</span>

自包含和通俗语言至关重要。如果引入非日常英语的术语（如"daemon"、"middleware"、"RPC gateway"、"filter graph"），请立即定义并提醒读者它在代码库中的具体体现（如相关文件名或命令名）。不要说"如前所述"或"根据架构文档"。即使需要重复，也要在此处包含必要解释。

避免常见失败模式。不要依赖未定义的专业术语。不要过度狭隘地描述"功能的字面要求"，导致代码能编译但缺乏实际意义。不要将关键决策推给读者。当存在模糊性时，在计划中明确解决并说明选择该路径的原因。描述用户可见效果时倾向于充分说明，描述附带实现细节时倾向于简要说明。

以可观察的结果来锚定计划。说明用户在实现后可以做什么、要运行的命令以及应该看到的输出。验收标准应表述为人类可验证的行为（"启动服务器后，访问 [<span class="hljs-string">http://localhost:8080/health</span>](<span class="hljs-link">http://localhost:8080/health</span>) 返回 HTTP 200，响应体为 OK"），而非内部属性（"添加了 HealthCheck 结构体"）。如果变更是内部的，说明其影响如何验证（如运行变更前失败、变更后通过的测试，并展示使用新功能的场景）。

明确指定代码库上下文。使用完整的代码库相对路径命名文件，精确命名函数和模块，并说明新文件创建位置。如果涉及多个区域，请包含简短的导向段落，说明各部分的关联方式，以便新手能自信地导航。运行命令时，显示工作目录和确切命令行。当结果依赖于环境时，说明假设条件并提供合理替代方案。

确保幂等性和安全性。编写步骤时要支持多次运行而不会造成损坏或状态偏移。如果步骤可能中途失败，请说明重试或适应方法。如果需要迁移或破坏性操作，请明确备份策略或安全回退方案。优先采用可逐步验证的增量、可测试变更。

验证是必须的，不是可选的。包含运行测试、启动系统（如适用）并观察其执行有用操作的指导。描述任何新功能或能力的全面测试。包含预期输出和错误消息，以便新手能区分成功与失败。尽可能展示如何证明变更是有效的（如通过小型端到端场景、CLI 调用或 HTTP 请求/响应记录）。说明适合项目工具链的确切测试命令及结果解读方法。

收集证据。当步骤产生终端输出、简短差异或日志时，将其作为缩进示例包含在单一代码块内。保持内容简洁，专注证明成功的关键信息。如需包含补丁，优先使用文件范围差异或读者可按您指导重新创建的小段摘录，而非粘贴大型代码块。

<span class="hljs-section">## 里程碑</span>

里程碑是叙述性的，非官僚化的。如果将工作分解为里程碑，请用简短段落介绍每个里程碑，描述范围、里程碑结束时新增的内容、要运行的命令及预期验证结果。保持其故事般的可读性：目标、工作、结果、验证。进展和里程碑是不同的：里程碑讲述故事，进展跟踪细粒度工作。两者都必须存在。不要仅因简洁而缩写里程碑，不要省略对未来实现可能关键的信息。

每个里程碑必须独立验证并逐步实现执行计划的整体目标。

<span class="hljs-section">## 动态计划和设计决策</span>

<span class="hljs-bullet">*</span> ExecPlans 是动态文档。当做出关键设计决策时，更新计划以记录决策和背后的思考过程。将所有决策记录在 <span class="hljs-code">`Decision Log`</span> 部分。
<span class="hljs-bullet">*</span> ExecPlans 必须包含和维护 <span class="hljs-code">`Progress`</span> 部分、<span class="hljs-code">`Surprises &amp; Discoveries`</span> 部分、<span class="hljs-code">`Decision Log`</span> 和 <span class="hljs-code">`Outcomes &amp; Retrospective`</span> 部分。这些都是必需的。
<span class="hljs-bullet">*</span> 当发现优化器行为、性能权衡、意外错误或逆向/撤销应用语义影响您的方法时，在 <span class="hljs-code">`Surprises &amp; Discoveries`</span> 部分记录这些观察，并附上简短证据（测试输出最佳）。
<span class="hljs-bullet">*</span> 如在实现过程中改变方向，请在 <span class="hljs-code">`Decision Log`</span> 中记录原因，并在 <span class="hljs-code">`Progress`</span> 中反映影响。计划既是下一位贡献者的指南，也是您的检查清单。
<span class="hljs-bullet">*</span> 在完成主要任务或整个计划时，撰写 <span class="hljs-code">`Outcomes &amp; Retrospective`</span> 条目，总结取得的成就、剩余工作和经验教训。

<span class="hljs-section"># 原型里程碑和并行实现</span>

包含明确的原型里程碑是可接受的——且常受鼓励——当能降低更大变更的风险时。例如：向依赖项添加底层操作符以验证可行性，或在测量优化器效果的同时探索两种组合顺序。保持原型的增量性和可测试性。明确标记范围为"原型"；描述运行和观察结果的方法；并说明升级或废弃原型的标准。

优先采用保持测试通过的增量代码变更，后跟清理操作。并行实现（如在迁移期间同时维护适配器与旧路径）在降低风险或确保大型迁移期间测试持续通过时是可行的。描述如何验证两个路径及如何通过测试安全淘汰一个。当处理多个新库或功能区域时，考虑创建探索点来独立评估各功能的可行性，证明外部库按预期执行并在隔离环境中实现所需功能。

<span class="hljs-section">## 优秀 ExecPlan 的框架</span>

<span class="hljs-code">```md
# &lt;简短、面向行动的描述&gt;

此 ExecPlan 是动态文档。`Progress`、`Surprises &amp; Discoveries`、`Decision Log` 和 `Outcomes &amp; Retrospective` 部分必须在开发过程中保持更新。

如果 PLANS.md 文件已提交到代码库，请在此处从代码库根目录引用该文件路径，并注意此文档必须根据 PLANS.md 进行维护。

## 目的/大局观

用几句话说明用户在此变更后获得了什么及如何验证其工作效果。说明您将启用的用户可见行为。

## 进展

使用带复选框的列表总结细粒度步骤。每个暂停点都必须在此记录，即使需要将部分完成的任务拆分为两个（"已完成"vs."剩余"）。此部分必须始终反映工作的实际当前状态。

- [x] (2025-10-01 13:00Z) 示例已完成步骤。
- [ ] 示例未完成步骤。
- [ ] 示例部分完成步骤（已完成：X；剩余：Y）。

使用时间戳衡量进展速度。

## 意外与发现

记录实现过程中发现的意外行为、错误、优化或洞察。提供简洁证据。

- 观察：...
  证据：...

## 决策日志

按以下格式记录执行计划时做出的每个决策：

- 决策：...
  理由：...
  日期/作者：...

## 结果与回顾

在主要里程碑或完成时总结结果、差距和经验教训。将结果与原始目的进行对比。

## 上下文和导向

描述与任务相关的当前状态，假设读者对此一无所知。使用完整路径命名关键文件和模块。定义您将使用的任何非显而易见术语。不要引用先前的计划。

## 工作计划

用散文风格描述编辑和添加的序列。对每次编辑，命名文件和位置（函数、模块）及要插入或更改的内容。保持具体和最小化。

## 具体步骤

陈述要运行的确切命令及运行位置（工作目录）。当命令产生输出时，显示简短的预期记录以便读者对比。此部分必须在开发过程中更新。

## 验证和验收

描述如何启动或运行系统及要观察什么。将验收标准表述为行为，具有特定输入和输出。如涉及测试，请说明"运行 &lt;项目测试命令&gt; 并期望 &lt;N&gt; 个通过；新测试 &lt;名称&gt; 在变更前失败，变更后通过"。

## 幂等和恢复

如步骤可安全重复，请说明。如步骤有风险，请提供安全重试或回滚路径。完成后保持环境整洁。

## 产物和注释

包含最重要的记录、差异或代码摘录作为缩进示例。保持内容简洁，专注证明成功的关键信息。

## 接口和依赖

具有规定性。命名要使用的库、模块和服务并说明原因。指定里程碑结束时必须存在的类型、特征/接口和函数签名。优先使用稳定的名称和路径，如 `crate::module::function` 或 `package.submodule.Interface`。例如：

在 crates/foo/planner.rs 中，定义：

    pub trait Planner {
        fn plan(&amp;self, observed: &amp;Observed) -&gt; Vec&lt;Action&gt;;
    }
</span></code></pre>
<p>如果您遵循上述指导，单个无状态代理——或人类新手——可以从头到尾阅读您的 ExecPlan 并产出可运行的、可观察的结果。这就是标准：自包含、自给自足、新手友好、结果导向。</p>
<p>当修订计划时，必须确保您的更改全面反映在所有部分中，包括动态文档部分，并且必须在计划底部撰写说明，描述变更内容和原因。ExecPlans 必须说明几乎所有内容的缘由和方式。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何解析iOS崩溃日志：从获取到符号化分析]]></title>    <link>https://juejin.cn/post/7574621075323486271</link>    <guid>https://juejin.cn/post/7574621075323486271</guid>    <pubDate>2025-11-20T10:01:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574621075323486271" data-draft-id="7574621075323469887" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何解析iOS崩溃日志：从获取到符号化分析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T10:01:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bcbnb"/> <meta itemprop="url" content="https://juejin.cn/user/895474073078377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何解析iOS崩溃日志：从获取到符号化分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895474073078377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bcbnb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T10:01:28.000Z" title="Thu Nov 20 2025 10:01:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>一、前言：</p>
<p>作为一个合格的iOS开发者，除了具有规范强悍的编码能力外，还应该具有过硬的查错纠错能力。在项目运行时，程序崩溃是不可避免的，遇到这个问题，有时会出现一大堆的crash日志，艹，貌似看不懂呀。其实没有那么可怕，我们可以将这些日志格式化，通过它来快速定位问题的所在，以便迅速搞定它。</p>
<p>二、分析：</p>
<p>首先我们来看一个crash日志，大略的介绍其中的几个重要的关键词：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85b3ac303abe4ef78660b1ae44f5b26e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=w23r5%2FFOdqRaEV0g5ZyNb4%2FYpB8%3D" alt="" loading="lazy"/></p>
<p>关键词解释：</p>
<p>2.1、 进程信息</p>
<p>第一部分是闪退进程的相关信息：</p>
<p>Incident Identifier ： 是崩溃报告的唯一标识符。</p>
<p>CrashReporter Key： 是与设备标识相对应的唯一键值。虽然它不是真正的设备标识符，但也是一个非常有用的情报:如果你看到100个崩溃日志的CrashReporter Key值都是相同的，或者只有少数几个不同的CrashReport值，说明这不是一个普遍的问题，只发生在一个或少数几个设备上。</p>
<p>Hardware Model ：标识设备类型。 如果很多崩溃日志都是来自相同的设备类型，说明应用只在某特定类型的设备上有问题。上面的日志里，崩溃日志产生的设备是iPhone 4s。</p>
<p>Process：对项目的操作权限，上面的是可读可写</p>
<p>Path:崩溃文件的路径</p>
<p>Identifier:项目标识符，就是Bundle Id</p>
<p>Version:版本号</p>
<p>.....等等.......</p>
<p>2.2、基本信息</p>
<p>这部分给出了一些基本信息，包括闪退发生的日期Date/Time和时间Launch Time，设备的iOS版本OS Version等。</p>
<p>2.3、异常信息</p>
<p>Exception Type:异常的类型。</p>
<p>Exception Codes ：异常错误码</p>
<p>Termination Reason：闪退的原因，比如常见的数组越界啊，什么的。</p>
<p>Triggered by Thread：出现问题在哪个线程，这个比较重要，首先确定在哪个线程中出了问题，然后再去定位。</p>
<p>2.4、线程回溯</p>
<p>这部分提供应用中所有线程的回溯日志。 线程调用的一些，堆栈信息，压根看不懂，所有需要进行符号化处理。</p>
<p>三、解析崩溃日志</p>
<p>除了使用Xcode自带的工具，开发者也可以利用Keymob助手进行崩溃日志分析。Keymob提供了日志与崩溃信息查看功能，支持过滤和符号化分析，比Xcode控制台更便捷，能够帮助快速定位问题。</p>
<p>用Xcode自带的 symbolicatecrash 工具来解析的.crash文件</p>
<p>3.1、获取crash文件：</p>
<p>a.直接从设备中获取方法如下图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bce18a89a024a73b3a190dee88064a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=uthzcH8I%2FcFphnJxg725hn47ZyI%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ae2ce5ae06b4bd4b6a5846b92f7f092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=4nuFikpEKVCDXF%2FrCA457d3LkYE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abcc60d5f95144718c88d37e78a6ce7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=20hbRwUT2eH9euPUU%2BhfSND5PUI%3D" alt="" loading="lazy"/></p>
<p>b.如果产品在上架过程中发生崩溃，苹果那边的测试人员给我们直接发送过来已经整理好的崩溃日志文件，只需要根据其解决问题就行。</p>
<p>3.2、找到app包所对应的.dSYM文件。</p>
<p>强调要对应.dSYM 是保存 16 进制函数地址映射信息的中转文件，我们调试的 symbols 都会包含在这个文件中，并且每次编译项目的时候都会生成一个新的 dSYM 文件。测试给过来的.crash文件中，关于崩溃的确切语句和函数部分只有16进制地址符号，并不是我们在xcode调试时看到的xxx.cpp(xxfunction xx行)这样的。一般发布一个版本需要保存好对应的.dSYM和.app包，方便分析crash。如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c6dcdb1afd7434d8f15f96759a1b81b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=Dr4Yc6L9IPQJMcGp1sT6VnqifOU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9b7e63796434202a440cc0e9ad4657d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=AEnDswhJp21NL02C6g%2B3BGETeXo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3e343390715468f95efa79a38a1c9c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=QLyywl57LFdX2E7DU3rCdvMv0LY%3D" alt="" loading="lazy"/></p>
<p>3.3、就是找到Xcode中的symbolicatecrash工具咯，本人用的Xcode8，路径为：</p>
<pre><code class="hljs language-bash" lang="bash">/Applications/Xcode.app/Contents/SharedFrameworks/DVTFoundation.framework/Versions/A/Resources/symbolicatecrash
</code></pre>
<p>其他版本的xcode，自己百度咯，反正都差不多。把我们需要的工具直接复制到桌面上来（方便用）。</p>
<p>3.4、.crash文件的分析</p>
<p>a.配置环境变量DEVELOPER_DIR，（配置好了就不再需要）</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-variable constant_">DEVELOPER_DIR</span>=<span class="hljs-regexp">/Applications/</span><span class="hljs-title class_">Xcode</span>.<span class="hljs-property">app</span>/<span class="hljs-title class_">Contents</span>/<span class="hljs-title class_">Developer</span>
</code></pre>
<p>b.新建一个文件夹，将第二步中获取的两个文件放在同一个文件夹中</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dfcf1ce853f4c73b219b4e8e7745de2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=Lm3k5Tbl6HZUc2P1%2B2SghwwcGQA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53fe035b157c4219915095155d42ae90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmNibmI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237688&amp;x-signature=fH0peffFngG46jtyrUsPPeJfDN4%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0">注意：上面指的是其所在的路径。经过上面的简单几步我们就能得到格式化好的crash日志，这样就方便我们定位bug的位置了。</h5></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Compiler 完全指南：自动化性能优化的未来]]></title>    <link>https://juejin.cn/post/7573985572399710223</link>    <guid>https://juejin.cn/post/7573985572399710223</guid>    <pubDate>2025-11-19T03:16:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573985572399710223" data-draft-id="7573864324714577972" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Compiler 完全指南：自动化性能优化的未来"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-19T03:16:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="少卿"/> <meta itemprop="url" content="https://juejin.cn/user/26044010879709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Compiler 完全指南：自动化性能优化的未来
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044010879709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    少卿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T03:16:22.000Z" title="Wed Nov 19 2025 03:16:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React Compiler 完全指南：自动化性能优化的未来</h2>
<h3 data-id="heading-1">一、什么是 React Compiler？</h3>
<p><strong>React Compiler</strong>（曾用名 React Forget）是 React 团队在 2025 年 10 月发布的稳定版 1.0 构建时优化工具<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2025%2F10%2F07%2Freact-compiler-1" target="_blank" title="https://react.dev/blog/2025/10/07/react-compiler-1" ref="nofollow noopener noreferrer"/>。它不是一个传统意义上的"编译器"（将代码转为字节码），而是一个<strong>静态分析优化器</strong>，能够自动为你的 React 组件插入记忆化（memoization），从而消除不必要的重新渲染。</p>
<p><strong>核心定位</strong>：它让你可以<strong>忘记（Forget</strong>手动使用 <code>useMemo</code>、<code>useCallback</code> 和 <code>React.memo</code>，专注于编写声明式代码，性能优化由编译器在构建时自动完成。</p>
<hr/>
<h3 data-id="heading-2">二、解决了什么痛点？为什么需要它？</h3>
<h4 data-id="heading-3">传统的性能优化困境</h4>
<p>在 React Compiler 出现前，开发者面临<strong>两难选择</strong>：</p>
<ol>
<li><strong>性能 vs 代码简洁性</strong>：为了防止不必要的重渲染，必须用 <code>useMemo</code>/<code>useCallback</code> 包裹一切，导致代码臃肿、难以维护</li>
<li><strong>优化不一致性</strong>：不同开发者对何时使用记忆化的判断标准不同，导致性能优化碎片化</li>
<li><strong>高认知负荷</strong>：维护复杂的依赖数组 <code>deps</code> 容易出错，遗漏依赖导致 bug，多余依赖导致性能浪费</li>
<li><strong>“死亡千刀”</strong> ：大型项目中，性能相关的样板代码可能占代码总量的 20-30%</li>
</ol>
<p><strong>React 团队的观察</strong>：即使开发者知道需要优化，<strong>手动优化的覆盖率通常不到 30%</strong>。绝大多数组件本可以被记忆化，但出于"懒惰"或"风险考虑"被遗漏了。</p>
<hr/>
<h3 data-id="heading-4">三、工作原理：如何自动优化？</h3>
<p>React Compiler 的技术架构经历了<strong>近十年</strong>的演进：</p>
<h4 data-id="heading-5">1. 核心架构：基于 HIR 的静态分析</h4>
<p>编译器并非直接操作 AST，而是<strong>将代码降维到高级中间表示（High-Level Intermediate Representation, HIR）的控制流图（CFG）</strong>。这让它能够：</p>
<ul>
<li><strong>精确分析数据流</strong>：追踪每个变量的赋值、引用和传递路径</li>
<li><strong>理解可变性</strong>：识别哪些数据可能被修改，哪些是纯函数</li>
<li><strong>细粒度记忆化</strong>：可以<strong>条件性地</strong>记忆化值（这是手动 <code>useMemo</code> 无法做到的）</li>
</ul>
<h4 data-id="heading-6">2. React 规则编码</h4>
<p>编译器内置了 <strong>React 核心规则</strong>的验证通道：</p>
<ul>
<li><strong>幂等性</strong>：组件在相同输入下必须返回相同输出</li>
<li><strong>不可变性</strong>：props 和 state 值不能被直接修改</li>
<li><strong>副作用隔离</strong>：识别不纯的代码并跳过优化</li>
</ul>
<p><strong>安全策略</strong>：遇到不符合规则的代码时，编译器不会冒险优化，而是<strong>跳过该部分</strong>，确保不引入 bug。</p>
<h4 data-id="heading-7">3. 验证与诊断</h4>
<p>编译器通过 <strong>eslint-plugin-react-hooks</strong> 暴露诊断信息。当你违反 React 规则时，它会提示你潜在的 bug，这甚至比优化本身更有价值。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 编译器能检测并跳过此场景的优化</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">BadComponent</span>(<span class="hljs-params">props</span>) {
  props.<span class="hljs-property">value</span> = <span class="hljs-number">123</span>; <span class="hljs-comment">// ❌ 直接修改 props</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{props.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-8">四、核心特性与优势</h3>
<h4 data-id="heading-9">1. <strong>自动记忆化</strong>（Automatic Memoization）</h4>
<p>编译器自动在<strong>组件、hook、计算值</strong>层面插入等效的 <code>useMemo</code>/<code>useCallback</code>/<code>React.memo</code>，覆盖率接近 <strong>100%</strong>。</p>
<h4 data-id="heading-10">2. <strong>静态分析 &amp; 类型推断</strong></h4>
<p>在构建时分析组件的依赖关系，精确判断何时需要重新渲染。</p>
<h4 data-id="heading-11">3. <strong>现有代码库零侵入</strong></h4>
<p><strong>无需重写组件</strong>，编译器无缝集成到构建流程（Babel/Vite/Next.js），对开发者透明。</p>
<h4 data-id="heading-12">4. <strong>性能提升显著</strong></h4>
<ul>
<li><strong>Meta Quest Store</strong> 案例：加载和导航时间提升 <strong>12%</strong> ，特定交互速度提升 <strong>2.5 倍</strong></li>
<li><strong>Sanity Studio</strong>：大型 CMS 应用性能提升 <strong>30%</strong></li>
<li><strong>内存占用</strong>：优化后未增加内存消耗</li>
</ul>
<h4 data-id="heading-13">5. <strong>减少样板代码</strong></h4>
<p>代码库清晰度提升，开发者可以删除大量性能相关的"噪声代码"。</p>
<hr/>
<h3 data-id="heading-14">五、如何开始使用？</h3>
<h4 data-id="heading-15">前置条件</h4>
<ol>
<li><strong>启用 React Strict Mode</strong></li>
<li><strong>配置 ESLint React Hooks 插件</strong>（<code>eslint-plugin-react-hooks</code>）</li>
</ol>
<h4 data-id="heading-16">快速开始</h4>
<p>React Compiler 1.0 已与主流框架集成：</p>
<h5 data-id="heading-17"><strong>Next.js</strong>（v15+）</h5>
<pre><code class="hljs language-lua" lang="lua"># 创建新项目时启用
npx <span class="hljs-built_in">create</span>-<span class="hljs-built_in">next</span>-app@latest <span class="hljs-comment">--react-compiler</span>
</code></pre>
<h5 data-id="heading-18"><strong>Vite</strong></h5>
<pre><code class="hljs language-arduino" lang="arduino">npm install babel-plugin-react-compiler
# 在 vite.config.js 中配置
</code></pre>
<h5 data-id="heading-19"><strong>Expo</strong>（React Native）</h5>
<pre><code class="hljs language-lua" lang="lua">npx <span class="hljs-built_in">create</span>-expo-app <span class="hljs-comment">--template with-react-compiler</span>
</code></pre>
<h5 data-id="heading-20"><strong>自定义 Babel 配置</strong></h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"plugins"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">[</span><span class="hljs-string">"babel-plugin-react-compiler"</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"18"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-21">渐进式采用</h4>
<p>React Compiler 支持<strong>逐文件</strong>或<strong>逐组件</strong>启用，风险可控：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 在组件顶部添加指令禁用编译器</span>
<span class="hljs-string">'use no memo'</span>;

<span class="hljs-function">function <span class="hljs-title">LegacyComponent</span>()</span> {
  <span class="hljs-comment">// 这个组件不会被优化</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-22">六、与 Webpack Compiler 的区别</h3>
<p>有人容易混淆 <strong>React Compiler</strong> 与 <strong>Webpack Compiler</strong>：</p>



































<table><thead><tr><th align="left">维度</th><th align="left">React Compiler</th><th align="left">Webpack Compiler</th></tr></thead><tbody><tr><td align="left"><strong>定位</strong></td><td align="left">React 应用性能优化</td><td align="left">模块打包与构建</td></tr><tr><td align="left"><strong>工作层</strong></td><td align="left">源码级（AST/JSX）</td><td align="left">模块级（依赖图）</td></tr><tr><td align="left"><strong>核心功能</strong></td><td align="left">自动记忆化、静态分析</td><td align="left">代码拆分、Tree Shaking、HMR</td></tr><tr><td align="left"><strong>输出</strong></td><td align="left">优化后的 React 代码</td><td align="left">打包后的 bundle</td></tr><tr><td align="left"><strong>关系</strong></td><td align="left"><strong>互补</strong>（React Compiler 在 Webpack 的 loader 阶段工作）</td><td align="left"/></tr></tbody></table>
<p><strong>协同工作</strong>：React Compiler 作为 Babel 插件，在 Webpack 处理 JS/JSX 之前优化代码。</p>
<hr/>
<h3 data-id="heading-23">七、未来展望</h3>
<p>React Compiler 1.0 只是开始，路线图包括：</p>
<ul>
<li><strong>更智能的优化</strong>：在构建时预计算常量、优化数据获取模式</li>
<li><strong>React DevTools 集成</strong>：可视化显示哪些组件被编译器优化</li>
<li><strong>Concurrent React 深度整合</strong>：让并发渲染更智能地决定更新优先级</li>
<li><strong>生态系统普及</strong>：Next.js、Expo、Vite 将默认启用编译器</li>
</ul>
<hr/>
<h3 data-id="heading-24">八、常见问题解答</h3>
<p><strong>Q1：会完全取代 useMemo/useCallback 吗？</strong><br/>
A：绝大多数场景可以，但<strong>手动优化仍是逃生舱</strong>，用于极端性能需求。</p>
<p><strong>Q2：会增加构建时间吗？</strong><br/>
A：会，但增量构建和缓存机制让影响可控（通常 +10%~20%）。</p>
<p><strong>Q3：会改变代码行为吗？</strong><br/>
A：<strong>不会</strong>，编译器只进行安全的记忆化，不改变逻辑。</p>
<p><strong>Q4：对旧版本 React 兼容吗？</strong><br/>
A：支持 React 17+，但推荐 React 18+ 以获得最佳效果。</p>
<hr/>
<h3 data-id="heading-25">九、总结</h3>
<p>React Compiler 通过自动化消除了一代人的性能优化负担，让开发者回归本质：<strong>编写清晰、声明式的 UI 代码</strong>。正如 React 团队所说，这是<strong>未来十年 React 的新基础</strong>。</p>
<p><strong>现在就开始尝试</strong>：在你的项目中启用它，运行 <code>npm run build</code>，然后享受<strong>零手动优化</strong>的快感吧！</p>
<h3 data-id="heading-26">参考资料</h3>
<h4 data-id="heading-27">官方来源</h4>
<ol>
<li><strong>React Compiler 1.0发布公告</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Fblog%2F2025%2F10%2F07%2Freact-compiler-1" target="_blank" title="https://zh-hans.react.dev/blog/2025/10/07/react-compiler-1" ref="nofollow noopener noreferrer">zh-hans.react.dev/blog/2025/1…</a></li>
<li><strong>React Compiler官方文档</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Flearn%2Freact-compiler%2Fintroduction" target="_blank" title="https://zh-hans.react.dev/learn/react-compiler/introduction" ref="nofollow noopener noreferrer">zh-hans.react.dev/learn/react…</a></li>
<li><strong>React Compiler安装指南</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Flearn%2Freact-compiler%2Finstallation" target="_blank" title="https://zh-hans.react.dev/learn/react-compiler/installation" ref="nofollow noopener noreferrer">zh-hans.react.dev/learn/react…</a></li>
<li><strong>React Compiler配置参考</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.react.dev%2Freference%2Freact-compiler%2Fconfiguration" target="_blank" title="https://zh-hans.react.dev/reference/react-compiler/configuration" ref="nofollow noopener noreferrer">zh-hans.react.dev/reference/r…</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第4章：布局类组件 —— 4.5 流式布局（Wrap、Flow）]]></title>    <link>https://juejin.cn/post/7574250031247933474</link>    <guid>https://juejin.cn/post/7574250031247933474</guid>    <pubDate>2025-11-19T09:00:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574250031247933474" data-draft-id="7574245788948676623" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第4章：布局类组件 —— 4.5 流式布局（Wrap、Flow）"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-19T09:00:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="旧时光_"/> <meta itemprop="url" content="https://juejin.cn/user/4442458669718279"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第4章：布局类组件 —— 4.5 流式布局（Wrap、Flow）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4442458669718279/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    旧时光_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T09:00:00.000Z" title="Wed Nov 19 2025 09:00:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">4.5 流式布局（Wrap、Flow）</h2>
<h3 data-id="heading-1">📚 章节概览</h3>
<p>流式布局是指超出屏幕范围会自动换行的布局方式，本章节将学习：</p>
<ul>
<li><strong>Row/Column溢出问题</strong> - 为什么需要流式布局</li>
<li><strong>Wrap</strong> - 自动换行布局</li>
<li><strong>spacing</strong> - 主轴方向间距</li>
<li><strong>runSpacing</strong> - 纵轴方向间距</li>
<li><strong>alignment</strong> - 对齐方式</li>
<li><strong>Flow</strong> - 高性能自定义布局</li>
<li><strong>FlowDelegate</strong> - 自定义布局策略</li>
</ul>
<hr/>
<h3 data-id="heading-2">🎯 核心知识点</h3>
<h4 data-id="heading-3">什么是流式布局</h4>
<p>当子组件超出父容器范围时，<strong>自动换行</strong>的布局方式称为流式布局。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ❌ Row会溢出</span>
Row(
  children: [
    Text(<span class="hljs-string">'很长的文本'</span> * <span class="hljs-number">100</span>),  <span class="hljs-comment">// 超出屏幕 → 报错</span>
  ],
)

<span class="hljs-comment">// ✅ Wrap自动换行</span>
Wrap(
  children: [
    Text(<span class="hljs-string">'很长的文本'</span> * <span class="hljs-number">100</span>),  <span class="hljs-comment">// 超出屏幕 → 自动换行</span>
  ],
)
</code></pre>
<h4 data-id="heading-4">Wrap vs Flow</h4>






























<table><thead><tr><th>特性</th><th>Wrap</th><th>Flow</th></tr></thead><tbody><tr><td><strong>易用性</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td></tr><tr><td><strong>性能</strong></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>灵活性</strong></td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>推荐度</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td></tr></tbody></table>
<p><strong>建议：</strong> 90%的场景用 <code>Wrap</code> 即可</p>
<hr/>
<h3 data-id="heading-5">1️⃣ Row/Column的溢出问题</h3>
<h4 data-id="heading-6">1.1 溢出示例</h4>
<pre><code class="hljs language-dart" lang="dart">Row(
  children: [
    Text(<span class="hljs-string">'xxx'</span> * <span class="hljs-number">100</span>),  <span class="hljs-comment">// 超长文本</span>
  ],
)
</code></pre>
<p><strong>运行效果：</strong></p>
<pre><code class="hljs language-css" lang="css">xxxxxxxxxxxxxxxxxxxxx...  ⚠️ <span class="hljs-attribute">OVERFLOW</span>
</code></pre>
<p><strong>错误信息：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">A RenderFlex overflowed <span class="hljs-keyword">by</span> XXX pixels <span class="hljs-keyword">on</span> the right.
</code></pre>
<h4 data-id="heading-7">1.2 传统解决方案</h4>
<h5 data-id="heading-8">方案1：SingleChildScrollView（滚动）</h5>
<pre><code class="hljs language-dart" lang="dart">SingleChildScrollView(
  scrollDirection: Axis.horizontal,
  child: Row(
    children: [
      Text(<span class="hljs-string">'很长的文本'</span>),
      Text(<span class="hljs-string">'很长的文本'</span>),
    ],
  ),
)
</code></pre>
<p><strong>缺点：</strong> 需要手动滚动，不适合多行展示</p>
<h5 data-id="heading-9">方案2：Expanded（截断）</h5>
<pre><code class="hljs language-dart" lang="dart">Row(
  children: [
    Expanded(
      child: Text(
        <span class="hljs-string">'很长的文本'</span>,
        overflow: TextOverflow.ellipsis,  <span class="hljs-comment">// 省略号</span>
      ),
    ),
  ],
)
</code></pre>
<p><strong>缺点：</strong> 内容被截断，信息不完整</p>
<h5 data-id="heading-10">方案3：Wrap（自动换行）✅</h5>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  children: [
    Text(<span class="hljs-string">'很长的文本'</span>),
    Text(<span class="hljs-string">'很长的文本'</span>),
  ],
)
</code></pre>
<p><strong>优点：</strong> 自动换行，内容完整显示</p>
<hr/>
<h3 data-id="heading-11">2️⃣ Wrap（自动换行布局）</h3>
<h4 data-id="heading-12">2.1 构造函数</h4>
<pre><code class="hljs language-dart" lang="dart">Wrap({
  Key? key,
  Axis direction = Axis.horizontal,              <span class="hljs-comment">// 主轴方向</span>
  WrapAlignment alignment = WrapAlignment.start, <span class="hljs-comment">// 主轴对齐</span>
  <span class="hljs-built_in">double</span> spacing = <span class="hljs-number">0.0</span>,                          <span class="hljs-comment">// 主轴间距</span>
  WrapAlignment runAlignment = WrapAlignment.start, <span class="hljs-comment">// 纵轴对齐</span>
  <span class="hljs-built_in">double</span> runSpacing = <span class="hljs-number">0.0</span>,                       <span class="hljs-comment">// 纵轴间距</span>
  WrapCrossAlignment crossAxisAlignment = WrapCrossAlignment.start, <span class="hljs-comment">// 交叉轴对齐</span>
  TextDirection? textDirection,                  <span class="hljs-comment">// 文本方向</span>
  VerticalDirection verticalDirection = VerticalDirection.down, <span class="hljs-comment">// 垂直方向</span>
  <span class="hljs-built_in">List</span>&lt;Widget&gt; children = <span class="hljs-keyword">const</span> &lt;Widget&gt;[],      <span class="hljs-comment">// 子组件</span>
})
</code></pre>
<h4 data-id="heading-13">2.2 主要属性</h4>















































<table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>direction</code></td><td>Axis</td><td>horizontal</td><td>主轴方向</td></tr><tr><td><code>alignment</code></td><td>WrapAlignment</td><td>start</td><td>主轴对齐方式</td></tr><tr><td><code>spacing</code></td><td>double</td><td>0.0</td><td><strong>主轴方向子组件间距</strong></td></tr><tr><td><code>runAlignment</code></td><td>WrapAlignment</td><td>start</td><td><strong>纵轴对齐方式</strong></td></tr><tr><td><code>runSpacing</code></td><td>double</td><td>0.0</td><td><strong>纵轴方向行间距</strong></td></tr><tr><td><code>crossAxisAlignment</code></td><td>WrapCrossAlignment</td><td>start</td><td>交叉轴对齐</td></tr></tbody></table>
<h4 data-id="heading-14">2.3 基础用法</h4>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  children: [
    Chip(label: Text(<span class="hljs-string">'Flutter'</span>)),
    Chip(label: Text(<span class="hljs-string">'Dart'</span>)),
    Chip(label: Text(<span class="hljs-string">'iOS'</span>)),
    Chip(label: Text(<span class="hljs-string">'Android'</span>)),
    Chip(label: Text(<span class="hljs-string">'Web'</span>)),
  ],
)
</code></pre>
<p><strong>效果：</strong> 超出宽度自动换行</p>
<hr/>
<h3 data-id="heading-15">3️⃣ spacing 和 runSpacing</h3>
<h4 data-id="heading-16">3.1 spacing（主轴间距）</h4>
<p>控制<strong>同一行</strong>内子组件之间的间距。</p>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  spacing: <span class="hljs-number">8.0</span>,  <span class="hljs-comment">// 水平间距8</span>
  children: [
    Chip(label: Text(<span class="hljs-string">'A'</span>)),
    Chip(label: Text(<span class="hljs-string">'B'</span>)),
    Chip(label: Text(<span class="hljs-string">'C'</span>)),
  ],
)
</code></pre>
<p><strong>效果：</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[A]</span> <span class="hljs-number">8px</span> <span class="hljs-selector-attr">[B]</span> <span class="hljs-number">8px</span> <span class="hljs-selector-attr">[C]</span>
</code></pre>
<h4 data-id="heading-17">3.2 runSpacing（纵轴间距）</h4>
<p>控制<strong>不同行</strong>之间的间距。</p>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  runSpacing: <span class="hljs-number">12.0</span>,  <span class="hljs-comment">// 行间距12</span>
  children: [
    Chip(label: Text(<span class="hljs-string">'A'</span>)),
    Chip(label: Text(<span class="hljs-string">'B'</span>)),
    Chip(label: Text(<span class="hljs-string">'C'</span>)),
    <span class="hljs-comment">// ... 更多组件，自动换行</span>
  ],
)
</code></pre>
<p><strong>效果：</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[A]</span> <span class="hljs-selector-attr">[B]</span> <span class="hljs-selector-attr">[C]</span>
↕️ <span class="hljs-number">12px</span>
<span class="hljs-selector-attr">[D]</span> <span class="hljs-selector-attr">[E]</span> <span class="hljs-selector-attr">[F]</span>
</code></pre>
<h4 data-id="heading-18">3.3 同时使用</h4>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  spacing: <span class="hljs-number">8.0</span>,     <span class="hljs-comment">// 水平间距</span>
  runSpacing: <span class="hljs-number">12.0</span>, <span class="hljs-comment">// 垂直间距</span>
  children: [
    Chip(label: Text(<span class="hljs-string">'Flutter'</span>)),
    Chip(label: Text(<span class="hljs-string">'Dart'</span>)),
    Chip(label: Text(<span class="hljs-string">'iOS'</span>)),
    Chip(label: Text(<span class="hljs-string">'Android'</span>)),
  ],
)
</code></pre>
<p><strong>可视化效果：</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Flutter]</span> <span class="hljs-number">8px</span> <span class="hljs-selector-attr">[Dart]</span> <span class="hljs-number">8px</span> <span class="hljs-selector-attr">[iOS]</span>
↕️ <span class="hljs-number">12px</span>
<span class="hljs-selector-attr">[Android]</span>
</code></pre>
<hr/>
<h3 data-id="heading-19">4️⃣ alignment（对齐方式）</h3>
<h4 data-id="heading-20">4.1 WrapAlignment枚举值</h4>








































<table><thead><tr><th>枚举值</th><th>说明</th><th>效果</th></tr></thead><tbody><tr><td><strong>start</strong></td><td>起始对齐（默认）</td><td>从左到右</td></tr><tr><td><strong>end</strong></td><td>末尾对齐</td><td>从右到左</td></tr><tr><td><strong>center</strong></td><td>居中对齐</td><td>居中排列</td></tr><tr><td><strong>spaceBetween</strong></td><td>两端对齐</td><td>两端贴边，均分间距</td></tr><tr><td><strong>spaceAround</strong></td><td>间距环绕</td><td>每个组件两侧间距相等</td></tr><tr><td><strong>spaceEvenly</strong></td><td>间距均分</td><td>所有间距完全相等</td></tr></tbody></table>
<h4 data-id="heading-21">4.2 示例对比</h4>
<h5 data-id="heading-22">start（默认）</h5>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  alignment: WrapAlignment.start,
  children: [
    Chip(label: Text(<span class="hljs-string">'A'</span>)),
    Chip(label: Text(<span class="hljs-string">'B'</span>)),
    Chip(label: Text(<span class="hljs-string">'C'</span>)),
  ],
)
</code></pre>
<p><strong>效果：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">[<span class="hljs-string">A</span>][<span class="hljs-symbol">B</span>][<span class="hljs-string">C</span>]<span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_
</code></pre>
<h5 data-id="heading-23">center</h5>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  alignment: WrapAlignment.center,
  children: [
    Chip(label: Text(<span class="hljs-string">'A'</span>)),
    Chip(label: Text(<span class="hljs-string">'B'</span>)),
    Chip(label: Text(<span class="hljs-string">'C'</span>)),
  ],
)
</code></pre>
<p><strong>效果：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">__[<span class="hljs-string">A</span>][<span class="hljs-symbol">B</span>][<span class="hljs-string">C</span>]__</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_
</code></pre>
<h5 data-id="heading-24">spaceBetween</h5>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  alignment: WrapAlignment.spaceBetween,
  spacing: <span class="hljs-number">8</span>,
  children: [
    Chip(label: Text(<span class="hljs-string">'A'</span>)),
    Chip(label: Text(<span class="hljs-string">'B'</span>)),
    Chip(label: Text(<span class="hljs-string">'C'</span>)),
  ],
)
</code></pre>
<p><strong>效果：</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">[A]<span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">__<span class="hljs-emphasis">_[B]_</span>__</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>[C]
</code></pre>
<h4 data-id="heading-25">4.3 runAlignment（纵轴对齐）</h4>
<p>控制<strong>多行之间</strong>的对齐方式。</p>
<pre><code class="hljs language-dart" lang="dart">SizedBox(
  height: <span class="hljs-number">200</span>,
  child: Wrap(
    runAlignment: WrapAlignment.center,  <span class="hljs-comment">// 垂直居中</span>
    children: [...],
  ),
)
</code></pre>
<hr/>
<h3 data-id="heading-26">5️⃣ Wrap实际应用</h3>
<h4 data-id="heading-27">应用1：标签云（Tag Cloud）</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagCloud</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; tags;

  <span class="hljs-keyword">const</span> TagCloud({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.tags});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Wrap(
      spacing: <span class="hljs-number">8</span>,
      runSpacing: <span class="hljs-number">8</span>,
      children: tags.map((tag) {
        <span class="hljs-keyword">return</span> Chip(
          label: Text(tag),
          avatar: CircleAvatar(
            backgroundColor: Colors.blue,
            child: Text(tag[<span class="hljs-number">0</span>]),
          ),
        );
      }).toList(),
    );
  }
}

<span class="hljs-comment">// 使用</span>
TagCloud(
  tags: [<span class="hljs-string">'Flutter'</span>, <span class="hljs-string">'Dart'</span>, <span class="hljs-string">'iOS'</span>, <span class="hljs-string">'Android'</span>, <span class="hljs-string">'Web'</span>],
)
</code></pre>
<h4 data-id="heading-28">应用2：可选择标签</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SelectableTags</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _SelectableTagsState createState() =&gt; _SelectableTagsState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_SelectableTagsState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">SelectableTags</span>&gt; </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; _allTags = [<span class="hljs-string">'前端'</span>, <span class="hljs-string">'后端'</span>, <span class="hljs-string">'移动端'</span>, <span class="hljs-string">'算法'</span>];
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; _selected = [];

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Wrap(
      spacing: <span class="hljs-number">8</span>,
      runSpacing: <span class="hljs-number">8</span>,
      children: _allTags.map((tag) {
        <span class="hljs-keyword">final</span> isSelected = _selected.contains(tag);
        <span class="hljs-keyword">return</span> FilterChip(
          label: Text(tag),
          selected: isSelected,
          onSelected: (selected) {
            setState(() {
              <span class="hljs-keyword">if</span> (selected) {
                _selected.add(tag);
              } <span class="hljs-keyword">else</span> {
                _selected.remove(tag);
              }
            });
          },
        );
      }).toList(),
    );
  }
}
</code></pre>
<h4 data-id="heading-29">应用3：图片网格（自适应列数）</h4>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  spacing: <span class="hljs-number">8</span>,
  runSpacing: <span class="hljs-number">8</span>,
  children: <span class="hljs-built_in">List</span>.generate(
    <span class="hljs-number">20</span>,
    (index) =&gt; Container(
      width: <span class="hljs-number">100</span>,
      height: <span class="hljs-number">100</span>,
      color: Colors.blue,
      child: Center(child: Text(<span class="hljs-string">'<span class="hljs-subst">$index</span>'</span>)),
    ),
  ),
)
</code></pre>
<p><strong>优点：</strong> 根据屏幕宽度自动调整列数</p>
<hr/>
<h3 data-id="heading-30">6️⃣ Flow（高性能自定义布局）</h3>
<h4 data-id="heading-31">6.1 什么是Flow</h4>
<p><code>Flow</code> 是一个对子组件尺寸和位置调整非常高效的控件。</p>
<h4 data-id="heading-32">6.2 Flow的优缺点</h4>
<h5 data-id="heading-33">✅ 优点</h5>
<ol>
<li>
<p><strong>性能好</strong></p>
<ul>
<li>使用转换矩阵（Transform Matrix）优化</li>
<li>重绘时不实际调整组件位置</li>
<li>适合动画场景</li>
</ul>
</li>
<li>
<p><strong>灵活</strong></p>
<ul>
<li>自定义布局策略</li>
<li>完全控制子组件位置</li>
</ul>
</li>
</ol>
<h5 data-id="heading-34">❌ 缺点</h5>
<ol>
<li>
<p><strong>使用复杂</strong></p>
<ul>
<li>需要实现 <code>FlowDelegate</code></li>
<li>手动计算每个子组件位置</li>
</ul>
</li>
<li>
<p><strong>不能自适应</strong></p>
<ul>
<li>Flow不能自适应子组件大小</li>
<li>必须指定固定大小</li>
</ul>
</li>
</ol>
<h4 data-id="heading-35">6.3 FlowDelegate</h4>
<p>需要继承 <code>FlowDelegate</code> 并实现三个方法：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyFlowDelegate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FlowDelegate</span> </span>{
  <span class="hljs-comment">// 1. 绘制子组件（必需）</span>
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> paintChildren(FlowPaintingContext context) {
    <span class="hljs-comment">// 计算并绘制每个子组件</span>
  }

  <span class="hljs-comment">// 2. 返回Flow大小（必需）</span>
  <span class="hljs-meta">@override</span>
  Size getSize(BoxConstraints constraints) {
    <span class="hljs-comment">// 返回Flow的大小</span>
    <span class="hljs-keyword">return</span> Size(width, height);
  }

  <span class="hljs-comment">// 3. 是否需要重绘（必需）</span>
  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">bool</span> shouldRepaint(FlowDelegate oldDelegate) {
    <span class="hljs-keyword">return</span> oldDelegate != <span class="hljs-keyword">this</span>;
  }
}
</code></pre>
<h4 data-id="heading-36">6.4 完整示例</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestFlowDelegate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FlowDelegate</span> </span>{
  <span class="hljs-keyword">final</span> EdgeInsets margin;

  TestFlowDelegate({<span class="hljs-keyword">this</span>.margin = EdgeInsets.zero});

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> paintChildren(FlowPaintingContext context) {
    <span class="hljs-keyword">var</span> x = margin.left;
    <span class="hljs-keyword">var</span> y = margin.top;

    <span class="hljs-comment">// 遍历所有子组件</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; context.childCount; i++) {
      <span class="hljs-keyword">var</span> childSize = context.getChildSize(i)!;
      <span class="hljs-keyword">var</span> w = childSize.width + x + margin.right;

      <span class="hljs-comment">// 判断是否需要换行</span>
      <span class="hljs-keyword">if</span> (w &lt; context.size.width) {
        <span class="hljs-comment">// 当前行能放下</span>
        context.paintChild(
          i,
          transform: Matrix4.translationValues(x, y, <span class="hljs-number">0.0</span>),
        );
        x = w + margin.left;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 需要换行</span>
        x = margin.left;
        y += childSize.height + margin.top + margin.bottom;
        context.paintChild(
          i,
          transform: Matrix4.translationValues(x, y, <span class="hljs-number">0.0</span>),
        );
        x += childSize.width + margin.left + margin.right;
      }
    }
  }

  <span class="hljs-meta">@override</span>
  Size getSize(BoxConstraints constraints) {
    <span class="hljs-comment">// 返回固定大小</span>
    <span class="hljs-keyword">return</span> Size(<span class="hljs-built_in">double</span>.infinity, <span class="hljs-number">200.0</span>);
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">bool</span> shouldRepaint(FlowDelegate oldDelegate) {
    <span class="hljs-keyword">return</span> oldDelegate != <span class="hljs-keyword">this</span>;
  }
}

<span class="hljs-comment">// 使用</span>
Flow(
  delegate: TestFlowDelegate(margin: EdgeInsets.all(<span class="hljs-number">10</span>)),
  children: [
    Container(width: <span class="hljs-number">80</span>, height: <span class="hljs-number">80</span>, color: Colors.red),
    Container(width: <span class="hljs-number">80</span>, height: <span class="hljs-number">80</span>, color: Colors.green),
    Container(width: <span class="hljs-number">80</span>, height: <span class="hljs-number">80</span>, color: Colors.blue),
  ],
)
</code></pre>
<h4 data-id="heading-37">6.5 FlowPaintingContext方法</h4>

























<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>childCount</code></td><td>子组件数量</td></tr><tr><td><code>getChildSize(int i)</code></td><td>获取第i个子组件的尺寸</td></tr><tr><td><code>paintChild(int i, {...})</code></td><td>绘制第i个子组件</td></tr><tr><td><code>size</code></td><td>Flow的尺寸</td></tr></tbody></table>
<h4 data-id="heading-38">6.6 何时使用Flow</h4>





























<table><thead><tr><th>场景</th><th>推荐</th></tr></thead><tbody><tr><td><strong>简单流式布局</strong></td><td>❌ 用Wrap</td></tr><tr><td><strong>需要动画</strong></td><td>✅ 用Flow</td></tr><tr><td><strong>需要精确控制位置</strong></td><td>✅ 用Flow</td></tr><tr><td><strong>性能要求极高</strong></td><td>✅ 用Flow</td></tr><tr><td><strong>大多数情况</strong></td><td>❌ 用Wrap</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-39">🤔 常见问题（FAQ）</h3>
<h4 data-id="heading-40">Q1: Wrap和Flow的区别？</h4>
<p><strong>A:</strong></p>



































<table><thead><tr><th>特性</th><th>Wrap</th><th>Flow</th></tr></thead><tbody><tr><td><strong>易用性</strong></td><td>简单，开箱即用</td><td>复杂，需要自定义</td></tr><tr><td><strong>性能</strong></td><td>好</td><td>更好（转换矩阵优化）</td></tr><tr><td><strong>灵活性</strong></td><td>固定规则</td><td>完全自定义</td></tr><tr><td><strong>自适应</strong></td><td>✅ 自动适应子组件</td><td>❌ 需要指定大小</td></tr><tr><td><strong>推荐场景</strong></td><td>大多数场景</td><td>动画、高性能需求</td></tr></tbody></table>
<p><strong>建议：</strong> 优先使用Wrap，只有在特殊需求下才用Flow</p>
<h4 data-id="heading-41">Q2: spacing和runSpacing的区别？</h4>
<p><strong>A:</strong></p>
<ul>
<li><strong>spacing</strong>：主轴方向间距（同一行/列内）</li>
<li><strong>runSpacing</strong>：纵轴方向间距（不同行/列之间）</li>
</ul>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  spacing: <span class="hljs-number">8</span>,     <span class="hljs-comment">// 水平间距（同行内）</span>
  runSpacing: <span class="hljs-number">12</span>, <span class="hljs-comment">// 垂直间距（行之间）</span>
  children: [
    Text(<span class="hljs-string">'A'</span>), Text(<span class="hljs-string">'B'</span>), Text(<span class="hljs-string">'C'</span>),
    Text(<span class="hljs-string">'D'</span>), Text(<span class="hljs-string">'E'</span>), Text(<span class="hljs-string">'F'</span>),
  ],
)
</code></pre>
<p><strong>可视化：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[A]</span> <span class="hljs-number">8px</span> <span class="hljs-selector-attr">[B]</span> <span class="hljs-number">8px</span> <span class="hljs-selector-attr">[C]</span>
↕️ <span class="hljs-number">12px</span> (runSpacing)
<span class="hljs-selector-attr">[D]</span> <span class="hljs-number">8px</span> <span class="hljs-selector-attr">[E]</span> <span class="hljs-number">8px</span> <span class="hljs-selector-attr">[F]</span>
</code></pre>
<h4 data-id="heading-42">Q3: Wrap如何实现等宽子组件？</h4>
<p><strong>A:</strong> Wrap的子组件是自然宽度，不支持等宽。可以用以下方案：</p>
<h5 data-id="heading-43">方案1：固定宽度</h5>
<pre><code class="hljs language-dart" lang="dart">Wrap(
  spacing: <span class="hljs-number">8</span>,
  runSpacing: <span class="hljs-number">8</span>,
  children: <span class="hljs-built_in">List</span>.generate(<span class="hljs-number">10</span>, (i) {
    <span class="hljs-keyword">return</span> SizedBox(
      width: <span class="hljs-number">100</span>,  <span class="hljs-comment">// 固定宽度</span>
      child: Chip(label: Text(<span class="hljs-string">'Item <span class="hljs-subst">$i</span>'</span>)),
    );
  }),
)
</code></pre>
<h5 data-id="heading-44">方案2：计算宽度</h5>
<pre><code class="hljs language-dart" lang="dart">LayoutBuilder(
  builder: (context, constraints) {
    <span class="hljs-comment">// 计算每行3个，自动计算宽度</span>
    <span class="hljs-keyword">final</span> itemWidth = (constraints.maxWidth - <span class="hljs-number">16</span>) / <span class="hljs-number">3</span>;
    <span class="hljs-keyword">return</span> Wrap(
      spacing: <span class="hljs-number">8</span>,
      runSpacing: <span class="hljs-number">8</span>,
      children: <span class="hljs-built_in">List</span>.generate(<span class="hljs-number">10</span>, (i) {
        <span class="hljs-keyword">return</span> SizedBox(
          width: itemWidth,
          child: Chip(label: Text(<span class="hljs-string">'<span class="hljs-subst">$i</span>'</span>)),
        );
      }),
    );
  },
)
</code></pre>
<h4 data-id="heading-45">Q4: Flow的性能为什么更好？</h4>
<p><strong>A:</strong> Flow使用<strong>转换矩阵</strong>（Transform Matrix）而不是实际移动组件：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Wrap：实际改变组件位置（重新布局）</span>
Container(
  margin: EdgeInsets.only(left: <span class="hljs-number">100</span>),  <span class="hljs-comment">// 实际移动</span>
  child: Widget(),
)

<span class="hljs-comment">// Flow：使用转换矩阵（不重新布局）</span>
context.paintChild(
  i,
  transform: Matrix4.translationValues(<span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),  <span class="hljs-comment">// 矩阵变换</span>
)
</code></pre>
<p><strong>转换矩阵优势：</strong></p>
<ul>
<li>不触发布局（Layout）阶段</li>
<li>只触发绘制（Paint）阶段</li>
<li>GPU加速</li>
<li>适合动画</li>
</ul>
<h4 data-id="heading-46">Q5: Wrap如何限制最大行数？</h4>
<p><strong>A:</strong> Wrap本身不支持限制行数，可以结合其他组件：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 方案1：用LimitedBox限制高度</span>
LimitedBox(
  maxHeight: <span class="hljs-number">100</span>,  <span class="hljs-comment">// 限制最大高度</span>
  child: SingleChildScrollView(
    child: Wrap(
      children: [...],
    ),
  ),
)

<span class="hljs-comment">// 方案2：手动截取子组件</span>
Wrap(
  children: items.take(<span class="hljs-number">12</span>).toList(),  <span class="hljs-comment">// 只显示前12个</span>
)

<span class="hljs-comment">// 方案3：用ClipRect裁剪</span>
ClipRect(
  child: Container(
    height: <span class="hljs-number">100</span>,
    child: Wrap(
      children: [...],
    ),
  ),
)
</code></pre>
<hr/>
<h3 data-id="heading-47">🎯 跟着做练习</h3>
<h4 data-id="heading-48">练习1：实现一个技能标签云</h4>
<p><strong>目标：</strong> 创建可点击的技能标签，点击后切换选中状态</p>
<p><strong>步骤：</strong></p>
<ol>
<li>使用Wrap布局</li>
<li>用ChoiceChip实现选择效果</li>
<li>维护选中状态</li>
</ol>
<details>
<summary>💡 查看答案</summary>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SkillTags</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> SkillTags({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;SkillTags&gt; createState() =&gt; _SkillTagsState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_SkillTagsState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">SkillTags</span>&gt; </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; _skills = [
    <span class="hljs-string">'Flutter'</span>, <span class="hljs-string">'Dart'</span>, <span class="hljs-string">'iOS'</span>, <span class="hljs-string">'Android'</span>,
    <span class="hljs-string">'React'</span>, <span class="hljs-string">'Vue'</span>, <span class="hljs-string">'Node.js'</span>, <span class="hljs-string">'Python'</span>,
    <span class="hljs-string">'Java'</span>, <span class="hljs-string">'Kotlin'</span>, <span class="hljs-string">'Swift'</span>, <span class="hljs-string">'TypeScript'</span>,
  ];
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Set</span>&lt;<span class="hljs-built_in">String</span>&gt; _selected = {};

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        <span class="hljs-keyword">const</span> Text(
          <span class="hljs-string">'请选择您擅长的技能：'</span>,
          style: TextStyle(fontSize: <span class="hljs-number">16</span>, fontWeight: FontWeight.bold),
        ),
        <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">12</span>),
        Wrap(
          spacing: <span class="hljs-number">8</span>,
          runSpacing: <span class="hljs-number">8</span>,
          children: _skills.map((skill) {
            <span class="hljs-keyword">final</span> isSelected = _selected.contains(skill);
            <span class="hljs-keyword">return</span> ChoiceChip(
              label: Text(skill),
              selected: isSelected,
              onSelected: (selected) {
                setState(() {
                  <span class="hljs-keyword">if</span> (selected) {
                    _selected.add(skill);
                  } <span class="hljs-keyword">else</span> {
                    _selected.remove(skill);
                  }
                });
              },
            );
          }).toList(),
        ),
        <span class="hljs-keyword">if</span> (_selected.isNotEmpty) ...[
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
          Text(
            <span class="hljs-string">'已选择 <span class="hljs-subst">${_selected.length}</span> 项：<span class="hljs-subst">${_selected.join(<span class="hljs-string">'、'</span>)}</span>'</span>,
            style: <span class="hljs-keyword">const</span> TextStyle(color: Colors.blue),
          ),
        ],
      ],
    );
  }
}
</code></pre>
</details>
<hr/>
<h4 data-id="heading-49">练习2：实现一个自定义Flow动画</h4>
<p><strong>目标：</strong> 创建一个圆形排列的Flow布局</p>
<p><strong>步骤：</strong></p>
<ol>
<li>继承FlowDelegate</li>
<li>在paintChildren中计算圆形位置</li>
<li>使用三角函数计算坐标</li>
</ol>
<details>
<summary>💡 查看答案</summary>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:math'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CircleFlowDelegate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FlowDelegate</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> radius;

  CircleFlowDelegate({<span class="hljs-keyword">this</span>.radius = <span class="hljs-number">80</span>});

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> paintChildren(FlowPaintingContext context) {
    <span class="hljs-keyword">final</span> centerX = context.size.width / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">final</span> centerY = context.size.height / <span class="hljs-number">2</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; context.childCount; i++) {
      <span class="hljs-keyword">final</span> angle = (<span class="hljs-number">2</span> * pi / context.childCount) * i;
      <span class="hljs-keyword">final</span> x = centerX + radius * cos(angle) - <span class="hljs-number">20</span>;  <span class="hljs-comment">// 20是子组件宽度的一半</span>
      <span class="hljs-keyword">final</span> y = centerY + radius * sin(angle) - <span class="hljs-number">20</span>;

      context.paintChild(
        i,
        transform: Matrix4.translationValues(x, y, <span class="hljs-number">0.0</span>),
      );
    }
  }

  <span class="hljs-meta">@override</span>
  Size getSize(BoxConstraints constraints) {
    <span class="hljs-keyword">return</span> Size(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>);
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">bool</span> shouldRepaint(CircleFlowDelegate oldDelegate) {
    <span class="hljs-keyword">return</span> radius != oldDelegate.radius;
  }
}

<span class="hljs-comment">// 使用</span>
Flow(
  delegate: CircleFlowDelegate(radius: <span class="hljs-number">80</span>),
  children: <span class="hljs-built_in">List</span>.generate(
    <span class="hljs-number">8</span>,
    (i) =&gt; Container(
      width: <span class="hljs-number">40</span>,
      height: <span class="hljs-number">40</span>,
      decoration: BoxDecoration(
        color: Colors.blue,
        shape: BoxShape.circle,
      ),
      child: Center(
        child: Text(
          <span class="hljs-string">'<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>'</span>,
          style: <span class="hljs-keyword">const</span> TextStyle(color: Colors.white),
        ),
      ),
    ),
  ),
)
</code></pre>
</details>
<hr/>
<h3 data-id="heading-50">📋 小结</h3>
<h4 data-id="heading-51">核心概念</h4>




















<table><thead><tr><th>组件</th><th>说明</th><th>使用场景</th></tr></thead><tbody><tr><td><strong>Wrap</strong></td><td>自动换行布局</td><td>标签云、按钮组、图片网格</td></tr><tr><td><strong>Flow</strong></td><td>高性能自定义布局</td><td>动画、复杂布局策略</td></tr></tbody></table>
<h4 data-id="heading-52">Wrap常用属性</h4>






























<table><thead><tr><th>属性</th><th>说明</th><th>常用值</th></tr></thead><tbody><tr><td><code>spacing</code></td><td>主轴间距</td><td>8.0</td></tr><tr><td><code>runSpacing</code></td><td>纵轴间距</td><td>8.0</td></tr><tr><td><code>alignment</code></td><td>主轴对齐</td><td>start/center</td></tr><tr><td><code>runAlignment</code></td><td>纵轴对齐</td><td>start/center</td></tr></tbody></table>
<h4 data-id="heading-53">Flow关键方法</h4>





















<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>paintChildren()</code></td><td>计算并绘制子组件位置</td></tr><tr><td><code>getSize()</code></td><td>返回Flow的尺寸</td></tr><tr><td><code>shouldRepaint()</code></td><td>是否需要重绘</td></tr></tbody></table>
<h4 data-id="heading-54">记忆技巧</h4>
<ol>
<li><strong>Wrap首选</strong>：90%场景用Wrap</li>
<li><strong>spacing记忆</strong>：spacing = 同行间距，runSpacing = 行间距</li>
<li><strong>Flow性能好</strong>：转换矩阵优化</li>
<li><strong>Flow很少用</strong>：除非特殊需求</li>
</ol>
<hr/>
<h3 data-id="heading-55">🔗 相关资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fwidgets%2FWrap-class.html" target="_blank" title="https://api.flutter.dev/flutter/widgets/Wrap-class.html" ref="nofollow noopener noreferrer">Wrap 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Fwidgets%2FFlow-class.html" target="_blank" title="https://api.flutter.dev/flutter/widgets/Flow-class.html" ref="nofollow noopener noreferrer">Flow 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.flutter.dev%2Fflutter%2Frendering%2FFlowDelegate-class.html" target="_blank" title="https://api.flutter.dev/flutter/rendering/FlowDelegate-class.html" ref="nofollow noopener noreferrer">FlowDelegate 官方文档</a></li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【跨国数仓迁移最佳实践 12】阿里云 MaxCompute 实现 BigQuery 10 万条 SQL 智能转写迁移]]></title>    <link>https://juejin.cn/post/7574404398067482624</link>    <guid>https://juejin.cn/post/7574404398067482624</guid>    <pubDate>2025-11-20T10:06:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574404398067482624" data-draft-id="7574529034673012771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【跨国数仓迁移最佳实践 12】阿里云 MaxCompute 实现 BigQuery 10 万条 SQL 智能转写迁移"/> <meta itemprop="keywords" content="大数据,SQL"/> <meta itemprop="datePublished" content="2025-11-20T10:06:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【跨国数仓迁移最佳实践 12】阿里云 MaxCompute 实现 BigQuery 10 万条 SQL 智能转写迁移
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T10:06:27.000Z" title="Thu Nov 20 2025 10:06:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>作者：曹霖</strong></p>
<p>本系列文章将围绕东南亚头部科技集团的真实迁移历程展开，逐步拆解 BigQuery 迁移至 MaxCompute 过程中的关键挑战与技术创新。本篇为第十二篇，基于 阿里云MaxCompute 实现BigQuery 10万条SQL智能转写迁移。</p>
<p>注：客户为东南亚头部科技集团，文中用 GoTerra 表示。</p>
<h2 data-id="heading-0">一、项目背景</h2>
<p>在全球化和数字化加速的浪潮下，越来越多的企业出于成本优化、合规要求和业务协同等原因，考虑将自建或三方大数据平台迁移至阿里云MaxCompute。本案例基于是东南亚头部科技集团 GoTerra，其业务生态覆盖网约车、电商、外卖、物流及金融支付等多个垂直领域，多年运行在 Google Cloud BigQuery 的数仓平台，基于综合优势分析规划全量迁移至阿里云 MaxCompute。</p>
<p>相比数据搬迁本身，迁移过程中一个更为棘手的挑战是：</p>
<ul>
<li><strong>10 万条 SQL 脚本的高质量快速转写</strong>。这其中既包含简短的分析 SQL，也包含上万行、嵌套极深的复杂 ETL 逻辑。</li>
<li>脚本广泛使用了 BigQuery 特有的语法、函数（如 <code>UNNEST</code>、<code>SAFE_CAST</code>、<code>FORMAT_DATE</code>）、复杂数据类型（<code>ARRAY</code>、<code>STRUCT</code>、<code>BIGNUMERIC</code>）和独有优化模式。</li>
<li>在历史业务沉淀下，不少 SQL 逻辑与业务规则、数据模型紧密绑定，稍有不慎便会影响数据产品准确性。</li>
</ul>
<p>传统人力转写方式显然不现实。内部测算显示：</p>
<ul>
<li>假设工程师日均高质量转写 5 条 SQL，则需 <strong>2 万人天</strong>；</li>
<li>即便 100 人并行，也要近 <strong>1 年</strong>才能完成，远超半年上线目标。</li>
<li>质量一致性无法保障，知识传递和规则固化存在巨大难度，回归测试成本高昂。</li>
</ul>
<p>在这样背景下，团队必须找到 <strong>自动化+协同化的工程化解法</strong>，提升 SQL 转换率，实现大规模、可控的迁移。</p>
<h2 data-id="heading-1">二、解决方案</h2>
<h3 data-id="heading-2">整体策略</h3>
<p>我们基于阿里云 <strong>Cloud Migration Hub（CMH）/ Lake Migration Hub（LMH）</strong> 自动化迁移能力，配合自研规则引擎、AST（抽象语法树）转换、大语言模型（LLM）辅助和人工修正，构建“一条龙”的 <strong>工具主导+人工兜底</strong> 方案，并在迁移过程中沉淀可复用的 <strong>迁移知识库</strong>。</p>
<p>迁移整体分为两大阶段：</p>
<ol>
<li><strong>数据迁移</strong>：将 BigQuery 表数据平滑搬迁到 MaxCompute（包括全量及后续增量），使用在线迁移、MMS（MaxCompute Migration Serverless） 等。</li>
<li><strong>SQL 转写</strong>：借助 CMH/LMH 自动化批量转换 SQL，并通过规则迭代、LLM 增强、人工修正，实现高准确率交付。</li>
</ol>
<h3 data-id="heading-3">数据迁移与SQL转写迁移方案的技术实现与优化</h3>
<p>基于阿里云Cloud Migration Hub（CMH）/Lake Migration Hub（LMH）的自动化迁移能力，结合自主研发的规则引擎、抽象语法树（AST）转换技术、大语言模型（LLM）辅助及人工修正机制，我们构建了一套“工具主导+人工兜底”的端到端迁移解决方案。该方案不仅实现了从数据层到应用层的全栈迁移，还通过迁移知识库的持续沉淀，显著提升了迁移效率与准确性。迁移过程分为以下两个核心阶段：</p>
<h4 data-id="heading-4">第一阶段：数据迁移——保障数据平滑过渡的全生命周期管理</h4>
<p>数据迁移是整个迁移工程的基础，其核心目标是将源端BigQuery的数据无缝迁移到阿里云MaxCompute，并确保迁移过程的高可用性、一致性和可扩展性。</p>
<p><strong>工具与架构</strong>：采用阿里云在线迁移工具（Online Migration）和MMS（MaxCompute Migration Serverless）进行全量数据迁移。在线迁移工具通过分布式架构实现高吞吐量传输，支持断点续传和错误重试机制，确保大规模数据（如PB级）的稳定迁移。MMS则通过Serverless服务化模式，按需分配计算资源，降低运维复杂度。</p>
<h4 data-id="heading-5">第二阶段：SQL转写——自动化与人工协同的智能转换</h4>
<p>SQL转写是迁移过程中技术难度最高的环节，涉及语法、函数、UDF（用户定义函数）及性能优化的复杂转换。我们通过“自动化为主，人工为辅”的分层策略，结合AST分析、规则引擎和LLM技术，实现高准确率的SQL转换。</p>
<h5 data-id="heading-6">1. 自动化转换引擎</h5>
<ul>
<li><strong>AST语法树解析</strong>：基于ANTLR或自研解析器构建BigQuery SQL的抽象语法树（AST），逐层分析语法结构。例如，将BigQuery的<code>SELECT APPROX_COUNT_DISTINCT(column)</code>转换为MaxCompute的<code>SELECT COUNT(DISTINCT column)</code>，并通过AST节点替换实现。</li>
<li><strong>规则引擎迭代优化</strong>：
<ul>
<li><strong>内置规则库</strong>：预置超过200条迁移规则，覆盖数据类型映射（如BigQuery的<code>TIMESTAMP</code>→MaxCompute的<code>DATETIME</code>）、函数替换（如<code>SAFE</code>函数的兼容性处理）、窗口函数调整等场景。</li>
<li><strong>动态规则扩展</strong>：通过迁移知识库的实时反馈，持续迭代规则库。例如，若发现某类CASE-WHEN嵌套语句转换失败，可立即新增规则并重新运行转换流程。</li>
</ul>
</li>
<li><strong>LLM辅助转换</strong>：针对复杂或模糊的SQL语句（如自定义UDF或依赖源端特定语法的查询），利用大语言模型（如通义千问）进行语义解析和意图理解。例如，将BigQuery的<code>STRUCT</code>类型转换为MaxCompute的<code>LATERAL VIEW</code>表达式，LLM可辅助生成等效逻辑的SQL代码。</li>
</ul>
<h5 data-id="heading-7">2. 人工修正与质量控制</h5>
<ul>
<li><strong>自动化缺陷定位</strong>：通过静态代码分析工具和动态执行测试（在测试环境中运行转换后的SQL），快速定位转换失败的语句。例如，若转换后的SQL在MaxCompute执行时因类型不匹配报错，系统将标记该SQL并提示可能的修复方向。</li>
<li><strong>专家介入流程</strong>：
<ul>
<li><strong>优先级分级</strong>：根据错误类型（如语法错误、性能隐患、业务逻辑偏差）和影响范围，将问题分为P0-P3等级，优先处理高风险缺陷。</li>
<li><strong>协同开发环境</strong>：提供基于IDE的联机调试工具，允许开发者直接修改转换后的SQL，并通过版本控制系统（如Git）管理修改记录，确保可追溯性。</li>
</ul>
</li>
<li><strong>迁移知识库的闭环反馈</strong>：每次人工修正后，系统自动提取修正前后的SQL差异，并将其归类为新规则或案例存入知识库。例如，若某次修正解决了BigQuery的<code>ARRAY_AGG</code>到MaxCompute的<code>COLLECT_SET</code>转换问题，该规则将被优先级提升，并在后续迁移中自动应用。</li>
</ul>
<h5 data-id="heading-8">3. 转换后验证与优化</h5>
<ul>
<li><strong>功能验证</strong>：在测试集群中执行转换后的SQL，对比源端和目标端的查询结果，确保业务逻辑一致性。</li>
<li><strong>性能调优</strong>：利用MaxCompute的执行计划分析工具，识别转换后SQL的性能瓶颈（如全表扫描、Join顺序不当），并通过索引优化、分区裁剪或谓词下推等手段提升效率。</li>
<li><strong>迁移知识库的持续优化</strong>：将验证过程中发现的性能优化策略（如特定函数转换方式）补充至知识库，形成“迁移-修正-优化”的闭环。</li>
</ul>
<h4 data-id="heading-9">迁移知识库的核心价值与应用场景</h4>
<p>迁移知识库是整个方案的关键支撑，其价值体现在以下方面：</p>
<ol>
<li>
<p><strong>规则复用与加速迭代</strong>：通过积累迁移规则、缺陷案例和最佳实践，新项目可直接调用知识库中的已有规则，减少重复性开发。例如，某金融客户在迁移过程中发现BigQuery的<code>DATE_TRUNC</code>函数在MaxCompute中需配合<code>DATE_FORMAT</code>使用，该规则可直接复用至其他项目。</p>
</li>
<li>
<p><strong>风险预判与质量提升</strong>：知识库中的历史案例可辅助迁移前的风险评估，例如提前识别BigQuery的<code>ML_*</code>机器学习函数在MaxCompute中的替代方案，避免迁移后期的返工。</p>
</li>
<li>
<p><strong>跨团队协作与知识传承</strong>：知识库采用统一的Markdown格式和分类标签（如按场景、工具、复杂度分类），支持多团队并行查阅与贡献，降低隐性知识流失风险。</p>
</li>
</ol>
<h4 data-id="heading-10">技术优势与迁移成效</h4>
<p>通过上述技术方案，我们实现了以下显著优势：</p>
<ul>
<li><strong>迁移效率提升</strong>：相比纯人工迁移，自动化工具将SQL转写效率提升80%以上，单项目迁移周期从数年缩短至数月。</li>
<li><strong>准确性保障</strong>：结合规则引擎与LLM的双通道验证，部分场景SQL转换准确率超过90%，人工修正仅需处理约10%的复杂场景。</li>
<li><strong>成本优化</strong>：通过MMS的Serverless模式和按需计费机制，降低数据迁移成本，同时减少因停机迁移导致的业务损失。</li>
</ul>
<h2 data-id="heading-11">三、核心技术</h2>
<h3 data-id="heading-12">1. SQL 转换主流技术：AST 驱动</h3>
<p>相比复杂且易出错的正则/模板替换，AST 驱动的 SQL 转换具备可扩展、高可维护等优势：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b99cb3b509144cc84dee5c06eb7479e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237987&amp;x-signature=Mj%2FlUCpGQlDUaUIZW9zzpwvUHtU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>流程</strong>：</p>
<ol>
<li>
<p><strong>Parse</strong>：将 BigQuery SQL 解析为抽象语法树（AST），保留结构和节点类型（SELECT、FROM、FUNCTION_CALL 等）。</p>
</li>
<li>
<p><strong>Transform</strong>：按规则库替换/重构 AST 节点，例如：</p>
<ul>
<li>
<p><code>FORMAT_DATE('%Y-%m-%d', col)</code> → <code>TO_CHAR(col, 'yyyy-MM-dd')</code></p>
</li>
<li>
<p><code>UNNEST(array_col)</code> → <code>LATERAL VIEW EXPLODE(array_col)</code></p>
</li>
<li>
<p>隐式类型转换规则修正</p>
</li>
</ul>
</li>
<li>
<p><strong>Generate</strong>：输出目标 MaxCompute SQL。</p>
</li>
</ol>
<p><strong>优势</strong>：</p>
<ul>
<li>对复杂嵌套、长 SQL 稳定性高</li>
<li>易于增量维护规则</li>
<li>可结合类型系统和元数据增强（RAG 思路）</li>
</ul>
<h3 data-id="heading-13">2. SQL 转换示例</h3>
<p><strong>BigQuery SQL</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> FORMAT_DATE(<span class="hljs-string">'%Y-%m-%d'</span>, order_time) <span class="hljs-keyword">AS</span> order_date,
       <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">AS</span> uv
<span class="hljs-keyword">FROM</span> `project.dataset.orders`
<span class="hljs-keyword">WHERE</span> order_time <span class="hljs-operator">&gt;=</span> DATE_SUB(<span class="hljs-built_in">CURRENT_DATE</span>(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">30</span> <span class="hljs-keyword">DAY</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> order_date;

</code></pre>
<p><strong>MaxCompute SQL</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> TO_CHAR(order_time, <span class="hljs-string">'yyyy-MM-dd'</span>) <span class="hljs-keyword">AS</span> order_date,
       <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">AS</span> uv
<span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> order_time <span class="hljs-operator">&gt;=</span> DATEADD(<span class="hljs-built_in">CURRENT_DATE</span>, <span class="hljs-number">-30</span>)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> order_date;

</code></pre>
<p><strong>映射规则</strong>：</p>
<ul>
<li><code>FORMAT_DATE</code> → <code>TO_CHAR</code>（参数位置调整）</li>
<li><code>DATE_SUB</code> → <code>DATEADD</code>（顺序/符号兼容）</li>
<li>去除 BigQuery 数据集前缀</li>
<li>类型映射：DATE 保持一致，BIGINT 替换 INT64</li>
</ul>
<h3 data-id="heading-14">3. SQL转写流程</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/617587520bfe4c758593d0f3538ab912~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237987&amp;x-signature=c1vLs3c3zE%2BiWac1SM6XJUR4pHA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-15">4. 行业实践与趋势</h3>
<p>在多家企业的跨云 SQL 迁移中，总结出几条趋势：</p>
<ul>
<li><strong>AST+规则库</strong> 是工程实践中相对高效可控的技术路径</li>
<li><strong>LLM 加持的混合模式</strong> 在处理尾部长尾复杂 SQL 时展现价值</li>
<li><strong>知识库驱动持续优化</strong> 可复用性强，提升 ROI</li>
<li><strong>平台自适配增强</strong> 比单纯靠转换器更能保障业务一致性</li>
</ul>
<h2 data-id="heading-16">四、小结与未来展望</h2>
<p><strong>本项目成果</strong>：</p>
<ul>
<li>在 4 个月内完成 SQL 转写任务，比计划提前 1 个月上线</li>
<li>工具转换率从 5%→80%，人工成本下降 70%+</li>
<li>沉淀上千条规则和案例，形成可复用的 SQL 迁移知识库</li>
<li>平台能力增强，提升未来兼容性</li>
</ul>
<p><strong>展望</strong>：</p>
<ul>
<li>推动 CMH/LMH 全自动化迁移平台，支持更多方言（Snowflake、Databricks 等）</li>
<li>引入在线实时 SQL 转换 API，支持多云混合分析</li>
<li>结合执行计划与成本模型的自动化 SQL 优化器</li>
<li>依托知识库与 RAG 提高 LLM 转换一致性与可解释性</li>
</ul>
<p><strong>参考研究</strong>：</p>
<ul>
<li>《Mallet: SQL Dialect Translation with LLM Rule Generation》</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[umi4暗黑模式设置]]></title>    <link>https://juejin.cn/post/7574651025727275046</link>    <guid>https://juejin.cn/post/7574651025727275046</guid>    <pubDate>2025-11-20T10:00:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574651025727275046" data-draft-id="7574625040660807730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="umi4暗黑模式设置"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T10:00:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="七淮"/> <meta itemprop="url" content="https://juejin.cn/user/1467169116000585"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            umi4暗黑模式设置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1467169116000585/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    七淮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T10:00:13.000Z" title="Thu Nov 20 2025 10:00:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">umi4 max + antd5 全局暗黑模式设置</h2>
<h3 data-id="heading-1">方案一 (错误-只能设置layout content内部 模式切换)</h3>
<h4 data-id="heading-2">效果</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3364fa0e996c4708948813943cd72dd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD5reu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237894&amp;x-signature=DmL5HZqV4oiyblkyESrnchkcnSY%3D" alt="Snipaste_2025-11-20_17-59-05.PNG" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">layout</span>: <span class="hljs-title class_">RunTimeLayoutConfig</span> = <span class="hljs-function">(<span class="hljs-params">{ initialState }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">layout</span>: <span class="hljs-string">'mix'</span>,
    <span class="hljs-attr">logo</span>: <span class="hljs-string">'https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg'</span>,
    <span class="hljs-attr">menu</span>: {
      <span class="hljs-attr">locale</span>: <span class="hljs-literal">false</span>
    },
    <span class="hljs-attr">childrenRender</span>: <span class="hljs-function">(<span class="hljs-params">children</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ConfigProvider</span>
          <span class="hljs-attr">theme</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">algorithm:</span> <span class="hljs-attr">initialState</span>?<span class="hljs-attr">.theme</span> === <span class="hljs-string">'dark'</span> ? <span class="hljs-attr">theme.darkAlgorithm</span> <span class="hljs-attr">:</span> <span class="hljs-attr">theme.defaultAlgorithm</span> }}&gt;</span>
          {children}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ConfigProvider</span>&gt;</span></span>
      );
    }
  };
};
</code></pre>
<h3 data-id="heading-3">方案二通过自定义切换逻辑全局配置 (可实现整体layout区域暗黑)</h3>
<h4 data-id="heading-4">效果</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbea1fde18a745a7b4385c5d69956636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD5reu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237894&amp;x-signature=svPTIoOwHtBQUoKfBjgKK6SjGSU%3D" alt="Snipaste_2025-11-20_17-48-49.PNG" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">layout</span>: <span class="hljs-title class_">RunTimeLayoutConfig</span> = <span class="hljs-function">(<span class="hljs-params">{ initialState }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">layout</span>: <span class="hljs-string">'mix'</span>,
    <span class="hljs-attr">logo</span>: <span class="hljs-string">'https://img.alicdn.com/tfs/TB1YHEpwUT1gK0jSZFhXXaAtVXa-28-27.svg'</span>,
    <span class="hljs-attr">menu</span>: {
      <span class="hljs-attr">locale</span>: <span class="hljs-literal">false</span>
    },
    <span class="hljs-attr">rightRender</span>: <span class="hljs-function">() =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RightRender</span>/&gt;</span></span>, <span class="hljs-comment">//这里内部控制切换</span>
    <span class="hljs-attr">childrenRender</span>: <span class="hljs-function">(<span class="hljs-params">children</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ConfigProvider</span>
          <span class="hljs-attr">theme</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">algorithm:</span> <span class="hljs-attr">initialState</span>?<span class="hljs-attr">.theme</span> === <span class="hljs-string">'dark'</span> ? <span class="hljs-attr">theme.darkAlgorithm</span> <span class="hljs-attr">:</span> <span class="hljs-attr">theme.defaultAlgorithm</span> }}&gt;</span>
          {children}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ConfigProvider</span>&gt;</span></span>
      );
    }
  };
};
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">IUserInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types'</span>;
<span class="hljs-keyword">import</span> storage <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/storage'</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">LogoutOutlined</span>,
  <span class="hljs-title class_">MoonOutlined</span>,
  <span class="hljs-title class_">SunOutlined</span>,
  <span class="hljs-title class_">UserOutlined</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/icons'</span>;
<span class="hljs-keyword">import</span> { history, useModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'@umijs/max'</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">Avatar</span>,
  <span class="hljs-title class_">Dropdown</span>,
  <span class="hljs-title class_">Switch</span>,
  message,
  theme
} <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useAntdConfigSetter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@umijs/max'</span>; <span class="hljs-comment">//  需要打开配置才不会报错 antd: { configProvider: {} },</span>

<span class="hljs-keyword">const</span> { darkAlgorithm, defaultAlgorithm } = theme;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">RightRender</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { initialState, setInitialState } = <span class="hljs-title function_">useModel</span>(<span class="hljs-string">'@@initialState'</span>);
  <span class="hljs-comment">// 从 initialState 获取用户信息</span>
  <span class="hljs-keyword">const</span> userInfo = initialState?.<span class="hljs-property">person</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">IUserInfo</span>;

  <span class="hljs-keyword">const</span> setAntdConfig = <span class="hljs-title function_">useAntdConfigSetter</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setAntdConfig'</span>, setAntdConfig);

  <span class="hljs-keyword">const</span> [dark, setDark] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-comment">// 重点处理逻辑</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleThemeChange</span> = (<span class="hljs-params">checked: <span class="hljs-built_in">boolean</span></span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'checked'</span>, checked);
    <span class="hljs-title function_">setDark</span>(checked);
    <span class="hljs-title function_">setAntdConfig</span>({
      <span class="hljs-attr">theme</span>: {
        <span class="hljs-attr">algorithm</span>: [
          checked ? darkAlgorithm : defaultAlgorithm
        ]
      }
    });
  };

  <span class="hljs-comment">// 退出登录处理函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      storage.<span class="hljs-title function_">clearAll</span>();
      <span class="hljs-comment">// 更新初始状态</span>
      <span class="hljs-title function_">setInitialState</span>(<span class="hljs-literal">undefined</span>);
      history.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>);
      message.<span class="hljs-title function_">success</span>(<span class="hljs-string">'退出登录成功'</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      message.<span class="hljs-title function_">error</span>(<span class="hljs-string">'退出登录失败'</span>);
    }
  };

  <span class="hljs-comment">// 下拉菜单项</span>
  <span class="hljs-keyword">const</span> menuItems = [
    {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'logout'</span>,
      <span class="hljs-attr">icon</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">LogoutOutlined</span> /&gt;</span></span>,
      <span class="hljs-attr">label</span>: <span class="hljs-string">'退出登录'</span>,
      <span class="hljs-attr">onClick</span>: handleLogout
    }
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">16px</span>' }}&gt;</span>
      {/* 暗黑模式切换 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">8px</span>' }}&gt;</span>
        {dark ? <span class="hljs-tag">&lt;<span class="hljs-name">MoonOutlined</span> /&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">SunOutlined</span> /&gt;</span>}
        <span class="hljs-tag">&lt;<span class="hljs-name">Switch</span>
          <span class="hljs-attr">checked</span>=<span class="hljs-string">{dark}</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleThemeChange}</span>
          <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      {/* 用户头像和下拉菜单 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Dropdown</span>
        <span class="hljs-attr">menu</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">items:</span> <span class="hljs-attr">menuItems</span> }}
        <span class="hljs-attr">placement</span>=<span class="hljs-string">"bottomRight"</span>
        <span class="hljs-attr">trigger</span>=<span class="hljs-string">{[</span>'<span class="hljs-attr">hover</span>']}
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>', <span class="hljs-attr">cursor:</span> '<span class="hljs-attr">pointer</span>' }}
        &gt;</span>
          {userInfo.headImg ? (
            <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span>
              <span class="hljs-attr">src</span>=<span class="hljs-string">{</span>
                &lt;<span class="hljs-attr">img</span> <span class="hljs-attr">draggable</span>=<span class="hljs-string">{false}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{userInfo.headImg}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"avatar"</span> /&gt;</span>
              }
            /&gt;
          ) : (
            <span class="hljs-tag">&lt;<span class="hljs-name">Avatar</span>
              <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">backgroundColor:</span> '<span class="hljs-attr">skyblue</span>' }}
              <span class="hljs-attr">icon</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">UserOutlined</span> /&gt;</span>}
            /&gt;
          )}

          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginLeft:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">14px</span>' }}&gt;</span>
            {userInfo?.nickName || userInfo?.name || '未知用户'}
          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Dropdown</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">RightRender</span>;

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[c语言——while循环续，for循环]]></title>    <link>https://juejin.cn/post/7574648745893691433</link>    <guid>https://juejin.cn/post/7574648745893691433</guid>    <pubDate>2025-11-20T10:14:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574648745893691433" data-draft-id="7574529034647535668" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="c语言——while循环续，for循环"/> <meta itemprop="keywords" content="C"/> <meta itemprop="datePublished" content="2025-11-20T10:14:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lucky_dog"/> <meta itemprop="url" content="https://juejin.cn/user/2446882131936864"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            c语言——while循环续，for循环
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2446882131936864/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lucky_dog
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T10:14:26.000Z" title="Thu Nov 20 2025 10:14:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🍁例：小球从100米高处自由落下，每次反弹回原来高度的一半</h2>
<p>🍂求第10次落下的高度</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>{
	<span class="hljs-type">double</span> h = <span class="hljs-number">100</span>; <span class="hljs-comment">// double</span>
	<span class="hljs-comment">// 循环执行10次</span>
	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">10</span>){
		h = h / <span class="hljs-number">2</span>;
		i++;
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"第%d次落下之后的高度是： %f \n"</span>, i, h);
	} 
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>,i);
	
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
} 
</code></pre>
<p>运行结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e26d3057ff244841b6e19a7b4ec3394e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVja3lfZG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238466&amp;x-signature=9aMzmCNe57s%2BmNYcGO720USjdwQ%3D" alt="image.png" loading="lazy"/></p>
<p>🍂求第几次落下高度低于0.5米</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>{
	<span class="hljs-type">double</span> h = <span class="hljs-number">100</span>; <span class="hljs-comment">// double</span>
	<span class="hljs-comment">// 循环执行10次</span>
	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (h &gt; <span class="hljs-number">0.5</span>){
		h = h / <span class="hljs-number">2</span>;
		i++;
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"第%d次落下之后的高度是： %f \n"</span>, i, h);
	} 
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>,i);
	
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
} 
</code></pre>
<p>运行结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dde3cf523e434a07b919458923fdf605~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVja3lfZG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238466&amp;x-signature=IFatOAM50QNyCqupJ2c1Gjdh0oI%3D" alt="image.png" loading="lazy"/></p>
<p>🍂求它第10年结束时有多少元</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>{
	<span class="hljs-type">double</span> money = <span class="hljs-number">1</span>; <span class="hljs-comment">// double</span>
	<span class="hljs-comment">// 循环执行10次</span>
	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">10</span>){
		money = money *  (<span class="hljs-number">1</span>+<span class="hljs-number">0.1</span>);
		i++;
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"第%d年之后，是： %f元 \n"</span>, i, money);
	} 
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>,i);
	
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
} 
</code></pre>
<p>运行结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f5f553e348c41f7a13560347db36762~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVja3lfZG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238466&amp;x-signature=%2Be7rca2pDifUve%2BltkGDegPML0g%3D" alt="image.png" loading="lazy"/></p>
<p>🍂多少年之后能超过1000元</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>{
	<span class="hljs-type">double</span> money = <span class="hljs-number">1</span>; <span class="hljs-comment">// double</span>
	<span class="hljs-comment">// 循环执行10次</span>
	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (money &lt; <span class="hljs-number">1000</span>){
		money = money *  (<span class="hljs-number">1</span>+<span class="hljs-number">0.1</span>);
		i++;
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"第%d年之后，是： %f元 \n"</span>, i, money);
	} 
	<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>,i);
	
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
} 
</code></pre>
<p>运行结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1b516c85b524db486f509a7a00a737d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVja3lfZG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238466&amp;x-signature=5kOuvswSZUDaNKB9V3mZJoh1gs8%3D" alt="image.png" loading="lazy"/></p>
<p>🍂for语句</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>{
	<span class="hljs-type">int</span> j;
	<span class="hljs-keyword">for</span>(j = <span class="hljs-number">1</span>; j&lt;=<span class="hljs-number">10</span>; j++){
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"第%d \n"</span>, j);
	}
	
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>运行结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/305021feedbb4a3dae57ddfacf588d57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbHVja3lfZG9n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238466&amp;x-signature=7ujJnJ9tN%2FeutfX3v8UW4hEITvY%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Google Antigravity：无法登录？早期错误、登录修复和用户反馈指南]]></title>    <link>https://juejin.cn/post/7574615024293527578</link>    <guid>https://juejin.cn/post/7574615024293527578</guid>    <pubDate>2025-11-20T10:22:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574615024293527578" data-draft-id="7574621387573952558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Google Antigravity：无法登录？早期错误、登录修复和用户反馈指南"/> <meta itemprop="keywords" content="Gemini"/> <meta itemprop="datePublished" content="2025-11-20T10:22:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Google Antigravity：无法登录？早期错误、登录修复和用户反馈指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T10:22:00.000Z" title="Thu Nov 20 2025 10:22:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.remio.ai%2Fpost%2Fgoogle-s-antigravity-unable-to-sign-in-a-guide-to-early-bugs-login-fixes-and-user-feedback" target="_blank" title="https://www.remio.ai/post/google-s-antigravity-unable-to-sign-in-a-guide-to-early-bugs-login-fixes-and-user-feedback" ref="nofollow noopener noreferrer">转载</a></p>
<p>作者：Aisha Washington</p>
<p>Google最近发布了Antigravity，一款全新的AI驱动IDE，在开发者社区中引发了巨大反响。该产品承诺了创新功能，如交互式"planning mode"和与下一代Gemini 3模型的深度集成，旨在挑战VS Code with GitHub Copilot等成熟产品。</p>
<p>然而，早期采用者分享的大量反馈显示，这是一个具有巨大潜力的强大工具，但目前受到一系列令人沮丧的错误、不明确的政策以及工作流程限制的阻碍。以下是用户面临的关键问题以及他们发现的社区解决方案的总结。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/052657c1f8da42ea8b8803168e3dcedb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238919&amp;x-signature=DlkrsKnNCj9PglVmTqRc6tvo%2BeI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">1. 第一个障碍："Antigravity无法登录"</h2>
<p>迄今为止最常见和最关键的问题可以总结为"Antigravity无法登录"。这个致命问题阻止了许多用户尝试使用该IDE，因为他们被困在初始设置屏幕上，实际上被锁定在外。</p>
<p><strong>问题所在：</strong></p>
<ul>
<li>卡在"正在设置您的账户"：用户成功通过Google认证，但却被留在一个无限的加载屏幕上。</li>
<li>地区限制和服务器过载：许多美国用户报告无法登录，而其他人则遇到HTTP 429（请求过多）错误，表明服务器不堪重负。</li>
<li>Google Workspace账户问题：一个反复出现的主题是，使用付费Google Workspace（商业）账户的用户比使用标准免费Gmail账户的用户面临更多登录问题，导致一位用户讽刺性地指出："如果你付费给他们，他们就会搞坏它。"</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a27029989d564143b551a5e1f43e629e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238919&amp;x-signature=QNQ2L1pG0%2FoK0tTFlVYmoAKj%2F%2B4%3D" alt="" loading="lazy"/></p>
<p><strong>可能的解决方案：</strong></p>
<ul>
<li>退出并重新启动：在Antigravity中退出您的Google账户，完全关闭应用程序，然后重新打开并再次登录。</li>
<li>切换到个人账户：如果您使用的是Workspace账户，请尝试标准的@gmail.com地址，这似乎更可靠。</li>
<li>"蛮力"方法：几位用户通过在认证屏幕上反复点击"返回"和"下一步"按钮并重新认证4-5次直到成功，发现了成功的方法。</li>
<li>频繁点击"下一步"按钮：一个奇特的修复方法涉及在出现"正在设置您的账户"消息时立即频繁点击"下一步"按钮。</li>
<li>使用VPN：切换到新加坡等地区的IP地址已成功为一些用户绕过登录阻止。</li>
</ul>
<h2 data-id="heading-1">2. 激进的配额限制和不可靠的模型行为</h2>
<p>对于成功通过设置屏幕的用户来说，核心AI体验则好坏参半。主要的挫败感来自于一个不透明且严格的配额系统。</p>
<p><strong>问题所在：</strong></p>
<ul>
<li>即时配额限制：用户报告称"单次查询后"或使用几分钟内就达到模型配额限制，即使是付费计划也是如此。该IDE不提供剩余积分的指示或购买更多积分的方式。</li>
<li>不稳定的AI性能：底层的Gemini 3 Pro模型被描述为不可靠。问题包括陷入循环、完全重写代码库而忽略错误，以及无故中途暂停任务。</li>
<li>"继续"错误：一个频繁问题是模型因错误而暂停，结果证明这是UI故障而不是致命崩溃。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2f6ab17afd34d6b9c00022c77a74f59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238919&amp;x-signature=zk%2BvoIlo55lb1kpogFYt110ykMA%3D" alt="" loading="lazy"/></p>
<p><strong>可能的解决方案：</strong></p>
<ul>
<li>只需说"继续"：当模型暂停或抛出模糊错误时，只需在提示中输入"continue"这个词，就可以恢复任务。这表明问题在于IDE界面的错误，而不是模型本身。</li>
</ul>
<h2 data-id="heading-2">3. 工作流程中断和数据可移植性</h2>
<p>虽然Antigravity的"planning mode"因其协作式、文档风格的反馈用户体验而受到高度赞扬，但其实施却造成了重大的工作流程问题。</p>
<p><strong>问题所在：</strong></p>
<ul>
<li>被困的规划文档：IDE生成的规划文档和任务没有存储在用户的项目目录中。相反，它们保存在一个名为"brain"的专有本地应用程序目录中。这使得在不丢失关键上下文的情况下切换回像VS Code这样的其他IDE变得不可能。</li>
</ul>
<p><strong>可能的解决方案：</strong></p>
<ul>
<li>手动复制和粘贴：目前，将规划文档移出Antigravity的唯一方法是手动复制并粘贴到外部文件中。</li>
</ul>
<h2 data-id="heading-3">4. 扩展支持和自定义</h2>
<p>尝试用熟悉的扩展自定义Antigravity的用户遇到了障碍。</p>
<p><strong>问题所在：</strong></p>
<ul>
<li>缺失扩展：像OpenAI Codex IDE这样的流行扩展据称在市场搜索中难以或不可能找到。</li>
<li>安装失败：一些用户根本无法安装任何扩展。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe6032989c664228ba3d5e98d9455e04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764238919&amp;x-signature=rjw%2B8%2F945KcG4NfNBCwQ0g1W%2Bxg%3D" alt="" loading="lazy"/></p>
<p><strong>可能的解决方案：</strong></p>
<ul>
<li>导入配置文件：一位用户通过从Cursor IDE导入现有配置文件成功安装了他们的扩展，包括Codex。</li>
<li>继续滚动：市场UI可能存在问题；一些缺失的扩展可以通过一直滚动到搜索结果的底部来找到。</li>
</ul>
<h2 data-id="heading-4">5. 隐私和开源问题</h2>
<p>最后，开发者提出了关于数据隐私和供应商锁定的基本问题。</p>
<p><strong>问题所在：</strong></p>
<ul>
<li>数据隐私：用户担心他们的私人代码是否被用来训练Google的模型。</li>
<li>闭源：IDE似乎不是开源的，这引发了对其长期可行性和社区信任的关注，与MIT许可证的VS Code相比。</li>
</ul>
<p><strong>可能的解决方案/澄清：</strong></p>
<ul>
<li>检查设置：Antigravity包含一个退出数据收集的开关，这些数据"用于评估、开发和改进Antigravity和模型"。用户被鼓励审查此设置，尽管有些人对其范围仍持怀疑态度。</li>
</ul>
<h2 data-id="heading-5">结论：有希望但半生不熟的首秀</h2>
<p>早期采用者的共识是，Antigravity感觉像一个"20%时间项目"，而不是准备好竞争的成熟产品。创新的planning mode和Gemini 3模型的潜力是其明显的优势。然而，在Google解决严重的登录问题、明确其配额系统、修复模型破坏性错误并解决关键的工作流程锁定问题之前，它将难以从竞争对手成熟可靠的生态系统中赢得开发者。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【保姆级教程】免费使用Gemini3的5种方法！免翻墙/国内直连]]></title>    <link>https://juejin.cn/post/7574622940689039379</link>    <guid>https://juejin.cn/post/7574622940689039379</guid>    <pubDate>2025-11-20T10:25:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574622940689039379" data-draft-id="7574648745893724201" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【保姆级教程】免费使用Gemini3的5种方法！免翻墙/国内直连"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-20T10:25:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java中文社群"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【保姆级教程】免费使用Gemini3的5种方法！免翻墙/国内直连
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java中文社群
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T10:25:08.000Z" title="Thu Nov 20 2025 10:25:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Google 的 Gemini 3 Pro 模型发布后，强大的性能让很多人跃跃欲试。今天为大家盘点 5 种<strong>免费使用 Gemini 3 Pro</strong> 的渠道。</p>
<p>无论你是想通过国内网络直接访问，还是需要高级的开发功能，甚至是不想注册账号，这里都有适合你的方案！</p>
<h2 data-id="heading-0">🚀 视频教程</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1tuywBcE9k%2F" target="_blank" title="https://www.bilibili.com/video/BV1tuywBcE9k/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1tu…</a></p>
<h2 data-id="heading-1">📋 方案概览（省流版）</h2>
<p>为了方便大家快速选择，我们根据<strong>网络要求</strong>和<strong>是否需要登录</strong>做了一个快速分类：</p>















































<table><thead><tr><th><strong>排名</strong></th><th><strong>平台名称</strong></th><th><strong>网络要求</strong></th><th><strong>登录要求</strong></th><th><strong>核心亮点</strong></th></tr></thead><tbody><tr><td>推荐</td><td>ZenMux</td><td>国内直连</td><td>需登录</td><td>免费API调用、支持画图 (Nano/Pro)</td></tr><tr><td>推荐</td><td>Flowith</td><td>国内直连</td><td>需登录</td><td>聚合 Claude/OpenAI 等多模型</td></tr><tr><td>进阶</td><td>Google AI Studio</td><td>需魔法</td><td>需登录</td><td>全能开发台 (音视频/App生成)</td></tr><tr><td>官方</td><td>Gemini 官网</td><td>需魔法</td><td>需登录</td><td>官方原生体验，交互流畅</td></tr><tr><td>快捷</td><td>lmArena</td><td>需魔法</td><td><strong>免登录</strong></td><td>即开即用，聚合 Grok 等模型</td></tr></tbody></table>
<h2 data-id="heading-2">🚀 第一梯队：国内直连，无需魔法（强烈推荐）</h2>
<p>这两种方式最适合国内用户，不需要任何“梯子”或“魔法”，打开网址注册即可免费使用，且功能非常强大。</p>
<h3 data-id="heading-3">1.ZenMux —— 免费 API 与绘图神器</h3>
<p>ZenMux 是一个类似 OpenRouter 的聚合平台，但目前提供极为慷慨的免费额度。</p>
<p><strong>访问方式</strong>：直接访问 <code>zenmux.ai</code>，注册登录即可 。</p>
<p><strong>核心优势</strong>：完全免费： 平台内的 Gemini 3 Pro 模型目前 Input 和 Output 费用均为 0 。</p>
<p><strong>支持绘图</strong>：更加神奇的是，它免费提供 <code>Gemini 3 Pro image</code> (Nano/Banana Pro 版本)，也就是可以免费使用 Gemini 进行 AI 绘画 。</p>
<p><strong>开发者友好</strong>： 如果你在工作流或程序中需要调用 API，这里目前不需要任何费用，无论是聊天还是生图 。</p>
<h3 data-id="heading-4">2.Flowith (flo.ing) —— 多模型聚合平台</h3>
<p>这是一个非常优秀的 AI 聚合站，同样支持国内网络直接访问。</p>
<p><strong>访问方式</strong>：访问 <code>flo.ing</code> 并登录账号 。</p>
<p><strong>核心优势</strong>：免费 Gemini 3 Pro： 登录后可直接选择 Gemini 3 Pro 模型免费使用 。</p>
<p><strong>模型丰富</strong>：除了 Google 的模型，它还集成了 Claude 和 OpenAI (GPT) 系列模型，全部都可以免费体验 。</p>
<h2 data-id="heading-5">🛠 第二梯队：官方渠道，功能最强（需魔法）</h2>
<p>如果你有稳定的网络环境（魔法），官方渠道能提供最原汁原味甚至更高级的多模态体验。</p>
<h3 data-id="heading-6">3.Google AI Studio —— 极客与创作者的首选</h3>
<p>相比于普通的对话，AI Studio 是 Google 面向开发者推出的“军火库”，功能最全。</p>
<p><strong>访问方式：</strong> Google 官方开发平台 。</p>
<p><strong>核心优势：全能多模态：</strong> 普通 Gemini 只能对话，而 AI Studio 集成了 <strong>Imagen</strong> (生图)、<strong>Veo</strong> (生视频)、音频生成甚至播客生成功能 。</p>
<p><strong>代码生成特化：</strong> 它可以辅助生成网站、App 甚至游戏代码，非常适合有丰富需求的高级用户 。</p>
<h3 data-id="heading-7">4. Google Gemini 官网 —— 官方原生对话</h3>
<p>这是最标准的官方入口，适合只需要进行日常聊天的普通用户。</p>
<p><strong>访问方式</strong>：访问 <code>gemini.google.com</code>。</p>
<p><strong>必须登录</strong>：如果不登录，只能使用快速模式 (Gemini 2.5)，速度快但不是最新模型。只有登录 Google 账号后，才能切换并使用 Gemini 3 Pro。</p>
<h2 data-id="heading-8">⚡ 第三梯队：极致快捷，隐私保护（需魔法）</h2>
<h3 data-id="heading-9">5.lmarena —— 免登录即用</h3>
<p>这是唯一一种<strong>不需要注册或登录账号</strong>的方法，适合临时使用或注重隐私的用户，但需要网络支持。</p>
<p><strong>访问方式：</strong> 通过特定的聚合对话网站（视频中展示界面为 Direct Chat 类型的聚合站），选择 "Direct Chat" 模式 。</p>
<p><strong>核心优势：零门槛：</strong> 既然不需要登录，打开网页就能聊，隐私性更好 。</p>
<p>**多模型支持：**除了 Gemini 3 Pro，还支持马斯克旗下的 <strong>Grok</strong>、以及 Claude 和 GPT 等多种模型 。</p>
<h2 data-id="heading-10">小结</h2>
<p>以上就是 5 种白嫖 Gemini 3 Pro 的方法。</p>
<ul>
<li>如果你追求<strong>稳定和国内直连</strong>，请选择 <strong>ZenMux</strong> 或 <strong>Flowith</strong>；</li>
<li>如果你是<strong>开发者或创作者</strong>，<strong>Google AI Studio</strong> 是你的不二之选；</li>
<li>如果你只是<strong>临时用一下</strong>，<strong>Direct Chat</strong> 模式最方便。</li>
</ul>
<p>大家可以根据自己的需求选择最适合的一种！</p>
<blockquote>
<p>本文已收录到我的技术小站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>，其中包含的内容有：Spring AI、Spring AI Alibaba、LangChain4j、Dify、Coze、N8N、智能体（AI Agent）、MCP、Function Call、RAG、向量数据库、Prompt、多模态、向量数据库、嵌入模型、AI 常见面试问题等内容。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开发了几个app后，我在React Native用到的几个库的推荐]]></title>    <link>https://juejin.cn/post/7574626451749289984</link>    <guid>https://juejin.cn/post/7574626451749289984</guid>    <pubDate>2025-11-20T10:49:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574626451749289984" data-draft-id="7574529034672816163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开发了几个app后，我在React Native用到的几个库的推荐"/> <meta itemprop="keywords" content="前端,React Native,Android"/> <meta itemprop="datePublished" content="2025-11-20T10:49:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天平"/> <meta itemprop="url" content="https://juejin.cn/user/1214304985296439"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开发了几个app后，我在React Native用到的几个库的推荐
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1214304985296439/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天平
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T10:49:42.000Z" title="Thu Nov 20 2025 10:49:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 样式开发：nativewind + clsx + tailwind-merge</h2>
<p>此前尝试过 StyleSheet 原生写法与 styled-components 方案，均觉得语法冗余、编写繁琐。而采用 nativewind 实现类 Tailwind CSS 的 className 样式编写方式，再配合 clsx 与 tailwind-merge 封装的 cn 函数，处理不同状态下的样式切换时，体验极为便捷高效 —— 无需冗余嵌套，就能灵活组合样式，大幅简化了样式开发流程。</p>
<h2 data-id="heading-1">2. 请求管理：@tanstack/react-query</h2>
<p>想必不少人都遇到过这样的痛点：A 组件更新数据后需同步刷新 B 组件数据，此时请求函数往往要层层透传，流程繁琐且不易维护。而 @tanstack/react-query 的出现彻底解决了这一问题，堪称前端请求管理的 “神级工具”。它能集中管理所有请求逻辑与返回数据，无需层层透传请求函数，仅需一行代码即可触发请求重发，极大简化了跨组件数据同步的复杂度，实用性拉满。</p>
<h2 data-id="heading-2">3. 本地存储：expo-sqlite + drizzle-orm + drizzle-zod + zod</h2>
<p>经过对多种本地存储方案与 ORM 工具的调研对比，我最终选定 expo-sqlite 作为核心存储方案。恰好 drizzle-orm 已原生支持 expo-sqlite，且其官网内置了 AI 答疑功能，遇到疑问可直接咨询，体验与 Prisma 类似；但 Prisma 暂不支持 expo-sqlite，因此 drizzle-orm 成为了更适配的选择。再搭配 drizzle-zod 与 zod 实现参数校验，整套方案从存储操作到数据校验无缝衔接，类型安全且易用性强，用起来十分顺手。</p>
<h2 data-id="heading-3">4. 表单处理：react-hook-form + @hookform/resolvers + zod</h2>
<p>React Native 生态中，好用的表单组件库相对稀缺。因此我选用 react-hook-form 作为表单管理核心，其简洁的 API 设计、高效的状态管理能力，大幅提升了表单开发效率。同时结合 @hookform/resolvers 与 zod 实现表单校验，无需手动编写复杂的校验逻辑，就能实现类型安全的参数校验，显著节省了开发时间与后期调试成本。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何使用MCP Inspector调试MCP工具]]></title>    <link>https://juejin.cn/post/7574648745893822505</link>    <guid>https://juejin.cn/post/7574648745893822505</guid>    <pubDate>2025-11-20T10:52:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574648745893822505" data-draft-id="7574622940689104915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何使用MCP Inspector调试MCP工具"/> <meta itemprop="keywords" content="MCP"/> <meta itemprop="datePublished" content="2025-11-20T10:52:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿虎儿"/> <meta itemprop="url" content="https://juejin.cn/user/3394908210857901"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何使用MCP Inspector调试MCP工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394908210857901/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿虎儿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T10:52:56.000Z" title="Thu Nov 20 2025 10:52:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Finspector%3Ftab%3Dreadme-ov-file" target="_blank" title="https://github.com/modelcontextprotocol/inspector?tab=readme-ov-file" ref="nofollow noopener noreferrer">MCP Inspector</a></p>
<h2 data-id="heading-0">启动MCP Inspector</h2>
<p><strong>docker启动</strong></p>
<pre><code class="hljs language-bash" lang="bash">docker run --<span class="hljs-built_in">rm</span> --network host -p 6274:6274 -p 6277:6277 -e DANGEROUSLY_OMIT_AUTH=<span class="hljs-literal">false</span> m.daocloud.io/ghcr.io/modelcontextprotocol/inspector:latest
</code></pre>
<p><strong>npx启动</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">DANGEROUSLY_OMIT_AUTH</span>=<span class="hljs-literal">false</span> npx @modelcontextprotocol/inspector
</code></pre>
<ul>
<li><code>DANGEROUSLY_OMIT_AUTH=false</code> 关闭权限验证，简化后面配置</li>
<li><code>m.daocloud.io/ghcr.io/modelcontextprotocol/inspector:latest</code> 修改为国内镜像，加速下载</li>
<li><code>http://localhost:6274/</code> UI访问地址</li>
<li><code>http://localhost:6277/</code> 后端代理地址，一并启动，代理我们的测试请求</li>
</ul>
<h2 data-id="heading-1">启动本地的MCP服务</h2>
<p>我本地使用<code>fastMCP</code>开发的服务，使用的<code>StreamableHTTP</code>协议，端口号是<code>8000</code>，打印日志大概如下</p>
<pre><code class="hljs language-markdown" lang="markdown">$ python server.py
╭────────────────────────────────────────────────────────────────────────────╮
│                                                                            │
│        _ __ <span class="hljs-strong">___  __</span><span class="hljs-strong">___           __</span>  __  <span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span>_    <span class="hljs-strong">____</span>    <span class="hljs-strong">____</span>     │
│       _ __ <span class="hljs-strong">___ .'__</span><span class="hljs-strong">__/__</span>_ <span class="hljs-strong">____</span><span class="hljs-strong">__/ /<span class="hljs-emphasis">_/  |/  / _</span>__</span><span class="hljs-emphasis">_/ _</span>_ \  |<span class="hljs-strong">___ \  / __</span> \    │
│      _ __ <span class="hljs-strong">___ / /_  / __</span> `/ <span class="hljs-strong">__<span class="hljs-emphasis">_/ _</span><span class="hljs-emphasis">_/ /|_</span>/ / /   / /<span class="hljs-emphasis">_/ /  _</span>__</span>/ / / / / /    │
│     _ __ <span class="hljs-strong">___ / __</span>/ / /<span class="hljs-emphasis">_/ (_</span>_  ) /<span class="hljs-emphasis">_/ /  / / /<span class="hljs-strong">___/ __</span><span class="hljs-strong">__/  /  __</span>/_</span>/ /<span class="hljs-emphasis">_/ /     │
│    _</span> __ <span class="hljs-strong">___ /<span class="hljs-emphasis">_/    \_</span>__</span><span class="hljs-emphasis">_/<span class="hljs-strong">____</span>/\<span class="hljs-strong">__/_/  /_/\__</span><span class="hljs-strong">__/_/      /__</span><span class="hljs-strong">___(*)__</span><span class="hljs-strong">__/      │
│                                                                            │
│                                                                            │
│                                FastMCP  2.0                                │
│                                                                            │
│                                                                            │
│                🖥️  Server name:     TenderMCP 🚀                            │
│                📦 Transport:       Streamable-HTTP                         │
│                🔗 Server URL:      http://0.0.0.0:8000/mcp                 │
│                                                                            │
│                🏎️  FastMCP version: 2.12.4                                  │
│                🤝 MCP SDK version: 1.18.0                                  │
│                                                                            │
│                📚 Docs:            https://gofastmcp.com                   │
│                🚀 Deploy:          https://fastmcp.cloud                   │
│                                                                            │
╰────────────────────────────────────────────────────────────────────────────╯
</span></span></code></pre>
<h2 data-id="heading-2">配置MCP Inspector UI界面</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/260dfad9255f4b0ca60135a044c5541c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764241009&amp;x-signature=Ogy8Kh26iXkLsc5aLLnnA3%2F8nD8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">连接调试</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b6b5a1804f748898e8c85602093f3b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6JmO5YS_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764241009&amp;x-signature=i6IuIRkPB890SHcwrz0E1G5zsJI%3D" alt="image.png" loading="lazy"/></p>
<p>剩下我们就可以根据自己需要调试方法了，不用再依靠大模型调用</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI终于学会「读懂人心」，带飞DeepSeek R1，OpenAI o3等模型]]></title>    <link>https://juejin.cn/post/7574619023805136934</link>    <guid>https://juejin.cn/post/7574619023805136934</guid>    <pubDate>2025-11-20T09:40:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574619023805136934" data-draft-id="7574615024293314586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI终于学会「读懂人心」，带飞DeepSeek R1，OpenAI o3等模型"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-20T09:40:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI终于学会「读懂人心」，带飞DeepSeek R1，OpenAI o3等模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:40:13.000Z" title="Thu Nov 20 2025 09:40:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“What is meant often goes far beyond what is said, and that is what makes conversation possible.” ——H. P. Grice </p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3694a5f2b0654668b389d5dbac827037~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=mjxOUn8DX51%2FXlycuPdH7Sx7les%3D" alt="图片" loading="lazy"/></p>
<p>引言：从「语义理解」到「心智共情」的跨越</p>
<p>在人类日常交流中，话语的含义往往超越字面本身。举个例子，当有人说出 “这里好冷啊” 的时候，真正的用意可能远不止是在描述温度 —— 这句话可能是一种委婉的请求（希望对方关窗），也可能是在表达不适、寻求关心。再比如，当人类说出 “我最近总是失眠” 时，背后的潜台词可能是工作压力、情感困扰，或是生理疾病 —— 人类社交之所以能领会言外之意，是通过碎片信息，比如社交语境、先验常识和预设反馈推测他人未明说的意图、情绪和信念等心理状态，一种被称为心智理论（Theory of Mind, ToM）的能力，也是社交智能的核心。发展心理学研究表明，儿童大约在 4 岁左右就开始具备这种对他人心态的推理能力。这种 “读心术” 式的社交智力让人类对语言的理解超越字面，做到 “听言外之意，观其心中之思”。</p>
<p>让机器拥有类似的人类社交智力一直是人工智能领域的一项巨大挑战。尽管大型语言模型（LLM）在语义理解和问答对话上表现出色，它们在面对人类交流中的模糊性和间接暗示时却常常表现不佳，因此在真实社交场景中的表现常被诟病为机械式回应。人们很快发现：单纯的语言流畅 ≠ 理解 “人情世故”。一些尝试为模型注入社交行为的工作，比如预先设定角色档案，或通过偏好数据微调模型等，往往只是让模型在表层对齐（如遵循对话格式或避免禁忌语），并未真正赋予模型类人般分层次的心理推理能力。简而言之，传统方法大多把社交推理当成一次生成问题，而不是像人类那样经历解读 - 反思 - 适应的多阶段过程。如何使 AI 具备这种人类式的多层社交推理能力，成为通往更高层次人工智能的一道关键门槛。</p>
<p>为应对这一挑战，威斯康星大学麦迪逊分校联合清华大学 NeurIPS 2025 Spotlight 的最新研究《MetaMind: Modeling Human Social Thoughts with Metacognitive Multi-Agent Systems》，首次将发展心理学中的元认知（Metacognition）理论融入 LLM 架构，通过仿生人类假设生成 - 反思修正 - 行为验证的认知闭环，在 8 项标准化心智理论测试中使 LLM 达到人类平均水平。该成果不仅刷新多项基准记录，显著提升模型对隐含意图、情绪和社会规范的把握能力，更揭示了构建社交智能 AI 的系统性方法论，让 AI “读懂人心”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01fcd2210a2b460ba74dd15df2640fe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=uI4NU%2F0HjQtOhNiJwZFeIc2gJAE%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>
<p>论文链接：<a href="https://link.juejin.cn?target=http%3A%2F%2Farxiv.org%2Fabs%2F2505.18943" target="_blank" title="http://arxiv.org/abs/2505.18943" ref="nofollow noopener noreferrer">arxiv.org/abs/2505.18…</a></p>
</li>
<li>
<p>Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FXMZhangAI%2FMetaMind" target="_blank" title="https://github.com/XMZhangAI/MetaMind" ref="nofollow noopener noreferrer">github.com/XMZhangAI/M…</a></p>
</li>
<li>
<p>Hugging Face：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fpapers%2F2505.18943" target="_blank" title="https://huggingface.co/papers/2505.18943" ref="nofollow noopener noreferrer">huggingface.co/papers/2505…</a></p>
</li>
</ul>
<p>MetaMind 框架：三阶段的元认知多智能体</p>
<p>MetaMind 试图让 LLM 通过多智能体协作来模拟人类的社交推理过程，这一框架受启发于心理学中的元认知理论。美国心理学家 Flavell 于 1979 年提出元认知（Metacognition）概念，指出人类在认知活动中会进行自我监控和调节：我们会对自己的想法进行反思，根据社会规则修正理解，并在复杂情景中调整行为。MetaMind 正是借鉴来这种 “思考之上的思考” 理念，将社交理解拆解为逐层深入的三个阶段，每个阶段由一个专门的智能体（Agent）负责处理不同层面的推理任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c036ea03bc444d64a9efc1fe73e21e7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=7Gqj2vxY054DO2tO1O3Yg7yH1Z4%3D" alt="图片" loading="lazy"/></p>
<p>阶段 1：理论心智智能体（ToM Agent）负责生成心理状态假设。在这一初始阶段，ToM 智能体会尝试推测用户话语背后 “未尽之意”，生成多个关于用户潜在心理状态的假设。这些假设涵盖了用户可能的信念、愿望、意图、情绪等不同类型。举个例子，当用户说 “最近工作把我累坏了”，ToM 代理不会直接生成劝你注意休息的统一答复，而是先推测用户真正的心理状态：可能是假设用户感到 “倦怠和沮丧”，或是假设用户在寻求同情和理解。通过生成一系列多样的假设，模型在回答前就对用户的潜在诉求有了更全面的考虑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889cad5707c84cf6b3c6664c77bebbda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=nwsWyBXvz3uajkK8oBAwMm5sO4A%3D" alt="图片" loading="lazy"/></p>
<p>阶段 2：道德约束智能体（Moral Agent）负责应用社交规范约束，对上一阶段产生的心理假设进行审视和过滤。该智能体扮演 “社交常识与规范审查员” 的角色：它会考虑当前场景下的文化背景、伦理准则以及情境适当性，对不合理或不恰当的假设进行修正或摒弃。正如人类会用社会经验来调整自己对他人话语的解读一样，该代理确保模型的推理符合社会常情。例如，如果 ToM 阶段假设出 “浪漫意图”，但对话发生在工作场合，那么领域代理会根据职业场合的规范将此解读调整为普通的 “同事间欣赏”，避免产生越界的理解。通过引入社会约束，模型能够抑制不合时宜的推测，使推理结果在情境中更加合理、负责任。</p>
<p>值得注意的是，该阶段通过平衡目标假设在上下文中的概率与假设的意外性，保证最优假设的语境合理性与场景专有的信息增益。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/541b56ccd9de43d5902096ef5c88bfeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=L9izy%2BVUYIrjw%2BWLnObG8C7z1HQ%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7792a8078f1443ef988c25e84bd87d47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=pQxStYH3MdU%2BxZCpqLqEUOnNqns%3D" alt="图片" loading="lazy"/></p>
<p>阶段 3：响应验证智能体（Response Agent）负责生成并验证最终回答。经过前两阶段，模型已经 “想明白” 了用户可能的潜在诉求，也过滤出了最合适的假设。最后一步，响应智能体要做的就是据此生成实际的回答，并在生成过程中进行自我验证。该智能体以前两阶段提出的最佳假设为条件，加上用户的社交记忆作为额外输入，一方面确保回答内容切题且语气贴合用户当下的情绪，另一方面在回答完成后对其进行质量评估：生成回答后会反思其是否与推断的用户意图以及自我的社交状态相一致、在情感和语境上是否合适，如有偏差还能触发认知循环，通过在社交记忆中注入经验反馈以改进答案。通过 “生成 + 校验” 的闭环，模型的最终输出在语义准确性之外，更具共情力和社交认知。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32f3780384924b0c854df1cd29ba1b35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=IFgqTXT1K%2FtSUNrBAMHrnJTWLU4%3D" alt="图片" loading="lazy"/></p>
<p>上述三步循环让 MetaMind 在理解和回应用户时，能够像人类一样经过假设、反思和调整的过程，而非一上来就给出武断答复。这种多智能体协作的分层推理设计，使模型初步具备了人类式的社交认知能力。值得一提的是，MetaMind 的智能体之间并非各自孤立地工作，而是通过共享记忆和信息形成一个有机整体。例如，第一阶段生成假设时会参考社交记忆的用户偏好，第三阶段生成回答时又会用到经过领域智能体修正的假设等 —— 整个流程构建出一种 “元认知循环”，不断自我反馈改进，正如人类在社交互动中大脑所做的那样。</p>
<p>动态社交记忆：长期、可进化的用户画像</p>
<p>在 MetaMind 框架中，有一个贯穿始终的关键机制叫作社交记忆（Social Memory）。它就像 AI 的大脑中一个不断更新的笔记本，用来记录用户在交互过程中的重要信息。具体来说，社交记忆会存储用户长期的偏好、人格特征以及突出的情绪模式，并在对话推进时动态更新。每当模型需要推理用户的意图或决定如何回应时，这个记忆库都可以被检索，提供额外的背景参考。例如，在连续多轮交互中，用户曾表现出害羞内向的性格或偏好委婉隐喻的交流方式，MetaMind 可以将这些历史信息纳入考虑，从而对用户有更一致且连贯的把握。</p>
<p>社交记忆的作用在 MetaMind 架构中贯穿始终：第一阶段 ToM 智能体在生成心理假设时，会交叉引用社交记忆，以确保推测符合用户一贯的行为模式。基于假设类型，当假设被判定为新的用户偏好时，将注入社交记忆作为常识性用户建模；第三阶段响应智能体在生成回答时，则会调取社交记忆来调整回复的情感基调，使语气和内容与用户以往的情绪状态相协调。当该轮验证失败，社交记忆将通过风险反馈再次优化 —— 基于这种方式，MetaMind 实现了长期用户建模和情感一致性两大提升：一方面，模型能够持续累积用户信息，形成更全面的用户画像；另一方面，在长对话或多轮交互中，模型的回应风格情绪不会前后矛盾，而是与用户先前情绪脉络相呼应。这有效避免了传统 LLM 常见的 “失忆” 和情感不连贯问题。</p>
<p>更进一步，社交记忆还赋予了模型一定程度的个性化适应能力。如果说传统模型面对每个新对话都是 “从零开始” 的话，那么具备社交记忆的 MetaMind 则能 “记住你是谁”。例如，在教育场景中，一个教学 AI 助手如果有社交记忆，就可以记住学生以往知识的掌握曲线和情绪反应，从而调整教学策略，拿捏反馈的语气力度。这种个性化的长程适应对于人机交互体验至关重要，也是迈向更具情感智能的 AI 的一大步。简而言之，社交记忆具有如下特性：</p>
<ul>
<li>
<p>动态结构化存储：记录用户长期信念、情绪模式与社交偏好。</p>
</li>
<li>
<p>三步演化：① 场景初始化 M₀ —— 基于场景 / 角色 / 文化背景预设；② 基于 ToM 假设更新 Mₜ → Mₜ₊₁ —— 写入持久化心智片段；③ 失败反馈修正 —— 若响应被判低效或违背规范，记忆自我矫正。</p>
</li>
<li>
<p>用户建模：为多轮对话带来 “熟人感”，同时为 Response Agent 提供情感与语调的连续性约束。</p>
</li>
</ul>
<p>从 Folk Psychology 到元认知理论</p>
<p>MetaMind 的设计深深植根于认知心理学理论，与人类社交认知的原理高度对齐。首先，它借鉴了发展心理学中的 “朴素心理学（Folk Psychology）” 概念。朴素心理学指的是人们在日常生活中自发形成的一套关于他人行为背后心理状态的推理方法 —— 简单说就是我们直觉地去理解他人的想法和动机，这正是心智理论 ToM 能力的基础。</p>
<p>MetaMind 的第一阶段 ToM 代理所做的事情，本质上就是在模仿人类的朴素心理学过程：面对一段话，列举出可能的隐含心态（信念、情绪等），就如同我们在脑海中猜测对方 “是不是在暗示 XX” 那样。这种设计让 AI 对语言的理解不再停留于字面，而是尝试触及背后的心理语境。</p>
<p>其次，MetaMind 引入的元认知多阶段循环理念，直接受益于 Flavell 的元认知理论。元认知强调，人会对自己的认知活动进行计划、监控和评估，从而实现自我调节。对应到 MetaMind 框架，三个智能体的协作过程正体现了类似的自我调节机制：ToM 代理完成计划和假设（对应计划阶段），领域代理对假设进行审核和调整（对应监控反思阶段），响应代理则对最终输出进行评估验证（对应评估阶段）。可以说，MetaMind 在 LLM 架构中显式地融合了人类元认知的原则。这种分工协作的系统，比起简单靠提示词让单个模型 “一步到位” 地给出答案，更加接近人类解决复杂社交任务时的思维方式。</p>
<p>相比之下，目前常用的 LLM 对齐手段就显得过于扁平了。例如，链式 Prompt 虽然在一定程度上分步引导模型思考，但缺乏根据上下文动态调整的机制；预设人设的对话让模型假装扮演某角色，但难以捕捉真实对话中动态变化的社交意图；RLHF 通过大规模人工反馈微调模型，提升了礼貌和安全性，却很难针对千变万化的社交场景做到举一反三，而且收集广覆盖的训练数据本身就非常困难。这些方法本质上都还是让模型学会一种 “静态” 的或 “表层” 的对齐策略，缺乏对人类社交认知过程更深层的模拟。MetaMind 的出现，正是对这种现状的反思和突破：它不再将社会交互视作一个静态的问题，而是让 AI 通过元认知的多阶段推理，在内部重现人类的社交思维链条。正因如此，MetaMind 在各类复杂社交场景中表现出更强的上下文适应性和行为合理性。</p>
<p>性能表现：多基准上的 SOTA 与人类水平逼近</p>
<p>MetaMind 框架在一系列严格的基准测试中取得了卓越的成绩，展示出其赋予 LLM 社会推理能力的有效性。作者在论文中选取了三个具有挑战性的测试：一个是专门评估社交推理能力的 ToMBench，涵盖了多种 ToM 推理任务；第二是一系列社交认知任务（如社交常识问答 SocialIQA 等），考察模型对社交情景的理解；第三是社会模拟任务集 STSS 及 SOTOPIA，让模型在交互式情景中执行行为决策。综合这几方面，可以较全面地测量模型的社交智能水平。</p>
<p>实验结果显示，MetaMind 让各种底层 LLM 在这些基准上均实现了大幅度的性能提升。例如，在 ToMBench 上，MetaMind 框架将 GPT-4 的平均心理推理准确率从约 74.8% 提高到了 81.0%，超过了以往所有针对 ToM 能力的提升方法。值得注意的是，无论是小模型（7-13 亿参数量级）、大模型（GPT-3.5/4 等）还是最先进的推理模型（DeepSeek r1，OpenAI o3 等），几乎清一色地被 MetaMind “带飞”：这说明 MetaMind 提供的多阶段推理机制对各类模型通用有效，并非只对个别模型奏效。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78b99c2ed9754e578a61501957a6d3dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=EAPwh45oTg9RD0FV1xhIIV1CB4s%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1466139f9a0a41bc92e15fafa49a93bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=EeBwZ43kKwj9LcRoA%2BQLhbMAG%2FY%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ec453ece2ea41f88acf1af387e929e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=cCtxSm5vQjLPYUqAH9X3oeMpr0w%3D" alt="图片" loading="lazy"/></p>
<p>不仅在选择题式的 ToM 测试上崭露头角，MetaMind 在更加开放复杂的社交任务上也表现卓越。在社交认知类任务中（如对对话中隐含动机的判断、尴尬场景识别等），MetaMind 同样取得了比现有模型更高的综合得分。而在交互式的 STSS 社会模拟测试中，MetaMind 相比原始模型更是取得了 34.5% 的性能提升，显著增强了模型在真实社交场景下的应对能力。一个令人瞩目的里程碑是：借助 MetaMind 框架，一些 LLM 首次在关键的心理推理任务上达到了平均人类水平 —— 这在过去是难以想象的。考虑到推理模型的大规模运行成本，我们着重分析八个非推理模型在六种典型 ToM 能力维度上的得分雷达图。可以看到，它们的原始雷达图普遍小于人类标准，且形状各异，表示这些模型在不同心智维度上能力不均衡、且整体逊于人类。而同样的模型集成 MetaMind 后雷达图面积显著增广，GPT-4 甚至几乎追平蓝色的人类圈。特别的，在加入 MetaMind 后，GPT-4 在 “信念推理” 维度上达到 89.3 分，超越人类平均表现的 88.6 分；在 “自然语言交流理解” 维度也达到 89.0 分，超过人类平均表现的 88.5 分。这些结果清晰地表明：MetaMind 有效地弥合了 LLM 与人类社交认知水平之间的差距，使模型能够更全面、均衡地掌握人类推理他人心理的能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e7e197e740d4b2e8e74192816f75bf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=b4JmkDDLU7KLxyejiztx80IApME%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85f18e091eb14db9a880bbfaf95d1be3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=PQqXMBuD6pOb2uEdPv6cMa5YR14%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/035104ceefea4e3891cc1e0634242ec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=iGeh2WqRu3FQ5MTsT7va%2FLlc0v4%3D" alt="图片" loading="lazy"/></p>
<p>消融实验与参数敏感性：验证架构设计的必要性</p>
<p>为了进一步弄清 MetaMind 各组成部分对整体性能的贡献，研究者进行了消融实验，逐一移除架构中的关键组件以观察性能变化。结果表明，MetaMind 的三阶段架构和社交记忆机制都是不可或缺的。具体来说：</p>
<ul>
<li>
<p>移除阶段 1（心理假设生成）：去掉 ToM 智能体的结构化心理状态推理后，模型在社交认知任务上的平均成绩下降约 2.6%，在高歧义性的任务中降幅更大（例如在意外结果测试下降 4.3%）。在 STSS 模拟场景下，缺少心理假设往往容易错失潜在含义，导致性能下滑，再次证明了事先推测用户状态及偏好的价值。</p>
</li>
<li>
<p>移除阶段 2（规范约束审查）：跳过领域智能体，对心理假设不做任何文化 / 伦理过滤，直接将阶段 1 的假设用于回应，平均表现将下降 3.8%，在涉及规范违规或潜台词理解的任务中跌幅最大。例如在 “社交失礼（Faux-pas）识别” 任务上成绩下降 5.5%。这说明社会规范约束对于避免不恰当解读至关重要。</p>
</li>
<li>
<p>移除阶段 3（回复自我验证）：如果不进行响应阶段的自我检查，模型将直接根据假设生成答案而不做反思校验。在 STSS 综合社交任务中，这种改动造成了整体性能骤降 16.1%。可见，最后的自我验证步骤对高质量响应至关重要：没有这道把关，模型很容易成为不计后果的 “冒失鬼”，生成与用户真实意图不符或欠缺共情的回复。</p>
</li>
<li>
<p>移除社交记忆：当关闭动态社交记忆模块后，模型性能下降明显。失去长期记忆支撑的模型，在对话中表现得短视且生硬：无法牢记用户之前提供的偏好信息和情绪线索，导致推理和回答都变得片面。尤其在需要跨多轮跟踪用户状态的任务上，没有记忆的模型往往顾此失彼、前后不一致。这进一步证明了长期社交记忆对于模拟真实对话的必要性。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71fdc19a9e9547b390251a35261b3324~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=mX69vNaCpMvjHXURtWP3Fi2p6lU%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db9410404dbc4cd4b072391748561ef1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=2GAI0Cc1WA%2BRi2YoNggUMn1PoMU%3D" alt="图片" loading="lazy"/></p>
<p>上述消融分析清楚地印证了 MetaMind 架构设计的合理性：每一阶段的智能体和社交记忆机制各有独特作用，缺少任何一个都会明显削弱模型的社交推理能力。阶段 1 提供对用户潜在心态的洞察基础，阶段 2 保障了推理符合社会常情，阶段 3 确保了最终输出的质量和一致性，社交记忆贯穿其中提供长程依托。正是这些要素的协同，才造就了 MetaMind 卓越的整体性能。这也从另一个侧面强调了一个观点：真正逼近人类社交智能的 AI，需要的是这种层次分明、环环相扣的类人认知架构，而非简单堆砌参数或数据。</p>
<p>除了验证框架有效性，论文还对 MetaMind 中的超参数进行了敏感性分析，以找到最优配置并了解模型性能对参数的依赖程度。例如，ToM 智能体需要生成多少条假设（记为 k）才能保证覆盖充分？领域智能体在筛选假设时如何平衡假设的 “语境可能性” 与 “信息增益”（记为 λ）？响应代理在验证时如何平衡 “共情” 与 “连贯” 的权重（记为 β）？研究者通过网格搜索发现，生成约 6 条心理假设（k=6）时效果最佳，并能保证合理效能，超过这个数量并不会带来更大提升。另外，在选择和验证的效能函数中，引入约 60% 权重用于语境可能性，约 80% 权重用于情感共情可以取得较优效果。总的来说，MetaMind 在合理范围内对这些参数并不极端敏感，说明框架具有一定鲁棒性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb015e497a2b477fbc38ba640029dd7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=0yXZ0XCWQ8UkvfNE57vfjeeOldM%3D" alt="图片" loading="lazy"/></p>
<p>真实对话剖面：十分钟跑步建议的 “说服术”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a218884d7afa49e981a4bc85d10a4112~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=RjHadCJhZmJcHQGcku8n3%2FVEqx0%3D" alt="图片" loading="lazy"/></p>
<p>在实际的案例分析中，MetaMind 表现出能够理解用户的显性和隐性表达，并运用适当的策略与用户沟通，这种能力在说服、谈判、合作场景灵活泛化。此外，当 MetaMind 加成后的模型与普通模型对话时，其交互质量明显更高：在外部裁判评审时，无论是 AI 还是人类评审员，都倾向于将对话认定为人机或人人进行，并且将 MetaMind 所属一方判定为人类，这在普通模型交互中则是很难误判的。该现象进一步彰显 MetaMind 的社交智能潜力 —— 建立自交互数据系统，从而为未来模型的训练构建珍贵的异质、长尾交互数据；以及人工智能的重大目标 —— 尝试攻克图灵测试。</p>
<p>未来展望：迈向更高社交智能的 AI 应用</p>
<p>MetaMind 的研究成果向我们展示了赋予 AI 类人社交智力的巨大潜力。这一多智能体元认知框架不仅在学术基准上取得了优异成绩，更为实际应用打开了新的大门。首先，在人机自然交互方面，具备 ToM 推理的 AI 将更善于领会用户的言下之意和情感状态，从而提供更贴心、恰如其分的回应。无论是智能客服、虚拟助手，还是陪伴型对话机器人，都有望因 MetaMind 式的升级而变得更加通情达理，真正理解用户所思所想，而非机械地回答问题。</p>
<p>其次，在跨文化敏感对话中，MetaMind 的领域代理可以发挥重要作用。当 AI 面对不同文化背景的用户时，能够依据当地的社会规范和礼仪来调整自己的理解和回应。这意味着未来的全球化 AI 系统可以更好地避免文化冒犯和误解，实现文化自适应的对话体验。例如，一个经过 MetaMind 式升级的国际客服机器人，能识别出某些表达在特定文化中可能是不礼貌的，从而自动修正回复用语，使之符合该文化的社交期待。</p>
<p>在教育场景下，具备社交心智的 AI 导师将大放异彩。它可以通过社交记忆了解学生的知识掌握情况和情绪变化，在教学对话中提前洞察学生可能的困惑或挫败感（ToM 智能体），并用贴合学生文化背景和个性特点的方式来引导（领域智能体），最终给予温暖而有指导性的反馈（响应智能体）。这样的智能教学系统将更像一位知冷暖、懂进退的私人导师，既能针对学术问题答疑解惑，又能在情感上激励学生，给予人性化的陪伴。</p>
<p>最后，从更宏大的视角来看，MetaMind 代表了一种 AI 设计理念的转变 —— 从追求单一指标上的极致性能，转向追求与人类认知过程的同构性。它提示我们，与其不断增大模型参数规模，不如让 AI 的思考方式更接近人类：学会像我们一样深度思考、反思自己的认知并根据社会规则调节行为。这样的 AI 将更有可能融入人类社会，帮助我们解决那些既需要智能又需要共情和伦理考量的问题，比如心理咨询、医疗陪护、群体决策等等。总而言之，MetaMind 让我们看到了打造 “懂人心” 的 AI 的曙光：未来的人工智能或许不仅能听懂我们说的话，更能明白我们没有说出口的那些话。这无疑是迈向通用人工智能的一大步，也是让技术更好服务于人的美好愿景。</p>
<p>欢迎留言：你期待 AI 在哪些社交场景大显身手？</p>
<p>作者介绍</p>
<p>张轩铭，威斯康星大学麦迪逊分校大四本科生。研究方向为类人智能 (Humanoid Intelligence) 与认知学习。他曾作为学生研究员在亚马逊 AGI、字节跳动、清华大学、智谱、北京大学高可信软件技术重点实验室参与研究。其研究成果已多次在 NeurIPS、ACL、ICLR 等顶会发表。</p>
<p>陈宇轩，清华大学计算机系硕士生。研究方向为 AI 对话模型与 AI 社交智能，涵盖多智能体与认知推理。论文曾发表于 NeurIPS、ACL、AAAI 等国际顶会。</p>
<p>Samuel Yeh，威斯康星大学麦迪逊分校计算机科学博士生。研究领域为可靠机器学习，涵盖数据导向的 AI 对齐与幻觉检测。论文多次发表于 NeurIPS、ICML、EMNLP 等国际顶会。</p>
<p>Sharon Li，威斯康星大学麦迪逊分校计算机科学系副教授，ICML 2026 程序主席。她博士毕业于康奈尔大学，师从图灵奖得主 John E. Hopcroft。Li 教授是 Alfred P. Sloan 学者，并曾获得 NSF CAREER Award、MIT Innovators Under 35 Award、Forbes 30under30 in Science 等荣誉。她的团队曾荣获 NeurIPS 2022 和 ICLR 2022 杰出论文奖。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini3 强势来袭，这次前端真的死了。。。]]></title>    <link>https://juejin.cn/post/7573958996668760091</link>    <guid>https://juejin.cn/post/7573958996668760091</guid>    <pubDate>2025-11-19T03:46:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573958996668760091" data-draft-id="7573972055269130278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini3 强势来袭，这次前端真的死了。。。"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-19T03:46:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苍何"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini3 强势来袭，这次前端真的死了。。。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苍何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T03:46:52.000Z" title="Wed Nov 19 2025 03:46:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是苍何的第 451篇原创！</p>
<p>大家好，我是苍何。</p>
<p>Gemini3 终于还是来了，预热了这么久，谷歌这次没让人失望。</p>
<p>全网现在你能看到都是 Gemini 3 了，我熬夜测到 3 点，狗嘴里硬是吐不出几个字。</p>
<p>就 2 字：牛逼 + 炸裂。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6221200b16374f8a91f7fdc49e9c37d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=v9p8bYfv65q5E88Nyv1FqKUGcNo%3D" alt="图片" loading="lazy"/></p>
<p>这个本文章的信息图好看吗？也是 Gemini3 Pro生成的。</p>
<p>这次是真炸裂，我们先不看参数和 SOTA，直接看下 case。</p>
<p>这是用 Gemini3 复刻的网站首页，几乎都是一句朴实无华的 prompt：</p>
<blockquote>
<p>请帮我复刻该网站首页。</p>
</blockquote>
<p>这是复刻的 B 站首页：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3118aa7b9e2f47feb9c19451972fd4f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=n8LO7wT5QeEBNvbIKXeilA0lFD4%3D" alt="图片" loading="lazy"/></p>
<p>这是 X 的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18559f94c82541c5a651129ad28794c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=Sqa6ALuqowO701FrDvgX2CPQIXA%3D" alt="图片" loading="lazy"/></p>
<p>这是抖音的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d75f2729167548baa1ba9fa544ba0bfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=YaB0BZ05EWlagJWDU1%2FzYz9zrq0%3D" alt="图片" loading="lazy"/></p>
<p>这是小红书的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92485b4913ea4c0e97929a54da99162e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=Vc3cFVRjeC7MVvlfn78b76pSK7g%3D" alt="图片" loading="lazy"/></p>
<p>讲真，我要不说是复刻的，你大概率不会想到这特么是十几秒就能搞定的？</p>
<p>Gemini3 Pro 比 Gemini2.5 Pro 提升不止一点，这个是用 Gemini 3 Pro 出的天气卡片：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbc43a8e85d646ad9cd039bbd0f0efb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=biDStvjTLs3wzcor5GActqumo%2FI%3D" alt="图片" loading="lazy"/></p>
<p>而之前 2.5 Pro 的长这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1494d9d7ea4f41b2810711f0a3a94ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=aS8mYvTOK1NcvUFUzagpizDeJMY%3D" alt="图片" loading="lazy"/></p>
<p>2.5 Pro 的代码能力和 Agent 能力确实挺抽象的。</p>
<p>然后是经典的六边形弹力小球测试 Gemini3 也不在话下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0f1c868b4a340528e2f5474e0b8a57e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=y3gdz%2BUGm00J1edU0JWfVGp%2BFRI%3D" alt="图片" loading="lazy"/></p>
<p>还可以一句话生成一个完全可玩的植物大战僵尸游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14d01b006cb44a5ca98637469944bfdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=CGkNno0jCaWuqos4G6JQMJknMaU%3D" alt="wxv_4259791702086647811" loading="lazy"/></p>
<p>一句话生成可交互的 3 D 动画：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/669c9dbfb2d041b48df24284cfa0790f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=v9sQSRTz%2BrCTdt0O11QxAeOofN4%3D" alt="wxv_4259792337356046337" loading="lazy"/></p>
<blockquote>
<p>提示词：用 HTML 生成 3D 演示动画，像中学生演示DNA双螺旋的复制过程</p>
</blockquote>
<p>最绝的是，我让它帮我直接写了个 MacOS 操作系统，还内置了一个 Gemini AI 助手，和小助手聊天还能 AI 回复。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a7aa92a676a4a56aee0501f95b9008e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=h3WHnguIah59v3HHdqocEo%2F92JE%3D" alt="wxv_4259795426947022848" loading="lazy"/></p>
<p>还可以将架构图截上传后复刻这个页面，并让能直接修改里面的文字。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81b7bd3548854568b69dd96679bf3eb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=4BxOI2dtnFc3wdmcvRxC8ttWpY8%3D" alt="wxv_4259796213765423106" loading="lazy"/></p>
<p>效果相当不错，这以后画架构图也方便了啊。</p>
<p>不仅仅是复刻网页，甚至还可以直接让他做个应用，比如我让他仿着 lovart 的风格来做个公众号封面图生成器。</p>
<pre><code class="hljs">帮我做一个公众号封面图生成器，只需要输入公众号文章内容，自动根据内容帮我生成符合要求的公众号封面图  
你可以参考图片中的样式进行设计开发
</code></pre>
<p>最后，你一定要看下这个视频，他居然真的根据我的内容，帮我来生图了，卧槽。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/047d31ebfafb441fa04fc4b3655c46cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=H%2F6g7k1h5Z4s7TwIoL9bsRQ30KU%3D" alt="wxv_4259802736176398337" loading="lazy"/></p>
<p>以上是我亲测的 case，除此还有非常多网友有意思的 case，比如 @arkitus 做的知识理解的 case 就很有意思，它不再是简单的文字演示，而是带有交互动画的效果演示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efd07f687279478c89d6921c5d1bd3c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=oaOphnTe5ZkSKkqbA3aLzlnj%2F9k%3D" alt="wxv_4259797222662782977" loading="lazy"/></p>
<p>除了编程能力，也测了下写作能力，因为 2.5 Pro 说实话已经很强了，这次的 Gemini 3 我感觉对指令的遵循上有提升，比如以前即使我让它不要加双引号，他总是不听话还是会加上。</p>
<p>现在 Gemini 3 Pro 就不会了，而且模仿上来说，绝对没问题的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3752042178a4a14a81262a5d5dab94a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=k6luvkhrn8IRShbldNIKo1wwXoA%3D" alt="图片" loading="lazy"/></p>
<p>好，case 看完了，确实牛逼。</p>
<p>这次 Gemini3 能力提升了非常多，可以说是飞跃式提升了，<strong>LMArena 直接干到了 1501 分，霸榜第一</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f8294a8f9b84cb190d8b27b1d72159c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=HnbYrDtxAvoZVvEijTdjBVmNlE4%3D" alt="图片" loading="lazy"/></p>
<p>Gemini3 Pro 在推理多模态上可以说是史诗级加强，可以毫不夸张的说，是目前全球最强的多模态模型了。</p>
<p>所以也就能解释为啥前端复刻能力如此之强，还在于其多模态和推理上。</p>
<p>在 Humanity’s Last Exam 这种变态难的测试里 Gemini 3 Pro 拿到 37.5%的成绩，数学能力在 MathArena 上也是刷新纪录。不管是看复杂的图表还是解高难度的数学题，它都能做好。</p>
<p>新增了 Deep Think 深度思考模式专门解决复杂问题的推理。</p>
<p>这次谷歌还推出了Agent 开发 IDE，叫 Antigravity，可以免费使用 Gemini3 Pro、Claude Sonnet 4.5。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b64fc855c5894855b1d5f07cc222c5d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=pMcpcCektx6YcXgquxPjk%2Fp%2F%2Fb8%3D" alt="图片" loading="lazy"/></p>
<p>Gemini 3 在代码生成和长上下文规划上进步巨大，SWE-bench 达到了 76.2%。对于项目级开发来说，会有很大的帮助。</p>
<p>值得注意的是，Gemini 3 现在的上下文窗口依然是 100 万 token，但处理信息的维度更广了。20 分钟的视频，现在能精确的分析出每一个细节。</p>
<p>那现在哪里可以使用呢？其实很多平台都已经支持了。</p>
<p>谷歌的 AI Studio、Gemini APP、Gemini Cli 都已经可以直接用，还有 Cursor 上也能直接用了。</p>
<p>而且 Gemini 3 的 API 也可以直接用，在自己业务系统中可以替换试用。</p>
<p>这次谷歌是动真格了，不光模型重磅更新，全平台上线，还发布了新的 AI IDE。</p>
<p>这次感受最大的还是前端又再一次遭受到了前所未有的挑战。</p>
<p>可以夸张的说，当下的 Gemini3 有足够的实力来取代一个只会 code 的前端工程师，但工程化架构化以及更懂业务的的高级工程师一时还取代不了。</p>
<p>我看很多朋友说，这次Gemini3 是通向 AGI 的一个重要时刻，说的是夸张了些，但总归又回到了当年 GPT4 刚出来那阵的兴奋了。</p>
<p>AI 又再一次铺天盖地，而我们终将是时代的见证者。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再吹性能优化了：你的应用卡顿，纯粹是因为产品设计烂🤷‍♂️]]></title>    <link>https://juejin.cn/post/7573950036897038376</link>    <guid>https://juejin.cn/post/7573950036897038376</guid>    <pubDate>2025-11-19T03:52:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573950036897038376" data-draft-id="7573950036896694312" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再吹性能优化了：你的应用卡顿，纯粹是因为产品设计烂🤷‍♂️"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2025-11-19T03:52:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再吹性能优化了：你的应用卡顿，纯粹是因为产品设计烂🤷‍♂️
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T03:52:57.000Z" title="Wed Nov 19 2025 03:52:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3349dd0b49314e4d8ce7022bf38d6b5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764129309&amp;x-signature=G1sk68zwpAR89dMUvvv%2BOwnZC5k%3D" alt="image.png" loading="lazy"/></p>
<p>大家好！</p>
<p>最近面试，我发现一个很有意思的事情。几乎每个高级前端的简历上，都专门开辟了一栏，叫<strong>性能优化</strong>。</p>
<p>里面写满了各种高大上的名词😖：</p>
<blockquote>
<p>使用Virtual List（虚拟列表）优化长列表渲染...</p>
<p>使用Web Worker把复杂计算移出主线程...</p>
<p>使用WASM重写核心算法...</p>
</blockquote>
<p>看着这些，我通常会问一个问题：</p>
<p>你为什么要渲染一个有一万条数据的列表？用户真的看得过来吗？</p>
<p>候选人通常会愣住，然后支支吾吾地说：“呃...这是我们产品经理要求的🤷‍♂️。”</p>
<p>这就是今天我想聊的话题：</p>
<p><strong>在2025年的今天，前端领域90%的所谓性能瓶颈，根本不是技术问题，而是产品问题。</strong></p>
<p>我们这群工程师，拿着最先进的前端技术（Vite, Rust, WASM），却在日复一日地给一坨屎💩（糟糕的产品设计）雕花。</p>
<hr/>
<h4 data-id="heading-0"><strong>我们正在解决错误的问题</strong></h4>
<p>让我们还原一个经典的性能优化现场吧👇。</p>
<p>场景：一个中后台的超级表格（默认大家应该比较熟悉🤔）。</p>
<p>产品经理说需求：这个表格要展示所有订单，大概有50列，每页要展示500条，而且要支持实时搜索，还要支持列拖拽，每个单元格里可能还有下拉菜单...</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f83703961f444959f43e49f20afb178~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764129309&amp;x-signature=AZ2gRS3TrmKPqkg6x5SDLXcV9IQ%3D" alt="image.png" loading="lazy"/></p>
<p><strong>开发者的第一反应（技术视角）</strong> ：</p>
<ul>
<li>50列 x 500行 = 25000个DOM节点，浏览器肯定卡死。</li>
<li>快！上<strong>虚拟滚动</strong>（Virtual Scroll）！</li>
<li>快！上<strong>防抖</strong>（Debounce）！</li>
<li>快！上<strong>Memoization</strong>（缓存）！</li>
</ul>
<p>我们为了这个需求，引入了复杂的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ag-grid.com%2Freact-data-grid%2Fgetting-started%2F" target="_blank" title="https://www.ag-grid.com/react-data-grid/getting-started/" ref="nofollow noopener noreferrer">第三方库</a>，写了晦涩难懂的优化代码，甚至为了解决虚拟滚动带来的样式问题（比如高度坍塌、定位异常），又打了一堆补丁。</p>
<p>最后，页面终于不卡了。我们觉得自己很牛逼，技术很强。</p>
<p><strong>但我们从来没问过那个最核心的问题：</strong></p>
<blockquote>
<p><strong>人类的视网膜和大脑，真的能同时处理50列 x 500行的数据吗？</strong></p>
</blockquote>
<p>答案是：<strong>不能。</strong></p>
<p>当屏幕上密密麻麻挤满了数据时，用户的认知负荷已经爆表了。他根本找不到他要看的东西。他需要的不是高性能的渲染，他需要的是<strong>筛选</strong>和<strong>搜索</strong>。</p>
<p><strong>我们用顶级的技术，去实现了一个反人类的设计。</strong> 这不是优化，这是叫作恶😠。</p>
<hr/>
<h4 data-id="heading-1"><strong>真正的优化，是从砍需求开始</strong></h4>
<p>我曾经接手过一个类似的项目，页面卡顿到FPS只有10。前任开发留下了几千行用来优化渲染的复杂代码，维护起来生不如死。</p>
<p>我接手后，没有改一行渲染代码。</p>
<p>我直接去找了产品总监，把那个页面投在大屏幕上，问了他三个问题：</p>
<p><strong>1.你看这一列 订单原始JSON日志，平均长度3000字符，你把它全展示在表格里，谁会看？</strong></p>
<p>砍掉！改成一个查看详情的按钮，点开再加载。DOM节点减少20%。</p>
<p><strong>2.这50列数据，用户高频关注的真的有这么多吗？</strong></p>
<p>默认只展示核心的8列。剩下的放在自定义列里，用户想看自己勾选。DOM节点减少80%。</p>
<p><strong>3.我就不知道为什么🤷‍♂️ 要一次性加载500条？用户翻到第400条的时候，他还记得第1条是什么吗？</strong></p>
<p>赶紧砍掉！改成标准的分页，每页20条。DOM节点减少96%。</p>
<p><strong>做完这三件事，我甚至把之前的虚拟滚动代码全删了，回退到了最朴素的<code>&lt;table&gt;</code>标签。</strong></p>
<p>结果呢？</p>
<ul>
<li><strong>页面飞一样快</strong>（因为DOM只有原来的1%）。</li>
<li><strong>代码极其简单</strong>（维护就更简单了🤔）。</li>
<li><strong>用户反而更开心了</strong>（因为界面清爽了，信息层级清晰了）。</li>
</ul>
<p><strong>这才是最高级的性能优化：不仅优化了机器的性能，更优化了人的体验。</strong></p>
<hr/>
<h4 data-id="heading-2"><strong>技术自负的陷阱</strong></h4>
<p>为什么我们总是陷在技术优化的泥潭里出不来呢？😒</p>
<p>因为我们有<strong>技术自负</strong>。</p>
<p>作为工程师，我们潜意识里觉得：承认这个需求做不了（或者做不好），是因为我技术不行。</p>
<p><strong>产品经理要五彩斑斓的黑，我就得给他做出来！</strong></p>
<p><strong>产品经理要在这个页面跑3D地球，我就得去学Three.js！</strong></p>
<p>我们试图用技术去弥补产品逻辑上的懒惰！（非常有触感😖）</p>
<p><strong>因为产品经理懒得思考信息的层级</strong> ，所以他把所有信息一股脑扔给前端，让你去搞懒加载。</p>
<p><strong>技术不是万能的。</strong></p>
<p>浏览器的渲染能力是有上限的，JS的主线程是单核的，移动端的电量是有限的。更重要的是，<strong>用户的注意力是极其有限的。</strong></p>
<p>当你发现你需要用极其复杂的新技术才能勉强让一个页面跑起来的时候</p>
<p><strong>请停下来！</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e59f0ebbf74847d88d4027a09418a1b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764129309&amp;x-signature=7r54IrvUz9ES%2FEdXo5WWtd%2Bo%2Bl8%3D" alt="stOpStopstopstOpstOp.gif" loading="lazy"/></p>
<p>这时候，问题的根源通常不在代码里，而可能是在 <strong>PRD（需求文档）</strong> 里。</p>
<hr/>
<h4 data-id="heading-3"><strong>说了那么多，该怎么做呢？</strong></h4>
<p>下次，当你再面对一个导致卡顿的需求时，别急着打开<code>Profiler</code>分析性能。</p>
<p>请试着做以下几步：</p>
<p><strong>我们真的需要在前端处理10万条数据吗？能不能在后端聚合好，只给我返回结果？</strong></p>
<p><strong>这个图表真的需要实时刷新吗？用户真的能看清1毫秒的变化吗？改成5秒刷新一次行不行？</strong></p>
<p><strong>在这个弹窗里塞个完整地图太卡了。能不能改成：点击缩略图，跳转到专门的地图页面？</strong></p>
<p>你要告诉产品经理： <strong>性能本身，也是一个产品功能。</strong></p>
<p>如果为了塞下更多的功能，牺牲了流畅度这个最核心的功能，那是丢了西瓜捡芝麻。</p>
<hr/>
<p>最好的代码，是 <strong>没有代码（No Code）</strong>。</p>
<p>同理，最好的性能优化，是<strong>没有需求</strong>。</p>
<p>作为高级工程师，你的价值不仅仅体现在你会写<code>Virtual List</code>，更体现在你敢不敢在需求评审会上，拍着桌子说：</p>
<p><strong>这个设计怎么这么反人类😠！我们能不能换个更好的方式？🤷‍♂️</strong></p>
<p>别再给屎山💩雕花了。把那座山推了，才是真正的优化。</p>
<p>关于这个观点你们怎么看？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[逆天！Gemini 3 Pro直接封神 （用三句话完成的小球物理世界）]]></title>    <link>https://juejin.cn/post/7573958996668858395</link>    <guid>https://juejin.cn/post/7573958996668858395</guid>    <pubDate>2025-11-19T04:06:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573958996668858395" data-draft-id="7573972055269081126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="逆天！Gemini 3 Pro直接封神 （用三句话完成的小球物理世界）"/> <meta itemprop="keywords" content="前端,JavaScript,Gemini"/> <meta itemprop="datePublished" content="2025-11-19T04:06:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ak啊"/> <meta itemprop="url" content="https://juejin.cn/user/237916932030253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            逆天！Gemini 3 Pro直接封神 （用三句话完成的小球物理世界）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/237916932030253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ak啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T04:06:56.000Z" title="Wed Nov 19 2025 04:06:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    194
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">用三句话完成的小球物理世界</h2>
<p><em>2025·11·19</em></p>
<p>最近在测试 Gemini 3 Pro 的代码生成能力，我做了一个很简单的实验：用尽可能少的话，让它实现一个完整的交互动画。</p>
<p>最后，我只说了三句话。</p>
<hr/>
<h3 data-id="heading-1">第一句话：</h3>
<blockquote>
<p><strong>“生成一堆颜色各异，在空间乱弹的小球。”</strong></p>
</blockquote>
<p><span href="https://code.juejin.cn/pen/7574281654547447843" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7574281654547447843" data-src="https://code.juejin.cn/pen/7574281654547447843" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span>
它返回了一个结构完整的 Canvas 动画：</p>
<ul>
<li>随机颜色</li>
<li>随机速度</li>
<li>全屏</li>
<li>不断反弹</li>
<li>点击还能生成新的球</li>
</ul>
<hr/>
<h3 data-id="heading-2">第二句话：</h3>
<blockquote>
<p><strong>“不要光效，小球富有弹性，可以微变形。”</strong></p>
</blockquote>
<p><span href="https://code.juejin.cn/pen/7574280045792624686" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7574280045792624686" data-src="https://code.juejin.cn/pen/7574280045792624686" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span>
它自动理解了我想要“果冻球”“橡胶球”那种轻微的拉伸与压扁效果，并重新组织了代码：</p>
<ul>
<li>移除光效与叠加模式</li>
<li>给小球加上简单的体积渐变</li>
<li>根据速度方向进行轻微变形（stretch &amp; squash）</li>
</ul>
<p>我没有解释公式，它自己找到了合理实现方式。<br/>
这一点给我留下比较深的印象。</p>
<hr/>
<h3 data-id="heading-3">第三句话：</h3>
<blockquote>
<p><strong>“小球之间可以相互碰撞，碰撞后会变形然后复原。”</strong></p>
</blockquote>
<p><span href="https://code.juejin.cn/pen/7574273153342373934" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7574273153342373934" data-src="https://code.juejin.cn/pen/7574273153342373934" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<p>这是最难的一步，因为已经涉及：</p>
<ul>
<li>球体碰撞检测</li>
<li>动量计算</li>
<li>速度交换</li>
<li>位置修正（避免重叠）</li>
<li>碰撞瞬间的挤压变形</li>
</ul>
<p>结果返回的代码不仅实现了全部内容，而且结构化程度依然很高，便于继续扩展。</p>
<p>这个部分如果我自己写，从零开始至少需要 1～2 小时，因为要不断调试碰撞、修正重叠，还有变形的插值。</p>
<p>它一次性生成的代码没有明显逻辑问题，这对我来说是意外的。</p>
<hr/>
<h3 data-id="heading-4">简单总结</h3>
<p>这次体验非常直接，不需要夸大：</p>
<ul>
<li><strong>我只给了三句话</strong></li>
<li>每句话都在增加系统复杂度</li>
<li>它能持续保持代码质量</li>
<li>生成速度快</li>
<li>细节实现到位</li>
<li>没有出现明显 bug</li>
</ul>
<p>从实用角度讲，<strong>如果以后要快速验证动画、交互、物理效果的原型，这种能力非常有用</strong>。</p>
<p><strong>Gemini 3 Pro</strong> 表现出的能力远超我预期。我只说了三句话，它就把一个完整的小球物理世界搭建好了——从随机颜色、自由弹跳，到速度拉伸、碰撞挤压，再到防粘连修正，每一个细节都处理得井井有条。它不仅理解了我的意图，还能把复杂逻辑自动落地，生成结构清晰、可扩展的代码。这种速度、准确度和工程级质量，真的让人感受到大模型带来的效率革命——你说的三句话，它几乎读懂了你的脑子，并直接把想法变成现实。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跟着TRAE SOLO全链路看看项目部署服务器全流程吧]]></title>    <link>https://juejin.cn/post/7574041466710294571</link>    <guid>https://juejin.cn/post/7574041466710294571</guid>    <pubDate>2025-11-19T06:56:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574041466710294571" data-draft-id="7574084898878062633" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跟着TRAE SOLO全链路看看项目部署服务器全流程吧"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-19T06:56:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林太白"/> <meta itemprop="url" content="https://juejin.cn/user/1874034273300919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跟着TRAE SOLO全链路看看项目部署服务器全流程吧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1874034273300919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林太白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T06:56:17.000Z" title="Wed Nov 19 2025 06:56:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">跟着TRAE SOLO全链路看看项目部署服务器全流程吧</h2>
<p>接下来我们新建一个项目，然后将项目部署到服务器上，并且配置好以后可以在外网进行访问</p>
<pre><code class="hljs language-bash" lang="bash">安装nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
</code></pre>
<h3 data-id="heading-1">1、简单服务器环境搭建</h3>
<p>接下来我们就实现把 Node.js 项目部署到<code> /opt/nexus-node-api </code>并配置外部访问</p>
<h4 data-id="heading-2">进入服务器以后安装环境</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 更新包列表</span>
sudo apt update

<span class="hljs-comment"># 安装 Node.js 和 npm</span>
sudo apt install nodejs npm

<span class="hljs-comment"># 验证安装</span>
node --version
npm --version
</code></pre>
<h4 data-id="heading-3">项目创建</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建目录</span>
sudo <span class="hljs-built_in">mkdir</span> -p /opt/nexus-node-api

<span class="hljs-comment"># 设置所有者和权限</span>
sudo <span class="hljs-built_in">chown</span> -R <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> /opt/nexus-node-api
<span class="hljs-built_in">chmod</span> -R 755 /opt/nexus-node-api

<span class="hljs-comment"># 进入目录</span>
<span class="hljs-built_in">cd</span> /opt/nexus-node-api

<span class="hljs-comment"># 创建一个项目</span>
nano app.js
</code></pre>
<h4 data-id="heading-4">项目内容</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello World!\n'</span>);
});
server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-string">'0.0.0.0'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running on port 3000`</span>);
});
</code></pre>
<h4 data-id="heading-5">测试运行以及外网访问</h4>
<p>注意点：一定要注意这个时候必须保证你的服务器里面的防火墙（安全组）规则里面有3000这个端口号</p>
<pre><code class="hljs language-perl" lang="perl">node app.js

现在访问 http:<span class="hljs-regexp">//</span>你的服务器IP:<span class="hljs-number">3000</span> 应该能看到 <span class="hljs-string">"Hello World!"</span>
</code></pre>
<h3 data-id="heading-6">2、正式项目配置</h3>
<h4 data-id="heading-7">卸载node环境</h4>
<p>这里我们使用nvm来配置我们的环境，如果已经有的，我们删除一下已经有的环境</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 卸载 nodejs 和 npm</span>
sudo apt-<span class="hljs-keyword">get</span> <span class="hljs-keyword">remove</span> nodejs npm
sudo apt-<span class="hljs-keyword">get</span> purge nodejs npm
</code></pre>
<h4 data-id="heading-8">安装nvm</h4>
<pre><code class="hljs language-bash" lang="bash">// 安装 nvm
<span class="hljs-comment"># 建议安装 nvm，方便版本管理</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
</code></pre>
<p>配置环境变量</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑 .bashrc</span>
nano ~/.bashrc

//添加配置 ---一般系统会自动为我们添加
<span class="hljs-built_in">export</span> NVM_DIR=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm"</span>
[ -s <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; . <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/nvm.sh"</span>
[ -s <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/bash_completion"</span> ] &amp;&amp; . <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/bash_completion"</span>

// 重新加载配置
<span class="hljs-built_in">source</span> ~/.bashrc

// 验证 nvm 安装
nvm --version
</code></pre>
<h4 data-id="heading-9">安装稳定版本node</h4>
<pre><code class="hljs language-csharp" lang="csharp">ubuntu为例子
<span class="hljs-comment">// 查看可以安装的稳定版本</span>
nvm ls-remote

<span class="hljs-comment">// 这里我安转版本</span>
nvm install v22<span class="hljs-number">.12</span><span class="hljs-number">.0</span>
<span class="hljs-comment">// 使用</span>
nvm use v22<span class="hljs-number">.12</span><span class="hljs-number">.0</span>

<span class="hljs-comment">// 设置默认版本</span>
nvm <span class="hljs-keyword">alias</span> <span class="hljs-literal">default</span> v22<span class="hljs-number">.12</span><span class="hljs-number">.0</span>
<span class="hljs-comment">//   pm2</span>
npm i -g pm2
</code></pre>
<h4 data-id="heading-10">使用pm2守护进程</h4>
<p>PM2 是 Node 应用的进程管理工具，能保证服务在后台持续运行：要不然关闭窗口之后，就无法访问了</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局安装 PM2</span>
npm install pm2 -g

<span class="hljs-comment"># 启动服务并命名（方便管理）</span>
pm2 start app.js --name <span class="hljs-string">"node-api-nexus"</span>

<span class="hljs-comment"># 查看服务状态</span>
pm2 list  <span class="hljs-comment"># 若 Status 为 online 则表示启动成功</span>
</code></pre>
<p>这个时候不管怎么刷新我们的页面或者窗口，可以始终稳定访问我们的接口</p>
<h5 data-id="heading-11">pm2 重启对应的服务</h5>
<pre><code class="hljs language-arduino" lang="arduino">pm2 restart <span class="hljs-string">"node-api-nexus"</span>
</code></pre>
<h3 data-id="heading-12">3、服务器安装mysql数据库</h3>
<h4 data-id="heading-13">环境搭建</h4>
<p>接下来我们在服务器上安装mysql数据库，这里需要我们输入服务器密码</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 更新包列表</span>
sudo apt update

<span class="hljs-meta"># 安装 MySQL 服务器 </span>
<span class="hljs-comment">// 安装 MySQL 8.0（Ubuntu 默认源即提供 MySQL 8.0）</span>
sudo apt install mysql-server -y

<span class="hljs-meta"># 安装过程中可能会提示输入服务器密码</span>

<span class="hljs-meta"># 确认 MySQL 版本</span>
mysql --version
</code></pre>
<h4 data-id="heading-14">MYSQl数据库安全配置</h4>
<h5 data-id="heading-15">调整 MySQL 服务器的安全性</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 安全配置（可选但推荐）</span>
sudo mysql_secure_installation

测试可以都选n


按照提示配置：
是否启用强密码   <span class="hljs-comment">// y </span>
设置 root 密码   <span class="hljs-comment">// Le@1996#Lin</span>
移除匿名用户
禁止远程 root 登录（可选）
删除测试数据库
重新加载权限表
</code></pre>

<pre><code class="hljs language-css" lang="css">登录 MySQL
sudo mysql -u root -<span class="hljs-selector-tag">p</span>
输入密码即可
</code></pre>
<h4 data-id="heading-16">配置远程访问（可选）</h4>
<pre><code class="hljs language-ini" lang="ini">配置 MySQL 允许本地连接：

sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

配置信息
<span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 确保绑定到本地</span>
<span class="hljs-attr">bind-address</span> = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>

<span class="hljs-comment"># 设置端口</span>
<span class="hljs-attr">port</span> = <span class="hljs-number">3306</span>

<span class="hljs-comment"># 设置字符集</span>
<span class="hljs-attr">character-set-server</span> = utf8mb4
<span class="hljs-attr">collation-server</span> = utf8mb4_unicode_ci
</code></pre>
<h5 data-id="heading-17">修改mysql数据库配置</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 注释掉原来的 bind-address 或改为 0.0.0.0</span>
<span class="hljs-comment"># bind-address = 127.0.0.1</span>
<span class="hljs-attr">bind-address</span> = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>
<span class="hljs-attr">port</span> = <span class="hljs-number">3306</span>
</code></pre>
<h5 data-id="heading-18">重启服务,登录mysql创建远程连接用户</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 重启mysql服务
sudo systemctl restart mysql

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 登录
sudo mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 密码
<span class="hljs-number">123456</span>

<span class="hljs-comment">-- 创建远程用户（% 表示允许任何IP连接）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'账号'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'密码'</span>;

<span class="hljs-comment">-- 授予权限</span>
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'密码'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION;

<span class="hljs-comment">-- 或者只授权特定数据库(跳过)</span>
<span class="hljs-comment">-- GRANT ALL PRIVILEGES ON your_database.* TO 'remote_user'@'%';</span>

<span class="hljs-comment">-- 刷新权限</span>
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 查看用户</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">User</span>, Host <span class="hljs-keyword">FROM</span> mysql.user;

<span class="hljs-comment">-- 退出</span>
EXIT;

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 重启 MySQL
sudo systemctl restart mysql

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 设置开机自启（默认应已设置）
sudo systemctl enable mysql
</code></pre>
<h3 data-id="heading-19">4、navicat远程mysql数据库</h3>
<p>切记：一定要保证我们的服务器已经添加了我们的端口3306</p>
<p>服务器允许我们远程连接</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 开放 3306 端口</span>
sudo ufw allow <span class="hljs-number">3306</span>

<span class="hljs-comment"># 或者只允许特定IP访问（更安全）</span>
sudo ufw allow <span class="hljs-keyword">from</span> 你的本地IP to <span class="hljs-built_in">any</span> port <span class="hljs-number">3306</span>

<span class="hljs-comment"># 查看防火墙状态</span>
sudo ufw status
</code></pre>
<h4 data-id="heading-20">远程连接</h4>
<p>本地远程mysql数据库,我使用的是navicat工具，这里直接输入我们的信息</p>
<pre><code class="hljs">连接名：远程服务器,随便起名字
主机：服务器IP
用户名：上面设置的
密码：上面设置的
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6be106fdc964442998cf5af33acacd02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6X5aSq55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764140176&amp;x-signature=7QtCZG5aMpkvM1h5oUiXZdBLmA0%3D" alt="" loading="lazy"/></p>
<p>测试一下，服务器的数据库已经连接成功了</p>
<h4 data-id="heading-21">数据库连接测试</h4>
<p>新建一个数据库，这里我的名称是nexus</p>
<pre><code class="hljs">数据库名：nexus
字符集：utf8mb3
排序规则：utf8mb3_bin
</code></pre>
<p>新建一个表</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `sys_user`;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `sys_user`  (
  `user_id` <span class="hljs-type">int</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'id'</span>,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'姓名'</span>,
  `age` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'年龄'</span>,
  `sex` <span class="hljs-type">int</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户性别 1男 2女 '</span>,
  `create_time` datetime(<span class="hljs-number">0</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  `address` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户的地址'</span>,
  `state` tinyint(<span class="hljs-number">0</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'1 正常  0 2  禁用'</span>,
  `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'手机号'</span>,
  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户的登录账号'</span>,
  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'123456'</span> COMMENT <span class="hljs-string">'用户的登录密码'</span>,
  `avatar` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'头像地址'</span>,
  `update_time` datetime(<span class="hljs-number">0</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'更新时间'</span>,
  `user_height` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'身高'</span>,
  `user_weight` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'体重'</span>,
  `disease` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'健康状况，是否有疾病'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`user_id`, `password`) <span class="hljs-keyword">USING</span> BTREE
) ENGINE <span class="hljs-operator">=</span> InnoDB AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">55</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8mb3_general_ci ROW_FORMAT <span class="hljs-operator">=</span> <span class="hljs-keyword">Dynamic</span>;
</code></pre>
<h4 data-id="heading-22">本地运行项目测试</h4>
<p>这里我们现在就本地启动项目连接我们服务器，然后进行测试，这里我以开源的Node项目为例，主要修改四个参数</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">dbhost</span>=<span class="hljs-string">'xx'</span><span class="hljs-comment">; // 数据库主机地址，如果是本地数据库则使用localhost</span>
const <span class="hljs-attr">dbdatabase</span>=<span class="hljs-string">'xx'</span><span class="hljs-comment">; // 数据库名称</span>
const <span class="hljs-attr">dbuser</span>=<span class="hljs-string">'xx'</span><span class="hljs-comment">; // 数据库用户名</span>
const <span class="hljs-attr">dbpassword</span>=<span class="hljs-string">'xxx'</span><span class="hljs-comment">; // 数据库密码</span>
</code></pre>
<p>本地测试一下，我们的线上数据库已经可以使用了</p>
<h3 data-id="heading-23">5、Node项目部署</h3>
<p>接下来我们将node项目部署进我们的服务器，首先把我们项目都扔进去</p>
<h4 data-id="heading-24">配置环境</h4>
<p>这里我用的是yarn，安装一下</p>
<pre><code class="hljs language-arduino" lang="arduino">npm install yarn -g 


<span class="hljs-comment">// 配置环境</span>
yarn

<span class="hljs-comment">// 启动pm2</span>
pm2 start app.js --name <span class="hljs-string">"node-api-nexus"</span>

<span class="hljs-comment">// 重新启动pm2 设置开机自启</span>
pm2 startup
pm2 save
</code></pre>
<p>查看详细日志</p>
<pre><code class="hljs">pm2 logs node-api-nexus
</code></pre>
<p>启动以后我们就可以直接在浏览器打开地址对我们的系统后台进行访问了</p>
<pre><code class="hljs language-arduino" lang="arduino">http:<span class="hljs-comment">//XXX<span class="hljs-doctag">XXX:</span>3200/</span>
</code></pre>
<h3 data-id="heading-25">6、前端部署</h3>
<h4 data-id="heading-26">环境安装</h4>
<p>接下来我们继续部署我们的前端应用，先用我们的项目连接一下我们的数据库尝试一下 OK，没什么问题，然后我们开始部署前端项目</p>
<pre><code class="hljs language-arduino" lang="arduino">项目名称为nexus-vue，项目打包好的路径位于 /opt/nexus-vue 下面

<span class="hljs-comment">// 打包前端项目</span>
yarn build

<span class="hljs-comment">// 更新和安装nginx </span>
<span class="hljs-comment">// 更新可以跳过 之前我们已经进行过</span>
sudo apt update
sudo apt install nginx

<span class="hljs-comment">// 查看版本</span>
nginx -V
</code></pre>
<h4 data-id="heading-27">配置nginx</h4>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/nginx/sites-available/nexus-vue

// 配置如下
server {
    listen 80;
    server_name localhost;  <span class="hljs-comment"># 替换为你的域名或IP</span>

    root /opt/nexus-vue;
    index index.html;

    location / {
        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
    }

    <span class="hljs-comment"># 如果需要代理API请求</span>
    location /api {
        proxy_pass http://localhost:3000;
    }
}
server {
    listen 8080;
    server_name localhost;  <span class="hljs-comment"># 替换为你的域名或IP</span>

    <span class="hljs-comment"># 前端静态文件</span>
    root /opt/nexus-vue;
    index index.html;

    <span class="hljs-comment"># 前端路由</span>
    location / {
        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
    }

    <span class="hljs-comment"># 后端API请求</span>
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade <span class="hljs-variable">$http_upgrade</span>;
        proxy_set_header Connection <span class="hljs-string">'upgrade'</span>;
        proxy_set_header Host <span class="hljs-variable">$host</span>;
        proxy_cache_bypass <span class="hljs-variable">$http_upgrade</span>;
    }

    <span class="hljs-comment"># WebSocket连接</span>
    location /ws {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade <span class="hljs-variable">$http_upgrade</span>;
        proxy_set_header Connection <span class="hljs-string">"upgrade"</span>;
        proxy_set_header Host <span class="hljs-variable">$host</span>;
    }
}
</code></pre>
<h4 data-id="heading-28">开放接口</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">sudo</span> <span class="hljs-string">ufw</span> <span class="hljs-string">allow</span> <span class="hljs-number">8080</span>

<span class="hljs-string">sudo</span> <span class="hljs-string">systemctl</span> <span class="hljs-string">restart</span> <span class="hljs-string">nginx</span>
</code></pre>
<p>处理日志错误</p>
<pre><code class="hljs language-ruby" lang="ruby">/<span class="hljs-regexp">/ 检查nginx错误日志
sudo tail -f /var</span><span class="hljs-regexp">/log/nginx</span><span class="hljs-regexp">/error.log


/</span><span class="hljs-regexp">/开放文件权限
sudo chmod -R 755 /opt</span><span class="hljs-regexp">/nexus-vue

/</span><span class="hljs-regexp">/ 检查配置
sudo nano /etc</span><span class="hljs-regexp">/nginx/sites</span>-available/nexus-vue

/<span class="hljs-regexp">/ 重新启动nginx
sudo systemctl restart nginx
</span></code></pre>
<h4 data-id="heading-29">部署</h4>
<p>写一个测试页面扔进去</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我是测试页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>我是测试页面<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>访问我们的地址<code>http://域名IP:8080/</code></p>
<pre><code class="hljs">这个时候已经可以看到我们的项目已经部署上去了
</code></pre>
<p>重新加载以后，ok，到这里我们全链路都部署上去了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fcd06041e5942e1897904d1f5491a45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6X5aSq55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764140176&amp;x-signature=Vn5%2Ba7WRF5qXM%2FitGuRJ5%2B%2FySZQ%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【开源】耗时数月、我开发了一款功能全面【30W行代码】的AI图床]]></title>    <link>https://juejin.cn/post/7574271557938905139</link>    <guid>https://juejin.cn/post/7574271557938905139</guid>    <pubDate>2025-11-19T10:15:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574271557938905139" data-draft-id="7574271557938855987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【开源】耗时数月、我开发了一款功能全面【30W行代码】的AI图床 "/> <meta itemprop="keywords" content="前端,后端,开源"/> <meta itemprop="datePublished" content="2025-11-19T10:15:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_小九"/> <meta itemprop="url" content="https://juejin.cn/user/3861140568811576"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【开源】耗时数月、我开发了一款功能全面【30W行代码】的AI图床 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3861140568811576/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _小九
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T10:15:48.000Z" title="Wed Nov 19 2025 10:15:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI编程发展迅猛，现在如果你是一个全栈开发，借助AI编辑器，比如<strong>Trae</strong>你可以开发很多你以往无法实现的功能，并且效率会大大提示，<strong>Tare</strong>的<strong>Coding能力</strong>已经非常智强了，借助他，我完成了这个<code>30W行</code>代码的开源项目，现在，想把这个项目推荐给你。</p>
<p>当前文章主要是介绍我们开发出的这个项目，在后续，将会新开一个文章专门介绍<strong>AI Coding</strong>的各种技巧，如何使用他，才能让他在<strong>大型项目</strong>中依然如虎添翼。</p>
<blockquote>
<p>如果你想快速了解此项目、你可以访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fpixelpunk.cc%2F" target="_blank" title="https://pixelpunk.cc/" ref="nofollow noopener noreferrer">PixelPunk官方文档</a>。</p>
</blockquote>
<blockquote>
<p>如果你想快速体验此项目、你可以访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fv1.pixelpunk.cc%2F" target="_blank" title="https://v1.pixelpunk.cc/" ref="nofollow noopener noreferrer">V1版本</a>,前往体验功能。</p>
</blockquote>
<blockquote>
<p>如果你想完整体验前后台全面的功能、你可以访问<a href="https://link.juejin.cn?target=http%3A%2F%2Fdev.pixelpunk.cc%2F" target="_blank" title="http://dev.pixelpunk.cc/" ref="nofollow noopener noreferrer">测试环境</a>。【root 123456】</p>
</blockquote>
<blockquote>
<p>如果您认可我的项目，愿意为我献上一个宝贵的Star，你可以前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCooperJiang%2FPixelPunk" target="_blank" title="https://github.com/CooperJiang/PixelPunk" ref="nofollow noopener noreferrer">PixelPunk</a>项目。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bada0a94aae436495f282772dd0748b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=046KAzJ3ITK5fWE0X%2BdC2dEoQZc%3D" alt="image.png" loading="lazy"/></p>
<p>开发这样一个项目在现在这个时间来看似乎没什么必要，实际上开发这样一个项目的原因其实就是在年初的时候失业了一段时间，闲在家里无聊，于是想着做一个自己的开源项目，最开始其实做的是另一个类型的项目，开发了一段时间感觉有些无聊就转战做了现在的这个项目<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCooperJiang%2FPixelPunk" target="_blank" title="https://github.com/CooperJiang/PixelPunk" ref="nofollow noopener noreferrer">PixelPunk图床</a>， 其实并不只是想要做一个<code>图床</code>，只是当前来说的一期功能比较贴合图床，后期的跌代准备支持更多格式包括视频文档等等，并且由于<code>AI多模态模型</code>的能力发展迅速，后期结合<code>AI</code>可以实现更多可玩性比较高的内容。</p>
<p>市面上已经有了非常多的开源图床了，开发这样一个项目要追求一些差异点才会有价值，本质上来说这类服务其实核心就是个存图片而已，其他功能并不是很重要，但是作为个人使用用户来说，除了存图也愿意去尝试一些便捷的功能，于是思考到这个点之后，我开始了这个项目的开发，项目的命名<code>[PixelPunk] </code>是我让AI起的，因为要做就要做一个不一样的有特点，我要做一个ui上就不一样的图床出来，于是有了此命名，中文翻译过来是<code>像素朋克</code>,由于像素风格感觉ui不是很适合工具类网站使用，于是我选择了<code>赛博朋克风格</code>，围绕这个ui来开发了此项目。</p>
<h3 data-id="heading-0">项目概览</h3>
<p>首先呢项目从开发就一个全栈项目，前后端放一起了，采用的技术栈是 go+vue， 前端会将打包的文件放入到go中一起打包为<code>二进制</code>安装包，这样部署起来将非常简单。
项目分为了用户端和管理端，并且同属于一个项目，不分离开发，为了符合我们定制化的ui，所有组件都是自定义的组件，项目使用了<code>70+</code>自定义组件。
项目接入了多模态<code>AI</code>大模型，在以前我们的图床要实现各种功能需要对接各种各样的平台，现在有了<code>AI</code>，我们只需要一个模型就能完成非常多的功能，比如【<strong>语义化描述图片</strong>】，【**<em>图片OCR识别</em>】，【**<em>图片自动分类</em>】，【**<em>图片自动打标</em>】，【**<em>图标自动审核NSFW、违规图、敏感图、血腥图等等</em>】，【<strong>图片颜色提取</strong>】等等功能都只需要配置一个<code>AI模型</code>即可，对于成本而言，比之前的三方<code>API</code>可能更加便宜</p>
<h3 data-id="heading-1">关于部署</h3>
<p>作为一个开源项目，我想的是需要使用者使用起来足够简单，部署起来也足够快，本身来讲，我们项目需要用来这些内容，<code>mysql|Sqlite</code> + <code>Redis|系统内存</code> + <code>qdrant向量数据库</code>， 这三件套，为了安装简单，我将向量数据库直接集成到安装包，用户可以无需关系任何内容，我们可以做到<code>0配置启动项目</code>，不需要你做任何配置即可超快部署项目。</p>
<p>我们提供了两种部署方式，一种是安装包部署，你可以下载对应平台的安装包**.zip安装包**，下载到你的服务器，解压之后里面有一个<code>install.sh</code>，直接<code>sh ./install.sh</code>即可安装，当然手动部署 可能还需要两个步骤，你可以使用我们的脚本直接进行部署，也可以看看我们的部署文档，<a href="https://link.juejin.cn?target=https%3A%2F%2Fpixelpunk.cc%2Fdocs%2Fgetting-started" target="_blank" title="https://pixelpunk.cc/docs/getting-started" ref="nofollow noopener noreferrer">PixelPunk部署文档</a>。</p>
<blockquote>
<p>安装包一键部署 <code>curl -fsSL https://download.pixelpunk.cc/shell/install.sh | bash</code></p>
</blockquote>
<blockquote>
<p>docker-compose一键部署脚本 <code>curl -fsSL https://download.pixelpunk.cc/shell/docker-install.sh | bash</code></p>
</blockquote>
<p>我们的部署非常简单，你只需要执行完脚本即可直接启动项目，我们的<code>docker-compose部署方式</code>已经配置了所有数据库缓存等信息，启动项目进入 <strong><a href="https://link.juejin.cn?target=http%3A%2F%2Fip%3A9520" target="_blank" title="http://ip:9520" ref="nofollow noopener noreferrer">http://ip:9520</a></strong> 会自动跳转到安装页面，添加管理员账号密码即可完成安装， 如果使用安装包模式呢，那么就支持你可以自定义选择数据库，可以填写自己的mysql，也可以使用系统内置的<code>Sqlite</code>，可以选择自己的<code>向量数据库和缓存</code>，也可以使用系统内置的，自由选择，总之，一键脚本预估20S就可以帮你安装并且启动项目，无需你的任何配置，希望会自己内置生成一些必要信息，比如<strong>jwt</strong>，系统安装后你可以进入后台管理进行修改。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28da070422dd4053915ba5f9e947322a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=QN8mnmOLPXfFpR6sGM1VVRjEBNw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">项目部分功能</h3>
<p>我们的项目功能可以说已经非常全面了，并且还在持续迭代，目前代码总行数已经达到了<code>30W行</code>，很多功能需要你自己体验，我们覆盖了主流图床的全部功能，并且还在进一步持续加入更多有趣的元素，我们可以列举一些功能做简要说明。</p>
<h4 data-id="heading-3">10+精美主题</h4>
<p>作为个人使用的工具，我一直在持续优化UI和交互，始终认为，<code>UI</code>还是很重要的一个步骤，目前的<code>UI还不够精美</code>，也是后续会持续调整的一个点，目前提供了<code>10多套</code>主题，并且您可以自定义主题，我在项目中放置了<strong>主题开发文档</strong>,你可以根据模板文件去替换一套变量即可完成一套主题的开发。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c9416634a9d4fe6a07b2f25dbab0ab4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=pkSI7K4CTlF5zHMEZLBFxl1QmFg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdf3798fec034b7aaceff58524b7b733~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=gYITr0mdbY2Rj4EWqkTBkRBJJ3c%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">多语言双风格</h4>
<p>我们目前内置了三种语言<code>中英日</code>,并且为了迎合我们<code>PixelPunk风格</code>的特色，我们新增了一种风格选项，你可以选择<code>赛博朋克风格</code>的文案，让系统的所有内容提示充满赛博味道~</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3152eb1f44824daa9aaf4428e0357b0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=9u%2BdbT%2BNiVsgEKrlEa8cpZPpZXY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62ec4e8376c542c6b5fc0a62f9b8a512~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=zQlg2awfkZ6nL8c7OPjhm2V2hoA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">多布局系统</h4>
<p>我们网站为了更好的工作体验，提供了两种的布局方式,<code>传统布局</code>,<code>工作布局</code>，既可以使用传统的轻量化的布局让人轻松，也可以使用工作台布局让工作更高效。并且您还可以在后台限制这些功能，使用固定布局而不开放这些功能，在后台管理部分都可以实现。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b76d28edf12749e180c31bd42d90ad6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=BqsX8kXEGnHy0rVFOuBgu6jFKkQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f22417779924ad1898afc8620ad40f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=YyNiK%2FGz7syOQpWj8I6Ng%2BwaYc8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">多种登录方式</h4>
<p>我们内置默认使用传统邮箱的登录方式，并且支持关闭注册，<code>邮箱配置也是后台配置即可</code>，同时系统对接了<code>Github</code>、<code>Google</code>、<code>LinuxDo</code>三种接入成本非常低的快捷登录方式，并且可能由于你是国内服务器，无法直接访问这些服务，所以系统贴心的准备了<code>(代理服务)</code>配置，让你即使是国内服务器也依然可以顺利完成这些快捷登录。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55af683a3ec340e09bba7b1a875dfaf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=bRWkKlZ%2FyX0ZYNK2y0Bpw41%2FQ3A%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8fc5d4613564de4b8bb1b823ec4c39e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=AIrC%2Fyf%2BppTocXvsAPBoh16kV7o%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">强大的特色文件上传</h4>
<p>文件上传是一个基础的功能，所有图床都支持，我们当然也支持，我们在此功能上进行了耐心的打磨，支持很多特色功能，</p>
<ul>
<li>支持后台动态配置允许格式，动态配置上传图片限制尺寸</li>
<li>支持<code>大文件分片上传</code>、<code>断点续传</code>等功能。</li>
<li>支持<code>秒传</code>，后台动态开启是否启用</li>
<li>支持<code>游客模式</code>，限制游客上传数量，并限制上传资源有效时间</li>
<li>支持<code>自定义资源保存时间</code>，后台可配置用户允许选择有效期，精确到分钟</li>
<li>支持<code>重复图检测</code>，重复图自动秒传，不占用空间</li>
<li>支持水印，并且特色化水印，开发了一个水印专用面板用于你配置特色化水印，支持<code>文字、图片</code>水印。</li>
<li>支持<code>中断上传</code>,取消上传</li>
<li>支持<code>上传实时进度提示</code></li>
<li>支持<code>自动优化图片</code>，<code>自定义上传文件夹</code>。</li>
<li>支持<code>文件夹上传</code>,<code>拖拽上传</code>,<code>项目内全局上传（任意页面都支持上传）</code>。</li>
<li>支持<code>原图复制</code>,<code>MD格式复制</code>,<code>HTML格式复制</code>,<code>缩略图格式复制</code>,<code>全部图片链接批量复制</code></li>
<li>支持<code>公开、私密、受保护</code>,三种权限设置，<code>公开图片</code>可以在任何地方显示并且授权给管理员可以用于推荐，并且在作者首页可以展示对外，<code>私密</code>则仅自己可见，系统其他人不可见，<code>受保护</code>权限图片只能在系统观看打开，无法产生链接，除自己登录系统外，其他人无法观看。</li>
<li>支持<code>持久化</code>，你可以选择图片并且上传中，跳转到任何页面而不会中断你的上传，你可以在上传过程中干任何事情</li>
<li>支持<code>特色悬浮球</code>，当你不在上传页面的其他页面，如果有上传内容，会有一个特色上传球实时告知您上传的进度，并且你可以随意拖动控制悬浮球的位置。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fdc7ea1ec924525bf3b14d5d5ca803d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=P5I48qTZ681qRtQemYbnxdyM2MY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f66c5469421d47639f17f4d9fd308934~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=AGis85x6E6aOeT514m8gygfdzhU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93ae54015b5348ceaa37d7fc7874985f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Vo6udTlkiV2aSaZXgQXvrfRQ6G4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">超过上传渠道支持</h4>
<p>作为一个图床的基本素养，都会支持对接三方，目前我们已经支持了<code>10+</code>的三方云储存渠道，并且添加时候可以测试渠道保障你的配置，首先我们支持<code>服务器自身存储</code>，这也是系统默认渠道，你可以在后台渠道配置更多，比如<code>阿里云COS</code>,<code>腾讯云OSS</code>,<code>七牛云</code>,<code>雨云</code>,<code>又拍云</code>,<code>S3</code>,<code>Cloudfare R2</code>,<code>WebDav</code>,<code>AZure</code>,<code>Sftp</code>,<code>Ftp</code>,等等渠道，<strong>S3</strong>协议本身就可以支持非常多的基于S3协议的渠道了，并且，如果你想要更多渠道，可以去往我们官网网站提起诉求，我们可以很快支持新的渠道。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa931accca7c4903a5eb329f90d1adb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=lykqpx7jqED%2B9tnj8GK1NffKGnE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e2674a6366e4caabe03f3f98f0f6391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Ui6agEDPab1Q5OjE2WpOoaki%2B7A%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">特色AI功能</h4>
<p>AI也是我们图床的一大特色，我们利用AI做了这些事情</p>
<ul>
<li>自动分类</li>
<li>自动打标</li>
<li>语义化图片，提取信息，提取色调</li>
<li>实现ai自然语言搜索</li>
<li>实现相似图搜索</li>
<li>实现NSFW违规图审核</li>
</ul>
<p>而这些，仅仅只需要配置一个<strong>openai的gpt4-mini</strong>即可完成，后续会支持更多渠道（目前仅支持配置OPENAI格式的渠道），目前测试感觉<strong>gpt-4.1-mini</strong>足以胜任工作，并且价格低廉，性价比很高。</p>
<ul>
<li>违规图片检测 可以自定义等级 宽松或严格</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b57cfde532dc4c13bad16a572ff66a93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=qYG9qLtaHLEDBDx28fKEH5Sd5Go%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>自然语言搜索图片</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/084de3398649419f834f4c948b2bcfa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Tt8nptZae1e3dNdJjKKL0js4HNI%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>相似图搜索</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d322149879694be5bfd9c7a94b420738~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=V9k%2BBT44cE4Xln%2B6wh4JTSX5f8g%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>图片ai描述</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55e575a838c24ced9ef145455cdd7ef1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=l%2BKwYtVZq0zxvfGEX5EvvthywJU%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>自动分类打标签</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05ea689cef8c44829823170ca949d523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=mn03ubC2618pQuafFawjHPicIOA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">文件夹功能</h4>
<p>文件分类是一个和合理的诉求，所以我们可以自定义创建文件夹，同样可以控制不同的权限，并且文件夹可以无限嵌套 你可以自定义多层级的文件夹 合理管理你的文件，并且我们支持<code>文件夹移动</code>，<code>图片移动</code>，<code>批量操作</code>，<code>右键菜单</code>，<code>拖拽排序</code>等等特色功能，你可以灵活的管理你的文件。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffa3db788fb14937a9ca47cf82d77def~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Zm%2F3TEl193SXbkK5hzmIiU0rJ8A%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>右键菜单</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/512e2954b1334e7fa3b57f69b490068d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=D3V4yCKNPBX62VmzJzfo0EBY%2F1g%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-11">分享系统</h4>
<p>我们拥有大量素材，或者一些收藏资源需要分享给好友，我们可以任意创建分享，可以分享自己的文件夹，图片，也可以组合分享，也可以分享用户公开的推荐图，选择任意探索广场的图进行分享，并且可以统计访问次数，限制访问次数，达到访问次数关闭分享，密码分享，限制时间有效期分享，邮箱通知等等功能。</p>
<p>您可以观看我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fv1.pixelpunk.cc%2Fshare%2FETDMDkz6EnzZxEMl" target="_blank" title="https://v1.pixelpunk.cc/share/ETDMDkz6EnzZxEMl" ref="nofollow noopener noreferrer">演示分享内容</a></p>
<ul>
<li>创建分享</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa459bf521ec476b8190f04bb4f84bd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=nnXi4XsOomOAIkEv6%2F9v4f1kaeU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a5e483c67d4441e897fb2c9879ec1b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=gh9K%2Bc9DazHicKKW500pas9c7EM%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-12">防盗链管理</h4>
<p>图床安全始终是一个问题，经常会遇到被盗刷的风险，由于流量费用贵，鄙人有幸被刷破产过一次（TMD），我们加入了防盗链配置，可以配置<code>白黑名单域名|IP</code>，可以配置<code>网站refer</code>等内容，并且对于违规的用户，我们可以配置让其<code>302到他地址</code>,<code>可以自定义返回固定图</code>,<code>也可以直接拒绝</code>。</p>
<p>当我们对接三方渠道的时候，正常情况我们会拿到<code>远程url地址</code>，我们依然可以在后台配置渠道将其隐藏远程url地址，如果配置，那么域名请求将会从我们服务器代理获取，可以隐藏掉三方的地址，或者配置私有存储桶通过秘钥去动态获取图片，防止你的图片被盗刷大量流量</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6092e578d72a4b2f83e9f98b4ec1c277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=s%2BghD%2FZfbwm7WX5k72c2eppjwgk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-13">开放API</h4>
<p>图床的基本功能之一，我们可以生成秘钥在三方进行上传文件，不同的是，我们系统支持了设置秘钥时可以<code>限制其使用的空间</code>，<code>限制上传次数</code>，可以<code>指定上传的文件夹</code>,指定<code>文件格式</code>等等，并位置提供了完整的上传文档，支持<code>单文件上传</code>,<code>多文件上传</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90d55a4cd12e45f3bccb57c8a30470dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=WQI3G2nTForI1P94vE%2FWCry264g%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-14">随机图片</h4>
<p>经常会有人需要一个随机图片的API，但是受限于使用别人的不够稳定，也不够灵活，于是我们开放了一个随机API功能，你可以动态的配置，选择其绑定你需要随机的图片，比如指定随机任意文件夹，指定返回方式302重定向，或直接返回图片，你可以点击<a href="https://link.juejin.cn?target=https%3A%2F%2Fv1.pixelpunk.cc%2Fapi%2Fv1%2Fr%2Frnd_C3wEvW5T9EjJ" target="_blank" title="https://v1.pixelpunk.cc/api/v1/r/rnd_C3wEvW5T9EjJ" ref="nofollow noopener noreferrer">pixelpunk随机图片API演示</a> ，每次刷新你可以获取新的图片。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d507d4f2f6947ef80c161b73337a5fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=%2FI687jhTfSy0lKAJpYJMOLzcATQ%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-15">空间带宽控制</h4>
<p>我们允许为用户配置限制的使用空间和流量，后台动态灵活配置这些内容，保证多用户使用的时候限制用户使用量。</p>
<h3 data-id="heading-16">更多功能</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed3904072cee4741a79777739e8ae0af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Pf96zVJF6ve6QljPCceE3AR9VnE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92f44fb955fd48d283b89d061a5651e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=ge1kF0X3PvyAs4tLCnpOoBnTLkM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/813a5acee47f4818a667273b7ee0785e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=m2rGsoQ%2BSLy1j4aeBf7r59K5AwU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7232fbd2fa040d888643bf21fee31dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=mxt90OLx%2BeUlacgijTrk5k8aeRk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/800b0f1909c343e4b00f1b8b18b06fcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=29ECRlu6CGV5sUt9sEG2TbhLWPg%3D" alt="image.png" loading="lazy"/></p>
<p>总之我们的功能远不止如此，我们还有很多有意思的功能，一些更多的细节需要你去探索，比如，公告系统、消息通知、活动日志、限制登录、IP登录记录，超全的管理系统、埋点统计、访客系统等等模块，这是我个人第一个花费较多时间开发的一套系统，目前对比市面上所有的开源图床，自我认为是一款相对功能最全面的图床，耗费了我大量时间。</p>
<p>如果佬友花费时间看到了这里，那么希望能收获你的一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCooperJiang%2FPixelPunk" target="_blank" title="https://github.com/CooperJiang/PixelPunk" ref="nofollow noopener noreferrer">宝贵的Star</a>,后续的功能我依然会持续跌代，如果你有任何需求，可以私信我，如果合理，我可以无偿免费优先加入到后续跌代中去。</p>
<h3 data-id="heading-17">待更新预期功能</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 后端多语言适配</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> UI 美化</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Desktop 端开发</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更多格式支持 (视频|文档)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 交互体验优化</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更多渠道支持</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更多AI接入</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 图片处理工具箱</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[4.Kotlin 流程控制：强大的 when 表达式：取代 Switch]]></title>    <link>https://juejin.cn/post/7574601160981659663</link>    <guid>https://juejin.cn/post/7574601160981659663</guid>    <pubDate>2025-11-20T09:42:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574601160981659663" data-draft-id="7574383670436118580" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="4.Kotlin 流程控制：强大的 when 表达式：取代 Switch"/> <meta itemprop="keywords" content="后端,Android,Kotlin"/> <meta itemprop="datePublished" content="2025-11-20T09:42:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_小雨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            4.Kotlin 流程控制：强大的 when 表达式：取代 Switch
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_小雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:42:11.000Z" title="Thu Nov 20 2025 09:42:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>希望帮你在Kotlin进阶路上少走弯路，在技术上稳步提升。当然，由于个人知识储备有限，笔记中难免存在疏漏或表述不当的地方，也非常欢迎大家提出宝贵意见，一起交流进步。 —— Android_小雨</p>
</blockquote>
<p>整体目录：<a href="https://juejin.cn/spost/7573592952242602036" target="_blank" title="https://juejin.cn/spost/7573592952242602036">Kotlin 进阶不迷路：41 个核心知识点，构建完整知识体系</a></p>
<h2 data-id="heading-0">一、前言</h2>
<h3 data-id="heading-1">1.1 Java Switch 的使用痛点（语法繁琐、穿透风险、类型局限）</h3>
<p>用过Java的开发者对Switch语句肯定不陌生，它是处理多分支条件判断的常用工具，但在实际使用中，诸多痛点常常让人头疼不已。首先是<strong>语法繁琐</strong>，每个分支都需要写<code>case</code>关键字定义匹配条件，还得在分支末尾加<code>break</code>语句防止穿透，哪怕是简单的返回值逻辑，也得写一堆重复的结构。比如一个根据月份获取季节的逻辑，Java Switch写法就得嵌套多层<code>case</code>和<code>break</code>。</p>
<p>其次是<strong>穿透风险</strong>，这是Switch最容易踩的坑——一旦忘记写<code>break</code>，程序就会从匹配到的分支开始，依次执行后续所有分支的代码，导致逻辑错误。而且这种错误在编译时不会报错，只能在运行时发现，排查起来十分麻烦。</p>
<p>最后是<strong>类型局限</strong>，Java 7之前的Switch仅支持byte、short、int、char等基本类型，后续虽支持String和枚举，但仍无法匹配范围、类型判断等复杂场景。比如想判断一个数字是否在某个区间，或者判断一个对象的具体类型，Switch完全无能为力，只能转而使用繁琐的if-else嵌套。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Switch 痛点示例：根据月份获取季节</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getSeason</span><span class="hljs-params">(<span class="hljs-type">int</span> month)</span> {
    String season;
    <span class="hljs-keyword">switch</span> (month) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
            season = <span class="hljs-string">"春季"</span>;
            <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 忘记写就会穿透到夏季</span>
        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:
            season = <span class="hljs-string">"夏季"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">11</span>:
            season = <span class="hljs-string">"秋季"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            season = <span class="hljs-string">"冬季"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            season = <span class="hljs-string">"月份无效"</span>;
    }
    <span class="hljs-keyword">return</span> season;
}

</code></pre>
<h3 data-id="heading-2">1.2 Kotlin when 表达式的核心亮点（简洁、灵活、无穿透）</h3>
<p>Kotlin的when表达式正是为解决Java Switch的痛点而生，它不仅是对Switch的替代，更是一次全面的升级，核心亮点体现在三个方面。第一是<strong>极致简洁</strong>，摒弃了<code>case</code>和<code>break</code>关键字，直接用“匹配条件 -&gt; 执行逻辑”的结构，多值匹配用逗号分隔即可，代码量大幅减少。</p>
<p>第二是<strong>高度灵活</strong>，突破了Switch的类型局限，支持单值、多值、范围、类型、表达式等多种匹配方式，甚至可以无参数使用，实现自定义复杂条件判断。比如判断数字区间、检测对象类型、匹配表达式结果等场景，when表达式都能轻松应对。</p>
<p>第三是<strong>无穿透风险</strong>，when表达式的每个分支都是独立的，默认不会发生穿透，无需像Switch那样手动加<code>break</code>，从语法层面避免了穿透错误。同时，when还是表达式，能直接返回结果赋值给变量或作为函数返回值，进一步简化代码。</p>
<p>同样是“根据月份获取季节”，用Kotlin when表达式改写后，逻辑清晰且简洁：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin when 表达式示例：根据月份获取季节</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getSeason</span><span class="hljs-params">(month: <span class="hljs-type">Int</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (month) {
        <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span> -&gt; <span class="hljs-string">"春季"</span>
        <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span> -&gt; <span class="hljs-string">"夏季"</span>
        <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span> -&gt; <span class="hljs-string">"秋季"</span>
        <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span> -&gt; <span class="hljs-string">"冬季"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"月份无效"</span>
    }
}

</code></pre>
<h3 data-id="heading-3">1.3 本文核心内容预告（基础用法→进阶场景→实用技巧）</h3>
<p>本文将从基础到进阶，全面解析Kotlin when表达式的使用方法。首先从入门级内容讲起，介绍when表达式的定义、基本语法以及与Java Switch的核心区别，帮助新手快速上手；接着深入讲解when表达式的多种灵活匹配场景，包括单值、多值、范围、类型和无参数匹配，覆盖实际开发中的常见需求；然后通过具体案例展示when表达式的实用场景，如替代多分支Switch、变量赋值、函数返回值等；最后总结when表达式的核心知识点、适用场景和避坑技巧，助力大家在开发中灵活运用，写出更简洁高效的Kotlin代码。</p>
<h2 data-id="heading-4">二、when 表达式 基础入门</h2>
<h3 data-id="heading-5">2.1 什么是 when 表达式？（Kotlin 对 Switch 的优化升级）</h3>
<p>when表达式是Kotlin中用于处理多分支条件判断的核心语法结构，是对Java Switch语句的彻底优化和升级。从本质上讲，when是一个<strong>表达式</strong>（而非语句），这意味着它会计算并返回一个结果，这个结果可以直接赋值给变量、作为函数返回值，或者嵌入到其他表达式中。</p>
<p>when表达式的核心思想是“匹配分支并执行对应逻辑”，它会依次判断当前值与各个分支的匹配条件，找到第一个匹配的分支后执行相应逻辑，并返回该分支的结果（若为代码块则返回最后一行表达式的结果），之后不再执行后续分支（无穿透）。相比Switch，when不仅语法更简洁，匹配能力也更强大，是Kotlin流程控制中不可或缺的工具。</p>
<h3 data-id="heading-6">2.2 基本语法格式（简单条件匹配 + 直接赋值示例）</h3>
<h4 data-id="heading-7">2.2.1 基本语法</h4>
<p>when表达式的基本语法有两种形式：一种是带参数的形式（最常用），用于匹配指定参数的值；另一种是无参数形式，用于自定义复杂条件判断（后续进阶部分讲解）。带参数的基本语法如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 带参数的 when 表达式</span>
<span class="hljs-keyword">when</span> (参数) {
    匹配条件<span class="hljs-number">1</span> -&gt; 执行逻辑<span class="hljs-number">1</span> <span class="hljs-comment">// 单值匹配</span>
    匹配条件<span class="hljs-number">2</span>, 匹配条件<span class="hljs-number">3</span> -&gt; 执行逻辑<span class="hljs-number">2</span> <span class="hljs-comment">// 多值匹配</span>
    匹配条件<span class="hljs-number">4.</span>.匹配条件<span class="hljs-number">5</span> -&gt; 执行逻辑<span class="hljs-number">3</span> <span class="hljs-comment">// 范围匹配（后续讲解）</span>
    <span class="hljs-keyword">is</span> 数据类型 -&gt; 执行逻辑<span class="hljs-number">4</span> <span class="hljs-comment">// 类型匹配（后续讲解）</span>
    <span class="hljs-keyword">else</span> -&gt; 默认执行逻辑 <span class="hljs-comment">// 类似 Switch 的 default，匹配所有未覆盖的情况</span>
}

</code></pre>
<p>说明：1. 匹配条件可以是常量、变量、表达式等；2. 执行逻辑若为单条语句，可直接写在箭头后，无需花括号；若为多条语句，需用花括号包裹，此时分支结果为最后一行语句的结果；3. else分支可选，但建议加上，避免遗漏未覆盖的情况（若编译器能确定所有情况都已覆盖，可省略）。</p>
<h4 data-id="heading-8">2.2.2 直接赋值示例</h4>
<p>由于when是表达式，其结果可直接赋值给变量，这是Java Switch无法做到的。比如“根据星期几获取对应的中文名称”：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> day = <span class="hljs-number">3</span> <span class="hljs-comment">// 1-7 对应周一到周日</span>

    <span class="hljs-comment">// when 表达式结果直接赋值给变量</span>
    <span class="hljs-keyword">val</span> dayName = <span class="hljs-keyword">when</span> (day) {
        <span class="hljs-number">1</span> -&gt; <span class="hljs-string">"星期一"</span>
        <span class="hljs-number">2</span> -&gt; <span class="hljs-string">"星期二"</span>
        <span class="hljs-number">3</span> -&gt; <span class="hljs-string">"星期三"</span>
        <span class="hljs-number">4</span> -&gt; <span class="hljs-string">"星期四"</span>
        <span class="hljs-number">5</span> -&gt; <span class="hljs-string">"星期五"</span>
        <span class="hljs-number">6</span> -&gt; <span class="hljs-string">"星期六"</span>
        <span class="hljs-number">7</span> -&gt; <span class="hljs-string">"星期日"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"无效日期"</span>
    }

    println(<span class="hljs-string">"今天是：<span class="hljs-variable">$dayName</span>"</span>) <span class="hljs-comment">// 输出：今天是：星期三</span>
}

</code></pre>
<p>再比如执行逻辑为多条语句的场景，此时用花括号包裹，返回最后一行结果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getScoreDesc</span><span class="hljs-params">(score: <span class="hljs-type">Int</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (score) {
        <span class="hljs-keyword">in</span> <span class="hljs-number">90.</span><span class="hljs-number">.100</span> -&gt; {
            println(<span class="hljs-string">"成绩优异"</span>)
            <span class="hljs-string">"优秀"</span> <span class="hljs-comment">// 分支结果，作为整个 when 表达式的结果</span>
        }
        <span class="hljs-keyword">in</span> <span class="hljs-number">80.</span><span class="hljs-number">.89</span> -&gt; {
            println(<span class="hljs-string">"成绩良好"</span>)
            <span class="hljs-string">"良好"</span>
        }
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"其他"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(getScoreDesc(<span class="hljs-number">95</span>)) <span class="hljs-comment">// 输出：成绩优异  优秀</span>
}

</code></pre>
<h3 data-id="heading-9">2.3 与 Switch 的核心区别（无需 break、支持表达式返回值）</h3>
<p>when表达式与Java Switch相比，有多个核心区别，正是这些区别让when更简洁、更灵活、更安全：</p>
<h4 data-id="heading-10">2.3.1 无需 break，无穿透风险</h4>
<p>Java Switch的分支默认会穿透，必须在每个分支末尾加<code>break</code>才能终止执行，而when表达式的分支默认不穿透，找到第一个匹配的分支执行后就会终止，无需手动加<code>break</code>，从语法层面避免了穿透错误。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Switch 穿透风险示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    <span class="hljs-keyword">switch</span> (num) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            System.out.println(<span class="hljs-string">"一"</span>);
            <span class="hljs-comment">// 忘记加 break，会穿透到 case 2</span>
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            System.out.println(<span class="hljs-string">"二"</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
            System.out.println(<span class="hljs-string">"三"</span>);
    }
    <span class="hljs-comment">// 输出：二  三（发生穿透）</span>
}

</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin when 无穿透示例</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> num = <span class="hljs-number">2</span>
    <span class="hljs-keyword">when</span> (num) {
        <span class="hljs-number">1</span> -&gt; println(<span class="hljs-string">"一"</span>)
        <span class="hljs-number">2</span> -&gt; println(<span class="hljs-string">"二"</span>)
        <span class="hljs-number">3</span> -&gt; println(<span class="hljs-string">"三"</span>)
    }
    <span class="hljs-comment">// 输出：二（无穿透）</span>
}

</code></pre>
<h4 data-id="heading-11">2.3.2 支持表达式返回值，可直接赋值</h4>
<p>Java Switch是语句，不返回值，无法直接赋值给变量，若要实现类似逻辑，需先定义变量再在分支中赋值；而when是表达式，会返回匹配分支的结果，可直接赋值给变量或作为函数返回值，代码更简洁。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Switch 赋值需先定义变量</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getLevel</span><span class="hljs-params">(<span class="hljs-type">int</span> score)</span> {
    String level;
    <span class="hljs-keyword">switch</span> (score / <span class="hljs-number">10</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>, <span class="hljs-number">9</span> -&gt; level = <span class="hljs-string">"A"</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span> -&gt; level = <span class="hljs-string">"B"</span>;
        <span class="hljs-keyword">default</span> -&gt; level = <span class="hljs-string">"C"</span>;
    }
    <span class="hljs-keyword">return</span> level;
}

</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin when 直接赋值</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getLevel</span><span class="hljs-params">(score: <span class="hljs-type">Int</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (score / <span class="hljs-number">10</span>) {
        <span class="hljs-number">10</span>, <span class="hljs-number">9</span> -&gt; <span class="hljs-string">"A"</span>
        <span class="hljs-number">8</span> -&gt; <span class="hljs-string">"B"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"C"</span>
    }
    <span class="hljs-comment">// 更简洁的单表达式函数写法</span>
    <span class="hljs-comment">// fun getLevel(score: Int) = when (score / 10) { 10,9 -&gt; "A"; 8-&gt;"B"; else-&gt;"C" }</span>
}

</code></pre>
<h4 data-id="heading-12">2.3.3 匹配能力更强大，支持多种匹配方式</h4>
<p>Java Switch仅支持单值匹配（除了枚举和String），而when表达式支持单值、多值、范围、类型、表达式等多种匹配方式，能应对更复杂的场景（后续章节详细讲解）。</p>
<h4 data-id="heading-13">2.3.4 语法更简洁，无需 case 关键字</h4>
<p>Java Switch需要用<code>case</code>定义每个分支的匹配条件，而when直接用“匹配条件 -&gt; 执行逻辑”的结构，省去了大量冗余的<code>case</code>关键字，代码更简洁直观。</p>
<h2 data-id="heading-14">三、when 表达式 灵活匹配场景</h2>
<p>when表达式的最大优势在于其灵活的匹配能力，除了类似Switch的单值匹配，还支持多种复杂的匹配场景，覆盖实际开发中的绝大多数需求。</p>
<h3 data-id="heading-15">3.1 单值匹配（直接匹配具体数值 / 字符串）</h3>
<p>单值匹配是when最基础的用法，与Java Switch的单值匹配类似，用于匹配指定的常量值（如数值、字符串、枚举等）。匹配条件可以是字面量、常量变量或返回常量的表达式。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 字符串单值匹配</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFruitColor</span><span class="hljs-params">(fruit: <span class="hljs-type">String</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (fruit) {
        <span class="hljs-string">"苹果"</span> -&gt; <span class="hljs-string">"红色"</span>
        <span class="hljs-string">"香蕉"</span> -&gt; <span class="hljs-string">"黄色"</span>
        <span class="hljs-string">"葡萄"</span> -&gt; <span class="hljs-string">"紫色"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"未知颜色"</span>
    }
}

<span class="hljs-comment">// 枚举单值匹配</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Direction</span> { UP, DOWN, LEFT, RIGHT }
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDirectionDesc</span><span class="hljs-params">(direction: <span class="hljs-type">Direction</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (direction) {
        Direction.UP -&gt; <span class="hljs-string">"向上"</span>
        Direction.DOWN -&gt; <span class="hljs-string">"向下"</span>
        Direction.LEFT -&gt; <span class="hljs-string">"向左"</span>
        Direction.RIGHT -&gt; <span class="hljs-string">"向右"</span>
    }
    <span class="hljs-comment">// 枚举匹配可省略枚举类名（需导入或在同一作用域）</span>
    <span class="hljs-comment">// return when (direction) { UP -&gt; "向上"; DOWN -&gt; "向下"; ... }</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(getFruitColor(<span class="hljs-string">"苹果"</span>)) <span class="hljs-comment">// 输出：红色</span>
    println(getDirectionDesc(Direction.LEFT)) <span class="hljs-comment">// 输出：向左</span>
}

</code></pre>
<h3 data-id="heading-16">3.2 多值匹配（用逗号分隔多个匹配条件）</h3>
<p>当多个匹配条件对应相同的执行逻辑时，可在一个分支中用逗号分隔多个匹配条件，实现“多值对应同一结果”的逻辑，无需像Java Switch那样写多个重复的<code>case</code>分支。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 多值匹配：判断是否为工作日</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isWorkDay</span><span class="hljs-params">(day: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-comment">// 1-5 对应周一到周五，都返回 true</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (day) {
        <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span> -&gt; <span class="hljs-literal">true</span>
        <span class="hljs-number">6</span>, <span class="hljs-number">7</span> -&gt; <span class="hljs-literal">false</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"无效的星期数"</span>)
    }
}

<span class="hljs-comment">// 多值匹配：根据考试等级获取奖励</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getReward</span><span class="hljs-params">(level: <span class="hljs-type">String</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (level) {
        <span class="hljs-string">"A"</span>, <span class="hljs-string">"A+"</span> -&gt; <span class="hljs-string">"500元奖学金"</span>
        <span class="hljs-string">"B"</span>, <span class="hljs-string">"B+"</span> -&gt; <span class="hljs-string">"200元奖学金"</span>
        <span class="hljs-string">"C"</span> -&gt; <span class="hljs-string">"学习用品"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"鼓励信"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(isWorkDay(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：true</span>
    println(getReward(<span class="hljs-string">"A+"</span>)) <span class="hljs-comment">// 输出：500元奖学金</span>
}

</code></pre>
<h3 data-id="heading-17">3.3 范围匹配（in 关键字匹配区间）</h3>
<p>when表达式支持通过<code>in</code>关键字匹配“值是否在指定范围内”，范围可以是数值范围、字符范围等，这是Java Switch完全不具备的能力，能极大简化区间判断的逻辑。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 数值范围匹配：根据分数评级</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getScoreLevel</span><span class="hljs-params">(score: <span class="hljs-type">Int</span>)</span></span>: String {
    require(score <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span><span class="hljs-number">.100</span>) { <span class="hljs-string">"分数必须在 0-100 之间"</span> }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (score) {
        <span class="hljs-keyword">in</span> <span class="hljs-number">90.</span><span class="hljs-number">.100</span> -&gt; <span class="hljs-string">"优秀"</span>
        <span class="hljs-keyword">in</span> <span class="hljs-number">80.</span><span class="hljs-number">.89</span> -&gt; <span class="hljs-string">"良好"</span>
        <span class="hljs-keyword">in</span> <span class="hljs-number">60.</span><span class="hljs-number">.79</span> -&gt; <span class="hljs-string">"及格"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"不及格"</span> <span class="hljs-comment">// 0-59 范围</span>
    }
}

<span class="hljs-comment">// 字符范围匹配：判断字符类型</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCharType</span><span class="hljs-params">(c: <span class="hljs-type">Char</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (c) {
        <span class="hljs-keyword">in</span> <span class="hljs-string">'a'</span>..<span class="hljs-string">'z'</span>, <span class="hljs-keyword">in</span> <span class="hljs-string">'A'</span>..<span class="hljs-string">'Z'</span> -&gt; <span class="hljs-string">"字母"</span>
        <span class="hljs-keyword">in</span> <span class="hljs-string">'0'</span>..<span class="hljs-string">'9'</span> -&gt; <span class="hljs-string">"数字"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"特殊字符"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(getScoreLevel(<span class="hljs-number">85</span>)) <span class="hljs-comment">// 输出：良好</span>
    println(getCharType(<span class="hljs-string">'5'</span>)) <span class="hljs-comment">// 输出：数字</span>
    println(getCharType(<span class="hljs-string">'@'</span>)) <span class="hljs-comment">// 输出：特殊字符</span>
}

</code></pre>
<p>除了匹配“在范围内”，还可以用<code>!in</code>匹配“不在范围内”的情况：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// !in 匹配不在范围内的值</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkAge</span><span class="hljs-params">(age: <span class="hljs-type">Int</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (age) {
        !<span class="hljs-keyword">in</span> <span class="hljs-number">0.</span><span class="hljs-number">.120</span> -&gt; <span class="hljs-string">"年龄无效"</span>
        <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span><span class="hljs-number">.17</span> -&gt; <span class="hljs-string">"未成年"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"成年"</span>
    }
}

</code></pre>
<h3 data-id="heading-18">3.4 类型匹配（is 关键字判断数据类型）</h3>
<p>when表达式支持通过<code>is</code>关键字判断变量的具体数据类型，实现“类型匹配”逻辑，且匹配成功后会自动进行类型转换（智能类型转换），无需手动强转，这在处理多类型对象时非常实用。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 类型匹配：处理不同类型的数据</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Any</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (<span class="hljs-keyword">data</span>) {
        <span class="hljs-keyword">is</span> <span class="hljs-built_in">Int</span> -&gt; <span class="hljs-string">"整数类型，值为：<span class="hljs-variable">$data</span>"</span> <span class="hljs-comment">// 自动转换为 Int 类型</span>
        <span class="hljs-keyword">is</span> String -&gt; <span class="hljs-string">"字符串类型，长度为：<span class="hljs-subst">${data.length}</span>"</span> <span class="hljs-comment">// 自动转换为 String 类型</span>
        <span class="hljs-keyword">is</span> <span class="hljs-built_in">Double</span> -&gt; <span class="hljs-string">"浮点数类型，值为：<span class="hljs-variable">$data</span>"</span> <span class="hljs-comment">// 自动转换为 Double 类型</span>
        <span class="hljs-keyword">is</span> List&lt;*&gt; -&gt; <span class="hljs-string">"列表类型，元素个数为：<span class="hljs-subst">${data.size}</span>"</span> <span class="hljs-comment">// 自动转换为 List 类型</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"未知类型"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(handleData(<span class="hljs-number">100</span>)) <span class="hljs-comment">// 输出：整数类型，值为：100</span>
    println(handleData(<span class="hljs-string">"Kotlin"</span>)) <span class="hljs-comment">// 输出：字符串类型，长度为：6</span>
    println(handleData(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))) <span class="hljs-comment">// 输出：列表类型，元素个数为：3</span>
}

</code></pre>
<p>智能类型转换的优势在于，匹配成功后可直接调用该类型的方法和属性（如上述示例中的<code>data.length</code>、<code>data.size</code>），无需手动强转，既简洁又安全。</p>
<h3 data-id="heading-19">3.5 无参数匹配（自定义复杂条件判断）</h3>
<p>when表达式还支持无参数的形式，此时每个分支的匹配条件是一个布尔表达式，当表达式结果为true时，执行对应的逻辑。这种方式适用于需要自定义复杂条件判断的场景，相当于多个独立的if-else分支，但语法更简洁。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 无参数 when：自定义复杂条件判断（判断学生是否符合奖学金条件）</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEligibleForScholarship</span><span class="hljs-params">(score: <span class="hljs-type">Int</span>, attendance: <span class="hljs-type">Double</span>, isExcellent: <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
        <span class="hljs-comment">// 条件1：成绩优秀且出勤率≥95%</span>
        score &gt;= <span class="hljs-number">90</span> &amp;&amp; attendance &gt;= <span class="hljs-number">0.95</span> -&gt; <span class="hljs-literal">true</span>
        <span class="hljs-comment">// 条件2：成绩良好且是优秀学生</span>
        score &gt;= <span class="hljs-number">80</span> &amp;&amp; isExcellent -&gt; <span class="hljs-literal">true</span>
        <span class="hljs-comment">// 条件3：其他情况不满足</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
    }
}

<span class="hljs-comment">// 无参数 when：替代多层 if-else</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getLoginStatus</span><span class="hljs-params">(username: <span class="hljs-type">String</span>?, password: <span class="hljs-type">String</span>?)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
        username.isNullOrEmpty() -&gt; <span class="hljs-string">"用户名不能为空"</span>
        password.isNullOrEmpty() -&gt; <span class="hljs-string">"密码不能为空"</span>
        username == <span class="hljs-string">"admin"</span> &amp;&amp; password == <span class="hljs-string">"123456"</span> -&gt; <span class="hljs-string">"登录成功"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"用户名或密码错误"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(isEligibleForScholarship(<span class="hljs-number">92</span>, <span class="hljs-number">0.96</span>, <span class="hljs-literal">false</span>)) <span class="hljs-comment">// 输出：true</span>
    println(getLoginStatus(<span class="hljs-string">"admin"</span>, <span class="hljs-string">""</span>)) <span class="hljs-comment">// 输出：密码不能为空</span>
}

</code></pre>
<p>无参数when的本质是“多个布尔条件的依次判断”，找到第一个结果为true的条件分支执行，适用于各分支条件无共同参数的场景，比多层if-else更简洁易读。</p>
<h2 data-id="heading-20">四、when 表达式 实用场景举例</h2>
<p>在实际开发中，when表达式的应用场景非常广泛，无论是简单的多分支判断，还是复杂的条件匹配，都能发挥其优势。下面介绍几个最常见的实用场景。</p>
<h3 data-id="heading-21">4.1 替代多分支 Switch 逻辑</h3>
<p>这是when表达式最基础的应用场景，用于替代Java中繁琐的多分支Switch逻辑，尤其适合匹配枚举、字符串、数值等场景，代码更简洁且无穿透风险。</p>
<p>示例：根据支付方式处理支付逻辑（替代Java Switch）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Switch 处理支付逻辑</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">PaymentMethod</span> { ALIPAY, WECHAT, CARD }
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">processPayment</span><span class="hljs-params">(PaymentMethod method, <span class="hljs-type">double</span> amount)</span> {
    <span class="hljs-keyword">switch</span> (method) {
        <span class="hljs-keyword">case</span> ALIPAY:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"支付宝支付 "</span> + amount + <span class="hljs-string">" 元，已完成"</span>;
        <span class="hljs-keyword">case</span> WECHAT:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"微信支付 "</span> + amount + <span class="hljs-string">" 元，已完成"</span>;
        <span class="hljs-keyword">case</span> CARD:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"银行卡支付 "</span> + amount + <span class="hljs-string">" 元，已完成"</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"不支持的支付方式"</span>);
    }
}

</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin when 替代 Switch 处理支付逻辑</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentMethod</span> { ALIPAY, WECHAT, CARD }
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processPayment</span><span class="hljs-params">(method: <span class="hljs-type">PaymentMethod</span>, amount: <span class="hljs-type">Double</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (method) {
        PaymentMethod.ALIPAY -&gt; <span class="hljs-string">"支付宝支付 <span class="hljs-variable">$amount</span> 元，已完成"</span>
        PaymentMethod.WECHAT -&gt; <span class="hljs-string">"微信支付 <span class="hljs-variable">$amount</span> 元，已完成"</span>
        PaymentMethod.CARD -&gt; <span class="hljs-string">"银行卡支付 <span class="hljs-variable">$amount</span> 元，已完成"</span>
    }
    <span class="hljs-comment">// 省略枚举类名的写法（需导入或同一作用域）</span>
    <span class="hljs-comment">// return when (method) { ALIPAY -&gt; "..."; WECHAT -&gt; "..."; CARD -&gt; "..." }</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(processPayment(PaymentMethod.ALIPAY, <span class="hljs-number">100.0</span>))
    <span class="hljs-comment">// 输出：支付宝支付 100.0 元，已完成</span>
}

</code></pre>
<h3 data-id="heading-22">4.2 变量赋值（直接通过匹配结果赋值）</h3>
<p>由于when是表达式，其结果可直接赋值给变量，这是非常常用的场景，能替代“定义变量+多分支赋值”的繁琐写法，让变量赋值逻辑更集中、更清晰。</p>
<p>示例：根据用户等级赋值对应的权限列表</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 用户等级枚举</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLevel</span> { ADMIN, MANAGER, USER, GUEST }

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getPermissions</span><span class="hljs-params">(level: <span class="hljs-type">UserLevel</span>)</span></span>: List&lt;String&gt; {
    <span class="hljs-comment">// when 表达式结果直接赋值给变量</span>
    <span class="hljs-keyword">val</span> permissions = <span class="hljs-keyword">when</span> (level) {
        UserLevel.ADMIN -&gt; listOf(<span class="hljs-string">"增"</span>, <span class="hljs-string">"删"</span>, <span class="hljs-string">"改"</span>, <span class="hljs-string">"查"</span>, <span class="hljs-string">"管理"</span>)
        UserLevel.MANAGER -&gt; listOf(<span class="hljs-string">"增"</span>, <span class="hljs-string">"删"</span>, <span class="hljs-string">"改"</span>, <span class="hljs-string">"查"</span>)
        UserLevel.USER -&gt; listOf(<span class="hljs-string">"查"</span>, <span class="hljs-string">"改"</span>)
        UserLevel.GUEST -&gt; listOf(<span class="hljs-string">"查"</span>)
    }
    <span class="hljs-keyword">return</span> permissions
}

<span class="hljs-comment">// 更简洁的单表达式函数写法</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getPermissionsSimpler</span><span class="hljs-params">(level: <span class="hljs-type">UserLevel</span>)</span></span> = <span class="hljs-keyword">when</span> (level) {
    UserLevel.ADMIN -&gt; listOf(<span class="hljs-string">"增"</span>, <span class="hljs-string">"删"</span>, <span class="hljs-string">"改"</span>, <span class="hljs-string">"查"</span>, <span class="hljs-string">"管理"</span>)
    UserLevel.MANAGER -&gt; listOf(<span class="hljs-string">"增"</span>, <span class="hljs-string">"删"</span>, <span class="hljs-string">"改"</span>, <span class="hljs-string">"查"</span>)
    UserLevel.USER -&gt; listOf(<span class="hljs-string">"查"</span>, <span class="hljs-string">"改"</span>)
    UserLevel.GUEST -&gt; listOf(<span class="hljs-string">"查"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(getPermissions(UserLevel.MANAGER))
    <span class="hljs-comment">// 输出：[增, 删, 改, 查]</span>
}

</code></pre>
<h3 data-id="heading-23">4.3 函数返回值（作为函数主体直接返回结果）</h3>
<p>when表达式可直接作为函数的返回值，此时函数可简化为单表达式函数（省略花括号和return关键字），让函数定义更简洁，尤其适合逻辑简单的工具函数。</p>
<p>示例：1. 计算图形面积（根据图形类型和参数计算）；2. 转换日期格式（将数字星期转换为中文）</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 图形类型枚举</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> { CIRCLE, RECTANGLE, SQUARE }

<span class="hljs-comment">// when 作为函数返回值（计算图形面积）</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateArea</span><span class="hljs-params">(shape: <span class="hljs-type">Shape</span>, <span class="hljs-keyword">vararg</span> params: <span class="hljs-type">Double</span>)</span></span>: <span class="hljs-built_in">Double</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (shape) {
        Shape.CIRCLE -&gt; {
            <span class="hljs-keyword">val</span> radius = params[<span class="hljs-number">0</span>]
            Math.PI * radius * radius <span class="hljs-comment">// 圆的面积公式</span>
        }
        Shape.RECTANGLE -&gt; {
            <span class="hljs-keyword">val</span> width = params[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">val</span> height = params[<span class="hljs-number">1</span>]
            width * height <span class="hljs-comment">// 矩形面积公式</span>
        }
        Shape.SQUARE -&gt; {
            <span class="hljs-keyword">val</span> side = params[<span class="hljs-number">0</span>]
            side * side <span class="hljs-comment">// 正方形面积公式</span>
        }
    }
}

<span class="hljs-comment">// 单表达式函数：when 直接作为返回值</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">convertWeekToChinese</span><span class="hljs-params">(week: <span class="hljs-type">Int</span>)</span></span> = <span class="hljs-keyword">when</span> (week) {
    <span class="hljs-number">1</span> -&gt; <span class="hljs-string">"星期一"</span>
    <span class="hljs-number">2</span> -&gt; <span class="hljs-string">"星期二"</span>
    <span class="hljs-number">3</span> -&gt; <span class="hljs-string">"星期三"</span>
    <span class="hljs-number">4</span> -&gt; <span class="hljs-string">"星期四"</span>
    <span class="hljs-number">5</span> -&gt; <span class="hljs-string">"星期五"</span>
    <span class="hljs-number">6</span> -&gt; <span class="hljs-string">"星期六"</span>
    <span class="hljs-number">7</span> -&gt; <span class="hljs-string">"星期日"</span>
    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"无效星期"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(calculateArea(Shape.CIRCLE, <span class="hljs-number">5.0</span>)) <span class="hljs-comment">// 输出：78.5398...</span>
    println(calculateArea(Shape.RECTANGLE, <span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>)) <span class="hljs-comment">// 输出：12.0</span>
    println(convertWeekToChinese(<span class="hljs-number">5</span>)) <span class="hljs-comment">// 输出：星期五</span>
}

</code></pre>
<h3 data-id="heading-24">4.4 简化复杂条件判断（替代多层 if-else）</h3>
<p>当存在多层if-else嵌套的复杂条件判断时，用无参数when表达式可将其转换为线性分支，消除嵌套缩进，提升代码可读性。这是when表达式比if-else更有优势的场景之一。</p>
<p>示例：用户注册信息校验（多层if-else嵌套 vs 无参数when）</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 多层 if-else 嵌套：校验注册信息</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkRegisterInfoOld</span><span class="hljs-params">(username: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>, phone: <span class="hljs-type">String</span>)</span></span>: String {
    <span class="hljs-keyword">if</span> (username.isEmpty()) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"用户名不能为空"</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (username.length &lt; <span class="hljs-number">3</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"用户名长度不能小于3位"</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (password.isEmpty()) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"密码不能为空"</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (password.length &lt; <span class="hljs-number">6</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"密码长度不能小于6位"</span>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (!phone.matches(<span class="hljs-string">"^1[3-9]\\d{9}$"</span>.toRegex())) {
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"手机号格式错误"</span>
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"注册信息校验通过"</span>
                    }
                }
            }
        }
    }
}

<span class="hljs-comment">// 无参数 when 简化：校验注册信息（无嵌套）</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkRegisterInfoNew</span><span class="hljs-params">(username: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>, phone: <span class="hljs-type">String</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
        username.isEmpty() -&gt; <span class="hljs-string">"用户名不能为空"</span>
        username.length &lt; <span class="hljs-number">3</span> -&gt; <span class="hljs-string">"用户名长度不能小于3位"</span>
        password.isEmpty() -&gt; <span class="hljs-string">"密码不能为空"</span>
        password.length &lt; <span class="hljs-number">6</span> -&gt; <span class="hljs-string">"密码长度不能小于6位"</span>
        !phone.matches(<span class="hljs-string">"^1[3-9]\\d{9}$"</span>.toRegex()) -&gt; <span class="hljs-string">"手机号格式错误"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"注册信息校验通过"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(checkRegisterInfoNew(<span class="hljs-string">"kotlin"</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-string">"13800138000"</span>))
    <span class="hljs-comment">// 输出：注册信息校验通过</span>
    println(checkRegisterInfoNew(<span class="hljs-string">"ko"</span>, <span class="hljs-string">"12345"</span>, <span class="hljs-string">"123456"</span>))
    <span class="hljs-comment">// 输出：用户名长度不能小于3位</span>
}

</code></pre>
<p>可以看到，无参数when将5层嵌套的if-else简化为线性分支，逻辑一目了然，后续维护和修改也更方便。</p>
<h2 data-id="heading-25">五、总结与使用建议</h2>
<h3 data-id="heading-26">5.1 核心知识点回顾（when 表达式的灵活性与优势）</h3>
<ul>
<li><strong>本质特性</strong>：when是表达式而非语句，会返回匹配分支的结果，可直接赋值给变量或作为函数返回值；默认无穿透，无需手动加break。</li>
<li><strong>核心优势</strong>：相比Java Switch，语法更简洁（无case、break）、匹配能力更强（支持单值、多值、范围、类型、无参数匹配）、更安全（无穿透风险）；相比if-else，更适合多分支场景，可消除嵌套缩进。</li>
<li><strong>关键能力</strong>：支持智能类型转换（is匹配后自动转类型）、范围匹配（in关键字）、多值匹配（逗号分隔）、无参数自定义条件匹配，覆盖多种复杂场景。</li>
</ul>
<h3 data-id="heading-27">5.2 适用场景与避坑点（何时优先用 when、避免过度复杂匹配）</h3>
<h4 data-id="heading-28">5.2.1 适用场景</h4>
<ol>
<li><strong>多分支条件判断场景</strong>：当存在3个及以上条件分支时，优先使用when，比if-else更简洁；替代Java的Switch语句（所有Switch场景都可用when替代）。</li>
<li><strong>特定匹配场景</strong>：需要进行范围匹配（如数值区间）、类型匹配（如判断对象类型）、多值匹配（多个值对应同一逻辑）的场景，when是最优选择。</li>
<li><strong>变量赋值或函数返回值场景</strong>：需要根据条件动态赋值变量，或函数逻辑为多分支判断并返回结果的场景，可利用when表达式的返回值特性简化代码。</li>
<li><strong>复杂条件嵌套场景</strong>：存在多层if-else嵌套时，用无参数when可将嵌套拉平，提升可读性。</li>
</ol>
<h4 data-id="heading-29">5.2.2 避坑点</h4>
<ul>
<li><strong>避免遗漏else分支</strong>：除了编译器能确定所有情况都已覆盖的场景（如枚举匹配），建议加上else分支处理未覆盖的情况，避免运行时异常。</li>
<li><strong>不要过度复杂单个分支</strong>：若某个分支的执行逻辑过于复杂（如包含大量循环、条件判断），应将其抽离为单独的函数，避免when表达式臃肿不堪，影响可读性。</li>
<li><strong>区分带参数与无参数场景</strong>：当各分支有共同的匹配参数时，用带参数when；当各分支条件无共同参数（为独立布尔表达式）时，用无参数when，不要混用。</li>
<li><strong>注意智能类型转换的范围</strong>：is匹配的智能类型转换仅在当前分支内有效，若需在分支外使用转换后的类型，需手动定义变量。</li>
</ul>
<h3 data-id="heading-30">5.3 代码简洁性提升技巧（简化匹配逻辑、提高可读性）</h3>
<ul>
<li><strong>利用单表达式函数简化</strong>：当函数逻辑仅为when表达式时，用单表达式函数写法（省略花括号和return），代码更简洁。例如：<code>fun getLevel(score: Int) = when (score) { ... }</code>。</li>
<li><strong>合并重复逻辑的分支</strong>：多个匹配条件对应相同逻辑时，用逗号分隔合并为一个分支，避免代码重复。例如：<code>1,2,3 -&gt; "春季"</code>。</li>
<li><strong>优先处理简单或高频分支</strong>：将简单的分支或高频匹配的分支放在前面，复杂分支放在后面，提升代码执行效率和可读性。</li>
<li><strong>用常量或枚举优化匹配条件</strong>：避免在匹配条件中写字面量（如魔法数字、魔法字符串），改用常量或枚举，提升代码可维护性。例如：用<code>UserLevel.ADMIN</code>替代<code>"admin"</code>。</li>
<li><strong>无参数when的条件排序</strong>：无参数when的分支按“异常场景→普通场景→默认场景”排序，符合日常逻辑习惯，便于理解。</li>
</ul>
<p>when表达式是Kotlin中最具代表性的语法特性之一，它的灵活性和简洁性能极大提升开发效率和代码质量。掌握when的各种匹配方式，并在合适的场景灵活运用，能让你的Kotlin代码更优雅、更易读、更易维护。建议在开发中主动用when替代Switch和复杂的if-else，逐步养成简洁的编码习惯。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5.Kotlin 流程控制：循环的艺术：for 循环与区间 (Range)]]></title>    <link>https://juejin.cn/post/7574626451748945920</link>    <guid>https://juejin.cn/post/7574626451748945920</guid>    <pubDate>2025-11-20T09:43:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574626451748945920" data-draft-id="7574614157955334178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5.Kotlin 流程控制：循环的艺术：for 循环与区间 (Range)"/> <meta itemprop="keywords" content="后端,Android,Kotlin"/> <meta itemprop="datePublished" content="2025-11-20T09:43:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_小雨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5.Kotlin 流程控制：循环的艺术：for 循环与区间 (Range)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_小雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:43:54.000Z" title="Thu Nov 20 2025 09:43:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>希望帮你在Kotlin进阶路上少走弯路，在技术上稳步提升。当然，由于个人知识储备有限，笔记中难免存在疏漏或表述不当的地方，也非常欢迎大家提出宝贵意见，一起交流进步。 —— Android_小雨</p>
</blockquote>
<p>整体目录：<a href="https://juejin.cn/spost/7573592952242602036" target="_blank" title="https://juejin.cn/spost/7573592952242602036">Kotlin 进阶不迷路：41 个核心知识点，构建完整知识体系</a></p>
<h2 data-id="heading-0">一、前言</h2>
<h3 data-id="heading-1">1.1 循环在开发中的核心作用（遍历数据、重复执行逻辑）</h3>
<p>循环是编程中最基础也最核心的流程控制结构之一，几乎所有开发场景都离不开它。其核心作用主要体现在两个方面：一是<strong>遍历数据</strong>，无论是数组、列表、集合还是字符串，我们都需要通过循环逐个访问其中的元素，实现数据的读取、筛选、转换等操作，比如遍历用户列表获取所有用户名、遍历订单数据统计总金额；二是<strong>重复执行逻辑</strong>，当一段代码需要多次执行时，循环能避免冗余的重复编写，只需定义一次逻辑即可指定执行次数或执行条件，比如批量创建10个测试用户、每隔1秒打印一次系统状态等。</p>
<p>以Java中遍历1到10的循环为例，传统写法需要定义循环变量、初始值、终止条件和步长，代码略显繁琐。而Kotlin通过“for循环+区间”的组合，将循环逻辑优化得极为简洁直观，让开发者能更专注于业务逻辑而非循环结构本身。</p>
<h3 data-id="heading-2">1.2 Kotlin for 循环 + 区间的优势（简洁、直观、功能强大）</h3>
<p>Kotlin并没有沿用Java中for循环的“三段式”语法（for(int i=0; i&lt;10; i++)），而是对for循环进行了重构，使其成为一种“迭代器遍历”的语法糖，尤其与Kotlin特有的“区间（Range）”结合后，展现出三大核心优势：</p>
<ul>
<li><strong>极致简洁</strong>：无需手动定义循环变量、终止条件和步长，通过区间表达式即可快速描述循环范围，一行代码就能实现常见的遍历需求，比如遍历1到10只需“for (i in 1..10)”。</li>
<li><strong>直观易懂</strong>：区间表达式的语法贴近自然语言，“1..5”表示“从1到5的闭区间”，“1 until 5”表示“从1到5但不包含5”，“10 downTo 1”表示“从10倒序到1”，即使是新手也能一眼看懂循环范围。</li>
<li><strong>功能强大</strong>：支持正序、倒序、指定步长遍历，还能直接与数组、列表等集合配合，同时兼容字符区间等特殊场景，覆盖绝大多数循环需求。</li>
</ul>
<p>同样是遍历1到10并打印，对比Java和Kotlin的写法就能直观感受到其优势：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java 传统 for 循环</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++) {
    System.out.println(i);
}

</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin for 循环 + 区间</span>
<span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) {
    println(i)
}

</code></pre>
<h3 data-id="heading-3">1.3 本文核心内容预告（区间基础→for 循环用法→实用场景）</h3>
<p>本文将围绕“for循环与区间”展开，采用“基础先行、用法递进、场景落地”的思路逐步讲解。首先从Kotlin区间的基础概念入手，介绍区间的定义、三种核心类型（闭区间、半开区间、倒序区间）以及步长的使用方法；接着重点讲解for循环与区间的配合用法，覆盖正序、不包含终点、倒序、指定步长等常见遍历场景，同时拓展到for循环遍历数组、列表等其他集合的用法；然后通过多个实用场景案例，展示“for循环+区间”在实际开发中的应用；最后总结核心知识点、适用场景和避坑技巧，帮助读者真正掌握这一简洁高效的循环方式。</p>
<h2 data-id="heading-4">二、先搞懂：Kotlin 区间 (Range) 基础</h2>
<h3 data-id="heading-5">2.1 什么是区间？（连续值的集合，如数字 / 字符区间）</h3>
<p>在Kotlin中，<strong>区间（Range）是一种表示“连续值集合”的数据结构</strong>，它本质上是实现了ClosedRange接口的类，用于描述从一个起始值到一个结束值的连续范围。区间中的元素必须是可比较的（实现Comparable接口），常见的区间类型包括数字区间（如IntRange、LongRange）和字符区间（CharRange），比如“1到5的数字区间”包含1、2、3、4、5五个值，“A到E的字符区间”包含A、B、C、D、E五个字符。</p>
<p>区间的核心价值在于“简化范围的描述”，它将“起始值、结束值、增减方向”等信息封装为简洁的表达式，配合for循环使用时能极大简化遍历逻辑。需要注意的是，Kotlin的区间默认是“连续且有序”的，不支持非连续的离散值范围（如1、3、5这样的奇数集合，需通过其他方式实现）。</p>
<h3 data-id="heading-6">2.2 区间的基本语法（闭区间..、半开区间 until、倒序区间 downTo）</h3>
<p>Kotlin提供了三种核心的区间定义语法，分别对应不同的遍历需求，掌握这三种语法是使用区间的基础：</p>
<h4 data-id="heading-7">2.2.1 闭区间：.. （包含起始值和结束值）</h4>
<p>用“起始值..结束值”的语法定义闭区间，表示包含起始值和结束值在内的所有连续值。这是最常用的区间类型，适用于需要遍历“从a到b（含a和b）”的场景。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 数字闭区间：1到5，包含1、2、3、4、5</span>
<span class="hljs-keyword">val</span> intRange = <span class="hljs-number">1.</span><span class="hljs-number">.5</span>
<span class="hljs-comment">// 字符闭区间：'A'到'E'，包含'A'、'B'、'C'、'D'、'E'</span>
<span class="hljs-keyword">val</span> charRange = <span class="hljs-string">'A'</span>..<span class="hljs-string">'E'</span>
<span class="hljs-comment">// 长整型闭区间：100L到105L</span>
<span class="hljs-keyword">val</span> longRange = <span class="hljs-number">100L</span>..<span class="hljs-number">105L</span>

</code></pre>
<h4 data-id="heading-8">2.2.2 半开区间：until （包含起始值，不包含结束值）</h4>
<p>用“起始值 until 结束值”的语法定义半开区间，表示包含起始值但不包含结束值的连续值。这种区间类型与Java中“i &lt; 结束值”的逻辑一致，适用于避免“结束值-1”的繁琐计算场景，比如遍历数组（数组索引从0开始，到长度-1结束）。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 数字半开区间：1 until 5，包含1、2、3、4（不包含5）</span>
<span class="hljs-keyword">val</span> halfOpenRange = <span class="hljs-number">1</span> until <span class="hljs-number">5</span>
<span class="hljs-comment">// 字符半开区间：'a' until 'd'，包含'a'、'b'、'c'（不包含'd'）</span>
<span class="hljs-keyword">val</span> charHalfOpenRange = <span class="hljs-string">'a'</span> until <span class="hljs-string">'d'</span>

</code></pre>
<h4 data-id="heading-9">2.2.3 倒序区间：downTo （从结束值倒序到起始值）</h4>
<p>用“结束值 downTo 起始值”的语法定义倒序区间，表示从结束值开始，倒序遍历到起始值（包含起始值和结束值）。传统循环中倒序遍历需要手动调整循环变量，而downTo语法让倒序逻辑一目了然。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 数字倒序区间：5 downTo 1，包含5、4、3、2、1</span>
<span class="hljs-keyword">val</span> reverseRange = <span class="hljs-number">5</span> downTo <span class="hljs-number">1</span>
<span class="hljs-comment">// 字符倒序区间：'E' downTo 'A'，包含'E'、'D'、'C'、'B'、'A'</span>
<span class="hljs-keyword">val</span> charReverseRange = <span class="hljs-string">'E'</span> downTo <span class="hljs-string">'A'</span>

</code></pre>
<h3 data-id="heading-10">2.3 常用区间示例（数字区间、字符区间、步长 step 用法）</h3>
<p>除了三种基础区间类型，Kotlin还支持通过“step”关键字指定区间的遍历步长（即每次递增或递减的数值），默认步长为1。步长可以是正数（正序区间）或负数（倒序区间，但通常用downTo更直观），适用于需要“跳跃式”遍历的场景。下面通过具体示例展示数字区间、字符区间和步长的用法：</p>
<h4 data-id="heading-11">2.3.1 数字区间示例</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 闭区间：1到5，步长默认1</span>
    <span class="hljs-keyword">val</span> closedRange = <span class="hljs-number">1.</span><span class="hljs-number">.5</span>
    println(<span class="hljs-string">"闭区间 1..5：<span class="hljs-subst">${closedRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：闭区间 1..5：[1, 2, 3, 4, 5]</span>

    <span class="hljs-comment">// 2. 半开区间：1到5（不含5），步长默认1</span>
    <span class="hljs-keyword">val</span> halfOpenRange = <span class="hljs-number">1</span> until <span class="hljs-number">5</span>
    println(<span class="hljs-string">"半开区间 1 until 5：<span class="hljs-subst">${halfOpenRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：半开区间 1 until 5：[1, 2, 3, 4]</span>

    <span class="hljs-comment">// 3. 倒序区间：5到1，步长默认1</span>
    <span class="hljs-keyword">val</span> reverseRange = <span class="hljs-number">5</span> downTo <span class="hljs-number">1</span>
    println(<span class="hljs-string">"倒序区间 5 downTo 1：<span class="hljs-subst">${reverseRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：倒序区间 5 downTo 1：[5, 4, 3, 2, 1]</span>

    <span class="hljs-comment">// 4. 指定步长的正序区间：1到10，步长2（只取奇数）</span>
    <span class="hljs-keyword">val</span> stepRange = <span class="hljs-number">1.</span><span class="hljs-number">.10</span> step <span class="hljs-number">2</span>
    println(<span class="hljs-string">"步长2的正序区间：<span class="hljs-subst">${stepRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：步长2的正序区间：[1, 3, 5, 7, 9]</span>

    <span class="hljs-comment">// 5. 指定步长的倒序区间：10到1，步长3</span>
    <span class="hljs-keyword">val</span> reverseStepRange = <span class="hljs-number">10</span> downTo <span class="hljs-number">1</span> step <span class="hljs-number">3</span>
    println(<span class="hljs-string">"步长3的倒序区间：<span class="hljs-subst">${reverseStepRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：步长3的倒序区间：[10, 7, 4, 1]</span>
}

</code></pre>
<h4 data-id="heading-12">2.3.2 字符区间示例</h4>
<p>字符区间基于字符的ASCII码值进行排序，支持正序、倒序和步长遍历，适用于需要遍历字母表等场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 正序字符闭区间：'a'到'e'</span>
    <span class="hljs-keyword">val</span> lowerCharRange = <span class="hljs-string">'a'</span>..<span class="hljs-string">'e'</span>
    println(<span class="hljs-string">"小写字母区间：<span class="hljs-subst">${lowerCharRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：小写字母区间：[a, b, c, d, e]</span>

    <span class="hljs-comment">// 2. 倒序字符区间：'Z'到'W'</span>
    <span class="hljs-keyword">val</span> upperReverseRange = <span class="hljs-string">'Z'</span> downTo <span class="hljs-string">'W'</span>
    println(<span class="hljs-string">"倒序大写字母区间：<span class="hljs-subst">${upperReverseRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：倒序大写字母区间：[Z, Y, X, W]</span>

    <span class="hljs-comment">// 3. 指定步长的字符区间：'A'到'I'，步长2（取A、C、E、G、I）</span>
    <span class="hljs-keyword">val</span> charStepRange = <span class="hljs-string">'A'</span>..<span class="hljs-string">'I'</span> step <span class="hljs-number">2</span>
    println(<span class="hljs-string">"步长2的字符区间：<span class="hljs-subst">${charStepRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：步长2的字符区间：[A, C, E, G, I]</span>
}

</code></pre>
<h4 data-id="heading-13">2.3.3 步长使用注意事项</h4>
<p>步长的使用虽然灵活，但有两个关键点需要注意：一是<strong>步长不能为0</strong>，否则会导致无限循环，Kotlin编译器会直接报错；二是<strong>倒序区间建议用downTo配合正步长</strong>，而非用正序区间配合负步长（虽然语法允许，但可读性极差）。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 错误示例：步长为0，编译报错</span>
    <span class="hljs-comment">// val errorRange = 1..5 step 0</span>

    <span class="hljs-comment">// 不推荐：正序区间配合负步长（可读性差）</span>
    <span class="hljs-keyword">val</span> notRecommended = <span class="hljs-number">5.</span><span class="hljs-number">.1</span> step -<span class="hljs-number">1</span>
    println(notRecommended.toList()) <span class="hljs-comment">// 输出：[5, 4, 3, 2, 1]</span>

    <span class="hljs-comment">// 推荐：用downTo定义倒序区间，配合正步长（可读性高）</span>
    <span class="hljs-keyword">val</span> recommended = <span class="hljs-number">5</span> downTo <span class="hljs-number">1</span> step <span class="hljs-number">1</span>
    println(recommended.toList()) <span class="hljs-comment">// 输出：[5, 4, 3, 2, 1]</span>
}

</code></pre>
<h2 data-id="heading-14">三、Kotlin for 循环：与区间的完美配合</h2>
<h3 data-id="heading-15">3.1 for 循环的基本语法（遍历区间的简洁写法）</h3>
<p>Kotlin的for循环摒弃了Java中“三段式”的复杂语法，采用“for (元素变量 in 可迭代对象)”的简洁形式，其中“可迭代对象”可以是区间、数组、列表、集合等实现了Iterable接口的类型。当可迭代对象是区间时，for循环会逐个遍历区间中的元素，语法如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// for 循环遍历区间的基本语法</span>
<span class="hljs-keyword">for</span> (element <span class="hljs-keyword">in</span> 区间表达式) {
    <span class="hljs-comment">// 循环体：element 为当前遍历到的区间元素</span>
    执行逻辑
}

</code></pre>
<p>这种语法的优势在于“聚焦元素本身”，无需关注循环变量的初始化、终止条件和步长调整（区间已封装这些信息），比如遍历1到5并打印每个元素，只需一行循环头即可实现：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 遍历1到5的闭区间，打印每个元素</span>
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.5</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$i</span> "</span>) <span class="hljs-comment">// 输出：1 2 3 4 5</span>
    }
}

</code></pre>
<h3 data-id="heading-16">3.2 遍历常见区间场景</h3>
<p>结合上一章讲解的三种区间类型和步长用法，for循环与区间配合可实现多种常见的遍历场景，下面分别介绍并给出示例。</p>
<h4 data-id="heading-17">3.2.1 正序遍历（如 1..5 遍历 1-5）</h4>
<p>正序遍历是最基础的场景，使用闭区间“起始值..结束值”即可，默认步长为1，适用于需要从起始值到结束值依次遍历的场景，比如打印1到10的数字、遍历字母表等。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：打印1到10的正整数</span>
    println(<span class="hljs-string">"1到10的正整数："</span>)
    <span class="hljs-keyword">for</span> (num <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$num</span> "</span>) <span class="hljs-comment">// 输出：1 2 3 4 5 6 7 8 9 10</span>
    }
    println()

    <span class="hljs-comment">// 场景2：打印A到F的大写字母</span>
    println(<span class="hljs-string">"A到F的大写字母："</span>)
    <span class="hljs-keyword">for</span> (char <span class="hljs-keyword">in</span> <span class="hljs-string">'A'</span>..<span class="hljs-string">'F'</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$char</span> "</span>) <span class="hljs-comment">// 输出：A B C D E F</span>
    }
}

</code></pre>
<h4 data-id="heading-18">3.2.2 不包含终点遍历（until 关键字）</h4>
<p>当需要遍历“从起始值到结束值，但不包含结束值”时，使用半开区间“起始值 until 结束值”，这种场景在遍历数组、列表等索引从0开始的集合时尤为常用，能避免“索引越界”的风险。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：遍历0到4（不包含5），模拟数组索引</span>
    <span class="hljs-keyword">val</span> array = arrayOf(<span class="hljs-string">"Kotlin"</span>, <span class="hljs-string">"Java"</span>, <span class="hljs-string">"Python"</span>, <span class="hljs-string">"Go"</span>, <span class="hljs-string">"Swift"</span>)
    println(<span class="hljs-string">"数组元素："</span>)
    <span class="hljs-comment">// 数组长度为5，索引范围0-4，用until避免索引越界</span>
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until array.size) {
        println(<span class="hljs-string">"索引<span class="hljs-variable">$index</span>：<span class="hljs-subst">${array[index]}</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 索引0：Kotlin</span>
    <span class="hljs-comment">// 索引1：Java</span>
    <span class="hljs-comment">// 索引2：Python</span>
    <span class="hljs-comment">// 索引3：Go</span>
    <span class="hljs-comment">// 索引4：Swift</span>

    <span class="hljs-comment">// 场景2：打印1到9（不包含10）的数字</span>
    println(<span class="hljs-string">"1到9的数字："</span>)
    <span class="hljs-keyword">for</span> (num <span class="hljs-keyword">in</span> <span class="hljs-number">1</span> until <span class="hljs-number">10</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$num</span> "</span>) <span class="hljs-comment">// 输出：1 2 3 4 5 6 7 8 9</span>
    }
}

</code></pre>
<h4 data-id="heading-19">3.2.3 倒序遍历（downTo 关键字）</h4>
<p>倒序遍历使用“结束值 downTo 起始值”的倒序区间，适用于需要从大到小遍历的场景，比如倒计时、逆序打印数据等。相比传统循环的倒序写法，downTo语法更直观。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：倒计时（10到1）</span>
    println(<span class="hljs-string">"倒计时开始："</span>)
    <span class="hljs-keyword">for</span> (count <span class="hljs-keyword">in</span> <span class="hljs-number">10</span> downTo <span class="hljs-number">1</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$count</span> "</span>)
        Thread.sleep(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 模拟延迟1秒</span>
    }
    println(<span class="hljs-string">"！倒计时结束"</span>) <span class="hljs-comment">// 输出：10 9 8 7 6 5 4 3 2 1 ！倒计时结束</span>

    <span class="hljs-comment">// 场景2：逆序打印数组元素</span>
    <span class="hljs-keyword">val</span> numbers = arrayOf(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>)
    println(<span class="hljs-string">"数组逆序元素："</span>)
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> numbers.size - <span class="hljs-number">1</span> downTo <span class="hljs-number">0</span>) {
        print(<span class="hljs-string">"<span class="hljs-subst">${numbers[index]}</span> "</span>) <span class="hljs-comment">// 输出：50 40 30 20 10</span>
    }
}

</code></pre>
<h4 data-id="heading-20">3.2.4 指定步长遍历（step 控制间隔）</h4>
<p>当需要“跳跃式”遍历区间时，在区间表达式后加上“step 步长值”即可，适用于只需要遍历区间中部分元素的场景，比如遍历奇数、偶数，或每隔n个元素处理一次。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：遍历1到20的偶数（步长2，起始值为2）</span>
    println(<span class="hljs-string">"1到20的偶数："</span>)
    <span class="hljs-keyword">for</span> (even <span class="hljs-keyword">in</span> <span class="hljs-number">2.</span><span class="hljs-number">.20</span> step <span class="hljs-number">2</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$even</span> "</span>) <span class="hljs-comment">// 输出：2 4 6 8 10 12 14 16 18 20</span>
    }
    println()

    <span class="hljs-comment">// 场景2：遍历100到50的整十数（倒序，步长10）</span>
    println(<span class="hljs-string">"100到50的整十数："</span>)
    <span class="hljs-keyword">for</span> (ten <span class="hljs-keyword">in</span> <span class="hljs-number">100</span> downTo <span class="hljs-number">50</span> step <span class="hljs-number">10</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$ten</span> "</span>) <span class="hljs-comment">// 输出：100 90 80 70 60 50</span>
    }
    println()

    <span class="hljs-comment">// 场景3：每隔3个字母打印一次（A到Z，步长3）</span>
    println(<span class="hljs-string">"A到Z每隔3个字母："</span>)
    <span class="hljs-keyword">for</span> (char <span class="hljs-keyword">in</span> <span class="hljs-string">'A'</span>..<span class="hljs-string">'Z'</span> step <span class="hljs-number">3</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$char</span> "</span>) <span class="hljs-comment">// 输出：A D G J M P S V Y</span>
    }
}

</code></pre>
<h3 data-id="heading-21">3.3 for 循环遍历其他集合（结合区间思想遍历数组、列表）</h3>
<p>虽然Kotlin的for循环与区间配合极为默契，但它并非只能遍历区间。实际上，for循环可以遍历所有实现了Iterable接口的集合（如数组、List、Set等），其核心思想与遍历区间一致——“逐个访问集合中的元素”。下面介绍两种常见的集合遍历场景：直接遍历元素和通过索引遍历元素（结合区间思想）。</p>
<h4 data-id="heading-22">3.3.1 直接遍历集合元素</h4>
<p>对于数组、List等集合，for循环可以直接遍历其中的元素，无需通过索引，语法为“for (元素 in 集合)”，这种方式最简洁，适用于不需要关注元素索引的场景。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 遍历数组元素</span>
    <span class="hljs-keyword">val</span> fruits = arrayOf(<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"葡萄"</span>, <span class="hljs-string">"橙子"</span>)
    println(<span class="hljs-string">"水果数组："</span>)
    <span class="hljs-keyword">for</span> (fruit <span class="hljs-keyword">in</span> fruits) {
        println(<span class="hljs-string">"水果：<span class="hljs-variable">$fruit</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 水果：苹果</span>
    <span class="hljs-comment">// 水果：香蕉</span>
    <span class="hljs-comment">// 水果：葡萄</span>
    <span class="hljs-comment">// 水果：橙子</span>

    <span class="hljs-comment">// 2. 遍历List元素</span>
    <span class="hljs-keyword">val</span> scores = listOf(<span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">78</span>, <span class="hljs-number">95</span>, <span class="hljs-number">88</span>)
    println(<span class="hljs-string">"成绩列表："</span>)
    <span class="hljs-keyword">var</span> total = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> (score <span class="hljs-keyword">in</span> scores) {
        total += score
    }
    println(<span class="hljs-string">"总成绩：<span class="hljs-variable">$total</span>，平均分：<span class="hljs-subst">${total / scores.size}</span>"</span>) <span class="hljs-comment">// 输出：总成绩：438，平均分：87</span>
}

</code></pre>
<h4 data-id="heading-23">3.3.2 通过索引遍历集合元素（结合区间）</h4>
<p>当需要同时获取元素的索引和值时，可以结合区间思想，通过“0 until 集合.size”的半开区间遍历索引，再通过索引获取元素。这种方式类似于Java中的“for循环遍历索引”，但语法更简洁。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 遍历数组：同时获取索引和元素</span>
    <span class="hljs-keyword">val</span> colors = arrayOf(<span class="hljs-string">"红色"</span>, <span class="hljs-string">"绿色"</span>, <span class="hljs-string">"蓝色"</span>, <span class="hljs-string">"黄色"</span>)
    println(<span class="hljs-string">"颜色数组（索引-值）："</span>)
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until colors.size) {
        <span class="hljs-keyword">val</span> color = colors[index]
        println(<span class="hljs-string">"索引<span class="hljs-variable">$index</span>：<span class="hljs-variable">$color</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 索引0：红色</span>
    <span class="hljs-comment">// 索引1：绿色</span>
    <span class="hljs-comment">// 索引2：蓝色</span>
    <span class="hljs-comment">// 索引3：黄色</span>

    <span class="hljs-comment">// 遍历List：倒序获取索引和元素</span>
    <span class="hljs-keyword">val</span> names = listOf(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-string">"王五"</span>)
    println(<span class="hljs-string">"姓名列表（逆序索引-值）："</span>)
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> names.size - <span class="hljs-number">1</span> downTo <span class="hljs-number">0</span>) {
        println(<span class="hljs-string">"索引<span class="hljs-variable">$index</span>：<span class="hljs-subst">${names[index]}</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 索引2：王五</span>
    <span class="hljs-comment">// 索引1：李四</span>
    <span class="hljs-comment">// 索引0：张三</span>
}

</code></pre>
<p>此外，Kotlin还提供了“withIndex()”方法，可直接获取包含索引和值的Pair对象，进一步简化“索引+值”的遍历逻辑：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> languages = listOf(<span class="hljs-string">"Kotlin"</span>, <span class="hljs-string">"Java"</span>, <span class="hljs-string">"Python"</span>)
    <span class="hljs-keyword">for</span> ((index, lang) <span class="hljs-keyword">in</span> languages.withIndex()) {
        println(<span class="hljs-string">"索引<span class="hljs-variable">$index</span>：<span class="hljs-variable">$lang</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 索引0：Kotlin</span>
    <span class="hljs-comment">// 索引1：Java</span>
    <span class="hljs-comment">// 索引2：Python</span>
}

</code></pre>
<h2 data-id="heading-24">四、for 循环 + 区间 实用场景举例</h2>
<p>“for循环+区间”的组合在实际开发中应用广泛，无论是简单的数字遍历，还是复杂的业务数据处理，都能发挥其简洁高效的优势。下面通过四个常见的实用场景，展示其在开发中的具体应用。</p>
<h3 data-id="heading-25">4.1 数字遍历（如循环打印 1-10）</h3>
<p>数字遍历是最基础的场景，常用于打印连续数字、生成连续数据、计数等需求。下面以“生成1到100的奇数并计算总和”为例，展示数字遍历的应用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 场景：生成1到100的奇数，打印并计算总和
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateOddNumbers</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> oddList = mutableListOf&lt;<span class="hljs-built_in">Int</span>&gt;()
    <span class="hljs-keyword">var</span> total = <span class="hljs-number">0</span>
    <span class="hljs-comment">// 遍历1到100，步长2，获取所有奇数</span>
    <span class="hljs-keyword">for</span> (num <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.100</span> step <span class="hljs-number">2</span>) {
        oddList.add(num)
        total += num
    }
    println(<span class="hljs-string">"1到100的奇数共有<span class="hljs-subst">${oddList.size}</span>个："</span>)
    println(oddList.take(<span class="hljs-number">10</span>).joinToString(<span class="hljs-string">", "</span>) + <span class="hljs-string">"..."</span> + oddList.takeLast(<span class="hljs-number">10</span>).joinToString(<span class="hljs-string">", "</span>))
    println(<span class="hljs-string">"1到100的奇数总和：<span class="hljs-variable">$total</span>"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    generateOddNumbers()
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 1到100的奇数共有50个：</span>
    <span class="hljs-comment">// 1, 3, 5, 7, 9, 11, 13, 15, 17, 19...81, 83, 85, 87, 89, 91, 93, 95, 97, 99</span>
    <span class="hljs-comment">// 1到100的奇数总和：2500</span>
}

</code></pre>
<h3 data-id="heading-26">4.2 字符遍历（如循环打印 A-Z）</h3>
<p>字符遍历常用于生成字母表、字符编码转换、批量生成字符串等场景。下面以“生成A-Z的大写字母和对应的ASCII码”为例，展示字符遍历的应用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 场景：生成A-Z的大写字母，打印字母及对应的ASCII码
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printCharAndAscii</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"大写字母 | ASCII码"</span>)
    println(<span class="hljs-string">"--------|--------"</span>)
    <span class="hljs-comment">// 遍历'A'到'Z'的字符区间</span>
    <span class="hljs-keyword">for</span> (char <span class="hljs-keyword">in</span> <span class="hljs-string">'A'</span>..<span class="hljs-string">'Z'</span>) {
        <span class="hljs-keyword">val</span> ascii = char.toInt() <span class="hljs-comment">// 获取字符的ASCII码</span>
        println(<span class="hljs-string">"<span class="hljs-variable">$char</span>        | <span class="hljs-variable">$ascii</span>"</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    printCharAndAscii()
    <span class="hljs-comment">// 输出（部分）：</span>
    <span class="hljs-comment">// 大写字母 | ASCII码</span>
    <span class="hljs-comment">// --------|--------</span>
    <span class="hljs-comment">// A        | 65</span>
    <span class="hljs-comment">// B        | 66</span>
    <span class="hljs-comment">// C        | 67</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// Z        | 90</span>
}

</code></pre>
<h3 data-id="heading-27">4.3 集合遍历（如遍历列表、数组）</h3>
<p>集合遍历是开发中最常用的场景之一，常用于数据筛选、转换、统计等操作。下面以“遍历学生列表，筛选出成绩≥90分的优秀学生并排序”为例，展示集合遍历的应用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 定义学生数据类</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> score: <span class="hljs-built_in">Int</span>)

<span class="hljs-comment">/**
 * 场景：遍历学生列表，筛选优秀学生并排序
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">filterExcellentStudents</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 模拟学生列表数据</span>
    <span class="hljs-keyword">val</span> students = listOf(
        Student(<span class="hljs-string">"张三"</span>, <span class="hljs-number">85</span>),
        Student(<span class="hljs-string">"李四"</span>, <span class="hljs-number">92</span>),
        Student(<span class="hljs-string">"王五"</span>, <span class="hljs-number">78</span>),
        Student(<span class="hljs-string">"赵六"</span>, <span class="hljs-number">95</span>),
        Student(<span class="hljs-string">"钱七"</span>, <span class="hljs-number">88</span>),
        Student(<span class="hljs-string">"孙八"</span>, <span class="hljs-number">90</span>)
    )

    <span class="hljs-keyword">val</span> excellentStudents = mutableListOf&lt;Student&gt;()
    <span class="hljs-comment">// 遍历学生列表，筛选成绩≥90分的学生</span>
    <span class="hljs-keyword">for</span> (student <span class="hljs-keyword">in</span> students) {
        <span class="hljs-keyword">if</span> (student.score &gt;= <span class="hljs-number">90</span>) {
            excellentStudents.add(student)
        }
    }

    <span class="hljs-comment">// 按成绩降序排序（通过索引遍历排序后的列表）</span>
    <span class="hljs-keyword">val</span> sortedStudents = excellentStudents.sortedByDescending { it.score }
    println(<span class="hljs-string">"优秀学生列表（成绩≥90分，按成绩降序）："</span>)
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until sortedStudents.size) {
        <span class="hljs-keyword">val</span> student = sortedStudents[index]
        println(<span class="hljs-string">"第<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>名：<span class="hljs-subst">${student.name}</span>，成绩：<span class="hljs-subst">${student.score}</span>"</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    filterExcellentStudents()
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 优秀学生列表（成绩≥90分，按成绩降序）：</span>
    <span class="hljs-comment">// 第1名：赵六，成绩：95</span>
    <span class="hljs-comment">// 第2名：李四，成绩：92</span>
    <span class="hljs-comment">// 第3名：孙八，成绩：90</span>
}

</code></pre>
<h3 data-id="heading-28">4.4 简单业务场景（如计数、批量处理数据）</h3>
<p>在实际业务中，“for循环+区间”可用于批量处理数据、计数统计、生成测试数据等场景。下面以“批量生成10个测试用户并统计男性用户数量”为例，展示其业务应用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 定义用户数据类</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> gender: String)

<span class="hljs-comment">/**
 * 场景：批量生成10个测试用户，统计男性用户数量
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateTestUsers</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> users = mutableListOf&lt;User&gt;()
    <span class="hljs-keyword">var</span> maleCount = <span class="hljs-number">0</span>
    <span class="hljs-comment">// 遍历1到10的区间，生成10个用户</span>
    <span class="hljs-keyword">for</span> (id <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) {
        <span class="hljs-keyword">val</span> name = <span class="hljs-string">"测试用户<span class="hljs-variable">$id</span>"</span>
        <span class="hljs-comment">// 奇数ID为男性，偶数ID为女性</span>
        <span class="hljs-keyword">val</span> gender = <span class="hljs-keyword">if</span> (id % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) <span class="hljs-string">"男"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"女"</span>
        <span class="hljs-keyword">val</span> user = User(id, name, gender)
        users.add(user)
        <span class="hljs-comment">// 统计男性用户数量</span>
        <span class="hljs-keyword">if</span> (gender == <span class="hljs-string">"男"</span>) {
            maleCount++
        }
    }

    <span class="hljs-comment">// 打印所有用户信息</span>
    println(<span class="hljs-string">"批量生成的10个测试用户："</span>)
    <span class="hljs-keyword">for</span> (user <span class="hljs-keyword">in</span> users) {
        println(<span class="hljs-string">"ID：<span class="hljs-subst">${user.id}</span>，姓名：<span class="hljs-subst">${user.name}</span>，性别：<span class="hljs-subst">${user.gender}</span>"</span>)
    }
    println(<span class="hljs-string">"男性用户数量：<span class="hljs-variable">$maleCount</span>，女性用户数量：<span class="hljs-subst">${users.size - maleCount}</span>"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    generateTestUsers()
    <span class="hljs-comment">// 输出（部分）：</span>
    <span class="hljs-comment">// 批量生成的10个测试用户：</span>
    <span class="hljs-comment">// ID：1，姓名：测试用户1，性别：男</span>
    <span class="hljs-comment">// ID：2，姓名：测试用户2，性别：女</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// ID：10，姓名：测试用户10，性别：女</span>
    <span class="hljs-comment">// 男性用户数量：5，女性用户数量：5</span>
}

</code></pre>
<h2 data-id="heading-29">五、总结与使用建议</h2>
<h3 data-id="heading-30">5.1 核心知识点回顾（区间类型、for 循环遍历方式）</h3>
<ul>
<li><strong>区间核心知识点</strong>：区间是连续值的集合，支持三种类型——闭区间（..，包含首尾）、半开区间（until，包含首不包含尾）、倒序区间（downTo，从尾到首）；可通过step指定步长（默认1，不能为0），支持数字和字符区间。</li>
<li><strong>for循环核心知识点</strong>：采用“for (元素 in 可迭代对象)”的简洁语法，可遍历区间、数组、列表等集合；遍历区间时无需关注循环变量细节，聚焦元素本身；遍历集合时支持直接遍历元素或通过索引遍历（结合区间）。</li>
<li><strong>组合优势</strong>：“for循环+区间”实现了循环逻辑的极致简化，将“范围描述”与“遍历执行”完美结合，语法直观、可读性高，覆盖绝大多数循环场景。</li>
</ul>
<h3 data-id="heading-31">5.2 适用场景与避坑点（何时用哪种区间、步长注意事项）</h3>
<h4 data-id="heading-32">5.2.1 适用场景与区间选择</h4>
<ol>
<li><strong>正序遍历且包含首尾值</strong>：选择闭区间“a..b”，如遍历1到10的所有数字。</li>
<li><strong>正序遍历且不包含尾值</strong>：选择半开区间“a until b”，如遍历数组索引（0 until 数组.size）。</li>
<li><strong>倒序遍历</strong>：选择倒序区间“b downTo a”，如倒计时、逆序打印数据。</li>
<li><strong>跳跃式遍历</strong>：在上述区间基础上添加“step 步长”，如遍历奇数（1..100 step 2）。</li>
<li><strong>集合遍历</strong>：直接遍历元素用“for (元素 in 集合)”；需要索引用“for (index in 0 until 集合.size)”或“for ((index, 元素) in 集合.withIndex())”。</li>
</ol>
<h4 data-id="heading-33">5.2.2 避坑点</h4>
<ul>
<li><strong>步长不可为0</strong>：步长为0会导致无限循环，编译器会直接报错，务必确保步长为非0整数。</li>
<li><strong>倒序遍历避免负步长</strong>：倒序遍历推荐用“downTo”配合正步长，而非正序区间配合负步长，提升代码可读性。</li>
<li><strong>字符区间注意ASCII码顺序</strong>：字符区间基于ASCII码排序，大写字母ASCII码小于小写字母（如'A'..'z'会包含其他字符），需谨慎使用跨大小写的字符区间。</li>
<li><strong>区间不可直接用于非连续值</strong>：区间仅支持连续值，若需遍历非连续值（如1、3、5、7），可通过步长实现，或使用集合存储非连续值后遍历。</li>
</ul>
<h3 data-id="heading-34">5.3 代码简洁性技巧（用区间简化循环逻辑）</h3>
<ul>
<li><strong>替代传统计数循环</strong>：摒弃Java“三段式”循环，所有计数循环都用“for (i in 区间)”实现，如“for (i in 1..10)”替代“for (int i=1; i&lt;=10; i++)”。</li>
<li><strong>利用区间生成集合</strong>：通过“区间.toList()”快速生成连续值集合，如“(1..5).toList()”生成[1,2,3,4,5]，避免手动添加元素。</li>
<li><strong>结合集合函数简化逻辑</strong>：遍历集合时，若需筛选、转换数据，可结合Kotlin集合函数（如filter、map），减少for循环内的复杂逻辑。例如，筛选成绩≥90的学生可简化为“students.filter { it.score ≥ 90 }”。</li>
<li><strong>单语句循环省略花括号</strong>：若循环体仅包含一条语句，可省略花括号，进一步简化代码，如“for (i in 1..5) print(i)”。</li>
</ul>
<p>Kotlin的“for循环+区间”是对传统循环语法的一次重要优化，其核心在于“用简洁的语法描述复杂的循环范围”，让开发者能更专注于业务逻辑。掌握区间的三种类型、步长的使用以及for循环与不同可迭代对象的配合，能极大提升代码的简洁性和可读性。建议在开发中主动摒弃传统的“三段式”循环思维，多用“for循环+区间”的组合，逐步养成Kotlin式的简洁编码习惯。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI概念解惑系列 - RAG]]></title>    <link>https://juejin.cn/post/7573950036897202216</link>    <guid>https://juejin.cn/post/7573950036897202216</guid>    <pubDate>2025-11-19T04:26:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573950036897202216" data-draft-id="7574204970774659099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI概念解惑系列 - RAG"/> <meta itemprop="keywords" content="前端,AIGC,LLM"/> <meta itemprop="datePublished" content="2025-11-19T04:26:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="酥风"/> <meta itemprop="url" content="https://juejin.cn/user/4388906148064231"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI概念解惑系列 - RAG
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906148064231/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    酥风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T04:26:09.000Z" title="Wed Nov 19 2025 04:26:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    87
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文发布于掘金，转载请声明</p>
</blockquote>
<p>随着最近几年AI在各个领域大放异彩，作为一个前端开发，我也对AI里的各种技术概念产生了浓厚的兴趣，希望能详细了解这些技术概念和背后的原理后，找寻和前端结合的一些思路。今天我们就来一起了解下AI领域常用到的一个技术——<strong>RAG（Retrieval-Augmented Generation）</strong>，检索增强生成。</p>
<h2 data-id="heading-0">一、 开始之前</h2>
<p>在开始介绍RAG之前，我们先来简单回顾一下大语言模型LLM的原理。</p>
<p>LLM通过预训练，让模型学习了全网公开的知识（网页、书籍、论文、代码等等），得到一堆“参数”，之后根据用户的输入来不断地预测下一个token应该是什么，最终得到输出。</p>
<p>这种训练好的模型，在通用领域有着比较好的表现。但是根据LLM的原理，我们也能发现它的一些不足：</p>
<ul>
<li>“<strong>预训练</strong>”：由于是使用了旧的数据进行的训练，对于在训练之后产生新信息，LLM无法回答</li>
<li>“<strong>公开的知识</strong>”：LLM使用了公开的知识训练，对于一些非公开的内容，或者专业数据，LLM同样无法回答</li>
<li>“<strong>预测</strong>”：因为LLM本质上是一个“看前文、猜下文”的大规模统计生成器，所以对于它不知道的信息，在回答时往往会“胡说八道”，也就是常说的Hallucination，“<strong>幻觉</strong>”</li>
</ul>
<p>对于普通用户一些不要求实时性的通用性问题来说，上面这些不是什么大问题，但是一旦涉及到<strong>实时性、专业数据、企业内私有数据</strong>时，上面的问题就会严重影响用户体验。</p>
<p>为了解决这些问题，通常有下面两个手段：</p>
<ol>
<li>微调大模型</li>
<li>手动给LLM添加额外知识，即外挂知识库</li>
</ol>
<h2 data-id="heading-1">二、 微调 vs 外挂知识库</h2>
<h3 data-id="heading-2">1. 微调Fine-tuning</h3>
<p>所谓<strong>微调（Fine-tuning）</strong>，就是在预训练模型的基础上，使用特定任务的数据（如私有数据、专业领域知识、最新的信息等）进行进一步训练，让模型在特定领域表现更好。</p>
<p>举个比较形象的例子，通过预训练得到的大模型，就是学习了小学到高中的通识教育的知识，学会语言、数学、常识、逻辑思维，知识面广但不够专业。</p>
<p>而微调阶段（Fine-tuning）类似于专业教育，就好像学习了专业领域课程、成为某个领域的专家。</p>
<p>即“<strong>通用模型 + 专业数据 + 针对性训练 = 专业模型</strong>”：</p>
<ul>
<li>GPT + 代码数据 + 代码任务训练 = CodeGPT</li>
<li>GPT + 医学数据 + 医学任务训练 = MedicalGPT</li>
<li>GPT + 法律数据 + 法律任务训练 = LegalGPT</li>
</ul>
<h3 data-id="heading-3">2. 外挂知识库</h3>
<p>在和LLM交互时，我们可以通过一些特殊手段，从外部知识库检索相关信息提供给LLM，相当于给AI配个"外挂知识库"，让它可以获取到专业领域知识、私有数据、实时信息等等。</p>
<p>而RAG就是比较常用的手段。</p>
<h3 data-id="heading-4">3. 对比</h3>
<p>对比这两个不难发现，微调是内化知识到了模型参数中，最终的效果肯定是稍微好一些的。</p>
<p>但是考虑到微调下面这些点：</p>
<ul>
<li>需要<strong>大量的标注训练数据</strong>（需要对文档等进行数据清洗、标注等）</li>
<li><strong>较高的训练成本</strong>（比如训练需要较高的算力，有不小的经济成本和时间成本）</li>
<li><strong>较高的实现难度</strong>（需要AI领域的专业知识）</li>
<li><strong>无法保持数据是最新的</strong>（内化的知识需要重新训练才能更新）</li>
</ul>
<p>对于个人或者中小型企业来说，通过RAG外挂知识库是一个更合适的选择：</p>
<ul>
<li>只需要<strong>结构化的文档</strong></li>
<li><strong>不需要训练</strong></li>
<li><strong>较低的实现难度</strong>（大多是工程方面的实现）</li>
<li><strong>知识库更新很方便</strong>（不需要重新训练，只需要重新向量化即可）</li>
</ul>
<h2 data-id="heading-5">三、 RAG</h2>
<p>那我们来看下RAG是什么，所谓 <strong>RAG（Retrieval-Augmented Generation）</strong> 检索增强生成，就是：</p>
<ol>
<li><strong>检索(Retrieval)</strong>: 从外部知识库中检索相关信息</li>
<li><strong>增强(Augmented)</strong>: 将检索到的信息作为上下文</li>
<li><strong>生成(Generation)</strong>: 大模型基于检索内容生成回答</li>
</ol>
<p>它的本质就是上面说的给LLM外挂一个知识库，而它的工作过程，简单来讲就是下面这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d1ad7ba2b5f42a386942cf8fc28fd4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=vprImOLDcCSdMjQLPRBcpM6Gsb0%3D" alt="工作流程" loading="lazy"/></p>
<p>而一个RAG完整工程的架构示意图，则如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c2962721a194f80aa63ff971265d41c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=JorK7KNJlRPpJkWkkvRz2W3ZfWw%3D" alt="架构示意图" loading="lazy"/></p>
<p>看不懂？没关系，我们一步一步来讲解。</p>
<h2 data-id="heading-6">四、 向量和向量化</h2>
<p>首先，最基础的一个概念，什么是<strong>向量（Vector）<strong>和</strong>向量化（Vectorization/Embedding）</strong>。</p>
<h3 data-id="heading-7">向量（Vector）</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E5%2590%2591%25E9%2587%258F" target="_blank" title="https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F" ref="nofollow noopener noreferrer">向量</a>我们应该不陌生，我们最早应该在高中就学过了，就是一个同时具有数值和方向的量。相对应的，标量则只有数值，没有方向。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edc9198f575a4e2e8a33e947cbb9e2e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=Z%2FLBLe%2FCr40EP0dw1FnWdqppjb4%3D" alt="向量" loading="lazy"/></p>
<p>向量通常用一个有序的数字数组来表示，比如：</p>
<ul>
<li>2维向量: [3, 4]，可以理解为一个有x轴和y轴的平面直角坐标系，从原点指向[3, 4]这个坐标点的一个向量</li>
<li>3维向量: [1, 2, 3]，可以理解为一个有x、y、z三个轴的空间直角坐标系，从原点指向[1, 2, 3]这个坐标点的一个向量</li>
<li>高维向量: [0.2, 0.5, 0.1, ..., 0.8]，以此类推，在数学或者计算机领域，一个向量可以有任意多个维度， 比如有几百甚至上千维</li>
</ul>
<p>而在AI领域，向量是<strong>原始数据的数值化表示</strong>，用来捕捉语义信息，比如</p>
<ul>
<li>文本“苹果很好吃”，可以用这样一个向量表示：[0.12, 0.34, 0.89, ..., 0.45]</li>
<li>图片🍎，可以用这样一个向量表示：[0.23, 0.67, 0.12, ..., 0.91]</li>
</ul>
<p>而具体是怎么把一串文本或者图片转换为向量的，就是向量化所做的工作了。</p>
<h3 data-id="heading-8">向量化（Vectorization/Embedding）</h3>
<p>向量化，就是将非结构化原始数据(文本、图片、音频等)转换为向量的过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc600b46672646c3890041b2b33a4cb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=mpdNC%2Fx88FBuqpxLk6Cbi%2FrcZeY%3D" alt="向量化" loading="lazy"/></p>
<p>而为了将一个非结构化数据，变为向量，我们首先需要给这个数据定义好它的<strong>维度</strong>。</p>
<p>世界上的所有数据，都可以根据它在某一项特点上的程度而打一个分，数值越高代表这个原始数据在这个特点上的特征越强烈。我们规定<strong>数值的范围是[-1, 1]</strong>，1代表完全符合这个特征，-1代表拥有完全相反的特征。</p>
<p>例如下面这个二维的向量空间：</p>
<ul>
<li>横坐标代表情感极性，越靠近1代表越正向的情感，越靠近-1代表越负向的情感</li>
<li>纵坐标代表内容类型，越靠近1代表越主观的观点评价，越靠近-1代表越客观的事实陈述</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/390da64c4f3c46959adb72cc3bac8778~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=PRyrYkwQe8Nyi6Bun8w4Tzkmcug%3D" alt="二维向量示例" loading="lazy"/></p>
<p>上面的几个原始文本数据里：</p>
<blockquote>
<ol>
<li>这部电影太精彩了，演员表演完美
<ul>
<li>横轴（情感）：+0.9（强烈正面）</li>
<li>纵轴（内容类型）：+0.8（明显观点评价）</li>
<li>坐标：[0.9, 0.8]</li>
</ul>
</li>
<li>水的沸点是100摄氏度
<ul>
<li>横轴（情感）：0.0（完全中性）</li>
<li>纵轴（内容类型）：-0.9（纯粹事实）</li>
<li>坐标：[0.0, -0.9]</li>
</ul>
</li>
<li>这个产品质量很差，完全不符合预期
<ul>
<li>横轴（情感）：-0.8（明显负面）</li>
<li>纵轴（内容类型）：+0.7（个人评价）</li>
<li>坐标：[-0.8, 0.7]</li>
</ul>
</li>
<li>令人失望的是，数据显示销售额下降了20%"
<ul>
<li>横轴（情感）：-0.6（负面情绪）</li>
<li>纵轴（内容类型）：-0.3（偏向事实但带有主观色彩）</li>
<li>坐标：[-0.6, -0.3]</li>
</ul>
</li>
<li>数据表明用户流失率高达30%
<ul>
<li>横轴（情感）：-0.7（负面情绪）</li>
<li>纵轴（内容类型）：-0.8（事实陈述，且没有明显主观评价在里面）</li>
<li>坐标：[-0.7, -0.8]</li>
</ul>
</li>
<li>我们彩票中了500万
<ul>
<li>横轴（情感）：+0.9（正面）</li>
<li>纵轴（内容类型）：-0.8（事实陈述，且没有明显主观评价在里面）</li>
<li>坐标：[0.9, -0.8]</li>
</ul>
</li>
</ol>
</blockquote>
<p>可以看到，在我们对原始的文本数据从不同维度打分后会出现</p>
<ul>
<li>相似文本会聚集：比如所有正面评价都会集中在第一象限</li>
<li>距离/夹角反映相似度：坐标距离/夹角越近，文本在情感和类型上越相似</li>
</ul>
<p>我们的例子里只有两个维度，而在实际应用中可能有几百上千个维度，每个维度代表不同特征，这样的话就可以得到一个高维的向量空间，在向量空间内可以体现出不同数据之间或近或远的关系。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d73c9a1216941de8e8561882c97ce49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=nZ2LUJEuGcRtmSo7ALhxg8f2j8A%3D" alt="向量空间" loading="lazy"/></p>
<p>另外，向量化除了叫做Vectorization外，有时候也会叫做<strong>Embedding，嵌入</strong>。这是因为向量化的过程，不只是将一个非结构化数据转为向量数字，更重要的是在这个过程中，将原始数据的语义信息嵌入到了向量空间中,使得语义关系被保留。</p>
<p>举个例子，通常情况下“国王King”和“王后Queen”常出现在相似的上下文中，“男人Man”和“女人Women”经常出现在相似的上下文中。</p>
<p>皇室词汇（King, Queen, Prince）之间的相似度整体大于它们与普通人词汇（Man, Women）的相似度。但是“国王King”和“男人Man”之间又有一些相似，“王后Queen”和“女人Women”之间有一些相似。</p>
<p>而将这四个单词进行向量化后，可能如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c9da8bf27840e9bc1bfd49d2774e4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=%2Fhz2yotgf%2FZ%2FQPlKJm2iw7e0Fmc%3D" alt="语义嵌入" loading="lazy"/></p>
<p>“国王King”、“王后Queen”、“男人Man”、“女人Women”的语义以及语义关系被嵌入了向量空间，做到了：</p>
<ol>
<li><strong>保持语义关系</strong>: 意思相近的词在向量空间中也靠近</li>
<li><strong>支持语义运算</strong>: 实现了<code>king - man + woman ≈ queen</code>这种神奇的运算</li>
</ol>
<h3 data-id="heading-9">如何向量化</h3>
<p>向量化是一个很复杂的过程，通常都是使用模型来实现的，即“<strong>Embedding models</strong>”，比如OpenAI的text-embedding-ada-002（需要API密钥访问），或者也可以使用一些开源的模型。</p>
<p>通常一个模型向量化数据后的维度越高，在后续进行信息检索时就会越精准。</p>
<p>其实除了调用模型这一步之外，完整的向量化过程还有一些其他工作要做，整个过程大概如下：</p>
<ol>
<li>
<p>读取文档</p>
<ul>
<li>PDF → 提取文本</li>
<li>Word → 提取文本</li>
<li>Markdown → 读取内容</li>
<li>...</li>
</ul>
</li>
<li>
<p>清洗文本</p>
<ul>
<li>去除乱码</li>
<li>统一格式</li>
<li>去除无用内容（页眉页脚等）</li>
</ul>
</li>
<li>
<p>把文本进行切割，即<strong>文本分块 (Chunking)</strong></p>
<p>为什么要分块？因为原始文档可能特别长，几千上万字，不方便后续进行向量化和检索。</p>
<p>而分块的规则也有多种，比如根据标点符号分割，但是可能会存在有的块长度很长，有的又很短的情况；也可以根据固定长度分割，但是可能会导致一个完整的语义被切割到不同的块，每个块里的部分词变得毫无语义价值。</p>
<p>所以RAG 分割一般用<strong>相同块大小</strong> + <strong>块重叠</strong>的办法，即所谓的<strong>滑动窗口分块</strong>，这和按长度截断来分割有点像。用这种办法，在一定程度上能避免文档原意被截断导致分出来的片段变得没价值，而且重叠块里有重复的信息，能让模型更好地理解文档内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23760b3089254b1faa25715d6b51db5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=dDSt%2BNpVrS4OTWuQyNS0Xli5vN4%3D" alt="文本分块" loading="lazy"/></p>
</li>
<li>
<p>使用某个模型进行<strong>向量化（Embedding）</strong></p>
<ul>
<li>
<p>BGE-base-zh (中文效果好)</p>
</li>
<li>
<p>all-MiniLM-L6-v2 (英文，轻量)</p>
</li>
<li>
<p>text-embedding-ada-002 (OpenAI，需联网)</p>
<p>假设选择BGE-base-zh (中文)，输出维度768维，模型大小约 400MB</p>
</li>
</ul>
</li>
<li>
<p>将向量化后的数据存入向量数据库，<strong>构建索引（Indexing）</strong></p>
<p>普通的数据存储有数据库，那么向量的存储，也有专门的<strong>向量数据库</strong>，它是专为存储与检索高维嵌入向量而设计的数据库。支持基于相似度的检索并可结合元数据过滤，常用于语义搜索、推荐和 RAG。常见的数据库有：</p>
<ul>
<li>Chroma</li>
<li>Milvus</li>
<li>Qdrant</li>
</ul>
<p>假设选择Chroma，那么它的每条记录的存储结构大概为：</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"id"</span>: <span class="hljs-string">"doc_1_chunk_1"</span>,
  <span class="hljs-string">"vector"</span>: [<span class="hljs-number">0.23</span>, <span class="hljs-number">0.45</span>, ..., <span class="hljs-number">0.12</span>],  <span class="hljs-comment">// 768维向量</span>
  <span class="hljs-string">"metadata"</span>: {
    <span class="hljs-string">"source"</span>: <span class="hljs-string">"系统架构文档.pdf"</span>,
    <span class="hljs-string">"chunk_index"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"第一章 系统架构..."</span>  <span class="hljs-comment">// 原始文本</span>
  }
}
</code></pre>
</li>
</ol>
<p>在做完上述的几个步骤之后，就算是完成了RAG的准备工作，即给LLM准备好了“外挂的知识库”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/260f81589cae4e1297c6b45b0caf0c36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=py20iRdJjMvMRLEFI4PTDKr%2FE2Y%3D" alt="知识库向量化过程" loading="lazy"/></p>
<h2 data-id="heading-10">五、 RAG - R (Retrieval)</h2>
<p>在准备好知识库之后，就可以和LLM进行问答了。那在提出问题后，如何让LLM知晓知识库的内容呢？答案就是RAG中的R，<strong>Retrieval检索</strong>。</p>
<p>在上面的知识库的准备过程中，我们使用了某个<strong>Embedding Model</strong>进行了知识库的向量化，那么在用户提出问题Query之后，也需要使用相同的<strong>Embedding Model</strong>，对用户的输入Query进行相同的向量化。</p>
<p>在都进行了向量化之后，就可以开始在向量数据库中检索了，检索和用户的Query相似语义的向量。</p>
<h3 data-id="heading-11">相似度匹配</h3>
<p>和普通数据库基于关键字的检索不同，向量数据库是基于语义的检索。那怎么判断两个向量的语义是否接近，常见的衡量标准有：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E4%25BD%2599%25E5%25BC%25A6%25E7%259B%25B8%25E4%25BC%25BC%25E6%2580%25A7" target="_blank" title="https://zh.wikipedia.org/wiki/%E4%BD%99%E5%BC%A6%E7%9B%B8%E4%BC%BC%E6%80%A7" ref="nofollow noopener noreferrer">余弦相似度（Cosine Similarity）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E6%25AC%25A7%25E5%2587%25A0%25E9%2587%258C%25E5%25BE%2597%25E8%25B7%259D%25E7%25A6%25BB" target="_blank" title="https://zh.wikipedia.org/wiki/%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB" ref="nofollow noopener noreferrer">欧氏L2（Euclidean L2/Square L2）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E5%2586%2585%25E7%25A7%25AF" target="_blank" title="https://zh.wikipedia.org/wiki/%E5%86%85%E7%A7%AF" ref="nofollow noopener noreferrer">内积IP（Inner Product）</a></li>
</ul>
<p>这三个的具体定义和区别如下所示：</p>





























<table><thead><tr><th align="left">算法</th><th align="left">公式</th><th align="left">定义</th><th align="left">适用场景</th></tr></thead><tbody><tr><td align="left">余弦相似度（Cosine Similarity）</td><td align="left"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c058bf3e2fa240fe95b03ad3ef4aa21f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=mAvkfHDB2lMzNcfrBPdAhJUj80E%3D" alt="cosine" loading="lazy"/></td><td align="left">余弦相似度通过测量两个向量的夹角的余弦值来度量它们之间的相似性。<br/>仅反映方向一致性而与长度无关。</td><td align="left">当你关心“语义方向/形状”而不想被向量长度影响。<br/>典型应用场景有文本/图像嵌入检索、RAG 向量检索、语义去重、语义聚合。</td></tr><tr><td align="left">欧氏L2（Euclidean L2/Square L2）</td><td align="left"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8cab793bbfb4a82803b42fd700cc3f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=We0YS2tAP%2BbOi8VwIlta2rz6bvU%3D" alt="L2" loading="lazy"/></td><td align="left">对两向量差的平方和开平方来度量几何距离（或向量自身长度），反映它们在空间中的直线距离。</td><td align="left">当你你需要真正的几何距离（度量性质、三角不等式）时。<br/>典型应用场景有K-means 聚类（目标是平方 L2）、最小二乘/MSE、几何邻近、部分 ANN 索引默认。</td></tr><tr><td align="left">内积（Inner Product/Dot Product）</td><td align="left"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5239a9147eee49e99c2c9aed16456bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=On0xXHp%2BWkXSD5JsiQxENWD5ed0%3D" alt="Inner Product" loading="lazy"/></td><td align="left">将两个向量对应分量相乘后求和，得到同时受方向与长度影响的对齐程度（线性打分）。</td><td align="left">典型应用场景有最大内积搜索（MIPS）、推荐召回、因子分解机/embedding 打分。</td></tr></tbody></table>
<p>而在RAG语义搜索中，通常使用余弦相似度来计算两个向量是否相似，即通过判断两个向量的夹角大小，来判断两个向量的语义是否接近。还是以上面的这个图为例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f31f8d0a76643deac54c1a6c524ec7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=3Cdwsqq59eu1rjGIY4xjZJDXydU%3D" alt="向量空间夹角" loading="lazy"/></p>
<p>在这个向量空间里，Chicken和“鸡”的图片之间，向量的夹角很小，Dog和Wolf夹角很小，Banana和Apple夹角很小，Apple和Apple公司的Logo夹角很小。但是动物和水果之间的向量夹角就很大了，语义上相差很远。</p>
<blockquote>
<p>为什么用余弦相似度？</p>
<p>因为文本长度不重要（一句话和一段话可能表达同一意思），我们只关心语义方向是否一致。</p>
</blockquote>
<h3 data-id="heading-12">ANN</h3>
<p>在上面的图中，我们还看到了一个叫做Approximate Nearest Neighbor（ANN）近似最近邻检索算法的东西，这个和余弦相似度有什么关系呢？</p>
<p>简单来讲：</p>
<ul>
<li>ANN是“怎么快地找相似向量”（检索算法/索引）</li>
<li>余弦相似度是“用什么标准衡量相似”（度量/打分）</li>
</ul>
<p>在RAG中它们是配套使用的，用余弦相似度等度量定义“近邻”，再用ANN在大规模向量库上高效近似地找这些近邻。</p>
<h3 data-id="heading-13">完整过程</h3>
<p>在完成检索后，通常会拿到Top-K最相关的几条数据。假设用户输入的问题是“如何配置HTTPS？”，那么过程大概如下：</p>
<ol>
<li>
<p>用户提问：“如何配置HTTPS？”</p>
</li>
<li>
<p>用户问题向量化，使用和文档向量化时相同的Embedding Model</p>
</li>
<li>
<p>得到Query的向量</p>
<pre><code class="hljs language-plain" lang="plain">query_vector = [0.31, 0.48, 0.73, ..., 0.15]  // 768维
</code></pre>
</li>
<li>
<p>在向量数据库中搜索</p>
</li>
<li>
<p>计算相似度
Chroma自动计算query_vector与所有向量数据库中向量的相似度</p>
<ul>
<li>向量1: [0.23, 0.45, ...] → 相似度 0.45</li>
<li>向量2: [0.31, 0.52, ...] → 相似度 0.89 ⭐</li>
<li>向量3: [0.12, 0.34, ...] → 相似度 0.32</li>
<li>...</li>
<li>向量8234: [0.29, 0.51, ...] → 相似度 0.91 ⭐⭐</li>
<li>向量8235: [0.35, 0.48, ...] → 相似度 0.87 ⭐</li>
<li>...</li>
</ul>
</li>
<li>
<p>返回 Top-K 最相关的，假设我们设置 K=3，返回相似度最高的3个文本块</p>
<p>结果：</p>
<ol>
<li>(相似度 0.91) "4.2 HTTPS配置步骤：首先需要申请SSL证书..."</li>
<li>(相似度 0.89) "安全配置章节：HTTPS是保障网站安全的关键..."</li>
<li>(相似度 0.87) "第五章 证书管理：SSL/TLS证书的申请与部署..."</li>
</ol>
</li>
</ol>
<h2 data-id="heading-14">六、 RAG - A (Augmented)</h2>
<p>在得到Top-K相关的数据后，会把这几条结果的原始数据（每条数据的metadata中会有原始数据），和用户的Query，一起给LLM。为什么叫<strong>Augmented增强</strong>呢？</p>
<p>其实Augmented，就是一个Prompt Engineering提示词工程相关的工作，把Query和知识库中的相关数据，通过一些特殊的Prompt给到LLM，让LLM更好地回答问题。即通过清晰的结构 + 明确的指令，让模型知道该参考什么。例如，一个完整的增强后的提示词可能如下所示：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是一个技术支持助手。请根据以下参考资料回答用户问题。

<span class="hljs-section">## 参考资料</span>

<span class="hljs-section">### 文档1（相关度：91%）</span>
来源：网络安全配置手册.pdf
内容：{检索到的文本块1}

<span class="hljs-section">### 文档2（相关度：89%）</span>
来源：服务器部署指南.pdf  
内容：{检索到的文本块2}

<span class="hljs-section">### 文档3（相关度：87%）</span>
来源：证书管理文档.pdf
内容：{检索到的文本块3}

<span class="hljs-section">## 回答要求</span>
<span class="hljs-bullet">1.</span> 必须基于上述参考资料
<span class="hljs-bullet">2.</span> 如果资料不足，明确说明
<span class="hljs-bullet">3.</span> 给出具体步骤
<span class="hljs-bullet">4.</span> 标注信息来源

<span class="hljs-section">## 用户问题</span>
如何配置HTTPS？

<span class="hljs-section">## 你的回答</span>
</code></pre>
<h2 data-id="heading-15">七、 RAG - G (Generation)</h2>
<p>最后一步的Generation生成，就和平时使用LLM没什么区别了，LLM会根据提示词，来回答问题并按照指定的格式来输出内容。即：</p>
<ol>
<li>读取参考资料</li>
<li>理解用户问题</li>
<li>从资料中提取相关信息</li>
<li>组织成结构化回答</li>
<li>逐字生成输出</li>
</ol>
<p>以上面的问题为例，LLM最终生成的内容可能如下所示：</p>
<pre><code class="hljs language-markdown" lang="markdown">根据参考资料，HTTPS配置步骤如下：

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**申请SSL证书**</span>
<span class="hljs-bullet">   -</span> 可以通过Let's Encrypt获取免费证书
<span class="hljs-bullet">   -</span> 或购买商业证书（来源：证书管理文档）

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**安装证书**</span>

   sudo cp cert.pem /etc/ssl/certs/
   sudo cp key.pem /etc/ssl/private/
   ...

<span class="hljs-bullet">3.</span> ...

</code></pre>
<p>到这里，整个RAG的过程就算是结束了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b33a3d8f95d4031ac035523fdbbcd1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=xPKRa%2F9K342d4AniNIJ7YMZ%2FPf8%3D" alt="RAG流程" loading="lazy"/></p>
<h2 data-id="heading-16">八、 完整RAG过程</h2>
<p>现在把上面几个步骤结合起来：</p>
<pre><code class="hljs language-plain" lang="plain">私有的知识库
→ 文本分块Chunking
→ 向量化Embedding
→ 存储向量构建索引Indexing
→ 用户提问Query
→ 检索Retrieval
→ 增强Augmented
→ 生成Generation
</code></pre>
<p>之后就得到了最开始的这个架构示意图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d206e521d05f4c15a599196edbe8396f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=mejh1lMg2nOf%2B%2BtH4YeDth2BUn8%3D" alt="架构示意图" loading="lazy"/></p>
<h2 data-id="heading-17">九、 FAQ</h2>
<p>下面是一些常见的问题：</p>
<ol>
<li>
<p><strong>RAG和传统的全文模糊搜索有什么区别？</strong></p>
<p>传统的模糊搜索是关键词匹配的，比如</p>
<ul>
<li>用户搜索："如何做蛋糕"</li>
<li>系统匹配：只能找到包含"蛋糕"字样的文档</li>
<li>结果：❌ 找不到"烘焙教程"、"甜点制作"等相关内容</li>
</ul>
<p>而RAG最重要的一步就是把知识库做了向量化，是根据语义进行搜索的</p>
<ul>
<li>用户搜索："如何做蛋糕"</li>
<li>系统理解：用户想学习烘焙技能</li>
<li>结果：✅ 找到"烘焙教程"、"甜点制作"、"面包制作"等相关内容</li>
</ul>
</li>
<li>
<p><strong>既然RAG还是要通过构造提示词，来把参考资料放入提示词，那这和“直接在问题里把参考文档也输进去”有什么区别？</strong></p>
<p>这是因为我们要考虑成本和效率，一个知识库可能很大，成百上千个文档，数万数十万字，在实际操作的时候，要考虑到：</p>
<ul>
<li>Token限制：GPT-4 最多128K tokens ≈ 10万字，知识库无法塞进去</li>
<li>成本问题：即使能塞进去，128K tokens可能一次调用可能要几美元，成本激增</li>
<li>效率低下：LLM要读完所有无关内容</li>
<li>响应缓慢：处理海量文本需要很长时间</li>
</ul>
<p>所以RAG中R检索这一步，就是在做过滤，它的本质就是把“无限大”的知识库变成“刚刚好”的上下文</p>
</li>
<li>
<p><strong>在做向量化的时候，使用到的Embedding Model和LLM的Model有什么关联，为什么Embedding Model可以识别原始数据的语义？</strong></p>
<p>简单来讲，<strong>Embedding模型</strong>和<strong>大语言模型</strong>，他们的基础架构是相似的，但目标和训练方式不同。
两者都基于Transformer架构，即：</p>
<ul>
<li>多头自注意力机制 (Multi-Head Attention)</li>
<li>前馈神经网络 (Feed-Forward)</li>
<li>层归一化 (Layer Normalization)</li>
<li>位置编码 (Positional Encoding)</li>
</ul>
<p>但是</p>
<ul>
<li>Embedding Model：专门学习“理解和表示”，输出是向量</li>
<li>LLM：专门学习“生成文本”，输出是文字</li>
</ul>
<p>完整的Transformer可以理解为Encoder编码器 + Decoder解码器。</p>

















<table><thead><tr><th>组成</th><th>作用</th></tr></thead><tbody><tr><td>Encoder编码器</td><td>理解输入，提取特征</td></tr><tr><td>Decoder解码器</td><td>生成输出，逐字生成</td></tr></tbody></table>
<p>Embedding模型主要用的是Encoder，大语言模型主要用Decoder。</p>
<p>而Embedding模型之所以比LLM小很多（如BGE-base-zh只有400M），主要是因为它的任务相对简单（映射到向量空间），不需要生成能力，也就不需要记忆海量知识和复杂的推理能力。</p>
</li>
</ol>
<h2 data-id="heading-18">十、 小结</h2>
<p>这篇文章里，我们一起了解了一下RAG，以及这个技术如何通过外挂知识库解决大语言模型的三大局限：</p>
<ul>
<li>时效性不足（无法处理训练后新数据）</li>
<li>私有数据缺失</li>
<li>幻觉问题</li>
</ul>
<p>它的核心机制包含三个阶段：</p>
<ul>
<li>基于语义的向量化检索</li>
<li>结构化提示词增强上下文</li>
<li>以及大模型的知识整合生成</li>
</ul>
<p>这样就能实现低成本、易于维护的专业领域知识融合。相比微调方案， RAG无需训练标注数据且支持实时更新，适合用在企业知识库问答、实时政策解读这些场景里。</p>
<p>还有就是这篇文章（或者说《AI概念解惑》这个系列）更专注于概念解惑和原理解析，所以没有包含什么代码实操。</p>
<p>另外这也只是一个简单的原理解析，实际的RAG工程中可能还会包含很多其他的步骤，比如：</p>
<ul>
<li>文本分块时可能会同时使用语义分块+滑动窗口分块</li>
<li>Retrieval阶段可能不只是用向量相似度检索，会使用向量相似度+关键词（如BM25）的混合检索
<ul>
<li>为什么？因为向量相似度只对语义敏感，对关键词不敏感，比如“Python 3.12”和“Python 3.13”的向量基本相同，但是用户可能是提问具体Python版本的问题</li>
</ul>
</li>
<li>在Retrieval检索后还可能存在一个Reranking重排的步骤
<ul>
<li>对候选片段进行精细化打分和排序</li>
</ul>
</li>
<li>对于用户的问题Query可能会增加一个Query Rewriting
<ul>
<li>是为了让问题更规范，比如从一个口语化的表达到一个规范化的表达</li>
</ul>
</li>
<li>使用多路检索（Multi-Path Retrieval）、上下文压缩（Context Compression）、自我反思（Self-Reflection）等手段进行优化</li>
<li>引入RAG评分机制，对RAG的输出结果进行评估</li>
<li>...</li>
</ul>
<p>感兴趣的可以自行搜索了解。</p>
<p>希望这篇文章能帮助你理解RAG的核心原理和应用场景，如果这篇文章有什么问题，辛苦大家指正。</p>
<h2 data-id="heading-19">参考链接</h2>
<ul>
<li><a href="https://juejin.cn/post/7464756728685936694" target="_blank" title="https://juejin.cn/post/7464756728685936694">检索增强生成技术RAG：向量化与大模型的结合</a></li>
<li><a href="https://juejin.cn/post/7251903805980524581" target="_blank" title="https://juejin.cn/post/7251903805980524581">被 AI 带火的向量数据库是什么</a></li>
<li><a href="https://juejin.cn/post/7554986681502957587#heading-5" target="_blank" title="https://juejin.cn/post/7554986681502957587#heading-5">大模型系列教程：什么是RAG（检索增强生成模型）技术</a></li>
<li><a href="https://juejin.cn/post/7379831020495732773" target="_blank" title="https://juejin.cn/post/7379831020495732773">RAG-检索增强生成</a></li>
<li><a href="https://juejin.cn/post/7502279037948313651" target="_blank" title="https://juejin.cn/post/7502279037948313651">第一章：RAG 开发入门与基础概念</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F647646322" target="_blank" title="https://zhuanlan.zhihu.com/p/647646322" ref="nofollow noopener noreferrer">文本 Embedding 基本概念和应用实现原理</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweaviate.io%2Fblog%2Fdistance-metrics-in-vector-search" target="_blank" title="https://weaviate.io/blog/distance-metrics-in-vector-search" ref="nofollow noopener noreferrer">Distance Metrics in Vector Search</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdatacream.substack.com%2Fp%2Frag-explained-understanding-embeddings" target="_blank" title="https://datacream.substack.com/p/rag-explained-understanding-embeddings" ref="nofollow noopener noreferrer">RAG Explained: Understanding Embeddings, Similarity, and Retrieval</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS 相对颜色：告别 180 个颜色变量的设计系统噩梦]]></title>    <link>https://juejin.cn/post/7574045294611546147</link>    <guid>https://juejin.cn/post/7574045294611546147</guid>    <pubDate>2025-11-19T07:51:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574045294611546147" data-draft-id="7574245788948283407" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS 相对颜色：告别 180 个颜色变量的设计系统噩梦"/> <meta itemprop="keywords" content="CSS,前端"/> <meta itemprop="datePublished" content="2025-11-19T07:51:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大知闲闲i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS 相对颜色：告别 180 个颜色变量的设计系统噩梦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大知闲闲i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T07:51:30.000Z" title="Wed Nov 19 2025 07:51:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    77
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>当组件库中的颜色变量达到 180 个时，一次品牌色变更就成了前端开发的噩梦。CSS 相对颜色语法将彻底改变这一现状。</p>
</blockquote>
<h2 data-id="heading-0">一个让人沉默的现实</h2>
<p>最近在排查一个组件库的主题 BUG 时，我们发现了令人震惊的事实：这个看似成熟的设计系统中，竟然定义了 <strong>180 个颜色变量</strong>。</p>
<p>更可怕的是，每次品牌主色调整，都需要在 3 个不同的文件中同步修改 15 种深浅变化、hover 状态、透明度变体……设计同学轻描淡写的一句"主色想从偏蓝调成更紫一点"，意味着工程侧需要：</p>
<ul>
<li>
<p>手动修改 15+ 个变量</p>
</li>
<li>
<p>反复对比 hover、active 状态是否协调</p>
</li>
<li>
<p>仔细检查半透明背景是否漏改</p>
</li>
<li>
<p>确保整个颜色体系保持和谐</p>
</li>
</ul>
<p>漏改一个变量，hover 状态显得怪异；漏改两个，整套主题就开始"发脏"。</p>
<h2 data-id="heading-1">传统颜色系统的困境</h2>
<p>当前绝大多数设计系统的配色方案可以概括为：<strong>靠人肉复制的"颜色农场"</strong>。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* 主色系 */</span>
  <span class="hljs-attr">--color-primary</span>: <span class="hljs-number">#3b82f6</span>;
  <span class="hljs-attr">--color-primary-hover</span>: <span class="hljs-number">#2563eb</span>;
  <span class="hljs-attr">--color-primary-active</span>: <span class="hljs-number">#1d4ed8</span>;
  <span class="hljs-attr">--color-primary-light</span>: <span class="hljs-number">#93c5fd</span>;
  <span class="hljs-attr">--color-primary-dark</span>: <span class="hljs-number">#1e40af</span>;
  
  <span class="hljs-comment">/* 辅助色系 */</span>
  <span class="hljs-attr">--color-secondary</span>: <span class="hljs-number">#8b5cf6</span>;
  <span class="hljs-attr">--color-secondary-hover</span>: <span class="hljs-number">#7c3aed</span>;
  <span class="hljs-attr">--color-secondary-active</span>: <span class="hljs-number">#6d28d9</span>;
  
  <span class="hljs-comment">/* 继续衍生... */</span>
}
</code></pre>
<p>这种模式的痛点显而易见：</p>
<ul>
<li>
<p><strong>维护成本高</strong>：一个主色系需要十几二十个变量</p>
</li>
<li>
<p><strong>同步困难</strong>：多处定义的变量容易遗漏</p>
</li>
<li>
<p><strong>不可靠</strong>：手动调色依赖个人感觉，缺乏系统性</p>
</li>
</ul>
<h2 data-id="heading-2">CSS 相对颜色：革命性的解决方案</h2>
<p>CSS 相对颜色语法引入的 <code>from</code> 关键字，让颜色从"死值"变成"活公式"。</p>
<h3 data-id="heading-3">基础语法</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">color</span>-function(<span class="hljs-selector-tag">from</span> origin-<span class="hljs-attribute">color</span> channel1 channel2 channel3 / alpha)
</code></pre>
<p>拆解说明：</p>
<ul>
<li>
<p><code>color-function</code>：输出格式，如 <code>rgb()</code>、<code>hsl()</code>、<code>oklch()</code></p>
</li>
<li>
<p><code>from</code>：关键字符，声明颜色来源</p>
</li>
<li>
<p><code>origin-color</code>：基准颜色，支持 hex、RGB、HSL 等格式</p>
</li>
<li>
<p><code>channel1 ~ 3</code>：可访问和修改的通道值</p>
</li>
<li>
<p><code>alpha</code>：可选透明度通道</p>
</li>
</ul>
<h3 data-id="heading-4">实际应用示例</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary</span>: <span class="hljs-number">#3b82f6</span>;
}
​
<span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--primary);
}
​
<span class="hljs-selector-class">.button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-comment">/* 基于主色自动计算 hover 状态 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--primary) h s <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">10</span>));
}
</code></pre>
<p>这一行 <code>hsl(from ...)</code> 的改变，将 hover 效果从"写死"变成了"相对基色、自动联动"。从此，品牌色只需修改一个 <code>--primary</code> 变量，所有衍生状态自动跟随。</p>
<h2 data-id="heading-5">from 关键字的魔力</h2>
<p><code>from</code> 的核心作用是将颜色分解为通道值，让我们能够像搭乐高一样重新组合：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* 将绿色分解为 RGB 通道 */</span>
<span class="hljs-built_in">rgb</span>(from green r g b)  <span class="hljs-comment">/* 输出: rgb(0 128 0) */</span>
​
<span class="hljs-comment">/* 用绿色通道创建灰度 */</span>
<span class="hljs-built_in">rgb</span>(from green g g g)  <span class="hljs-comment">/* 输出: rgb(128 128 128) */</span>
​
<span class="hljs-comment">/* 随意调换通道顺序 */</span>
<span class="hljs-built_in">rgb</span>(from green b r g)  <span class="hljs-comment">/* 输出: rgb(0 0 128) */</span>
</code></pre>
<h3 data-id="heading-6">跨色彩空间转换</h3>
<p><code>from</code> 自动处理色彩空间转换，让颜色格式不再成为障碍：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* RGB 转 HSL */</span>
<span class="hljs-built_in">hsl</span>(from rgb(<span class="hljs-number">255</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>) h s l)
​
<span class="hljs-comment">/* Hex 转 OKLCH */</span>
<span class="hljs-built_in">oklch</span>(from #<span class="hljs-number">3</span>b82f6 l c h)
</code></pre>
<p>这对设计系统意义重大：源头存储格式不再重要，使用端始终使用统一的可计算空间。</p>
<h2 data-id="heading-7">calc()：颜色计算的引擎</h2>
<p>真正的威力在于将 <code>calc()</code> 与颜色通道结合：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* 变亮：提高亮度 */</span>
<span class="hljs-built_in">hsl</span>(from blue h s calc(l + <span class="hljs-number">20</span>))
​
<span class="hljs-comment">/* 变暗：降低亮度 */</span>  
<span class="hljs-built_in">hsl</span>(from blue h s calc(l - <span class="hljs-number">20</span>))
​
<span class="hljs-comment">/* 半透明：调整透明度 */</span>
<span class="hljs-built_in">rgb</span>(from blue r g b / calc(alpha * <span class="hljs-number">0.5</span>))
​
<span class="hljs-comment">/* 调色：旋转色相 */</span>
<span class="hljs-built_in">hsl</span>(from blue calc(h + <span class="hljs-number">180</span>) s l)
</code></pre>
<p>大部分颜色衍生逻辑都可以归结为：<strong>通道 + 偏移量</strong> 或 <strong>通道 × 系数</strong>。</p>
<h2 data-id="heading-8">OKLCH：更智能的色彩空间</h2>
<p>虽然 HSL 很流行，但它有个致命缺陷：<strong>亮度感知不均</strong>。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">hsl</span>(<span class="hljs-number">220</span> <span class="hljs-number">80%</span> <span class="hljs-number">50%</span>)  <span class="hljs-comment">/* 蓝色 */</span>
<span class="hljs-built_in">hsl</span>(<span class="hljs-number">120</span> <span class="hljs-number">80%</span> <span class="hljs-number">50%</span>)  <span class="hljs-comment">/* 绿色 */</span>
</code></pre>
<p>理论上两者亮度相同，但人眼感知中绿色明显更亮。OKLCH 解决了这个问题：</p>
<ul>
<li>
<p><strong>L（Lightness）</strong>：0-1，感知亮度，更符合人眼</p>
</li>
<li>
<p><strong>C（Chroma）</strong>：0-约0.37，颜色纯度</p>
</li>
<li>
<p><strong>H（Hue）</strong>：0-360，色相角度</p>
<p>oklch(0.55 0.15 260)  /* 蓝色 <em>/
oklch(0.55 0.15 140)  /</em> 绿色 */</p>
</li>
</ul>
<p>在 OKLCH 中，相同的 L 值在不同色相间具有一致的亮度感知，这让程序化调色更加可靠。</p>
<h2 data-id="heading-9">构建智能颜色系统</h2>
<h3 data-id="heading-10">第一步：定义品牌基色</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* 只用定义 4 个基础品牌色 */</span>
  <span class="hljs-attr">--brand-primary</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.55</span> <span class="hljs-number">0.2</span> <span class="hljs-number">265</span>);
  <span class="hljs-attr">--brand-success</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.65</span> <span class="hljs-number">0.18</span> <span class="hljs-number">145</span>);
  <span class="hljs-attr">--brand-error</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.6</span> <span class="hljs-number">0.25</span> <span class="hljs-number">25</span>);
  <span class="hljs-attr">--brand-warning</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.75</span> <span class="hljs-number">0.15</span> <span class="hljs-number">85</span>);
}
</code></pre>
<h3 data-id="heading-11">第二步：按规则生成完整色板</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* Primary 色系 - 全部从基色派生 */</span>
  <span class="hljs-attr">--primary</span>: <span class="hljs-built_in">var</span>(--brand-primary);
  <span class="hljs-attr">--primary-hover</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">0.1</span>) c h);
  <span class="hljs-attr">--primary-active</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">0.15</span>) c h);
  <span class="hljs-attr">--primary-light</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">0.2</span>) <span class="hljs-built_in">calc</span>(c * <span class="hljs-number">0.5</span>) h);
  <span class="hljs-attr">--primary-lighter</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">0.3</span>) <span class="hljs-built_in">calc</span>(c * <span class="hljs-number">0.3</span>) h);
  <span class="hljs-attr">--primary-alpha-10</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) l c h / <span class="hljs-number">0.1</span>);
  <span class="hljs-attr">--primary-alpha-20</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) l c h / <span class="hljs-number">0.2</span>);
  
  <span class="hljs-comment">/* 其他色系采用相同模式 */</span>
  <span class="hljs-attr">--success</span>: <span class="hljs-built_in">var</span>(--brand-success);
  <span class="hljs-attr">--success-hover</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-success) <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">0.1</span>) c h);
  <span class="hljs-attr">--success-light</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-success) <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">0.2</span>) <span class="hljs-built_in">calc</span>(c * <span class="hljs-number">0.5</span>) h);
}
</code></pre>
<p>四个基色变量，扩展出完整的颜色体系。品牌色调整时，只需修改四个基础值。</p>
<h2 data-id="heading-12">暗色模式的革命</h2>
<p>传统暗色模式需要维护两套 token，现在只需一个公式：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--surface</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.98</span> <span class="hljs-number">0.02</span> <span class="hljs-number">240</span>);
  <span class="hljs-attr">--text</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.25</span> <span class="hljs-number">0.03</span> <span class="hljs-number">240</span>);
}
​
<span class="hljs-selector-attr">[data-theme=<span class="hljs-string">"dark"</span>]</span> {
  <span class="hljs-comment">/* 亮度反转实现暗色模式 */</span>
  <span class="hljs-attr">--surface</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--surface) <span class="hljs-built_in">calc</span>(<span class="hljs-number">1</span> - l) c h);
  <span class="hljs-attr">--text</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--text) <span class="hljs-built_in">calc</span>(<span class="hljs-number">1</span> - l) c h);
}
</code></pre>
<h2 data-id="heading-13">实战高级技巧</h2>
<h3 data-id="heading-14">1. 智能阴影系统</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
  <span class="hljs-attr">--card-bg</span>: <span class="hljs-built_in">var</span>(--primary);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--card-bg);
  <span class="hljs-attribute">box-shadow</span>: 
    <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">6px</span> <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--card-bg) l c h / <span class="hljs-number">0.2</span>),
    <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--card-bg) l c h / <span class="hljs-number">0.15</span>);
}
</code></pre>
<p>阴影自动适应背景色，主题切换时自然过渡。</p>
<h3 data-id="heading-15">2. 确保可读性的文本颜色</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.tag</span> {
  <span class="hljs-attr">--tag-bg</span>: <span class="hljs-built_in">var</span>(--primary);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--tag-bg);
  <span class="hljs-comment">/* 文本亮度比背景高 0.6，确保对比度 */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--tag-bg) <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">0.6</span>) c h);
}
</code></pre>
<h3 data-id="heading-16">3. 品牌化半透明遮罩</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.modal-backdrop</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) l c h / <span class="hljs-number">0.7</span>);
}
</code></pre>
<h2 data-id="heading-17">浏览器支持与渐进增强</h2>
<p>截至 2025 年，相对颜色已获得良好支持：</p>
<ul>
<li>
<p>Chrome 119+ ✅</p>
</li>
<li>
<p>Firefox 128+ ✅</p>
</li>
<li>
<p>Safari 16.4+ ✅</p>
</li>
<li>
<p>Edge 119+ ✅</p>
</li>
</ul>
<p>覆盖率约 83%，对于不支持的环境可提供静态回退：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#2563eb</span>; <span class="hljs-comment">/* 回退值 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--primary) <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">0.1</span>) c h);
}
</code></pre>
<h2 data-id="heading-18">避坑指南</h2>
<ol>
<li>
<p><strong>避免过深派生链</strong>：从基色直接推导，最多两层</p>
</li>
<li>
<p><strong>控制 Chroma 范围</strong>：OKLCH 中 Chroma 超过 0.37 可能导致颜色溢出</p>
</li>
<li>
<p><strong>正确使用 Alpha</strong>：<code>oklch(0.6 0.2 265 / 0.5)</code> 而非 <code>oklch(0.6 0.2 265 0.5)</code></p>
</li>
</ol>
<h2 data-id="heading-19">总结：从小升级到大变革</h2>
<p>CSS 相对颜色解决的不仅是技术问题，更是设计系统维护的哲学变革：</p>
<ul>
<li>
<p><strong>主题切换不再是灾难</strong>：改一个变量，全站自洽</p>
</li>
<li>
<p><strong>颜色 Token 真正集中管理</strong>：从分散定义到统一源头</p>
</li>
<li>
<p><strong>设计规则化</strong>：深浅、状态、透明度都成为可复用的公式</p>
</li>
<li>
<p><strong>开发体验提升</strong>：从机械调色到智能推导</p>
</li>
</ul>
<p>下一次重构配色系统时，不妨尝试将基准色、状态色、暗色模式、半透明层全部交给相对颜色计算。那种"改一处，全局联动"的流畅体验，确实让人上头。</p>
<p>从 180 个颜色变量到 4 个基色变量，这不只是数量的减少，更是设计系统维护理念的质的飞跃。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SysInfoKeeper是一款面向 Linux/Unix 的硬件变动检测 CLI 工具]]></title>    <link>https://juejin.cn/post/7574619023805104166</link>    <guid>https://juejin.cn/post/7574619023805104166</guid>    <pubDate>2025-11-20T09:38:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574619023805104166" data-draft-id="7574639741149626419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SysInfoKeeper是一款面向 Linux/Unix 的硬件变动检测 CLI 工具"/> <meta itemprop="keywords" content="运维"/> <meta itemprop="datePublished" content="2025-11-20T09:38:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="泷厨logan做机器学习"/> <meta itemprop="url" content="https://juejin.cn/user/2285221467402489"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SysInfoKeeper是一款面向 Linux/Unix 的硬件变动检测 CLI 工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285221467402489/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    泷厨logan做机器学习
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:38:38.000Z" title="Thu Nov 20 2025 09:38:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>SysInfoKeeper 是一款面向 Linux/Unix 的硬件资产与漂移检测 CLI 工具。<br/>
每次执行都会采集完整的硬件快照（CPU、内存、磁盘、网卡、GPU、风扇、传感器等），与存储在 SQLite 中的历史记录比对，并将设备标记为 <strong>新增</strong>、<strong>移除</strong>、<strong>变更</strong> 或 <strong>位置调整</strong>。CLI 支持渲染丰富的终端表格、输出 JSON/YAML，也可以作为守护进程持续记录硬件事件。</p>
<p>获取：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinrchq%2Fsysinfokeeper" target="_blank" title="https://github.com/binrchq/sysinfokeeper" ref="nofollow noopener noreferrer">github.com/binrchq/sys…</a></p>
<p>图例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db8ff88bd6184962ac93ce88e7df8927~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=4Tdy0gYDZoSbJ5NbdT4DqIHMymQ%3D" alt="1763628646256.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8557aa14d4b3411cb2f940d896669bad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=5fLcjYU0AaZCLKeIwgMG%2FrlcgPw%3D" alt="1763628551735.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87661ac0fa754e98b494f1b276b32d56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=bacHYvpiPpAGSHzMrPffYJmG4%2Bg%3D" alt="1763628567628.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32624efb75e449a38125ff345a7ef4d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=yl7%2FolhIRdCOF8O21BZ11f1RtC0%3D" alt="1763628573878.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa8b9aefdece459d9e2e6dce049c8ea0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=J8sVMFWIsB4430wAQzZGcDj47So%3D" alt="1763628853755.png" loading="lazy"/></p>
<h2 data-id="heading-0">功能亮点</h2>
<ul>
<li><strong>精准的硬件发现</strong>：整合 <code>lsblk</code>、<code>udevadm</code>、<code>dmidecode</code>、<code>smartctl</code>、<code>findmnt</code>、<code>pterm</code> 等工具，统一输出每个部件的规范视图。</li>
<li><strong>磁盘基准测试</strong>：在真实挂载点上执行校准后的 <code>dd</code> 测试（避开 tmpfs），并记录读/写吞吐与 SMART 数据。</li>
<li><strong>事件追踪</strong>：快照持久化在 SQLite，比较器会标记新增/移除/迁移，并保留完整时间线，便于审计。</li>
<li><strong>留存策略</strong>：默认保存 30 天历史（可通过 <code>sinfo retention</code> 调整），过期记录可自动或手动清理。</li>
<li><strong>自动化友好</strong>：支持多种输出格式（<code>graph</code>、<code>table</code>、<code>json</code>、<code>json-line</code>、<code>yaml</code>），按硬件类型筛选，分级输出 (<code>basic</code> / <code>advanced</code> / <code>full</code>)，并附带 systemd service 与 AppImage 打包脚本。</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">.
├── cmd/sinfo/            <span class="hljs-comment"># Cobra CLI 入口（root、clean、retention 等）</span>
├── core/                 <span class="hljs-comment"># 采集器、模型、数据库层、比较器</span>
│   ├── hardware/         <span class="hljs-comment"># 快照管理、DB 存储、调度器</span>
│   ├── model/            <span class="hljs-comment"># 渲染助手与 JSON 结构体</span>
│   └── packages/         <span class="hljs-comment"># CPU / RAM / Disk / GPU / NIC 采集逻辑</span>
├── deployments/          <span class="hljs-comment"># systemd 示例</span>
├── tools/                <span class="hljs-comment"># 调用图、构建脚本</span>
├── LICENSE               <span class="hljs-comment"># 双重许可策略（AGPLv3 + 商业协议）</span>
├── LICENSE.AGPLv3        <span class="hljs-comment"># AGPLv3 正文</span>
└── LICENSE.COMMERCIAL    <span class="hljs-comment"># 商业授权摘要</span>
</code></pre>
<p>获取：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">GO111MODULE</span>=<span class="hljs-literal">on</span> go install binrc.com/sysinfokeeper/cmd/sinfo@latest
sinfo
</code></pre>
<h2 data-id="heading-1">核心命令</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinrchq%2Fsysinfokeeper%2Fblob%2Fmain%2FREADME_CN.md%23%25E6%25A0%25B8%25E5%25BF%2583%25E5%2591%25BD%25E4%25BB%25A4" target="_blank" title="https://github.com/binrchq/sysinfokeeper/blob/main/README_CN.md#%E6%A0%B8%E5%BF%83%E5%91%BD%E4%BB%A4" ref="nofollow noopener noreferrer"/></p>





























<table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>sinfo</code></td><td>采集硬件信息、输出结果并写入快照。</td></tr><tr><td><code>sinfo clean</code></td><td>清理历史记录（支持 <code>--all</code>、<code>--inactive</code>、<code>--days</code>、<code>--type</code>、<code>--dry-run</code> 等）。</td></tr><tr><td><code>sinfo retention</code></td><td>查看或修改留存天数（默认 30 天）。</td></tr><tr><td><code>sinfo --output json</code></td><td>机器可读输出。</td></tr><tr><td><code>sinfo --target cpu --target memory</code></td><td>仅采集指定硬件类型。</td></tr></tbody></table>
<p>无人值守场景可结合 cron/systemd，或使用 <code>core/hardware/scheduler.go</code> 中的调度器。</p>
<h2 data-id="heading-2">使用 <code>serve</code> 以 systemd 服务方式运行</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinrchq%2Fsysinfokeeper%2Fblob%2Fmain%2FREADME_CN.md%23%25E4%25BD%25BF%25E7%2594%25A8-serve-%25E4%25BB%25A5-systemd-%25E6%259C%258D%25E5%258A%25A1%25E6%2596%25B9%25E5%25BC%258F%25E8%25BF%2590%25E8%25A1%258C" target="_blank" title="https://github.com/binrchq/sysinfokeeper/blob/main/README_CN.md#%E4%BD%BF%E7%94%A8-serve-%E4%BB%A5-systemd-%E6%9C%8D%E5%8A%A1%E6%96%B9%E5%BC%8F%E8%BF%90%E8%A1%8C" ref="nofollow noopener noreferrer"/></p>
<p>仓库中已经提供了参考配置 <code>deployments/sinfo.service</code>。可将其复制到 <code>/etc/systemd/system/</code> 并按需修改，用于长时间运行 <code>sinfo serve</code> 调度任务：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Unit]</span>
<span class="hljs-attr">Description</span>=SysInfoKeeper Hardware Monitoring Service
<span class="hljs-attr">After</span>=network-<span class="hljs-literal">on</span>line.target
<span class="hljs-attr">Wants</span>=network-<span class="hljs-literal">on</span>line.target

<span class="hljs-section">[Service]</span>
<span class="hljs-attr">Type</span>=simple
<span class="hljs-attr">User</span>=sysinfokeeper
<span class="hljs-attr">Group</span>=sysinfokeeper
<span class="hljs-attr">WorkingDirectory</span>=/var/lib/sysinfokeeper
<span class="hljs-attr">Environment</span>=SINFO_INTERVAL=<span class="hljs-number">3600</span>
<span class="hljs-attr">Environment</span>=SINFO_RETENTION=<span class="hljs-number">30</span>
<span class="hljs-attr">Environment</span>=SINFO_SPEED_TEST=low
<span class="hljs-attr">EnvironmentFile</span>=-/etc/sysinfokeeper.env
<span class="hljs-attr">ExecStart</span>=/usr/local/bin/sinfo serve \
  --interval $SINFO_INTERVAL \
  --retention $SINFO_RETENTION \
  --speed-test $SINFO_SPEED_TEST
<span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure

<span class="hljs-section">[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target
</code></pre>
<p>可以通过环境变量或 <code>/etc/sysinfokeeper.env</code> 覆盖 <code>interval</code>、<code>retention</code>、<code>speed-test</code> 等参数。<code>sinfo serve</code> 将常驻运行，不断采集并写入快照直至服务停止。</p>
<h2 data-id="heading-3">参与贡献</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinrchq%2Fsysinfokeeper%2Fblob%2Fmain%2FREADME_CN.md%23%25E5%258F%2582%25E4%25B8%258E%25E8%25B4%25A1%25E7%258C%25AE" target="_blank" title="https://github.com/binrchq/sysinfokeeper/blob/main/README_CN.md#%E5%8F%82%E4%B8%8E%E8%B4%A1%E7%8C%AE" ref="nofollow noopener noreferrer"/></p>
<ol>
<li>Fork &amp; Clone 仓库。</li>
<li>开启 Go Modules（<code>GO111MODULE=on</code>）。</li>
<li>提交前请 <code>gofmt</code>/<code>goimports</code>，并运行 lint / test。</li>
<li>提交 Issue 时请尽量描述硬件环境（内核、发行版、存储拓扑、RAID 等）。</li>
</ol>
<p>贡献默认遵循本项目的双重许可方案（见下文）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决 XXL-Job 定时任务时间偏差8小时的问题]]></title>    <link>https://juejin.cn/post/7573957755369160714</link>    <guid>https://juejin.cn/post/7573957755369160714</guid>    <pubDate>2025-11-19T03:23:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573957755369160714" data-draft-id="7567309723478442036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决 XXL-Job 定时任务时间偏差8小时的问题"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-19T03:23:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决 XXL-Job 定时任务时间偏差8小时的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T03:23:45.000Z" title="Wed Nov 19 2025 03:23:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是大华！</p>
<p>最近把XXL-Job定时任务迁移到新服务器时，遇到了一个让人困惑的问题：任务设置在上午10点执行，但执行调度和执行却显示晚上18点。经过排查，发现问题根源是<strong>A服务器的时间少了8个小时</strong>！</p>
<p>所有任务执行时间都多了8小时，如图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff86a6fa1ff54003896609007d04da3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764127425&amp;x-signature=DCsLc9FZuFnLHRP3HaCPvTtPNp4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">问题分析</h2>
<h3 data-id="heading-1">执行时间线</h3>
<p><strong>1.我设置的时间</strong>：10:00（我以为的北京时间）
<strong>2.A服务器理解的时间</strong>：10:00 UTC（相当于北京时间18:00）
<strong>3.触发任务</strong>：A服务器在UTC时间10:00向B服务器发送请求
<strong>4.B服务器接收时刻</strong>：北京时间18:00（UTC 10:00 + 8小时）
<strong>5.执行任务</strong>：北京时间18:00</p>
<h2 data-id="heading-2">解决方案：修复A服务器时间</h2>
<h3 data-id="heading-3">第一步：检查B服务器时区配置</h3>
<p>登录B服务器，执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看当前时间和时区</span>
<span class="hljs-built_in">date</span>
timedatectl

<span class="hljs-comment"># 预期正确输出（北京时间）：</span>
<span class="hljs-comment"># Wed May 15 10:00:00 CST 2024</span>

<span class="hljs-comment"># 错误输出示例：</span>
<span class="hljs-comment"># Wed May 15 02:00:00 UTC 2024</span>
</code></pre>
<h3 data-id="heading-4">第二步：修正B服务器时区</h3>
<p><strong>CentOS/RedHat系统：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置时区为上海</span>
timedatectl set-timezone Asia/Shanghai

<span class="hljs-comment"># 验证设置</span>
<span class="hljs-built_in">date</span>
</code></pre>
<p><strong>Ubuntu/Debian系统：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 交互式设置时区</span>
sudo dpkg-reconfigure tzdata
<span class="hljs-comment"># 选择 Asia -&gt; Shanghai</span>
</code></pre>
<h3 data-id="heading-5">第三步：确保时间同步</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装并配置NTP时间同步</span>
yum install -y ntp  <span class="hljs-comment"># CentOS</span>
sudo apt-get update  <span class="hljs-comment"># Ubuntu</span>

<span class="hljs-comment"># 验证当前时间状态</span>
timedatectl status
<span class="hljs-comment"># 确认为Time zone: Asia/Shanghai (CST, +0800)</span>
</code></pre>
<h3 data-id="heading-6">第四步：验证B服务器配置</h3>
<p>虽然问题主要出在A服务器，但确保环境一致性很重要：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在A服务器上也执行同样的检查</span>
<span class="hljs-built_in">date</span>
timedatectl
</code></pre>
<p>确保B服务器也使用 <code>Asia/Shanghai</code> 时区。</p>
<h4 data-id="heading-7">最后一定要记得重启定时任务。</h4>
<h2 data-id="heading-8">在XXL-Job管理界面中确认</h2>
<p>登录XXL-Job Admin管理后台，查看调度日志：</p>
<p><strong>1.调度时间</strong>：反映A服务器（调度中心）的触发时间
<strong>2.执行时间</strong>：来自B服务器（执行器）上报的时间</p>
<p>修复前后对比：
<strong>修复前</strong>：调度时间 10:00，执行时间 18:00
<strong>修复后</strong>：调度时间 10:00，执行时间 10:00</p>
<h2 data-id="heading-9">实践建议</h2>
<p><strong>1.环境标准化</strong></p>
<ul>
<li>所有服务器统一使用 <code>Asia/Shanghai</code> 时区</li>
<li>使用相同的时间同步服务</li>
</ul>
<p><strong>2.日志规范</strong></p>
<ul>
<li>在业务日志中明确输出时区信息</li>
<li>考虑使用UTC时间存储日志，展示时按需转换</li>
</ul>
<h2 data-id="heading-10">总结</h2>
<p>这个问题本质上是一个环境配置一致性问题。在分布式系统中，时间一致性是经常被忽视却又至关重要的基础配置。
<code>XXL-Job</code>作为一个优秀的分布式任务调度框架，其本身的时间机制是清晰的，问题往往出现在环境配置层面。</p>
<p>下次当你发现定时任务执行时间对不上时，首先检查服务器的时区和时间同步配置，这可能会为你节省大量的排查时间。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<p><strong>📌 扩展阅读：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F72THiVPtsrA2xvtHmdDLmA" target="_blank" title="https://mp.weixin.qq.com/s/72THiVPtsrA2xvtHmdDLmA" ref="nofollow noopener noreferrer">《SpringBoot+Vue3 整合 SSE 实现实时消息推送》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FP7SMincYFKERZbNKAFtzGQ" target="_blank" title="https://mp.weixin.qq.com/s/P7SMincYFKERZbNKAFtzGQ" ref="nofollow noopener noreferrer">《这20条SQL优化方案，让你的数据库查询速度提升10倍》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FgQK9L1TxKL50FUVMcgh6JQ" target="_blank" title="https://mp.weixin.qq.com/s/gQK9L1TxKL50FUVMcgh6JQ" ref="nofollow noopener noreferrer">《SpringBoot 动态菜单权限系统设计的企业级解决方案》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fn1DqvgnDTFzpv9hJaudQeA" target="_blank" title="https://mp.weixin.qq.com/s/n1DqvgnDTFzpv9hJaudQeA" ref="nofollow noopener noreferrer">《Vue3 + ElementPlus 动态菜单实现：一套代码完美适配多角色权限系统》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>