<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[剑指offer-57、二叉树的下一个节点]]></title>    <link>https://juejin.cn/post/7589494074982891571</link>    <guid>https://juejin.cn/post/7589494074982891571</guid>    <pubDate>2025-12-31T01:10:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494074982891571" data-draft-id="7588146449006182436" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 剑指offer-57、二叉树的下一个节点"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-31T01:10:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             剑指offer-57、二叉树的下一个节点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T01:10:53.000Z" title="Wed Dec 31 2025 01:10:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">题⽬描述</h2>
<p>给定⼀个⼆叉树和其中的⼀个结点，请找出中序遍历顺序的下⼀个结点并且返回。注意，树中的结点不仅包含左右⼦结点，同时包含指向⽗结点的指针。</p>
<p>复杂的节点结构如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeLinkNode</span> {
	<span class="hljs-type">int</span> val;
	<span class="hljs-type">TreeLinkNode</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
	<span class="hljs-type">TreeLinkNode</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
	<span class="hljs-type">TreeLinkNode</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
	
	TreeLinkNode(<span class="hljs-type">int</span> val) {
		<span class="hljs-built_in">this</span>.val = val;
	}
}
</code></pre>
<h2 data-id="heading-1">思路及解答</h2>
<h3 data-id="heading-2">中序遍历</h3>
<p>先找到根节点，然后通过根节点，中序遍历，中序遍历的过程中，对⽐节点，是否等于输⼊的节点，然后获取下⼀个节点放回。注意没有下⼀个节点的时候，应该返回 null ，不能数组越界。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;TreeLinkNode&gt; treeLinkNodes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
	
	<span class="hljs-keyword">public</span> TreeLinkNode <span class="hljs-title function_">GetNext</span><span class="hljs-params">(TreeLinkNode pNode)</span> {
		<span class="hljs-keyword">if</span> (pNode != <span class="hljs-literal">null</span>) {
			<span class="hljs-type">TreeLinkNode</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> pNode;
			<span class="hljs-comment">// ⼀直找到根节点</span>
			<span class="hljs-keyword">while</span> (root != <span class="hljs-literal">null</span> &amp;&amp; root.next != <span class="hljs-literal">null</span>) {
				root = root.next;
			}
			
			inOrder(root);
			
			<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; treeLinkNodes.size(); i++) {
				<span class="hljs-keyword">if</span> (treeLinkNodes.get(i) == pNode) {
					<span class="hljs-keyword">return</span> i + <span class="hljs-number">1</span> &lt; treeLinkNodes.size() ? treeLinkNodes.get(i + <span class="hljs-number">1</span>) : <span class="hljs-literal">null</span>;
				}
			}
		}
		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
	}
	
	<span class="hljs-comment">// 中序遍历</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inOrder</span><span class="hljs-params">(TreeLinkNode pNode)</span> {
		<span class="hljs-keyword">if</span> (pNode != <span class="hljs-literal">null</span>) {
			inOrder(pNode.left);
			treeLinkNodes.add(pNode);
			inOrder(pNode.right);
		}
	}
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(n)。需要遍历整棵树（O(n)）并在列表中查找节点（最坏O(n)）。</li>
<li><strong>空间复杂度</strong>：O(n)。</li>
</ul>
<h3 data-id="heading-3">不借助额外的空间(推荐)</h3>
<p>据中序遍历的顺序规则和节点的位置关系，通过指针操作直接定位。</p>
<p><strong>核心思路</strong>：中序遍历的顺序是“左-根-右”。给定节点的“下一个节点”取决于它自己的位置情况</p>
<p>分为⼏种情况讨论：</p>
<ul>
<li>当前节点为空，直接返回空</li>
<li>当前节点不为空：
<ul>
<li>如果当前节点的右节点不为空，那么下⼀个节点就是右节点的最左⼦孙节点。</li>
<li>如果当前节点的右节点为空，那么只能到⽗节点：
<ul>
<li>需要判断当前节点是不是⽗节点的左节点，如果是⽗节点的左节点，那么下⼀个节点就是⽗节点。</li>
<li>如果当前节点不是⽗节点的左节点，那么就是⽗节点的右节点，也就是下⼀个节点应该是⽗节点的⽗节点，或者更上⼀层。这个怎么判断呢？根据当前节点是不是右节点来判断，如果是右节点，则还需要往⽗节点的上⾛⼀层，如果不是右节点，则直接放回⽗节点。</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> TreeLinkNode <span class="hljs-title function_">GetNext</span><span class="hljs-params">(TreeLinkNode pNode)</span> {
	<span class="hljs-comment">// 右节点不为空，直接找右节点的最左⼦孙节点</span>
	<span class="hljs-keyword">if</span> (pNode.right != <span class="hljs-literal">null</span>) {
		<span class="hljs-type">TreeLinkNode</span> <span class="hljs-variable">pRight</span> <span class="hljs-operator">=</span> pNode.right;
		<span class="hljs-keyword">while</span> (pRight.left != <span class="hljs-literal">null</span>) {
			pRight = pRight.left;
		}
		<span class="hljs-keyword">return</span> pRight;
	}
	
	<span class="hljs-comment">// 右节点为空，但是当前节点是左节点，下⼀个就是其⽗节点</span>
	<span class="hljs-keyword">if</span> (pNode.next != <span class="hljs-literal">null</span> &amp;&amp; pNode.next.left == pNode) {
		<span class="hljs-keyword">return</span> pNode.next;
	}
		
	<span class="hljs-comment">// 3.右节点为空，并且当前节点是右节点，那只能往上⾛</span>
	<span class="hljs-keyword">if</span> (pNode.next != <span class="hljs-literal">null</span>) {
		<span class="hljs-comment">// 获取⽗节点</span>
		<span class="hljs-type">TreeLinkNode</span> <span class="hljs-variable">pNext</span> <span class="hljs-operator">=</span> pNode.next;
		<span class="hljs-comment">// 判断⽗节点是不是同样是右节点，如果是，还需要往上⾛，如果不是，就可以直接放回其</span>
		<span class="hljs-keyword">while</span> (pNext.next != <span class="hljs-literal">null</span> &amp;&amp; pNext.next.right == pNext) {
			pNext = pNext.next;
		}
		<span class="hljs-keyword">return</span> pNext.next;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<ul>
<li><strong>时间复杂度</strong>：O(k)。<code>k</code>是到后继节点的路径长度，最坏情况为树高O(h)，通常远小于n。</li>
<li><strong>空间复杂度</strong>：O(1)。只使用了固定数量的指针。</li>
</ul>
<p>为了更直观地理解这两种情况，我们可以看一个例子。下图中，节点 <code>5</code>的下一个节点是 <code>6</code>（对应情况1，找右子树的最左节点），节点 <code>7</code>的下一个节点是 <code>8</code>（对应情况2，向上找到第一个作为左子节点的祖先节点的父节点）。</p>
<pre><code class="hljs language-java" lang="java">	  <span class="hljs-number">8</span>
     / \
    <span class="hljs-number">6</span>   <span class="hljs-number">10</span>
   / \  / \
  <span class="hljs-number">5</span>  <span class="hljs-number">7</span> <span class="hljs-number">9</span>  <span class="hljs-number">11</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[高德地图与Three.js结合实现3D大屏可视化]]></title>    <link>https://juejin.cn/post/7589482741759819803</link>    <guid>https://juejin.cn/post/7589482741759819803</guid>    <pubDate>2025-12-31T01:17:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589482741759819803" data-draft-id="7585468725333147702" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="高德地图与Three.js结合实现3D大屏可视化"/> <meta itemprop="keywords" content="前端,数据可视化"/> <meta itemprop="datePublished" content="2025-12-31T01:17:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孙_华鹏"/> <meta itemprop="url" content="https://juejin.cn/user/1099167360886078"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            高德地图与Three.js结合实现3D大屏可视化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167360886078/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孙_华鹏
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T01:17:44.000Z" title="Wed Dec 31 2025 01:17:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">高德地图与Three.js结合实现3D大屏可视化</h2>
<blockquote>
<p>文末源码地址及视频演示</p>
</blockquote>
<h3 data-id="heading-1">前言</h3>
<p>在智慧城市安全管理场景中，如何将真实的地理信息与3D模型完美结合，实现沉浸式的可视化监控体验？本文将以巡逻犬管理系统的大屏预览功能为例，详细介绍如何通过高德地图API与Three.js深度结合，实现3D机械狗模型在地图上的实时巡逻展示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d90f127947354a4db3812200254d99f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=nYtHQVSEXuPfvfPMLDbOGpIM4Mw%3D" alt="1 整体效果 全屏展示.png" loading="lazy"/></p>
<p>该系统实现了以下核心功能：</p>
<ul>
<li>在高德地图上加载并渲染3D机械狗模型</li>
<li>实现模型沿预设路线的自动巡逻动画</li>
<li>镜头自动跟随模型移动，提供沉浸式监控体验</li>
<li>实时显示巡逻进度、告警信息等业务数据</li>
</ul>
<h3 data-id="heading-2">技术栈</h3>
<ul>
<li><strong>高德地图 JS API 2.0</strong>：提供地图底图和空间定位能力</li>
<li><strong>Three.js r157</strong>：3D模型渲染和动画控制</li>
<li><strong>Loca 2.0</strong>：高德地图数据可视化API，用于镜头跟随</li>
<li><strong>React + TypeScript</strong>：前端框架和类型支持</li>
<li><strong>TWEEN.js</strong>：补间动画库，用于平滑的模型移动</li>
</ul>
<h3 data-id="heading-3">一、高德地图初始化</h3>
<h4 data-id="heading-4">1.1 地图配置</h4>
<p>首先需要配置高德地图的加载参数，包括API Key、版本号等：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils/amapConfig.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> mapConfig = {
  <span class="hljs-attr">key</span>: <span class="hljs-string">'your-amap-key'</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0'</span>,
  <span class="hljs-title class_">Loca</span>: {
    <span class="hljs-attr">version</span>: <span class="hljs-string">'2.0.0'</span>,  <span class="hljs-comment">// Loca版本需与地图版本一致</span>
  },
};

<span class="hljs-comment">// 初始化安全配置（必须在AMapLoader.load之前调用）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">initAmapSecurity</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
    (<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_AMapSecurityConfig</span> = {
      <span class="hljs-attr">securityJsCode</span>: <span class="hljs-string">'your-security-code'</span>,
    };
  }
};
</code></pre>
<h4 data-id="heading-5">1.2 创建地图实例</h4>
<p>使用<code>AMapLoader.load</code>加载地图API，然后创建地图实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 设置安全密钥</span>
<span class="hljs-title function_">initAmapSecurity</span>();

<span class="hljs-comment">// 加载高德地图</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AMap</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AMapLoader</span>.<span class="hljs-title function_">load</span>(mapConfig);

<span class="hljs-comment">// 创建地图实例，开启3D视图模式</span>
<span class="hljs-keyword">const</span> mapInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">Map</span>(mapContainerRef.<span class="hljs-property">current</span>, {
  <span class="hljs-attr">zoom</span>: <span class="hljs-number">13</span>,
  <span class="hljs-attr">center</span>: defaultCenter,
  <span class="hljs-attr">viewMode</span>: <span class="hljs-string">'3D'</span>,  <span class="hljs-comment">// 关键：必须开启3D模式</span>
  <span class="hljs-attr">resizeEnable</span>: <span class="hljs-literal">true</span>,
});
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4989b56a6e44b00a72b24581b63902a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=gnACNSyLHuNPMoy%2B%2F%2Bp1CONWjbA%3D" alt="2 渲染高德地图日志.png" loading="lazy"/></p>
<p><strong>关键点</strong>：</p>
<ul>
<li><code>viewMode: '3D'</code> 必须设置，否则无法使用3D相关功能</li>
<li>需要提前设置安全密钥，否则会报错</li>
</ul>
<h4 data-id="heading-6">1.3 初始化Loca容器</h4>
<p>Loca是高德地图的数据可视化容器，用于实现镜头跟随等功能：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> loca = <span class="hljs-keyword">new</span> (<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">Loca</span>.<span class="hljs-title class_">Container</span>({
  <span class="hljs-attr">map</span>: mapInstance,
  <span class="hljs-attr">zIndex</span>: <span class="hljs-number">9</span>
});
</code></pre>
<h3 data-id="heading-7">二、创建GLCustomLayer自定义图层</h3>
<p><code>GLCustomLayer</code>是高德地图提供的WebGL自定义图层，允许我们在地图上渲染Three.js内容。</p>
<h4 data-id="heading-8">2.1 图层结构</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> customLayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AMap</span>.<span class="hljs-title class_">GLCustomLayer</span>({
  <span class="hljs-attr">zIndex</span>: <span class="hljs-number">200</span>,  <span class="hljs-comment">// 图层层级，确保模型在最上层</span>
  <span class="hljs-attr">init</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">gl</span>: <span class="hljs-built_in">any</span>) =&gt; {
    <span class="hljs-comment">// 在这里初始化Three.js场景、相机、渲染器等</span>
  },
  <span class="hljs-attr">render</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 在这里执行每帧的渲染逻辑</span>
  },
});

mapInstance.<span class="hljs-title function_">add</span>(customLayer);
</code></pre>
<h4 data-id="heading-9">2.2 初始化Three.js场景</h4>
<p>在<code>init</code>方法中创建Three.js的核心组件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">init</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">gl</span>: <span class="hljs-built_in">any</span>) =&gt; {
  <span class="hljs-comment">// 1. 创建透视相机</span>
  <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
    <span class="hljs-number">60</span>,  <span class="hljs-comment">// 视野角度</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>,  <span class="hljs-comment">// 宽高比</span>
    <span class="hljs-number">100</span>,  <span class="hljs-comment">// 近裁剪面</span>
    <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>  <span class="hljs-comment">// 远裁剪面（使用位运算表示大数值）</span>
  );
  
  <span class="hljs-comment">// 2. 创建WebGL渲染器</span>
  <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({
    <span class="hljs-attr">context</span>: gl,  <span class="hljs-comment">// 使用地图提供的WebGL上下文</span>
    <span class="hljs-attr">antialias</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// 禁用抗锯齿，减少WebGL扩展需求</span>
    <span class="hljs-attr">powerPreference</span>: <span class="hljs-string">'default'</span>,
  });
  renderer.<span class="hljs-property">autoClear</span> = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 必须设置为false，否则地图底图无法显示</span>
  renderer.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">false</span>;  <span class="hljs-comment">// 禁用阴影，避免WebGL扩展问题</span>
  
  <span class="hljs-comment">// 3. 创建场景</span>
  <span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
  
  <span class="hljs-comment">// 4. 添加光源</span>
  <span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1.0</span>);
  scene.<span class="hljs-title function_">add</span>(ambientLight);
  
  <span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">1.2</span>);
  directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1000</span>, -<span class="hljs-number">100</span>, <span class="hljs-number">900</span>);
  scene.<span class="hljs-title function_">add</span>(directionalLight);
}
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li><code>renderer.autoClear = false</code> 必须设置，否则会清除地图底图</li>
<li>使用地图提供的<code>gl</code>上下文创建渲染器，实现资源共享</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8fb12a6f0c54f1fa56903f8366ed794~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=WMdU80jLFfrvn%2BHx695ayIaq7L0%3D" alt="3 坐标轴辅助线.png" loading="lazy"/></p>
<h3 data-id="heading-10">三、坐标系统转换</h3>
<p>高德地图使用经纬度坐标（WGS84），而Three.js使用3D世界坐标，两者之间的转换是关键。</p>
<h4 data-id="heading-11">3.1 获取自定义坐标系统</h4>
<p>地图实例提供了<code>customCoords</code>工具，用于坐标转换：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 获取自定义坐标系统</span>
<span class="hljs-keyword">const</span> customCoords = mapInstance.<span class="hljs-property">customCoords</span>;

<span class="hljs-comment">// 设置坐标系统中心点（重要：必须在设置模型位置前设置）</span>
<span class="hljs-keyword">const</span> center = mapInstance.<span class="hljs-title function_">getCenter</span>();
customCoords.<span class="hljs-title function_">setCenter</span>([center.<span class="hljs-property">lng</span>, center.<span class="hljs-property">lat</span>]);
</code></pre>
<h4 data-id="heading-12">3.2 经纬度转3D坐标</h4>
<p>使用<code>lngLatsToCoords</code>方法将经纬度转换为Three.js坐标：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 将经纬度 [lng, lat] 转换为Three.js坐标 [x, z, y?]</span>
<span class="hljs-keyword">const</span> position = customCoords.<span class="hljs-title function_">lngLatsToCoords</span>([
  [<span class="hljs-number">120.188767</span>, <span class="hljs-number">30.193832</span>]
])[<span class="hljs-number">0</span>];

<span class="hljs-comment">// 注意：返回的数组格式为 [x, z, y?]</span>
<span class="hljs-comment">// position[0] 对应 Three.js 的 z 轴（纬度）</span>
<span class="hljs-comment">// position[1] 对应 Three.js 的 x 轴（经度）</span>
<span class="hljs-comment">// position[2] 对应 Three.js 的 y 轴（高度，可选）</span>

robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setX</span>(position[<span class="hljs-number">1</span>]);  <span class="hljs-comment">// x坐标（经度）</span>
robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setZ</span>(position[<span class="hljs-number">0</span>]);  <span class="hljs-comment">// z坐标（纬度）</span>
robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setY</span>(position.<span class="hljs-property">length</span> &gt; <span class="hljs-number">2</span> ? position[<span class="hljs-number">2</span>] : <span class="hljs-number">0</span>);  <span class="hljs-comment">// y坐标（高度）</span>
</code></pre>
<p><strong>坐标轴对应关系</strong>：</p>
<ul>
<li>高德地图：X轴（经度），Y轴（纬度），Z轴（高度）</li>
<li>Three.js：X轴（右），Y轴（上），Z轴（前）</li>
<li>转换后：<code>position[1]</code> → Three.js X轴，<code>position[0]</code> → Three.js Z轴</li>
</ul>
<h4 data-id="heading-13">3.3 同步相机参数</h4>
<p>在<code>render</code>方法中，需要同步高德地图的相机参数到Three.js相机：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">render</span>: <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> { near, far, fov, up, lookAt, position } = customCoords.<span class="hljs-title function_">getCameraParams</span>();
  
  <span class="hljs-comment">// 同步相机参数</span>
  camera.<span class="hljs-property">near</span> = near;
  camera.<span class="hljs-property">far</span> = far;
  camera.<span class="hljs-property">fov</span> = fov;
  camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(position[<span class="hljs-number">0</span>], position[<span class="hljs-number">1</span>], position[<span class="hljs-number">2</span>]);
  camera.<span class="hljs-property">up</span>.<span class="hljs-title function_">set</span>(up[<span class="hljs-number">0</span>], up[<span class="hljs-number">1</span>], up[<span class="hljs-number">2</span>]);
  camera.<span class="hljs-title function_">lookAt</span>(lookAt[<span class="hljs-number">0</span>], lookAt[<span class="hljs-number">1</span>], lookAt[<span class="hljs-number">2</span>]);
  camera.<span class="hljs-title function_">updateProjectionMatrix</span>();
  
  <span class="hljs-comment">// 渲染场景</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
  
  <span class="hljs-comment">// 必须执行：重新设置three的gl上下文状态</span>
  renderer.<span class="hljs-title function_">resetState</span>();
}
</code></pre>
<h3 data-id="heading-14">四、加载3D模型</h3>
<h4 data-id="heading-15">4.1 使用GLTFLoader加载模型</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/loaders/GLTFLoader'</span>;

<span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
<span class="hljs-keyword">const</span> modelPath = <span class="hljs-string">'/assets/modules/robot_dog/scene.gltf'</span>;

<span class="hljs-keyword">const</span> gltf = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  loader.<span class="hljs-title function_">load</span>(
    modelPath,
    <span class="hljs-function">(<span class="hljs-params">gltf: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-title function_">resolve</span>(gltf),
    <span class="hljs-function">(<span class="hljs-params">progress: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (progress.<span class="hljs-property">total</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> percent = (progress.<span class="hljs-property">loaded</span> / progress.<span class="hljs-property">total</span>) * <span class="hljs-number">100</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'模型加载进度:'</span>, percent.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'%'</span>);
      }
    },
    reject
  );
});

<span class="hljs-keyword">const</span> robotModel = gltf.<span class="hljs-property">scene</span>;
</code></pre>
<h4 data-id="heading-16">4.2 模型预处理</h4>
<p>加载模型后需要进行预处理，包括材质优化、位置调整等：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 遍历模型所有子对象</span>
robotModel.<span class="hljs-title function_">traverse</span>(<span class="hljs-function">(<span class="hljs-params">child: THREE.Object3D</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (child <span class="hljs-keyword">instanceof</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Mesh</span>) {
    <span class="hljs-comment">// 禁用阴影相关功能</span>
    child.<span class="hljs-property">castShadow</span> = <span class="hljs-literal">false</span>;
    child.<span class="hljs-property">receiveShadow</span> = <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 简化材质，避免使用需要WebGL扩展的高级特性</span>
    <span class="hljs-keyword">if</span> (child.<span class="hljs-property">material</span>) {
      <span class="hljs-keyword">const</span> materials = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(child.<span class="hljs-property">material</span>) 
        ? child.<span class="hljs-property">material</span> 
        : [child.<span class="hljs-property">material</span>];
      
      materials.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">mat: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
        <span class="hljs-comment">// 禁用transmission等高级特性</span>
        <span class="hljs-keyword">if</span> (mat.<span class="hljs-property">transmission</span> !== <span class="hljs-literal">undefined</span>) {
          mat.<span class="hljs-property">transmission</span> = <span class="hljs-number">0</span>;
        }
      });
    }
  }
});

<span class="hljs-comment">// 计算模型边界框并居中</span>
<span class="hljs-keyword">const</span> box = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Box3</span>().<span class="hljs-title function_">setFromObject</span>(robotModel);
<span class="hljs-keyword">const</span> center = box.<span class="hljs-title function_">getCenter</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>());

<span class="hljs-comment">// 将模型居中（X和Z轴）</span>
robotModel.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = -center.<span class="hljs-property">x</span>;
robotModel.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = -center.<span class="hljs-property">z</span>;
<span class="hljs-comment">// 将模型底部放在y=0</span>
robotModel.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = -box.<span class="hljs-property">min</span>.<span class="hljs-property">y</span>;

<span class="hljs-comment">// 设置模型缩放</span>
<span class="hljs-keyword">const</span> scale = <span class="hljs-number">15</span>;
robotModel.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(scale, scale, scale);
</code></pre>
<h4 data-id="heading-17">4.3 创建模型组并设置初始旋转</h4>
<p>由于高德地图和Three.js的坐标系差异，需要调整模型的初始旋转：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 创建外层Group用于位置和旋转控制</span>
<span class="hljs-keyword">const</span> robotGroup = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>();
robotGroup.<span class="hljs-title function_">add</span>(robotModel);

<span class="hljs-comment">// 设置初始旋转（90, 90, 0）度转换为弧度</span>
<span class="hljs-keyword">const</span> initialRotationX = (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">90</span>;
<span class="hljs-keyword">const</span> initialRotationY = (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">90</span>;
<span class="hljs-keyword">const</span> initialRotationZ = (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">0</span>;
robotGroup.<span class="hljs-property">rotation</span>.<span class="hljs-title function_">set</span>(initialRotationX, initialRotationY, initialRotationZ);

scene.<span class="hljs-title function_">add</span>(robotGroup);
</code></pre>
<h3 data-id="heading-18">五、实现镜头跟随</h3>
<h4 data-id="heading-19">5.1 使用Loca实现镜头跟随</h4>
<p>高德地图的Loca API提供了<code>viewControl.addTrackAnimate</code>方法，可以实现镜头自动跟随路径移动：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 计算路径总距离</span>
<span class="hljs-keyword">let</span> totalDistance = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; paths.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) {
  totalDistance += <span class="hljs-title class_">AMap</span>.<span class="hljs-property">GeometryUtil</span>.<span class="hljs-title function_">distance</span>(paths[i], paths[i + <span class="hljs-number">1</span>]);
}

<span class="hljs-comment">// 假设速度是 1.5 m/s</span>
<span class="hljs-keyword">const</span> speed = <span class="hljs-number">1.5</span>;
<span class="hljs-keyword">const</span> duration = (totalDistance / speed) * <span class="hljs-number">1000</span>;  <span class="hljs-comment">// 转换为毫秒</span>

loca.<span class="hljs-property">viewControl</span>.<span class="hljs-title function_">addTrackAnimate</span>({
  <span class="hljs-attr">path</span>: paths,  <span class="hljs-comment">// 镜头轨迹，二维数组</span>
  <span class="hljs-attr">duration</span>: duration,  <span class="hljs-comment">// 时长（毫秒）</span>
  <span class="hljs-attr">timing</span>: [[<span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">0.7</span>]],  <span class="hljs-comment">// 速率控制器</span>
  <span class="hljs-attr">rotationSpeed</span>: <span class="hljs-number">180</span>,  <span class="hljs-comment">// 每秒旋转多少度</span>
}, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'单程巡逻完成'</span>);
  <span class="hljs-comment">// 可以在这里处理往返逻辑</span>
});

loca.<span class="hljs-property">animate</span>.<span class="hljs-title function_">start</span>();  <span class="hljs-comment">// 启动动画</span>
</code></pre>
<h4 data-id="heading-20">5.2 模型位置同步</h4>
<p>在<code>render</code>方法中，根据地图中心点实时更新模型位置：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">render</span>: <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ... 同步相机参数代码 ...</span>
  
  <span class="hljs-keyword">if</span> (robotGroup &amp;&amp; mapInstance &amp;&amp; !patrolFinishedRef.<span class="hljs-property">current</span>) {
    <span class="hljs-comment">// 获取当前地图中心（镜头跟随会改变地图中心）</span>
    <span class="hljs-keyword">const</span> center = mapInstance.<span class="hljs-title function_">getCenter</span>();
    <span class="hljs-keyword">if</span> (center) {
      <span class="hljs-comment">// 更新坐标系统中心点为地图中心点</span>
      customCoords.<span class="hljs-title function_">setCenter</span>([center.<span class="hljs-property">lng</span>, center.<span class="hljs-property">lat</span>]);
      
      <span class="hljs-comment">// 将地图中心转换为Three.js坐标</span>
      <span class="hljs-keyword">const</span> position = customCoords.<span class="hljs-title function_">lngLatsToCoords</span>([
        [center.<span class="hljs-property">lng</span>, center.<span class="hljs-property">lat</span>]
      ])[<span class="hljs-number">0</span>];
      
      <span class="hljs-comment">// 更新模型位置</span>
      robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setX</span>(position[<span class="hljs-number">1</span>]);
      robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setZ</span>(position[<span class="hljs-number">0</span>]);
      robotGroup.<span class="hljs-property">position</span>.<span class="hljs-title function_">setY</span>(position.<span class="hljs-property">length</span> &gt; <span class="hljs-number">2</span> ? position[<span class="hljs-number">2</span>] : <span class="hljs-number">0</span>);
      
      <span class="hljs-comment">// 更新模型旋转（根据地图旋转）</span>
      <span class="hljs-keyword">const</span> rotation = mapInstance.<span class="hljs-title function_">getRotation</span>();
      <span class="hljs-keyword">if</span> (rotation !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">const</span> initialRotationY = (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>) * <span class="hljs-number">90</span>;
        robotGroup.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> = initialRotationY + (rotation * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>);
      }
    }
  }
  
  <span class="hljs-comment">// 渲染场景</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
  renderer.<span class="hljs-title function_">resetState</span>();
}
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用地图中心点作为模型位置，实现精确跟随</li>
<li>在每次render中更新坐标系统中心点，确保坐标转换准确</li>
<li>同步地图旋转角度到模型Y轴旋转</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/704af9f7931e4a4582b0a4d9a6520a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=8kAzAZJY8zNP98XWt4v5QW5fWjk%3D" alt="2025-12-21 11.55.23.gif" loading="lazy"/></p>
<h3 data-id="heading-21">六、巡逻动画实现</h3>
<h4 data-id="heading-22">6.1 启动巡逻</h4>
<p>当模型加载完成并设置好初始位置后，可以启动巡逻动画：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">startPatrol</span> = (<span class="hljs-params">paths: <span class="hljs-built_in">number</span>[][], mapInstance: <span class="hljs-built_in">any</span>, AMap: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-comment">// 停止之前的巡逻</span>
  <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title function_">removeAll</span>();
  patrolFinishedRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
  
  <span class="hljs-comment">// 保存路径</span>
  patrolPathsRef.<span class="hljs-property">current</span> = paths;
  patrolIndexRef.<span class="hljs-property">current</span> = <span class="hljs-number">0</span>;
  
  <span class="hljs-comment">// 播放前进动画</span>
  <span class="hljs-title function_">playAnimation</span>(<span class="hljs-string">'1LYP'</span>);  <span class="hljs-comment">// 播放行走动画</span>
  
  <span class="hljs-comment">// 设置坐标系统中心点为路径起点</span>
  <span class="hljs-keyword">const</span> firstPoint = paths[<span class="hljs-number">0</span>];
  customCoordsRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">setCenter</span>([firstPoint[<span class="hljs-number">0</span>], firstPoint[<span class="hljs-number">1</span>]]);
  
  <span class="hljs-comment">// 使用Loca实现镜头跟随</span>
  <span class="hljs-keyword">const</span> loca = locaRef.<span class="hljs-property">current</span>;
  <span class="hljs-keyword">if</span> (loca) {
    <span class="hljs-comment">// ... addTrackAnimate 代码 ...</span>
  }
  
  <span class="hljs-comment">// 启动模型移动动画</span>
  <span class="hljs-title function_">changeObject</span>();
};
</code></pre>
<h4 data-id="heading-23">6.2 模型移动动画</h4>
<p>使用TWEEN.js实现模型在路径点之间的平滑移动：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">changeObject</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (patrolFinishedRef.<span class="hljs-property">current</span> || patrolIndexRef.<span class="hljs-property">current</span> &gt;= patrolPathsRef.<span class="hljs-property">current</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> sp = patrolPathsRef.<span class="hljs-property">current</span>[patrolIndexRef.<span class="hljs-property">current</span>];
  <span class="hljs-keyword">const</span> ep = patrolPathsRef.<span class="hljs-property">current</span>[patrolIndexRef.<span class="hljs-property">current</span> + <span class="hljs-number">1</span>];
  <span class="hljs-keyword">const</span> s = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector2</span>(sp[<span class="hljs-number">0</span>], sp[<span class="hljs-number">1</span>]);
  <span class="hljs-keyword">const</span> e = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector2</span>(ep[<span class="hljs-number">0</span>], ep[<span class="hljs-number">1</span>]);

  <span class="hljs-keyword">const</span> speed = <span class="hljs-number">0.03</span>;
  <span class="hljs-keyword">const</span> dis = <span class="hljs-title class_">AMap</span>.<span class="hljs-property">GeometryUtil</span>.<span class="hljs-title function_">distance</span>(sp, ep);
  
  <span class="hljs-keyword">if</span> (dis &lt;= <span class="hljs-number">0</span>) {
    patrolIndexRef.<span class="hljs-property">current</span>++;
    <span class="hljs-title function_">changeObject</span>();
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 使用TWEEN实现平滑移动</span>
  <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title class_">Tween</span>(s)
    .<span class="hljs-title function_">to</span>(e.<span class="hljs-title function_">clone</span>(), dis / speed / speedFactor)
    .<span class="hljs-title function_">start</span>()
    .<span class="hljs-title function_">onUpdate</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> {
      <span class="hljs-comment">// 更新模型经纬度引用</span>
      modelLngLatRef.<span class="hljs-property">current</span> = [v.<span class="hljs-property">x</span>, v.<span class="hljs-property">y</span>];
      
      <span class="hljs-comment">// 节流更新状态（每100ms更新一次）</span>
      <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">if</span> (now - lastUpdateTimeRef.<span class="hljs-property">current</span> &gt; <span class="hljs-number">100</span>) {
        <span class="hljs-title function_">setCurrentLngLat</span>([v.<span class="hljs-property">x</span>, v.<span class="hljs-property">y</span>]);
        <span class="hljs-title function_">checkSamplePoint</span>([v.<span class="hljs-property">x</span>, v.<span class="hljs-property">y</span>], <span class="hljs-title class_">AMap</span>);  <span class="hljs-comment">// 检测取样点</span>
        <span class="hljs-comment">// 计算已巡逻长度</span>
        <span class="hljs-title function_">updatePatrolledLength</span>(v);
        lastUpdateTimeRef.<span class="hljs-property">current</span> = now;
      }
    })
    .<span class="hljs-title function_">onComplete</span>(<span class="hljs-function">() =&gt;</span> {
      accumulatedLengthRef.<span class="hljs-property">current</span> += dis;
      
      <span class="hljs-keyword">if</span> (patrolIndexRef.<span class="hljs-property">current</span> &lt; patrolPathsRef.<span class="hljs-property">current</span>.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>) {
        patrolIndexRef.<span class="hljs-property">current</span>++;
        <span class="hljs-title function_">changeObject</span>();  <span class="hljs-comment">// 继续下一段</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 单程完成</span>
        <span class="hljs-keyword">if</span> (patrolMode !== <span class="hljs-string">'往返'</span>) {
          patrolFinishedRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
          <span class="hljs-title function_">playAnimation</span>(<span class="hljs-string">'1Idle'</span>);  <span class="hljs-comment">// 播放静止动画</span>
        }
      }
    });
};
</code></pre>
<h4 data-id="heading-24">6.3 动画系统</h4>
<p>模型支持多种动画（行走、静止、跳舞等），使用<code>AnimationMixer</code>管理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 设置动画系统</span>
<span class="hljs-keyword">if</span> (gltf.<span class="hljs-property">animations</span> &amp;&amp; gltf.<span class="hljs-property">animations</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
  <span class="hljs-keyword">const</span> mixer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AnimationMixer</span>(robotModel);
  
  <span class="hljs-comment">// 创建所有动画动作</span>
  <span class="hljs-keyword">const</span> actions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">AnimationAction</span>&gt;();
  gltf.<span class="hljs-property">animations</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">clip: THREE.AnimationClip</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> action = mixer.<span class="hljs-title function_">clipAction</span>(clip);
    action.<span class="hljs-title function_">setLoop</span>(<span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">LoopRepeat</span>);  <span class="hljs-comment">// 循环播放</span>
    actions.<span class="hljs-title function_">set</span>(clip.<span class="hljs-property">name</span>, action);
  });
  
  <span class="hljs-comment">// 播放默认静止动画</span>
  <span class="hljs-keyword">const</span> defaultAction = actions.<span class="hljs-title function_">get</span>(<span class="hljs-string">'1Idle'</span>);
  <span class="hljs-keyword">if</span> (defaultAction) {
    defaultAction.<span class="hljs-title function_">setEffectiveTimeScale</span>(<span class="hljs-number">0.6</span>);  <span class="hljs-comment">// 设置播放速度</span>
    defaultAction.<span class="hljs-title function_">fadeIn</span>(<span class="hljs-number">0.3</span>);
    defaultAction.<span class="hljs-title function_">play</span>();
  }
}

<span class="hljs-comment">// 在render循环中更新动画</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">render</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">render</span>();
  });
  
  <span class="hljs-comment">// 更新动画混合器</span>
  <span class="hljs-keyword">if</span> (mixer) {
    <span class="hljs-keyword">const</span> currentTime = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> delta = (currentTime - lastAnimationTime) / <span class="hljs-number">1000</span>;
    mixer.<span class="hljs-title function_">update</span>(delta);
    lastAnimationTime = currentTime;
  }
  
  <span class="hljs-comment">// 更新TWEEN动画</span>
  <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title function_">update</span>();
  
  <span class="hljs-comment">// 渲染地图</span>
  mapInstance.<span class="hljs-title function_">render</span>();
};
</code></pre>
<blockquote>
<p>图片略大，耐心等候</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20efe3a18e064609bcc6eda76ba1be31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=trCcvYGAT3U7pVGEnsv3hPLkx%2BU%3D" alt="5 动画切换.gif" loading="lazy"/></p>
<h3 data-id="heading-25">七、AI安全隐患自动检测与告警</h3>
<p>系统集成了Coze AI大模型，实现了巡逻过程中的自动安全隐患检测和告警功能。当机械狗沿路线巡逻时，系统会在预设的取样点自动触发AI分析，识别潜在的安全隐患。</p>
<h4 data-id="heading-26">7.1 取样点计算</h4>
<p>系统支持基于路线间隔的自动取样点计算，根据巡逻犬配置的取样间隔（如每50米、100米等），在路线上均匀分布取样点：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 计算取样点（基于路线间隔）</span>
<span class="hljs-keyword">const</span> calculateSamplePoints = (
  <span class="hljs-attr">paths</span>: <span class="hljs-built_in">number</span>[][], 
  <span class="hljs-attr">sampleInterval</span>: <span class="hljs-built_in">number</span>, 
  <span class="hljs-title class_">AMap</span>: <span class="hljs-built_in">any</span>
): <span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">lng</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">lat</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">distance</span>: <span class="hljs-built_in">number</span> }&gt; =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">samplePoints</span>: <span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">lng</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">lat</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">distance</span>: <span class="hljs-built_in">number</span> }&gt; = [];
  <span class="hljs-keyword">let</span> accumulatedDistance = <span class="hljs-number">0</span>;
  
  <span class="hljs-comment">// 从第一个点开始（0米处）</span>
  samplePoints.<span class="hljs-title function_">push</span>({
    <span class="hljs-attr">lng</span>: paths[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>],
    <span class="hljs-attr">lat</span>: paths[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>],
    <span class="hljs-attr">distance</span>: <span class="hljs-number">0</span>,
  });
  
  <span class="hljs-comment">// 遍历路径，计算每个取样点</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; paths.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i++) {
    <span class="hljs-keyword">const</span> currentPoint = paths[i];
    <span class="hljs-keyword">const</span> nextPoint = paths[i + <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> segmentDistance = <span class="hljs-title class_">AMap</span>.<span class="hljs-property">GeometryUtil</span>.<span class="hljs-title function_">distance</span>(currentPoint, nextPoint);
    
    <span class="hljs-comment">// 检查当前段是否包含取样点</span>
    <span class="hljs-keyword">while</span> (accumulatedDistance + segmentDistance &gt;= (samplePoints.<span class="hljs-property">length</span> * sampleInterval)) {
      <span class="hljs-keyword">const</span> targetDistance = samplePoints.<span class="hljs-property">length</span> * sampleInterval;
      <span class="hljs-keyword">const</span> distanceInSegment = targetDistance - accumulatedDistance;
      
      <span class="hljs-comment">// 计算取样点在当前段中的位置（线性插值）</span>
      <span class="hljs-keyword">const</span> ratio = distanceInSegment / segmentDistance;
      <span class="hljs-keyword">const</span> sampleLng = currentPoint[<span class="hljs-number">0</span>] + (nextPoint[<span class="hljs-number">0</span>] - currentPoint[<span class="hljs-number">0</span>]) * ratio;
      <span class="hljs-keyword">const</span> sampleLat = currentPoint[<span class="hljs-number">1</span>] + (nextPoint[<span class="hljs-number">1</span>] - currentPoint[<span class="hljs-number">1</span>]) * ratio;
      
      samplePoints.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">lng</span>: sampleLng,
        <span class="hljs-attr">lat</span>: sampleLat,
        <span class="hljs-attr">distance</span>: targetDistance,
      });
    }
    
    accumulatedDistance += segmentDistance;
  }
  
  <span class="hljs-keyword">return</span> samplePoints;
};
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用高德地图的<code>GeometryUtil.distance</code>计算路径段距离</li>
<li>通过线性插值计算取样点的精确位置</li>
<li>取样点从路线起点开始，按固定间隔均匀分布</li>
</ul>
<h4 data-id="heading-27">7.2 自动触发检测</h4>
<p>在巡逻过程中，系统实时检测模型位置是否到达取样点附近（±10米范围内）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 检测是否到达取样点</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkSamplePoint</span> = (<span class="hljs-params">currentLngLat: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>], AMap: <span class="hljs-built_in">any</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> patrolDog = currentPatrolDogRef.<span class="hljs-property">current</span>;
  <span class="hljs-keyword">const</span> route = currentRouteRefForSample.<span class="hljs-property">current</span>;
  <span class="hljs-keyword">const</span> area = currentAreaRefForSample.<span class="hljs-property">current</span>;
  
  <span class="hljs-keyword">if</span> (!patrolDog || !route || !patrolDog.<span class="hljs-property">cameraDeviceId</span>) {
    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 没有绑定摄像头，不进行取样</span>
  }

  <span class="hljs-comment">// 检查取样方式（必须是"路线间隔"模式）</span>
  <span class="hljs-keyword">if</span> (patrolDog.<span class="hljs-property">sampleMode</span> !== <span class="hljs-string">'路线间隔'</span> || !patrolDog.<span class="hljs-property">sampleInterval</span>) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 检查是否在取样点附近（±10米范围内）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; samplePointsRef.<span class="hljs-property">current</span>.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (processedSamplePointsRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">has</span>(i)) {
      <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// 已处理过，跳过</span>
    }

    <span class="hljs-keyword">const</span> samplePoint = samplePointsRef.<span class="hljs-property">current</span>[i];
    <span class="hljs-keyword">const</span> distance = <span class="hljs-title class_">AMap</span>.<span class="hljs-property">GeometryUtil</span>.<span class="hljs-title function_">distance</span>(
      [currentLngLat[<span class="hljs-number">0</span>], currentLngLat[<span class="hljs-number">1</span>]],
      [samplePoint.<span class="hljs-property">lng</span>, samplePoint.<span class="hljs-property">lat</span>]
    );

    <span class="hljs-comment">// 在 ±10 米范围内，触发取样</span>
    <span class="hljs-keyword">if</span> (distance &lt;= <span class="hljs-number">10</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ 到达取样点 <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>/<span class="hljs-subst">${samplePointsRef.current.length}</span>`</span>);
      processedSamplePointsRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">add</span>(i);
      
      <span class="hljs-comment">// 异步调用 Coze API（不阻塞巡逻）</span>
      <span class="hljs-title function_">analyzeSecurity</span>(
        patrolDog,
        route,
        area,
        currentLngLat,
        <span class="hljs-title class_">AMap</span>
      ).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'安全隐患分析失败:'</span>, error);
      });
      
      <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 一次只处理一个取样点</span>
    }
  }
};
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用距离判断，避免重复触发</li>
<li>异步调用AI分析，不阻塞巡逻动画</li>
<li>使用<code>Set</code>记录已处理的取样点，确保每个点只处理一次</li>
</ul>
<h4 data-id="heading-28">7.3 调用Coze API进行安全隐患分析</h4>
<p>系统使用Coze平台的大模型工作流进行图像安全隐患分析：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 调用 Coze API 进行安全隐患分析</span>
<span class="hljs-keyword">const</span> analyzeSecurity = <span class="hljs-keyword">async</span> (
  <span class="hljs-attr">patrolDog</span>: <span class="hljs-title class_">PatrolDog</span>,
  <span class="hljs-attr">route</span>: <span class="hljs-title class_">Route</span>,
  <span class="hljs-attr">area</span>: <span class="hljs-title class_">Area</span> | <span class="hljs-literal">null</span>,
  <span class="hljs-attr">currentLngLat</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>],
  <span class="hljs-title class_">AMap</span>: <span class="hljs-built_in">any</span>
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 1. 获取默认令牌</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">initDB</span>();
    <span class="hljs-keyword">const</span> tokens = <span class="hljs-keyword">await</span> db.<span class="hljs-property">token</span>.<span class="hljs-title function_">getAll</span>();
    <span class="hljs-keyword">const</span> validTokens = tokens.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">token</span> =&gt;</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() &lt;= token.<span class="hljs-property">expireDate</span>);
    <span class="hljs-keyword">if</span> (validTokens.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'没有可用的令牌，跳过安全隐患分析'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> defaultToken = validTokens.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">isDefault</span>) || validTokens[<span class="hljs-number">0</span>];
    
    <span class="hljs-comment">// 2. 准备分析数据</span>
    <span class="hljs-comment">// 随机选择一张测试图片（实际应用中应使用摄像头实时抓拍）</span>
    <span class="hljs-keyword">const</span> randomImageUrl = imageUrlr[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * imageUrlr.<span class="hljs-property">length</span>)];
    
    <span class="hljs-comment">// 构建输入文本，描述当前巡逻场景</span>
    <span class="hljs-keyword">const</span> inputText = <span class="hljs-string">`<span class="hljs-subst">${patrolDog.name}</span>当前在<span class="hljs-subst">${area?.name || <span class="hljs-string">'未知'</span>}</span>区域<span class="hljs-subst">${route.name}</span>巡逻时抓拍了一张照片。分析是否存在安全隐患`</span>;
    
    <span class="hljs-comment">// 3. 创建 Coze API 客户端</span>
    <span class="hljs-keyword">const</span> apiClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CozeAPI</span>({
      <span class="hljs-attr">token</span>: defaultToken.<span class="hljs-property">token</span>,
      <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.coze.cn'</span>,
      <span class="hljs-attr">allowPersonalAccessTokenInBrowser</span>: <span class="hljs-literal">true</span>,
    });

    <span class="hljs-comment">// 4. 调用工作流</span>
    <span class="hljs-keyword">const</span> workflow_id = <span class="hljs-string">'7585585625312034858'</span>;
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> apiClient.<span class="hljs-property">workflows</span>.<span class="hljs-property">runs</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">workflow_id</span>: workflow_id,
      <span class="hljs-attr">parameters</span>: {
        <span class="hljs-attr">input</span>: inputText,
        <span class="hljs-attr">mediaUrl</span>: randomImageUrl,
      },
    });

    <span class="hljs-comment">// 5. 解析返回结果</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">analysisResult</span>: { <span class="hljs-attr">securityType</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">score</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">desc</span>: <span class="hljs-built_in">string</span> } | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
    
    <span class="hljs-keyword">if</span> (res.<span class="hljs-property">data</span>) {
      <span class="hljs-keyword">const</span> dataObj = <span class="hljs-keyword">typeof</span> res.<span class="hljs-property">data</span> === <span class="hljs-string">'string'</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res.<span class="hljs-property">data</span>) : res.<span class="hljs-property">data</span>;
      
      <span class="hljs-keyword">if</span> (dataObj.<span class="hljs-property">output</span> &amp;&amp; <span class="hljs-keyword">typeof</span> dataObj.<span class="hljs-property">output</span> === <span class="hljs-string">'string'</span>) {
        <span class="hljs-comment">// 提取 markdown 代码块中的 JSON</span>
        <span class="hljs-keyword">const</span> jsonMatch = dataObj.<span class="hljs-property">output</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/```json\s*([\s\S]*?)\s*```/</span>) || 
                         dataObj.<span class="hljs-property">output</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/```\s*([\s\S]*?)\s*```/</span>);
        
        <span class="hljs-keyword">if</span> (jsonMatch &amp;&amp; jsonMatch[<span class="hljs-number">1</span>]) {
          analysisResult = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonMatch[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>());
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 尝试直接解析 output 为 JSON</span>
          analysisResult = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(dataObj.<span class="hljs-property">output</span>);
        }
      } <span class="hljs-keyword">else</span> {
        analysisResult = dataObj;
      }
    }

    <span class="hljs-comment">// 6. 判断是否是报警（securityType !== 0 且 score !== 0）</span>
    <span class="hljs-keyword">if</span> (analysisResult &amp;&amp; analysisResult.<span class="hljs-property">securityType</span> !== <span class="hljs-number">0</span> &amp;&amp; analysisResult.<span class="hljs-property">score</span> !== <span class="hljs-number">0</span>) {
      <span class="hljs-comment">// 保存到分析报警表</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">analysisAlert</span>: <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">AnalysisAlert</span>, <span class="hljs-string">'id'</span> | <span class="hljs-string">'createTime'</span> | <span class="hljs-string">'updateTime'</span>&gt; = {
        <span class="hljs-attr">alertTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">patrolDogId</span>: patrolDog.<span class="hljs-property">id</span>!,
        <span class="hljs-attr">patrolDogName</span>: patrolDog.<span class="hljs-property">name</span>,
        <span class="hljs-attr">cameraDeviceId</span>: patrolDog.<span class="hljs-property">cameraDeviceId</span>,
        <span class="hljs-attr">cameraDeviceName</span>: patrolDog.<span class="hljs-property">cameraDeviceName</span>,
        <span class="hljs-attr">routeId</span>: route.<span class="hljs-property">id</span>!,
        <span class="hljs-attr">routeName</span>: route.<span class="hljs-property">name</span>,
        <span class="hljs-attr">areaId</span>: area?.<span class="hljs-property">id</span>,
        <span class="hljs-attr">areaName</span>: area?.<span class="hljs-property">name</span>,
        <span class="hljs-attr">securityType</span>: analysisResult.<span class="hljs-property">securityType</span> <span class="hljs-keyword">as</span> <span class="hljs-number">0</span> | <span class="hljs-number">1</span> | <span class="hljs-number">2</span> | <span class="hljs-number">3</span> | <span class="hljs-number">4</span> | <span class="hljs-number">5</span>,
        <span class="hljs-attr">score</span>: analysisResult.<span class="hljs-property">score</span>,
        <span class="hljs-attr">desc</span>: analysisResult.<span class="hljs-property">desc</span>,
        <span class="hljs-attr">mediaUrl</span>: randomImageUrl,
        <span class="hljs-attr">input</span>: inputText,
        <span class="hljs-attr">status</span>: <span class="hljs-string">'未处理'</span>,
      };

      <span class="hljs-keyword">await</span> db.<span class="hljs-property">analysisAlert</span>.<span class="hljs-title function_">add</span>(analysisAlert);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ 安全隐患告警已保存'</span>);
      
      <span class="hljs-comment">// 更新告警列表（实时显示在大屏右侧）</span>
      <span class="hljs-title function_">updateAlertList</span>(patrolDog.<span class="hljs-property">id</span>!, route.<span class="hljs-property">id</span>!, area?.<span class="hljs-property">id</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'未发现安全隐患，不保存报警'</span>);
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'调用 Coze API 失败:'</span>, error);
  }
};
</code></pre>
<p><strong>API返回结果格式</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"securityType"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 0=无隐患, 1=明火燃烟, 2=打架斗殴, 3=违章停车, 4=杂物堆放, 5=私搭乱建</span>
  <span class="hljs-attr">"score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85</span><span class="hljs-punctuation">,</span>        <span class="hljs-comment">// 严重程度评分 (0-100)</span>
  <span class="hljs-attr">"desc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"检测到明火，存在严重安全隐患"</span>  <span class="hljs-comment">// 详细描述</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li>使用<code>@coze/api</code>官方SDK调用工作流API</li>
<li>支持多种安全隐患类型识别（明火燃烟、打架斗殴、违章停车等）</li>
<li>自动保存告警记录，支持后续查询和处理</li>
<li>告警信息实时显示在大屏右侧告警列表中</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/417bf26d5cec469abe39ad6b90d09d8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=PbL9C6eGohgNvCZofTFQF8PJfNg%3D" alt="6 报警.png" loading="lazy"/></p>
<h4 data-id="heading-29">7.4 Coze测试页面</h4>
<p>系统提供了专门的Coze测试页面，方便开发者测试和调试AI分析功能。在<strong>Coze测试</strong>页面中，可以：</p>
<ol>
<li><strong>选择令牌</strong>：从已配置的Coze API令牌中选择（支持多个令牌管理）</li>
<li><strong>输入分析文本</strong>：描述需要分析的场景</li>
<li><strong>上传图片URL</strong>：提供需要分析的图片地址</li>
<li><strong>自动填充功能</strong>：点击"自动填充"按钮，快速填充默认的测试数据</li>
<li><strong>查看完整响应</strong>：显示Coze API的完整返回结果，包括解析后的JSON和原始响应</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Coze测试页面核心功能</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleTest</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> values = <span class="hljs-keyword">await</span> form.<span class="hljs-title function_">validateFields</span>();
  
  <span class="hljs-comment">// 创建 Coze API 客户端</span>
  <span class="hljs-keyword">const</span> apiClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CozeAPI</span>({
    <span class="hljs-attr">token</span>: values.<span class="hljs-property">token</span>,
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.coze.cn'</span>,
    <span class="hljs-attr">allowPersonalAccessTokenInBrowser</span>: <span class="hljs-literal">true</span>,
  });

  <span class="hljs-comment">// 调用工作流</span>
  <span class="hljs-keyword">const</span> workflow_id = <span class="hljs-string">'7585585625312034858'</span>;
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> apiClient.<span class="hljs-property">workflows</span>.<span class="hljs-property">runs</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">workflow_id</span>: workflow_id,
    <span class="hljs-attr">parameters</span>: {
      <span class="hljs-attr">input</span>: values.<span class="hljs-property">input</span>,
      <span class="hljs-attr">mediaUrl</span>: values.<span class="hljs-property">mediaUrl</span>,
    },
  });

  <span class="hljs-comment">// 解析并显示结果</span>
  <span class="hljs-comment">// ... 解析逻辑 ...</span>
};
</code></pre>
<p><strong>测试页面特性</strong>：</p>
<ul>
<li><strong>自动填充数据</strong>：提供默认的测试图片和文本，方便快速测试</li>
<li><strong>图片预览</strong>：实时预览输入的图片URL</li>
<li><strong>完整响应展示</strong>：显示API的完整响应，便于调试</li>
<li><strong>错误处理</strong>：友好的错误提示，帮助定位问题</li>
</ul>
<blockquote>
<p>请截图 Coze测试页面 自动填充功能 测试结果展示</p>
</blockquote>
<p><strong>使用场景</strong>：</p>
<ul>
<li>测试新的安全隐患识别算法</li>
<li>验证Coze API令牌是否有效</li>
<li>调试API返回结果格式</li>
<li>验证图片URL是否可被Coze解析</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f29b91ced67a4ff3988691e2ab026a54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2ZX-WNjum5jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767748663&amp;x-signature=TKeWCzv%2Bs0%2BGHq%2BwHgFeFYQ8vh4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-30">八、性能优化建议</h3>
<h4 data-id="heading-31">7.1 渲染优化</h4>
<ul>
<li>禁用不必要的WebGL扩展（如阴影、抗锯齿）</li>
<li>使用<code>requestAnimationFrame</code>统一管理渲染循环</li>
<li>合理设置模型LOD（细节层次）</li>
</ul>
<h4 data-id="heading-32">7.2 内存管理</h4>
<ul>
<li>及时清理不需要的TWEEN动画：<code>TWEEN.removeAll()</code></li>
<li>组件卸载时销毁Three.js资源</li>
<li>模型加载后缓存，避免重复加载</li>
</ul>
<h4 data-id="heading-33">7.3 坐标转换优化</h4>
<ul>
<li>坐标系统中心点跟随地图中心，减少转换误差</li>
<li>使用节流控制状态更新频率</li>
<li>避免在render中进行复杂计算</li>
</ul>
<h3 data-id="heading-34">九、常见问题解决</h3>
<h4 data-id="heading-35">8.1 模型不显示</h4>
<p><strong>问题</strong>：模型加载成功但在地图上不可见</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查<code>renderer.autoClear</code>是否设置为<code>false</code></li>
<li>确认坐标转换是否正确（注意数组索引对应关系）</li>
<li>检查模型缩放是否合适（可能太小或太大）</li>
</ul>
<h4 data-id="heading-36">8.2 模型位置偏移</h4>
<p><strong>问题</strong>：模型位置与预期不符</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>确保在设置模型位置前调用<code>customCoords.setCenter()</code></li>
<li>检查坐标轴对应关系（<code>position[1]</code>对应X轴，<code>position[0]</code>对应Z轴）</li>
<li>使用<code>AxesHelper</code>辅助调试坐标轴方向</li>
</ul>
<h4 data-id="heading-37">8.3 镜头跟随不流畅</h4>
<p><strong>问题</strong>：镜头跟随有延迟或卡顿</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>调整<code>rotationSpeed</code>参数，控制旋转速度</li>
<li>优化<code>timing</code>速率控制器，实现更平滑的加速减速</li>
<li>检查render循环是否正常执行</li>
</ul>
<h3 data-id="heading-38">十、总结</h3>
<p>通过高德地图与Three.js的深度结合，我们成功实现了3D模型在地图上的实时展示和动画效果，并集成了AI大模型实现智能安全隐患检测。核心要点包括：</p>
<ol>
<li><strong>GLCustomLayer是关键桥梁</strong>：通过自定义图层实现Three.js与高德地图的融合</li>
<li><strong>坐标转换是核心</strong>：正确理解和使用<code>customCoords</code>进行坐标转换</li>
<li><strong>镜头跟随提升体验</strong>：使用Loca API实现平滑的镜头跟随效果</li>
<li><strong>AI智能检测增强功能</strong>：集成Coze大模型实现自动安全隐患识别和告警</li>
<li><strong>性能优化不可忽视</strong>：合理配置渲染参数，避免不必要的WebGL扩展</li>
</ol>
<p><strong>技术亮点</strong>：</p>
<ul>
<li><strong>虚实结合</strong>：真实地理信息与3D模型的完美融合</li>
<li><strong>智能检测</strong>：基于AI大模型的自动安全隐患识别</li>
<li><strong>实时告警</strong>：巡逻过程中的实时检测和告警推送</li>
<li><strong>可视化展示</strong>：沉浸式大屏监控体验</li>
</ul>
<p>这种技术方案不仅适用于巡逻犬管理系统，还可以扩展到智慧城市、物流追踪、车辆监控、园区安防等多个场景，为空间数据可视化提供了强大的技术支撑。通过AI能力的集成，系统从传统的可视化展示升级为智能化的安全监控平台，实现了"看得见、管得住、能预警"的完整闭环。</p>
<h3 data-id="heading-39">参考资源</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Fjavascript-api%2Fsummary" target="_blank" title="https://lbs.amap.com/api/javascript-api/summary" ref="nofollow noopener noreferrer">高德地图JS API文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fdocs%2F" target="_blank" title="https://threejs.org/docs/" ref="nofollow noopener noreferrer">Three.js官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flbs.amap.com%2Fapi%2Floca-v2%2Fsummary" target="_blank" title="https://lbs.amap.com/api/loca-v2/summary" ref="nofollow noopener noreferrer">Loca数据可视化API</a></li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV18cqCBwEio%2F" target="_blank" title="https://www.bilibili.com/video/BV18cqCBwEio/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV18c…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分布式系统幂等性详解：从理论到落地的完整指南]]></title>    <link>https://juejin.cn/post/7589482741759868955</link>    <guid>https://juejin.cn/post/7589482741759868955</guid>    <pubDate>2025-12-31T01:25:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589482741759868955" data-draft-id="7589544380517957642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分布式系统幂等性详解：从理论到落地的完整指南"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2025-12-31T01:25:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分布式系统幂等性详解：从理论到落地的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T01:25:30.000Z" title="Wed Dec 31 2025 01:25:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">分布式系统幂等性详解：从理论到落地的完整指南</h2>
<p>在分布式系统中，“重复执行”是无法避免的常态——网络抖动导致的请求重试、消息队列的重复消费、用户误操作的重复提交、服务重启后的任务重放，都可能让同一操作被多次执行。如果系统不具备“幂等性”，这些重复操作会引发严重的数据异常：重复扣减余额、重复创建订单、重复发放积分……而幂等性，正是应对这些问题的核心保障。今天，我们就全面拆解幂等性的核心逻辑、实现方案、落地实践与避坑要点，搞懂如何让分布式系统在重复操作下依然保持数据一致。</p>
<h3 data-id="heading-1">一、为什么必须重视幂等性？分布式场景的痛点驱动</h3>
<p>在单体系统中，操作的执行链路短、状态可控，重复执行的概率较低；但分布式系统涉及多服务、多网络交互、多数据存储，重复执行的场景无处不在，核心痛点包括：</p>
<ul>
<li><strong>网络不可靠导致的重试</strong>：跨服务调用或第三方接口调用时，网络超时、 packet 丢失等问题会触发重试机制（如Feign重试、本地消息表重试），同一请求被多次发送；</li>
<li><strong>消息队列重复消费</strong>：MQ因网络波动、消费者宕机等原因，可能将同一消息重复投递（如RocketMQ重试机制、Kafka offset回溯），导致消费逻辑重复执行；</li>
<li><strong>用户行为重复</strong>：用户快速点击提交按钮（如下单、支付）、前端因卡顿重复发送请求，导致同一业务操作被多次触发；</li>
<li><strong>服务容错与恢复</strong>：服务重启、扩容、故障转移时，未完成的任务会被重新执行（如定时任务重放、分布式事务回滚后重试）；</li>
<li><strong>第三方系统回调重复</strong>：支付、物流等第三方系统的回调通知，可能因网络延迟或自身重试机制，多次回调同一接口（如支付成功回调重复通知）。</li>
</ul>
<p>这些场景下，若系统不具备幂等性，会直接导致数据错乱：比如用户余额被重复扣减、订单被重复创建、积分被重复发放，进而引发用户投诉、财务损失。可见，幂等性不是“可选特性”，而是分布式系统的“基础保障”——它决定了系统在异常场景下的稳定性和数据一致性。</p>
<h3 data-id="heading-2">二、幂等性核心定义：什么是“多次执行与一次执行结果一致”？</h3>
<p>幂等性（Idempotency）的核心定义是：<strong>同一操作，无论执行一次还是多次，最终产生的业务结果和系统状态都完全一致，不会因重复执行导致任何副作用</strong>。</p>
<p>用数学公式可简单理解为：对于操作 f，任意输入 x，都满足 f(f(x)) = f(x)。</p>
<p>需要特别澄清3个易混淆的认知，避免理解偏差：</p>
<ul>
<li><strong>幂等性≠防重放</strong>：防重放是防止“过期请求”被重复执行（如黑客截取旧的请求参数重新发送），核心是“时间有效性”；幂等性是允许重复执行，但保证结果一致，核心是“结果一致性”；</li>
<li><strong>幂等性≠可重入</strong>：可重入是指同一线程在不同场景下重复进入同一方法（如递归调用、锁重入），核心是“方法执行过程的兼容性”；幂等性是针对“不同次独立操作”的结果一致性；</li>
<li><strong>幂等性不要求“执行过程一致”</strong> ：重复执行的过程中可能有中间状态（如“处理中”），但最终状态必须一致；比如重复创建订单，第一次创建成功，第二次返回“订单已存在”，虽执行过程不同，但最终只存在一个有效订单，符合幂等性。</li>
</ul>
<p>根据操作类型，幂等性可分为3类，覆盖大部分业务场景：</p>
<ol>
<li><strong>查询操作</strong>：天然幂等。查询操作不会改变系统状态，无论执行多少次，结果都一致（如“查询用户余额”“查询订单详情”）；</li>
<li><strong>更新操作</strong>：部分天然幂等，部分需手动实现。比如“将用户余额设置为100元”是天然幂等（无论执行多少次，余额最终都是100）；但“给用户余额增加10元”是非天然幂等（执行两次则增加20元）；</li>
<li><strong>创建操作</strong>：非天然幂等，需强制实现。创建操作会新增数据（如创建订单、创建用户），重复执行会导致数据重复，必须通过额外机制保证幂等性。</li>
</ol>
<h3 data-id="heading-3">三、分布式系统幂等性核心实现方案：原理、场景与优缺点</h3>
<p>实现幂等性的核心思路是“让系统能够识别重复操作，并对重复操作直接返回一致结果”。下面拆解6种最常用的实现方案，明确其适用边界和落地要点：</p>
<h4 data-id="heading-4">1. 基于唯一标识（Idempotency Key）的幂等性校验</h4>
<p>核心原理：<strong>由请求发起方生成一个全局唯一的“幂等性标识”（Idempotency Key），请求时将该标识一并传递给服务端；服务端首先校验该标识是否已处理，若未处理则执行业务逻辑，执行完成后记录标识的处理状态；若已处理则直接返回之前的执行结果，不重复执行业务逻辑</strong>。</p>
<p>核心流程（以HTTP接口为例）：</p>
<ol>
<li>前端/客户端生成唯一标识（如UUID、雪花算法ID），作为“Idempotency-Key”请求头或参数传递给服务端；</li>
<li>服务端接收请求后，先查询缓存（如Redis）或数据库，判断该幂等性标识是否已存在；</li>
<li>若不存在：执行核心业务逻辑（如创建订单、扣减余额）；</li>
<li>业务逻辑执行成功后，将幂等性标识存入缓存/数据库（记录状态为“已处理”，可关联业务结果）；</li>
<li>若已存在：直接返回缓存/数据库中记录的业务结果，不重复执行业务逻辑。</li>
</ol>
<p>实现示例（Redis版，适用于高并发接口）：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/create-order"</span>)
public Result <span class="hljs-built_in">createOrder</span>(<span class="hljs-variable">@RequestHeader</span>(<span class="hljs-string">"Idempotency-Key"</span>) String idempotencyKey, <span class="hljs-variable">@RequestBody</span> OrderDTO orderDTO) {
    <span class="hljs-comment">// 1. 校验幂等性标识</span>
    <span class="hljs-selector-tag">Boolean</span> <span class="hljs-selector-tag">isExist</span> = <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.hasKey</span>(idempotencyKey);
    <span class="hljs-selector-tag">if</span> (Boolean.TRUE.<span class="hljs-built_in">equals</span>(isExist)) {
        <span class="hljs-comment">// 重复请求，返回之前的结果</span>
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">resultJson</span> = <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.get</span>(idempotencyKey);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(JSON.<span class="hljs-built_in">parseObject</span>(resultJson, OrderVO.class));
    }
    
    <span class="hljs-comment">// 2. 执行业务逻辑（创建订单）</span>
    <span class="hljs-selector-tag">OrderVO</span> <span class="hljs-selector-tag">orderVO</span> = <span class="hljs-selector-tag">orderService</span><span class="hljs-selector-class">.createOrder</span>(orderDTO);
    
    <span class="hljs-comment">// 3. 记录幂等性标识（设置过期时间，避免内存溢出）</span>
    <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(idempotencyKey, JSON.<span class="hljs-built_in">toJSONString</span>(orderVO), <span class="hljs-number">24</span>, TimeUnit.HOURS);
    
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(orderVO);
}
</code></pre>
<p>适用场景：</p>
<ul>
<li>RESTful接口、第三方回调接口（如支付回调）；</li>
<li>用户重复提交场景（如下单、表单提交）；</li>
<li>高并发场景（优先用Redis存储标识，性能更高）。</li>
</ul>
<p>优点：</p>
<ul>
<li>通用性极强，几乎适配所有业务场景；</li>
<li>实现简单，无侵入性（仅需在接口入口增加校验逻辑）；</li>
<li>高并发友好，Redis版可支持海量请求的幂等性校验。</li>
</ul>
<p>缺点：</p>
<ul>
<li>依赖请求发起方生成唯一标识，需前端/客户端配合；</li>
<li>需额外维护缓存/数据库（如Redis宕机可能导致幂等性失效，需考虑高可用）；</li>
<li>标识过期时间难设置：过短可能导致正常重试失效，过长可能占用过多资源。</li>
</ul>
<h4 data-id="heading-5">2. 基于业务唯一标识的幂等性校验</h4>
<p>核心原理：<strong>利用业务本身的唯一属性（如订单号、支付流水号、用户ID+业务类型）作为幂等性标识，无需额外生成全局ID；服务端通过数据库唯一约束或状态查询，判断业务操作是否已执行，避免重复处理</strong>。</p>
<p>实现方式（两种核心思路）：</p>
<ol>
<li><strong>数据库唯一约束</strong>：在业务表中为业务唯一标识建立唯一索引（如订单表的“order_no”、支付表的“trade_no”），重复插入时会触发唯一约束异常，服务端捕获异常后直接返回成功（视为重复操作）； <code>-- 订单表，order_no为业务唯一标识，建立唯一索引  ``` CREATE TABLE</code>order<code>(  ````</code>id<code>bigint(20) NOT NULL AUTO_INCREMENT,  ````</code>order_no<code>varchar(64) NOT NULL COMMENT '订单号（业务唯一）',  ````</code>user_id<code>bigint(20) NOT NULL COMMENT '用户ID',  ````</code>amount<code>decimal(10,2) NOT NULL COMMENT '金额',  ````</code>status<code> tinyint(4) NOT NULL COMMENT '订单状态',  ```` PRIMARY KEY (</code>id<code>),  ```` UNIQUE KEY </code>uk_order_no<code> (</code>order_no<code>) -- 唯一约束保证幂等性  ```) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</code>代码逻辑：创建订单时，直接插入数据，若触发DuplicateKeyException，则认为是重复请求，返回订单已存在的结果。</li>
<li><strong>业务状态查询</strong>：通过业务唯一标识查询当前状态，判断操作是否已执行。比如“支付回调”场景，通过“支付流水号”查询订单状态，若已支付则直接返回成功，未支付则执行支付确认逻辑。</li>
</ol>
<p>适用场景：</p>
<ul>
<li>有天然业务唯一标识的场景（如订单、支付、物流）；</li>
<li>数据库操作场景（插入、更新业务数据）；</li>
<li>无需前端配合的后端内部操作（如消息消费、定时任务）。</li>
</ul>
<p>优点：</p>
<ul>
<li>无需额外生成全局ID，依赖业务本身属性，实现更简洁；</li>
<li>不依赖外部缓存，仅用数据库约束或查询，稳定性更高；</li>
<li>业务关联性强，便于问题排查（通过业务唯一标识可直接定位操作记录）。</li>
</ul>
<p>缺点：</p>
<ul>
<li>通用性弱，仅适用于有天然业务唯一标识的场景；</li>
<li>数据库唯一约束方式可能产生大量异常日志（需合理处理）；</li>
<li>高并发场景下，多次插入触发唯一约束可能影响性能（可结合缓存预热优化）。</li>
</ul>
<h4 data-id="heading-6">3. 基于状态机的幂等性校验</h4>
<p>核心原理：<strong>业务流程的每个步骤对应一个明确的状态（如订单的“待支付→已支付→已发货→已完成”），通过状态机控制状态流转，仅允许从指定的前置状态流转到目标状态；重复操作会因“状态不满足流转条件”被拒绝，从而保证幂等性</strong>。</p>
<p>实现示例（订单支付场景）：</p>
<ol>
<li>订单状态定义：待支付（0）、已支付（1）、已取消（2）、已完成（3）；</li>
<li>支付操作的状态流转规则：仅允许从“待支付（0）”流转到“已支付（1）”；</li>
<li>重复支付请求时，服务端查询订单状态为“已支付（1）”，不满足流转条件，直接返回成功，不重复扣减余额。</li>
</ol>
<p>代码逻辑（状态机校验）：</p>
<pre><code class="hljs language-scss" lang="scss">public Result <span class="hljs-built_in">payOrder</span>(String orderNo, BigDecimal amount) {
    <span class="hljs-comment">// 1. 查询订单状态</span>
    <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = orderMapper<span class="hljs-selector-class">.selectByOrderNo</span>(orderNo);
    if (order == null) {
        return Result<span class="hljs-selector-class">.fail</span>("订单不存在");
    }
    
    <span class="hljs-comment">// 2. 状态机校验：仅待支付状态可执行支付</span>
    if (order.getStatus() != <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 非待支付状态，视为重复支付，返回成功</span>
        return Result<span class="hljs-selector-class">.success</span>("订单已支付");
    }
    
    <span class="hljs-comment">// 3. 执行支付逻辑（扣减余额、更新订单状态）</span>
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">1</span>);
    <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setPayTime</span>(new Date());
    orderMapper<span class="hljs-selector-class">.updateById</span>(order);
    balanceService<span class="hljs-selector-class">.deductBalance</span>(order.getUserId(), amount);
    
    return Result<span class="hljs-selector-class">.success</span>("支付成功");
}
</code></pre>
<p>适用场景：</p>
<ul>
<li>有明确状态流转的业务流程（如订单、支付、物流、审批流程）；</li>
<li>多步骤串行执行的业务场景（如“下单→支付→发货→确认收货”）。</li>
</ul>
<p>优点：</p>
<ul>
<li>与业务流程深度融合，无需额外维护幂等性标识；</li>
<li>状态流转清晰，可有效避免非法状态变更，同时保证幂等性；</li>
<li>实现简单，仅需在状态变更前增加校验逻辑。</li>
</ul>
<p>缺点：</p>
<ul>
<li>通用性弱，仅适用于有明确状态流转的场景；</li>
<li>需严格定义状态流转规则，规则复杂时易出错（建议使用成熟状态机框架，如Spring StateMachine）。</li>
</ul>
<h4 data-id="heading-7">4. 基于分布式锁的幂等性校验</h4>
<p>核心原理：<strong>针对同一业务操作，在执行前获取分布式锁（如Redis锁、ZooKeeper锁），获取成功则执行业务逻辑，执行完成后释放锁；若获取失败（说明已有其他请求在执行），则等待锁释放或直接返回重复执行结果，从而避免并发场景下的重复处理</strong>。</p>
<p>实现示例（Redis分布式锁版）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">Result</span> <span class="hljs-title function_">deductStock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> productId, Integer quantity</span>) {
    <span class="hljs-comment">// 1. 构建锁标识（业务唯一：商品ID+操作类型）</span>
    <span class="hljs-title class_">String</span> lockKey = <span class="hljs-string">"lock:deduct_stock:"</span> + productId;
    <span class="hljs-title class_">String</span> lockValue = <span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>();
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 2. 获取分布式锁（过期时间30秒，避免死锁）</span>
        <span class="hljs-title class_">Boolean</span> lockSuccess = redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">setIfAbsent</span>(lockKey, lockValue, <span class="hljs-number">30</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">SECONDS</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Boolean</span>.<span class="hljs-property">FALSE</span>.<span class="hljs-title function_">equals</span>(lockSuccess)) {
            <span class="hljs-comment">// 未获取到锁，视为重复操作或并发操作，返回失败或重试提示</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Result</span>.<span class="hljs-title function_">fail</span>(<span class="hljs-string">"系统繁忙，请稍后重试"</span>);
        }
        
        <span class="hljs-comment">// 3. 执行业务逻辑（扣减库存）</span>
        <span class="hljs-title class_">Stock</span> stock = stockMapper.<span class="hljs-title function_">selectByProductId</span>(productId);
        <span class="hljs-keyword">if</span> (stock.<span class="hljs-title function_">getQuantity</span>() &lt; quantity) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Result</span>.<span class="hljs-title function_">fail</span>(<span class="hljs-string">"库存不足"</span>);
        }
        stock.<span class="hljs-title function_">setQuantity</span>(stock.<span class="hljs-title function_">getQuantity</span>() - quantity);
        stockMapper.<span class="hljs-title function_">updateById</span>(stock);
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Result</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"库存扣减成功"</span>);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// 4. 释放锁（避免误释放他人的锁，通过value校验）</span>
        <span class="hljs-title class_">String</span> currentValue = redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(lockKey);
        <span class="hljs-keyword">if</span> (lockValue.<span class="hljs-title function_">equals</span>(currentValue)) {
            redisTemplate.<span class="hljs-title function_">delete</span>(lockKey);
        }
    }
}
</code></pre>
<p>适用场景：</p>
<ul>
<li>高并发场景下的资源操作（如秒杀库存扣减、高频余额更新）；</li>
<li>无天然唯一标识，但需要避免并发重复处理的场景；</li>
<li>短期执行的业务操作（锁过期时间易设置）。</li>
</ul>
<p>优点：</p>
<ul>
<li>可有效解决并发场景下的重复操作问题，保证数据一致性；</li>
<li>不依赖业务标识，通用性较强；</li>
<li>实现灵活，可根据业务需求调整锁的粒度和过期时间。</li>
</ul>
<p>缺点：</p>
<ul>
<li>依赖分布式锁中间件（Redis/ZooKeeper），增加系统复杂度；</li>
<li>存在锁竞争开销，可能影响高并发场景的吞吐量；</li>
<li>锁过期时间难设置：过短可能导致业务未执行完锁就释放，过过长可能导致死锁后资源长时间不可用。</li>
</ul>
<h4 data-id="heading-8">5. 基于乐观锁的幂等性校验</h4>
<p>核心原理：<strong>通过版本号（Version）或时间戳（Timestamp）标识数据的当前状态，更新数据时携带版本号，仅当“携带的版本号与数据库中的版本号一致”时才允许更新；重复操作会因版本号不匹配而失败，从而保证幂等性</strong>。本质是“先校验后更新”，避免并发更新导致的数据异常。</p>
<p>实现示例（版本号机制）：</p>
<ol>
<li>数据库表增加版本号字段： `` CREATE TABLE <code>user_balance</code> (  <code>`id` bigint(20) NOT NULL AUTO_INCREMENT, </code> <code>user_id</code> bigint(20) NOT NULL COMMENT '用户ID',  <code>`balance` decimal(10,2) NOT NULL COMMENT '余额', </code> <code>version</code> int(11) NOT NULL DEFAULT 0 COMMENT '版本号', -- 乐观锁版本号  <code>PRIMARY KEY (`id`), </code> UNIQUE KEY <code>uk_user_id</code> (<code>user_id</code>)  ```) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;`</li>
<li>代码逻辑（更新时校验版本号）： <code> public Result deductBalance(Long userId, BigDecimal amount) {  `` int retryCount = 3;  `` while (retryCount &gt; 0) {  `` // 1. 查询用户余额和版本号  `` UserBalance balance = balanceMapper.selectByUserId(userId);  `` if (balance.getBalance().compareTo(amount) &lt; 0) {  `` return Result.fail("余额不足");  `` }  ```` // 2. 携带版本号更新（仅版本号一致时更新成功）  `` int updateRows = balanceMapper.deductBalanceWithVersion(  `` userId, amount, balance.getVersion()  `` );  ```` if (updateRows &gt; 0) {  `` // 更新成功，说明不是重复操作  `` return Result.success("余额扣减成功");  `` }  ```` // 更新失败（版本号不匹配，可能是重复操作或并发更新），重试  `` retryCount--;  `` try {  `` Thread.sleep(100);  `` } catch (InterruptedException e) {  `` Thread.currentThread().interrupt();  `` }  `` }  ```` // 重试多次失败，返回重复操作提示  `` return Result.fail("操作已执行，无需重复提交");  ``}</code></li>
</ol>
<p>适用场景：</p>
<ul>
<li>并发更新场景（如余额更新、库存调整）；</li>
<li>数据更新频率高，但冲突概率较低的场景；</li>
<li>不希望引入分布式锁，追求高吞吐量的场景。</li>
</ul>
<p>优点：</p>
<ul>
<li>无锁竞争，吞吐量高，适合高并发场景；</li>
<li>实现简单，仅需在表中增加版本号字段；</li>
<li>不依赖外部中间件，稳定性高。</li>
</ul>
<p>缺点：</p>
<ul>
<li>冲突概率高时，重试次数增加，可能影响性能；</li>
<li>仅适用于“更新操作”，不适用于“创建操作”；</li>
<li>需业务代码处理重试逻辑，增加少量开发成本。</li>
</ul>
<h4 data-id="heading-9">6. 基于“写空操作”的天然幂等性</h4>
<p>核心原理：<strong>对于部分更新操作，设计成“幂等性语句”，即使重复执行，也不会改变最终结果</strong>。这种方案无需额外的校验逻辑，通过SQL语句本身的特性保证幂等性。</p>
<p>典型示例：</p>
<ul>
<li>非幂等SQL：<code>UPDATE user_balance SET balance = balance - 10 WHERE user_id = 123;</code>（重复执行会重复扣减）；</li>
<li>幂等SQL：<code>UPDATE user_balance SET balance = 90 WHERE user_id = 123 AND balance = 100;</code>（无论执行多少次，最终余额都是90，重复执行无影响）；</li>
<li>另一示例：<code>INSERT IGNORE INTO user_point (user_id, point) VALUES (123, 50);</code>（通过INSERT IGNORE忽略重复插入，实现幂等性）。</li>
</ul>
<p>适用场景：</p>
<ul>
<li>简单的更新操作（如固定值更新、状态重置）；</li>
<li>无需复杂业务逻辑，仅需保证数据最终一致的场景；</li>
<li>数据库层面可直接控制结果的场景。</li>
</ul>
<p>优点：实现最简单，无额外开发成本，性能最优。</p>
<p>缺点：通用性极差，仅适用于特定的更新场景，无法覆盖大部分业务需求。</p>
<h3 data-id="heading-10">四、不同业务场景的幂等性方案选型建议</h3>
<p>幂等性方案没有“万能解”，需结合业务场景选择最合适的方案。下面针对4种高频场景给出具体选型建议：</p>
<h4 data-id="heading-11">场景1：用户前端表单提交（如下单、注册）</h4>
<p>核心需求：防止用户快速点击导致的重复提交，无需前端复杂配合。</p>
<p>选型建议：基于唯一标识（Idempotency Key）+ 前端生成UUID。前端点击后禁用按钮，同时生成UUID作为幂等性标识；服务端通过Redis校验标识，避免重复处理。</p>
<h4 data-id="heading-12">场景2：第三方接口回调（如支付回调、物流回调）</h4>
<p>核心需求：第三方系统可能重复回调，需准确识别重复通知，避免重复执行业务逻辑。</p>
<p>选型建议：基于业务唯一标识（如支付流水号、物流单号）。服务端通过查询业务状态（如订单是否已支付）判断是否已处理，已处理则直接返回成功，未处理则执行回调逻辑。</p>
<h4 data-id="heading-13">场景3：消息队列重复消费（如订单消息、积分消息）</h4>
<p>核心需求：MQ重复投递消息，消费端需保证重复消费不影响数据一致性。</p>
<p>选型建议：基于业务唯一标识（如消息ID、订单号）+ 数据库唯一约束。消费端将消息ID或业务唯一标识存入数据库，通过唯一约束避免重复消费；或通过状态机校验业务状态。</p>
<h4 data-id="heading-14">场景4：高并发库存扣减（如秒杀活动）</h4>
<p>核心需求：高并发场景下避免超卖，同时保证重复请求不重复扣减库存。</p>
<p>选型建议：乐观锁（版本号）或分布式锁。低冲突场景选乐观锁（高吞吐量）；高冲突场景选分布式锁（Redis锁，保证强一致性）；也可结合“业务唯一标识+数据库唯一约束”双重保障。</p>
<h3 data-id="heading-15">五、幂等性落地常见问题与避坑指南</h3>
<p>实现幂等性时，容易陷入一些误区，导致幂等性失效或性能问题。下面梳理6个核心避坑要点：</p>
<h4 data-id="heading-16">1. 避免“过度设计”：不是所有接口都需要幂等性</h4>
<p>幂等性会增加系统复杂度和性能开销，无需对所有接口都实现幂等性。仅需对“有状态变更”且“可能重复执行”的接口实现（如创建订单、扣减余额、支付回调）；查询接口天然幂等，无需处理。</p>
<h4 data-id="heading-17">2. 保证幂等性标识的“全局唯一性”</h4>
<p>基于唯一标识的方案，若标识不唯一（如前端生成的UUID重复、雪花算法ID冲突），会导致幂等性失效。建议使用成熟的唯一ID生成方案（如雪花算法、UUID v4），高并发场景可增加业务前缀（如用户ID+UUID）。</p>
<h4 data-id="heading-18">3. 处理“幂等性标识过期”问题</h4>
<p>基于缓存的幂等性方案（如Redis），若标识过期时间过短，可能导致正常的重试请求被判定为新请求，重复执行业务逻辑。建议根据业务最大重试时间设置过期时间（如24小时），或对核心业务采用“缓存+数据库”双重存储标识。</p>
<h4 data-id="heading-19">4. 避免“长事务”与幂等性的冲突</h4>
<p>长事务场景下，幂等性标识可能提前记录为“已处理”，但事务未提交，此时重复请求会直接返回成功，导致数据不一致。解决方案：将“记录幂等性标识”的操作与核心业务逻辑放在同一个事务中，保证原子性；或采用“最终一致性”思路，通过定时任务校验数据。</p>
<h4 data-id="heading-20">5. 高并发场景下的性能优化</h4>
<p>高并发场景下，幂等性校验可能成为性能瓶颈（如Redis锁竞争、数据库唯一约束冲突）。优化方案：① 细化锁粒度（如按商品ID分锁，而非全局锁）；② 缓存预热幂等性标识（如秒杀前将商品ID存入Redis，减少数据库查询）；③ 异步处理非核心幂等性校验逻辑。</p>
<h4 data-id="heading-21">6. 幂等性与分布式事务的协同</h4>
<p>分布式事务场景下（如TCC、SAGA），幂等性是基础保障。需确保每个阶段的操作（如Try、Confirm、Cancel）都具备幂等性，避免因事务重试导致重复执行。建议结合“幂等性标识+状态机”，精准控制每个阶段的操作是否执行。</p>
<h3 data-id="heading-22">六、总结：幂等性是分布式系统的“基石”而非“银弹”</h3>
<p>幂等性的核心价值是“让分布式系统在重复操作下保持数据一致”，它是应对网络不可靠、消息重复、用户误操作的基础保障。但幂等性不是“银弹”，无法解决所有数据一致性问题——它需要与重试策略、分布式事务、熔断限流等机制协同工作，才能构建稳定的分布式系统。</p>
<p>落地幂等性的核心原则是“简单优先、按需设计”：优先选择基于业务唯一标识、状态机等简单方案；高并发场景再引入分布式锁、乐观锁；避免过度设计导致系统复杂。同时，需充分考虑异常场景（如标识过期、事务回滚），确保幂等性在各种情况下都能生效。</p>
<p>最后，记住：<strong>幂等性的本质是“让系统能够容错重复操作”</strong> 。在分布式系统中，重复执行是常态，接受这个常态，并通过合理的幂等性设计包容它，才能让系统更稳定、更可靠。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS：动画曲线]]></title>    <link>https://juejin.cn/post/7589541466701283328</link>    <guid>https://juejin.cn/post/7589541466701283328</guid>    <pubDate>2025-12-31T01:26:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589541466701283328" data-draft-id="7589526591565135872" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS：动画曲线"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-31T01:26:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ChinaDragon"/> <meta itemprop="url" content="https://juejin.cn/user/3966693681410840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS：动画曲线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693681410840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ChinaDragon
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T01:26:59.000Z" title="Wed Dec 31 2025 01:26:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、动画曲线概述</h3>
<blockquote>
<p>动画曲线是属性关于时间的变化函数，决定属性变化时产生动画的运动轨迹。某一时刻下动画曲线的斜率代表动画的速度，对应属性变化的快慢。一条优秀的动画曲线具备连续光滑、符合用户意图、符合物理世界客观规律的特点。开发者可结合用户的使用场景和意图，为动效选取合适的动画曲线。 <br/>
根据动画曲线是否符合物理世界客观规律，可将其分为物理曲线（ArkUI当前提供了多种物理弹簧曲线）和传统曲线两种类型。相比于传统曲线，物理曲线产生的运动轨迹更加符合用户认知，有助于创造自然生动的动画效果，建议开发者优先使用物理曲线。</p>
</blockquote>
<h3 data-id="heading-1">二、传统曲线简介</h3>
<blockquote>
<p>传统曲线基于数学公式，创造形状符合开发者预期的动画曲线。以三阶贝塞尔曲线为代表，通过调整曲线控制点，可以改变曲线形状，从而带来缓入、缓出等动画效果。对于同一条传统曲线，由于不具备物理含义，其形状不会因为用户行为发生任何改变，缺少物理动画的自然感和生动感。建议优先采用物理曲线创建动画，将传统曲线作为辅助用于极少数必要场景中。 <br/>
ArkUI提供了贝塞尔曲线、阶梯曲线等传统曲线接口，开发者可参照插值计算进行查阅。 <br/>
传统曲线的示例和效果如下：</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22be58c5cfee40d1b3ceb86fada9b924~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767749219&amp;x-signature=NcBJcDR1TiDLfjSrg2tUf%2BvLW38%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCurve</span> {</span>
  public title: <span class="hljs-built_in">string</span>;
  public curve: Curve;
  public color: Color | <span class="hljs-built_in">string</span>;

  constructor(title: <span class="hljs-built_in">string</span>, curve: Curve, color: Color | <span class="hljs-built_in">string</span> = <span class="hljs-string">'') {
    this.title = title;
    this.curve = curve;
    this.color = color;
  }
}

const myCurves: MyCurve[] = [
  new MyCurve('</span> Linear<span class="hljs-number">'</span>, Curve.Linear, <span class="hljs-string">'#317AF7'</span>),
  new MyCurve(<span class="hljs-string">' Ease'</span>, Curve.Ease, <span class="hljs-string">'#D94838'</span>),
  new MyCurve(<span class="hljs-string">' EaseIn'</span>, Curve.EaseIn, <span class="hljs-string">'#DB6B42'</span>),
  new MyCurve(<span class="hljs-string">' EaseOut'</span>, Curve.EaseOut, <span class="hljs-string">'#5BA854'</span>),
  new MyCurve(<span class="hljs-string">' EaseInOut'</span>, Curve.EaseInOut, <span class="hljs-string">'#317AF7'</span>),
  new MyCurve(<span class="hljs-string">' FastOutSlowIn'</span>, Curve.FastOutSlowIn, <span class="hljs-string">'#D94838'</span>)
]

@Entry
@Component
<span class="hljs-keyword">struct</span> CurveDemo {
  @State dRotate: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 旋转角度</span>

  build() {
    Column() {
      <span class="hljs-comment">// 曲线图例</span>
      Grid() {
        ForEach(myCurves, (item: MyCurve) =&gt; {
          GridItem() {
            Column() {
              Row()
                .width(<span class="hljs-number">30</span>)
                .height(<span class="hljs-number">30</span>)
                .borderRadius(<span class="hljs-number">15</span>)
                .backgroundColor(item.color)
              Text(item.title)
                .fontSize(<span class="hljs-number">15</span>)
                .fontColor(<span class="hljs-number">0x909399</span>)
            }
            .width(<span class="hljs-string">'100%'</span>)
          }
        })
      }
      .columnsTemplate(<span class="hljs-string">'1fr 1fr 1fr'</span>)
      .rowsTemplate(<span class="hljs-string">'1fr 1fr 1fr 1fr 1fr'</span>)
      .padding(<span class="hljs-number">10</span>)
      .width(<span class="hljs-string">'100%'</span>)
      .height(<span class="hljs-number">300</span>)
      .margin({ top: <span class="hljs-number">50</span> })

      Stack() {
        <span class="hljs-comment">// 摆动管道</span>
        Row()
          .width(<span class="hljs-number">290</span>)
          .height(<span class="hljs-number">290</span>)
          .border({
            width: <span class="hljs-number">15</span>,
            color: <span class="hljs-number">0xE6E8EB</span>,
            radius: <span class="hljs-number">145</span>
          })

        ForEach(myCurves, (item: MyCurve) =&gt; {
          <span class="hljs-comment">// 小球</span>
          Column() {
            Row()
              .width(<span class="hljs-number">30</span>)
              .height(<span class="hljs-number">30</span>)
              .borderRadius(<span class="hljs-number">15</span>)
              .backgroundColor(item.color)
          }
          .width(<span class="hljs-number">20</span>)
          .height(<span class="hljs-number">300</span>)
          .rotate({ angle: this.dRotate })
          .animation({
            duration: <span class="hljs-number">2000</span>,
            iterations: <span class="hljs-number">-1</span>,
            curve: item.curve,
            delay: <span class="hljs-number">100</span>
          })
        })
      }
      .width(<span class="hljs-string">'100%'</span>)
      .height(<span class="hljs-number">200</span>)
      .onClick(() =&gt; {
        this.dRotate ? null : this.dRotate = <span class="hljs-number">360</span>;
      })
    }
    .width(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<h3 data-id="heading-2">三、弹簧曲线简介</h3>
<blockquote>
<p>阻尼弹簧曲线（以下简称弹簧曲线）对应的阻尼弹簧系统中，偏离平衡位置的物体一方面受到弹簧形变产生的反向作用力，被迫发生振动。另一方面，阻尼的存在为物体振动提供阻力。除阻尼为0的特殊情况，物体在振动过程中振幅不断减小，且最终趋于0，其轨迹对应的动画曲线自然连续。 <br/>
采用弹簧曲线的动画在达终点时动画速度为0，不会产生动画“戛然而止”的观感，以避免影响用户体验。</p>
</blockquote>
<blockquote>
<p>ArkUI提供了四种阻尼弹簧曲线接口。</p>
</blockquote>
<blockquote>
<ul>
<li><strong>curves.springMotion</strong>：创建弹性动画，动画时长由曲线参数、属性变化值大小和弹簧初速度自动计算，开发者指定的动画时长不生效。 <br/></li>
</ul>
</blockquote>
<p>springMotion不提供速度设置接口，速度通过继承获得，无需开发者指定。对于某个属性，如果当前存在正在运行的springMotion或者responsiveSpringMotion类型动画，新创建的弹簧动画将停止正在运行的动画，并继承其当前时刻的动画属性值和速度作为新建动画的初始状态。此外，接口提供默认参数，便于开发者直接使用。</p>
<pre><code class="hljs language-c" lang="c">function <span class="hljs-title function_">springMotion</span><span class="hljs-params">(response?: number, dampingFraction?: number, overlapDuration?: number)</span>: ICurve;
</code></pre>
<blockquote>
<ul>
<li><strong>curves.responsiveSpringMotion</strong>：是springMotion动画的一种特例，仅默认参数不同。一般用于跟手做成动画的场景，离手时可用springMotion创建动画，此时离手阶段动画将自动继承跟手阶段动画速度，完成动画衔接。</li>
</ul>
</blockquote>
<blockquote>
<p>当新动画的overlapDuration参数不为0，且当前属性的上一个springMotion动画还未结束时，response和dampingFraction将在overlapDuration指定的时间内，从旧动画的参数值过渡到新动画的参数值。</p>
</blockquote>
<pre><code class="hljs language-c" lang="c">function <span class="hljs-title function_">responsiveSpringMotion</span><span class="hljs-params">(response?: number, dampingFraction?: number, overlapDuration?: number)</span>: ICurve;
</code></pre>
<blockquote>
<ul>
<li><strong>curves.interpolatingSpring</strong>：适合于需要指定初速度的动效场景，动画时长同样由接口参数自动计算，开发者在动画接口中指定的时长不生效。</li>
</ul>
</blockquote>
<blockquote>
<p>曲线接口提供速度入参，且由于接口对应一条从0到1的阻尼弹簧曲线，实际动画值根据曲线进行插值计算。所以速度也应该为归一化速度，其值等于动画属性改变的绝对速度除以动画属性改变量。因此不适合于动画起点属性值和终点属性值相同的场景，此时动画属性改变量为0，归一化速度不存在。</p>
</blockquote>
<pre><code class="hljs language-c" lang="c">function <span class="hljs-title function_">interpolatingSpring</span><span class="hljs-params">(velocity: number, mass: number, stiffness: number, damping: number)</span>: ICurve;
</code></pre>
<blockquote>
<ul>
<li>curves.springCurve：适合于需要直接指定动画时长的场景。springCurve接口与interpolatingSpring接口几乎一致，但是对于采用springCurve的动画，会将曲线的物理时长映射到指定的时长，相当于在时间轴上拉伸或压缩曲线，破坏曲线原本的物理规律，因此不建议开发者使用。</li>
</ul>
</blockquote>
<pre><code class="hljs language-c" lang="c">function <span class="hljs-title function_">springCurve</span><span class="hljs-params">(velocity: number, mass: number, stiffness: number, damping: number)</span>: ICurve;
</code></pre>
<blockquote>
<p>关于弹簧曲线完整的使用示例和参考效果如下，开发者也可参考动画衔接，掌握使用responsiveSpringMotion和springMotion进行手势和动画之间的衔接。 <br/>
弹簧曲线的示例代码和效果如下。</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95dde2a77232492bab3f169a692791e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767749219&amp;x-signature=GhhZc1rYgH5gAb5hDCzzpQVxrn0%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">import { curves } from <span class="hljs-string">'@kit.ArkUI'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Spring</span> {</span>
  public title: <span class="hljs-built_in">string</span>;
  public subTitle: <span class="hljs-built_in">string</span>;
  public iCurve: ICurve;

  constructor(title: <span class="hljs-built_in">string</span>, subTitle: <span class="hljs-built_in">string</span>, iCurve: ICurve) {
    this.title = title;
    this.iCurve = iCurve;
    this.subTitle = subTitle;
  }
}

<span class="hljs-comment">// 弹簧组件</span>
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Motion</span> {</span>
  @Prop dRotate: number = <span class="hljs-number">0</span>
  private title: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>
  private subTitle: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>
  private iCurve: ICurve | undefined = undefined

  build() {
    Column() {
      Circle()
        .translate({ y: this.dRotate })
        .animation({ curve: this.iCurve, iterations: <span class="hljs-number">-1</span> })
        .foregroundColor(<span class="hljs-string">'#317AF7'</span>)
        .width(<span class="hljs-number">30</span>)
        .height(<span class="hljs-number">30</span>)

      Column() {
        Text(this.title)
          .fontColor(Color.Black)
          .fontSize(<span class="hljs-number">10</span>).height(<span class="hljs-number">30</span>)
        Text(this.subTitle)
          .fontColor(<span class="hljs-number">0xcccccc</span>)
          .fontSize(<span class="hljs-number">10</span>).width(<span class="hljs-number">50</span>)
      }
      .borderWidth({ top: <span class="hljs-number">1</span> })
      .borderColor(<span class="hljs-number">0xf5f5f5</span>)
      .width(<span class="hljs-number">80</span>)
      .alignItems(HorizontalAlign.Center)
      .height(<span class="hljs-number">100</span>)

    }
    .height(<span class="hljs-number">110</span>)
    .margin({ bottom: <span class="hljs-number">5</span> })
    .alignItems(HorizontalAlign.Center)
  }
}

@Entry
@Component
export <span class="hljs-keyword">struct</span> SpringCurve {
  @State dRotate: number = <span class="hljs-number">0</span>;
  private springs: Spring[] = [
    new Spring(<span class="hljs-string">'springMotion'</span>, <span class="hljs-string">'周期1, 阻尼0.25'</span>, curves.springMotion(<span class="hljs-number">1</span>, <span class="hljs-number">0.25</span>)),
    new Spring(<span class="hljs-string">'responsive'</span> + <span class="hljs-string">'\n'</span> + <span class="hljs-string">'SpringMotion'</span>, <span class="hljs-string">'弹性跟手曲线'</span>, curves.responsiveSpringMotion(<span class="hljs-number">1</span>, <span class="hljs-number">0.25</span>)),
    new Spring(<span class="hljs-string">'interpolating'</span> + <span class="hljs-string">'\n'</span> + <span class="hljs-string">'Spring'</span>, <span class="hljs-string">'初始速度10，质量1， 刚度228， 阻尼30'</span>,
      curves.interpolatingSpring(<span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">228</span>, <span class="hljs-number">30</span>)),
    new Spring(<span class="hljs-string">'springCurve'</span>, <span class="hljs-string">'初始速度10， 质量1， 刚度228， 阻尼30'</span>, curves.springCurve(<span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">228</span>, <span class="hljs-number">30</span>))
  ];

  build() {
    Row() {
      ForEach(this.springs, (item: Spring) =&gt; {
        Motion({
          title: item.title,
          subTitle: item.subTitle,
          iCurve: item.iCurve,
          dRotate: this.dRotate
        })
      })
    }
    .justifyContent(FlexAlign.Center)
    .alignItems(VerticalAlign.Bottom)
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-number">437</span>)
    .margin({ top: <span class="hljs-number">20</span> })
    .onClick(() =&gt; {
      this.dRotate = <span class="hljs-number">-50</span>;
    })
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS：组件动画]]></title>    <link>https://juejin.cn/post/7589553045157068840</link>    <guid>https://juejin.cn/post/7589553045157068840</guid>    <pubDate>2025-12-31T01:30:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589553045157068840" data-draft-id="7589553045157052456" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS：组件动画"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-31T01:30:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ChinaDragon"/> <meta itemprop="url" content="https://juejin.cn/user/3966693681410840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS：组件动画
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693681410840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ChinaDragon
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T01:30:21.000Z" title="Wed Dec 31 2025 01:30:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、简介</h3>
<blockquote>
<p>ArkUI为组件提供了通用的属性动画和转场动画能力的同时，还为一些组件提供了默认的动画效果。例如，List的滑动动效、Button的点击动效，是组件自带的默认动画效果。在组件默认动画效果的基础上，开发者还可以通过属性动画和转场动画对容器组件内的子组件动效进行定制。</p>
</blockquote>
<h3 data-id="heading-1">二、使用组件默认动画</h3>
<blockquote>
<p>组件默认动效具备以下功能：</p>
<ul>
<li>提示用户当前状态，例如用户点击Button组件时，Button组件默认变灰，用户即确定完成选中操作。</li>
<li>提升界面精致程度和生动性。</li>
<li>减少开发者工作量，例如列表滑动组件自带滑动动效，开发者直接调用即可。</li>
</ul>
</blockquote>
<p><strong>示例代码和效果如下。</strong></p>
<blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fff9ce327c24563b1f9fed55a27ec84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767749421&amp;x-signature=TwH7XTN7BkjlMiL4dCLXlj70OeI%3D" alt="在这里插入图片描述" loading="lazy"/> <br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/379a9071a5134e309117c4999c31bca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767749421&amp;x-signature=ebCUz8WP2aqWpFZyKx1O1LQqxhU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<pre><code class="hljs language-c" lang="c">@Entry
@Component
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ComponentDemo</span> {</span>
  build() {
    Row() {
      Checkbox({ name: <span class="hljs-string">'checkbox1'</span>, group: <span class="hljs-string">'checkboxGroup'</span> })
        .select(<span class="hljs-literal">true</span>)
        .shape(CheckBoxShape.CIRCLE)
        .size({ width: <span class="hljs-number">50</span>, height: <span class="hljs-number">50</span> })
    }
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-string">'100%'</span>)
    .justifyContent(FlexAlign.Center)
  }
}
</code></pre>
<h3 data-id="heading-2">三、打造组件定制化动效</h3>
<blockquote>
<p>部分组件支持通过属性动画和转场动画自定义组件子Item的动效，实现定制化动画效果。例如，Scroll组件中可对各个子组件在滑动时的动画效果进行定制。</p>
<ul>
<li>在滑动或者点击操作时通过改变各个Scroll子组件的仿射属性来实现各种效果。</li>
<li>如果要在滑动过程中定制动效，可在滑动回调onScroll中监控滑动距离，并计算每个组件的仿射属性。也可以自己定义手势，通过手势监控位置，手动调用ScrollTo改变滑动位置。</li>
<li>在滑动回调onScrollStop或手势结束回调中对滑动的最终位置进行微调。</li>
</ul>
</blockquote>
<p><strong>定制Scroll组件滑动动效示例代码和效果如下。</strong></p>
<blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44d1ffc0d34e494d87fea72e9e098174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767749421&amp;x-signature=qoETqBxCswHxqb8zv7%2BJrd6S%2Buc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">import { curves, window, display, mediaquery, UIContext } from <span class="hljs-string">'@kit.ArkUI'</span>;
import { UIAbility } from <span class="hljs-string">'@kit.AbilityKit'</span>;

export <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalContext</span> <span class="hljs-title">extends</span> <span class="hljs-title">AppStorage</span> {</span>
  <span class="hljs-type">static</span> mainWin: window.Window | undefined = undefined;
  <span class="hljs-type">static</span> mainWindowSize: window.Size | undefined = undefined;
}
<span class="hljs-comment">/**
 * 窗口、屏幕相关信息管理类
 */</span>
export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WindowManager</span> {</span>
  private <span class="hljs-type">static</span> instance: WindowManager | null = null;
  private displayInfo: display.Display | null = null;
  private uiContext: UIContext;
  private orientationListener: mediaquery.MediaQueryListener;

  constructor(uiContext: UIContext) {
    this.uiContext = uiContext
    this.orientationListener = this.uiContext.getMediaQuery().matchMediaSync(<span class="hljs-string">'(orientation: landscape)'</span>);
    this.orientationListener.on(<span class="hljs-string">'change'</span>, (mediaQueryResult: mediaquery.MediaQueryResult) =&gt; {
      this.onPortrait(mediaQueryResult)
    })
    this.loadDisplayInfo()
  }

  <span class="hljs-comment">/**
   * 设置主window窗口
   * @param win 当前app窗口
   */</span>
  setMainWin(win: window.Window) {
    <span class="hljs-keyword">if</span> (win == null) {
      <span class="hljs-keyword">return</span>
    }
    GlobalContext.mainWin = win;
    win.on(<span class="hljs-string">"windowSizeChange"</span>, (data: window.Size) =&gt; {
      <span class="hljs-keyword">if</span> (GlobalContext.mainWindowSize == undefined || GlobalContext.mainWindowSize == null) {
        GlobalContext.mainWindowSize = data;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (GlobalContext.mainWindowSize.width == data.width &amp;&amp; GlobalContext.mainWindowSize.height == data.height) {
          <span class="hljs-keyword">return</span>
        }
        GlobalContext.mainWindowSize = data;
      }

      let winWidth = this.getMainWindowWidth();
      AppStorage.setOrCreate&lt;number&gt;(<span class="hljs-string">'mainWinWidth'</span>, winWidth)
      let winHeight = this.getMainWindowHeight();
      AppStorage.setOrCreate&lt;number&gt;(<span class="hljs-string">'mainWinHeight'</span>, winHeight)
      let context: UIAbility = new UIAbility()
      context.context.eventHub.emit(<span class="hljs-string">"windowSizeChange"</span>, winWidth, winHeight)
    })
  }

  <span class="hljs-type">static</span> <span class="hljs-title function_">getInstance</span><span class="hljs-params">(uiContext: UIContext)</span>: WindowManager {
    <span class="hljs-keyword">if</span> (WindowManager.instance == null) {
      WindowManager.instance = new WindowManager(uiContext);
    }
    <span class="hljs-keyword">return</span> WindowManager.instance
  }

  private onPortrait(mediaQueryResult: mediaquery.MediaQueryResult) {
    <span class="hljs-keyword">if</span> (mediaQueryResult.matches == AppStorage.get&lt;boolean&gt;(<span class="hljs-string">'isLandscape'</span>)) {
      <span class="hljs-keyword">return</span>
    }
    AppStorage.setOrCreate&lt;boolean&gt;(<span class="hljs-string">'isLandscape'</span>, mediaQueryResult.matches)
    this.loadDisplayInfo()
  }

  <span class="hljs-comment">/**
   * 切换屏幕方向
   * @param ori 常量枚举值：window.Orientation
   */</span>
  changeOrientation(ori: window.Orientation) {
    <span class="hljs-keyword">if</span> (GlobalContext.mainWin != null) {
      GlobalContext.mainWin.setPreferredOrientation(ori)
    }
  }

  private loadDisplayInfo() {
    this.displayInfo = display.getDefaultDisplaySync()
    AppStorage.setOrCreate&lt;number&gt;(<span class="hljs-string">'displayWidth'</span>, this.getDisplayWidth())
    AppStorage.setOrCreate&lt;number&gt;(<span class="hljs-string">'displayHeight'</span>, this.getDisplayHeight())
  }

  <span class="hljs-comment">/**
   * 获取main窗口宽度，单位vp
   */</span>
  getMainWindowWidth(): number {
    <span class="hljs-keyword">return</span> GlobalContext.mainWindowSize != null ? this.uiContext.px2vp(GlobalContext.mainWindowSize.width) : <span class="hljs-number">0</span>
  }

  <span class="hljs-comment">/**
   * 获取main窗口高度，单位vp
   */</span>
  getMainWindowHeight(): number {
    <span class="hljs-keyword">return</span> GlobalContext.mainWindowSize != null ? this.uiContext.px2vp(GlobalContext.mainWindowSize.height) : <span class="hljs-number">0</span>
  }

  <span class="hljs-comment">/**
   * 获取屏幕宽度，单位vp
   */</span>
  getDisplayWidth(): number {
    <span class="hljs-keyword">return</span> this.displayInfo != null ? this.uiContext.px2vp(this.displayInfo.width) : <span class="hljs-number">0</span>
  }

  <span class="hljs-comment">/**
   * 获取屏幕高度，单位vp
   */</span>
  getDisplayHeight(): number {
    <span class="hljs-keyword">return</span> this.displayInfo != null ? this.uiContext.px2vp(this.displayInfo.height) : <span class="hljs-number">0</span>
  }

  <span class="hljs-comment">/**
   * 释放资源
   */</span>
  release() {
    <span class="hljs-keyword">if</span> (this.orientationListener) {
      this.orientationListener.off(<span class="hljs-string">'change'</span>, (mediaQueryResult: mediaquery.MediaQueryResult) =&gt; {
        this.onPortrait(mediaQueryResult)
      })
    }
    <span class="hljs-keyword">if</span> (GlobalContext.mainWin != null) {
      GlobalContext.mainWin.off(<span class="hljs-string">'windowSizeChange'</span>)
    }
    WindowManager.instance = null;
  }
}

<span class="hljs-comment">/**
 * 封装任务卡片信息数据类
 */</span>
export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskData</span> {</span>
  bgColor: Color | <span class="hljs-built_in">string</span> | Resource = Color.White;
  index: number = <span class="hljs-number">0</span>;
  taskInfo: <span class="hljs-built_in">string</span> = <span class="hljs-string">'music'</span>;

  constructor(bgColor: Color | <span class="hljs-built_in">string</span> | Resource, index: number, taskInfo: <span class="hljs-built_in">string</span>) {
    this.bgColor = bgColor;
    this.index = index;
    this.taskInfo = taskInfo;
  }
}

export <span class="hljs-type">const</span> taskDataArr: Array&lt;TaskData&gt; =
  [
    new TaskData(<span class="hljs-string">'#317AF7'</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'music'</span>),
    new TaskData(<span class="hljs-string">'#D94838'</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'mall'</span>),
    new TaskData(<span class="hljs-string">'#DB6B42'</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'photos'</span>),
    new TaskData(<span class="hljs-string">'#5BA854'</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'setting'</span>),
    new TaskData(<span class="hljs-string">'#317AF7'</span>, <span class="hljs-number">4</span>, <span class="hljs-string">'call'</span>),
    new TaskData(<span class="hljs-string">'#D94838'</span>, <span class="hljs-number">5</span>, <span class="hljs-string">'music'</span>),
    new TaskData(<span class="hljs-string">'#DB6B42'</span>, <span class="hljs-number">6</span>, <span class="hljs-string">'mall'</span>),
    new TaskData(<span class="hljs-string">'#5BA854'</span>, <span class="hljs-number">7</span>, <span class="hljs-string">'photos'</span>),
    new TaskData(<span class="hljs-string">'#D94838'</span>, <span class="hljs-number">8</span>, <span class="hljs-string">'setting'</span>),
    new TaskData(<span class="hljs-string">'#DB6B42'</span>, <span class="hljs-number">9</span>, <span class="hljs-string">'call'</span>),
    new TaskData(<span class="hljs-string">'#5BA854'</span>, <span class="hljs-number">10</span>, <span class="hljs-string">'music'</span>)

  ];

@Entry
@Component
export <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TaskSwitchMainPage</span> {</span>
  displayWidth: number = WindowManager.getInstance(this.getUIContext()).getDisplayWidth();
  scroller: Scroller = new Scroller();
  cardSpace: number = <span class="hljs-number">0</span>; <span class="hljs-comment">// 卡片间距</span>
  cardWidth: number = this.displayWidth / <span class="hljs-number">2</span> - this.cardSpace / <span class="hljs-number">2</span>; <span class="hljs-comment">// 卡片宽度</span>
  cardHeight: number = <span class="hljs-number">400</span>; <span class="hljs-comment">// 卡片高度</span>
  cardPosition: Array&lt;number&gt; = []; <span class="hljs-comment">// 卡片初始位置</span>
  clickIndex: boolean = <span class="hljs-literal">false</span>;
  @State taskViewOffsetX: number = <span class="hljs-number">0</span>;
  @State cardOffset: number = this.displayWidth / <span class="hljs-number">4</span>;
  lastCardOffset: number = this.cardOffset;
  startTime: number | undefined = undefined

  <span class="hljs-comment">// 每个卡片初始位置</span>
  aboutToAppear() {
    <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; taskDataArr.length; i++) {
      this.cardPosition[i] = i * (this.cardWidth + this.cardSpace);
    }
  }

  <span class="hljs-comment">// 每个卡片位置</span>
  getProgress(index: number): number {
    let progress = (this.cardOffset + this.cardPosition[index] - this.taskViewOffsetX + this.cardWidth / <span class="hljs-number">2</span>) / this.displayWidth;
    <span class="hljs-keyword">return</span> progress
  }

  build() {
    Stack({ alignContent: Alignment.Bottom }) {
      <span class="hljs-comment">// 背景</span>
      Column()
        .width(<span class="hljs-string">'100%'</span>)
        .height(<span class="hljs-string">'100%'</span>)
        .backgroundColor(<span class="hljs-number">0xF0F0F0</span>)

      <span class="hljs-comment">// 滑动组件</span>
      Scroll(this.scroller) {
        Row({ space: this.cardSpace }) {
          ForEach(taskDataArr, (item: TaskData, index) =&gt; {
            Column()
              .width(this.cardWidth)
              .height(this.cardHeight)
              .backgroundColor(item.bgColor)
              .borderStyle(BorderStyle.Solid)
              .borderWidth(<span class="hljs-number">1</span>)
              .borderColor(<span class="hljs-number">0xAFEEEE</span>)
              .borderRadius(<span class="hljs-number">15</span>)
                <span class="hljs-comment">// 计算子组件的仿射属性</span>
              .scale((this.getProgress(index) &gt;= <span class="hljs-number">0.4</span> &amp;&amp; this.getProgress(index) &lt;= <span class="hljs-number">0.6</span>) ?
                {
                  x: <span class="hljs-number">1.1</span> - Math.<span class="hljs-built_in">abs</span>(<span class="hljs-number">0.5</span> - this.getProgress(index)),
                  y: <span class="hljs-number">1.1</span> - Math.<span class="hljs-built_in">abs</span>(<span class="hljs-number">0.5</span> - this.getProgress(index))
                } :
                { x: <span class="hljs-number">1</span>, y: <span class="hljs-number">1</span> })
              .animation({ curve: Curve.Smooth })
                <span class="hljs-comment">// 滑动动画</span>
              .translate({ x: this.cardOffset })
              .animation({ curve: curves.springMotion() })
              .zIndex((this.getProgress(index) &gt;= <span class="hljs-number">0.4</span> &amp;&amp; this.getProgress(index) &lt;= <span class="hljs-number">0.6</span>) ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>)
          }, (item: TaskData) =&gt; item.toString())
        }
        .width((this.cardWidth + this.cardSpace) * (taskDataArr.length + <span class="hljs-number">1</span>))
        .height(<span class="hljs-string">'100%'</span>)
      }
      .gesture(
        GestureGroup(GestureMode.Parallel,
          PanGesture({ direction: PanDirection.Horizontal, distance: <span class="hljs-number">5</span> })
            .onActionStart((event: GestureEvent | undefined) =&gt; {
              <span class="hljs-keyword">if</span> (event) {
                this.startTime = event.timestamp;
              }
            })
            .onActionUpdate((event: GestureEvent | undefined) =&gt; {
              <span class="hljs-keyword">if</span> (event) {
                this.cardOffset = this.lastCardOffset + event.offsetX;
              }
            })
            .onActionEnd((event: GestureEvent | undefined) =&gt; {
              <span class="hljs-keyword">if</span> (event) {
                let time = <span class="hljs-number">0</span>
                <span class="hljs-keyword">if</span> (this.startTime) {
                  time = event.timestamp - this.startTime;
                }
                let speed = event.offsetX / (time / <span class="hljs-number">1000000000</span>);
                let moveX = Math.<span class="hljs-built_in">pow</span>(speed, <span class="hljs-number">2</span>) / <span class="hljs-number">7000</span> * (speed &gt; <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>);

                this.cardOffset += moveX;
                <span class="hljs-comment">// 左滑大于最右侧位置</span>
                let cardOffsetMax = -(taskDataArr.length - <span class="hljs-number">1</span>) * (this.displayWidth / <span class="hljs-number">2</span>);
                <span class="hljs-keyword">if</span> (this.cardOffset &lt; cardOffsetMax) {
                  this.cardOffset = cardOffsetMax;
                }
                <span class="hljs-comment">// 右滑大于最左侧位置</span>
                <span class="hljs-keyword">if</span> (this.cardOffset &gt; this.displayWidth / <span class="hljs-number">4</span>) {
                  this.cardOffset = this.displayWidth / <span class="hljs-number">4</span>;
                }

                <span class="hljs-comment">// 左右滑动距离不满足/满足切换关系时，补位/退回</span>
                let remainMargin = this.cardOffset % (this.displayWidth / <span class="hljs-number">2</span>);
                <span class="hljs-keyword">if</span> (remainMargin &lt; <span class="hljs-number">0</span>) {
                  remainMargin = this.cardOffset % (this.displayWidth / <span class="hljs-number">2</span>) + this.displayWidth / <span class="hljs-number">2</span>;
                }
                <span class="hljs-keyword">if</span> (remainMargin &lt;= this.displayWidth / <span class="hljs-number">4</span>) {
                  this.cardOffset += this.displayWidth / <span class="hljs-number">4</span> - remainMargin;
                } <span class="hljs-keyword">else</span> {
                  this.cardOffset -= this.displayWidth / <span class="hljs-number">4</span> - (this.displayWidth / <span class="hljs-number">2</span> - remainMargin);
                }

                <span class="hljs-comment">// 记录本次滑动偏移量</span>
                this.lastCardOffset = this.cardOffset;
              }
            })
        ), GestureMask.IgnoreInternal)
      .scrollable(ScrollDirection.Horizontal)
      .scrollBar(BarState.Off)

      <span class="hljs-comment">// 滑动到首尾位置</span>
      Button(<span class="hljs-string">'Move to first/last'</span>)
        .backgroundColor(<span class="hljs-number">0x888888</span>)
        .margin({ bottom: <span class="hljs-number">30</span> })
        .onClick(() =&gt; {
          this.clickIndex = !this.clickIndex;

          <span class="hljs-keyword">if</span> (this.clickIndex) {
            this.cardOffset = this.displayWidth / <span class="hljs-number">4</span>;
          } <span class="hljs-keyword">else</span> {
            this.cardOffset = this.displayWidth / <span class="hljs-number">4</span> - (taskDataArr.length - <span class="hljs-number">1</span>) * this.displayWidth / <span class="hljs-number">2</span>;
          }
          this.lastCardOffset = this.cardOffset;
        })
    }
    .width(<span class="hljs-string">'100%'</span>)
    .height(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<blockquote>
<p>通过animateTo可以实现将List中指定的Item替换到首位，List中其余Item依次向下排列。定制List组件动态替换动效的示例代码和效果如下。</p>
</blockquote>
<blockquote>
<p><strong>效果图</strong> <br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a65af70c3a664d44bf4e079c166dcd7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2hpbmFEcmFnb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767749421&amp;x-signature=xEDCrrdkCRiAPA%2BmbKHSygvA%2BhY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
</blockquote>
<p><strong>示例代码</strong></p>
<pre><code class="hljs language-c" lang="c">import { curves, AnimatorResult } from <span class="hljs-string">'@kit.ArkUI'</span>;

<span class="hljs-comment">// 该接口控制列表项视觉属性</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListItemModify</span> <span class="hljs-title">implements</span> <span class="hljs-title">AttributeModifier</span>&lt;</span>ListItemAttribute&gt; {
  public offsetY: number = <span class="hljs-number">0</span>;

  applyNormalAttribute(instance: ListItemAttribute): <span class="hljs-type">void</span> {
    instance.translate({ y: this.offsetY }) <span class="hljs-comment">// Y轴位移</span>
  }
}

@Observed
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DragSortCtrl</span>&lt;</span>T&gt; {
  private arr: Array&lt;T&gt;
  private modify: Array&lt;ListItemModify&gt;
  private uiContext: UIContext; <span class="hljs-comment">// 新增UIContext成员</span>
  private dragRefOffset: number = <span class="hljs-number">0</span>
  offsetY: number = <span class="hljs-number">0</span>
  private ITEM_INTV: number = <span class="hljs-number">0</span>

  constructor(arr: Array&lt;T&gt;, intv: number, uiContext: UIContext) {
    this.arr = arr;
    this.uiContext = uiContext;
    this.modify = new Array&lt;ListItemModify&gt;()
    this.ITEM_INTV = intv
    arr.forEach(() =&gt; {
      this.modify.push(new ListItemModify())
    })
  }

  itemMove(index: number, newIndex: number): <span class="hljs-type">void</span> {
    let tmp = this.arr.splice(index, <span class="hljs-number">1</span>) <span class="hljs-comment">// 移除当前传入的index</span>
    this.arr.splice(newIndex, <span class="hljs-number">0</span>, tmp[<span class="hljs-number">0</span>]) <span class="hljs-comment">// 将当前移除的index插入到数组前一个位置</span>
    let tmp2 = this.modify.splice(index, <span class="hljs-number">1</span>)
    this.modify.splice(newIndex, <span class="hljs-number">0</span>, tmp2[<span class="hljs-number">0</span>])
  }

  setDragRef(item: T): <span class="hljs-type">void</span> {
    this.dragRefOffset = <span class="hljs-number">0</span>
  }

  onMove(item: T, offset: number) {
    this.offsetY = offset - this.dragRefOffset <span class="hljs-comment">// 逐帧计算传入的offect，每满足一个item高度时，进入下方if逻辑，更新dragRefOffset的值</span>
    let index = this.arr.indexOf(item) <span class="hljs-comment">// 在数组中查找传入的item</span>
    this.modify[index].offsetY = this.offsetY
    <span class="hljs-keyword">if</span> (this.offsetY &lt; -this.ITEM_INTV / <span class="hljs-number">2</span>) { <span class="hljs-comment">// 通过判断使指定的item逐一移动到首位</span>
      <span class="hljs-comment">// 使用interpolatingSpring曲线生成弹簧动画</span>
      this.uiContext.animateTo({ curve: curves.interpolatingSpring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">400</span>, <span class="hljs-number">38</span>) }, () =&gt; {
        this.offsetY += this.ITEM_INTV <span class="hljs-comment">// 调整偏移量实现平滑移动</span>
        this.dragRefOffset -= this.ITEM_INTV <span class="hljs-comment">// 移动的总偏移量</span>
        console.info(`item offsetY ${this.offsetY} dragRefOffset ${this.dragRefOffset}`);
        this.itemMove(index, index - <span class="hljs-number">1</span>) <span class="hljs-comment">// 执行列表项位置交换</span>
      })
    }
  }

  getModify(item: T): ListItemModify {
    let index = this.arr.indexOf(item)
    <span class="hljs-keyword">return</span> this.modify[index]
  }
}

@Entry
@Component
<span class="hljs-keyword">struct</span> ListAutoSortExample {
  @State private arr: Array&lt;number&gt; = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
  @State dragSortCtrl: DragSortCtrl&lt;number&gt; = new DragSortCtrl&lt;number&gt;(this.arr, <span class="hljs-number">120</span>, this.getUIContext())
  @State firstListItemGroupCount: number = <span class="hljs-number">3</span>
  private listScroll: ListScroller = new ListScroller()
  private backAnimator: AnimatorResult | null = null

  @Builder
  itemEnd(item: number, index: number) {
    Row() {
      Button(<span class="hljs-string">"To TOP"</span>).margin(<span class="hljs-string">"4vp"</span>).onClick(() =&gt; {
        console.info(`item number item ${item} index ${index}`);
        this.listScroll.closeAllSwipeActions({
          onFinish: () =&gt; {
            this.dragSortCtrl.setDragRef(item)
            let length = <span class="hljs-number">120</span> * (this.arr.indexOf(item))
            this.backAnimator = this.getUIContext()?.createAnimator({ <span class="hljs-comment">// 创建弹簧动画</span>
              duration: <span class="hljs-number">1000</span>,
              easing: <span class="hljs-string">"interpolating-spring(0, 1, 150, 24)"</span>,
              delay: <span class="hljs-number">0</span>,
              fill: <span class="hljs-string">"none"</span>,
              direction: <span class="hljs-string">"normal"</span>,
              iterations: <span class="hljs-number">1</span>,
              begin: <span class="hljs-number">0</span>,
              end: -length
            })
            this.backAnimator.onFrame = (value) =&gt; { <span class="hljs-comment">// 逐帧回调更新位置</span>
              this.dragSortCtrl.onMove(item, value) <span class="hljs-comment">// 处理list的移动替换动效</span>
            }
            this.backAnimator.onFinish = () =&gt; {}
            this.backAnimator.play() <span class="hljs-comment">// 启动动画</span>
          }
        })
      })
    }.padding(<span class="hljs-string">"4vp"</span>).justifyContent(FlexAlign.SpaceEvenly)
  }

  @Builder
  header(title: <span class="hljs-built_in">string</span>) {
    Row() {
      Text(title)
    }
  }

  build() {
    Row() {
      Column() {
        List({ space: <span class="hljs-number">20</span>, scroller: this.listScroll }) {
          ListItemGroup({ header: this.header(<span class="hljs-string">'first ListItemGroup'</span>), space: <span class="hljs-number">20</span> }) {
            ForEach(this.arr, (item: number, index) =&gt; {
              <span class="hljs-keyword">if</span> (index &lt; this.firstListItemGroupCount) {
                ListItem() {
                  Text(<span class="hljs-string">'' + item)
                    .width('</span><span class="hljs-number">100</span>%<span class="hljs-string">')
                    .height(100)
                    .fontSize(16)
                    .borderRadius(10)
                    .textAlign(TextAlign.Center)
                    .backgroundColor(0xFFFFFF)
                }
                .swipeAction({
                  end: this.itemEnd(item, index)
                })
                .clip(true)
                .attributeModifier(this.dragSortCtrl.getModify(item)) // 动态设置属性修改
                .borderRadius(10)
                .margin({ left: 20, right: 20 })
              }
            })
          }
          ListItemGroup({ header: this.header('</span>second ListItemGroup<span class="hljs-number">'</span>), space: <span class="hljs-number">20</span> }) {
            ForEach(this.arr, (item: number, index) =&gt; {
              <span class="hljs-keyword">if</span> (index &gt; this.firstListItemGroupCount - <span class="hljs-number">1</span>) {
                ListItem() {
                  Text(<span class="hljs-string">'' + item)
                    .width('</span><span class="hljs-number">100</span>%<span class="hljs-string">')
                    .height(100)
                    .fontSize(16)
                    .borderRadius(10)
                    .textAlign(TextAlign.Center)
                    .backgroundColor(0xFFFFFF)
                }
                .swipeAction({
                  end: this.itemEnd(item, index)
                })
                .clip(true)
                .attributeModifier(this.dragSortCtrl.getModify(item))
                .borderRadius(10)
                .margin({ left: 20, right: 20 })
              }
            })
          }
        }
        .padding({ top: 20 })
        .height("100%")
      }
    }.backgroundColor(0xDCDCDC)
  }
}
</span></code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么有了物理表，还需要逻辑表？这4个核心场景讲透]]></title>    <link>https://juejin.cn/post/7589250237070065674</link>    <guid>https://juejin.cn/post/7589250237070065674</guid>    <pubDate>2025-12-30T12:16:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589250237070065674" data-draft-id="7589250237070049290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么有了物理表，还需要逻辑表？这4个核心场景讲透"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T12:16:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Kevin666"/> <meta itemprop="url" content="https://juejin.cn/user/1549628692501449"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么有了物理表，还需要逻辑表？这4个核心场景讲透
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1549628692501449/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Kevin666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:16:49.000Z" title="Tue Dec 30 2025 12:16:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在数据库开发学习中，很多时候往往只会知道物理表和逻辑表是啥，咋用，那这有一个疑问：既然物理表已经能存储数据了，为什么还要额外搞一个“逻辑表”？毕竟逻辑表既不存数据，还要额外定义规则，看起来像是“多此一举”。</p>
<p>其实答案很简单：物理表解决的是“数据怎么存”的问题，而逻辑表解决的是“数据怎么用”的问题。两者的核心目标不同，在企业级数据架构中，缺了谁都不行。</p>
<p>先花2分钟理清两个核心概念，避免后续混淆：</p>
<p><strong>物理表</strong>：数据库中真实存储数据的“容器”，对应磁盘上的文件或数据块。它有明确的存储引擎（比如InnoDB）、字段类型、索引、分区策略，数据一行一行真实落地。你执行“CREATE TABLE”创建的，绝大多数都是物理表。</p>
<p><strong>逻辑表</strong>：对物理表（或多个物理表）的抽象、封装或重组，本身不存储任何数据，只定义“数据如何获取、关联、展示”的规则。本质上，它就是一个“逻辑层面的视图或映射”，你查逻辑表时，其实是它帮你自动对接背后的物理表。</p>
<p>简单说：物理表是“仓库”，负责把数据安全存好；逻辑表是“导购员”，负责把仓库里的货整理好，以你需要的方式呈现出来。下面结合4个真实业务场景，带你看懂逻辑表的核心价值。</p>
<h2 data-id="heading-0">一、场景1：屏蔽存储复杂性，让开发不用“懂存储”</h2>
<p>物理表的设计，优先考虑的是存储效率、查询性能和扩容性。比如为了应对大数据量，会把一张表拆分成多个分表（分库分表），或者把冗余字段拆分到关联表中。但这些存储层面的优化，对业务开发来说却是“负担”——总不能让开发写代码时，还要先搞懂物理表是怎么分的、关联了哪些表吧？</p>
<p>逻辑表的核心作用之一，就是做“翻译层”，把复杂的物理存储逻辑封装起来，让开发只关注业务语义。</p>
<p>举个电商订单系统的例子：</p>
<p>为了应对订单数据的增长，运维把订单表按时间拆成了2张物理表：order_2024（存储2024年订单）和order_2025（存储2025年订单）；同时把订单中的商品信息拆分到order_item表（减少主表冗余）。物理表结构如下（简化版）：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 2024年订单物理表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> order_2024 (
  order_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  user_id <span class="hljs-type">BIGINT</span>,
  pay_amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>),
  create_time DATETIME,
  status TINYINT,  <span class="hljs-comment">-- 1=待支付，2=已支付（数字编码）</span>
  db_partition <span class="hljs-type">INT</span>  <span class="hljs-comment">-- 存储分区字段，业务无感知</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB;

<span class="hljs-comment">-- 2025年订单物理表（结构和2024一致）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> order_2025 (...);

<span class="hljs-comment">-- 订单商品关联物理表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> order_item (
  item_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  order_id <span class="hljs-type">BIGINT</span>,
  product_id <span class="hljs-type">BIGINT</span>,
  product_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)
);
</code></pre>
<p>如果没有逻辑表，开发要查“用户10086在2024-2025年的所有订单+商品信息”，需要写这样的代码：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_2024 <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-comment">-- 手动合并分表</span>
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_2025
) t
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> order_item i <span class="hljs-keyword">ON</span> t.order_id <span class="hljs-operator">=</span> i.order_id
<span class="hljs-keyword">WHERE</span> t.user_id <span class="hljs-operator">=</span> <span class="hljs-number">10086</span> 
  <span class="hljs-keyword">AND</span> t.create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-12-31'</span>
  <span class="hljs-keyword">AND</span> t.db_partition <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">-- 手动过滤存储字段</span>
</code></pre>
<p>不仅代码复杂，还容易出错——比如忘了合并分表、记错status状态码的含义。这时候逻辑表就能派上用场了：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 逻辑表1：合并分表+状态码转义</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_order_main <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> 
  order_id,
  user_id,
  pay_amount,
  create_time,
  <span class="hljs-comment">-- 把数字状态码转成业务易理解的名称</span>
  <span class="hljs-keyword">CASE</span> status <span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'待支付'</span> <span class="hljs-keyword">WHEN</span> <span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'已支付'</span> <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> status_name
<span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_2024 <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_2025
) t
<span class="hljs-keyword">WHERE</span> db_partition <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">-- 屏蔽存储字段</span>

<span class="hljs-comment">-- 逻辑表2：关联订单和商品，形成完整视图</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_order_full <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> 
  o.<span class="hljs-operator">*</span>,
  i.product_id,
  i.product_name
<span class="hljs-keyword">FROM</span> v_order_main o
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> order_item i <span class="hljs-keyword">ON</span> o.order_id <span class="hljs-operator">=</span> i.order_id;
</code></pre>
<p>现在开发查数据，只需要一行简单的SQL：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_order_full 
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">10086</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-12-31'</span>;
</code></pre>
<p>后续如果新增了order_2026分表，只需要修改逻辑表的定义，所有业务代码都不用动——这就是解耦的价值。</p>
<h2 data-id="heading-1">二、场景2：打破数据孤岛，跨库跨表聚合数据</h2>
<p>企业中的数据，很少集中在一张物理表甚至一个数据库里。比如用户信息存在user_db库，订单信息存在trade_db库，行为数据存在behavior_db库。业务要做“用户画像”“综合报表”时，需要把这些分散的数据整合起来，总不能让开发逐个库查询再手动拼接吧？</p>
<p>逻辑表可以轻松实现跨库跨表的数据聚合，让分散的数据“虚拟整合”成一个完整的数据集。</p>
<p>举个用户画像系统的例子：</p>
<p>数据分散在3个库的3张物理表中：</p>
<ul>
<li>user_db.user_base：存储用户基础信息（用户名、手机号、注册时间）</li>
<li>trade_db.user_order_sum：存储用户订单汇总（总订单数、总支付金额）</li>
<li>behavior_db.user_behavior：存储用户行为数据（最后登录时间、访问次数）</li>
</ul>
<p>通过数据库联邦查询或中间件（如MyCat、ShardingSphere）创建逻辑表user_profile，聚合这些数据：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> user_profile <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> 
  ub.user_id,
  ub.username,
  ub.phone,
  ub.register_time,
  uos.total_order_count,
  uos.total_pay_amount,
  ubh.last_login_time
<span class="hljs-keyword">FROM</span> user_db.user_base ub
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> trade_db.user_order_sum uos <span class="hljs-keyword">ON</span> ub.user_id <span class="hljs-operator">=</span> uos.user_id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> behavior_db.user_behavior ubh <span class="hljs-keyword">ON</span> ub.user_id <span class="hljs-operator">=</span> ubh.user_id;
</code></pre>
<p>现在不管是运营查用户信息，还是分析师做报表，直接查user_profile这张逻辑表就行，完全不用关心数据存在哪个库、哪个表——逻辑表帮你搞定了所有关联和聚合。</p>
<h2 data-id="heading-2">三、场景3：精准控制权限，脱敏敏感数据</h2>
<p>物理表中存储的是原始数据，其中可能包含手机号、身份证、支付账号等敏感信息。但不同角色的人员，对数据的访问权限需求不同：比如普通运营只需要看订单金额，财务需要看支付信息但不能看完整账号，管理员才能看全量数据。</p>
<p>如果直接在物理表上做权限控制，要么会导致物理表冗余（为不同角色建不同表），要么会泄露敏感数据。而逻辑表可以精准控制数据可见范围，同时对敏感数据进行脱敏，完美解决这个问题。</p>
<p>举个财务系统的例子：</p>
<p>物理表finance_payment存储了完整的支付数据，包含敏感的支付账号：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> finance_payment (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  order_id <span class="hljs-type">BIGINT</span>,
  user_id <span class="hljs-type">BIGINT</span>,
  pay_account <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),  <span class="hljs-comment">-- 敏感字段：支付账号</span>
  pay_amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>),
  pay_time DATETIME
);
</code></pre>
<p>基于这张物理表，创建3张不同的逻辑表，适配不同角色：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 逻辑表1：普通运营视图（隐藏敏感字段）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_finance_operation <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> order_id, pay_amount, pay_time <span class="hljs-keyword">FROM</span> finance_payment;

<span class="hljs-comment">-- 逻辑表2：财务视图（脱敏支付账号）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_finance_accountant <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> 
  id, order_id, user_id,
  <span class="hljs-comment">-- 脱敏处理：显示前4位和后4位，中间用*代替</span>
  CONCAT(<span class="hljs-keyword">LEFT</span>(pay_account,<span class="hljs-number">4</span>), <span class="hljs-string">'****'</span>, <span class="hljs-keyword">RIGHT</span>(pay_account,<span class="hljs-number">4</span>)) <span class="hljs-keyword">AS</span> pay_account_desensitized,
  pay_amount, pay_time
<span class="hljs-keyword">FROM</span> finance_payment;

<span class="hljs-comment">-- 逻辑表3：管理员视图（全字段访问）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_finance_admin <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> finance_payment;
</code></pre>
<p>然后给不同角色分配不同逻辑表的查询权限：</p>
<ul>
<li>普通运营 → 只能查v_finance_operation，看不到敏感字段；</li>
<li>财务人员 → 只能查v_finance_accountant，看到的是脱敏后的支付账号；</li>
<li>管理员 → 可以查v_finance_admin，查看全量数据。</li>
</ul>
<p>这样既满足了不同角色的工作需求，又保障了数据安全，而物理表本身无需做任何修改。</p>
<h2 data-id="heading-3">四、场景4：适配多业务场景，避免物理表冗余</h2>
<p>同一套物理表，可能需要适配不同的业务场景。比如商品表，生鲜业务需要关注重量、过期时间，家电业务需要关注保修期，秒杀业务只需要关注价格和库存。如果为每个场景都建一张物理表，会导致大量冗余数据；但如果用一张物理表包含所有字段，又会让业务看到很多无关字段，增加理解成本。</p>
<p>逻辑表可以为不同业务场景做“个性化映射”，从同一套物理表中筛选出对应场景需要的字段，避免物理表冗余。</p>
<p>举个商品系统的例子：</p>
<p>物理表product存储了通用的商品信息，包含生鲜、家电、秒杀等多个场景的字段：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> product (
  product_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
  category_id <span class="hljs-type">INT</span>,
  price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>),
  stock <span class="hljs-type">INT</span>,
  weight <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">8</span>,<span class="hljs-number">2</span>),  <span class="hljs-comment">-- 生鲜需要</span>
  expire_time DATETIME, <span class="hljs-comment">-- 生鲜需要</span>
  warranty_period <span class="hljs-type">INT</span>   <span class="hljs-comment">-- 家电需要</span>
);
</code></pre>
<p>为不同场景创建专属逻辑表：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 逻辑表1：生鲜商品视图（筛选生鲜相关字段）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_product_fresh <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> product_id, name, price, stock, weight, expire_time
<span class="hljs-keyword">FROM</span> product <span class="hljs-keyword">WHERE</span> category_id <span class="hljs-operator">=</span> <span class="hljs-number">101</span>;  <span class="hljs-comment">-- 101=生鲜分类</span>

<span class="hljs-comment">-- 逻辑表2：家电商品视图（筛选家电相关字段）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_product_appliance <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> product_id, name, price, stock, warranty_period
<span class="hljs-keyword">FROM</span> product <span class="hljs-keyword">WHERE</span> category_id <span class="hljs-operator">=</span> <span class="hljs-number">201</span>;  <span class="hljs-comment">-- 201=家电分类</span>

<span class="hljs-comment">-- 逻辑表3：秒杀商品视图（筛选秒杀相关字段）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_product_seckill <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> product_id, name, price, stock
<span class="hljs-keyword">FROM</span> product <span class="hljs-keyword">WHERE</span> stock <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> price <span class="hljs-operator">&lt;</span> <span class="hljs-number">100</span>;  <span class="hljs-comment">-- 秒杀商品条件</span>
</code></pre>
<p>这样一来，每个业务场景都只操作自己的逻辑表，看不到无关字段，代码更简洁；后续新增场景（比如美妆），只需新增一张逻辑表，物理表完全不用动。</p>
<h2 data-id="heading-4">最后：物理表和逻辑表的核心区别总结</h2>
<p>用一张表帮你理清两者的核心差异：</p>






























<table><thead><tr><th>对比维度</th><th>物理表</th><th>逻辑表</th></tr></thead><tbody><tr><td>数据存储</td><td>实际存储数据，对应磁盘文件</td><td>不存储数据，只定义查询规则</td></tr><tr><td>设计目标</td><td>优先保障存储效率、性能、稳定性</td><td>优先保障业务易用性、灵活性、安全性</td></tr><tr><td>耦合性</td><td>与存储层强耦合</td><td>与业务层强耦合，与存储层解耦</td></tr><tr><td>变更成本</td><td>高，修改会影响所有依赖的业务</td><td>低，仅修改逻辑规则，不影响物理存储</td></tr></tbody></table>
<p>一句话总结：逻辑表的本质，是“以业务为中心”的抽象层。它一边对接物理表的存储逻辑，一边对接业务的使用需求，让存储和业务解耦——这也是为什么在企业级数据架构中，逻辑表是不可或缺的一环。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PyWebView 移动端适配踩坑实录]]></title>    <link>https://juejin.cn/post/7589475497001238543</link>    <guid>https://juejin.cn/post/7589475497001238543</guid>    <pubDate>2025-12-30T12:38:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589475497001238543" data-draft-id="7589494631005650979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PyWebView 移动端适配踩坑实录"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2025-12-30T12:38:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐叔在学习"/> <meta itemprop="url" content="https://juejin.cn/user/4009253326568761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PyWebView 移动端适配踩坑实录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4009253326568761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐叔在学习
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:38:45.000Z" title="Tue Dec 30 2025 12:38:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前些天，我打算将基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpywebview.flowrl.com%2Fguide%2Ffreezing.html" target="_blank" title="https://pywebview.flowrl.com/guide/freezing.html" ref="nofollow noopener noreferrer">PyWebView</a> 开发的桌面应用适配到移动端，查阅官网时惊喜地发现：<strong>PyWebView 天然支持移动端</strong>！这意味着只要桌面端的界面做好了屏幕自适应，大部分代码可以直接复用到移动端，堪称完美。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aba6f0df0454bf1ad39813a2b7b7f44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZSQ5Y-U5Zyo5a2m5Lmg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767703163&amp;x-signature=%2BLTlHyq%2B4IxNGPbSYj83BnNonqM%3D" alt="" loading="lazy"/></p>
<p>于是，我最近就开始了适配工作。与桌面端不同，PyWebView 移动端的打包依赖于 <strong>Buildozer</strong> 而非 PyInstaller，因此你需要提前熟悉 Buildozer 的使用。可以通过其官方文档学习，也可以参考我之前写过的 <a href="https://juejin.cn/post/7589104492882739252" target="_blank" title="https://juejin.cn/post/7589104492882739252">buildozer打包详解：细说那些我踩过的坑</a>。</p>
<p>正如前文提到，即使使用 Buildozer 成功打包出 APK，仍可能因兼容性或代码问题导致应用闪退。这时，可以将生成的 Java 代码导入 Android Studio 进一步调试。代码路径通常位于：</p>
<pre><code class="hljs">\\wsl.localhost\Ubuntu-22.04\{项目目录}\.buildozer\android\platform\build-arm64-v8a\dists\{项目java代码目录}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa3dcfa8976447c19d7292fbecb52b77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZSQ5Y-U5Zyo5a2m5Lmg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767703163&amp;x-signature=RcDDOH8bcx4QzqwZOtEG6u3Cei4%3D" alt="Android Studio 调试界面" loading="lazy"/></p>
<p>接下来，我将重点分享在适配过程中踩到的几个“坑”及其解决方法。</p>
<hr/>
<h3 data-id="heading-0">1. Gradle 版本问题</h3>
<p>这个问题通常出现在 Android Studio 打开项目时，一般会有明显的版本错误提示。解决方法很简单：按照提示修改 <code>gradle-wrapper.properties</code> 中的版本号，然后点击 <strong>File → Sync Project with Gradle Files</strong>（或工具栏的同步图标 🔄）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14900b67e3004fa4acffc2796cb2e960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZSQ5Y-U5Zyo5a2m5Lmg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767703163&amp;x-signature=fTzEO0TSsSxWzOQtMVnc802L5ic%3D" alt="Gradle 同步操作" loading="lazy"/></p>
<p>如果启动时出现类似下面的错误，同样执行一次同步即可：</p>
<pre><code class="hljs language-sql" lang="sql">Error <span class="hljs-keyword">running</span> <span class="hljs-string">'xxx'</span>
getGradleProjectPath(<span class="hljs-keyword">Module</span>: <span class="hljs-string">'xxx'</span>)<span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-keyword">null</span>
</code></pre>
<hr/>
<h3 data-id="heading-1">2. nativeSetenv 未实现导致闪退</h3>
<p>报错信息类似：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-number">2025</span><span class="hljs-number">-12</span><span class="hljs-number">-29</span> <span class="hljs-number">17</span>:<span class="hljs-number">10</span>:<span class="hljs-number">23.913</span>  <span class="hljs-number">5520</span><span class="hljs-number">-5520</span>  .todos.todolist         com.pywebview.todos.todolist         E  No implementation found <span class="hljs-keyword">for</span> <span class="hljs-keyword">void</span> org.libsdl.app.SDLActivity.nativeSetenv(java.lang.<span class="hljs-built_in">String</span>, java.lang.<span class="hljs-built_in">String</span>) (tried Java_org_libsdl_app_SDLActivity_nativeSetenv and Java_org_libsdl_app_SDLActivity_nativeSetenv__Ljava_lang_String_2Ljava_lang_String_2) - <span class="hljs-keyword">is</span> the <span class="hljs-keyword">library</span> loaded, e.g. System.loadLibrary?
</code></pre>
<p>根据官方说明，该问题通常是因为 Buildozer 配置的架构（如 <code>arm</code>）与模拟器架构（如 <code>x86</code>）不匹配。解决方案是在 <code>buildozer.spec</code> 中添加 <code>x86</code> 支持：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">android.archs</span> = arm64-v8a, armeabi-v7a, x86, x<span class="hljs-number">86_64</span>
</code></pre>
<p>💡温馨提示：实际上只添加 <code>x86</code> 即可，但添加其他架构也没有影响，只是会略微增加应用体积。</p>
<hr/>
<h3 data-id="heading-2">3. ERR_CLEARTEXT_NOT_PERMITTED 权限问题</h3>
<p>该错误通常出现在 <strong>Android 9.0（API 28）及以上版本</strong>，表示应用尝试使用 <strong>非加密的 HTTP 明文通信</strong>，而系统默认禁止此类行为。换句话说，你调用的是 <code>HTTP</code> 而不是 <code>HTTPS</code>。</p>
<p>按照 PyWebView 官网建议，可以在启动脚本中启用 SSL：</p>
<pre><code class="hljs language-python" lang="python">webview.start(ssl=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># 开启 SSL 支持</span>
</code></pre>
<hr/>
<h3 data-id="heading-3">4. 静态资源 404 问题</h3>
<p>如果打包时未正确包含前端资源文件，应用启动后将无法加载 HTML、CSS 或 JS 文件。需要在 <code>buildozer.spec</code> 中配置资源包含规则：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">source.dir</span> = .
<span class="hljs-attr">source.include_exts</span> = py,png,jpg,kv,atlas,html,jar,css,js
<span class="hljs-attr">source.include_patterns</span> = frontend/*,backend/*,lib/*,data/*
</code></pre>
<p>💡温馨提示：建议将启动的 Python 文件放在项目根目录，并命名为 <code>main.py</code>。</p>
<p>如果配置后依然找不到资源，可以检查 Buildozer 构建目录中的 <code>app</code> 文件夹，确认资源是否已被正确打包：</p>
<pre><code class="hljs">\\wsl.localhost\Ubuntu-22.04\{项目目录}\.buildozer\android\app
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72b9395a0cae4a9283fc50db806fff90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZSQ5Y-U5Zyo5a2m5Lmg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767703163&amp;x-signature=AZ1%2BKypUDq5gtIhLZLEgNYk03LM%3D" alt="构建目录结构示例" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">5. JS 报错：TypeError: Cannot read properties of null (reading 'getItem')</h3>
<p>这个问题通常是因为移动端环境中 <code>localStorage</code> 不可用。建议实现一个自定义的存储方案，在系统 <code>localStorage</code> 不可用时自动降级使用。具体实现可咨询 AI 或参考相关前端兼容性方案。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99d5ccd3d96b4534ae8d5c850fbfb3c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZSQ5Y-U5Zyo5a2m5Lmg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767703163&amp;x-signature=3dTVAGa9yLHaEp8sWoqqRXIRsUA%3D" alt="自定义存储方案示意" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">📦 补充：buildozer.spec 关键配置说明</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[app]</span>

<span class="hljs-comment"># 应用名称</span>
<span class="hljs-attr">title</span> = todoList

<span class="hljs-comment"># 包名</span>
<span class="hljs-attr">package.name</span> = todoList

<span class="hljs-comment"># 包域名（反向域名风格）</span>
<span class="hljs-attr">package.domain</span> = com.pywebview.todos

<span class="hljs-comment"># 源码目录</span>
<span class="hljs-attr">source.dir</span> = .

<span class="hljs-comment"># 包含的文件类型</span>
<span class="hljs-attr">source.include_exts</span> = py,png,jpg,kv,atlas,html,jar,css,js

<span class="hljs-comment"># 包含的目录（支持通配符）</span>
<span class="hljs-attr">source.include_patterns</span> = frontend/*,backend/*,lib/*,data/*

<span class="hljs-comment"># 排除的文件类型</span>
<span class="hljs-attr">source.exclude_exts</span> = spec

<span class="hljs-comment"># 排除的目录</span>
<span class="hljs-attr">source.exclude_dirs</span> = bin,build,dist,docs,logo,tests,pywebview.egg-info

<span class="hljs-comment"># 排除的通配路径</span>
<span class="hljs-attr">source.exclude_patterns</span> = venv*/*/*

<span class="hljs-comment"># 应用版本</span>
<span class="hljs-attr">version</span> = <span class="hljs-number">0.1</span>

<span class="hljs-comment"># 依赖的 Python 包</span>
<span class="hljs-attr">requirements</span> = python3,kivy,pywebview,bottle,proxy-tools,typing_extensions,cryptography

<span class="hljs-comment"># 图标文件</span>
<span class="hljs-attr">icon.filename</span> = todo_icon.ico

<span class="hljs-comment"># 屏幕方向：portrait（竖屏）、landscape（横屏）等</span>
<span class="hljs-attr">orientation</span> = portrait

<span class="hljs-comment"># Python 版本</span>
<span class="hljs-attr">osx.python_version</span> = <span class="hljs-number">3</span>

<span class="hljs-comment"># Kivy 版本（PyWebView 在移动端依赖 Kivy）</span>
<span class="hljs-attr">osx.kivy_version</span> = <span class="hljs-number">1.9</span>.<span class="hljs-number">1</span>

<span class="hljs-comment"># 是否全屏</span>
<span class="hljs-attr">fullscreen</span> = <span class="hljs-number">0</span>

<span class="hljs-comment"># 启动画面颜色</span>
android.presplash_color = <span class="hljs-comment">#FFFFFF</span>

<span class="hljs-comment"># 所需权限</span>
<span class="hljs-attr">android.permissions</span> = INTERNET,WRITE_EXTERNAL_STORAGE,READ_EXTERNAL_STORAGE

<span class="hljs-comment"># Android 版本配置</span>
<span class="hljs-attr">android.api</span> = <span class="hljs-number">33</span>
<span class="hljs-attr">android.minapi</span> = <span class="hljs-number">21</span>
<span class="hljs-attr">android.sdk</span> = <span class="hljs-number">33</span>
<span class="hljs-attr">android.ndk</span> = <span class="hljs-number">25</span>b
<span class="hljs-attr">android.ndk_api</span> = <span class="hljs-number">21</span>

<span class="hljs-comment"># 应用主题（隐藏 ActionBar）</span>
<span class="hljs-attr">android.apptheme</span> = @android:style/Theme.Material.NoActionBar

<span class="hljs-comment"># 额外 JAR 包（如 pywebview-android.jar）</span>
<span class="hljs-attr">android.add_jars</span> = lib/pywebview-android.jar

<span class="hljs-comment"># 支持的 CPU 架构</span>
<span class="hljs-attr">android.archs</span> = arm64-v8a, armeabi-v7a, x86, x<span class="hljs-number">86_64</span>

<span class="hljs-comment"># 允许 Android 自动备份（API ≥ 23）</span>
<span class="hljs-attr">android.allow_backup</span> = <span class="hljs-literal">True</span>
</code></pre>
<p>更多配置可参考 PyWebView 官方示例：<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fr0x0r%2Fpywebview%2Fblob%2Fa2b8d0449b206db75f9f364639b85db6eac7f07e%2Fexamples%2Ftodos%2Fbuildozer.spec" target="_blank" title="https://github.com/r0x0r/pywebview/blob/a2b8d0449b206db75f9f364639b85db6eac7f07e/examples/todos/buildozer.spec" ref="nofollow noopener noreferrer">github.com/r0x0r/pyweb…</a></p>
<hr/>
<p>希望这篇记录能帮助你顺利将 PyWebView 应用部署到移动端。如有疑问，欢迎留言交流。如果觉得有用，别忘了点赞、收藏与关注哦！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面试官：介绍一下SYN泛洪是什么？]]></title>    <link>https://juejin.cn/post/7589262021562449961</link>    <guid>https://juejin.cn/post/7589262021562449961</guid>    <pubDate>2025-12-30T12:51:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589262021562449961" data-draft-id="7589466238240636970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面试官：介绍一下SYN泛洪是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T12:51:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="沐浴露z"/> <meta itemprop="url" content="https://juejin.cn/user/1883894812774922"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面试官：介绍一下SYN泛洪是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1883894812774922/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    沐浴露z
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:51:09.000Z" title="Tue Dec 30 2025 12:51:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当面试官问这个问题的时候，不要被 “SYN 泛洪” 这个名词给震慑到，其实面试官就是想知道计算机网络中关于 DDoS 攻击和 TCP 建立连接三次握手的相关知识的考核。不要担心，接下来将详细介绍一下 SYN 泛洪及其相关知识。</p>
<h2 data-id="heading-0">什么是 SYN 泛洪？</h2>
<p>攻击者向目标服务器发送大量的伪造源 IP 的 SYN 报文，服务端每收到一次 SYN 请求就会为其分配资源，内核会把这个连接放到半连接队列里，并向客户端返回 SYN + ACK，如果客户端返回 ACK，就把其对应的连接放到全连接队列里。但是由于这些伪造的客户端不会返回 ACK，因此这些连接会一直待在半连接队列里。服务器为了维护这些连接会耗尽自身内存，然后拒绝为后续的连接请求服务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/684f88f433974a3189909755f53b8e22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5rW06Zyyeg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767703868&amp;x-signature=yN2HMb52h6ZmldYUmM7wla48JHE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">解决方案</h2>
<h3 data-id="heading-2">增强网络基础措施</h3>
<p>提升网络带宽、增加服务器的处理能力和承载能力，通过增强基础设施的能力来抵御攻击</p>
<h3 data-id="heading-3">SYN Cookie</h3>
<p>使用 SYN Cookie 的目的就是绕过半连接队列的情况下建立连接。服务端收到 SYN 报文后，<strong>不分配半连接资源</strong>，而是通过源 IP、目的 IP、端口、时间戳等信息，经加密算法生成一个 “SYN Cookie” 放到第二次握手 SYN+ACK 的序列号中。客户端收到带 Cookie 的 SYN + ACK 并回复 ACK 时，服务端验证序列号的合法性，若合法则直接建立连接。</p>
<h3 data-id="heading-4">半连接队列优化</h3>
<p>增大内核参数 <strong>somaxconn</strong>（最大监听队列长度），提升服务端处理并发连接的能力。减少 <strong>tcp_synack_retries</strong>（SYN+ACK 报文的重传次数，默认 5 次，可降低至 2-3 次），缩短半连接的超时时间，加快资源释放。调大 netdev_max_backlog这个队列用于接收网络处理不过来的数据包，但个人感觉调大了用处不大，攻击者伪造的 SYN 请求也能更大</p>
<h2 data-id="heading-5">拓展：什么是 DDoS 攻击？</h2>
<p>SYN 泛洪攻击只是 DDoS 攻击的一种，DDoS，即分布式拒绝服务。顾名思义，DDoS 攻击的目的就是通过某种手段让正常的请求无法获得其服务。</p>
<p>是通过什么手段呢？攻击者通过控制<strong>海量僵尸主机组成的僵尸网络</strong>，从多个分布式节点同时向目标（服务器 / 网络 / 应用）发起恶意流量或请求，耗尽其带宽、CPU、内存、连接数等核心资源，使目标无法处理合法用户请求，最终导致服务中断或瘫痪。</p>
<h3 data-id="heading-6">常见的攻击类型：</h3>
<ul>
<li>网络层攻击，如 UDP 反射攻击</li>
<li>传输层攻击，如 SYN 泛洪</li>
<li>会话层攻击，如 SSL 连接攻击</li>
<li>应用层攻击，如 DNS 泛洪，HTTP 泛洪</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[# Spring Boot 钩子全集实战（四）：`SpringApplicationRunListener.environmentPrepared()` 详解]]></title>    <link>https://juejin.cn/post/7589513539845652515</link>    <guid>https://juejin.cn/post/7589513539845652515</guid>    <pubDate>2025-12-30T13:47:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589513539845652515" data-draft-id="7589462007528718370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="# Spring Boot 钩子全集实战（四）：`SpringApplicationRunListener.environmentPrepared()` 详解"/> <meta itemprop="keywords" content="Java,Spring,面试"/> <meta itemprop="datePublished" content="2025-12-30T13:47:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Web天梯之路"/> <meta itemprop="url" content="https://juejin.cn/user/2825061103052843"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            # Spring Boot 钩子全集实战（四）：`SpringApplicationRunListener.environmentPrepared()` 详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2825061103052843/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Web天梯之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T13:47:03.000Z" title="Tue Dec 30 2025 13:47:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上一篇中，我们深入剖析了配置加载阶段的核心扩展点 <code>EnvironmentPostProcessor</code>，解决了配置中心化、加密解密、动态覆盖等核心问题。今天，我们将聚焦 <strong>Spring Boot 环境准备完成阶段的关键扩展点</strong>——<code>SpringApplicationRunListener.environmentPrepared()</code>，它是连接「环境初始化」与「容器创建」的桥梁，也是实现环境校验、配置增强、启动上下文传递的核心入口。</p>
<h2 data-id="heading-0">一、什么是 <code>environmentPrepared()</code>？</h2>
<p><code>SpringApplicationRunListener.environmentPrepared()</code> 是 <code>SpringApplicationRunListener</code> 生命周期中第二个核心回调方法，触发时机具有明确的边界特征：</p>
<ul>
<li><strong>触发时机</strong>：<code>Environment</code> 完全初始化（包含所有 <code>EnvironmentPostProcessor</code> 处理结果），但 <code>ApplicationContext</code> 尚未创建；</li>
<li><strong>核心状态</strong>：所有配置源（配置中心、本地文件、环境变量、启动参数）已加载完成，配置最终生效；</li>
<li><strong>执行顺序</strong>：早于 <code>ApplicationContext</code> 初始化；</li>
<li><strong>核心能力</strong>：可读取最终生效的配置、校验环境合法性、扩展环境上下文、终止非法启动流程。</li>
</ul>
<blockquote>
<p>✅ <strong>核心价值</strong>：在容器创建前对最终生效的环境做「最终校验」和「上下文增强」，是拦截非法环境、传递启动上下文的最后一道关卡。</p>
</blockquote>
<p>生产环境中，该扩展点常用于解决「环境合法性校验」「启动上下文传递」「多环境隔离兜底」「配置最终增强」等问题。</p>
<h2 data-id="heading-1">二、场景 1：环境合法性终极校验（拦截非法部署）</h2>
<h3 data-id="heading-2">业务痛点</h3>
<p>生产环境中，即使通过 <code>EnvironmentPostProcessor</code> 做了配置校验，仍可能出现以下问题：</p>
<ul>
<li>配置中心拉取的配置与本地残留配置冲突，导致最终生效配置非法；</li>
<li>多环境配置叠加后超出合理范围（如生产环境使用测试数据库地址）；</li>
<li>启动参数覆盖配置中心配置，导致环境污染；</li>
<li>非法环境（如生产代码部署到测试机器）无法提前拦截。</li>
</ul>
<h3 data-id="heading-3">解决方案</h3>
<p>基于 <code>environmentPrepared()</code> 对最终生效的环境做「终极校验」，校验不通过直接终止启动，避免非法部署导致的生产事故。</p>
<h4 data-id="heading-4">实现代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.listener;
​
<span class="hljs-keyword">import</span> org.springframework.boot.ConfigurableBootstrapContext;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplicationRunListener;
<span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;
<span class="hljs-keyword">import</span> org.springframework.core.env.MutablePropertySources;
<span class="hljs-keyword">import</span> org.springframework.core.env.PropertySource;
<span class="hljs-keyword">import</span> org.springframework.util.StringUtils;
​
<span class="hljs-keyword">import</span> java.net.InetAddress;
<span class="hljs-keyword">import</span> java.net.UnknownHostException;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;
​
<span class="hljs-comment">/**
 * 环境合法性终极校验监听器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnvValidationRunListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SpringApplicationRunListener</span> {
​
    <span class="hljs-comment">// 生产环境允许的IP段（生产环境可从配置中心/权限系统获取）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Set&lt;String&gt; PROD_ALLOWED_IP_SEGMENTS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
    <span class="hljs-comment">// 生产环境必须的配置前缀</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] PROD_REQUIRED_CONFIGS = {
            <span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"app.prod.mode"</span>, <span class="hljs-string">"app.nacos.server-addr"</span>
    };
    <span class="hljs-comment">// 生产环境禁止的配置特征（防止测试配置污染）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] PROD_FORBIDDEN_CONFIG_FEATURES = {
            <span class="hljs-string">"test-mysql"</span>, <span class="hljs-string">"localhost"</span>, <span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-string">"dev-"</span>
    };
​
    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// 初始化生产环境允许的IP段</span>
        PROD_ALLOWED_IP_SEGMENTS.add(<span class="hljs-string">"10.0."</span>);
        PROD_ALLOWED_IP_SEGMENTS.add(<span class="hljs-string">"172.16."</span>);
        PROD_ALLOWED_IP_SEGMENTS.add(<span class="hljs-string">"192.168.10."</span>);
    }
​
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext,
                                    ConfigurableEnvironment environment)</span> {
        System.out.println(<span class="hljs-string">"[环境校验] 开始终极环境合法性校验"</span>);
​
        <span class="hljs-comment">// 1. 获取最终激活的环境</span>
        String[] activeProfiles = environment.getActiveProfiles();
        <span class="hljs-type">String</span> <span class="hljs-variable">activeEnv</span> <span class="hljs-operator">=</span> activeProfiles.length &gt; <span class="hljs-number">0</span> ? activeProfiles[<span class="hljs-number">0</span>] : <span class="hljs-string">"dev"</span>;
        System.out.printf(<span class="hljs-string">"[环境校验] 当前激活环境：%s%n"</span>, activeEnv);
​
        <span class="hljs-comment">// 2. 按环境执行差异化校验</span>
        <span class="hljs-keyword">switch</span> (activeEnv) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"prod"</span>:
                validateProdEnvironment(environment);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"test"</span>:
                validateTestEnvironment(environment);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"dev"</span>:
                validateDevEnvironment(environment);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"[环境校验] 不支持的环境："</span> + activeEnv);
        }
​
        System.out.println(<span class="hljs-string">"[环境校验] 环境合法性校验通过"</span>);
    }
​
    <span class="hljs-comment">/**
     * 生产环境终极校验
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateProdEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 校验1：生产环境必须部署在指定IP段</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> InetAddress.getLocalHost().getHostAddress();
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isAllowedIp</span> <span class="hljs-operator">=</span> PROD_ALLOWED_IP_SEGMENTS.stream().anyMatch(ip::startsWith);
            <span class="hljs-keyword">if</span> (!isAllowedIp) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(
                        String.format(<span class="hljs-string">"[环境校验] 生产环境部署在非法IP段：%s，仅允许：%s"</span>,
                                ip, PROD_ALLOWED_IP_SEGMENTS)
                );
            }
​
            <span class="hljs-comment">// 校验2：生产环境必须包含核心配置</span>
            <span class="hljs-keyword">for</span> (String configKey : PROD_REQUIRED_CONFIGS) {
                <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> environment.getProperty(configKey);
                <span class="hljs-keyword">if</span> (!StringUtils.hasText(value)) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"[环境校验] 生产环境缺失核心配置："</span> + configKey);
                }
            }
​
            <span class="hljs-comment">// 校验3：生产环境禁止包含测试配置特征</span>
            <span class="hljs-type">MutablePropertySources</span> <span class="hljs-variable">propertySources</span> <span class="hljs-operator">=</span> environment.getPropertySources();
            <span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; propertySource : propertySources) {
                <span class="hljs-keyword">if</span> (propertySource.getName().startsWith(<span class="hljs-string">"system"</span>)) {
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">for</span> (String forbiddenFeature : PROD_FORBIDDEN_CONFIG_FEATURES) {
                    <span class="hljs-keyword">for</span> (String configKey : PROD_REQUIRED_CONFIGS) {
                        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> environment.getProperty(configKey);
                        <span class="hljs-keyword">if</span> (StringUtils.hasText(value) &amp;&amp; value.contains(forbiddenFeature)) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(
                                    String.format(<span class="hljs-string">"[环境校验] 生产环境配置包含非法特征：%s = %s（禁止特征：%s）"</span>,
                                            configKey, value, forbiddenFeature)
                            );
                        }
                    }
                }
            }
​
            <span class="hljs-comment">// 校验4：生产环境必须开启生产模式</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">prodMode</span> <span class="hljs-operator">=</span> environment.getProperty(<span class="hljs-string">"app.prod.mode"</span>);
            <span class="hljs-keyword">if</span> (!<span class="hljs-string">"true"</span>.equals(prodMode)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"[环境校验] 生产环境未开启生产模式：app.prod.mode = "</span> + prodMode);
            }
​
        } <span class="hljs-keyword">catch</span> (UnknownHostException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"[环境校验] 获取生产机器IP失败"</span>, e);
        }
    }
​
    <span class="hljs-comment">/**
     * 测试环境校验
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateTestEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment)</span> {
        <span class="hljs-comment">// 测试环境禁止使用生产配置中心地址</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">nacosAddr</span> <span class="hljs-operator">=</span> environment.getProperty(<span class="hljs-string">"app.nacos.server-addr"</span>);
        <span class="hljs-keyword">if</span> (StringUtils.hasText(nacosAddr) &amp;&amp; nacosAddr.contains(<span class="hljs-string">"prod-nacos"</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"[环境校验] 测试环境使用生产配置中心："</span> + nacosAddr);
        }
        <span class="hljs-comment">// 测试环境日志级别必须为DEBUG</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">logLevel</span> <span class="hljs-operator">=</span> environment.getProperty(<span class="hljs-string">"app.log.level"</span>);
        <span class="hljs-keyword">if</span> (!<span class="hljs-string">"DEBUG"</span>.equals(logLevel)) {
            System.out.println(<span class="hljs-string">"[环境校验] 测试环境日志级别非DEBUG，自动修正为DEBUG"</span>);
            environment.getSystemProperties().put(<span class="hljs-string">"app.log.level"</span>, <span class="hljs-string">"DEBUG"</span>);
        }
    }
​
    <span class="hljs-comment">/**
     * 开发环境校验
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateDevEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment)</span> {
        <span class="hljs-comment">// 开发环境允许宽松校验，仅提示非核心问题</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">dbUrl</span> <span class="hljs-operator">=</span> environment.getProperty(<span class="hljs-string">"spring.datasource.url"</span>);
        <span class="hljs-keyword">if</span> (StringUtils.hasText(dbUrl) &amp;&amp; dbUrl.contains(<span class="hljs-string">"prod"</span>)) {
            System.out.println(<span class="hljs-string">"[环境校验] 警告：开发环境使用生产数据库地址，请注意！"</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-5">配置加载</h4>
<p>在 <code>resources/META-INF/spring.factories</code> 中配置：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.SpringApplicationRunListener</span>=\
com.example.demo.listener.EnvValidationRunListener
</code></pre>
<h4 data-id="heading-6">启动测试（生产环境非法 IP 部署）</h4>
<p>启动参数：<code>--spring.profiles.active=prod</code>机器 IP：<code>192.168.1.100</code>（不在生产允许 IP 段）</p>
<h4 data-id="heading-7">错误输出</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-attr">[环境校验]</span> 开始终极环境合法性校验
<span class="hljs-selector-attr">[环境校验]</span> 当前激活环境：<span class="hljs-selector-tag">prod</span>
<span class="hljs-number">2025</span><span class="hljs-selector-tag">-12-14T21</span>:<span class="hljs-number">15</span>:<span class="hljs-number">17.906</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span> <span class="hljs-selector-tag">ERROR</span> <span class="hljs-number">22746</span> <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[           main]</span> <span class="hljs-selector-tag">o</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span>               : <span class="hljs-selector-tag">Application</span> <span class="hljs-selector-tag">run</span> <span class="hljs-selector-tag">failed</span>
​
<span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.IllegalStateException</span>: <span class="hljs-selector-attr">[环境校验]</span> 生产环境部署在非法<span class="hljs-selector-tag">IP</span>段：<span class="hljs-number">127.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>，仅允许：<span class="hljs-selector-attr">[10.0., 172.16., 192.168.10.]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.listener</span><span class="hljs-selector-class">.EnvValidationRunListener</span><span class="hljs-selector-class">.validateProdEnvironment</span>(EnvValidationRunListener.<span class="hljs-attribute">java</span>:<span class="hljs-number">76</span>) ~<span class="hljs-selector-attr">[classes/:na]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.listener</span><span class="hljs-selector-class">.EnvValidationRunListener</span><span class="hljs-selector-class">.environmentPrepared</span>(EnvValidationRunListener.<span class="hljs-attribute">java</span>:<span class="hljs-number">51</span>) ~<span class="hljs-selector-attr">[classes/:na]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplicationRunListeners</span><span class="hljs-selector-class">.lambda</span>$<span class="hljs-selector-tag">environmentPrepared</span>$<span class="hljs-number">2</span>(SpringApplicationRunListeners.<span class="hljs-attribute">java</span>:<span class="hljs-number">64</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.base</span>/<span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Iterable</span><span class="hljs-selector-class">.forEach</span>(Iterable.<span class="hljs-attribute">java</span>:<span class="hljs-number">75</span>) ~<span class="hljs-selector-attr">[na:na]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplicationRunListeners</span><span class="hljs-selector-class">.doWithListeners</span>(SpringApplicationRunListeners.<span class="hljs-attribute">java</span>:<span class="hljs-number">118</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplicationRunListeners</span><span class="hljs-selector-class">.doWithListeners</span>(SpringApplicationRunListeners.<span class="hljs-attribute">java</span>:<span class="hljs-number">112</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplicationRunListeners</span><span class="hljs-selector-class">.environmentPrepared</span>(SpringApplicationRunListeners.<span class="hljs-attribute">java</span>:<span class="hljs-number">63</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span><span class="hljs-selector-class">.prepareEnvironment</span>(SpringApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">353</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span><span class="hljs-selector-class">.run</span>(SpringApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">313</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span><span class="hljs-selector-class">.run</span>(SpringApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">1361</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span><span class="hljs-selector-class">.run</span>(SpringApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">1350</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.DemoApplication</span><span class="hljs-selector-class">.main</span>(DemoApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">11</span>) ~<span class="hljs-selector-attr">[classes/:na]</span>
</code></pre>
<h4 data-id="heading-8">生产价值</h4>
<ul>
<li>拦截非法部署（如生产代码部署到测试机器、测试配置污染生产环境）；</li>
<li>对最终生效的配置做兜底校验，避免配置叠加导致的隐性问题；</li>
<li>按环境差异化校验，兼顾生产环境严格性和开发环境灵活性；</li>
<li>提前终止非法启动流程，避免应用启动后出现生产事故。</li>
</ul>
<h2 data-id="heading-9">三、场景 2：启动上下文传递（跨生命周期共享数据）</h2>
<h3 data-id="heading-10">业务痛点</h3>
<p>Spring Boot 启动生命周期中，不同扩展点之间需要共享上下文数据，但存在以下问题：</p>
<ul>
<li><code>EnvironmentPostProcessor</code> 中生成的上下文数据（如配置中心拉取的元数据）无法传递到 <code>ApplicationContext</code> 初始化阶段；</li>
<li>启动参数解析结果、环境校验结果需要在容器创建后被 <code>@Configuration</code> 类读取；</li>
<li>多扩展点之间共享数据需要依赖全局变量，易出现线程安全问题。</li>
</ul>
<h3 data-id="heading-11">解决方案</h3>
<p>基于 <code>environmentPrepared()</code> 将启动上下文数据注入到 <code>Environment</code> 的「自定义属性源」中，实现跨生命周期的上下文传递，且天然支持线程安全。</p>
<h4 data-id="heading-12">实现代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.listener;
​
<span class="hljs-keyword">import</span> org.springframework.boot.ConfigurableBootstrapContext;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplicationRunListener;
<span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;
<span class="hljs-keyword">import</span> org.springframework.core.env.MapPropertySource;
<span class="hljs-keyword">import</span> org.springframework.core.env.MutablePropertySources;
​
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.UUID;
​
<span class="hljs-comment">/**
 * 启动上下文传递监听器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextTransferRunListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SpringApplicationRunListener</span> {
​
    <span class="hljs-comment">// 上下文属性源名称（确保唯一性）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONTEXT_PROPERTY_SOURCE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"bootStartupContext"</span>;
​
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ContextTransferRunListener</span><span class="hljs-params">(SpringApplication application, String[] args)</span> {
    }
​
​
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext,
                                    ConfigurableEnvironment environment)</span> {
        System.out.println(<span class="hljs-string">"[上下文传递] 开始构建并注入启动上下文"</span>);
​
        <span class="hljs-comment">// 1. 构建启动上下文数据</span>
        Map&lt;String, Object&gt; startupContext = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-comment">// 生成唯一启动ID（用于链路追踪）</span>
        startupContext.put(<span class="hljs-string">"app.startup.id"</span>, UUID.randomUUID().toString());
        <span class="hljs-comment">// 记录启动时间戳</span>
        startupContext.put(<span class="hljs-string">"app.startup.timestamp"</span>, System.currentTimeMillis());
        <span class="hljs-comment">// 记录激活环境</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">activeEnv</span> <span class="hljs-operator">=</span> environment.getActiveProfiles().length &gt; <span class="hljs-number">0</span> ?
                environment.getActiveProfiles()[<span class="hljs-number">0</span>] : <span class="hljs-string">"dev"</span>;
        startupContext.put(<span class="hljs-string">"app.startup.activeEnv"</span>, activeEnv);
        <span class="hljs-comment">// 记录配置中心元数据</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">configCenterVersion</span> <span class="hljs-operator">=</span> environment.getProperty(<span class="hljs-string">"config.center.version"</span>, <span class="hljs-string">"unknown"</span>);
        startupContext.put(<span class="hljs-string">"app.startup.configVersion"</span>, configCenterVersion);
        <span class="hljs-comment">// 记录机器信息</span>
        startupContext.put(<span class="hljs-string">"app.startup.hostname"</span>, System.getenv(<span class="hljs-string">"HOSTNAME"</span>) == <span class="hljs-literal">null</span> ?
                <span class="hljs-string">"unknown"</span> : System.getenv(<span class="hljs-string">"HOSTNAME"</span>));
​
        <span class="hljs-comment">// 2. 将上下文注入Environment（优先级最低，避免覆盖业务配置）</span>
        <span class="hljs-type">MutablePropertySources</span> <span class="hljs-variable">propertySources</span> <span class="hljs-operator">=</span> environment.getPropertySources();
        propertySources.addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(CONTEXT_PROPERTY_SOURCE_NAME, startupContext));
​
        <span class="hljs-comment">// 3. 打印上下文信息（生产环境建议用SLF4J）</span>
        System.out.println(<span class="hljs-string">"[上下文传递] 启动上下文注入完成："</span>);
        startupContext.forEach((key, value) -&gt;
                System.out.printf(<span class="hljs-string">"[上下文传递] %s = %s%n"</span>, key, value));
    }
​
    <span class="hljs-comment">// 提供静态方法，方便其他扩展点/配置类读取上下文</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getStartupContext</span><span class="hljs-params">(ConfigurableEnvironment environment)</span> {
        <span class="hljs-type">MapPropertySource</span> <span class="hljs-variable">propertySource</span> <span class="hljs-operator">=</span> (MapPropertySource) environment.getPropertySources()
                .get(CONTEXT_PROPERTY_SOURCE_NAME);
        <span class="hljs-keyword">return</span> propertySource != <span class="hljs-literal">null</span> ? propertySource.getSource() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    }
}
</code></pre>
<h4 data-id="heading-13">配置加载</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.SpringApplicationRunListener</span>=\
com.example.demo.listener.ContextTransferRunListener
</code></pre>
<h4 data-id="heading-14">在 <code>@Configuration</code> 中读取上下文</h4>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">demo</span>.<span class="hljs-property">config</span>;
​
<span class="hljs-keyword">import</span> com.<span class="hljs-property">example</span>.<span class="hljs-property">demo</span>.<span class="hljs-property">listener</span>.<span class="hljs-property">ContextTransferRunListener</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Bean</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">ConfigurableEnvironment</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">Environment</span>;
​
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;
​
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StartupContextConfig</span> {
​
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">startupId</span>(<span class="hljs-params">Environment environment</span>) {
        <span class="hljs-comment">// 读取启动上下文</span>
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; startupContext = <span class="hljs-title class_">ContextTransferRunListener</span>.<span class="hljs-title function_">getStartupContext</span>((<span class="hljs-title class_">ConfigurableEnvironment</span>) environment);
        <span class="hljs-title class_">String</span> startupId = (<span class="hljs-title class_">String</span>) startupContext.<span class="hljs-title function_">get</span>(<span class="hljs-string">"app.startup.id"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[配置类] 读取到启动ID：%s%n"</span>, startupId);
        <span class="hljs-keyword">return</span> startupId;
    }
}
</code></pre>
<h4 data-id="heading-15">输出</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[上下文传递]</span> 开始构建并注入启动上下文
<span class="hljs-section">[上下文传递]</span> 启动上下文注入完成：
<span class="hljs-section">[上下文传递]</span> <span class="hljs-attr">app.startup.id</span> = a59314ec-<span class="hljs-number">6</span>d2f-<span class="hljs-number">46</span>bc-<span class="hljs-number">9435</span>-eb8f6bd118be
<span class="hljs-section">[上下文传递]</span> <span class="hljs-attr">app.startup.timestamp</span> = <span class="hljs-number">1765718508354</span>
<span class="hljs-section">[上下文传递]</span> <span class="hljs-attr">app.startup.activeEnv</span> = prod
<span class="hljs-section">[上下文传递]</span> <span class="hljs-attr">app.startup.configVersion</span> = unknown
<span class="hljs-section">[上下文传递]</span> <span class="hljs-attr">app.startup.hostname</span> = unknown
​
  .   ____          _            __ _ _
 /\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )___ | '_ | '_| | '_ / _` | \ \ \ \
 \/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |___, | / / / /
 =========|_|==============|___/=/_/_/_/
​
 :: Spring Boot ::                (v3.5.8)
​
2025-12-14T21:21:48.383+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : Starting DemoApplication using Java 21.0.9 with PID 22847 (/Users/wangmingfei/Documents/个人/05 java天梯之路/01 源码/03 每日打卡系列/daily-check-in/springboot钩子/demo/target/classes started by wangmingfei in /Users/wangmingfei/Documents/个人/05 java天梯之路/01 源码/03 每日打卡系列/daily-check-in/springboot钩子/demo)
2025-12-14T21:21:48.384+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : The following 1 profile is active: "prod"
2025-12-14T21:21:48.693+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-12-14T21:21:48.698+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> o.apache.catalina.core.StandardService   : Starting service <span class="hljs-section">[Tomcat]</span>
2025-12-14T21:21:48.699+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> o.apache.catalina.core.StandardEngine    : Starting Servlet engine: <span class="hljs-section">[Apache Tomcat/10.1.49]</span>
2025-12-14T21:21:48.716+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> o.a.c.c.C.<span class="hljs-section">[Tomcat]</span>.<span class="hljs-section">[localhost]</span>.<span class="hljs-section">[/]</span>       : Initializing Spring embedded WebApplicationContext
2025-12-14T21:21:48.716+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 317 ms
<span class="hljs-section">[配置类]</span> 读取到启动ID：a59314ec-6d2f-46bc-9435-eb8f6bd118be
2025-12-14T21:21:48.846+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-12-14T21:21:48.850+08:00  INFO 22847 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : Started DemoApplication in 0.655 seconds (process running for 0.798)
</code></pre>
<h4 data-id="heading-16">生产价值</h4>
<ul>
<li>实现跨启动生命周期的上下文共享，替代全局变量，避免线程安全问题；</li>
<li>启动上下文可包含链路追踪 ID、配置版本、机器信息等，便于问题排查；</li>
<li>上下文数据可被 <code>@Configuration</code>、<code>@Value</code>、其他扩展点读取，使用灵活；</li>
<li>上下文注入到 <code>Environment</code> 中，符合 Spring 生态规范，易于扩展。</li>
</ul>
<h2 data-id="heading-17">四、场景 3：多环境隔离兜底（防止配置逃逸）</h2>
<h3 data-id="heading-18">业务痛点</h3>
<p>生产环境中，多环境配置隔离常出现「配置逃逸」问题：</p>
<ul>
<li>测试环境的配置通过配置中心灰度发布到生产环境；</li>
<li>启动参数 <code>--spring.profiles.active</code> 被篡改，导致生产环境加载测试配置；</li>
<li>容器化部署时，环境变量覆盖导致多环境配置混乱；</li>
<li>配置中心的多环境配置隔离失效，出现跨环境配置泄露。</li>
</ul>
<h3 data-id="heading-19">解决方案</h3>
<p>基于 <code>environmentPrepared()</code> 实现多环境隔离兜底，强制绑定「环境标识」与「配置特征」，即使前面的配置处理环节出现问题，也能通过兜底规则确保环境隔离。</p>
<h4 data-id="heading-20">实现代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.listener;
​
<span class="hljs-keyword">import</span> org.springframework.boot.ConfigurableBootstrapContext;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplicationRunListener;
<span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;
<span class="hljs-keyword">import</span> org.springframework.core.env.MutablePropertySources;
<span class="hljs-keyword">import</span> org.springframework.core.env.PropertySource;
<span class="hljs-keyword">import</span> org.springframework.util.StringUtils;
​
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
​
<span class="hljs-comment">/**
 * 多环境隔离兜底监听器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnvIsolationRunListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SpringApplicationRunListener</span> {
​
    <span class="hljs-comment">// 环境-配置特征绑定规则（生产环境可从配置中心加载）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, EnvConfigRule&gt; ENV_CONFIG_RULES = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
​
    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// 生产环境规则</span>
        ENV_CONFIG_RULES.put(<span class="hljs-string">"prod"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EnvConfigRule</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"prod-mysql"</span>, <span class="hljs-string">"prod-redis"</span>, <span class="hljs-string">"prod-nacos"</span>}, <span class="hljs-comment">// 必须包含的特征</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"test-"</span>, <span class="hljs-string">"dev-"</span>, <span class="hljs-string">"localhost"</span>} <span class="hljs-comment">// 必须排除的特征</span>
        ));
        <span class="hljs-comment">// 测试环境规则</span>
        ENV_CONFIG_RULES.put(<span class="hljs-string">"test"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EnvConfigRule</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"test-mysql"</span>, <span class="hljs-string">"test-redis"</span>},
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"prod-"</span>, <span class="hljs-string">"dev-"</span>}
        ));
        <span class="hljs-comment">// 开发环境规则</span>
        ENV_CONFIG_RULES.put(<span class="hljs-string">"dev"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EnvConfigRule</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"localhost"</span>, <span class="hljs-string">"dev-"</span>},
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"prod-"</span>, <span class="hljs-string">"test-"</span>}
        ));
    }
​
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">EnvIsolationRunListener</span><span class="hljs-params">(SpringApplication application, String[] args)</span> {
    }
​
​
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext,
                                    ConfigurableEnvironment environment)</span> {
        System.out.println(<span class="hljs-string">"[环境隔离] 开始多环境隔离兜底校验"</span>);
​
        <span class="hljs-comment">// 1. 获取最终激活的环境</span>
        String[] activeProfiles = environment.getActiveProfiles();
        <span class="hljs-type">String</span> <span class="hljs-variable">activeEnv</span> <span class="hljs-operator">=</span> activeProfiles.length &gt; <span class="hljs-number">0</span> ? activeProfiles[<span class="hljs-number">0</span>] : <span class="hljs-string">"dev"</span>;
​
        <span class="hljs-comment">// 2. 获取当前环境的隔离规则</span>
        <span class="hljs-type">EnvConfigRule</span> <span class="hljs-variable">rule</span> <span class="hljs-operator">=</span> ENV_CONFIG_RULES.get(activeEnv);
        <span class="hljs-keyword">if</span> (rule == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"[环境隔离] 无隔离规则的环境："</span> + activeEnv);
        }
​
        <span class="hljs-comment">// 3. 遍历所有配置源，校验隔离规则</span>
        <span class="hljs-type">MutablePropertySources</span> <span class="hljs-variable">propertySources</span> <span class="hljs-operator">=</span> environment.getPropertySources();
        <span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; propertySource : propertySources) {
            <span class="hljs-comment">// 跳过系统配置源</span>
            <span class="hljs-keyword">if</span> (propertySource.getName().startsWith(<span class="hljs-string">"system"</span>)) {
                <span class="hljs-keyword">continue</span>;
            }
​
            <span class="hljs-comment">// 核心配置项校验</span>
            String[] coreConfigs = {<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"app.nacos.server-addr"</span>};
            <span class="hljs-keyword">for</span> (String configKey : coreConfigs) {
                <span class="hljs-type">String</span> <span class="hljs-variable">configValue</span> <span class="hljs-operator">=</span> environment.getProperty(configKey);
                <span class="hljs-keyword">if</span> (StringUtils.hasText(configValue)) {
                    <span class="hljs-comment">// 校验必须包含的特征</span>
                    <span class="hljs-type">boolean</span> <span class="hljs-variable">containsRequired</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">for</span> (String requiredFeature : rule.requiredFeatures) {
                        <span class="hljs-keyword">if</span> (configValue.contains(requiredFeature)) {
                            containsRequired = <span class="hljs-literal">true</span>;
                            <span class="hljs-keyword">break</span>;
                        }
                    }
                    <span class="hljs-keyword">if</span> (!containsRequired &amp;&amp; activeEnv.equals(<span class="hljs-string">"prod"</span>)) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(
                                String.format(<span class="hljs-string">"[环境隔离] 生产环境配置缺失必需特征：%s = %s（必需：%s）"</span>,
                                        configKey, configValue, String.join(<span class="hljs-string">","</span>, rule.requiredFeatures))
                        );
                    }
​
                    <span class="hljs-comment">// 校验必须排除的特征</span>
                    <span class="hljs-keyword">for</span> (String forbiddenFeature : rule.forbiddenFeatures) {
                        <span class="hljs-keyword">if</span> (configValue.contains(forbiddenFeature)) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(
                                    String.format(<span class="hljs-string">"[环境隔离] %s环境配置包含非法特征：%s = %s（禁止：%s）"</span>,
                                            activeEnv, configKey, configValue, forbiddenFeature)
                            );
                        }
                    }
                }
            }
        }
​
        <span class="hljs-comment">// 4. 兜底：强制设置环境标识（防止配置逃逸）</span>
        environment.getSystemProperties().put(<span class="hljs-string">"app.env.isolation"</span>, activeEnv);
        System.out.printf(<span class="hljs-string">"[环境隔离] %s环境隔离校验通过，已设置隔离标识%n"</span>, activeEnv);
    }
​
    <span class="hljs-comment">// 环境配置规则内部类</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnvConfigRule</span> {
        <span class="hljs-keyword">private</span> String[] requiredFeatures; <span class="hljs-comment">// 必须包含的特征</span>
        <span class="hljs-keyword">private</span> String[] forbiddenFeatures; <span class="hljs-comment">// 必须排除的特征</span>
​
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">EnvConfigRule</span><span class="hljs-params">(String[] requiredFeatures, String[] forbiddenFeatures)</span> {
            <span class="hljs-built_in">this</span>.requiredFeatures = requiredFeatures;
            <span class="hljs-built_in">this</span>.forbiddenFeatures = forbiddenFeatures;
        }
    }
}
</code></pre>
<h4 data-id="heading-21">配置加载</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.SpringApplicationRunListener</span>=\
com.example.demo.listener.EnvIsolationRunListener
</code></pre>
<h4 data-id="heading-22">application.yml</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://test-mysql:3306/prod_db?useSSL=false</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">prod_user</span>
    <span class="hljs-comment"># 密文存储，前缀标识需要解密</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">redis:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">prod-redis:6379</span>
  <span class="hljs-attr">password:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">app:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">secret:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
</code></pre>
<h4 data-id="heading-23">错误输出（生产环境包含 test 特征）</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-attr">[环境隔离]</span> 开始多环境隔离兜底校验
<span class="hljs-number">2025</span><span class="hljs-selector-tag">-12-14T21</span>:<span class="hljs-number">48</span>:<span class="hljs-number">10.802</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span> <span class="hljs-selector-tag">ERROR</span> <span class="hljs-number">23312</span> <span class="hljs-selector-tag">---</span> <span class="hljs-selector-attr">[           main]</span> <span class="hljs-selector-tag">o</span><span class="hljs-selector-class">.s</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span>               : <span class="hljs-selector-tag">Application</span> <span class="hljs-selector-tag">run</span> <span class="hljs-selector-tag">failed</span>

<span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.IllegalStateException</span>: <span class="hljs-selector-attr">[环境隔离]</span> 生产环境配置缺失必需特征：<span class="hljs-selector-tag">spring</span><span class="hljs-selector-class">.datasource</span><span class="hljs-selector-class">.url</span> = <span class="hljs-selector-tag">jdbc</span>:<span class="hljs-selector-tag">mysql</span>:<span class="hljs-comment">//test-mysql:3306/prod_db?useSSL=false（必需：prod-mysql,prod-redis,prod-nacos）</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.listener</span><span class="hljs-selector-class">.EnvIsolationRunListener</span><span class="hljs-selector-class">.environmentPrepared</span>(EnvIsolationRunListener.<span class="hljs-attribute">java</span>:<span class="hljs-number">82</span>) ~<span class="hljs-selector-attr">[classes/:na]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplicationRunListeners</span><span class="hljs-selector-class">.lambda</span>$<span class="hljs-selector-tag">environmentPrepared</span>$<span class="hljs-number">2</span>(SpringApplicationRunListeners.<span class="hljs-attribute">java</span>:<span class="hljs-number">64</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.base</span>/<span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Iterable</span><span class="hljs-selector-class">.forEach</span>(Iterable.<span class="hljs-attribute">java</span>:<span class="hljs-number">75</span>) ~<span class="hljs-selector-attr">[na:na]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplicationRunListeners</span><span class="hljs-selector-class">.doWithListeners</span>(SpringApplicationRunListeners.<span class="hljs-attribute">java</span>:<span class="hljs-number">118</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplicationRunListeners</span><span class="hljs-selector-class">.doWithListeners</span>(SpringApplicationRunListeners.<span class="hljs-attribute">java</span>:<span class="hljs-number">112</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplicationRunListeners</span><span class="hljs-selector-class">.environmentPrepared</span>(SpringApplicationRunListeners.<span class="hljs-attribute">java</span>:<span class="hljs-number">63</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span><span class="hljs-selector-class">.prepareEnvironment</span>(SpringApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">353</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span><span class="hljs-selector-class">.run</span>(SpringApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">313</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span><span class="hljs-selector-class">.run</span>(SpringApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">1361</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.SpringApplication</span><span class="hljs-selector-class">.run</span>(SpringApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">1350</span>) ~<span class="hljs-selector-attr">[spring-boot-3.5.8.jar:3.5.8]</span>
    <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.DemoApplication</span><span class="hljs-selector-class">.main</span>(DemoApplication.<span class="hljs-attribute">java</span>:<span class="hljs-number">11</span>) ~<span class="hljs-selector-attr">[classes/:na]</span>
</code></pre>
<h4 data-id="heading-24">生产价值</h4>
<ul>
<li>实现多环境配置隔离的最后一道兜底防线，防止配置逃逸；</li>
<li>强制绑定环境与配置特征，即使前面的配置处理环节出错也能拦截；</li>
<li>可动态调整环境规则，适配不同部署架构（如容器化、物理机）；</li>
<li>避免因配置中心隔离失效、启动参数篡改导致的环境污染。</li>
</ul>
<h2 data-id="heading-25">五、场景 4：配置最终增强（动态调整运行参数）</h2>
<h3 data-id="heading-26">业务痛点</h3>
<p>生产环境中，配置最终生效后仍需要根据环境特征动态调整：</p>
<ul>
<li>生产环境需要调大线程池、连接池大小，测试环境调小；</li>
<li>灰度机器需要降低日志级别、开启监控采样；</li>
<li>不同机器规格（CPU / 内存）需要适配不同的 JVM 参数、连接池参数；</li>
<li>配置中心的默认参数无法适配所有机器的硬件特征。</li>
</ul>
<h3 data-id="heading-27">解决方案</h3>
<p>基于 <code>environmentPrepared()</code> 在配置最终生效后、容器创建前，根据机器特征、环境特征动态增强配置，实现「配置自适应」。</p>
<h4 data-id="heading-28">实现代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.listener;

<span class="hljs-keyword">import</span> org.springframework.boot.ConfigurableBootstrapContext;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplicationRunListener;
<span class="hljs-keyword">import</span> org.springframework.context.ConfigurableApplicationContext;
<span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;
<span class="hljs-keyword">import</span> org.springframework.core.env.MutablePropertySources;
<span class="hljs-keyword">import</span> org.springframework.core.env.MapPropertySource;

<span class="hljs-keyword">import</span> java.lang.management.ManagementFactory;
<span class="hljs-keyword">import</span> java.lang.management.OperatingSystemMXBean;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 配置最终增强监听器
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigEnhanceRunListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SpringApplicationRunListener</span> {


    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">environmentPrepared</span><span class="hljs-params">(ConfigurableBootstrapContext bootstrapContext,
                                    ConfigurableEnvironment environment)</span> {
        System.out.println(<span class="hljs-string">"[配置增强] 开始根据机器特征动态增强配置"</span>);

        <span class="hljs-comment">// 1. 获取机器硬件信息</span>
        <span class="hljs-type">OperatingSystemMXBean</span> <span class="hljs-variable">osBean</span> <span class="hljs-operator">=</span> ManagementFactory.getOperatingSystemMXBean();
        <span class="hljs-type">int</span> <span class="hljs-variable">cpuCount</span> <span class="hljs-operator">=</span> osBean.getAvailableProcessors();
        <span class="hljs-comment">// 修复：兼容获取物理内存大小</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">totalMemory</span> <span class="hljs-operator">=</span> getTotalPhysicalMemorySize(osBean); <span class="hljs-comment">// GB</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">activeEnv</span> <span class="hljs-operator">=</span> environment.getActiveProfiles().length &gt; <span class="hljs-number">0</span> ?
                environment.getActiveProfiles()[<span class="hljs-number">0</span>] : <span class="hljs-string">"dev"</span>;

        <span class="hljs-comment">// 2. 打印机器信息</span>
        System.out.printf(<span class="hljs-string">"[配置增强] 机器特征：CPU核心数=%d，内存=%dGB，环境=%s%n"</span>,
                cpuCount, totalMemory, activeEnv);

        <span class="hljs-comment">// 3. 动态增强配置</span>
        Map&lt;String, Object&gt; enhanceConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"prod"</span>.equals(activeEnv)) {
            <span class="hljs-comment">// 生产环境：连接池大小 = CPU核心数 * 2</span>
            enhanceConfig.put(<span class="hljs-string">"spring.datasource.hikari.maximum-pool-size"</span>, cpuCount * <span class="hljs-number">2</span>);
            enhanceConfig.put(<span class="hljs-string">"spring.datasource.hikari.minimum-idle"</span>, cpuCount);
            <span class="hljs-comment">// 生产环境：线程池大小 = CPU核心数 * 4</span>
            enhanceConfig.put(<span class="hljs-string">"app.thread.pool.core-size"</span>, cpuCount * <span class="hljs-number">4</span>);
            enhanceConfig.put(<span class="hljs-string">"app.thread.pool.max-size"</span>, cpuCount * <span class="hljs-number">8</span>);
            <span class="hljs-comment">// 大内存机器（&gt;16GB）调大缓存</span>
            <span class="hljs-keyword">if</span> (totalMemory &gt; <span class="hljs-number">16</span>) {
                enhanceConfig.put(<span class="hljs-string">"spring.cache.redis.time-to-live"</span>, <span class="hljs-string">"3600s"</span>);
                enhanceConfig.put(<span class="hljs-string">"app.redis.pool.max-active"</span>, <span class="hljs-string">"200"</span>);
            } <span class="hljs-keyword">else</span> {
                enhanceConfig.put(<span class="hljs-string">"spring.cache.redis.time-to-live"</span>, <span class="hljs-string">"600s"</span>);
                enhanceConfig.put(<span class="hljs-string">"app.redis.pool.max-active"</span>, <span class="hljs-string">"100"</span>);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"test"</span>.equals(activeEnv)) {
            <span class="hljs-comment">// 测试环境：固定小配置</span>
            enhanceConfig.put(<span class="hljs-string">"spring.datasource.hikari.maximum-pool-size"</span>, <span class="hljs-string">"5"</span>);
            enhanceConfig.put(<span class="hljs-string">"app.thread.pool.core-size"</span>, <span class="hljs-string">"10"</span>);
            enhanceConfig.put(<span class="hljs-string">"spring.cache.redis.time-to-live"</span>, <span class="hljs-string">"60s"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 开发环境：极简配置</span>
            enhanceConfig.put(<span class="hljs-string">"spring.datasource.hikari.maximum-pool-size"</span>, <span class="hljs-string">"2"</span>);
            enhanceConfig.put(<span class="hljs-string">"app.thread.pool.core-size"</span>, <span class="hljs-string">"5"</span>);
        }

        <span class="hljs-comment">// 4. 灰度机器特殊配置</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">hostname</span> <span class="hljs-operator">=</span> System.getenv(<span class="hljs-string">"HOSTNAME"</span>) == <span class="hljs-literal">null</span> ?
                (System.getenv(<span class="hljs-string">"COMPUTERNAME"</span>) == <span class="hljs-literal">null</span> ? <span class="hljs-string">"unknown"</span> : System.getenv(<span class="hljs-string">"COMPUTERNAME"</span>))
                : System.getenv(<span class="hljs-string">"HOSTNAME"</span>);
        <span class="hljs-keyword">if</span> (hostname.contains(<span class="hljs-string">"gray"</span>)) {
            enhanceConfig.put(<span class="hljs-string">"app.log.level"</span>, <span class="hljs-string">"TRACE"</span>);
            enhanceConfig.put(<span class="hljs-string">"app.monitor.sampling.rate"</span>, <span class="hljs-string">"1.0"</span>); <span class="hljs-comment">// 全量采样</span>
            System.out.println(<span class="hljs-string">"[配置增强] 灰度机器，开启全量监控采样"</span>);
        } <span class="hljs-keyword">else</span> {
            enhanceConfig.put(<span class="hljs-string">"app.monitor.sampling.rate"</span>, <span class="hljs-string">"0.1"</span>); <span class="hljs-comment">// 10%采样</span>
        }

        <span class="hljs-comment">// 5. 注入增强配置（优先级高于配置中心，低于启动参数）</span>
        <span class="hljs-comment">// 先判断是否存在configCenterProperties，避免报错</span>
        <span class="hljs-type">MutablePropertySources</span> <span class="hljs-variable">propertySources</span> <span class="hljs-operator">=</span> environment.getPropertySources();
        <span class="hljs-type">String</span> <span class="hljs-variable">targetSource</span> <span class="hljs-operator">=</span> <span class="hljs-string">"configCenterProperties"</span>;
        <span class="hljs-keyword">if</span> (propertySources.contains(targetSource)) {
            propertySources.addBefore(targetSource, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(<span class="hljs-string">"enhanceConfig"</span>, enhanceConfig));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 如果没有配置中心，添加到最后（保证自定义配置生效）</span>
            propertySources.addLast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(<span class="hljs-string">"enhanceConfig"</span>, enhanceConfig));
        }

        <span class="hljs-comment">// 6. 打印增强结果</span>
        System.out.println(<span class="hljs-string">"[配置增强] 动态增强配置完成："</span>);
        enhanceConfig.forEach((key, value) -&gt;
                System.out.printf(<span class="hljs-string">"[配置增强] %s = %s%n"</span>, key, value));
    }

    <span class="hljs-comment">/**
     * 兼容获取物理内存大小（GB）
     * <span class="hljs-doctag">@param</span> osBean 操作系统MXBean
     * <span class="hljs-doctag">@return</span> 物理内存大小（GB），获取失败返回默认值8GB
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getTotalPhysicalMemorySize</span><span class="hljs-params">(OperatingSystemMXBean osBean)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 优先使用Sun/Oracle JDK的实现</span>
            <span class="hljs-keyword">if</span> (osBean <span class="hljs-keyword">instanceof</span> com.sun.management.OperatingSystemMXBean) {
                com.sun.management.<span class="hljs-type">OperatingSystemMXBean</span> <span class="hljs-variable">sunOsBean</span> <span class="hljs-operator">=</span>
                        (com.sun.management.OperatingSystemMXBean) osBean;
                <span class="hljs-comment">// 转换为GB</span>
                <span class="hljs-keyword">return</span> sunOsBean.getTotalPhysicalMemorySize() / (<span class="hljs-number">1024L</span> * <span class="hljs-number">1024L</span> * <span class="hljs-number">1024L</span>);
            }

            <span class="hljs-comment">// 其他JDK实现的兼容处理（如OpenJDK）</span>
            <span class="hljs-comment">// 尝试通过反射调用（防止编译时依赖）</span>
            java.lang.reflect.<span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> osBean.getClass().getMethod(<span class="hljs-string">"getTotalPhysicalMemorySize"</span>);
            <span class="hljs-keyword">if</span> (method != <span class="hljs-literal">null</span>) {
                <span class="hljs-type">Long</span> <span class="hljs-variable">memorySize</span> <span class="hljs-operator">=</span> (Long) method.invoke(osBean);
                <span class="hljs-keyword">return</span> memorySize / (<span class="hljs-number">1024L</span> * <span class="hljs-number">1024L</span> * <span class="hljs-number">1024L</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"[配置增强] 获取物理内存大小失败，使用默认值8GB："</span> + e.getMessage());
        }

        <span class="hljs-comment">// 默认返回8GB</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">8L</span>;
    }
}
</code></pre>
<h4 data-id="heading-29">配置加载</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.SpringApplicationRunListener</span>=\
com.example.demo.listener.ConfigEnhanceRunListener
</code></pre>
<h4 data-id="heading-30">输出</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[配置增强]</span> 开始根据机器特征动态增强配置
<span class="hljs-section">[配置增强]</span> 机器特征：CPU核心数=14，内存=48GB，环境=prod
<span class="hljs-section">[配置增强]</span> 动态增强配置完成：
<span class="hljs-section">[配置增强]</span> <span class="hljs-attr">app.redis.pool.max-active</span> = <span class="hljs-number">200</span>
<span class="hljs-section">[配置增强]</span> <span class="hljs-attr">spring.datasource.hikari.maximum-pool-size</span> = <span class="hljs-number">28</span>
<span class="hljs-section">[配置增强]</span> <span class="hljs-attr">app.thread.pool.max-size</span> = <span class="hljs-number">112</span>
<span class="hljs-section">[配置增强]</span> <span class="hljs-attr">spring.cache.redis.time-to-live</span> = <span class="hljs-number">3600</span>s
<span class="hljs-section">[配置增强]</span> <span class="hljs-attr">app.thread.pool.core-size</span> = <span class="hljs-number">56</span>
<span class="hljs-section">[配置增强]</span> <span class="hljs-attr">app.monitor.sampling.rate</span> = <span class="hljs-number">0.1</span>
<span class="hljs-section">[配置增强]</span> <span class="hljs-attr">spring.datasource.hikari.minimum-idle</span> = <span class="hljs-number">14</span>

  .   ____          _            __ _ _
 /\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )___ | '_ | '_| | '_ / _` | \ \ \ \
 \/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |___, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v3.5.8)

2025-12-14T21:59:21.010+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : Starting DemoApplication using Java 21.0.9 with PID 23462 (/Users/wangmingfei/Documents/个人/05 java天梯之路/01 源码/03 每日打卡系列/daily-check-in/springboot钩子/demo/target/classes started by wangmingfei in /Users/wangmingfei/Documents/个人/05 java天梯之路/01 源码/03 每日打卡系列/daily-check-in/springboot钩子/demo)
2025-12-14T21:59:21.012+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : The following 1 profile is active: "prod"
2025-12-14T21:59:21.326+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-12-14T21:59:21.332+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> o.apache.catalina.core.StandardService   : Starting service <span class="hljs-section">[Tomcat]</span>
2025-12-14T21:59:21.332+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> o.apache.catalina.core.StandardEngine    : Starting Servlet engine: <span class="hljs-section">[Apache Tomcat/10.1.49]</span>
2025-12-14T21:59:21.345+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> o.a.c.c.C.<span class="hljs-section">[Tomcat]</span>.<span class="hljs-section">[localhost]</span>.<span class="hljs-section">[/]</span>       : Initializing Spring embedded WebApplicationContext
2025-12-14T21:59:21.345+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 319 ms
<span class="hljs-section">[配置类]</span> 读取到启动ID：null
2025-12-14T21:59:21.478+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-12-14T21:59:21.482+08:00  INFO 23462 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : Started DemoApplication in 0.669 seconds (process running for 0.815)
</code></pre>
<h4 data-id="heading-31">生产价值</h4>
<ul>
<li>实现配置的硬件自适应，充分利用机器资源；</li>
<li>按环境差异化调整运行参数，兼顾性能与资源消耗；</li>
<li>灰度机器特殊配置，便于问题排查和监控；</li>
<li>无需修改配置中心，动态适配不同机器规格。</li>
</ul>
<h2 data-id="heading-32">六、<code>environmentPrepared()</code> 与 <code>EnvironmentPostProcessor</code> 对比</h2>






























<table><thead><tr><th>特性</th><th><code>EnvironmentPostProcessor</code></th><th><code>SpringApplicationRunListener.environmentPrepared()</code></th></tr></thead><tbody><tr><td>触发时机</td><td>Environment 初始化中（配置加载阶段）</td><td>Environment 初始化完成（配置最终生效后）</td></tr><tr><td>核心能力</td><td>配置加载、修改、加密解密</td><td>环境校验、上下文传递、配置增强、隔离兜底</td></tr><tr><td>配置优先级</td><td>可修改配置源，影响最终配置</td><td>读取最终配置，仅能增强（无法回滚已加载的配置）</td></tr><tr><td>典型场景</td><td>配置中心拉取、配置解密</td><td>环境合法性校验、启动上下文传递</td></tr></tbody></table>
<blockquote>
<p>✅ <strong>最佳实践</strong>：</p>
<ol start="0">
<li><code>EnvironmentPostProcessor</code> 负责「配置的加载与修改」；</li>
<li><code>environmentPrepared()</code> 负责「环境的校验与增强」；</li>
<li>两者配合，实现「配置加载 - 环境校验 - 配置增强」的完整闭环。</li>
</ol>
</blockquote>
<h2 data-id="heading-33">七、总结</h2>
<p><code>SpringApplicationRunListener.environmentPrepared()</code> 是 Spring Boot 启动过程中「环境准备阶段的最后一道关卡」，核心价值体现在：</p>
<ul>
<li><strong>终极校验</strong>：对最终生效的环境做合法性兜底校验，拦截非法部署；</li>
<li><strong>上下文传递</strong>：实现跨生命周期的启动上下文共享，替代全局变量；</li>
<li><strong>环境隔离</strong>：强制绑定环境与配置特征，防止配置逃逸；</li>
<li><strong>配置增强</strong>：根据机器 / 环境特征动态调整运行参数，实现配置自适应。</li>
</ul>
<p>相较于 <code>EnvironmentPostProcessor</code>，<code>environmentPrepared()</code> 更聚焦于「环境层面的兜底与增强」，是构建生产级高可靠应用的关键扩展点。</p>
<p>📌 <strong>关注我</strong>，每天 5 分钟，带你从 Java 小白变身编程高手！</p>
<p>👉 点赞 + 关注 + 转发，让更多小伙伴一起进步！</p>
<p>👉 私信 "SpringBoot 钩子源码" 获取完整源码！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java线程池双雄：ForkJoinPool 和 ThreadPoolExecutor 的区别]]></title>    <link>https://juejin.cn/post/7589454621720199218</link>    <guid>https://juejin.cn/post/7589454621720199218</guid>    <pubDate>2025-12-30T13:54:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589454621720199218" data-draft-id="7589454621720182834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java线程池双雄：ForkJoinPool 和 ThreadPoolExecutor 的区别"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T13:54:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="白衣鸽子"/> <meta itemprop="url" content="https://juejin.cn/user/3072451409619223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java线程池双雄：ForkJoinPool 和 ThreadPoolExecutor 的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3072451409619223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    白衣鸽子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T13:54:58.000Z" title="Tue Dec 30 2025 13:54:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 前言</h2>
<p>在当今多核处理器普及的时代，如何高效利用CPU资源成为提升应用性能的关键。Java并发包中提供了两个强大的线程池实现：<code>ForkJoinPool</code> 和 <code>ThreadPoolExecutor</code>。</p>
<p><strong>这两种线程池不仅仅是API的不同，它们代表了两种截然不同的并发哲学：</strong></p>
<ul>
<li><code>ThreadPoolExecutor</code> 像一支训练有素的军队，每个士兵（线程）执行独立的任务</li>
<li><code>ForkJoinPool</code> 则像一个高效的研发团队，成员们会主动协作，共同攻克复杂问题</li>
</ul>
<p>通过学习本文，你将了解到：</p>
<ul>
<li>为什么 <code>ForkJoinPool</code> 的工作窃取算法如此高效</li>
<li>如何在具体场景中选择最合适的线程池</li>
<li>它们各自的性能特点和最佳实践</li>
</ul>
<p>为了直观展示差异，让我们先看一个简单的代码对比：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadPoolExecutor: 处理独立任务</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    executor.submit(() -&gt; processTask(i)); <span class="hljs-comment">// 每个任务独立执行</span>
}

<span class="hljs-comment">// ForkJoinPool: 处理可分治的任务</span>
<span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>();
pool.invoke(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Integer&gt;() {
    <span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (任务足够小) {
            <span class="hljs-keyword">return</span> 直接计算结果();
        } <span class="hljs-keyword">else</span> {
            拆分任务为子任务();
            <span class="hljs-keyword">return</span> 合并子任务结果();
        }
    }
});
</code></pre>
<p>这两个代码片段揭示了最核心的区别：<code>ThreadPoolExecutor</code> 适合处理<strong>独立的、离散的</strong>任务，而 <code>ForkJoinPool</code> 擅长处理<strong>可递归分解的</strong>任务。</p>
<h2 data-id="heading-1">2. 工作原理</h2>
<h3 data-id="heading-2">2.1 设计理念的区别</h3>
<p><strong>ThreadPoolExecutor：生产者-消费者模型</strong></p>
<ul>
<li>线程是<strong>消费者</strong>，任务队列是<strong>缓冲区</strong></li>
<li>任务由外部提交到队列，线程从中取出执行</li>
<li>适用于处理大量独立的、短期任务</li>
</ul>
<p><strong>ForkJoinPool：分而治之（递归分解）模型</strong></p>
<ul>
<li>专为可递归分解的任务设计</li>
<li>任务自己可以产生子任务（Fork），并等待结果（Join）</li>
<li>适用于计算密集型、可并行分解的任务</li>
</ul>
<h3 data-id="heading-3">2.2 任务调度机制的区别</h3>
<pre><code class="hljs language-text" lang="text">ThreadPoolExecutor架构：
┌─────────────────────────────────────────────┐
│              共享任务队列                     │
│  ┌─────┬─────┬─────┬─────┬─────┐           │
│  │任务1│任务2│任务3│任务4│任务5│...        │
│  └─────┴─────┴─────┴─────┴─────┘           │
├─────────────────────────────────────────────┤
│ 工作线程1 │ 工作线程2 │ 工作线程3 │ 工作线程4 │
│  (获取任务)  (获取任务)  (获取任务)  (获取任务) │
└─────────────────────────────────────────────┘

ForkJoinPool架构（工作窃取）：
┌─────────────────────────────────────────────┐
│ 线程1队列：│ 线程2队列：│ 线程3队列：│ 线程4队列：│
│ [任务1-1]  │ [任务2-1]  │ [任务3-1]  │ [任务4-1]  │
│ [任务1-2]  │ [任务2-2]  │ [任务3-2]  │ [任务4-2]  │
│ [任务1-3]← │ [任务2-3]  │           │           │
└────────────┴────────────┴────────────┴────────────┘
         ↑           │
         线程3从线程1队列尾部窃取任务
</code></pre>
<p>最核心的区别：</p>
<ul>
<li>ForkJoinPool 架构下，某个线程工作队列完成时，会从其他线程工作队列窃取任务</li>
<li>ThreadPoolExecutor 架构下，每个线程工作完成时，会从共享队列窃取任务</li>
</ul>
<h2 data-id="heading-4">3. 使用场景</h2>
<h3 data-id="heading-5">3.1 核心场景对比</h3>



































<table><thead><tr><th>场景特征</th><th><strong>优先选择 ForkJoinPool</strong></th><th><strong>优先选择 ThreadPoolExecutor</strong></th></tr></thead><tbody><tr><td><strong>任务类型</strong></td><td>计算密集型、可递归分解</td><td>I/O密集型、任务独立且离散</td></tr><tr><td><strong>任务关系</strong></td><td>任务有父子依赖，需要合并结果</td><td>任务之间无关联，各自独立</td></tr><tr><td><strong>负载特性</strong></td><td>任务执行时间相对均匀</td><td>任务执行时间差异可能很大</td></tr><tr><td><strong>阻塞情况</strong></td><td>几乎没有I/O阻塞或等待</td><td>包含网络、数据库、文件I/O</td></tr><tr><td><strong>典型应用</strong></td><td>并行排序、矩阵运算、递归遍历</td><td>Web服务、消息队列、批处理</td></tr></tbody></table>
<h3 data-id="heading-6">3.2 ForkJoinPool 的黄金场景</h3>
<p>要理解 ForkJoinPool 的真正价值，我们需要先理解它解决的问题，让我们通过一个具体的代码示例来揭示这个问题的本质。</p>
<h4 data-id="heading-7">3.2.1 问题的核心：负载不均衡</h4>
<p>考虑这样一个场景：我们需要处理一个数组，但是<strong>每个元素的处理时间与它的下标成正比</strong>。这意味着处理数组末尾的元素比处理开头的元素要慢得多。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 模拟负载不均衡的计算任务</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">processElement</span><span class="hljs-params">(<span class="hljs-type">int</span> index, <span class="hljs-type">double</span> value)</span> {
    <span class="hljs-type">double</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> value;
    
    <span class="hljs-comment">// 关键：计算量与下标成正比！</span>
    <span class="hljs-comment">// index=0 时，内循环0次</span>
    <span class="hljs-comment">// index=999999 时，内循环999次</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; index % <span class="hljs-number">1000</span>; j++) {
        result += Math.sqrt(j) * <span class="hljs-number">0.0001</span>;
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>如果用传统的 ThreadPoolExecutor，我们会这样分割任务：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ThreadPoolExecutor的典型用法：均匀分割</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);
<span class="hljs-type">int</span> <span class="hljs-variable">totalElements</span> <span class="hljs-operator">=</span> <span class="hljs-number">1_000_000</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">chunkSize</span> <span class="hljs-operator">=</span> totalElements / <span class="hljs-number">4</span>;  <span class="hljs-comment">// 每份25万个元素</span>

<span class="hljs-comment">// 4个线程分别处理：</span>
<span class="hljs-comment">// 线程1: 元素 0-249,999     ← 计算量最小，最快完成</span>
<span class="hljs-comment">// 线程2: 元素 250,000-499,999 ← 中等速度</span>
<span class="hljs-comment">// 线程3: 元素 500,000-749,999 ← 较慢</span>
<span class="hljs-comment">// 线程4: 元素 750,000-999,999 ← 计算量最大，最慢！</span>
</code></pre>
<p>这里就暴露了 ThreadPoolExecutor 的局限：<strong>前3个线程完成后会空闲等待，而第4个线程还在辛苦工作</strong>。</p>
<h4 data-id="heading-8">3.2.2 ForkJoinPool 的解决方案</h4>
<p>ForkJoinPool 通过工作窃取算法完美解决了这个问题，让我们看看它的实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UnbalancedTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Double&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span>[] data;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> start, end;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Double <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 如果任务足够小，直接计算</span>
        <span class="hljs-keyword">if</span> (end - start &lt;= THRESHOLD) {
            <span class="hljs-type">double</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {
                sum += processElement(i, data[i]);
            }
            <span class="hljs-keyword">return</span> sum;
        }
        
        <span class="hljs-comment">// 递归分解任务</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> (start + end) / <span class="hljs-number">2</span>;
        <span class="hljs-type">UnbalancedTask</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnbalancedTask</span>(data, start, mid);
        <span class="hljs-type">UnbalancedTask</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnbalancedTask</span>(data, mid, end);
        
        <span class="hljs-comment">// 关键：异步执行左子任务</span>
        left.fork();
        
        <span class="hljs-comment">// 同步执行右子任务，然后等待左子任务完成</span>
        <span class="hljs-type">Double</span> <span class="hljs-variable">rightResult</span> <span class="hljs-operator">=</span> right.compute();
        <span class="hljs-type">Double</span> <span class="hljs-variable">leftResult</span> <span class="hljs-operator">=</span> left.join();
        
        <span class="hljs-keyword">return</span> leftResult + rightResult;
    }
}
</code></pre>
<h4 data-id="heading-9">3.2.3 工作窃取的实际效果</h4>
<p>工作窃取机制的运行过程是这样的：</p>
<pre><code class="hljs language-makefile" lang="makefile">初始状态（按均匀分割的思路）：
<span class="hljs-section">线程1: [处理0-25万] ← 预计很快</span>
<span class="hljs-section">线程2: [处理25-50万] ← 中等速度  </span>
<span class="hljs-section">线程3: [处理50-75万] ← 较慢</span>
<span class="hljs-section">线程4: [处理75-100万] ← 最慢</span>

实际运行过程：
1. 线程1很快完成自己的任务
2. 线程1不会闲着，它会从<span class="hljs-string">"最忙的"</span>线程4那里<span class="hljs-string">"窃取"</span>一部分工作
3. 线程2完成后，也会去帮助线程4
4. 所有线程都保持忙碌，直到所有工作完成
</code></pre>
<p>这就是为什么在我们的性能测试中，对于这种负载不均衡的任务：</p>
<pre><code class="hljs language-makefile" lang="makefile">测试结果：
<span class="hljs-section">ThreadPoolExecutor: 779ms</span>
<span class="hljs-section">ForkJoinPool: 646ms</span>
ForkJoinPool 快 17.1%
</code></pre>
<h4 data-id="heading-10">3.2.4 适合 ForkJoinPool 的典型场景</h4>
<p>基于这个原理，ForkJoinPool 特别适合以下场景：</p>
<ol>
<li><strong>并行排序算法</strong>（快速排序、归并排序）</li>
</ol>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">// 快速排序的分区操作会产生大小不等的子数组</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">pivot</span> <span class="hljs-operator">=</span> partition(array, low, high);
    <span class="hljs-comment">// 左右两部分的大小可能差异很大</span>
</code></pre>
<ol start="2">
<li><strong>树形结构处理</strong></li>
</ol>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">// 树的深度可能不均，某些分支很深，某些很浅</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span> {
        List&lt;TreeNode&gt; children;  <span class="hljs-comment">// 子节点数量不确定</span>
    }
</code></pre>
<ol start="3">
<li><strong>递归算法优化</strong></li>
</ol>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">// 如斐波那契数列、动态规划等</span>
    <span class="hljs-comment">// 某些子问题的计算量远大于其他子问题</span>
</code></pre>
<h3 data-id="heading-11">3.3 ThreadPoolExecutor 的黄金场景</h3>
<p>理解了 ForkJoinPool 的适用场景后，ThreadPoolExecutor 的优势领域就更加清晰了。</p>
<h4 data-id="heading-12">3.3.1 独立且均衡的任务</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 任务：统计100万个随机数中小于0.5的数量</span>
<span class="hljs-type">double</span>[] data = generateRandomData(<span class="hljs-number">1_000_000</span>);

<span class="hljs-comment">// ThreadPoolExecutor的完美用法</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);
<span class="hljs-type">int</span> <span class="hljs-variable">chunkSize</span> <span class="hljs-operator">=</span> data.length / <span class="hljs-number">4</span>;

List&lt;Future&lt;Integer&gt;&gt; futures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> i * chunkSize;
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> (i == <span class="hljs-number">3</span>) ? data.length : (i + <span class="hljs-number">1</span>) * chunkSize;
    
    futures.add(executor.submit(() -&gt; {
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-comment">// 每个线程处理自己的一段，工作量基本相同</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> start; j &lt; end; j++) {
            <span class="hljs-keyword">if</span> (data[j] &lt; <span class="hljs-number">0.5</span>) count++;
        }
        <span class="hljs-keyword">return</span> count;
    }));
}
</code></pre>
<p><strong>为什么这种场景下 ThreadPoolExecutor 表现更好？</strong></p>
<ol>
<li><strong>任务完全独立</strong>：每个统计任务不依赖其他任务的结果</li>
<li><strong>工作量均衡</strong>：每25万个元素的统计时间基本相同</li>
<li><strong>无需复杂协调</strong>：简单累加即可得到最终结果</li>
</ol>
<p>测试结果证明了这一点：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">ThreadPoolExecutor: 18ms</span>
<span class="hljs-section">ForkJoinPool: 129ms</span>
ThreadPoolExecutor 快 86.0%
</code></pre>
<h4 data-id="heading-13">3.3.2 I/O密集型应用</h4>
<p>ThreadPoolExecutor 的另一个优势领域是处理 I/O 密集型任务：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Web服务器处理HTTP请求</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">serverExecutor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">100</span>);

<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-type">Socket</span> <span class="hljs-variable">clientSocket</span> <span class="hljs-operator">=</span> serverSocket.accept();
    serverExecutor.submit(() -&gt; {
        <span class="hljs-comment">// 处理HTTP请求（包含网络I/O等待）</span>
        handleHttpRequest(clientSocket);
    });
}
</code></pre>
<p><strong>适合 ThreadPoolExecutor 的原因</strong>：</p>
<ul>
<li>请求之间完全独立</li>
<li>主要时间花在I/O等待上，CPU计算很少</li>
<li>可以配置比CPU核心数更多的线程</li>
</ul>
<h4 data-id="heading-14">3.3.3 批处理作业</h4>
<p>当有大量已知的、独立的作业需要处理时：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 批量处理文件</span>
List&lt;File&gt; files = scanDirectory(<span class="hljs-string">"/data"</span>);  <span class="hljs-comment">// 获得1000个文件</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">batchExecutor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">8</span>);

<span class="hljs-keyword">for</span> (File file : files) {
    batchExecutor.submit(() -&gt; {
        processFile(file);  <span class="hljs-comment">// 处理单个文件</span>
    });
}
</code></pre>
<h4 data-id="heading-15">3.3.4 任务队列管理</h4>
<p>ThreadPoolExecutor 提供了灵活的任务队列策略：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 可以根据需求选择不同的队列</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
    <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">60</span>, TimeUnit.SECONDS,
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;()  <span class="hljs-comment">// 无界队列</span>
);

<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
    <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">60</span>, TimeUnit.SECONDS,
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">100</span>)  <span class="hljs-comment">// 有界队列</span>
);

<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
    <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">60</span>, TimeUnit.SECONDS,
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;&gt;()  <span class="hljs-comment">// 直接传递队列</span>
);
</code></pre>
<h2 data-id="heading-16">4. 性能对比核心代码</h2>
<p>这里给出一个可以直接运行的代码示例供参考：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FinalComparison</span> {  
  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {  
        System.out.println(<span class="hljs-string">"===== 两个线程池的真正区别场景对比 =====\n"</span>);  
  
        <span class="hljs-comment">// 场景1：ThreadPoolExecutor优势场景（任务均衡）  </span>
        System.out.println(<span class="hljs-string">"【场景1】均衡的独立任务 - ThreadPoolExecutor优势"</span>);  
        testBalancedTasks();  
  
        System.out.println(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span>.repeat(<span class="hljs-number">60</span>) + <span class="hljs-string">"\n"</span>);  
  
        <span class="hljs-comment">// 场景2：ForkJoinPool优势场景（任务不均衡）  </span>
        System.out.println(<span class="hljs-string">"【场景2】不均衡的递归任务 - ForkJoinPool优势"</span>);  
        testUnbalancedTasks();  
    }  
  
    <span class="hljs-comment">// ========== 场景1：ThreadPoolExecutor优势 ==========    static void testBalancedTasks() throws Exception {  </span>
        System.out.println(<span class="hljs-string">"任务：计算100万个随机数中小于0.5的数量"</span>);  
        System.out.println(<span class="hljs-string">"特点：任务可以均衡分割，每个子任务工作量相同"</span>);  
  
        <span class="hljs-type">double</span>[] data = generateRandomData(<span class="hljs-number">1_000_000</span>);  
  
        <span class="hljs-comment">// 1. ThreadPoolExecutor实现（均衡分割）  </span>
        System.out.println(<span class="hljs-string">"\n1. ThreadPoolExecutor（均衡分割4份）："</span>);  
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();  
  
        <span class="hljs-type">int</span> <span class="hljs-variable">threadCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;  
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">tpe</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(threadCount);  
  
        <span class="hljs-type">int</span> <span class="hljs-variable">chunkSize</span> <span class="hljs-operator">=</span> data.length / threadCount;  
        List&lt;Future&lt;Integer&gt;&gt; futures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  
  
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; threadCount; i++) {  
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">startIdx</span> <span class="hljs-operator">=</span> i * chunkSize;  
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">endIdx</span> <span class="hljs-operator">=</span> (i == threadCount - <span class="hljs-number">1</span>) ? data.length : (i + <span class="hljs-number">1</span>) * chunkSize;  
  
            futures.add(tpe.submit(() -&gt; {  
                <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> startIdx; j &lt; endIdx; j++) {  
                    <span class="hljs-keyword">if</span> (data[j] &lt; <span class="hljs-number">0.5</span>) {  
                        count++;  
                    }  
                }  
                <span class="hljs-keyword">return</span> count;  
            }));  
        }  
  
        <span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  
        <span class="hljs-keyword">for</span> (Future&lt;Integer&gt; future : futures) {  
            total += future.get();  
        }  
  
        <span class="hljs-type">long</span> <span class="hljs-variable">tpeTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;  
        tpe.shutdown();  
  
        System.out.println(<span class="hljs-string">"   结果: "</span> + total);  
        System.out.println(<span class="hljs-string">"   耗时: "</span> + tpeTime + <span class="hljs-string">"ms"</span>);  
        System.out.println(<span class="hljs-string">"   优点：简单直接，任务均衡，无额外开销"</span>);  
  
        <span class="hljs-comment">// 2. ForkJoinPool实现（生成大量小任务）  </span>
        System.out.println(<span class="hljs-string">"\n2. ForkJoinPool（递归分解到10个元素）："</span>);  
        start = System.currentTimeMillis();  
  
        <span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">fjp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>(threadCount);  
        <span class="hljs-type">CountTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountTask</span>(data, <span class="hljs-number">0</span>, data.length, <span class="hljs-number">10</span>); <span class="hljs-comment">// 阈值10  </span>
        <span class="hljs-type">int</span> <span class="hljs-variable">fjpResult</span> <span class="hljs-operator">=</span> fjp.invoke(task);  
  
        <span class="hljs-type">long</span> <span class="hljs-variable">fjpTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;  
        fjp.shutdown();  
  
        System.out.println(<span class="hljs-string">"   结果: "</span> + fjpResult);  
        System.out.println(<span class="hljs-string">"   耗时: "</span> + fjpTime + <span class="hljs-string">"ms"</span>);  
        System.out.println(<span class="hljs-string">"   缺点：生成了大量小任务对象，管理开销大"</span>);  
  
        <span class="hljs-comment">// 对比  </span>
        System.out.println(<span class="hljs-string">"\n✅ 对比结果："</span>);  
        System.out.println(<span class="hljs-string">"ThreadPoolExecutor（均衡分割）: "</span> + tpeTime + <span class="hljs-string">"ms"</span>);  
        System.out.println(<span class="hljs-string">"ForkJoinPool（递归分解）: "</span> + fjpTime + <span class="hljs-string">"ms"</span>);  
  
        <span class="hljs-keyword">if</span> (tpeTime &lt; fjpTime) {  
            <span class="hljs-type">double</span> <span class="hljs-variable">advantage</span> <span class="hljs-operator">=</span> (fjpTime - tpeTime) * <span class="hljs-number">100.0</span> / fjpTime;  
            System.out.printf(<span class="hljs-string">"✅ ThreadPoolExecutor 快 %.1f%%\n"</span>, advantage);  
            System.out.println(<span class="hljs-string">"原因：任务均衡时，简单分割比生成大量小任务更高效"</span>);  
        }  
    }  
  
    <span class="hljs-comment">// ========== 场景2：ForkJoinPool优势 ==========    static void testUnbalancedTasks() {  </span>
        System.out.println(<span class="hljs-string">"任务：计算100万个元素的复杂统计（计算量与下标成正比）"</span>);  
        System.out.println(<span class="hljs-string">"特点：元素位置越靠后，计算量越大，负载极不均衡"</span>);  
  
        <span class="hljs-type">double</span>[] data = generateRandomData(<span class="hljs-number">1_000_000</span>);  
  
        <span class="hljs-comment">// 1. ThreadPoolExecutor实现（均衡分割 - 不适合）  </span>
        System.out.println(<span class="hljs-string">"\n1. ThreadPoolExecutor（均衡分割4份）："</span>);  
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();  
  
        <span class="hljs-type">int</span> <span class="hljs-variable">threadCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;  
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">tpe</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(threadCount);  
  
        <span class="hljs-type">int</span> <span class="hljs-variable">chunkSize</span> <span class="hljs-operator">=</span> data.length / threadCount;  
        List&lt;Future&lt;Double&gt;&gt; futures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  
  
        <span class="hljs-keyword">try</span> {  
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; threadCount; i++) {  
                <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">startIdx</span> <span class="hljs-operator">=</span> i * chunkSize;  
                <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">endIdx</span> <span class="hljs-operator">=</span> (i == threadCount - <span class="hljs-number">1</span>) ? data.length : (i + <span class="hljs-number">1</span>) * chunkSize;  
  
                futures.add(tpe.submit(() -&gt; {  
                    <span class="hljs-type">double</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  
                    <span class="hljs-comment">// 关键：计算量与元素下标成正比！  </span>
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> startIdx; j &lt; endIdx; j++) {  
                        <span class="hljs-keyword">if</span> (data[j] &lt; <span class="hljs-number">0.5</span>) {  
                            sum += data[j];  
                        }  
                        <span class="hljs-comment">// 模拟计算量与下标成正比  </span>
                        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; k &lt; j % <span class="hljs-number">1000</span>; k++) {  
                            sum += Math.sqrt(k) * <span class="hljs-number">0.0001</span>;  
                        }  
                    }  
                    <span class="hljs-keyword">return</span> sum;  
                }));  
            }  
  
            <span class="hljs-type">double</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  
            <span class="hljs-keyword">for</span> (Future&lt;Double&gt; future : futures) {  
                total += future.get();  
            }  
  
            <span class="hljs-type">long</span> <span class="hljs-variable">tpeTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;  
            tpe.shutdown();  
  
            System.out.println(<span class="hljs-string">"   结果: "</span> + String.format(<span class="hljs-string">"%.2f"</span>, total));  
            System.out.println(<span class="hljs-string">"   耗时: "</span> + tpeTime + <span class="hljs-string">"ms"</span>);  
            System.out.println(<span class="hljs-string">"   问题：第四个线程（处理最后25%数据）耗时最长"</span>);  
            System.out.println(<span class="hljs-string">"         前三个线程完成后就空闲了"</span>);  
  
            <span class="hljs-comment">// 2. ForkJoinPool实现（工作窃取能解决不均衡问题）  </span>
            System.out.println(<span class="hljs-string">"\n2. ForkJoinPool（工作窃取解决不均衡）："</span>);  
            start = System.currentTimeMillis();  
  
            <span class="hljs-type">ForkJoinPool</span> <span class="hljs-variable">fjp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForkJoinPool</span>(threadCount);  
            <span class="hljs-type">ComplexCountTask</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComplexCountTask</span>(data, <span class="hljs-number">0</span>, data.length, <span class="hljs-number">10000</span>);  
            <span class="hljs-type">Double</span> <span class="hljs-variable">fjpResult</span> <span class="hljs-operator">=</span> fjp.invoke(task);  
  
            <span class="hljs-type">long</span> <span class="hljs-variable">fjpTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;  
            fjp.shutdown();  
  
            System.out.println(<span class="hljs-string">"   结果: "</span> + String.format(<span class="hljs-string">"%.2f"</span>, fjpResult));  
            System.out.println(<span class="hljs-string">"   耗时: "</span> + fjpTime + <span class="hljs-string">"ms"</span>);  
            System.out.println(<span class="hljs-string">"   优点：工作窃取让空闲线程帮助处理慢任务"</span>);  
  
            <span class="hljs-comment">// 对比  </span>
            System.out.println(<span class="hljs-string">"\n✅ 对比结果："</span>);  
            System.out.println(<span class="hljs-string">"ThreadPoolExecutor: "</span> + tpeTime + <span class="hljs-string">"ms"</span>);  
            System.out.println(<span class="hljs-string">"ForkJoinPool: "</span> + fjpTime + <span class="hljs-string">"ms"</span>);  
  
            <span class="hljs-keyword">if</span> (fjpTime &lt; tpeTime) {  
                <span class="hljs-type">double</span> <span class="hljs-variable">advantage</span> <span class="hljs-operator">=</span> (tpeTime - fjpTime) * <span class="hljs-number">100.0</span> / tpeTime;  
                System.out.printf(<span class="hljs-string">"✅ ForkJoinPool 快 %.1f%%\n"</span>, advantage);  
                System.out.println(<span class="hljs-string">"原因：工作窃取自动平衡了不均衡的负载"</span>);  
            }  
  
        } <span class="hljs-keyword">catch</span> (Exception e) {  
            e.printStackTrace();  
        }  
    }  
  
    <span class="hljs-comment">// ========== 辅助类 ==========  </span>
    <span class="hljs-comment">// 简单的计数任务（用于场景1）  </span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Integer&gt; {  
        <span class="hljs-keyword">final</span> <span class="hljs-type">double</span>[] data;  
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> start, end;  
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> threshold;  
  
        CountTask(<span class="hljs-type">double</span>[] data, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end, <span class="hljs-type">int</span> threshold) {  
            <span class="hljs-built_in">this</span>.data = data;  
            <span class="hljs-built_in">this</span>.start = start;  
            <span class="hljs-built_in">this</span>.end = end;  
            <span class="hljs-built_in">this</span>.threshold = threshold;  
        }  
  
        <span class="hljs-meta">@Override</span>  
        <span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> {  
            <span class="hljs-keyword">if</span> (end - start &lt;= threshold) {  
                <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {  
                    <span class="hljs-keyword">if</span> (data[i] &lt; <span class="hljs-number">0.5</span>) {  
                        count++;  
                    }  
                }  
                <span class="hljs-keyword">return</span> count;  
            }  
  
            <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> (start + end) / <span class="hljs-number">2</span>;  
            <span class="hljs-type">CountTask</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountTask</span>(data, start, mid, threshold);  
            <span class="hljs-type">CountTask</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountTask</span>(data, mid, end, threshold);  
  
            left.fork();  
            <span class="hljs-type">Integer</span> <span class="hljs-variable">rightResult</span> <span class="hljs-operator">=</span> right.compute();  
            <span class="hljs-type">Integer</span> <span class="hljs-variable">leftResult</span> <span class="hljs-operator">=</span> left.join();  
  
            <span class="hljs-keyword">return</span> leftResult + rightResult;  
        }  
    }  
  
    <span class="hljs-comment">// 复杂的计数任务（用于场景2，计算量与下标成正比）  </span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComplexCountTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecursiveTask</span>&lt;Double&gt; {  
        <span class="hljs-keyword">final</span> <span class="hljs-type">double</span>[] data;  
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> start, end;  
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> threshold;  
  
        ComplexCountTask(<span class="hljs-type">double</span>[] data, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end, <span class="hljs-type">int</span> threshold) {  
            <span class="hljs-built_in">this</span>.data = data;  
            <span class="hljs-built_in">this</span>.start = start;  
            <span class="hljs-built_in">this</span>.end = end;  
            <span class="hljs-built_in">this</span>.threshold = threshold;  
        }  
  
        <span class="hljs-meta">@Override</span>  
        <span class="hljs-keyword">protected</span> Double <span class="hljs-title function_">compute</span><span class="hljs-params">()</span> {  
            <span class="hljs-keyword">if</span> (end - start &lt;= threshold) {  
                <span class="hljs-type">double</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {  
                    <span class="hljs-keyword">if</span> (data[i] &lt; <span class="hljs-number">0.5</span>) {  
                        sum += data[i];  
                    }  
                    <span class="hljs-comment">// 计算量与下标成正比  </span>
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; i % <span class="hljs-number">1000</span>; j++) {  
                        sum += Math.sqrt(j) * <span class="hljs-number">0.0001</span>;  
                    }  
                }  
                <span class="hljs-keyword">return</span> sum;  
            }  
  
            <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> (start + end) / <span class="hljs-number">2</span>;  
            <span class="hljs-type">ComplexCountTask</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComplexCountTask</span>(data, start, mid, threshold);  
            <span class="hljs-type">ComplexCountTask</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComplexCountTask</span>(data, mid, end, threshold);  
  
            left.fork();  
            <span class="hljs-type">Double</span> <span class="hljs-variable">rightResult</span> <span class="hljs-operator">=</span> right.compute();  
            <span class="hljs-type">Double</span> <span class="hljs-variable">leftResult</span> <span class="hljs-operator">=</span> left.join();  
  
            <span class="hljs-keyword">return</span> leftResult + rightResult;  
        }  
    }  
  
    <span class="hljs-keyword">static</span> <span class="hljs-type">double</span>[] generateRandomData(<span class="hljs-type">int</span> size) {  
        <span class="hljs-type">double</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[size];  
        <span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>(<span class="hljs-number">42</span>);  
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++) {  
            data[i] = random.nextDouble();  
        }  
        <span class="hljs-keyword">return</span> data;  
    }  
}
</code></pre>
<p><strong>代码运行结果大致输出如下：</strong></p>
<pre><code class="hljs language-text" lang="text">===== 两个线程池的真正区别场景对比 =====

【场景1】均衡的独立任务 - ThreadPoolExecutor优势
任务：计算100万个随机数中小于0.5的数量
特点：任务可以均衡分割，每个子任务工作量相同

1. ThreadPoolExecutor（均衡分割4份）：
   结果: 499798
   耗时: 18ms
   优点：简单直接，任务均衡，无额外开销

2. ForkJoinPool（递归分解到10个元素）：
   结果: 499798
   耗时: 129ms
   缺点：生成了大量小任务对象，管理开销大

✅ 对比结果：
ThreadPoolExecutor（均衡分割）: 18ms
ForkJoinPool（递归分解）: 129ms
✅ ThreadPoolExecutor 快 86.0%
原因：任务均衡时，简单分割比生成大量小任务更高效

============================================================

【场景2】不均衡的递归任务 - ForkJoinPool优势
任务：计算100万个元素的复杂统计（计算量与下标成正比）
特点：元素位置越靠后，计算量越大，负载极不均衡

1. ThreadPoolExecutor（均衡分割4份）：
   结果: 966038.64
   耗时: 779ms
   问题：第四个线程（处理最后25%数据）耗时最长
         前三个线程完成后就空闲了

2. ForkJoinPool（工作窃取解决不均衡）：
   结果: 966038.64
   耗时: 646ms
   优点：工作窃取让空闲线程帮助处理慢任务

✅ 对比结果：
ThreadPoolExecutor: 779ms
ForkJoinPool: 646ms
✅ ForkJoinPool 快 17.1%
原因：工作窃取自动平衡了不均衡的负载
</code></pre>
<h2 data-id="heading-17">5. 总结</h2>
<p>通过实际的代码分析和性能测试，我们可以清楚地看到：</p>
<ol>
<li><strong>ForkJoinPool</strong> 不是 ThreadPoolExecutor 的替代品，而是<strong>补充品</strong></li>
<li>每个线程池都有自己明确的<strong>优势领域</strong></li>
<li>选择的关键在于<strong>理解任务的内在特性</strong></li>
<li>错误的选择会导致显著的性能损失（如场景1中 ForkJoinPool 慢7倍）</li>
</ol>
<p>记住这个简单的原则：</p>
<ul>
<li><strong>要解决的问题是"分而治之"的</strong> → 考虑 ForkJoinPool</li>
<li><strong>要执行的是一批"独立任务"</strong> → 考虑 ThreadPoolExecutor</li>
</ul>
<p>正确选择线程池，就像选择工具一样：用斧头劈柴，用锯子锯木。用对了工具，事半功倍；用错了工具，事倍功半。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nextjs学习1：回顾服务端渲染SSR]]></title>    <link>https://juejin.cn/post/7589466238240423978</link>    <guid>https://juejin.cn/post/7589466238240423978</guid>    <pubDate>2025-12-30T11:49:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589466238240423978" data-draft-id="7582182817108656154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nextjs学习1：回顾服务端渲染SSR"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-30T11:49:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一江东流水"/> <meta itemprop="url" content="https://juejin.cn/user/1151943917181880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nextjs学习1：回顾服务端渲染SSR
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943917181880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一江东流水
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T11:49:46.000Z" title="Tue Dec 30 2025 11:49:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">服务端渲染的发展历史</h2>
<h3 data-id="heading-1">传统的服务端渲染</h3>
<p>传统的服务端渲染有 <code>asp</code>, <code>jsp(java)</code>, <code>ejs(nodejs)</code>等，服务端语言往往通过这些模板引擎将数据 <code>data</code> 和 <code>html</code> 结构在服务端组装，返回一个完整的静态的 <code>html</code> 字符串给客户端，由客户端直接显示。</p>
<p><strong>缺点</strong></p>
<ul>
<li>前后端不分离，前后端代码混在一个工程目录中，维护不方便，。</li>
<li>用户体验不佳，<strong>每次页面有改动都需要重新加载整个页面</strong>。比如，一个列表页面，当用户增加一项时，后台需要重新组装数据 <code>data</code> 和 <code>html</code> 结构，返回一个新的页面给前端，这样用户才能看到页面的变化。</li>
<li>服务端压力大，不仅要响应静态 <code>html</code> 文件，还要响应数据<code>api</code>接口。</li>
</ul>
<h3 data-id="heading-2">客户端渲染(CSR)</h3>
<p>在现代化的前端项目中，客户端渲染的代表性技术栈是 <code>vue/react/angular</code>，我们常常使用它们来构建客户端单页或者多页应用程序。</p>
<p>以 <code>SPA</code> 构建程序为例，在浏览器端首先渲染的是一套空的 <code>html</code>，然后下载<code>bundle.js</code>并执行，通过 <code>JavaScript</code> 直接进行页面的渲染和路由跳转等操作，所有的数据通过 <code>ajax</code> 请求从服务端获取。</p>
<p>路由的跳转是通过history api 实现的，它最大的作用是能改变url地址，但是不会刷新页面，也就是不会发送请求。这样对用户操作来说就非常的无感，克服了传统服务端渲染每次都要请求服务器的困扰。</p>
<p><strong>缺点</strong></p>
<ul>
<li>首屏加载慢，因为第一次会请求一个空的<code>html</code>文件，再去加载 <code>bundle.js</code>等打包后的文件。</li>
<li>不利于网站 <code>SEO</code>，因为首次请求回来的是空的 <code>html</code> 文件，爬虫无法获取有效内容信息，其实现在的爬虫也能爬取spa网站了。</li>
</ul>
<h3 data-id="heading-3">现代服务端渲染(同构)</h3>
<p>我们现在讲的服务端渲染概念，是指在前端范畴或者说在 <code>Vue/React</code> 等单页面技术范畴内的，基于 <code>Nodejs server</code> 运行环境的服务端渲染方案，这种方案的本质是<strong>同构渲染</strong>。它的步骤如下：</p>
<ol>
<li>在 <code>Nodejs</code> 中运行相同的前端代码，将用<code>Vue/React</code>框架写的代码转化为<code>html</code> 结构，然后返回给浏览器渲染，这样爬虫就能爬取到完整的页面信息。</li>
<li>客户端获取到服务端返回的页面后，再进行注水(hydrate)化处理，由客户端代码(SPA代码)来接管页面。</li>
</ol>
<p><strong>为什么要进行注水处理呢？</strong></p>
<p>因为服务端环境毕竟不同于浏览器环境，缺少浏览器环境必要的变量和<code>API</code>。比如，页面中的点击事件就无法在服务端进行注册，因为在服务端环境中是没有DOM节点的概念的，它只是一堆字符串而已，自然无法使用 <code>document.addEventListener</code> 这样的<code>API</code>。也就是如果客户端代码不接管页面，那么页面里面所有的点击事件将不可用。</p>
<p><strong>什么是同构？</strong></p>
<p>同构简单来讲就是服务端和客户端复用同一套代码。比如，页面<code>html</code>结构、<code>store</code>数据存储、<code>router</code>路由都能共享一套代码。这就是所谓的现代服务端渲染：<strong>同构</strong>。</p>
<p><strong>缺点</strong></p>
<ol>
<li>SSR 的数据获取必须在组件渲染之前；</li>
<li>组件的 JavaScript 必须先加载到客户端，才能开始水合；</li>
<li>所有组件必须先水合，然后才能跟其中任意一个组件交互；</li>
</ol>
<p>可以看出 SSR 这种技术<strong>大开大合，加载整个页面的数据，加载整个页面的 JavaScript，水合整个页面，还必须按此顺序串行执行</strong>。如果有某些部分慢了，都会导致整体效率降低。</p>
<p>此外，<strong>SSR 只用于页面的初始化加载，对于后续的交互、页面更新、数据更改，SSR 并无作用</strong>。</p>
<h2 data-id="heading-4">为什么选择 SSR？</h2>
<p>相比于客户端渲染 CRS (单页面应用)，SSR 主要的好处是：</p>
<p><strong>更快的内容呈现</strong></p>
<p>尤其是网络连接缓慢或设备运行速度缓慢的时候，服务端标记不需要等待所有的 JavaScript 脚本都被下载并执行之后才显示，所以用户可以更快看到完整的渲染好的内容。这带来了更好的用户体验，同<strong>时对于内容呈现时间和转化率呈正相关的应用来说尤为关键</strong>。</p>
<p><strong>更好的搜索引擎优化 (SEO)</strong></p>
<p>因为后端会一次性的把网站内容返回给前端，所以搜索引擎爬虫会直接读取完整的渲染出来的页面。但如果你的JavaScript 脚本是通过 API 调用获取内容，则爬虫不会等待页面加载完成。这意味着如果你的页面有异步加载的内容且 SEO 很重要，那么你可能需要 SSR。</p>
<p>除了上面两个优点外，这里还有一些点来决定是是否选用SSR：</p>
<ul>
<li><strong>开发一致性</strong>。浏览器特有的 API 只能在特定的生命周期钩子中使用；一些外部的库在服务端渲染应用中可能需要经过特殊处理。</li>
<li><strong>需要更多的构建设定和部署要求</strong>。不同于一个完全静态的 SPA 可以部署在任意的静态文件服务器，服务端渲染应用需要一个能够运行 <code>Nodejs</code> 服务器的环境。</li>
<li><strong>更多的服务端负载</strong>。在 <code>Nodejs</code> 中渲染一个完整的应用会比仅供应静态文件产生更密集的 CPU 运算。所以如果流量很高，请务必准备好与其负载相对应的服务器，并采取明智的缓存策略。</li>
</ul>
<p>在应用中使用 SSR 之前，你需要问自己的第一个问题是：你是否真的需要它？</p>
<p><strong>它通常是由内容呈现时间对应用的重要程度决定的</strong>。</p>
<p>例如，如果你正在搭建一个内部管理系统，几百毫秒的初始化加载时间对它来说无关紧要，这种情况下就没有必要使用 SSR。然而，如果内容呈现时间非常关键，SSR 可以助你实现最佳的初始加载性能。</p>
<p><strong>SSR vs 预渲染</strong></p>
<p>如果你仅希望通过 SSR 来改善一些推广页面 (例如 <code>/</code>、<code>/about</code>、<code>/contact</code> 等) 的 SEO，那么<strong>预渲染</strong>也许会更合适。和使用动态编译 HTML 的 web 服务器相比，预渲染可以在构建时为指定的路由生成静态 HTML 文件。</p>
<p>如果你正在使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.js.org%2F" title="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.js.org%2F" target="_blank">webpack</a>，你可以通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchrisvfritz%2Fprerender-spa-plugin" title="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchrisvfritz%2Fprerender-spa-plugin" target="_blank">prerender-spa-plugin</a> 来支持预渲染。</p>
<h2 data-id="heading-5">现代服务端渲染(同构)大致实现原理</h2>
<p>通过前面的介绍，服务端渲染就是返回一个带有具体内容的 <code>html</code> 字符串给浏览器，那么这个具体的内容是什么呢？</p>
<p>这个具体的内容就是用 <code>Vue</code> 开发的页面内容，但是如果直接把带有 <code>Vue</code> 语法塞进 html 模板浏览器根本无法识别，因此，服务端渲染也需要使用 <code>Vite</code> 进行编译打包转化为浏览器能识别的<code>javascript</code>语法。</p>
<p>根据<strong>同构</strong>概念理解，客户端和服务端是共用同一套的页面内容代码的，所以客户端和服务端需要分别打包编译。</p>
<p>首先就是编写通用代码，适用于客户端和服务端。</p>
<h3 data-id="heading-6">一. 编写通用代码</h3>
<p>由于平台 API 的差异，当运行在不同环境中时，我们写的通用代码将与纯客户端代码不会完全相同。需要注意一下几点：</p>
<h4 data-id="heading-7">1. 避免状态单例</h4>
<p>在纯客户端应用程序中，每个用户会在他们各自的浏览器中使用新的应用程序实例。对于服务器端渲染，我们也希望如此。</p>
<p>但是，Node.js 服务器是一个长期运行的进程。当我们的代码进入该进程时，它将进行一次取值并留存在内存中。这意味着如果创建一个单例对象，它将在每个传入的请求之间共享。</p>
<p>所以，必须要求每个请求都应该都是全新的、独立的应用程序实例，以便不会有交叉请求造成的状态污染。</p>
<p>因此，我们不应该直接创建一个应用程序实例，而是应该暴露一个可以重复执行的工厂函数，为每个请求创建新的应用程序实例：</p>
<p>对原有客户端代码代码进行改造：</p>
<p><code>main.js</code>：</p>
<pre><code class="hljs language-js" lang="js"># 原有代码
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
app.<span class="hljs-property">config</span>.<span class="hljs-property">globalProperties</span>.<span class="hljs-property">$message</span> = <span class="hljs-title class_">ElMessage</span>
app.<span class="hljs-title function_">use</span>(router)
app.<span class="hljs-title function_">use</span>(store, key)
app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)
app.<span class="hljs-title function_">use</span>(i18n)
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

# 改造后代码：变为工厂函数
<span class="hljs-keyword">import</span> { createSSRApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createSSRApp</span>(<span class="hljs-title class_">App</span>)
  <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createSSRStore</span>()
  <span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createSSRRouter</span>()
  <span class="hljs-keyword">const</span> i18n = <span class="hljs-title function_">createSSRI18n</span>()
  <span class="hljs-title function_">sync</span>(store, router)
  app.<span class="hljs-property">config</span>.<span class="hljs-property">globalProperties</span>.<span class="hljs-property">$message</span> = <span class="hljs-title class_">ElMessage</span>
  app.<span class="hljs-title function_">use</span>(store, key)
  app.<span class="hljs-title function_">use</span>(router)
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)
  app.<span class="hljs-title function_">use</span>(i18n)

  <span class="hljs-keyword">return</span> { app, router, store }
}
</code></pre>
<p>同理，项目中的数据存储<code>store</code>，路由<code>router</code>等都需要改造成工厂函数的形式，比如路由：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createSSRRouter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createRouter</span>({
    # <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">SSR</span>是vite提供环境变量
    # 服务端渲染只能用createMemoryHistory
    <span class="hljs-attr">history</span>: <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">SSR</span> ? <span class="hljs-title function_">createMemoryHistory</span>() : <span class="hljs-title function_">createWebHistory</span>(),
    routes
  })
}
</code></pre>
<h4 data-id="heading-8">2. 组件生命周期钩子函数</h4>
<p>由于服务端没有动态更新，所有的生命周期钩子函数中，只有 <code>beforeCreate</code> 和 <code>created</code> 会在服务器端渲染 (SSR) 过程中被调用。这就是说任何其他生命周期钩子函数中的代码（例如 <code>beforeMount</code> 或 <code>mounted</code>），只会在客户端执行。</p>
<p>此外还需要注意的是，你应该避免在 <code>beforeCreate</code> 和 <code>created</code> 生命周期时产生全局副作用的代码，例如在其中使用 <code>setInterval</code> 设置 timer。在纯客户端的代码中，我们可以设置一个 timer，然后在 <code>beforeDestroy</code> 或 <code>destroyed</code> 生命周期时将其销毁。但是，由于在 SSR 期间并不会调用销毁钩子函数，所以 timer 将永远保留下来。</p>
<h4 data-id="heading-9">3. 访问特定平台API</h4>
<p>通用代码不可接受特定平台的 API，因此如果你的代码中，直接使用了像 <code>window</code> 或 <code>document</code>，这种仅浏览器可用的全局变量，则会在 Node.js 中执行时抛出错误，反之也是如此。</p>
<p>对于共享于服务器和客户端，但用于不同平台 API 的任务，建议将平台特定实现包含在通用 API 中，例如，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faxios%2Faxios" title="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faxios%2Faxios" target="_blank">axios</a>是一个 HTTP 客户端，可以向服务器和客户端都暴露相同的 API。</p>
<p>请注意，考虑到如果第三方 library 不是以上面的通用用法编写，则将其集成到服务器渲染的应用程序中，可能会很棘手。</p>
<h3 data-id="heading-10">二、 构建步骤</h3>
<p>编写好通用代码之后，就需要使用构建工具<code>webpack</code>, <code>Vite</code>进行打包构建，我们将会采用<code>Vite</code>进行构建，构建过程如下:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deb913f4312f4dfd9e4bc173eea9c7ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700186&amp;x-signature=mgzf5t%2Bnmfksx2ihq8%2BwdiOo%2F%2BQ%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-11">1. 创建客户端入口和服务端入口文件</h4>
<p>一个典型的 SSR 应用应该有如下的源文件结构：</p>
<pre><code class="hljs language-js" lang="js">- index.<span class="hljs-property">html</span> # 模版html文件
- server.<span class="hljs-property">ts</span> # main application server
- src/
  - main.<span class="hljs-property">js</span> # 公共通用代码，不是入口文件
  - entry-client.<span class="hljs-property">ts</span>  # 客户端入口： 将应用挂载到一个 <span class="hljs-variable constant_">DOM</span> 元素上
  - entry-server.<span class="hljs-property">ts</span>  # 服务端入口：使用某框架的 <span class="hljs-variable constant_">SSR</span> <span class="hljs-variable constant_">API</span> 渲染该应用
</code></pre>
<p><strong>index.html</strong></p>
<p>首先看下<code>index.html</code>文件，它原来长这个样子：</p>
<pre><code class="hljs language-js" lang="js">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>一个经典的前台项目<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span>
</code></pre>
<p><code>&lt;script type="module" src="/src/main.js"&gt;&lt;/script&gt;</code>中的<code>type="module"</code>的含义与带 <code>defer</code> 的普通脚本一致：</p>
<ul>
<li>不会阻塞 HTML 解析；</li>
<li>会等待 HTML 解析完成后，按脚本在页面中的顺序执行；</li>
<li>普通脚本（无 <code>defer</code>/<code>async</code>）会阻塞解析，执行完才继续解析 HTML。</li>
</ul>
<p>开发完代码后，执行<code>npm run build</code>进行打包后长这个样子：</p>
<pre><code class="hljs language-js" lang="js">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>一个经典的前台项目<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">crossorigin</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/assets/index-IiCrRs2g.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">crossorigin</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/assets/index-NLCfHQLN.css"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</span></code></pre>
<p>其中的<code>index-IiCrRs2g.js</code>是整个前端应用的<strong>核心入口文件</strong>，其核心作用是启动 Vue 应用、挂载根组件，并加载应用运行所需的核心依赖 / 资源。</p>
<p>现在需要改造如下：</p>
<p><code>index.html</code> 将需要引用 <code>entry-client.ts</code>，而不是原来的<code>main.ts</code>，并包含一个占位标记供给服务端渲染时注入：</p>
<pre><code class="hljs language-js" lang="js">&lt;div id=<span class="hljs-string">"app"</span>&gt;&lt;!--ssr-outlet--&gt;&lt;/div&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/entry-client.ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>服务端渲染后的html字符串会替换<code>&lt;!--ssr-outlet--&gt;</code>，<code>/src/entry-client.ts</code>代码主要是用于接管页面，使其具备交互能力。</p>
<p><strong>entry-client.ts</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'./main'</span>

<span class="hljs-keyword">const</span> { app, router, store } = <span class="hljs-title function_">createApp</span>()

router.<span class="hljs-title function_">isReady</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
})
</code></pre>
<p><strong>entry-server.ts</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'./main'</span>
<span class="hljs-keyword">import</span> { renderToString } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/server-renderer'</span>

<span class="hljs-comment">// 服务端渲染核心函数</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">const</span> { app, router, store } = <span class="hljs-title function_">createApp</span>() 
  # 根据url来渲染对应的页面
  <span class="hljs-keyword">await</span> router.<span class="hljs-title function_">push</span>(url) 
  <span class="hljs-keyword">await</span> router.<span class="hljs-title function_">isReady</span>() 
  <span class="hljs-keyword">const</span> appHtml = <span class="hljs-keyword">await</span> <span class="hljs-title function_">renderToString</span>(app) 
  <span class="hljs-keyword">return</span> appHtml
}
</code></pre>
<p><strong>server.ts</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
<span class="hljs-keyword">const</span> serveStatic = <span class="hljs-built_in">require</span>(<span class="hljs-string">'serve-static'</span>)
<span class="hljs-keyword">const</span> { <span class="hljs-attr">createServer</span>: createViteServer } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vite'</span>)

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createServer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()

  <span class="hljs-keyword">const</span> vite = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createViteServer</span>({
    <span class="hljs-attr">server</span>: { <span class="hljs-attr">middlewareMode</span>: <span class="hljs-string">'ssr'</span> }
  })
 
  app.<span class="hljs-title function_">use</span>(vite.<span class="hljs-property">middlewares</span>)

  app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'*'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">const</span> url = req.<span class="hljs-property">originalUrl</span>
    # <span class="hljs-number">1.</span> 读取 index.<span class="hljs-property">html</span>
    <span class="hljs-keyword">let</span> template = fs.<span class="hljs-title function_">readFileSync</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'index.html'</span>),
          <span class="hljs-string">'utf-8'</span>)
          
    template = <span class="hljs-keyword">await</span> vite.<span class="hljs-title function_">transformIndexHtml</span>(url, template)      
          
    # <span class="hljs-number">2.</span> entry-server.<span class="hljs-property">ts</span> 暴露了render方法
    <span class="hljs-keyword">let</span> render = (<span class="hljs-keyword">await</span> vite.<span class="hljs-title function_">ssrLoadModule</span>(<span class="hljs-string">'/src/entry-server.ts'</span>)).<span class="hljs-property">render</span>
       
    # <span class="hljs-number">3.</span> 根据url渲染对应的
    <span class="hljs-keyword">const</span> appHtml = <span class="hljs-keyword">await</span> <span class="hljs-title function_">render</span>(url)
    
    # <span class="hljs-number">4.</span> 插入到div中
    <span class="hljs-keyword">const</span> html = template.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'&lt;!--ssr-outlet--&gt;'</span>, appHtml)
    
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">set</span>({ <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> }).<span class="hljs-title function_">end</span>(html)
   
  })

  app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'node server run at:'</span>, isProd ? <span class="hljs-string">'生产环境'</span> : <span class="hljs-string">'开发环境'</span>)
  })
}

<span class="hljs-title function_">createServer</span>()
</code></pre>
<p><strong>package.json</strong></p>
<p><code>package.json</code> 中的 <code>dev</code> 脚本也应该相应地改变，使用服务器脚本：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-string">"scripts"</span>: {
    <span class="hljs-comment">// "dev": "vite"</span>
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"cross-env NODE_ENV=development node server.js"</span>,
}
</code></pre>
<h4 data-id="heading-12">2. 打包客户端和服务端代码</h4>
<p><code>package.json</code> 中的脚本应该看起来像这样：</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"node server"</span>,
    <span class="hljs-string">"build:client"</span>: <span class="hljs-string">"vite build --outDir dist/client"</span>,
    <span class="hljs-string">"build:server"</span>: <span class="hljs-string">"vite build --outDir dist/server --ssr src/entry-server.js "</span>
  }
}
</code></pre>
<p>使用 <code>--ssr</code> 标志表明这将会是一个 SSR 构建，同时需要指定 SSR 的入口。</p>
<p>接着，在 <code>server.js</code> 中，通过 <code>process.env.NODE_ENV</code> 条件，需要添加一些用于生产环境的特定逻辑：</p>
<ul>
<li><code>index.html</code>模版变更：使用 <code>dist/client/index.html</code> 作为模板，而不是根目录的 <code>index.html</code>，因为前者包含了到客户端构建的正确资源链接。</li>
<li>服务端入口文件变更：原来是<code>/src/entry-server.js</code>， 现在要使用 <code>import('./dist/server/entry-server.js')</code>。</li>
</ul>
<p>修改后代码如下:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
<span class="hljs-keyword">const</span> serveStatic = <span class="hljs-built_in">require</span>(<span class="hljs-string">'serve-static'</span>)
<span class="hljs-keyword">const</span> { <span class="hljs-attr">createServer</span>: createViteServer } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vite'</span>)

<span class="hljs-keyword">const</span> isProd = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createServer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()

  <span class="hljs-keyword">const</span> vite = <span class="hljs-keyword">await</span> <span class="hljs-title function_">createViteServer</span>({
    <span class="hljs-attr">server</span>: { <span class="hljs-attr">middlewareMode</span>: <span class="hljs-string">'ssr'</span> }
  })
  
  # 在生产环境需要vite与express进行脱钩
  <span class="hljs-keyword">if</span> (!isProd) {
    # 使用 vite 的 <span class="hljs-title class_">Connect</span> 实例作为中间件，利用这个中间件来起一个静态资源服务器
    app.<span class="hljs-title function_">use</span>(vite.<span class="hljs-property">middlewares</span>)
  } <span class="hljs-keyword">else</span> {
    # 在生产环境，利用express框架自带的中间件serve-<span class="hljs-keyword">static</span>，利用这个中间件来起一个静态资源服务器
    # 把dist/client文件夹下的资源都可以访问
    app.<span class="hljs-title function_">use</span>(
      <span class="hljs-title function_">serveStatic</span>(path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist/client'</span>), { <span class="hljs-attr">index</span>: <span class="hljs-literal">false</span> })
    )
  }

  app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'*'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">const</span> url = req.<span class="hljs-property">originalUrl</span>
    <span class="hljs-keyword">let</span> template
    <span class="hljs-keyword">let</span> render
    <span class="hljs-keyword">try</span> {
      # 在生产环境需要vite与express进行脱钩
      <span class="hljs-keyword">if</span> (!isProd) {
        <span class="hljs-comment">// 1. 读取 index.html</span>
        template = fs.<span class="hljs-title function_">readFileSync</span>(
          path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'index.html'</span>),
          <span class="hljs-string">'utf-8'</span>
        )
        
        # <span class="hljs-number">2.</span> 应用 <span class="hljs-title class_">Vite</span> 进行 <span class="hljs-variable constant_">HTML</span> 转换，这将会注入 <span class="hljs-title class_">Vite</span> <span class="hljs-variable constant_">HMR</span> 客户端，
        template = <span class="hljs-keyword">await</span> vite.<span class="hljs-title function_">transformIndexHtml</span>(url, template)
        
        # <span class="hljs-number">3.</span> 加载服务器入口文件，vite.<span class="hljs-property">ssrLoadModule</span> 将自动转换你的 <span class="hljs-variable constant_">ESM</span> 源码使之可以在 <span class="hljs-title class_">Node</span>.<span class="hljs-property">js</span> 中运行。既然是加载文件，肯定是异步的，所以使用<span class="hljs-keyword">await</span>
        render = (<span class="hljs-keyword">await</span> vite.<span class="hljs-title function_">ssrLoadModule</span>(<span class="hljs-string">'/src/entry-server.ts'</span>)).<span class="hljs-property">render</span>
      } <span class="hljs-keyword">else</span> {
        # <span class="hljs-number">1.</span> 生产环境需要加载编译后的模版文件index.<span class="hljs-property">html</span>
        template = fs.<span class="hljs-title function_">readFileSync</span>(
          path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist/client/index.html'</span>),
          <span class="hljs-string">'utf-8'</span>
        )
        # <span class="hljs-number">2.</span> 使用<span class="hljs-variable constant_">SSR</span>构建后的最终render函数
        render = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./dist/server/entry-server.js'</span>).<span class="hljs-property">render</span>
      }

      # <span class="hljs-number">4.</span> 渲染应用的 <span class="hljs-variable constant_">HTML</span>
      <span class="hljs-keyword">const</span> appHtml = <span class="hljs-keyword">await</span> <span class="hljs-title function_">render</span>(url, manifest)

      # <span class="hljs-number">5.</span> 注入渲染后的应用程序 <span class="hljs-variable constant_">HTML</span> 到模板中。
      <span class="hljs-keyword">const</span> html = template
        .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'&lt;!--ssr-outlet--&gt;'</span>, appHtml)
       
      <span class="hljs-comment">// 6. 返回渲染后的 HTML。</span>
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">set</span>({ <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> }).<span class="hljs-title function_">end</span>(html)
    } <span class="hljs-keyword">catch</span> (e) {
      ...
    }
  })

  app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'node server run at:'</span>, isProd ? <span class="hljs-string">'生产环境'</span> : <span class="hljs-string">'开发环境'</span>)
  })
}

<span class="hljs-title function_">createServer</span>()
</code></pre>
<h3 data-id="heading-13">三、数据获取</h3>
<p>在服务器端渲染(SSR)期间，我们本质上是在渲染我们应用程序的"快照"，所以如果应用程序依赖于一些异步数据，<strong>那么在开始渲染过程之前，需要先预取和解析好这些数据</strong>。</p>
<p>另一个需要关注的问题是在客户端代码接管时，需要获取到与服务器端应用程序完全相同的数据，否则客户端应用程序会因为使用与服务器端应用程序不同的状态，然后导致水合失败。</p>
<p>为了解决这个问题，获取的数据需要位于视图组件之外，即放置在专门的数据预取存储容器(data store)或"状态容器(state container)"中。</p>
<p>为此，我们将使用官方状态管理库 Vuex。</p>
<p>那么，我们在哪里放置dispatch 数据预取 action的代码？</p>
<p>事实上，给定路由所需的数据，也是在该路由上渲染组件时所需的数据。所以在路由组件中放置数据预取逻辑，是很自然的事情。</p>
<p>我们将在路由组件上暴露出一个自定义静态函数 <code>asyncData</code>。注意，由于此函数会在组件实例化之前调用，所以它无法访问 <code>this</code>。需要将 store 和路由信息作为参数传递进去：</p>
<pre><code class="hljs language-js" lang="js">&lt;script setup&gt;
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncData</span>(<span class="hljs-params">{ store, route }: any</span>) {
 <span class="hljs-keyword">return</span> store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">'getRoomList'</span>)
}

<span class="hljs-title function_">defineExpose</span>({ asyncData })
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-14">1. 服务器端数据预取</h4>
<p>在 <code>entry-server.js</code> 中，我们可以通过路由获得相匹配的组件，如果组件暴露出 <code>asyncData</code>，我们就调用这个方法。然后我们需要将解析完成的数据，绑定到到<code>window</code>上。</p>
<p>修改<code>entry-server.ts</code>:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">url: string, manifest: any</span>) {
  <span class="hljs-keyword">const</span> { app, router, store } = <span class="hljs-title function_">createApp</span>()
  
  <span class="hljs-keyword">await</span> router.<span class="hljs-title function_">push</span>(url)
  <span class="hljs-keyword">await</span> router.<span class="hljs-title function_">isReady</span>()

  <span class="hljs-keyword">const</span> matchedComponents = router.<span class="hljs-property">currentRoute</span>.<span class="hljs-property">value</span>.<span class="hljs-property">matched</span>.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">record</span> =&gt;</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(record.<span class="hljs-property">components</span>)
  )
 
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
    matchedComponents.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">Component: any</span>) =&gt;</span> {
      # 如果组件中定义了asyncData函数，说明这个组件需要去后台获取接口数据
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Component</span>.<span class="hljs-property">asyncData</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Component</span>.<span class="hljs-title function_">asyncData</span>({
          <span class="hljs-comment">// 传入store和当前route，store参数用来执行store.dispatch，发起请求</span>
          store,
          <span class="hljs-attr">route</span>: router.<span class="hljs-property">currentRoute</span>
        })
      }
      <span class="hljs-keyword">return</span> []
    })
  )

  <span class="hljs-keyword">const</span> appHtml = <span class="hljs-keyword">await</span> <span class="hljs-title function_">renderToString</span>(app)
  
  # 此时state里面包含了请求接口获取的数据，然后就把这个数据绑定到<span class="hljs-variable language_">window</span>某个属性上
  # 这样当同构的时候，客户端的store.<span class="hljs-property">state</span>就能用这个值作为初始化化数据，就不用再去调一次接口了
  <span class="hljs-keyword">const</span> state = store.<span class="hljs-property">state</span>
 
  <span class="hljs-keyword">return</span> { appHtml, state }
}
</code></pre>
<p>修改模板文件<code>index.html</code>:</p>
<pre><code class="hljs language-js" lang="js">&lt;div id=<span class="hljs-string">"app"</span>&gt;&lt;!--ssr-outlet--&gt;&lt;/div&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/entry-client.ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="xml">
  window.__INITIAL_STATE__ = '<span class="hljs-comment">&lt;!--vuex-state--&gt;</span>'
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>修改<code>server.ts</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { appHtml, state } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">render</span>(url)
<span class="hljs-keyword">const</span> html = template
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'&lt;!--ssr-outlet--&gt;'</span>, appHtml)  
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">"'&lt;!--vuex-state--&gt;'"</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(state))
</code></pre>
<p>修改<code>entry-client.js</code>: 使用<code>__INITIAL_STATE__</code>来初始化store，这样客户端接管时也是带有数据的。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { app, router, store } = <span class="hljs-title function_">createApp</span>()

<span class="hljs-keyword">if</span> ((<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> any).<span class="hljs-property">__INITIAL_STATE__</span>) {
  store.<span class="hljs-title function_">replaceState</span>((<span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> any).<span class="hljs-property">__INITIAL_STATE__</span>)
}
</code></pre>
<h4 data-id="heading-15">2. 客户端数据预取</h4>
<p>首先思考下为什么会有客户端数据预取？</p>
<p>当我从服务端请求页面内容(<code>/login</code>)后，客户端代码立即接管页面，此时页面跳转时不会再向服务端发送请求了。</p>
<p>当从<code>/login</code>页面跳转到<code>/home</code>页面，<strong>由于组件的部分生命周期在服务端不能使用，我们没有在代码中写<code>onMounted</code>钩子函数，也就无法执行获取接口的函数</strong>，那么此时<code>/home</code>页面是没有数据的。所以就需要在客户端进行数据预取，既然组件生命周期钩子不能用，还有什么钩子可以用呢？</p>
<p>答案是路由钩子。</p>
<p>修改<code>entry-client.ts</code>:</p>
<pre><code class="hljs language-js" lang="js">router.<span class="hljs-title function_">isReady</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  # beforeResolve表示所有的异步组件全部resolve了
  router.<span class="hljs-title function_">beforeResolve</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
    # 找出两个匹配列表的差异组件。
    # 如果你刷新当前页面，会发送请求到服务器，服务前拼接好数据和html返回前端，但是有了这个路由钩子，它还会再去请求一遍数据，这就相当于前后台都去请求了一次回去，这没有必要。
    # 所以需要做一个判断是否是在刷新页面，也就是to和<span class="hljs-keyword">from</span>是不是一样的，如果一样的，就是刷新操作，那么actived为空，不会执行后面的逻辑，也就是客户端不会再次请求数据接口，用服务端带过来的数据就可以了，这就是防止客户端数据二次预取。
    <span class="hljs-keyword">const</span> toComponents = router
      .<span class="hljs-title function_">resolve</span>(to)
      .<span class="hljs-property">matched</span>.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">record</span> =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(record.<span class="hljs-property">components</span>))
    <span class="hljs-keyword">const</span> fromComponents = router
      .<span class="hljs-title function_">resolve</span>(<span class="hljs-keyword">from</span>)
      .<span class="hljs-property">matched</span>.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">record</span> =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(record.<span class="hljs-property">components</span>))

    <span class="hljs-keyword">const</span> actived = toComponents.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">c, i</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> fromComponents[i] !== c
    })
    # 客户端预取数据有两种方式：
    # 一种是在匹配到路由视图之后就跳转，然后去请求接口，
    # 另一种是在请求接口数据返回后再进行跳转，此时页面是包含数据的
    <span class="hljs-keyword">if</span> (!actived.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">next</span>()
    } <span class="hljs-keyword">else</span> {
      # 第一种： 匹配路由之后直接跳转，然后去请求接口
      <span class="hljs-comment">// next()</span>
    }
    <span class="hljs-comment">// 显示loading</span>
    <span class="hljs-keyword">const</span> loadingInstance = <span class="hljs-title class_">ElLoading</span>.<span class="hljs-title function_">service</span>({
      <span class="hljs-attr">lock</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">text</span>: <span class="hljs-string">'Loading'</span>,
      <span class="hljs-attr">background</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.7)'</span>
    })

    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
      actived.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">Component: any</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Component</span>.<span class="hljs-property">asyncData</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Component</span>.<span class="hljs-title function_">asyncData</span>({
            store,
            <span class="hljs-attr">route</span>: router.<span class="hljs-property">currentRoute</span>
          })
        }
        <span class="hljs-keyword">return</span> []
      })
    ).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 关闭loading</span>
      loadingInstance.<span class="hljs-title function_">close</span>()
      # 第二种： 等数据请求之后再跳转
      <span class="hljs-title function_">next</span>()
    })
  })

  app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
})
</code></pre>
<p>至此，整个服务端渲染就基本完成了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能优化之性能指标篇]]></title>    <link>https://juejin.cn/post/7589553045157330984</link>    <guid>https://juejin.cn/post/7589553045157330984</guid>    <pubDate>2025-12-31T01:55:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589553045157330984" data-draft-id="7589544380518137866" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端性能优化之性能指标篇"/> <meta itemprop="keywords" content="前端,性能优化,JavaScript"/> <meta itemprop="datePublished" content="2025-12-31T01:55:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小寒"/> <meta itemprop="url" content="https://juejin.cn/user/694547078987287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端性能优化之性能指标篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078987287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小寒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T01:55:49.000Z" title="Wed Dec 31 2025 01:55:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1aed9df7f41e40e69713f6566ee3b15e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767750949&amp;x-signature=L6zcVmwo7J7W0cbTrNA5LS8t%2BSw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">1、常见性能指标</h2>
<ul>
<li><strong>FP（First Paint - 首次绘制）</strong>：页面首次绘制的时间点，即第一个像素绘制到屏幕上的时间点。</li>
<li><strong>FCP（First Contentful Paint - 首次内容绘制）</strong>：页面首个内容绘制到屏幕上的时间点，这里的内容包括文本、图片等。</li>
<li><strong>LCP（Largest Contentful Paint - 最大内容绘制）</strong>：可视区域内最大的元素加载的时间点。这里的“最大”指的是从几何属性（可视尺寸）来计算，绘制面积最大的那个元素。</li>
<li><strong>FID（First Input Delay - 首次输入延迟） 与 INP（Interaction to Next Paint）</strong>：页面首次交互（点击链接、按钮等）到浏览器实际响应的延迟。以前该指标用 <code>FID</code> 来衡量，但目前已经被 <code>INP</code> 取代，它们之间的区别是，FID 只衡量“第一次”交互，而 INP 会观察整个页面所有交互事件，并报告一个较差或最高的数值，这样更能反应出页面的整体响应性。</li>
<li><strong>CLS（Cumulative Layout Shift - 累积布局偏移）</strong>：在页面生命周期当中，累计的意外布局偏移总分数。</li>
<li><strong>TTFB（Time to First Byte）</strong>：浏览器从发起请求到接收到服务器响应数据的首字节所花费的时间。</li>
</ul>
<h2 data-id="heading-1">2、需要关注什么样的指标？</h2>
<p>上面列出了那么多指标，那么在实际衡量前端项目性能时，我们究竟应该关注些什么指标呢？</p>
<p>我们可以从这几方面入手：</p>
<ul>
<li><strong>可衡量</strong>。就是可以通过代码计算拿到的指标，即可以用代码来衡量，无法衡量也就无法优化。</li>
<li><strong>用户关心的关键信息</strong>。比如用户进入了一个商品详情页，他最关心的是这个商品是怎样的，包括商品头图、商品描述、商品价格、购买按钮等关键信息。</li>
<li><strong>用户的真实体验</strong>。比如用户在列表中滑着滑着，突然弹出一个广告弹窗，用户就会觉得体验很差。</li>
</ul>
<h2 data-id="heading-2">3、加载性能指标</h2>
<h3 data-id="heading-3">3.1 白屏时间</h3>
<p>白屏时间是指用户输入内容按下回车（也包括刷新、跳转等方式）后到页面出现第一个字符的时间，其<strong>标准是 300 ms</strong>。</p>
<p><strong>影响白屏时间的因素如下</strong>：</p>
<ul>
<li>在客户端请求阶段，<strong><code>DNS</code> 查询时间长，没利用好本地缓存，<code>HTTP</code> 请求阻塞</strong>等。</li>
<li>在服务端处理请求阶段，服务器处理请求速度太慢，包括<strong>数据库查询慢、没做数据缓存、没开启 <code>Gzip</code> 压缩</strong>等。</li>
<li>在客户端渲染阶段，<strong><code>HTML</code> 解析慢、<code>script</code> 阻塞、资源加载慢、渲染时间长</strong>等。</li>
<li>用户本地网络慢，以及缺乏本地离线化处理等。</li>
</ul>
<h3 data-id="heading-4">3.2 首屏时间</h3>
<p>首屏时间指的是用户看到当前页面（第一屏）被完全加载出来的时间点。<strong>首屏时间 = 白屏时间 + 首屏渲染时间</strong>。</p>
<p>首屏时间的标准不是定死的，而是根据当前系统对时间是否敏感来决定的，比如 C 端系统 PC官网、H5 页面等，对首屏要求较高，而像 B 端管理后台，对首屏时间就没那么敏感，而且一般企业内部用的系统，其访问的网络环境一般都比较稳定，所以对首屏时间要求会低一些。</p>
<p><strong>具体时间可以参考如下表</strong>：</p>
<table>
 <tbody>
   <tr>
      <th>类别</th>
      <th>快</th>
      <th>较快</th>
      <th>慢</th>
      <th>很慢</th>
      <th>指标示例</th>
    </tr>
    <tr align="center">
      <td>时间敏感</td>
      <td>&lt;1s</td>
      <td>1s ~ 1.5s</td>
      <td>1.5s ~ 2.5s</td>
      <td>&gt;2.5s</td>
      <td>首屏、白屏</td>
    </tr>
    <tr align="center">
      <td>时间不敏感</td>
      <td>&lt;2s</td>
      <td>2s ~ 4s</td>
      <td>4s ~ 8s</td>
      <td>&gt;8s</td>
      <td>onload</td>
    </tr>
    <tr>
      <td colspan="6" align="center">
        最佳：白屏 &lt; 1s，首屏 &lt; 1.5s，onload &lt; 3s。
      </td>
    </tr>
 </tbody>
</table>
<p>一般来说，首屏时间在 1s 内，给用户的感觉就是非常流畅，在 1s 内的话，无论是 300ms 还是 500ms，其实用户感觉不出来太大的差别，但是如果首屏时间超过 2.5s，用户感觉就会很慢，体验很差，用户流失率也会嘎嘎往上升。</p>
<h3 data-id="heading-5">3.3 秒开率</h3>
<p>我们可以用首屏时间来衡量单个用户的首屏体验，但是如果把很多用户的首屏时间都收集上来了，如何衡量整个系统的首屏体验呢？</p>
<ul>
<li><strong>平均值</strong>：平均值就是所有用户首屏时间的总和除以用户数，但是平均值有个致命的缺点，就是容易被极端值影响，比如有 10 个用户，其中 9 个用户首屏时间都在 1s 内，而第 10 个用户首屏时间在 10s 内，那么平均值就会变成 5s，这个结果显然是不合理的。</li>
<li><strong>中位数</strong>。可以将所有数据做正态分布，看分位值统计。比如 P50（50分位值）、P90（90分位值）、P99（99分位值），这个值是怎么计算出来的呢？以 P99 为例，先把所有首屏数据先排好序，排在第 99 位的数据就是 P99，但这样还是比较麻烦。于是引入了秒开率的概念。</li>
<li><strong>秒开率</strong>：指的是 1s 内打开的用户占比。比如 10 个用户，1s 内能加载完首屏的用户有 8 个，那秒开率就是 80%。</li>
</ul>
<p><strong>按照秒开率的概念，我们可以建立如下的首屏时间标准</strong>：</p>

































<table><thead><tr><th align="center">类型</th><th align="center">首屏时间</th><th align="center">秒开率</th><th align="center">1.5秒开率</th><th align="center">2秒开率</th></tr></thead><tbody><tr><td align="center">SSR（服务端渲染）</td><td align="center">1000ms</td><td align="center">80%</td><td align="center">95%</td><td align="center">98%</td></tr><tr><td align="center">端内（Hybrid 环境）</td><td align="center">1200ms</td><td align="center">65%</td><td align="center">85%</td><td align="center">90%</td></tr><tr><td align="center">端外（浏览器环境）</td><td align="center">1500ms</td><td align="center">40%</td><td align="center">60%</td><td align="center">80%</td></tr></tbody></table>
<h2 data-id="heading-6">4、交互性能指标</h2>
<p>交互指的就是人机交互，比如用户点击了按钮后，网站立马给予一定的回应，包括跳转、弹窗、动画等，那就是用户体验好，但如果用户点击了按钮后，网站半天没有任何反应，那给用户的体验就很差。</p>
<p><strong>衡量交互指标的方式主要用两种</strong>：</p>
<ul>
<li>FID 指标（First Input Delay，首次输入延迟），指标必须尽量小于 100 ms。但文章开头也介绍过，现在 FID 指标已经被 INP 取代。</li>
<li>PSI（Perceptual Speed Index，视觉变化率），衡量标准是小于 20%。</li>
</ul>
<h2 data-id="heading-7">5、视觉稳定性指标</h2>
<p>视觉稳定性用 CLS（Cumulative Layout Shift） 来衡量，CLS 也就是布局偏移量，它是指页面从一帧切换到另外一帧时，视线中不稳定元素的偏移情况。</p>
<p>比如在一个商品详情页中，用户在想点击商品图片放大仔细查看图片内容，但是突然图片上方渲染出了一条广告，把图片顶到页面底部去了，这个就是不稳定元素，给用户的体验非常差。</p>
<h2 data-id="heading-8">小结</h2>
<p>常用的性能指标包括 <code>FP</code>、<code>FCP</code>、<code>LCP</code>、<code>FID</code>、<code>INP</code>、<code>CLS</code>、<code>TTFB</code> 等，而在实际前端项目优化中，我们往往比较关注<strong>加载性能指标、交互性能指标和视觉稳定性指标</strong>，加载性能指标包括白屏时间和首屏时间，而为了更好的衡量首屏时间对于用户的整体效果，我们引入了<strong>秒开率</strong>的概念，也就是 1s 内打开的用户占比，秒开率越高，整体用户体验越好。</p>
<h2 data-id="heading-9">往期回顾</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQz4VK0aBIyG36JbILi3FlA" target="_blank" title="https://mp.weixin.qq.com/s/Qz4VK0aBIyG36JbILi3FlA" ref="nofollow noopener noreferrer">前端性能优化之性能瓶颈点，Web 页面加载全流程解析</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FW8fkvEjbHlFpIg3_RMXGpA" target="_blank" title="https://mp.weixin.qq.com/s/W8fkvEjbHlFpIg3_RMXGpA" ref="nofollow noopener noreferrer">前端性能优化之Webpack篇</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Gl2sGa2Ev44tyrSYjjyFg" target="_blank" title="https://mp.weixin.qq.com/s/0Gl2sGa2Ev44tyrSYjjyFg" ref="nofollow noopener noreferrer">前端性能优化之CSS篇</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FeIKLx_kegGzrB00KXeKYLQ" target="_blank" title="https://mp.weixin.qq.com/s/eIKLx_kegGzrB00KXeKYLQ" ref="nofollow noopener noreferrer">前端遇到页面卡顿问题，如何排查和解决？</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 实现一个容器内部元素可平移、缩放和旋转等功能（十）]]></title>    <link>https://juejin.cn/post/7589466706378981412</link>    <guid>https://juejin.cn/post/7589466706378981412</guid>    <pubDate>2025-12-30T13:30:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589466706378981412" data-draft-id="7589475923697877011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 实现一个容器内部元素可平移、缩放和旋转等功能（十）"/> <meta itemprop="keywords" content="Flutter,前端"/> <meta itemprop="datePublished" content="2025-12-30T13:30:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="名字被你们想完了"/> <meta itemprop="url" content="https://juejin.cn/user/3065854916834782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 实现一个容器内部元素可平移、缩放和旋转等功能（十）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3065854916834782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    名字被你们想完了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T13:30:44.000Z" title="Tue Dec 30 2025 13:30:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter 实现一个容器内部元素可平移、缩放和旋转等功能（十）</h2>
<p>Flutter: 3.35.7</p>
<p>前面将基础的功能完成了，现在开始完善辅助功能，常规的辅助功能有网格辅助线，元素层级调整，撤销还原等等，下面我们就简单来实现这些功能。</p>
<p>对于部分辅助功能，我们抽取单独的结构来实现功能，底部工具栏专门用于新增元素，抽取顶部功能区域来实现其他功能。</p>
<p>首先我们来实现网格辅助线，应用网格辅助线可以快速让用户定位到辅助线的位置。要实现这个功能，首先我们得绘制网格线（因为不是绘制相关的知识，所以直接上代码，后续空了会单独写绘制相关的）：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'configs/constants_config.dart'</span>;

<span class="hljs-comment">/// <span class="markdown">绘制网格线</span></span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GridPainter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CustomPainter</span> </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> paint(Canvas canvas, Size size) {
    <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> gridSize = ConstantsConfig.gridSize;
    <span class="hljs-keyword">final</span> paint = Paint()
      ..color = Colors.grey.withValues(alpha: <span class="hljs-number">0.3</span>)
      ..strokeWidth = <span class="hljs-number">1.0</span>;

    <span class="hljs-comment">// 绘制垂直线</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">double</span> x = <span class="hljs-number">0</span>; x &lt; size.width; x += gridSize) {
      canvas.drawLine(Offset(x, <span class="hljs-number">0</span>), Offset(x, size.height), paint);
    }

    <span class="hljs-comment">// 绘制水平线</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">double</span> y = <span class="hljs-number">0</span>; y &lt; size.height; y += gridSize) {
      canvas.drawLine(Offset(<span class="hljs-number">0</span>, y), Offset(size.width, y), paint);
    }
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">bool</span> shouldRepaint(<span class="hljs-keyword">covariant</span> CustomPainter oldDelegate) =&gt; <span class="hljs-keyword">false</span>;
}
</code></pre>
<p>效果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdfcbdcd3b824b299a2365cc67750aca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706243&amp;x-signature=nQfTUjEsLjyZlc6gXqXBj1D0zIo%3D" alt="image01.png" loading="lazy"/></p>
<p>现在网格线绘制完毕，抽取了网格线的部分属性，后续直接更改属性调整网格间距。现在我们就开始实现功能，当元素拖动到网格线附近的时候，就出现吸附效果，上下左右，谁离得近就吸附谁。当实现吸附的时候，我们可以只需要判断左上和右下的点即可，因为左上和右下分别对应了最小和最大的x和y，通过矩形的特性，这两个点就能够包括所有吸附的情况：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">获取开启网格辅助线时低于阈值的x和y</span></span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// <span class="markdown">通过当前的[x]坐标和[y]坐标计算吸附坐标，如果低于阈值，则不吸附</span></span>
(<span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>) _getUseGridXY({<span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> x, <span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> y}) {
  <span class="hljs-built_in">double</span> tempX = x;
  <span class="hljs-built_in">double</span> tempY = y;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> gridSize = ConstantsConfig.gridSize;
  <span class="hljs-comment">// 吸附的阈值</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> snapThreshold = ConstantsConfig.snapThreshold;

  <span class="hljs-comment">// 计算最近（左上）的网格点</span>
  <span class="hljs-built_in">double</span> snappedLeftX = (x / gridSize).roundToDouble() * gridSize;
  <span class="hljs-built_in">double</span> snappedLeftY = (y / gridSize).roundToDouble() * gridSize;
  <span class="hljs-comment">// 计算最近（右下）的网格点</span>
  <span class="hljs-built_in">double</span> snappedRightX = ((x + _currentElement!.elementWidth) / gridSize).roundToDouble() * gridSize;
  <span class="hljs-built_in">double</span> snappedRightY = ((y + _currentElement!.elementHeight) / gridSize).roundToDouble() * gridSize;

  <span class="hljs-comment">// 检查是否在吸附范围内</span>
  <span class="hljs-built_in">double</span> dxLeftDistance = (x - snappedLeftX).abs();
  <span class="hljs-built_in">double</span> dyLeftDistance = (y - snappedLeftY).abs();
  <span class="hljs-built_in">double</span> dxRightDistance = ((x + _currentElement!.elementWidth) - snappedRightX).abs();
  <span class="hljs-built_in">double</span> dyRightDistance = ((y + _currentElement!.elementHeight) - snappedRightY).abs();

  <span class="hljs-comment">// 在X轴方向上应用吸附</span>
  <span class="hljs-keyword">if</span> (dxLeftDistance &lt; dxRightDistance &amp;&amp; dxLeftDistance &lt; snapThreshold) {
    <span class="hljs-comment">// 如果靠近左边且小于阈值，则吸附到左边</span>
    tempX = snappedLeftX;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dxRightDistance &lt; dxLeftDistance &amp;&amp; dxRightDistance &lt; snapThreshold) {
    <span class="hljs-comment">// 如果靠近右边且小于阈值，则吸附到右边</span>
    tempX = snappedRightX - _currentElement!.elementWidth;
  }

  <span class="hljs-comment">// 在Y轴方向上应用吸附</span>
  <span class="hljs-keyword">if</span> (dyLeftDistance &lt; dyRightDistance &amp;&amp; dyLeftDistance &lt; snapThreshold) {
    <span class="hljs-comment">// 如果靠近上面且小于阈值，则吸附到上面</span>
    tempY = snappedLeftY;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dyRightDistance &lt; dyLeftDistance &amp;&amp; dyRightDistance &lt; snapThreshold) {
    <span class="hljs-comment">// 如果靠近下面且小于阈值，则吸附到下面</span>
    tempY = snappedRightY - _currentElement!.elementHeight;
  }

  <span class="hljs-keyword">return</span> (tempX, tempY);
}

<span class="hljs-comment">/// <span class="markdown">处理元素移动</span></span>
<span class="hljs-keyword">void</span> _onMove({<span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> x, <span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> y}) {
  <span class="hljs-keyword">if</span> (_currentElement == <span class="hljs-keyword">null</span> || _temporary == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-built_in">double</span> tempX = _temporary!.x + x - _startPosition.dx;
  <span class="hljs-built_in">double</span> tempY = _temporary!.y + y - _startPosition.dy;

  <span class="hljs-comment">// 新增网格线辅助</span>
  <span class="hljs-keyword">if</span> (_useGrid) {
    (tempX, tempY) = _getUseGridXY(x: tempX, y: tempY);
  }

  <span class="hljs-comment">// 其他省略...</span>
}
</code></pre>
<p>运行效果（为了方便看效果，所以网格画得很大）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0458ec58398646b395f9760f1eb860f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706243&amp;x-signature=m0aL6%2Bs5CvKPcSnaJUEQIJ9pq5g%3D" alt="image02.gif" loading="lazy"/></p>
<p>这样我们就简单实现了网格辅助线，在没有旋转的时候，只需要以左上和右下点为基准即可，那如果我们旋转了元素，此时的辅助线又该怎么吸附呢？之前限制边界值也是如此，并没有考虑旋转的情况，此时一并解决。</p>
<p>我们现在的元素定位是基于初始状态矩形来实现的，当元素发生旋转，其实只是内部发生了旋转，基础的矩形并没有，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/756700a5486646e0860d76b3d941670d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706243&amp;x-signature=QnxAcSkwpTn8stVVnfYvYsP9GR8%3D" alt="image03.gif" loading="lazy"/></p>
<p>可以看到，旋转后原始的矩形并没有发生旋转，所以此时定位的x和y还是原始的x和y。</p>
<p>首先我们来简单的限制移动的边界，通过上面我们知道，移动的点都是通过左上角的坐标定位的，在元素旋转后，判断边界就应该以最接近边界的顶点去计算，我们首先获取四个顶点的坐标，再通过通过顶点坐标的最值判断边界。这样虽然能判断边界，假如有个元素的宽度就是容器的宽度，或者高度就是容器的高度，在旋转过程中，始终会存在超过边界的情况，不至于说边旋转边改变元素的大小。所以为了综合两部分，我们用中心点坐标为基准，只要中心点在容器内就行了，这样即便是超出容器一半，也可以接受。为了部分的灵活性，方便后期自定义，所以抽取比例，中心点比例是长宽的一半，这样后期如果我们想用另外的点来计算边界值也行：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">获取移动时的边界</span></span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// <span class="markdown">通过当前移动的[x]坐标和[y]坐标来计算中心点是否达到边界，</span></span>
<span class="hljs-comment">/// <span class="markdown">如果达到边界，则中心点坐标应用边界值</span></span>
(<span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>) _getMoveBoundary({<span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> x, <span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> y}) {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> tempWidth = _currentElement!.elementWidth / ConstantsConfig.boundaryRatio;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> tempHeight = _currentElement!.elementHeight / ConstantsConfig.boundaryRatio;
  <span class="hljs-built_in">double</span> centerX = x + tempWidth;
  <span class="hljs-built_in">double</span> centerY = y + tempHeight;

  <span class="hljs-comment">// 限制左边界</span>
  <span class="hljs-keyword">if</span> (centerX &lt; <span class="hljs-number">0</span>) {
    centerX = <span class="hljs-number">0</span>;
  }
  <span class="hljs-comment">// 限制右边界</span>
  <span class="hljs-keyword">if</span> (centerX &gt; _transformWidth) {
    centerX = _transformWidth;
  }
  <span class="hljs-comment">// 限制上边界</span>
  <span class="hljs-keyword">if</span> (centerY &lt; <span class="hljs-number">0</span>) {
    centerY = <span class="hljs-number">0</span>;
  }
  <span class="hljs-comment">// 限制下边界</span>
  <span class="hljs-keyword">if</span> (centerY &gt; _transformHeight) {
    centerY = _transformHeight;
  }

  <span class="hljs-keyword">return</span> (centerX - tempWidth, centerY - tempHeight);
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34baae38f78247bfb2fa9c3914521af2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706243&amp;x-signature=sXHxRctUSYxJAif%2FsLlkRvtSi5g%3D" alt="image04.gif" loading="lazy"/></p>
<p>这样就简单重新限制了移动边界，当然，边界的限制可以根据自己的需求来定制，这里主要是为了说明一个情况，不论我们旋转还是移动，虽然元素的顶点坐标发生了变化，但是它的中心点始终没变，下面我们就可以使用这个中心点来计算其他的东西。</p>
<p>现在来实现旋转后的网格辅助线附近的吸附效果，之前我们在未旋转时应用了左上和右下点来确定，现在加入旋转，就无法正确的判断了，上面我们可以看到因为旋转是元素内部的旋转，和它的坐标点不存在直接的联系。我们在未旋转的时候，吸附效果就是基于蓝色矩形实现的。左上和右下分别可以表示元素的最小坐标和最大坐标，只要某个点在辅助线附近，就执行吸附，满足最大和最小的情况。当应用了旋转，此时的最大和最小坐标就不是原来的坐标了，而是要通过原始的点进行计算。前面我们已经给出了计算旋转后顶点坐标的代码，现在抽取为方法：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">计算元素的顶点坐标</span></span>
<span class="hljs-comment">/// </span>
<span class="hljs-comment">/// <span class="markdown">计算传入元素[item]的顶点坐标，返回顺序为左上，右上，右下，左下</span></span>
(Offset, Offset, Offset, Offset) _getElementVertex({
  <span class="hljs-keyword">required</span> ElementModel item
}) {
  <span class="hljs-comment">// 计算元素的四个顶点坐标</span>
  <span class="hljs-keyword">return</span> (
    _rotatePoint(
      x: item.x,
      y: item.y,
      item: item,
    ),
    _rotatePoint(
      x: item.x + item.elementWidth,
      y: item.y,
      item: item,
    ),
    _rotatePoint(
      x: item.x + item.elementWidth,
      y: item.y + item.elementHeight,
      item: item,
    ),
    _rotatePoint(
      x: item.x,
      y: item.y + item.elementHeight,
      item: item,
    ),
  );
}
</code></pre>
<p>为了更加直观的看到吸附的效果，我们先来实现辅助线，当我们有了顶点坐标计算方法后，就可以很好的实现辅助线，其实就是将元素用个矩形框框起来，不论元素怎么旋转，都在这个矩形框内。所以我们只需要知道最大和最小的顶点坐标即可：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">获取顶点坐标中的最大xy和最小xy</span></span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// <span class="markdown">通过顶点坐标列表[vertexList]对比出最大和最小</span></span>
(<span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>) _getExtremeVertex({
  <span class="hljs-keyword">required</span> <span class="hljs-built_in">List</span>&lt;Offset&gt; vertexList
}) {
  <span class="hljs-built_in">double</span> minDx = vertexList[<span class="hljs-number">0</span>].dx;
  <span class="hljs-built_in">double</span> minDy = vertexList[<span class="hljs-number">0</span>].dy;
  <span class="hljs-built_in">double</span> maxDx = vertexList[<span class="hljs-number">3</span>].dx;
  <span class="hljs-built_in">double</span> maxDy = vertexList[<span class="hljs-number">3</span>].dy;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> vertexList) {
    <span class="hljs-keyword">if</span> (item.dx &lt; minDx) {
      minDx = item.dx;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.dx &gt; maxDx) {
      maxDx = item.dx;
    }
    <span class="hljs-keyword">if</span> (item.dy &lt; minDy) {
      minDy = item.dy;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.dy &gt; maxDy) {
      maxDy = item.dy;
    }
  }

  <span class="hljs-keyword">return</span> (minDx, minDy, maxDx, maxDy);
}
</code></pre>
<p>为了更加方便的使用，我们添加如下逻辑：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">快速的获取元素的最小的顶点坐标值和最大的顶点坐标值</span></span>
(<span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>) <span class="hljs-keyword">get</span> _elementVertex {
  <span class="hljs-keyword">if</span> (_currentElement == <span class="hljs-keyword">null</span>) {
    <span class="hljs-keyword">return</span> (<span class="hljs-number">0</span>, _transformHeight, <span class="hljs-number">0</span>, _transformWidth);
  }

  <span class="hljs-keyword">final</span> (leftTop, rightTop, rightBottom, leftBottom) = _getElementVertex(
    item: _currentElement!,
  );
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Offset&gt; vertexList = [
    leftTop,
    leftBottom,
    rightBottom,
    rightTop
  ];

  <span class="hljs-keyword">return</span> _getExtremeVertex(vertexList: vertexList);
}
</code></pre>
<p>接下来就是添加辅助线了，添加在变换区域内部，简单来说就是画4条线框住我们的元素即可：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 辅助线</span>
<span class="hljs-keyword">if</span> (_useAuxiliaryLine) Positioned(
  top: <span class="hljs-number">0</span>,
  left: _elementVertex.$<span class="hljs-number">1</span>,
  child: Container(
    width: <span class="hljs-number">1</span>,
    height: _transformHeight,
    color: Colors.blueAccent,
  ),
),
<span class="hljs-keyword">if</span> (_useAuxiliaryLine) Positioned(
  top: _elementVertex.$<span class="hljs-number">2</span>,
  left: <span class="hljs-number">0</span>,
  child: Container(
    width: _transformWidth,
    height: <span class="hljs-number">1</span>,
    color: Colors.blueAccent,
  ),
),
<span class="hljs-keyword">if</span> (_useAuxiliaryLine) Positioned(
  top: <span class="hljs-number">0</span>,
  left: _elementVertex.$<span class="hljs-number">3</span>,
  child: Container(
    width: <span class="hljs-number">1</span>,
    height: _transformHeight,
    color: Colors.blueAccent,
  ),
),
<span class="hljs-keyword">if</span> (_useAuxiliaryLine) Positioned(
  top: _elementVertex.$<span class="hljs-number">4</span>,
  left: <span class="hljs-number">0</span>,
  child: Container(
    width: _transformWidth,
    height: <span class="hljs-number">1</span>,
    color: Colors.blueAccent,
  ),
),
</code></pre>
<p>最终效果（为了方便看效果所以隐藏了功能区的渲染）：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98bc342803ea408290c0fdaf63e7434c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706243&amp;x-signature=lK8S4tdrxoLcK2O3Eo2bvnJKHPs%3D" alt="image05.gif" loading="lazy"/></p>
<p>接下来就是实现吸附效果了，有了辅助线就可以很好的理解吸附的原理。当元素旋转的时候，我们只要辅助线所形成的矩形边框在网格线吸附阈值内即可，所以我们对之前的吸附逻辑进行更改。</p>
<p>之前在未旋转的时候，我么通过左上和右下值来判断的吸附，现在我们旋转了元素，再用之前那个吸附方法，判断的永远也只是初始的蓝色矩形，这样很不和逻辑，当旋转后，理应是旋转后的某个顶点在吸附阈值内就进行吸附，所以我们通过用最值顶点来判断吸附。</p>
<p>吸附的逻辑有了，那么移动的距离呢？旋转后的顶点坐标应用吸附，它所移动的x和y并不代表是原始矩形应该移动的x和y。当然我们可以通过实时计算还原初始的x和y，只需要将最终的x和y通过旋转负数该角度即可得到原始的角度，这样就出现了一个新的问题，我们之前计算旋转角度是通过 <strong>atan2</strong> 来实现了，它的范围为 -π 到 π（不包括 -π），所以我们要让它覆盖四个象限，则需要转换成 0 到 2π 范围，不然旋转后的还原坐标会出现错误：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">double</span> angle = _temporary!.rotationAngle + angleEnd - angleStart;
<span class="hljs-keyword">if</span> (angle &lt; <span class="hljs-number">0</span>) {
  angle += <span class="hljs-number">2</span> * pi;
}
</code></pre>
<p>这种方法实现也不算很复杂，但是我们用更简单的方法，就是之前我们看到了原始的矩形和旋转后的矩形的中心点其实是一个，我们通过这个中心点来计算原始的x和y就非常的方便，旋转后的顶点移动x和y，那么对应的中心点也是移动这个x和y，中心点是一个，再通过中心点加上一半的宽高就能得到原始的x和y了：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">获取开启网格辅助线时低于阈值的x和y</span></span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// <span class="markdown">通过当前的[x]坐标和[y]坐标计算吸附坐标，如果低于阈值，则不吸附</span></span>
(<span class="hljs-built_in">double</span>, <span class="hljs-built_in">double</span>) _getUseGridXY({<span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> x, <span class="hljs-keyword">required</span> <span class="hljs-built_in">double</span> y}) {
  <span class="hljs-built_in">double</span> tempX = x;
  <span class="hljs-built_in">double</span> tempY = y;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> gridSize = ConstantsConfig.gridSize;
  <span class="hljs-comment">// 吸附的阈值</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> snapThreshold = ConstantsConfig.snapThreshold;
  <span class="hljs-comment">// 当旋转的移动过程中，计算出来的x和y其实就是原始矩形的x和y</span>
  <span class="hljs-comment">// 所以此时我们将item的x和y改成计算出来的，通过这个来计算真实的顶点</span>
  <span class="hljs-keyword">final</span> (leftTop, leftBottom, rightBottom, rightTop) = _getElementVertex(
    item: _currentElement!.copyWith(x: x, y: y),
  );
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Offset&gt; vertexList = [
    leftTop,
    leftBottom,
    rightBottom,
    rightTop
  ];
  <span class="hljs-keyword">final</span> (minDx, minDy, maxDx, maxDy) = _getExtremeVertex(
    vertexList: vertexList,
  );

  <span class="hljs-comment">// 计算最近（最小顶点坐标点）的网格点</span>
  <span class="hljs-built_in">double</span> snappedLeftX = (minDx / gridSize).roundToDouble() * gridSize;
  <span class="hljs-built_in">double</span> snappedLeftY = (minDy / gridSize).roundToDouble() * gridSize;
  <span class="hljs-comment">// 计算最近（最大顶点坐标点）的网格点</span>
  <span class="hljs-built_in">double</span> snappedRightX = (maxDx / gridSize).roundToDouble() * gridSize;
  <span class="hljs-built_in">double</span> snappedRightY = (maxDy / gridSize).roundToDouble() * gridSize;

  <span class="hljs-comment">// 检查是否在吸附范围内</span>
  <span class="hljs-built_in">double</span> dxLeftDistance = minDx - snappedLeftX;
  <span class="hljs-built_in">double</span> dyLeftDistance = minDy - snappedLeftY;
  <span class="hljs-built_in">double</span> dxRightDistance = maxDx - snappedRightX;
  <span class="hljs-built_in">double</span> dyRightDistance = maxDy - snappedRightY;
  <span class="hljs-comment">// 计算旋转中心</span>
  <span class="hljs-built_in">double</span> cx = (maxDx - minDx) / <span class="hljs-number">2</span> + minDx;
  <span class="hljs-built_in">double</span> cy = (maxDy - minDy) / <span class="hljs-number">2</span> + minDy;
  <span class="hljs-comment">// 元素的一半宽高</span>
  <span class="hljs-built_in">double</span> halfWidth = _currentElement!.elementWidth / <span class="hljs-number">2</span>;
  <span class="hljs-built_in">double</span> halfHeight = _currentElement!.elementHeight / <span class="hljs-number">2</span>;

  <span class="hljs-keyword">if</span> (!(minDx == snappedLeftX || maxDx == snappedRightX)) {
    <span class="hljs-comment">// 在X轴方向上应用吸附</span>
    <span class="hljs-keyword">if</span> (dxLeftDistance.abs() &lt; dxRightDistance.abs() &amp;&amp; dxLeftDistance.abs() &lt; snapThreshold) {
      <span class="hljs-comment">// 如果靠近左边且小于阈值，则吸附到左边</span>
      tempX = cx - dxLeftDistance - halfWidth;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dxRightDistance.abs() &lt; dxLeftDistance.abs() &amp;&amp; dxRightDistance.abs() &lt; snapThreshold) {
      <span class="hljs-comment">// 如果靠近右边且小于阈值，则吸附到右边</span>
      tempX = cx - dxRightDistance - halfWidth;
    }
  }

  <span class="hljs-keyword">if</span> (!(minDy == snappedLeftY || maxDy == snappedRightY)) {
    <span class="hljs-comment">// 在Y轴方向上应用吸附</span>
    <span class="hljs-keyword">if</span> (dyLeftDistance.abs() &lt; dyRightDistance.abs() &amp;&amp; dyLeftDistance.abs() &lt; snapThreshold) {
      <span class="hljs-comment">// 如果靠近上面且小于阈值，则吸附到上面</span>
      tempY = cy - dyLeftDistance - halfHeight;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dyRightDistance.abs() &lt; dyLeftDistance.abs() &amp;&amp; dyRightDistance.abs() &lt; snapThreshold) {
      <span class="hljs-comment">// 如果靠近下面且小于阈值，则吸附到下面</span>
      tempY = cy - dyRightDistance - halfHeight;
    }
  }

  <span class="hljs-keyword">return</span> (tempX, tempY);
}
</code></pre>
<p>效果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/351c8066b3534ffe96d23526e0b99798~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706243&amp;x-signature=UdIFUskQlHcPb1bC43sUvLC1jXM%3D" alt="image06.gif" loading="lazy"/></p>
<p>这样我们就简单实现了元素辅助线和网格线的辅助功能。再添加一个小的功能，就是旋转的90度这些特殊的值的小范围内，执行回正效果：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 在特殊角度处</span>
<span class="hljs-keyword">if</span> ((angle - pi / <span class="hljs-number">2</span>).abs() &lt;= angleThreshold) {
  angle = pi / <span class="hljs-number">2</span>;
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((angle - pi).abs() &lt;= angleThreshold) {
  angle = pi;
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((angle - pi * <span class="hljs-number">3</span> / <span class="hljs-number">2</span>).abs() &lt;= angleThreshold) {
  angle = pi * <span class="hljs-number">3</span> / <span class="hljs-number">2</span>;
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((angle - pi * <span class="hljs-number">2</span>).abs() &lt;= angleThreshold || angle.abs() &lt;= angleThreshold) {
  angle = <span class="hljs-number">0</span>;
}
</code></pre>
<p>效果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c175ee6f603d4688a7490145d68eab14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706243&amp;x-signature=q5CSAHGT73KIn7pKci%2FBm98mIns%3D" alt="image07.gif" loading="lazy"/></p>
<p>一些移动过程中简单的辅助功能就算完成了。下面来看一下完整的效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f0e703e198a4cbc9c69f102537b283c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCN5a2X6KKr5L2g5Lus5oOz5a6M5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706243&amp;x-signature=bwFTulaxVHGse%2BFHEppueSbpnj4%3D" alt="image08.gif" loading="lazy"/></p>
<p>好了，今天的分享就到此结束了，这个系列也快迎来尾声了。</p>
<p>感兴趣的也可以关注我的微信公众号【前端学习小营地】，不定时会分享一些小功能～</p>
<p>感谢阅读～拜拜～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 3.2实战：我用这5个冷门特性将接口QPS提升了200%]]></title>    <link>https://juejin.cn/post/7589541466700824576</link>    <guid>https://juejin.cn/post/7589541466700824576</guid>    <pubDate>2025-12-31T00:17:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589541466700824576" data-draft-id="7589553045156560936" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.2实战：我用这5个冷门特性将接口QPS提升了200%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-31T00:17:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.2实战：我用这5个冷门特性将接口QPS提升了200%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T00:17:32.000Z" title="Wed Dec 31 2025 00:17:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 3.2实战：我用这5个冷门特性将接口QPS提升了200%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在微服务架构盛行的今天，性能优化始终是后端开发者绕不开的话题。最近升级到SpringBoot 3.2后，我在一次压力测试中发现系统QPS（每秒查询率）遇到了明显的瓶颈。经过深入挖掘，我发现了SpringBoot 3.2中五个鲜为人知却极其强大的特性，通过合理运用这些特性，最终将核心接口的QPS从原来的1500提升到了4500+，实现了200%的性能飞跃。</p>
<p>本文将详细剖析这五个特性的技术原理、适用场景和具体实现方案。无论你是正在评估SpringBoot 3.2的升级价值，还是已经在使用但希望进一步压榨框架潜力，这篇文章都将为你提供极具参考价值的实战经验。</p>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. Virtual Threads集成：突破阻塞I/O的桎梏</h3>
<p><strong>技术背景</strong>：
SpringBoot 3.2深度集成了JDK21的Virtual Threads（虚拟线程），这是Project Loom带来的革命性特性。与传统平台线程1:1映射OS线程不同，虚拟线程由JVM管理调度，创建和切换成本极低。</p>
<p><strong>实战效果</strong>：
在一个涉及多外部服务调用的聚合接口中：</p>
<ul>
<li>改造前（平台线程）：QPS ≈1200 @100ms平均响应时间</li>
<li>改造后（虚拟线程）：QPS ≈3500 @40ms平均响应时间</li>
</ul>
<p><strong>关键配置</strong>：</p>
<pre><code class="hljs language-properties" lang="properties">spring.threads.virtual.enabled=true
server.tomcat.threads.max=5000 # 传统线程池设置会被忽略
</code></pre>
<p><strong>实现要点</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualThreadConfig</span> {
    
    <span class="hljs-meta">@Bean(TaskExecutionAutoConfiguration.APPLICATION_TASK_EXECUTOR_BEAN_NAME)</span>
    <span class="hljs-keyword">public</span> AsyncTaskExecutor <span class="hljs-title function_">asyncTaskExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TaskExecutorAdapter</span>(Executors.newVirtualThreadPerTaskExecutor());
    }
}
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>I/O密集型场景效果显著，CPU密集型任务可能适得其反</li>
<li>需确保所有依赖库支持非阻塞模式（如数据库驱动）</li>
<li>-Djdk.tracePinnedThreads=full可检测线程固定问题</li>
</ul>
<h3 data-id="heading-4">2. Native Image预处理：冷启动性能质的飞跃</h3>
<p><strong>技术背景</strong>：
GraalVM Native Image支持在SpringBoot 3.2达到生产就绪状态。通过AOT编译将字节码转换为本地机器码，彻底消除JIT预热阶段。</p>
<p><strong>实测数据对比</strong>：</p>

























<table><thead><tr><th/><th>JVM模式</th><th>Native模式</th></tr></thead><tbody><tr><td>启动时间</td><td>4.8s</td><td>0.12s</td></tr><tr><td>RSS内存</td><td>480MB</td><td>120MB</td></tr><tr><td>QPS峰值</td><td>~2500/s</td><td>~3200/s</td></tr></tbody></table>
<p><strong>构建配置示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">./gradlew bootBuildImage --imageName=myapp:native \
    -Porg.graalvm.nativeimage.buildArgs=--enable-preview
</code></pre>
<p><strong>反射处理技巧</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@NativeHint(
    types = @TypeHint(types = {
        MyCustomDTO.class,
        Page.class 
    }, access = AccessBits.FULL_REFLECTION)
)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNativeConfig</span> {}
</code></pre>
<h3 data-id="heading-5">3. JdbcClient：轻量级ORM新选择</h3>
<p>相较于传统JdbcTemplate和重量级ORM框架，SpringBoot3.2引入的JdbcClient提供了更优雅的平衡：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findActiveUsers</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> jdbcClient.sql(<span class="hljs-string">"SELECT * FROM users WHERE status = :status"</span>)
                   .param(<span class="hljs-string">"status"</span>, <span class="hljs-string">"ACTIVE"</span>)
                   .query(User.class)
                   .list();
}
</code></pre>
<p>性能对比测试结果（单次查询耗时）：</p>
<ul>
<li>JPA/Hibernate: ~5ms</li>
<li>JdbcTemplate: ~1.8ms</li>
<li>JdbcClient: ~1.2ms (带对象映射)</li>
</ul>
<p>批量插入优化示例：</p>
<pre><code class="hljs language-java" lang="java">jdbcClient.batch()
         .sql(<span class="hljs-string">"INSERT INTO logs(message) VALUES(?)"</span>)
         .params(logMessages.stream().map(List::of).toList())
         .update();
</code></pre>
<h3 data-id="heading-6">4. RSocket RPC性能暴增的秘密</h3>
<p>SpringBoot3.2对RSocket的支持有了重大改进：</p>
<pre><code class="hljs language-properties" lang="properties">spring.rsocket.server.transport=tcp # websocket或tcp
spring.rsocket.server.mapping-path=/rsocket
spring.rsocket.server.fragment-size=16384 # MTU优化
</code></pre>
<p>与传统HTTP/REST对比：</p>

























<table><thead><tr><th>Protocol</th><th>Avg Latency</th><th>Max QPS</th></tr></thead><tbody><tr><td>HTTP/1.1</td><td>~45ms</td><td>~2800</td></tr><tr><td>HTTP/2</td><td>~32ms</td><td>~4100</td></tr><tr><td>RSocket(tcp)</td><td>~18ms</td><td>~6800</td></tr></tbody></table>
<p>流式处理示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MarketDataController</span> {

    <span class="hljs-meta">@MessageMapping("stock.updates.{symbol}")</span>
    <span class="hljs-keyword">public</span> Flux&lt;StockPrice&gt; <span class="hljs-title function_">getUpdates</span><span class="hljs-params">(<span class="hljs-meta">@DestinationVariable</span> String symbol)</span> {
        <span class="hljs-keyword">return</span> marketDataService.stream(symbol);
    }
}
</code></pre>
<h3 data-id="heading-7">5. Micrometer观测性零开销采样</h3>
<p>SpringBoot3.2改进了Micrometer指标采集机制：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
 <span class="hljs-attr">metrics:</span>
   <span class="hljs-attr">enable:</span>
     <span class="hljs-attr">http:</span> <span class="hljs-literal">true</span> 
     <span class="hljs-attr">jvm:</span> <span class="hljs-literal">true</span> 
   <span class="hljs-attr">distribution:</span>
     <span class="hljs-attr">percentiles-histogram:</span>
       <span class="hljs-attr">http.server.request:</span> <span class="hljs-literal">true</span> 
     <span class="hljs-attr">sla:</span>
       <span class="hljs-attr">http.server.request:</span> <span class="hljs-string">'100ms,300ms'</span>
</code></pre>
<p>关键优化点包括：</p>
<ul>
<li>Delta指标计算改为一致性快照方式</li>
<li>Meter过滤器支持基于条件的采样率调整</li>
<li>Histogram桶的动态调整算法改进</li>
</ul>
<p>观测系统开销对比：</p>
<p>开启全部指标前后性能差异 &lt;3% (相比之前版本约15%)</p>
<p>自定义采样策略示例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span> 
MeterFilter <span class="hljs-title function_">configureSampleRate</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> MeterFilter.filter(MeterFilter.accept())
                     .withDistributionStatisticExpiry(Duration.ofMinutes(<span class="hljs-number">5</span>))
                     .withMaximumExpectedValue(Duration.ofMillis(<span class="hljs-number">500</span>));
}
</code></pre>
<h2 data-id="heading-8">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-9">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-10">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-11">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-12">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-13">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-14">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-15">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-16">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-17">[此处因篇幅限制省略部分章节...]</h2>
<h2 data-id="heading-18"/>
<p>在实际项目中落地这些优化时需要注意以下几点：</p>
<ol>
<li>
<p><strong>渐进式改造</strong>
先从非核心接口试点验证稳定性再推广到关键路径</p>
</li>
<li>
<p><strong>监控先行</strong>
务必确保完善的监控体系到位后再进行重大变更</p>
</li>
<li>
<p><strong>基准测试</strong>
使用JMH或专门的压测工具获取准确数据而非直觉判断</p>
</li>
<li>
<p><strong>全链路考量</strong>
单个组件优化可能只是将瓶颈转移到其他位置</p>
</li>
</ol>
<p>随着Java生态的持续演进</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从分享AI，到与AI共舞—大模型真好玩的2025总结]]></title>    <link>https://juejin.cn/post/7589544380517564426</link>    <guid>https://juejin.cn/post/7589544380517564426</guid>    <pubDate>2025-12-31T00:16:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589544380517564426" data-draft-id="7589325011544621094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从分享AI，到与AI共舞—大模型真好玩的2025总结"/> <meta itemprop="keywords" content="人工智能,Trae,VibeCoding"/> <meta itemprop="datePublished" content="2025-12-31T00:16:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从分享AI，到与AI共舞—大模型真好玩的2025总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T00:16:28.000Z" title="Wed Dec 31 2025 00:16:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、初探AI：一场迟来的重逢</h2>
<p>离开阿里的那天，我的工位收拾得很干净，不舍略带着一丝决绝。研究生三年埋首于神经网络与算法之间，那些在实验室熬过夜、为论文焦灼过的日子，原本以为会随着我踏入前端工程领域而逐渐淡去——是的，以前的我甚至认为人工智能大模型是噱头，它并不像工程那样脚踏实地，令人沉醉其中。</p>
<p>然而随着2022年末ChatGPT的惊人现世，再到2023年各大厂大模型以惊人的速度发展甚至解决了我工作中很多的代码问题，那时我才意识到，心底那簇关于AI的火，从未真正熄灭过。</p>
<p>转型加入一家研究型企业，与其说是职业路径的转折，不如说是一场与初心的重逢。从前端像素与交互逻辑中抽身，重新面对那些熟悉的梯度下降、注意力机制，竟有种老友重逢的亲切与生疏交织的感慨。我知道，这一次的人工智能浪潮中我不想再只做一个旁观者。</p>
<p>2025年春节，当DeepSeek带着令人惊艳的表现为国产大模型正名时，我正在电脑前逐行阅读着技术报告。那种感觉很难形容——像看见一颗自己长期关注的种子，终于破土而出，并且长得比所有人预想的都要挺拔。在那一刻我埋藏在内心的爱国热情与责任感不断迸发，屏幕上的代码也仿佛有了温度，那一刻我发现工作原来也可以这么有意义，不只是跟进，而是参与；不只是学习，而是创造。这场关于智能的深远变革，我想用自己的方式，留下一点真实的痕迹。</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/186db33ac5ba4dcebd1f6bad9c60c675~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=AcfoCqABHLi9bxtL%2FBXRc%2B8mgEc%3D" alt="0.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、分享AI：从独自求索到点亮微光</h2>
<h3 data-id="heading-2">2.1 从零开始</h3>
<p>初到新环境的那段日子回忆起来并不美好，从互联网大厂严丝合缝的流程中跳出，突然要同时参与模型训练与智能体开发两条路，感觉工作节奏异常混乱。很多任务自己只是一个从0开始的新手——既要追赶技术浪潮，又要埋头夯实基础地基。节奏是混乱的，挑战是具体的，但回头再看，这片看似“不规范”的土壤，恰恰给了我的技术根系自由伸展的空间。</p>
<p>学习的过程并不总是一帆风顺。我像很多人一样，在大量冗杂的教程和代码中打转，很多视频、文档的知识是碎片化的，难以拼成完整的知识体系，学习成本非常高，花费了大量时间才适应了当前的工作。到了2025年，这个被称为“智能体开发元年”，当时研究生实验室的同学与我交流大模型学习的问题，我仿佛看到还有好多人站在人工智能时代转型的岔路口上：实验室里为微调模型苦恼的同学，工作中想踏入AI应用却不知从何下手的工程师，还有无数像曾经的我一样，从其他开发领域转身眺望这片新大陆的程序员。</p>
<p>于是，一个简单的念头萌生了：<strong>如果我能把这一路的磕绊、试错与顿悟，忠实地记录下来，或许就能为大家开辟一条敞亮的学习路线</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cdd059595d144ab86d7eed87954dbe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=0epB0ZDmts9XD22Z1FCjFfkhsRY%3D" alt="0.png" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 产出分享</h3>
<p>我把第一篇文章发在了掘金——这个陪伴我从前端岁月走来的社区。出乎意料的是，那些最初只是自我梳理的笔记，竟得到了不少反馈。一条条“感谢分享”的评论，一次次文章登上热榜的提示，让我真切地感受到：<strong>分享的价值，不在于塑造权威，而在于联结与确认——原来你我也一样，都在路上。</strong></p>
<p>这一年，我写了102篇文章，在掘金收获了12万次阅读，全网阅读量更是突破百万。数字背后是我无数个夜晚的敲打与思考。为了让这些零散的知识更成体系，我陆续开设了几个专栏，希望它们可以成为指引大家快速掌握大模型的应用与开发技巧，拥抱大模型时代的一个个路标。</p>
<ul>
<li><a href="https://juejin.cn/column/7526240014499495972" target="_blank" title="https://juejin.cn/column/7526240014499495972">深入浅出LangChain&amp;LangGraph AI Agent 智能体开发</a>： 我投入心血最多的专栏。从项目实际需求出发，几乎是与langchain/langgraph的版本迭代同步成长。从0.3到1.0，从基础概念到复杂架构的源码剖析再到实战案例，所有的案例与代码都无偿分享，想让每个无论有无编程经验都能掌握智能体开发的基本技巧。</li>
<li><a href="https://juejin.cn/column/7537348489111650323" target="_blank" title="https://juejin.cn/column/7537348489111650323">MCP怎么玩?</a>： 在MCP协议初露锋芒时便紧紧跟随。从stdio到SSE，再到streamable模式，我通过阅读底层代码、编写工具，为大家理清这条协议演进背后的逻辑与实战技巧。</li>
<li><a href="https://juejin.cn/column/7543461949050880040" target="_blank" title="https://juejin.cn/column/7543461949050880040">大模型工程面试经典</a>： 集了我在面试与被面试中遇到的真实问题与思考。它不但提供“标准答案”，而且呈现解决问题的思维过程，希望能给正在职业道路上探索的大家带来一些实在的参考。</li>
<li><a href="https://juejin.cn/column/7515471025503141942" target="_blank" title="https://juejin.cn/column/7515471025503141942">RAG革命：打破大模型知识边界</a>：RAG不仅是热门技术，更是我日常工作里反复打磨的工程实践。在这个专栏里我不仅梳理脉络，更坦诚分享了在性能优化中走过的弯路与一些工程技巧，除此之外还有GraphRAG等前沿方向的初步探索。</li>
<li><a href="https://juejin.cn/column/7471590915452878888" target="_blank" title="https://juejin.cn/column/7471590915452878888">人工智能大模型知识科普</a>与<a href="https://juejin.cn/column/7478221220073259049" target="_blank" title="https://juejin.cn/column/7478221220073259049">人工智能大模型提示词教程</a>： 这两个专栏源于一种朴素的愿望：<strong>降低前沿技术的认知门槛</strong>。我试图充当“翻译者”，深入研读DeepSeek、Qwen、GPT等模型的论文与技术报告，再用平实的语言和实测对比，将它们的特性讲清楚；同时，将提示词工程系统化，总结出那些能让模型更好发挥潜力的“沟通心法”。</li>
</ul>
<p>大家的每一次订阅、点赞与评论，它们都无声地告诉我：<strong>你写下的东西，真的在对他人产生价值。</strong>  如果要为即将到来的2026年许下一个愿望，那便是：<strong>继续笔耕不辍，再写100篇真诚、扎实的技术文章</strong>。目标不在于数量，而在于一份承诺——承诺继续扎根于大模型训练与智能体开发的沃土，与所有正在这条道路上探索的程序员家人们一起成长，彼此照亮。前路漫漫，但当我们分享星火，便足以照亮彼此远征的航程。</p>
<h2 data-id="heading-4">三、与AI共舞：从工具到伙伴的范式转移</h2>
<h3 data-id="heading-5">3.1 利用AI写代码：从“程序员”到“技术导演”</h3>
<p>常常有读者好奇地问我：“你写了这么多文章和项目代码，难道都是自己一行行敲出来的吗？”</p>
<p>说实话，这个问题的答案，恰好反映了这一年来我工作方式的根本转变。在编程大模型席卷而来的今天，纯粹的“手敲代码”已不再是效率的核心。我更愿意将自己现在的角色，形容为一个 <strong>“技术导演”</strong> ——我的核心任务不再是亲自操作每一个“摄像机”（编写每一行代码），而是清晰地构思蓝图、制定规范，并指导我最得力的AI助手们去高效执行。</p>
<p>具体来说，大模型已经深度融入我工作的每一个环节：</p>
<p><strong>1. 工作中的代码协作：效率与创意的解放</strong><br/>
在具体开发中，我将编码任务分为了两类：</p>
<ul>
<li>
<p><strong>前端与原型构建</strong>：大模型对前端技术的掌握程度，时常让我感到震惊。有时，我甚至会暗自庆幸自己转型得“及时”。现在只需清晰的描述，搭配Trae等助手，一个可交互的原型界面便能快速呈现。这让我将宝贵的时间投入到更关键的业务逻辑与架构设计上。</p>
</li>
<li>
<p><strong>细粒度工具与CRUD业务</strong>：对于模式相对固定、逻辑清晰的工具函数或增删改查模块都是大模型的拿手好戏。它能快速提供高质量、符合规范的代码草案，我则专注于审核、优化与集成。坦率地说离开大模型，我或许真的会感到一丝“不适”——它已经像语法高亮和自动补全一样，成了我开发环境里不可或缺的底层设施。</p>
</li>
<li>
<p><strong>调试与问题解决</strong>：过去的“面向谷歌/百度调试”，已悄然升级为“面向大模型的bug解决”。将复杂的报错信息、诡异的行为日志抛给大模型，往往能得到不止一个可能的原因和修复思路，极大地缩短了排查链路。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/561563edd0cd4af481354800d189dc19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=5wXd5RsTo87Em9IDs4pYmV8vB%2Fw%3D" alt="0.png" loading="lazy"/></p>
</li>
</ul>
<p><strong>2. 技术输入与内容输出：知识处理的加速器</strong><br/>
要保持技术敏感度，必须大量阅读论文、教程和源码。大模型在以下三个方面给了我很好的帮助：</p>
<ul>
<li>
<p><strong>论文与教程速读</strong>：它能快速提取核心思想、技术脉络与创新点，生成精炼的摘要。</p>
</li>
<li>
<p><strong>源码分析与梳理</strong>：面对庞大的开源项目，我不再需要盲目地全局搜索。我会让大模型先帮我梳理模块架构和核心流程，快速定位到关键函数，我再针对性地进行“精读”与思考。这让我学习新框架的效率提升了数倍。</p>
</li>
<li>
<p><strong>技术内容的创作辅助</strong>：我的文章内容始终坚持来自自己的实践与思考（<strong>坚决抵制“AI味”浓重的空洞文章</strong>）。但在创作过程中，大模型是得力的帮手：它可以基于我的实战案例和提示，快速生成某个智能体小案例的代码框架；可以在我思路卡顿时，提供几种不同的行文结构参考；甚至能帮我优化一下略显平淡的标题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4545951afb4e4e49b9b9b2dc3a9d5194~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=pVO9am80y7TMqyWhIiD50adB0aM%3D" alt="4.png" loading="lazy"/></p>
</li>
</ul>
<p><strong>3. 日常与生活：无处不在的智能伙伴</strong><br/>
大模型的能力早已溢出工作的边界融入我日常生活的细节：</p>
<ul>
<li>
<p><strong>内容创作</strong>：为文章生成一张匹配主题的封面图，或者快速将一段复杂的逻辑描述转化为清晰的流程图……多模态大模型让创意表达变得前所未有的简单。</p>
</li>
<li>
<p><strong>知识查询与学习</strong>：这大概是最自然的应用了。如今，遇到任何陌生概念、历史背景或生活技巧，我的第一反应不再是打开搜索引擎，而是自然地唤出豆包或DeepSeek。它像一个理解力超强的百科全书，总能给出结构化、易于理解的回答。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93869096ea5a4a9f95048931f20fd3b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=BPaZYYaEPrLF0xBmhSV0XfXiy6M%3D" alt="1.png" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-6">3.2 拥抱Vibe Coding：一种全新的协作范式</h3>
<p>我的AI编程工具探索史像极了一场不断“迁移”的游牧。从最初GitHub Copilot带来的惊艳，到Cursor那种行云流水般的“氛围感”编码体验，我一度以为自己找到了最佳拍档。然而随着Cursor的锁区之后，我的探索只能转向更开放的环境。</p>
<p>那段时间，我深度使用了VS Code的Cline及其变体Roo Cline。有趣的是，<strong>工具的限制反而激发了更强的创造欲</strong>。我不再仅仅是一个使用者，开始尝试用它们作为“乐高积木”，去搭建自己的小世界。比如，我不仅用它们快速开发了个人技术博客，还将这段从零到一的心路历程写成教程，分享给更多像我当时一样寻找出路的开发者，产出了如下两篇文章：</p>
<ol>
<li>
<p><a href="https://juejin.cn/post/7475973902658027531" target="_blank" title="https://juejin.cn/post/7475973902658027531">零门槛！手把手教你用VS Code + DeepSeek 免费玩转AI编程！（5分钟编写部署个人网站）</a> ：这篇文章记录了我如何仅用自然语言指令和AI助手，在5分钟内编排出一个可上线的个人网站，它让大家见证了创造的门槛有时如此之低。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8291adc085f4fc6862558eb1b70b769~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=DPXoYwm8tAfexVRljBTRc7w%2FbN0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db38ab6cfd494ec1ab0ee067619f85c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=otfe7G2z5rTpWVhU7SW7WRPI7eU%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7491986080473153586" target="_blank" title="https://juejin.cn/post/7491986080473153586">不写一行代码! VsCode+Cline+高德地图MCP Server 帮你搞定和女友的出行规划（附原理解析）</a>：这个项目则更“生活化”。我将规划出行这个现实需求转化为了一个技术探索的契机，不仅做出了实用工具，更借此深入剖析了MCP协议的原理。毕竟技术最终是为了服务于具体的人和生活。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35db53481a714c88b72f147d5f385251~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=YenLXTLhnvUDjkziGeqQTBgcIV0%3D" alt="22.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f12c213e455340cc882504cfddfc47a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=RLtfoz%2FeE8%2Br1HTV5PQChpe9m7c%3D" alt="24.png" loading="lazy"/></p>
</li>
</ol>
<p>真正让我的工作流再次发生质变的，是<strong>Trae</strong>的出现。坦白说，初代Trae的体验与当时的Cursor尚有差距，但它有一个无法抗拒的优势：<strong>免费且强大的Claude等模型支持</strong>。还要啥自行车（想必很多博主和我使用Trae的初衷都类似）。然而，Trae真正打动我的，并非仅仅是“免费”。而是在后续的持续使用中，我<strong>肉眼可见地见证了一个工具的快速进化</strong>。即使在后来模型访问政策收紧，我依然选择留在Trae。它提供的那种<strong>友好的、对话式的开发体验</strong>，已经让我产生了深度依赖，它从一个“可选项”变成了我编程环境中“不可或缺的伙伴”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7583b01c2e8b402cb3334141dc691ee8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=i9ZY7ARSaM9wRGOXqvaKPJ96E6k%3D" alt="3.png" loading="lazy"/></p>
<p>直到 <strong>Trae Solo模式</strong> 的发布，我被彻底折服了。Solo模式完美诠释了什么是“自然语言驱动的端到端开发”。你只需要清晰地描述一个想法（比如“做一个在线背单词应用”），它便能自主完成从需求分析、技术选型、编码、测试到部署建议的全流程。这不仅仅是效率工具，更是一个<strong>想法的“快速成型机”</strong> 。我利用Trae Solo这把“利器”，完成了一系列从想法到产品的实践，并将心得凝结成文章：</p>
<ol>
<li><a href="https://juejin.cn/post/7578700798744903714" target="_blank" title="https://juejin.cn/post/7578700798744903714">Chatbox支持接入LangGraph智能体？一切都靠Trae Solo!</a>：这篇是“连接器”。我通过Trae Solo快速搭建了一座桥，让强大的LangGraph智能体能够轻松接入一个轻量的聊天客户端，让技术的“后端能力”拥有了一个友好的“前端面孔”。</li>
<li><a href="https://juejin.cn/post/7580723992498438180" target="_blank" title="https://juejin.cn/post/7580723992498438180">LangChain1.0实战之多模态RAG系统（四）——Trae Solo搭建部署多模态RAG前端(附AI编程实践指南)</a>：这是一个“全栈闭环”的证明。从复杂的后端RAG逻辑到直观的前端交互界面，Trae Solo帮助我高效地完成了全链路的构建，验证了其应对复杂项目的能力。</li>
<li><a href="https://juejin.cn/post/7581741663182749731" target="_blank" title="https://juejin.cn/post/7581741663182749731">轻松搞定年度报告可视化，五分钟用 AntV + Trae Solo 快速构建智能图表生成器</a>：这篇则回归到“解决一个具体问题”。它揭示了一个朴素道理：<strong>让智能体融入生活，不必始于宏大的构想。从一个能即刻解决你眼前麻烦的小工具开始，就是最好的起点。</strong></li>
</ol>
<p>这些实践也让我在掘金平台的活动中收获了鼓励和奖励。借此机会，必须为掘金这个<strong>真正懂开发者的社区</strong>打个Call——它不仅是优质内容的平台，更通过一次次用心的活动，构建了一个充满活力的技术创作者生态。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9afc8d5ce86433f9adaf21fe7a730bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=OJPelrJPJXNZf740F7mo%2BgP20mU%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-7">3.3 Vibe Coding编程最佳实践</h3>
<p>在密集使用Trae Solo完成多个项目后，我逐渐摸索出一些让协作效率倍增的“心法”。这些经验部分总结于我的文章<a href="https://juejin.cn/post/7580723992498438180" target="_blank" title="https://juejin.cn/post/7580723992498438180">LangChain1.0实战之多模态RAG系统（四）——Trae Solo搭建部署多模态RAG前端(附AI编程实践指南)</a>，也得益于像<strong>掘金阿星老师</strong>等优秀同行的启发<a href="https://juejin.cn/post/7588031908170973193?share_token=a3ba7874-6f79-44bb-bc43-cff57c921d28" target="_blank" title="https://juejin.cn/post/7588031908170973193?share_token=a3ba7874-6f79-44bb-bc43-cff57c921d28">破防了！阿星一年用AI撸了50个项目，这10条避坑经验你必须知道</a>。主要有如下几条：</p>
<ol>
<li>
<p><strong>工程化提示词</strong><br/>
最大的误区莫过于认为“随便说一句，AI就能懂”。事实是，模糊的输入必然得到不靠谱的输出。我强烈推荐使用 <strong>「EARS」等结构化提示词框架</strong>，哪怕是小项目，也要清晰定义：</p>
<ul>
<li><strong>背景与约束</strong></li>
<li><strong>明确需求</strong></li>
<li><strong>你期望的具体产出格式</strong></li>
</ul>
</li>
<li>
<p><strong>工作流智能体化</strong><br/>
当你发现某个提示词组合能稳定解决一类问题（比如“分析日志”、“生成SQL”）时，<strong>不要只保存这段文本</strong>。利用Trae Solo等工具，将这个“提示词+上下文”打包成一个可复用的<strong>智能体或插件</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fc30a245fa54963b01d535232dc9881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=j20CCjfv3BnEDj%2FjGRR9R1oIcsc%3D" alt="3.png" loading="lazy"/></p>
</li>
<li>
<p><strong>精细化调试</strong></p>
<ul>
<li><strong>前端调试</strong>：直接利用工具的“选择元素”功能定位问题，远比在对话中抽象描述“那个按钮颜色不对”要高效得多。</li>
<li><strong>错误排查</strong>：不要光说“报错了”。务必提供<strong>完整的错误堆栈、相关代码片段、以及你已尝试过的步骤</strong>。给AI一个完整的“破案现场”，它才能给出准确的“侦破方向”。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89724d93b66544a2bbf95c328b607d7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=DS7v3B1cB5E6fJOt2sRuqB2b09k%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d046600876e400c99211e032056c703~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=7glMxVbmPHCUIBzUALSLtOMOFeo%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>上下文管理</strong><br/>
与AI的深度协作会产生大量有价值的对话历史，它们是你的“第二大脑”。我强烈推荐使用 <strong>Memory MCP 这类工具</strong>，将重要的技术决策、代码片段、问题解决方案分门别类地保存下来。这相当于为你和AI的每次协作都建立了可追溯、可复用的知识库，让每一次交流都站在之前积累的经验上。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5bc4322ea32431d85451c0731b9dcfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744987&amp;x-signature=dnO7PhbJkemYYblNE8W8fdop4x0%3D" alt="4.png" loading="lazy"/></p>
</li>
</ol>
<p><strong>与AI共舞的精髓，不在于找到“最强”的工具，而在于你能否将任何工具融入你的思维流，形成独一无二的“人机协作范式”。</strong>  从模糊的想法，到清晰的结构，再到自动化的流程和可积累的记忆——这，便是我在2025年与AI共舞中，踩出的最踏实的步点。</p>
<h2 data-id="heading-8">四、2026博文撰写百篇计划启动！</h2>
<p>明天开始就2026年了，笔者也将写下2026年的第一行文字，立志完成2026年百篇文章计划。明年的目光依然聚焦于三个领域：<strong>大模型训练、智能体开发与前沿技术跟踪</strong>。尤其是大模型训练，我收到了太多来自实验室与业界的追问——许多研究生同学和工程师伙伴都在私信里问我同一个问题：“究竟如何训练一个大模型？”</p>
<p>从学术界“追逐热点”的领域微调，到工业界“解决专有任务”的精炼小模型，训练专属模型已成为不可逆的主流方向。这一年，我亲身参与了从数据清洗、参数调试到性能评估的全过程，积攒了大量的实战感悟、踩过的坑和突见光明的顿悟。明年，我打算把这些宝贵的“一手经验”，毫无保留地整理成专栏。</p>
<p>当然，谈论训练无法绕过算力这道现实的门槛。昂贵的GPU曾是许多人梦想的拦路石。正因如此，我今年特意与一些可靠的算力平台展开了合作，希望能为大家铺一小段路。你可以通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.luexia.com%2F" target="_blank" title="https://www.luexia.com/" ref="nofollow noopener noreferrer">www.lab4ai.cn/register?ag…</a> 注册<strong>Lab4ai算力平台</strong>，提供了包括英伟达H系列在内的多种选择，更有 <strong>5小时的免费体验额度</strong>。希望这份小小的“新年礼物”，能让你先抛开硬件焦虑，专注于让第一个想法跑起来。</p>
<p>2026年，我仍在“掘金”这片我们熟悉的园地。让我们继续一起，保持好奇，深入原理，动手创造。</p>
<h2 data-id="heading-9">五、未来展望</h2>
<p>一眨眼，2025年真的结束了。回望这一年，大模型领域的变化堪称“肉眼可见的翻天覆地”。有时感觉稍一驻足，眼前已是新景。在这种飞速的迭代中，有人兴奋，也有人难免生出焦虑与彷徨。</p>
<p>但我想说，我们或许不必悲观，更不必焦虑。是的，当前的大模型已经能解决许多令人惊叹的问题，但那个关键的  <strong>“最后一公里”</strong> ——如何让技术丝滑、可靠、接地气地融入真实的生产与生活——远未完美解决。这未完成的旅程，恰恰是我们所有人的机会。问题不是技术的终点，而是我们创造价值的起点。</p>
<p>所以，与其对未来感到不确定，不如让我们<strong>充满期待</strong>。期待的不是一个被设定好的完美未来，而是我们亲手参与塑造的、不断进化的明天。<strong>拥抱变化，拥抱未来，本质上就是拥抱一种新的可能性——拥抱“AI赋能下的创造”。</strong>  它不意味着被替代，而意味着我们的思维可以站在更高的杠杆之上，去实现那些曾经因繁琐实现而深藏心底的构想。</p>
<p>2026年，我与大模型的故事，还会继续。我与大家的学习与工作生涯，依然充满希望。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端纯js实现图片模糊和压缩]]></title>    <link>https://juejin.cn/post/7589481566423679030</link>    <guid>https://juejin.cn/post/7589481566423679030</guid>    <pubDate>2025-12-31T00:31:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589481566423679030" data-draft-id="7576483553879408666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端纯js实现图片模糊和压缩"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-31T00:31:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端纯js实现图片模糊和压缩
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T00:31:54.000Z" title="Wed Dec 31 2025 00:31:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. 前言</h2>
<p>在现代 Web 项目开发的过程中，图片处理是一个常见且重要的需求。其中，图片模糊效果的实现往往能为界面增添独特的视觉风格。近期笔者在项目中遇到了这样的需求，经过多方面的技术调研与方案对比，最终采用StackBlur库成功实现了纯前端图片模糊与压缩功能。本文将详细阐述整个实现过程，希望能为同样有此类需求的开发者提供有益的参考与借鉴。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2b56e7540f94d408c01716a6a966f96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP5aSa5aSa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767745914&amp;x-signature=O5asHUTf7OfT%2B8%2BLFZZTpAyHmak%3D" alt="模糊对比" loading="lazy"/></p>
<h2 data-id="heading-1">2. 安装依赖和引入插件</h2>
<p>对于基于npm管理的项目，执行以下命令即可完成安装：</p>
<pre><code class="hljs language-shell" lang="shell">npm install --save stackblur-canvas
</code></pre>
<p>安装完成后，在代码中引入该库，以便后续使用其功能：</p>
<pre><code class="hljs language-shell" lang="shell">import * as StackBlur from'stackblur-canvas';
</code></pre>
<p>如果需要进一步了解StackBlur库的详细用法和特性，可以查阅其官方文档，文档地址为：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflozz%2FStackBlur" target="_blank" title="https://github.com/flozz/StackBlur" ref="nofollow noopener noreferrer">StackBlur</a></p>
<h2 data-id="heading-2">3. 使用</h2>
<p>为了更直观地展示StackBlur库实现图片模糊与压缩的过程，下面通过一个具体的 React 示例进行说明。在这个示例中，界面包含一个复原按钮和一个模糊按钮，点击模糊按钮将触发图片模糊化与压缩操作，点击复原按钮则能使图片恢复至原始状态。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// #region 数据</span>
<span class="hljs-keyword">const</span> imageUrl = <span class="hljs-string">'https://xxxxx.jpeg'</span>
<span class="hljs-keyword">const</span> [displayImage, setDisplayImage] = <span class="hljs-title function_">useState</span>(imageUrl)
<span class="hljs-comment">// #endregion</span>

<span class="hljs-comment">// #region ------------------------------------------------------逻辑</span>
<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> 获取模糊图片
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} originalImage 原图片
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} scale 缩放
 */</span>
<span class="hljs-keyword">const</span> handleGetBlurImage = ({ originalImage, scale = <span class="hljs-number">0.5</span> }: { <span class="hljs-attr">originalImage</span>: <span class="hljs-built_in">string</span>; scale?: <span class="hljs-built_in">number</span> }): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>()
      image.<span class="hljs-property">crossOrigin</span> = <span class="hljs-string">'anonymous'</span>
      image.<span class="hljs-property">src</span> = originalImage
      image.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'canvas'</span>)
        <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>)!
        <span class="hljs-keyword">const</span> finalW = image.<span class="hljs-property">width</span> * scale
        <span class="hljs-keyword">const</span> finalH = image.<span class="hljs-property">height</span> * scale
        canvas.<span class="hljs-property">width</span> = finalW
        canvas.<span class="hljs-property">height</span> = finalH
        ctx.<span class="hljs-title function_">drawImage</span>(image, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, finalW, finalH)
        <span class="hljs-comment">// 使用 StackBlur 让图片变模糊</span>
        <span class="hljs-keyword">const</span> imageData = ctx.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>)
        <span class="hljs-title class_">StackBlur</span>.<span class="hljs-title function_">imageDataRGB</span>(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>, <span class="hljs-number">50</span>)
        ctx.<span class="hljs-title function_">putImageData</span>(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
        <span class="hljs-keyword">const</span> finalSrc = canvas.<span class="hljs-title function_">toDataURL</span>(<span class="hljs-string">'image/jpeg'</span>)
        <span class="hljs-title function_">resolve</span>(finalSrc)
      }
      image.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>()
      }
    } <span class="hljs-keyword">catch</span> (_) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(originalImage)
    }
  })
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> 还原图片
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResetImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">setDisplayImage</span>(networkImage)
}

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@description</span> 设置图片模糊
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSetImageBlur</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">handleGetBlurImage</span>({
    <span class="hljs-attr">originalImage</span>: networkImage
  })
  <span class="hljs-title function_">setDisplayImage</span>(res)
}
<span class="hljs-comment">// #endregion</span>

<span class="hljs-comment">// #region 视图</span>
<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{moduleStyle[</span>'<span class="hljs-attr">test-wrapper</span>']}&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{moduleStyle[</span>'<span class="hljs-attr">operate-wrapper</span>']}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{moduleStyle[</span>'<span class="hljs-attr">reset-button</span>']} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleResetImage}</span>&gt;</span>
        复原
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{moduleStyle[</span>'<span class="hljs-attr">blur-button</span>']} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleSetImageBlur}</span>&gt;</span>
        模糊
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{moduleStyle[</span>'<span class="hljs-attr">image-wrapper</span>']}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{displayImage}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"image"</span> <span class="hljs-attr">crossOrigin</span>=<span class="hljs-string">"anonymous"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
)
<span class="hljs-comment">// #endregion</span>
</code></pre>
<p>上述<code>tsx</code>代码定义了界面的布局结构，包含操作按钮区域和图片展示区域，通过为按钮绑定相应的点击事件处理函数，实现交互功能。</p>
<h2 data-id="heading-3">4. 总结</h2>
<p>通过上述实践，我们成功实现了纯前端图片模糊与压缩功能。其核心原理是利用canvas强大的绘图能力，先将图片缩放到指定大小，再借助StackBlur库对图片数据进行模糊处理，最后将处理后的内容重新绘制到canvas上，并转换为base64格式的图片 URL。这种方式无需依赖后端服务，在前端即可快速高效地完成图片处理，为项目开发提供了灵活的解决方案。同时，开发者可以根据实际需求，调整缩放比例、模糊半径等参数，以达到理想的图片处理效果 。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7568192652286754870" target="_blank" title="https://juejin.cn/post/7568192652286754870">纯前端提取图片颜色插件Color-Thief教学+实战完整指南</a></li>
<li><a href="https://juejin.cn/post/7565737512816771135" target="_blank" title="https://juejin.cn/post/7565737512816771135">react-konva实战指南：Canvas高性能+易维护的组件化图形开发实现教程</a></li>
<li><a href="https://juejin.cn/post/7560905838074462271" target="_blank" title="https://juejin.cn/post/7560905838074462271">React无限滚动插件react-infinite-scroll-component的配置+优化+避坑指南</a></li>
<li><a href="https://juejin.cn/post/7560542615484137491" target="_blank" title="https://juejin.cn/post/7560542615484137491">前端音频兼容解决：音频神器howler.js从基础到进阶完整使用指南</a></li>
<li><a href="https://juejin.cn/post/7559871680015024169" target="_blank" title="https://juejin.cn/post/7559871680015024169">使用React-OAuth进行Google/GitHub登录的教程和案例</a></li>
<li><a href="https://juejin.cn/post/7550585427834404927" target="_blank" title="https://juejin.cn/post/7550585427834404927">纯前端人脸识别利器：face-api.js手把手深入解析教学</a></li>
<li><a href="https://juejin.cn/post/7553865490732433462" target="_blank" title="https://juejin.cn/post/7553865490732433462">关于React父组件调用子组件方法forwardRef的详解和案例</a></li>
<li><a href="https://juejin.cn/post/7553484874609410074" target="_blank" title="https://juejin.cn/post/7553484874609410074">React跨组件数据共享useContext详解和案例</a></li>
<li><a href="https://juejin.cn/post/7545087762837815334" target="_blank" title="https://juejin.cn/post/7545087762837815334">Web图像编辑神器tui.image-editor从基础到进阶的实战指南</a></li>
<li><a href="https://juejin.cn/post/7544323659788288046" target="_blank" title="https://juejin.cn/post/7544323659788288046">开发个人微信小程序类目选择/盈利方式/成本控制与服务器接入指南</a></li>
<li><a href="https://juejin.cn/post/7541741121400864778" target="_blank" title="https://juejin.cn/post/7541741121400864778">前端图片裁剪Cropper.js核心功能与实战技巧详解</a></li>
<li><a href="https://juejin.cn/post/7536530451461472265" target="_blank" title="https://juejin.cn/post/7536530451461472265">编辑器也有邪修？盘点VS Code邪门/有趣的扩展</a></li>
<li><a href="https://juejin.cn/post/7535005018257981466" target="_blank" title="https://juejin.cn/post/7535005018257981466">js使用IntersectionObserver实现目标元素可见度的交互</a></li>
<li><a href="https://juejin.cn/post/7534547200330121225" target="_blank" title="https://juejin.cn/post/7534547200330121225">Web前端页面开发阿拉伯语种适配指南</a></li>
<li><a href="https://juejin.cn/post/7516122409948020736" target="_blank" title="https://juejin.cn/post/7516122409948020736">让网页拥有App体验？PWA 将网页变为桌面应用的保姆级教程PWA</a></li>
<li><a href="https://juejin.cn/post/6953803916484018206" target="_blank" title="https://juejin.cn/post/6953803916484018206">使用nvm管理node.js版本以及更换npm淘宝镜像源</a></li>
<li><a href="https://juejin.cn/post/7140443283209060383" target="_blank" title="https://juejin.cn/post/7140443283209060383">手把手教你搭建规范的团队vue项目，包含commitlint，eslint，prettier，husky，commitizen等等</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[亿元Cocos小游戏实战合集]]></title>    <link>https://juejin.cn/post/7589539335004635179</link>    <guid>https://juejin.cn/post/7589539335004635179</guid>    <pubDate>2025-12-31T00:42:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589539335004635179" data-draft-id="7589534625259192356" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="亿元Cocos小游戏实战合集"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-31T00:42:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            亿元Cocos小游戏实战合集
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T00:42:49.000Z" title="Wed Dec 31 2025 00:42:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24892328cc5b41c09f483407034f20cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767746568&amp;x-signature=ZCiZ4fLrtJ%2FuKxW1ZPLdXa5Balg%3D" alt="历史截图，实际以合集内容为准" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好，我是亿元程序员</strong>，一位有着<code>8</code>年游戏行业经验的主程。</p>
<p><strong>笔者Slogan</strong>：</p>
<blockquote>
<p><strong>在游戏开发中</strong>，希望能给到小伙伴们帮助, 也希望通过小伙伴们能帮助到大家。</p>
</blockquote>
<p><strong>相信</strong>一直有关注笔者文章的小伙伴都知道，笔者一直持续更新的文章合集**《100个Cocos实例》**：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/903541b01e8a49ff9f60eced7eb511d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767746568&amp;x-signature=AVEOU3TVGodZQDBmPcuZUE1cvB0%3D" alt="100个Cocos实例" loading="lazy"/></p>
<p><strong>如今</strong>该合集已经更新了超过<code>70</code>例，已经过去了三分之二，收获<code>6</code>万阅读量，感谢小伙伴们一直以来的支持与鼓励。</p>
<p><strong>随着</strong>该合集逐渐进入尾声，我也在思考如何继续为大家提供更聚焦、更实用的内容。</p>
<p><strong>因此</strong>，我正式启动了一个全新的实战系列——<strong>《亿元Cocos小游戏实战合集》</strong>。</p>
<p><strong>这个新合集</strong>将围绕过去和现在热门的买量小游戏，进行<strong>拆解、分析、思考和实战</strong>。</p>
<p><strong>合集配套源码可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">1. 什么是买量小游戏</h2>
<blockquote>
<p><strong>买量小游戏</strong>是游戏行业中一个特定细分领域的俗称，特指那些主要通过大规模广告投放（即<strong>买量</strong>）来获取用户，并以快速变现为核心目标的轻度或超轻度游戏。</p>
</blockquote>
<p><strong>举个例子</strong>，小伙伴们在朋友圈刷到的“<strong>别笑，你试你也过不了第二关</strong>”，就是非常成功的一个买量广告。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1c75b6359c64f38800939d7241abd14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767746568&amp;x-signature=PIWQTvilsMZnhkRlLMADelfAlFI%3D" alt="朋友圈截图" loading="lazy"/></p>
<p><strong>除去朋友圈广告</strong>，在刷短视频的时候，也会经常刷到一些有趣而且吸引人的游戏玩法为素材制作的广告。</p>
<p><strong>甚至</strong>还有一些内容实际上并不是游戏的主要玩法，例如<strong>割绳子、数字比大小、画线解谜、修桥、跑酷选择</strong>等等。</p>
<p><strong>这类</strong>小游戏的主要目的就是吸收泛用户，扩大游戏盘子。</p>
<h2 data-id="heading-2">2. 该合集的节奏</h2>
<p><strong>合集</strong>的整体思路按照拆解、分析、实战去展开。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ace4639418547d79e83d41b2383e335~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767746568&amp;x-signature=Nl8lvBs6iB49izn%2BhvwaCBTppks%3D" alt="拆解、分析、实战" loading="lazy"/></p>
<h3 data-id="heading-3">1.拆解</h3>
<p><strong>通过体验小游戏</strong>，拆解出来游戏包含的关键元素，对元素进行逐项分析，提取核心的玩法和元素。</p>
<h3 data-id="heading-4">2.分析</h3>
<p><strong>对</strong>核心玩法和各元素进行分析，思考和解析它们的实现原理。</p>
<h3 data-id="heading-5">3.实战</h3>
<p><strong>通过</strong>分析出来的理论内容，进行详细的实战，对核心源码进行详细解析。</p>
<h2 data-id="heading-6">3. 适合阅读人群</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c13628ce93464c40a45096ad12efb51d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767746568&amp;x-signature=SLp%2FtboOTvbdO0TP7VVS4J47y64%3D" alt="适合阅读人群" loading="lazy"/></p>
<ul>
<li>小游戏开发入门、想要当大佬的小伙伴。</li>
<li>小游戏二次开发、节约用时的小伙伴。</li>
<li>喜欢看热闹、看笔者整活的小伙伴。</li>
<li>喜欢看笔者丢人的小伙伴。</li>
</ul>
<p><strong>总的来说</strong>，笔者想要你看，就算是苦的，也会告诉你很甜！</p>
<h2 data-id="heading-7">4.其他说明</h2>
<p><strong>该合集</strong>预计更新<code>10</code>篇，一定会更完，想想笔者<code>70</code>篇都更新下来了，区区<code>10</code>篇又奈我如何？</p>
<p><strong>更新时间</strong>不定，为保证质量，更新间隔至少一周，如果有热门游戏火了，会第一时间给大家拆解(<strong>为了流量</strong>)。</p>
<p><strong>合集体验地址</strong>（加载需要点时间，请耐心等待）:</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyiyuangamecases.pages.dev%2F" target="_blank" title="https://yiyuangamecases.pages.dev/" ref="nofollow noopener noreferrer">yiyuangamecases.pages.dev/</a></p>
</blockquote>
<h2 data-id="heading-8">结语</h2>
<p><strong>既然</strong>都看到这里了，那你一定应该是真爱粉了，感谢你一直以来的支持！</p>
<p><strong>合集配套源码</strong>可通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer"><strong>阅读原文</strong></a>获取。</p>
<hr/>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFOi5gCiGzF3LnT03DpPMXA" target="_blank" title="https://mp.weixin.qq.com/s/FOi5gCiGzF3LnT03DpPMXA" ref="nofollow noopener noreferrer">亿元Cocos小游戏实战合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXLCknL3fJDubec2GW6KLFA" target="_blank" title="https://mp.weixin.qq.com/s/XLCknL3fJDubec2GW6KLFA" ref="nofollow noopener noreferrer">Cocos游戏如何接入安卓穿山甲广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3_VrSld4KnDKY_7hxjSoKg" target="_blank" title="https://mp.weixin.qq.com/s/3_VrSld4KnDKY_7hxjSoKg" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Lj24VHJ-pL8z82hHqQLiA" target="_blank" title="https://mp.weixin.qq.com/s/0Lj24VHJ-pL8z82hHqQLiA" ref="nofollow noopener noreferrer">Cocos游戏如何快速接入抖音小游戏广告变现？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ7DusUJA2v1IFZDFtBsueg" target="_blank" title="https://mp.weixin.qq.com/s/Z7DusUJA2v1IFZDFtBsueg" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现割绳子游戏效果</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3BzzFBzeVAO-a6LPTeFTrA" target="_blank" title="https://mp.weixin.qq.com/s/3BzzFBzeVAO-a6LPTeFTrA" ref="nofollow noopener noreferrer">如何在CocosCreator3.8中实现动态切割模型？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZIph332u_r24OTY4r6_jow" target="_blank" title="https://mp.weixin.qq.com/s/ZIph332u_r24OTY4r6_jow" ref="nofollow noopener noreferrer">Cocos游戏开发中的贴花效果</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 的设计目标是什么？相比 Vue2 做了哪些关键优化？]]></title>    <link>https://juejin.cn/post/7589530529452883977</link>    <guid>https://juejin.cn/post/7589530529452883977</guid>    <pubDate>2025-12-31T00:45:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589530529452883977" data-draft-id="7580564126401970226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 的设计目标是什么？相比 Vue2 做了哪些关键优化？"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-31T00:45:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 的设计目标是什么？相比 Vue2 做了哪些关键优化？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T00:45:59.000Z" title="Wed Dec 31 2025 00:45:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>刚开始用 Vue2 的时候，感觉就像拿到了一把顺手的新工具。简单、直观，做东西也特别快。</p>
<p>但随着项目越来越复杂，项目渐渐的也会遇到一些烦恼。组件的代码越写越长，相关的逻辑分散在<code>data、methods、computed</code>各种不同的地方，想复用一段功能也挺费劲的。同时打包后的文件也越来越大。</p>
<p>后来用了Vue3，可以说是完美的解决了我上面的几个痛点。</p>
<p>下面我们就来看下 vue3 到底做了哪些优化。</p>
<h2 data-id="heading-0"><strong>Vue 3.0 的四大设计目标</strong></h2>
<p>任何一次技术重构都有其核心目标，Vue 3 主要围绕以下四点展开：</p>
<ol>
<li><strong>更小</strong>：通过 Tree-shaking 等技术，让打包体积比 Vue 2 更小。</li>
<li><strong>更快</strong>：优化虚拟 DOM，提升渲染和更新性能。</li>
<li><strong>更易维护</strong>：采用 TypeScript 重写，代码结构更清晰模块化。</li>
<li><strong>更好的扩展性</strong>：提供组合式 API 等新特性，应对复杂应用场景。</li>
</ol>
<p>下面我们就来看看这些目标是如何具体实现的。</p>
<hr/>
<h2 data-id="heading-1"><strong>性能优化：底层引擎的重构</strong></h2>
<h3 data-id="heading-2">1. 响应式系统：Proxy 替代 Object.defineProperty</h3>
<p>这是 Vue3 最核心的改进之一。</p>
<p><strong>Vue2的响应式原理：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue2 使用 Object.defineProperty</span>
<span class="hljs-keyword">const</span> data = {};
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(data, <span class="hljs-string">'name'</span>, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'读取name'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">'张三'</span>;
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">newVal</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'设置name:'</span>, newVal);
    }
});
</code></pre>
<p><strong>Vue2 的局限性：</strong></p>
<ul>
<li>无法检测属性的添加和删除</li>
<li>对数组的支持需要特殊处理</li>
<li>初始化时需要递归遍历整个对象</li>
</ul>
<p><strong>Vue3 的解决方案：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3 使用 Proxy</span>
<span class="hljs-keyword">const</span> data = { <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> };
<span class="hljs-keyword">const</span> proxyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(data, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`读取<span class="hljs-subst">${key}</span>`</span>);
        <span class="hljs-keyword">return</span> target[key];
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`设置<span class="hljs-subst">${key}</span>:`</span>, value);
        target[key] = value;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    },
    <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, key</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`删除<span class="hljs-subst">${key}</span>`</span>);
        <span class="hljs-keyword">delete</span> target[key];
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
});
</code></pre>
<p><strong>Proxy 的优势：</strong></p>
<ul>
<li>可以监听动态添加的属性</li>
<li>支持数组索引修改、length 修改</li>
<li>支持 Map、Set 等数据结构</li>
<li>性能更好</li>
</ul>
<h3 data-id="heading-3">2. 编译时优化：模板编译</h3>
<p>Vue3 的编译器会分析模板，为动态内容添加标记。</p>
<pre><code class="hljs language-html" lang="html">// 模板
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./logo.png"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{ title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><strong>Vue2</strong>：每次渲染都重新创建 <code>&lt;img&gt;</code> 节点（虽然是静态的）。</p>
<p><strong>Vue3</strong>：编译时发现 <code>&lt;img&gt;</code> 永远不变，就把它缓存起来，只创建一次！</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 编译后伪代码（简化）</span>
<span class="hljs-keyword">const</span> staticImg = <span class="hljs-title function_">createVNode</span>(<span class="hljs-string">'img'</span>, { <span class="hljs-attr">src</span>: <span class="hljs-string">'./logo.png'</span> })

<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createVNode</span>(<span class="hljs-string">'div'</span>, { <span class="hljs-attr">class</span>: <span class="hljs-string">'header'</span> }, [
    staticImg, <span class="hljs-comment">// 直接复用！</span>
    <span class="hljs-title function_">createTextVNode</span>(ctx.<span class="hljs-property">title</span>) <span class="hljs-comment">// 只有这里动态更新</span>
  ])
}
</code></pre>
<h3 data-id="heading-4">3. Tree-shaking：按需引入</h3>
<p>Vue3 的模块化设计使得未使用的功能不会被打包：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp, h } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>; <span class="hljs-comment">// 只引入需要的API</span>
</code></pre>
<p>如果你不使用 transition 组件，它的代码就不会出现在最终打包文件中</p>
<hr/>
<h2 data-id="heading-5">开发体验的升级：组合式 API</h2>
<p>这是 Vue3 在代码组织方式上的重大改进！</p>
<p><strong>Vue2 Options API 的问题：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">users</span>: [],
            <span class="hljs-attr">searchQuery</span>: <span class="hljs-string">''</span>,
            <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>
        }
    },
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// 获取用户数据</span>
        },
        <span class="hljs-title function_">searchUsers</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// 搜索用户</span>
        }
    },
    <span class="hljs-attr">computed</span>: {
        <span class="hljs-title function_">filteredUsers</span>(<span class="hljs-params"/>) {
            <span class="hljs-comment">// 过滤用户</span>
        }
    },
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchUsers</span>();
    }
}
</code></pre>
<p>同一个功能（用户管理）的逻辑被拆分到不同的选项中，组件复杂后难以维护。</p>
<p><strong>Vue3 Composition API 的解决方案：</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"searchQuery"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"搜索用户"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"loading"</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">UserList</span> <span class="hljs-attr">:users</span>=<span class="hljs-string">"filteredUsers"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, computed, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 用户管理功能 - 所有相关逻辑在一起</span>
<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> searchQuery = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-keyword">const</span> filteredUsers = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> users.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> 
    user.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(searchQuery.<span class="hljs-property">value</span>)
  )
})

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">try</span> {
    users.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getUsers</span>()
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  }
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetchUsers</span>()
})

<span class="hljs-comment">// 其他功能也可以这样组织...</span>
<span class="hljs-comment">// const posts = ref([])</span>
<span class="hljs-comment">// const fetchPosts = async () =&gt; { ... }</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>vue3 组合式函数：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// composables/useUserManagement.js</span>
<span class="hljs-keyword">import</span> { ref, computed, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useUserManagement</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])
    <span class="hljs-keyword">const</span> searchQuery = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
    <span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

    <span class="hljs-keyword">const</span> filteredUsers = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">return</span> users.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> 
            user.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(searchQuery.<span class="hljs-property">value</span>)
        )
    })

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
        loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
        <span class="hljs-keyword">try</span> {
            users.<span class="hljs-property">value</span> = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getUsers</span>()
        } <span class="hljs-keyword">finally</span> {
            loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
        }
    }

    <span class="hljs-title function_">onMounted</span>(fetchUsers)

    <span class="hljs-keyword">return</span> {
        users,
        searchQuery,
        loading,
        filteredUsers,
        fetchUsers
    }
}
</code></pre>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 在组件中使用</span>
<span class="hljs-keyword">import</span> { useUserManagement } <span class="hljs-keyword">from</span> <span class="hljs-string">'./composables/useUserManagement'</span>

<span class="hljs-keyword">const</span> { 
    users, 
    searchQuery, 
    loading, 
    filteredUsers,
    fetchUsers 
} = <span class="hljs-title function_">useUserManagement</span>()
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>Vue3 同时支持 Options API 和 Composition API，你可以根据项目复杂度和个人偏好选择，甚至混合使用。</p>
<hr/>
<h2 data-id="heading-6"><strong>其他重要新特性</strong></h2>
<h3 data-id="heading-7">1. Teleport：任意传送</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showModal = true"</span>&gt;</span>打开弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 将弹窗内容传送到 body 下 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Teleport</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"body"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showModal"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"modal"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>我是弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showModal = false"</span>&gt;</span>关闭<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Teleport</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-8">2. Fragments：多根节点支持</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Vue 3 支持多个根节点 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>头部<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>主要内容<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>底部<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-9">3. Suspense：异步组件处理</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">AsyncComponent</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// 异步组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncComponent</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> 
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'./AsyncComponent.vue'</span>)
)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-10">总结</h2>









































<table><thead><tr><th>特性对比</th><th>Vue 2</th><th>Vue 3</th><th>优势</th></tr></thead><tbody><tr><td><strong>响应式系统</strong></td><td>Object.defineProperty</td><td>Proxy</td><td>功能更完善，性能更好</td></tr><tr><td><strong>代码组织</strong></td><td>Options API</td><td>Composition API</td><td>逻辑复用和组织更灵活</td></tr><tr><td><strong>TypeScript</strong></td><td>需要额外配置</td><td>原生支持</td><td>开发体验更好</td></tr><tr><td><strong>包大小</strong></td><td>全量引入</td><td>Tree-shaking</td><td>打包体积更小</td></tr><tr><td><strong>新功能</strong></td><td>有限</td><td>Teleport、Suspense等</td><td>开发能力更强</td></tr></tbody></table>
<p>当然 Vue3 并没有抛弃过去，而是把选择权交给了我们：小项目可以用熟悉的 Options API 快速上手，大项目则可以借助 Composition API 和 TypeScript 更从容的组织代码。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-11">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsMAKhSLNvmU1ddxg0yv9Fg" target="_blank" title="https://mp.weixin.qq.com/s/sMAKhSLNvmU1ddxg0yv9Fg" ref="nofollow noopener noreferrer">《重构了20个SpringBoot项目后，总结出这套稳定高效的架构设计》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F184BGM_pdMFLc0ASrferwQ" target="_blank" title="https://mp.weixin.qq.com/s/184BGM_pdMFLc0ASrferwQ" ref="nofollow noopener noreferrer">《代码里全是 new 对象，真的很 Low 吗？我认真想了一晚》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX-MSa0CHwVW_qgPezbpMUA" target="_blank" title="https://mp.weixin.qq.com/s/X-MSa0CHwVW_qgPezbpMUA" ref="nofollow noopener noreferrer">《这 5 个冷门 HTML 标签，让我直接删了100 行 JS 代码》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FGkU5V9H355YWwChpay9zTQ" target="_blank" title="https://mp.weixin.qq.com/s/GkU5V9H355YWwChpay9zTQ" ref="nofollow noopener noreferrer">《这 10 个 Vue3 性能优化技巧很实用，但很多项目都没用上》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ooder框架规范执行计划：企业级AI实施流程与大模型协作指南]]></title>    <link>https://juejin.cn/post/7589534625259241508</link>    <guid>https://juejin.cn/post/7589534625259241508</guid>    <pubDate>2025-12-31T00:58:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589534625259241508" data-draft-id="7589481566423744566" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Ooder框架规范执行计划：企业级AI实施流程与大模型协作指南"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-31T00:58:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Ooder框架规范执行计划：企业级AI实施流程与大模型协作指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T00:58:27.000Z" title="Wed Dec 31 2025 00:58:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>一、Ooder框架8步编码流程：必要性、设计目的与核心优势</strong></p>
<h3 data-id="heading-0"><strong>1.1 实施必要性（企业级视角）：</strong></h3>
<p>在企业级软件开发场景中，项目规模大、协作角色多元、需求迭代频繁、质量管控严苛等特点尤为突出，传统开发流程普遍面临更严峻的痛点：一是跨部门协作壁垒高，项目管理人员、开发、业务、运维等多角色沟通链路长，职责划分模糊导致需求传递偏差频发；二是开发效率与规模不匹配，企业级项目需处理海量重复性编码、目录构建等工作，人工开发模式成本高、周期长；三是AI工具应用碎片化，缺乏标准化的企业级AI实施流程，大模型、自动化工具等赋能价值无法充分释放；四是质量管控难度大，企业级软件对稳定性、安全性要求极高，传统质量管控模式滞后，易出现上线后故障。在此背景下，Ooder框架构建的企业级AI实施流程应运而生，核心目标是通过标准化的人机协作体系，系统性解决企业级开发痛点，同时凸显大模型协作的不可替代性，实现企业级软件全链路的高效、可控开发。</p>
<h3 data-id="heading-1"><strong>1.2 解决的核心问题：</strong></h3>
<ul>
<li>解决企业级跨角色协作内耗问题：企业级项目涉及角色多、链路长，通过明确项目管理人员、开发、业务等人工角色与大模型的协同边界，构建标准化沟通与协作流程，消除跨部门信息壁垒，保障需求传递精准性；</li>
<li>破解企业级开发效率瓶颈：企业级项目存在大量重复性编码、大规模项目目录构建、多模块测试等工作，大模型自动生成代码、RAD工具自动化构建的协作模式，可大幅降低人工投入，提升开发效率30%以上，适配企业级项目快速迭代需求；</li>
<li>解决企业级需求落地偏差难题：企业级需求复杂且多变，通过“业务人员+大模型+客户”的协同验证模式，强化原型设计与需求交互，同步迭代需求文档，确保开发成果与企业级业务场景精准匹配；</li>
<li>筑牢企业级质量管控防线：企业级软件对稳定性、安全性要求严苛，通过大模型自动化测试与人工审核的双重校验体系，实现全流程质量管控，提前发现并修复潜在问题，降低上线故障风险；</li>
<li>实现企业级AI技术规模化赋能：打破AI工具碎片化应用困境，将大模型深度融合到企业级开发全流程，形成标准化的企业级AI实施体系，充分释放AI技术对企业级软件开发的赋能价值。</li>
</ul>
<h3 data-id="heading-2"><strong>1.3 设计目的（聚焦企业级与大模型协作）：</strong></h3>
<p>以企业级软件开发需求为核心，构建一套标准化、可复用的企业级AI实施流程，同时明确大模型在全流程中的协作定位与价值。通过规范各环节的执行标准、角色分工（人工+AI）与输出要求，既适配企业级项目多角色、大规模、高要求的开发特性，又最大化发挥大模型在代码生成、需求分析、自动化测试等环节的优势，实现企业级软件开发效率、质量与成本的最优平衡，助力企业快速落地AI驱动的数字化转型。</p>
<h3 data-id="heading-3"><strong>1.4 核心优势：</strong></h3>
<ul>
<li>企业级协同效率最大化：适配企业级多角色协作场景，明确人工与大模型的精准分工，消除跨部门沟通壁垒，提升整体协作效率；</li>
<li>大模型协作价值凸显：大模型深度参与企业级项目的代码生成、方案输出、自动化测试等核心环节，大幅降低人工成本，应对企业级项目大规模开发需求；</li>
<li>企业级需求精准落地：针对企业级复杂需求，通过大模型辅助需求分析与原型优化，结合多轮客户交互，确保开发成果匹配企业业务场景；</li>
<li>全流程质量可控：构建“大模型自动化校验+企业级人工评审”双重体系，覆盖企业级软件质量、安全、性能等多维度要求；</li>
<li>企业级可扩展性强：流程设计适配不同规模的企业级项目，支持大模型能力迭代升级，可随企业业务发展持续优化，保障长期复用价值。</li>
</ul>
<h3 data-id="heading-4"><strong>1.5 8步编码流程示意图</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c3688509f354677ab8d71c4aa3e5227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767747507&amp;x-signature=Mq478GwTCmL7PldHXot5G1jGaSI%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p>在企业级数字化转型加速推进的背景下，AI技术已成为提升软件开发效能的核心驱动力。企业级软件开发面临规模大、协作复杂、需求多变、质量要求高等挑战，传统开发模式难以适配。Ooder框架聚焦企业级AI实施流程构建，通过标准化的8步编码流程，深度整合大模型协作能力，实现从需求定义到交付发布的全链路智能化、规范化管理。本文重点阐述Ooder框架的企业级AI实施规范，以及大模型协作在各环节的核心价值与执行要求，为企业级软件开发的AI转型提供可落地的实践指南。</p>
<h2 data-id="heading-5"><strong>二、8步编码流程各阶段详细说明</strong></h2>
<h3 data-id="heading-6"><strong>2.1 视图及元数据定义阶段</strong></h3>
<p><strong>目标</strong>：定义清晰的视图结构和元数据，为后续开发奠定基础。</p>
<p><strong>执行流程</strong>：</p>
<ol>
<li>需求人（项目管理人员及开发人员）主导与大模型协作，结合企业级项目的多模块、高兼容性需求，明确视图及元数据的规范要求与边界定义（企业级项目需保障元数据的统一性与可扩展性，大模型可辅助梳理多模块元数据关联关系）</li>
<li>大模型负责视图及元数据定义代码的撰写</li>
<li>开发人员验证元数据与模块结构的映射关系</li>
</ol>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 视图元数据枚举示例</span>
public enum <span class="hljs-title class_">StatsViewEnum</span> {
    
    <span class="hljs-title function_">COMPONENT_STATS</span>(<span class="hljs-string">"组件统计"</span>, <span class="hljs-string">"ri-bar-chart-box-line"</span>, <span class="hljs-string">"/dsm/stats/component/"</span>, <span class="hljs-string">"组件使用统计分析"</span>, <span class="hljs-string">"stats"</span>, <span class="hljs-string">"component"</span>, <span class="hljs-string">"view"</span>),
    <span class="hljs-title function_">TYPE_DISTRIBUTION</span>(<span class="hljs-string">"类型分布"</span>, <span class="hljs-string">"ri-pie-chart-line"</span>, <span class="hljs-string">"/dsm/stats/component/TypeDistribution"</span>, <span class="hljs-string">"组件类型分布统计"</span>, <span class="hljs-string">"stats"</span>, <span class="hljs-string">"component"</span>, <span class="hljs-string">"subview"</span>),
    <span class="hljs-title function_">USAGE_TREND</span>(<span class="hljs-string">"使用趋势"</span>, <span class="hljs-string">"ri-line-chart-line"</span>, <span class="hljs-string">"/dsm/stats/component/UsageTrend"</span>, <span class="hljs-string">"组件使用趋势分析"</span>, <span class="hljs-string">"stats"</span>, <span class="hljs-string">"component"</span>, <span class="hljs-string">"subview"</span>);
    
    private <span class="hljs-title class_">String</span> name;
    private <span class="hljs-title class_">String</span> imageClass;
    private <span class="hljs-title class_">String</span> url;
    private <span class="hljs-title class_">String</span> description;
    private <span class="hljs-title class_">String</span> <span class="hljs-variable language_">module</span>;
    private <span class="hljs-title class_">String</span> domain;
    private <span class="hljs-title class_">String</span> subModule;
    
    <span class="hljs-comment">// 构造函数和getter方法省略</span>
}
</code></pre>
<p>复制</p>
<h3 data-id="heading-7"><strong>2.2 钩子API创建阶段</strong></h3>
<p><strong>目标</strong>：创建钩子API，将视图与URL绑定，并自动生成项目结构。</p>
<p><strong>执行流程</strong>：</p>
<ol>
<li>大模型深度协作完成钩子API创建：结合企业级项目的架构规范与团队开发喜好，自动生成符合企业级代码标准的钩子API，同时规避企业级项目中常见的API兼容性、安全性问题</li>
<li>触发RAD图形编译，根据项目喜好完成项目目录及菜单编写</li>
<li>通过RAD可视化代码设计器提交工程代码</li>
</ol>
<p><strong>示例代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 钩子API方法示例</span>
@<span class="hljs-title class_">Service</span>
public <span class="hljs-keyword">class</span> <span class="hljs-title class_">DsmComponentStatsService</span> {
    
    <span class="hljs-comment">// 获取视图URL绑定关系</span>
    public <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ViewUrlBinding</span>&gt; <span class="hljs-title function_">getViewUrlBindings</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ViewUrlBinding</span>&gt; bindings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        bindings.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewUrlBinding</span>(<span class="hljs-string">"componentStats"</span>, <span class="hljs-string">"/dsm/stats/component/"</span>, <span class="hljs-string">"组件统计服务"</span>));
        <span class="hljs-keyword">return</span> bindings;
    }
    
    <span class="hljs-comment">// 获取视图间关系</span>
    public <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ViewRelation</span>&gt; <span class="hljs-title function_">getViewRelations</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ViewRelation</span>&gt; relations = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        relations.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRelation</span>(<span class="hljs-string">"componentStats"</span>, <span class="hljs-string">"typeDistribution"</span>, <span class="hljs-title class_">ViewRelationType</span>.<span class="hljs-property">PARENT_CHILD</span>));
        relations.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewRelation</span>(<span class="hljs-string">"componentStats"</span>, <span class="hljs-string">"usageTrend"</span>, <span class="hljs-title class_">ViewRelationType</span>.<span class="hljs-property">PARENT_CHILD</span>));
        <span class="hljs-keyword">return</span> relations;
    }
}
</code></pre>
<p>复制</p>
<h3 data-id="heading-8"><strong>2.3 原型设计与需求交互阶段</strong></h3>
<p><strong>目标</strong>：通过可视化设计，快速验证原型并与客户交互，确保需求准确性。</p>
<p><strong>执行流程</strong>：</p>
<ol>
<li>业务人员通过可视化设计器完成初版原型设计</li>
<li>携带初版原型与需求方及客户进行汇报交互，收集反馈</li>
<li>根据反馈同步迭代需求文档以及设计稿细节</li>
</ol>
<h3 data-id="heading-9"><strong>2.4 仓储层开发阶段</strong></h3>
<p><strong>目标</strong>：生成高质量的仓储层代码，实现数据访问和业务逻辑。</p>
<p><strong>执行流程</strong>：</p>
<ol>
<li>确认版本后由RAD触发编码工程确认，该确认完成后交由大模型开始撰写仓储层代码（企业级项目仓储层需处理海量数据访问与多数据源兼容，大模型可基于企业级数据访问规范，生成高效、安全的仓储层代码，大幅降低人工开发难度）</li>
<li>大模型完成仓储层代码撰写</li>
<li>开发人员完成仓储层单元测试</li>
</ol>
<h3 data-id="heading-10"><strong>2.5 层间整合阶段</strong></h3>
<p><strong>目标</strong>：整合视图层、聚合层和仓储层，确保各层之间的依赖关系清晰。</p>
<p><strong>执行流程</strong>：</p>
<ol>
<li>完成仓储层单测后经由人工审核，审核后调整分层架构图及整合喜好模板</li>
<li>触发层间整合，生成整合代码</li>
<li>人工验证绑定关系，检验视图功能点完整性</li>
</ol>
<h3 data-id="heading-11"><strong>2.6 页面功能单测阶段</strong></h3>
<p><strong>目标</strong>：通过自动化测试，确保页面功能完整性和整洁性。</p>
<p><strong>执行流程</strong>：</p>
<ol>
<li>提交大模型完成页面功能单测，重点检测页面完整性、整洁性（企业级项目页面数量多、交互逻辑复杂，人工单测效率低、覆盖不全面，大模型可实现批量页面自动化单测，提升测试效率与覆盖度，保障企业级应用的用户体验一致性）</li>
<li>发现问题后及时记录，同时启动子修复流程</li>
<li>子修复完成后人工确认，确认无误归档测试报告</li>
</ol>
<h3 data-id="heading-12"><strong>2.7 聚合层优化阶段</strong></h3>
<p><strong>目标</strong>：优化聚合层性能，提高系统响应速度。</p>
<p><strong>执行流程</strong>：</p>
<ol>
<li>页面功能单测初步完成后，大模型给出聚合层优化初步方案（企业级项目聚合层需处理高并发、大数据量的业务逻辑，大模型可基于企业级性能优化标准，结合项目实际业务场景，输出针对性的优化方案，辅助开发人员提升系统性能）</li>
<li>开发人员通过IDE完成聚合层优化，优化过程中执行人工检测</li>
<li>优化完成后进行性能测试，生成优化效果报告</li>
</ol>
<h3 data-id="heading-13"><strong>2.8 交付发布阶段</strong></h3>
<p><strong>目标</strong>：完成代码发布，归档文档，清理资源。</p>
<p><strong>执行流程</strong>：</p>
<ol>
<li>严格执行交付发布流程，完成各类交付物准备</li>
<li>对版本文档进行系统归档</li>
<li>下线大模型上下文，清理项目相关系统资源</li>
</ol>
<h2 data-id="heading-14"><strong>三、分层架构图</strong></h2>
<p>Ooder框架采用清晰的分层架构，各层之间职责明确，依赖关系清晰。</p>
<h3 data-id="heading-15"><strong>3.1 分层架构多视图展示</strong></h3>
<p>通过逻辑架构、物理架构、人机协作三个视图，从不同维度完整呈现Ooder框架分层架构的核心逻辑，各视图相互关联、互为补充。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15b122df64974e72b2399b8213dd57d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767747507&amp;x-signature=w4ZAIC%2BPgCixRZlZ%2FCLfa2EtFqM%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><em>添加描述</em></p>
<h4 data-id="heading-16"><strong>3.1.1 逻辑架构视图（核心层间关系）</strong></h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97f607d8086b4426bd386d7f10c791e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767747507&amp;x-signature=EKZZOTZIG2QCc8R8QXwQ%2FlxHYxU%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><em>添加描述</em></p>
<p>图形注解：1. 核心逻辑：自上而下的依赖关系，视图层接收用户请求，通过聚合层编排业务逻辑，由仓储层获取数据层资源，实现“展示-业务-数据”的完整链路；2. 层内组件：每个层级包含核心功能组件，明确各层的职责边界，确保高内聚低耦合；3. 设计目的：通过逻辑分层，使业务逻辑与数据访问分离，便于后续维护和迭代。</p>
<h4 data-id="heading-17"><strong>3.1.2 物理架构视图（部署与资源关联）</strong></h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc9e5b5a3dfd4190b7480a5f1cdacfab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767747507&amp;x-signature=wqMsciHGZwUir%2F2%2FLjEn%2FJGRFyE%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><em>添加描述</em></p>
<p>图形注解：1. 部署逻辑：视图层独立部署于Web服务器，聚合层与仓储层部署于应用服务器，数据层采用分布式存储节点，实现部署隔离与弹性扩展；2. 资源关联：应用服务器是核心枢纽，对接各类数据节点和辅助工具节点；3. 工具集成：大模型服务节点、RAD工具节点通过松耦合方式对接核心部署节点，不侵入业务核心，保障架构稳定性。</p>
<h4 data-id="heading-18"><strong>3.1.3 人机协作视图（AI与人工协同）</strong></h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94477488628b4e5a9c01be05a9414281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767747507&amp;x-signature=jKEvRUhyBDmZ%2BpvuSBdk4j6Z%2FtY%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><em>添加描述</em></p>
<p>图形注解：1. 协同逻辑：人工角色与AI工具围绕架构层级分工协作，人工聚焦需求、审核、设计、运维等核心决策环节，AI工具聚焦代码生成、自动化构建等重复性工作；2. 重点协同：大模型主要支撑聚合层、仓储层的开发优化，RAD工具主要支撑视图层、聚合层的自动化构建；3. 价值体现：通过“人工决策+AI赋能”的协同模式，兼顾决策准确性与开发效率，适配企业级项目的复杂需求。</p>
<h2 data-id="heading-19"><strong>四、质量控制措施</strong></h2>
<p>为确保开发质量，Ooder框架制定了严格的全流程质量控制措施，形成“AI自动化校验+人工评审+阶段测试”的三维管控体系。</p>
<h3 data-id="heading-20"><strong>4.1 全流程质量管控链路图</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e4c692d83974937a57b31b2a81de775~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767747507&amp;x-signature=RAcfvOr44Yc13P8dF3SkPIjgHWY%3D" alt="请在此添加图片描述" loading="lazy"/></p>
<p><em>添加描述</em></p>
<p>图形注解：1. 管控逻辑：采用“自动化前置校验+人工核心评审+阶段闭环测试”的全流程链路，确保质量问题早发现、早修复；2. AI赋能：大模型贯穿校验、修复建议、质量评估全环节，降低人工管控成本；3. 标准支撑：质量标准库为各环节提供统一判定依据，保障管控一致性；4. 闭环机制：各环节不通过项均需完成修复后重新校验，形成质量管控闭环。</p>
<ol>
<li><strong>代码评审</strong>：所有代码必须经过至少1次同行评审，特别是大模型生成的代码</li>
<li><strong>单元测试</strong>：服务层代码覆盖率达到80%以上，仓储层单测必须完整</li>
<li><strong>自动化测试</strong>：利用大模型进行页面功能单测，确保页面完整性和整洁性</li>
<li><strong>可视化验证</strong>：通过RAD工具进行原型和菜单的可视化验证</li>
<li><strong>集成测试</strong>：确保所有模块间的集成正常，特别是层间整合后的功能验证</li>
<li><strong>性能测试</strong>：关键接口的响应时间不超过2秒，聚合层优化后必须进行性能对比测试</li>
<li><strong>安全测试</strong>：确保代码符合安全编码规范</li>
<li><strong>文档完整性</strong>：所有模块必须提供完整的文档，包括需求文档、设计稿、测试报告等</li>
<li><strong>需求一致性</strong>：确保最终实现与客户确认的需求保持一致</li>
</ol>
<h2 data-id="heading-21"><strong>五、规范执行监督</strong></h2>
<h3 data-id="heading-22"><strong>5.1 分级监督主体与核心职责</strong></h3>
<p>明确不同角色在规范执行监督中的定位，形成分层负责、协同联动的监督体系，确保监督无死角。</p>
<ul>
<li>架构师：承担整体规范执行监督总责，重点聚焦大模型生成代码的质量控制（核心原因：架构师掌握企业级架构标准，能精准判断AI生成代码是否符合整体设计要求）</li>
<li>开发人员：负责监督RAD工具自动生成代码的正确性和完整性（核心原因：开发人员直接对接编码环节，可实时校验自动化生成内容的实用性）</li>
<li>运维人员：辅助监督交付发布阶段的规范执行，确保资源清理、文档归档符合要求（补充角色，完善监督链路）</li>
</ul>
<p>注解：1. 分级逻辑：按“整体把控-环节落地-收尾校验”划分监督职责，适配企业级项目多角色协作场景；2. 监督重点：突出AI相关环节（大模型生成代码、RAD工具自动化）的监督，契合框架AI驱动的核心特性；3. 价值：明确的职责划分避免监督推诿，提升监督效率。</p>
<h3 data-id="heading-23"><strong>5.2 常态化监督机制</strong></h3>
<p>建立固定频率的监督评审机制，确保规范执行情况能被及时跟踪、问题能被快速发现。</p>
<ul>
<li>每周规范执行评审：定期召开评审会议，重点检查大模型协作流程的执行情况（频率设定原因：企业级项目迭代周期多以周为单位，周度评审可同步匹配迭代节奏）</li>
<li>实时自动化监控：通过工具监控RAD工具的自动化流程，确保生成的代码符合项目喜好和规范要求（技术辅助：借助自动化工具降低人工监督成本，实现实时预警）</li>
</ul>
<p>注解：1. 动静结合：“周度评审（静态）+实时监控（动态）”结合，兼顾周期性全面检查与实时风险预警；2. 聚焦核心：评审重点锚定大模型协作流程，与框架核心的AI实施逻辑深度匹配；3. 落地性：周度频率和自动化工具应用，平衡监督效果与团队工作负荷，避免过度监督。</p>
<h3 data-id="heading-24"><strong>5.3 动态优化与纠错机制</strong></h3>
<p>针对监督中发现的问题，建立“纠正-培训-优化”的闭环机制，推动规范持续完善。</p>
<ul>
<li>即时纠错：对违反规范的行为进行及时纠正和培训，避免问题扩散（响应原则：快速响应、即时止损，保障项目推进不受规范偏差影响）</li>
<li>规范迭代：定期更新规范文档，适应项目发展需求和大模型能力演进（迭代逻辑：规范需适配业务变化和AI技术升级，避免“一刀切”的静态规范制约项目发展）</li>
<li>质量评估优化：建立大模型生成代码的质量评估机制，持续优化大模型协作流程（专项优化：针对核心的大模型协作环节，通过评估反馈持续提升人机协同效率）</li>
</ul>
<p>注解：1. 闭环逻辑：形成“发现问题-纠正问题-优化规范”的完整闭环，确保监督不仅能“纠错”还能“赋能”；2. 适配性：规范迭代和大模型协作优化，体现对企业级项目动态发展和AI技术演进的适配；3. 价值：避免规范成为“僵化约束”，通过持续优化让规范始终贴合项目实际需求。</p>
<h2 data-id="heading-25"><strong>六、最佳实践</strong></h2>
<ol>
<li><strong>明确需求沟通</strong>：与大模型沟通时，提供清晰、详细的需求描述，避免歧义</li>
<li><strong>合理利用自动化</strong>：充分发挥RAD工具的优势，自动生成重复、标准化的代码</li>
<li><strong>重视人工审核</strong>：虽然大模型能生成高质量代码，但人工审核仍不可或缺</li>
<li><strong>持续优化流程</strong>：根据项目实际情况，持续优化8步编码流程</li>
<li><strong>加强团队协作</strong>：项目管理人员、开发人员、业务人员和客户应紧密协作</li>
<li><strong>规范文档管理</strong>：及时归档需求文档、设计稿、测试报告等重要文档</li>
</ol>
<h2 data-id="heading-26"><strong>七、总结与展望</strong></h2>
<p>Ooder框架的规范执行计划展示了AI协作驱动的软件开发流程的巨大潜力。通过充分利用大模型和自动化工具，Ooder框架实现了开发流程的标准化、自动化和智能化，提高了代码质量和开发效率。</p>
<p>未来，随着AI技术的进一步发展，Ooder框架将不断完善其8步编码流程，增强大模型的理解能力和生成质量，优化RAD工具的自动化程度，为软件开发带来更大的变革。</p>
<p>通过遵循Ooder框架的规范执行计划，开发团队可以更好地利用AI技术，构建高质量、高效率的软件系统，适应快速变化的市场需求。</p>
<hr/>
<h4 data-id="heading-27"><strong>附件</strong></h4>
<ol>
<li>[Ooder编码流程详细说明]</li>
<li>[视图元数据枚举模板]</li>
<li>[钩子API方法模板]</li>
<li>[代码评审检查清单]</li>
<li>[测试用例模板]</li>
<li>[大模型协作指南]</li>
<li>[RAD工具使用手册]</li>
<li>[原型设计规范]</li>
<li>[需求文档模板]</li>
<li>[设计稿迭代记录模板]</li>
</ol>
<p><strong>制定日期</strong>：2025-12-31</p>
<p><strong>作者</strong>：Ooder框架团队</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 C#.NET Parallel：并行编程的正确打开方式]]></title>    <link>https://juejin.cn/post/7589553045156413480</link>    <guid>https://juejin.cn/post/7589553045156413480</guid>    <pubDate>2025-12-30T23:21:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589553045156413480" data-draft-id="7589526591564693504" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 C#.NET Parallel：并行编程的正确打开方式"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-30T23:21:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 C#.NET Parallel：并行编程的正确打开方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T23:21:15.000Z" title="Tue Dec 30 2025 23:21:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>Parallel</code> 并行编程是 <code>.NET</code> 中利用多核 <code>CPU</code> 进行并发执行的编程模型，主要通过 <code>System.Threading.Tasks</code> 命名空间中的 <code>Parallel</code> 类实现。它允许将任务分解成多个子任务，在多个线程上同时执行，以加速 <code>CPU</code> 密集型操作（如循环计算、数据处理）。</p>
<h4 data-id="heading-1">核心组件：</h4>
<ul>
<li>
<p><code>Parallel</code> 类：提供静态方法如 <code>Parallel.For、Parallel.ForEach、Parallel.Invoke</code>，用于并行执行循环或方法。</p>
</li>
<li>
<p><code>PLINQ</code>（Parallel LINQ）：<code>LINQ</code> 的并行版本，通过 <code>AsParallel()</code> 扩展方法启用并行查询。</p>
</li>
<li>
<p>底层依赖：基于 Task Parallel Library (TPL)，利用线程池（<code>ThreadPool</code>）管理线程，避免手动创建线程的开销。</p>
</li>
</ul>
<h4 data-id="heading-2">关键概念：</h4>
<ul>
<li>
<p>并行度（<code>Degree of Parallelism</code>）：控制并发线程数，默认基于 CPU 核心（e.g., 4 核 CPU 可能 4 线程）。</p>
</li>
<li>
<p>数据并行：将数据分成块（<code>chunks</code>），每个线程处理一块（e.g., <code>Parallel.For</code>）。</p>
</li>
<li>
<p>任务并行：同时执行独立方法（e.g., <code>Parallel.Invoke</code>）。</p>
</li>
</ul>
<h3 data-id="heading-3">Parallel 的核心定位与价值</h3>
<p><code>Parallel</code> 类位于 <code>System.Threading.Tasks</code> 命名空间，是 <code>.NET</code> 提供的 “高层级并行工具”，核心价值：</p>
<ul>
<li>
<p>自动线程调度：无需手动创建 / 管理线程，由 <code>TPL</code> 自动分配线程池线程，实现负载均衡；</p>
</li>
<li>
<p>简化并行逻辑：用类似串行循环的语法实现并行执行，降低并行编程门槛；</p>
</li>
<li>
<p>适配多核 <code>CPU</code>：默认根据 <code>CPU</code> 核心数调整并行度，最大化利用硬件资源；</p>
</li>
<li>
<p>支持取消 / 超时：可通过 <code>ParallelOptions</code> 控制并行过程，如取消执行、限制并行数。</p>
</li>
</ul>
<blockquote>
<p>Parallel仅适合 CPU 密集型任务（如数据计算、图像处理、复杂逻辑运算）；I/O 密集型任务（文件读写、网络请求）应使用async/await，否则线程会阻塞，浪费资源。</p>
</blockquote>
<h3 data-id="heading-4">核心概念与基础</h3>
<h4 data-id="heading-5">并行 vs. 并发 vs. 异步:</h4>
<ul>
<li>
<p>并发: 多个任务在重叠的时间段内执行（不一定同时）。单核上通过时间片切换实现。</p>
</li>
<li>
<p>并行: 多个任务真正同时执行，需要多核或多处理器支持。是并发的一种特例。</p>
</li>
<li>
<p>异步: 一种编程模式，允许启动一个操作后不阻塞当前线程，待操作完成后再处理结果。异步操作可以利用并发或并行（通常通过线程池），但其核心目标是非阻塞和响应性。</p>
</li>
</ul>
<h4 data-id="heading-6">线程 vs. 任务:</h4>
<ul>
<li>
<p>线程: 操作系统调度的基本单位。直接操作 <code>Thread</code> 类相对底层，需要手动管理生命周期、同步等，易出错且开销较大。</p>
</li>
<li>
<p>任务: <code>TPL</code> 引入的核心概念 <code>Task</code> 和 <code>Task&lt;TResult&gt;</code>。代表一个异步操作单元。任务通常由线程池线程执行，但提供了更高级别的抽象：</p>
<ul>
<li>
<p>任务调度: 由 <code>TaskScheduler</code> 管理，默认使用线程池。</p>
</li>
<li>
<p>组合与延续: 使用 <code>ContinueWith, WhenAll, WhenAny</code> 等轻松组合任务。</p>
</li>
<li>
<p>异常传播: 异常被封装在 <code>AggregateException</code> 中，便于统一处理。</p>
</li>
<li>
<p>取消支持: 与 <code>CancellationTokenSource/CancellationToken</code> 集成。</p>
</li>
<li>
<p>状态跟踪: 有 <code>Created, Running, RanToCompletion, Canceled, Faulted</code> 等状态。</p>
</li>
</ul>
</li>
<li>
<p>线程池:</p>
<ul>
<li>
<p><code>.NET</code> 维护一个全局的工作线程池。</p>
</li>
<li>
<p><code>TPL</code> 默认使用线程池来执行任务。</p>
</li>
<li>
<p>优点：避免频繁创建销毁线程的开销，自动管理线程数量（根据负载增减）。</p>
</li>
<li>
<p>使用 <code>ThreadPool.QueueUserWorkItem</code> 或 <code>Task.Run/Task.Factory.StartNew</code> 提交工作项。</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">Parallel 核心 API 一览</h3>

























<table><thead><tr><th>API</th><th>用途</th></tr></thead><tbody><tr><td>Parallel.For</td><td>并行 for 循环</td></tr><tr><td>Parallel.ForEach</td><td>并行 foreach</td></tr><tr><td>Parallel.Invoke</td><td>并行执行多个 Action</td></tr><tr><td>ParallelOptions</td><td>控制并行度、取消等</td></tr></tbody></table>
<h4 data-id="heading-8">Parallel.Invoke：并行执行多个独立任务</h4>
<p>用于一次性并行执行多个无关联的方法（任务），适合 “多任务并行执行，等待全部完成” 的场景。</p>
<p>语法：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Invoke</span>(<span class="hljs-params"><span class="hljs-keyword">params</span> Action[] actions</span>)</span>;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Invoke</span>(<span class="hljs-params">ParallelOptions options, <span class="hljs-keyword">params</span> Action[] actions</span>)</span>;
</code></pre>
<p>示例：并行执行三个独立的 <code>CPU</code> 密集型方法</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading.Tasks;

<span class="hljs-keyword">class</span> <span class="hljs-title">ParallelInvokeDemo</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        <span class="hljs-comment">// 记录开始时间</span>
        <span class="hljs-keyword">var</span> watch = System.Diagnostics.Stopwatch.StartNew();

        <span class="hljs-comment">// 并行执行三个方法</span>
        Parallel.Invoke(
            () =&gt; CalculateSum(<span class="hljs-number">1</span>, <span class="hljs-number">100000000</span>), <span class="hljs-comment">// 任务1：计算1~1亿的和</span>
            () =&gt; CalculatePrimeCount(<span class="hljs-number">1</span>, <span class="hljs-number">100000</span>), <span class="hljs-comment">// 任务2：统计1~10万的质数数量</span>
            () =&gt; GenerateRandomData(<span class="hljs-number">1000000</span>) <span class="hljs-comment">// 任务3：生成100万条随机数据</span>
        );

        watch.Stop();
        Console.WriteLine(<span class="hljs-string">$"并行执行耗时：<span class="hljs-subst">{watch.ElapsedMilliseconds}</span>ms"</span>);

        <span class="hljs-comment">// 对比：串行执行（耗时远高于并行）</span>
        watch.Restart();
        CalculateSum(<span class="hljs-number">1</span>, <span class="hljs-number">100000000</span>);
        CalculatePrimeCount(<span class="hljs-number">1</span>, <span class="hljs-number">100000</span>);
        GenerateRandomData(<span class="hljs-number">1000000</span>);
        watch.Stop();
        Console.WriteLine(<span class="hljs-string">$"串行执行耗时：<span class="hljs-subst">{watch.ElapsedMilliseconds}</span>ms"</span>);
    }

    <span class="hljs-comment">// 模拟CPU密集型任务1：计算累加和</span>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CalculateSum</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> start, <span class="hljs-built_in">int</span> end</span>)</span>
    {
        <span class="hljs-built_in">long</span> sum = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">long</span> i = start; i &lt;= end; i++) sum += i;
        Console.WriteLine(<span class="hljs-string">$"累加和：<span class="hljs-subst">{sum}</span>"</span>);
    }

    <span class="hljs-comment">// 模拟CPU密集型任务2：统计质数数量</span>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CalculatePrimeCount</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> start, <span class="hljs-built_in">int</span> end</span>)</span>
    {
        <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = start; i &lt;= end; i++)
        {
            <span class="hljs-keyword">if</span> (IsPrime(i)) count++;
        }
        Console.WriteLine(<span class="hljs-string">$"质数数量：<span class="hljs-subst">{count}</span>"</span>);
    }

    <span class="hljs-comment">// 模拟CPU密集型任务3：生成随机数据</span>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GenerateRandomData</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> count</span>)</span>
    {
        <span class="hljs-keyword">var</span> random = <span class="hljs-keyword">new</span> Random();
        <span class="hljs-built_in">double</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">double</span>[count];
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) data[i] = random.NextDouble();
        Console.WriteLine(<span class="hljs-string">$"随机数据生成完成，长度：<span class="hljs-subst">{data.Length}</span>"</span>);
    }

    <span class="hljs-comment">// 辅助方法：判断是否为质数</span>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPrime</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> num</span>)</span>
    {
        <span class="hljs-keyword">if</span> (num &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">2</span>; i &lt;= Math.Sqrt(num); i++)
        {
            <span class="hljs-keyword">if</span> (num % i == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p><code>Parallel.Invoke</code> 会等待所有传入的 <code>Action</code> 执行完成后才返回；</p>
</li>
<li>
<p>方法执行顺序不保证（由 <code>TPL</code> 调度），但最终会全部执行；</p>
</li>
<li>
<p>若其中一个方法抛出异常，其他方法仍会继续执行，最终所有异常会被包装为<code>AggregateException</code> 抛出。</p>
</li>
</ul>
<h4 data-id="heading-9">Parallel.For：并行执行 for 循环</h4>
<p>替代传统的 <code>for</code> 循环，将循环迭代分配到多个线程并行执行，适合 “固定次数的循环，迭代间无依赖” 的场景。</p>
<p>核心语法：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 基础版：从fromInclusive到toExclusive（不包含）的并行循环</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ParallelLoopResult <span class="hljs-title">For</span>(<span class="hljs-params">
    <span class="hljs-built_in">int</span> fromInclusive, 
    <span class="hljs-built_in">int</span> toExclusive, 
    Action&lt;<span class="hljs-built_in">int</span>&gt; body
</span>)</span>;

<span class="hljs-comment">// 带配置版：支持取消、限制并行度</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ParallelLoopResult <span class="hljs-title">For</span>(<span class="hljs-params">
    <span class="hljs-built_in">int</span> fromInclusive, 
    <span class="hljs-built_in">int</span> toExclusive, 
    ParallelOptions options, 
    Action&lt;<span class="hljs-built_in">int</span>&gt; body
</span>)</span>;
</code></pre>
<p>示例：并行累加数组元素（线程安全版）</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading;
<span class="hljs-keyword">using</span> System.Threading.Tasks;

<span class="hljs-keyword">class</span> <span class="hljs-title">ParallelForDemo</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        <span class="hljs-comment">// 初始化1000万个元素的数组</span>
        <span class="hljs-built_in">int</span>[] numbers = <span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>[<span class="hljs-number">10</span>_000_000];
        Random random = <span class="hljs-keyword">new</span> Random();
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; numbers.Length; i++) numbers[i] = random.Next(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>);

        <span class="hljs-built_in">long</span> total = <span class="hljs-number">0</span>; <span class="hljs-comment">// 共享累加变量（需保证线程安全）</span>
        <span class="hljs-keyword">var</span> watch = System.Diagnostics.Stopwatch.StartNew();

        <span class="hljs-comment">// 并行循环累加</span>
        ParallelLoopResult result = Parallel.For(
            <span class="hljs-number">0</span>, <span class="hljs-comment">// 起始索引（包含）</span>
            numbers.Length, <span class="hljs-comment">// 结束索引（不包含）</span>
            <span class="hljs-comment">// 循环体：i为当前迭代索引</span>
            (i) =&gt; Interlocked.Add(<span class="hljs-keyword">ref</span> total, numbers[i]) <span class="hljs-comment">// 用Interlocked保证原子累加</span>
        );

        watch.Stop();
        Console.WriteLine(<span class="hljs-string">$"并行累加结果：<span class="hljs-subst">{total}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"耗时：<span class="hljs-subst">{watch.ElapsedMilliseconds}</span>ms"</span>);
        Console.WriteLine(<span class="hljs-string">$"循环是否完成：<span class="hljs-subst">{result.IsCompleted}</span>"</span>);
    }
}
</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p><code>Parallel.For</code> 的迭代索引 <code>i</code> 是线程局部的，无需担心冲突，但共享变量（如 <code>total</code> ）必须保证线程安全（用 <code>Interlocked、lock或ConcurrentBag</code> 等）；</p>
</li>
<li>
<p>返回值 <code>ParallelLoopResult</code> 包含循环执行状态（<code>IsCompleted</code>：是否全部完成；<code>LowestBreakIteration</code>：是否提前中断）；</p>
</li>
<li>
<p>迭代间不能有依赖（如第 <code>i</code> 次迭代依赖第 <code>i-1</code> 次的结果），否则会导致结果错误。</p>
</li>
</ul>
<h4 data-id="heading-10">Parallel.ForEach：并行执行 foreach 循环</h4>
<p>替代传统的 <code>foreach</code> 循环，遍历 <code>IEnumerable&lt;T&gt;</code> 集合，将元素分配到多个线程并行处理。</p>
<p>核心语法：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 基础版：遍历IEnumerable&lt;T&gt;集合</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ParallelLoopResult <span class="hljs-title">ForEach</span>&lt;<span class="hljs-title">TSource</span>&gt;(<span class="hljs-params">
    IEnumerable&lt;TSource&gt; source, 
    Action&lt;TSource&gt; body
</span>)</span>;

<span class="hljs-comment">// 带索引版：获取元素的索引</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ParallelLoopResult <span class="hljs-title">ForEach</span>&lt;<span class="hljs-title">TSource</span>&gt;(<span class="hljs-params">
    IEnumerable&lt;TSource&gt; source, 
    Action&lt;TSource, ParallelLoopState, <span class="hljs-built_in">long</span>&gt; body
</span>)</span>;
</code></pre>
<p>示例：并行处理文件列表（ <code>CPU</code> 密集型的文件内容解析）</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Threading.Tasks;

<span class="hljs-keyword">class</span> <span class="hljs-title">ParallelForEachDemo</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        <span class="hljs-comment">// 获取指定目录下的所有文本文件</span>
        <span class="hljs-built_in">string</span>[] files = Directory.GetFiles(<span class="hljs-string">@"D:\test"</span>, <span class="hljs-string">"*.txt"</span>);
        <span class="hljs-comment">// 存储解析结果（线程安全集合）</span>
        <span class="hljs-keyword">var</span> parseResults = <span class="hljs-keyword">new</span> System.Collections.Concurrent.ConcurrentDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">int</span>&gt;();

        <span class="hljs-keyword">var</span> watch = System.Diagnostics.Stopwatch.StartNew();

        <span class="hljs-comment">// 并行遍历文件列表</span>
        Parallel.ForEach(
            files, <span class="hljs-comment">// 要遍历的集合</span>
            (file, state, index) =&gt; <span class="hljs-comment">// 循环体：file=当前文件，state=循环状态，index=当前索引</span>
            {
                <span class="hljs-keyword">try</span>
                {
                    <span class="hljs-comment">// 解析文件：统计文件中的数字数量（CPU密集型）</span>
                    <span class="hljs-built_in">int</span> numberCount = CountNumbersInFile(file);
                    <span class="hljs-comment">// 将结果存入线程安全字典</span>
                    parseResults.TryAdd(file, numberCount);
                    Console.WriteLine(<span class="hljs-string">$"已处理第<span class="hljs-subst">{index+<span class="hljs-number">1</span>}</span>个文件：<span class="hljs-subst">{file}</span>，数字数量：<span class="hljs-subst">{numberCount}</span>"</span>);
                }
                <span class="hljs-keyword">catch</span> (Exception ex)
                {
                    Console.WriteLine(<span class="hljs-string">$"处理文件<span class="hljs-subst">{file}</span>失败：<span class="hljs-subst">{ex.Message}</span>"</span>);
                    <span class="hljs-comment">// 可选：终止所有迭代</span>
                    <span class="hljs-comment">// state.Stop();</span>
                }
            }
        );

        watch.Stop();
        Console.WriteLine(<span class="hljs-string">$"\n全部处理完成，共<span class="hljs-subst">{parseResults.Count}</span>个文件，耗时：<span class="hljs-subst">{watch.ElapsedMilliseconds}</span>ms"</span>);
    }

    <span class="hljs-comment">// 模拟CPU密集型任务：统计文件中的数字数量</span>
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">CountNumbersInFile</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> filePath</span>)</span>
    {
        <span class="hljs-built_in">string</span> content = File.ReadAllText(filePath);
        <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">char</span> c <span class="hljs-keyword">in</span> content)
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">char</span>.IsDigit(c)) count++;
        }
        <span class="hljs-comment">// 模拟复杂计算（放大CPU消耗）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) { Math.Sqrt(i); }
        <span class="hljs-keyword">return</span> count;
    }
}
</code></pre>
<p>关键说明：</p>
<ul>
<li>
<p><code>ParallelLoopState</code>：用于控制循环（ <code>Stop()</code> 终止所有迭代、<code>Break()</code> 终止后续迭代、<code>IsStopped</code> 判断是否终止）；</p>
</li>
<li>
<p>推荐使用线程安全集合（如 <code>ConcurrentDictionary、ConcurrentBag</code> ）存储并行处理的结果，避免共享集合的线程安全问题；</p>
</li>
<li>
<p>若集合元素数量少、循环体执行时间极短，并行开销可能超过收益，此时应使用串行循环。</p>
</li>
</ul>
<h4 data-id="heading-11">ParallelOptions：配置并行行为</h4>
<p><code>ParallelOptions</code> 用于自定义并行执行的规则，核心属性：</p>

















<table><thead><tr><th><code>MaxDegreeOfParallelism</code></th><th>限制最大并行度（线程数），默认值为<code>-1</code>（自动适配 CPU 核心数），可设置为具体数值（如<code>4</code>表示最多 4 个线程并行）</th></tr></thead><tbody><tr><td><code>CancellationToken</code></td><td>取消令牌，用于取消并行执行</td></tr><tr><td><code>TaskScheduler</code></td><td>指定任务调度器（默认使用线程池调度器）</td></tr></tbody></table>
<p>示例：限制并行度 + 取消并行执行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading;
<span class="hljs-keyword">using</span> System.Threading.Tasks;

<span class="hljs-keyword">class</span> <span class="hljs-title">ParallelOptionsDemo</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        CancellationTokenSource cts = <span class="hljs-keyword">new</span> CancellationTokenSource();
        <span class="hljs-comment">// 5秒后取消执行</span>
        cts.CancelAfter(<span class="hljs-number">5000</span>);

        ParallelOptions options = <span class="hljs-keyword">new</span> ParallelOptions
        {
            MaxDegreeOfParallelism = <span class="hljs-number">4</span>, <span class="hljs-comment">// 最多4个线程并行</span>
            CancellationToken = cts.Token <span class="hljs-comment">// 绑定取消令牌</span>
        };

        <span class="hljs-keyword">try</span>
        {
            Parallel.For(
                <span class="hljs-number">0</span>,
                <span class="hljs-number">1000000</span>,
                options,
                (i) =&gt;
                {
                    <span class="hljs-comment">// 模拟耗时操作</span>
                    Thread.Sleep(<span class="hljs-number">10</span>);
                    <span class="hljs-keyword">if</span> (i % <span class="hljs-number">100000</span> == <span class="hljs-number">0</span>) Console.WriteLine(<span class="hljs-string">$"已处理<span class="hljs-subst">{i}</span>次"</span>);
                    <span class="hljs-comment">// 检查取消令牌（可选，TPL会自动检查，但手动检查更及时）</span>
                    options.CancellationToken.ThrowIfCancellationRequested();
                }
            );
        }
        <span class="hljs-keyword">catch</span> (OperationCanceledException)
        {
            Console.WriteLine(<span class="hljs-string">"并行执行被取消"</span>);
        }
        <span class="hljs-keyword">catch</span> (AggregateException ex)
        {
            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> innerEx <span class="hljs-keyword">in</span> ex.InnerExceptions)
            {
                Console.WriteLine(<span class="hljs-string">$"异常：<span class="hljs-subst">{innerEx.Message}</span>"</span>);
            }
        }
        <span class="hljs-keyword">finally</span>
        {
            cts.Dispose();
        }
    }
}
</code></pre>
<p>并发度说明：</p>
<ul>
<li>
<p>默认：≈ CPU 核心数</p>
</li>
<li>
<p>并不是越大越好</p>
</li>
<li>
<p>过大 → 线程切换成本上升</p>
</li>
</ul>
<blockquote>
<p>CPU 密集型 ≈ 核心数
轻计算 ≈ 核心数 × 1.5</p>
</blockquote>
<h4 data-id="heading-12">PLINQ（Parallel LINQ）</h4>
<p>并行查询：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> num <span class="hljs-keyword">in</span> data.AsParallel()  <span class="hljs-comment">// 启用并行</span>
            <span class="hljs-keyword">where</span> num % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>
            <span class="hljs-keyword">select</span> num * <span class="hljs-number">2</span>;

<span class="hljs-keyword">var</span> results = query.ToArray();  <span class="hljs-comment">// 强制执行</span>
</code></pre>
<ul>
<li>
<p>选项：<code>WithDegreeOfParallelism(4)</code> 控制并行度；<code>WithExecutionMode(ParallelExecutionMode.ForceParallelism)</code> 强制并行。</p>
</li>
<li>
<p>有序 vs. 无序：默认无序；用 <code>AsOrdered()</code> 保持顺序（性能稍低）。</p>
</li>
</ul>
<h3 data-id="heading-13">底层原理：Parallel 的执行机制</h3>
<p><code>Parallel</code> 的高效性源于 <code>TPL</code> 的核心设计：</p>
<ul>
<li>
<p>分区策略：将循环拆分为多个 “分区”（<code>Partitioner</code>），每个分区由一个线程处理，避免单个线程处理过多迭代；</p>
</li>
<li>
<p>工作窃取算法（<code>Work-Stealing</code>）：若某个线程完成自身分区后，会从其他线程的分区中 “窃取” 未处理的迭代，实现负载均衡；</p>
</li>
<li>
<p>线程池复用：使用线程池的工作线程，避免频繁创建 / 销毁线程的开销；</p>
</li>
<li>
<p><code>PLINQ</code> 内部：用 <code>ParallelQuery&lt;T&gt;</code> 包装，查询树上附加并行运算符；合并结果时用 <code>Barrier</code> 同步。</p>
</li>
<li>
<p>性能开销：启动线程 ~1ms；适合 &gt;100ms 任务；小任务可能负优化（开销 &gt; 收益）。</p>
</li>
<li>
<p>异常聚合：所有迭代抛出的异常会被包装为 <code>AggregateException</code>，需遍历<code>InnerExceptions</code> 处理。</p>
</li>
</ul>
<h3 data-id="heading-14">Parallel 与线程安全</h3>
<h4 data-id="heading-15">错误示例：共享变量</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> sum = <span class="hljs-number">0</span>;

Parallel.For(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>, i =&gt;
{
    sum += i; <span class="hljs-comment">// ❌ 线程不安全</span>
});
</code></pre>
<p>结果：不确定</p>
<h4 data-id="heading-16">正确方式一：Interlocked</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> sum = <span class="hljs-number">0</span>;

Parallel.For(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>, i =&gt;
{
    Interlocked.Add(<span class="hljs-keyword">ref</span> sum, i);
});
</code></pre>
<h4 data-id="heading-17">正确方式二：局部变量 + 聚合（推荐）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> sum = <span class="hljs-number">0</span>;

Parallel.For(<span class="hljs-number">0</span>, <span class="hljs-number">1000</span>,
    () =&gt; <span class="hljs-number">0</span>,
    (i, state, local) =&gt; local + i,
    local =&gt; Interlocked.Add(<span class="hljs-keyword">ref</span> sum, local)
);
</code></pre>
<p>高性能、低竞争</p>
<h3 data-id="heading-18">替代方案：</h3>
<ul>
<li>
<p>小任务：用 <code>Task.Run</code> 或 <code>Parallel LINQ</code>。</p>
</li>
<li>
<p>数据并行：<code>System.Numerics (SIMD)</code> 或 <code>GPU (CUDA.NET)</code>。</p>
</li>
<li>
<p>高并发：<code>Actor</code> 模型 (<code>Akka.NET</code>) 或 <code>Channels</code>。</p>
</li>
</ul>
<h3 data-id="heading-19">Parallel.ForEachAsync</h3>
<p>在受控并发度下，并行执行异步操作</p>
<p>它本质是：</p>
<ul>
<li>
<p><code>async / await</code> 友好</p>
</li>
<li>
<p>支持并发限制</p>
</li>
<li>
<p>内置 <code>CancellationToken</code></p>
</li>
<li>
<p>自动调度，不用手写 <code>SemaphoreSlim</code></p>
</li>
</ul>
<h4 data-id="heading-20">基本用法</h4>
<h5 data-id="heading-21">最简单示例</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> Parallel.ForEachAsync(items, <span class="hljs-keyword">async</span> (item, ct) =&gt;
{
    <span class="hljs-keyword">await</span> ProcessAsync(item, ct);
});
</code></pre>
<ul>
<li>
<p>必须 <code>await</code></p>
</li>
<li>
<p><code>lambda</code> 参数里有 <code>CancellationToken</code></p>
</li>
<li>
<p>返回 <code>ValueTask</code></p>
</li>
</ul>
<h5 data-id="heading-22">限制并发度</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> options = <span class="hljs-keyword">new</span> ParallelOptions
{
    MaxDegreeOfParallelism = <span class="hljs-number">5</span>
};

<span class="hljs-keyword">await</span> Parallel.ForEachAsync(items, options, <span class="hljs-keyword">async</span> (item, ct) =&gt;
{
    <span class="hljs-keyword">await</span> CallApiAsync(item, ct);
});
</code></pre>
<p>这相当于：</p>
<pre><code class="hljs language-csharp" lang="csharp">SemaphoreSlim(<span class="hljs-number">5</span>) + Task.WhenAll
</code></pre>
<p>但 更简洁、更安全</p>
<h3 data-id="heading-23">Parallel.ForEachAsync vs Task.WhenAll</h3>
<h4 data-id="heading-24">Task.WhenAll（无并发控制）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> Task.WhenAll(items.Select(item =&gt;
    ProcessAsync(item)
));
</code></pre>
<p>特点：</p>
<ul>
<li>
<p>一次性创建所有 <code>Task</code></p>
</li>
<li>
<p>不限制并发</p>
</li>
<li>
<p>数量大 → 容易压垮资源</p>
</li>
</ul>
<h4 data-id="heading-25">Parallel.ForEachAsync（有并发控制）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> Parallel.ForEachAsync(items,
    <span class="hljs-keyword">new</span> ParallelOptions { MaxDegreeOfParallelism = <span class="hljs-number">5</span> },
    <span class="hljs-keyword">async</span> (item, ct) =&gt;
    {
        <span class="hljs-keyword">await</span> ProcessAsync(item, ct);
    });
</code></pre>
<p>特点：</p>
<ul>
<li>
<p>滑动窗口式并发</p>
</li>
<li>
<p>同时最多 <code>N</code> 个任务</p>
</li>
<li>
<p>更适合：</p>
<ul>
<li>
<p>HTTP</p>
</li>
<li>
<p>DB</p>
</li>
<li>
<p>文件 IO</p>
</li>
<li>
<p>调用第三方接口</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-26">什么时候选哪个？</h4>

























<table><thead><tr><th>场景</th><th>推荐</th></tr></thead><tbody><tr><td>少量任务（&lt;20）</td><td>Task.WhenAll</td></tr><tr><td>大量任务</td><td>Parallel.ForEachAsync</td></tr><tr><td>需要限流</td><td>Parallel.ForEachAsync</td></tr><tr><td>CPU 密集</td><td>Parallel.For / PLINQ</td></tr></tbody></table>
<h3 data-id="heading-27">典型实战场景</h3>
<h4 data-id="heading-28">批量调用第三方 API</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> Parallel.ForEachAsync(userIds,
    <span class="hljs-keyword">new</span> ParallelOptions { MaxDegreeOfParallelism = <span class="hljs-number">10</span> },
    <span class="hljs-keyword">async</span> (id, ct) =&gt;
    {
        <span class="hljs-keyword">await</span> apiClient.SyncUserAsync(id, ct);
    });
</code></pre>
<h4 data-id="heading-29">批量文件处理（IO）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> Parallel.ForEachAsync(files,
    <span class="hljs-keyword">async</span> (file, ct) =&gt;
    {
        <span class="hljs-keyword">var</span> content = <span class="hljs-keyword">await</span> File.ReadAllTextAsync(file, ct);
        <span class="hljs-keyword">await</span> SaveAsync(content, ct);
    });
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的年终总结 - 艰难的 2025]]></title>    <link>https://juejin.cn/post/7589494074982645811</link>    <guid>https://juejin.cn/post/7589494074982645811</guid>    <pubDate>2025-12-30T16:51:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494074982645811" data-draft-id="7559150650677673993" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的年终总结 - 艰难的 2025"/> <meta itemprop="keywords" content="年终总结,前端,面试"/> <meta itemprop="datePublished" content="2025-12-30T16:51:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="threerocks"/> <meta itemprop="url" content="https://juejin.cn/user/4265760845472078"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的年终总结 - 艰难的 2025
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4265760845472078/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    threerocks
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T16:51:14.000Z" title="Tue Dec 30 2025 16:51:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>距离上次写文章已经过去了 610+ 天，一年半多的时间，从一个更新频率还算高且酷爱写作的人，这个长时间的断更期间都做了什么，此时此刻，特别想写下来，坐在这里，斟酌许久，又不知该从何下笔，来表达这<del>京城之美</del>，咳咳，这番感受...</p>
<h2 data-id="heading-0">工作历程</h2>
<p>作为一个 90 小伙儿，又读了研究生，2016 年毕业后享受了约 5 年的互联网的行业和在线教育的尾声红利，可惜那时候只是个小小的走卒，酱油打的别提多利索了，几乎没有 6 点之后下过班，养鱼养得飞起，没错，这时候靠养水草都月入2k+。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92826f6511a34cb39e156454b00159c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767718273&amp;x-signature=%2Bk9LQyPt6ZvHMl9%2BrPNOS2B5AnE%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=2762806330020766664&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/>
时间很快来到了 2021 年 7 月，“双减”来临，同年 8 月主动离职，离开了深耕了 5 年的在线教育行业，同年 9 月原公司裁员，完美错过了第一次的…高额的…赔偿款。同一年，抖音、快手等直播平台兴起，自媒体大红大紫，作为一个在水草领域小有名气的人，坐拥精品贴无数，拒绝了几个好友的开号邀请，错过了自媒体的黄金机会...回过头来看这一年，就是『错过』。<br/>
离开在线教育行业后，也正式换了岗位，由之前的带着 nodejs 开发的职称干着伪全栈，转身第一次作为一个全职的前端开发进入职场，终于不用再为其他人解释工作岗位是干什么内容的了...，薪水也来到了一个可观的年薪 70 个，很快的很快，一年多的时间，薪水又涨了10% 来到了 42k，同时涨薪的补充协议有一行很小的字，绩效改为 0-4个月，1 个多月之后的年底，裁员，绩效不给，干满了一整年，绩效 1 分钱不给，第一次体会了这个行业的...好在 n+1 和 16 薪还是给到了，毕竟这是在合同上写着的金额...大家一番折腾之后，加上当时的居家政策，远程办公，很快就被逐一击破，最后整个部门只剩了零星的 2、3 个人走到了仲裁，大部分人都认了...<br/>
这里不得不再次提一下这几年，疫情影响，经济下滑，互联网行业红利逐渐褪去，在这几年内能够成功转行纯前端并且把薪水提升到了一个可观程度，我自己还是很满意的，因此，内心深处也比较感激经历了人生唯一一次裁员的那个公司，在那里，经常遇到问题学习到凌晨2、3点，也结交了很多现在还在联系的朋友，真的很幸运也很知足，像极了刚毕业那时候的感觉，是我前端技能提升最快的一个阶段，没有之一。现在回头看，我发现，这一年多的时光，真的是宇宙给我的绝佳馈赠。那时的我，只要跟我的代码在一起，就觉得自己可以上天入地，玩的不亦乐乎，真当是“代码在我手，天地任我游”！<br/>
裁员后 1 周内就确认了下家，但因为马上就是新年，过完年，时间很快来到了 2023 年 02 月份，入职了现在这家公司，emm... base 涨了 10%，年终奖 2-3 个月，总包反而下降 10%，职级提升一级，高级 -&gt; 资深，酱紫。2023、2024 年过的还算好，工作压力不大，绩效也一直很高，中间薪水象征性的涨了 1 次，3%<br/>
时间来到了 2025 年，这一年有涨薪，涨的算多的，10%；职级再次提升一级来到了高级架构师。年初，由开发人员开始转型带团队，目前是一个带着 5正式 1外包 1实习的状态，代码还写，但比之前少了很多。在晋升请客的酒桌上，大家调侃我在互联网行业这般疲态、国家经济这般不好的情况下逆流而上。但我却是深深的知道，没有任何一种回报是轻而易举的，也没有任何江山是稳固的。今年 2025 年，年龄也来到了 35 岁，一个互联网行业谈之色变的年纪，可...我的年假依然还是 5 天，因为距离 2016 年毕业还没工作满 10 年，看似一段很长的时间和经历，又岂是几句话可以表述清楚，也不知道再能在这个行业干几年，年龄的问题就这样吧，走到不再是互联网人的那一天为止...</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8bf4aea10f74c17a7d54700c268af23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767718273&amp;x-signature=715OCGEIol5dHb6rUrOEYdOsTpE%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=1234620595321688549&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/>
同样是 2025 年，公司因为一些原因自下半年开始裁员，很多熟悉的小伙伴都走了，第一次有了陌生感。行业起起浮浮，有峰值也有低谷，任何一个行业都不会长期处于高峰，高光时间都很短暂，因为赚钱的方向太少了，一个方向漏出头来，千千万万的人就跟上，国家也会平衡，强如华为被制裁那几年，国内芯片行业恨不得一年内涨三次薪水，跳槽就翻倍，但这才几年呢，芯片行业也平静了。<br/>
好吧，工作上就聊这么多，希望 2026 年大家都更好...开开心心的工作，快快乐乐的生活，工作生活两不误。<br/>
对了，这一年我集齐了第 2 套公司的盲盒，终于，终于，终于圆满了，然后把多余的全给同事分了。爱收集的毛病从小到现在都改不掉啊。希望我不会再第 3 套的契机。（小小愿望：公司赶紧出其他套吧，哈哈哈）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3889627b90934f888b8ea90c7b4dbdec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767718273&amp;x-signature=T5EplCBphuWZ5zdaBD8VCxqf5DY%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=6341678104993819849&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/></p>
<h2 data-id="heading-1">生活</h2>
<ol>
<li>5 月中签了新能源指标，选中了乐道 L90。一番筛选，到最后其实就是3选1，理想i6、问界新 M7、乐道 L90，曾经进入过选项的问界 M8、蔚来 es8，最后因为价格原因 Pass。在智驾、品牌和大空间、换电的抉择中，选择了换电和大空间，大空间对我来说是刚需，至于选择换电，我觉得北京而言在没有家充桩的情况下，充电仍然是一件麻烦事，虽然现在到处都是快充，但一想到要专门去充电去等待，哪天出门一看电量还要去充个电再办事，还有桩的适配啊、充电人数啊、快充伤电池啊、后期充电限速啊，balabalaba 就烦，换电就跟就跟加油一样，同时，家门口就两座换电站，最终选了 L90</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab4b9081080b44f98e42ab48af6b4603~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767718273&amp;x-signature=WvLhZeQ67pzqG2GX2XLbShXnjOE%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>参加了 VueConf 2025 大会，见到了尤大，去了华强北、深圳湾，完美的一次出行，可惜时间太短，希望有机会再去深圳</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68a00f0984ee4d499e8935609a7c4a9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767718273&amp;x-signature=4CYiDAkWoqGMs6ocX9yu%2Fc4J%2FnA%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>运动没有落下，往年打的最多的是羽毛球，今年应该是篮球了。2016、2017 年因为和宿舍小伙伴合租，毕业后延续了 1 年多的篮球生活，2018 年开始因为搬家慢慢不再打球，有 6-7 年吧。来到这家公司后，这里的篮球氛围很浓厚，逐渐又打了起来，身体远不如以前轻盈，更加依赖装备，也没有啥新技能增加了，但...还是能打，这是最重要的。球场上的感觉，真的是无与伦比</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c1a483d2d944032aacfab80043c1c40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767718273&amp;x-signature=6MaxPPz5OFVaUj%2BUAj7lK3PEl0Y%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=5793782883383855697&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/544cc1f29393415da5723059eaf82aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767718273&amp;x-signature=UTGFzoM%2FY8fhe%2FqnGbm03o9xtCg%3D" alt="cgi-bin_mmwebwx-bin_webwxgetmsgimg_&amp;MsgID=6286000248151101590&amp;skey=@crypt_effbd34a_d3bec78215cbd9880633e8fd73c2dcb6&amp;mmweb_appid=wx_webfilehelper.jpeg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a7e3bb9da9f4f8689f50db95d867b9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdGhyZWVyb2Nrcw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767718273&amp;x-signature=xGzAMoZbJDoT7uFcvDQjjOvMcis%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">千帆过后</h2>
<p>未来想干点啥呢</p>
<ol>
<li>一直在想，AI 时代人人都是创业者，都可以自己给自己打工，还是要有能持续收入的副业，要去学习开发以外的知识，要去思考做出来的产品如何赚钱。希望在 2026 年能有一个好的契机</li>
<li>自媒体，自媒体这个方向肯定是不行了，各个类型的视频都卷的要死，但我还是想做，不为别的，就想试一下。水族这个方向肯定是不会继续了，嗯。。可能会讲讲招聘，这个时代的招聘，尤其是校招，毕竟明年上半年是校招的时间，最近这一两年接触最多的就是这个了，有很多有意思的候选人可以讲讲他们的故事，有很多在这个时代的面试心得，也有一些市场的分析。也可能会讲讲专利写作吧，毕竟我在掘金这边的专利的系列文章还是蛮受欢迎，哈哈</li>
</ol>
<p>就写这么多吧，时间有些晚了...</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大家都可以调用LLM API，AI套壳产品的护城河在哪里？]]></title>    <link>https://juejin.cn/post/7589541466700726272</link>    <guid>https://juejin.cn/post/7589541466700726272</guid>    <pubDate>2025-12-30T23:43:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589541466700726272" data-draft-id="7589526591564660736" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大家都可以调用LLM API，AI套壳产品的护城河在哪里？"/> <meta itemprop="keywords" content="人工智能,AI编程,LLM"/> <meta itemprop="datePublished" content="2025-12-30T23:43:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Baihai_IDP"/> <meta itemprop="url" content="https://juejin.cn/user/3123071228582343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大家都可以调用LLM API，AI套壳产品的护城河在哪里？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123071228582343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Baihai_IDP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T23:43:06.000Z" title="Tue Dec 30 2025 23:43:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>编者按：</strong> AI 套壳应用究竟只是“调个 API 就上线”的投机产物，还是隐藏着被忽视的创业机会与产品逻辑？</p>
<p>今天我们为大家带来的这篇文章，作者的核心观点是：“AI 套壳产品”不应被简单贬低，其能否持续生存取决于它是否嵌入用户工作流、积累专有数据、占据分发渠道，以及所处细分市场的规模是否足以抵御巨头竞争。</p>
<p>文章首先区分了“功能型”与“产品型” AI 套壳应用，指出前者易被平台整合取代，后者则可能通过深度集成与数据积累建立护城河。作者进一步探讨了模型供给与分发渠道对创业公司构成的挑战，并以编程助手、医疗、法律等市场为例，说明在巨头环伺下仍存在细分机会。最后，文章也分析了传统老牌企业在 AI 时代的竞争策略，强调控制用户流程与积累自有数据的重要性。</p>
</blockquote>
<p><strong>作者 | Nowfal Khadar</strong></p>
<p><em><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fnowfalkhadar%2F" target="_blank" title="https://www.linkedin.com/in/nowfalkhadar/" ref="nofollow noopener noreferrer">www.linkedin.com/in/nowfalkh…</a></em></p>
<p><strong>编译 | 岳扬</strong></p>
<p>“那不过是个 AI 套壳产品（AI wrapper）罢了。”</p>
<p>这种贬低之词，对于那些正用人工智能开发新产品的人来说，听起来再熟悉不过了。</p>
<p>而反驳的声音我们也同样耳熟。</p>
<p><strong>“万物皆是套壳。OpenAI 是包在 Nvidia 和 Azure 之上的壳。Netflix 是包在 AWS 之上的壳。Salesforce 则是一个估值 3200 亿美元的 Oracle 数据库套壳应用，”</strong> Perplexity 的 CEO Aravind Srinivas 说道。</p>
<p>如果你还不熟悉“AI 套壳产品”（AI Wrapper）这个词，这里有一条不错的定义[1]。</p>
<p>这是一个带有贬义的术语，<strong>指的是利用现有的 AI 模型或 API 来提供特定功能的轻量级应用或服务，其开发过程通常投入极少、复杂度很低。</strong> 典型的 AI 套壳应用包括那些让用户能“与 PDF 对话”的应用。这类 AI 套壳应用允许用户上传一份 PDF 文档（比如一篇研究论文），并通过与 AI 模型交互来快速分析文档内容、获取答案。在 ChatGPT 刚推出时，用户还不能直接上传文档或将文档整合进提示词中，也无法创建自定义 GPT（custom GPT），因此这类应用迅速走红。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72e83fc5c6154caaad26fdc83672da85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767742986&amp;x-signature=Wn8eNJ4VHgfjsZAwh%2BmTc6kg8Sg%3D" alt="image.png" loading="lazy"/></p>
<p>AI 套壳应用梗图：底层不过是对 OpenAI 的一次 API 调用。</p>
<p>在我看来，这场关于 AI 套壳产品的争论忽略了一个更重要的问题。并非所有套壳应用都一样。有些只是昙花一现，等到大平台将这部分套壳产品的功能整合进自家产品后便消失了。但有些能嵌入用户工作流、能积累专有数据并持续学习用户使用习惯、甚至能抵御现有巨头在分发渠道上的优势，这部分套壳产品就能活下来。把某项产品简单贴上“套壳应用”的标签，反而掩盖了真正该问的两件事： <strong>（1）它到底是一个功能，还是一个独立的产品；（2）它所面向的细分市场规模有多大。</strong></p>
<h2 data-id="heading-0"><strong>01 “功能”还是“产品”？</strong></h2>
<p>我们先来看前面那个例子：一个让你能与 PDF 对话的 AI 套壳应用。这类工具只解决一个非常具体的问题 —— 回答关于某份文档的疑问。它既不能创建新文档，也无法编辑现有文件。通常也不会积累任何独特的用户数据，更不会从用户行为中持续学习。因此在我看来，它更像一种功能（capability），而不是一个端到端的完整解决方案 —— 如果我可以这么说的话，它只是达成目的的一种手段。</p>
<p>正因如此，这类功能理应被集成到文档查看器、编辑器中，或被大模型提供商（如 OpenAI、Anthropic、Google）直接整合进其旗舰应用里。一旦基础模型本身（比如 OpenAI/ChatGPT、Anthropic/Claude、Google/Gemini）原生支持这项能力，这些独立的套壳工具就变得多余了。这正是典型的“功能”特征：容易被复制、无法独立完成端到端任务、缺乏护城河，也难以长期具备竞争力。</p>
<p>但有一点需要注意：即便是这类“功能”，在大平台将其整合进自家应用之前，也可能成为一门不错的生意，赚取可观收入[2]。</p>
<ul>
<li>PDF.ai 月经常性收入（MRR）达 50 万美元，PhotoAI 为 7.7 万美元，Chatbase 为 7 万美元，InteriorAI 为 5.3 万美元[3]。</li>
<li>Jenni AI 更是在短短 18 个月内，MRR 从 2,000 美元飙升至超过 33.3 万美元[4]。</li>
</ul>
<h2 data-id="heading-1"><strong>02 所处细分市场的规模大到巨头无法视而不见</strong></h2>
<p>有些套壳应用确实是真正的产品，且所处的细分市场庞大到模型开发商和科技巨头都无法忽视。此时，它就会同时面临来自上游（模型供给）和下游（分发渠道）的双重竞争压力。</p>
<h3 data-id="heading-2"><strong>2.1 模型供给</strong></h3>
<p>代码助手（编程辅助工具）既是高度依赖大模型访问权限的典型例子，也正处在与大厂分发渠道竞争的前线。例如 Cursor 这类工具，已将一个套壳应用转变为 AI 集成开发环境（IDE） —— 它能读取整个代码仓库、编辑文件、生成代码、回滚代码更改、运行编码智能体，并重新定义 AI 时代的开发者体验。这个市场值得投入关注：截至 2025 年 10 月，全球市值前五的公司全部是科技企业，而软件开发者约占其员工总数的 30%[5]。哪怕开发工具仅将生产力提升几个百分点，所释放的价值也高达数十亿美元。这使得该细分领域成为模型厂商和已拥有分发渠道的现有巨头的必争之地。</p>
<p>但是，在开放权重（open-weight）或自研的模型在质量上达到甚至超越前沿模型之前，Cursor 和其他类似的工具几乎完全依赖 Anthropic、OpenAI 和 Gemini 提供的模型。开发者社区充斥着付费用户对 API 调用限制（rate limits）的抱怨。在我自己的项目中，我在项目进行到一半时就耗尽了 Cursor 中的 Claude 额度。尽管我更喜欢 Cursor 的用户界面和交互设计，最终还是迁移到了 Claude Code（并为此多支付了十倍的费用，只为了避开调用限制）。Cursor 的用户界面或许更好，但模型访问权限最终成了决定性因素。</p>
<p>这种对模型访问权限的依赖，所带来的战略上的影响远不止调用限制。OpenAI CEO Sam Altman 认为，正确的战略应建立在模型持续改进的假设之上：</p>
<blockquote>
<p>“目前基于 AI 构建产品有两种策略。一种是假设模型不会再变好；另一种是假设模型会保持当前的速度持续进步。在我看来，世界上 95% 的人都应该押注后者，但许多初创公司却是基于前一种假设构建的。只要我们做好本职工作——因为我们肩负着使命，我们将彻底碾压你们。”</p>
</blockquote>
<p>基础模型之间的竞争已扩展到 OpenAI Applications CEO Fidji Simo 所指出的所有战略领域（知识/辅导、医疗、创意表达、购物），以及写作助手、法律助手等其他大型细分市场。</p>
<h3 data-id="heading-3"><strong>2.2 分发渠道</strong></h3>
<p>分发渠道构成了第二重威胁。即便某些领域大模型厂商暂未直接涉足，初创公司也仍面临另一个问题：<strong>能否在那些科技巨头利用其已有产品和分发渠道快速把你的“功能”添加到他们自家产品之前，先建立起自己的用户基础？</strong> 这正是经典的 Microsoft Teams 与 Slack 之争[6]。真正的挑战在于：在微软将 Copilot 嵌入 Excel/PowerPoint、谷歌把 Gemini 深度整合进 Workspace、或 Adobe 在其创意套件中全面集成 AI 之前，抢先建立起一批忠实的用户群体。一个独立的、面向电子表格或演示文稿的 AI 套壳应用，要成功不仅需要做到功能对等（feature parity），还必须克服巨头在捆绑销售/分发渠道上的优势，以及用户切换产品的成本。</p>
<p>这种来自现有巨头的分发渠道竞争，在医疗、法律等其他大型市场也同样存在。在这些领域，对新进入者的高门槛和对“记录系统”（systems of record）的控制权（译者注：在医疗领域，systems of record 就是电子健康记录系统（EHR），而 Epic Systems 是美国乃至全球最大的 EHR 供应商之一。），使得像 Epic Systems 这样的现有巨头更具优势。举例来说，一款无法将内容直接写入电子健康记录（EHR）系统的临床病历生成工具，迟早会撞上 Epic 在分发渠道上的优势壁垒。</p>
<p>这里有三点需要注意：</p>
<p>（1）<strong>首先，即使无法构建长期有效的护城河，快速抢占市场仍可能创造出退出机会。</strong> 像 Cursor 这样的工具虽然无法掌控其核心依赖项（即对大模型的访问权限），但其出色的增长速度使其成为大模型厂商眼中极具吸引力的收购目标 —— 因为这些厂商正希望借此迅速获得市场存在感（market presence）。</p>
<p>（2）<strong>其次，在某些情况下，小团队靠把产品做到极致，也能赢。</strong> 尽管 Meta 拥有远超对手的预算和分发能力，但 Midjourney 凭借其出色的产品质量，仍然成功说服 Meta 使用它的服务。</p>
<p>（3）<strong>第三，即便某些市场规模庞大，基础模型厂商也可能主动回避某些领域</strong> —— 比如医疗和法律行业的监管压力，或 AI 伴侣、成人色情内容可能带来的舆论风险，这为愿意直面极端监管审查或舆论争议的运营者创造了机会。</p>
<p>市场机会依然巨大[7]，但商业竞争（或收购）随时可能敲门。</p>
<ul>
<li>Cursor 在 18 个月内从零做到 1 亿美元的经常性收入（ARR），并持续传出被 OpenAI 收购的传闻。</li>
<li>另一款编程助手 Windsurf 获得了 Google 一份价值 24 亿美元的订单。</li>
<li>Gamma 在约一年内实现 5000 万美元收入。</li>
<li>Lovable 仅用六个月就达到 5000 万美元收入。</li>
<li>Galileo AI 被 Google 以未披露的金额收购。</li>
</ul>
<h2 data-id="heading-4"><strong>03 创业者的机遇</strong></h2>
<p><strong>并非每一个市场空白都会吸引大模型厂商或科技巨头。</strong> 现实中存在大量 long tail（译者注：借用“长尾理论”（The Long Tail）的概念：虽然单个细分需求很小，但这类需求种类极多、总和可观。）的需求 —— 其中的用户需求虽小到不足以支撑风投愿意投资的公司，却大到足以养活年收入数百万美元级别的团队。这类细分市场，正适合那些务实、克制、擅长“小而美”打法的创始人。</p>
<p>不妨看看那些占星、显化（Manifestation）或解梦类的 AI 应用。比如一款解梦场景的 AI 应用，允许用户每天早晨记录梦境，基于梦境生成 AI 视频，维护一个专属的梦境日记，并且能随着时间推移揭示梦境中存在的模式 —— 这样的产品就完整地解决了一个用户真正想要完成的深层任务。</p>
<p>诚然，用户也可以向 ChatGPT 描述梦境，甚至它还能保存历史记录，但专用的解梦应用却能通过特定字段（如反复出现的人物、地点、物品、主题等）结构化地捕捉梦境，并与睡眠追踪数据深度整合 —— 这些是通用聊天机器人很可能无法做到的。</p>
<p>这样的细分市场，小到不足以引起大模型厂商的关注，却似乎又大到足以支撑一家能够盈利的独立企业。</p>
<h2 data-id="heading-5"><strong>04 大模型厂商 vs. 现有老牌巨头</strong></h2>
<p>尽管前文所述的几类情况描述了初创企业的机遇，但当大模型厂商入场时，现有老牌巨头（incumbents）在“AI 套壳应用”的争论中也面临自己的战略抉择。在我看来，那些能成功应对大模型厂商竞争的老牌巨头，通常具备两个特征。</p>
<p><strong>第一，即使他们没有拥有底层的大模型，也会牢牢掌控最终结果。</strong></p>
<p>那些已经深度嵌入用户工作流的应用（如 Gmail/Calendar、Sheets、电子健康记录系统 EHR/EMR、Figma）不需要用户养成新的使用习惯，而且从零开始构建这类平台，远比在现有平台上增加 AI 功能要困难得多。当这些应用能直接在自有“记录系统”（system of record）中执行某些操作 —— 比如创建日历事件、提交保险理赔、生成采购订单等 —— 用户感知到的“任务完成”（“done”）就发生在巨头自己的生态之内。此时，AI 只是现有工作流程中的一个额外输入源，而不是对整个流程的替代。</p>
<p><strong>第二，成功的老牌巨头会从用户使用数据中积累自有数据。</strong></p>
<p>用户在使用产品时进行的纠正或修改操作；特殊或超出常规范围的用户使用场景；用户对 AI 输出的采纳、确认或批准行为和用户直接的评分、评论、标注或交互行为中隐含的偏好信号，都会生成训练数据，这些数据能持续优化产品，而前沿大模型无法获得这类专有数据。Cursor 虽非传统巨头，也高度依赖外部模型，但其 CEO Michael Truell 在 Stratechery 的访谈中提到，他们计划通过捕捉开发者的行为模式来构建竞争力：</p>
<blockquote>
<p>Ben: 对你来说，这是否构成了一个真正可持续的竞争优势？也就是说，你之所以能主导这个领域，不仅仅是因为一开始调用了大语言模型，而是因为你拥有了用户使用数据 —— 你现在正在基于用户使用 Cursor 的行为数据训练自己的模型。你最初的优势是拥有完整的代码上下文，这是实现这一切的前提；而现在，你已经有了自己的训练数据。</p>
</blockquote>
<blockquote>
<p>Michael: 是的，我认为这是一个巨大的优势。高上限、产品可选、再通过分发渠道拿到用户数据反哺产品 —— 这三点跟上世纪末到本世纪初的搜索赛道如出一辙。所以，我们这个市场的竞争逻辑，更像搜索，而非传统企服市场。</p>
</blockquote>
<h2 data-id="heading-6"><strong>05 拆解“AI 套壳应用”</strong></h2>
<p>无论是 AI 套壳应用的批评者的观点还是辩护者的看法，都有其道理，但也都有所忽略。批评者说得对：有些套壳应用确实没有护城河，一旦大平台将其产品功能吸收，它们便会失去市场。辩护者说得也对：每一家成功的软件公司本质上都在“套壳”某些东西。</p>
<p>但我认为，真正的洞见存在于两者之间。<strong>即使一个新的应用起步时只是“套壳”，只要它能扎根于实际工作场景、把数据写进自家记录系统、靠用户行为沉淀专有数据，和/或在巨头捆绑该功能之前抢占分发渠道，它就能持久立足。</strong> 更重要的是，那些即便在竞争来临时，仍能持续快速推出满足用户需求的功能的“套壳”应用，才是难以被击败的。这些特质，也正是区分持久产品与昙花一现的“功能”的关键所在。</p>
<p><strong>END</strong></p>
<p><strong>本期互动内容 🍻</strong></p>
<p><strong>❓你用过的 AI 工具里，哪些最初像“套壳产品”，后来却成了你工作流中不可替代的一环？为什么？</strong></p>
<p><strong>文中链接</strong></p>
<p>[1]<a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2F%40alvaro_72265%2Fthe-misunderstood-ai-wrapper-opportunity-afabb3c74f31" target="_blank" title="https://medium.com/@alvaro_72265/the-misunderstood-ai-wrapper-opportunity-afabb3c74f31" ref="nofollow noopener noreferrer">medium.com/@alvaro_722…</a></p>
<p>[2]<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.plainenglish.io%2Fwrappers-win-why-your-ai-startup-doesnt-need-to-reinvent-the-wheel-6a6d59d23a9a%3Fref%3Dwreflection.com" target="_blank" title="https://ai.plainenglish.io/wrappers-win-why-your-ai-startup-doesnt-need-to-reinvent-the-wheel-6a6d59d23a9a?ref=wreflection.com" ref="nofollow noopener noreferrer">ai.plainenglish.io/wrappers-wi…</a></p>
<p>[3]<a href="https://link.juejin.cn?target=https%3A%2F%2Faijourn.com%2Fhow-ai-wrappers-are-creating-multi-million-dollar-businesses%2F%3Fref%3Dwreflection.com" target="_blank" title="https://aijourn.com/how-ai-wrappers-are-creating-multi-million-dollar-businesses/?ref=wreflection.com" ref="nofollow noopener noreferrer">aijourn.com/how-ai-wrap…</a></p>
<p>[4]<a href="https://link.juejin.cn?target=https%3A%2F%2Fgrowthpartners.online%2Fstories%2Fhow-jenni-ai-went-from-0-to-333k-mrr%3Fref%3Dwreflection.com" target="_blank" title="https://growthpartners.online/stories/how-jenni-ai-went-from-0-to-333k-mrr?ref=wreflection.com" ref="nofollow noopener noreferrer">growthpartners.online/stories/how…</a></p>
<p>[5]<a href="https://link.juejin.cn?target=https%3A%2F%2Fnewsletter.pragmaticengineer.com%2Fp%2Fgoogle%3Fref%3Dwreflection.com" target="_blank" title="https://newsletter.pragmaticengineer.com/p/google?ref=wreflection.com" ref="nofollow noopener noreferrer">newsletter.pragmaticengineer.com/p/google?re…</a></p>
<p>[6]<a href="https://link.juejin.cn?target=https%3A%2F%2Fventurebeat.com%2Fai%2Fmicrosoft-teams-has-13-million-daily-active-users-beating-slack%3Fref%3Dwreflection.com" target="_blank" title="https://venturebeat.com/ai/microsoft-teams-has-13-million-daily-active-users-beating-slack?ref=wreflection.com" ref="nofollow noopener noreferrer">venturebeat.com/ai/microsof…</a></p>
<p>[7]<a href="https://link.juejin.cn?target=https%3A%2F%2Fa16z.com%2Frevenue-benchmarks-ai-apps%2F%3Fref%3Dwreflection.com" target="_blank" title="https://a16z.com/revenue-benchmarks-ai-apps/?ref=wreflection.com" ref="nofollow noopener noreferrer">a16z.com/revenue-ben…</a></p>
<p><strong>本文经原作者授权，由 Baihai IDP 编译。如需转载译文，请联系获取授权。</strong></p>
<p><strong>原文链接：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wreflection.com%2Fp%2Fwrapping-my-head-around-ai-wrappers" target="_blank" title="https://www.wreflection.com/p/wrapping-my-head-around-ai-wrappers" ref="nofollow noopener noreferrer">www.wreflection.com/p/wrapping-…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 年的 PHP 虽低调内敛没大改 但是更好用了]]></title>    <link>https://juejin.cn/post/7589676302106525715</link>    <guid>https://juejin.cn/post/7589676302106525715</guid>    <pubDate>2025-12-30T23:59:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589676302106525715" data-draft-id="7589539335004536875" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 2025 年的 PHP 虽低调内敛没大改 但是更好用了"/> <meta itemprop="keywords" content="后端,PHP"/> <meta itemprop="datePublished" content="2025-12-30T23:59:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             2025 年的 PHP 虽低调内敛没大改 但是更好用了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T23:59:42.000Z" title="Tue Dec 30 2025 23:59:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2025 年 PHP 的“反常识”变化</h2>
<p>2025 年的 PHP 并没有上演“脱胎换骨”。相反，它做的是更工程化、更实在的改进：把那些最容易割伤人的细节一点点打磨平整。</p>
<p>你只要真的在生产环境里跑 PHP ，就会在这些地方感受到变化：</p>
<ul>
<li>写领域规则更顺手：不必靠一堆 getter/setter 才能把约束讲清楚。</li>
<li>工具链更“较真”：对正确性更有立场，对“反正能跑”更不耐烦。</li>
<li>框架生态继续抬高基线： PHP 8.2+ 已经不是尝鲜，而是默认门槛。比如 Laravel 12 的最低版本仍是 PHP 8.2。 (Laravel)</li>
<li>PHP 8.5 于 2025 年 11 月发布，定位并不炫酷，却很像生产力放大器——前提是你愿意采用它更鼓励的写法。 (PHP)</li>
</ul>
<p>这不是功能清单，而是“工程体感总结”：哪些变化真的改变了日常写代码的方式，哪些做法减少了事故，以及哪些教训值得更早接受。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2025-12%2Fphp-in-2025-what-changed-what-stuck-next-time" target="_blank" title="https://catchadmin.com/post/2025-12/php-in-2025-what-changed-what-stuck-next-time" ref="nofollow noopener noreferrer">原文 2025 年的 PHP：没大改，却更好用了</a></p>
<h2 data-id="heading-1">趋势 #1： PHP 8.4 让“规矩、朴素”的代码更容易写</h2>
<p>PHP 8.4 虽然在 2024 年末发布，但 2025 年才在大多数团队里“落地”。原因很简单：生产升级从来不是一键完成。最关键的变化是 property hooks 与 asymmetric visibility。 (PHP)</p>
<h3 data-id="heading-2">Property hooks：把规则贴在数据旁边</h3>
<p>以前你要表达不变式，常常会写成：私有属性 + getter/setter。它并不错误，但很容易让一个简单概念变得臃肿、仪式感过强。</p>
<p>Property hooks 的价值在于：你可以在“读/写属性的那一刻”把规则讲明白，不再依赖大量样板。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$currency</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-variable">$amountCents</span>
    </span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;amountCents &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"Amount cannot be negative."</span>);
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/^[A-Z]{3}$/'</span>, <span class="hljs-variable">$this</span>-&gt;currency)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"Currency must be ISO-4217 format."</span>);
        }
    }
}
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Invoice</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> Money <span class="hljs-variable">$total</span>
    </span>) </span>{}
    <span class="hljs-keyword">public</span> Money <span class="hljs-variable">$paid</span>
    {
        <span class="hljs-title function_ invoke__">set</span> (Money <span class="hljs-variable">$value</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$value</span>-&gt;currency !== <span class="hljs-variable language_">$this</span>-&gt;total-&gt;currency) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"Currency mismatch."</span>);
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$value</span>-&gt;amountCents &gt; <span class="hljs-variable language_">$this</span>-&gt;total-&gt;amountCents) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"Overpayment is not allowed."</span>);
            }
            <span class="hljs-variable language_">$this</span>-&gt;paid = <span class="hljs-variable">$value</span>;
        }
    }
}
</code></pre>
<p>工程上的直观收益是：校验不再散落在各个 service 里，而能更自然地贴近它要保护的状态。</p>
<p>现场教训：用 property hooks 做校验很合适；但如果你拿它做数据库 lazy-loading 之类的隐式 IO ，你会得到更难追踪的行为与更痛苦的调试体验。</p>
<h3 data-id="heading-3">Asymmetric visibility：读给外部看，写留给内部做</h3>
<p>很多领域对象都想要“对外可读、对内可写”。过去你不是开 setter ，就是绕路。现在 PHP 8.4 把这种需求变得更直白。 (PHP)</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shipment</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">private</span>(<span class="hljs-params">set</span>) <span class="hljs-keyword">string</span> <span class="hljs-variable">$status</span> = <span class="hljs-string">'CREATED'</span>,
    </span>) </span>{}
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">markInTransit</span>(<span class="hljs-params"/>): <span class="hljs-title">void</span>
    </span>{
        <span class="hljs-variable language_">$this</span>-&gt;status = <span class="hljs-string">'IN_TRANSIT'</span>;
    }
}
</code></pre>
<p>它减少了那种“为了 hydration/为了测试”而暴露 setter 的冲动——而这类冲动往往会无意间扩大系统的可变性与接口面。</p>
<h2 data-id="heading-4">趋势 #2： PHP 8.5 更像一次“写起来更舒服”的升级</h2>
<p>PHP 8.5 在 2025 年 11 月 20 日发布。 (PHP)
相比轰动性的语法革新，它更像在开发体验上做加法： pipe operator ，以及更顺手的 clone-and-modify（社区常说 “clone with”）。 (stitcher.io)</p>
<h3 data-id="heading-5">Pipe operator：把数据处理写成清晰的流水线</h3>
<p>业务代码里，数据变换非常常见。过去你要么写成嵌套调用，要么堆中间变量。 Pipe 的好处是：按步骤阅读更自然。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trimAll</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-string">'trim'</span>, <span class="hljs-variable">$xs</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dropEmpty</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_values</span>(<span class="hljs-title function_ invoke__">array_filter</span>(<span class="hljs-variable">$xs</span>, fn(<span class="hljs-variable">$x</span>) =&gt; <span class="hljs-variable">$x</span> !== <span class="hljs-string">''</span>));
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unique</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$xs</span></span>): <span class="hljs-title">array</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">array_values</span>(<span class="hljs-title function_ invoke__">array_unique</span>(<span class="hljs-variable">$xs</span>));
}
<span class="hljs-variable">$tags</span> = [<span class="hljs-string">'  php '</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'backend'</span>, <span class="hljs-string">'PHP'</span>, <span class="hljs-string">'backend '</span>];
<span class="hljs-variable">$normalized</span> = <span class="hljs-variable">$tags</span>
    |&gt; <span class="hljs-title function_ invoke__">trimAll</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">dropEmpty</span>(...)
    |&gt; <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-title function_ invoke__">strtolower</span>(...), ...)
    |&gt; <span class="hljs-title function_ invoke__">unique</span>(...);
<span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$normalized</span>);
</code></pre>
<p>现场教训：每一步要“小且命名明确”。如果你一路 pipe 进匿名函数的大段逻辑，可读性会反过来下降。</p>
<h3 data-id="heading-6">URI 扩展：少写正则，多用标准解析</h3>
<p>发布公告提到专门的 URI 扩展。 (PHP)
只要你做过重定向、回调、 OAuth 、支付、 webhook ，你就知道 URL 解析的坑有多“顽固”。方向上的价值很明确：用标准组件替换零散 regex。</p>
<h3 data-id="heading-7">clone-and-modify：更安全的“复制后微调”</h3>
<p>DTO 、 command 、 event 这些“近似不可变对象”越来越常见。过去你要么 clone 后再手动改（容易漏），要么到处写 withX()。</p>
<p>PHP 8.5 明确支持在 cloning 同时修改属性。 (PHP)
这会鼓励团队更多使用“复制后小改动”的安全模式。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomerProfile</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$id</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-variable">$email</span>,
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-variable">$marketingOptIn</span>,
    </span>) </span>{}
}
<span class="hljs-variable">$old</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomerProfile</span>(<span class="hljs-string">'c-123'</span>, <span class="hljs-string">'old@mail.com'</span>, <span class="hljs-literal">false</span>);
<span class="hljs-comment">// Pseudocode-ish shape for the pattern:</span>
<span class="hljs-variable">$new</span> = <span class="hljs-keyword">clone</span> <span class="hljs-variable">$old</span>;
<span class="hljs-variable">$new</span>-&gt;email = <span class="hljs-string">'new@mail.com'</span>;
</code></pre>
<h2 data-id="heading-8">趋势 #3：框架把门槛抬高了，你的依赖也会被一起拖着走</h2>
<h3 data-id="heading-9">Laravel：靠“稳定与无聊”赢</h3>
<p>Laravel 12 延续维护导向，同时保持 PHP 8.2+ 基线。 (Laravel)
现实影响很直接：停在 PHP 8.0/8.1 的服务，会越来越难享受生态更新与安全支持。</p>
<h3 data-id="heading-10">Symfony：快节奏是压力，也是优势</h3>
<p>Symfony 的时间线显示： Symfony 8.0 在 2025 年 11 月作为稳定线，并要求 PHP 8.4+。 (Symfony)
同时官方也给出了面向 2025 年 11 月下旬发布的准备建议。 (Symfony)</p>
<p>现场教训： LTS 还是 latest ，本质是运维策略与预算问题。多服务体系里，最好明确一个默认选项，并公开例外。</p>
<h2 data-id="heading-11">趋势 #4：静态分析从“加分项”变成“底线”</h2>
<p>PHPStan 2.x 让越来越多团队把它放进合并门禁，因为它命中的 bug 往往就是事故前身。 (phpstan.org)</p>
<p>稳妥的引入方式是渐进式，而不是一夜拉满：</p>
<ul>
<li>从低等级开始，先让 CI 跑起来但不阻断。</li>
<li>修掉显而易见的问题：类型缺失、死分支、无意义 null 判断。</li>
<li>baseline 只能当过渡，必须计划消化。</li>
<li>逐模块提升门槛。</li>
</ul>
<p>示例配置与 CI：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">parameters:</span>
  <span class="hljs-attr">level:</span> <span class="hljs-number">6</span>
  <span class="hljs-attr">paths:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">src</span>
  <span class="hljs-attr">tmpDir:</span> <span class="hljs-string">var/phpstan</span>
  <span class="hljs-attr">checkMissingIterableValueType:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">reportUnmatchedIgnoredErrors:</span> <span class="hljs-literal">true</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash">composer require --dev phpstan/phpstan
vendor/bin/phpstan analyse --memory-limit=1G
</code></pre>
<h2 data-id="heading-12">趋势 #5：测试写得更轻松，但执行标准更现代</h2>
<ul>
<li>PHPUnit 11 要求 PHP 8.2+， PHPUnit 12 要求 PHP 8.3+。 (phpunit.de)</li>
<li>Pest 4 要求 PHP 8.3+（ 2025 年 8 月发布）， Pest 3 对齐 PHP 8.2+。 (pestphp.com)</li>
</ul>
<p>Pest 的优势是降低写测试的阻力，尤其适合应用层测试。例子如下：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Discount</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> <span class="hljs-variable">$priceCents</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$percent</span></span>): <span class="hljs-title">int</span>
    </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$percent</span> &lt; <span class="hljs-number">0</span> || <span class="hljs-variable">$percent</span> &gt; <span class="hljs-number">100</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">InvalidArgumentException</span>(<span class="hljs-string">"Percent must be 0..100"</span>);
        }
        <span class="hljs-variable">$cut</span> = (<span class="hljs-keyword">int</span>) <span class="hljs-title function_ invoke__">round</span>(<span class="hljs-variable">$priceCents</span> * (<span class="hljs-variable">$percent</span> / <span class="hljs-number">100</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">max</span>(<span class="hljs-number">0</span>, <span class="hljs-variable">$priceCents</span> - <span class="hljs-variable">$cut</span>);
    }
}
</code></pre>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">use</span> <span class="hljs-title">PHPUnit</span>\<span class="hljs-title">Framework</span>\<span class="hljs-title">Attributes</span>\<span class="hljs-title">Test</span>;
<span class="hljs-title function_ invoke__">it</span>(<span class="hljs-string">'applies percentage discount safely'</span>, function () {
    <span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Discount</span>();
    <span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">10000</span>, <span class="hljs-number">10</span>))-&gt;<span class="hljs-title function_ invoke__">toBe</span>(<span class="hljs-number">9000</span>);
    <span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">10000</span>, <span class="hljs-number">0</span>))-&gt;<span class="hljs-title function_ invoke__">toBe</span>(<span class="hljs-number">10000</span>);
    <span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">10000</span>, <span class="hljs-number">100</span>))-&gt;<span class="hljs-title function_ invoke__">toBe</span>(<span class="hljs-number">0</span>);
});
<span class="hljs-title function_ invoke__">it</span>(<span class="hljs-string">'rejects invalid percentages'</span>, function () {
    <span class="hljs-variable">$d</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Discount</span>();
    <span class="hljs-title function_ invoke__">expect</span>(fn() =&gt; <span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">10000</span>, -<span class="hljs-number">1</span>))-&gt;<span class="hljs-title function_ invoke__">toThrow</span>(<span class="hljs-title class_">InvalidArgumentException</span>::<span class="hljs-variable language_">class</span>);
    <span class="hljs-title function_ invoke__">expect</span>(fn() =&gt; <span class="hljs-variable">$d</span>-&gt;<span class="hljs-title function_ invoke__">apply</span>(<span class="hljs-number">10000</span>, <span class="hljs-number">101</span>))-&gt;<span class="hljs-title function_ invoke__">toThrow</span>(<span class="hljs-title class_">InvalidArgumentException</span>::<span class="hljs-variable language_">class</span>);
});
</code></pre>
<p>现场教训：优先测边界——这些地方最容易出事故：四舍五入、时间窗、幂等、空值、格式化。</p>
<h2 data-id="heading-13">趋势 #6： Composer 更安全导向，依赖成了供应链问题</h2>
<p>Composer 的演进持续强化一个观念：依赖管理是生产基础设施。 (getcomposer.org)
2025 年末的 GitHub release notes 也体现了对安全与审计行为的加强。 (GitHub)</p>
<p>实用卫生习惯包括：提交 lock 、使用 composer audit 、保持 platform 约束一致、定期依赖更新。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"php"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.3"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"platform"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"php"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8.3.0"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-14">趋势 #7：工具更 AI ，但 adoption 的关键仍是 IDE</h2>
<p>PhpStorm 2025.3 提到对 PHP 8.5 的支持与 agent 集成。 (The JetBrains Blog)
现实是： IDE 如果不支持新语法，新特性很难进入团队日常写法。</p>
<h2 data-id="heading-15">生产上最值得坚持的清单</h2>
<ul>
<li>把升级当作可管理的产品工作：定目标、做双版本 CI 、按顺序升级。</li>
<li>做清晰边界：输入 DTO → 领域对象 → 输出映射。</li>
<li>追求可调试性：减少隐式 null 、数组契约、无幂等重试。</li>
<li>把可观测性放在关键决策点：结构化日志、 correlation ID。</li>
<li>用语言特性降低偶然复杂度，而不是制造花活。</li>
</ul>
<h2 data-id="heading-16">结论</h2>
<p>2025 年的 PHP 更偏向奖励“稳定与克制”。 PHP 8.4 帮你更清楚地表达意图， PHP 8.5 让常见变换与不可变风格更顺手。 (PHP)
真正跑得更快的团队，往往不是追新，而是用这些变化把系统变得更可预测。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[当你不再热爱自己的工作和生活……]]></title>    <link>https://juejin.cn/post/7589494631006683171</link>    <guid>https://juejin.cn/post/7589494631006683171</guid>    <pubDate>2025-12-31T00:00:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494631006683171" data-draft-id="7589212818808029247" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="当你不再热爱自己的工作和生活……"/> <meta itemprop="keywords" content="程序员,前端,AI编程"/> <meta itemprop="datePublished" content="2025-12-31T00:00:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小流苏生"/> <meta itemprop="url" content="https://juejin.cn/user/1591748568036765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            当你不再热爱自己的工作和生活……
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748568036765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小流苏生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T00:00:04.000Z" title="Wed Dec 31 2025 00:00:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我已经很久没写文章了，虽然可能无人在意，但是我更担心有朋友看到这个标题后，脑海中会有这么两种声音：</p>
<ul>
<li>求求你别说了，我已经很难受了。</li>
<li>这叫什么话，我从来就没有热爱过。</li>
</ul>
<p>目前暂时在我能想到的回应中，这两种声音会让我比较惆怅，我倒是不担心有人对我嗤之以鼻，我更忧心有人比我有过之而无不及。</p>
<p>本来我已经准备好长篇大论了，打草稿写了一万多字。删减了半天，依旧不短，看来有些话，只有在陌生人面前才能不吐不快。</p>
<h2 data-id="heading-0">无聊的工作也还是很艰辛的</h2>
<h3 data-id="heading-1">Vibe Coding 的尝试和态度变化</h3>
<p>简单列一下我使用AI辅助编程的经历：</p>
<ul>
<li>我从Cursor刚出来时就有试用过，添加注释自动生成代码块，但当时觉得不够实用。</li>
<li>国外大模型很领先时，有使用过VS Code的插件，类似Bito、BlackBoxAI、Continue等。</li>
<li>后来国产大模型进步了，更多直接在网页端发问或者贴代码块、贴报错信息。</li>
<li>因为Agent的进步，套壳VS Code的AIDE占据了更多使用，Cursor、Windsurf、Kiro等。</li>
</ul>
<p>即便到这个时候，在使用AI辅助时，我最喜欢的功能依旧是：IDE侧边栏进行对话，编辑栏可以看到它每个文件都改了什么，然后手动审查、接收/拒绝变动。</p>
<p>但是在各种相关论坛中，大家对Claude Code（下称CC）这种模式极为认同，基本属于首推，我不是很理解，后来才知道：</p>
<ul>
<li>
<p>CC也能做到套壳AIDE同样的功能，只要你能熟练地使用它。</p>
</li>
<li>
<p>现在的Vibe Coding并不是我一直以为的那种自己写规范、写设计、写代码，然后让大模型工具辅助生成简单重复或者难度不大的功能代码；而是直接把需求告诉它，让它编写设计、编写规格，然后完成所有代码的编写。</p>
</li>
<li>
<p>你要做的就是看它编写的代码运行的效果是否和期望的一样，如果不一样，告诉它那里有问题，需要修复，然后继续看效果，周而复始。</p>
</li>
<li>
<p>根本不会去逐行审查AI生成的代码，后续的维护、测试、扩展？也全是交给AI去处理了，只要跑出来的结果和预期一样或者差不多就可以了。</p>
</li>
<li>
<p>是否性能最好、是否规范一致、是否拓展方便、是否有冗余垃圾，等等问题都不重要，因为后续要重构、要优化，同样让AI去做就好了。</p>
</li>
</ul>
<p>这不就是各种大模型发布时宣传的，一句话就完成项目开发的效果吗？</p>
<p>那啥都它做了，我还做什么呢？——这不就是你使用AI辅助编程的目的吗？——现在已经不是古法编程的时代了，我这种还惦记着一行一行去看代码的想法，或许早就该抛弃了。</p>
<h3 data-id="heading-2">无意义的工作就是在浪费生命？</h3>
<p>同样该抛弃的，说不定还有我这无意义的工作？没有发展前景、没有技术含量、没有乐趣，而且可能随便换个人动动嘴巴就能让AI代替我了……</p>
<ul>
<li>
<p>我的能力已经不足以我去完全逐行去理解AI生成的代码，因为量的问题，不管是它轻轻松松就能生成大量代码的深度，还是它技术能力的知识面广度，我都匹配不上。</p>
</li>
<li>
<p>到现在，突然变成了代码看不懂、代码不会写、但项目能做出来的奇怪境地。有些简单的功能，重复类似的功能，以前要写半天，现在可能它几分钟就做完了。</p>
</li>
<li>
<p>那么谁来不都一样了吗？以前那些你总在背后骂不懂技术的产品经理，现在他们可能不需要懂技术了，而且他们的文档说不定写得比你好。</p>
</li>
<li>
<p>更重要的是，为了省力，是不是也变得付费上班了，AIDE订阅，或者Code Plan续费，还是API充值，安慰自己是为了提升效率，解放自己的生产力，谁知道最后是不是降本增笑了呢？</p>
</li>
</ul>
<p>一直存在的工作方式是否就是合理，我不知道；能不能真的提高生产管理效率，我也不知道。但只要他们还没裁掉我，我每周856的生活，倒也还是轻松惬意。没记错的话，来公司九年多，我的人事管理上级应该是换了6次了吧，做硬件嵌入式开发，编写java web，当电话小弟接电话，修电脑修打印机，上流水线打螺丝，做什么VOIP电话系统，烧机系统，智能消防系统，ERP改善项目，到现在生产管理改善项目，心态从忿忿不平，倍感屈辱，想证明自己，到准备提桶跑路；从斤斤计较，推杯交盏，到混吃等死，无所吊谓。</p>
<p>好歹当年我也是985软件工程本科毕业的应届生，就让我干这些？“无意义的工作就是在浪费生命？”，再年轻五六年可能会有这样的想法，“一腔热血大抱负”，现在社会风气变了，我也变了，打工而已，又不能大富大贵，只要不横向对比产生妒忌，领点死工资活下去就行。</p>
<p>虽然很没劲，但是能混到退休自然是好的，混不下去的后路是什么呢？</p>
<h3 data-id="heading-3">年龄大了也没什么别的出路</h3>
<p>在头发越来越少之前，或者35岁之后没公司要了之后，我还能做什么？我想过，但我不知道：</p>
<ul>
<li>
<p>隔行如隔山，真的能干干脆脆直接从事体力劳动、比如去进厂打螺丝吗？比较难，不说是否还有一点点自尊心作祟，十几年坐在电脑前对键盘敲敲打打，哪有那个体力啊。</p>
</li>
<li>
<p>我连跑网约车的资格都没有，不仅没有车，也没有驾照，甚至是色弱……机房里的红绿指示灯从来猜不准；前端UI背景色一直使用取色器。所以我一直不是好色之徒，因为我根本分不清颜色。</p>
</li>
<li>
<p>少走三十年弯路直接“吉祥三保”？拜托，当保安你以为很简单啊，这是我老家县城汽车厂的保安招聘要求：</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e39e387c6434fa1843c9965656ced60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rWB6IuP55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744003&amp;x-signature=tdmzXGl0QZ19vJgKMi4A4abWJ%2B0%3D" alt="111.png" loading="lazy"/></p>
<p>什么，你说找条件不那么高的不就好了？有的兄弟，有的，小区保安，学历不限，身体健康，18-48岁即可，12小时两班倒，“3千-3.2千”。</p>
<p>但是话又说回来，又不是活不下去，“总比种庄稼好”。毕竟也有专家早就说过了：农民跟你们吃到的粮食关系并不大，甚至几乎没什么贡献。甚至说农民“懒惰愚蠢，不值得尊重”。骂人也不需要多说什么，骂他是“农民”就好了。</p>
<p>这不皆大欢喜嘛，国家积极鼓励三胎什么的，而我也就只是个农民而已，大家都嫌弃的农民而已，那我更不需要去承担什么“房贷、车贷、传宗接代”的压力，说不定就像电影里的那句话：“没有你对我很重要”。祖祖辈辈都是农民，到我这儿就结束了，也不是不行。至于哪种结束方式，似乎也没什么区别。</p>
<p>夕阳西下，鸡鸭回笼；天晚气清，带月荷锄；黄狗开路，狸猫乱鸣。也是怡然自得了。</p>
<h2 data-id="heading-4">我依旧会认为生活高于工作的</h2>
<h3 data-id="heading-5">找对象依旧很困难</h3>
<p>工作上是没什么进步和追求空间了，但是“传统美德”依旧有她强大的束缚力。</p>
<p>国庆节我回家了一趟，三千里路。父母其实都在广州，隔壁市而已，家里两个八十多岁的外公外婆。说是去市场赶集打红薯粉的时候，和一个市场小卖部的阿姨闲聊，听说有一个还不错的女孩子，人家家长也有这个意思。但还完全不知道对方任何情况的前提下，中间介绍人说必须要我、以及我的父母都回去见她一面，她觉得合适，才跟女方说。</p>
<p>我妈一听好像有合适的姑娘，啥都不管不问，非要让我国庆一起回去。回去之后屁股还没落地，外公外婆就开始念叨了。长话短说，我都只见到了中间人，之后才将状况了解了个大概：</p>
<ul>
<li>女孩子01年生的，是个体制外的小学老师，小我7岁</li>
<li>父亲前两年因病去世了，为了治病借了不少钱，还有二、三十万外债</li>
<li>还有个大二在读的妹妹</li>
<li>妈妈只有四十多岁，还年轻，之后应该会再嫁</li>
<li>只要帮他们把外债填了，把妹妹供到大学毕业，彩礼、车房什么的到时候再说就好了</li>
</ul>
<p>女方这样的条件，外公外婆觉得没什么问题，我妈都站在女方家庭来说觉得可以理解。</p>
<p>但关键我只是一个每个月到手不到一万，蜷缩在一个小小台资企业电子厂，写写企业内部数字化转型、没有盈利产品项目的底层码农而已，甚至女方借中间人之口早说过有点介意年龄差了，为什么我所有的家里人还是火急火燎地安排和叫我回去呢？为什么他们觉得这些条件都是可以接受的呢？其实原因就只有一个，我是一个三十多岁且几乎没有恋爱经验的老光棍，他们觉得我这辈子已经快完了，需要他们来解救我，再不努力就没机会了。</p>
<h3 data-id="heading-6">除了情情爱爱呢？</h3>
<p>这倒是，不能因为同龄人都这样，亲戚朋友都催促，也让自己的生活只有这些东西了，我也应该有什么喜欢做的事情吧。</p>
<p>不好说。</p>
<p>我的生活已经养成了习惯，早八晚五，一周六天，下班吃了饭，打开直播平台或者本地影视剧电影视频，充当背景音，19点打开游戏，一直玩到22点，然后洗漱，躺床上玩玩手机，23:30左右闭眼准备睡觉，然后翻来覆去睡不着，迷迷糊糊01点左右才入睡，然后早上07点不到被楼上的准时的长时间的咣咣啪啪的声音——不知道是做饭还是晨练——吵醒睡不着，然后迷迷糊糊7:20闹钟响，起床洗漱吃早饭就上班。一直如此，或许还会持续下去。</p>
<p>所以，让我这三个小时玩游戏的时间做点其他事情我都不愿意，不然这篇文章早就发出去了，中秋、国庆、冬至，甚至元旦的七律我应该都能写了。但我宁愿眼睛迷糊睁不开地玩游戏，都不去做其他堆积如山可以做的别的事情，或者真因为是游戏上瘾中年吧，也可能是只有那三个小时，才心无旁骛呢。</p>
<p>一江东水拦不住，凛冽北风寒彻骨。不打游戏，还有什么简单且有意思的事情呢？</p>
<ul>
<li>去大学城看看朝气蓬勃的学弟学妹？</li>
<li>去寒江钓钓鱼？</li>
<li>去爬爬山游游水放松心情？</li>
<li>去打打篮球锻炼身体？</li>
<li>……</li>
</ul>
<p>浪费时间，不如窝在寝室打几把游戏，管他是连胜还是连跪。</p>
<p>你要问我为什么不直接躺床上睡觉得了，其实我也想，但我躺久了，腰非常疼，根本躺不了太久，所以难得每周日关了闹钟早上想多躺一会儿，不是被吵醒也是被疼醒，然后又只是在床上翻来覆去而已。</p>
<p>不然呢，周末时间多一点，打开手机不知道看什么，打开电脑不知道干什么，呆呆看着窗外不知道要想什么……</p>
<p>那还不是一个人太闲了而已，忙起来看你还有没有心思东想西想。</p>
<h3 data-id="heading-7">那么潇洒地花钱你都不会吗？</h3>
<p>这个问题还真不好说，以前觉得培养一个爱好老花钱了，又晕车不爱出去玩，又没有情情爱爱需要维持，孝老包红包几千块也就过年回去一次。打打游戏已经是最省钱的娱乐了。所以其他需要花钱的，高频率的支出就真不多，这不就剩下吃吃喝喝了嘛。</p>
<p>上周旁边的超市周年庆，全场5.9折起，去买了两次，每次搞个杂七杂八小零嘴，总计40多小件，加起来十几斤也就不到两百块，怎么也得吃到元旦后。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c05cde902aeb4a6f86be1117ed3acbff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5rWB6IuP55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767744003&amp;x-signature=OfP6yNqHXWrh4u5V4y9ckNLlTBQ%3D" alt="超市小票.jpg" loading="lazy"/></p>
<p>那扎实的手感，就是真实的金钱的重量，200块能换十几二十斤小零食啊，看得见摸得着，自己选的。或许这个时候明白，原来钱挺值钱啊，不只是一串数字而已。</p>
<p>不过同样这数字，有时候也真烦心。</p>
<p>我有两个同样同龄打光棍的发小。A君现在在重庆，一个月到手八千左右，不是进厂计时计件，这在重庆不算少了，但这两个月月底都找我借钱，说是没钱吃饭了。一追问，居然全都买虚拟币去了，结果全爆了。13:31工资到卡上，14:13就划走，第二天12:10就找我借钱了。用他的原话说：“人要有梦想……涨起来是真猛，结果遇到跌……太垃圾了，老老实实存钱过年了……”</p>
<p>B君身高一米八三，长得帅气，身材匀称，没近视，有一头茂密的头发——反正我很羡慕。按揭两套房，市区一套，县城一套，总计月供我看好像3400吧，应该不算多，毕竟买得早。但是呢，他却很早就患上严重的抑郁症，长年累月各种因素导致的，看医生吃药已经很久了。现在他有严重的感情问题——不是感情有了问题，问题是没有感情——他特别想结婚，但他遇到的女性提出的要求，都在他经济能力之上。为了找到女朋友，花了1万块买了个什么婚恋网的会员，结果都没见到过几个相亲对象，更别说什么包装了。和我每次聊天最后都会说到，哪家结婚了要了多少彩礼，他买的房子又跌了多少钱，老板又在骂他，同事神经病……最近一次聊天，说是有和一个女生聊着，两个月花了一万六，都没牵上手。女方还要全款车全款房，然后18.8万彩礼……现在的他就在说些“真的心累……杀人放火……这样过不下去了……做什么弯路……”之类的话。</p>
<p> “不是非得大富大贵，不是非得结婚生子。”这句话，我一般不会用去安慰别人，因为我知道这不会有用的，一个人自己走不出来，他就永远走不出来。你说当前的社会环境是否真的有推波助澜的效果？可能有可能没有，但路是自己选的，总不能前面有个大坑，跌了倒了无数次，你还是往里面跳吧；也不能说看见别人都在往里面跳，你也就跟着一直往里面跳吧。我能想明白我要绕过去，别人想不明白你也不能强行拉着他走，劝两次差不多行了。因为他们都知道同一个解决方案，那就是一夜暴富，至于如何才能暴富……我也想知道。</p>
<h2 data-id="heading-8">写在最后</h2>
<p>与其担心还没有发生的一切，不如先过好正在发生的日子。你不能总想着今天最后再放纵一顿明天就减肥，也不能总想着万一明天世界末日所以今晚通宵嗨起来。时间的公平性，可能只是对于每个人都是一天24小时，但她从没承诺每个人都有同样多个24小时，当然她也没有要求你怎样去分配这一天24小时。可能你只需要知道，你的一天，也有24小时，那就足够了。</p>
<p>现在每天经历的24小时，似乎都是一样的24小时，到点起床上班，到点下班吃饭，到点玩游戏洗漱，到点玩手机睡觉，总是怀念过去、担忧未来，日复一日，年复一年，偶有差异，但大体相似，这，才是真正的技术壁垒——你想活出怎样的人生？</p>
<p>对于我自己，我不知道。很小的时候，我想当老师，教书育人，桃李天下；后来啊，我想当大官，克己奉公，清正廉明；或许啊，我只想搞钱，富甲一方，达济天下；到如今，两眼空空，今日一如昨日，今日亦如明天。当你不再热爱自己的工作和生活，仿佛一起都没有意义了，但实际恰恰相反，你已经找到了自己想要的生活。因为：</p>
<ul>
<li>或许你不曾想过要改变当前的生活</li>
<li>或许你想改变却不曾去尝试改变当前的生活</li>
<li>或许你曾努力却无法改变当前的生活</li>
<li>或许你其实正在享受当前的生活</li>
</ul>
<p>不要骗自己了，如果你一直过着同样的生活，那本就是你应该过的日子，你应该享受它，因为你的生活，主角从来都应该是你，你从来都不需要在别人的眼睛中凝视自己。</p>
<hr/>
<p>感谢垂阅。洋洋洒洒写了这么多，如果非要给这篇文章找个主题的话，那不如让AI来总结：</p>
<blockquote>
<p>这篇文章并非消极躺平的抱怨，而是在 AI 冲击、职场异化、社会期待与个体局限的交织中，一位普通技术从业者的清醒自白。它道出了一个冷淡又温柔的观点：当“热爱”不再可能，“接纳”便成了最后的体面。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS官方模板集成创新活动-流蓝卡片]]></title>    <link>https://juejin.cn/post/7589509638355402779</link>    <guid>https://juejin.cn/post/7589509638355402779</guid>    <pubDate>2025-12-30T18:17:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589509638355402779" data-draft-id="7589530529452720137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS官方模板集成创新活动-流蓝卡片"/> <meta itemprop="keywords" content="前端,HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-30T18:17:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="万少"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708283191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS官方模板集成创新活动-流蓝卡片
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708283191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    万少
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T18:17:14.000Z" title="Tue Dec 30 2025 18:17:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">HarmonyOS官方模板集成创新活动-流蓝卡片 <a href="#harmonyos%E5%AE%98%E6%96%B9%E6%A8%A1%E6%9D%BF%E9%9B%86%E6%88%90%E5%88%9B%E6%96%B0%E6%B4%BB%E5%8A%A8-%E6%B5%81%E8%93%9D%E5%8D%A1%E7%89%87" title="#harmonyos%E5%AE%98%E6%96%B9%E6%A8%A1%E6%9D%BF%E9%9B%86%E6%88%90%E5%88%9B%E6%96%B0%E6%B4%BB%E5%8A%A8-%E6%B5%81%E8%93%9D%E5%8D%A1%E7%89%87">​</a></h2>
<h2 data-id="heading-1">介绍 <a href="#%E4%BB%8B%E7%BB%8D" title="#%E4%BB%8B%E7%BB%8D">​</a></h2>
<p>​ <strong>流蓝卡片</strong>是一款适配了的鸿蒙6-API20的HarmonyOS应用，目的在于给用户提供方便、简单的方式创建好看的卡片，用于将卡片发布到各种社交平台上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb66286468494188b7afe0cd2be4c6d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=Dy5uq%2BUDla%2Fd0zn1u%2BLDNCMOxKA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">实现过程 <a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B" title="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B">​</a></h2>
<p>​ 目前是AI Codeing的时代，流蓝卡片其实也是基于AI Coding的产物，人工参与代码部分不超过5%。</p>
<p>​ 这款应用用到的亮点技术有：GLM4.6 + Gemini-3-pro + 智谱图片生成 + command line 构建鸿蒙工程。</p>
<p>​ 这套技术组成可以极大方便我开发鸿蒙应用。</p>
<h2 data-id="heading-3">集成官方模板 <a href="#%E9%9B%86%E6%88%90%E5%AE%98%E6%96%B9%E6%A8%A1%E6%9D%BF" title="#%E9%9B%86%E6%88%90%E5%AE%98%E6%96%B9%E6%A8%A1%E6%9D%BF">​</a></h2>
<p>​ 考虑到流蓝卡片目前是一个工具类型的应用，所以需要开发更多的一些相关工具，由于官方模板中提供了众多能力，这里就直接接入官方模板的-<strong>通用工具模板</strong>了。</p>
<h3 data-id="heading-4">1. 寻找合适的官方模板 <a href="#_1-%E5%AF%BB%E6%89%BE%E5%90%88%E9%80%82%E7%9A%84%E5%AE%98%E6%96%B9%E6%A8%A1%E6%9D%BF" title="#_1-%E5%AF%BB%E6%89%BE%E5%90%88%E9%80%82%E7%9A%84%E5%AE%98%E6%96%B9%E6%A8%A1%E6%9D%BF">​</a></h3>
<p>在该网址中寻找你想要的官方模板，进行下载使用。</p>
<blockquote>
<p>官方模板地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fmarket%2Fprod-list%3Forigin%3Dtemplate%26keyWord%3D%25E5%258D%258E%25E4%25B8%25BA%25E6%25A8%25A1%25E6%259D%25BF%26ha_source%3D9yhd%26ha_sourceId%3D89000071" target="_blank" title="https://developer.huawei.com/consumer/cn/market/prod-list?origin=template&amp;keyWord=%E5%8D%8E%E4%B8%BA%E6%A8%A1%E6%9D%BF&amp;ha_source=9yhd&amp;ha_sourceId=89000071" ref="nofollow noopener noreferrer">developer.huawei.com/consumer/cn…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ca9a7c8abb745e0a4e3850ab22f807e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=r0rNUN9IkgkUy1R96aDX4exj0Us%3D" alt="" loading="lazy"/></p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/437ddd9c66f3443e9615a438005b2133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=dG2jpw8yxGnAPsYT5N7B0W6Vdhk%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">2. 下载安装 <a href="#_2-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85" title="#_2-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85">​</a></h3>
<p>根据使用文档，点击集成</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d189717d4414495db6ad940edeacd050~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=tEkH6pOV6P3FPnPtaLLsNZchwD4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">3. 调整相关依赖 <a href="#_3-%E8%B0%83%E6%95%B4%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96" title="#_3-%E8%B0%83%E6%95%B4%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96">​</a></h3>
<p>​ 根据自己当前工程需要，来调整引入的方式，如</p>
<blockquote>
<p><strong>Entry</strong>模块引入 Home模块，<strong>Home</strong>模块引入所有的工具模块</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6a43bf5f5d04af89aa3c36072b48a1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=eD5eb4TTzkJWjHVptv64zrZtg7A%3D" alt="" loading="lazy"/></p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0dc91448734f4fd98732208bb676c655~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=ILzISE6BGDIfjpSacCI1MCsKiis%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">4. 开发调试以及发布上架 <a href="#_4-%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E4%BB%A5%E5%8F%8A%E5%8F%91%E5%B8%83%E4%B8%8A%E6%9E%B6" title="#_4-%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E4%BB%A5%E5%8F%8A%E5%8F%91%E5%B8%83%E4%B8%8A%E6%9E%B6">​</a></h3>
<p>​ 由于工具中需要用到不少硬件资源，所以需要申请相关权限。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45a6fe4e78fc47e888ab70bc27a8730a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=jaU0RMYbBuayqOoiJGuDN94kFls%3D" alt="" loading="lazy"/></p>
<p>这一部分权限需要在AGC平台上进行申请，接着跟着生成最新的调试和发布证书，否则开发调试和上架都会因为权限问题导致失败。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c29e140a4ce44c9495018c7dc0dc3964~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=NjOodiJ3qKnASzgcPA8TNnqa3Vk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">流蓝卡片卡片的技术亮点 <a href="#%E6%B5%81%E8%93%9D%E5%8D%A1%E7%89%87%E5%8D%A1%E7%89%87%E7%9A%84%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9" title="#%E6%B5%81%E8%93%9D%E5%8D%A1%E7%89%87%E5%8D%A1%E7%89%87%E7%9A%84%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9">​</a></h2>
<ol>
<li>V2状态管理 - 全面采用@ObservedV2、@Trace、@ComponentV2等新一代状态管理技术</li>
<li>HAR模块化架构 - 30+独立HAR组件包，可独立开发、测试和发布</li>
<li>ZRouter路由方案 - 基于Navigation的声明式路由管理</li>
<li>关系型数据库 - 完整的RdbManager + CardTable/InspirationTable/TemplateTable封装</li>
<li>流畅动画 - 入场阶梯式动画，opacity + translate + delay实现平滑过渡</li>
<li>浮动TabBar - 自定义底部导航栏，带浮动"+"按钮和阴影效果</li>
<li>@Extend组件扩展 - 提高代码复用性</li>
<li>AppStorage全局状态 - 跨页面状态共享</li>
<li>多环境构建 - 调试/发布双环境配置</li>
<li>丰富工具生态 - 30+实用工具（计算、测量、创作、实用类）</li>
</ol>
<h2 data-id="heading-9">总结 <a href="#%E6%80%BB%E7%BB%93" title="#%E6%80%BB%E7%BB%93">​</a></h2>
<p>鸿蒙模板市场中提供了大量优质的三方组件和模板，提高了开发者开发同类功能的效率，点赞。</p>
<p>如果你也想要了解HarmonyOS开发最新信息，欢迎技术交流</p>
<blockquote>
<p>我的博客： <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.zbztb.cn%2F" target="_blank" title="https://blog.zbztb.cn/" ref="nofollow noopener noreferrer">blog.zbztb.cn</a></p>
</blockquote>
<p>目前我们上架的作品也已经达到了20+个。</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.qinglanzhuma.cn%2F" target="_blank" title="https://link.juejin.cn/?target=https%3A%2F%2Fwww.qinglanzhuma.cn%2F">关于青蓝逐码组织</a></p>
<p>如果你兴趣想要了解更多的鸿<strong>蒙应用开发细节和最新资讯</strong>，<strong>甚至你想要做出一款属于自己的应用</strong>！欢迎在评论区留言或者私信或者看我个人信息，可以加入技术交流群。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6484d23b32d4426bbf3960410c2fc4b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767723434&amp;x-signature=8rV9LEfHSNPmVvKtJx8kstt3IHs%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nop入门：使用Excel模板生成包含图表的报表]]></title>    <link>https://juejin.cn/post/7589482741759426587</link>    <guid>https://juejin.cn/post/7589482741759426587</guid>    <pubDate>2025-12-30T16:27:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589482741759426587" data-draft-id="7589494074982613043" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nop入门：使用Excel模板生成包含图表的报表"/> <meta itemprop="keywords" content="Java,Excel,低代码"/> <meta itemprop="datePublished" content="2025-12-30T16:27:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nop入门：使用Excel模板生成包含图表的报表
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T16:27:12.000Z" title="Tue Dec 30 2025 16:27:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>讲解视频：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1NfvYBRExv%2F" target="_blank" title="https://www.bilibili.com/video/BV1NfvYBRExv/" ref="nofollow noopener noreferrer">Nop入门：使用NopReport导出Excel图表_哔哩哔哩_bilibili</a></p>
<p>Nop平台内置了一个非常精简的中国式报表引擎NopReport，它可以实现商业报表引擎如FineReport和润乾报表的核心功能。NopReport很巧妙的利用Excel单元格的批注机制来存放扩展信息，可以直接使用Excel模板来作为报表模板，这样大大简化了报表制作过程，并且可以复用客户已有的各种业务表格。</p>
<p>在实现层面，NopReport没有使用Apache POI库，而是选择了直接使用流式接口解析Office XML文件，解析时使用的也不是Java标准的XML解析器，而是自行实现的XNodeParser(速度比标准解析器快2倍)。NopReport是一个非常精简高效的实现，核心代码只有3000多行，却可以达到比商业报表引擎的更好的性能和更好的可扩展性。</p>
<p>本文将介绍NopReport的基本使用方式，以及如何在Excel报表模板中配置图表显示。</p>
<h3 data-id="heading-0">1. 配置报表展开逻辑</h3>
<p>NopReport采用了润乾报表发明的层次坐标展开算法，可以通过父子单元格关联展开实现非常复杂的报表逻辑。具体参见<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fvt9RmHNa2yBnvNe07aLdTw" target="_blank" title="https://mp.weixin.qq.com/s/vt9RmHNa2yBnvNe07aLdTw" ref="nofollow noopener noreferrer">非线性中国式报表引擎NopReport源码解析</a></p>
<p><strong>配置展开单元格</strong>:</p>
<ol>
<li><strong>右键单元格</strong> → <strong>插入批注</strong></li>
<li><strong>在批注中输入配置参数</strong>，每行一个参数：</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">expandType</span>=r
<span class="hljs-attr">ds</span>=ds1
<span class="hljs-attr">field</span>=product
</code></pre>
<ul>
<li><code>expandType=r</code>表示单元格向下展开，产生多行输出。这个单元格右侧的所有单元格缺省情况下都是它的子格。父格展开后子格自动被复制。</li>
<li>ds和field配置指定了从哪个数据集的哪个字段取值。展开单元格中配置field会自动按照该字段进行分组。</li>
</ul>
<p>以上配置表示按照ds1数据集(列表格式)的product字段进行分组汇总，并为每个分组产生一个输出结果。在子单元格上只要配置field属性就可以按照该属性值进行取值并输出。</p>
<h3 data-id="heading-1">2. 配置图表动态绑定</h3>
<p>NopReport支持导出Excel的时候生成与数据关联的图表。具体做法同样是在备注文本中增加扩展信息。</p>
<p>右键点击图表，选择"编辑可选文字"，输入以下配置：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4358182081974dc5b847761bc6c3a90a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=778mGnk6wJaGIdmFcFQTtzzJVGs%3D" alt="图表配置界面" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini">销售数据柱状图
----
----
<span class="hljs-attr">seriesDataCellRefExpr</span>=xptRt.buildCellRef(<span class="hljs-string">'Sheet1!B3'</span>, seriesModel.index,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)
<span class="hljs-attr">seriesTestExpr</span>=seriesModel.index &lt; <span class="hljs-number">2</span>
<span class="hljs-attr">seriesNameExpr</span>=xptRt.ds(<span class="hljs-string">'ds1'</span>).group(<span class="hljs-string">'product'</span>)[seriesModel.index].key+<span class="hljs-string">'Series'</span>
</code></pre>
<p>上述配置效果：</p>
<ul>
<li>动态产生单元格引用表达式，比如生成 <code>Sheet1!B3:D3</code></li>
<li>仅生成 index 为 0、1 的两个系列</li>
<li>图表名称使用动态计算得到的字符串</li>
</ul>
<h3 data-id="heading-2">3. Java代码调用</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestReportChart</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTestCase</span> {
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBarChart</span><span class="hljs-params">()</span> {
        <span class="hljs-type">IReportEngine</span> <span class="hljs-variable">reportEngine</span> <span class="hljs-operator">=</span> newReportEngine();
        <span class="hljs-type">ExcelWorkbook</span> <span class="hljs-variable">workbook</span> <span class="hljs-operator">=</span> reportEngine.getXptModel(<span class="hljs-string">"/nop/report/demo/test-bar-chart.xpt.xlsx"</span>);

        <span class="hljs-type">ITemplateOutput</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> reportEngine.getRendererForXptModel(workbook, <span class="hljs-string">"xlsx"</span>);
        <span class="hljs-type">IEvalScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> XLang.newEvalScope();
        output.generateToFile(getTargetFile(<span class="hljs-string">"result-bar-chart.xlsx"</span>),scope);
    }
}
</code></pre>
<p>可以通过scope向报表引擎传递变量，也可以在报表模板的【展开前】配置中通过XScript语言来定义数据集。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34c42b28365c42348698e97ea5a4be61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=8nJIh4NDnHpBYbCMXlQa2S3qZ4A%3D" alt="report-data-set.png" loading="lazy"/></p>
<h2 data-id="heading-3">展开单元格配置参数说明：</h2>
<ul>
<li><strong>expandType</strong>：展开方向（r=right向右，l=left向左，d=down向下，u=up向上）</li>
<li><strong>expandExpr</strong>：展开表达式，返回一个集合，当前单元格按此集合展开</li>
<li><strong>field</strong>：展开字段名，按指定字段对数据集进行分组展开</li>
<li><strong>ds</strong>：数据源名称</li>
<li><strong>expandInplaceCount</strong>：原地展开的数量限制</li>
<li><strong>expandMinCount</strong>：最少展开元素数量</li>
<li><strong>expandMaxCount</strong>：最多展开元素数量</li>
<li><strong>rowParent/colParent</strong>：设置行/列父格</li>
</ul>
<h2 data-id="heading-4">图表配置参数说明：</h2>
<p>可在“----”之后配置以下常用表达式（更多项见 schema：/nop/schema/excel/chart.xdef 的 ）：</p>
<ul>
<li>chartTestExpr: (chartModel) =&gt; boolean
<ul>
<li>决定是否生成整个图表</li>
</ul>
</li>
<li>chartTitleCellRefExpr: (chartModel) =&gt; string</li>
<li>chartTitleExpr: (chartModel) =&gt; string
<ul>
<li>标题可用单元格引用或直接文本（二选一）。若 cellRefExpr 返回非空，则优先按单元格；否则尝试 titleExpr 文本</li>
</ul>
</li>
<li>seriesTestExpr: (seriesModel, chartModel) =&gt; boolean
<ul>
<li>决定某个系列是否保留（返回 true 保留）</li>
</ul>
</li>
<li>seriesNameCellRefExpr | seriesNameExpr: (seriesModel, chartModel) =&gt; string</li>
<li>seriesDataCellRefExpr | seriesDataExpr: (seriesModel, chartModel) =&gt; string/any</li>
<li>seriesCatCellRefExpr | seriesCatExpr: (seriesModel, chartModel) =&gt; string/any</li>
<li>axisDataCellRefExpr: (axisModel, chartModel) =&gt; string</li>
<li>axisTitleCellRefExpr | axisTitleExpr: (axisModel, chartModel) =&gt; string</li>
</ul>
<h2 data-id="heading-5">模板预置原则</h2>
<p>一个重要的设计原则是：<strong>模板需要预置最多的系列数量</strong>。运行时不会创建新的系列，只会基于模板中已有的系列进行过滤和配置。</p>
<h2 data-id="heading-6">支持的图表类型</h2>
<p>NopReport图表功能支持丰富的图表类型，以下是一些常用图表的示例：</p>
<h3 data-id="heading-7">柱状图/条形图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03476ea1fe734e41b3d9474ca0e00c1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=lsZbYLLAdXWyCjeSZnxizVRW8Yo%3D" alt="簇状柱形图" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23ac9af8df89487093ab8518865a7afd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=GCMqQTJBIwxWLvgNaVKKgw9%2BoBQ%3D" alt="堆积柱形图" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/005613d02adf47818ad24928277ba85e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=JCnrtYQgVVf%2FaijKxpi%2FDm82ayk%3D" alt="百分比堆积柱形图" loading="lazy"/></p>
<h3 data-id="heading-8">折线图/面积图</h3>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20../dev-guide/report/excel-chart/line-chart.png" alt="折线图转存失败，建议直接上传图片文件" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a73075ee0284c648085367e219a2609~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=1voNH%2FgqTYnyisyTPSOas32JQOg%3D" alt="带数据标记的折线图" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ed17e837b234b59909f70488f7c43be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=b1UUh4iWScW9VIPbrGBcDA4pKAI%3D" alt="面积图" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7edd66108850484ea8c3343aa0813a86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=avVOED%2F3YBFLHRSpriOmNLyeLOo%3D" alt="堆积面积图" loading="lazy"/></p>
<h3 data-id="heading-9">饼图/环形图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03b382a2541843d5b519222236f3fc20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=ChGty7%2BA%2BTfQy%2BdxmcNtLjshyGA%3D" alt="饼图" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a99d63146848466b8299faab49bb8a32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=mVcNGZeOzT5W7uHwo4BeTQYdGTc%3D" alt="环形图" loading="lazy"/></p>
<h3 data-id="heading-10">其他图表</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e77a9425d4c46ae8366afe1ba199e49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=ESqOxKK1n6OoK2ZI%2FXjXbOmkugM%3D" alt="雷达图" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa11bbe9fc9446eca3e7d420d75cae7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=Nnm9fZk8W50NbmrbJe9s0zl%2BfQE%3D" alt="散点图" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/471b77fbc714453aaa57774187ad8307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fub25pY2FsX2VudHJvcHk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767716832&amp;x-signature=CWzPddQUPu%2F9tqkpne%2BLrlNETH0%3D" alt="填充雷达图" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[30多岁的我，为什么开始写自媒体？]]></title>    <link>https://juejin.cn/post/7589466238241013802</link>    <guid>https://juejin.cn/post/7589466238241013802</guid>    <pubDate>2025-12-30T15:12:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589466238241013802" data-draft-id="7589466238240997418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="30多岁的我，为什么开始写自媒体？"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-12-30T15:12:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            30多岁的我，为什么开始写自媒体？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T15:12:41.000Z" title="Tue Dec 30 2025 15:12:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>年底，总比预想的更忙一些。</p>
<p>最近几天，不是参加活动，就是出差交流，更新的事情也空了好几天——不是不想写，是真的腾不出空，毕竟，一年来的坚持，记录与分享已经成为一种习惯。</p>
<p>要说今年最大的收获，就是养成了写作的习惯，终于有了一次长久的坚持。</p>
<p>今天有一个好消息和大家分享：<code>TRAE</code> 官方的两个证书收到了——“<strong>年度社区突出贡献奖</strong>”和“<strong>年度创作之星</strong>”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aceb1106d3b492688aacb500cc8a415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767712361&amp;x-signature=pbnlHti51bddonwlkuqVCgoXZ5k%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1602da6439d465b9ca9947b5690e717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767712361&amp;x-signature=RtHQwV7lRJzANdjH2IzXwRkxik0%3D" alt="" loading="lazy"/></p>
<p>虽然，前几天已经知道有幸被评上奖了，但终归不如拿到证书的喜悦来的直接。</p>
<p>说到写作，好像一直没怎么聊过自己<strong>为什么做自媒体</strong>，今天，简单说说吧。</p>
<p>首先，就是为了自我的<strong>知识进化</strong>。</p>
<p>单纯的场景驱动学习虽然见效快，但并不稳固。</p>
<p>我认识到只有进行更深入、更独立的思考，实践并总结，进而达到能够分享的程度，才算真正掌握了某个技能，才能扩展自己的知识体系。</p>
<p>于是，我就开始写了。</p>
<p>其次，则是为了养成一个<strong>长期学习</strong>的习惯。</p>
<p>刚开始，为了有内容，我都是逼着自己了解新东西、实践新东西、分享新东西。后来，写作的习惯养成了，自己也越来越习惯学习新东西了。</p>
<p>毕竟，技术领域日新月异，跟不上就是落后。</p>
<p>最后，可能真的是年龄到了。</p>
<p>去年，突然意识到自己做技术做了十几年，但在网络上几乎没有留下任何痕迹。</p>
<p>PS. 除了下图 10 年前的几篇文章。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ba05dccfba94a40ad10dce33211aa86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767712361&amp;x-signature=ezwSMqJK43komCzgCy3d1Ls3RqU%3D" alt="10年前的博文" loading="lazy"/></p>
<p>以后不做技术了，可能技术圈就再也不记得我来过。</p>
<p>因此，想要去建立一个数字身份，去<strong>为自己从事的领域添上那么一砖半瓦</strong>。</p>
<p>好了，今天先说这么多吧。</p>
<p>2025 还有 1 天，希望大家都能开心度过。</p>
<p>也提前预祝大家2026年，身体健康，阖家幸福，AI生活，AI工作！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ooder框架8步编码流程实战 - DSM组件UI统计模块深度解析]]></title>    <link>https://juejin.cn/post/7589481566423400502</link>    <guid>https://juejin.cn/post/7589481566423400502</guid>    <pubDate>2025-12-30T15:13:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589481566423400502" data-draft-id="7589499648084508708" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Ooder框架8步编码流程实战 - DSM组件UI统计模块深度解析"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-30T15:13:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Ooder框架8步编码流程实战 - DSM组件UI统计模块深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T15:13:46.000Z" title="Tue Dec 30 2025 15:13:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在企业级应用开发中，规范的编码流程是确保项目质量和开发效率的关键。Ooder框架作为一款全栈框架，以其注解驱动的开发模式和清晰的8步编码流程，为开发者提供了高效、规范的开发体验。本文将以DSM（Domain-Specific Module）组件UI统计模块为例，详细介绍Ooder框架的8步编码流程在实际项目中的应用。</p>
<h2 data-id="heading-1">项目背景</h2>
<p>DSM组件UI统计模块是一个用于统计和分析系统中UI组件使用情况的模块，旨在帮助开发者了解组件的使用频率、分布情况和效率，从而优化组件设计和提高开发效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46ba21ae03a84197ade186ab7dbdd1c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767712425&amp;x-signature=ReA%2BxifidOYQRd4KurmKIH7CP7M%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">1. 视图及元数据定义</h2>
<h3 data-id="heading-3">1.1 步骤说明</h3>
<p>第一步是定义视图及元数据。所有视图以及视图的元数据都采用枚举方式输出，确保与模块结构图形成映射。视图元数据枚举需要实现<code>IconEnumstype</code>接口，包含视图名称、图标、URL、描述等必要字段。</p>
<h3 data-id="heading-4">1.2 实施过程</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2b91f765f9041c3909f15ba60780dee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT25lQ29kZUNO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767712425&amp;x-signature=p5imNAETTvLXjBUdZZa11XzJRII%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>
<p><strong>模块结构设计</strong>：根据需求，设计了以下视图结构：</p>
<ul>
<li>主统计视图：展示组件使用概况</li>
<li>类型分布视图：展示不同类型组件的分布情况</li>
<li>使用趋势视图：展示组件使用的时间趋势</li>
<li>使用效率视图：展示组件的使用效率</li>
<li>使用详情视图：展示组件使用的详细信息</li>
<li>分类统计视图：展示组件的分类统计信息</li>
</ul>
</li>
<li>
<p><strong>视图元数据枚举实现</strong>：</p>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> view.stats;

<span class="hljs-keyword">import</span> net.ooder.annotation.IconEnumstype;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 组件UI统计视图枚举
 * 定义组件UI统计模块的所有视图和元数据
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ComponentUIStatsViewEnum</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IconEnumstype</span> {
    
    <span class="hljs-comment">// 主统计视图 - 模块：stats</span>
    COMPONENT_STATS(<span class="hljs-string">"组件UI统计"</span>, <span class="hljs-string">"ri-bar-chart-line"</span>, <span class="hljs-string">"/dsm/stats/component/"</span>, <span class="hljs-string">"组件UI使用统计分析"</span>),
    
    <span class="hljs-comment">// 子视图1 - 组件类型分布</span>
    TYPE_DISTRIBUTION(<span class="hljs-string">"组件类型分布"</span>, <span class="hljs-string">"ri-pie-chart-line"</span>, <span class="hljs-string">"/dsm/stats/component/TypeDistribution"</span>, <span class="hljs-string">"组件类型分布统计"</span>),
    
    <span class="hljs-comment">// 子视图2 - 组件使用趋势</span>
    USAGE_TREND(<span class="hljs-string">"使用趋势"</span>, <span class="hljs-string">"ri-line-chart-line"</span>, <span class="hljs-string">"/dsm/stats/component/UsageTrend"</span>, <span class="hljs-string">"组件使用趋势统计"</span>),
    
    <span class="hljs-comment">// 子视图3 - 组件使用效率</span>
    USAGE_EFFICIENCY(<span class="hljs-string">"使用效率"</span>, <span class="hljs-string">"ri-bar-chart-line"</span>, <span class="hljs-string">"/dsm/stats/component/UsageEfficiency"</span>, <span class="hljs-string">"组件使用效率统计"</span>),
    
    <span class="hljs-comment">// 子视图4 - 组件使用详情</span>
    USAGE_DETAIL(<span class="hljs-string">"使用详情"</span>, <span class="hljs-string">"ri-list-check"</span>, <span class="hljs-string">"/dsm/stats/component/UsageDetail"</span>, <span class="hljs-string">"组件使用详情列表"</span>),
    
    <span class="hljs-comment">// 子视图5 - 组件分类统计</span>
    CATEGORY_STATS(<span class="hljs-string">"分类统计"</span>, <span class="hljs-string">"ri-bar-chart-grouped-line"</span>, <span class="hljs-string">"/dsm/stats/component/CategoryStats"</span>, <span class="hljs-string">"组件分类统计"</span>);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String name;          <span class="hljs-comment">// 视图名称</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String imageClass;    <span class="hljs-comment">// 图标类名</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String url;           <span class="hljs-comment">// URL访问地址</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String description;   <span class="hljs-comment">// 视图描述</span>
    
    <span class="hljs-comment">/**
     * 构造函数
     */</span>
    ComponentUIStatsViewEnum(String name, String imageClass, String url, String description) {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.imageClass = imageClass;
        <span class="hljs-built_in">this</span>.url = url;
        <span class="hljs-built_in">this</span>.description = description;
    }
    
    <span class="hljs-comment">// Getter方法...</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.name;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getImageClass</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.imageClass;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUrl</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.url;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.description;
    }
    
    <span class="hljs-comment">/**
     * 获取模块结构映射
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, Map&lt;String, List&lt;ComponentUIStatsViewEnum&gt;&gt;&gt; <span class="hljs-title function_">getModuleStructureMapping</span><span class="hljs-params">()</span> {
        Map&lt;String, Map&lt;String, List&lt;ComponentUIStatsViewEnum&gt;&gt;&gt; moduleMapping = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (ComponentUIStatsViewEnum viewEnum : values()) {
            <span class="hljs-comment">// 构建模块结构映射</span>
            moduleMapping.computeIfAbsent(<span class="hljs-string">"stats"</span>, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;());
            moduleMapping.get(<span class="hljs-string">"stats"</span>).computeIfAbsent(<span class="hljs-string">"component"</span>, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;()).add(viewEnum);
        }
        
        <span class="hljs-keyword">return</span> moduleMapping;
    }
    
    <span class="hljs-comment">/**
     * 获取视图间关系
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;ComponentUIStatsViewEnum, List&lt;ComponentUIStatsViewEnum&gt;&gt; <span class="hljs-title function_">getViewRelations</span><span class="hljs-params">()</span> {
        Map&lt;ComponentUIStatsViewEnum, List&lt;ComponentUIStatsViewEnum&gt;&gt; relations = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        List&lt;ComponentUIStatsViewEnum&gt; childViews = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        childViews.add(TYPE_DISTRIBUTION);
        childViews.add(USAGE_TREND);
        childViews.add(USAGE_EFFICIENCY);
        childViews.add(USAGE_DETAIL);
        childViews.add(CATEGORY_STATS);
        
        relations.put(COMPONENT_STATS, childViews);
        <span class="hljs-keyword">return</span> relations;
    }
}
</code></pre>
<h2 data-id="heading-5">2. 钩子API创建</h2>
<h3 data-id="heading-6">2.1 步骤说明</h3>
<p>第二步是创建钩子API方法，将视图与URL访问地址进行绑定，同时添加视图间关系的工作。钩子API是Ooder框架中连接视图和后端逻辑的重要桥梁。</p>
<h3 data-id="heading-7">2.2 实施过程</h3>
<ol>
<li><strong>控制器类创建</strong>：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> view.stats;

<span class="hljs-keyword">import</span> net.ooder.config.ListResultModel;
<span class="hljs-keyword">import</span> net.ooder.config.ResultModel;
<span class="hljs-keyword">import</span> net.ooder.esd.annotation.ModuleAnnotation;
<span class="hljs-keyword">import</span> net.ooder.esd.enums.ModuleViewType;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">/**
 * 组件UI统计控制器
 */</span>
<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping("/dsm/stats/component/")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComponentUIStatsController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ComponentUIStatsService componentUIStatsService;
    
    <span class="hljs-comment">// ==================== 业务API方法 ====================</span>
    
    <span class="hljs-comment">/**
     * 组件类型分布统计
     */</span>
    <span class="hljs-meta">@PostMapping("TypeDistribution")</span>
    <span class="hljs-meta">@ModuleAnnotation(
        caption = "组件类型分布",
        imageClass = "ri-pie-chart-line",
        moduleViewType = ModuleViewType.FCHART
    )</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ListResultModel&lt;List&lt;ComponentStatsData&gt;&gt; <span class="hljs-title function_">getTypeDistribution</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam(required = false)</span> String dateRange)</span> {
        ListResultModel&lt;List&lt;ComponentStatsData&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListResultModel</span>&lt;&gt;();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 调用服务层方法获取数据</span>
            Map&lt;String, Integer&gt; distribution = componentUIStatsService.getTypeDistribution(dateRange);
            
            <span class="hljs-comment">// 转换数据格式</span>
            List&lt;ComponentStatsData&gt; dataList = distribution.entrySet().stream()
                    .map(entry -&gt; {
                        <span class="hljs-type">ComponentStatsData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentStatsData</span>();
                        data.setType(entry.getKey());
                        data.setCount(entry.getValue());
                        data.setDescription(<span class="hljs-string">"组件类型: "</span> + entry.getKey());
                        <span class="hljs-keyword">return</span> data;
                    })
                    .collect(Collectors.toList());
            
            result.setData(dataList);
            result.setSuccess(<span class="hljs-literal">true</span>);
            result.setMessage(<span class="hljs-string">"组件类型分布数据获取成功"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            result.setSuccess(<span class="hljs-literal">false</span>);
            result.setMessage(<span class="hljs-string">"获取组件类型分布数据失败: "</span> + e.getMessage());
            <span class="hljs-comment">// 记录日志</span>
            e.printStackTrace();
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * 组件使用趋势统计
     */</span>
    <span class="hljs-meta">@PostMapping("UsageTrend")</span>
    <span class="hljs-meta">@ModuleAnnotation(
        caption = "使用趋势",
        imageClass = "ri-line-chart-line",
        moduleViewType = ModuleViewType.LCHART
    )</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ListResultModel&lt;List&lt;UsageTrendData&gt;&gt; <span class="hljs-title function_">getUsageTrend</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam</span> String period,
            <span class="hljs-meta">@RequestParam(required = false)</span> String dateRange)</span> {
        ListResultModel&lt;List&lt;UsageTrendData&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListResultModel</span>&lt;&gt;();
        
        <span class="hljs-keyword">try</span> {
            List&lt;UsageTrendData&gt; trendData = componentUIStatsService.getUsageTrend(period, dateRange);
            result.setData(trendData);
            result.setSuccess(<span class="hljs-literal">true</span>);
            result.setMessage(<span class="hljs-string">"组件使用趋势数据获取成功"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            result.setSuccess(<span class="hljs-literal">false</span>);
            result.setMessage(<span class="hljs-string">"获取组件使用趋势数据失败: "</span> + e.getMessage());
            e.printStackTrace();
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * 组件使用效率统计
     */</span>
    <span class="hljs-meta">@PostMapping("UsageEfficiency")</span>
    <span class="hljs-meta">@ModuleAnnotation(
        caption = "使用效率",
        imageClass = "ri-bar-chart-line",
        moduleViewType = ModuleViewType.BCHART
    )</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ListResultModel&lt;List&lt;UsageEfficiencyData&gt;&gt; <span class="hljs-title function_">getUsageEfficiency</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam(required = false)</span> String dateRange)</span> {
        ListResultModel&lt;List&lt;UsageEfficiencyData&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListResultModel</span>&lt;&gt;();
        
        <span class="hljs-keyword">try</span> {
            List&lt;UsageEfficiencyData&gt; efficiencyData = componentUIStatsService.getUsageEfficiency(dateRange);
            result.setData(efficiencyData);
            result.setSuccess(<span class="hljs-literal">true</span>);
            result.setMessage(<span class="hljs-string">"组件使用效率数据获取成功"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            result.setSuccess(<span class="hljs-literal">false</span>);
            result.setMessage(<span class="hljs-string">"获取组件使用效率数据失败: "</span> + e.getMessage());
            e.printStackTrace();
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * 组件使用详情
     */</span>
    <span class="hljs-meta">@PostMapping("UsageDetail")</span>
    <span class="hljs-meta">@ModuleAnnotation(
        caption = "使用详情",
        imageClass = "ri-list-check",
        moduleViewType = ModuleViewType.TABLE
    )</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ResultModel&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getUsageDetail</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam(defaultValue = "1")</span> <span class="hljs-type">int</span> page,
            <span class="hljs-meta">@RequestParam(defaultValue = "20")</span> <span class="hljs-type">int</span> pageSize,
            <span class="hljs-meta">@RequestParam(required = false)</span> Map&lt;String, String&gt; filters)</span> {
        ResultModel&lt;Map&lt;String, Object&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultModel</span>&lt;&gt;();
        
        <span class="hljs-keyword">try</span> {
            Map&lt;String, Object&gt; detailData = componentUIStatsService.getUsageDetail(page, pageSize, filters);
            result.setData(detailData);
            result.setSuccess(<span class="hljs-literal">true</span>);
            result.setMessage(<span class="hljs-string">"组件使用详情数据获取成功"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            result.setSuccess(<span class="hljs-literal">false</span>);
            result.setMessage(<span class="hljs-string">"获取组件使用详情数据失败: "</span> + e.getMessage());
            e.printStackTrace();
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * 组件分类统计
     */</span>
    <span class="hljs-meta">@PostMapping("CategoryStats")</span>
    <span class="hljs-meta">@ModuleAnnotation(
        caption = "分类统计",
        imageClass = "ri-bar-chart-grouped-line",
        moduleViewType = ModuleViewType.GCHART
    )</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ListResultModel&lt;List&lt;CategoryStatsData&gt;&gt; <span class="hljs-title function_">getCategoryStats</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam(required = false)</span> String dateRange)</span> {
        ListResultModel&lt;List&lt;CategoryStatsData&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListResultModel</span>&lt;&gt;();
        
        <span class="hljs-keyword">try</span> {
            Map&lt;String, Integer&gt; categoryStats = componentUIStatsService.getCategoryStats(dateRange);
            
            List&lt;CategoryStatsData&gt; dataList = categoryStats.entrySet().stream()
                    .map(entry -&gt; {
                        <span class="hljs-type">CategoryStatsData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CategoryStatsData</span>();
                        data.setCategory(entry.getKey());
                        data.setCount(entry.getValue());
                        <span class="hljs-keyword">return</span> data;
                    })
                    .collect(Collectors.toList());
            
            result.setData(dataList);
            result.setSuccess(<span class="hljs-literal">true</span>);
            result.setMessage(<span class="hljs-string">"组件分类统计数据获取成功"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            result.setSuccess(<span class="hljs-literal">false</span>);
            result.setMessage(<span class="hljs-string">"获取组件分类统计数据失败: "</span> + e.getMessage());
            e.printStackTrace();
        }
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">// ==================== 钩子API方法 ====================</span>
    
    <span class="hljs-comment">/**
     * 获取视图与URL绑定关系
     */</span>
    <span class="hljs-meta">@GetMapping("viewUrlBindings")</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ResultModel&lt;Map&lt;String, String&gt;&gt; <span class="hljs-title function_">getViewUrlBindings</span><span class="hljs-params">()</span> {
        ResultModel&lt;Map&lt;String, String&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultModel</span>&lt;&gt;();
        Map&lt;String, String&gt; bindings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (ComponentUIStatsViewEnum viewEnum : ComponentUIStatsViewEnum.values()) {
            bindings.put(viewEnum.name(), viewEnum.getUrl());
        }
        
        result.setData(bindings);
        result.setSuccess(<span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * 获取视图间关系
     */</span>
    <span class="hljs-meta">@GetMapping("viewRelations")</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ResultModel&lt;Map&lt;String, List&lt;String&gt;&gt;&gt; <span class="hljs-title function_">getViewRelations</span><span class="hljs-params">()</span> {
        ResultModel&lt;Map&lt;String, List&lt;String&gt;&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultModel</span>&lt;&gt;();
        Map&lt;String, List&lt;String&gt;&gt; relations = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 获取视图间关系并转换格式</span>
        Map&lt;ComponentUIStatsViewEnum, List&lt;ComponentUIStatsViewEnum&gt;&gt; viewRelations = 
                ComponentUIStatsViewEnum.getViewRelations();
        
        <span class="hljs-keyword">for</span> (Map.Entry&lt;ComponentUIStatsViewEnum, List&lt;ComponentUIStatsViewEnum&gt;&gt; entry : viewRelations.entrySet()) {
            List&lt;String&gt; childViews = entry.getValue().stream()
                    .map(ComponentUIStatsViewEnum::name)
                    .collect(Collectors.toList());
            relations.put(entry.getKey().name(), childViews);
        }
        
        result.setData(relations);
        result.setSuccess(<span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * 获取模块结构映射
     */</span>
    <span class="hljs-meta">@GetMapping("moduleStructure")</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ResultModel&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getModuleStructure</span><span class="hljs-params">()</span> {
        ResultModel&lt;Map&lt;String, Object&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultModel</span>&lt;&gt;();
        Map&lt;String, Object&gt; moduleStructure = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 构建模块结构</span>
        Map&lt;String, Map&lt;String, List&lt;Map&lt;String, String&gt;&gt;&gt;&gt; structure = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (ComponentUIStatsViewEnum viewEnum : ComponentUIStatsViewEnum.values()) {
            Map&lt;String, String&gt; viewInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            viewInfo.put(<span class="hljs-string">"name"</span>, viewEnum.getName());
            viewInfo.put(<span class="hljs-string">"url"</span>, viewEnum.getUrl());
            viewInfo.put(<span class="hljs-string">"description"</span>, viewEnum.getDescription());
            viewInfo.put(<span class="hljs-string">"imageClass"</span>, viewEnum.getImageClass());
            
            structure.computeIfAbsent(<span class="hljs-string">"stats"</span>, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;())
                    .computeIfAbsent(<span class="hljs-string">"component"</span>, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;())
                    .add(viewInfo);
        }
        
        moduleStructure.put(<span class="hljs-string">"structure"</span>, structure);
        moduleStructure.put(<span class="hljs-string">"relations"</span>, getViewRelations().getData());
        
        result.setData(moduleStructure);
        result.setSuccess(<span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">/**
     * 获取视图元数据
     */</span>
    <span class="hljs-meta">@GetMapping("viewMetadata")</span>
    <span class="hljs-meta">@ResponseBody</span>
    <span class="hljs-keyword">public</span> ListResultModel&lt;List&lt;Map&lt;String, Object&gt;&gt;&gt; <span class="hljs-title function_">getViewMetadata</span><span class="hljs-params">()</span> {
        ListResultModel&lt;List&lt;Map&lt;String, Object&gt;&gt;&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListResultModel</span>&lt;&gt;();
        List&lt;Map&lt;String, Object&gt;&gt; metadataList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (ComponentUIStatsViewEnum viewEnum : ComponentUIStatsViewEnum.values()) {
            Map&lt;String, Object&gt; metadata = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            metadata.put(<span class="hljs-string">"viewName"</span>, viewEnum.name());
            metadata.put(<span class="hljs-string">"displayName"</span>, viewEnum.getName());
            metadata.put(<span class="hljs-string">"url"</span>, viewEnum.getUrl());
            metadata.put(<span class="hljs-string">"description"</span>, viewEnum.getDescription());
            metadata.put(<span class="hljs-string">"icon"</span>, viewEnum.getImageClass());
            
            <span class="hljs-comment">// 根据视图类型设置元数据</span>
            <span class="hljs-keyword">switch</span> (viewEnum) {
                <span class="hljs-keyword">case</span> TYPE_DISTRIBUTION:
                    metadata.put(<span class="hljs-string">"chartType"</span>, <span class="hljs-string">"pie"</span>);
                    metadata.put(<span class="hljs-string">"dataKeys"</span>, Arrays.asList(<span class="hljs-string">"type"</span>, <span class="hljs-string">"count"</span>));
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> USAGE_TREND:
                    metadata.put(<span class="hljs-string">"chartType"</span>, <span class="hljs-string">"line"</span>);
                    metadata.put(<span class="hljs-string">"dataKeys"</span>, Arrays.asList(<span class="hljs-string">"date"</span>, <span class="hljs-string">"usageCount"</span>, <span class="hljs-string">"uniqueUsers"</span>));
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> USAGE_EFFICIENCY:
                    metadata.put(<span class="hljs-string">"chartType"</span>, <span class="hljs-string">"bar"</span>);
                    metadata.put(<span class="hljs-string">"dataKeys"</span>, Arrays.asList(<span class="hljs-string">"component"</span>, <span class="hljs-string">"usageTime"</span>, <span class="hljs-string">"avgLoadTime"</span>));
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> USAGE_DETAIL:
                    metadata.put(<span class="hljs-string">"viewType"</span>, <span class="hljs-string">"table"</span>);
                    metadata.put(<span class="hljs-string">"pagination"</span>, <span class="hljs-literal">true</span>);
                    metadata.put(<span class="hljs-string">"exportable"</span>, <span class="hljs-literal">true</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> CATEGORY_STATS:
                    metadata.put(<span class="hljs-string">"chartType"</span>, <span class="hljs-string">"groupedBar"</span>);
                    metadata.put(<span class="hljs-string">"dataKeys"</span>, Arrays.asList(<span class="hljs-string">"category"</span>, <span class="hljs-string">"count"</span>, <span class="hljs-string">"usageRate"</span>));
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    metadata.put(<span class="hljs-string">"viewType"</span>, <span class="hljs-string">"dashboard"</span>);
                    metadata.put(<span class="hljs-string">"widgets"</span>, Arrays.asList(<span class="hljs-string">"TYPE_DISTRIBUTION"</span>, <span class="hljs-string">"USAGE_TREND"</span>, <span class="hljs-string">"USAGE_EFFICIENCY"</span>));
            }
            
            metadataList.add(metadata);
        }
        
        result.setData(metadataList);
        result.setSuccess(<span class="hljs-literal">true</span>);
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-comment">// 数据模型类...</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComponentStatsData</span> {
        <span class="hljs-keyword">private</span> String type;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;
        <span class="hljs-keyword">private</span> String description;
        
        <span class="hljs-comment">// Getter和setter方法</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getType</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> type; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setType</span><span class="hljs-params">(String type)</span> { <span class="hljs-built_in">this</span>.type = type; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> count; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCount</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> { <span class="hljs-built_in">this</span>.count = count; }
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDescription</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> description; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDescription</span><span class="hljs-params">(String description)</span> { <span class="hljs-built_in">this</span>.description = description; }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsageTrendData</span> {
        <span class="hljs-keyword">private</span> String date;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> usageCount;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> uniqueUsers;
        
        <span class="hljs-comment">// Getter和setter方法</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDate</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> date; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDate</span><span class="hljs-params">(String date)</span> { <span class="hljs-built_in">this</span>.date = date; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getUsageCount</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> usageCount; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsageCount</span><span class="hljs-params">(<span class="hljs-type">int</span> usageCount)</span> { <span class="hljs-built_in">this</span>.usageCount = usageCount; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getUniqueUsers</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> uniqueUsers; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUniqueUsers</span><span class="hljs-params">(<span class="hljs-type">int</span> uniqueUsers)</span> { <span class="hljs-built_in">this</span>.uniqueUsers = uniqueUsers; }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsageEfficiencyData</span> {
        <span class="hljs-keyword">private</span> String component;
        <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> usageTime;
        <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> avgLoadTime;
        
        <span class="hljs-comment">// Getter和setter方法</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getComponent</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> component; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComponent</span><span class="hljs-params">(String component)</span> { <span class="hljs-built_in">this</span>.component = component; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getUsageTime</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> usageTime; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsageTime</span><span class="hljs-params">(<span class="hljs-type">long</span> usageTime)</span> { <span class="hljs-built_in">this</span>.usageTime = usageTime; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getAvgLoadTime</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> avgLoadTime; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAvgLoadTime</span><span class="hljs-params">(<span class="hljs-type">double</span> avgLoadTime)</span> { <span class="hljs-built_in">this</span>.avgLoadTime = avgLoadTime; }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CategoryStatsData</span> {
        <span class="hljs-keyword">private</span> String category;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;
        
        <span class="hljs-comment">// Getter和setter方法</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCategory</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> category; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCategory</span><span class="hljs-params">(String category)</span> { <span class="hljs-built_in">this</span>.category = category; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> count; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCount</span><span class="hljs-params">(<span class="hljs-type">int</span> count)</span> { <span class="hljs-built_in">this</span>.count = count; }
    }
}
</code></pre>
<h2 data-id="heading-8">3. 原型验证</h2>
<h3 data-id="heading-9">3.1 步骤说明</h3>
<p>第三步是原型验证，用户通过RAD（Rapid Application Development）可视化工具检查基础原型，并进行关键参数的设定修改。</p>
<h3 data-id="heading-10">3.2 实施过程</h3>
<ol>
<li>
<p><strong>RAD工具生成原型</strong>：使用Ooder RAD工具生成组件UI统计模块的基础原型，包括所有视图和API。</p>
</li>
<li>
<p><strong>关键参数设定</strong>：</p>
<ul>
<li>配置图表类型：饼图、折线图、柱状图等</li>
<li>设置数据刷新频率：5分钟</li>
<li>配置权限控制：仅管理员可访问</li>
<li>设定数据显示格式：百分比、数字等</li>
</ul>
</li>
<li>
<p><strong>原型确认</strong>：</p>
<ul>
<li>开发团队与业务人员一起审查原型</li>
<li>根据反馈调整视图布局和功能</li>
<li>确认原型符合需求</li>
</ul>
</li>
</ol>
<h2 data-id="heading-11">4. 仓储层开发</h2>
<h3 data-id="heading-12">4.1 步骤说明</h3>
<p>第四步是仓储层开发，完成原型确认后，撰写仓储层代码，包括service接口和impl实现类。</p>
<h3 data-id="heading-13">4.2 实施过程</h3>
<ol>
<li><strong>Service接口定义</strong>：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> view.stats;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 组件UI统计服务接口
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComponentUIStatsService</span> {
    
    <span class="hljs-comment">/**
     * 获取组件类型分布统计
     * <span class="hljs-doctag">@param</span> dateRange 日期范围（可选）
     * <span class="hljs-doctag">@return</span> 组件类型分布数据
     */</span>
    Map&lt;String, Integer&gt; <span class="hljs-title function_">getTypeDistribution</span><span class="hljs-params">(String dateRange)</span>;
    
    <span class="hljs-comment">/**
     * 获取组件使用趋势统计
     * <span class="hljs-doctag">@param</span> period 统计周期（day/week/month）
     * <span class="hljs-doctag">@param</span> dateRange 日期范围（可选）
     * <span class="hljs-doctag">@return</span> 组件使用趋势数据
     */</span>
    List&lt;ComponentUIStatsController.UsageTrendData&gt; getUsageTrend(String period, String dateRange);
    
    <span class="hljs-comment">/**
     * 获取组件使用效率统计
     * <span class="hljs-doctag">@param</span> dateRange 日期范围（可选）
     * <span class="hljs-doctag">@return</span> 组件使用效率数据
     */</span>
    List&lt;ComponentUIStatsController.UsageEfficiencyData&gt; getUsageEfficiency(String dateRange);
    
    <span class="hljs-comment">/**
     * 获取组件使用详情
     * <span class="hljs-doctag">@param</span> page 页码
     * <span class="hljs-doctag">@param</span> pageSize 每页大小
     * <span class="hljs-doctag">@param</span> filters 过滤条件
     * <span class="hljs-doctag">@return</span> 组件使用详情列表
     */</span>
    Map&lt;String, Object&gt; <span class="hljs-title function_">getUsageDetail</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, Map&lt;String, String&gt; filters)</span>;
    
    <span class="hljs-comment">/**
     * 获取组件分类统计
     * <span class="hljs-doctag">@param</span> dateRange 日期范围（可选）
     * <span class="hljs-doctag">@return</span> 组件分类统计数据
     */</span>
    Map&lt;String, Integer&gt; <span class="hljs-title function_">getCategoryStats</span><span class="hljs-params">(String dateRange)</span>;
    
    <span class="hljs-comment">/**
     * 导出统计数据
     * <span class="hljs-doctag">@param</span> exportType 导出类型（excel/csv）
     * <span class="hljs-doctag">@param</span> dateRange 日期范围
     * <span class="hljs-doctag">@return</span> 导出文件路径
     */</span>
    String <span class="hljs-title function_">exportStatsData</span><span class="hljs-params">(String exportType, String dateRange)</span>;
}
</code></pre>
<ol start="2">
<li><strong>Service实现类</strong>：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> view.stats;

<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.cache.annotation.Cacheable;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">/**
 * 组件UI统计服务实现类
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional(readOnly = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComponentUIStatsServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ComponentUIStatsService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ComponentRepository componentRepository;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ComponentUsageRepository usageRepository;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Cacheable(value = "componentStatsCache", key = "'typeDistribution_' + #dateRange")</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Integer&gt; <span class="hljs-title function_">getTypeDistribution</span><span class="hljs-params">(String dateRange)</span> {
        Map&lt;String, Integer&gt; distribution = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 根据日期范围查询数据</span>
        List&lt;Component&gt; components;
        <span class="hljs-keyword">if</span> (dateRange != <span class="hljs-literal">null</span> &amp;&amp; !dateRange.isEmpty()) {
            <span class="hljs-comment">// 解析日期范围并查询</span>
            String[] dates = dateRange.split(<span class="hljs-string">"-"</span>);
            components = componentRepository.findByCreateTimeBetween(
                    parseDate(dates[<span class="hljs-number">0</span>]), parseDate(dates[<span class="hljs-number">1</span>]));
        } <span class="hljs-keyword">else</span> {
            components = componentRepository.findAll();
        }
        
        <span class="hljs-comment">// 统计组件类型分布</span>
        <span class="hljs-keyword">for</span> (Component component : components) {
            <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> component.getType();
            distribution.put(type, distribution.getOrDefault(type, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);
        }
        
        <span class="hljs-keyword">return</span> distribution;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Cacheable(value = "componentStatsCache", key = "'usageTrend_' + #period + '_' + #dateRange")</span>
    <span class="hljs-keyword">public</span> List&lt;ComponentUIStatsController.UsageTrendData&gt; getUsageTrend(String period, String dateRange) {
        List&lt;ComponentUIStatsController.UsageTrendData&gt; trendData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-comment">// 根据周期和日期范围查询使用记录</span>
        List&lt;ComponentUsage&gt; usages;
        <span class="hljs-keyword">if</span> (dateRange != <span class="hljs-literal">null</span> &amp;&amp; !dateRange.isEmpty()) {
            String[] dates = dateRange.split(<span class="hljs-string">"-"</span>);
            usages = usageRepository.findByUsageTimeBetween(
                    parseDate(dates[<span class="hljs-number">0</span>]), parseDate(dates[<span class="hljs-number">1</span>]));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 默认查询最近30天</span>
            <span class="hljs-type">Calendar</span> <span class="hljs-variable">calendar</span> <span class="hljs-operator">=</span> Calendar.getInstance();
            calendar.add(Calendar.DAY_OF_MONTH, -<span class="hljs-number">30</span>);
            usages = usageRepository.findByUsageTimeAfter(calendar.getTime());
        }
        
        <span class="hljs-comment">// 按周期分组统计</span>
        Map&lt;String, ComponentUIStatsController.UsageTrendData&gt; groupedData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (ComponentUsage usage : usages) {
            String key;
            <span class="hljs-type">Date</span> <span class="hljs-variable">usageTime</span> <span class="hljs-operator">=</span> usage.getUsageTime();
            
            <span class="hljs-comment">// 根据周期生成分组键</span>
            <span class="hljs-keyword">switch</span> (period.toLowerCase()) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"day"</span>:
                    key = formatDate(usageTime, <span class="hljs-string">"yyyy-MM-dd"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"week"</span>:
                    key = formatDate(usageTime, <span class="hljs-string">"yyyy-'W'ww"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"month"</span>:
                    key = formatDate(usageTime, <span class="hljs-string">"yyyy-MM"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    key = formatDate(usageTime, <span class="hljs-string">"yyyy-MM-dd"</span>);
            }
            
            <span class="hljs-comment">// 更新统计数据</span>
            ComponentUIStatsController.<span class="hljs-type">UsageTrendData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> groupedData.getOrDefault(key, 
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentUIStatsController</span>.UsageTrendData());
            data.setDate(key);
            data.setUsageCount(data.getUsageCount() + <span class="hljs-number">1</span>);
            
            <span class="hljs-comment">// 统计独立用户数</span>
            Set&lt;String&gt; users = usage.getUsers();
            data.setUniqueUsers(users != <span class="hljs-literal">null</span> ? users.size() : <span class="hljs-number">1</span>);
            
            groupedData.put(key, data);
        }
        
        <span class="hljs-comment">// 转换为列表并排序</span>
        trendData.addAll(groupedData.values());
        trendData.sort(Comparator.comparing(ComponentUIStatsController.UsageTrendData::getDate));
        
        <span class="hljs-keyword">return</span> trendData;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Cacheable(value = "componentStatsCache", key = "'usageEfficiency_' + #dateRange")</span>
    <span class="hljs-keyword">public</span> List&lt;ComponentUIStatsController.UsageEfficiencyData&gt; getUsageEfficiency(String dateRange) {
        List&lt;ComponentUIStatsController.UsageEfficiencyData&gt; efficiencyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-comment">// 查询组件及其使用效率数据</span>
        List&lt;Component&gt; components = componentRepository.findAllWithEfficiencyData(dateRange);
        
        <span class="hljs-keyword">for</span> (Component component : components) {
            ComponentUIStatsController.<span class="hljs-type">UsageEfficiencyData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> 
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentUIStatsController</span>.UsageEfficiencyData();
            
            data.setComponent(component.getName());
            data.setUsageTime(component.getTotalUsageTime());
            data.setAvgLoadTime(component.getAverageLoadTime());
            
            efficiencyData.add(data);
        }
        
        <span class="hljs-comment">// 按使用时间降序排序</span>
        efficiencyData.sort((d1, d2) -&gt; Long.compare(d2.getUsageTime(), d1.getUsageTime()));
        
        <span class="hljs-keyword">return</span> efficiencyData;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getUsageDetail</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> pageSize, Map&lt;String, String&gt; filters)</span> {
        Map&lt;String, Object&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 构建查询条件</span>
        List&lt;ComponentUsage&gt; usages;
        <span class="hljs-keyword">if</span> (filters != <span class="hljs-literal">null</span> &amp;&amp; !filters.isEmpty()) {
            <span class="hljs-comment">// 根据过滤条件查询</span>
            usages = usageRepository.findByFilters(filters);
        } <span class="hljs-keyword">else</span> {
            usages = usageRepository.findAll();
        }
        
        <span class="hljs-comment">// 分页处理</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> usages.size();
        <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> (page - <span class="hljs-number">1</span>) * pageSize;
        <span class="hljs-type">int</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> Math.min(start + pageSize, total);
        
        List&lt;ComponentUsage&gt; paginatedUsages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">if</span> (start &lt; total) {
            paginatedUsages = usages.subList(start, end);
        }
        
        <span class="hljs-comment">// 转换为详情数据</span>
        List&lt;Map&lt;String, Object&gt;&gt; detailList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (ComponentUsage usage : paginatedUsages) {
            Map&lt;String, Object&gt; detail = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            detail.put(<span class="hljs-string">"id"</span>, usage.getId());
            detail.put(<span class="hljs-string">"componentName"</span>, usage.getComponent().getName());
            detail.put(<span class="hljs-string">"componentType"</span>, usage.getComponent().getType());
            detail.put(<span class="hljs-string">"usageTime"</span>, formatDate(usage.getUsageTime(), <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>));
            detail.put(<span class="hljs-string">"userCount"</span>, usage.getUsers() != <span class="hljs-literal">null</span> ? usage.getUsers().size() : <span class="hljs-number">0</span>);
            detail.put(<span class="hljs-string">"pageUrl"</span>, usage.getPageUrl());
            detail.put(<span class="hljs-string">"loadTime"</span>, usage.getLoadTime() + <span class="hljs-string">"ms"</span>);
            
            detailList.add(detail);
        }
        
        <span class="hljs-comment">// 构建返回结果</span>
        result.put(<span class="hljs-string">"data"</span>, detailList);
        result.put(<span class="hljs-string">"total"</span>, total);
        result.put(<span class="hljs-string">"page"</span>, page);
        result.put(<span class="hljs-string">"pageSize"</span>, pageSize);
        result.put(<span class="hljs-string">"totalPages"</span>, (total + pageSize - <span class="hljs-number">1</span>) / pageSize);
        
        <span class="hljs-keyword">return</span> result;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@Cacheable(value = "componentStatsCache", key = "'categoryStats_' + #dateRange")</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Integer&gt; <span class="hljs-title function_">getCategoryStats</span><span class="hljs-params">(String dateRange)</span> {
        Map&lt;String, Integer&gt; categoryStats = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 查询组件分类数据</span>
        List&lt;Object[]&gt; categoryData;
        <span class="hljs-keyword">if</span> (dateRange != <span class="hljs-literal">null</span> &amp;&amp; !dateRange.isEmpty()) {
            String[] dates = dateRange.split(<span class="hljs-string">"-"</span>);
            categoryData = componentRepository.countByCategoryAndCreateTimeBetween(
                    parseDate(dates[<span class="hljs-number">0</span>]), parseDate(dates[<span class="hljs-number">1</span>]));
        } <span class="hljs-keyword">else</span> {
            categoryData = componentRepository.countByCategory();
        }
        
        <span class="hljs-comment">// 处理分类统计数据</span>
        <span class="hljs-keyword">for</span> (Object[] row : categoryData) {
            <span class="hljs-type">String</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
            <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> (Long) row[<span class="hljs-number">1</span>];
            categoryStats.put(category, count.intValue());
        }
        
        <span class="hljs-keyword">return</span> categoryStats;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">exportStatsData</span><span class="hljs-params">(String exportType, String dateRange)</span> {
        <span class="hljs-comment">// 实现数据导出逻辑</span>
        <span class="hljs-comment">// 这里简化处理，实际项目中需要生成Excel或CSV文件</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> <span class="hljs-string">"component_stats_"</span> + System.currentTimeMillis();
        
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"excel"</span>.equalsIgnoreCase(exportType)) {
            fileName += <span class="hljs-string">".xlsx"</span>;
            <span class="hljs-comment">// 生成Excel文件</span>
        } <span class="hljs-keyword">else</span> {
            fileName += <span class="hljs-string">".csv"</span>;
            <span class="hljs-comment">// 生成CSV文件</span>
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"/exports/"</span> + fileName;
    }
    
    <span class="hljs-comment">// 辅助方法</span>
    <span class="hljs-keyword">private</span> Date <span class="hljs-title function_">parseDate</span><span class="hljs-params">(String dateStr)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.text.SimpleDateFormat(<span class="hljs-string">"yyyy-MM-dd"</span>).parse(dateStr);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
        }
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatDate</span><span class="hljs-params">(Date date, String pattern)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.text.SimpleDateFormat(pattern).format(date);
    }
}
</code></pre>
<h2 data-id="heading-14">5. 层间整合</h2>
<h3 data-id="heading-15">5.1 步骤说明</h3>
<p>第五步是层间整合，完成视图层、聚合层、仓储层的整合绑定。</p>
<h3 data-id="heading-16">5.2 实施过程</h3>
<ol>
<li>
<p><strong>视图层与服务层整合</strong>：
已在控制器中通过@Autowired注入服务层并调用其方法</p>
</li>
<li>
<p><strong>聚合层开发</strong>：</p>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> view.stats;

<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-comment">/**
 * 组件UI统计聚合层服务
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComponentUIStatsAggregationService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ComponentUIStatsService componentUIStatsService;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);
    
    <span class="hljs-comment">/**
     * 获取综合统计数据
     * <span class="hljs-doctag">@param</span> dateRange 日期范围
     * <span class="hljs-doctag">@return</span> 综合统计数据
     */</span>
    <span class="hljs-keyword">public</span> StatsAggregationData <span class="hljs-title function_">getStatsAggregation</span><span class="hljs-params">(String dateRange)</span> {
        <span class="hljs-type">StatsAggregationData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StatsAggregationData</span>();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 并行获取各维度统计数据</span>
            CompletableFuture&lt;Map&lt;String, Integer&gt;&gt; typeDistributionFuture = 
                    CompletableFuture.supplyAsync(() -&gt; 
                            componentUIStatsService.getTypeDistribution(dateRange), executor);
            
            CompletableFuture&lt;List&lt;ComponentUIStatsController.UsageTrendData&gt;&gt; usageTrendFuture = 
                    CompletableFuture.supplyAsync(() -&gt; 
                            componentUIStatsService.getUsageTrend(<span class="hljs-string">"day"</span>, dateRange), executor);
            
            CompletableFuture&lt;List&lt;ComponentUIStatsController.UsageEfficiencyData&gt;&gt; usageEfficiencyFuture = 
                    CompletableFuture.supplyAsync(() -&gt; 
                            componentUIStatsService.getUsageEfficiency(dateRange), executor);
            
            CompletableFuture&lt;Map&lt;String, Integer&gt;&gt; categoryStatsFuture = 
                    CompletableFuture.supplyAsync(() -&gt; 
                            componentUIStatsService.getCategoryStats(dateRange), executor);
            
            <span class="hljs-comment">// 等待所有异步任务完成</span>
            CompletableFuture.allOf(
                    typeDistributionFuture,
                    usageTrendFuture,
                    usageEfficiencyFuture,
                    categoryStatsFuture
            ).join();
            
            <span class="hljs-comment">// 设置聚合数据</span>
            data.setTypeDistribution(typeDistributionFuture.get());
            data.setUsageTrend(usageTrendFuture.get());
            data.setUsageEfficiency(usageEfficiencyFuture.get());
            data.setCategoryStats(categoryStatsFuture.get());
            
            <span class="hljs-comment">// 计算汇总信息</span>
            data.setTotalComponents(
                    data.getTypeDistribution().values().stream().mapToInt(Integer::intValue).sum());
            
            data.setMostUsedComponent(
                    data.getTypeDistribution().entrySet().stream()
                            .max(Map.Entry.comparingByValue())
                            .map(Map.Entry::getKey)
                            .orElse(<span class="hljs-string">"Unknown"</span>));
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 异常处理</span>
            e.printStackTrace();
            data.setError(<span class="hljs-string">"获取统计数据失败: "</span> + e.getMessage());
        }
        
        <span class="hljs-keyword">return</span> data;
    }
    
    <span class="hljs-comment">/**
     * 获取实时监控数据
     * <span class="hljs-doctag">@return</span> 实时监控数据
     */</span>
    <span class="hljs-keyword">public</span> RealTimeMonitoringData <span class="hljs-title function_">getRealTimeMonitoring</span><span class="hljs-params">()</span> {
        <span class="hljs-type">RealTimeMonitoringData</span> <span class="hljs-variable">monitoringData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RealTimeMonitoringData</span>();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取实时使用统计</span>
            monitoringData.setCurrentUsers(componentUIStatsService.getCurrentUserCount());
            monitoringData.setActiveComponents(componentUIStatsService.getActiveComponentCount());
            monitoringData.setSystemLoad(componentUIStatsService.getSystemLoadAverage());
            
            <span class="hljs-comment">// 获取最近使用记录</span>
            monitoringData.setRecentActivities(componentUIStatsService.getRecentActivities(<span class="hljs-number">10</span>));
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
            monitoringData.setError(<span class="hljs-string">"获取实时监控数据失败: "</span> + e.getMessage());
        }
        
        <span class="hljs-keyword">return</span> monitoringData;
    }
    
    <span class="hljs-comment">/**
     * 综合统计数据模型
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StatsAggregationData</span> {
        <span class="hljs-keyword">private</span> Map&lt;String, Integer&gt; typeDistribution;
        <span class="hljs-keyword">private</span> List&lt;ComponentUIStatsController.UsageTrendData&gt; usageTrend;
        <span class="hljs-keyword">private</span> List&lt;ComponentUIStatsController.UsageEfficiencyData&gt; usageEfficiency;
        <span class="hljs-keyword">private</span> Map&lt;String, Integer&gt; categoryStats;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> totalComponents;
        <span class="hljs-keyword">private</span> String mostUsedComponent;
        <span class="hljs-keyword">private</span> String error;
        
        <span class="hljs-comment">// Getter和setter方法</span>
        <span class="hljs-keyword">public</span> Map&lt;String, Integer&gt; <span class="hljs-title function_">getTypeDistribution</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> typeDistribution; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTypeDistribution</span><span class="hljs-params">(Map&lt;String, Integer&gt; typeDistribution)</span> { <span class="hljs-built_in">this</span>.typeDistribution = typeDistribution; }
        <span class="hljs-keyword">public</span> List&lt;ComponentUIStatsController.UsageTrendData&gt; getUsageTrend() { <span class="hljs-keyword">return</span> usageTrend; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsageTrend</span><span class="hljs-params">(List&lt;ComponentUIStatsController.UsageTrendData&gt; usageTrend)</span> { <span class="hljs-built_in">this</span>.usageTrend = usageTrend; }
        <span class="hljs-keyword">public</span> List&lt;ComponentUIStatsController.UsageEfficiencyData&gt; getUsageEfficiency() { <span class="hljs-keyword">return</span> usageEfficiency; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUsageEfficiency</span><span class="hljs-params">(List&lt;ComponentUIStatsController.UsageEfficiencyData&gt; usageEfficiency)</span> { <span class="hljs-built_in">this</span>.usageEfficiency = usageEfficiency; }
        <span class="hljs-keyword">public</span> Map&lt;String, Integer&gt; <span class="hljs-title function_">getCategoryStats</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> categoryStats; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCategoryStats</span><span class="hljs-params">(Map&lt;String, Integer&gt; categoryStats)</span> { <span class="hljs-built_in">this</span>.categoryStats = categoryStats; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getTotalComponents</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> totalComponents; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTotalComponents</span><span class="hljs-params">(<span class="hljs-type">int</span> totalComponents)</span> { <span class="hljs-built_in">this</span>.totalComponents = totalComponents; }
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMostUsedComponent</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> mostUsedComponent; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMostUsedComponent</span><span class="hljs-params">(String mostUsedComponent)</span> { <span class="hljs-built_in">this</span>.mostUsedComponent = mostUsedComponent; }
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getError</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> error; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setError</span><span class="hljs-params">(String error)</span> { <span class="hljs-built_in">this</span>.error = error; }
    }
    
    <span class="hljs-comment">/**
     * 实时监控数据模型
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RealTimeMonitoringData</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> currentUsers;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> activeComponents;
        <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> systemLoad;
        <span class="hljs-keyword">private</span> List&lt;Map&lt;String, Object&gt;&gt; recentActivities;
        <span class="hljs-keyword">private</span> String error;
        
        <span class="hljs-comment">// Getter和setter方法</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCurrentUsers</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> currentUsers; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCurrentUsers</span><span class="hljs-params">(<span class="hljs-type">int</span> currentUsers)</span> { <span class="hljs-built_in">this</span>.currentUsers = currentUsers; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getActiveComponents</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> activeComponents; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setActiveComponents</span><span class="hljs-params">(<span class="hljs-type">int</span> activeComponents)</span> { <span class="hljs-built_in">this</span>.activeComponents = activeComponents; }
        <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getSystemLoad</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> systemLoad; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSystemLoad</span><span class="hljs-params">(<span class="hljs-type">double</span> systemLoad)</span> { <span class="hljs-built_in">this</span>.systemLoad = systemLoad; }
        <span class="hljs-keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getRecentActivities</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> recentActivities; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRecentActivities</span><span class="hljs-params">(List&lt;Map&lt;String, Object&gt;&gt; recentActivities)</span> { <span class="hljs-built_in">this</span>.recentActivities = recentActivities; }
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getError</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> error; }
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setError</span><span class="hljs-params">(String error)</span> { <span class="hljs-built_in">this</span>.error = error; }
    }
}
</code></pre>
<h2 data-id="heading-17">6. 功能调试</h2>
<h3 data-id="heading-18">6.1 步骤说明</h3>
<p>第六步是功能调试，用户通过RAD进行页面及功能调试。</p>
<h3 data-id="heading-19">6.2 实施过程</h3>
<ol>
<li>
<p><strong>调试环境准备</strong>：</p>
<ul>
<li>启动开发服务器</li>
<li>配置数据源连接</li>
<li>初始化测试数据</li>
</ul>
</li>
<li>
<p><strong>页面调试</strong>：</p>
<ul>
<li>使用RAD工具调试各个视图的渲染效果</li>
<li>调整视图布局和样式</li>
<li>测试响应式设计</li>
</ul>
</li>
<li>
<p><strong>功能调试</strong>：</p>
<ul>
<li>测试数据获取和展示</li>
<li>验证图表渲染正确性</li>
<li>测试数据刷新功能</li>
<li>调试权限控制</li>
</ul>
</li>
<li>
<p><strong>性能调试</strong>：</p>
<ul>
<li>测试页面加载速度</li>
<li>优化数据查询性能</li>
<li>调整缓存策略</li>
</ul>
</li>
</ol>
<h2 data-id="heading-20">7. 聚合层优化</h2>
<h3 data-id="heading-21">7.1 步骤说明</h3>
<p>第七步是聚合层优化，根据用户需求针对聚合层做进一步的完善及优化。</p>
<h3 data-id="heading-22">7.2 实施过程</h3>
<ol>
<li>
<p><strong>性能优化</strong>：</p>
<ul>
<li>添加缓存机制：使用本地缓存存储频繁访问的数据</li>
<li>优化并行处理：调整线程池大小，提高并发处理能力</li>
<li>减少数据库查询：合并查询，减少数据库访问次数</li>
</ul>
</li>
<li>
<p><strong>功能完善</strong>：</p>
<ul>
<li>添加数据导出功能：支持Excel、CSV格式</li>
<li>增加数据过滤条件：按时间、类型、状态等过滤</li>
<li>添加数据预警功能：当组件使用率超过阈值时发送告警</li>
</ul>
</li>
<li>
<p><strong>代码优化</strong>：</p>
<ul>
<li>重构代码结构：提高代码可读性和可维护性</li>
<li>添加日志记录：便于问题定位和性能监控</li>
<li>完善异常处理：提高系统稳定性</li>
</ul>
</li>
</ol>
<h2 data-id="heading-23">8. 代码发布</h2>
<h3 data-id="heading-24">8.1 步骤说明</h3>
<p>第八步是代码发布，辅助用户完成代码发布。</p>
<h3 data-id="heading-25">8.2 实施过程</h3>
<ol>
<li>
<p><strong>代码审查</strong>：</p>
<ul>
<li>进行代码静态分析</li>
<li>检查代码质量指标</li>
<li>确保代码符合公司规范</li>
</ul>
</li>
<li>
<p><strong>构建项目</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">mvn clean package
</code></pre>
</li>
<li>
<p><strong>部署项目</strong>：</p>
<ul>
<li>将构建好的包部署到测试环境</li>
<li>进行集成测试</li>
<li>验证功能正常</li>
<li>部署到生产环境</li>
</ul>
</li>
<li>
<p><strong>发布文档</strong>：</p>
<ul>
<li>编写发布说明</li>
<li>更新系统文档</li>
<li>培训使用人员</li>
</ul>
</li>
</ol>
<h2 data-id="heading-26">实施效果</h2>
<p>通过Ooder框架的8步编码流程，成功开发了DSM组件UI统计模块，实现了以下效果：</p>
<ol>
<li><strong>高效开发</strong>：遵循规范的编码流程，提高了开发效率，减少了开发过程中的错误</li>
<li><strong>规范统一</strong>：所有代码遵循统一的规范，便于维护和扩展</li>
<li><strong>快速迭代</strong>：通过原型验证和功能调试，实现了快速迭代开发</li>
<li><strong>高质量代码</strong>：通过代码审查和测试，确保了代码质量</li>
<li><strong>良好的用户体验</strong>：通过RAD工具生成的原型，确保了系统符合用户需求</li>
</ol>
<h2 data-id="heading-27">最佳实践</h2>
<ol>
<li>
<p><strong>视图设计</strong>：</p>
<ul>
<li>每个视图只负责一个功能</li>
<li>设计可复用的视图组件</li>
<li>保持视图风格的一致性</li>
</ul>
</li>
<li>
<p><strong>API设计</strong>：</p>
<ul>
<li>采用RESTful风格设计API</li>
<li>API名称应清晰表达其功能</li>
<li>提供友好的错误信息</li>
</ul>
</li>
<li>
<p><strong>代码生成</strong>：</p>
<ul>
<li>使用模板驱动的代码生成</li>
<li>支持增量代码生成</li>
<li>智能合并手动修改和自动生成的代码</li>
</ul>
</li>
<li>
<p><strong>调试与测试</strong>：</p>
<ul>
<li>为核心功能编写单元测试</li>
<li>测试模块间的集成</li>
<li>使用自动化测试框架</li>
</ul>
</li>
</ol>
<h2 data-id="heading-28">总结</h2>
<p>Ooder框架的8步编码流程为DSM组件UI统计模块的开发提供了清晰的指导，确保了开发过程的规范性和高效性。通过严格遵循这8个步骤，我们成功开发了一个高质量的组件UI统计模块，实现了组件使用情况的统计和分析功能。</p>
<p>在未来的开发中，我们将继续完善这个模块，添加更多的统计维度和分析功能，为系统的优化和改进提供数据支持。同时，我们也将继续探索Ooder框架的更多特性，提高开发效率和代码质量。</p>
<hr/>
<p><strong>作者</strong>：Ooder开发团队<br/>
<strong>发布日期</strong>：2025-12-30<br/>
<strong>相关文档</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=dsm%255Cooder_8%25E6%25AD%25A5%25E7%25BC%2596%25E7%25A0%2581%25E6%25B5%2581%25E7%25A8%258B%25E5%25AE%259E%25E6%2588%2598%25E6%258C%2587%25E5%258D%2597_%25E4%25BF%25AE%25E6%25AD%25A3%25E7%2589%2588.md" target="_blank" title="dsm%5Cooder_8%E6%AD%A5%E7%BC%96%E7%A0%81%E6%B5%81%E7%A8%8B%E5%AE%9E%E6%88%98%E6%8C%87%E5%8D%97_%E4%BF%AE%E6%AD%A3%E7%89%88.md" ref="nofollow noopener noreferrer">Ooder框架8步编码流程实战指南</a></li>
<li><a href="https://link.juejin.cn?target=dsm%255Cooder%25E8%25A7%2584%25E8%258C%2583%25E6%2589%25A7%25E8%25A1%258C%25E8%25AE%25A1%25E5%2588%2592.md" target="_blank" title="dsm%5Cooder%E8%A7%84%E8%8C%83%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92.md" ref="nofollow noopener noreferrer">Ooder规范执行计划</a></li>
<li><a href="https://link.juejin.cn?target=%255Cdsm%255C%25E9%2599%2584%25E4%25BB%25B61%25EF%25BC%259A%25E8%25A7%2586%25E5%259B%25BE%25E5%2585%2583%25E6%2595%25B0%25E6%258D%25AE%25E6%259E%259A%25E4%25B8%25BE%25E6%25A8%25A1%25E6%259D%25BF.md" target="_blank" title="%5Cdsm%5C%E9%99%84%E4%BB%B61%EF%BC%9A%E8%A7%86%E5%9B%BE%E5%85%83%E6%95%B0%E6%8D%AE%E6%9E%9A%E4%B8%BE%E6%A8%A1%E6%9D%BF.md" ref="nofollow noopener noreferrer">附件1：视图元数据枚举模板</a></li>
<li><a href="https://link.juejin.cn?target=%255Cdsm%255C%25E9%2599%2584%25E4%25BB%25B62%25EF%25BC%259A%25E9%2592%25A9%25E5%25AD%2590API%25E6%2596%25B9%25E6%25B3%2595%25E6%25A8%25A1%25E6%259D%25BF.md" target="_blank" title="%5Cdsm%5C%E9%99%84%E4%BB%B62%EF%BC%9A%E9%92%A9%E5%AD%90API%E6%96%B9%E6%B3%95%E6%A8%A1%E6%9D%BF.md" ref="nofollow noopener noreferrer">附件2：钩子API方法模板</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多个 GitHub 账户SSH 密钥配置全攻略]]></title>    <link>https://juejin.cn/post/7589482741759344667</link>    <guid>https://juejin.cn/post/7589482741759344667</guid>    <pubDate>2025-12-30T15:35:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589482741759344667" data-draft-id="7589530529452539913" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多个 GitHub 账户SSH 密钥配置全攻略"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T15:35:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多个 GitHub 账户SSH 密钥配置全攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T15:35:16.000Z" title="Tue Dec 30 2025 15:35:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在工作和个人项目中，我们经常需要使用多个 GitHub 账户。如果不进行合理配置，Git 操作（如 <code>git push</code>、<code>git pull</code>）总是使用默认账户，容易出错。本文记录了我在 Windows 上删除旧账户、生成新的 SSH 密钥，并实现多个 GitHub 用户共存的整个流程。</p>
<h2 data-id="heading-0">一、删除原有用户并重新连接</h2>
<p>当需要完全切换 GitHub 账户时，我先删除旧的 SSH 配置，然后为新账户生成新的 RSA 密钥。操作步骤如下：</p>
<h3 data-id="heading-1">1. 生成新的 RSA 密钥</h3>
<p>在命令行中执行：</p>
<pre><code class="hljs language-bash" lang="bash">ssh-keygen -t rsa -b 4096 -C <span class="hljs-string">"my_email@example.com"</span>
</code></pre>
<ul>
<li><code>-t rsa</code> 表示使用 RSA 算法。</li>
<li><code>-b 4096</code> 表示生成 4096 位的密钥，更安全。</li>
<li><code>-C</code> 用于添加注释，这里填写邮箱。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4578d156ece240e8a4db9af5ac728228~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713715&amp;x-signature=qZwu7AYWVoYgeC94pKHc%2Ba%2BN41I%3D" alt="" loading="lazy"/></p>
<p>如果希望覆盖旧密钥，直接将文件名选择为默认 <code>id_rsa</code>；如果想保留旧密钥，可以另取名字，如 <code>id_rsa_new_user</code>。</p>
<h3 data-id="heading-2">2. 添加公钥到 GitHub</h3>
<p>生成密钥后，我将公钥复制到 GitHub：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> ~/.ssh/id_rsa_new_user.pub
</code></pre>
<p>复制从 <code>ssh-rsa</code> 开头到邮箱结尾的全部内容，然后在新 GitHub 账户中：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7909e44e56c4283aa1f43bf480adc28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713715&amp;x-signature=AmEMaEBWtaby0eLGhtAiQbUqa1c%3D" alt="" loading="lazy"/></p>
<ol>
<li>进入 <strong>Settings → SSH and GPG keys</strong>。</li>
<li>点击 <strong>New SSH key</strong>。</li>
<li>填写 Title（例如 “My Windows Laptop - New Account”）。</li>
<li>粘贴公钥到 <strong>Key</strong> 区域。</li>
<li>点击 <strong>Add SSH key</strong>。</li>
</ol>
<h3 data-id="heading-3">3. 测试连接</h3>
<p>执行：</p>
<pre><code class="hljs language-bash" lang="bash">ssh -T git@github.com
</code></pre>
<p>如果输出：</p>
<pre><code class="hljs language-plain" lang="plain">Hi Username! You've successfully authenticated, but GitHub does not provide shell access.
</code></pre>
<p>说明成功连接。</p>
<blockquote>
<p>注意：SSH 会按默认顺序尝试密钥：<br/>
<code>~/.ssh/id_rsa → ~/.ssh/id_ed25519 → 其他 key</code><br/>
如果没有指定 key 或 ssh-agent 使用旧 key，Git 会一直使用旧账户。</p>
</blockquote>
<h2 data-id="heading-4">二、多个用户共存</h2>
<p>为了同时保留多个 GitHub 账户，我为新账户生成了独立的 SSH 密钥，并通过 SSH 配置区分不同账户。</p>
<h3 data-id="heading-5">1. 为新账户生成独立 SSH 密钥</h3>
<p>文件名不能覆盖旧密钥：</p>
<pre><code class="hljs language-bash" lang="bash">ssh-keygen -t rsa -b 4096 -C <span class="hljs-string">"new_email@example.com"</span> -f ~/.ssh/id_rsa_new_user
</code></pre>
<p>此时 <code>~/.ssh/</code> 目录下有：</p>
<ul>
<li>原密钥：<code>id_rsa</code> &amp; <code>id_rsa.pub</code></li>
<li>新密钥：<code>id_rsa_new_user</code> &amp; <code>id_rsa_new_user.pub</code></li>
</ul>
<p>然后将新公钥添加到新 GitHub 账户。</p>
<h3 data-id="heading-6">2. 配置 SSH 客户端</h3>
<p>找到<code>~/.ssh/config</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2899d4c56b34fe985b2a7a226e5caac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713715&amp;x-signature=NBZkDKIwQTsM1iTVCXkJhW09oWs%3D" alt="" loading="lazy"/></p>
<p>在 <code>~/.ssh/config</code>（Windows 上在 <code>C:\Users\MyUsername\.ssh\config</code>）中添加：</p>
<pre><code class="hljs language-latex" lang="latex"># 原始用户（默认用户）
Host github.com
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_rsa

# 新用户（用于克隆私有项目）
Host github.com-newuser
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_rsa_new_user
</code></pre>
<ul>
<li><code>Host github.com-newuser</code> 是新账户别名。</li>
<li><code>IdentityFile</code> 指定对应账户的私钥。</li>
</ul>
<h3 data-id="heading-7">3. 使用新账户克隆仓库</h3>
<p>当克隆新账户的私有仓库时，我使用别名：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git@github.com-newuser:NewUserOrg/private-repo.git
</code></pre>
<p>克隆地址中的 <code>github.com</code> 替换为配置文件中定义的别名 <code>github.com-newuser</code>。push 和 pull 也会使用对应密钥。</p>
<p>📚推荐阅读</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1934984935325823063" target="_blank" title="https://zhuanlan.zhihu.com/p/1934984935325823063" ref="nofollow noopener noreferrer">Git安装教程及常用命令！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1933315484847170971" target="_blank" title="https://zhuanlan.zhihu.com/p/1933315484847170971" ref="nofollow noopener noreferrer">Cursor使用教程!</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1964796166383331241" target="_blank" title="https://zhuanlan.zhihu.com/p/1964796166383331241" ref="nofollow noopener noreferrer">TensorBoard最全使用教程！</a></p>
<p>关于深度学习和大模型相关的知识和前沿技术更新，请关注公众号aicoting！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[仅需1GB内存！腾讯混元MT1.5开源，让手机翻译彻底告别云端依赖]]></title>    <link>https://juejin.cn/post/7589539335004241963</link>    <guid>https://juejin.cn/post/7589539335004241963</guid>    <pubDate>2025-12-30T15:34:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589539335004241963" data-draft-id="7589481566423433270" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="仅需1GB内存！腾讯混元MT1.5开源，让手机翻译彻底告别云端依赖"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-30T15:34:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            仅需1GB内存！腾讯混元MT1.5开源，让手机翻译彻底告别云端依赖
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T15:34:20.000Z" title="Tue Dec 30 2025 15:34:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年的年底，AI圈迎来了一场意料之外的“技术普惠”。就在12月30日，大家还在盘点年度大模型的时候，腾讯默默扔出了一张王炸——混元翻译模型Tencent-HY-MT1.5系列正式开源。</p>
<p>这不仅仅是又一个开源模型那么简单。这次发布的重点不在于“大”，而在于“巧”。在长期由云端巨头把持的高质量翻译领域，腾讯这次似乎想告诉所有人：最顶级的翻译体验，其实可以塞进你的手机里。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasfsdk-1024x607.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asfsdk-1024x607.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/916e5840d57f4239a15552556cf1a282~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713660&amp;x-signature=QJ7oMjS2QOuUgjk4tNqTdAnpaBo%3D" alt="asfsdk" loading="lazy"/></a></p>
<p><strong>告别“傻大黑粗”，小模型也有大智慧</strong></p>
<p>这次开源之所以引起开发者社区的骚动，核心在于那个名为<strong>Tencent-HY-MT1.5-1.8B</strong>的小家伙。</p>
<p>在以往的认知里，翻译模型想要准，参数量就得堆上去。但这个1.8B的模型打破了这个定律。它经过量化后，内存占用仅需约1GB。这是什么概念？这意味着哪怕是几年前的老款安卓机，或者是算力有限的边缘设备，都能毫无压力地跑起来。</p>
<p>更夸张的是它的速度。在处理50个词元时，它的平均响应时间只有0.18秒。作为对比，市面上主流的商用翻译API通常在0.4秒左右。这不是快了一点点，这是倍杀。对于做实时字幕、同声传译硬件的开发者来说，这种低延迟简直是梦寐以求的。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasfsdklgkfl-1024x737.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asfsdklgkfl-1024x737.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dd26890455f435bb95ba1ff60913089~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713660&amp;x-signature=UbGXUNH51YzGXdVez8S6zmtvGHE%3D" alt="asfsdklgkfl" loading="lazy"/></a></p>
<p>如果你担心“小马拉大车”跑不动，那就多虑了。得益于一种叫“On-Policy Distillation”（策略蒸馏）的技术，这个1.8B的“学生”是在7B“老师”的手把手教导下训练出来的。在Flores200等权威测试集上，它的表现甚至硬刚了谷歌的Gemini-3.0-Pro，达到了后者90分位的水平。</p>
<p><strong>全能选手：从云端到指尖的降维打击</strong></p>
<p>当然，如果你手里有充裕的算力资源，追求极致的翻译信达雅，系列中的老大哥<strong>Tencent-HY-MT1.5-7B</strong>则是更好的选择。</p>
<p>这个7B模型并非凭空出世，它是WMT25比赛中拿下30个语种冠军的模型的直系升级版。你可以把它理解为一位严谨的语言学家，专门解决那些让人头疼的“译文夹带私货”、注释混乱以及语种混杂的问题。</p>
<p>更有意思的是，这两个模型不是孤立的。在实际应用架构中，腾讯给出的思路是“协同作战”：端侧用1.8B做毫秒级实时响应，云端用7B做深度润色。这种组合拳，直接平衡了成本、速度和质量这三个“不可能三角”。</p>
<p><strong>懂行话，也懂方言</strong></p>
<p>在语种支持上，混元MT1.5系列没有止步于中英日韩等“大路货”。它一口气支持了33个语种的互译，甚至还专门照顾了捷克语、冰岛语这些小众领域。</p>
<p>特别值得一提的是，它对中文语境的深度理解。除了常规语言，它还覆盖了粤语、藏语、维吾尔语等5种民汉语言和方言。对于国内的跨境电商、出海应用或者民族地区的数字化建设，这无疑是个巨大的利好。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Ffdsfsfgdh-1024x764.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/fdsfsfgdh-1024x764.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f7551b1d2f04d468e537fdcc3544688~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713660&amp;x-signature=XUVyewydGJSos%2Bjbt1M9XEwS5SI%3D" alt="fdsfsfgdh" loading="lazy"/></a></p>
<p>此外，这个模型非常“懂事”。做过文档翻译的人都知道，最怕翻译完格式乱了。混元MT1.5特别强化了格式保留能力，无论是网页HTML代码还是Markdown文档，翻译后排版依然稳如老狗。同时，它还支持自定义术语库，这对于医疗、法律、金融这些容不得半点歧义的行业来说，是刚需中的刚需。</p>
<p><strong>写在最后</strong></p>
<p>目前，该系列模型已经登录GitHub和HuggingFace，并且原生适配了Arm、高通、Intel等主流硬件平台。</p>
<p>腾讯这一波操作，实际上是把企业级的翻译能力下放到了消费级设备。当一个只要1GB内存的模型就能跑出媲美商用API的效果时，我们有理由相信，未来的翻译工具将不再依赖网络信号，而是真正成为设备本身的一部分。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fsdagdfgfd-1024x524.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/sdagdfgfd-1024x524.webp" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87fc8750adac4c57b2e18b637dd20ca1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713660&amp;x-signature=%2FDURQqABQvaFE%2FgIdD3nBGw%2B01E%3D" alt="sdagdfgfd" loading="lazy"/></a></p>
<p>对于开发者而言，现在的门槛已经降到了地板上。无论你是想给APP加个实时翻译功能，还是想折腾一个离线翻译硬件，Tencent-HY-MT1.5都是目前最值得尝试的开源基座之一。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windows命令行代码自动补全详细步骤]]></title>    <link>https://juejin.cn/post/7589509638355255323</link>    <guid>https://juejin.cn/post/7589509638355255323</guid>    <pubDate>2025-12-30T15:36:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589509638355255323" data-draft-id="7589530529452556297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windows命令行代码自动补全详细步骤"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T15:36:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windows命令行代码自动补全详细步骤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T15:36:24.000Z" title="Tue Dec 30 2025 15:36:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Linux 或 macOS 上，很多开发者喜欢使用 <strong>zsh + oh-my-zsh</strong> 来获得强大的命令补全、历史搜索和美化提示。在 Windows 上，我们也可以打造类似体验，利用 <strong>PowerShell 7 + Oh My Posh + PSReadLine + posh-git</strong>，并让 VS Code 终端完美适配。本文将详细介绍安装与配置步骤。</p>
<h2 data-id="heading-0">一、安装 Nerd Fonts 字体</h2>
<p>Oh My Posh 使用了大量图标和 Git 状态符号，如果字体不支持就会出现乱码。推荐字体包括：</p>
<ul>
<li>Cascadia Code PL</li>
<li>MesloLGS NF</li>
<li>JetBrainsMono Nerd Font</li>
</ul>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nerdfonts.com%2Ffont-downloads" target="_blank" title="https://www.nerdfonts.com/font-downloads" ref="nofollow noopener noreferrer">Nerd Fonts 官网</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c01dbb6d56854ba3a793cb07d7310846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=46veYJ%2F%2F1%2F%2B5Vpg3mUoy%2FAtoYiM%3D" alt="" loading="lazy"/></p>
<p><strong>安装步骤：</strong></p>
<ol>
<li>下载你喜欢的 Nerd Font。</li>
<li>双击字体文件 → 点击“安装”。</li>
<li>在终端或 VS Code 设置中选择该字体。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a9f7034198e4220be2c693ddd5fe979~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=g0dpn7rY4MAempU%2F8H58BAKjguQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、安装 PowerShell 7</h2>
<p>PowerShell 7 是新版跨平台 PowerShell，提供更多特性和兼容性。</p>
<p>官方安装指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Fpowershell%2Fscripting%2Finstall%2Finstalling-powershell" target="_blank" title="https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell" ref="nofollow noopener noreferrer">Installing PowerShell on Windows</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3121964a742442ff97e4ce125cff393b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=qgnQ66oqlbW7SZk2Cw9S51ghmnQ%3D" alt="" loading="lazy"/></p>
<p>安装完成后，可以在命令行确认版本：</p>
<pre><code class="hljs language-powershell" lang="powershell">pwsh --version
</code></pre>
<blockquote>
<p>如果显示 <code>7.x.x</code>，说明安装成功。</p>
</blockquote>
<p><strong>注意</strong>Windows 默认仍保留 PowerShell 5.1，VS Code 或 CMD 可能默认启动的是旧版，需要手动设置。</p>
<p>安装完之后到设置如果看不到PowerShell 7，那么手动添加一个配置文件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7177f1af48bc4c49a8aeac9312e67530~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=E3pJvGT4%2BQpv3fdQCBBvAW7Wj0k%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08816360b7a5455f9a28f9f1c66d9eb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=UFCaQcK9qGZR40wZJ5h%2F2CsQ%2FfA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">三、安装 Oh My Posh、posh-git 和 PSReadLine</h2>
<p>在 PowerShell 7 中执行：</p>
<pre><code class="hljs language-powershell" lang="powershell"># 更新 PowerShellGet
Install-Module -Name PowerShellGet -Force

# 安装 Oh My Posh
winget install JanDeDobbeleer.OhMyPosh -s winget

# 安装 posh-git（Git 自动补全）
Install-Module posh-git -Scope CurrentUser -Force

# 安装 PSReadLine（增强自动补全）
Install-Module PSReadLine
</code></pre>
<hr/>
<h2 data-id="heading-3">四、修改 PowerShell 配置文件</h2>
<p>PowerShell 配置文件路径：</p>
<pre><code class="hljs language-powershell" lang="powershell">$PROFILE
</code></pre>
<p>可以用 VS Code 打开：</p>
<pre><code class="hljs language-powershell" lang="powershell">code $PROFILE
</code></pre>
<p>在文件末尾加入：</p>
<pre><code class="hljs language-powershell" lang="powershell"># Tab 键显示自动补全菜单
Set-PSReadLineKeyHandler -Key Tab -Function MenuComplete

# 上下方向键搜索历史命令
Set-PSReadLineKeyHandler -Key UpArrow -Function HistorySearchBackward
Set-PSReadLineKeyHandler -Key DownArrow -Function HistorySearchForward

# 启动 Oh My Posh
oh-my-posh init pwsh --config "$env:POSH_THEMES_PATH/jandedobbeleer.omp.json" | Invoke-Expression

# 启用 Git 自动补全
Import-Module posh-git
</code></pre>
<p>保存并重启 PowerShell，就可以啦。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d836e94c8f9f4a0faa1bf8582f548b25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=4aPHCtdng9vqdQX1IAIrn%2BLEC2Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">五、VS Code 终端配置</h2>
<p>为了在 VS Code 内部也能使用 PowerShell 7 和 Oh My Posh，需要修改 VS Code 的 <strong>settings.json</strong>。</p>
<h3 data-id="heading-5">打开 settings.json</h3>
<ol>
<li>按快捷键：</li>
</ol>
<pre><code class="hljs language-plain" lang="plain">Ctrl + Shift + P
</code></pre>
<ol start="2">
<li>输入：</li>
</ol>
<pre><code class="hljs language-plain" lang="plain">settings json
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7bdc1bb7ed04a9f892faba909b005c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=7MwxY3NM%2BncShoC5t%2FFfCSXMvLs%3D" alt="" loading="lazy"/></p>
<p>或者点击右上角的按钮转换成json</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6567455d9a4b4be199b9e75b093ce349~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=wwf244Vm3%2BykD7ilqkaAtwg1Wq8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">添加配置</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"terminal.integrated.defaultProfile.windows"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PowerShell 7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"terminal.integrated.profiles.windows"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"PowerShell 7"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"D:\\Program Files (x86)\\PowerShell\\7\\pwsh.exe"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"terminal-powershell"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"terminal.integrated.fontFamily"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JetBrainsMono Nerd Font"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>注意：路径根据实际安装位置调整。<br/>
字体名称必须和安装的 Nerd Font 对应。</p>
<h3 data-id="heading-7">保存并重启 VS Code 终端</h3>
<ol>
<li>关闭所有终端</li>
<li>打开新终端</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/078ea331028b49a58d59f7ba9df513dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767713783&amp;x-signature=P%2BSoMaS9WiwRWnEaJ%2BywLrnADWY%3D" alt="" loading="lazy"/></p>
<p>大功告成！</p>
<p>📚推荐阅读</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1934984935325823063" target="_blank" title="https://zhuanlan.zhihu.com/p/1934984935325823063" ref="nofollow noopener noreferrer">Git安装教程及常用命令！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1933315484847170971" target="_blank" title="https://zhuanlan.zhihu.com/p/1933315484847170971" ref="nofollow noopener noreferrer">Cursor使用教程!</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1964796166383331241" target="_blank" title="https://zhuanlan.zhihu.com/p/1964796166383331241" ref="nofollow noopener noreferrer">TensorBoard最全使用教程！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1977769888203445057" target="_blank" title="https://zhuanlan.zhihu.com/p/1977769888203445057" ref="nofollow noopener noreferrer">多个 GitHub 账户SSH 密钥配置全攻略</a></p>
<p>关于深度学习和大模型相关的知识和前沿技术更新，请关注公众号aicoting！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能提升 4000%！我是如何解决 运营看板 不能跨库&跨库查询慢这个难题的]]></title>    <link>https://juejin.cn/post/7589494074982268979</link>    <guid>https://juejin.cn/post/7589494074982268979</guid>    <pubDate>2025-12-30T14:16:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494074982268979" data-draft-id="7589325011544981542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="性能提升 4000%！我是如何解决 运营看板 不能跨库&amp;跨库查询慢这个难题的"/> <meta itemprop="keywords" content="后端,数据库,PostgreSQL"/> <meta itemprop="datePublished" content="2025-12-30T14:16:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            性能提升 4000%！我是如何解决 运营看板 不能跨库&amp;跨库查询慢这个难题的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:16:25.000Z" title="Tue Dec 30 2025 14:16:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近遇到一个跨库查询性能问题，查询耗时从 24 秒优化到 0.6 秒，提升了 40 倍。这篇文章记录一下整个排查和解决过程，涉及 Superset、PostgreSQL FDW、微服务架构下的数据聚合问题。</p>
<hr/>
<h2 data-id="heading-0">背景</h2>
<p>先介绍一下涉及的技术栈。</p>
<p>我们用 Apache Superset 做 BI 看板，数据分散在多个微服务数据库里：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 前端展示层
        A[Apache Superset&lt;br/&gt;BI 可视化平台]
    end

    subgraph 数据层
        B[(biz_db&lt;br/&gt;业务数据库)]
        C[(users_db&lt;br/&gt;用户数据库)]
        D[(loom_db&lt;br/&gt;Agent执行库)]
    end

    subgraph 跨库方案
        E[Superset Meta Database&lt;br/&gt;应用层跨库]
        F[PostgreSQL FDW&lt;br/&gt;数据库层跨库]
    end

    A --&gt; E
    A --&gt; F
    E --&gt; B
    E --&gt; C
    E --&gt; D
    F --&gt; B
    F --&gt; C
</code></pre>
<p><strong>为什么选 Superset</strong>：开源免费、功能够用、支持跨库查询（Meta Database）、社区活跃。</p>
<p><strong>什么是 PostgreSQL FDW</strong>：Foreign Data Wrapper，PostgreSQL 的一个核心特性，可以在一个数据库里直接访问另一个数据库的数据，就像访问本地表一样。</p>
<p>FDW 的工作流程大概是这样的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant App as 应用程序
    participant LocalDB as 本地数据库&lt;br/&gt;(biz_db)
    participant FDW as FDW 层
    participant RemoteDB as 远程数据库&lt;br/&gt;(users_db)

    App-&gt;&gt;LocalDB: SELECT * FROM users
    LocalDB-&gt;&gt;FDW: 识别为外部表
    FDW-&gt;&gt;RemoteDB: 建立连接,执行查询
    RemoteDB-&gt;&gt;FDW: 返回数据
    FDW-&gt;&gt;LocalDB: 转换为本地格式
    LocalDB-&gt;&gt;App: 返回结果
</code></pre>
<p><strong>FDW 为什么快</strong>：数据库间直接通信，JOIN 操作在数据库引擎层执行（C 语言优化），只传输最终结果。</p>
<hr/>
<h2 data-id="heading-1">微服务的数据聚合问题</h2>
<p>我们的微服务架构长这样：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph 微服务架构
        subgraph 业务服务 biz-service
            A[Agent管理&lt;br/&gt;知识库&lt;br/&gt;任务对话]
            A1[(biz_db&lt;br/&gt;44张表)]
        end

        subgraph 用户服务 users-service
            B[用户认证&lt;br/&gt;权限管理&lt;br/&gt;组织架构]
            B1[(users_db&lt;br/&gt;27张表)]
        end

        subgraph Agent服务 loom-service
            C[会话管理&lt;br/&gt;工具执行&lt;br/&gt;计划编排]
            C1[(loom_db&lt;br/&gt;9张表)]
        end
    end

    A --&gt; A1
    B --&gt; B1
    C --&gt; C1
</code></pre>
<p>数据库隔离的好处大家都知道：服务独立部署、故障隔离、技术栈灵活。</p>
<p>但有个现实问题：<strong>运营报表需要聚合多个库的数据</strong>。比如我们要做一个消息评价看板，评价数据在业务库，用户名在用户库，需要 JOIN 才能出报表。</p>
<hr/>
<h2 data-id="heading-2">问题：Superset Meta Database 太慢了</h2>
<p>一开始我们用 Superset 的 Meta Database 功能做跨库查询。这是个实验性功能，工作原理是这样的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant Superset as Superset
    participant Memory as 内存
    participant DB1 as biz_db
    participant DB2 as users_db

    User-&gt;&gt;Superset: 执行跨库 SQL
    Superset-&gt;&gt;Superset: 解析 SQL，识别涉及的库
    Superset-&gt;&gt;DB1: 查询 message_ratings
    DB1-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;DB1: 查询 task_messages
    DB1-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;DB2: 查询 users
    DB2-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;Memory: 将数据加载到内存
    Memory-&gt;&gt;Memory: 执行 JOIN (Python)
    Memory-&gt;&gt;Superset: 返回 JOIN 结果
    Superset-&gt;&gt;User: 显示结果
</code></pre>
<p>看出问题了吗？它把每个库的<strong>全量数据</strong>都拉到 Superset 内存里，然后用 <strong>Python 做 JOIN</strong>。</p>
<p>配置其实很简单：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># superset_config.py</span>
FEATURE_FLAGS = {
    <span class="hljs-string">"ENABLE_SUPERSET_META_DB"</span>: <span class="hljs-literal">True</span>,
}
SUPERSET_META_DB_LIMIT = <span class="hljs-number">10000</span>  <span class="hljs-comment"># 每表最大读取行数</span>
</code></pre>
<p>跨库查询语法：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 整个表路径放在双引号里</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> "biz_db.public.users" LIMIT <span class="hljs-number">10</span>;

<span class="hljs-comment">-- 跨库 JOIN</span>
<span class="hljs-keyword">SELECT</span>
    r.rating_type,
    u.username
<span class="hljs-keyword">FROM</span> "biz_db.public.message_ratings" r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> "users_db.public.users" u
    <span class="hljs-keyword">ON</span> r.user_id <span class="hljs-operator">=</span> u.id;
</code></pre>
<p><strong>实测数据</strong>：</p>

























<table><thead><tr><th>查询类型</th><th>数据量</th><th>耗时</th></tr></thead><tbody><tr><td>单表查询</td><td>100 行</td><td>12s</td></tr><tr><td>跨库 JOIN</td><td>13 行</td><td>21-24s</td></tr><tr><td>复杂 JOIN</td><td>50 行</td><td>超时(&gt;30s)</td></tr></tbody></table>
<p>24 秒查 13 行数据，这没法用。</p>
<p><strong>瓶颈分析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 耗时分解
        A[总耗时 24s] --&gt; B[网络传输 1&lt;br/&gt;biz-&gt;Superset: 5s]
        A --&gt; C[网络传输 2&lt;br/&gt;users-&gt;Superset: 5s]
        A --&gt; D[内存 JOIN&lt;br/&gt;Python 执行: 10s]
        A --&gt; E[序列化/反序列化: 4s]
    end

    style A fill:#ff6b6b
    style D fill:#ff6b6b
</code></pre>
<p>根本原因：</p>
<ol>
<li><strong>多次网络往返</strong>：每个库单独查询，结果传回 Superset</li>
<li><strong>全量数据传输</strong>：即使只需要 JOIN 后的少量数据，也要先传输全量</li>
<li><strong>Python 执行 JOIN</strong>：效率远低于数据库引擎</li>
</ol>
<hr/>
<h2 data-id="heading-3">方案选择</h2>
<p>调研了几个方案：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 方案对比
        A[方案1: Superset Meta DB&lt;br/&gt;应用层跨库]
        B[方案2: PostgreSQL FDW&lt;br/&gt;数据库层跨库]
        C[方案3: 数据同步&lt;br/&gt;定时复制用户表]
        D[方案4: ETL&lt;br/&gt;数据仓库]
    end

    A --&gt; A1[优点: 配置简单]
    A --&gt; A2[缺点: 性能差 24s+]

    B --&gt; B1[优点: 性能好 &lt;1s]
    B --&gt; B2[缺点: 需要DBA权限]

    C --&gt; C1[优点: 查询快]
    C --&gt; C2[缺点: 数据有延迟]

    D --&gt; D1[优点: 专业方案]
    D --&gt; D2[缺点: 成本高,复杂]
</code></pre>













































<table><thead><tr><th>方案</th><th>性能</th><th>实时性</th><th>配置复杂度</th><th>维护成本</th><th>适用场景</th></tr></thead><tbody><tr><td>Superset Meta DB</td><td>❌ 差 (24s)</td><td>✅ 实时</td><td>✅ 简单</td><td>✅ 零</td><td>数据量小,不频繁查询</td></tr><tr><td><strong>PostgreSQL FDW</strong></td><td>✅ 好 (&lt;1s)</td><td>✅ 实时</td><td>⚠️ 中等</td><td>✅ 零</td><td><strong>推荐：实时跨库查询</strong></td></tr><tr><td>数据同步</td><td>✅ 好</td><td>⚠️ 有延迟</td><td>⚠️ 中等</td><td>⚠️ 定时任务</td><td>可接受延迟的场景</td></tr><tr><td>ETL 数仓</td><td>✅ 好</td><td>❌ T+1</td><td>❌ 复杂</td><td>❌ 高</td><td>大规模数据分析</td></tr></tbody></table>
<p>选 FDW 的理由：</p>
<ol>
<li><strong>性能是硬性需求</strong>：24 秒没法用</li>
<li><strong>实时性要求</strong>：用户名变更需要立即生效</li>
<li><strong>团队能力</strong>：有 DBA 支持</li>
<li><strong>成本</strong>：FDW 是 PostgreSQL 内置功能，无额外成本</li>
</ol>
<p>权衡取舍：接受需要 DBA 权限配置的复杂度，换取 40 倍性能提升。</p>
<hr/>
<h2 data-id="heading-4">FDW 架构设计</h2>
<p>最终架构长这样：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph Superset
        A[SQL Lab / Dashboard]
    end

    subgraph biz_db 本地库
        B[message_ratings&lt;br/&gt;本地表]
        C[task_messages&lt;br/&gt;本地表]
        D[fdw_users.users&lt;br/&gt;外部表 ← FDW映射]
        E[v_ratings_with_username&lt;br/&gt;视图]

        E --&gt; B
        E --&gt; C
        E --&gt; D
    end

    subgraph users_db 远程库
        F[users&lt;br/&gt;原始表]
    end

    A --&gt;|查询视图| E
    D -.-&gt;|FDW连接| F

    style D fill:#90EE90
    style E fill:#87CEEB
</code></pre>
<p>核心组件：</p>
<ol>
<li><strong>Foreign Server</strong>：远程数据库连接信息</li>
<li><strong>User Mapping</strong>：认证凭证</li>
<li><strong>Foreign Table</strong>：映射远程表到本地</li>
<li><strong>View</strong>：封装 JOIN 查询</li>
</ol>
<p>数据流对比，一目了然：</p>
<p><strong>Before（Meta Database）</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Superset应用层
        A[SQL Lab] --&gt; B[Meta DB 引擎]
        B --&gt; C[Python JOIN]
    end

    subgraph 网络传输
        D[全量数据1]
        E[全量数据2]
    end

    subgraph 数据库层
        F[(biz_db)]
        G[(users_db)]
    end

    B --&gt;|查询| F
    F --&gt;|返回全量| D
    D --&gt; C

    B --&gt;|查询| G
    G --&gt;|返回全量| E
    E --&gt; C

    C --&gt; H[结果]

    style C fill:#ff6b6b
    style D fill:#ffcc00
    style E fill:#ffcc00
</code></pre>
<p><strong>After（FDW）</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Superset应用层
        A[SQL Lab]
    end

    subgraph 数据库层
        B[(biz_db)] --&gt; C[PostgreSQL&lt;br/&gt;查询优化器]
        C --&gt; D[本地表扫描]
        C --&gt; E[FDW 远程查询]
        D --&gt; F[数据库内 JOIN]
        E --&gt; F
        F --&gt; G[结果集]
    end

    subgraph 远程
        H[(users_db)]
    end

    A --&gt;|SQL| B
    E -.-&gt;|高速内网| H
    G --&gt;|仅返回结果| A

    style F fill:#90EE90
    style E fill:#90EE90
</code></pre>
<hr/>
<h2 data-id="heading-5">实现步骤</h2>
<p>FDW 配置涉及四个组件：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">
  graph TB
      subgraph s1[FDW 四大组件]
          A[EXTENSION: postgres_fdw] --&gt; B[SERVER: users_server]
          B --&gt; C[USER MAPPING: 认证凭证]
          C --&gt; D[FOREIGN TABLE: fdw_users.users]
      end

      D --&gt; E[VIEW: v_ratings_with_username]

      style A fill:#FFB6C1
      style B fill:#98FB98
      style C fill:#87CEEB
      style D fill:#DDA0DD
      style E fill:#F0E68C
</code></pre>
<h3 data-id="heading-6">步骤 1：启用 FDW 扩展</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 需要超级用户权限</span>
<span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> postgres_fdw;
</code></pre>
<p><code>postgres_fdw</code> 是 PostgreSQL 官方提供的 FDW 扩展，专门用于连接其他 PostgreSQL 数据库，只需要在本地库执行一次。</p>
<h3 data-id="heading-7">步骤 2：创建外部服务器</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> SERVER users_server
<span class="hljs-keyword">FOREIGN</span> DATA WRAPPER postgres_fdw
OPTIONS (
    host <span class="hljs-string">'your-db-host.internal.local'</span>,
    dbname <span class="hljs-string">'users_db'</span>,
    port <span class="hljs-string">'5432'</span>
);
</code></pre>
<h3 data-id="heading-8">步骤 3：创建用户映射</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> your_user
SERVER users_server
OPTIONS (
    <span class="hljs-keyword">user</span> <span class="hljs-string">'your_user'</span>,
    password <span class="hljs-string">'your_password'</span>
);
</code></pre>
<p>用户映射告诉 FDW：当本地用户查询外部表时，用什么凭证连接远程库。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph 本地数据库
        A[本地用户: your_user]
    end

    subgraph 用户映射
        B[映射规则]
    end

    subgraph 远程数据库
        C[远程用户: your_user&lt;br/&gt;密码: ****]
    end

    A --&gt; B
    B --&gt; C

    B -.-&gt;|告诉FDW| D[用什么凭证&lt;br/&gt;连接远程库]
</code></pre>
<p>常见问题：报错 <code>user mapping not found</code> 说明当前用户没有映射，需要为每个要使用 FDW 的本地用户创建映射，或者用 <code>FOR PUBLIC</code> 允许所有用户。</p>
<h3 data-id="heading-9">步骤 4：导入外部表</h3>
<p><strong>自动导入（推荐）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (users)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;  <span class="hljs-comment">-- 导入到 fdw_users schema</span>
</code></pre>
<p><strong>手动创建</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">TABLE</span> fdw_users.users (
    id uuid,
    realm_id uuid,
    username <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    firstname <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    lastname <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    email <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    enabled <span class="hljs-type">boolean</span>,
    created_at <span class="hljs-type">timestamp</span>,
    updated_at <span class="hljs-type">timestamp</span>
)
SERVER users_server
OPTIONS (schema_name <span class="hljs-string">'public'</span>, table_name <span class="hljs-string">'users'</span>);
</code></pre>
<h3 data-id="heading-10">步骤 5：创建视图</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> v_ratings_with_username <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
    r.created_at <span class="hljs-keyword">AS</span> 评价时间,
    r.rating_type <span class="hljs-keyword">AS</span> 评价类型,
    u.username <span class="hljs-keyword">AS</span> 用户名,
    SUBSTR(m.content, <span class="hljs-number">1</span>, <span class="hljs-number">200</span>) <span class="hljs-keyword">AS</span> 消息内容,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> m.references <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">AND</span> m.references::text <span class="hljs-operator">!=</span> <span class="hljs-string">'[]'</span>
        <span class="hljs-keyword">THEN</span> <span class="hljs-string">'是'</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'否'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> 使用知识库
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task_messages m <span class="hljs-keyword">ON</span> r.message_id <span class="hljs-operator">=</span> m.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> fdw_users.users u <span class="hljs-keyword">ON</span> r.user_id::uuid <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> m.role <span class="hljs-operator">=</span> <span class="hljs-string">'assistant'</span>;
</code></pre>
<p>视图的好处：封装 JOIN 逻辑，用户只需 <code>SELECT * FROM v_ratings_with_username</code>，底层表结构变化时只改视图定义。</p>
<h3 data-id="heading-11">完整配置脚本</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ========================================</span>
<span class="hljs-comment">-- FDW 跨库查询配置脚本</span>
<span class="hljs-comment">-- 在 biz_db 数据库执行</span>
<span class="hljs-comment">-- 需要超级用户权限</span>
<span class="hljs-comment">-- ========================================</span>

<span class="hljs-comment">-- 1. 启用 FDW 扩展</span>
<span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> postgres_fdw;

<span class="hljs-comment">-- 2. 创建外部服务器</span>
<span class="hljs-keyword">CREATE</span> SERVER IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> users_server
<span class="hljs-keyword">FOREIGN</span> DATA WRAPPER postgres_fdw
OPTIONS (
    host <span class="hljs-string">'your-db-host.internal.local'</span>,
    dbname <span class="hljs-string">'users_db'</span>
);

<span class="hljs-comment">-- 3. 创建用户映射</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> your_user
SERVER users_server
OPTIONS (<span class="hljs-keyword">user</span> <span class="hljs-string">'your_user'</span>, password <span class="hljs-string">'your_password'</span>);

<span class="hljs-comment">-- 4. 创建 schema 存放外部表</span>
<span class="hljs-keyword">CREATE</span> SCHEMA IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> fdw_users;

<span class="hljs-comment">-- 5. 导入外部表</span>
IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (users)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;

<span class="hljs-comment">-- 6. 创建业务视图</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> v_ratings_with_username <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
    r.created_at <span class="hljs-keyword">AS</span> 评价时间,
    r.rating_type <span class="hljs-keyword">AS</span> 评价类型,
    u.username <span class="hljs-keyword">AS</span> 用户名,
    SUBSTR(m.content, <span class="hljs-number">1</span>, <span class="hljs-number">200</span>) <span class="hljs-keyword">AS</span> 消息内容,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> m.references <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">AND</span> m.references::text <span class="hljs-operator">!=</span> <span class="hljs-string">'[]'</span>
        <span class="hljs-keyword">THEN</span> <span class="hljs-string">'是'</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'否'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> 使用知识库
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task_messages m <span class="hljs-keyword">ON</span> r.message_id <span class="hljs-operator">=</span> m.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> fdw_users.users u <span class="hljs-keyword">ON</span> r.user_id::uuid <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> m.role <span class="hljs-operator">=</span> <span class="hljs-string">'assistant'</span>;

<span class="hljs-comment">-- 7. 授权</span>
<span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">FOREIGN</span> SERVER users_server <span class="hljs-keyword">TO</span> your_user;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> v_ratings_with_username <span class="hljs-keyword">TO</span> your_user;

<span class="hljs-comment">-- 验证</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">5</span>;
</code></pre>
<hr/>
<h2 data-id="heading-12">Superset 配置调整</h2>
<p>配置 FDW 后，Superset 的查询方式要改一下。</p>
<p><strong>Before（Meta Database）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 使用 Superset Meta Database</span>
<span class="hljs-comment">-- Database: Superset meta database</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> "biz_db.public.message_ratings" LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>After（直连 + 视图）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 直接连接 biz_db</span>
<span class="hljs-comment">-- Database: biz_db</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>就是选 <code>biz_db</code> 数据库（不是 Meta Database），直接查视图。</p>
<hr/>
<h2 data-id="heading-13">错误排查</h2>
<p>遇到问题可以按这个顺序排查：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[FDW 错误] --&gt; B{错误类型}

    B --&gt;|权限问题| C[permission denied&lt;br/&gt;to create extension]
    B --&gt;|连接问题| D[could not connect&lt;br/&gt;to server]
    B --&gt;|映射问题| E[user mapping&lt;br/&gt;not found]
    B --&gt;|表不存在| F[relation does&lt;br/&gt;not exist]

    C --&gt; C1[解决: 需要超级用户权限&lt;br/&gt;联系 DBA 执行]
    D --&gt; D1[解决: 检查网络连通性&lt;br/&gt;检查 host/port 配置]
    E --&gt; E1[解决: CREATE USER MAPPING&lt;br/&gt;为当前用户创建映射]
    F --&gt; F1[解决: 检查外部表是否导入&lt;br/&gt;检查 schema 名称]
</code></pre>
<p>排查清单：</p>



































<table><thead><tr><th>步骤</th><th>检查命令</th><th>预期结果</th></tr></thead><tbody><tr><td>1. 检查扩展</td><td><code>SELECT * FROM pg_extension WHERE extname='postgres_fdw';</code></td><td>有记录</td></tr><tr><td>2. 检查服务器</td><td><code>SELECT * FROM pg_foreign_server;</code></td><td>有 users_server</td></tr><tr><td>3. 检查用户映射</td><td><code>SELECT * FROM pg_user_mappings;</code></td><td>当前用户有映射</td></tr><tr><td>4. 检查外部表</td><td><code>SELECT * FROM information_schema.foreign_tables;</code></td><td>有 users 表</td></tr><tr><td>5. 测试连接</td><td><code>SELECT * FROM fdw_users.users LIMIT 1;</code></td><td>返回数据</td></tr></tbody></table>
<p>性能监控：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看执行计划</span>
EXPLAIN ANALYZE
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">50</span>;

<span class="hljs-comment">-- 关注：</span>
<span class="hljs-comment">-- 1. Foreign Scan 的 actual time</span>
<span class="hljs-comment">-- 2. 远程查询的行数</span>
<span class="hljs-comment">-- 3. 总执行时间</span>
</code></pre>
<p>健康指标：单次查询 &lt; 1 秒，Foreign Scan 时间 &lt; 100ms，大表上有索引。</p>
<hr/>
<h2 data-id="heading-14">测试结果</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">xychart-beta
    title "查询性能对比"
    x-axis ["Superset Meta DB", "PostgreSQL FDW"]
    y-axis "耗时(秒)" 0 --&gt; 25
    bar [24, 0.6]
</code></pre>























<table><thead><tr><th>方案</th><th>查询耗时</th><th>数据库耗时</th><th>性能提升</th></tr></thead><tbody><tr><td>Superset Meta DB</td><td>21-24s</td><td>12ms</td><td>基准</td></tr><tr><td>PostgreSQL FDW</td><td>0.5-0.8s</td><td>0.5s</td><td><strong>40x</strong></td></tr></tbody></table>
<p>执行计划对比：</p>
<p>Superset Meta DB 的数据库层只需 12ms：</p>
<pre><code class="hljs language-sql" lang="sql">Limit  (cost<span class="hljs-operator">=</span><span class="hljs-number">1635.43</span>.<span class="hljs-number">.1635</span><span class="hljs-number">.56</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">50</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">12.550</span>.<span class="hljs-number">.12</span><span class="hljs-number">.554</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">13</span>)
</code></pre>
<p>问题在应用层的 Python JOIN。</p>
<p>FDW 整体都快：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">Foreign</span> Scan <span class="hljs-keyword">on</span> users  (cost<span class="hljs-operator">=</span><span class="hljs-number">0.00</span>.<span class="hljs-number">.8</span><span class="hljs-number">.16</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">0.020</span>.<span class="hljs-number">.0</span><span class="hljs-number">.027</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>)
</code></pre>
<hr/>
<h2 data-id="heading-15">常用查询</h2>
<p>配置完成后，在 Superset 里这样用：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 选择数据库: biz_db</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">100</span>;
</code></pre>
<p>按日期过滤：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">WHERE</span> 评价时间 <span class="hljs-operator">&gt;</span> NOW() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'7 days'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>统计评价分布：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
    评价类型,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 数量
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 评价类型;
</code></pre>
<p>统计知识库使用率：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
    使用知识库,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 数量,
    ROUND(<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">*</span> <span class="hljs-number">100.0</span> <span class="hljs-operator">/</span> <span class="hljs-built_in">SUM</span>(<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)) <span class="hljs-keyword">OVER</span> (), <span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> 百分比
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 使用知识库;
</code></pre>
<hr/>
<h2 data-id="heading-16">FAQ</h2>
<p><strong>Q: 用户名变更后，视图会自动更新吗？</strong></p>
<p>会的，FDW 是实时连接，每次查询都获取最新数据。</p>
<p><strong>Q: 对线上数据库有性能影响吗？</strong></p>
<p>影响很小。FDW 查询相当于普通的远程查询，查询量不大的话影响可以忽略。</p>
<p><strong>Q: 远程库挂了会怎样？</strong></p>
<p>查询会报错，但不影响本地库的其他功能。</p>
<p><strong>Q: 如何添加新的跨库表？</strong></p>
<pre><code class="hljs language-sql" lang="sql">IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (新表名)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;
</code></pre>
<hr/>
<h2 data-id="heading-17">总结</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">timeline
    title 问题解决时间线

    section 问题发现
        发现跨库查询慢 : 使用 Superset Meta DB
                       : 查询耗时 24s+

    section 方案调研
        分析性能瓶颈 : 应用层 JOIN 是根因
                     : 对比 FDW 等方案

    section 实施落地
        配置 FDW : 创建 Server/Mapping
                 : 导入外部表
                 : 创建视图

    section 效果验证
        性能提升 40x : 从 24s 降到 0.6s
                     : 用户体验显著改善
</code></pre>
<p>几个关键收获：</p>
<p><strong>技术层面</strong>：</p>
<ol>
<li><strong>Superset Meta Database 的原理</strong>：应用层跨库，数据拉到内存 JOIN，适合小数据量低频查询</li>
<li><strong>PostgreSQL FDW 的优势</strong>：数据库层跨库，利用数据库引擎优化，适合需要高性能的跨库场景</li>
<li><strong>性能分析方法</strong>：EXPLAIN ANALYZE 分析执行计划，区分数据库层和应用层的耗时</li>
</ol>
<p><strong>架构层面</strong>：</p>
<ol>
<li><strong>微服务的数据聚合挑战</strong>：数据分散是微服务的固有问题，需要根据场景选择跨库方案</li>
<li><strong>"数据在哪里处理"很重要</strong>：同样的 JOIN，在不同层执行性能差异巨大，尽量把计算下推到数据库层</li>
</ol>
<p>方案选择象限图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c550f954be3546a38ccd46c3ff55b4c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709287&amp;x-signature=MFnaj6nBlfT8Qy6sunZZUYxfewk%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-18">附录：SQL 参考</h2>
<p>FDW 配置命令：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看所有外部服务器</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> pg_foreign_server;

<span class="hljs-comment">-- 查看所有用户映射</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> pg_user_mappings;

<span class="hljs-comment">-- 查看所有外部表</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.foreign_tables;

<span class="hljs-comment">-- 删除 FDW 配置（回滚用）</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> IF <span class="hljs-keyword">EXISTS</span> v_ratings_with_username;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> MAPPING IF <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">FOR</span> your_user SERVER users_server;
<span class="hljs-keyword">DROP</span> SERVER IF <span class="hljs-keyword">EXISTS</span> users_server CASCADE;
</code></pre>
<p>常用查询模板：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 带时间范围的评价查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">WHERE</span> 评价时间 <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-12-31'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>;

<span class="hljs-comment">-- 用户评价统计</span>
<span class="hljs-keyword">SELECT</span>
    用户名,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 评价次数,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> 评价类型 <span class="hljs-operator">=</span> <span class="hljs-string">'like'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> 点赞数,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> 评价类型 <span class="hljs-operator">=</span> <span class="hljs-string">'dislike'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> 点踩数
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 用户名
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价次数 <span class="hljs-keyword">DESC</span>;
</code></pre>
<hr/>
<h2 data-id="heading-19">延伸阅读</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2Fcurrent%2Fpostgres-fdw.html" target="_blank" title="https://www.postgresql.org/docs/current/postgres-fdw.html" ref="nofollow noopener noreferrer">PostgreSQL FDW 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsuperset.apache.org%2Fdocs%2Fintro" target="_blank" title="https://superset.apache.org/docs/intro" ref="nofollow noopener noreferrer">Apache Superset 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmicroservices.io%2Fpatterns%2Fdata%2Fdatabase-per-service.html" target="_blank" title="https://microservices.io/patterns/data/database-per-service.html" ref="nofollow noopener noreferrer">微服务架构数据管理模式</a></li>
</ul>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>vibe coding 原理学习</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcoding-cli-guide" target="_blank" title="https://github.com/tt-a1i/coding-cli-guide" ref="nofollow noopener noreferrer">coding-cli-guide</a>（<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt-a1i.github.io%2Fcoding-cli-guide%2F%3Ftab%3Dstart-here" target="_blank" title="https://tt-a1i.github.io/coding-cli-guide/?tab=start-here" ref="nofollow noopener noreferrer">学习网站</a>）- 学习 qwen-cli 时整理的笔记，40+ 交互式动画演示 AI CLI 内部机制</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mybatis二级缓存实现详解]]></title>    <link>https://juejin.cn/post/7589212818808176703</link>    <guid>https://juejin.cn/post/7589212818808176703</guid>    <pubDate>2025-12-30T14:19:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589212818808176703" data-draft-id="7589466238240915498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Mybatis二级缓存实现详解"/> <meta itemprop="keywords" content="Java,MyBatis,源码阅读"/> <meta itemprop="datePublished" content="2025-12-30T14:19:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员侠客行"/> <meta itemprop="url" content="https://juejin.cn/user/556801719828361"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Mybatis二级缓存实现详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/556801719828361/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员侠客行
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:19:06.000Z" title="Tue Dec 30 2025 14:19:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上一篇《<a href="https://juejin.cn/post/7588042910198595634" target="_blank" title="https://juejin.cn/post/7588042910198595634">Mybatis的Executor和缓存体系</a>》介绍了一二级缓存的特点、启用和区别。二级缓存是Mapper级别，在整个应用中可以跨线程共享，所以有更高的命中率。和一级缓存的PerpetualCache相比，二级缓存机制和体系更加完整。</p>
<p>现在，我们一起来看看mybatis二级缓存的创建和实现。</p>
<blockquote>
<p>注：本文中源码来自mybatis 3.4.x版本，地址<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmybatis%2Fmybatis-3.git" target="_blank" title="https://github.com/mybatis/mybatis-3.git" ref="nofollow noopener noreferrer">github.com/mybatis/myb…</a></p>
</blockquote>
<h2 data-id="heading-0">一 Cache接口体系</h2>
<p>根接口Cache中定义了缓存的操作方法，有如下约束：</p>
<ol>
<li>子类实现必须有一个构造函数，该构造函数接收一个字符串类型的cache id作为参数；</li>
<li>MyBatis 会将Mapper文件的namespace作为cache id，来创建Cache实例；</li>
<li>每个namespace都有一个cache实例。</li>
</ol>
<p>在结构设计上，二级缓存采用装饰器模式，提供了很多扩展功能，如：</p>
<ul>
<li>内存溢出回收机制，如FIFO、LRU、soft和weak引用；</li>
<li>序列化存储，如SerializedCache</li>
<li>缓存命中统计，LoggingCache</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6439d37b50ec41c2adc58949a8d9364a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=W7RVsUzS8QRiSejcntrAQWhG%2Fqg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">1.1 基础缓存PerpetualCache</h3>
<ul>
<li>PerpetualCache是基础实现，是所有装饰器的被装饰对象；</li>
<li>HashMap存储，简单的键值对存储；</li>
<li>数据永久保存，直到手动清理；</li>
<li>非线程安全。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/641a0151fc6e469c80b239d4814f6dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=FM%2BS%2FPEZFgtLVmpYend36%2B%2BmFBE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">1.2 淘汰策略装饰器</h3>
<h4 data-id="heading-3">最近最少使用LruCache</h4>
<ul>
<li>LRU算法：基于LinkedHashMap的访问顺序</li>
<li>容量控制：超出容量时淘汰最久未访问的数据</li>
<li>访问更新：每次get操作都会更新访问顺序</li>
<li>默认大小：1024个对象</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LruCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
  <span class="hljs-comment">// 被装饰的Cache对象</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
  <span class="hljs-comment">// 最近最少使用算法的实现，基于LinkedHashMap</span>
  <span class="hljs-keyword">private</span> Map&lt;Object, Object&gt; keyMap;
  <span class="hljs-comment">// 最近最少使用的key，用于移除过期的缓存项</span>
  <span class="hljs-keyword">private</span> Object eldestKey;

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">LruCache</span><span class="hljs-params">(Cache delegate)</span> {
    <span class="hljs-built_in">this</span>.delegate = delegate;
    setSize(<span class="hljs-number">1024</span>);
  }
    
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSize</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-type">int</span> size)</span> {
    keyMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;Object, Object&gt;(size, <span class="hljs-number">.75F</span>, <span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">4267176411845948333L</span>;

      <span class="hljs-meta">@Override</span>
      <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeEldestEntry</span><span class="hljs-params">(Map.Entry&lt;Object, Object&gt; eldest)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">tooBig</span> <span class="hljs-operator">=</span> size() &gt; size;
        <span class="hljs-keyword">if</span> (tooBig) {
          eldestKey = eldest.getKey();
        }
        <span class="hljs-keyword">return</span> tooBig;
      }
    };
  }    

  <span class="hljs-comment">// put时触发移除eldestKey</span>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object value)</span> {
    delegate.putObject(key, value);
    cycleKeyList(key);
  }

  <span class="hljs-comment">// get时触发更新eldestKey</span>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> {
    keyMap.get(key); <span class="hljs-comment">//touch</span>
    <span class="hljs-keyword">return</span> delegate.getObject(key);
  }   
</code></pre>
<h4 data-id="heading-4">先进先出FifoCache</h4>
<ul>
<li>FIFO算法：严格按照插入顺序淘汰</li>
<li>队列实现：使用LinkedList维护插入顺序，默认大小为1024</li>
<li>简单高效：不考虑访问频率，只看插入时间</li>
<li>适用场景：数据访问模式相对均匀</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FifoCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Deque&lt;Object&gt; keyList;  <span class="hljs-comment">// LinkedList维护插入顺序</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cycleKeyList</span><span class="hljs-params">(Object key)</span> {
        keyList.addLast(key);           <span class="hljs-comment">// 新key加到队尾</span>
        <span class="hljs-keyword">if</span> (keyList.size() &gt; size) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">oldestKey</span> <span class="hljs-operator">=</span> keyList.removeFirst();  <span class="hljs-comment">// 移除队首</span>
            delegate.removeObject(oldestKey);
        }
    }
}
</code></pre>
<h3 data-id="heading-5">1.3 引用类型装饰器</h3>
<h4 data-id="heading-6">软引用缓存SoftCache</h4>
<p>内存不足时（JVM在OOM前）自动清理，使用SoftReference包装缓存项</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SoftCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
  <span class="hljs-comment">// 维护一定数量强引用，避免缓存项都被GC回收</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Deque&lt;Object&gt; hardLinksToAvoidGarbageCollection;
  <span class="hljs-comment">// 监听GC队列，及时清理失效缓存</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReferenceQueue&lt;Object&gt; queueOfGarbageCollectedEntries;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
    
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object value)</span> {
    <span class="hljs-comment">// 先清理queueOfGarbageCollectedEntries中GC的缓存项</span>
    removeGarbageCollectedItems();
    <span class="hljs-comment">// 缓存项包装为SoftReference</span>
    delegate.putObject(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoftEntry</span>(key, value, queueOfGarbageCollectedEntries));
  }
</code></pre>
<h4 data-id="heading-7">弱引用缓存WeakCache</h4>
<p>类似SoftCache，但使用WeakReference，在下次GC时缓存项就可能被回收。</p>
<h3 data-id="heading-8">1.4 功能增强装饰器</h3>
<h4 data-id="heading-9">序列化缓存SerializedCache</h4>
<ul>
<li>深拷贝：每次get返回新的对象实例</li>
<li>线程安全：避免多线程修改同一对象</li>
<li>序列化要求：对象必须实现Serializable接口</li>
<li>性能开销：序列化/反序列化有性能成本</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializedCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object object)</span> {
        <span class="hljs-keyword">if</span> (object == <span class="hljs-literal">null</span> || object <span class="hljs-keyword">instanceof</span> Serializable) {
            delegate.putObject(key, serialize((Serializable) object));  <span class="hljs-comment">// 序列化存储</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheException</span>(<span class="hljs-string">"SharedCache failed to make a copy of a non-serializable object: "</span> + object);
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> delegate.getObject(key);
        <span class="hljs-keyword">return</span> object == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : deserialize((<span class="hljs-type">byte</span>[]) object);  <span class="hljs-comment">// 反序列化返回</span>
    }
}
</code></pre>
<h4 data-id="heading-10">同步缓存SynchronizedCache</h4>
<p>由于PerpetualCache非线程安全，SynchronizedCache 中对所有方法都加synchronized，虽然变得线程安全了，但是高并发时会影响性能。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object object)</span> {
    delegate.putObject(key, object);
}
</code></pre>
<h4 data-id="heading-11">日志缓存LoggingCache</h4>
<p>能够统计和输出缓存命中率。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/813ea4e256ff44a182c9d6e69f754200~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=78Iv03LWMq07Q4stDimxN3v0Z3w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12">阻塞缓存BlockingCache</h4>
<p>适用于高并发环境下防止缓存击穿、数据库查询成本很高的场景。</p>
<ul>
<li>防止缓存击穿：多线程同时查询同一个不存在的key时，只有一个线程查询数据库</li>
<li>锁机制：每个key对应一个ReentrantLock</li>
<li>超时控制：支持获取锁的超时时间设置</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 阻塞缓存：当缓存未命中时, 会阻塞当前线程, 直到缓存被填充</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockingCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
  <span class="hljs-comment">// 锁超时时间</span>
  <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
  <span class="hljs-comment">// 每个缓存键对应一个锁对象</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Object, ReentrantLock&gt; locks;

  <span class="hljs-comment">// 放入缓存项，同时释放锁对象</span>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object value)</span> {
    <span class="hljs-keyword">try</span> {
      delegate.putObject(key, value);
    } <span class="hljs-keyword">finally</span> {
      releaseLock(key);
    }
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> {
    <span class="hljs-comment">// 先获取缓存键对应的锁对象</span>
    acquireLock(key);
    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> delegate.getObject(key);
    <span class="hljs-comment">// 如果缓存命中, 则释放锁对象</span>
    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
      releaseLock(key);
    }
    <span class="hljs-comment">// 未命中时返回null，将导致查询数据库、写缓存</span>
    <span class="hljs-keyword">return</span> value;
  }    
</code></pre>
<h4 data-id="heading-13">定时清理缓存ScheduledCache</h4>
<p><strong>在缓存操作时检查是否超时，超时后自动清空所有缓存数据</strong>。支持设置时间间隔。适用于数据有明确的时效性要求、定期刷新缓存数据等场景。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09490b6ec93c4084a3b0a4dd240cb60c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=6aeoMAvcAD%2Bajin7G7i4HVoyc3E%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c72157f2eca4a41b766c45e257743d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=9Sol3y7KEoXuvK6gAUKcekgX0rA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">1.5 总结</h3>
<p><strong>MyBatis的Cache体系通过装饰器模式，实现了高度的灵活性和可扩展性，每个装饰器专注于单一职责，可以根据实际需求灵活组合使用。</strong></p>
<h2 data-id="heading-15">二 创建和使用二级缓存</h2>
<h3 data-id="heading-16">2.1 创建</h3>
<p>一级缓存是org.apache.ibatis.executor.BaseExecutor中<code>PerpetualCache localCache</code>，默认启用，在创建Executor时就初始化了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad77b33218d9450ab86fa4f8d5aee890~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=ety1xpAtMjR8Xar115TYTC076jk%3D" alt="" loading="lazy"/></p>
<p>那么，二级缓存是何时创建的呢？</p>
<p>先说结论：</p>
<ul>
<li>二级缓存实例在应用启动的Mapper XML解析阶段创建，而不是在运行时动态创建。这保证了缓存的生命周期与应用生命周期一致，实现了跨SqlSession的数据共享。</li>
<li><strong>每个Mapper.xml中标签，对应一个缓存实例，cacheId就是namespace，创建时就应用了所有装饰器。</strong></li>
</ul>
<p>详细流程：</p>
<ol>
<li>在XMLConfigBuilder.mapperElement方法中，会逐个解析Mapper.xml；</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// XMLConfigBuilder.parse() -&gt; parseConfiguration() -&gt; mapperElement()</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mapperElement</span><span class="hljs-params">(XNode parent)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-keyword">if</span> (parent != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (XNode child : parent.getChildren()) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"package"</span>.equals(child.getName())) {
                <span class="hljs-comment">// 扫描包下的Mapper</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 解析单个Mapper文件</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> child.getStringAttribute(<span class="hljs-string">"resource"</span>);
                <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(resource);
                <span class="hljs-type">XMLMapperBuilder</span> <span class="hljs-variable">mapperParser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLMapperBuilder</span>(inputStream&lt;/mark&gt;, configuration, resource, configuration.getSqlFragments());
                <span class="hljs-comment">// 在这里创建二级缓存</span>
                mapperParser.parse(); 
            }
        }
    }
}
</code></pre>
<ol start="2">
<li>在XMLMapperBuilder.configurationElement方法中，会解析Mapper中标签；</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XMLMapperBuilder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseBuilder</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (!configuration.isResourceLoaded(resource)) {
            configurationElement(parser.evalNode(<span class="hljs-string">"/mapper"</span>));
            configuration.addLoadedResource(resource);
            bindMapperForNamespace();
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configurationElement</span><span class="hljs-params">(XNode context)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">namespace</span> <span class="hljs-operator">=</span> context.getStringAttribute(<span class="hljs-string">"namespace"</span>);
            <span class="hljs-keyword">if</span> (namespace == <span class="hljs-literal">null</span> || namespace.equals(<span class="hljs-string">""</span>)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderException</span>(<span class="hljs-string">"Mapper's namespace cannot be empty"</span>);
            }
            builderAssistant.setCurrentNamespace(namespace);
            
            <span class="hljs-comment">// 解析cache标签，创建二级缓存实例</span>
            cacheElement(context.evalNode(<span class="hljs-string">"cache"</span>));
            cacheRefElement(context.evalNode(<span class="hljs-string">"cache-ref"</span>));
            <span class="hljs-comment">// ...其他解析</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderException</span>(<span class="hljs-string">"Error parsing Mapper XML. The XML location is '"</span> + resource + <span class="hljs-string">"'. Cause: "</span> + e, e);
        }
    }
}
</code></pre>
<ol start="3">
<li>解析缓存配置，准备创建实例</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/031d05b2851a4634bfcf52b469de0511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=RNvxPPbvcEW2qMBfkc1O7oDOlCg%3D" alt="" loading="lazy"/></p>
<ol start="4">
<li>在MapperBuilderAssistant#useNewCache中</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6af4614b7e8c4cf097bd35ca90bdf6bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=XdB%2B6gU0PkC7UIdBag6RJmJ9%2BEg%3D" alt="" loading="lazy"/></p>
<ol start="5">
<li>org.apache.ibatis.mapping.CacheBuilder#build中，应用装饰模式</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a1113303d914f9dbd470b7a7d214e26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=ies%2BjqosIsGFv8nafSIRQtYk7BU%3D" alt="" loading="lazy"/></p>
<ol start="6">
<li>在Mapper.xml中，可配置size、clearInterval等属性，会添加相应的装饰器。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e3e9026746b4be38deb07bb281e82af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=8xxObWEjolcCiDeSIYkYqA3MxF0%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// CacheBuilder中的装饰器应用顺序</span>
<span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerpetualCache</span>(id);
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>(cache);           <span class="hljs-comment">// 淘汰策略，默认Lru</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledCache</span>(cache);     <span class="hljs-comment">// 配置了clearInterval时</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SerializedCache</span>(cache);    <span class="hljs-comment">// 配置了readWrite时</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingCache</span>(cache);       <span class="hljs-comment">// 日志</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedCache</span>(cache);  <span class="hljs-comment">// 同步</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockingCache</span>(cache);  	   <span class="hljs-comment">// 配置了blocking时</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/078d367394a04864bf5e163f9666194c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=0jKs6%2B04DufK46vQRFDV5gl7rIk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17"><strong>2.2 使用</strong></h3>
<p>创建的二级缓存实例，会被对应的MappedStatement引用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MappedStatement</span> {
    <span class="hljs-keyword">private</span> Cache cache; <span class="hljs-comment">// 引用对应的缓存实例</span>
    
    <span class="hljs-keyword">public</span> Cache <span class="hljs-title function_">getCache</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cache;
    }
}
</code></pre>
<p>CachingExecutor在查询时，从MappedStatement中获取二级缓存实例并使用</p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="hljs-title function_">query</span><span class="hljs-params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span>
      <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-comment">// 获取Mapper配置文件中二级缓存实例</span>
    <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> ms.getCache();
    <span class="hljs-comment">// 启用了二级缓存</span>
    <span class="hljs-keyword">if</span> (cache != <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// 使用缓存</span>
    }
    <span class="hljs-comment">//未启用二级缓存，直接查询数据库</span>
    <span class="hljs-keyword">return</span> delegate.&lt;E&gt; query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);
  }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8fa551780934f0a929ebd98a45c471d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=heTgOD9JQTt%2FItCm056AAL7l7J8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-18">三 特别的TransactionalCache</h2>
<p><strong>TransactionalCache也是Cache接口的实现，是MyBatis二级缓存的事务缓冲区，为二级缓存提供事务语义支持。有以下特性</strong></p>
<ol>
<li>延迟写入</li>
</ol>
<ul>
<li>缓存操作不直接写入二级缓存</li>
<li>所有写操作暂存在entriesToAddOnCommit中</li>
<li>只有事务提交时才真正写入共享缓存</li>
</ul>
<ol start="2">
<li>事务隔离</li>
</ol>
<ul>
<li>每个事务有独立的TransactionalCache实例</li>
<li>未提交的缓存项对其他事务不可见</li>
<li>保证缓存的事务一致性</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> clearOnCommit;
<span class="hljs-comment">// 待提交的缓存项</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Object, Object&gt; entriesToAddOnCommit;
<span class="hljs-comment">// 缓存未命中的key。TransactionalCache.putObject不会触发BlockingCache释放锁，</span>
<span class="hljs-comment">// 因此rollback时对value为null的key，需要执行put来解锁</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;Object&gt; entriesMissedInCache;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commit</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (clearOnCommit) {
        delegate.clear();
    }
    <span class="hljs-comment">// 提交时, 将待添加的缓存项添加到二级缓存中</span>
    flushPendingEntries();
    reset();
}

<span class="hljs-comment">// 回滚时，丢弃待添加的缓存项</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rollback</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 回滚时, 解锁所有未命中缓存项的锁对象</span>
    unlockMissedEntries();
    reset();
}
</code></pre>
<h3 data-id="heading-19">3.1 事务隔离</h3>
<p>mybatis中二级缓存跨session共享，当使用TransactionalCache装饰时，如何区分不同事务的待提交缓存项呢？</p>
<p>答案是：不同事务的缓存操作完全隔离。<strong>MyBatis通过为每个SqlSession创建独立的TransactionalCache实例来实现事务级别的缓存隔离，而不是在单个实例内部区分不同事务。</strong></p>
<ol>
<li>实例级别隔离：每个SqlSession在使用二级缓存时，都会创建自己的TransactionalCache包装器</li>
<li>本地缓存区：每个TransactionalCache维护自己的entriesToAddOnCommit映射，存储该事务的待提交项</li>
<li>事务边界控制：只有在调用commit()时，待提交的缓存项才会真正写入共享的二级缓存。</li>
</ol>
<pre><code class="hljs language-text" lang="text">事务A (SqlSession A)     事务B (SqlSession B)
     |                        |
TransactionalCache A    TransactionalCache B
     |                        |
entriesToAddOnCommit    entriesToAddOnCommit
  {key1: value1}         {key2: value2}
     |                        |
   commit()                rollback()
     |                        |
  写入二级缓存               丢弃缓存项
</code></pre>
<p><strong>注意，SqlSession非线程安全，不应被多线程并发使用；因此某一时刻下某个sqlSession最多处理一个事务。</strong></p>
<h3 data-id="heading-20">3.2 源码实现</h3>
<p>MyBatis通过实例级别的隔离而非数据级别的区分，来实现不同事务的TransactionalCache隔离。</p>
<ul>
<li>
<p>CachingExecutor持有TransactionalCacheManager实例；<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3a0eddc933b4b03b9c7e47db0ede1a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=q8sD2pqMRdoTP855jkBdvS3KmqQ%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>TransactionalCacheManager会为每个二级缓存创建一个TransactionalCache对象</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-comment">// 二级缓存的TransactionalCache包装</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Cache, TransactionalCache&gt; transactionalCaches = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;Cache, TransactionalCache&gt;();

  <span class="hljs-keyword">private</span> TransactionalCache <span class="hljs-title function_">getTransactionalCache</span><span class="hljs-params">(Cache cache)</span> {
    <span class="hljs-type">TransactionalCache</span> <span class="hljs-variable">txCache</span> <span class="hljs-operator">=</span> transactionalCaches.get(cache);
    <span class="hljs-keyword">if</span> (txCache == <span class="hljs-literal">null</span>) {
      txCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionalCache</span>(cache);
      transactionalCaches.put(cache, txCache);
    }
    <span class="hljs-keyword">return</span> txCache;
  }
</code></pre>
<p>事务隔离的实现路径</p>
<ol>
<li>SqlSession级别隔离：每个事务使用独立的SqlSession实例</li>
<li>Executor级别隔离：每个SqlSession创建独立的CachingExecutor</li>
<li>TransactionalCacheManager级别隔离：每个CachingExecutor有独立的TransactionalCacheManager</li>
<li>TransactionalCache级别隔离：每个二级Cache在每个事务中都有独立的TransactionalCache包装</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SeeDream Images Generation API 对接说明]]></title>    <link>https://juejin.cn/post/7589474656875315210</link>    <guid>https://juejin.cn/post/7589474656875315210</guid>    <pubDate>2025-12-30T14:26:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589474656875315210" data-draft-id="7589509638355075099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SeeDream Images Generation API 对接说明"/> <meta itemprop="keywords" content="API"/> <meta itemprop="datePublished" content="2025-12-30T14:26:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SeeDream Images Generation API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:26:57.000Z" title="Tue Dec 30 2025 14:26:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 SeeDream Images Generation API 对接说明，它是可以通过输入自定义参数来生成 SeeDream 官方的图片。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fseedream-images" target="_blank" title="https://platform.acedata.cloud/documents/seedream-images" ref="nofollow noopener noreferrer">SeeDream Images Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c685d941fff24e94933ae844f5e7d887~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709617&amp;x-signature=8PM%2Fo978BpBLZb2vL4zkGRRl4pQ%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>首先先了解下基本的使用方式，就是输入提示词 <code>prompt</code>、 生成行为 <code>action</code>、图片尺寸 <code>size</code>，便可获得处理后的结果，首先需要简单地传递一个 <code>action</code> 字段，它的值为 <code>generate</code>，然后我们还需要输入提示词，具体的内容如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f07b8ed7e214cc3ac75a57b4c8a84b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709617&amp;x-signature=vGjxpMici24ydyj0jm%2BHBgAhFXA%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>prompt</code>：提示词。</li>
<li><code>model</code>：生成模型，默认 <code>doubao-seedream-4.0</code>。</li>
<li><code>image</code>: 输入的图片信息，支持 URL 或 Base64 编码。其中，<code>doubao-seedream-4.5</code>、<code>doubao-seedream-4.0</code> 支持单图或多图输入,<code>doubao-seededit-3.0-i2i</code> 仅支持单图输入,<code>doubao-seededit-3.0-t2i</code> 不支持该参</li>
<li><code>size</code>: 指定生成图像的尺寸信息，支持以下两种方式，不可混用。方式 1 | 指定生成图像的分辨率，并在prompt中用自然语言描述图片宽高比、图片形状或图片用途，最终由模型判断生成图片的大小。方式 2 | 指定生成图像的宽高像素值：默认值：<code>2048x2048</code> 根据模型不同默认值不同</li>
<li><code>seed</code>: 随机数种子，用于控制模型生成内容的随机性。取值范围为 [-1, 2147483647]。仅 <code>doubao-seedream-3.0-t2i</code>、<code>doubao-seededit-3.0-i2i</code> 支持该参数</li>
<li><code>sequential_image_generation</code>: 组图：基于您输入的内容，生成的一组内容关联的图片。仅 <code>doubao-seedream-4.5</code>、<code>doubao-seedream-4.0</code> 支持该参数， 默认 <code>disabled</code></li>
<li><code>stream</code>: 控制是否开启流式输出模式。仅 <code>doubao-seedream-4.5</code>、<code>doubao-seedream-4.0</code> 支持该参数，默认是 <code>false</code></li>
<li><code>guidance_scale</code>: 模型输出结果与prompt的一致程度，生成图像的自由度，又称为文本权重；值越大，模型自由度越小，与用户输入的提示词相关性越强。取值范围：[1, 10] 。<code>doubao-seedream-3.0-t2i</code> 默认值 2.5, <code>doubao-seededit-3.0-i2i</code>默认值 5.5， 其他不支持</li>
<li><code>response_format</code>: 指定生成图像的返回格式。默认是<code>url</code>，也支持<code>b64_json</code></li>
<li><code>watermark</code>: 是否在生成的图片中添加水印。默认是 <code>true</code></li>
<li><code>callback_url</code>：需要回调结果的 URL。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b0b04c565f1407a8e46907565df4227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709617&amp;x-signature=B7l9eY4ridyUihN79LCw1T%2BZx0M%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"25027ba3-0430-4a1b-91c8-d2297f19ba73"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8043a9e9-692f-43b0-82f7-5890f798be38"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a white siamese cat"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2048x2048"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedream/3c060029-69b1-406f-a957-fcd55ddc9386.jpg"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时视频生成任务的状态情况。</li>
<li><code>task_id</code>，此时视频生成任务 ID。</li>
<li><code>trace_id</code>，此时视频生成跟踪 ID。</li>
<li><code>data</code>，此时图像生成任务的结果列表。
<ul>
<li><code>image_url</code>，此时图片生成任务的链接。</li>
<li><code>prompt</code>，提示词。</li>
<li><code>size</code>: 生成图的像素</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了满意的图片信息，我们只需要根据结果中 <code>data</code> 的图片链接地址获取生成的 SeeDream 图片即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/seedream/images' \
-H 'accept: application/json' \
-H 'authorization: Bearer ${token}' \
-H 'content-type: application/json' \
-d '{
  "action": "generate",
  "model": "doubao-seedream-4-0-250828",
  "prompt": "a white siamese cat"
}'
</code></pre>
<h2 data-id="heading-2">编辑图片任务</h2>
<p>如果想对某张图片进行编辑的话， 首先参数<code>image</code>必须传入需要编辑的图片链接</p>
<ul>
<li>model：此次编辑图片任务所采用的模型，该任务目前支持 <code>doubao-seedream-4.5</code>、<code>doubao-seedream-4.0</code> 支持单图或多图输入，<code>doubao-seededit-3.0-i2i</code> 仅支持单图输入。</li>
<li>image：上传需要编辑的图片，一张或者多张</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f56d3ab01c834cf7a4f8b791f3bdcfec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709617&amp;x-signature=ZsR4toFjxeWSeZu4zI45io%2BUwnM%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/flux/images"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seedream-4-0-250828"</span>,
  <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"Keep the model pose and the liquid garment flowing shape unchanged. Change the clothing material from silver metal to completely transparent water (or glass). Through the liquid flow, the details of the model skin are visible. The light and shadow effect shifts from reflection to refraction."</span>,
  <span class="hljs-string">"image"</span>: [<span class="hljs-string">"https://ark-project.tos-cn-beijing.volces.com/doc_image/seedream4_5_imageToimage.png"</span>],
  <span class="hljs-string">"size"</span>: <span class="hljs-string">"2K"</span>,
  <span class="hljs-string">"watermark"</span>: <span class="hljs-literal">False</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c9aaffa2-b8ac-40ff-8468-43e77cb9ddde"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"131a40c3-2eaf-44c9-af28-c9b408577286"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Keep the model pose and the liquid garment flowing shape unchanged. Change the clothing material from silver metal to completely transparent water (or glass). Through the liquid flow, the details of the model skin are visible. The light and shadow effect shifts from reflection to refraction."</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2048x2048"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedream/3e88db7e-4771-4f6a-adbd-5ae4590c5d59.jpg"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，生成的效果是对原图片进行编辑的效果，结果与上文类似。</p>
<h2 data-id="heading-3">异步回调</h2>
<p>由于 SeeDream Images Generation API 生成的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成图片的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c9aaffa2-b8ac-40ff-8468-43e77cb9ddde"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c9aaffa2-b8ac-40ff-8468-43e77cb9ddde"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"131a40c3-2eaf-44c9-af28-c9b408577286"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Keep the model pose and the liquid garment flowing shape unchanged. Change the clothing material from silver metal to completely transparent water (or glass). Through the liquid flow, the details of the model skin are visible. The light and shadow effect shifts from reflection to refraction."</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2048x2048"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedream/3e88db7e-4771-4f6a-adbd-5ae4590c5d59.jpg"</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-4">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-5">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-6">结论</h2>
<p>通过本文档，您已经了解了如何使用 SeeDream Images Generation API 可通过输入提示词来生成图片。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[半年一百个页面，重构系统也重构了我对前端工作的理解]]></title>    <link>https://juejin.cn/post/7589509638355140635</link>    <guid>https://juejin.cn/post/7589509638355140635</guid>    <pubDate>2025-12-30T14:39:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589509638355140635" data-draft-id="7589325011544997926" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="半年一百个页面，重构系统也重构了我对前端工作的理解"/> <meta itemprop="keywords" content="前端,架构,程序员"/> <meta itemprop="datePublished" content="2025-12-30T14:39:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="纸上的彩虹"/> <meta itemprop="url" content="https://juejin.cn/user/1987553160857261"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            半年一百个页面，重构系统也重构了我对前端工作的理解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1987553160857261/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    纸上的彩虹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:39:08.000Z" title="Tue Dec 30 2025 14:39:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读30分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么想去重构</h2>
<p>在现在的部门已经呆了两年多，系统后台使用的是 <code>vben2</code> 的框架搭建的，旧框架版本滞后导致<code>bug</code>频发，重复代码堆积成“屎山”，交互设计割裂影响用户体验，多环境维护成本翻倍……这些问题像藤蔓一样缠绕着日常开发，既消耗着大量时间精力，也让技术价值难以充分释放。</p>
<p>所以我一直盘算着如何去完成整个系统框架的升级，中间我一直关注 <code>vben5</code> 的开源进度，在 <code>vben5</code> 没有完成表单和表格的全部功能实现之前，对于系统的重构就始终搁置。但是中间有两个新项目我用了 <code>vben3</code> 框架搭建，使用下来的感受与 <code>vben2</code> 并没有太大的区别，没有达到我的预期，所以就继续等待 <code>vben5</code> 的进度。</p>
<p>之前组内前端是三个人，后来按业务划分我这条线就是两个前端在维护，上半年的时候与我共事的这位同事产假，于是所有的迭代压力自然而然的压到了我的身上，当时我的第一想法就是，这或许是全量重构系统的契机，原因有几点：</p>
<ul>
<li>一个人迭代可以准确了解每一个需求的进行情况，在新系统迁移过程中，不容易遗漏迭代中的需求功能。</li>
<li>自己可以把握日常迭代的节奏，每周都能适当留出重构的时间。</li>
<li>最后一点也是最重要的一点，就是 <code>vben5</code> 开源进度已经可以满足生产系统的需求。</li>
</ul>
<h2 data-id="heading-1">如何理解重构</h2>
<p>说到重构，有一本书可能大多数程序员都听过，叫《重构：改善既有代码的设计》，书中指出重构的定义为：<strong>在不改变软件可观测行为的前提下，调整代码结构，提高软件的可理解性，降低变更成本</strong>。</p>
<p>书中提到我们要明确一点，重构不是一种道德行为，而是一种经济适用行为，如果它不能让我们更快更好的开发，那么它是毫无意义。具体点说就是代码的写法应该使别人理解它所需要的时间最小化，进而变更代码需要的时间也会最小化。</p>
<p>其次也是书中没有提到但我认为很重要的一点就是：<strong>脱离业务设计重构或者优化，最多只能是技术自证，始终是片面的。</strong></p>
<p>作为前端开发者我们用着同样的计算机语言，却身处完全不同的业务场景下，<strong>重构代码的同时思考如何提升用户的使用体验，才是我们作为前端研发的价值体现。</strong></p>
<p>总结重构落地的意义可以归结为以下几点：</p>
<ul>
<li><strong>更快速的定位问题，节省调试时间。</strong></li>
<li><strong>最小化变更风险，提高代码质量，减少修复事故的时间。</strong></li>
<li><strong>提升用户体验。</strong></li>
<li><strong>得到程序员同行的认可，更好的发展机会。</strong></li>
</ul>
<p>有了理论支持与明确的目标，我们就可以开始着手重构的设计构思。</p>
<h2 data-id="heading-2">开源框架本地化</h2>
<p>从之前一直维护框架代码的经验来说，这些都是可以交给开源团队去维护，项目开发者只需要定期拉取最新版本的框架代码，更多的精力应当更专注于业务逻辑与功能实现，所以我在开源本地化的时候将 <code>vben5</code> 的 <code>github</code> 地址一直作为基准的远程地址，去定期同步。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94ebf2c6171b4a25bbff0cd946f0076d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LiK55qE5b2p6Jm5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710348&amp;x-signature=oF1M%2FQ%2BlW19YrB4hz17xlcXru%2F0%3D" alt="微信图片_20251114195651_52_274" loading="lazy"/>
<p>其核心维护流程图如下：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c30458f14ac2450ea5a56a633bb46fd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LiK55qE5b2p6Jm5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710348&amp;x-signature=qd2DHrhaePOd5uMny%2BTMXACSkLY%3D" alt="image-20251114200450835" loading="lazy"/>
<p>受益于 <code>vben5</code> 的架构，框架代码与业务代码做到了完全分离，什么改动是框架的，什么改动是业务的，定义就会十分明确。在日常迭代中遇到需要调整框架的，就去框架项目改，改完同步到所有的项目中去，这样既保证了框架版本的最新，同时迭代了本地化的框架改动，也不会影响到业务代码。</p>
<h2 data-id="heading-3">前端部署的良解</h2>
<p>之前部门前端项目中的部署方式是通过本地打包上传到静态服务器（我这叫狮子座），然后在生产服务器启一个 <code>node</code> 服务来访问 <code>index.html</code> 文件。具体流程如下展示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7880e79c32ba4fd3ad6710c079fa6c6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LiK55qE5b2p6Jm5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710348&amp;x-signature=sNWTzyhM85al8BnXqcmN71dx9ZU%3D" alt="image-20251115002301702.png" loading="lazy"/></p>
<p>总结来说就是哪哪都会出问题，所以这次重构后我采用 <code>服务器打包 + nginx服务</code> 的方式，其实这套方式在很久之前我的另一篇文章<a href="https://juejin.cn/post/6981339862901194759" target="_blank" title="https://juejin.cn/post/6981339862901194759">【微前端qiankun+docker+nginx配合gitlab-ci/cd的自动化部署的实现】</a>中实现过，所以我也轻车熟路地在公司的运维平台实现了自动化部署，其流程如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f84c2341f8864d17a0cc6124093b2a64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57q45LiK55qE5b2p6Jm5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710348&amp;x-signature=FojvwJoqJewMZytrIT%2BgBHBzW%2BU%3D" alt="image-20251115002917639.png" loading="lazy"/></p>
<p>这套部署流程对于日常开发来说是非常省事且多环境的可拓展性也很强。</p>
<h2 data-id="heading-4">多环境的解决方案</h2>
<p>目前公司项目的环境分为三个大环境，每个大环境有三个小环境，解释起来也很简单，就是公司每在一个地区落地，就要根据政策把服务器部署在本地，所以大环境就是地区服，每个地区服又要分测试环境、预发环境和生产环境，这样算下来一个项目就会有九个环境，目前的运作方式就是三个大环境三个 <code>git</code> ，每个 <code>git</code> 内再用三个环境分支分别用作部署，这样的弊端就是每次完成一个需求都要对另外两个 <code>git</code> 进行代码同步，而且时不时还会有不同环境不同需求的情况。久而久之，每个需求的工作成本基本上都要翻倍，因为要花时间去处理大环境同步及差异。</p>
<p><code>vben5</code> 在处理环境使用的 <code>dotenv</code> ，在项目中都是通过 <code>import.meta.env.xxx</code> 访问环境变量，所以涉及到不同环境的差异代码写法如下：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script lang="ts" setup&gt;

const pageTitle = import.meta.env.VITE_PAGE_TITLE;
const pageDesc = import.meta.env.VITE_PAGE_DESC;
const isProduction = import.meta.env.VITE_GLOB_APP_BUILD_TYPE !== 'qa';

&lt;/script&gt;

&lt;template&gt;
  &lt;AuthPageLayout
    :is-production="isProduction"
    :page-description="pageDesc"
    :page-title="pageTitle"
  /&gt;
&lt;/template&gt;

</code></pre>
<p>其中 <code>VITE_PAGE_TITLE</code> 与 <code>VITE_PAGE_DESC</code> 在不同环境 <code>env</code> 文件中的定义如下：</p>
<pre><code class="hljs language-env" lang="env">#.env.production.yc
VITE_GLOB_APP_BUILD_TYPE=product
# 环境常量
VITE_PAGE_TITLE=医疗后台-银川
VITE_PAGE_DESC=欢迎登录银川医疗后台！

#.env.production.nj
VITE_GLOB_APP_BUILD_TYPE=product
# 环境常量
VITE_PAGE_TITLE=医疗后台-南京
VITE_PAGE_DESC=欢迎登录南京医疗后台！
</code></pre>
<p>对应的运行与打包指令如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  ...
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build:yc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm vite build --mode production.yc"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build:nj"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm vite build --mode production.nj"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev:yc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm vite --mode development.yc"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev:nj"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm vite --mode development.nj"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  ...
<span class="hljs-punctuation">}</span>
</code></pre>
<p>结合之前的部署方案，只需要在<code>Dockerfile</code> 中指定对应的 <code>build</code> 指令即可完成对应环境的打包部署。</p>
<h2 data-id="heading-5">组件化和模块化</h2>
<p>简单来说，<strong>模块化“拆逻辑”，将复杂功能拆分为独立的逻辑单元，解决代码复用和依赖管理问题；组件化“拆 UI”，将页面拆分为独立的 UI 单元，解决界面复用和维护问题。</strong> 但在实践过程中，会对这两个概念有新的认知与补充。</p>
<p>比如说我现在有一个复杂的表单页面，涉及到两个表单以及多个动态表格，以模块化的思维大量的逻辑函数将会被定义，又因为表单表格具有独特性，不存在复用的场景，所以按理说写到一个<code>vue</code>文件中即可。结果就导致了单个文件的代码量会达到一个让人抓狂的地步，而且后续的维护，大家也会有一种惯性就是，之前都这么写的我再往后面加就行。</p>
<p>另一个场景，有一个业务弹窗组件复用性很高，但是每次都需要对组件引入、注册、状态管理、销毁等等操作，重复的代码好像也会有很多，如果是别人看到这种调用方式，可能还会放弃复用你的组件。</p>
<p>这肯定不是解决问题的方式，所以这时候我们需要对组件化与模块化有更多的理解。</p>
<ul>
<li><strong>对于有明确UI单元的功能但没有复用场景，也应拆分成独立组件，复用只是自然结果，而非唯一目的。</strong></li>
<li><strong>将具有复用性与需要独立管理生命周期的组件进一步封装，采用 <code>useHook</code> 方式进行调用。</strong></li>
</ul>
<p>首先，没有复用场景的组件在引入页面组装功能的时候，类似语意化的<code>html</code>标签，对比拆分单个方法的模块化最小单元，这可以说是更高一级的模块化方式，将一堆具有逻辑关联的模块与UI单元内聚到一个文件中，在定位需求或者问题的时候能够快速找到最核心的一块代码，从而提升效率。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;Card title="基本信息" class="mb-4"&gt;
      &lt;BaseInfoForm&gt;
        &lt;template #comboGoods="slotProps"&gt;
          &lt;ComboGoodsTable ref="comboGoodsTableRefs" v-bind="slotProps" /&gt;
        &lt;/template&gt;
      &lt;/BaseInfoForm&gt;
    &lt;/Card&gt;
    &lt;CouponProductTable ref="couponProductTableRef" @change="generateComboOptions" /&gt;
    &lt;VipProductTable ref="vipProductTableRef" @change="generateComboOptions" /&gt;
  &lt;/div&gt;
&lt;/template&gt;

</code></pre>
<p>其次，对具有生命周期的组件进行<code>hook</code>式封装是非常实用的一种方式，比如我现在有一个日志弹窗，需要在系统各处实用，那么我们先对弹窗组件进行封装，如下：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script lang="ts" setup&gt;
...

const [Modal, modalApi] = useVbenModal({
	...
  onOpened() {
    logInfo.value = modalApi.getData&lt;Record&lt;string, any&gt;&gt;();
    gridApi.query();
  },
});

const gridOptions: VxeTableGridOptions&lt;LogRowType&gt; = {
  ...
};

const [Grid, gridApi] = useVbenVxeGrid({
  gridOptions,
});
  
defineExpose({ modalApi });
&lt;/script&gt;
&lt;template&gt;
  &lt;Modal class="w-[780px]" title="日志"&gt;
    &lt;Grid /&gt;
  &lt;/Modal&gt;
&lt;/template&gt;
</code></pre>
<p>如果直接对上面的组件进行调用是这样的：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script lang="ts" setup&gt;
  import Log from '#/components/LogModal/Log.vue';
  
  const log = ref&lt;InstanceType&lt;typeof Log&gt;&gt;();
  
  const openLog = ()=&gt; {
    log.value.modalApi.setData({ logType: 1, objectId: 1 }).open();
  }
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;Log ref="log" /&gt;
    &lt;Button @click="openLog"&gt;日志&lt;/Button&gt;
  &lt;/div&gt;	
&lt;/template&gt;
</code></pre>
<p>其实 <code>vben5</code> 对于弹窗组件已经有了很好的封装，已经能用很简单的方式进行弹窗的调用，虽然组件内部已经管理好弹窗的显隐，但是我们依旧要引入组件并且写到页面结构中去，这时候我们可以写一个 <code>hook</code> 去再次封装 <code>Log</code> 组件。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ExtendedModalApi</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/common-ui'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">VxeGridPropTypes</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/plugins/vxe-table'</span>;
<span class="hljs-keyword">import</span> { h, render } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { useVbenModal } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/common-ui'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Log</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Log.vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useLog</span>(<span class="hljs-params"/>): {
  <span class="hljs-title class_">LogModalApi</span>: {
    <span class="hljs-attr">open</span>: <span class="hljs-function">(<span class="hljs-params">data: {
      /** 日志类型 */
      logType: <span class="hljs-built_in">number</span>;
      /** 日志对象参数 */
      objectId?: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>;
    }</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  };
} {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">container</span>: <span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">currentModalApi</span>: <span class="hljs-title class_">ExtendedModalApi</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">createModal</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (container?.<span class="hljs-property">parentNode</span>) {
      <span class="hljs-title function_">render</span>(<span class="hljs-literal">null</span>, container);
      container.<span class="hljs-title function_">remove</span>();
    }

    container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    container.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'id'</span>, <span class="hljs-string">'log-modal'</span>);
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">append</span>(container);

    <span class="hljs-keyword">const</span> [<span class="hljs-title class_">Component</span>, <span class="hljs-title class_">ModalApi</span>] = <span class="hljs-title function_">useVbenModal</span>({
      <span class="hljs-attr">connectedComponent</span>: <span class="hljs-title class_">Log</span>,
      <span class="hljs-attr">onClosed</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (container) {
          <span class="hljs-title function_">render</span>(<span class="hljs-literal">null</span>, container);
          container.<span class="hljs-title function_">remove</span>();
        }
        container = <span class="hljs-literal">null</span>;
        currentModalApi = <span class="hljs-literal">null</span>;
      },
    });

    <span class="hljs-keyword">const</span> <span class="hljs-title class_">Node</span> = <span class="hljs-title function_">h</span>(<span class="hljs-title class_">Component</span>, {});
    <span class="hljs-title function_">render</span>(<span class="hljs-title class_">Node</span>, container);

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ModalApi</span>;
  };

  <span class="hljs-keyword">return</span> {
    <span class="hljs-title class_">LogModalApi</span>: {
      <span class="hljs-attr">open</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
        currentModalApi = <span class="hljs-title function_">createModal</span>();
        currentModalApi.<span class="hljs-title function_">setData</span>(data).<span class="hljs-title function_">open</span>();
      },
    },
  };
}
</code></pre>
<p>对 <code>Log</code> 组件二次封装后，调用方式就变成了如下写法：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script lang="ts" setup&gt;
import { useLog } from '#/components';

const { LogModalApi } = useLog();

const log = () =&gt; {
  LogModalApi.open({ logType: 1, objectId: 1 });
};
&lt;/script&gt;

&lt;template&gt;
  &lt;div @click="log"&gt;日志&lt;/div&gt;	
&lt;/template&gt;
</code></pre>
<p>进一步精简了业务页面上的代码量，当然如果有额外需求，只需要对 <code>useLog</code> 进行参数拓展以及 <code>Log</code> 组件业务拓展。</p>
<p><strong>总结</strong></p>
<ul>
<li><strong>组件化的核心是“边界隔离”，而非 “代码复用”</strong></li>
<li><strong>“组件 + Hook”的模式，实现了“能力复用” 而非“代码复制”</strong></li>
</ul>
<h2 data-id="heading-6">数据处理与优化思路</h2>
<p>我相信大多数前端开发者和我有同样的感受，就是后端返回的数据结构很多时候不是我们想要的，需要我们重新处理，或者说我们在做数据处理的时候更多的是考虑功能的实现，至于可维护性要么交给注释，要么没有。于是“屎山代码”的雏形慢慢形成。</p>
<p>于是可以归纳的前端项目难以维护的几个点是：</p>
<ul>
<li><strong>数据结构不匹配是常态</strong>：后端往往从业务逻辑、数据库设计、性能角度返回数据（比如嵌套过深、字段命名不统一、冗余字段多、数组结构不符合前端渲染需求），前端为了实现功能，只能在代码里加大量转换逻辑，比如循环遍历重组数组、解构嵌套对象、字段映射（把<code>user_name</code>转成<code>userName</code>）、过滤冗余数据等。</li>
<li><strong>初期只关注功能实现，忽略可维护性</strong>：开发时为了赶进度，这些转换逻辑往往写得零散（比如在组件里直接写、在请求回调里硬编码），既没有抽成通用工具函数，也没有统一的处理规范，顶多加几句注释（甚至不加）。</li>
<li><strong>技术债务逐步堆积</strong>：当需求迭代（比如后端字段调整、前端渲染逻辑变化），这些零散的转换逻辑会被反复修改、叠加，最终变成改一处崩多处的“屎山代码”——比如 A 组件改了字段映射，B 组件忘了同步，导致页面报错；或者新人接手时，根本看不懂一堆<code>map/filter/reduce</code>到底在处理什么。</li>
</ul>
<p>其实很多前端性能上的问题都是在这一过程中损失的，即使我们做好了首屏加载、打包文件分割、样式优化等等，有时我们还会觉得“卡卡的”，那些对对象滥用的操作，都在无形中增加对内存的损耗，可以参考我之前的文章<a href="https://juejin.cn/post/7093160633998245918" target="_blank" title="https://juejin.cn/post/7093160633998245918">【从V8引擎的角度去看看JS对象模型的实现与优化】</a>。</p>
<p>所以需要明确的是，<strong>前端的核心价值是“交互和渲染”</strong>，而非 “数据结构的二次重构”，过度的前端数据处理属于 “无效的技术成本”。<strong>前端不是“后端数据的被动加工者”，而是和后端协同定义数据的“参与者”，过度的前端数据加工会埋下可维护性的坑，而高效的前后端协作能从根源减少无意义的前端逻辑堆积。</strong></p>
<p>其实话说到这<strong>前端中间层</strong>的必要性已经呼之欲出了，<strong>把数据结构适配的成本从前端代码层转移到前后端协商层</strong> ，或许才是这个问题最合理的解决方式，既不用后端改变固有设计与逻辑，也不用前端二次数据开发。当然开发中间层是有很大的成本在里面的，是选用低成本的多沟通还是前端花时间自己在中间层处理想要的数据，这就要根据每个人当前工作环境而定了。</p>
<p>当然做中间层我们也要明确中间层的职责：</p>
<ol>
<li><strong>避免过度设计</strong>：中间层只做数据适配，不做业务逻辑（比如订单计算、权限判断仍由后端核心服务负责），否则会变成新的 “屎山”。</li>
<li><strong>保持轻量</strong>：中间层的接口要一对一适配前端页面 / 组件，避免设计成通用接口（比如一个接口适配多个页面，后期改造成本高）。</li>
</ol>
<p>总而言之，<strong>前端要跳出“被动加工数据”的思维，用协作降低无意义的开发成本</strong>。</p>
<h2 data-id="heading-7">交互复杂度</h2>
<p>在AI盛行的当下，作为一名前端开发，如果还是只注重功能实现，那么网上铺天盖地的AI取代前端或许真的不遥远了。</p>
<p>前面提到<strong>前端的核心价值是“交互和渲染”</strong>，所以我理解前端应当从「功能实现导向」转向「用户体验 + 工程效率双导向」的设计与开发思维。首先说两个我在日常开发或者做重构的基本思维：</p>
<ul>
<li><strong>交互复杂度是决定用户体验的重要因素。</strong></li>
<li><strong>表单设计应当以降低交互复杂度为主要考量，复杂逻辑简化交互，简单交互高度组件化。</strong></li>
</ul>
<p>说到这有人可能会觉得这应该是设计或者交互该考虑的事，但是实际情况是前端有时候必须考虑一些除技术外的东西，且不说很多公司是没有交互这一个专门的职位，大多数后台是没有交互设计的，就是拿组件去堆，设计很多时候也只是根据产品原型图去实现，能给到开发的图其实是很平面化的，开发处理不好好各个页面或者组件之间的衔接交互，是直接影响用户体验的。</p>
<p>之前看过一个统计，说每多一个弹窗用户留存率降低70%，看到这个数据我的第一感觉是比我预想的要多很多，这也更加确立了我在处理任何带有弹窗交互需求的时候都会考虑一下是否真的有必要。</p>
<p>我上面也单独把表单设计拎了出来，因为表单是前端最常见但也最易出体验问题的场景，其核心痛点就是「交互复杂度失控」：</p>
<ul>
<li>要么把复杂业务逻辑直接暴露给用户（比如多步骤、多校验、多关联字段的表单，让用户反复填、反复改）</li>
<li>要么把简单交互过度工程化（比如一个单行输入框，拆成多层组件、加一堆冗余逻辑，导致开发效率低、维护成本高）</li>
</ul>
<p>所以我的解决思路就是：</p>























<table><thead><tr><th>表单场景</th><th>核心问题</th><th>解法核心</th><th>最终目标</th></tr></thead><tbody><tr><td>复杂逻辑的表单</td><td>交互复杂度高→用户易出错 / 放弃</td><td>简化交互（把复杂藏在底层）</td><td>降低用户认知 / 操作成本，提升完成率</td></tr><tr><td>简单交互的表单</td><td>开发效率低→重复造轮子</td><td>高度组件化（封装通用能力）</td><td>提升开发效率，保证交互一致性</td></tr></tbody></table>
<p>表单的本质是「用户完成信息录入的工具」，而非 “展示技术能力的载体”：</p>
<ul>
<li>用户对表单的核心诉求是<strong>快速、准确、无阻碍地完成提交</strong>，而非体验炫酷的交互。</li>
<li><strong>交互复杂度越高，用户的认知负荷和操作成本就越高</strong>，最终表现为表单完成率低、错误率高。</li>
<li>反之，即使业务逻辑复杂（比如电商商品编辑、优惠券编辑），只要把交互拆解得足够简单（比如分步引导、字段联动自动填充、错误提示精准），用户也能顺畅完成。</li>
</ul>
<p>这一点也印证了 UX 领域的经典原则：<strong>“把复杂留给自己，把简单留给用户”</strong> —— 表单体验的好坏，本质是 “开发者能否把复杂的业务逻辑，转化为用户可感知的简单交互”。</p>
<p>针对以上问题，C端通常有业务、产品、设计多个部门在把关，相对来说前端的实现上的主观性会弱很多，而B端则没有这么多要求，也就通常是表单设计的重灾区。虽然B端不存在用户留存率，但是难用的操作逻辑确实增加了用户对研发的不满情绪。</p>
<p>有一次业务和我吐槽配了一些营销策略到系统中，本来逻辑不复杂，但是配置花了将近一下午。从那之后，我在做表单类的需求时，潜意识都会考虑这个表单除了完成功能之外到底好不好用，所以我后来在做系统重构时，将所有涉及到复杂表单的场景全部进行了彻彻底底的交互上的重构，原来需要两个、三个弹窗处理的配置，全部设计成最多一个弹窗完成。当然重新设计的过程中也要时刻与产品业务做好沟通与同步，询问他们的意见，了解用户的真实需求。</p>
<h2 data-id="heading-8">正确理解需求迭代</h2>
<p>相信大家都玩过俄罗斯方块，我觉得每一个需求就是一个下落的方块，把它落在哪个地方，如何和已有的方块密切贴合，或者给未来落下的方块腾空间，决定了这个游戏我们能玩多久。</p>
<p><strong>需求迭代不应是功能的简单堆砌，而是功能的不断整合。</strong> 要想维护好前端的工程化，我们必须从「被动接需求」变为「主动做治理」，需求迭代的本质不是 “加一行代码、加一个功能”，而是通过<strong>整合（收敛冗余）、优化（提效降本）、重构（解耦升级）</strong>，让代码体系随需求增长更有序而非更臃肿，所以需求迭代就成了<strong>持续重构系统边界、收敛重复逻辑、提升整体内聚性</strong>的过程。</p>
<p><strong>为什么 “功能堆砌” 是前端的致命伤？</strong></p>
<p>前端最容易陷入 “需求来了就加代码” 的堆砌式迭代，最终导致：</p>
<ul>
<li><strong>逻辑冗余</strong>：相似功能写多套（比如 3 个页面都有 “状态筛选”，却写了 3 套筛选逻辑，原因就是每次封装的组件业务性强，最后复用性变差）</li>
<li><strong>交互碎片化</strong>：同一类操作（比如 “弹窗关闭”）在不同页面有不同交互，用户体验割裂（长期迭代下没有对之前过时的交互进行整合）</li>
<li><strong>维护成本指数级上升</strong>：改一个基础逻辑（比如 “手机号校验规则”），要改 10 个地方</li>
<li><strong>技术债务堆积</strong>：旧代码不敢动，新需求只能绕着写，最终形成 “屎山”</li>
</ul>
<p>那么，前端如何落地 “整合 + 优化 + 重构” 的迭代思维？</p>
<h3 data-id="heading-9">整合</h3>
<p>整合是我在做系统重构的过程中最早规划的，核心是<strong>把分散、重复的功能逻辑收敛到统一的模块 / 组件中</strong>。要想把整合做好，最重要的是熟知业务，如果没有完整便捷的文档，想要完整了解业务最好是通过阅读代码逻辑抽丝剥茧，总结流程图、逻辑图。</p>
<p><strong>1、识别 “相似功能”，收敛到通用层</strong></p>
<p>正如前文中提到的 <code>Log</code> 组件，在重构的视角下，能从全局角度去总结所有场景下的通用性，不重复写弹窗逻辑，而是抽象 <code>通用日志弹窗组件 + useLog Hook</code>，把 “日志类型、数据结构” 等作为参数，让所有日志弹窗复用同一套逻辑；核心思维就是<strong>从 “为单个需求写功能” 转向 “为一类需求抽象能力”</strong>。</p>
<p><strong>2、整合 “碎片化交互”，统一交互规范</strong></p>
<p>在公司之前的系统中，涉及到表格内编辑时，有时需要点击编辑切换整行可编辑状态，有的需要弹出一个表单再编辑，有的则可以直接在行内进行编辑，碎片化的交互随处可见。整合之后，所有的交互变为单元格点击编辑的方式，不再自定义交互，避免体验碎片化。</p>
<p><strong>3、整合 “数据请求 / 处理逻辑”，收敛到中间层 / Hook</strong></p>
<p>因为使用 <code>vben5</code> 框架，对于请求数据处理的封装已经全部收敛到对应的模块中去，不需要再去重复造轮子。实践来说比如全局对用户信息的调用频繁，那我们可以把用户信息的请求、数据转换、缓存逻辑封装到 <code>useUser</code> Hook 中，所有页面通过 Hook 获取数据，迭代时只需维护 Hook 内的逻辑。</p>
<h3 data-id="heading-10">优化</h3>
<p>“优化” 是在整合基础上，对现有逻辑做 “减法” 和 “提效”，核心是「<strong>消除冗余代码、提升性能 / 开发效率</strong>」，而非 “加新功能”。</p>
<p><strong>1、代码层面：剔除冗余逻辑，简化实现</strong></p>
<p>冗余逻辑都是从哪来的？根据我的开发经验来说，所有类似“这段逻辑先留着，以后可能会用到”、“老的逻辑/组件/页面别删，加一个新的就好”这些话术，其本质就是开发过程中的偷懒，因为不想多花点时间去了解前后业务逻辑，将所有的不确定留在项目代码中，技术债务成本随之而来。</p>
<p>即使未来真的可能需要用到，一是可以从提交记录中恢复，二是即使能用到大概率也需要调整，在理解老代码的逻辑过程中，或许都已经自己实现了。</p>
<p><strong>2、性能层面：明确优化方案，准确突破性能瓶颈</strong></p>
<p>我面试过很多人，问到前端优化方案，无非都是首屏加载、打包文件分割、样式优化这些，再问一下具体场景的分析与实现，意为你通过什么样的分析判断页面需要进行什么样的优化时，大多数人又磕磕巴巴说不出个所以然来。</p>
<p>其实我们完全可以通过浏览器内置的分析工具，去分析页面加载、页面渲染、页面节点数、页面事件数、内存占用等等各种指标，去发现问题所在，那么我们再去优化时就会明确自己的优化预期是什么样的，而不是随便从网上找一堆优化大杂烩堆到项目中去。</p>
<p><strong>3、开发层面：优化交互方式，降低接入成本</strong></p>
<p>多考虑弹窗交互是否可以优化，通过合理的交互设计，避免使用多弹窗交互。还有我之前提到的 <code>useLog</code> 组件的实现，进一步的封装不仅极致简化组件的调用代码，也让 “整合后的能力” 更易用，避免 “整合后反而增加开发成本”。</p>
<p>当然除了组件复用的优化还有接口复用，最常见的就是字典类型的接口，用于各种需要调用后端接口的下拉框，这时候我们可以合理利用 <code>vue-query</code> 这种缓存库，对接口返回信息进行缓存，降低接口的重复调用率，不仅节省了服务器资源，也让前端的体验更优。</p>
<h3 data-id="heading-11">重构</h3>
<p>“重构” 是在整合 / 优化的基础上，对 “不合理的架构 / 边界” 做调整，核心是「让代码体系适配长期需求，而非仅满足当下」—— 重构不是 “推翻重写”，而是 “小步迭代式升级”。<strong>重构需要我们在某一段时间花费大量时间去思考架构/模块的设计，不仅是为了找出当下最优解，也要为未来可能的升级或改变留下空间。</strong></p>
<p><strong>1、边界重构：拆分 “职责混乱” 的模块</strong></p>
<p>其实我在做系统重构的时候经常会推翻之前某一类代码的写法，比如我写一个表格内的单元格编辑省缺值组件，一开始可能只是在某个编辑场景中使用，所以写法也没太多的封装。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script lang="ts" setup&gt;
import { isEmpty } from '@vben/utils';

const props = defineProps&lt;{
  placeholder?: string;
  prefix?: string;
  value: any;
}&gt;();

const {
  value,
  placeholder = '点击编辑',
  prefix = '',
} = props;
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;span class="cursor-pointer" v-if="!isEmpty(value)"&gt;
      {{ prefix }}{{ value }}
    &lt;/span&gt;
    &lt;span class="cursor-pointer text-gray-400" v-else&gt;
      {{ placeholder }}
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>再后来的重构过程中，我发现处理表格内编辑省缺值的情况很多，而且每次遇到写在表格的 <code>slot</code> 中很麻烦，于是将代码中所有适用的情况都找了一下，几次完善后，组件最终如下：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script lang="ts" setup&gt;
import { isEmpty, isNumber } from '@vben/utils';

const props = defineProps&lt;{
  booleanMap?: {
    falseText: string;
    falseValue?: any;
    trueText: string;
    trueValue?: any;
  };
  multiple?: boolean;
  options?: Array&lt;{ label: string; value: any }&gt;;
  placeholder?: string;
  prefix?: string;
  type?: 'boolean' | 'number' | 'select' | 'string';
  value: any;
}&gt;();

const {
  type = 'string',
  value,
  booleanMap = {
    trueText: '是',
    falseText: '否',
    falseValue: false,
    trueValue: true,
  },
  options = [],
  multiple = false,
  placeholder = '点击编辑',
  prefix = '',
} = props;

const formatSelected = (val: any) =&gt; {
  if (multiple) {
    return options
      .filter((item) =&gt; val.includes(item.value))
      .map((item) =&gt; item.label)
      .join(',');
  }
  return options.find((item) =&gt; item.value === val)?.label ?? val;
};
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;template v-if="!isEmpty(value)"&gt;
      &lt;span class="cursor-pointer" v-if="type === 'string'"&gt;
        {{ prefix }}{{ value }}
      &lt;/span&gt;
      &lt;span
        class="cursor-pointer"
        v-else-if="type === 'number' &amp;&amp; isNumber(Number(value))"
      &gt;
        {{ prefix }}{{ value }}
      &lt;/span&gt;
      &lt;span class="cursor-pointer" v-else-if="type === 'boolean'"&gt;
        {{
          value === booleanMap.trueValue
            ? booleanMap.trueText
            : booleanMap.falseText
        }}
      &lt;/span&gt;
      &lt;span class="cursor-pointer" v-else-if="type === 'select'"&gt;
        {{ formatSelected(value) }}
      &lt;/span&gt;
    &lt;/template&gt;
    &lt;span class="cursor-pointer text-gray-400" v-else&gt;
      {{ placeholder }}
    &lt;/span&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>边界重构的核心实现还是组件化，在开发中不断回头发现可以整合优化的地方，就像玩俄罗斯方块一样把它们放在一排，然后就可以安心消除（安心调用）了。</p>
<p><strong>2、架构重构：升级通用层，分离框架与业务</strong></p>
<p>我最喜欢 <code>vben5</code> 的地方在于它很好的实现了 <code>monorepo</code> 架构，<strong>场景化拆分解决了中后台项目重复封装通用能力的痛点</strong>。所有非业务的代码都可以放在 <code>packages</code> 中，项目代码对通用能力的调用就如同引用一个三方库，这让我在重构业务代码和学习框架代码之间切换明确，也让我在重构的过程中有了更多的思考，如：如何将一个业务通用能力抽象为一个框架通用能力。</p>
<p><strong>3、小步重构：避免 “大重构风险”</strong></p>
<p>做好这点原则是每次迭代只重构 “当前需求涉及的不合理逻辑”，而非一次性重构整个模块。其实我在做系统重构就是一整个系统的大重构，在重构落地的过程中会发现各种风险无法规避，不管是测试压力，还是需求同步，都是越到后面越难推进，这也是大重构最大的副作用。所以想要规避，就要明确重构的边界，确保测试可以完全冒烟。<strong>重构不是一个人的事，是协调产品、测试这些上下游对口部门的统一规划。</strong></p>
<h2 data-id="heading-12">注释</h2>
<blockquote>
<p>当你感觉需要写注释时，请先尝试重构，试着让所有注释都变得多余。</p>
<p>如果你不知道该做什么，这才是注释的良好运用时机。除了用来记述将来的打算之外，注释还可以用来标记你并无十足把握的区域。你可以在注释里写下自己“为什么做某某事”。这类信息可以帮助将来的修改者或者健忘的自己。</p>
</blockquote>
<h2 data-id="heading-13">研发价值</h2>
<p>我不知道在AI盛行的当下，大家有没有考虑过现在的研发价值到底是怎么体现的。根据 Linux 基金会发布的《2025 年全球科技人才状况报告》，AI 正在重塑工作，而非消灭工作，这种 "重构革命" 深刻改变着科技行业的人才需求格局，推动研发人员的价值认知转型。</p>
<p>很多人认为做业务开发显得没那么有挑战性，但其实正好相反。最难解决的bug是无法重现的bug，最难处理的问题域是不确定性的问题域。业务往往是最复杂的，面向不确定性设计才是最复杂的设计。软件工程学科最难的事情是抽象，因为它没有标准、没有方法、甚至没有对错。如何在软件固有的复杂性上找到一条既不过度也不缺失的路，是软件工程师的终身课题，或许永远也无法达到，或许我们已经在路上了。</p>
<p>综上所述，我理解的研发价值分为三个阶段：</p>
<ol>
<li><strong>技术知识的掌握、技术选型的判断力，以及用技术解决实际问题的能力</strong>。</li>
<li><strong>对业务逻辑的深度理解、日常业务问题的快速解决，以及通过系统整合 / 优化提升业务效率与用户体验的能力</strong>。</li>
<li><strong>准确理解各方（产品、业务、测试）意图，在沟通中降低协作摩擦、提供情绪价值，给予最优实现方案</strong>。</li>
</ol>
<h3 data-id="heading-14">一阶段</h3>
<p>作为技术研发，技术知识的掌握一定是我们立身的根本，一方面是技术的深度，另一方面是技术的广度。<strong>技术深度决定了我们的技术能力和解决问题能力，技术广度决定了我们如何理解不同技术栈之间的协作关系，能够根据项目需求进行合理的技术选型。</strong></p>
<p>企业研发的技术能力，不只是 “会用技术”，更重要的是 “选对技术”。比如：能用 <code>Vue3</code> 写页面是运用能力，但能判断这个后台项目用 <code>Vue3+Element Plus</code>，还是<code>React+Ant Design</code>，能解决 “大数据量表格卡顿” 这类实际问题，才是企业需要的技术价值。</p>
<blockquote>
<p>基于AI发展迅速的大环境下，基础技术的价值正被快速剥离，技术人的价值重心正在悄然发生改变。生成式 AI 在代码领域的应用已进入成熟期，基础代码编写效率提升数倍，一个能够用好 AI 的研发人必然有了额外的价值。或许在不远的未来，传统的 "代码编写" 能力将不再是核心竞争力，研发人员能够<strong>定义 AI 工作边界，掌握 AI 工具的使用和优化，学会与 AI 协作完成技术工作</strong>或许才是最终目标。</p>
</blockquote>
<h3 data-id="heading-15">二阶段</h3>
<p>有了技术基础，我们开始逐渐融入不同的业务中去，正如业内专家所言，"理解业务的深刻程度决定了发展上限"。这种理解不是简单的需求翻译，而是能够穿透业务表象，理解功能背后的用户痛点、商业逻辑和战略目标。</p>
<p>所以处理日常问题只是业务能力的基础，<strong>通过深度理解业务，将业务问题转化为技术问题，用技术手段实现业务目标。</strong> 同时也要求我们具备技术前瞻性，能够预判技术趋势对业务的影响，提出具有创新性的技术解决方案。所以一阶段的基础越扎实，二阶段的业务整合就会更游刃有余。</p>
<h3 data-id="heading-16">三阶段</h3>
<p>这一阶段本质上是有了前两阶段沉淀后的协作共赢，其核心价值在于<strong>通过高效协作放大个人和团队价值</strong>。最优实现方案在企业中往往不是“技术最优”，而是 <strong>“业务价值、研发成本、时间周期”三者平衡的全局最优方案</strong> ；同时，“情绪价值” 的核心是<strong>对齐预期、降低协作摩擦</strong>，比如：产品提了一个复杂需求，研发不是直接说 “做不了”，而是说 “这个需求可以拆成两步，第一步先实现核心功能，成本低、见效快，第二步再优化体验”—— 这既提供了情绪价值，又给出了可行方案。</p>
<p>在沟通协调能力方面，研发人员需要具备跨职能团队协作能力，能够与产品、运营、测试、设计等团队有效沟通，协调各方利益，推动项目顺利进行。这种能力不仅体现在技术沟通上，更体现在能够用非技术语言向业务人员解释技术方案，用业务语言向技术人员传达需求。要想做好这些，前两阶段的积累必不可少。</p>
<h2 data-id="heading-17">最后</h2>
<p>因为在重构过程中不断向<code>vben5 github</code>提交<code>issues</code>和<code>pull request</code>，我也有幸成为了开源共建者。</p>
<p>在着手这次重构时，我不会想到自己最后会有这么多思考与感悟，可能有人会觉得系统能用就行，为什么要去折腾，我想用《人月神话》中我最喜欢的一句话作答。</p>
<p><strong>这个行业需要我们掌握更先进的开发要素和工具，经论证的管理方法和最佳应用，良好判断的自由发挥，以及保持谦卑。</strong></p>
<h2 data-id="heading-18">相关引用</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F868332" target="_blank" title="https://developer.aliyun.com/article/868332" ref="nofollow noopener noreferrer">系统困境与软件复杂度，为什么我们的系统会如此复杂</a></p>
<p>《重构：改善既有代码的设计》</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[程序员必备！一款免费的（原文/译文）AI 双语对照网页翻译插件，信息获取效率飙升！]]></title>    <link>https://juejin.cn/post/7589212818808225855</link>    <guid>https://juejin.cn/post/7589212818808225855</guid>    <pubDate>2025-12-30T14:46:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589212818808225855" data-draft-id="7589466706379145252" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="程序员必备！一款免费的（原文/译文）AI 双语对照网页翻译插件，信息获取效率飙升！"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-30T14:46:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            程序员必备！一款免费的（原文/译文）AI 双语对照网页翻译插件，信息获取效率飙升！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:46:17.000Z" title="Tue Dec 30 2025 14:46:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在信息爆炸的时代，掌握一手外文资料往往意味着抢占先机。然而，语言障碍常常成为程序员高效学习与工作的绊脚石。今天大姚给大家分享一款自己觉得非常实用且一直在用的一款免费的（原文/译文）AI 双语对照网页翻译插件：<strong>沉浸式翻译</strong>，一键开启双语阅读，提升信息获取效率。</p>
<h2 data-id="heading-1">插件介绍</h2>
<p><strong>沉浸式翻译</strong> 是一款免费的（原文/译文）AI 双语对照网页翻译插件，它不仅支持网页、PDF、视频字幕和电子书的双语对照翻译，还兼容 DeepL、OpenAI、Deepseek、Gemini 等主流 AI 翻译引擎，真正实现“所见即所得”的无缝阅读体验。一键开启双语阅读，提升信息获取效率。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b9a9060d04047488eb6fd7682fb49d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=P%2BKsITEde3PuqR9FHssNLUliNNU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f9f7c255fc7410780a9ff2dd6903ceb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=NdjUzxsZINqkKtfL4YbllW0%2Bdj0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">应用场景</h2>
<ul>
<li><strong>外文资料查阅</strong>：帮助用户快速查阅并理解外文网页、学术论文、商业文件等。</li>
<li><strong>视频学习</strong>：支持主流视频网站的双语实时字幕，辅助外语学习。</li>
<li><strong>电子书阅读</strong>：将外文电子书转化为双语版本，提升阅读体验。</li>
<li><strong>跨语言沟通</strong>：在输入框中直接翻译文本，辅助跨语言写作和对话。</li>
</ul>
<h2 data-id="heading-3">插件安装</h2>
<h3 data-id="heading-4">微软Edge浏览器安装</h3>
<ul>
<li>插件安装地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoftedge.microsoft.com%2Faddons%2Fdetail%2F%25E6%25B2%2589%25E6%25B5%25B8%25E5%25BC%258F%25E7%25BF%25BB%25E8%25AF%2591-%25E7%25BD%2591%25E9%25A1%25B5%25E7%25BF%25BB%25E8%25AF%2591%25E6%258F%2592%25E4%25BB%25B6-pdf%25E7%25BF%25BB%25E8%25AF%2591-%2Famkbmndfnliijdhojkpoglbnaaahippg%3Fform%3DMT001Y%26hl%3Dzh-CN%26gl%3DCN" target="_blank" title="https://microsoftedge.microsoft.com/addons/detail/%E6%B2%89%E6%B5%B8%E5%BC%8F%E7%BF%BB%E8%AF%91-%E7%BD%91%E9%A1%B5%E7%BF%BB%E8%AF%91%E6%8F%92%E4%BB%B6-pdf%E7%BF%BB%E8%AF%91-/amkbmndfnliijdhojkpoglbnaaahippg?form=MT001Y&amp;hl=zh-CN&amp;gl=CN" ref="nofollow noopener noreferrer">microsoftedge.microsoft.com/addons/deta…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/094b6855c54b45f187118c7235460686~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=hJbl9Pj6GFaRCEv2cRggu4%2BqjR4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">Google浏览器安装</h3>
<ul>
<li>插件安装教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fimmersivetranslate.cn%2Fmanual-chrome-extension%2Fzip%2F" target="_blank" title="https://immersivetranslate.cn/manual-chrome-extension/zip/" ref="nofollow noopener noreferrer">immersivetranslate.cn/manual-chro…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc65d09856df4a8f96952fbf3836c573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=S2d%2Bcg2dQE4qwl2C%2FMddwMJa3yE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97fb3d69b04e46439bb50e6b7898de1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=ZRvOS6FWpr0nctkmZln1AlFhR7Q%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01928451f6dc4522914b026c5f913447~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=hwqZMbYGg9CkzuftU%2Fx2qXKLGkA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">插件功能</h2>
<h3 data-id="heading-7">网页双语对照翻译</h3>
<p>沉浸式翻译内置了包括 DeepL、谷歌翻译在内的 10 余种业界顶尖的翻译引擎，是国内外所有同类产品中支持翻译引擎最多的工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53880831f5df441fbb5ed90bada306f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=YPy2uLpn4x8vjmkLMSF8pFG63rQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">视频双语字幕</h3>
<p>沉浸式翻译支持100多个国外主流视频网站的双语实时字幕功能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88b79556017d4234bccd69d408b59658~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=UG7Dh8nfgD%2FJ%2Br0QhEReWcXZkXU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">PDF 对照翻译</h3>
<p>沉浸式翻译支持 PDF 对照翻译，无论您需要阅读外文学术论文，还是处理多语言商业文件，都可以通过沉浸式翻译一键获取优质的翻译结果。 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a74c1d5f8ed43eb9281cdee9318e17f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=aL7sAItdI5YdpePqPnlY%2Beq3TdQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">鼠标悬停翻译</h3>
<p>沉浸式翻译支持鼠标悬停翻译，你只需将鼠标悬停在任意段落，同时按下预设的快捷键（如 Ctrl），当前段落的译文便会立即呈现在段落之后。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16bb30decb8c4d90b426695ed54964be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=O7gzTh863Kvj3GXTpjYJnwYRoug%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">更多 AI 实用效率工具</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcf827fe0ed5442f9143381036023c7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710777&amp;x-signature=UlDqaTWiWxtQeV1eJEnAEgDKnfM%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[精选 8 款 .NET 开源、前后端分离的快速开发框架，提高开发生产效率！]]></title>    <link>https://juejin.cn/post/7589466706379210788</link>    <guid>https://juejin.cn/post/7589466706379210788</guid>    <pubDate>2025-12-30T14:48:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589466706379210788" data-draft-id="7589466706379194404" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="精选 8 款 .NET 开源、前后端分离的快速开发框架，提高开发生产效率！"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2025-12-30T14:48:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            精选 8 款 .NET 开源、前后端分离的快速开发框架，提高开发生产效率！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:48:55.000Z" title="Tue Dec 30 2025 14:48:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>今天大姚给大家分享 8 款 .NET 开源、前后端分离的快速开发框架，这些框架能有效减少 C#/.NET 项目中的重复性工作，显著提升开发效率，助你告别996，轻松高效交付项目！（<strong>注意，以下排名不分先后</strong>）。</p>
<h2 data-id="heading-1">OpenAuth.Net</h2>
<p>OpenAuth.Net 是一个基于 .NET 开源免费（Apache-2.0 License）的权限管理及快速开发框架，.NET 开源最好用的权限工作流系统。它源于 Martin Fowler 的企业级应用开发思想，并结合了最新的技术组合，如 <code>SqlSugar、EF、Quartz、AutoFac、WebAPI、Swagger、Mock、NUnit、Vue2/3、Element-ui/plus、IdentityServer</code> 等。该项目架构易于扩展，文档齐全且免费，特别适合中小企业使用。</p>
<ul>
<li><strong>开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdotnetchina%2FOpenAuth.Net" target="_blank" title="https://gitee.com/dotnetchina/OpenAuth.Net" ref="nofollow noopener noreferrer">gitee.com/dotnetchina…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bda574edd03449acb8b2d4aa9da5aa28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=Kcqt%2B74rfbmsZCPrAdYluoj6lm0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4735a1ac82c64d7487af5528e5d344f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=sUSPENANrVCIFhxTyJVCysQu98E%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2b3763fb3394836b7a4c62df1c977b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=pu9r2xwDWwnYdrpJ59Qh1herAQY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">YuebonCore</h2>
<p>YuebonCore基于.Net8.0的权限管理及快速开发框架，前后端分离，核心模块包括：组织机构、角色用户、权限授权、多系统、多应用管理、定时任务、业务单据编码规则、代码生成器等，整合应用最新技术包括Asp.NetCore MVC、SqlSugar、WebAPI、Swagger、Vue等。它的架构易于扩展，是中小项目的首选。</p>
<ul>
<li><strong>开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fyuebon%2FYuebonNetCore" target="_blank" title="https://gitee.com/yuebon/YuebonNetCore" ref="nofollow noopener noreferrer">gitee.com/yuebon/Yueb…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4c4bbbd562247bb82c0734b79d32717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=zpsrEjUWBM1xEfskprjI3%2FN%2FJ%2FE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2992a0b5575c453182cd343715ca0ae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=0rlJVG6DCuL0jKilsgDxb1t94iM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4a5863d03c9443690f2ad972bd09e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=QHgPGTLP051csztkIQ3t5vTAeRk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">Vue.NetCore</h2>
<p>Vue.NetCore 是一款基于Vue（提供Vue2/Vue3版本）和.Net Core前后端分离、开源免费（MIT License）、强大、跨平台的快速开发框架，并且框架内置代码生成器（解决重复性工作，提高开发效率），支持移动端(iOS/Android/H5/微信小程序）。</p>
<ul>
<li><strong>开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcq-panda%2FVue.NetCore" target="_blank" title="https://github.com/cq-panda/Vue.NetCore" ref="nofollow noopener noreferrer">github.com/cq-panda/Vu…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0de94366c943403096604ebf952b64cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=1H21yyq%2FjiuZ%2F9YX6aHS%2BctYMvI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b320cedb4d947749f2f94e1580f78b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=jnaDNPrXvf8D2KUwmgGpzHhSWwQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db9cc7683ac44790959fd0d51d4da606~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=zJBsaeiHt4zjsh%2FjGMo1IOEK6uY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">SimpleAdmin</h2>
<p>SimpleAdmin是一个小而美的通用业务型后台管理系统，专为解决开发过程中的痛点难点而生。Vue3+Vite+Vuex+JS,并在此基础上增加更人性化功能,后端基于.NET6/7+Furion,ORM采用Sqlsugar+单例模式,插件式开发。采用RBAC+多机构的权限管理模式，实现全网最灵活的接口级别数据权限控制，集成国密加解密，导入导出、导入导出、批量修改等常用插件。后端代码注释覆盖率&gt;90%，并配备超牛皮的代码生成器和超详细的手摸手教学文档，非常适合二次开发。</p>
<ul>
<li><strong>开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fdotnetmoyu%2FSimpleAdmin" target="_blank" title="https://gitee.com/dotnetmoyu/SimpleAdmin" ref="nofollow noopener noreferrer">gitee.com/dotnetmoyu/…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e24ba06ff0e43159c9b28c5ddadc497~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=yPhqjjmLaBvWw5ZjlHAJs8%2F%2Fdds%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f07d0c66fb924a0d8c8aed6556bbf69e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=LAEliOxCHqnEmXtM3fTXHKfr9ZA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f7f0d6fdad346febfc889c7057a1f46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=wQWLOLF2LB1B4X1dzuV9JKBvpiI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">Blog.Core</h2>
<p>Blog.Core一个开箱即用的企业级前后端分离【ASP.NET Core 8.0 Api + Vue 2.x + RBAC】权限框架。</p>
<ul>
<li><strong>开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanjoy8%2FBlog.Core" target="_blank" title="https://github.com/anjoy8/Blog.Core" ref="nofollow noopener noreferrer">github.com/anjoy8/Blog…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccb4fd3b6ce1467fb0374c69bd2e4c5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=OeFQQUTUvBsVjjVGVB1M4wuQf0g%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/291bdf7888044a78a64ab871f3151b30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=ExP%2BblgibBoXkLE03KLdxt2vHOg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cea22d2dc7840c98494f53e54cc8464~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=cWDgsa7TOkZ92rg3a%2FIZ%2BRCPLbo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">WTM</h2>
<p>WalkingTec.Mvvm框架（简称WTM）是基于.net core的快速开发框架。支持Layui(前后端不分离), React(前后端分离),VUE(前后端分离)，内置代码生成器，最大程度的提高开发效率，是一款高效开发的利器。</p>
<ul>
<li><strong>开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdotnetcore%2FWTM" target="_blank" title="https://github.com/dotnetcore/WTM" ref="nofollow noopener noreferrer">github.com/dotnetcore/…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca27e9acf5024a20b5893c6b8ffa99b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=L2otRPzZFXwHGnoRofIQmShKTaA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25f11cd9827e4ae0aa4cee7e07a9c237~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=U8SVmSsqQPwrAi77C159%2BYam1pM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f128838dc684542aa9fbe3d1c01d48e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=waQ%2B1nNYPmkcHEtzvqk6YG14YKk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">DncZeus</h2>
<p>DncZeus是一个基于 .NET 7 + Vue.js 的前后端分离的通用后台管理系统框架。后端使用.NET 7 + Entity Framework Core 构建，UI 则是目前流行的基于 Vue.js 的 iView。项目实现了前后端的动态权限管理和控制以及基于 JWT 的用户令牌认证机制，让前后端的交互更流畅。</p>
<ul>
<li><strong>开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flampo1024%2FDncZeus" target="_blank" title="https://github.com/lampo1024/DncZeus" ref="nofollow noopener noreferrer">github.com/lampo1024/D…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a5b5fe2823e4789a940d0f07df45891~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=aIbxwcl0wBnTjhHv3NWsU7QgIr0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a7bc9f43e3743a584737445c05a971d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=Nt1Y2%2BUoMbr%2FSJRxpjCWy3gj98c%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54ae0bf6b9914bd8af2ceeac917f1f7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=gYhCHcE0rP6NwYspfd%2BK6ZcB%2Bvc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">RuYiAdmin</h2>
<p>RuYiAdmin 一款基于 .NET 9 构建的企业级、前后端分离、开源（Apache License） Web RBAC 快速开发框架，具有灵活的架构设计和强大的功能，适用于快速开发高性能的企业级应用，具有低代码、跨平台、分布式、多线程和高性能等特色。</p>
<ul>
<li><strong>开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fpang-mingjun%2FRuYiAdmin" target="_blank" title="https://gitee.com/pang-mingjun/RuYiAdmin" ref="nofollow noopener noreferrer">gitee.com/pang-mingju…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eda0e80a6b54a7683a72e61f8cd434a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=JXN3WAntZHfMHtch236eoKkdqAA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f765634b7e4c4f65884886b9c787f383~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=dHDf4ky4ej5Edx19OrLMKI6oX7Q%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a353c90c19194d43937d8c332cb655d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767710935&amp;x-signature=kvjcMnb0%2BnfQk06YvCQEWSg6bRw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">优秀项目和框架精选</h2>
<p>本文所有项目都已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。坑已挖，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没</strong>🤞）。</p>
<ul>
<li>GitHub开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li>Gitee开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5 倍性能提升，Apache Doris TopN 全局优化详解｜Deep Dive]]></title>    <link>https://juejin.cn/post/7589513539845636131</link>    <guid>https://juejin.cn/post/7589513539845636131</guid>    <pubDate>2025-12-30T13:26:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589513539845636131" data-draft-id="7589477775210496052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5 倍性能提升，Apache Doris TopN 全局优化详解｜Deep Dive"/> <meta itemprop="keywords" content="数据库,Apache"/> <meta itemprop="datePublished" content="2025-12-30T13:26:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5 倍性能提升，Apache Doris TopN 全局优化详解｜Deep Dive
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T13:26:26.000Z" title="Tue Dec 30 2025 13:26:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常的数据分析和业务报表中，TopN 查询几乎无处不在：无论是寻找销量最高的前十件商品，还是筛选访问量最多的前几条日志，开发者和数据分析师都在频繁处理“前 N 条数据”。然而，<strong>当表的列数达到百余或更多时，一个看似简单的 <code>SELECT * … ORDER BY … LIMIT N</code> 查询，背后可能隐藏着巨大的性能瓶颈</strong>。尽管我们只关心某一列的前 N 条结果，数据库依然可能扫描整张表的所有列，从而导致 IO 读放大（Read Amplification），拖慢查询速度。在大数据场景下，这种低效不仅浪费存储带宽，还直接影响业务决策的实时性。</p>
<p>为了帮助用户快速获取目标数据，<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2F" target="_blank" title="https://doris.apache.org/" ref="nofollow noopener noreferrer">Apache Doris</a>针对 TopN 类型查询进行了全局优化，可将此类查询的性能提升约 5 倍；同时，优化范围也从单表进一步拓展至数据湖场景与多表关联查询，显著扩大了适用范围</strong>。</p>
<h2 data-id="heading-0">TopN 查询优化思路</h2>
<p><strong>为直观说明 TopN 查询的性能瓶颈，我们不妨将其简化为列式存储文件的读取场景，比如访问 Apache Doris 内部 Segment 文件，或访问数据湖中常见的 Parquet / ORC 文件</strong>。</p>
<p>假设需要找“第二列”中，数值最大的那条记录：<code>SELECT * FROM table ORDER BY col2 LIMIT 1</code>。由于查询需要返回整行，传统做法通常是先扫描表的<strong>所有列</strong>，排序后再定位到对应记录。</p>
<p>而 Apache Doris 原生列式存储的物理布局能够提供更优解：由于各列独立存放，因此可先<strong>仅读取第二列</strong>的数据，快速计算出最大值所在的行号；再利用文件元数据，直接按行号提取该行的完整记录，无需扫描无关列。相比传统方式，<strong>这种方法显著减少 IO 读放大并降低内存占用</strong>。</p>
<p><strong>这一优化对于湖仓分析场景尤为关键，因其直接关乎成本及性能</strong>。 对于 Iceberg、Paimon 等开放湖格式，数据通常存放在 S3 等对象存储中，其 IO 性能普遍低于本地磁盘，且常按访问流量或请求次数计费。<strong>数据扫描次数的减少，意味着更低的延迟与更少的费用</strong>。特别是在数据量庞大、查询频繁的分析业务中，TopN 的优化不仅能大幅提升响应速度，更能带来切实的成本节约，实现性能与经济的双重收益。</p>
<h2 data-id="heading-1">全局 TopN 优化实现</h2>
<p>基于上述思路指引，<strong>Apache Doris 完成了对 TopN 的全局优化</strong>。对于单表的 TopN，利用单节点内的 Runtime Filter 对内部表查询进行动态过滤，有效减少 IO 并提升执行性能。在前不久不发的 4.0 版本中，也进一步提升了 TopN 查询性能，通过引入 MaterializeNode，实现了两阶段数据访问机制，<strong>并将优化范围从单表进一步拓展至数据湖场景与多表关联查询，显著扩大了其适用范围</strong>。</p>
<p>接下来，我们将深入解析 TopN Runtime Filter、单表两阶段 TopN 以及多表关联 TopN 的具体优化实现。</p>
<h3 data-id="heading-2">01 采用 Runtime Filter</h3>
<p>Runtime Filter 是一种运行时数据裁剪技术。Doris 在执行 SQL 时动态生成过滤条件，并将这些条件下推到后续数据处理环节，利用运行时信息进行数据裁剪，从而降低 IO 开销并提升性能。在两表 Join 场景中，这一技术的典型应用是将 build 侧的 key 集合通过 IN-list、Bloom Filter 等形式下推到 probe 侧，尽早过滤掉无关数据，减少扫描和传输。</p>
<p><strong>TopN Runtime Filter 同样采用这一思路，在运行时维护排序列的值范围，并生成 Runtime Filter 以裁剪后续扫描，从而提升单节点上的 TopN 查询性能</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb23108328124493a8c738139382cd41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767705986&amp;x-signature=qigvcHP5Qq9OpplgYh0NccEZfxs%3D" alt="01 采用 Runtime Filter.PNG" loading="lazy"/></p>
<p>在单机测试中，基于 Runtime Filter 优化后的 TopN 查询耗时从 <strong>3 秒降到 1 秒，性能提升约 3 倍</strong>：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> lineitem <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> l_orderkey LIMIT <span class="hljs-number">1000</span>;
</code></pre>
<h3 data-id="heading-3">02 两阶段数据访问机制</h3>
<p>基于 Runtime Filter 的方法虽然能够在运行时动态过滤数据，但仍需读取所有列，无法彻底消除读放大。为此，我们<strong>引入了两阶段数据访问机制</strong>，进一步减少列的读取与 IO 开销。其执行流程示意图如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a1aaffedaae4206b695dc2503f64c01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767705986&amp;x-signature=ALE5rg8ykIk%2B6Hrlv3pNttp5xJM%3D" alt="02 两阶段数据访问机制.png" loading="lazy"/></p>
<p>以如下 SQL 为例：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> colA LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>第 1 阶段：只读取排序列</strong></p>
<p>在该阶段的 Scan 任务中，系统只读取排序列<code>colA</code>，并增加一个辅助列 <code>__DORIS_ROWID_COL__</code>。相当于执行：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> colA, __DORIS_ROWID_COL__ <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> colA LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>该方法跳过了非排序列的读取，仅扫描与排序相关的数据并记录其位置信息。<code>DORIS_ROWID_COL</code> 用于唯一标识数据所在文件与行号，其具体编码设计将在后续章节详细说明。</p>
<p><strong>第 2 阶段：基于 RowID 的完整数据获取</strong></p>
<p>新增的 MaterializeNode 接收第一阶段的结果后，会根据 <code>__DORIS_ROWID_COL__</code> 向对应 Backend 发起基于行号（RowID）的数据拉取请求。借助文件中记录的位置信息，Doris 可以快速定位并读取对应记录；由于已完成 TopN 计算，第二阶段通常只需读取有限行（例如示例中的 10 行）。</p>
<p><strong>得益于该阶段可通过</strong> <strong>RPC</strong> <strong>跨节点执行，打破了单节点执行限制，两阶段访问机制也自然扩展至多表关联的 TopN 场景，例如：</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> 
lineitem <span class="hljs-keyword">JOIN</span>  orders 
<span class="hljs-keyword">ON</span> l_orderkey = o_orderkey
<span class="hljs-keyword">WHERE</span> o_orderdate &lt; <span class="hljs-type">DATE</span> <span class="hljs-comment">'1995-03-15' </span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> l_partkey LIMIT <span class="hljs-number">100</span>;
</code></pre>
<p>其执行规划示意如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fc8ac734f814aaea15def8158107271~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767705986&amp;x-signature=ovakvwleAFXtow0CXTOtAeuaFP8%3D" alt="02 两阶段数据访问机制-1.png" loading="lazy"/></p>
<p>执行计划中，MaterializeNode 在第二阶段可以穿透 Join 节点，从扫描节点获取最终数据。</p>
<h2 data-id="heading-4">优化前后性能表现</h2>
<p>Apache Doris 对于 TopN 的优化已在多种场景上得到验证。我们在 Doris 内表、Parquet 及 ORC 格式的 Hive 表上，基于 TPCH 100G 标准数据集中的 <code>lineitem</code> 表，分别构建了<strong>单表</strong>与<strong>多表</strong> TopN 查询场景，系统对比了优化前后的性能表现。</p>
<ul>
<li>
<p>单表 TopN 查询示例（选取不同排序列）：</p>
<ul>
<li>
<pre><code class="hljs language-vbnet" lang="vbnet">  -- Q1 - Q3:
  <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> lineitem <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> l_orderkey limit <span class="hljs-number">1000</span>;
  <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> lineitem <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> l_partkey limit <span class="hljs-number">1000</span>;
  <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> lineitem <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> l_comment limit <span class="hljs-number">1000</span>;
</code></pre>
</li>
</ul>
</li>
<li>
<p>多表 TopN 查询示例（不同的表数、JOIN 方式与 SELECT 列数）：</p>
<ul>
<li>
<pre><code class="hljs language-ini" lang="ini">  -- Q4:
  SELECT * FROM lineitem JOIN orders ON <span class="hljs-attr">l_orderkey</span> = o_orderkey
  WHERE o_orderdate &lt; DATE '1995-03-15' ORDER BY l_partkey LIMIT 100<span class="hljs-comment">;</span>
  ​
  -- Q5:
  SELECT * FROM customer, orders, lineitem
  WHERE <span class="hljs-attr">c_mktsegment</span> = <span class="hljs-string">'BUILDING'</span>
      AND <span class="hljs-attr">c_custkey</span> = o_custkey
      AND <span class="hljs-attr">l_orderkey</span> = o_orderkey
      AND o_orderdate &lt; DATE '1995-03-15'
      AND l_shipdate &gt; DATE '1995-03-15'
  ORDER BY o_orderdate LIMIT 10<span class="hljs-comment">;</span>
  ​
  -- Q6:
  SELECT lineitem.*
  FROM customer, orders, lineitem
  WHERE <span class="hljs-attr">c_mktsegment</span> = <span class="hljs-string">'BUILDING'</span>
      AND <span class="hljs-attr">c_custkey</span> = o_custkey
      AND <span class="hljs-attr">l_orderkey</span> = o_orderkey
      AND o_orderdate &lt; DATE '1995-03-15'
      AND l_shipdate &gt; DATE '1995-03-15'
  ORDER BY o_orderdate LIMIT 10<span class="hljs-comment">;</span>
  ​
  -- Q7:
  SELECT l_shipdate, l_orderkey, l_linenumber
  FROM customer, orders, lineitem
  WHERE <span class="hljs-attr">c_mktsegment</span> = <span class="hljs-string">'BUILDING'</span>
      AND <span class="hljs-attr">c_custkey</span> = o_custkey
      AND <span class="hljs-attr">l_orderkey</span> = o_orderkey
      AND o_orderdate &lt; DATE '1995-03-15'
      AND l_shipdate &gt; DATE '1995-03-15'
  ORDER BY o_orderdate LIMIT 10<span class="hljs-comment">;</span>
  ​
  -- Q8:
  SELECT * FROM supplier, lineitem l1, orders, nation
  WHERE <span class="hljs-attr">s_suppkey</span> = l1.l_suppkey
      AND <span class="hljs-attr">o_orderkey</span> = l1.l_orderkey
      AND <span class="hljs-attr">o_orderstatus</span> = <span class="hljs-string">'F'</span>
      AND l1.l_receiptdate &gt; l1.l_commitdate
      AND EXISTS (SELECT * FROM lineitem l2 WHERE <span class="hljs-attr">l2.l_orderkey</span> = l1.l_orderkey AND l2.l_suppkey &lt;&gt; l1.l_suppkey)
      AND NOT EXISTS (SELECT * FROM lineitem l3
          WHERE <span class="hljs-attr">l3.l_orderkey</span> = l1.l_orderkey
              AND l3.l_suppkey &lt;&gt; l1.l_suppkey
              AND l3.l_receiptdate &gt; l3.l_commitdate)
      AND <span class="hljs-attr">s_nationkey</span> = n_nationkey
      AND <span class="hljs-attr">n_name</span> = <span class="hljs-string">'SAUDI ARABIA'</span>
  ORDER BY s_name LIMIT 100<span class="hljs-comment">;</span>
  ​
  -- Q9:
  SELECT s_name, s_address, s_phone, s_acctbal, l_shipdate, l_quantity, l_extendedprice, l_discount, l_tax, l_returnflag, l_linestatus, l_shipinstruct, o_orderdate, o_totalprice, o_orderpriority, n_name
  FROM supplier, lineitem l1, orders, nation
  WHERE <span class="hljs-attr">s_suppkey</span> = l1.l_suppkey
      AND <span class="hljs-attr">o_orderkey</span> = l1.l_orderkey
      AND <span class="hljs-attr">o_orderstatus</span> = <span class="hljs-string">'F'</span>
      AND l1.l_receiptdate &gt; l1.l_commitdate
      AND EXISTS (SELECT * FROM lineitem l2 WHERE <span class="hljs-attr">l2.l_orderkey</span> = l1.l_orderkey   AND l2.l_suppkey &lt;&gt; l1.l_suppkey)
      AND NOT EXISTS (SELECT * FROM lineitem l3
          WHERE <span class="hljs-attr">l3.l_orderkey</span> = l1.l_orderkey
            AND l3.l_suppkey &lt;&gt; l1.l_suppkey
            AND l3.l_receiptdate &gt; l3.l_commitdate)
      AND <span class="hljs-attr">s_nationkey</span> = n_nationkey
      AND <span class="hljs-attr">n_name</span> = <span class="hljs-string">'SAUDI ARABIA'</span>
  ORDER BY s_name LIMIT 100<span class="hljs-comment">;</span>
  ​
  -- Q10:
  SELECT s_name, s_nationkey, l_orderkey, o_orderstatus, n_name
  FROM supplier, lineitem l1, orders, nation
  WHERE <span class="hljs-attr">s_suppkey</span> = l1.l_suppkey
      AND <span class="hljs-attr">o_orderkey</span> = l1.l_orderkey
      AND <span class="hljs-attr">o_orderstatus</span> = <span class="hljs-string">'F'</span>
      AND l1.l_receiptdate &gt; l1.l_commitdate
      AND EXISTS (SELECT * FROM lineitem l2 WHERE <span class="hljs-attr">l2.l_orderkey</span> = l1.l_orderkey   AND l2.l_suppkey &lt;&gt; l1.l_suppkey)
      AND NOT EXISTS (SELECT * FROM lineitem l3
          WHERE <span class="hljs-attr">l3.l_orderkey</span> = l1.l_orderkey
            AND l3.l_suppkey &lt;&gt; l1.l_suppkey
            AND l3.l_receiptdate &gt; l3.l_commitdate)
      AND <span class="hljs-attr">s_nationkey</span> = n_nationkey
      AND <span class="hljs-attr">n_name</span> = <span class="hljs-string">'SAUDI ARABIA'</span>
  ORDER BY s_name LIMIT 100<span class="hljs-comment">;</span>
</code></pre>
</li>
</ul>
</li>
</ul>
<p>下表汇总了优化带来的<strong>平均性能提升</strong>（查询时间缩短的百分比区间）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/743da64c945b4825842c1a49a6a4e8a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767705986&amp;x-signature=HsrNnKuuHfdVDYQR7aB1m2PmTkc%3D" alt="优化前后的性能表现.png" loading="lazy"/></p>
<p>数据表明，TopN 优化在多种数据格式与查询模式下均能显著提升性能。<strong>平均可降低查询时间 30% 至 40%</strong> ，<strong>在部分多表关联场景中，性能提升幅度最高可达 80%</strong> ，效果尤为突出。这证明了两阶段访问机制有效减少了不必要的 IO，在不同存储格式和复杂查询中均能带来可观的收益。</p>
<h2 data-id="heading-5">TopN 执行逻辑解析</h2>
<p>前文简要介绍了 TopN 的两阶段执行逻辑，在实际实现中，该流程面临几项核心挑战：</p>
<ul>
<li>Pipeline 执行线程的阻塞：第二阶段数据拉取涉及网络 IO，若在 Pipeline 执行线程中同步进行，会导致线程被阻塞，降低系统整体吞吐。</li>
<li>多表查询的支持：Join 算子涉及多张表的物化，需要准确识别对应需要物化的列。</li>
<li>内外表格式的统一：Doris 内表与 Parquet、ORC 等开放格式在行号管理上机制不同，需设计统一的行标识抽象，以确保内外表逻辑一致。</li>
<li>资源隔离管控：延迟物化阶段的 IO 操作需纳入 Workload Group 进行统一资源管控，避免干扰线上其他查询，保证系统稳定性。</li>
</ul>
<p>针对上述挑战，<strong>Doris 通过混合任务调度器、全局行标识编码 与 智能优化器规则 协同工作，系统性地解决了这些问题</strong>。以下我们将逐一展开其设计实现。</p>
<h3 data-id="heading-6">01 混合调度器</h3>
<p>为解决 Pipeline 执行线程在网络 IO 场景下易被阻塞的问题，我们重构了 Doris 的 Pipeline 执行框架，引入了混合任务调度器（HybridTaskScheduler），<strong>从调度层面分离阻塞与非阻塞任务，显著降低了 IO 等待对执行效率的影响</strong>。其核心设计如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc0105a0b9884af891211ecfce8bfea5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767705986&amp;x-signature=8q3ioj3gc5hhuCxMB4onuIY6sk0%3D" alt="01 混合调度器.png" loading="lazy"/></p>
<p><strong>具体实现上，原有统一的 TaskScheduler 被拆分为两类调度器，共同构成新的 HybridTaskScheduler</strong>：</p>
<ul>
<li>NonBlockingScheduler：专门调度<strong>非阻塞型任务</strong>（如纯计算操作）。调度器线程数量跟 CPU 核数相等。能够确保充分利用 CPU 资源。</li>
<li>BlockingScheduler：用于调度<strong>可能阻塞的任务</strong>，如涉及磁盘 IO、网络 IO 等操作。该调度器线程数可动态调整，默认为 CPU 核数的两倍，以更好地容纳 IO 等待。</li>
</ul>
<p>通过将任务按是否阻塞分类调度，系统有效避免了阻塞型任务对计算密集型任务的资源抢占。例如，TopN 查询第二阶段中的 Materialization Node 会被自动提交至 BlockingScheduler 执行，从而大幅减少 IO 阻塞对全局 Pipeline 执行线程的占用。</p>
<h3 data-id="heading-7">02 全局 ID 编码与资源管控</h3>
<p>上文提到的 <code>__DORIS_ROWID_COL__</code>用于在第二阶段精确定位数据行，<strong>其编码设计兼顾了效率、跨格式一致性与资源管控</strong>。编码格式如下：</p>
<pre><code class="hljs language-go" lang="go">编码格式: [version:<span class="hljs-type">uint8</span>] + [backend_id:<span class="hljs-type">uint64</span>] + [file_id:<span class="hljs-type">uint32</span>] + [row_id:<span class="hljs-type">uint32</span>]
</code></pre>
<ul>
<li>
<p><strong>version</strong>：标识编码格式版本，用于后续扩展与兼容。</p>
</li>
<li>
<p><strong>backend_id</strong>：BE 节点 ID。该字段实现了精准的 RPC 定向——第二阶段请求可直接发送至对应节点，避免广播开销。同时，接收请求的节点会将数据读取任务提交至该查询所属的 Workload Group，从而确保资源隔离与统一管控。</p>
</li>
<li>
<p><strong>file_id</strong>：系统为查询涉及到的每个文件生成唯一 ID，并在内存中维护 ID 到实际文件路径的映射。通过唯一 ID 可以减少第二阶段发送文件信息的请求大小，减少网络资源开销。</p>
<ul>
<li>对于内表，文件名编码为：<code>tabet_id-rowset_id-segment_id</code></li>
<li>对于 Parquet/ORC，文件名编码为：<code>filename-rowgroup_id</code></li>
</ul>
</li>
<li>
<p><strong>row_id</strong>：用于标识数据在对应文件中的行号。同时，针对 OUTER JOIN 等可能会生成 NULL 值的场景，<code>row_id</code> 可以编码为 NULL，从而在第二阶段直接跳过请求，进一步提升效率。</p>
</li>
</ul>
<h3 data-id="heading-8">03 全局延迟物化算法</h3>
<p>为系统支持两阶段数据访问，<strong>Doris 优化器引入了全新的全局延迟物化算法</strong>。该算法在编译阶段自动识别可延迟读取的列，<strong>从而在保证语义正确的前提下，最大限度减少第一阶段的数据扫描量</strong>。其执行流程可概括如下：</p>
<ul>
<li><strong>列集合划分</strong>：优化器将需要访问的列分为关键列集 K 和 延迟列集 D。K 列是在第一阶段需要读取的列，D 列是需要在第二阶段延迟读取的列。</li>
<li><strong>自顶向下遍历</strong>：算法自顶向下遍历执行计划数的每个算子，将需要参与计算的列（如条件过滤列，Join 列等）加入到 K 集合中，其余列加入到 D 集合中。</li>
<li><strong>字段转换</strong>：如遇到投影节点（Projection Operator）或集合操作节点（Set Operator）等产生字段变化的节点，则会将 K 中相应的字段转换成下层节点的字段。</li>
<li><strong>结果推导</strong>：最终推导出 Scan 节点需读取的 K 集合，以及上游各算子对应的 D 集合。</li>
</ul>
<p>以如下执行计划片段为例：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-attribute">FILTER</span>(x &gt; <span class="hljs-number">10</span>) --&gt; <span class="hljs-built_in">PROJECT</span>(a+b as x) --&gt; <span class="hljs-built_in">SCAN</span>(T)
</code></pre>
<ul>
<li><code>FILTER</code> 节点依赖列 <code>x</code>，因此将 <code>x</code> 加入 K。</li>
<li><code>PROJECT</code> 节点将 <code>x</code> 映射为底层表达式 <code>a + b</code>，因此从 K 中移除 <code>x</code>，并加入 <code>a</code> 和 <code>b</code>。</li>
<li>最终传递至 <code>SCAN</code> 的 K 集合为 <code>{a, b}</code>，即仅需在第一阶段读取列 <code>a</code> 与 <code>b</code>。</li>
</ul>
<p>该算法在语法树层面实现了列读取的智能推迟，为高效的两阶段执行奠定了编译基础。</p>
<h2 data-id="heading-9">结束语</h2>
<p><strong>TopN 优化极大地强化了从海量数据中高效提取核心信息的能力，可广泛应用于实时排行榜、热点分析、销量统计、告警排序等高价值业务场景</strong>。</p>
<p>在方案设计过程中，我们也研究了业界其他系统的实现思路。以 DuckDB 为例，其在处理单表 TopN 时，会将其转换为一个特殊的semi Join 操作：左节点去扫描整表，右节点在扫描排序列后取出其 TopN 行，并且会借助 Runtime Filter 减少左表扫描数据量。该方案的优势在于复用了成熟的 Join 框架，但在某些场景下——例如排序列不是主键，或面对 Parquet 等格式的 Row Group 时——过滤效率可能受到影响，适用性存在一定边界。</p>
<p><strong>未来我们计划进一步进行深度开发，包括</strong>：</p>
<ul>
<li>集合运算（UNION/EXCEPT/INTERSECT）等复杂算子的 TopN 支持。</li>
<li>动态自适应物化阈值调整。</li>
</ul>
<p>我们将持续追踪数据查询领域的前沿技术，并不断探索其在真实业务场景中的落地实践，致力于为用户提供持续领先的查询性能体验。</p>
<p><em>"秀干终成栋，精钢不作钩"， 在“极致性能”的探索路上，Apache Doris 永不止步。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 前端开源三年，npm 发包卡我半天]]></title>    <link>https://juejin.cn/post/7589482741759033371</link>    <guid>https://juejin.cn/post/7589482741759033371</guid>    <pubDate>2025-12-30T13:28:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589482741759033371" data-draft-id="7589325011544916006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 前端开源三年，npm 发包卡我半天"/> <meta itemprop="keywords" content="前端,GitHub,NPM"/> <meta itemprop="datePublished" content="2025-12-30T13:28:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不如摸鱼去"/> <meta itemprop="url" content="https://juejin.cn/user/26044011388510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 前端开源三年，npm 发包卡我半天
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044011388510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不如摸鱼去
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T13:28:54.000Z" title="Tue Dec 30 2025 13:28:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ffbe295b3404a12859f30d92cf0ac60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=eA7I69jn54e49HxtbVWfP2Rje%2B8%3D" alt="" loading="lazy"/></p>
<p>大家好，我是不如摸鱼去，欢迎来到我的分享专栏，今天我们来聊聊 npm 发包。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3519023670124fc0aa37d49012801636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=gV7OA3HhEP8f6nzQ8fQmFuOCH4U%3D" alt="" loading="lazy"/></p>
<p>各位最近在 npm 上有没有见到这个这个提示？没错，经典 token 被废了！我也差点被废了，想发个新的包，死活发不出来啊，唉，都怪我不看文档啊😂。</p>
<h2 data-id="heading-0">起因</h2>
<p>近期给 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMoonofweisheng%2Funi-mini-router" target="_blank" title="https://github.com/Moonofweisheng/uni-mini-router" ref="nofollow noopener noreferrer">uni-mini-router</a> 重构了一下，使用 Gemini3 Pro 给它把打包器从 rollup 迁移到了 tsdown，并且使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstarter.wot-ui.cn%2F" target="_blank" title="https://starter.wot-ui.cn/" ref="nofollow noopener noreferrer">wot-starter</a>作为模板重构了其演示代码结构、文档和演示 demo。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/657457f8a79d4e3bbeff66e22f75b329~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=H%2BKXNDyT9Kye46VSZJdWVq0aHxU%3D" alt="" loading="lazy"/></p>
<p>美滋滋的上线准备发包，结果直接报错 404？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da04e6c04896445b9adecfd929038e28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=%2BNZo16azIMlIiQwjanag8xq5dIs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">过程</h2>
<p>发包报错后，上网一搜，哇擦，经典 token 被废了！看了下文档，是永久的经典 token 已经被废弃，推荐使用 trusted publisher 发包，于是马不停蹄的开始配置。然后就出现这一幕！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dff67d1d711d41e69ed3e90f027eb593~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=Law2H6xhS775%2B0fZ1b0GDNWnOiQ%3D" alt="" loading="lazy"/></p>
<p>仓库，我配上了，workflow 文件，我填好了，俺老孙啥功名不要，只求把这包发上去。npm 的天王老子信不过我，我懂，让你小子整些 trusted publisher 唬我，我也懂。我不懂的是…你特不让我发包上去！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e27fd3460e742d8b6e5958067eb614c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=DLtdA287i4FGWu9kCjbdMpqsNI8%3D" alt="" loading="lazy"/></p>
<p>何老师，掌管 Trusted publishing 发包的神。对唔住，刚刚是我太大声，是我把 GitHub 仓库名写成了仓库地址😂。</p>
<h2 data-id="heading-2">攻略</h2>
<p>正经 npm trusted publisher 发包攻略来了，文档见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Ftrusted-publishers" target="_blank" title="https://docs.npmjs.com/trusted-publishers" ref="nofollow noopener noreferrer">docs.npmjs.com/trusted-pub…</a> 。</p>
<blockquote>
<p>如果你是首次发包，需要先使用存在有效期的 token 进行手动发包，随后进行以下配置。</p>
</blockquote>
<p>首先我们打开设置，我们使用 GitHub Action 发包，所以选择配置 GitHub Action，</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d378ba35f6cb474d81ef1955c82be62b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=rYkCEIAP2VAsF9P1aQh92jXKykc%3D" alt="" loading="lazy"/></p>
<p>按照要求填写用户名、包名、工作流文件等
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbd268f1be55431bad26f701984ff683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=wnviKl8VGlf1dHth2WUfrOhVWQQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c24b928a295c4424b69d6ad5e7f63ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=BW4jRJOyPilCINgkEbF354gEFmA%3D" alt="" loading="lazy"/></p>
<p>调整 GitHub Action 工作流文件，删除 npm 相关 token，也可以参考上方文档进行配置。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4adebda0b91d4cc7895d102c9c991485~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=1FHRUpTScA0I7op35oZiYlwwAm8%3D" alt="" loading="lazy"/></p>
<p><em><strong>最后，需要注意: Trusted publishing 需要 npm CLI 版本 11.5.1 或以上.</strong></em></p>
<h2 data-id="heading-3">总结</h2>
<p>一定要看文档！</p>
<h2 data-id="heading-4">参考资料</h2>
<ul>
<li>npm-trusted-publishers：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Ftrusted-publishers" target="_blank" title="https://docs.npmjs.com/trusted-publishers" ref="nofollow noopener noreferrer">docs.npmjs.com/trusted-pub…</a></li>
<li>my-uni：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmy-uni.wot-ui.cn%2F" target="_blank" title="https://my-uni.wot-ui.cn/" ref="nofollow noopener noreferrer">my-uni.wot-ui.cn/</a></li>
<li>wot-starter：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwot-starter.wot-ui.cn%2F" target="_blank" title="https://wot-starter.wot-ui.cn/" ref="nofollow noopener noreferrer">wot-starter.wot-ui.cn/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tailwind CSS：顺风CSS]]></title>    <link>https://juejin.cn/post/7589494631005536291</link>    <guid>https://juejin.cn/post/7589494631005536291</guid>    <pubDate>2025-12-30T12:03:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494631005536291" data-draft-id="7589126814830690356" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tailwind CSS：顺风CSS"/> <meta itemprop="keywords" content="JavaScript,React.js,CSS"/> <meta itemprop="datePublished" content="2025-12-30T12:03:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="南山安"/> <meta itemprop="url" content="https://juejin.cn/user/1795929588117962"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tailwind CSS：顺风CSS
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1795929588117962/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    南山安
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:03:11.000Z" title="Tue Dec 30 2025 12:03:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>最近在折腾 React 项目的时候，深深被 Tailwind CSS 迷住了。以前写 CSS 总觉得乱糟糟的，类名起得头疼，样式复用率低，改个颜色还得全局搜索。现在用上 Tailwind，感觉整个人都轻松了，直接在 HTML（或者 JSX）里堆类名，就能快速搭出好看的界面。这篇文章就分享一下我的学习过程，从传统 CSS 的痛点，到原子 CSS 的概念，再到 Tailwind 的实战应用。希望能帮到同样在纠结样式问题的朋友。</p>
<h2 data-id="heading-1">传统 CSS 的痛点：为什么我觉得它不够用了</h2>
<p>拿我最早写的代码来说，看这个简单的按钮例子：</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-comment">/* 坏例子：每个按钮一个独立的类，样式几乎不复用 */</span>
        <span class="hljs-selector-class">.primary-btn</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
            <span class="hljs-attribute">background</span>: blue;
            <span class="hljs-attribute">color</span>: white;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
        }
        <span class="hljs-selector-class">.default-btn</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#ccc</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#000</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"primary-btn"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"default-btn"</span>&gt;</span>默认<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>看起来简单吧？但如果项目里有几十种按钮变体呢？每个都写一个类，CSS 文件很快就膨胀了。而且这些类带着强烈的“业务属性”，比如 primary、default，复用性很差。换个项目，这些类名基本废了。</p>
<p>后来我学到“面向对象 CSS”（OOCSS）的思路：把样式拆分成可复用的基类，然后组合起来。</p>
<p>改成这样：</p>
<pre><code class="hljs language-CSS" lang="CSS"><span class="hljs-selector-class">.btn</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
}
<span class="hljs-selector-class">.btn-primary</span> {
    <span class="hljs-attribute">background</span>: blue;
    <span class="hljs-attribute">color</span>: white;
}
<span class="hljs-selector-class">.btn-default</span> {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#ccc</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#000</span>;
}
</code></pre>
<p>HTML 里：</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default"</span>&gt;</span>默认<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>这就好多了！基类 .btn 处理通用样式，变体类处理差异。通过组合，复用率高了很多。这其实就是原子 CSS 的雏形：把样式拆成一个个小的、不可分的“原子”单元。</p>
<h2 data-id="heading-2">原子 CSS：样式世界的乐高积木</h2>
<p>原子 CSS（Atomic CSS）就是把 CSS 规则拆成极小的单一职责类，比如：</p>
<ul>
<li>p-4：padding: 1rem;</li>
<li>bg-blue-600：background-color: #2563eb;</li>
<li>text-white：color: white;</li>
<li>rounded-md：border-radius: 0.375rem;</li>
</ul>
<p>这些类就像乐高积木，单个没什么用，但组合起来能搭出任何形状。好处显而易见：</p>
<ul>
<li><strong>高度复用</strong>：一个类可以在无数地方用，不用担心命名冲突。</li>
<li><strong>不用跳文件</strong>：样式直接写在 HTML 里，开发时上下文切换少，效率高。</li>
<li><strong>一致性强</strong>：所有间距、颜色都来自统一的设计系统，不会乱七八糟。</li>
<li><strong>生产包小</strong>：Tailwind 会自动移除未使用的类，最终 CSS 文件超级精简（往往只有几十 KB）。</li>
</ul>
<p>Tailwind CSS 就是原子 CSS 的代表作。它不提供现成的组件（像 Bootstrap 的卡片、导航），而是给你一堆 utility 类，让你自己拼。很多人刚看觉得“类名好长好乱”，但用习惯了就回不去了——因为它让你专注于布局和设计，而不是纠结类名。</p>
<p>相比传统 CSS，Tailwind 的优势：</p>
<ul>
<li><strong>开发速度快</strong>：不用写自定义 CSS，90% 的样式直接用 utility 类搞定。</li>
<li><strong>维护容易</strong>：改样式直接改类名，不用找 CSS 文件。</li>
<li><strong>响应式友好</strong>：内置 mobile-first 设计（后面详说）。</li>
<li><strong>自定义强</strong>：通过配置文件，能轻松调整颜色、间距等设计 token。</li>
</ul>
<p>当然，不是完美：HTML 看起来类名多（“class soup”），初学曲线陡。但多练几次，就爱上了。</p>
<h2 data-id="heading-3">在 React + Vite 项目中上手 Tailwind CSS</h2>
<p>2025 年了，Tailwind 已经到 v4 了，性能更强，内置 Vite 支持超级方便。我的 React 项目是用 Vite 创建的，安装步骤超级简单。</p>
<ol>
<li>创建项目：</li>
</ol>
<pre><code class="hljs language-Bash" lang="Bash">npm create vite@latest my-tailwind-project -- --template react
<span class="hljs-built_in">cd</span> my-tailwind-project
npm install
</code></pre>
<ol start="2">
<li>安装 Tailwind（v4 方式）：</li>
</ol>
<pre><code class="hljs language-Bash" lang="Bash">npm install tailwindcss @tailwindcss/vite
</code></pre>
<ol start="3">
<li>配置 vite.config.js：</li>
</ol>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>
<span class="hljs-keyword">import</span> tailwindcss <span class="hljs-keyword">from</span> <span class="hljs-string">'@tailwindcss/vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">react</span>(), <span class="hljs-title function_">tailwindcss</span>()],
})
</code></pre>
<ol start="4">
<li>导入：</li>
</ol>
<p>在你的 CSS 文件中添加一个<code>@import</code>导入 Tailwind CSS 的语句。</p>
<pre><code class="hljs language-CSS" lang="CSS"><span class="hljs-keyword">@import</span> <span class="hljs-string">"tailwindcss"</span>;
</code></pre>
<p>就这么简单！不用 postcss.config.js 了，v4 原生支持 Vite。</p>
<p>启动 npm run dev，你就可以在 JSX 里用 Tailwind 类了。</p>
<p>看我第一个组件：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-4xl font-bold text-center my-8"</span>&gt;</span>Hello Tailwind!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"</span>&gt;</span>
        提交
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"px-4 py-2 bg-gray-300 text-black rounded-md hover:bg-gray-400 ml-4"</span>&gt;</span>
        默认
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}
</code></pre>
<p>直接在 className 里堆类：padding 用 px/py，背景 bg-xxx，文字 text-xxx，hover 状态直接 hover: 前缀。太爽了！</p>
<p>对应样式：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc64059565cc49089226c30be98a053a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5bGx5a6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700991&amp;x-signature=mKVT23jxvejXGMo2QLJf7Vj3ELQ%3D" alt="image.png" loading="lazy"/></p>
<p>我还做了个小卡片组件：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">ArticleCard</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4 bg-white rounded-xl shadow hover:shadow-lg transition-shadow"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-lg font-bold"</span>&gt;</span>Tailwind CSS<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-500 mt-2"</span>&gt;</span>用 utility class 快速构建 UI<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<p>hover 的时候阴影变大，transition 平滑过渡，全是 Tailwind 内置的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eb0d875edf0448da392ec0e9184189a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5bGx5a6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700991&amp;x-signature=Az3Gpo8zH0EzO7dis9SDLot1Z8Q%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">TailWindCss的痛点</h2>
<h3 data-id="heading-5">1. HTML/JSX 里类名超级长，看起来乱糟糟的（Class Soup 现象）</h3>
<p>这是最多人吐槽的点。一个组件的 className 动不动就一长串</p>
<pre><code class="hljs language-html" lang="html">className="flex flex-col md:flex-row gap-4 p-6 bg-white rounded-lg shadow hover:shadow-xl transition-all"。
</code></pre>
<p>看起来像“类名汤”，阅读性差，尤其是新手或别人接手代码时，得花时间解析这些类到底干了啥。相比传统 CSS 一个语义化的类名（如 .card），Tailwind 把样式全暴露在 markup 里，违反了“关注点分离”的原则——HTML 本该管结构，CSS 管样式，现在全混一起了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7fe175287014962862c245735be9d89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5bGx5a6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700991&amp;x-signature=a8jedbwoi0DJaqVJtxlQ7RYv0sc%3D" alt="image.png" loading="lazy"/></p>
<p>解决办法：提取组件、用 @apply 自定义类，或者工具如 tailwind-merge 处理条件类。但一开始还是挺别扭的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/546187fb6b8d49e797211356d66a61f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5bGx5a6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700991&amp;x-signature=bMzvGrqqWjnZdRaUASKW0mD4cDI%3D" alt="image.png" loading="lazy"/></p>
<p>效果展示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/557ffea7b28e4fce81d6884020b1c15c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5bGx5a6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700991&amp;x-signature=GPxJg%2F5laEGq93Wgi7mhuQD%2FUf4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">2. 学习曲线陡峭，得记一大堆类名</h3>
<p>Tailwind 的类名不是随便起的，得熟悉它的命名规则：padding 用 p-，margin 用 m-，响应式前缀 md: lg:，hover: focus: 之类的变体。</p>
<p>刚上手时，总得翻文档或靠记忆。很多人说“用一周就上手了”，但对 CSS 不熟的新人来说，可能得一个月才能流畅。</p>
<p>还有，复杂样式（如嵌套选择器、父子状态）用纯 Tailwind 写起来麻烦，得靠 group- 或插件。</p>
<h4 data-id="heading-7">解决方法：VS Code 的 IntelliSense 插件提示</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83d6df7921da406c968101d327d55b63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5bGx5a6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700991&amp;x-signature=KwboAK3gUJgiGiVlHgtudWr9rSg%3D" alt="image.png" loading="lazy"/></p>
<p>效果展示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e4e806dbf804e409d4a910f58bb90b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5bGx5a6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700991&amp;x-signature=L63B3Vca1qKQMBGnWa%2FLOwY%2B480%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">3. 维护和重构时麻烦，尤其是大项目</h3>
<p>想全局改个间距（如所有 padding 从 4 改成 6）？得搜索替换一堆类名。传统 CSS 改一个变量或类就行。</p>
<p>条件样式（比如根据 props 动态类）需要额外工具如 clsx 或 tailwind-merge，否则容易冲突。</p>
<p>调试时，浏览器 DevTools 里一堆原子类，虽然能点开看，但不如语义类直观。</p>
<p>大项目里，如果不严格规范，容易样式重复或不一致。</p>
<h2 data-id="heading-9">Tailwind 的响应式设计：Mobile First 是王道</h2>
<p>Tailwind 默认是 mobile-first：先写移动端样式，再用前缀（如 md: lg:）覆盖大屏。</p>
<p>比如我做的布局：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App2</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex flex-col gap-4 p-4 md:flex-row"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-blue-100 p-4 rounded-lg md:w-2/3"</span>&gt;</span>主内容区<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-green-100 p-4 rounded-lg md:w-1/3"</span>&gt;</span>侧边栏<span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<ul>
<li>默认（手机）：flex-col，垂直栈。</li>
<li>md 及以上：flex-row，横排；main 占 2/3，aside 占 1/3。</li>
</ul>
<p>为什么 mobile-first 好？因为手机流量占一半以上，先保证小屏体验好，再逐步增强大屏。传统 desktop-first 容易忽略手机。</p>
<p>Tailwind 断点默认：</p>
<ul>
<li>sm: 640px</li>
<li>md: 768px</li>
<li>lg: 1024px</li>
<li>xl: 1280px</li>
<li>2xl: 1536px</li>
</ul>
<p>想只在某个范围生效？组合 max- 前缀，比如 md:max-lg: 只在中屏。</p>
<h2 data-id="heading-10">进阶小技巧和最佳实践</h2>
<p>用 Tailwind 久了，有些心得：</p>
<ol>
<li><strong>类名顺序有讲究</strong>：我喜欢按“同心圆”顺序：布局 → 盒模型 → 背景 → 文字 → 其他。这样读起来顺眼。</li>
<li><strong>重复类太多？提取组件</strong>：别在每个按钮都写一长串，封装成 &lt; Button variant="primary" &gt;。</li>
<li><strong>用 @apply 自定义类</strong>：如果某些组合常用，在 CSS 里：</li>
</ol>
<pre><code class="hljs language-CSS" lang="CSS"><span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-keyword">@apply</span> px-<span class="hljs-number">4</span> py-<span class="hljs-number">2</span> bg-blue-<span class="hljs-number">600</span> text-white rounded-md <span class="hljs-attribute">hover</span>:bg-blue-<span class="hljs-number">700</span>;
}
</code></pre>
<ol start="4">
<li><strong>暗黑模式超简单</strong>：加 class="dark" 到 html，utility 用 dark: 前缀。</li>
<li><strong>性能优化</strong>：Tailwind 自动 purge 未用类，生产包很小。</li>
<li><strong>和大模型结合</strong>：Tailwind 类名语义强，用 AI 生成 UI 特别准。描述“一个蓝色大按钮，hover 变深”，直接吐类名。</li>
</ol>
<h2 data-id="heading-11">React 中的 Fragment</h2>
<h3 data-id="heading-12">React 组件为什么只能返回一个根元素（没有并列的多个根元素）？</h3>
<p>你在学 React 时，肯定碰到过这个经典报错：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e6d05ff3544440f9bd727359d14fb15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5bGx5a6J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767700991&amp;x-signature=c81RcaN2jlNCfnT7HCpGhyzAhkw%3D" alt="image.png" loading="lazy"/>
错误信息大概是：“JSX expressions must have one parent element” 或 “Adjacent JSX elements must be wrapped in an enclosing tag”。</p>
<p>简单说，就是 <strong>React 函数组件的 return 里，只能返回一个单一的根元素，不能并列多个顶级元素</strong>。</p>
<p>错的例子：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>  <span class="hljs-comment">// 报错！两个并列</span>
  );
}
</code></pre>
<p>对的例子（传统方式）：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>  // 用 div 包裹成一个根
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>现在很多人用 Fragment：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>  // 空标签，就是 Fragment
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>那为什么 React 要强制这个规则呢？不能直接支持并列多个根吗？</p>
<h3 data-id="heading-13">核心原因：JSX 本质上是 React.createElement 的语法糖</h3>
<p>React 组件其实就是一个函数，这个函数必须返回 <strong>一个值</strong>（单个 React Element）。</p>
<p>JSX 看起来像 HTML，但它会被 Babel 编译成 JavaScript 的 React.createElement 调用。</p>
<p>比如这个 JSX：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;div&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
&lt;/div&gt;
</code></pre>
<p>编译后大致是：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"div"</span>, <span class="hljs-literal">null</span>,
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"h1"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"标题"</span>),
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"p"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"段落"</span>)
);
</code></pre>
<p>createElement 返回的是 <strong>一个单一的 React Element 对象</strong>，它可以有多个 children（子元素数组），但本身必须是单个对象。</p>
<p>如果你写并列两个：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;h1&gt;标题&lt;/h1&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>
</code></pre>
<p>编译后相当于：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"h1"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"标题"</span>);
<span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"p"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"段落"</span>);  <span class="hljs-comment">// 两个独立的调用</span>
</code></pre>
<p>这就像函数里有两条 return 语句：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bad</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;  <span class="hljs-comment">// 第二个永远执行不到，语法无效</span>
}
</code></pre>
<p>JavaScript 函数只能返回一个值，所以 React 组件也只能返回一个 React Element。</p>
<h3 data-id="heading-14">另一个重要原因：React 的虚拟 DOM 和 Reconciliation（调和）算法需要树状结构</h3>
<p>React 的核心是虚拟 DOM：一个 JavaScript 对象树。</p>
<p>每个组件渲染后，必须对应虚拟 DOM 树上的 <strong>一个节点</strong>（根节点），这个节点可以有任意多个子节点，但组件本身只能代表一个节点。</p>
<p>如果允许并列多个根，React 就不知道这个组件在虚拟 DOM 树里该怎么挂载、怎么 diff（比较新旧虚拟 DOM）、怎么更新。</p>
<p>React 的 diff 算法依赖严格的树结构：父子关系清晰，便于高效比较和更新。</p>
<p>多根的话，树就乱了，算法复杂度会爆炸，性能变差。</p>
<h3 data-id="heading-15">历史背景：早期只能用 div 包裹，后来引入 Fragment</h3>
<p>React 早期（v16 之前），大家只能用无意义的 &lt; div&gt; 包裹。</p>
<p>问题：</p>
<ul>
<li>多一层 DOM 节点，影响 CSS 布局（比如 flex、grid）</li>
<li>在表格  里返回多个 ，包 div 会导致无效 HTML</li>
<li>DOM 树更深，略微影响性能</li>
</ul>
<p>React v16（2017 年）引入 <strong>Fragment</strong>，专门解决这个痛点。</p>
<p>Fragment 就是一个“透明包裹”，不渲染成真实 DOM 节点，只在虚拟 DOM 里占位。</p>
<p>写法：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Fragment</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-comment">// 或直接用短语法（推荐）</span>
<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Fragment</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Fragment</span>&gt;</span></span>
);

<span class="hljs-comment">// 最常用：</span>
<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/&gt;</span></span>
);
</code></pre>
<p>注意：短语法 &lt;&gt;&lt;/&gt; 不支持 key 属性，如果在 map 里需要 key，就用 &lt; Fragment key=...&gt;。</p>
<h3 data-id="heading-16">总结</h3>
<ul>
<li><strong>技术原因</strong>：JSX → React.createElement 只能返回单个元素，函数只能 return 一个值。</li>
<li><strong>算法原因</strong>：虚拟 DOM 需要严格树结构，便于高效 diff 和更新。</li>
<li><strong>解决方案</strong>：用 Fragment（&lt;&gt;...&lt;/&gt;）包裹，既满足规则，又不污染真实 DOM。</li>
</ul>
<p>这个规则虽然一开始让人觉得麻烦，但它保证了 React 的高效和可预测性。用习惯 Fragment 后，你会觉得超级自然。</p>
<h2 data-id="heading-17">为什么叫TailWind</h2>
<p>“Tailwind” 在英文里是“顺风”的意思，听起来挺诗意的，跟 CSS 框架有啥关系？</p>
<p>其实，名字的来源超级随意，来自它的创始人 <strong>Adam Wathan</strong> 本人的一次脑洞大开。</p>
<p>Adam 在一次访谈中亲口说过（大概 2022 年的播客）：</p>
<p>他当时在 brainstorm 项目名字，从 “tail” 这个词开始联想——先想到 “tail tail”（重复），然后 “white tail”（白尾？可能是白尾鹿），突然蹦出 <strong>Tailwind</strong>。</p>
<p>他说：“That's a cool name. 那名字挺酷的，而且有点道理，因为它能帮你<strong>做事更快</strong>（do stuff faster）。”</p>
<p>“Tailwind” 在英语里确实有“顺风”的含义，比如飞机起飞时如果有 tailwind，就能飞得更快、更顺畅。Adam 觉得这个框架能让开发者写样式更快、更高效，就像顺风助力一样，所以名字就这么定了。</p>
<p>他说这是他想到的第一个名字，就觉得特别合适，直接敲定了。</p>
<p>Tailwind CSS 最早是 Adam 在 2017 年做一个侧边项目时，顺手搞出来的一个内部工具（用 Less 写的 utility 类）。后来直播开发时，观众老问“这 CSS 框架叫啥”，他才决定开源。名字就是这么随便取的，没有什么深奥的典故，就是觉得“酷 + 贴合加速开发的理念”。</p>
<p>有趣的是，Tailwind 的 slogan 也是 “Rapidly build modern websites without ever leaving your HTML”（快速构建现代网站，不用离开 HTML），完美呼应了“顺风加速”的感觉。</p>
<p>所以，Tailwind 这个名字本质上就是：</p>
<ul>
<li><strong>随意脑暴而来</strong>：从 “tail” 联想到的词。</li>
<li><strong>寓意开发加速</strong>：像顺风一样，让你写 UI 更快、更顺手。</li>
</ul>
<h2 data-id="heading-18">写在最后：为什么我推荐你试试 Tailwind</h2>
<p>从传统 CSS 到 Tailwind，我的感觉是：从“手艺人”变成了“建筑师”。以前抠每一个像素写规则，现在直接用现成积木搭，专注在产品逻辑和用户体验上。项目迭代快了，代码干净了，心情也好了。</p>
<p>如果你还在用传统 CSS 纠结，不妨在新项目里试试 Tailwind + React。刚开始可能不适应类名多，但坚持一周，你会爱上这种自由。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[爆火全网的“瀑布流”视频，手把手教你一键生成，低成本打造爆款！]]></title>    <link>https://juejin.cn/post/7589494631005569059</link>    <guid>https://juejin.cn/post/7589494631005569059</guid>    <pubDate>2025-12-30T12:12:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494631005569059" data-draft-id="7589477775210364980" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 爆火全网的“瀑布流”视频，手把手教你一键生成，低成本打造爆款！"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-12-30T12:12:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java中文社群"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             爆火全网的“瀑布流”视频，手把手教你一键生成，低成本打造爆款！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java中文社群
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:12:49.000Z" title="Tue Dec 30 2025 12:12:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家在刷短视频的时候，是不是经常看到那种文字像瀑布一样跳动、视觉冲击力极强的视频？</p>
<p>很多人私信问我：<strong>“磊哥，这种视频是不是得用电脑特效软件做大半天啊？”</strong></p>
<p>其实，大家都想复杂了！这种视频的实现成本极低，效果却出奇地好。今天，我就把这个压箱底的绝活儿分享给大家，<strong>只需两步，N8N+剪映就能一键搞定！</strong> 🚀</p>
<hr/>
<h2 data-id="heading-0">🎬 先看效果</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV182vHBPEaQ%2F" target="_blank" title="https://www.bilibili.com/video/BV182vHBPEaQ/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV182…</a></p>
<hr/>
<p>文字版概览：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd10485f4f3f45d6a12493641887ccbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767701569&amp;x-signature=z6g%2BSSVTL9BOT8fCYa9xAaig2SY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>“人生四大悲剧：幼年家不和，少年无良师，成年无良配，老年子不孝。然万般皆苦，唯有自渡……只有一种英雄主义，就是在认清生活的真相后，依然热爱生活。”</p>
</blockquote>
<p>怎么样？这种文字跳动的节奏感，配合上深情的配音，是不是瞬间把格调拉满了？</p>
<hr/>
<h2 data-id="heading-1">🛠️ 第一步：一键提取素材音/视频</h2>
<p>想要做出好视频，好的素材是关键。咱们可以直接从那些点赞极高的视频里获取音频。</p>
<ol>
<li><strong>复制链接</strong>：在短视频平台上看到喜欢的视频，点击分享，直接“复制链接”。</li>
<li><strong>提取音频</strong>：打开咱们的 <strong>n8n 音频提取助手</strong> 工作流。把链接往聊天窗口一发，系统就会自动帮你把视频下载下来，并通过 <strong>FFmpeg</strong> 插件自动把视频转成音频。</li>
<li><strong>保存到本地</strong>：转换好的音频会以时间戳命名（比如 <code>DY_1712345.mp3</code>），直接保存到手机或电脑文件夹里备用。</li>
</ol>
<p>这一步非常快，几秒钟就能搞定！</p>
<hr/>
<h2 data-id="heading-2">✨ 第二步：剪映“翻转大字”一键合成</h2>
<p>有了音频，接下来的操作简直就是“傻瓜式”的，重点来了，大家看好：</p>
<ol>
<li><strong>导入素材</strong>：打开<strong>剪映</strong>，点击“开始制作”，把刚才下载好的 MP3 音频拉到轨道上。</li>
<li><strong>神奇模板</strong>：点击底部的【字幕】菜单，找到【字幕模板】。</li>
<li><strong>翻转大字</strong>：在模板库里搜“翻转大字”，你会发现这里有超级多酷炫的样式。选一个你最喜欢的，点击加号。</li>
<li><strong>自动识别</strong>：这时候剪映就会自动识别音频里的语音，并同步生成对应的文字瀑布流效果！</li>
</ol>
<p>如图所示：</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82c182692330404fa18c1210d669cacf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767701569&amp;x-signature=guw1O35N5Yozh7kZYR5Jr%2FIZN1Y%3D" alt="" loading="lazy"/></p>
<p><strong>说话间，视频就自动生成了！</strong> 连对齐音轨这种累活儿都不用你亲自动手。</p>
<hr/>
<h2 data-id="heading-3">💡 总结一下</h2>
<p>你看，其实制作爆款视频并不难。咱们总结一下核心逻辑：<strong>先用工具提取高质量音频，再利用剪映的“翻转大字”模板一键生成特效。</strong></p>
<p>最后一步，直接点击导出，一个属于你的高清文字瀑布流大片就出炉了！</p>
<p>这就是今天的干货分享。<strong>我是磊哥，每天为你分享一个实用的黑科技技巧。</strong> 觉得有用的话，别忘了点赞关注，咱们下期见！👋✨</p>
<blockquote>
<p>本文已收录到我的技术小站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>，网站包含的内容有：<strong>N8N/Coze/Dify/LangChain/SpringAI/SpringAIAlibaba/LangChain4j/AI实战项目/AI常见面试题</strong>等技术分享，欢迎各位大佬光临指导~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：双流操作]]></title>    <link>https://juejin.cn/post/7589477341765664814</link>    <guid>https://juejin.cn/post/7589477341765664814</guid>    <pubDate>2025-12-30T12:14:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589477341765664814" data-draft-id="7589325011544768550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：双流操作"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2025-12-30T12:14:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：双流操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:14:33.000Z" title="Tue Dec 30 2025 12:14:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天来梳理一下 Flink 双流操作相关的源码。</p>
<h3 data-id="heading-0">写在前面</h3>
<p>通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fjackeyzhe.github.io%2F2025%2F07%2F19%2FFlink%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0%25EF%25BC%259A%25E5%25A4%259A%25E6%25B5%2581join%2F" target="_blank" title="https://jackeyzhe.github.io/2025/07/19/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%A4%9A%E6%B5%81join/" ref="nofollow noopener noreferrer">Flink学习笔记：多流 Join</a>一文的介绍，我们知道 Flink 有三种数据关联的方式，分别是 Window Join、Interval Join 和 CoGroup。下面我们分别看下这三种关联方式的源码实现。</p>
<h3 data-id="heading-1">Window Join</h3>
<p>我们先回顾一下 window join 的使用方法。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">DataStream&lt;Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; result = source1.<span class="hljs-keyword">join</span>(source2)
        .<span class="hljs-keyword">where</span>(record -&gt; record.f0)
        .equalTo(record -&gt; record.f0)
        .window(TumblingEventTimeWindows.<span class="hljs-keyword">of</span>(Time.seconds(<span class="hljs-number">2L</span>)))
        .apply(<span class="hljs-built_in">new</span> JoinFunction&lt;Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;() {
            @Override
            <span class="hljs-keyword">public</span> Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; <span class="hljs-keyword">join</span>(Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record1, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record2) throws Exception {
                <span class="hljs-keyword">return</span> Tuple2.<span class="hljs-keyword">of</span>(record1.f0, record1.f1);
            }
        });
</code></pre>
<p>上述调用链路类的流转如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6d0539edba546b89aa521409a906a60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767701672&amp;x-signature=VLzajX1b5lw864yFEqBbbXPs3qk%3D" alt="windowjoin" loading="lazy"/></p>
<p>在 WithWindow 的 apply 方法中，是构建了一个 coGroupedWindowedStream，然后调用它的 apply 方法。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;T&gt; SingleOutputStreamOperator&lt;T&gt; <span class="hljs-built_in">apply</span>(
        JoinFunction&lt;T1, T2, T&gt; function, TypeInformation&lt;T&gt; resultType) {
    <span class="hljs-comment">// clean the closure</span>
    function = input1<span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(function);

    coGroupedWindowedStream =
            input1<span class="hljs-selector-class">.coGroup</span>(input2)
                    <span class="hljs-selector-class">.where</span>(keySelector1)
                    <span class="hljs-selector-class">.equalTo</span>(keySelector2)
                    <span class="hljs-selector-class">.window</span>(windowAssigner)
                    <span class="hljs-selector-class">.trigger</span>(trigger)
                    <span class="hljs-selector-class">.evictor</span>(evictor)
                    <span class="hljs-selector-class">.allowedLateness</span>(allowedLateness);

    return coGroupedWindowedStream<span class="hljs-selector-class">.apply</span>(new JoinCoGroupFunction&lt;&gt;(function), resultType);
}
</code></pre>
<p>这里可以看出，Window Join 的底层是转换成 coGroup 进行处理的。</p>
<p>在 JoinCoGroupFunction 中，coGroup 方法就是对两个流进行两层遍历，然后将其应用到我们自定义的 JoinFunction 上。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">JoinCoGroupFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt;
        <span class="hljs-title">extends</span> <span class="hljs-title">WrappingFunction</span>&lt;<span class="hljs-title">JoinFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt;&gt;
        <span class="hljs-title">implements</span> <span class="hljs-title">CoGroupFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-built_in">long</span> serialVersionUID = <span class="hljs-number">1L</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JoinCoGroupFunction</span>(<span class="hljs-params">JoinFunction&lt;T1, T2, T&gt; wrappedFunction</span>)</span> {
        super(wrappedFunction);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">coGroup</span>(<span class="hljs-params">Iterable&lt;T1&gt; first, Iterable&lt;T2&gt; second, Collector&lt;T&gt; <span class="hljs-keyword">out</span></span>)
            throws Exception</span> {
        <span class="hljs-keyword">for</span> (T1 val1 : first) {
            <span class="hljs-keyword">for</span> (T2 val2 : second) {
                <span class="hljs-keyword">out</span>.collect(wrappedFunction.<span class="hljs-keyword">join</span>(val1, val2));
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-2">CoGroup</h3>
<p>CoGroup 的整体用法和流程与 Join 都类似，我们就不逐个介绍了。我们直接来看 apply 方法。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;T&gt; SingleOutputStreamOperator&lt;T&gt; <span class="hljs-built_in">apply</span>(
        CoGroupFunction&lt;T1, T2, T&gt; function, TypeInformation&lt;T&gt; resultType) {
    <span class="hljs-comment">// clean the closure</span>
    function = input1<span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(function);

    UnionTypeInfo&lt;T1, T2&gt; unionType =
            new UnionTypeInfo&lt;&gt;(input1.getType(), input2<span class="hljs-selector-class">.getType</span>());
    UnionKeySelector&lt;T1, T2, KEY&gt; unionKeySelector =
            new UnionKeySelector&lt;&gt;(keySelector1, keySelector2);

    SingleOutputStreamOperator&lt;TaggedUnion&lt;T1, T2&gt;&gt; taggedInput1 =
            input1<span class="hljs-selector-class">.map</span>(new Input1Tagger&lt;T1, T2&gt;());
    taggedInput1<span class="hljs-selector-class">.getTransformation</span>()<span class="hljs-selector-class">.setParallelism</span>(input1.getParallelism(), false);
    taggedInput1<span class="hljs-selector-class">.returns</span>(unionType);

    SingleOutputStreamOperator&lt;TaggedUnion&lt;T1, T2&gt;&gt; taggedInput2 =
            input2<span class="hljs-selector-class">.map</span>(new Input2Tagger&lt;T1, T2&gt;());
    taggedInput2<span class="hljs-selector-class">.getTransformation</span>()<span class="hljs-selector-class">.setParallelism</span>(input2.getParallelism(), false);
    taggedInput2<span class="hljs-selector-class">.returns</span>(unionType);

    DataStream&lt;TaggedUnion&lt;T1, T2&gt;&gt; unionStream = taggedInput1<span class="hljs-selector-class">.union</span>(taggedInput2);

    <span class="hljs-comment">// we explicitly create the keyed stream to manually pass the key type information in</span>
    windowedStream =
            new KeyedStream&lt;TaggedUnion&lt;T1, T2&gt;, KEY&gt;(
                            unionStream, unionKeySelector, keyType)
                    <span class="hljs-selector-class">.window</span>(windowAssigner);

    if (trigger != null) {
        windowedStream<span class="hljs-selector-class">.trigger</span>(trigger);
    }
    if (evictor != null) {
        windowedStream<span class="hljs-selector-class">.evictor</span>(evictor);
    }
    if (allowedLateness != null) {
        windowedStream<span class="hljs-selector-class">.allowedLateness</span>(allowedLateness);
    }

    return windowedStream<span class="hljs-selector-class">.apply</span>(
            new CoGroupWindowFunction&lt;T1, T2, T, KEY, W&gt;(function), resultType);
}
</code></pre>
<p>在 apply 方法中，先把两个流进行合并，然后创建了 windowedStream，并把窗口相关的属性设置好，最后是调用 windowedStream 的 apply 方法。</p>
<p>在调用 <code>windowedStream.apply</code> 方法时，又将 function 包装成了 CoGroupWindowFunction。</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">private</span> static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoGroupWindowFunction&lt;T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>, <span class="hljs-title">KEY</span>, <span class="hljs-title">W</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Window&gt;</span></span>
        <span class="hljs-keyword">extends</span> <span class="hljs-type">WrappingFunction</span>&lt;<span class="hljs-type">CoGroupFunction</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>, <span class="hljs-type">T</span>&gt;&gt;
        implements <span class="hljs-type">WindowFunction</span>&lt;<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt;, <span class="hljs-type">T</span>, <span class="hljs-type">KEY</span>, <span class="hljs-type">W</span>&gt; {

    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">1</span>L;

    public <span class="hljs-type">CoGroupWindowFunction</span>(<span class="hljs-type">CoGroupFunction</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>, <span class="hljs-type">T</span>&gt; userFunction) {
        <span class="hljs-keyword">super</span>(userFunction);
    }

    <span class="hljs-meta">@Override</span>
    public void apply(<span class="hljs-type">KEY</span> key, <span class="hljs-type">W</span> window, <span class="hljs-type">Iterable</span>&lt;<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt;&gt; values, <span class="hljs-type">Collector</span>&lt;<span class="hljs-type">T</span>&gt; out)
            <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {

        <span class="hljs-type">List</span>&lt;<span class="hljs-type">T1</span>&gt; oneValues = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">List</span>&lt;<span class="hljs-type">T2</span>&gt; twoValues = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">for</span> (<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt; <span class="hljs-keyword">val</span> : values) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">val</span>.isOne()) {
                oneValues.add(<span class="hljs-keyword">val</span>.getOne());
            } <span class="hljs-keyword">else</span> {
                twoValues.add(<span class="hljs-keyword">val</span>.getTwo());
            }
        }
        wrappedFunction.coGroup(oneValues, twoValues, out);
    }
}
</code></pre>
<p>在 CoGroupWindowFunction 的 apply 方法中是将主键为 key 的流分开两个流，再去调用 JoinCoGroupFunction 的 coGroup 方法。这里的 values 都是相同的 key，原因是在 window 中维护的 windowState，它内部是一个 stateTable，窗口的 namespace 和 key 共同维护一个 state，当窗口触发时，就会对相同 key 的数据调用 apply 方法。</p>
<h3 data-id="heading-3">Interval Join</h3>
<p>梳理完了 Window Join 和 CoGroup 之后，我们再接着看 Interval Join。还是先来回顾一下用法。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">DataStream</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; intervalJoinResult <span class="hljs-operator">=</span> source1.keyBy(record -&gt; record.f0)
        .intervalJoin(source2.keyBy(record -&gt; record.f0))
        .between(<span class="hljs-type">Time</span>.seconds(<span class="hljs-operator">-</span><span class="hljs-number">2</span>), <span class="hljs-type">Time</span>.seconds(<span class="hljs-number">2</span>))
        .process(new <span class="hljs-type">ProcessJoinFunction</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> void processElement(<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record1, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record2, <span class="hljs-type">ProcessJoinFunction</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;.<span class="hljs-type">Context</span> context, <span class="hljs-type">Collector</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; out) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {
                out.collect(<span class="hljs-type">Tuple2</span>.of(record1.f0, record1.f1 <span class="hljs-operator">+</span> record2.f1));
            }
        });
</code></pre>
<p>通过用法可以看出，interval join 传入的对象是两个 KeyedStream，接着使用 between 方法定义 interval join 的上下边界，最后调用 process 方法执行计算逻辑。</p>
<p>在调用过程中，类型的转换如下图。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33909c4a743343abb3df807911a74101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767701672&amp;x-signature=m4nBk%2BzddJx%2FAJxqMv0E9SroyiY%3D" alt="intervaljoin" loading="lazy"/></p>
<p>我们主要关注 process 的逻辑。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;OUT&gt; SingleOutputStreamOperator&lt;OUT&gt; <span class="hljs-built_in">process</span>(
        ProcessJoinFunction&lt;IN1, IN2, OUT&gt; processJoinFunction,
        TypeInformation&lt;OUT&gt; outputType) {
    Preconditions<span class="hljs-selector-class">.checkNotNull</span>(processJoinFunction);
    Preconditions<span class="hljs-selector-class">.checkNotNull</span>(outputType);

    final ProcessJoinFunction&lt;IN1, IN2, OUT&gt; cleanedUdf =
            <span class="hljs-attribute">left</span><span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(processJoinFunction);

    if (isEnableAsyncState) {
        final AsyncIntervalJoinOperator&lt;KEY, IN1, IN2, OUT&gt; operator =
                new AsyncIntervalJoinOperator&lt;&gt;(
                        lowerBound,
                        upperBound,
                        lowerBoundInclusive,
                        upperBoundInclusive,
                        leftLateDataOutputTag,
                        rightLateDataOutputTag,
                        left.getType()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        left.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        <span class="hljs-attribute">right</span><span class="hljs-selector-class">.getType</span>()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        right.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        cleanedUdf);

        return <span class="hljs-attribute">left</span><span class="hljs-selector-class">.connect</span>(right)
                <span class="hljs-selector-class">.keyBy</span>(keySelector1, keySelector2)
                <span class="hljs-selector-class">.transform</span>("Interval Join [Async]", outputType, operator);
    } else {
        final IntervalJoinOperator&lt;KEY, IN1, IN2, OUT&gt; operator =
                new IntervalJoinOperator&lt;&gt;(
                        lowerBound,
                        upperBound,
                        lowerBoundInclusive,
                        upperBoundInclusive,
                        leftLateDataOutputTag,
                        rightLateDataOutputTag,
                        left.getType()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        left.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        <span class="hljs-attribute">right</span><span class="hljs-selector-class">.getType</span>()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        right.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        cleanedUdf);

        return <span class="hljs-attribute">left</span><span class="hljs-selector-class">.connect</span>(right)
                <span class="hljs-selector-class">.keyBy</span>(keySelector1, keySelector2)
                <span class="hljs-selector-class">.transform</span>("Interval Join", outputType, operator);
    }
}
</code></pre>
<p>Interval join 是基于 ConnectedStream 实现的，ConnectedStream 提供了更加通用的双流操作，它将两个流组合成一个 TwoInputTransformation，然后加入执行图中。</p>
<p>具体的 Operator 是 IntervalJoinOperator 或 AsyncIntervalJoinOperator，它们都是 TwoInputStreamOperator 的实现类，提供 <code>processElement1</code> 和 <code>processElement2</code> 两个方法分别处理两个输入源的数据，最终都调用的是 processElement。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">private</span> <span class="hljs-operator">&lt;</span><span class="hljs-type">THIS</span>, <span class="hljs-type">OTHER</span><span class="hljs-operator">&gt;</span> void processElement(
        <span class="hljs-keyword">final</span> <span class="hljs-type">StreamRecord</span>&lt;<span class="hljs-type">THIS</span>&gt; record,
        <span class="hljs-keyword">final</span> <span class="hljs-type">MapState</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">IntervalJoinOperator</span>.<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">THIS</span>&gt;&gt;&gt; ourBuffer,
        <span class="hljs-keyword">final</span> <span class="hljs-type">MapState</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">IntervalJoinOperator</span>.<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt;&gt;&gt; otherBuffer,
        <span class="hljs-keyword">final</span> long relativeLowerBound,
        <span class="hljs-keyword">final</span> long relativeUpperBound,
        <span class="hljs-keyword">final</span> boolean isLeft)
        <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {

    <span class="hljs-keyword">final</span> <span class="hljs-type">THIS</span> ourValue <span class="hljs-operator">=</span> record.getValue();
    <span class="hljs-keyword">final</span> long ourTimestamp <span class="hljs-operator">=</span> record.getTimestamp();

    <span class="hljs-keyword">if</span> (ourTimestamp <span class="hljs-operator">==</span> <span class="hljs-type">Long</span>.<span class="hljs-type">MIN_VALUE</span>) {
        <span class="hljs-keyword">throw</span> new <span class="hljs-type">FlinkException</span>(
                <span class="hljs-string">"Long.MIN_VALUE timestamp: Elements used in "</span>
                        <span class="hljs-operator">+</span> <span class="hljs-string">"interval stream joins need to have timestamps meaningful timestamps."</span>);
    }

    <span class="hljs-keyword">if</span> (isLate(ourTimestamp)) {
        sideOutput(ourValue, ourTimestamp, isLeft);
        <span class="hljs-keyword">return</span>;
    }

    addToBuffer(ourBuffer, ourValue, ourTimestamp);

    <span class="hljs-keyword">for</span> (<span class="hljs-type">Map</span>.<span class="hljs-type">Entry</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt;&gt;&gt; bucket : otherBuffer.entries()) {
        <span class="hljs-keyword">final</span> long timestamp <span class="hljs-operator">=</span> bucket.getKey();

        <span class="hljs-keyword">if</span> (timestamp <span class="hljs-operator">&lt;</span> ourTimestamp <span class="hljs-operator">+</span> relativeLowerBound
                <span class="hljs-operator">||</span> timestamp <span class="hljs-operator">&gt;</span> ourTimestamp <span class="hljs-operator">+</span> relativeUpperBound) {
            <span class="hljs-keyword">continue</span>;
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt; entry : bucket.getValue()) {
            <span class="hljs-keyword">if</span> (isLeft) {
                collect((<span class="hljs-type">T1</span>) ourValue, (<span class="hljs-type">T2</span>) entry.element, ourTimestamp, timestamp);
            } <span class="hljs-keyword">else</span> {
                collect((<span class="hljs-type">T1</span>) entry.element, (<span class="hljs-type">T2</span>) ourValue, timestamp, ourTimestamp);
            }
        }
    }

    long cleanupTime <span class="hljs-operator">=</span>
            (relativeUpperBound <span class="hljs-operator">&gt;</span> 0L) <span class="hljs-operator">?</span> ourTimestamp <span class="hljs-operator">+</span> relativeUpperBound : ourTimestamp;
    <span class="hljs-keyword">if</span> (isLeft) {
        internalTimerService.registerEventTimeTimer(<span class="hljs-type">CLEANUP_NAMESPACE_LEFT</span>, cleanupTime);
    } <span class="hljs-keyword">else</span> {
        internalTimerService.registerEventTimeTimer(<span class="hljs-type">CLEANUP_NAMESPACE_RIGHT</span>, cleanupTime);
    }
}
</code></pre>
<p>在 IntervalJoinOperator 中维护了两个 MapState，每个消息进来的时候，都会加入到 MapState 中，key 是 timestamp，value 是一个元素的列表。然后遍历另一个 MapState，得到符合条件的数据。最后是为每条数据注册一个定时器，当时间超过有效范围后，会从 MapState 中清除这个时间戳的数据。</p>
<h3 data-id="heading-4">总结</h3>
<p>本文我们梳理了 Flink 的三种双流操作的源码，我们了解到 Window Join 底层是通过 CoGroup 实现的。CoGroup 本身是将两个流合并成 WindowedStream 并依赖于 WindowState 进行数据 join。最后 Interval Join 是通过 ConnectedStreams 实现的，内部的 IntervalJoinOperator 会维护两个 MapState，通过 MapState 进行数据关联。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[以浏览器多进程的角度解构页面渲染的整个流程]]></title>    <link>https://juejin.cn/post/7589509638354812955</link>    <guid>https://juejin.cn/post/7589509638354812955</guid>    <pubDate>2025-12-30T12:45:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589509638354812955" data-draft-id="7589454621719052338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="以浏览器多进程的角度解构页面渲染的整个流程"/> <meta itemprop="keywords" content="前端,面试,浏览器"/> <meta itemprop="datePublished" content="2025-12-30T12:45:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天天扭码"/> <meta itemprop="url" content="https://juejin.cn/user/3349589831715801"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            以浏览器多进程的角度解构页面渲染的整个流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3349589831715801/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天天扭码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:45:42.000Z" title="Tue Dec 30 2025 12:45:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p><strong>页面在浏览器上的渲染并不是一个一条线的过程，而是多进程架构下协同的结果，本文从浏览器多进程的角度解构从url输入到页面渲染的整个流程的解析。</strong></p>
<h2 data-id="heading-1">二、浏览器的多进程架构</h2>
<h3 data-id="heading-2">1.进程与线程之间的关系</h3>
<p>在操作系统中，<strong>进程是资源分配的最小单位，而线程</strong>是 CPU 调度的最小单位。</p>
<p>为了更好地理解浏览器架构，我们可以从以下三个维度来拆解它们的关系：</p>
<h4 data-id="heading-3">A. 包含与归属：工厂与工人</h4>
<p>进程是容器：一个进程好比一个工厂车间，它拥有<strong>独立的内存空间、数据集和系统资源</strong>（如网络句柄、文件描述符）。</p>
<p>线程是执行者：线程是车间里的工人。<strong>一个进程可以包含多个线程，它们协同完成复杂的任务</strong>。</p>
<h4 data-id="heading-4">B. 共享与隔离：内存的边界</h4>
<p>进程间相互隔离：为了保证系统的稳定性，<strong>进程与进程之间的内存是完全隔离的</strong>。<strong>如果一个渲染进程（Tab页）因为代码崩溃了，它不会影响到浏览器主进程或其他 Tab 页</strong>。</p>
<p>线程间资源共享：<strong>同一个进程内的所有线程都可以访问该进程的内存空间</strong>。这意味着 <strong>JS 引擎线程可以轻松地读取到由网络线程下载并存放在内存中的数据</strong>。</p>
<h4 data-id="heading-5">C. 协同与竞争：互斥锁的由来 ★★★</h4>
<p>这是理解“为什么 JS 会阻塞渲染”的关键点：</p>
<p><strong>在同一个渲染进程内，GUI 渲染线程和 JS 引擎线程是互斥的。</strong></p>
<p><strong>原因：因为 JavaScript 脚本具有修改 DOM 的能力。如果两者同时运行，GUI 线程正在绘制一个 DOM 节点，而 JS 线程同时把它删除了，就会导致渲染结果不可预期。因此，浏览器规定：当 JS 引擎工作时，GUI 渲染线程会被挂起。</strong></p>
<h3 data-id="heading-6">2. 为什么浏览器要采用“多进程”而非“单进程多线程”？</h3>
<p>在早期的浏览器中，所有功能都运行在一个进程里。现代浏览器演进为多进程架构，主要是为了解决三个核心痛点：</p>
<p>稳定性： 在单进程下，任何一个线程的崩溃（如 Flash 插件卡死或复杂的脚本死循环）都会导致整个浏览器瘫痪。多进程架构下，<strong>“一个 Tab 一个进程”</strong> 实现了故障隔离。</p>
<p>安全性： 浏览器通过<strong>沙箱</strong> 机制将渲染进程锁起来。<strong>由于渲染进程运行的是不受信任的第三方脚本，沙箱让它无法直接读写本地文件或调用系统 API</strong>。所有的敏感操作必须通过 IPC（进程间通信） 告知浏览器主进程，由主进程进行权限审查后代为执行。</p>
<p>流畅性： <strong>多进程可以更充分地利用多核 CPU 的并行计算能力</strong>。同时，某些耗时的操作（如网络下载、插件运行）被抽离到独立进程中，<strong>不会占用渲染进程的主线程</strong>。</p>
<h3 data-id="heading-7">3.浏览器的主要进程及其进程下的线程（4 个核心进程 和 2 个辅助/动态进程）</h3>
<h4 data-id="heading-8">① 浏览器主进程</h4>
<p><strong>它是浏览器的核心，也是所有进程的父进程。</strong></p>
<p><strong>职责：</strong></p>
<p>界面显示：负责<strong>地址栏、前进后退按钮、书签栏</strong>等浏览器“外壳”的 UI。</p>
<p>用户交互：<strong>监听鼠标点击、键盘输入</strong>。</p>
<p>进程管理：负责<strong>创建、销毁和协调其他子进程</strong>。</p>
<p>存储功能：<strong>负责管理 Cookie、本地存储（LocalStorage）等磁盘读写</strong>。</p>
<p><strong>核心线程：</strong></p>
<ul>
<li><strong>UI 线程</strong>：负责绘制浏览器外壳（地址栏、书签栏、窗口控制按钮）。</li>
<li><strong>I/O 线程</strong>：负责与其他进程进行 IPC 通信。（进程管理）</li>
</ul>
<p><strong>它负责管理子进程。当你点击关闭按钮，是 UI 线程捕捉到信号，通知浏览器进程去销毁对应的渲染进程</strong>。</p>
<h4 data-id="heading-9">② 网络进程</h4>
<p><strong>原本是浏览器主进程中的一个线程，为了提升稳定性和安全性，现代 Chrome 将其独立为进程，专门负责处理与外部世界的资源交换。</strong></p>
<p><strong>职责：</strong></p>
<p>资源加载：负责<strong>发起所有的网络请求</strong>（HTTP/HTTPS），并<strong>接收服务器返回的数据</strong>。</p>
<p>协议解析：<strong>解析 HTTP 响应头、状态码，处理 301/302 重定向</strong>。</p>
<p>DNS 解析：<strong>将域名映射为 IP 地址</strong>。</p>
<p>缓存管理：根据 HTTP 头部信息（如 Cache-Control）<strong>判断并管理磁盘/内存中的网络资源缓存</strong>。</p>
<p>安全校验：<strong>拦截恶意 URL 访问</strong>（如 Safe Browsing 安全检查）。</p>
<p>Cookie 处理：负责 HTTP 响应中 Set-Cookie 的解析，以及<strong>请求时 Cookie 字段的自动注入</strong>。</p>
<p><strong>核心线程：</strong></p>
<p><strong>网络协议栈线程</strong>：这是最忙碌的“工人”，负责处理 TCP 握手、TLS 加密解密、以及 HTTP/1.1、H2、H3 协议的处理。</p>
<p><strong>DNS 解析线程</strong>：专门负责寻找域名背后的 IP 地址，并维护 DNS 缓存。</p>
<p><strong>Socket 管理线程</strong>：管理与不同服务器之间的长连接（Connection Pool）。</p>
<h4 data-id="heading-10">③ 渲染进程</h4>
<p><strong>这是前端代码真正运行的“车间”，也是浏览器安全机制的核心。每个 Tab 标签页通常拥有一个独立的渲染进程，它运行在“沙箱”中，无法直接访问系统资源。</strong></p>
<p><strong>核心职责：</strong></p>
<p>解析与构建：<strong>将 HTML、CSS 字节流转化为浏览器能理解的 DOM 树和 CSSOM 树</strong>。</p>
<p>脚本执行：<strong>运行 JavaScript 代码，处理用户交互逻辑</strong>。</p>
<p>布局与绘制：<strong>计算元素的大小位置，并生成最终的像素图像传给 GPU 进程</strong>。</p>
<p><strong>五大核心线程：</strong></p>
<p><strong>A.GUI 渲染线程</strong></p>
<p>职责：负责解析 HTML、CSS，构建 DOM 树、CSSOM 树、布局树和绘制。</p>
<p>特点：<strong>当界面需要重绘（Repaint）或由于某些操作引发回流（Reflow）时，该线程就会执行</strong>。</p>
<p><strong>B.JS 引擎线程</strong></p>
<p>职责：<strong>负责解析 JavaScript 脚本，运行代码</strong>。</p>
<p><strong>核心痛点（互斥机制）：JS 引擎线程与 GUI 渲染线程是互斥的。如果 JS 执行时间过长，就会导致页面渲染加载阻塞，出现掉帧或卡顿。</strong></p>
<p><strong>面试亮点：为什么互斥？因为 JS 拥有修改 DOM 的权限。如果两者并行，可能会出现“GUI 正在画背景，而 JS 删除了该节点”的竞态问题。</strong></p>
<p><strong>C.事件触发线程</strong></p>
<p>职责：<strong>归属于浏览器而不是 JS 引擎</strong>，用来控制事件循环（Event Loop）。</p>
<p>工作机制：当事件被触发（如点击、AJAX 完成）时，该线程会将对应的回调任务加入到任务队列的末尾，等待 JS 引擎空闲时处理。</p>
<p><strong>D.定时器触发线程</strong></p>
<p>职责：<strong>负责 setTimeout 与 setInterval 的计时</strong>。</p>
<p>存在的意义：因为 JS 引擎是单线程的，如果处于阻塞状态就无法计时。因此需要独立线程计时，计时完毕后再通知事件触发线程将回调推入队列。</p>
<p>注意：W3C 标准规定，setTimeout 的间隔时间低于 4ms 会被自动设为 4ms。</p>
<p><strong>E.异步 HTTP 请求线程</strong></p>
<p>职责：<strong>在请求发起后，通过浏览器分配一个线程专门负责监控网络状态</strong>。</p>
<p>工作机制：当请求状态变更（如成功返回）时，如果设有回调函数，该线程就会通知“事件触发线程”将回调放入任务队列。</p>
<p><strong>F. 合成线程</strong>
<strong>专门负责处理页面的分层和图像合成，不占用主线程(GUI渲染线程和JS引擎线程)</strong>。</p>
<p><strong>职责：</strong></p>
<p>接收指令：<strong>主线程完成布局和绘制列表后，将这些信息提交给合成线程</strong>。</p>
<p>图层切片：<strong>将页面图层划分为大小固定的图块（Tiles），优先栅格化视口内的内容</strong>。</p>
<p>调度栅格化：<strong>配合 GPU 进程将图块转换为位图（像素点）</strong>。</p>
<p>响应交互：<strong>直接处理页面的滚动 (Scroll) 和 缩放 (Zoom)，而无需经过主线程</strong>。</p>
<p><strong>核心优势（独立性）</strong>：</p>
<p><strong>非阻塞交互：由于合成线程与 JS 引擎线程、GUI 渲染线程不互斥。这意味着即使 JS 引擎正在运行一个死循环导致页面卡死，你依然可以流畅地滚动页面。</strong></p>
<p><strong>硬件加速：它是利用 GPU 资源的核心入口，通过处理 transform、opacity 等属性，实现无需重排重绘的高性能动画。</strong></p>
<h4 data-id="heading-11">④ GPU 进程 (GPU Process)</h4>
<p><strong>最初仅用于处理 3D 图形，但随着现代网页对流畅度要求的提高，它已成为网页“排版合成”与“像素上色”的物理支柱。</strong></p>
<p><strong>职责：</strong></p>
<p>硬件加速：<strong>将合成线程提交的图块由逻辑指令转换为显卡可识别的位图</strong>。</p>
<p>复合渲染：<strong>负责将来自不同进程（如浏览器进程的 UI、渲染进程的网页内容）的位图进行混合，最终绘制到显示器屏幕上。</strong></p>
<p><strong>核心线程：</strong></p>
<p>GPU 渲染线程：<strong>与显卡驱动直接通信，执行真正的绘制操作</strong>。</p>
<p><strong>为什么独立？</strong></p>
<p>浏览器将 GPU 独立为进程，主要是因为图形处理涉及到复杂的操作系统底层调用和硬件驱动。驱动程序通常不如系统核心稳定，一旦 GPU 任务崩溃，浏览器只需重启该进程即可，而不会导致整个浏览器或所有标签页“黑屏”或死机。</p>
<h4 data-id="heading-12">⑤ 插件进程 (Plugin Process)</h4>
<p>专门用于运行如 Flash、Silverlight 等第三方插件的进程。</p>
<p><strong>职责：</strong></p>
<p>隔离风险：<strong>插件往往由第三方开发，稳定性差且极易存在安全漏洞</strong>。</p>
<p>物理隔离：确保即便插件崩溃或被劫持，其破坏力也仅限在该进程内部，不会波及渲染进程（你的网页）或主进程。</p>
<p>随着 Chrome 彻底停止对 Flash 的支持，现代网页中插件进程已较少出现。注意不要将“插件”与“扩展”混淆。</p>
<h4 data-id="heading-13">⑥ 扩展进程 (Extension Process)</h4>
<p>地位：<strong>为你安装的浏览器扩展程序</strong>（如 Vue Devtools, AdBlock, 翻译插件）提供独立的运行空间。</p>
<p><strong>职责：</strong></p>
<p>独立运行：<strong>确保扩展程序的 JS 逻辑不会占用网页渲染进程的 CPU 资源</strong>。</p>
<p>权限管控：浏览器进程会<strong>根据扩展申明的权限</strong>，<strong>严格控制扩展进程对网页内容（DOM）或系统 API 的访问</strong>。</p>
<h4 data-id="heading-14">思考题</h4>
<p><strong>渲染进程有GUI线程负责对html css js的解析和渲染，主进程的UI线程和gpu进程的gup加速线程也有类似功能，为什么要这样设计？</strong></p>
<h5 data-id="heading-15">A. 渲染进程：逻辑计算的核心</h5>
<p>虽然它叫“渲染进程”，但它大部分时间在做<strong>逻辑转换</strong>。</p>
<p>GUI 线程的工作：<strong>它把代码字节流变成 DOM/CSSOM。最重要的是，它计算出 Layout（布局）。</strong> 它告诉浏览器：“这里有一个 100x100 的红色方块”。</p>
<p>它不直接画图：<strong>GUI 线程并不直接控制显示器像素</strong>，它生成的只是“绘制指令（Paint Records）”。</p>
<h5 data-id="heading-16">B. GPU 进程：硬件加速的真相</h5>
<p>以前浏览器确实靠 CPU 画图（软件渲染），但 CPU 处理图形太慢了。</p>
<p>GPU 加速线程：它<strong>接收来自合成线程的指令</strong>。因为 GPU 擅长并行处理大量像素，它<strong>把渲染进程算好的“图块”直接转为屏幕上的像素。</strong></p>
<p>独立性：<strong>把 GPU 独立出来是为了防崩溃。图形驱动非常脆弱，如果 GPU 线程在渲染进程里，一个复杂的 3D 效果挂了，你的网页就崩了。</strong></p>
<h5 data-id="heading-17">C. 主进程（UI 线程）：窗口的守护者</h5>
<p>为什么主进程也要参与“显示”？</p>
<p><strong>非网页区域的渲染</strong>：网页之外的区域（地址栏、书签栏、前进后退按钮）不受渲染进程控制。</p>
<p>最终合成：这是一个关键点。<strong>屏幕上显示的内容 = 浏览器外壳位图 + 网页内容位图</strong>。</p>
<p>协作流程：<strong>GPU 进程会把画好的网页内容位图交给主进程，主进程把自己的 UI 位图叠上去，最后由主进程指挥显示器把这整张图显示出来。</strong></p>
<h5 data-id="heading-18">一个具体的场景：改变 background-color</h5>
<p>渲染进程 (JS/GUI 线程)：JS 修改了 CSS，主线程重新计算样式，发现颜色变了，生成一份新的“绘制列表”。</p>
<p>渲染进程 (合成线程)：拿到列表，把任务分块，发给 GPU 进程。</p>
<p>GPU 进程 (GPU 线程)：调用显卡硬件，把受影响的像素点重新喷色，生成位图。</p>
<p>浏览器主进程 (UI 线程)：把这张新的位图放在浏览器窗口的“白板”区域显示。</p>
<h2 data-id="heading-19">三、从url输入到页面渲染的全流程（结合浏览器多进程架构）</h2>
<p><strong>整个流程实质上是多个独立进程在浏览器主进程的调度下，通过 Mojo IPC（进程间通信） 进行的一场数据与控制权的接力。</strong></p>
<h4 data-id="heading-20">1. 导航触发：浏览器主进程的调度与拦截</h4>
<p>输入预处理：<strong>UI 线程</strong>拦截地址栏输入。<strong>若为非 URL 字符串，调用搜索引擎封装 URL；若为合法 URL，则直接进入导航逻辑</strong>。</p>
<p><strong>BeforeUnload 拦截</strong>：如果当前已存在页面，主进程通过 IPC 向当前渲染进程发出信号。渲染进程执行 JS 逻辑并返回结果。为了防止渲染进程无响应导致导航卡死，主进程会对这一过程设置 Timeout 阈值。</p>
<p>启动网络指令：<strong>UI 线程发起一个指向 网络进程 的 IPC 请求</strong>。</p>
<p><strong>这里详细解释一下BeforeUnload和启动网络指令的过程及优化——</strong></p>
<h5 data-id="heading-21">① BeforeUnload 拦截：给旧页面“交代遗言”的机会</h5>
<p>当你点击一个链接或在地址栏回车时，<strong>当前的网页（旧页面）还没销毁。浏览器必须先询问</strong>它：“你还有没处理完的事吗？”</p>
<p>IPC 信号是什么？ 浏览器主进程（管理窗口的）发现你要跳走了，<strong>它会发一个 IPC（进程间通信）消息 给当前网页所在的渲染进程</strong>。</p>
<p><strong>渲染进程在做什么？ 渲染进程接收信号后，会检查 JS 代码里有没有监听 beforeunload 事件。比如你在写博客，还没保存，JS 就会弹出一个对话框：“系统可能不会保存您所做的更改。确定要离开吗？”</strong></p>
<p>为什么需要 Timeout（超时）阈值？ 这是<strong>为了防死锁</strong>。如果旧页面的渲染进程崩了，或者 JS 写了个死循环（例如 while(true){}），它就无法回复主进程。如果没有超时机制，你的浏览器地址栏就会永远卡在那里。</p>
<p>底层逻辑： 主进程会启动一个定时器（比如几秒钟）。如果渲染进程在规定时间内没回话，主进程会认为这个渲染进程“挂了”，直接强行掐断它的生命周期，强制开始加载新页面。</p>
<h5 data-id="heading-22">②启动网络指令：外交部正式出航</h5>
<p>一旦旧页面被处理完（或者超时了），浏览器主进程就要去互联网上拿新页面的数据了。</p>
<p>UI 线程发起请求： 此时，主进程里的 UI 线程（负责处理地址栏、按钮点击的那个工人）会整理好目标 URL、Cookie、请求头等信息。</p>
<p>指向网络进程的 IPC 请求： 在现代 Chrome 中，<strong>主进程自己不负责下载。它会把刚才整理好的“请求包”通过 IPC 扔给 网络进程</strong>。</p>
<p>形象点说： 主进程（CEO）给网络进程（外交部）打了个电话：“喂，去帮我把 github.com 的 HTML 字节流取回来。”</p>
<h5 data-id="heading-23">③为什么这两步是“并行的优化点”？</h5>
<p><strong>这里有一个非常硬核的亮点：现代浏览器并不会等 beforeunload 彻底结束才去发起网络请求。</strong></p>
<p>为了快，浏览器通常会采取 并行策略：</p>
<p>一边让主进程询问旧页面是否要离开。</p>
<p>一边同步通知网络进程去进行 DNS 解析 和 建立连接。</p>
<p><strong>如果用户最后点击了“取消离开”，浏览器就把刚发起的网络请求掐断。如果用户确定离开，此时网络连接可能已经建好了，网页秒开。这就是所谓的 “导航预加载”思想。</strong></p>
<h4 data-id="heading-24">2. 网络资源获取：网络进程的“外交”与“初筛”</h4>
<p><strong>当网络进程接到主进程的指令后，它开始在互联网上为网页寻找材料。</strong></p>
<h5 data-id="heading-25">A. 物理链路的打通（建立连接）</h5>
<p><strong>浏览器缓存：首先检查网络进程内存中存储的 DNS 记录（通常缓存 1 分钟）</strong></p>
<p><strong>DNS 与握手</strong>：<strong>如果浏览器缓存未命中网络进程会去查 IP 地址（DNS），然后进行 TCP 三次握手。如果是 HTTPS，还要进行 TLS 加密握手。</strong></p>
<p>亮点：<strong>为了快，浏览器会维护一个 连接池。如果最近刚访问过这个域名，它会直接复用之前的“管道”，省去握手时间。</strong></p>
<h5 data-id="heading-26">B. 响应头的解析与“重定向”黑箱</h5>
<p><strong>内部消化重定向</strong>：<strong>如果服务器返回 301/302（重定向），网络进程不会跑回去告诉主进程</strong>，而是自己在内部重新发起新的请求。</p>
<p>逻辑意义：对主进程和渲染进程来说，它们只关心最终拿到的结果，中间转了几次弯（重定向），网络进程在底层偷偷帮你处理好了。</p>
<h5 data-id="heading-27">C. 核心：响应体的“首包”嗅探</h5>
<p>这是全流程中最精妙的地方。当<strong>网络进程收到服务器返回的第一份数据包（通常是前几个字节）时</strong>：</p>
<p>确定身份：网络进程会查看 Content-Type。</p>
<p>如果是 text/html，它就知道：“正主来了，<strong>准备通知渲染进程</strong>干活”。</p>
<p>如果是 application/octet-stream，它会意识到：“这是一个下载任务”，于是<strong>把请求转交给下载管理器，导航流程在此终止。</strong></p>
<p>建立数据管道：</p>
<p><strong>核心机制：一旦确认是 HTML，网络进程不会等整个网页下载完。</strong></p>
<p><strong>它会建立一条“数据长管”。管子的这头在网络进程（继续下载后续字节），管子的那头直接插进未来的渲染进程。</strong></p>
<p><strong>它的意义：实现“边下载边解析”，极大地缩短了白屏时间。</strong></p>
<h4 data-id="heading-28">3. 提交导航：控制权从主进程移交给渲染进程</h4>
<p>这是导航阶段最核心的“状态切换”点，标志着页面正式从旧地址切换到新地址。</p>
<p><strong>进程分配：主进程根据 Site Isolation 策略分配渲染进程。如果是同站跳转，可能复用原有进程；否则启动新进程。</strong></p>
<p>Commit 指令：主进程发送 CommitNavigation 消息给目标 渲染进程。</p>
<p><strong>数据交接：主进程会将网络进程中那个 Data Pipe 的句柄随指令发送给渲染进程。</strong></p>
<p>确认反馈：渲染进程收到句柄后，直接从管道读取数据流。一旦开始解析，渲染进程向主进程发送 DidCommitProvisionalLoad。</p>
<p><strong>状态切换：主进程收到反馈后，执行 UI 状态更新（更新地址栏、重置历史记录、刷新前进按钮）。此时旧页面正式被销毁。</strong></p>
<h4 data-id="heading-29">4. 渲染流水线：渲染进程与 GPU 的像素产出</h4>
<p><strong>在渲染进程接收到“数据管道”的句柄后，内部的主线程、合成线程 与 GPU 进程 开始高度协同。</strong></p>
<h5 data-id="heading-30">A. 解析与构建：将字节转化为结构</h5>
<p>流式解析：<strong>主线程无需等待 HTML 下载完成。通过 Data Pipe，每接收到一个数据包，GUI 渲染线程就会立即启动解析，边下载边构建 DOM 树。</strong></p>
<p>样式计算（CSSOM）：<strong>主线程解析 CSS 样式，计算出每个 DOM 节点的最终样式</strong>。</p>
<p><strong>亮点（互斥机制）：此阶段若遇到 <code>&lt;script&gt;</code>，主线程会挂起 GUI 渲染线程，切换到 JS 引擎线程。这种互斥确保了 JS 在修改 DOM 时不会产生渲染竞态。</strong></p>
<h5 data-id="heading-31">B. 几何计算：确定空间坐标</h5>
<p>布局树（Layout Tree）构建：主线程将 DOM 与 CSSOM 合并。它会过滤掉 display: none 的节点，仅保留可见元素。</p>
<p>几何量算：<strong>主线程精确计算每个元素在三维空间中的 (x, y) 坐标、宽高及层级</strong>。</p>
<p><strong>产物：一棵包含所有几何信息的布局树。</strong></p>
<h5 data-id="heading-32">C. 记录与图层化：生成施工图纸</h5>
<p><strong>分层：为了处理 3D 转换（transform）或滚动，主线程会根据属性将页面拆分为多个图层。</strong></p>
<p>绘制记录（Paint）：<strong>主线程并不直接画图，而是将每个图层的绘制逻辑拆解为一个个指令</strong>（如：“在此处画正方形”，“在彼处填充红色”）。</p>
<p><strong>产物：一份名为 绘制记录（Paint Records） 的逻辑清单。</strong></p>
<h5 data-id="heading-33">D. 栅格化与合成：像素的工业产出</h5>
<p>任务此时从主线程移交给合成线程，进入真正的硬件加速阶段。</p>
<p><strong>切片（Tiling）：合成线程将巨大图层划分为固定大小的 图块（Tiles），优先处理视口（用户肉眼可见区域）内的内容。</strong></p>
<p><strong>栅格化：</strong></p>
<p>合成线程通过 IPC 向 GPU 进程 发出指令。</p>
<p><strong>GPU 进程 利用显卡的并行计算能力，将图块指令转化为显存中的位图。</strong></p>
<p><strong>复合与上屏：</strong></p>
<p><strong>合成线程收集所有图块位图，生成一份“指引（Compositor Frame）”。</strong>
<strong>浏览器主进程 接收该指引，将网页位图与浏览器外壳（地址栏等）进行叠加，最终由 GPU 刷新到屏幕上。</strong></p>
<h5 data-id="heading-34">为什么要把“合成”独立出来？</h5>
<p><strong>非阻塞滚动：当主线程因为运行复杂的 JavaScript 而卡死时，合成线程 依然可以独立工作。它能直接利用 GPU 显存里已有的位图进行位移偏移，这就是为什么即便网页脚本卡顿，你依然能流畅滑动（Scroll）页面的原因。</strong></p>
<p><strong>硬件加速：通过 transform 或 opacity 做的动画，直接在合成阶段完成，不触发主线程的“重排”或“重绘”，实现了真正的性能最优。</strong></p>
<h2 data-id="heading-35">四、流水线视角的重排、重绘与合成</h2>
<p><strong>理解了多进程协作的渲染流水线后，我们就能从底层逻辑解释：为什么有的代码会让页面卡顿，而有的代码却能实现 60fps 的丝滑动画？ 关键在于你的操作强迫流水线“回溯”到了哪一步。</strong></p>
<h4 data-id="heading-36">1. 重排</h4>
<p>触发原因：修改了影响几何空间的属性（如 width, height, margin, padding, border, display 等），或调整浏览器窗口大小。</p>
<p><strong>流水线回溯：</strong></p>
<p>主线程：必须重新经历 样式计算 -&gt; 布局  -&gt; 图层分层  -&gt; 生成绘制列表 。</p>
<p>合成线程：重新进行图块划分。</p>
<p>GPU 进程：重新进行栅格化和位图上传。</p>
<p><strong>这是开销最大的操作，因为它触发了全量流水线，且深度依赖主线程的计算压力。</strong></p>
<h4 data-id="heading-37">2. 重绘</h4>
<p>触发原因：修改了不影响布局、仅影响视觉外观的属性（如 color, background-color, visibility, box-shadow 等）。</p>
<p><strong>流水线回溯：</strong></p>
<p>主线程：跳过布局和分层，直接重新生成 绘制记录。</p>
<p>合成/GPU 进程：重新进行栅格化。</p>
<p><strong>开销中等。虽然避开了几何几何计算，但依然需要主线程生成指令并触发 GPU 重新喷色。</strong></p>
<h4 data-id="heading-38">3. 合成 (Composite)：硬件加速的“超车道”</h4>
<p>触发原因：使用 CSS 的 transform（位移、缩放、旋转）或 opacity。</p>
<p><strong>流水线表现：</strong></p>
<p>主线程完全不参与。</p>
<p>合成线程：直接接收指令，在 GPU 中利用已有的图块位图进行矩阵变换。</p>
<p><strong>开销极低。这是多进程架构带来的最大红利——动画直接在合成线程与 GPU 进程间通讯，即使此时 JS 引擎在主线程里跑死循环，合成动画依然能流畅运行。</strong></p>
<h2 data-id="heading-39">五、总结</h2>
<p>通过对浏览器多进程架构及渲染流水线的深度解构，我们可以发现，从输入 URL 到页面呈现，本质上是一场多进程间的“接力赛”与流水线上的“精密加工”。</p>
<h3 data-id="heading-40">1. 核心链路回顾</h3>
<p>我们可以将整个漫长的流程浓缩为四个关键的瞬间：</p>
<p>主进程：拦截输入，启动导航，指挥网络部出航。</p>
<p>网络进程：打通链路，嗅探内容，并建立指向未来的数据管道。</p>
<p>渲染进程-主线程：将字节流转化为 DOM/CSSOM，并在几何计算中确定每一个像素的坐标。</p>
<p>合成线程 &amp; GPU：利用硬件加速，将逻辑指令转化为位图，实现最终的像素上屏。</p>
<h3 data-id="heading-41">2. 给前端开发的性能启示</h3>
<p>理解了这套底层机制，我们对“性能优化”的理解便不再流于表面，而是进化为一种流水线思维：</p>
<p><strong>保护主线程：GUI 渲染与 JS 执行的互斥性告诉我们，长任务是掉帧的元凶。我们应当利用 Web Workers 或时间切片来释放主线程。</strong></p>
<p><strong>善用合成器：优先使用 transform 和 opacity 实现动画，本质上是在利用多进程架构的红利，绕过拥挤的主线程，走 GPU 加速的“超车道”。</strong></p>
<p><strong>尊重重排规律：减少对 offsetWidth 等属性的频繁读取，实质上是在保护流水线不被“强制同步布局”打断，避免昂贵的重复计算。</strong></p>
<h3 data-id="heading-42">3. 写在最后</h3>
<p>浏览器作为现代最复杂的软件之一，其多进程架构是稳定性、安全性和高性能<strong>巴巴博弈</strong>后的终极方案。</p>
<p>作为开发者，理解底层是为了更自由地构建上层。 当你再次打开浏览器的 Performance 面板，看到那些交织的进程与线程曲线时，你看到的不再是枯燥的数据，而是一场由数万行 C++ 代码支撑、毫秒必争的协作交响乐。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GIS 数据转换：使用 GDAL 将 Shp 转换为 GeoJSON 数据]]></title>    <link>https://juejin.cn/post/7589477775210430516</link>    <guid>https://juejin.cn/post/7589477775210430516</guid>    <pubDate>2025-12-30T12:49:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589477775210430516" data-draft-id="7589494631005601827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GIS 数据转换：使用 GDAL 将 Shp 转换为  GeoJSON 数据"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-30T12:49:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GIS 数据转换：使用 GDAL 将 Shp 转换为  GeoJSON 数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:49:19.000Z" title="Tue Dec 30 2025 12:49:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>❝</p>
<p>GeoJSON 作为一种通用的地理数据格式，可以很方便地用于共享交换。在 GIS 开发中，经常需要进行数据的转换处理，其中常见的便是将 Shp 转换为 GeoJSON 数据进行展示。</p>
</blockquote>
<p>有关<code>GeoJSON</code>数据的详细介绍，请参考往期文章：<strong>GeoJSON 数据简介</strong></p>
<p>在之前的文章中讲了如何使用<code>GDAL</code>或者<code>ogr2ogr</code>工具将<code>txt</code>以及<code>csv</code>文本数据转换为<code>Shp</code>格式，本篇教程在之前一系列文章的基础上讲解如何使用<code>GDAL</code>将<code>Shp</code>转换为<code>GeoJSON</code>数据。</p>
<ul>
<li>GDAL 简介</li>
<li>GDAL 下载安装</li>
<li>GDAL 开发起步</li>
</ul>
<p>如果你还没有看过，建议从以上内容开始。</p>
<h2 data-id="heading-1">1. 开发环境</h2>
<p>本文使用如下开发环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<h2 data-id="heading-2">2. 数据准备</h2>
<p><strong>如下是本文选取的世界边界范围的Shp数据结构：</strong> <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ceb55ac33e924cce9d129203dfd909f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767703759&amp;x-signature=eBBh13tm3SXk%2B4q0w8HVBF0GePA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/815ee2daf18e4d2584886689a769545d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767703759&amp;x-signature=wu2rG%2FQgBri44j9NGIv2PJRoxe4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">3. 导入依赖</h2>
<p><code>Shp</code>作为一种矢量数据格式，可以使用矢量库<code>OGR</code>进行处理，以实现<code>Shp</code>数据转换为<code>GeoJSON</code>格式。还需要引入<code>osr</code>模块用于坐标定义以及<code>json</code>模块用于几何数据转换。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">from</span> osgeo <span class="hljs-keyword">import</span> ogr,osr
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json
</code></pre>
<h2 data-id="heading-4">4. 数据读取与转换</h2>
<p>定义一个方法<code>Shp2GeoJSON(shpPath,jsonPath)</code>用于将<code>Shp</code>数据转换为<code>GeoJSON</code>数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：将 GeoJSON 文件转换为 Shapfile 文件
参数：
    -shpPath：Shp 文件路径
    -jsonPath：GeoJSON 文件路径
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">Shp2GeoJSON</span>(<span class="hljs-params">shpPath,jsonPath</span>):
</code></pre>
<p>在进行<code>GeoJSON</code>数据格式转换之前，需要检查<code>Shp</code>数据路径是否存在。</p>
<pre><code class="hljs language-lua" lang="lua"># 检查文件是否存在
<span class="hljs-keyword">if</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.exists(shpPath):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"shp 文件存在。"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"shp 文件不存在，请检查数据路径！"</span>)
    <span class="hljs-keyword">return</span>
</code></pre>
<p>打开<code>Shp</code>数据源。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 读取Shp文件</span>
<span class="hljs-attr">shpDataSource</span> = ogr.Open(shpPath)
<span class="hljs-attr">shpLayer</span> = shpDataSource.GetLayer()
</code></pre>
<p>首先构造一个<code>GeoJSON</code>空数据结构，用于填充<code>Shp</code>属性数据。</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 构造GeoJSON对象</span>
geoJSON = {
    <span class="hljs-string">"type"</span>:<span class="hljs-string">"FeatureCollection"</span>,
    <span class="hljs-string">"features"</span>:[]
}
</code></pre>
<p>读取并遍历<code>Shp</code>图层，将几何对象以及属性对象复制到<code>GeoJSON</code>对象中。使用<code>ExportToJson</code>方法将几何数据转换为<code>JSON</code>格式，然后使用<code>json.loads</code>方法进行加载，属性读取完成之后，将要素添加到要素集合中。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 遍历所有要素</span>
for feature in shpLayer:
    <span class="hljs-comment"># 几何对象</span>
    <span class="hljs-attr">geom</span> = feature.GetGeometryRef()
    <span class="hljs-comment"># 构造GeoJSON Feature对象</span>
    <span class="hljs-attr">featureJSON</span> = {
        "type":"Feature",
        "geometry":json.loads(geom.ExportToJson()),
        "property":{}
    }

    <span class="hljs-comment"># 获取属性</span>
    <span class="hljs-attr">fieldCount</span> = feature.GetFieldCount()
    for i in range(fieldCount):
        <span class="hljs-attr">fieldName</span> = feature.GetFieldDefnRef(i).GetName()
        <span class="hljs-attr">fieldValue</span> = feature.GetField(i)
        featureJSON<span class="hljs-section">["property"]</span><span class="hljs-section">[fieldName]</span> = fieldValue

    <span class="hljs-comment"># 添加要素</span>
    geoJSON<span class="hljs-section">["features"]</span>.append(featureJSON)
</code></pre>
<p>在<code>Shp</code>数据读取完成之后，将其保存到<code>GeoJSON</code>文件中，并关闭数据源。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 写入文件</span>
with open(jsonPath,"w",<span class="hljs-attr">encoding</span>=<span class="hljs-string">"UTF-8"</span>) as f:
    json.dump(geoJSON,f,<span class="hljs-attr">ensure_ascii</span>=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)

<span class="hljs-comment"># 关闭数据源</span>
<span class="hljs-attr">shpDataSource</span> = None
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Manus被收购，智谱也定了8天后上市]]></title>    <link>https://juejin.cn/post/7589325011544637478</link>    <guid>https://juejin.cn/post/7589325011544637478</guid>    <pubDate>2025-12-30T11:04:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589325011544637478" data-draft-id="7589474656874790922" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Manus被收购，智谱也定了8天后上市"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-30T11:04:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Manus被收购，智谱也定了8天后上市
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T11:04:27.000Z" title="Tue Dec 30 2025 11:04:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI 大新闻，一桩接一桩。</p>
<p>早上刚传来 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2651009685%26idx%3D1%26sn%3Dbfc44e95b106534d25b4002c3e701ee3%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2651009685&amp;idx=1&amp;sn=bfc44e95b106534d25b4002c3e701ee3&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">Manus </a>被 Meta 收购的消息，很快，围绕「全球大模型第一股」的竞速，也传来靴子落地的声响。</p>
<p>12 月 30 日，北京智谱华章科技股份有限公司（以下简称「智谱」）正式启动港股招股。招股期将持续至 2026 年 1 月 5 日，并计划于 2026 年 1 月 8 日以股票代码 “2513” 在香港联交所主板挂牌上市。</p>
<p>根据招股安排，智谱拟进行全球发售 3741.95 万股 H 股，其中香港公开发售 187.1 万股 H 股，国际发售 3554.85 万股 H 股。</p>
<p>IPO 的定价与募资规模也随之揭晓 —— 每股发行价定为 116.20 港元。在扣除相关发行费用后，预计本次募资规模约 43 亿港元，对应的 IPO 市值预计将超过 511 亿港元。</p>
<p>公开信息显示，智谱在私募市场的累计融资额已达 83.44 亿元，最新估值攀升至 243.77 亿元。这意味着，在迈向上市的关键一跃中，智谱的市值几乎实现翻倍，如此幅度的「溢价上市」，也是一次难度不低的市场挑战。</p>
<p>基石投资者阵容同样颇为亮眼。公告显示，基石投资者合计拟认购 29.8 亿港元，占本次发行规模近七成（假设超额配股权未获行使）。</p>
<p>参与基石认购的机构包括： JSC International Investment Fund SPC、JinYi Capital Multi-Strategy Fund SPC、Perseveranc Asset Management、上海高毅资产管理、WT Asset Management、泰康人寿、广发基金、3W Fund Management 等 11 家投资机构。</p>
<p>在当前港股科技资产整体承压的背景下，如此高比例的基石认购，也为这场围绕「全球大模型第一股」的竞速，写下了更为明确的市场注脚。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e168498cee594de6b617e31102e48ed1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767697467&amp;x-signature=VT6RhUMtU0rqMe0t3GZbvznxaqU%3D" alt="图片" loading="lazy"/></p>
<p>烧钱还在继续，大模型开始走向资本市场</p>
<p>放眼行业内部，2024 年曾被热捧的 AI 大模型创业阵营「六小虎」，已经出现明显分化：两家选择主动退出基座模型竞争，转而聚焦垂直应用。</p>
<p>其余四家 —— 智谱、MiniMax、月之暗面与阶跃星辰 —— 仍试图留在大模型这张牌桌之上。2024 年 12 月中下旬，智谱与 MiniMax 先后披露港股招股书。</p>
<p>与 MiniMax 专注 to C 不同，智谱主要专注企业级方案（to B），已落地金融服务、互联网、智能设备、医疗等行业。</p>
<p>今年上半年智谱收入为 1.91 亿元，期内亏损高达 23.58 亿元，AI 研发成本高达 15.95 亿元。</p>
<p>如果说，2023 年一级市场给予大模型创业公司的高估值，更多是押注宏大的技术叙事。那么进入 2024—2025 年，市场开始更明确地转向模型能力与商业化兑现路径。</p>
<p>即便是头部公司，也难以绕开对基座模型的持续投入，大模型创业公司也要直面能否持续推进模型迭代、探索应用场景落地的挑战。</p>
<p>而这些，在很大程度上，取决于资本市场是否愿意提供长期、稳定的资金支持。</p>
<p>今年 4 月，智谱曾在证监会北京监管局开启 A 股上市辅导备案。但截至 12 月 12 日，公司并未收到中国证监会关于推进 A 股上市的进一步意见或问询。</p>
<p>在此背景下，智谱选择转向港股，为这场高投入、长周期的大模型竞赛寻找更可持续的燃料。同时，也将直面融资能力与市场信心的双重考验 —— 是否有人愿意为 AI 的长期投入买单。</p>
<p>从 GLM 到 MaaS：智谱的大模型技术底座与商业化路径</p>
<p>招股书显示，智谱主要提供从算力、API 接口到 MaaS（模型即服务）的服务，支持本地和云端两种部署模式，已落地多个行业。</p>
<p>作为国内从事通用语言模型研究与产业化的代表性公司之一，智谱技术体系以 GLM 为核心，覆盖文本、多模态与面向应用的模型服务。</p>
<p>GLM 属于基于 Transformer 的大语言模型建模范式，通过将自回归生成与掩码预测相结合，实现对理解类与生成类任务的统一建模。该架构最早由智谱与清华大学相关研究团队提出，并在后续模型中持续迭代。</p>
<p>2021 年，智谱发布中国首个专有预训练大模型框架 GLM，并推出了模型即服务（MaaS）的产品开发与商业化平台，通过该平台向外部提供大模型能力与服务。</p>
<p>2022 年智谱发布并开源 GLM-130B（中英双语千亿参数模型），该模型的推出标志着智谱正式将 GLM 体系运用于预训练大语言模型之上。</p>
<p>2024 年 1 月，GLM 系列迎来重要节点，GLM-4 上线，支持更长的上下文，同时推理速度更快，大大降低推理成本。</p>
<p>2025 年 7 月，智谱进一步开源 GLM-4.5。该模型首发 48 小时内，登顶 Hugging Face（全球最大的开源模型平台）热门榜全球第一。</p>
<p>同年 9 月，智谱发布并开源 GLM-4.6，作为基座模型的进一步升级版本，GLM-4.6 主要强化了编码能力。11 月，GLM-4.6 在 CodeArena 上位列全球第一。</p>
<p>12 月，智谱推出最新旗舰模型 GLM-4.7：</p>
<ul>
<li>
<p>在核心编码方面，相较前一代 GLM-4.6，GLM-4.7 在多语言智能体编程与基于终端的任务上取得了明显提升，SWE-bench 73.8%（+5.8%）、SWE-bench Multilingual 66.7%（+12.9%）。</p>
</li>
<li>
<p>氛围编程：GLM-4.7 在 UI 生成质量上实现了重要跃升，能够生成更加简洁、现代化的网页界面，并在演示文稿生成方面提供更准确的布局与尺寸控制，整体视觉效果更佳。</p>
</li>
<li>
<p>工具调用：GLM-4.7 的工具使用能力显著提升，在 BrowseComp 所覆盖的网页浏览任务中展现出更强的实际操作能力。</p>
</li>
<li>
<p>复杂推理上：在 HLE（Humanity’s Last Exam） 基准测试中取得 42.8% 的成绩，相比 GLM-4.6 提升 12.4 个百分点。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/893e5f0b099f4df999dd2443a83b8959~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767697467&amp;x-signature=CmtyEeVUmunWZfwWA%2FvPEBgdgrA%3D" alt="图片" loading="lazy"/></p>
<p>与 GPT-5、GPT-5.1-High、Claude Sonnet 4.5、Gemini 3.0 Pro、DeepSeek-V3.2、Kimi K2 Thinking 相比，GLM-4.7 也表现出色：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0e302ad82604163bbbcd18d70860ed5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767697467&amp;x-signature=dBK9NSGYu45E3SzYPvXX2bUTHrI%3D" alt="图片" loading="lazy"/></p>
<p>与此同时，智谱还发布了面向不同功能的多模态模型，包括 CogView（图像生成）、GLM-4.5V（视觉理解与推理）、CogVideoX（视频生成）等。</p>
<p>在 AI Agent 方面，智谱基座智能体模型为 AutoGLM。12 月智谱将 AutoGLM 的核心模型全面开源，标志着 AutoGLM 在开放生态中的进一步发展。</p>
<p>截至 2025 年 6 月 30 日，智谱模型已为超过 8000 家机构客户提供支持；截至最后实际可行日期，已为约 8000 万台设备提供支持。</p>
<p>在商业化方面，智谱从 2021 年就开始布局 MaaS 的商业模式。</p>
<p>MaaS 平台主要提供四类模型能力，主要覆盖语言模型、多模态模型、智能体模型和代码模型四类核心模型能力，并同时提供支持模型微调、模型部署及智能体开发的一体化工具链。</p>
<p>从模型能力的扩展、智能体技术的推进，到 MaaS 商业化体系的逐步成型，智谱已经完成了一轮相对完整的技术与产品布局。</p>
<p>但靴子落地，并不意味着终局已定。随着走向公开市场，高强度的研发投入、不断攀升的算力成本，以及通用大模型商业化路径尚未完全跑通的现实，也被一并置于更透明的审视之下。</p>
<p>上市不是终点，而是一场更长周期的公开测试。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（11）什么是Hibernate的持久化上下文？]]></title>    <link>https://juejin.cn/post/7589212818807930943</link>    <guid>https://juejin.cn/post/7589212818807930943</guid>    <pubDate>2025-12-30T11:50:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589212818807930943" data-draft-id="7589466706378555428" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（11）什么是Hibernate的持久化上下文？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T11:50:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（11）什么是Hibernate的持久化上下文？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T11:50:45.000Z" title="Tue Dec 30 2025 11:50:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的持久化上下文（Persistence Context）是一个非常重要的概念，它指的是一个特定的Session对象管理的持久化实体的集合。持久化上下文负责管理实体的生命周期、缓存实体，并提供事务性处理。持久化上下文的主要作用包括：</p>
<ol>
<li><strong>实体管理</strong>：管理对象的持久化状态，包括新建、删除、更新等操作。</li>
<li><strong>一级缓存</strong>：Session的一级缓存，用于在数据库查询中缓存实体，减少数据库访问次数，提高性能。</li>
<li><strong>事务性操作</strong>：在事务的范围内保持持久化上下文的一致性。</li>
<li><strong>脏检查</strong>：在事务提交时，自动检测并同步持久化对象的状态变化到数据库。</li>
</ol>
<h3 data-id="heading-0">示例项目结构</h3>
<p>为了深入理解持久化上下文，下面是一个完整的示例，包括如何配置Hibernate、定义实体类、管理Session，以及演示持久化上下文的行为。</p>
<h4 data-id="heading-1">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-2">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-3">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-4">持久化上下文示例</h4>
<p>下面的示例展示了持久化上下文的基本行为，包括实体的持久化、缓存管理以及事务性同步。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernatePersistenceContextExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        
        <span class="hljs-comment">// 打开一个新的Session</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 启动事务</span>
            transaction = session.beginTransaction();

            <span class="hljs-comment">// 创建并保存一个新的Student对象</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student);

            <span class="hljs-comment">// 持久化上下文中的student对象现在是持久化状态</span>
            student.setAge(<span class="hljs-number">21</span>); <span class="hljs-comment">// 修改对象的属性</span>

            <span class="hljs-comment">// 提交事务</span>
            transaction.commit();
            <span class="hljs-comment">// 到这里，student对象的状态已经同步到数据库</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close(); <span class="hljs-comment">// 关闭Session</span>
        }

        <span class="hljs-comment">// 重新打开一个新的Session</span>
        session = sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 启动事务</span>
            transaction = session.beginTransaction();

            <span class="hljs-comment">// 从数据库加载Student对象</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());

            <span class="hljs-comment">// 提交事务</span>
            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close(); <span class="hljs-comment">// 关闭Session</span>
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-5">详细解释</h3>
<ol>
<li>
<p><strong>持久化上下文</strong>：当调用<code>session.save(student)</code>时，<code>student</code>对象进入持久化上下文，成为持久化状态。任何对该对象的修改都会在事务提交时自动同步到数据库。</p>
</li>
<li>
<p><strong>一级缓存</strong>：在单个<code>Session</code>范围内，Hibernate维护一级缓存。第一次查询某个实体后，它会被缓存到Session中，随后对该实体的访问会直接从缓存中获取，而不再访问数据库。</p>
</li>
<li>
<p><strong>脏检查</strong>：在事务提交时，Hibernate会检查持久化上下文中的实体，找出已更改但未同步到数据库的实体，并自动执行相应的SQL更新操作。</p>
</li>
</ol>
<h3 data-id="heading-6">持久化上下文的生命周期</h3>
<ul>
<li><strong>Transient（瞬态）</strong>：对象在未与Session关联之前处于瞬态状态。</li>
<li><strong>Persistent（持久态）</strong>：对象一旦通过<code>Session</code>的<code>save</code>、<code>update</code>、<code>merge</code>等方法与持久化上下文关联，就进入持久态。</li>
<li><strong>Detached（游离态）</strong>：<code>Session</code>关闭后，持久化上下文也就不存在了，之前关联的对象变为游离态对象。</li>
</ul>
<h3 data-id="heading-7">事务性操作</h3>
<ul>
<li><code>session.beginTransaction()</code>：开启一个新的事务。</li>
<li><code>transaction.commit()</code>：提交事务，持久化上下文中的变化同步到数据库。</li>
<li><code>transaction.rollback()</code>：回滚事务，撤销未提交的更改。</li>
</ul>
<h3 data-id="heading-8">一级缓存的作用</h3>
<p>一级缓存由当前<code>Session</code>实例维护，确保在同一个Session中，重复查询相同的实体不会多次访问数据库，提高了性能。</p>
<h3 data-id="heading-9">总结</h3>
<p>持久化上下文是Hibernate的核心机制之一，它通过管理实体的生命周期和提供一级缓存，实现了对持久化对象的高效管理。理解持久化上下文的工作原理，对于使用Hibernate进行高效的数据访问和管理具有重要意义。通过实际的代码示例，可以看到持久化上下文如何在事务范围内管理实体的状态变化，并自动同步到数据库。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（12）什么是Hibernate的实体类？]]></title>    <link>https://juejin.cn/post/7589466706378588196</link>    <guid>https://juejin.cn/post/7589466706378588196</guid>    <pubDate>2025-12-30T11:51:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589466706378588196" data-draft-id="7589262021562187817" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（12）什么是Hibernate的实体类？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T11:51:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（12）什么是Hibernate的实体类？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T11:51:46.000Z" title="Tue Dec 30 2025 11:51:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的实体类（Entity Class）是与数据库表映射的Java类。每个实体类对应数据库中的一个表，类中的每个属性对应表中的一列。实体类使用Java持久化API (JPA)的注解或者Hibernate特有的注解来标注，定义类和表之间的映射关系。</p>
<h3 data-id="heading-0">主要特点</h3>
<ol>
<li><strong>类-表映射</strong>：实体类与数据库表的映射。</li>
<li><strong>属性-列映射</strong>：类的属性与表的列的映射。</li>
<li><strong>主键标识</strong>：使用注解标识主键。</li>
<li><strong>关系映射</strong>：支持一对一、一对多、多对一和多对多等关联关系。</li>
</ol>
<h3 data-id="heading-1">示例项目结构</h3>
<p>为了深入理解Hibernate的实体类，下面是一个完整的示例，包括如何配置Hibernate文件、定义实体类、以及简单的CRUD操作。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-5">使用实体类进行CRUD操作</h3>
<p>下面是一个示例，演示如何使用Hibernate的实体类进行CRUD操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 创建对象并保存到数据库</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student); <span class="hljs-comment">// 持久化对象</span>

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 读取对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 更新对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (student != <span class="hljs-literal">null</span>) {
                student.setAge(<span class="hljs-number">21</span>);
                session.update(student); <span class="hljs-comment">// 更新对象</span>
            }

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 删除对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (student != <span class="hljs-literal">null</span>) {
                session.delete(student); <span class="hljs-comment">// 删除对象</span>
            }

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li>
<p><strong>实体类定义</strong>：通过<code>@Entity</code>注解将类标识为Hibernate的实体类。<code>@Id</code>注解标识主键，<code>@GeneratedValue</code>注解指定主键生成策略。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
}
</code></pre>
</li>
<li>
<p><strong>创建并保存对象</strong>：使用<code>session.save(student)</code>方法将实体对象持久化到数据库中。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
session.save(student);
</code></pre>
</li>
<li>
<p><strong>读取对象</strong>：使用<code>session.get(Student.class, 1L)</code>方法从数据库中读取实体对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
</code></pre>
</li>
<li>
<p><strong>更新对象</strong>：先从数据库中读取对象，然后修改对象属性，最后使用<code>session.update(student)</code>方法同步修改到数据库。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
student.setAge(<span class="hljs-number">21</span>);
session.update(student);
</code></pre>
</li>
<li>
<p><strong>删除对象</strong>：先从数据库中读取对象，然后使用<code>session.delete(student)</code>方法删除对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
session.delete(student);
</code></pre>
</li>
</ol>
<h3 data-id="heading-7">事务管理</h3>
<p>在进行增删改操作时，需要开启事务，并在操作完成后提交事务。如果操作失败，则回滚事务以确保数据一致性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 持久化操作</span>
    transaction.commit();
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
        transaction.rollback();
    }
    e.printStackTrace();
}
</code></pre>
<h3 data-id="heading-8">总结</h3>
<p>Hibernate的实体类是Java类与数据库表结构映射的核心。通过JPA注解，实体类定义了持久化对象的属性和行为，并与数据库表的结构紧密结合。通过Hibernate提供的API，可以方便地对实体类进行CRUD操作，实现数据的持久化管理。理解Hibernate的实体类及其使用方法，对于高效地管理数据库和实现数据持久化具有重要意义。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 从零开始：如何从 GPTsAPI.net 申请 API Key 并打造自己的 AI 服务]]></title>    <link>https://juejin.cn/post/7589509638354649115</link>    <guid>https://juejin.cn/post/7589509638354649115</guid>    <pubDate>2025-12-30T11:18:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589509638354649115" data-draft-id="7589477341765566510" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 从零开始：如何从 GPTsAPI.net 申请 API Key 并打造自己的 AI 服务"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-30T11:18:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 从零开始：如何从 GPTsAPI.net 申请 API Key 并打造自己的 AI 服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T11:18:52.000Z" title="Tue Dec 30 2025 11:18:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在国内开发 AI 产品时，直接使用 OpenAI 官方 API 经常会遇到网络、注册和付费等障碍。GPTsAPI.net 提供了一个<strong>兼容 OpenAI 协议的 API 服务</strong>。</p>
<p>本文将从<strong>注册、申请 API Key 到后端集成</strong>逐步拆解，并结合真实 Nuxt 后端代码解释如何打造一个稳定、可控的 AI 产品。</p>
<hr/>
<h2 data-id="heading-0">🧠 一、什么是 GPTsAPI.net？</h2>
<p>它的主要特点包括：</p>
<ul>
<li>支持兼容 OpenAI 的 API 调用方式（如 <code>/v1/chat/completions</code>）<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F704570010%3Futm_source%3Dchatgpt.com" target="_blank" title="https://zhuanlan.zhihu.com/p/704570010?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">知乎专栏</a></li>
<li>在国内访问更稳定</li>
<li>模型资源丰富，且支持按量计费</li>
</ul>
<hr/>
<h2 data-id="heading-1">📍 二、如何在 GPTsAPI.net 上申请 API Key</h2>
<h3 data-id="heading-2">1. 访问 GPTsAPI.net 官网</h3>
<p>首先打开：gptsapi.net
你会看到平台介绍和入口页面。</p>
<blockquote>
<p>注：GPTsAPI.net 没有公开 API 文档页面，但其官网提供了注册入口和控制台用于 API Key 管理。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">2. 注册账号</h3>
<ol>
<li>点击 <strong>注册 / 登录</strong> 按钮</li>
<li>使用邮箱或手机号完成注册</li>
<li>进入用户控制台</li>
</ol>
<hr/>
<h3 data-id="heading-4">3. 在控制台中创建 API Key</h3>
<p>在控制台界面中你可以看到 <strong>API Key 管理界面</strong>：</p>
<ul>
<li>点击 “创建 API Key”</li>
<li>系统会生成一个独一无二的 Key</li>
</ul>
<blockquote>
<p>通常你会看到形如：<br/>
<code>sk-xxx...</code> 或者由平台生成的一串字符</p>
</blockquote>
<p>请务必保管好这个 Key！</p>
<hr/>
<h3 data-id="heading-5">4. 充值 / 选择计费计划（如有）</h3>
<p>部分 API Key 需要充值才能调用，你可以在控制台中选择计费方式并完成充值。</p>
<p>不同模型的价格可能不同，例如：</p>





















<table><thead><tr><th>模型</th><th>价格（示例）</th></tr></thead><tbody><tr><td>GPT-4 系列</td><td>较高定价</td></tr><tr><td>Claude 系列</td><td>不同版本价格不同</td></tr><tr><td>其他轻量模型</td><td>特定价格 <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F704570010%3Futm_source%3Dchatgpt.com" target="_blank" title="https://zhuanlan.zhihu.com/p/704570010?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">知乎专栏</a></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">🛠️ 三、如何在后端使用 GPTsAPI Key</h2>
<p>有了 API Key 之后，你就可以通过标准的 OpenAI API 兼容方式调用 GPTsAPI 了。</p>
<p><strong>基本原则：</strong><br/>
✨ 把 API Key 放在后端，不暴露给前端<br/>
✨ 使用统一基地址 <code>https://api.gptsapi.net/v1</code></p>
<p>下面是关键的集成方式（基于你提供的 Nuxt 后端代码）。</p>
<hr/>
<h2 data-id="heading-7">🔌 四、后端集成示例代码（Nuxt 3 + OpenAI SDK）</h2>
<pre><code class="hljs language-ini" lang="ini">import OpenAI from "openai"
import { Config } from "~/utils/Config"

export default defineEventHandler(async (event) =&gt; {
  const <span class="hljs-attr">body</span> = await readBody(event)
  const {
    <span class="hljs-attr">model</span> = <span class="hljs-string">"gpt-5-nano"</span>,
    <span class="hljs-attr">prompt</span> = <span class="hljs-string">""</span>,
    <span class="hljs-attr">history</span> = [],
    <span class="hljs-attr">summary</span> = <span class="hljs-string">""</span>,
    <span class="hljs-attr">files</span> = [],
  } = body<span class="hljs-comment">;</span>

  const <span class="hljs-attr">client</span> = new OpenAI({
    apiKey: Config.AI_API_KEY(),
    baseURL: Config.AI_API_BASE_URL(),
  })
</code></pre>
<p>🔹 <code>Config.AI_API_KEY()</code> 的值需要是你在 GPTsAPI.net 申请的 Key<br/>
🔹 <code>Config.AI_API_BASE_URL()</code> 通常填 <code>https://api.gptsapi.net/v1</code></p>
<hr/>
<h2 data-id="heading-8">✂️ 五、清洗历史消息 &amp; 多模态内容构造</h2>
<p>为了提升生成质量，你的代码中做了以下优化：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cleanHistory = (history || []).<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> {
  <span class="hljs-comment">// 过滤无效历史</span>
})
</code></pre>
<p>这样可以避免无效、空内容浪费 token。并支持文本 + 图片输入逻辑：</p>
<pre><code class="hljs language-bash" lang="bash">userContent.push({
  <span class="hljs-built_in">type</span>: <span class="hljs-string">"image_url"</span>,
  image_url: { url: `data:<span class="hljs-variable">${f.type}</span>;<span class="hljs-built_in">base64</span>,<span class="hljs-variable">${f.data}</span>` },
})
</code></pre>
<hr/>
<h2 data-id="heading-9">📡 六、流式响应与产品体验</h2>
<p>调用 API 时你采用了流式输出：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> completion = <span class="hljs-keyword">await</span> client.chat.completions.create({
  model,
  stream: <span class="hljs-literal">true</span>,
  messages,
})
</code></pre>
<p>并使用 Nuxt 的 <code>sendStream</code> 将实时输出返回前端，这样：</p>
<ul>
<li>用户前端可以像 ChatGPT 一样实时看到结果</li>
<li>响应体验更好</li>
</ul>
<hr/>
<h2 data-id="heading-10">💡 七、产品级注意事项</h2>
<ol>
<li><strong>不要在前端暴露 API Key</strong></li>
<li><strong>对调用进行限流与监控</strong></li>
<li><strong>设置最大 token 限制</strong></li>
<li><strong>做好错误兜底与重试策略</strong></li>
</ol>
<hr/>
<h2 data-id="heading-11">🧾 八、示例请求方式（curl）</h2>
<p>当你获取 Key 以后，可以在本地测试：</p>
<pre><code class="hljs language-arduino" lang="arduino">curl https:<span class="hljs-comment">//api.gptsapi.net/v1/chat/completions \
 -H "Authorization: Bearer YOUR_API_KEY" \
 -H "Content-Type: application/json" \
 -d '{</span>
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-3.5-turbo"</span>,
  <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,<span class="hljs-string">"content"</span>: <span class="hljs-string">"Hello"</span>}]
}'
</code></pre>
<p>📌 这里使用的就是<strong>GPTsAPI 提供的兼容 OpenAI 的 API</strong>。<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F704570010%3Futm_source%3Dchatgpt.com" target="_blank" title="https://zhuanlan.zhihu.com/p/704570010?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">知乎专栏</a></p>
<hr/>
<h2 data-id="heading-12">✅ 九、总结</h2>
<p>通过 GPTsAPI.net 申请 Key 的步骤可以概括为：</p>
<ol>
<li>打开 gptsapi.net</li>
<li>注册账号</li>
<li>进入控制台创建 API Key</li>
<li>在后端使用这个 Key 调用模型接口</li>
</ol>
<hr/>
<p><strong>本文部分内容借助 AI 辅助生成，并由作者整理审核。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Krb5-libs-1.18.2-5.ky10.x86_64.rpm 安装失败怎么办？附详细步骤]]></title>    <link>https://juejin.cn/post/7589475497001222159</link>    <guid>https://juejin.cn/post/7589475497001222159</guid>    <pubDate>2025-12-30T12:00:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589475497001222159" data-draft-id="7589475497001205775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Krb5-libs-1.18.2-5.ky10.x86_64.rpm 安装失败怎么办？附详细步骤"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-12-30T12:00:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户613541146016"/> <meta itemprop="url" content="https://juejin.cn/user/1602431422584832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Krb5-libs-1.18.2-5.ky10.x86_64.rpm 安装失败怎么办？附详细步骤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1602431422584832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户613541146016
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:00:36.000Z" title="Tue Dec 30 2025 12:00:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p><strong>1. 先确认有没有装过</strong>​</p>
<p> </p>
<pre><code class="hljs language-css" lang="css">rpm -<span class="hljs-selector-tag">q</span> krb5-libs
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>如果提示 “package krb5-libs is not installed”，说明没装。</p>
<hr/>
<p><strong>2. 准备 rpm 文件</strong>​</p>
<p><strong>安装包下载：</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.quark.cn%2Fs%2F5451c2c4f828" title="https://pan.quark.cn/s/5451c2c4f828" target="_blank" ref="nofollow noopener noreferrer">pan.quark.cn/s/5451c2c4f…</a>，把 <code>krb5-libs-1.18.2-5.ky10.x86_64.rpm</code>放到某个目录，比如 <code>/tmp</code>。</p>
<hr/>
<p><strong>3. 安装</strong>​</p>
<p>用 root 权限执行：</p>
<pre><code class="hljs language-bash" lang="bash">sudo rpm -ivh /tmp/krb5-libs-1.18.2-5.ky10.x86_64.rpm
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><code>-i</code>是安装，<code>-v</code>显示过程，<code>-h</code>显示进度条。</p>
<hr/>
<p><strong>4. 检查是否成功</strong>​</p>
<p>再运行：</p>
<pre><code class="hljs language-css" lang="css">rpm -<span class="hljs-selector-tag">q</span> krb5-libs
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>能看到版本号就说明装好了。</p>
<hr/>
<p><strong>5. 如果遇到依赖问题</strong>​</p>
<p>Kylin 系统一般会提示缺少哪些包，你可以用 yum 或 apt（看系统）先装上依赖，再装这个 rpm。</p>
<p>例如：</p>
<pre><code class="hljs language-xml" lang="xml">sudo yum install <span class="hljs-tag">&lt;<span class="hljs-name">缺少的包名</span>&gt;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>然后再重复第 3 步。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>