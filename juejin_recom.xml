<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[é¦–å‘å®æˆ˜ï¼Spring AI + Qwen3 é˜¿é‡Œå¤§æ¨¡å‹æ¥å…¥ TARE é¡¹ç›® + TRAE SOLO å…¨æµç¨‹æŒ‡å—]]></title>    <link>https://juejin.cn/post/7575413146922352655</link>    <guid>https://juejin.cn/post/7575413146922352655</guid>    <pubDate>2025-11-24T01:38:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146922352655" data-draft-id="7576077034741579810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¦–å‘å®æˆ˜ï¼Spring AI + Qwen3 é˜¿é‡Œå¤§æ¨¡å‹æ¥å…¥ TARE é¡¹ç›® + TRAE SOLO å…¨æµç¨‹æŒ‡å—"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-24T01:38:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©å¤©æ‘¸é±¼çš„javaå·¥ç¨‹å¸ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3109843365802925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¦–å‘å®æˆ˜ï¼Spring AI + Qwen3 é˜¿é‡Œå¤§æ¨¡å‹æ¥å…¥ TARE é¡¹ç›® + TRAE SOLO å…¨æµç¨‹æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3109843365802925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©å¤©æ‘¸é±¼çš„javaå·¥ç¨‹å¸ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:38:26.000Z" title="Mon Nov 24 2025 01:38:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸš€ <strong>é¦–å‘å®æˆ˜ï¼Spring AI + Qwen3 é˜¿é‡Œå¤§æ¨¡å‹æ¥å…¥ TARE é¡¹ç›® + TRAE SOLO å…¨æµç¨‹æŒ‡å—</strong></h2>
<blockquote>
<p>ğŸ§‘â€ğŸ’» ä½œè€…ï¼š# å¤©å¤©æ‘¸é±¼çš„javaå·¥ç¨‹å¸ˆ<br/>
ğŸ† é¡¹ç›®æŠ•ç¨¿ï¼šTRAE SOLO æŠ€æœ¯å¤§å¥–èµ›<br/>
ğŸ“Œ å…³é”®è¯ï¼šSpring AIã€Qwen3ã€å¤§æ¨¡å‹ã€TRAEã€TAREã€å…¬ä¼—å·æ¥å…¥ã€å…¨æ ˆå®è·µ</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ğŸ§  èƒŒæ™¯ï¼šå¤§æ¨¡å‹å¾ˆç«ï¼Œä½†æ¥å…¥ä¸šåŠ¡æ‰æ˜¯å…³é”®</h3>
<p>ä½œä¸ºä¸€åå†™äº† 8 å¹´ Java çš„å¼€å‘è€…ï¼Œæˆ‘å¯¹â€œæ–°æŠ€æœ¯â€ä¸€ç›´ä¿æŒè°¨æ…ä¹è§‚çš„æ€åº¦ã€‚å¤§æ¨¡å‹ç«äº†è¿™ä¹ˆä¹…ï¼Œä»æœ€å¼€å§‹å†™ç©å…·èŠå¤©åˆ°ç°åœ¨è½åœ°ä¸šåŠ¡ï¼Œ<strong>çœŸæ­£èƒ½è·‘åœ¨ç”Ÿäº§ç¯å¢ƒé‡Œçš„é¡¹ç›®ï¼Œè¿˜ä¸å¤šã€‚</strong></p>
<p>è¿™æ¬¡æˆ‘é€‰æ‹©ä»æˆ‘ä»¬å†…éƒ¨çš„ <strong>TARE é¡¹ç›®</strong> ä¸‹æ‰‹ï¼Œå°è¯•æŠŠ <strong>é˜¿é‡Œ Qwen3 å¤§æ¨¡å‹</strong> é€šè¿‡ <strong>Spring AI</strong> æ¥å…¥ç³»ç»Ÿï¼ŒåŒæ—¶é€šè¿‡ <strong>TRAE SOLO</strong> æ„å»ºä¸šåŠ¡æµç¨‹ UIï¼Œæœ€ç»ˆåšåˆ°ï¼š</p>
<blockquote>
<p><strong>ä»æ¨¡å‹æ¥å…¥ â¡ï¸ ä¸šåŠ¡é›†æˆ â¡ï¸ å…¬ä¼—å·å¯¹æ¥ï¼Œä¸€å¥—å®Œæ•´é—­ç¯æµç¨‹ã€‚</strong></p>
</blockquote>
<p>å¹¶å°†å…¶ä½œä¸ºå‚èµ›é¡¹ç›®ï¼Œæäº¤ç»™ <strong>TRAE SOLO æŠ€æœ¯å¤§å¥–èµ›</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-2">ğŸ“¦ é¡¹ç›®ç›®æ ‡ï¼šä¸‰æ­¥èµ°</h3>
<h4 data-id="heading-3">âœ… Step 1ï¼šä½¿ç”¨ Spring AI æ¥å…¥é˜¿é‡Œ Qwen3 æ¨¡å‹</h4>
<h4 data-id="heading-4">âœ… Step 2ï¼šå°†æ¨¡å‹èƒ½åŠ›é›†æˆåˆ° TARE é¡¹ç›®ä¸­ï¼ˆè§„åˆ™ç”Ÿæˆã€ä»»åŠ¡å»ºè®®ï¼‰</h4>
<h4 data-id="heading-5">âœ… Step 3ï¼šé€šè¿‡ TRAE SOLO æ„å»ºå‰ç«¯é¡µé¢ï¼Œæ‰“é€šå…¬ä¼—å·æ¥å£ï¼Œå®ç°é—®ç­”æœåŠ¡</h4>
<hr/>
<h3 data-id="heading-6">ğŸ§° æŠ€æœ¯æ ˆé€‰å‹</h3>





























<table><thead><tr><th>æ¨¡å—</th><th>æŠ€æœ¯æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å¤§æ¨¡å‹æ¥å…¥</td><td>Spring AI + Qwen3 (é˜¿é‡Œé€šä¹‰åƒé—®)</td></tr><tr><td>åç«¯æ¡†æ¶</td><td>Spring Boot 3 + WebFlux</td></tr><tr><td>é¡µé¢ç¼–æ’</td><td>TRAE SOLOï¼ˆä½ä»£ç æ‹–æ‹½ UI + æ¥å£ç»‘å®šï¼‰</td></tr><tr><td>æ¶ˆæ¯å¹³å°</td><td>å¾®ä¿¡å…¬ä¼—å· + è‡ªå»ºæœåŠ¡è·¯ç”±</td></tr><tr><td>é¡¹ç›®æ¨¡å—</td><td>TAREï¼ˆæµç¨‹è‡ªåŠ¨åŒ–è§„åˆ™ç³»ç»Ÿï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-7">ğŸ›  å®æˆ˜ç»†èŠ‚æ‹†è§£</h3>
<hr/>
<h4 data-id="heading-8">âœ… ä¸€ã€Spring AI + Qwen3 æ¨¡å‹æ¥å…¥é…ç½®</h4>
<p>Spring AI ä½œä¸º Spring å®˜æ–¹æ¨å‡ºçš„å¤§æ¨¡å‹é›†æˆæ¡†æ¶ï¼Œæ¥å…¥é˜¿é‡Œ Qwen3 éå¸¸é¡ºæ»‘ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">ai:</span>
    <span class="hljs-attr">openai:</span>
      <span class="hljs-attr">base-url:</span> <span class="hljs-string">https://dashscope.aliyuncs.com/compatible-mode/v1</span>
      <span class="hljs-attr">api-key:</span> <span class="hljs-string">${ALI_API_KEY}</span>
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">OpenAiChatClient</span> <span class="hljs-title function_">chatClient</span>(<span class="hljs-params">OpenAiApi openAiApi</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAiChatClient</span>(openAiApi);
}
</code></pre>
<p><strong>æ¥å£å°è£…ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">public String <span class="hljs-built_in">askQwen</span>(String question) {
    ChatRequest request = ChatRequest<span class="hljs-selector-class">.builder</span>()
        <span class="hljs-selector-class">.model</span>("qwen-plus")
        <span class="hljs-selector-class">.messages</span>(List.of(ChatMessage.userMessage(question)))
        <span class="hljs-selector-class">.build</span>();

    ChatResponse response = chatClient<span class="hljs-selector-class">.call</span>(request);
    return response<span class="hljs-selector-class">.getResult</span>()<span class="hljs-selector-class">.getOutput</span>()<span class="hljs-selector-class">.getChoices</span>()<span class="hljs-selector-class">.get</span>(<span class="hljs-number">0</span>)<span class="hljs-selector-class">.getMessage</span>()<span class="hljs-selector-class">.getContent</span>();
}
</code></pre>
<hr/>
<h4 data-id="heading-9">âœ… äºŒã€TARE é¡¹ç›®ä¸­å¼•å…¥æ¨¡å‹èƒ½åŠ›</h4>
<p>TARE æœ¬èº«æ˜¯ä¸€ä¸ªè§„åˆ™é©±åŠ¨çš„ä¸šåŠ¡å¼•æ“ï¼Œä¹‹å‰è§„åˆ™é…ç½®ä¸»è¦é äººå·¥è®¾ç½®ã€‚</p>
<p>è¿™æ¬¡æˆ‘æ–°å¢äº†ä¸€ä¸ªæ¨¡å—ï¼š <strong>â€œAI æ™ºèƒ½æ¨èè§„åˆ™â€</strong></p>
<h5 data-id="heading-10">ğŸ‘‡ ä½¿ç”¨æ–¹å¼ï¼š</h5>
<ol>
<li>ç”¨æˆ·åœ¨ TRAE é¡µé¢ä¸Šé€‰æ‹©â€œç”Ÿæˆè§„åˆ™å»ºè®®â€</li>
<li>è¾“å…¥ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚â€œå®¢æˆ·æŠ•è¯‰è‡ªåŠ¨åˆ†é…â€ï¼‰</li>
<li>åç«¯å°†åœºæ™¯æè¿°ä¼ ç»™ Qwen3</li>
<li>æ¨¡å‹è¿”å›è§„åˆ™è‰æ¡ˆï¼ˆJSON æ ¼å¼ï¼‰</li>
<li>ç”¨æˆ·å¯ä¸€é”®å¯¼å…¥è‡³ç°æœ‰æµç¨‹ä¸­</li>
</ol>
<h5 data-id="heading-11">ç¤ºä¾‹å¯¹è¯ï¼š</h5>
<blockquote>
<p>ç”¨æˆ·è¾“å…¥ï¼š<br/>
â€œæˆ‘æƒ³è‡ªåŠ¨å°† VIP æŠ•è¯‰åˆ†é…ç»™ä¸€çº¿å®¢æœï¼Œæ™®é€šå®¢æˆ·åˆ™è¿›å…¥æ™®é€šé˜Ÿåˆ—ã€‚â€</p>
</blockquote>
<blockquote>
<p>æ¨¡å‹è¿”å›ï¼š</p>
</blockquote>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"è§„åˆ™æ¡ä»¶"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç”¨æˆ·ç­‰çº§ == VIP"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"æ‰§è¡ŒåŠ¨ä½œ"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä»»åŠ¡åˆ†é…è‡³é«˜çº§å®¢æœç»„"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"å¦åˆ™"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä»»åŠ¡è¿›å…¥æ™®é€šå®¡æ ¸æµç¨‹"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ğŸ‘‰ ç”¨æˆ·ç‚¹å‡»â€œå¯¼å…¥â€åï¼Œè§„åˆ™è‡ªåŠ¨å†™å…¥ TARE æµç¨‹å¼•æ“ï¼Œå¹¶é€šè¿‡ TRAE é¡µé¢å®æ—¶ç”Ÿæ•ˆã€‚</strong></p>
<hr/>
<h4 data-id="heading-12">âœ… ä¸‰ã€TRAE SOLO é¡µé¢æ­å»ºä¸äº¤äº’ç»†èŠ‚</h4>
<h5 data-id="heading-13">é¡µé¢ç»“æ„ï¼š</h5>





















<table><thead><tr><th>åŒºåŸŸ</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>å·¦ä¾§å¯¼èˆª</td><td>è§„åˆ™ç®¡ç† / AIæ¨è / å†å²è®°å½•</td></tr><tr><td>ä¸­é—´ä¸»åŒº</td><td>è¡¨å•è¾“å…¥ + æ¨¡å‹è¿”å›å†…å®¹</td></tr><tr><td>å³ä¾§</td><td>JSON è§„åˆ™é¢„è§ˆ + ä¸€é”®å¯¼å…¥æŒ‰é’®</td></tr></tbody></table>
<h5 data-id="heading-14">æ ¸å¿ƒäº¤äº’ç»†èŠ‚ï¼š</h5>
<ul>
<li>ä½¿ç”¨ <strong>è¡¨å•ç»„ä»¶</strong> æ”¶é›†ç”¨æˆ·è¾“å…¥</li>
<li><strong>æŒ‰é’®äº‹ä»¶ç»‘å®š</strong> åç«¯æ¥å£ <code>/api/ai-suggest</code></li>
<li>æ¥æ”¶æ¨¡å‹è¿”å›å <strong>è‡ªåŠ¨å¡«å…¥å³ä¾§ JSON åŒºå—</strong></li>
<li>â€œå¯¼å…¥è§„åˆ™â€æŒ‰é’®è§¦å‘äº‹ä»¶ -&gt; è°ƒç”¨ <code>/api/rules/import</code></li>
</ul>
<h5 data-id="heading-15">TRAE é…ç½®äº®ç‚¹ï¼š</h5>
<ul>
<li>æ‰€æœ‰äº¤äº’æ— é¡»å†™å‰ç«¯ä»£ç ï¼Œä»…é€šè¿‡ <strong>äº‹ä»¶é…ç½® + æ•°æ®æºç»‘å®š</strong> å®Œæˆ</li>
<li>è§„åˆ™é¢„è§ˆåŒºä½¿ç”¨ <strong>ä»£ç é«˜äº®ç»„ä»¶</strong>ï¼Œæå‡å¯è¯»æ€§</li>
<li>å¯¼å…¥æˆåŠŸåè‡ªåŠ¨é€šçŸ¥ç”¨æˆ·å¹¶åˆ·æ–°æµç¨‹å›¾</li>
</ul>
<hr/>
<h4 data-id="heading-16">âœ… å››ã€å…¬ä¼—å·æ¥å…¥ï¼šæ¨¡å‹èƒ½åŠ›å¯¹å¤–å¼€æ”¾</h4>
<p>æˆ‘ä»¬è¿˜å°†æ¨¡å‹èƒ½åŠ›é€šè¿‡æ¥å£æš´éœ²ç»™å¾®ä¿¡å…¬ä¼—å·ï¼Œå®ç°ä¼ä¸šçº§å¯¹è¯å¼æœåŠ¡ã€‚</p>
<h5 data-id="heading-17">æ¥å…¥æ–¹æ¡ˆï¼š</h5>
<ul>
<li>ä½¿ç”¨å¾®ä¿¡å…¬ä¼—å·å¼€å‘è€…å¹³å°é…ç½®æ¶ˆæ¯è½¬å‘åœ°å€</li>
<li>åç«¯æ¥æ”¶ç”¨æˆ·æ–‡æœ¬æ¶ˆæ¯ï¼Œè½¬å‘è‡³ AI æ¥å£</li>
<li>è¿”å›æ¨¡å‹å›ç­”åå›å¤æ–‡æœ¬æ¶ˆæ¯</li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/wx/msg"</span>)
public String <span class="hljs-built_in">handleMessage</span>(<span class="hljs-variable">@RequestBody</span> WxMessage message) {
    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">reply</span> = <span class="hljs-selector-tag">askQwen</span>(message.<span class="hljs-built_in">getContent</span>());
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">buildWxTextResponse</span>(message, reply);
}
</code></pre>
<p><strong>å®é™…ç”¨ä¾‹ï¼š</strong><br/>
ç”¨æˆ·å‘é€â€œè¯·å¸®æˆ‘å†™ä¸€ä¸ªå®¢æˆ·æŠ•è¯‰åˆ†é…è§„åˆ™â€ï¼Œå…¬ä¼—å·è‡ªåŠ¨è¿”å› JSON æ ¼å¼å»ºè®®ï¼Œä¾›è¿è¥å‚è€ƒã€‚</p>
<hr/>
<h3 data-id="heading-18">ğŸ” æ€»ç»“ï¼šè¿™æ¬¡é›†æˆå¸¦ç»™æˆ‘çš„ä¸‰ç‚¹æ”¶è·</h3>
<h4 data-id="heading-19">1. <strong>æ¨¡å‹èƒ½åŠ›ä¸å†æ˜¯â€œç©å…·â€ï¼Œå¼€å§‹æˆä¸ºä¸šåŠ¡åŠ é€Ÿå™¨</strong></h4>
<p>å®ƒå¯ä»¥çœŸæ­£ä¸ºæˆ‘ä»¬èŠ‚çœé…ç½®æ—¶é—´ã€æä¾›å¯å‚è€ƒçš„ä¸šåŠ¡å»ºè®®ã€‚</p>
<h4 data-id="heading-20">2. <strong>TRAE SOLO è®©æˆ‘æŠŠåç«¯çš„èƒ½åŠ›å»¶ä¼¸åˆ°äº† UI å±‚</strong></h4>
<p>æˆ‘èƒ½æ§åˆ¶é¡µé¢ã€é…ç½®æµç¨‹ã€è°ƒç”¨æ¥å£ï¼Œ<strong>ä¸å†ä¾èµ–å‰ç«¯ï¼Œä¹Ÿä¸æ‹…å¿ƒäº¤äº’è½åœ°ä¸äº†ã€‚</strong></p>
<h4 data-id="heading-21">3. <strong>TARE é¡¹ç›®å› ä¸º AI + TRAE çš„ç»„åˆï¼Œç„•å‘äº†ç¬¬äºŒæ˜¥</strong></h4>
<p>åŸæœ¬åªèƒ½å†…éƒ¨ä½¿ç”¨çš„è§„åˆ™é…ç½®ç³»ç»Ÿï¼Œç°åœ¨å…·å¤‡äº†å¯¹å¤–æœåŠ¡çš„èƒ½åŠ›ã€‚</p>
<hr/>
<h3 data-id="heading-22">ğŸ“¢ å†™åœ¨æœ€åï¼šå…¨æ ˆä¸æ˜¯â€œå…¨éƒ½ä¼šâ€ï¼Œè€Œæ˜¯â€œå…¨èƒ½äº¤ä»˜â€</h3>
<p>æˆ‘ä»ç„¶æ˜¯ä¸€å Java å·¥ç¨‹å¸ˆï¼Œä½†ç°åœ¨æˆ‘èƒ½ï¼š</p>
<ul>
<li>æ¥å…¥å¤§æ¨¡å‹</li>
<li>æ­å»ºå‰ç«¯é¡µé¢</li>
<li>æ„å»ºä¸šåŠ¡æµç¨‹</li>
<li>å¯¹æ¥å…¬ä¼—å·æœåŠ¡</li>
</ul>
<p>è¿™ä¸æ˜¯å› ä¸ºæˆ‘å˜æˆäº†å…¨æ ˆï¼Œè€Œæ˜¯å› ä¸ºæˆ‘æœ‰äº†å¥½å·¥å…·ï¼Œæ¯”å¦‚ Spring AI å’Œ TRAE SOLOã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Guava å¸¸ç”¨å·¥å…·åŒ…å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7575112613779046434</link>    <guid>https://juejin.cn/post/7575112613779046434</guid>    <pubDate>2025-11-24T01:39:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575112613779046434" data-draft-id="7575533124877582363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Guava å¸¸ç”¨å·¥å…·åŒ…å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-11-24T01:39:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sinoçˆ±å­¦ä¹ "/> <meta itemprop="url" content="https://juejin.cn/user/1873223544473431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Guava å¸¸ç”¨å·¥å…·åŒ…å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223544473431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sinoçˆ±å­¦ä¹ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:39:50.000Z" title="Mon Nov 24 2025 01:39:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç®€ä»‹</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/593643ad991e40af9dd060ca64ebf2cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2lub-eIseWtpuS5oA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554040&amp;x-signature=aVm6ZvOQJVBAWs5YibLQAg0QOYk%3D" alt="1763948312527.png" loading="lazy"/></p>
<p>Guava æ˜¯ Google å¼€æºçš„ Java æ ¸å¿ƒåº“ï¼Œæä¾›äº†ä¸°å¯Œçš„å·¥å…·ç±»å’Œé›†åˆæ¡†æ¶ï¼Œèƒ½å¤Ÿæå¤§æå‡å¼€å‘æ•ˆç‡ã€‚æœ¬æ–‡å°†ä»‹ç» Guava ä¸­æœ€å¸¸ç”¨çš„å·¥å…·åŒ…åŠå…¶å®é™…åº”ç”¨ã€‚</p>
<h2 data-id="heading-1">1. é›†åˆå·¥å…· (Collections)</h2>
<h3 data-id="heading-2">1.1 ä¸å¯å˜é›†åˆ</h3>
<p>ä¸å¯å˜é›†åˆçº¿ç¨‹å®‰å…¨ä¸”ä¸å¯ä¿®æ”¹ï¼Œé€‚åˆä½œä¸ºå¸¸é‡ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºä¸å¯å˜ List</span>
ImmutableList&lt;String&gt; list = ImmutableList.of(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);

<span class="hljs-comment">// åˆ›å»ºä¸å¯å˜ Set</span>
ImmutableSet&lt;Integer&gt; set = ImmutableSet.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);

<span class="hljs-comment">// åˆ›å»ºä¸å¯å˜ Map</span>
ImmutableMap&lt;String, Integer&gt; map = ImmutableMap.of(
    <span class="hljs-string">"Java"</span>, <span class="hljs-number">1</span>,
    <span class="hljs-string">"Python"</span>, <span class="hljs-number">2</span>,
    <span class="hljs-string">"Go"</span>, <span class="hljs-number">3</span>
);

<span class="hljs-comment">// ä½¿ç”¨ Builder æ„å»ºå¤æ‚é›†åˆ</span>
ImmutableList&lt;String&gt; complexList = ImmutableList.&lt;String&gt;builder()
    .add(<span class="hljs-string">"A"</span>)
    .add(<span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)
    .addAll(Arrays.asList(<span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>))
    .build();
</code></pre>
<h3 data-id="heading-3">1.2 Multiset - è®¡æ•°é›†åˆ</h3>
<p>Multiset å…è®¸å…ƒç´ é‡å¤ï¼Œå¹¶å¯ä»¥ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°ã€‚</p>
<pre><code class="hljs language-java" lang="java">Multiset&lt;String&gt; multiset = HashMultiset.create();
multiset.add(<span class="hljs-string">"apple"</span>);
multiset.add(<span class="hljs-string">"apple"</span>);
multiset.add(<span class="hljs-string">"banana"</span>);
multiset.add(<span class="hljs-string">"apple"</span>);

System.out.println(multiset.count(<span class="hljs-string">"apple"</span>));  <span class="hljs-comment">// è¾“å‡º: 3</span>
System.out.println(multiset.size());          <span class="hljs-comment">// è¾“å‡º: 4</span>

<span class="hljs-comment">// éå†ä¸é‡å¤å…ƒç´ </span>
<span class="hljs-keyword">for</span> (String element : multiset.elementSet()) {
    System.out.println(element + <span class="hljs-string">": "</span> + multiset.count(element));
}
</code></pre>
<h3 data-id="heading-4">1.3 Multimap - ä¸€é”®å¤šå€¼æ˜ å°„</h3>
<p>Multimap å…è®¸ä¸€ä¸ªé”®å¯¹åº”å¤šä¸ªå€¼ã€‚</p>
<pre><code class="hljs language-java" lang="java">Multimap&lt;String, String&gt; multimap = ArrayListMultimap.create();
multimap.put(<span class="hljs-string">"Fruit"</span>, <span class="hljs-string">"Apple"</span>);
multimap.put(<span class="hljs-string">"Fruit"</span>, <span class="hljs-string">"Banana"</span>);
multimap.put(<span class="hljs-string">"Vegetable"</span>, <span class="hljs-string">"Carrot"</span>);

System.out.println(multimap.get(<span class="hljs-string">"Fruit"</span>));  <span class="hljs-comment">// è¾“å‡º: [Apple, Banana]</span>

<span class="hljs-comment">// è½¬æ¢ä¸ºæ™®é€š Map</span>
Map&lt;String, Collection&lt;String&gt;&gt; map = multimap.asMap();
</code></pre>
<h3 data-id="heading-5">1.4 BiMap - åŒå‘æ˜ å°„</h3>
<p>BiMap æä¾›é”®å€¼äº’æŸ¥çš„åŒå‘æ˜ å°„ã€‚</p>
<pre><code class="hljs language-java" lang="java">BiMap&lt;String, Integer&gt; biMap = HashBiMap.create();
biMap.put(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">1</span>);
biMap.put(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">2</span>);

<span class="hljs-comment">// æ­£å‘æŸ¥è¯¢</span>
System.out.println(biMap.get(<span class="hljs-string">"Alice"</span>));  <span class="hljs-comment">// è¾“å‡º: 1</span>

<span class="hljs-comment">// åå‘æŸ¥è¯¢</span>
System.out.println(biMap.inverse().get(<span class="hljs-number">1</span>));  <span class="hljs-comment">// è¾“å‡º: Alice</span>
</code></pre>
<h3 data-id="heading-6">1.5 Table - åŒé”®æ˜ å°„</h3>
<p>Table æä¾›è¡Œåˆ—å¼çš„åŒé”®æ˜ å°„ç»“æ„ã€‚</p>
<pre><code class="hljs language-java" lang="java">Table&lt;String, String, Integer&gt; table = HashBasedTable.create();
table.put(<span class="hljs-string">"2023"</span>, <span class="hljs-string">"Q1"</span>, <span class="hljs-number">100</span>);
table.put(<span class="hljs-string">"2023"</span>, <span class="hljs-string">"Q2"</span>, <span class="hljs-number">150</span>);
table.put(<span class="hljs-string">"2024"</span>, <span class="hljs-string">"Q1"</span>, <span class="hljs-number">120</span>);

<span class="hljs-comment">// è·å–å€¼</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> table.get(<span class="hljs-string">"2023"</span>, <span class="hljs-string">"Q1"</span>);  <span class="hljs-comment">// 100</span>

<span class="hljs-comment">// è·å–æŸä¸€è¡Œçš„æ‰€æœ‰æ•°æ®</span>
Map&lt;String, Integer&gt; row = table.row(<span class="hljs-string">"2023"</span>);  <span class="hljs-comment">// {Q1=100, Q2=150}</span>

<span class="hljs-comment">// è·å–æŸä¸€åˆ—çš„æ‰€æœ‰æ•°æ®</span>
Map&lt;String, Integer&gt; column = table.column(<span class="hljs-string">"Q1"</span>);  <span class="hljs-comment">// {2023=100, 2024=120}</span>
</code></pre>
<h2 data-id="heading-7">2. å­—ç¬¦ä¸²å·¥å…· (Strings)</h2>
<h3 data-id="heading-8">2.1 Joiner - è¿æ¥å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŸºæœ¬è¿æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>).join(Arrays.asList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>));
<span class="hljs-comment">// è¾“å‡º: A, B, C</span>

<span class="hljs-comment">// è·³è¿‡ null å€¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">withoutNull</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>)
    .skipNulls()
    .join(<span class="hljs-string">"A"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);
<span class="hljs-comment">// è¾“å‡º: A, B, C</span>

<span class="hljs-comment">// æ›¿æ¢ null å€¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">replaceNull</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>)
    .useForNull(<span class="hljs-string">"N/A"</span>)
    .join(<span class="hljs-string">"A"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"B"</span>);
<span class="hljs-comment">// è¾“å‡º: A, N/A, B</span>

<span class="hljs-comment">// Map è¿æ¥</span>
Map&lt;String, String&gt; map = ImmutableMap.of(<span class="hljs-string">"name"</span>, <span class="hljs-string">"John"</span>, <span class="hljs-string">"age"</span>, <span class="hljs-string">"30"</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">mapStr</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">"&amp;"</span>).withKeyValueSeparator(<span class="hljs-string">"="</span>).join(map);
<span class="hljs-comment">// è¾“å‡º: name=John&amp;age=30</span>
</code></pre>
<h3 data-id="heading-9">2.2 Splitter - åˆ†å‰²å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŸºæœ¬åˆ†å‰²</span>
Iterable&lt;String&gt; parts = Splitter.on(<span class="hljs-string">','</span>).split(<span class="hljs-string">"A,B,C"</span>);

<span class="hljs-comment">// å»é™¤ç©ºç™½å­—ç¬¦</span>
Iterable&lt;String&gt; trimmed = Splitter.on(<span class="hljs-string">','</span>)
    .trimResults()
    .split(<span class="hljs-string">" A , B , C "</span>);

<span class="hljs-comment">// å¿½ç•¥ç©ºå­—ç¬¦ä¸²</span>
Iterable&lt;String&gt; noEmpty = Splitter.on(<span class="hljs-string">','</span>)
    .omitEmptyStrings()
    .split(<span class="hljs-string">"A,,B,C"</span>);

<span class="hljs-comment">// é™åˆ¶åˆ†å‰²æ•°é‡</span>
Iterable&lt;String&gt; limited = Splitter.on(<span class="hljs-string">','</span>)
    .limit(<span class="hljs-number">2</span>)
    .split(<span class="hljs-string">"A,B,C,D"</span>);
<span class="hljs-comment">// ç»“æœ: [A, B,C,D]</span>

<span class="hljs-comment">// åˆ†å‰² Map</span>
Map&lt;String, String&gt; kvMap = Splitter.on(<span class="hljs-string">'&amp;'</span>)
    .withKeyValueSeparator(<span class="hljs-string">'='</span>)
    .split(<span class="hljs-string">"name=John&amp;age=30"</span>);
</code></pre>
<h3 data-id="heading-10">2.3 Strings å·¥å…·ç±»</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// null è½¬ç©ºå­—ç¬¦ä¸²</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> Strings.nullToEmpty(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// ""</span>

<span class="hljs-comment">// ç©ºå­—ç¬¦ä¸²è½¬ null</span>
<span class="hljs-type">String</span> <span class="hljs-variable">nullStr</span> <span class="hljs-operator">=</span> Strings.emptyToNull(<span class="hljs-string">""</span>);  <span class="hljs-comment">// null</span>

<span class="hljs-comment">// å­—ç¬¦ä¸²å¡«å……</span>
<span class="hljs-type">String</span> <span class="hljs-variable">padded</span> <span class="hljs-operator">=</span> Strings.padStart(<span class="hljs-string">"7"</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'0'</span>);  <span class="hljs-comment">// "007"</span>
<span class="hljs-type">String</span> <span class="hljs-variable">paddedEnd</span> <span class="hljs-operator">=</span> Strings.padEnd(<span class="hljs-string">"7"</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'0'</span>); <span class="hljs-comment">// "700"</span>

<span class="hljs-comment">// é‡å¤å­—ç¬¦ä¸²</span>
<span class="hljs-type">String</span> <span class="hljs-variable">repeated</span> <span class="hljs-operator">=</span> Strings.repeat(<span class="hljs-string">"ab"</span>, <span class="hljs-number">3</span>);  <span class="hljs-comment">// "ababab"</span>

<span class="hljs-comment">// å…¬å…±å‰ç¼€</span>
<span class="hljs-type">String</span> <span class="hljs-variable">prefix</span> <span class="hljs-operator">=</span> Strings.commonPrefix(<span class="hljs-string">"testing"</span>, <span class="hljs-string">"test"</span>);  <span class="hljs-comment">// "test"</span>

<span class="hljs-comment">// å…¬å…±åç¼€</span>
<span class="hljs-type">String</span> <span class="hljs-variable">suffix</span> <span class="hljs-operator">=</span> Strings.commonSuffix(<span class="hljs-string">"testing"</span>, <span class="hljs-string">"interesting"</span>);  <span class="hljs-comment">// "ting"</span>
</code></pre>
<h2 data-id="heading-11">3. ç¼“å­˜å·¥å…· (Cache)</h2>
<p>Guava Cache æä¾›æœ¬åœ°ç¼“å­˜åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§è¿‡æœŸç­–ç•¥ã€‚</p>
<pre><code class="hljs language-java" lang="java">LoadingCache&lt;String, String&gt; cache = CacheBuilder.newBuilder()
    .maximumSize(<span class="hljs-number">1000</span>)                          <span class="hljs-comment">// æœ€å¤§å®¹é‡</span>
    .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)    <span class="hljs-comment">// å†™å…¥åè¿‡æœŸ</span>
    .expireAfterAccess(<span class="hljs-number">5</span>, TimeUnit.MINUTES)    <span class="hljs-comment">// è®¿é—®åè¿‡æœŸ</span>
    .recordStats()                              <span class="hljs-comment">// å¯ç”¨ç»Ÿè®¡</span>
    .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;String, String&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">load</span><span class="hljs-params">(String key)</span> <span class="hljs-keyword">throws</span> Exception {
            <span class="hljs-keyword">return</span> loadFromDatabase(key);  <span class="hljs-comment">// ç¼“å­˜åŠ è½½é€»è¾‘</span>
        }
    });

<span class="hljs-comment">// ä½¿ç”¨ç¼“å­˜</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> cache.get(<span class="hljs-string">"key"</span>);
} <span class="hljs-keyword">catch</span> (ExecutionException e) {
    e.printStackTrace();
}

<span class="hljs-comment">// æ‰‹åŠ¨æ”¾å…¥</span>
cache.put(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);

<span class="hljs-comment">// å¤±æ•ˆç¼“å­˜</span>
cache.invalidate(<span class="hljs-string">"key"</span>);

<span class="hljs-comment">// æŸ¥çœ‹ç»Ÿè®¡</span>
<span class="hljs-type">CacheStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> cache.stats();
System.out.println(<span class="hljs-string">"å‘½ä¸­ç‡: "</span> + stats.hitRate());
</code></pre>
<h2 data-id="heading-12">4. é›†åˆå·¥å…·ç±» (Lists, Sets, Maps)</h2>
<h3 data-id="heading-13">4.1 Lists å·¥å…·</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»º ArrayList</span>
List&lt;String&gt; list = Lists.newArrayList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);

<span class="hljs-comment">// æŒ‡å®šå®¹é‡</span>
List&lt;String&gt; capacityList = Lists.newArrayListWithCapacity(<span class="hljs-number">100</span>);

<span class="hljs-comment">// åè½¬åˆ—è¡¨</span>
List&lt;String&gt; reversed = Lists.reverse(list);

<span class="hljs-comment">// åˆ†åŒº</span>
List&lt;List&lt;String&gt;&gt; partitions = Lists.partition(list, <span class="hljs-number">2</span>);
<span class="hljs-comment">// ç»“æœ: [[A, B], [C]]</span>

<span class="hljs-comment">// ç¬›å¡å°”ç§¯</span>
List&lt;List&lt;String&gt;&gt; cartesian = Lists.cartesianProduct(
    Lists.newArrayList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>),
    Lists.newArrayList(<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>)
);
<span class="hljs-comment">// ç»“æœ: [[A, 1], [A, 2], [B, 1], [B, 2]]</span>
</code></pre>
<h3 data-id="heading-14">4.2 Sets å·¥å…·</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»º HashSet</span>
Set&lt;String&gt; set1 = Sets.newHashSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);
Set&lt;String&gt; set2 = Sets.newHashSet(<span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>);

<span class="hljs-comment">// å¹¶é›†</span>
Set&lt;String&gt; union = Sets.union(set1, set2);  <span class="hljs-comment">// [A, B, C, D]</span>

<span class="hljs-comment">// äº¤é›†</span>
Set&lt;String&gt; intersection = Sets.intersection(set1, set2);  <span class="hljs-comment">// [B, C]</span>

<span class="hljs-comment">// å·®é›†</span>
Set&lt;String&gt; difference = Sets.difference(set1, set2);  <span class="hljs-comment">// [A]</span>

<span class="hljs-comment">// å¯¹ç§°å·®é›†</span>
Set&lt;String&gt; symmetricDifference = Sets.symmetricDifference(set1, set2);  <span class="hljs-comment">// [A, D]</span>

<span class="hljs-comment">// å¹‚é›†</span>
Set&lt;Set&lt;String&gt;&gt; powerSet = Sets.powerSet(Sets.newHashSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>));
<span class="hljs-comment">// ç»“æœ: [[], [A], [B], [A, B]]</span>
</code></pre>
<h3 data-id="heading-15">4.3 Maps å·¥å…·</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»º HashMap</span>
Map&lt;String, Integer&gt; map = Maps.newHashMap();

<span class="hljs-comment">// ä» Set åˆ›å»º Map</span>
Set&lt;String&gt; keys = Sets.newHashSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);
Map&lt;String, String&gt; mapFromKeys = Maps.asMap(keys, key -&gt; key.toLowerCase());

<span class="hljs-comment">// è¿‡æ»¤ Map</span>
Map&lt;String, Integer&gt; filtered = Maps.filterKeys(map, key -&gt; key.startsWith(<span class="hljs-string">"A"</span>));

<span class="hljs-comment">// è½¬æ¢ Map å€¼</span>
Map&lt;String, String&gt; transformed = Maps.transformValues(map, value -&gt; <span class="hljs-string">"Value: "</span> + value);

<span class="hljs-comment">// å·®å¼‚æ¯”è¾ƒ</span>
MapDifference&lt;String, Integer&gt; diff = Maps.difference(map1, map2);
System.out.println(<span class="hljs-string">"ä»…åœ¨å·¦ä¾§: "</span> + diff.entriesOnlyOnLeft());
System.out.println(<span class="hljs-string">"ä»…åœ¨å³ä¾§: "</span> + diff.entriesOnlyOnRight());
System.out.println(<span class="hljs-string">"å€¼ä¸åŒ: "</span> + diff.entriesDiffering());
</code></pre>
<h2 data-id="heading-16">5. Optional - é¿å…ç©ºæŒ‡é’ˆ</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»º Optional</span>
Optional&lt;String&gt; optional = Optional.of(<span class="hljs-string">"Hello"</span>);
Optional&lt;String&gt; nullable = Optional.fromNullable(<span class="hljs-literal">null</span>);
Optional&lt;String&gt; absent = Optional.absent();

<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span>
<span class="hljs-keyword">if</span> (optional.isPresent()) {
    System.out.println(optional.get());
}

<span class="hljs-comment">// æä¾›é»˜è®¤å€¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> nullable.or(<span class="hljs-string">"Default"</span>);

<span class="hljs-comment">// è½¬æ¢</span>
Optional&lt;Integer&gt; length = optional.transform(String::length);

<span class="hljs-comment">// ä¸ Java 8 Optional äº’è½¬</span>
java.util.Optional&lt;String&gt; javaOptional = optional.toJavaUtil();
Optional&lt;String&gt; guavaOptional = Optional.fromJavaUtil(javaOptional);
</code></pre>
<h2 data-id="heading-17">6. Preconditions - å‰ç½®æ¡ä»¶æ£€æŸ¥</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processUser</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age, List&lt;String&gt; roles)</span> {
    <span class="hljs-comment">// æ£€æŸ¥é null</span>
    Preconditions.checkNotNull(name, <span class="hljs-string">"å§“åä¸èƒ½ä¸ºç©º"</span>);
    
    <span class="hljs-comment">// æ£€æŸ¥å‚æ•°æ¡ä»¶</span>
    Preconditions.checkArgument(age &gt;= <span class="hljs-number">0</span> &amp;&amp; age &lt;= <span class="hljs-number">150</span>, 
        <span class="hljs-string">"å¹´é¾„å¿…é¡»åœ¨ 0-150 ä¹‹é—´ï¼Œå®é™…å€¼: %s"</span>, age);
    
    <span class="hljs-comment">// æ£€æŸ¥çŠ¶æ€</span>
    Preconditions.checkState(isInitialized, <span class="hljs-string">"æœåŠ¡æœªåˆå§‹åŒ–"</span>);
    
    <span class="hljs-comment">// æ£€æŸ¥ç´¢å¼•</span>
    Preconditions.checkElementIndex(<span class="hljs-number">0</span>, roles.size(), <span class="hljs-string">"è§’è‰²åˆ—è¡¨"</span>);
    
    <span class="hljs-comment">// æ£€æŸ¥ä½ç½®ç´¢å¼•</span>
    Preconditions.checkPositionIndex(<span class="hljs-number">1</span>, roles.size(), <span class="hljs-string">"è§’è‰²åˆ—è¡¨"</span>);
}
</code></pre>
<h2 data-id="heading-18">7. Objects å·¥å…·</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç©ºå€¼åˆ¤æ–­</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">isNull</span> <span class="hljs-operator">=</span> Objects.equal(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// å“ˆå¸Œç </span>
<span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> Objects.hashCode(obj1, obj2, obj3);

<span class="hljs-comment">// toString è¾…åŠ©</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> MoreObjects.toStringHelper(<span class="hljs-built_in">this</span>)
    .add(<span class="hljs-string">"name"</span>, name)
    .add(<span class="hljs-string">"age"</span>, age)
    .toString();
<span class="hljs-comment">// è¾“å‡º: ClassName{name=John, age=30}</span>

<span class="hljs-comment">// æ¯”è¾ƒé“¾</span>
<span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ComparisonChain.start()
    .compare(<span class="hljs-built_in">this</span>.name, other.name)
    .compare(<span class="hljs-built_in">this</span>.age, other.age)
    .result();
</code></pre>
<h2 data-id="heading-19">8. IO å·¥å…·</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¯»å–æ–‡ä»¶</span>
<span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> Files.asCharSource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"test.txt"</span>), Charsets.UTF_8).read();

<span class="hljs-comment">// å†™å…¥æ–‡ä»¶</span>
Files.asCharSink(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"output.txt"</span>), Charsets.UTF_8).write(<span class="hljs-string">"Hello World"</span>);

<span class="hljs-comment">// å¤åˆ¶æ–‡ä»¶</span>
Files.copy(sourceFile, targetFile);

<span class="hljs-comment">// ç§»åŠ¨æ–‡ä»¶</span>
Files.move(sourceFile, targetFile);

<span class="hljs-comment">// è¯»å–æ‰€æœ‰è¡Œ</span>
List&lt;String&gt; lines = Files.readLines(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"test.txt"</span>), Charsets.UTF_8);

<span class="hljs-comment">// å…³é—­æµ</span>
<span class="hljs-type">Closer</span> <span class="hljs-variable">closer</span> <span class="hljs-operator">=</span> Closer.create();
<span class="hljs-keyword">try</span> {
    <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> closer.register(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"file.txt"</span>));
    <span class="hljs-comment">// ä½¿ç”¨æµ</span>
} <span class="hljs-keyword">catch</span> (Throwable e) {
    <span class="hljs-keyword">throw</span> closer.rethrow(e);
} <span class="hljs-keyword">finally</span> {
    closer.close();
}
</code></pre>
<h2 data-id="heading-20">9. æ•°å­¦å·¥å…· (Math)</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ•´æ•°è¿ç®—</span>
<span class="hljs-type">int</span> <span class="hljs-variable">gcd</span> <span class="hljs-operator">=</span> IntMath.gcd(<span class="hljs-number">12</span>, <span class="hljs-number">18</span>);  <span class="hljs-comment">// æœ€å¤§å…¬çº¦æ•°: 6</span>
<span class="hljs-type">int</span> <span class="hljs-variable">mod</span> <span class="hljs-operator">=</span> IntMath.mod(-<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);   <span class="hljs-comment">// æ¨¡è¿ç®—: 1</span>
<span class="hljs-type">int</span> <span class="hljs-variable">pow</span> <span class="hljs-operator">=</span> IntMath.pow(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>);   <span class="hljs-comment">// å¹‚è¿ç®—: 1024</span>

<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºè´¨æ•°</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">isPrime</span> <span class="hljs-operator">=</span> IntMath.isPrime(<span class="hljs-number">17</span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// é˜¶ä¹˜</span>
<span class="hljs-type">int</span> <span class="hljs-variable">factorial</span> <span class="hljs-operator">=</span> IntMath.factorial(<span class="hljs-number">5</span>);  <span class="hljs-comment">// 120</span>

<span class="hljs-comment">// äºŒé¡¹å¼ç³»æ•°</span>
<span class="hljs-type">int</span> <span class="hljs-variable">binomial</span> <span class="hljs-operator">=</span> IntMath.binomial(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);  <span class="hljs-comment">// 10</span>

<span class="hljs-comment">// æµ®ç‚¹æ•°æ¯”è¾ƒ</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">fuzzyEquals</span> <span class="hljs-operator">=</span> DoubleMath.fuzzyEquals(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0000001</span>, <span class="hljs-number">0.00001</span>);
</code></pre>
<h2 data-id="heading-21">10. RateLimiter - é™æµå™¨</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºé™æµå™¨ï¼šæ¯ç§’ 5 ä¸ªè®¸å¯</span>
<span class="hljs-type">RateLimiter</span> <span class="hljs-variable">limiter</span> <span class="hljs-operator">=</span> RateLimiter.create(<span class="hljs-number">5.0</span>);

<span class="hljs-comment">// è·å–è®¸å¯ï¼ˆé˜»å¡ï¼‰</span>
limiter.acquire();
processRequest();

<span class="hljs-comment">// è·å–å¤šä¸ªè®¸å¯</span>
limiter.acquire(<span class="hljs-number">3</span>);

<span class="hljs-comment">// å°è¯•è·å–è®¸å¯ï¼ˆéé˜»å¡ï¼‰</span>
<span class="hljs-keyword">if</span> (limiter.tryAcquire()) {
    processRequest();
} <span class="hljs-keyword">else</span> {
    rejectRequest();
}

<span class="hljs-comment">// å¸¦è¶…æ—¶çš„è·å–</span>
<span class="hljs-keyword">if</span> (limiter.tryAcquire(<span class="hljs-number">1</span>, TimeUnit.SECONDS)) {
    processRequest();
}
</code></pre>
<h2 data-id="heading-22">Maven ä¾èµ–</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>32.1.3-jre<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h2 data-id="heading-23">æ€»ç»“</h2>
<p>Guava æä¾›äº†ä¸°å¯Œçš„å·¥å…·ç±»ï¼Œæ¶µç›–é›†åˆã€å­—ç¬¦ä¸²ã€ç¼“å­˜ã€IO ç­‰å¤šä¸ªæ–¹é¢ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ Java å¼€å‘æ•ˆç‡ã€‚å»ºè®®åœ¨é¡¹ç›®ä¸­åˆç†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå‡å°‘é‡å¤é€ è½®å­ï¼Œæé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>å…³é”®ä¼˜åŠ¿ï¼š</p>
<ul>
<li>çº¿ç¨‹å®‰å…¨çš„ä¸å¯å˜é›†åˆ</li>
<li>å¼ºå¤§çš„é›†åˆæ‰©å±•ï¼ˆMultimapã€Tableã€BiMapï¼‰</li>
<li>ç®€æ´çš„å­—ç¬¦ä¸²å¤„ç†</li>
<li>é«˜æ€§èƒ½æœ¬åœ°ç¼“å­˜</li>
<li>å®Œå–„çš„å‰ç½®æ¡ä»¶æ£€æŸ¥</li>
<li>å®ç”¨çš„é™æµå’Œæ•°å­¦å·¥å…·</li>
</ul>
<p>é€šè¿‡æŒæ¡è¿™äº›å¸¸ç”¨å·¥å…·åŒ…ï¼Œä½ å¯ä»¥å†™å‡ºæ›´åŠ ç®€æ´ã€é«˜æ•ˆã€å¥å£®çš„ Java ä»£ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¬è¯´å‰ç«¯åˆæ­»äº†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575651989985820726</link>    <guid>https://juejin.cn/post/7575651989985820726</guid>    <pubDate>2025-11-24T02:40:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575651989985820726" data-draft-id="7575937594350010411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¬è¯´å‰ç«¯åˆæ­»äº†ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,ç¨‹åºå‘˜,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T02:40:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="suke"/> <meta itemprop="url" content="https://juejin.cn/user/404227777640397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¬è¯´å‰ç«¯åˆæ­»äº†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/404227777640397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    suke
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:40:56.000Z" title="Mon Nov 24 2025 02:40:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™å‡ å¤©åˆ· Xã€åˆ· Redditã€åˆ·å›½å†…æŠ€æœ¯ç¤¾åŒºï¼Œåªè¦ä½ ç¨å¾®ç‚¹å¼€çƒ­æ¦œï¼Œå°±ä¼šè¢«åŒä¸€å¥è¯ç²¾å‡†çˆ†å¤´ï¼š</p>
<p>â€œGemini 3 çœŸçš„æŠŠå‰ç«¯æ‰¬äº†ï¼Œè¿™æ¬¡æ˜¯éª¨ç°çº§åˆ«çš„æ‰¬ã€‚â€</p>
<p>â€œä¸€ä¸ª prompt ç›´æ¥å‡º 3D ä½“ç´ ç¼–è¾‘å™¨/è§†é¢‘å‰ªè¾‘è½¯ä»¶/ç”µå½±çº§ç™»é™†é¡µï¼Œå‰ç«¯å½»åº•æ²¡æ´»äº†ã€‚â€</p>
<p>â€œæˆ‘ç”¨ Gemini 3 ä¸‰åˆ†é’Ÿå†™äº†ä¸ªæ¯” CapCut è¿˜ä¸æ»‘çš„ç½‘é¡µç‰ˆå‰ªè¾‘å™¨ï¼Œç¨‹åºå‘˜å¯ä»¥å›å®¶æŠ±å­©å­äº†ã€‚â€</p>
<p>é…å›¾æ°¸è¿œæ˜¯é‚£ç§é«˜æ½®åˆ°å‘å…‰çš„ 4K 60fps æ¼”ç¤ºè§†é¢‘ï¼šä¸€ä¸ª prompt â†’ è¿›åº¦æ¡èµ°å®Œ â†’ å®Œç¾äº¤äº’åº”ç”¨è·ƒç„¶å±å¹•ï¼Œç‚¹èµå‡ ä¸‡ï¼Œè½¬å‘ç‹‚æ¬¢ï¼Œè¯„è®ºåŒºæ¸…ä¸€è‰²â€œå‰ç«¯å·²æ­»â€â€œæˆ‘å¤±ä¸šäº†â€â€œæ—¶ä»£æŠ›å¼ƒä½ è¿æ‹›å‘¼éƒ½ä¸æ‰“â€ã€‚</p>
<p>å…„å¼Ÿä»¬ï¼Œæˆ‘å¤ªç†Ÿè¿™ä¸ªå‰§æœ¬äº†ã€‚å‰ç«¯è¿™å‡ å¹´ï¼Œå¹³å‡æ¯ 9 ä¸ªæœˆå°±è¢«å…¬å¼€å¤„å†³ä¸€æ¬¡ã€‚</p>
<h4 data-id="heading-0">æˆ‘ä»¬çš„æ­»äº¡æ¸…å•ï¼ˆ2025 å¹´ 11 æœˆå®æ—¶æ›´æ–°ç‰ˆï¼‰</h4>
<ul>
<li>2010ï¼šWordPress æ¨¡æ¿ â†’ å‰ç«¯å†å’</li>
<li>2015ï¼šWebflow/No-Code â†’ å‰ç«¯ä¸‰å’</li>
<li>2023ï¼šGPT-4 ä¸€ä¸ª prompt è´ªåƒè›‡ â†’ å‰ç«¯å››å’</li>
<li>2024ï¼šClaude 3.5 Sonnet å· UI â†’ å‰ç«¯äº”å’</li>
<li>2025 å¹´ 11 æœˆ 18-21 æ—¥ï¼šGemini 3 è¿å‘ä¸‰å¤© demoï¼ˆä½“ç´ ç©å…·ç®±ã€ç½‘é¡µç‰ˆ CapCutã€èµ›åšé£ç™»é™†é¡µã€AI è§†é¢‘ç”Ÿæˆå·¥å…·â€¦â€¦ï¼‰â†’ å‰ç«¯è¿™ä¸‰å¤©æ­»äº† 114514 æ¬¡ï¼Œç›®å‰éª¨ç°å·²è¢« X ç”¨æˆ·æ‰¬åˆ°å¤ªå¹³æ´‹å¯¹å²¸å»äº†</li>
</ul>
<h4 data-id="heading-1">è¿™å‡ å¤©æœ€ç»å…¸çš„å‡ ä¸ªâ€œè‘¬ç¤¼ç°åœºâ€</h4>
<blockquote>
<ol>
<li>é‚£ä¸ª 3D Voxel Toy Boxï¼šä¸€ä¸ª prompt å‡ºæ¥ï¼Œå®æ—¶ç»˜ç”»ã€ç ´åã€å¯¼å‡º glTFï¼Œä¸æ»‘å¾—åƒ Unity å®˜æ–¹ demoã€‚è¯„è®ºåŒºç›´æ¥é«˜å‘¼â€œå‰ç«¯å·¥ç¨‹å¸ˆå¯ä»¥é›†ä½“è½¬è¡Œäº†â€ã€‚</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>é‚£ä¸ªç½‘é¡µç‰ˆè§†é¢‘ç¼–è¾‘å™¨ï¼šæ‹–æ‹½æ—¶é—´çº¿ã€AI è‡ªåŠ¨ç”Ÿæˆè§†é¢‘ã€TTSã€å­—å¹•ã€è½¬åœºå…¨æœ‰ã€‚ä½œè€…åœ¨ X ä¸Šå‘å¸–ï¼šâ€œä» 0 åˆ° 1 åªç”¨äº† 1.5 å°æ—¶ï¼Œæ„Ÿè°¢ Gemini 3ã€‚â€ åº•ä¸‹å›å¤â€œå‰ç«¯å·²æ­»â€â€œæˆ‘å“­æ­»â€â€œç¨‹åºå‘˜æœ«æ—¥â€ã€‚</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>é‚£ä¸ªç”µå½±çº§ç™»é™†é¡µï¼šæš—é»‘èµ›åšé£ã€3D ç²’å­èƒŒæ™¯ã€é¼ æ ‡è§†å·®ã€æ»šåŠ¨è§¦å‘åŠ¨ç”»ï¼Œå®Œç¾å“åº”å¼ï¼Œè¿ iPad æ¨ªç«–å±åˆ‡æ¢éƒ½ä¸æ»‘ã€‚ä½œè€…æ·¡å®šåœ°è¯´ï¼šâ€œå°±ä¸€ä¸ª promptï¼Œæ”¹äº†ä¸‰æ¬¡æè¿°ã€‚â€</li>
</ol>
</blockquote>
<p>ç„¶åè¿™å‡ å¤©ï¼Œæ—¶é—´çº¿å½»åº•æ²¦é™·ï¼š</p>
<ul>
<li>â€œä»¥åå…¬å¸åªéœ€è¦ä¸€ä¸ªä¼šå†™ prompt çš„äº§å“ç»ç†å°±è¡Œäº†ã€‚â€</li>
<li>â€œå‰ç«¯å²—ä½é¢„è®¡ 2026 å¹´æ¶ˆå¤±ã€‚â€</li>
<li>â€œå»ºè®®æ‰€æœ‰å¤§å‚ç«‹åˆ»è£æ‰ 90% çš„å‰ç«¯ã€‚â€</li>
</ul>
<p><strong>Gemini 3 ç¡®å®ç‰›é€¼</strong>ï¼Œè¿™å‡ å¤© X ä¸Šçš„å„ç§å®æµ‹æç¤ºè¯éƒ½è¯•äº†ä¸‹ï¼Œç”Ÿæˆçš„ä¸œè¥¿ç¡®å®ç‰›é€¼ï¼Œæˆ‘æŠŠå…¬å¸é¦–é¡µä¸¢ç»™å®ƒï¼Œè®©å®ƒâ€œé‡æ„å¾—æ›´ç°ä»£ä¸€ç‚¹â€ã€‚
<strong>20ç§’åï¼Œå®ƒç»™æˆ‘åäº†ä¸€ä¸ªç”µå½±çº§ç²’å­èƒŒæ™¯ + 3D å¡ç‰‡ + æ»šåŠ¨è§¦å‘åŠ¨ç”»çš„ç‰ˆæœ¬ï¼ŒLighthouse ç›´æ¥ 100/100/100/100ã€‚ã€‚ã€‚å¥¶å¥¶çš„è¿™æ¯”å¥½å¤šä¼˜ç§€å‰ç«¯å†™çš„ä¸çŸ¥é“å¥½å¤šå°‘å€ã€‚ã€‚</strong></p>
<p>ä½†é—®é¢˜æ¥äº†ï¼šä½ ä¸€ä¸ª prompt åšå‡ºæ¥çš„å®Œç¾ demoï¼Œæ˜å¤©ä¸Šçº¿çš„æ—¶å€™ï¼Œç”²æ–¹ä¼šå‘Šè¯‰ä½ ï¼š</p>
<p>â€œèƒŒæ™¯è¦é‚£ç§çœ‹ä¸è§çš„é»‘è‰²ï¼Œåƒæ·±å¤œemoä½†åˆæœ‰å¸Œæœ›çš„æ„Ÿè§‰ã€‚â€</p>
<p>â€œè¿™ä¸ªåŠ¨ç”»å†æ…¢ 0.2 ç§’ï¼Œç”¨æˆ·ä¼šè§‰å¾—æˆ‘ä»¬å…¬å¸å¾ˆç¨³é‡ã€‚â€</p>
<p>ä½ é—® Gemini 3 æ€ä¹ˆæ”¹ï¼Œå®ƒä¼šéå¸¸è®¤çœŸåœ°ç»™ä½ ç”Ÿæˆ 17 ç§ä¼˜é›…æ–¹æ¡ˆã€‚</p>
<p>ç„¶åä½ ä¸Šçº¿åå‘ç°ï¼š</p>
<ul>
<li>ç”²æ–¹ä¸æ»¡æ„ï¼Œè¿™é‡Œé‚£é‡Œæ€ä¹ˆæ ·æ€ä¹ˆæ ·ã€‚</li>
<li>ç”²æ–¹çš„æµè§ˆå™¨ CSS ä¸å…¼å®¹è€Œå¯¼è‡´çš„æ ·å¼æ··ä¹±ã€‚</li>
<li>æ–°çš„æ ·å¼å’Œé¡¹ç›®æ•´ä½“æ ·å¼å†²çªã€‚
è¿™æ—¶å€™ä½ è¿˜å¾—è‡ªå·±ä¸Šæ‰‹ï¼Œä¸€ä¸ªä¸ªå»ä¿®ã€å» hackã€å»åŠ ä¸€å † !important å’Œ anyã€‚</li>
</ul>
<p>æ­å–œä½ ï¼Œä½ åˆå›åˆ°äº†æœ€ç†Ÿæ‚‰çš„å‰ç«¯ç”Ÿæ´»ã€‚</p>
<h4 data-id="heading-2">2026 å¹´çš„æ–°å·¥ç§ï¼šAI æ“¦å±è‚¡å·¥ç¨‹å¸ˆ</h4>
<p>è¿™å‡ å¤©ç½‘ä¸Šæœ€çƒ­é—¨çš„æ¢—å°±æ˜¯â€œå‰ç«¯å·²æ­»â€ï¼Œä½†æ˜¯åªè¦ç”²æ–¹å­˜åœ¨ï¼Œå‰ç«¯åŒä»å°±æœ‰æ´»è·¯ã€‚</p>
<p>æ‰€ä»¥ï¼Œé¢å¯¹è¿™å‡ å¤©é“ºå¤©ç›–åœ°çš„â€œGemini 3 æŠŠå‰ç«¯æ‰¬äº†â€è¨€è®ºï¼Œè¯·å„ä½å‰ç«¯åŒä»ä¿æŒå†·é™ã€‚æˆ‘ä»¬<strong>å‰ç«¯çš„çœŸæ­£æ ¸å¿ƒç«äº‰åŠ›ï¼Œä»æ¥ä¸æ˜¯å†™ä»£ç </strong>ã€‚</p>
<p><strong>åªè¦ç”²æ–¹ä¼šåŠå¤œæ”¹éœ€æ±‚ï¼Œåªè¦è¿˜æœ‰å®‰å“ç¢ç‰‡åŒ–ï¼Œåªè¦ CSS è¿˜å­˜åœ¨ï¼Œå‰ç«¯å°±æ­»ä¸äº†ã€‚</strong></p>
<p><strong>å‰ç«¯å·²æ­»ï¼Ÿä¸ï¼Œå‰ç«¯åªæ˜¯åˆè¢«æ‰¬äº†ä¸€æ¬¡éª¨ç°ï¼Œç„¶åç»§ç»­è´Ÿä¼¤åŠ ç­ï¼Œé¡ºä¾¿å¸® Gemini 3 æ“¦å±è‚¡ã€‚</strong></p>
<p><strong>å‰ç«¯ä¸‡å²ï¼ï¼ˆä¸‹æ¬¡ GPT-6 å‡ºæ¥å†ç»§ç»­æ­»ï¼‰</strong></p>
<h4 data-id="heading-3">é¦–å‘åœ°å€ï¼š</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fd_hh8qKdTkW8iBYux2yrVA" target="_blank" title="https://mp.weixin.qq.com/s/d_hh8qKdTkW8iBYux2yrVA" ref="nofollow noopener noreferrer">Gemini 3 å‘å¸ƒäº†ï¼Œæ­å–œå‰ç«¯ç¬¬ 10086 æ¬¡â€œç”±äºä¸å¯æŠ—åŠ›â€å®£å‘Šæ­»äº¡</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot æ•´åˆ Elasticsearch åŠå®æˆ˜åº”ç”¨]]></title>    <link>https://juejin.cn/post/7575413146922385423</link>    <guid>https://juejin.cn/post/7575413146922385423</guid>    <pubDate>2025-11-24T01:46:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146922385423" data-draft-id="7575413146922369039" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot æ•´åˆ Elasticsearch åŠå®æˆ˜åº”ç”¨"/> <meta itemprop="keywords" content="åç«¯,Java,Elasticsearch"/> <meta itemprop="datePublished" content="2025-11-24T01:46:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚Ÿç©ºç å­—"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot æ•´åˆ Elasticsearch åŠå®æˆ˜åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚Ÿç©ºç å­—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:46:12.000Z" title="Mon Nov 24 2025 01:46:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™æ¬¡å†…å®¹è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Spring Boot æ•´åˆ Elasticsearchï¼Œå¹¶æä¾›å‡ ä¸ªå®é™…åº”ç”¨æ¡ˆä¾‹ã€‚å†…å®¹æ¶µç›– Elasticsearch çš„åŸºæœ¬æ¦‚å¿µã€Spring Boot æ•´åˆæ­¥éª¤ã€å®æˆ˜åº”ç”¨ç¤ºä¾‹ä»¥åŠä¼˜åŒ–å»ºè®®ã€‚</p>
<h2 data-id="heading-0">1ã€Elasticsearch æ¦‚å¿µåŠä½œç”¨</h2>
<p><strong>Elasticsearch</strong> æ˜¯ä¸€ä¸ªåŸºäº Apache Lucene æ„å»ºçš„åˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ã€‚å®ƒä¸“é—¨ä¸ºå¤„ç†å¤§è§„æ¨¡æ•°æ®è€Œè®¾è®¡ï¼Œæä¾›è¿‘å®æ—¶çš„æœç´¢èƒ½åŠ›ï¼Œæ”¯æŒç»“æ„åŒ–ã€å…¨æ–‡ã€åœ°ç†ç©ºé—´ç­‰å¤šç§ç±»å‹çš„æŸ¥è¯¢ã€‚</p>
<p>æ ¸å¿ƒç‰¹æ€§ä¸ä½œç”¨åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>åˆ†å¸ƒå¼æ¶æ„</strong>ï¼šæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œé€šè¿‡åˆ†ç‰‡ï¼ˆShardï¼‰å’Œå‰¯æœ¬ï¼ˆReplicaï¼‰æœºåˆ¶å®ç°é«˜å¯ç”¨ä¸è´Ÿè½½å‡è¡¡ã€‚</li>
<li><strong>è¿‘å®æ—¶æœç´¢</strong>ï¼šæ•°æ®ç´¢å¼•åå‡ ä¹ç«‹å³å¯æœï¼Œé€‚ç”¨äºéœ€è¦å¿«é€Ÿå“åº”çš„åœºæ™¯ã€‚</li>
<li><strong>å¼ºå¤§çš„å…¨æ–‡æœç´¢</strong>ï¼šåŸºäºå€’æ’ç´¢å¼•ï¼Œæ”¯æŒå¤æ‚çš„æŸ¥è¯¢ã€é«˜äº®æ˜¾ç¤ºã€æ¨¡ç³ŠåŒ¹é…ç­‰ã€‚</li>
<li><strong>æ•°æ®åˆ†æä¸èšåˆ</strong>ï¼šæä¾›ä¸°å¯Œçš„èšåˆåŠŸèƒ½ï¼ˆAggregationsï¼‰ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œç»Ÿè®¡å’Œåˆ†æã€‚</li>
<li><strong>å¤šç±»å‹æ•°æ®æ”¯æŒ</strong>ï¼šé™¤äº†æ–‡æœ¬ï¼Œè¿˜èƒ½å¤„ç†æ—¥å¿—ã€æŒ‡æ ‡ã€åœ°ç†ç©ºé—´æ•°æ®ç­‰ã€‚</li>
<li><strong>æ˜“ç”¨æ€§ä¸æ‰©å±•æ€§</strong>ï¼šæä¾› RESTful APIï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€é›†æˆï¼Œå¹¶æ‹¥æœ‰æ´»è·ƒçš„ç”Ÿæ€ç³»ç»Ÿã€‚</li>
</ul>
<p>Elasticsearch å¹¿æ³›åº”ç”¨äºç”µå•†æœç´¢ã€æ—¥å¿—åˆ†æã€å®æ—¶ç›‘æ§ã€æ•°æ®å¯è§†åŒ–ç­‰é¢†åŸŸã€‚</p>
<h2 data-id="heading-1">2ã€Spring Boot æ•´åˆ Elasticsearch</h2>
<h3 data-id="heading-2">2.1ã€ç¯å¢ƒå‡†å¤‡ä¸ä¾èµ–é…ç½®</h3>
<p>åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œé¦–å…ˆéœ€è¦åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ  Elasticsearch ç›¸å…³ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>åœ¨ <code>application.properties</code> ä¸­é…ç½® Elasticsearch è¿æ¥ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.elasticsearch.rest.uris</span>=http://localhost:<span class="hljs-number">9200</span>
<span class="hljs-attr">spring.data.elasticsearch.repositories.enabled</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>å¦‚æœè¿æ¥ Elasticsearch é›†ç¾¤ï¼Œå¯ä»¥é…ç½®é›†ç¾¤åç§°å’ŒèŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.data.elasticsearch.cluster-name</span>=your-cluster-name
<span class="hljs-attr">spring.data.elasticsearch.cluster-nodes</span>=ip1:port1,ip2:port2
</code></pre>
<h3 data-id="heading-3">2.2ã€åˆ›å»º Elasticsearch å®ä½“ç±»</h3>
<p>ä½¿ç”¨ <code>@Document</code> æ³¨è§£å®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼Œæ˜ å°„åˆ° Elasticsearch çš„ç´¢å¼•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Id</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">elasticsearch</span>.<span class="hljs-property">annotations</span>.<span class="hljs-property">Document</span>;

<span class="hljs-meta">@Document</span>(indexName = <span class="hljs-string">"articles"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Article</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> id;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> title;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> content;
    
    <span class="hljs-comment">// æ— å‚æ„é€ å™¨ã€æœ‰å‚æ„é€ å™¨ã€getterå’Œsetteræ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Article</span>() {}
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Article</span>(<span class="hljs-title class_">String</span> id, <span class="hljs-title class_">String</span> title, <span class="hljs-title class_">String</span> content) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = content;
    }
    
    <span class="hljs-comment">// Getter å’Œ Setter æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getId</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> id; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setId</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> id</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id; }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTitle</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> title; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setTitle</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> title</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title; }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getContent</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> content; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setContent</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> content</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = content; }
}
</code></pre>
<h3 data-id="heading-4">2.3ã€åˆ›å»º Elasticsearch Repository</h3>
<p>åˆ›å»ºä¸€ä¸ªç»§æ‰¿ <code>ElasticsearchRepository</code> çš„æ¥å£ï¼Œç”¨äºæ•°æ®æ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.repository.ElasticsearchRepository;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ArticleRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;Article, String&gt; {
    
    <span class="hljs-comment">// æ ¹æ®å†…å®¹è¿›è¡Œå…¨æ–‡æœç´¢</span>
    List&lt;Article&gt; <span class="hljs-title function_">findByContentContaining</span><span class="hljs-params">(String content)</span>;
    
    <span class="hljs-comment">// æ ¹æ®æ ‡é¢˜æœç´¢</span>
    List&lt;Article&gt; <span class="hljs-title function_">findByTitleContaining</span><span class="hljs-params">(String title)</span>;
}
</code></pre>
<h3 data-id="heading-5">2.4ã€æ§åˆ¶å™¨å±‚å®ç°</h3>
<p>åˆ›å»ºä¸€ä¸ª REST æ§åˆ¶å™¨æ¥å¤„ç†æœç´¢è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;

@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api/articles"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">ArticleController</span> {
    
    <span class="hljs-variable">@Autowired</span>
    private ArticleRepository articleRepository;
    
    <span class="hljs-comment">// æœç´¢æ–‡ç« </span>
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/search"</span>)
    public List&lt;Article&gt; <span class="hljs-built_in">searchArticles</span>(<span class="hljs-variable">@RequestParam</span> String query) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">articleRepository</span><span class="hljs-selector-class">.findByContentContaining</span>(query);
    }
    
    <span class="hljs-comment">// æ·»åŠ æ–°æ–‡ç« </span>
    @<span class="hljs-selector-tag">PostMapping</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Article</span> <span class="hljs-selector-tag">createArticle</span>(<span class="hljs-variable">@RequestBody</span> Article article) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">articleRepository</span><span class="hljs-selector-class">.save</span>(article);
    }
}
</code></pre>
<h2 data-id="heading-6">3ã€Elasticsearch å®æˆ˜åº”ç”¨æ¡ˆä¾‹</h2>
<h3 data-id="heading-7">3.1ã€æ¡ˆä¾‹ä¸€ï¼šç”µå•†å¹³å°å•†å“æœç´¢ä¸é«˜äº®æ˜¾ç¤º</h3>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šç”µå•†å¹³å°éœ€è¦ä¸ºç”¨æˆ·æä¾›é«˜æ•ˆçš„å•†å“æœç´¢åŠŸèƒ½ï¼Œåœ¨æµ·é‡æ•°æ®ä¸­å¿«é€Ÿè¿”å›åŒ¹é…ç»“æœï¼Œå¹¶é«˜äº®æ˜¾ç¤ºå…³é”®å­—ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>
<p><strong>åˆ›å»ºå•†å“ç´¢å¼•</strong>ï¼š
ä½¿ç”¨ Elasticsearch çš„ REST API åˆ›å»ºå•†å“ç´¢å¼•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">PUT /products
{
  <span class="hljs-string">"mappings"</span>: {
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"name"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span> },
      <span class="hljs-string">"description"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span> },
      <span class="hljs-string">"price"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"float"</span> }
    }
  }
}
</code></pre>
</li>
<li>
<p><strong>æ·»åŠ å•†å“æ•°æ®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">POST /products/_doc/1
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"åä¸º Mate 70"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Mate 70 æ‰‹æœºæ˜¯æ­è½½çº¯è¡€é¸¿è’™NEXT ç³»ç»Ÿçš„ç¬¬ä¸€æ¬¾æ——èˆ°æœº"</span>,
  <span class="hljs-string">"price"</span>: 6500
}
</code></pre>
</li>
<li>
<p><strong>å®ç°æœç´¢ä¸é«˜äº®</strong>ï¼š
åœ¨ Repository ä¸­å®šä¹‰å¤æ‚æŸ¥è¯¢æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.annotations.Query;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> interface <span class="hljs-type">ProductRepository</span> extends <span class="hljs-type">ElasticsearchRepository</span>&lt;<span class="hljs-type">Product</span>, <span class="hljs-type">String</span>&gt; {
    
    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"{<span class="hljs-subst">\"</span>multi_match<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>query<span class="hljs-subst">\"</span>: <span class="hljs-subst">\"</span>?0<span class="hljs-subst">\"</span>, <span class="hljs-subst">\"</span>fields<span class="hljs-subst">\"</span>: [<span class="hljs-subst">\"</span>name<span class="hljs-subst">\"</span>, <span class="hljs-subst">\"</span>description<span class="hljs-subst">\"</span>]}}"</span>)
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Product</span>&gt; findByQuery(<span class="hljs-type">String</span> query);
}
</code></pre>
<p>ä½¿ç”¨ Elasticsearch çš„é«˜äº®æŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ElasticsearchRestTemplate</span> elasticsearchTemplate;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">SearchHit</span>&lt;<span class="hljs-title class_">Product</span>&gt;&gt; <span class="hljs-title function_">searchProductsWithHighlight</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> keyword</span>) {
        <span class="hljs-comment">// åˆ›å»ºæŸ¥è¯¢æ¡ä»¶</span>
        <span class="hljs-title class_">NativeSearchQuery</span> searchQuery = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>()
            .<span class="hljs-title function_">withQuery</span>(<span class="hljs-title class_">QueryBuilders</span>.<span class="hljs-title function_">multiMatchQuery</span>(keyword, <span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>))
            .<span class="hljs-title function_">withHighlightFields</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.<span class="hljs-title class_">Field</span>(<span class="hljs-string">"name"</span>).<span class="hljs-title function_">preTags</span>(<span class="hljs-string">"&lt;em&gt;"</span>).<span class="hljs-title function_">postTags</span>(<span class="hljs-string">"&lt;/em&gt;"</span>),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.<span class="hljs-title class_">Field</span>(<span class="hljs-string">"description"</span>).<span class="hljs-title function_">preTags</span>(<span class="hljs-string">"&lt;em&gt;"</span>).<span class="hljs-title function_">postTags</span>(<span class="hljs-string">"&lt;/em&gt;"</span>)
            )
            .<span class="hljs-title function_">build</span>();
        
        <span class="hljs-title class_">SearchHits</span>&lt;<span class="hljs-title class_">Product</span>&gt; searchHits = elasticsearchTemplate.<span class="hljs-title function_">search</span>(searchQuery, <span class="hljs-title class_">Product</span>.<span class="hljs-property">class</span>);
        <span class="hljs-keyword">return</span> searchHits.<span class="hljs-title function_">getSearchHits</span>();
    }
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-8">3.2ã€æ¡ˆä¾‹äºŒï¼šæ—¥å¿—æ”¶é›†ä¸åˆ†æç³»ç»Ÿ</h3>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨æ—¥å¿—è¿›è¡Œé›†ä¸­ç®¡ç†ã€å®æ—¶ç›‘æ§ä¸åˆ†æï¼Œå¿«é€Ÿå®šä½ç³»ç»Ÿé”™è¯¯å’Œæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>ä½¿ç”¨ ELK/EFK æŠ€æœ¯æ ˆ</strong>ï¼š</p>
<ul>
<li><strong>Filebeat/Logstash</strong>ï¼šæ”¶é›†åº”ç”¨æ—¥å¿—</li>
<li><strong>Elasticsearch</strong>ï¼šå­˜å‚¨å’Œç´¢å¼•æ—¥å¿—æ•°æ®</li>
<li><strong>Kibana</strong>ï¼šæ—¥å¿—å¯è§†åŒ–å’Œç›‘æ§</li>
</ul>
</li>
<li>
<p><strong>åˆ›å»ºæ—¥å¿—ç´¢å¼•</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Document</span>(indexName = <span class="hljs-string">"app-logs-#{T(java.time.LocalDate).now().toString()}"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppLog</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> id;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> level;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> message;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> logger;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> timestamp;
    <span class="hljs-comment">// ... å…¶ä»–å­—æ®µå’Œæ–¹æ³•</span>
}
</code></pre>
</li>
<li>
<p><strong>å®ç°æ—¥å¿—åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> interface <span class="hljs-type">LogRepository</span> extends <span class="hljs-type">ElasticsearchRepository</span>&lt;<span class="hljs-type">AppLog</span>, <span class="hljs-type">String</span>&gt; {
    
    <span class="hljs-comment">// ç»Ÿè®¡å„æ—¥å¿—çº§åˆ«çš„æ•°é‡</span>
    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"{<span class="hljs-subst">\"</span>aggs<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>levels<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>terms<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>field<span class="hljs-subst">\"</span>: <span class="hljs-subst">\"</span>level.keyword<span class="hljs-subst">\"</span>}}}}"</span>)
    <span class="hljs-type">AggregatedPage</span>&lt;<span class="hljs-type">AppLog</span>&gt; countByLevel();
    
    <span class="hljs-comment">// æ ¹æ®æ—¶é—´èŒƒå›´æŸ¥è¯¢æ—¥å¿—</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">AppLog</span>&gt; findByTimestampBetween(<span class="hljs-type">String</span> startTime, <span class="hljs-type">String</span> endTime);
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">3.3ã€æ¡ˆä¾‹ä¸‰ï¼šå¤æ‚æŸ¥è¯¢ä¸èšåˆåˆ†æ</h3>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šæ–°é—»åˆ†æå¹³å°éœ€è¦å¯¹å¤§é‡æ–‡ç« è¿›è¡Œå¤æ‚æŸ¥è¯¢å’Œå†…å®¹åˆ†æï¼Œä¾‹å¦‚ç»Ÿè®¡ç‰¹å®šå…³é”®è¯çš„å‡ºç°é¢‘ç‡ã€‚</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>å¸ƒå°”æŸ¥è¯¢</strong>ï¼š
ç»„åˆå¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> org.elasticsearch.index.query.QueryBuilders;
<span class="hljs-keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;

<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Article&gt; <span class="hljs-title">complexSearch</span><span class="hljs-params">(<span class="hljs-type">String</span> mustTerm, <span class="hljs-type">String</span> shouldTerm, <span class="hljs-type">String</span> mustNotTerm)</span> </span>{
    BoolQueryBuilder boolQuery = QueryBuilders.<span class="hljs-built_in">boolQuery</span>()
        .<span class="hljs-built_in">must</span>(QueryBuilders.<span class="hljs-built_in">matchQuery</span>(<span class="hljs-string">"title"</span>, mustTerm))
        .<span class="hljs-built_in">should</span>(QueryBuilders.<span class="hljs-built_in">matchQuery</span>(<span class="hljs-string">"content"</span>, shouldTerm))
        .<span class="hljs-built_in">mustNot</span>(QueryBuilders.<span class="hljs-built_in">matchQuery</span>(<span class="hljs-string">"status"</span>, mustNotTerm));
    
    NativeSearchQuery searchQuery = <span class="hljs-keyword">new</span> <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
        .<span class="hljs-built_in">withQuery</span>(boolQuery)
        .<span class="hljs-built_in">build</span>();
    
    <span class="hljs-keyword">return</span> elasticsearchTemplate.<span class="hljs-built_in">search</span>(searchQuery, Article.<span class="hljs-keyword">class</span>).<span class="hljs-built_in">getContent</span>();
}
</code></pre>
</li>
<li>
<p><strong>èšåˆåˆ†æ</strong>ï¼š
ç»Ÿè®¡æ ‡ç­¾å‡ºç°é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">public void tagAggregation() {
    TermsAggregationBuilder <span class="hljs-attr">aggregation</span> = AggregationBuilders
        .terms("tags_aggregation")
        .field("tags.keyword")<span class="hljs-comment">;</span>
    
    NativeSearchQuery <span class="hljs-attr">searchQuery</span> = new NativeSearchQueryBuilder()
        .addAggregation(aggregation)
        .build()<span class="hljs-comment">;</span>
    
    SearchHits&lt;Article&gt; <span class="hljs-attr">searchHits</span> = elasticsearchTemplate.search(searchQuery, Article.class)<span class="hljs-comment">;</span>
    Terms <span class="hljs-attr">terms</span> = searchHits.getAggregations().get(<span class="hljs-string">"tags_aggregation"</span>)<span class="hljs-comment">;</span>
    
    for (Terms.Bucket bucket : terms.getBuckets()) {
        System.out.println("æ ‡ç­¾: " + bucket.getKey() + ", æ•°é‡: " + bucket.getDocCount())<span class="hljs-comment">;</span>
    }
}
</code></pre>
</li>
</ol>
<h2 data-id="heading-10">4ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2>
<ol>
<li>
<p><strong>ç´¢å¼•ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä¸ºå¸¸ç”¨å­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•æ˜ å°„</li>
<li>æ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©åˆé€‚çš„åˆ†æå™¨</li>
</ul>
</li>
<li>
<p><strong>æŸ¥è¯¢ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨è¿‡æ»¤å™¨ç¼“å­˜ç»“æœ</li>
<li>é™åˆ¶æ£€ç´¢èŒƒå›´ï¼Œé¿å…å…¨ç´¢å¼•æ‰«æ</li>
<li>ä½¿ç”¨åˆ†é¡µå‡å°‘è¿”å›æ•°æ®é‡</li>
</ul>
</li>
<li>
<p><strong>é›†ç¾¤ä¸åˆ†ç‰‡é…ç½®</strong>ï¼š</p>
<ul>
<li>æ ¹æ®æ•°æ®é‡å’Œç¡¬ä»¶é…ç½®åˆç†è®¾ç½®åˆ†ç‰‡æ•°é‡å’Œå‰¯æœ¬</li>
<li>ç›‘æ§èŠ‚ç‚¹è´Ÿè½½ï¼Œé¿å…çƒ­ç‚¹æ•°æ®é—®é¢˜</li>
</ul>
</li>
<li>
<p><strong>æ‰¹é‡æ“ä½œ</strong>ï¼š
å¯¹äºå¤§é‡æ•°æ®æ’å…¥å’Œæ›´æ–°ï¼Œä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class BulkOperationService {
    
    <span class="hljs-keyword">@Autowired</span>
    private ElasticsearchRestTemplate elasticsearchTemplate;
    
    public void <span class="hljs-built_in">bulkInsert</span>(List&lt;Article&gt; articles) {
        List&lt;IndexQuery&gt; queries = articles<span class="hljs-selector-class">.stream</span>()
            <span class="hljs-selector-class">.map</span>(article -&gt; new IndexQueryBuilder()
                <span class="hljs-selector-class">.withId</span>(article.getId())
                <span class="hljs-selector-class">.withObject</span>(article)
                <span class="hljs-selector-class">.build</span>())
            <span class="hljs-selector-class">.collect</span>(Collectors.toList());
        
        elasticsearchTemplate<span class="hljs-selector-class">.bulkIndex</span>(queries, BulkOptions.defaultOptions());
    }
}
</code></pre>
</li>
</ol>
<h2 data-id="heading-11">5ã€æ€»ç»“</h2>
<p>ä¸»è¦ä»‹ç»äº† Spring Boot ä¸ Elasticsearch çš„æ•´åˆæ–¹æ³•ï¼Œå¹¶é€šè¿‡ç”µå•†æœç´¢ã€æ—¥å¿—åˆ†æå’Œå¤æ‚æŸ¥è¯¢ä¸‰ä¸ªå®é™…æ¡ˆä¾‹å±•ç¤ºäº† Elasticsearch çš„åº”ç”¨ä»·å€¼ã€‚é€šè¿‡åˆç†çš„é…ç½®å’Œä¼˜åŒ–ï¼ŒElasticsearch èƒ½å¤Ÿä¸ºåº”ç”¨ç¨‹åºæä¾›å¼ºå¤§çš„æœç´¢å’Œæ•°æ®åˆ†æèƒ½åŠ›ï¼Œæ»¡è¶³å¤§æ•°æ®é‡ä¸‹çš„é«˜æ€§èƒ½éœ€æ±‚ã€‚</p>
<p>Elasticsearch çš„åˆ†å¸ƒå¼ç‰¹æ€§å’Œä¸°å¯Œçš„åŠŸèƒ½é›†ä½¿å…¶æˆä¸ºç°ä»£åº”ç”¨ä¸­ä¸å¯æˆ–ç¼ºçš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œåˆç†åˆ©ç”¨å…¶ç‰¹æ€§å¯ä»¥æ˜¾è‘—æå‡åº”ç”¨çš„æœç´¢ä½“éªŒå’Œæ•°æ®å¤„ç†èƒ½åŠ›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2dbbcbf45674c1b9e09659e67e261bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764553572&amp;x-signature=jOsMMYx2SXY8DEubf45xxUyOcms%3D" alt="image.png" loading="lazy"/></p>
<p><strong>è°¢è°¢ä½ çœ‹æˆ‘çš„æ–‡ç« ï¼Œæ—¢ç„¶çœ‹åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œéšæ‰‹ç‚¹ä¸ªèµã€è½¬å‘ã€åœ¨çœ‹ä¸‰è¿å§ï¼Œæ„Ÿè°¢æ„Ÿè°¢ã€‚é‚£æˆ‘ä»¬ï¼Œä¸‹æ¬¡å†è§ã€‚</strong></p>
<p>æ‚¨çš„ä¸€é”®ä¸‰è¿ï¼Œæ˜¯æˆ‘æ›´æ–°çš„æœ€å¤§åŠ¨åŠ›ï¼Œè°¢è°¢</p>
<p>å±±æ°´æœ‰ç›¸é€¢ï¼Œæ¥æ—¥çš†å¯æœŸï¼Œè°¢è°¢é˜…è¯»ï¼Œæˆ‘ä»¬å†ä¼š</p>
<p>æˆ‘æ‰‹ä¸­çš„é‡‘ç®æ£’ï¼Œä¸Šèƒ½é€šå¤©ï¼Œä¸‹èƒ½æ¢æµ·</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python é«˜çº§ç‰¹æ€§dataclass]]></title>    <link>https://juejin.cn/post/7575456858428080174</link>    <guid>https://juejin.cn/post/7575456858428080174</guid>    <pubDate>2025-11-24T02:08:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858428080174" data-draft-id="7575469988737302537" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python é«˜çº§ç‰¹æ€§dataclass"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-24T02:08:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GeekPMAlex"/> <meta itemprop="url" content="https://juejin.cn/user/2326992765334446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python é«˜çº§ç‰¹æ€§dataclass
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2326992765334446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GeekPMAlex
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:08:08.000Z" title="Mon Nov 24 2025 02:08:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python Dataclass ä¸­çš„ Getter ä¸ Setterï¼šä½ éœ€è¦çŸ¥é“çš„ä¸€åˆ‡</h2>
<p>åœ¨ Python ç¼–ç¨‹ä¸­ï¼Œ<code>dataclass</code> æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„è£…é¥°å™¨ï¼Œå®ƒèƒ½è‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆå¸¸è§çš„â€œæ ·æ¿ä»£ç â€ï¼ˆboilerplate codeï¼‰ï¼Œæ¯”å¦‚ <code>__init__</code>ã€<code>__repr__</code>ã€<code>__eq__</code> ç­‰æ–¹æ³•ã€‚ç„¶è€Œï¼Œå¾ˆå¤šåˆšæ¥è§¦ <code>dataclass</code> çš„å¼€å‘è€…ä¼šé—®ä¸€ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p><strong>â€œdataclass ä¼šè‡ªåŠ¨ç”Ÿæˆ getter å’Œ setter å—ï¼Ÿâ€</strong></p>
</blockquote>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸ä¼š</strong>ã€‚</p>
<p>ä½†åˆ«æ‹…å¿ƒï¼Python çš„è®¾è®¡å“²å­¦æœ¬èº«å°±é¼“åŠ±ç›´æ¥è®¿é—®å±æ€§ï¼Œè€Œä¸æ˜¯åƒ Java é‚£æ ·å¼ºåˆ¶å°è£…ã€‚ä¸è¿‡ï¼Œå½“ä½ ç¡®å®éœ€è¦å¯¹å±æ€§çš„è¯»å†™è¿›è¡Œæ§åˆ¶æ—¶ï¼ˆæ¯”å¦‚æ•°æ®æ ¡éªŒã€æ ¼å¼è½¬æ¢ã€æ—¥å¿—è®°å½•ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>@property</code> è£…é¥°å™¨æ¥å®ç°ç±»ä¼¼ä¼ ç»Ÿ getter/setter çš„åŠŸèƒ½ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ç†è§£ dataclass ä¸­å±æ€§è®¿é—®çš„æœºåˆ¶ï¼Œå¹¶é€šè¿‡å®é™…ä»£ç ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä¼˜é›…åœ°å®ç°è‡ªå®šä¹‰ getter å’Œ setterã€‚</p>
<hr/>
<h3 data-id="heading-1">1. é»˜è®¤è¡Œä¸ºï¼šç›´æ¥è®¿é—®å±æ€§</h3>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æœ€ç®€å•çš„ dataclass æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    name: <span class="hljs-built_in">str</span>
    age: <span class="hljs-built_in">int</span>

<span class="hljs-comment"># åˆ›å»ºå®ä¾‹</span>
p = Person(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">30</span>)

<span class="hljs-comment"># ç›´æ¥è¯»å–ï¼ˆç›¸å½“äº getterï¼‰</span>
<span class="hljs-built_in">print</span>(p.name)  <span class="hljs-comment"># è¾“å‡º: Alice</span>

<span class="hljs-comment"># ç›´æ¥èµ‹å€¼ï¼ˆç›¸å½“äº setterï¼‰</span>
p.age = <span class="hljs-number">31</span>
<span class="hljs-built_in">print</span>(p.age)   <span class="hljs-comment"># è¾“å‡º: 31</span>
</code></pre>
<p>åœ¨ Python ä¸­ï¼Œ<strong>ç›´æ¥è®¿é—®å±æ€§æ˜¯æƒ¯ç”¨åšæ³•</strong>ã€‚è¿™ä¸ä»…ç®€æ´ï¼Œè€Œä¸”æ€§èƒ½æ›´å¥½ã€‚PEP 8 å’Œ Python ç¤¾åŒºæ™®éè®¤ä¸ºï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™ä¸éœ€è¦ä¸ºæ¯ä¸ªå­—æ®µéƒ½å†™ getter/setter æ–¹æ³•ã€‚</p>
<hr/>
<h3 data-id="heading-2">2. ä½•æ—¶éœ€è¦è‡ªå®šä¹‰ getter/setterï¼Ÿ</h3>
<p>è™½ç„¶ç›´æ¥è®¿é—®æ˜¯æ¨èæ–¹å¼ï¼Œä½†åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ§åˆ¶å±æ€§çš„è¯»å†™è¡Œä¸ºï¼š</p>
<ul>
<li>å¯¹è¾“å…¥å€¼è¿›è¡ŒéªŒè¯ï¼ˆå¦‚å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°ï¼‰</li>
<li>è‡ªåŠ¨æ ¼å¼åŒ–æ•°æ®ï¼ˆå¦‚å§“åè½¬å¤§å†™ï¼‰</li>
<li>å®ç°åªè¯»å±æ€§</li>
<li>è§¦å‘å‰¯ä½œç”¨ï¼ˆå¦‚è®°å½•æ—¥å¿—ã€æ›´æ–°ç¼“å­˜ï¼‰</li>
</ul>
<p>è¿™æ—¶ï¼Œ<code>@property</code> å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<hr/>
<h3 data-id="heading-3">3. ä½¿ç”¨ <code>@property</code> å®ç°è‡ªå®šä¹‰ getter/setter</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å­—æ®µè®¾ä¸ºâ€œç§æœ‰â€ï¼ˆçº¦å®šä»¥ <code>_</code> å¼€å¤´ï¼‰ï¼Œç„¶åç”¨ <code>@property</code> æä¾›å—æ§çš„å…¬å…±æ¥å£ã€‚</p>
<h4 data-id="heading-4">ç¤ºä¾‹ï¼šå¸¦éªŒè¯å’Œæ ¼å¼åŒ–çš„ Person ç±»</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    _name: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># ç§æœ‰å­—æ®µï¼Œä¸ç›´æ¥æš´éœ²ç»™ç”¨æˆ·</span>
    _age: <span class="hljs-built_in">int</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""Getterï¼šè¿”å›å¤§å†™æ ¼å¼çš„å§“å"""</span>
        <span class="hljs-keyword">return</span> self._name.upper()

<span class="hljs-meta">    @name.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self, value: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""Setterï¼šç¡®ä¿å§“åéç©º"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> value <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> value.strip():
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"å§“åä¸èƒ½ä¸ºç©º"</span>)
        self._name = value.strip()

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">age</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""Getterï¼šç›´æ¥è¿”å›å¹´é¾„"""</span>
        <span class="hljs-keyword">return</span> self._age

<span class="hljs-meta">    @age.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">age</span>(<span class="hljs-params">self, value: <span class="hljs-built_in">int</span></span>):
        <span class="hljs-string">"""Setterï¼šç¡®ä¿å¹´é¾„åˆæ³•"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">int</span>) <span class="hljs-keyword">or</span> value &lt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"å¹´é¾„å¿…é¡»æ˜¯éè´Ÿæ•´æ•°"</span>)
        self._age = value

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
p = Person(<span class="hljs-string">"alice"</span>, <span class="hljs-number">25</span>)
<span class="hljs-built_in">print</span>(p.name)  <span class="hljs-comment"># è¾“å‡º: ALICE</span>
<span class="hljs-built_in">print</span>(p.age)   <span class="hljs-comment"># è¾“å‡º: 25</span>

p.name = <span class="hljs-string">"bob"</span>
p.age = <span class="hljs-number">30</span>
<span class="hljs-built_in">print</span>(p.name)  <span class="hljs-comment"># è¾“å‡º: BOB</span>

<span class="hljs-comment"># å°è¯•éæ³•èµ‹å€¼</span>
<span class="hljs-comment"># p.age = -5  # æŠ›å‡º ValueError</span>
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šç”±äºæˆ‘ä»¬ä½¿ç”¨äº† <code>_name</code> å’Œ <code>_age</code> ä½œä¸º dataclass å­—æ®µï¼Œå®ƒä»¬ä»ç„¶ä¼šå‡ºç°åœ¨ <code>__init__</code> ä¸­ã€‚è¿™æ„å‘³ç€ç”¨æˆ·åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä»éœ€ä¼ å…¥è¿™äº›â€œç§æœ‰â€å­—æ®µã€‚è¿™æ˜¯ dataclass çš„ç‰¹æ€§ï¼Œä¹Ÿæ˜¯åˆç†çš„â€”â€”åˆå§‹åŒ–æ—¶çš„æ•°æ®åº”ç”±è°ƒç”¨è€…è´Ÿè´£åˆæ³•æ€§ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">4. åªè¯»å±æ€§ï¼šåªæœ‰ getterï¼Œæ²¡æœ‰ setter</h3>
<p>å¦‚æœä½ å¸Œæœ›æŸä¸ªå­—æ®µåœ¨åˆå§‹åŒ–åä¸å¯ä¿®æ”¹ï¼Œå¯ä»¥åªå®šä¹‰ <code>@property</code> è€Œä¸æä¾› setterï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:
    _<span class="hljs-built_in">id</span>: <span class="hljs-built_in">str</span>
    name: <span class="hljs-built_in">str</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">id</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">return</span> self._<span class="hljs-built_in">id</span>

<span class="hljs-comment"># ä½¿ç”¨</span>
u = User(<span class="hljs-string">"12345"</span>, <span class="hljs-string">"Charlie"</span>)
<span class="hljs-built_in">print</span>(u.<span class="hljs-built_in">id</span>)      <span class="hljs-comment"># æ­£å¸¸è¯»å–</span>
<span class="hljs-comment"># u.id = "67890" # æŠ¥é”™: AttributeError: can't set attribute</span>
</code></pre>
<p>è¿™æ ·å°±å®ç°äº†çœŸæ­£çš„åªè¯»å±æ€§ã€‚</p>
<hr/>
<h3 data-id="heading-6">5. åˆå§‹åŒ–åå¤„ç†ï¼š<code>__post_init__</code></h3>
<p>æœ‰æ—¶ä½ åªæƒ³åœ¨å¯¹è±¡åˆ›å»ºååšä¸€æ¬¡æ ¡éªŒæˆ–è½¬æ¢ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡è®¿é—®éƒ½æ§åˆ¶ã€‚è¿™æ—¶å¯ä»¥ç”¨ <code>__post_init__</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclasses.dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span>:
    name: <span class="hljs-built_in">str</span>
    price: <span class="hljs-built_in">float</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__post_init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">if</span> self.price &lt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°"</span>)

<span class="hljs-comment"># ä½¿ç”¨</span>
p = Product(<span class="hljs-string">"Laptop"</span>, <span class="hljs-number">999.99</span>)  <span class="hljs-comment"># æ­£å¸¸</span>
<span class="hljs-comment"># p = Product("Phone", -100)   # æŠ›å‡ºå¼‚å¸¸</span>
</code></pre>
<p>è¿™ç§æ–¹å¼é€‚åˆä¸€æ¬¡æ€§æ ¡éªŒï¼Œä½†æ— æ³•é˜²æ­¢åç»­å¯¹ <code>price</code> çš„éæ³•èµ‹å€¼ã€‚å¦‚æœéœ€è¦æŒç»­ä¿æŠ¤ï¼Œè¿˜æ˜¯å¾—ç”¨ <code>@property</code>ã€‚</p>
<hr/>
<h3 data-id="heading-7">6. æœ€ä½³å®è·µå»ºè®®</h3>





























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èåšæ³•</th></tr></thead><tbody><tr><td>æ™®é€šæ•°æ®å­˜å‚¨</td><td>ç›´æ¥ä½¿ç”¨ dataclass å­—æ®µï¼Œæ— éœ€ getter/setter</td></tr><tr><td>éœ€è¦éªŒè¯æˆ–è½¬æ¢</td><td>ä½¿ç”¨ <code>@property</code> + ç§æœ‰å­—æ®µ</td></tr><tr><td>åªè¯»å±æ€§</td><td>ä»…å®šä¹‰ <code>@property</code>ï¼Œä¸æä¾› setter</td></tr><tr><td>åˆå§‹åŒ–æ ¡éªŒ</td><td>ä½¿ç”¨ <code>__post_init__</code></td></tr><tr><td>é¿å…</td><td>æ‰‹åŠ¨ç¼–å†™ <code>get_name()</code> / <code>set_name()</code> æ–¹æ³•ï¼ˆè¿èƒŒ Python é£æ ¼ï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">ç»“è¯­</h3>
<p>Python çš„ <code>dataclass</code> å¹¶ä¸è‡ªåŠ¨ç”Ÿæˆä¼ ç»Ÿçš„ getter å’Œ setterï¼Œä½†è¿™æ°æ°ä½“ç°äº† Python â€œæ˜¾å¼ä¼˜äºéšå¼â€ã€â€œç®€å•ä¼˜äºå¤æ‚â€çš„è®¾è®¡å“²å­¦ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç›´æ¥è®¿é—®å±æ€§å°±è¶³å¤Ÿäº†ï¼›å½“éœ€è¦é¢å¤–é€»è¾‘æ—¶ï¼Œ<code>@property</code> æä¾›äº†å¼ºå¤§è€Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚<strong>æ¯•ç«Ÿæˆ‘ä»¬éƒ½æ˜¯æˆå¹´äººâ€ï¼ˆ<em>Weâ€™re all consenting adults here</em>ï¼‰</strong></p>
<p>è®°ä½ï¼š<strong>ä¸è¦ä¸ºäº†å°è£…è€Œå°è£…</strong>ã€‚åªæœ‰åœ¨çœŸæ­£éœ€è¦æ§åˆ¶å±æ€§è®¿é—®è¡Œä¸ºæ—¶ï¼Œæ‰å¼•å…¥ getter/setterã€‚</p>
<hr/>
<p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpeps.python.org%2Fpep-0557%2F" target="_blank" title="https://peps.python.org/pep-0557/" ref="nofollow noopener noreferrer">PEP 557 â€“ Data Classes</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Ffunctions.html%23property" target="_blank" title="https://docs.python.org/3/library/functions.html#property" ref="nofollow noopener noreferrer">Python Property Documentation</a></li>
</ul>
<p>å¦‚æœä½ æœ‰æ›´å¤æ‚çš„å±æ€§ç®¡ç†éœ€æ±‚ï¼ˆæ¯”å¦‚åŠ¨æ€è®¡ç®—å­—æ®µã€ä¾èµ–æ³¨å…¥ç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ç»“åˆ <code>pydantic</code> æˆ– <code>attrs</code> ç­‰ç¬¬ä¸‰æ–¹åº“ã€‚ä½†å¯¹å¤§å¤šæ•°åœºæ™¯æ¥è¯´ï¼Œ<code>dataclass + property</code> å·²ç»è¶³å¤Ÿå¼ºå¤§ä¸”æ¸…æ™°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringåŠ¨æ€ä»£ç†è¯¦è§£]]></title>    <link>https://juejin.cn/post/7575438636332449843</link>    <guid>https://juejin.cn/post/7575438636332449843</guid>    <pubDate>2025-11-24T02:35:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575438636332449843" data-draft-id="7575367791274229798" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringåŠ¨æ€ä»£ç†è¯¦è§£"/> <meta itemprop="keywords" content="Spring,Java"/> <meta itemprop="datePublished" content="2025-11-24T02:35:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringåŠ¨æ€ä»£ç†è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:35:47.000Z" title="Mon Nov 24 2025 02:35:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SpringåŠ¨æ€ä»£ç†è¯¦è§£ï¼šä»åŸç†åˆ°å®æˆ˜</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åŠ¨æ€ä»£ç†æ˜¯Springæ¡†æ¶å®ç°AOPã€äº‹åŠ¡ç®¡ç†ã€å£°æ˜å¼ç¼“å­˜ç­‰æ ¸å¿ƒåŠŸèƒ½çš„åŸºçŸ³ã€‚ç†è§£åŠ¨æ€ä»£ç†çš„åŸç†å’Œä½¿ç”¨æ–¹å¼ï¼Œå¯¹äºæ·±å…¥æŒæ¡Springæ¡†æ¶è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†ä»ä»£ç†æ¨¡å¼çš„åŸºæœ¬æ¦‚å¿µå‡ºå‘ï¼Œè¯¦ç»†è®²è§£JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„å®ç°åŸç†ï¼Œä»¥åŠSpringå¦‚ä½•é€‰æ‹©å’Œä½¿ç”¨è¿™ä¸¤ç§ä»£ç†æ–¹å¼ã€‚</p>
<h3 data-id="heading-2">ä¸€ã€ä»£ç†æ¨¡å¼æ¦‚è¿°</h3>
<h4 data-id="heading-3">1.1 ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼</h4>
<p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¸ºç›®æ ‡å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">ä»£ç†æ¨¡å¼ç»“æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-built_in">Client</span>ï¼ˆå®¢æˆ·ç«¯ï¼‰                        â”‚
â”‚     â”‚                                    â”‚
â”‚     â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚   Proxy   â”‚ â† ä»£ç†å¯¹è±¡                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚        â”‚                                 â”‚
â”‚   ä»£ç†é€»è¾‘ï¼š                             â”‚
â”‚   - å‰ç½®å¤„ç†ï¼ˆæ—¥å¿—ã€æƒé™ç­‰ï¼‰             â”‚
â”‚   - è°ƒç”¨ç›®æ ‡æ–¹æ³•                         â”‚
â”‚   - åç½®å¤„ç†ï¼ˆç»“æœå¤„ç†ç­‰ï¼‰               â”‚
â”‚        â”‚                                 â”‚
â”‚        â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Target   â”‚ â† ç›®æ ‡å¯¹è±¡                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-4">1.2 é™æ€ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ¥å£
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {
    User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span>;
}

<span class="hljs-comment">/**
 * ç›®æ ‡ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç”¨æˆ·: "</span> + id);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(id, <span class="hljs-string">"User"</span> + id);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> {
        System.out.println(<span class="hljs-string">"ä¿å­˜ç”¨æˆ·: "</span> + user.getUsername());
    }
}

<span class="hljs-comment">/**
 * é™æ€ä»£ç†ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-keyword">private</span> UserService target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserServiceProxy</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// å‰ç½®å¢å¼º</span>
        System.out.println(<span class="hljs-string">"[é™æ€ä»£ç†] æ–¹æ³•å¼€å§‹: findById"</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-comment">// è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> target.findById(id);

        <span class="hljs-comment">// åç½®å¢å¼º</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        System.out.println(<span class="hljs-string">"[é™æ€ä»£ç†] æ–¹æ³•ç»“æŸï¼Œè€—æ—¶: "</span> + (endTime - startTime) + <span class="hljs-string">"ms"</span>);

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> {
        System.out.println(<span class="hljs-string">"[é™æ€ä»£ç†] æ–¹æ³•å¼€å§‹: save"</span>);
        target.save(user);
        System.out.println(<span class="hljs-string">"[é™æ€ä»£ç†] æ–¹æ³•ç»“æŸ"</span>);
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨é™æ€ä»£ç†
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();

        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceProxy</span>(target);

        <span class="hljs-comment">// é€šè¿‡ä»£ç†è°ƒç”¨</span>
        proxy.findById(<span class="hljs-number">1L</span>);
        proxy.save(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">"å¼ ä¸‰"</span>));
    }
}
</code></pre>
<p><strong>é™æ€ä»£ç†çš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªç›®æ ‡ç±»éƒ½éœ€è¦ä¸€ä¸ªä»£ç†ç±»</li>
<li>æ¥å£å¢åŠ æ–¹æ³•ï¼Œä»£ç†ç±»ä¹Ÿè¦ä¿®æ”¹</li>
<li>ä»£ç é‡å¤ï¼Œç»´æŠ¤å›°éš¾</li>
</ul>
<h4 data-id="heading-5">1.3 åŠ¨æ€ä»£ç†</h4>
<p>åŠ¨æ€ä»£ç†åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä»£ç†ç±»ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ä»£ç†ç±»ä»£ç ã€‚</p>
<pre><code class="hljs">é™æ€ä»£ç† vs åŠ¨æ€ä»£ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é™æ€ä»£ç†            â”‚  åŠ¨æ€ä»£ç†             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¼–è¯‘æ—¶åˆ›å»ºä»£ç†ç±»    â”‚  è¿è¡Œæ—¶åˆ›å»ºä»£ç†ç±»      â”‚
â”‚  æ‰‹åŠ¨ç¼–å†™ä»£ç†ç±»      â”‚  è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»        â”‚
â”‚  æ¯ä¸ªç±»ä¸€ä¸ªä»£ç†      â”‚  ä¸€å¥—ä»£ç†é€»è¾‘å¤ç”¨      â”‚
â”‚  ç»´æŠ¤å›°éš¾            â”‚  çµæ´»æ˜“æ‰©å±•           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-6">äºŒã€JDKåŠ¨æ€ä»£ç†</h3>
<h4 data-id="heading-7">2.1 JDKåŠ¨æ€ä»£ç†åŸç†</h4>
<p>JDKåŠ¨æ€ä»£ç†åŸºäºæ¥å£å®ç°ï¼Œé€šè¿‡<code>java.lang.reflect.Proxy</code>ç±»å’Œ<code>InvocationHandler</code>æ¥å£æ¥åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">JDKåŠ¨æ€ä»£ç†åŸç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-number">1</span>. è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ï¼ˆ<span class="hljs-variable">$Proxy0</span>ï¼‰          â”‚
â”‚  <span class="hljs-number">2</span>. ä»£ç†ç±»å®ç°ç›®æ ‡æ¥å£                   â”‚
â”‚  <span class="hljs-number">3</span>. ä»£ç†ç±»æŒæœ‰InvocationHandlerå¼•ç”¨      â”‚
â”‚  <span class="hljs-number">4</span>. è°ƒç”¨ä»£ç†æ–¹æ³•æ—¶ï¼Œè½¬å‘ç»™InvocationHandler
â”‚  <span class="hljs-number">5</span>. InvocationHandlerä¸­è°ƒç”¨ç›®æ ‡æ–¹æ³•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Interface    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
â”‚<span class="hljs-variable">$Proxy0</span>  â”‚      â”‚  Target   â”‚
â”‚(ä»£ç†ç±») â”‚      â”‚ (ç›®æ ‡ç±»)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚InvocationHandlerâ”‚
â”‚ (è°ƒç”¨å¤„ç†å™¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-8">2.2 JDKåŠ¨æ€ä»£ç†å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è‡ªå®šä¹‰InvocationHandler
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LogInvocationHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// è·å–æ–¹æ³•ä¿¡æ¯</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> target.getClass().getSimpleName();

        <span class="hljs-comment">// å‰ç½®å¢å¼º</span>
        System.out.println(<span class="hljs-string">"[JDKä»£ç†] "</span> + className + <span class="hljs-string">"."</span> + methodName + <span class="hljs-string">"() å¼€å§‹æ‰§è¡Œ"</span>);
        System.out.println(<span class="hljs-string">"[JDKä»£ç†] å‚æ•°: "</span> + Arrays.toString(args));
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        Object result;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
            result = method.invoke(target, args);

            <span class="hljs-comment">// åç½®å¢å¼º</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            System.out.println(<span class="hljs-string">"[JDKä»£ç†] è¿”å›å€¼: "</span> + result);
            System.out.println(<span class="hljs-string">"[JDKä»£ç†] æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶: "</span> + (endTime - startTime) + <span class="hljs-string">"ms"</span>);

        } <span class="hljs-keyword">catch</span> (InvocationTargetException e) {
            <span class="hljs-comment">// å¼‚å¸¸å¢å¼º</span>
            System.out.println(<span class="hljs-string">"[JDKä»£ç†] æ‰§è¡Œå¼‚å¸¸: "</span> + e.getTargetException().getMessage());
            <span class="hljs-keyword">throw</span> e.getTargetException();
        }

        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">/**
 * JDKåŠ¨æ€ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkProxyFactory</span> {

    <span class="hljs-comment">/**
     * åˆ›å»ºä»£ç†å¯¹è±¡
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),    <span class="hljs-comment">// ç±»åŠ è½½å™¨</span>
            target.getClass().getInterfaces(),     <span class="hljs-comment">// ç›®æ ‡ç±»å®ç°çš„æ¥å£</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogInvocationHandler</span>(target)       <span class="hljs-comment">// è°ƒç”¨å¤„ç†å™¨</span>
        );
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨JDKåŠ¨æ€ä»£ç†
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();

        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> JdkProxyFactory.createProxy(target);

        <span class="hljs-comment">// é€šè¿‡ä»£ç†è°ƒç”¨</span>
        proxy.findById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"---"</span>);
        proxy.save(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">"æå››"</span>));

        <span class="hljs-comment">// æ‰“å°ä»£ç†ç±»ä¿¡æ¯</span>
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»: "</span> + proxy.getClass().getName());
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»å®ç°çš„æ¥å£: "</span> + Arrays.toString(proxy.getClass().getInterfaces()));
    }
}
</code></pre>
<h4 data-id="heading-9">2.3 ç”Ÿæˆçš„ä»£ç†ç±»åˆ†æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * JDKåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ï¼ˆåç¼–è¯‘ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">$Proxy0</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m1;  <span class="hljs-comment">// equals</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m2;  <span class="hljs-comment">// toString</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m3;  <span class="hljs-comment">// findById</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m4;  <span class="hljs-comment">// save</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m0;  <span class="hljs-comment">// hashCode</span>

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            m3 = Class.forName(<span class="hljs-string">"com.example.UserService"</span>)
                .getMethod(<span class="hljs-string">"findById"</span>, Long.class);
            m4 = Class.forName(<span class="hljs-string">"com.example.UserService"</span>)
                .getMethod(<span class="hljs-string">"save"</span>, User.class);
            <span class="hljs-comment">// ...</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchMethodError</span>(e.getMessage());
        }
    }

    <span class="hljs-keyword">public</span> $Proxy0(InvocationHandler h) {
        <span class="hljs-built_in">super</span>(h);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨InvocationHandlerçš„invokeæ–¹æ³•</span>
            <span class="hljs-keyword">return</span> (User) <span class="hljs-built_in">super</span>.h.invoke(<span class="hljs-built_in">this</span>, m3, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{id});
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(e);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">super</span>.h.invoke(<span class="hljs-built_in">this</span>, m4, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{user});
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(e);
        }
    }
}
</code></pre>
<h4 data-id="heading-10">2.4 JDKä»£ç†çš„é™åˆ¶</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * JDKåŠ¨æ€ä»£ç†çš„é™åˆ¶
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkProxyLimitation</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// âŒ é”™è¯¯ï¼šç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();

        <span class="hljs-comment">// ä»¥ä¸‹ä»£ç ä¼šæŠ›å‡ºå¼‚å¸¸</span>
        <span class="hljs-comment">// OrderService proxy = JdkProxyFactory.createProxy(orderService);</span>
        <span class="hljs-comment">// å› ä¸ºOrderServiceæ²¡æœ‰å®ç°ä»»ä½•æ¥å£</span>

        System.out.println(<span class="hljs-string">"JDKåŠ¨æ€ä»£ç†è¦æ±‚ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£"</span>);
    }
}

<span class="hljs-comment">/**
 * æ²¡æœ‰å®ç°æ¥å£çš„ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"åˆ›å»ºè®¢å•"</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">ä¸‰ã€CGLIBåŠ¨æ€ä»£ç†</h3>
<h4 data-id="heading-12">3.1 CGLIBä»£ç†åŸç†</h4>
<p>CGLIBï¼ˆCode Generation Libraryï¼‰é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»çš„æ–¹å¼åˆ›å»ºä»£ç†ï¼Œä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚</p>
<pre><code class="hljs language-php" lang="php">CGLIBä»£ç†åŸç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-number">1</span>. è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ï¼ˆç»§æ‰¿ç›®æ ‡ç±»ï¼‰       â”‚
â”‚  <span class="hljs-number">2</span>. é€šè¿‡ASMå­—èŠ‚ç æ“ä½œç”Ÿæˆå­ç±»           â”‚
â”‚  <span class="hljs-number">3</span>. ä»£ç†ç±»é‡å†™çˆ¶ç±»çš„é<span class="hljs-keyword">final</span>æ–¹æ³•          â”‚
â”‚  <span class="hljs-number">4</span>. æ–¹æ³•è°ƒç”¨æ—¶ï¼Œé€šè¿‡MethodInterceptoræ‹¦æˆªâ”‚
â”‚  <span class="hljs-number">5</span>. MethodInterceptorä¸­è°ƒç”¨çˆ¶ç±»æ–¹æ³•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Target       â”‚
â”‚  (ç›®æ ‡ç±»)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ <span class="hljs-keyword">extends</span>
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Target<span class="hljs-variable">$$CGLIB</span> â”‚
â”‚  (ä»£ç†ç±»)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚MethodInterceptorâ”‚
â”‚  (æ–¹æ³•æ‹¦æˆªå™¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-13">3.2 CGLIBä»£ç†å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è‡ªå®šä¹‰MethodInterceptor
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogMethodInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> obj       ä»£ç†å¯¹è±¡
     * <span class="hljs-doctag">@param</span> method    ç›®æ ‡æ–¹æ³•
     * <span class="hljs-doctag">@param</span> args      æ–¹æ³•å‚æ•°
     * <span class="hljs-doctag">@param</span> proxy     æ–¹æ³•ä»£ç†
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                           MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {

        <span class="hljs-comment">// è·å–æ–¹æ³•ä¿¡æ¯</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> method.getDeclaringClass().getSimpleName();

        <span class="hljs-comment">// å‰ç½®å¢å¼º</span>
        System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] "</span> + className + <span class="hljs-string">"."</span> + methodName + <span class="hljs-string">"() å¼€å§‹æ‰§è¡Œ"</span>);
        System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] å‚æ•°: "</span> + Arrays.toString(args));
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        Object result;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼ˆç›®æ ‡æ–¹æ³•ï¼‰</span>
            result = proxy.invokeSuper(obj, args);

            <span class="hljs-comment">// åç½®å¢å¼º</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] è¿”å›å€¼: "</span> + result);
            System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶: "</span> + (endTime - startTime) + <span class="hljs-string">"ms"</span>);

        } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-comment">// å¼‚å¸¸å¢å¼º</span>
            System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] æ‰§è¡Œå¼‚å¸¸: "</span> + e.getMessage());
            <span class="hljs-keyword">throw</span> e;
        }

        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">/**
 * CGLIBä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyFactory</span> {

    <span class="hljs-comment">/**
     * åˆ›å»ºä»£ç†å¯¹è±¡
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Class&lt;T&gt; targetClass)</span> {
        <span class="hljs-comment">// åˆ›å»ºEnhancerå¯¹è±¡</span>
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();

        <span class="hljs-comment">// è®¾ç½®çˆ¶ç±»ï¼ˆç›®æ ‡ç±»ï¼‰</span>
        enhancer.setSuperclass(targetClass);

        <span class="hljs-comment">// è®¾ç½®å›è°ƒï¼ˆæ–¹æ³•æ‹¦æˆªå™¨ï¼‰</span>
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LogMethodInterceptor</span>());

        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="hljs-keyword">return</span> (T) enhancer.create();
    }

    <span class="hljs-comment">/**
     * å¸¦æ„é€ å‚æ•°åˆ›å»ºä»£ç†å¯¹è±¡
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Class&lt;T&gt; targetClass,
                                    Class&lt;?&gt;[] argTypes, Object[] args)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(targetClass);
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LogMethodInterceptor</span>());

        <span class="hljs-keyword">return</span> (T) enhancer.create(argTypes, args);
    }
}

<span class="hljs-comment">/**
 * ç›®æ ‡ç±»ï¼ˆæ²¡æœ‰å®ç°æ¥å£ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, BigDecimal amount)</span> {
        System.out.println(<span class="hljs-string">"åˆ›å»ºè®¢å•: ç”¨æˆ·="</span> + userId + <span class="hljs-string">", é‡‘é¢="</span> + amount);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(System.currentTimeMillis(), userId, amount);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(Long orderId)</span> {
        System.out.println(<span class="hljs-string">"å–æ¶ˆè®¢å•: "</span> + orderId);
    }

    <span class="hljs-comment">// finalæ–¹æ³•ä¸èƒ½è¢«ä»£ç†</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finalMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"è¿™æ˜¯finalæ–¹æ³•ï¼Œä¸èƒ½è¢«ä»£ç†"</span>);
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨CGLIBä»£ç†
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆæ— éœ€ç›®æ ‡å¯¹è±¡å®ä¾‹ï¼‰</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> CglibProxyFactory.createProxy(OrderService.class);

        <span class="hljs-comment">// é€šè¿‡ä»£ç†è°ƒç”¨</span>
        proxy.createOrder(<span class="hljs-number">1L</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"99.99"</span>));
        System.out.println(<span class="hljs-string">"---"</span>);
        proxy.cancelOrder(<span class="hljs-number">1001L</span>);
        System.out.println(<span class="hljs-string">"---"</span>);

        <span class="hljs-comment">// finalæ–¹æ³•ä¸ä¼šè¢«ä»£ç†</span>
        proxy.finalMethod();

        <span class="hljs-comment">// æ‰“å°ä»£ç†ç±»ä¿¡æ¯</span>
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»: "</span> + proxy.getClass().getName());
        System.out.println(<span class="hljs-string">"çˆ¶ç±»: "</span> + proxy.getClass().getSuperclass().getName());
    }
}
</code></pre>
<h4 data-id="heading-14">3.3 CGLIBçš„é«˜çº§ç”¨æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¤šä¸ªå›è°ƒï¼ˆCallbackFilterï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiCallbackDemo</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(OrderService.class);

        <span class="hljs-comment">// å®šä¹‰å¤šä¸ªå›è°ƒ</span>
        Callback[] callbacks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>[]{
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogMethodInterceptor</span>(),           <span class="hljs-comment">// ç´¢å¼•0ï¼šæ—¥å¿—æ‹¦æˆªå™¨</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceMethodInterceptor</span>(),   <span class="hljs-comment">// ç´¢å¼•1ï¼šæ€§èƒ½æ‹¦æˆªå™¨</span>
            NoOp.INSTANCE                         <span class="hljs-comment">// ç´¢å¼•2ï¼šä¸åšä»»ä½•æ“ä½œ</span>
        };

        enhancer.setCallbacks(callbacks);

        <span class="hljs-comment">// å›è°ƒè¿‡æ»¤å™¨ï¼šå†³å®šæ¯ä¸ªæ–¹æ³•ä½¿ç”¨å“ªä¸ªå›è°ƒ</span>
        enhancer.setCallbackFilter(method -&gt; {
            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();

            <span class="hljs-keyword">if</span> (methodName.startsWith(<span class="hljs-string">"create"</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// ä½¿ç”¨æ—¥å¿—æ‹¦æˆªå™¨</span>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (methodName.startsWith(<span class="hljs-string">"find"</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// ä½¿ç”¨æ€§èƒ½æ‹¦æˆªå™¨</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;  <span class="hljs-comment">// ä¸æ‹¦æˆª</span>
            }
        });

        <span class="hljs-type">OrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (OrderService) enhancer.create();
        proxy.createOrder(<span class="hljs-number">1L</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>));
    }
}

<span class="hljs-comment">/**
 * æ€§èƒ½ç›‘æ§æ‹¦æˆªå™¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceMethodInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                           MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> proxy.invokeSuper(obj, args);

        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
        System.out.println(<span class="hljs-string">"[æ€§èƒ½ç›‘æ§] "</span> + method.getName() + <span class="hljs-string">" è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);

        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">/**
 * å»¶è¿ŸåŠ è½½ï¼ˆLazyLoaderï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyLoadDemo</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(HeavyObject.class);

        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½å›è°ƒ</span>
        enhancer.setCallback((LazyLoader) () -&gt; {
            System.out.println(<span class="hljs-string">"å¼€å§‹åˆ›å»ºHeavyObject..."</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeavyObject</span>();
        });

        <span class="hljs-type">HeavyObject</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (HeavyObject) enhancer.create();
        System.out.println(<span class="hljs-string">"ä»£ç†å¯¹è±¡å·²åˆ›å»ºï¼Œä½†ç›®æ ‡å¯¹è±¡å°šæœªåˆ›å»º"</span>);

        <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨æ–¹æ³•æ—¶æ‰åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        proxy.doSomething();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HeavyObject</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HeavyObject</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶åˆå§‹åŒ–</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"HeavyObject.doSomething()"</span>);
    }
}
</code></pre>
<h4 data-id="heading-15">3.4 CGLIBçš„é™åˆ¶</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * CGLIBä»£ç†çš„é™åˆ¶
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibLimitation</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// âŒ é™åˆ¶1ï¼šä¸èƒ½ä»£ç†finalç±»</span>
        <span class="hljs-comment">// FinalClass proxy = CglibProxyFactory.createProxy(FinalClass.class);</span>
        <span class="hljs-comment">// ä¼šæŠ›å‡ºå¼‚å¸¸ï¼šCannot subclass final class</span>

        <span class="hljs-comment">// âŒ é™åˆ¶2ï¼šä¸èƒ½ä»£ç†finalæ–¹æ³•</span>
        <span class="hljs-comment">// finalæ–¹æ³•ä¸ä¼šè¢«æ‹¦æˆªï¼Œç›´æ¥è°ƒç”¨åŸæ–¹æ³•</span>

        <span class="hljs-comment">// âŒ é™åˆ¶3ï¼šä¸èƒ½ä»£ç†privateæ–¹æ³•</span>
        <span class="hljs-comment">// privateæ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿ï¼Œæ— æ³•ä»£ç†</span>
    }
}

<span class="hljs-comment">// finalç±»ä¸èƒ½è¢«CGLIBä»£ç†</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FinalClass</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"finalç±»çš„æ–¹æ³•"</span>);
    }
}
</code></pre>
<h3 data-id="heading-16">å››ã€Springä¸­çš„ä»£ç†é€‰æ‹©</h3>
<h4 data-id="heading-17">4.1 Springä»£ç†é€‰æ‹©ç­–ç•¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Springä»£ç†é€‰æ‹©ç­–ç•¥
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAspectJAutoProxy</span>  <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨JDKä»£ç†</span>
<span class="hljs-comment">// @EnableAspectJAutoProxy(proxyTargetClass = true)  // å¼ºåˆ¶ä½¿ç”¨CGLIB</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyConfig</span> {
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">Springä»£ç†é€‰æ‹©æµç¨‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›®æ ‡ç±»æ˜¯å¦å®ç°æ¥å£ï¼Ÿ                    â”‚
â”‚         â”‚                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                          â”‚
â”‚    â”‚         â”‚                          â”‚
â”‚   æ˜¯         å¦                          â”‚
â”‚    â”‚         â”‚                          â”‚
â”‚    â–¼         â–¼                          â”‚
â”‚  JDKä»£ç†   CGLIBä»£ç†                     â”‚
â”‚  (é»˜è®¤)    (è‡ªåŠ¨)                        â”‚
â”‚                                          â”‚
â”‚  <span class="hljs-attr">proxyTargetClass</span> = <span class="hljs-literal">true</span> ?              â”‚
â”‚    â†’ å¼ºåˆ¶ä½¿ç”¨CGLIBä»£ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-18">4.2 AopProxyFactoryæºç åˆ†æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Spring AOPä»£ç†å·¥å‚ï¼ˆç®€åŒ–ç‰ˆï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultAopProxyFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AopProxyFactory</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> AopProxy <span class="hljs-title function_">createAopProxy</span><span class="hljs-params">(AdvisedSupport config)</span> {
        <span class="hljs-comment">// åˆ¤æ–­ä½¿ç”¨å“ªç§ä»£ç†</span>
        <span class="hljs-keyword">if</span> (config.isOptimize() ||                    <span class="hljs-comment">// ä¼˜åŒ–æ¨¡å¼</span>
            config.isProxyTargetClass() ||           <span class="hljs-comment">// å¼ºåˆ¶CGLIB</span>
            hasNoUserSuppliedProxyInterfaces(config)) { <span class="hljs-comment">// æ²¡æœ‰æ¥å£</span>

            Class&lt;?&gt; targetClass = config.getTargetClass();

            <span class="hljs-keyword">if</span> (targetClass == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AopConfigException</span>(<span class="hljs-string">"..."</span>);
            }

            <span class="hljs-comment">// å¦‚æœæ˜¯æ¥å£æˆ–å·²ç»æ˜¯ä»£ç†ç±»ï¼Œä½¿ç”¨JDKä»£ç†</span>
            <span class="hljs-keyword">if</span> (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdkDynamicAopProxy</span>(config);
            }

            <span class="hljs-comment">// å¦åˆ™ä½¿ç”¨CGLIBä»£ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjenesisCglibAopProxy</span>(config);

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨JDKä»£ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdkDynamicAopProxy</span>(config);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNoUserSuppliedProxyInterfaces</span><span class="hljs-params">(AdvisedSupport config)</span> {
        Class&lt;?&gt;[] interfaces = config.getProxiedInterfaces();
        <span class="hljs-keyword">return</span> interfaces.length == <span class="hljs-number">0</span> ||
               (interfaces.length == <span class="hljs-number">1</span> &amp;&amp; SpringProxy.class.isAssignableFrom(interfaces[<span class="hljs-number">0</span>]));
    }
}
</code></pre>
<h4 data-id="heading-19">4.3 é…ç½®ä»£ç†æ–¹å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * XMLé…ç½®æ–¹å¼
 */</span>
<span class="hljs-comment">/*
&lt;aop:aspectj-autoproxy proxy-target-class="true"/&gt;
*/</span>

<span class="hljs-comment">/**
 * æ³¨è§£é…ç½®æ–¹å¼
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AopConfig</span> {
}

<span class="hljs-comment">/**
 * application.propertiesé…ç½®
 */</span>
<span class="hljs-comment">// spring.aop.proxy-target-class=true</span>

<span class="hljs-comment">/**
 * äº‹åŠ¡é…ç½®ä¸­æŒ‡å®šä»£ç†æ–¹å¼
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement(proxyTargetClass = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionConfig</span> {
}
</code></pre>
<h3 data-id="heading-20">äº”ã€å®æˆ˜æ¡ˆä¾‹</h3>
<h4 data-id="heading-21">5.1 æ¡ˆä¾‹1ï¼šé€šç”¨æ—¥å¿—ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é€šç”¨æ—¥å¿—ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UniversalLogProxyFactory</span> {

    <span class="hljs-comment">/**
     * åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆè‡ªåŠ¨é€‰æ‹©ä»£ç†æ–¹å¼ï¼‰
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        Class&lt;?&gt; targetClass = target.getClass();

        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰æ¥å£</span>
        <span class="hljs-keyword">if</span> (targetClass.getInterfaces().length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// ä½¿ç”¨JDKä»£ç†</span>
            <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(
                targetClass.getClassLoader(),
                targetClass.getInterfaces(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">UniversalLogHandler</span>(target)
            );
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ä½¿ç”¨CGLIBä»£ç†</span>
            <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
            enhancer.setSuperclass(targetClass);
            enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UniversalLogInterceptor</span>(target));
            <span class="hljs-keyword">return</span> (T) enhancer.create();
        }
    }
}

<span class="hljs-comment">/**
 * JDKä»£ç†å¤„ç†å™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UniversalLogHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UniversalLogHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> LogHelper.logAndInvoke(target, method, args, () -&gt; method.invoke(target, args));
    }
}

<span class="hljs-comment">/**
 * CGLIBæ–¹æ³•æ‹¦æˆªå™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UniversalLogInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UniversalLogInterceptor</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                           MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> LogHelper.logAndInvoke(target, method, args, () -&gt; proxy.invokeSuper(obj, args));
    }
}

<span class="hljs-comment">/**
 * æ—¥å¿—è¾…åŠ©ç±»
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LogHelper</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">logAndInvoke</span><span class="hljs-params">(Object target, Method method, Object[] args,
                                     Callable&lt;Object&gt; invoker)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> target.getClass().getSimpleName();
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();

        System.out.println(<span class="hljs-string">"â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>);
        System.out.println(<span class="hljs-string">"â”‚ æ–¹æ³•è°ƒç”¨: "</span> + className + <span class="hljs-string">"."</span> + methodName);
        System.out.println(<span class="hljs-string">"â”‚ å‚æ•°: "</span> + Arrays.toString(args));

        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invoker.call();

            <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
            System.out.println(<span class="hljs-string">"â”‚ è¿”å›å€¼: "</span> + result);
            System.out.println(<span class="hljs-string">"â”‚ è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);
            System.out.println(<span class="hljs-string">"â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>);

            <span class="hljs-keyword">return</span> result;

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"â”‚ å¼‚å¸¸: "</span> + e.getMessage());
            System.out.println(<span class="hljs-string">"â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>);
            <span class="hljs-keyword">throw</span> e;
        }
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UniversalProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// æœ‰æ¥å£çš„ç±» - ä½¿ç”¨JDKä»£ç†</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">userProxy</span> <span class="hljs-operator">=</span> UniversalLogProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>());
        userProxy.findById(<span class="hljs-number">1L</span>);

        System.out.println();

        <span class="hljs-comment">// æ— æ¥å£çš„ç±» - ä½¿ç”¨CGLIBä»£ç†</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderProxy</span> <span class="hljs-operator">=</span> UniversalLogProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>());
        orderProxy.createOrder(<span class="hljs-number">1L</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>));
    }
}
</code></pre>
<h4 data-id="heading-22">5.2 æ¡ˆä¾‹2ï¼šæ–¹æ³•æ‰§è¡Œé‡è¯•ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é‡è¯•æ³¨è§£
 */</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Retryable {
    <span class="hljs-type">int</span> <span class="hljs-title function_">maxAttempts</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">3</span>;           <span class="hljs-comment">// æœ€å¤§é‡è¯•æ¬¡æ•°</span>
    <span class="hljs-type">long</span> <span class="hljs-title function_">delay</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">1000</span>;             <span class="hljs-comment">// é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰</span>
    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt;[] value() <span class="hljs-keyword">default</span> {};  <span class="hljs-comment">// éœ€è¦é‡è¯•çš„å¼‚å¸¸</span>
}

<span class="hljs-comment">/**
 * é‡è¯•ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryProxyFactory</span> {

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        Class&lt;?&gt; targetClass = target.getClass();

        <span class="hljs-keyword">if</span> (targetClass.getInterfaces().length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(
                targetClass.getClassLoader(),
                targetClass.getInterfaces(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryHandler</span>(target)
            );
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
            enhancer.setSuperclass(targetClass);
            enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryInterceptor</span>(target));
            <span class="hljs-keyword">return</span> (T) enhancer.create();
        }
    }
}

<span class="hljs-comment">/**
 * JDKé‡è¯•å¤„ç†å™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RetryHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> RetryExecutor.executeWithRetry(target, method, args,
            () -&gt; method.invoke(target, args));
    }
}

<span class="hljs-comment">/**
 * CGLIBé‡è¯•æ‹¦æˆªå™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RetryInterceptor</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                           MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> RetryExecutor.executeWithRetry(target, method, args,
            () -&gt; proxy.invokeSuper(obj, args));
    }
}

<span class="hljs-comment">/**
 * é‡è¯•æ‰§è¡Œå™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryExecutor</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">executeWithRetry</span><span class="hljs-params">(Object target, Method method, Object[] args,
                                         Callable&lt;Object&gt; invoker)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// è·å–æ–¹æ³•ä¸Šçš„@Retryableæ³¨è§£</span>
        <span class="hljs-type">Method</span> <span class="hljs-variable">targetMethod</span> <span class="hljs-operator">=</span> target.getClass().getMethod(method.getName(), method.getParameterTypes());
        <span class="hljs-type">Retryable</span> <span class="hljs-variable">retryable</span> <span class="hljs-operator">=</span> targetMethod.getAnnotation(Retryable.class);

        <span class="hljs-keyword">if</span> (retryable == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ²¡æœ‰æ³¨è§£ï¼Œç›´æ¥æ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> invoker.call();
        }

        <span class="hljs-type">int</span> <span class="hljs-variable">maxAttempts</span> <span class="hljs-operator">=</span> retryable.maxAttempts();
        <span class="hljs-type">long</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> retryable.delay();
        Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt;[] retryExceptions = retryable.value();

        <span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">Throwable</span> <span class="hljs-variable">lastException</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">while</span> (attempt &lt; maxAttempts) {
            attempt++;
            <span class="hljs-keyword">try</span> {
                System.out.println(<span class="hljs-string">"[é‡è¯•ä»£ç†] ç¬¬"</span> + attempt + <span class="hljs-string">"æ¬¡å°è¯•æ‰§è¡Œ: "</span> + method.getName());
                <span class="hljs-keyword">return</span> invoker.call();

            } <span class="hljs-keyword">catch</span> (Throwable e) {
                <span class="hljs-type">Throwable</span> <span class="hljs-variable">cause</span> <span class="hljs-operator">=</span> e <span class="hljs-keyword">instanceof</span> InvocationTargetException
                    ? ((InvocationTargetException) e).getTargetException() : e;

                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦é‡è¯•</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">shouldRetry</span> <span class="hljs-operator">=</span> retryExceptions.length == <span class="hljs-number">0</span> ||
                    Arrays.stream(retryExceptions).anyMatch(ex -&gt; ex.isInstance(cause));

                <span class="hljs-keyword">if</span> (!shouldRetry || attempt &gt;= maxAttempts) {
                    System.out.println(<span class="hljs-string">"[é‡è¯•ä»£ç†] é‡è¯•å¤±è´¥: "</span> + cause.getMessage());
                    <span class="hljs-keyword">throw</span> cause;
                }

                lastException = cause;
                System.out.println(<span class="hljs-string">"[é‡è¯•ä»£ç†] æ‰§è¡Œå¤±è´¥ï¼Œ"</span> + delay + <span class="hljs-string">"msåé‡è¯•: "</span> + cause.getMessage());

                <span class="hljs-keyword">try</span> {
                    Thread.sleep(delay);
                } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">throw</span> cause;
                }
            }
        }

        <span class="hljs-keyword">throw</span> lastException;
    }
}

<span class="hljs-comment">/**
 * è¿œç¨‹æœåŠ¡ï¼ˆæ¼”ç¤ºé‡è¯•ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">callCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Retryable(maxAttempts = 3, delay = 500)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callRemoteApi</span><span class="hljs-params">(String param)</span> {
        callCount++;
        System.out.println(<span class="hljs-string">"è°ƒç”¨è¿œç¨‹APIï¼Œç¬¬"</span> + callCount + <span class="hljs-string">"æ¬¡"</span>);

        <span class="hljs-comment">// æ¨¡æ‹Ÿå¶å‘å¤±è´¥</span>
        <span class="hljs-keyword">if</span> (callCount &lt; <span class="hljs-number">3</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç½‘ç»œè¶…æ—¶"</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-string">"è°ƒç”¨æˆåŠŸ: "</span> + param;
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">RemoteService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> RetryProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteService</span>());

        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> proxy.callRemoteApi(<span class="hljs-string">"test"</span>);
        System.out.println(<span class="hljs-string">"æœ€ç»ˆç»“æœ: "</span> + result);
    }
}
</code></pre>
<h4 data-id="heading-23">5.3 æ¡ˆä¾‹3ï¼šç¼“å­˜ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ç¼“å­˜æ³¨è§£
 */</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Cacheable {
    String <span class="hljs-title function_">key</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">expire</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">3600</span>;  <span class="hljs-comment">// è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span>
}

<span class="hljs-comment">/**
 * ç¼“å­˜ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheProxyFactory</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, CacheEntry&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheInterceptor</span>(target));
        <span class="hljs-keyword">return</span> (T) enhancer.create();
    }

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheEntry</span> {
        Object value;
        <span class="hljs-type">long</span> expireTime;

        CacheEntry(Object value, <span class="hljs-type">int</span> expireSeconds) {
            <span class="hljs-built_in">this</span>.value = value;
            <span class="hljs-built_in">this</span>.expireTime = System.currentTimeMillis() + expireSeconds * <span class="hljs-number">1000L</span>;
        }

        <span class="hljs-type">boolean</span> <span class="hljs-title function_">isExpired</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> System.currentTimeMillis() &gt; expireTime;
        }
    }

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

        <span class="hljs-keyword">private</span> Object target;

        CacheInterceptor(Object target) {
            <span class="hljs-built_in">this</span>.target = target;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                               MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {

            <span class="hljs-comment">// è·å–@Cacheableæ³¨è§£</span>
            <span class="hljs-type">Method</span> <span class="hljs-variable">targetMethod</span> <span class="hljs-operator">=</span> target.getClass().getMethod(
                method.getName(), method.getParameterTypes());
            <span class="hljs-type">Cacheable</span> <span class="hljs-variable">cacheable</span> <span class="hljs-operator">=</span> targetMethod.getAnnotation(Cacheable.class);

            <span class="hljs-keyword">if</span> (cacheable == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> proxy.invokeSuper(obj, args);
            }

            <span class="hljs-comment">// æ„å»ºç¼“å­˜key</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> buildCacheKey(cacheable.key(), method, args);

            <span class="hljs-comment">// å°è¯•ä»ç¼“å­˜è·å–</span>
            <span class="hljs-type">CacheEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> cache.get(cacheKey);
            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span> &amp;&amp; !entry.isExpired()) {
                System.out.println(<span class="hljs-string">"[ç¼“å­˜ä»£ç†] ç¼“å­˜å‘½ä¸­: "</span> + cacheKey);
                <span class="hljs-keyword">return</span> entry.value;
            }

            <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡Œæ–¹æ³•</span>
            System.out.println(<span class="hljs-string">"[ç¼“å­˜ä»£ç†] ç¼“å­˜æœªå‘½ä¸­: "</span> + cacheKey);
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> proxy.invokeSuper(obj, args);

            <span class="hljs-comment">// å­˜å…¥ç¼“å­˜</span>
            <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) {
                cache.put(cacheKey, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntry</span>(result, cacheable.expire()));
                System.out.println(<span class="hljs-string">"[ç¼“å­˜ä»£ç†] ç¼“å­˜å†™å…¥: "</span> + cacheKey);
            }

            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-keyword">private</span> String <span class="hljs-title function_">buildCacheKey</span><span class="hljs-params">(String keyPattern, Method method, Object[] args)</span> {
            <span class="hljs-keyword">if</span> (keyPattern.isEmpty()) {
                <span class="hljs-comment">// é»˜è®¤keyï¼šç±»å.æ–¹æ³•å(å‚æ•°)</span>
                <span class="hljs-keyword">return</span> method.getDeclaringClass().getSimpleName() + <span class="hljs-string">"."</span> +
                       method.getName() + <span class="hljs-string">"("</span> + Arrays.toString(args) + <span class="hljs-string">")"</span>;
            }

            <span class="hljs-comment">// æ›¿æ¢å‚æ•°å ä½ç¬¦</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> keyPattern;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; args.length; i++) {
                key = key.replace(<span class="hljs-string">"#p"</span> + i, String.valueOf(args[i]));
            }
            <span class="hljs-keyword">return</span> key;
        }
    }
}

<span class="hljs-comment">/**
 * ç”¨æˆ·æœåŠ¡ï¼ˆå¸¦ç¼“å­˜ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CachedUserService</span> {

    <span class="hljs-meta">@Cacheable(key = "user:#p0", expire = 60)</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·: "</span> + id);
        <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">100</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(id, <span class="hljs-string">"User"</span> + id);
    }

    <span class="hljs-meta">@Cacheable(expire = 300)</span>
    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®åº“æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·"</span>);
        <span class="hljs-keyword">return</span> Arrays.asList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">"User1"</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2L</span>, <span class="hljs-string">"User2"</span>)
        );
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">CachedUserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> CacheProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CachedUserService</span>());

        <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œç¼“å­˜æœªå‘½ä¸­</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> proxy.findById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç»“æœ: "</span> + user1);

        System.out.println();

        <span class="hljs-comment">// ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œç¼“å­˜å‘½ä¸­</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> proxy.findById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç»“æœ: "</span> + user2);

        System.out.println();

        <span class="hljs-comment">// ä¸åŒå‚æ•°ï¼Œç¼“å­˜æœªå‘½ä¸­</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user3</span> <span class="hljs-operator">=</span> proxy.findById(<span class="hljs-number">2L</span>);
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç»“æœ: "</span> + user3);
    }
}
</code></pre>
<h4 data-id="heading-24">5.4 æ¡ˆä¾‹4ï¼šæƒé™æ ¡éªŒä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æƒé™æ³¨è§£
 */</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RequiresPermission {
    String[] value();
}

<span class="hljs-comment">/**
 * ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼ˆæ¨¡æ‹Ÿï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Set&lt;String&gt;&gt; permissions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPermissions</span><span class="hljs-params">(Set&lt;String&gt; perms)</span> {
        permissions.set(perms);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;String&gt; <span class="hljs-title function_">getPermissions</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> permissions.get();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPermission</span><span class="hljs-params">(String permission)</span> {
        Set&lt;String&gt; perms = permissions.get();
        <span class="hljs-keyword">return</span> perms != <span class="hljs-literal">null</span> &amp;&amp; perms.contains(permission);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        permissions.remove();
    }
}

<span class="hljs-comment">/**
 * æƒé™ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionProxyFactory</span> {

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PermissionInterceptor</span>(target));
        <span class="hljs-keyword">return</span> (T) enhancer.create();
    }

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

        <span class="hljs-keyword">private</span> Object target;

        PermissionInterceptor(Object target) {
            <span class="hljs-built_in">this</span>.target = target;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                               MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {

            <span class="hljs-comment">// è·å–@RequiresPermissionæ³¨è§£</span>
            <span class="hljs-type">Method</span> <span class="hljs-variable">targetMethod</span> <span class="hljs-operator">=</span> target.getClass().getMethod(
                method.getName(), method.getParameterTypes());
            <span class="hljs-type">RequiresPermission</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> targetMethod.getAnnotation(RequiresPermission.class);

            <span class="hljs-keyword">if</span> (annotation != <span class="hljs-literal">null</span>) {
                String[] required = annotation.value();

                <span class="hljs-comment">// æ£€æŸ¥æƒé™</span>
                <span class="hljs-keyword">for</span> (String permission : required) {
                    <span class="hljs-keyword">if</span> (!UserContext.hasPermission(permission)) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<span class="hljs-string">"ç¼ºå°‘æƒé™: "</span> + permission);
                    }
                }

                System.out.println(<span class="hljs-string">"[æƒé™ä»£ç†] æƒé™æ ¡éªŒé€šè¿‡: "</span> + Arrays.toString(required));
            }

            <span class="hljs-keyword">return</span> proxy.invokeSuper(obj, args);
        }
    }
}

<span class="hljs-comment">/**
 * ç®¡ç†æœåŠ¡
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminService</span> {

    <span class="hljs-meta">@RequiresPermission("user:delete")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long userId)</span> {
        System.out.println(<span class="hljs-string">"åˆ é™¤ç”¨æˆ·: "</span> + userId);
    }

    <span class="hljs-meta">@RequiresPermission({"user:create", "user:update"})</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrUpdateUser</span><span class="hljs-params">(User user)</span> {
        System.out.println(<span class="hljs-string">"åˆ›å»ºæˆ–æ›´æ–°ç”¨æˆ·: "</span> + user.getUsername());
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryUser</span><span class="hljs-params">(Long userId)</span> {
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç”¨æˆ·: "</span> + userId);
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">AdminService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> PermissionProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AdminService</span>());

        <span class="hljs-comment">// è®¾ç½®ç”¨æˆ·æƒé™</span>
        UserContext.setPermissions(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(Arrays.asList(<span class="hljs-string">"user:query"</span>, <span class="hljs-string">"user:create"</span>)));

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ— éœ€æƒé™çš„æ–¹æ³•</span>
            proxy.queryUser(<span class="hljs-number">1L</span>);
            System.out.println();

            <span class="hljs-comment">// æƒé™ä¸è¶³</span>
            proxy.deleteUser(<span class="hljs-number">1L</span>);

        } <span class="hljs-keyword">catch</span> (SecurityException e) {
            System.out.println(<span class="hljs-string">"æƒé™æ ¡éªŒå¤±è´¥: "</span> + e.getMessage());
        }

        System.out.println();

        <span class="hljs-comment">// æ·»åŠ æƒé™åé‡è¯•</span>
        UserContext.setPermissions(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(Arrays.asList(<span class="hljs-string">"user:delete"</span>)));
        proxy.deleteUser(<span class="hljs-number">1L</span>);

        UserContext.clear();
    }
}
</code></pre>
<h3 data-id="heading-25">å…­ã€æ€§èƒ½å¯¹æ¯”</h3>
<h4 data-id="heading-26">6.1 JDKä»£ç† vs CGLIBæ€§èƒ½æµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ€§èƒ½æµ‹è¯•
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyPerformanceTest</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ITERATIONS</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000000</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// é¢„çƒ­</span>
        warmup();

        <span class="hljs-comment">// æµ‹è¯•ç›´æ¥è°ƒç”¨</span>
        testDirectCall();

        <span class="hljs-comment">// æµ‹è¯•JDKä»£ç†</span>
        testJdkProxy();

        <span class="hljs-comment">// æµ‹è¯•CGLIBä»£ç†</span>
        testCglibProxy();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">warmup</span><span class="hljs-params">()</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">jdkProxy</span> <span class="hljs-operator">=</span> createJdkProxy(target);
        <span class="hljs-type">UserService</span> <span class="hljs-variable">cglibProxy</span> <span class="hljs-operator">=</span> createCglibProxy(target);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
            target.findById(<span class="hljs-number">1L</span>);
            jdkProxy.findById(<span class="hljs-number">1L</span>);
            cglibProxy.findById(<span class="hljs-number">1L</span>);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDirectCall</span><span class="hljs-params">()</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();

        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; ITERATIONS; i++) {
            target.findById(<span class="hljs-number">1L</span>);
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;

        System.out.println(<span class="hljs-string">"ç›´æ¥è°ƒç”¨è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testJdkProxy</span><span class="hljs-params">()</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> createJdkProxy(target);

        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; ITERATIONS; i++) {
            proxy.findById(<span class="hljs-number">1L</span>);
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;

        System.out.println(<span class="hljs-string">"JDKä»£ç†è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCglibProxy</span><span class="hljs-params">()</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> createCglibProxy(target);

        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; ITERATIONS; i++) {
            proxy.findById(<span class="hljs-number">1L</span>);
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;

        System.out.println(<span class="hljs-string">"CGLIBä»£ç†è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);
    }

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UserService <span class="hljs-title function_">createJdkProxy</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-keyword">return</span> (UserService) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            (proxy, method, args) -&gt; method.invoke(target, args)
        );
    }

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UserService <span class="hljs-title function_">createCglibProxy</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback((MethodInterceptor) (obj, method, args, proxy) -&gt;
            proxy.invokeSuper(obj, args));
        <span class="hljs-keyword">return</span> (UserService) enhancer.create();
    }
}
</code></pre>
<h4 data-id="heading-27">6.2 æ€§èƒ½å¯¹æ¯”ç»“æœ</h4>
<pre><code class="hljs language-markdown" lang="markdown">å…¸å‹æµ‹è¯•ç»“æœï¼ˆ100ä¸‡æ¬¡è°ƒç”¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è°ƒç”¨æ–¹å¼     â”‚  è€—æ—¶     â”‚  è¯´æ˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç›´æ¥è°ƒç”¨     â”‚  ~50ms   â”‚  åŸºå‡†    â”‚
â”‚  JDKä»£ç†      â”‚  ~150ms  â”‚  çº¦3å€   â”‚
â”‚  CGLIBä»£ç†    â”‚  ~120ms  â”‚  çº¦2.4å€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯´æ˜ï¼š
<span class="hljs-bullet">1.</span> ç°ä»£JVMå¯¹JDKä»£ç†æœ‰ä¼˜åŒ–
<span class="hljs-bullet">2.</span> CGLIBåœ¨æ–¹æ³•è°ƒç”¨ä¸Šç•¥å¿«ï¼ˆä½¿ç”¨FastClassï¼‰
<span class="hljs-bullet">3.</span> CGLIBåˆ›å»ºä»£ç†ç±»è¾ƒæ…¢ï¼ˆéœ€è¦ç”Ÿæˆå­—èŠ‚ç ï¼‰
<span class="hljs-bullet">4.</span> å®é™…ä¸šåŠ¡ä¸­ï¼Œä»£ç†å¼€é”€é€šå¸¸å¯å¿½ç•¥
</code></pre>
<h3 data-id="heading-28">ä¸ƒã€æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-29">7.1 é€‰æ‹©ä»£ç†æ–¹å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä»£ç†æ–¹å¼é€‰æ‹©å»ºè®®
 */</span>

<span class="hljs-comment">/*
1. ä¼˜å…ˆä½¿ç”¨JDKä»£ç†
   - é¢å‘æ¥å£ç¼–ç¨‹
   - Springé»˜è®¤é€‰æ‹©
   - æ›´ç¬¦åˆè®¾è®¡åŸåˆ™

2. ä»¥ä¸‹æƒ…å†µä½¿ç”¨CGLIBä»£ç†
   - ç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£
   - éœ€è¦ä»£ç†éæ¥å£æ–¹æ³•
   - æ€§èƒ½æ•æ„Ÿåœºæ™¯

3. Spring Boot 2.xé»˜è®¤ä½¿ç”¨CGLIB
   - spring.aop.proxy-target-class=true
*/</span>

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyRecommendation</span> {

    <span class="hljs-comment">// æ¨èï¼šé¢å‘æ¥å£ç¼–ç¨‹</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserService <span class="hljs-title function_">userService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
    }

    <span class="hljs-comment">// ä¸æ¨èï¼šç›´æ¥æ³¨å…¥å®ç°ç±»</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserServiceImpl <span class="hljs-title function_">userServiceImpl</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
    }
}
</code></pre>
<h4 data-id="heading-30">7.2 é¿å…å¸¸è§é—®é¢˜</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä»£ç†å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyPitfalls</span> {

    <span class="hljs-comment">/**
     * é—®é¢˜1ï¼šåŒç±»æ–¹æ³•è°ƒç”¨ä¸èµ°ä»£ç†
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// âŒ ç›´æ¥è°ƒç”¨ï¼Œä¸èµ°ä»£ç†</span>
        <span class="hljs-built_in">this</span>.innerMethod();
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// äº‹åŠ¡ä¸ç”Ÿæ•ˆ</span>
    }

    <span class="hljs-comment">// è§£å†³æ–¹æ¡ˆ1ï¼šæ³¨å…¥è‡ªå·±</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProxyPitfalls self;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethodFixed1</span><span class="hljs-params">()</span> {
        self.innerMethod();  <span class="hljs-comment">// âœ“ èµ°ä»£ç†</span>
    }

    <span class="hljs-comment">// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨AopContext</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethodFixed2</span><span class="hljs-params">()</span> {
        ((ProxyPitfalls) AopContext.currentProxy()).innerMethod();  <span class="hljs-comment">// âœ“</span>
    }

    <span class="hljs-comment">/**
     * é—®é¢˜2ï¼šfinalæ–¹æ³•ä¸èƒ½è¢«ä»£ç†
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finalMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// CGLIBæ— æ³•ä»£ç†finalæ–¹æ³•</span>
    }

    <span class="hljs-comment">/**
     * é—®é¢˜3ï¼šprivateæ–¹æ³•ä¸èƒ½è¢«ä»£ç†
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">privateMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä»»ä½•ä»£ç†éƒ½æ— æ³•ä»£ç†privateæ–¹æ³•</span>
    }
}

<span class="hljs-comment">/**
 * å¯ç”¨AopContext
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAspectJAutoProxy(exposeProxy = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AopConfig</span> {
}
</code></pre>
<h4 data-id="heading-31">7.3 è°ƒè¯•ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä»£ç†è°ƒè¯•æŠ€å·§
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyDebug</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. æŸ¥çœ‹ä»£ç†ç±»å</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> createProxy();
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»: "</span> + proxy.getClass().getName());

        <span class="hljs-comment">// 2. åˆ¤æ–­æ˜¯å¦ä¸ºä»£ç†å¯¹è±¡</span>
        System.out.println(<span class="hljs-string">"æ˜¯JDKä»£ç†: "</span> + Proxy.isProxyClass(proxy.getClass()));
        System.out.println(<span class="hljs-string">"æ˜¯CGLIBä»£ç†: "</span> + proxy.getClass().getName().contains(<span class="hljs-string">"$$"</span>));

        <span class="hljs-comment">// 3. è·å–åŸå§‹å¯¹è±¡</span>
        <span class="hljs-keyword">if</span> (AopUtils.isAopProxy(proxy)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> ((Advised) proxy).getTargetSource().getTarget();
                System.out.println(<span class="hljs-string">"ç›®æ ‡å¯¹è±¡: "</span> + target.getClass().getName());
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }

        <span class="hljs-comment">// 4. ä¿å­˜ç”Ÿæˆçš„ä»£ç†ç±»</span>
        <span class="hljs-comment">// JDKä»£ç†</span>
        System.setProperty(<span class="hljs-string">"sun.misc.ProxyGenerator.saveGeneratedFiles"</span>, <span class="hljs-string">"true"</span>);

        <span class="hljs-comment">// CGLIBä»£ç†</span>
        System.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY, <span class="hljs-string">"/tmp/cglib"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">createProxy</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h3 data-id="heading-32">å…«ã€æ€»ç»“</h3>
<h4 data-id="heading-33">æ ¸å¿ƒçŸ¥è¯†ç‚¹å›é¡¾</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">SpringåŠ¨æ€ä»£ç†æ ¸å¿ƒè¦ç‚¹</span>
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> ä»£ç†æ¨¡å¼åŸºç¡€
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> é™æ€ä»£ç†
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> åŠ¨æ€ä»£ç†
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">JDKåŠ¨æ€ä»£ç†</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> åŸºäºæ¥å£
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">Proxy</span> <span class="hljs-operator">+</span> <span class="hljs-type">InvocationHandler</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> é™åˆ¶ï¼šå¿…é¡»æœ‰æ¥å£
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">CGLIBä»£ç†</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> åŸºäºç»§æ‰¿
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">Enhancer</span> <span class="hljs-operator">+</span> <span class="hljs-type">MethodInterceptor</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> é™åˆ¶ï¼šä¸èƒ½ä»£ç†<span class="hljs-keyword">final</span>ç±»<span class="hljs-operator">/</span>æ–¹æ³•
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">Springä»£ç†é€‰æ‹©</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> é»˜è®¤<span class="hljs-type">JDKä»£ç†ï¼ˆæœ‰æ¥å£ï¼‰</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> è‡ªåŠ¨<span class="hljs-type">CGLIBä»£ç†ï¼ˆæ— æ¥å£ï¼‰</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> å¼ºåˆ¶<span class="hljs-type">CGLIBä»£ç†ï¼ˆé…ç½®ï¼‰</span>
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> å®æˆ˜åº”ç”¨
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> æ—¥å¿—ä»£ç†
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> é‡è¯•ä»£ç†
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> ç¼“å­˜ä»£ç†
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> æƒé™ä»£ç†
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â””â”€â”€</span> æœ€ä½³å®è·µ
    <span class="hljs-operator">â”œâ”€â”€</span> é¢å‘æ¥å£ç¼–ç¨‹
    <span class="hljs-operator">â”œâ”€â”€</span> é¿å…åŒç±»è°ƒç”¨
    <span class="hljs-operator">â”œâ”€â”€</span> æ³¨æ„<span class="hljs-keyword">final</span><span class="hljs-operator">/</span><span class="hljs-keyword">private</span>æ–¹æ³•
    <span class="hljs-operator">â””â”€â”€</span> åˆç†é€‰æ‹©ä»£ç†æ–¹å¼
</code></pre>
<p>åŠ¨æ€ä»£ç†æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ƒä½¿å¾—AOPã€äº‹åŠ¡ç®¡ç†ã€ç¼“å­˜ç­‰åŠŸèƒ½çš„å®ç°æˆä¸ºå¯èƒ½ã€‚ç†è§£JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŸç†å’ŒåŒºåˆ«ï¼ŒæŒæ¡æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨Springæ¡†æ¶ï¼Œå¹¶åœ¨éœ€è¦æ—¶å®ç°è‡ªå®šä¹‰çš„ä»£ç†åŠŸèƒ½ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cocos Creator Shader å…¥é—¨ â’‡ â€”â€” æ¶²æ€ç»ç’ƒæ•ˆæœ]]></title>    <link>https://juejin.cn/post/7575363120798973952</link>    <guid>https://juejin.cn/post/7575363120798973952</guid>    <pubDate>2025-11-23T18:24:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575363120798973952" data-draft-id="7574996958516477971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cocos Creator Shader å…¥é—¨ â’‡ â€”â€” æ¶²æ€ç»ç’ƒæ•ˆæœ"/> <meta itemprop="keywords" content="å‰ç«¯,Cocos Creator"/> <meta itemprop="datePublished" content="2025-11-23T18:24:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="VaJoy"/> <meta itemprop="url" content="https://juejin.cn/user/800100193674760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cocos Creator Shader å…¥é—¨ â’‡ â€”â€” æ¶²æ€ç»ç’ƒæ•ˆæœ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/800100193674760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    VaJoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T18:24:45.000Z" title="Sun Nov 23 2025 18:24:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ğŸ’¡ æœ¬ç³»åˆ—æ–‡ç« æ”¶å½•äº<a href="https://juejin.cn/column/7505952781289226291" target="_blank" title="https://juejin.cn/column/7505952781289226291">ä¸ªäººä¸“æ  ShaderMyHead</a>ã€‚</p>
<p>ğŸ’¡ æœ¬æ–‡æ¡ˆä¾‹å¯ä»¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fvajoy.github.io%2Fshader-demo%2Findex.html%3Fv%3D20" target="_blank" title="https://vajoy.github.io/shader-demo/index.html?v=20" ref="nofollow noopener noreferrer">åœ¨ Github ä¸Šè¿›è¡Œæ¼”ç¤º</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€æ¶²æ€ç»ç’ƒæ•ˆæœä»‹ç»</h2>
<p>è‹¹æœåœ¨ 2025 å¹´ 6 æœˆçš„ WWDC ä¸Šé¦–æ¬¡æ¨å‡ºäº†<strong>æ¶²æ€ç»ç’ƒï¼ˆLiquid Glassï¼‰</strong> æ•ˆæœï¼Œè®©ç•Œé¢å…ƒç´ å‘ˆç°å‡ºä»¿ä½›ç”±å¼¯æ›²ã€å¯æŠ˜å°„çš„ç»ç’ƒæ„æˆçš„è´¨æ„Ÿï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0c708655b674444b9b2546d83a7ea4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=qbC3FpAQF1lPYBQfq2jZbRH%2Fp1I%3D" alt="1.gif" loading="lazy"/></p>
<p>è‡ªæ­¤ï¼Œè¿™ç§åŒæ—¶å…¼å…·ç»šä¸½ä¸å¤æ‚çš„è§†è§‰ç‰¹æ•ˆè¿…é€Ÿåœ¨è®¾è®¡ä¸åŠ¨æ•ˆåœˆèµ°çº¢ï¼Œæˆä¸ºæ–°ä¸€ä»£ç•Œé¢é£æ ¼çš„æ½®æµè±¡å¾ã€‚</p>
<p>å¯¹äº H5 å‰ç«¯è€Œè¨€ï¼Œå¯ä»¥å€Ÿç”¨ SVG çš„ <code>&lt;filter&gt;</code> æ»¤é•œä¸­çš„ <code>&lt;feImage&gt;</code>ã€<code>&lt;feDisplacementMap&gt;</code>ã€<code>&lt;feBlend&gt;</code>ã€<code>&lt;feGaussianBlur&gt;</code>å’Œ <code>&lt;feComposite&gt;</code> ç­‰æ»¤é•œåŸºå…ƒï¼Œå¯¹èƒŒæ™¯è‰²è¿›è¡Œè‰²å€¼åç§»ã€æŸ”åŒ–å’Œé®ç½©å åˆï¼Œä»è€Œå®ç°ç±»ä¼¼çš„ç”»é¢æ‰­æ›²æ•ˆæœã€‚</p>
<p>ä¸ä¹…å‰ Trae Meetup å‘å¸ƒåœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fluma.com%2Flq0wo0qs" target="_blank" title="https://luma.com/lq0wo0qs" ref="nofollow noopener noreferrer">Luma å¹³å°ä¸Šçš„é‚€è¯·é¡µ</a>ï¼Œä¾¿å·²åº”ç”¨äº†è¿™ä¸€æŠ€æœ¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa7221af6d64fb6a8225755de21a7fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=8pprHvZh7h0xNT9L7NI2HStj010%3D" alt="9.gif" loading="lazy"/></p>
<p>æœ¬æ–‡åˆ™ä¼šä»¥ Cocos Creator ä¸ºæŠ€æœ¯æ ˆï¼Œä»‹ç»æ¶²æ€ç»ç’ƒæ•ˆæœçš„åŸç†ï¼ŒåŠå…¶ç€è‰²å™¨çš„é«˜æ€§èƒ½å®ç°ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ¶²æ€ç»ç’ƒåŸç†</h2>
<blockquote>
<p>ğŸ’¡ æœ¬èŠ‚éƒ¨åˆ†å†…å®¹å¼•ç”¨è‡ªã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fkube.io%2Fblog%2Fliquid-glass-css-svg%2F" target="_blank" title="https://kube.io/blog/liquid-glass-css-svg/" ref="nofollow noopener noreferrer">kube.io - Liquid Glass in the Browser</a>ã€‹ä¸€æ–‡ã€‚</p>
</blockquote>
<h3 data-id="heading-2">2.1 æŠ˜å°„</h3>
<p>æŠ˜å°„æ˜¯æŒ‡å…‰ä»ä¸€ç§ä»‹è´¨è¿›å…¥å¦ä¸€ç§ä»‹è´¨ï¼ˆå¦‚ä»ç©ºæ°”è¿›å…¥ç»ç’ƒï¼‰æ—¶æ”¹å˜ä¼ æ’­æ–¹å‘çš„ç°è±¡ã€‚è¿™ç§åæŠ˜ä¹‹æ‰€ä»¥å‘ç”Ÿï¼Œæ˜¯å› ä¸ºå…‰åœ¨ä¸åŒä»‹è´¨ä¸­çš„ä¼ æ’­é€Ÿåº¦ä¸åŒã€‚</p>
<p>å…¶ä¸­æˆ‘ä»¬éœ€è¦äº†è§£çš„æ˜¯ï¼Œå…¥å°„å…‰ä¸å‡ºå°„å…‰è§’åº¦çš„å…³ç³»ç”±<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSnell%2527s_law" target="_blank" title="https://en.wikipedia.org/wiki/Snell%27s_law" ref="nofollow noopener noreferrer">æ–¯æ¶…å°”â€“ç¬›å¡å°”å®šå¾‹</a>æè¿°ï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mi>sin</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>Î¸</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>n</mi><mn>2</mn></msub><mi>sin</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>Î¸</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">n_1 \sin(\theta_1) = n_2 \sin(\theta_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">sin</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">sin</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºä»‹è´¨ 1 çš„æŠ˜å°„ç‡ï¼›</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºä»‹è´¨ 2 çš„æŠ˜å°„ç‡ï¼›</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\theta_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå…¥å°„è§’ï¼ˆå…‰çº¿ä¸æ³•çº¿çš„å¤¹è§’ï¼‰ï¼›</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\theta_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºæŠ˜å°„è§’ï¼ˆæŠ˜å°„å…‰çº¿ä¸æ³•çº¿çš„å¤¹è§’ï¼‰ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77ecf8ebc0054d76bfa623b4ad669a0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=LkL%2FWhU%2FdkJB9GvLYbroW%2FXoYz0%3D" alt="3.gif" loading="lazy"/></p>
<p>å…¶è¡¨ç°ä¸ºï¼š</p>
<ul>
<li>å½“ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>=</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1 = n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ—¶ï¼Œå…‰çº¿ä¼šç›´çº¿ç©¿è¿‡ä»‹è´¨ï¼›</li>
<li>å½“ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1 &lt; n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ—¶ï¼Œå…‰çº¿ä¼šç©¿è¿‡ä»‹è´¨ä¸”å¾€æ³•çº¿ï¼ˆä¸Šå›¾ Normal è™šçº¿ï¼‰æ–¹å‘å‘ç”ŸåæŠ˜ï¼›</li>
<li>å½“ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>&gt;</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1 &gt; n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªä¸´ç•Œè§’ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>c</mi></msub><mo>=</mo><mi>arcsin</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><mfrac><msub><mi>n</mi><mn>2</mn></msub><msub><mi>n</mi><mn>1</mn></msub></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_c = \arcsin\left(\frac{n_2}{n_1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mop">arcsin</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7115em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span>ï¼Œè‹¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mn>1</mn></msub><mo>&gt;</mo><msub><mi>Î¸</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\theta_1 &gt; \theta_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> åˆ™å…‰çº¿ä¸ä¼šå‘ç”ŸæŠ˜å°„ï¼Œè€Œæ˜¯è¢«<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FTotal_internal_reflection" target="_blank" title="https://en.wikipedia.org/wiki/Total_internal_reflection" ref="nofollow noopener noreferrer">å®Œå…¨åå°„</a>å›å»ï¼›</li>
<li>å½“å…¥å°„å…‰çº¿ä¸è¡¨é¢æ­£äº¤æ—¶ï¼Œæ— è®ºæŠ˜å°„ç‡å¦‚ä½•ï¼Œå®ƒéƒ½ä¼šï¼ˆæ²¿ç€æ³•çº¿æ–¹å‘ï¼‰ç›´çº¿ç©¿è¿‡ã€‚</li>
</ul>
<h3 data-id="heading-3">2.2 ä½ç§»å‘é‡åœº</h3>
<p>å½“å…‰çº¿ç©¿å…¥ç»ç’ƒä»‹è´¨äº§ç”ŸæŠ˜å°„åï¼Œä¼šåœ¨åº•éƒ¨äº§ç”Ÿä½ç§»å‘é‡ï¼ˆè§ä¸‹å›¾çš„ç´«è‰²ç®­å¤´ï¼‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/009dbf87ec7043e3aa541276f86fcb50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=YarKkCtrptfn1%2Fmvc1vvTrYix9E%3D" alt="4.gif" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…‰çº¿äº§ç”ŸæŠ˜å°„è¶Šå¤§æ—¶ï¼Œå…¶ä½ç§»å‘é‡å°±è¶Šå¤§ï¼›ç›´åˆ°é è¿‘ç»ç’ƒä¸­å¿ƒä½ç½®æ—¶ï¼Œç”±äºå…‰çº¿ä¸ç»ç’ƒè¡¨é¢æ­£äº¤ï¼Œä¸å†äº§ç”ŸæŠ˜å°„ï¼Œå…¶ä½ç§»å‘é‡é•¿åº¦å½’é›¶ã€‚</p>
<p>å‡è®¾å…‰çº¿å°„å…¥çš„æ˜¯ä¸€å—æ­£åœ†å½¢çš„ç»ç’ƒå‡¸é€é•œï¼Œåˆ™æ‰€æœ‰å°„å…¥é•œå†…çš„å…‰çº¿æ‰€äº§ç”Ÿçš„ä½ç§»å‘é‡åœºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eb0ec7fa2314a7cae2ce01cdf3e5bef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=foCGRxWaByZ3uTHLgVYKP8OG3Iw%3D" alt="5.gif" loading="lazy"/></p>
<p>ç•™æ„ä¸Šå›¾çš„ç®­å¤´éƒ½ä¸ºäº†å¯è§æ€§è€Œè¿›è¡Œäº†å½’ä¸€åŒ–å¤„ç†ï¼Œè¿›è€Œç¼©å°äº†æ¯”ä¾‹ï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šé‡å ã€‚</p>
<blockquote>
<p>å’Œæ³•çº¿å‘é‡çš„ã€Œå½’ä¸€åŒ–ã€ä¸åŒï¼Œæ­¤å¤„çš„ã€Œå½’ä¸€åŒ–ã€å¹¶éå°†æ¯ä¸ªå‘é‡é™¤ä»¥è‡ªèº«çš„é•¿åº¦ï¼Œè€Œæ˜¯ç»Ÿä¸€é™¤ä»¥å‘é‡åœºå†…æœ€é•¿å‘é‡çš„é•¿åº¦ã€‚è¿™èˆ¬å¤„ç†åçš„å‘é‡æ‰èƒ½ä¿ç•™å½¼æ­¤ä¹‹é—´çš„é•¿åº¦æ¯”ä¾‹ä¿¡æ¯ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨ä¹‹å‰ã€Š<a href="https://juejin.cn/post/7542792170685825078" target="_blank" title="https://juejin.cn/post/7542792170685825078">æ³•çº¿è´´å›¾å’Œé«˜åº¦è´´å›¾</a>ã€‹ä¸€æ–‡å·²å­¦ä¹ è¿‡ã€Œå¦‚ä½•å°†å½’ä¸€åŒ–å‘é‡è½¬åŒ–ä¸ºè´´å›¾è‰²å€¼ã€ï¼Œä»Šå¤©ä¹Ÿå°†å¼‚æ›²åŒå·¥åœ°å¯¹ä½ç§»å‘é‡åšç±»ä¼¼çš„äº‹æƒ…ã€‚</p>
<p>ç”±äºå…‰çº¿æŠ˜å°„åçš„ä½ç§»å‘é‡ä»…å¤„äºç»ç’ƒæœ€åº•éƒ¨çš„å¹³é¢ï¼Œå› æ­¤æ¯ä¸ªå‘é‡ä»…åœ¨ X è½´å’Œ Y è½´å­˜åœ¨èµ°å‘ï¼Œä¸”å½’ä¸€åŒ–åçš„å€¼è¢«é™å®šåœ¨ <code>[-1, 1]</code> åŒºé—´ï¼Œå› æ­¤ä»…ä½¿ç”¨ RGBA ä¸­çš„ R å’Œ G ä¸¤ä¸ªé€šé“æ¥å­˜å‚¨è¿™ä¸¤ä¸ªè½´å‘å€¼å³å¯ï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mi>G</mi><mo>=</mo><mn>128</mn><mo>+</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mo>âˆ—</mo><mn>127</mn></mrow><annotation encoding="application/x-tex">RG = 128 + Normal * 127</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">RG</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">128</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">ma</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">127</span></span></span></span></span></div>
<p>å‡è®¾ B é€šé“å€¼å›ºå®šä¸º <code>0</code>ï¼ŒA é€šé“å›ºå®šä¸º <code>255</code>ï¼Œåˆ™æ¯ä¸ªå½’ä¸€åŒ–å‘é‡çš„è‰²å€¼ç›¸å½“äºåœ¨ã€Œé›¶å‘é‡è‰²ã€ <code>RGBA(127, 127, 0, 255)</code> ä¸Šå¢å‡ç›¸åº”çš„ R å’Œ G å€¼ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7477d0ad2f84538bcec1f83fd4eb4ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=lfClw3K7VEWgFEoR10ANRC%2F33Sg%3D" alt="6.gif" loading="lazy"/></p>
<p>é‚£ä¹ˆä¸€ä¸ªæ­£åœ†å½¢å‡¸é€é•œï¼Œå…¶å½’ä¸€åŒ–ä½ç§»å‘é‡åœºè´´å›¾ï¼ˆdisplacement mapï¼‰ï¼Œå¯ä»¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0318d20622ec4f69963a16d64fdafab4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=h%2FhRbj21Zd9OznsCp3vyE60mpsY%3D" alt="7.png" loading="lazy"/></p>
<blockquote>
<p>ğŸ’¡ æˆ‘åˆ¶ä½œäº†ä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fvajoy.github.io%2Fdm-generate%2Findex.html%3Fy%3D3" target="_blank" title="https://vajoy.github.io/dm-generate/index.html?y=3" ref="nofollow noopener noreferrer">å·¥å…·é¡µé¢</a>ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸Šè½»æ¾ç”Ÿæˆã€ä¸‹è½½å„ç§å½¢çŠ¶çš„ä½ç§»å‘é‡åœºè´´å›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed32ab4a9fb49138f65fbe567ffda58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=z2%2B1YazaqOiAUPC36zqpExTPKgw%3D" alt="8.gif" loading="lazy"/></p>
</blockquote>
<p>æ‹¥æœ‰äº†ä¿¡æ¯åŒ–è´´å›¾ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡ç€è‰²å™¨æ•è·ã€é€†å‘è¿™äº›ä¿¡æ¯ï¼Œå†è¿›ä¸€æ­¥åš UV åç§»ï¼Œæ¥å®ç°å…‰çº¿æŠ˜å°„ã€ç”»é¢è¢«æ‰­æ›²çš„æ•ˆæœã€‚</p>
<h3 data-id="heading-4">2.3 è‰²æ•£ä¸è½®å»“é«˜å…‰</h3>
<p>ä¸åŒé¢œè‰²çš„å…‰ï¼Œåœ¨ç»ç’ƒé‡Œä¼ æ’­çš„é€Ÿåº¦ä¸åŒï¼Œå› æ­¤æŠ˜å°„ç¨‹åº¦ä¹Ÿä¸åŒï¼ŒæŠ˜å°„åç§»è¶Šå¤§çš„åŒºåŸŸè¶Šå®¹æ˜“äº§ç”Ÿã€Œè‰²æ•£ã€ç°è±¡ï¼Œä»è€Œå‘ˆç°å‡ºä¸€ç§è‰²å½©åˆ†å±‚çš„è§†è§‰æ•ˆæœï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b93c4d9a2dd4eba8df43c1bf4b8d6fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=BM5H5kjte1%2BjCcK5s5j6VG%2B0tng%3D" alt="9.jpg" loading="lazy"/></p>
<p>åœ¨ã€Š<a href="https://juejin.cn/post/7517085209327484928" target="_blank" title="https://juejin.cn/post/7517085209327484928">æ»¤é•œçš„å®ç°</a>ã€‹ä¸€æ–‡ä¸­æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ª <code>glitchEffect</code> æ•…éšœæ•ˆæœæ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒæ­¤æ–¹æ³•ï¼Œæ ¹æ®ä½ç§»å‘é‡åœºè´´å›¾çš„ Rã€G é€šé“å€¼çš„å¤§å°ï¼Œæ¥å†³å®šä¸åŒç¨‹åº¦çš„è‰²å€¼åç§»ï¼Œä»è€Œè¾¾æˆç»ç’ƒè¾¹ç¼˜è‰²æ•£çš„è§†è§‰æ•ˆæœã€‚</p>
<p>å¦å¤–ï¼Œå½“å…‰çº¿ä»¥ç‰¹å®šè§’åº¦ç…§å°„æ—¶ï¼Œä¼šåœ¨ç»ç’ƒç‰©ä½“çœ‹åˆ°ä¸€äº›æ˜äº®çš„è¾¹ç¼˜åå°„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcafeaccf22e4f3884f4396aecce30eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=9g02vKrFl8r%2FJBRLroaWl0Sl4%2F0%3D" alt="9.gif" loading="lazy"/></p>
<p>è‹¹æœå…¬å¸å¯¹æ­¤çš„å®ç°ï¼Œæ˜¯ç»™æ¶²æ€ç»ç’ƒå›¾æ ‡æ·»åŠ ä¸€åœˆç®€å•çš„è½®å»“é«˜å…‰ï¼Œä»¤å…¶è´¨æ„Ÿæ›´è´´è¿‘ç»ç’ƒçš„åŒæ—¶ï¼Œä¹Ÿæ›´å¥½åœ°è®©å›¾æ ‡ä¸å¤–ç•Œåšè¾¹ç•ŒåŒºåˆ†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe5bcdddca1c45f5a7a2fb406b2be6ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=0KNcR2FBoFsuDAaXAygQlA3EN5E%3D" alt="11.png" loading="lazy"/></p>
<h2 data-id="heading-5">ä¸‰ã€ç€è‰²å™¨å®ç°</h2>
<h3 data-id="heading-6">3.1 æŠ˜å°„çš„å®ç°</h3>
<p>å…‰çº¿çš„æŠ˜å°„åœ¨ç€è‰²å™¨ä¸­é€šå¸¸è¡¨ç°ä¸º UV çš„åç§»ï¼ˆè¿™ä¹Ÿæ˜¯ã€Š<a href="https://juejin.cn/post/7544388006720471094" target="_blank" title="https://juejin.cn/post/7544388006720471094">UV æ‰°åŠ¨åŠ¨ç”»</a>ã€‹çš„å®ç°åŸç†ï¼‰ï¼Œå€ŸåŠ©ä½ç§»å‘é‡åœºè´´å›¾ï¼Œå¯ä»¥é«˜æ•ˆåœ°è·å¾— UV çš„åç§»å€¼ã€‚</p>
<p>æˆ‘ä»¬å…ˆæŠŠèƒŒæ™¯å’Œå‰ç½®çš„ç»ç’ƒç‰©ä½“ä½ç§»å‘é‡åœºè´´å›¾ï¼Œåˆ†åˆ«æ•è·ä¸ºä¸¤ä¸ªç¦»å±çš„ Render Textureï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bc434aa26194ad495a917d9a5409a80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=hoyJfJntiO8fl8mObwDfQv2hFo8%3D" alt="image.png" loading="lazy"/></p>
<p>æ¥ç€æ–°å»ºä¸€ä¸ª <code>Sprite</code> ç»„ä»¶èŠ‚ç‚¹ <code>Composition</code>ï¼Œç»‘å®šç€è‰²å™¨ï¼ˆ<code>liquid-glass.effect</code>ï¼‰æ¥è·å–è¿™ä¸¤ä¸ª Render Textureï¼ˆç”¨äºåé¢çš„åˆæˆå¤„ç†ï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** liquid-glass.effect ç‰‡å…ƒç€è‰²å™¨ç¤ºä¾‹ **/</span>

<span class="hljs-title class_">CCProgram</span> fs %{
  precision highp float;
  <span class="hljs-keyword">in</span> vec2 uv;

  uniform sampler2D bgRT;  <span class="hljs-comment">// èƒŒæ™¯ RenderTexture</span>
  uniform sampler2D displacementMapRT;  <span class="hljs-comment">// ä½ç§»å‘é‡åœºè´´å›¾ RenderTexture</span>

  vec4 frag () {
    vec4 bgColor = <span class="hljs-title function_">texture</span>(bgRT, uv);
    vec4 dispColor = <span class="hljs-title function_">texture</span>(displacementMapRT, uv);
    
    <span class="hljs-keyword">return</span> bgColor;  <span class="hljs-comment">// ç›´æ¥è¿”å›èƒŒæ™¯è‰²ï¼ˆæš‚æ— ä»»ä½•æ‰­æ›²å¤„ç†ï¼‰</span>
  }
}%
</code></pre>
<p>åœ¨è·å–åˆ°ä½ç§»å‘é‡åœºè´´å›¾çš„è‰²å€¼åï¼ˆå–å€¼åŒºé—´ <code>[0.0, 1.0]</code>ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ã€Œé€†å‘ã€ä¸ºåŸæœ¬çš„å½’ä¸€åŒ–å‘é‡ï¼ˆå–å€¼åŒºé—´ <code>[-1.0, 1.0]</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">vec2 offsetNormal = dispColor.<span class="hljs-property">xy</span> * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// RG æ˜ å°„åˆ° [-1, 1]</span>
</code></pre>
<p>ç”±äºé€†å‘åçš„å½’ä¸€åŒ–å‘é‡çš„å–å€¼ä¸º <code>[-1, 1]</code>ï¼Œå¯¹äº UV è€Œè¨€æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„æ•°å€¼ï¼Œç›´æ¥ä½¿ç”¨ <code>offsetNormal</code> ä½œä¸º UV åç§»å€¼ä¼šå¯¼è‡´éå¸¸å¤¸å¼ çš„èƒŒæ™¯æ‰­æ›²ï¼Œå› æ­¤éœ€è¦æ–°å¢ä¸€ä¸ª <code>strengthUV</code> å‚æ•°ï¼ˆé»˜è®¤å€¼ä¸º <code>0.03</code>ï¼‰æ¥ç¼©å° UV åç§»å€¼åˆ°åˆç†çš„èŒƒç•´ï¼š</p>
<pre><code class="hljs language-js" lang="js">uniform <span class="hljs-variable constant_">UBO</span> {
    float strengthUV;  <span class="hljs-comment">// é»˜è®¤å€¼ 0.03</span>
};

vec2 offsetNormal = dispColor.<span class="hljs-property">xy</span> * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0</span>;

float canvasScale = <span class="hljs-number">1280.0</span> / <span class="hljs-number">720.0</span>;  <span class="hljs-comment">// 1280x720 æ˜¯ Canvasã€bgRT å’Œ displacementMapRT çš„å®½é«˜</span>
vec2 offsetUV = offsetNormal * strengthUV * <span class="hljs-title function_">vec2</span>(<span class="hljs-number">1.0</span>, -canvasScale);  <span class="hljs-comment">// UV éœ€è¦åç§»çš„é‡</span>
vec2 baseUV = uv + offsetUV;  <span class="hljs-comment">// åç§» UV</span>

vec4 bgColor = <span class="hljs-title function_">texture</span>(bgRT, baseUV);

<span class="hljs-keyword">return</span> bgColor; 
</code></pre>
<blockquote>
<p>ç•™æ„ç¬¬ 8 è¡Œç»™ Y è½´çš„åç§»ä¹˜ä»¥äº†ç”»å¸ƒçš„å®½é«˜æ¯” <code>canvasScale</code>ï¼Œä»¥æ­¤ç¡®ä¿ X è½´å’Œ Y è½´çš„åç§»å¹…åº¦ä¸ä¼šäº§ç”Ÿæ‹‰ä¼¸ï¼ˆæ¯•ç«Ÿæœ¬æ¡ˆä¾‹çš„ç”»å¸ƒåŠå…¶å¯¹åº”çš„ UV å¹¶éæ­£æ–¹å½¢ï¼‰ã€‚</p>
<p>åŒæ—¶ Y è½´çš„åç§»è¿˜ä¹˜ä»¥äº† <code>-1</code>ï¼Œç¡®ä¿ä½ç§»çŸ¢é‡åœ¨å‚ç›´æ–¹ä½èƒ½ç¬¦åˆæ­£ç¡®çš„ UV æ–¹ä½ï¼ˆæŒ‡å‘ä¸­å¿ƒï¼‰ã€‚</p>
</blockquote>
<p>æ­¤æ—¶æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f7884bdf9b84a61a457f931ac9c2ee9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=GZ81dyQ%2BKU3%2Bej7U4so%2FaIliX5U%3D" alt="11.gif" loading="lazy"/></p>
<h3 data-id="heading-7">3.2 è‰²æ•£çš„å®ç°</h3>
<p>è‰²æ•£çš„å®ç°å…¶å®æ¯”æƒ³è±¡çš„ç®€å•ï¼Œåªéœ€è¦æ ¹æ® UV åç§»é‡ <code>offsetUV</code>ï¼Œè¿›ä¸€æ­¥å·¦å³åç§»èƒŒæ™¯è‰²çš„ R å’Œ B é€šé“å³å¯ï¼ŒåŒæ—¶æ–°å¢ <code>dispersionStrength</code> å‚æ•°ï¼ˆé»˜è®¤å€¼ä¸º <code>0.03</code>ï¼‰æ¥æ§åˆ¶è‰²æ•£åç§»çš„å¼ºåº¦ï¼š</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// è‰²æ•£æ•ˆæœï¼ŒæŠŠ R å’Œ B è‰²å€¼åˆ†åˆ«å·¦å³åç§»</span>
    vec4 rC = <span class="hljs-title function_">texture</span>(bgRT, baseUV + offsetUV * dispersionStrength);
    vec4 gC = <span class="hljs-title function_">texture</span>(bgRT, baseUV);
    vec4 bC = <span class="hljs-title function_">texture</span>(bgRT, baseUV - offsetUV * dispersionStrength);

    <span class="hljs-keyword">return</span> <span class="hljs-title function_">vec4</span>(rC.<span class="hljs-property">r</span>, gC.<span class="hljs-property">g</span>, bC.<span class="hljs-property">b</span>, <span class="hljs-number">1.0</span>);
</code></pre>
<p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3de3487b432f44d999afe16f334307af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=l5u1TTs2AjusMyAXWPiR55hObgQ%3D" alt="12.gif" loading="lazy"/></p>
<p>ä¸ºäº†æå‡æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä»…åœ¨éœ€è¦è‰²æ•£çš„æ—¶å€™æ‰å¯¹ R å’Œ B é€šé“è¿›è¡Œé‡‡æ ·ï¼š</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// è‰²æ•£æ•ˆæœï¼ŒæŠŠ R å’Œ B è‰²å€¼åˆ†åˆ«å·¦å³åç§»</span>
    vec4 gC = <span class="hljs-title function_">texture</span>(bgRT, baseUV);
    vec4 rC = gC;
    vec4 bC = gC;

    <span class="hljs-keyword">if</span> (dispersionStrength &gt; <span class="hljs-number">0.0</span>) {
      <span class="hljs-comment">// éœ€è¦å¼€å¯è‰²æ•£æ•ˆæœå†é‡‡æ · R B é€šé“ï¼Œæå‡æ€§èƒ½</span>
      rC = <span class="hljs-title function_">texture</span>(bgRT, baseUV + offsetUV * dispersionStrength);
      bC = <span class="hljs-title function_">texture</span>(bgRT, baseUV - offsetUV * dispersionStrength);
    }

    vec4 dispersionColor = <span class="hljs-title function_">vec4</span>(rC.<span class="hljs-property">r</span>, gC.<span class="hljs-property">g</span>, bC.<span class="hljs-property">b</span>, <span class="hljs-number">1.0</span>);
</code></pre>
<h3 data-id="heading-8">3.3 è½®å»“å…‰çš„å®ç°</h3>
<p>å®ç°è½®å»“å…‰æœ€ç®€å•ç²—æš´çš„æ–¹æ¡ˆï¼Œæ˜¯åœ¨å½¢çŠ¶èŠ‚ç‚¹ä¹‹ä¸Šå åŠ ä¸€ä¸ª PNG å›¾å±‚èŠ‚ç‚¹ï¼Œä½†æœ¬æ–‡å°†æ›´åŠ é«˜æ•ˆçš„ã€ç›´æ¥åœ¨ç€è‰²å™¨å†…éƒ¨å®ç°ã€‚</p>
<p>ç”±äºå…‰çº¿æŠ˜å°„äº§ç”Ÿçš„ä½ç§»å‘é‡ï¼Œåœ¨è¶Šé è¿‘è¾¹ç¼˜çš„éƒ¨åˆ†å…¶çŸ¢é‡é•¿åº¦æ˜¯è¶Šå¤§çš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡ <code>length</code> å‡½æ•°è·å¾—ä½ç§»çŸ¢é‡é•¿åº¦ï¼Œç„¶ååˆ¤æ–­å…¶å€¼æ˜¯å¦å¤§äºæŒ‡å®šçš„é˜ˆå€¼ï¼Œè‹¥æ˜¯åˆ™è¿”å›çº¯ç™½è‰²çš„è½®å»“å…‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">  uniform <span class="hljs-variable constant_">UBO</span> {
    float strengthUV; 
    float dispersionStrength; 
    float highlightStrength;   <span class="hljs-comment">// æ–°å¢è½®å»“å…‰å¼ºåº¦å‚æ•°ï¼ˆé»˜è®¤å€¼ä¸º 0.1ï¼ŒèŒƒå›´ `[0.0, 0.2]`ï¼‰</span>
  };
  
  
    <span class="hljs-comment">// è½®å»“å…‰å®ç°</span>
    float normalLen = <span class="hljs-title function_">length</span>(offsetNormal);  <span class="hljs-comment">// è·å¾—å½’ä¸€åŒ–ä½ç§»çŸ¢é‡é•¿åº¦ï¼ŒåŒºé—´ä¸º [0.0, 1.0]</span>

    <span class="hljs-keyword">if</span> (normalLen &lt; <span class="hljs-number">1.0</span> - highlightStrength) {
      <span class="hljs-comment">// ä½ç§»å‘é‡é•¿åº¦ä½äºæŒ‡å®šé˜ˆå€¼ï¼Œæ— éœ€è½®å»“å…‰</span>
      <span class="hljs-keyword">return</span> dispersionColor;
    }

    float highlightOpacity = <span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">vec4</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, highlightOpacity);
</code></pre>
<p>ç”±äº <code>offsetNormal</code> æ˜¯å½’ä¸€åŒ–åçš„å‘é‡ï¼Œå…¶é•¿åº¦ <code>normalLen</code> æ³¨å®šè½åœ¨ <code>[0.0, 1.0]</code> åŒºé—´ä¸­ï¼Œå› æ­¤å¯ä»¥è®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼ˆ<code>highlightStrength</code>ï¼‰æ¥åœˆå®šäº§ç”Ÿè½®å»“å…‰çš„åŒºåŸŸã€‚</p>
<p>æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªç›¸è¾ƒç²—ç³™çš„å®å¿ƒè½®å»“å…‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b30dfa949fe4ebe9a2713425d3eaf4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=Sqov4kkkqEGuCj1lf0tl9R2Ei%2Bg%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>å—é™äºä½ç§»å‘é‡åœºè´´å›¾ç²¾åº¦ï¼Œè®¡ç®—è·å¾—çš„è½®å»“å…‰ç²—ç»†å¯èƒ½ä¸å‡ï¼Œä¸”å¯èƒ½å­˜åœ¨äº›è®¸åç§»ã€‚</p>
</blockquote>
<p>ç„¶è€Œæˆ‘ä»¬éœ€è¦çš„å¹¶éä¸€ä¸ªå®Œæ•´ä¸”å®å¿ƒçš„è½®å»“å…‰ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªå¯¹ç§°çš„ã€é€æ˜åº¦çº¿æ€§æ¸å˜çš„è½®å»“å…‰ï¼Œè€Œè¿™å—çš„å¤„ç†å¯ä»¥ä»ä½ç§»å‘é‡åœºè´´å›¾ä¸Šçš„è‰²å€¼è·å–çº¿ç´¢ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d28c1f3aa63b485c8effec5835b90622~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=oJaLSkflgjin7ufO9dQ07Jkn7BE%3D" alt="15.jpg" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ä½ç§»å‘é‡åœºè´´å›¾çš„ R æˆ– G é€šé“å€¼ï¼Œå‡æ˜¯çº¿æ€§æ¸å˜çš„ï¼Œä¾‹å¦‚ G é€šé“çš„å€¼ï¼Œä¼šä»æœ€é¡¶éƒ¨çš„ <code>255</code> æ²¿ç€è¾¹ç¼˜çº¿æ€§é€’å‡åˆ°æœ€å·¦ä¾§çš„ <code>128</code>ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ä½äºå·¦ä¸Šè§’çš„ G é€šé“å€¼ <code>191</code> æ¥ä½œä¸ºå·¦åŠçƒè½®å»“å…‰çš„ä¸­ç‚¹ï¼ˆå®Œå…¨ä¸é€æ˜åº¦ï¼‰ï¼Œå…¶å·¦å³ä¸¤ä¾§ G é€šé“å€¼ <code>Â±50</code> çš„ç‚¹ä¸ºè½®å»“å…‰çš„è¾¹ç¼˜ï¼ˆå®Œå…¨é€æ˜åº¦ï¼‰ï¼Œè¿›è€Œå®ç°ä¸€ä¸ªä½äºå·¦ä¸Šè§’çš„æ¸å˜è½®å»“å…‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">    float highlightOpacity = <span class="hljs-number">0.0</span>;
    float leftCenterG = <span class="hljs-number">191.0</span> / <span class="hljs-number">255.0</span>;  <span class="hljs-comment">// ç»ç’ƒç‰©ä½“å·¦ä¾§è½®å»“å…‰ä¸­å¿ƒå¯¹åº”çš„ G å€¼ï¼Œè¦å…ˆè½¬æ¢åˆ° [0.0, 1.0] åŒºé—´ï¼Œæ‰èƒ½ä¸åŒºé—´ä¸º [0.0, 1.0] çš„ dispColor.g è¿›è¡Œå¯¹æ¯”</span>
    float rightCenterG = <span class="hljs-number">1.0</span> - leftCenterG; <span class="hljs-comment">// ç»ç’ƒç‰©ä½“å³ä¾§è½®å»“å…‰ä¸­å¿ƒå¯¹åº”çš„ G å€¼</span>
    float spanG = <span class="hljs-number">50.0</span> / <span class="hljs-number">255.0</span>;  <span class="hljs-comment">// è½®å»“å…‰èŒƒå›´å¯¹åº”çš„ G å€¼ï¼Œå½“ leftCenterG Â± spanG æ—¶ï¼Œè½®å»“å…‰é€æ˜åº¦ä¸º 0</span>
    
    <span class="hljs-keyword">if</span> ((offsetNormal.<span class="hljs-property">x</span> &gt; <span class="hljs-number">0.0</span>) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &lt; leftCenterG + spanG) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &gt; leftCenterG - spanG)) {
      <span class="hljs-comment">// ä½ç§»å‘é‡åœ¨æ°´å¹³æ–¹ä½æŒ‡å‘å³ä¾§ï¼Œè¯´æ˜å¤„äºç»ç’ƒç‰©ä½“å·¦ä¾§</span>
      highlightOpacity = <span class="hljs-title function_">clamp</span>(<span class="hljs-number">1.0</span> - <span class="hljs-title function_">abs</span>(dispColor.<span class="hljs-property">g</span> - leftCenterG) / spanG, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
    }
    
    vec4 highlightColor = <span class="hljs-title function_">vec4</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">mix</span>(dispersionColor, highlightColor, highlightOpacity);
</code></pre>
<p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf944730ef3b4141959f25e88be06125~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=bKvgNGD8N3bYamTvqXvN4dmYphA%3D" alt="16.jpg" loading="lazy"/></p>
<p>åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥ç®—å‡ºå³ä¸‹è§’çš„æ¸å˜è½®å»“å…‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">if</span> ((offsetNormal.<span class="hljs-property">x</span> &gt; <span class="hljs-number">0.0</span>) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &lt; leftCenterG + spanG) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &gt; leftCenterG - spanG)) {
      <span class="hljs-comment">// ä½ç§»å‘é‡åœ¨æ°´å¹³æ–¹ä½æŒ‡å‘å³ä¾§ï¼Œè¯´æ˜å¤„äºç»ç’ƒç‰©ä½“å·¦ä¾§</span>
      highlightOpacity = <span class="hljs-title function_">clamp</span>(<span class="hljs-number">1.0</span> - <span class="hljs-title function_">abs</span>(dispColor.<span class="hljs-property">g</span> - leftCenterG) / spanG, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((offsetNormal.<span class="hljs-property">x</span> &lt; <span class="hljs-number">0.0</span>) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &lt; rightCenterG + spanG) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &gt; rightCenterG - spanG)) {
      <span class="hljs-comment">// ä½ç§»å‘é‡åœ¨æ°´å¹³æ–¹ä½æŒ‡å‘å·¦ä¾§ï¼Œè¯´æ˜å¤„äºç»ç’ƒç‰©ä½“å³ä¾§</span>
      highlightOpacity = <span class="hljs-title function_">clamp</span>(<span class="hljs-number">1.0</span> - <span class="hljs-title function_">abs</span>(dispColor.<span class="hljs-property">g</span> - rightCenterG) / spanG, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
    }
</code></pre>
<p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88d5240eb6fd4025a1eebb7ddbe5df13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=w5Qfq3TA7p2iKtKbQ2NsUcibq3w%3D" alt="17.gif" loading="lazy"/></p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å€ŸåŠ©ä½ç§»å‘é‡åœºè´´å›¾çš„èƒ½åŠ›ï¼Œåœ¨å•ä¸ª DrawCall ä¸­ä»…ä½¿ç”¨äº†æœ€å¤š 4 æ¬¡é‡‡æ ·ï¼Œä¾¿é«˜æ•ˆåœ°å®ç°äº†ä¸€ä¸ªå¸¦æœ‰æ‰­æ›²ã€è‰²æ•£å’Œè½®å»“å…‰çš„æ¶²æ€ç»ç’ƒæ•ˆæœã€‚</p>
<p>è¯¥ç€è‰²å™¨ä¹Ÿé€‚ç”¨äºå…¶å®ƒå½¢çŠ¶ï¼Œè¯»è€…å¯ä»¥åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fvajoy.github.io%2Fshader-demo%2Findex.html%3Fv%3D20" target="_blank" title="https://vajoy.github.io/shader-demo/index.html?v=20" ref="nofollow noopener noreferrer">çº¿ä¸Šæ¡ˆä¾‹æ¼”ç¤ºé¡µ</a>æŸ¥çœ‹å®Œæ•´çš„åŠ¨æ€æ•ˆæœå’Œè·å–æºç ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d2ff76fa23f419a8addfa432e100880~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=goCwf%2F%2FYgtP0l3SymUFxdLfqC4E%3D" alt="18.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ Taro + å¾®ä¿¡å°ç¨‹åºå®ç°å¤§æ¨¡å‹æµå¼å“åº”ï¼ˆSSEï¼‰ï¼šæœ€å…¨å®è·µæŒ‡å—]]></title>    <link>https://juejin.cn/post/7575367791273639974</link>    <guid>https://juejin.cn/post/7575367791273639974</guid>    <pubDate>2025-11-24T01:02:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791273639974" data-draft-id="7574991051435147274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ Taro + å¾®ä¿¡å°ç¨‹åºå®ç°å¤§æ¨¡å‹æµå¼å“åº”ï¼ˆSSEï¼‰ï¼šæœ€å…¨å®è·µæŒ‡å—"/> <meta itemprop="keywords" content="å¾®ä¿¡å°ç¨‹åº,Taro,LLM"/> <meta itemprop="datePublished" content="2025-11-24T01:02:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="namehu"/> <meta itemprop="url" content="https://juejin.cn/user/993614243829768"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ Taro + å¾®ä¿¡å°ç¨‹åºå®ç°å¤§æ¨¡å‹æµå¼å“åº”ï¼ˆSSEï¼‰ï¼šæœ€å…¨å®è·µæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614243829768/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    namehu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:02:26.000Z" title="Mon Nov 24 2025 01:02:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘å¤§æ¨¡å‹ï¼ˆLLMï¼‰å¯ä»¥è¯´æ˜¯ç«å¾—ä¸€å¡Œç³Šæ¶‚ã€‚å„å®¶å…¬å¸éƒ½åœ¨å¾€å°ç¨‹åºé‡Œå¡ AI å¯¹è¯åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œå¤§å®¶æœ‰æ²¡æœ‰å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Ÿå¦‚æœä½ åƒä¼ ç»Ÿè¯·æ±‚é‚£æ ·ï¼Œç­‰ AI æŠŠå‡ åƒå­—çš„å°ä½œæ–‡å…¨å†™å®Œå†è¿”å›ç»™å‰ç«¯ï¼Œç”¨æˆ·çš„ç­‰å¾…ä½“éªŒç®€ç›´æ˜¯ç¾éš¾çº§çš„ï¼ğŸ˜«</p>
<p>æ‰€ä»¥ï¼Œ<strong>æµå¼è¾“å‡ºï¼ˆStreamingï¼‰</strong> ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€œæ‰“å­—æœºæ•ˆæœâ€ï¼Œæ˜¯æå‡ AI äº§å“ä½“éªŒçš„å¿…æ€æŠ€ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘å°±å¸¦å¤§å®¶æ·±å…¥ç¡¬æ ¸åœ°æ‰’ä¸€æ‰’ï¼Œå¦‚ä½•åœ¨ <strong>Taro æ¡†æ¶</strong> ä¸‹ï¼Œåˆ©ç”¨ <strong>å¾®ä¿¡å°ç¨‹åºåŸç”Ÿèƒ½åŠ›</strong> å®ç°ä¸æ»‘çš„ SSEï¼ˆServer-Sent Eventsï¼‰æµå¼å“åº”ã€‚</p>
<p>å¦‚æœä½ åœ¨å®æ–½çš„è¿‡ç¨‹ä¸­é‡åˆ°è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li>æ˜æ˜ä»£ç æŒ‰å®˜æ–¹å†™çš„ä½†æ˜¯å°±æ˜¯ä¸æµå¼è¾“å‡ºï¼Ÿ</li>
<li>æ¨¡æ‹Ÿå™¨è·ŸçœŸæœºæ•ˆæœä¸ä¸€æ ·ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆå®‰å“å¯ä»¥ã€‚IOSå´ä¸è¡Œ</li>
<li>ä¸ºä»€ä¹ˆå¯ä»¥è¾“å‡ºå†…å®¹ä½†æ˜¯æ§åˆ¶å°æ€»æ˜¯ä¼šåœ¨è¯·æ±‚ç»“æŸåæŠ¥é”™</li>
</ul>
<p>é‚£ä¹ˆè¯·æ”¾å¿ƒï¼Œè¿™ä¸­é—´çš„å‘ï¼Œæˆ‘å·²ç»æ›¿å¤§å®¶è¸©å¹³äº†</p>
<h2 data-id="heading-0">ğŸ§ ä¸ºä»€ä¹ˆæ˜¯ SSE è€Œä¸æ˜¯ WebSocketï¼Ÿ</h2>
<p>è™½ç„¶ WebSocket å…¨åŒå·¥å¾ˆå¼ºï¼Œä½†å¯¹äºå¤§æ¨¡å‹å¯¹è¯è¿™ç§â€œä¸€é—®å¤šç­”â€çš„åœºæ™¯ï¼ŒSSEï¼ˆServer-Sent Eventsï¼‰å…¶å®æ›´è½»é‡ã€æ›´ç¬¦åˆ HTTP è¯­ä¹‰ã€‚</p>
<p>ä½†åœ¨å¾®ä¿¡å°ç¨‹åºé‡Œï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ ‡å‡†çš„ <code>EventSource</code> APIã€‚ä¸è¿‡åˆ«æ…Œï¼Œå¾®ä¿¡çš„ <code>wx.request</code>ï¼ˆTaro ä¸­æ˜¯ <code>Taro.request</code>ï¼‰æ”¯æŒäº† <code>enableChunked</code> å‚æ•°ã€‚</p>
<p>è¿™å°±ç»™äº†æˆ‘ä»¬æ“ä½œçš„ç©ºé—´ï¼ğŸ˜</p>
<h2 data-id="heading-1">ğŸ› ï¸ æ ¸å¿ƒæŠ€æœ¯å®ç°ï¼šå‰ç«¯ç¯‡</h2>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹æ ¸å¿ƒçš„ Hook å®ç°ã€‚è¿™é‡Œæˆ‘å°è£…äº†ä¸€ä¸ª <code>useSSE</code>ï¼Œå®ƒè´Ÿè´£å»ºç«‹è¿æ¥ã€è§£ç äºŒè¿›åˆ¶æµã€è§£æ SSE åè®®ä»¥åŠæ§åˆ¶æ‰“å­—æœºé€Ÿåº¦ã€‚</p>
<h3 data-id="heading-2">1. é“¾è·¯è®¾è®¡å›¾</h3>
<p>åœ¨å¼€å§‹è´´ä»£ç å‰ï¼Œå…ˆçœ‹ä¸‹æ•°æ®æ˜¯æ€ä¹ˆæµè½¬çš„ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A["ç”¨æˆ·å‘èµ·å¯¹è¯"] --&gt; B["Taro.request (å¼€å¯ enableChunked)"]
    B --"å»ºç«‹è¿æ¥"--&gt; C["æœåŠ¡ç«¯å“åº” (Transfer-Encoding: chunked)"]
    C --"äºŒè¿›åˆ¶æµ chunk"--&gt; D["onChunkReceived ç›‘å¬"]
    D --&gt; E["TextDecoder è§£ç  (ArrayBuffer è½¬ String)"]
    E --&gt; F["SSE åè®®è§£æ (æå– data å­—æ®µ)"]
    F --&gt; G["å†™å…¥ç¼“å­˜é˜Ÿåˆ— (Buffer)"]
    G --&gt; H["å®šæ—¶å™¨æ§åˆ¶ (æ‰“å­—æœºæ•ˆæœ)"]
    H --&gt; I["æ›´æ–° UI (Markdown æ¸²æŸ“)"]
</code></pre>
<h3 data-id="heading-3">2. æ ¸å¿ƒ Hookï¼š<code>useSSE.ts</code></h3>
<p>è¿™ä¸ªæ–‡ä»¶æ˜¯æ•´ä¸ªåŠŸèƒ½çš„çµé­‚ã€‚æˆ‘ä»¬éœ€è¦è§£å†³ä¸¤ä¸ªå¤§éš¾é¢˜ï¼š</p>
<ol>
<li><strong>è§£ç </strong>ï¼šå°ç¨‹åºè¿”å›çš„æ˜¯ <code>ArrayBuffer</code>ï¼Œéœ€è¦å…¼å®¹æ€§å¥½çš„è§£ç æ–¹æ¡ˆï¼ˆæ¨è <code>text-encoding-shim</code>ï¼‰ã€‚</li>
<li><strong>ç²˜åŒ…å¤„ç†</strong>ï¼šç½‘ç»œä¼ è¾“æ˜¯ä¸è®²é“ç†çš„ï¼Œå¯èƒ½ä¸€æ¬¡ç»™ä½ åŠæ¡æ•°æ®ï¼Œä¹Ÿå¯èƒ½ä¸€æ¬¡ç»™ä½ ä¸‰æ¡ã€‚å¿…é¡»è¦æœ‰ Buffer æœºåˆ¶ã€‚</li>
</ol>
<p>ç›´æ¥ä¸Šä»£ç ï¼ŒCV ä¹Ÿå°±æ˜¯å¤åˆ¶ç²˜è´´å°±èƒ½ç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Taro</span>, { <span class="hljs-title class_">RequestTask</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tarojs/taro'</span>
<span class="hljs-keyword">import</span> { useState, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-comment">// å‡è®¾ config å’Œ request æ˜¯ä½ é¡¹ç›®é‡Œçš„åŸºç¡€é…ç½®ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢</span>
<span class="hljs-keyword">import</span> { apiUrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/config'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ResChatMessagesDTO</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/request'</span>
<span class="hljs-keyword">import</span> { getAuthorization } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/utils/authorization'</span>
<span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åº“ï¼Œç”¨äºåœ¨å°ç¨‹åºç¯å¢ƒè§£ç  Uint8Array</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">TextEncoding</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'text-encoding-shim'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">ChatMessage</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">ResChatMessagesDTO</span>, <span class="hljs-string">'id'</span>&gt; &amp; { id?: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> }

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useSSE</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æœ€ç»ˆå±•ç¤ºåœ¨ UI ä¸Šçš„å†…å®¹ï¼ˆç»è¿‡æ‰“å­—æœºæ•ˆæœå¤„ç†ï¼‰</span>
  <span class="hljs-keyword">const</span> [displayContent, setDisplayContent] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  <span class="hljs-comment">// å®Œæ•´çš„å†…å®¹ï¼ˆåå°å®æ—¶æ¥æ”¶åˆ°çš„ï¼‰</span>
  <span class="hljs-keyword">const</span> [content, setContent] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  
  <span class="hljs-comment">// ç¼“å†²æ± ï¼Œç”¨äºå¹³æ»‘æ‰“å­—æœºæ•ˆæœ</span>
  <span class="hljs-keyword">const</span> bufferRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> typingTimerRef = useRef&lt;<span class="hljs-built_in">any</span>&gt;(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">const</span> typingSpeedRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">120</span>) <span class="hljs-comment">// æ‰“å­—é€Ÿåº¦ ms</span>
  <span class="hljs-keyword">const</span> typingStepRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">1</span>)    <span class="hljs-comment">// æ¯æ¬¡æ¸²æŸ“å­—ç¬¦æ•°</span>
  
  <span class="hljs-keyword">let</span> <span class="hljs-attr">requestTask</span>: <span class="hljs-title class_">RequestTask</span>&lt;<span class="hljs-built_in">any</span>&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

  <span class="hljs-comment">/**
   * å°†æ¥æ”¶åˆ°çš„ç‰‡æ®µè¿½åŠ åˆ°ç¼“å†²æ± ï¼Œå¹¶å¯åŠ¨æ‰“å­—æœº
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">appendChunk</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">if</span> (!text) <span class="hljs-keyword">return</span>
    bufferRef.<span class="hljs-property">current</span> += text
    <span class="hljs-title function_">setContent</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> prev + text)
    
    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰å®šæ—¶å™¨åœ¨è·‘ï¼Œå°±å¯åŠ¨ä¸€ä¸ª</span>
    <span class="hljs-keyword">if</span> (!typingTimerRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> msPerChar = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">10</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-number">1000</span> / typingSpeedRef.<span class="hljs-property">current</span>))
      typingTimerRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (!bufferRef.<span class="hljs-property">current</span>) {
          <span class="hljs-keyword">return</span>
        }
        <span class="hljs-keyword">const</span> step = typingStepRef.<span class="hljs-property">current</span>
        <span class="hljs-comment">// ä»ç¼“å†²æ± å¤´éƒ¨åˆ‡å‡ºå­—ç¬¦</span>
        <span class="hljs-keyword">const</span> take = bufferRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, step)
        bufferRef.<span class="hljs-property">current</span> = bufferRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">slice</span>(step)
        <span class="hljs-title function_">setDisplayContent</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> prev + take)
      }, msPerChar)
    }
  }

  <span class="hljs-comment">/**
   * åŠ¨æ€è°ƒæ•´æ‰“å­—æœºé€Ÿåº¦ï¼ˆå¯é€‰ï¼‰
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">setTyping</span>(<span class="hljs-params">opts: { speed?: <span class="hljs-built_in">number</span>; step?: <span class="hljs-built_in">number</span> } = {}</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts.<span class="hljs-property">speed</span> === <span class="hljs-string">'number'</span> &amp;&amp; opts.<span class="hljs-property">speed</span> &gt; <span class="hljs-number">0</span>) {
      typingSpeedRef.<span class="hljs-property">current</span> = opts.<span class="hljs-property">speed</span>
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts.<span class="hljs-property">step</span> === <span class="hljs-string">'number'</span> &amp;&amp; opts.<span class="hljs-property">step</span> &gt; <span class="hljs-number">0</span>) {
      typingStepRef.<span class="hljs-property">current</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(opts.<span class="hljs-property">step</span>))
    }
    <span class="hljs-comment">// é‡ç½®å®šæ—¶å™¨é€»è¾‘ç•¥...ï¼ˆå‚è€ƒå®Œæ•´ä»£ç ï¼‰</span>
  }

  <span class="hljs-comment">/**
   * å‘èµ·å¯¹è¯è¯·æ±‚
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params">params: ChatMessage</span>) {
    <span class="hljs-keyword">const</span> url = apiUrl + <span class="hljs-string">'/api/web/member/v1/pets/stream/chat'</span>
    <span class="hljs-keyword">const</span> header = {
      <span class="hljs-title class_">Authorization</span>: <span class="hljs-title function_">getAuthorization</span>(),
      <span class="hljs-title class_">Accept</span>: <span class="hljs-string">'text/event-stream'</span>, <span class="hljs-comment">// å‘Šè¯‰æœåŠ¡ç«¯æˆ‘è¦æµ</span>
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
    }

    <span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span> <span class="hljs-comment">// ç”¨äºå¤„ç† SSE åˆ†åŒ…/ç²˜åŒ…çš„å±€éƒ¨ buffer</span>

    <span class="hljs-comment">// è§£ç å™¨ï¼šArrayBuffer -&gt; String</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">arr: <span class="hljs-built_in">ArrayBuffer</span> | <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> arr === <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span> arr
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> uint8Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoding</span>.<span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'utf-8'</span>).<span class="hljs-title function_">decode</span>(uint8Array)
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-comment">// é™çº§å¤„ç†</span>
        <span class="hljs-keyword">const</span> ints = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr)
        <span class="hljs-keyword">let</span> str = <span class="hljs-string">''</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; ints.<span class="hljs-property">length</span>; i++) {
          str += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(ints[i])
        }
        <span class="hljs-keyword">return</span> str
      }
    }

    <span class="hljs-comment">// SSE åè®®è§£æå™¨</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">parseSSE</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>[] {
      buffer += text
      <span class="hljs-comment">// SSE æ¶ˆæ¯é€šå¸¸ä»¥ \n\n ç»“å°¾</span>
      <span class="hljs-keyword">const</span> blocks = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n\n'</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">b</span>) =&gt;</span> b.<span class="hljs-title function_">trim</span>().<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>)
      
      <span class="hljs-comment">// å¦‚æœæœ€åä¸€ä¸ªå—ä¸æ˜¯ä»¥ \n\n ç»“å°¾ï¼Œè¯´æ˜æ•°æ®æ²¡ä¼ å®Œï¼Œæ”¾å› buffer ç­‰å¾…ä¸‹ä¸€æ¬¡</span>
      <span class="hljs-keyword">if</span> (!buffer.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'\n\n'</span>) &amp;&amp; blocks.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        buffer = blocks.<span class="hljs-title function_">pop</span>() || <span class="hljs-string">''</span>
      } <span class="hljs-keyword">else</span> {
        buffer = <span class="hljs-string">''</span>
      }
      
      <span class="hljs-keyword">const</span> <span class="hljs-attr">out</span>: <span class="hljs-built_in">string</span>[] = []
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> blk <span class="hljs-keyword">of</span> blocks) {
        <span class="hljs-keyword">const</span> lines = blk.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)
        <span class="hljs-comment">// æå– data: å¼€å¤´çš„æ•°æ®</span>
        <span class="hljs-keyword">const</span> dataLines = lines.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">l</span>) =&gt;</span> l.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'data:'</span>))
        <span class="hljs-keyword">if</span> (dataLines.<span class="hljs-property">length</span>) {
          <span class="hljs-keyword">const</span> payload = dataLines.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">l</span>) =&gt;</span> l.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^data:\s*/</span>, <span class="hljs-string">''</span>)).<span class="hljs-title function_">join</span>(<span class="hljs-string">'  \n'</span>)
          out.<span class="hljs-title function_">push</span>(payload)
        }
      }
      <span class="hljs-keyword">return</span> out
    }

    <span class="hljs-comment">// ğŸš€ æ ¸å¿ƒè¯·æ±‚é€»è¾‘</span>
    requestTask = <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">request</span>({
      url,
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      header,
      <span class="hljs-attr">data</span>: params,
      <span class="hljs-attr">enableChunked</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ğŸ‘ˆ å¼€å¯åˆ†å—ä¼ è¾“ï¼Œå…³é”®ï¼</span>
      <span class="hljs-attr">responseType</span>: <span class="hljs-string">'arraybuffer'</span>, <span class="hljs-comment">// ğŸ‘ˆ å¿…é¡»æ¥æ”¶äºŒè¿›åˆ¶ï¼Œå¦åˆ™ä¸­æ–‡ä¹±ç </span>
      <span class="hljs-attr">enableHttp2</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ğŸ‘ˆ é¿å… HTTP/2 åè®®æŠ¥é”™ï¼Œåé¢ä¼šç»†è¯´</span>
      <span class="hljs-attr">timeout</span>: <span class="hljs-number">60000</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> {},
      <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯·æ±‚é”™è¯¯'</span>, err),
      <span class="hljs-attr">complete</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¯·æ±‚å®Œæˆ'</span>)
    })

    requestTask.<span class="hljs-title function_">onHeadersReceived</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿æ¥æˆåŠŸ'</span>))
    
    <span class="hljs-comment">// ç›‘å¬æ•°æ®åŒ…</span>
    requestTask.<span class="hljs-title function_">onChunkReceived</span>(<span class="hljs-function">(<span class="hljs-params">res: { data: <span class="hljs-built_in">ArrayBuffer</span> }</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> text = <span class="hljs-title function_">decode</span>(res.<span class="hljs-property">data</span>)
      <span class="hljs-keyword">const</span> msgs = <span class="hljs-title function_">parseSSE</span>(text)
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> msgs) {
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥åšä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦å¤„ç†ï¼Œæ¯”å¦‚ markdown çš„å¤„ç†</span>
        <span class="hljs-keyword">const</span> _chunk = <span class="hljs-title class_">String</span>(chunk).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(#+)/</span>, <span class="hljs-string">'$1 '</span>)
        <span class="hljs-title function_">appendChunk</span>(_chunk)
      }
    })
  }

  <span class="hljs-keyword">return</span> {
    chat,
    <span class="hljs-attr">close</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (requestTask) {
        requestTask.<span class="hljs-title function_">abort</span>()
        requestTask = <span class="hljs-literal">null</span>
      }
      <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨é€»è¾‘...</span>
    },
    content,
    displayContent, <span class="hljs-comment">// UI ç»‘å®šè¿™ä¸ª</span>
    setTyping
  }
}
</code></pre>
<h3 data-id="heading-4">3. UI ç»„ä»¶å®ç°ï¼šMarkdown æ¸²æŸ“ + å…‰æ ‡åŠ¨ç”»</h3>
<p>å‰ç«¯å±•ç¤ºä¸ä»…è¦æµå¼å‡ºå­—ï¼Œè¿˜å¾—æ”¯æŒ Markdownï¼ˆä»£ç é«˜äº®ã€è¡¨æ ¼ç­‰ï¼‰ã€‚å°ç¨‹åºé‡Œæ¨èä½¿ç”¨ <code>towxml</code> æˆ–ç±»ä¼¼çš„åº“ã€‚åŒæ—¶ï¼Œä¸ºäº†æ‹ŸçœŸï¼Œæˆ‘ä»¬åŠ ä¸ªé—ªçƒçš„å…‰æ ‡ã€‚</p>
<p><code>index.tsx</code>:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { memo, <span class="hljs-variable constant_">FC</span>, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Text</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tarojs/components'</span>
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./index.module.less'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatMessage</span>, useSSE } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../useSSE'</span>
<span class="hljs-comment">// å‡è®¾ä½ å¼•å…¥äº† towxml ç»„ä»¶</span>
<span class="hljs-keyword">import</span> towxmlFun <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../../components/towxml'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MMLoading</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@wmeimob/taro-design'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IStreamMessasgeProps</span> {
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">ChatMessage</span>
  showTip?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Component</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">IStreamMessasgeProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { params, showTip = <span class="hljs-literal">true</span> } = props
  <span class="hljs-keyword">const</span> { chat, displayContent } = <span class="hljs-title function_">useSSE</span>()

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">chat</span>(params)
  }, [])

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.chatItem_ai}</span>&gt;</span>
      {!displayContent ? (
        // æ€è€ƒæ—¶çš„ Loading çŠ¶æ€
        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.ai_loading}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>AI æ­£åœ¨ç–¯ç‹‚çƒ§è„‘ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">MMLoading</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
      ) : (
        <span class="hljs-tag">&lt;&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.aiBubble}</span>&gt;</span>
            {/* Markdown æ¸²æŸ“åŒºåŸŸ */}
            <span class="hljs-tag">&lt;<span class="hljs-name">towxml</span> <span class="hljs-attr">nodes</span>=<span class="hljs-string">{towxmlFun(displayContent,</span> '<span class="hljs-attr">markdown</span>')} /&gt;</span>
            {/* æ¨¡æ‹Ÿå…‰æ ‡ */}
            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.cursor}</span> /&gt;</span> 
          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
          {showTip &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.aiTitle}</span>&gt;</span>å›ç­”ç”±AIç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒå¤‡ä»½<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>}
        <span class="hljs-tag">&lt;/&gt;</span></span>
      )}
    &lt;/<span class="hljs-title class_">View</span>&gt;
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Component</span>)
</code></pre>
<p><code>index.module.less</code> (å…‰æ ‡åŠ¨ç”»):</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.cursor</span> {
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">vertical-align</span>: bottom;
  <span class="hljs-attribute">animation</span>: blink <span class="hljs-number">1s</span> step-start infinite;
}

<span class="hljs-keyword">@keyframes</span> blink {
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }
}
</code></pre>
<h2 data-id="heading-5">ğŸŒ©ï¸ æœåŠ¡ç«¯é…ç½®ï¼šNginx çš„é‚£äº›å‘</h2>
<p>å¾ˆå¤šåŒå­¦å‰ç«¯ä»£ç å†™å¾—å®Œç¾æ— ç¼ºï¼Œä¸€è·‘èµ·æ¥ï¼š<strong>è¦ä¹ˆå¡é¡¿ï¼Œè¦ä¹ˆæŠ¥é”™ï¼Œè¦ä¹ˆå¹²è„†ä¸æµå¼ç›´æ¥è¿”å›ä¸€å¨æ•°æ®ã€‚</strong></p>
<p>è¿™é”…é€šå¸¸å¾— Nginx èƒŒã€‚ğŸ™…â€â™‚ï¸</p>
<p>Nginx é»˜è®¤ä¼šå¼€å¯ç¼“å†²ï¼ˆBufferingï¼‰ï¼Œå®ƒæƒ³å­˜å¤Ÿä¸€æ³¢æ•°æ®å†å‘ç»™å®¢æˆ·ç«¯ï¼Œè¿™ç›´æ¥æŠŠæˆ‘ä»¬çš„â€œæµâ€ç»™æˆªæ–­äº†ã€‚</p>
<h3 data-id="heading-6">1. é»„é‡‘ Nginx é…ç½®</h3>
<p>è¯·æŠŠè¿™æ®µé…ç½®ç„Šæ­»åœ¨ä½ çš„ Nginx é…ç½®æ–‡ä»¶é‡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini">location /api/web/member/v1/pets/stream/chat {
    <span class="hljs-comment"># 1. å…³é”®ï¼šå…³é—­æ‰€æœ‰ç¼“å†²</span>
    proxy_buffering off<span class="hljs-comment">;</span>
    proxy_cache off<span class="hljs-comment">;</span>
    proxy_request_buffering off<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 2. ç¦ç”¨ gzip å‹ç¼© (å‹ç¼©éœ€è¦ç¼“å†²åŒºï¼Œä¼šç ´åæµå¼)</span>
    gzip off<span class="hljs-comment">;</span>

    <span class="hljs-comment"># 3. HTTP åè®®è®¾ç½®</span>
    proxy_http_version 1.1<span class="hljs-comment">;</span>
    proxy_set_header Connection ''<span class="hljs-comment">; # æ¸…ç©º Connection å¤´ï¼Œä¿æŒé•¿è¿æ¥</span>

    <span class="hljs-comment"># 4. ç¼–ç è®¾ç½®</span>
    chunked_transfer_encoding on<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 5. ç¦ç”¨ Nginx çš„åŠ é€Ÿç¼“å†² (X-Accel-Buffering)</span>
    proxy_set_header X-Accel-Buffering no<span class="hljs-comment">;</span>
    proxy_hide_header X-Accel-Buffering<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 6. è¶…æ—¶è®¾ç½® (æµå¼å“åº”é€šå¸¸æ—¶é—´è¾ƒé•¿)</span>
    proxy_read_timeout 24h<span class="hljs-comment">;</span>
    proxy_send_timeout 24h<span class="hljs-comment">;</span>

    <span class="hljs-comment"># 7. å“åº”å¤´å¤„ç†</span>
    add_header Cache-Control "no-cache"<span class="hljs-comment">;</span>
    add_header X-Accel-Buffering "no"<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 8. å¼ºåˆ¶å°ç¼“å†²åŒº (é¿å… Nginx è‡ªä½œä¸»å¼ å­˜æ•°æ®)</span>
    proxy_buffer_size 1k<span class="hljs-comment">;</span>
    proxy_buffers 4 1k<span class="hljs-comment">;</span>
    proxy_busy_buffers_size 1k<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># è½¬å‘åˆ°ä½ çš„åç«¯æœåŠ¡...</span>
    proxy_pass http://backend_service<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-7">ğŸ› å¸¸è§æŠ¥é”™ä¸ç¥å‘æ’æŸ¥</h2>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢è¿™ä¸¤ä¸ªâ€œé¡¶çº§â€é”™è¯¯ï¼Œæˆ‘éƒ½ç¢°åˆ°è¿‡ï¼Œè¿™é‡Œç›´æ¥ç»™è§£æ³•ã€‚</p>
<h3 data-id="heading-8">âŒ é”™è¯¯ 1: <code>net::ERR_INCOMPLETE_CHUNKED_ENCODING</code></h3>
<p><strong>ç°è±¡</strong>ï¼š æ§åˆ¶å°æŠ¥é”™ <code>POST net::ERR_INCOMPLETE_CHUNKED_ENCODING 200</code>ã€‚è™½ç„¶çŠ¶æ€ç æ˜¯ 200ï¼Œæ•°æ®ä¹Ÿæ”¶åˆ°äº†ï¼Œä½†å°±æ˜¯çº¢ä¸€ç‰‡ã€‚</p>
<p><strong>åŸå› </strong>ï¼š è¿™æ˜¯å› ä¸ºæœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯ <code>Transfer-Encoding: chunked</code>ï¼Œä½†åœ¨æµç»“æŸæ—¶ï¼Œæ²¡æœ‰å‘é€æ ‡å‡†çš„ç»ˆæ­¢å—ï¼ˆ<code>0\r\n\r\n</code>ï¼‰ï¼Œæˆ–è€…ä¸­é—´ä»£ç†ï¼ˆæ¯”å¦‚å…¬å¸ç½‘å…³ã€WAFï¼‰æå‰æŠŠè¿æ¥åˆ‡æ–­äº†ã€‚</p>
<p><strong>è§£æ³•</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥åç«¯ä»£ç ï¼Œç¡®ä¿æµç»“æŸæ—¶æ­£ç¡®å…³é—­äº† Writerã€‚</li>
<li>å¦‚æœåœ¨å¼€å‘å·¥å…·é‡Œçœ‹åˆ°è¿™ä¸ªï¼Œåªè¦æ•°æ®æ¥æ”¶å®Œæ•´ï¼Œ<strong>å¯ä»¥å¿½ç•¥</strong>ã€‚è¿™å¾€å¾€æ˜¯å¼€å‘å·¥å…·å¯¹è¿æ¥å…³é—­çŠ¶æ€çš„è¯¯åˆ¤ã€‚</li>
</ol>
<h3 data-id="heading-9">âŒ é”™è¯¯ 2: <code>net::ERR_HTTP2_PROTOCOL_ERROR</code></h3>
<p><strong>ç°è±¡</strong>ï¼š æµå¼ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œéšæœºä¸­æ–­ï¼ŒæŠ¥é”™ <code>net::ERR_HTTP2_PROTOCOL_ERROR</code>ã€‚</p>
<p><strong>ç¡¬æ ¸åˆ†æ</strong>ï¼š è¿™æ˜¯å¾®ä¿¡å°ç¨‹åºç½‘ç»œæ ˆåœ¨ <strong>HTTP/2</strong> ä¸‹å¤„ç† <strong>Chunked å“åº”</strong> çš„å·²çŸ¥ä¸ç¨³å®šç‚¹ã€‚å½“ä½ çš„åŸŸåå¼€å¯äº† HTTP/2ï¼Œä¸”ä½¿ç”¨äº† <code>wx.request</code> + <code>enableChunked</code> æ—¶ï¼Œå¾®ä¿¡å®¢æˆ·ç«¯åº•å±‚åœ¨å¤„ç†åˆ†å—æ—¶æå…¶å®¹æ˜“å´©æºƒã€‚</p>
<p><strong>ç»ˆæè§£æ³•</strong>ï¼š <strong>é™çº§åˆ° HTTP/1.1</strong>ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨å‰ç«¯ä»£ç é‡Œå†™äº† <code>enableHttp2: false</code>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">requestTask = Taro.<span class="hljs-built_in">request</span>({
  <span class="hljs-comment">// ... å…¶ä»–é…ç½®</span>
  enableHttp2: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ğŸ‘ˆ æ•‘å‘½ç¨»è‰</span>
})
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šæœ‰æ—¶å€™å‰ç«¯è®¾ç½® <code>enableHttp2: false</code> è¿˜ä¸å¤Ÿï¼Œå› ä¸ºå¾®ä¿¡åº•å±‚å¯èƒ½è¿˜æ˜¯ä¼šå¤ç”¨ä¹‹å‰çš„ H2 è¿æ¥ã€‚æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯ <strong>æœåŠ¡ç«¯é’ˆå¯¹è¯¥æµå¼æ¥å£å¼ºåˆ¶åªèµ° HTTP/1.1</strong>ï¼Œæˆ–è€…å¹²è„†æŠŠæµå¼æ¥å£æŒ‚è½½åˆ°ä¸€ä¸ªæ²¡æœ‰å¼€å¯ H2 çš„å­åŸŸåä¸‹ã€‚</p>
<h2 data-id="heading-10">ğŸ“ æ€»ç»“</h2>
<p>åœ¨å°ç¨‹åºé‡Œåšå¤§æ¨¡å‹æµå¼è¾“å‡ºï¼Œå…¶å®å°±æ˜¯ä¸€åœº <strong>â€œå‰ç«¯ + ç½‘ç»œ + åç«¯â€</strong> çš„ç»¼åˆæˆ˜å½¹ã€‚</p>
<ol>
<li><strong>å‰ç«¯</strong>ï¼šTaro + <code>enableChunked</code> æ˜¯åŸºç¡€ï¼ŒTextDecoder + Buffer é˜Ÿåˆ—æ˜¯æ ¸å¿ƒã€‚</li>
<li><strong>ä½“éªŒ</strong>ï¼šä¸è¦ç›´æ¥æ¸²æŸ“ï¼Œç”¨å®šæ—¶å™¨åšä¸ªç¼“å†²æ± ï¼Œæ¨¡æ‹Ÿâ€œæ‰“å­—æœºâ€æ•ˆæœï¼Œä¸æ»‘åº¦æå‡ 10 å€ã€‚</li>
<li><strong>åç«¯</strong>ï¼šNginx å¿…é¡»å…³é—­ Bufferingï¼Œå¦åˆ™æµå¼å˜é˜»å¡ã€‚</li>
<li><strong>é¿å‘</strong>ï¼šHTTP/2 æ˜¯æµå¼çš„å¤§æ•Œï¼Œé‡åˆ°è¯¡å¼‚æ–­è¿ï¼Œè¯·æœæ–­åˆ‡å› HTTP/1.1ã€‚</li>
</ol>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ å°‘æ‰å‡ æ ¹å¤´å‘ï¼å¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œ<strong>ç‚¹èµã€æ”¶è—ã€è½¬å‘</strong> ä¸‰è¿èµ°èµ·ï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WXT æ¡†æ¶ä¸‹çš„ Window å¯¹è±¡è·å–]]></title>    <link>https://juejin.cn/post/7575469988737007625</link>    <guid>https://juejin.cn/post/7575469988737007625</guid>    <pubDate>2025-11-24T01:24:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575469988737007625" data-draft-id="7575182522411302950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WXT æ¡†æ¶ä¸‹çš„ Window å¯¹è±¡è·å–"/> <meta itemprop="keywords" content="å‰ç«¯,æµè§ˆå™¨"/> <meta itemprop="datePublished" content="2025-11-24T01:24:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å®ä¹ ç”Ÿå°é»„"/> <meta itemprop="url" content="https://juejin.cn/user/3246201392868637"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WXT æ¡†æ¶ä¸‹çš„ Window å¯¹è±¡è·å–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3246201392868637/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å®ä¹ ç”Ÿå°é»„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:24:23.000Z" title="Mon Nov 24 2025 01:24:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨æµè§ˆå™¨æ‰©å±•å¼€å‘ä¸­ï¼ŒContent Scriptï¼ˆå†…å®¹è„šæœ¬ï¼‰è¿è¡Œåœ¨ä¸ç½‘é¡µç›¸åŒçš„ç¯å¢ƒä¸­ï¼Œä½†ç”±äºå…¶å¤„äºéš”ç¦»çš„æ‰§è¡Œç¯å¢ƒï¼ˆIsolated Worldï¼‰ï¼Œæ— æ³•ç›´æ¥è®¿é—®ç½‘é¡µçš„ JavaScript ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ <code>window</code> å¯¹è±¡çš„è‡ªå®šä¹‰å±æ€§ã€‚è¿™åœ¨éœ€è¦è·å–é¡µé¢ç‰¹å®šæ•°æ®æ—¶ï¼ˆå¦‚ Etsy åº—é“ºçš„ <code>shopId</code>ã€è®¢å•çŠ¶æ€ç­‰ï¼‰ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>æœ¬æ–‡æ¡£åŸºäºå®é™…é¡¹ç›®ç»éªŒï¼Œè¯¦ç»†ä»‹ç»äº†åœ¨ WXT æ¡†æ¶ä¸‹è·å–é¡µé¢ <code>window</code> å¯¹è±¡çš„å‡ ç§æ–¹æ¡ˆï¼Œå¹¶æä¾›äº†å®Œæ•´çš„å®ç°ä»£ç å’Œå¯¹æ¯”åˆ†æã€‚</p>
<h2 data-id="heading-1">éœ€æ±‚</h2>
<p>åœ¨å¼€å‘ Etsy è®¢å•ç®¡ç†æ‰©å±•æ—¶ï¼Œéœ€è¦ä»é¡µé¢çš„ <code>window</code> å¯¹è±¡ä¸­è·å–ä»¥ä¸‹æ•°æ®ï¼š</p>
<ol>
<li><strong>åº—é“º IDï¼ˆshopIdï¼‰</strong>ï¼š<code>window.Etsy.Context.data.shop_id</code></li>
<li><strong>è®¢å•çŠ¶æ€åˆ—è¡¨ï¼ˆorderStatesï¼‰</strong>ï¼š<code>window.Etsy.Context.data.order_states</code></li>
</ol>
<p>è¿™äº›æ•°æ®å­˜å‚¨åœ¨é¡µé¢çš„ä¸»ä¸–ç•Œï¼ˆMain Worldï¼‰ä¸­ï¼Œè€Œ Content Script è¿è¡Œåœ¨éš”ç¦»ä¸–ç•Œï¼ˆIsolated Worldï¼‰ï¼Œæ— æ³•ç›´æ¥è®¿é—®ã€‚</p>
<h2 data-id="heading-2">æ–¹æ¡ˆ</h2>
<h3 data-id="heading-3">æ–¹æ¡ˆä¸€ï¼šweb_accessible_resources + window.postMessage</h3>
<h4 data-id="heading-4">åŸç†</h4>
<p>é€šè¿‡åœ¨ <code>manifest.json</code> ä¸­é…ç½® <code>web_accessible_resources</code>ï¼Œå°†è„šæœ¬æ–‡ä»¶æ³¨å…¥åˆ°é¡µé¢çš„ä¸»ä¸–ç•Œï¼ˆMain Worldï¼‰ï¼Œä½¿å…¶èƒ½å¤Ÿç›´æ¥è®¿é—®é¡µé¢çš„ <code>window</code> å¯¹è±¡ã€‚ä½¿ç”¨ <code>window.postMessage</code> åœ¨ Content Script å’Œæ³¨å…¥è„šæœ¬ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡ã€‚</p>
<h4 data-id="heading-5">å®ç°æµç¨‹</h4>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ³¨å…¥è„šæœ¬æ–‡ä»¶ï¼ˆå¦‚ <code>page-inject.js</code>ï¼‰ï¼Œç”¨äºåœ¨ä¸»ä¸–ç•Œä¸­æ‰§è¡Œä»£ç </li>
<li>åœ¨ <code>wxt.config.ts</code> ä¸­é…ç½® <code>web_accessible_resources</code>ï¼Œå°†è„šæœ¬æŒ‡å®šä¸ºå¯è®¿é—®èµ„æº</li>
<li>åœ¨ Content Script ä¸­åŠ¨æ€åˆ›å»º <code>&lt;script&gt;</code> æ ‡ç­¾ï¼Œå°†è„šæœ¬æ³¨å…¥åˆ°é¡µé¢ä¸­</li>
<li>ä½¿ç”¨ <code>window.postMessage</code> åœ¨ Content Script å’Œæ³¨å…¥è„šæœ¬ä¹‹é—´è¿›è¡Œé€šä¿¡</li>
</ol>
<h4 data-id="heading-6">ä»£ç å®ç°</h4>
<p><strong>1. åˆ›å»ºæ³¨å…¥è„šæœ¬ï¼ˆ<code>public/page-inject.js</code>ï¼‰</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * æ³¨å…¥åˆ°é¡µé¢ä¸»ä¸–ç•Œçš„è„šæœ¬
 * ç”¨äºç›´æ¥è®¿é—®é¡µé¢çš„ window å¯¹è±¡ï¼Œè·å– Etsy ç›¸å…³æ•°æ®
 */</span>
(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-string">"use strict"</span>;

  <span class="hljs-comment">// ç›‘å¬æ¥è‡ªéš”ç¦»ä¸–ç•Œï¼ˆISOLATED worldï¼‰çš„ content script çš„æ¶ˆæ¯</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"message"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {
    <span class="hljs-comment">// ç¡®ä¿æ¶ˆæ¯æ¥è‡ªå½“å‰çª—å£</span>
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">source</span> !== <span class="hljs-variable language_">window</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// æ£€æŸ¥æ¶ˆæ¯ç±»å‹</span>
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span> &amp;&amp; event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">"get-etsy-data"</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// åœ¨ä¸»ä¸–ç•Œä¸­ç›´æ¥è®¿é—® window.Etsy.Context.data å¯¹è±¡</span>
        <span class="hljs-keyword">const</span> etsyData = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Etsy</span>?.<span class="hljs-property">Context</span>?.<span class="hljs-property">data</span>;

        <span class="hljs-keyword">if</span> (etsyData) {
          <span class="hljs-keyword">const</span> shopId = etsyData.<span class="hljs-property">shop_id</span>;
          <span class="hljs-keyword">const</span> orderStates = etsyData.<span class="hljs-property">order_states</span>;

          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"âœ… [ä¸»ä¸–ç•Œ] æˆåŠŸè·å– Etsy æ•°æ®"</span>);

          <span class="hljs-comment">// å‘é€å“åº”å›éš”ç¦»ä¸–ç•Œ</span>
          <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
            {
              <span class="hljs-attr">type</span>: <span class="hljs-string">"etsy-data-response"</span>,
              <span class="hljs-attr">requestId</span>: event.<span class="hljs-property">data</span>.<span class="hljs-property">requestId</span>,
              <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">shopId</span>: shopId,
              <span class="hljs-attr">orderStates</span>: orderStates,
            },
            <span class="hljs-string">"*"</span>
          );
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// å‘é€é”™è¯¯å“åº”</span>
          <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
            {
              <span class="hljs-attr">type</span>: <span class="hljs-string">"etsy-data-response"</span>,
              <span class="hljs-attr">requestId</span>: event.<span class="hljs-property">data</span>.<span class="hljs-property">requestId</span>,
              <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">error</span>: <span class="hljs-string">"æ— æ³•è·å– Etsy æ•°æ®ï¼Œè¯·ç¡®ä¿åœ¨ Etsy åº—é“ºç®¡ç†é¡µé¢æ‰“å¼€æ­¤æ‰©å±•"</span>,
            },
            <span class="hljs-string">"*"</span>
          );
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// å‘é€é”™è¯¯å“åº”</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
          {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"etsy-data-response"</span>,
            <span class="hljs-attr">requestId</span>: event.<span class="hljs-property">data</span>.<span class="hljs-property">requestId</span>,
            <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">error</span>: error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">"æœªçŸ¥é”™è¯¯"</span>,
          },
          <span class="hljs-string">"*"</span>
        );
      }
    }
  });

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"âœ… [ä¸»ä¸–ç•Œ] page-inject.js å·²åŠ è½½ï¼Œå¯ä»¥è®¿é—® window.Etsy å¯¹è±¡"</span>);
})();
</code></pre>
<p><strong>2. é…ç½® WXTï¼ˆ<code>wxt.config.ts</code>ï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'wxt'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">modules</span>: [<span class="hljs-string">'@wxt-dev/module-vue'</span>],
  <span class="hljs-attr">manifest</span>: {
    <span class="hljs-attr">web_accessible_resources</span>: [
      {
        <span class="hljs-attr">resources</span>: [<span class="hljs-string">'page-inject.js'</span>],
        <span class="hljs-attr">matches</span>: [<span class="hljs-string">'*://*.etsy.com/*'</span>],
        <span class="hljs-attr">use_dynamic_url</span>: <span class="hljs-literal">true</span>,
      },
    ],
  },
});
</code></pre>
<p><strong>3. Content Script å®ç°ï¼ˆ<code>entrypoints/content.ts</code>ï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * æ³¨å…¥è„šæœ¬åˆ°é¡µé¢ä¸»ä¸–ç•Œ
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">injectScript</span>(<span class="hljs-params">scriptPath: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-comment">// æ£€æŸ¥è„šæœ¬æ˜¯å¦å·²ç»æ³¨å…¥</span>
    <span class="hljs-keyword">const</span> scriptId = <span class="hljs-string">`injected-script-<span class="hljs-subst">${scriptPath}</span>`</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(scriptId)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`âœ… [éš”ç¦»ä¸–ç•Œ] è„šæœ¬ <span class="hljs-subst">${scriptPath}</span> å·²å­˜åœ¨ï¼Œè·³è¿‡æ³¨å…¥`</span>);
      <span class="hljs-title function_">resolve</span>();
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"script"</span>);
    script.<span class="hljs-property">id</span> = scriptId;
    script.<span class="hljs-property">src</span> = browser.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">getURL</span>(scriptPath <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>);
    script.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`âœ… [éš”ç¦»ä¸–ç•Œ] è„šæœ¬ <span class="hljs-subst">${scriptPath}</span> æ³¨å…¥æˆåŠŸ`</span>);
      <span class="hljs-title function_">resolve</span>();
    };
    script.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`âŒ [éš”ç¦»ä¸–ç•Œ] è„šæœ¬ <span class="hljs-subst">${scriptPath}</span> æ³¨å…¥å¤±è´¥`</span>);
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`è„šæœ¬ <span class="hljs-subst">${scriptPath}</span> æ³¨å…¥å¤±è´¥`</span>));
    };
    (<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>).<span class="hljs-title function_">appendChild</span>(script);
  });
}

<span class="hljs-comment">/**
 * é€šè¿‡ postMessage ä¸ä¸»ä¸–ç•Œè„šæœ¬é€šä¿¡ï¼Œè·å– Etsy æ•°æ®
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getEtsyDataFromMainWorld</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;{
  <span class="hljs-attr">success</span>: <span class="hljs-built_in">boolean</span>;
  shopId?: <span class="hljs-built_in">number</span>;
  orderStates?: <span class="hljs-title class_">OrderState</span>[];
  error?: <span class="hljs-built_in">string</span>;
}&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">async</span> (resolve, reject) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// ç¡®ä¿æ³¨å…¥è„šæœ¬å·²åŠ è½½</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">injectScript</span>(<span class="hljs-string">"page-inject.js"</span>);

      <span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€çš„è¯·æ±‚ ID</span>
      <span class="hljs-keyword">const</span> requestId = <span class="hljs-string">`etsy-data-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>-<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random()}</span>`</span>;

      <span class="hljs-comment">// è®¾ç½®è¶…æ—¶ï¼Œé¿å…æ— é™ç­‰å¾…</span>
      <span class="hljs-keyword">const</span> timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"message"</span>, handleResponse);
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"è·å– Etsy æ•°æ®è¶…æ—¶ï¼Œä¸»ä¸–ç•Œè„šæœ¬å¯èƒ½æœªå“åº”"</span>));
      }, <span class="hljs-number">5000</span>); <span class="hljs-comment">// 5ç§’è¶…æ—¶</span>

      <span class="hljs-comment">// å¤„ç†å“åº”</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleResponse</span>(<span class="hljs-params">event: MessageEvent</span>) {
        <span class="hljs-comment">// ç¡®ä¿æ¶ˆæ¯æ¥è‡ªå½“å‰çª—å£</span>
        <span class="hljs-keyword">if</span> (event.<span class="hljs-property">source</span> !== <span class="hljs-variable language_">window</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// æ£€æŸ¥æ¶ˆæ¯ç±»å‹å’Œè¯·æ±‚ ID</span>
        <span class="hljs-keyword">if</span> (
          event.<span class="hljs-property">data</span> &amp;&amp;
          event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">"etsy-data-response"</span> &amp;&amp;
          event.<span class="hljs-property">data</span>.<span class="hljs-property">requestId</span> === requestId
        ) {
          <span class="hljs-built_in">clearTimeout</span>(timeout);
          <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"message"</span>, handleResponse);

          <span class="hljs-keyword">const</span> { success, shopId, orderStates, error } = event.<span class="hljs-property">data</span>;

          <span class="hljs-keyword">if</span> (success &amp;&amp; shopId !== <span class="hljs-literal">undefined</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"âœ… [éš”ç¦»ä¸–ç•Œ] æˆåŠŸä»ä¸»ä¸–ç•Œè·å– Etsy æ•°æ®"</span>);
            <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, shopId, orderStates });
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"âš ï¸ [éš”ç¦»ä¸–ç•Œ] ä»ä¸»ä¸–ç•Œè·å– Etsy æ•°æ®å¤±è´¥:"</span>, error);
            <span class="hljs-title function_">resolve</span>({
              <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">error</span>: error || <span class="hljs-string">"æ— æ³•è·å– Etsy æ•°æ®"</span>,
            });
          }
        }
      }

      <span class="hljs-comment">// ç›‘å¬å“åº”æ¶ˆæ¯</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"message"</span>, handleResponse);

      <span class="hljs-comment">// å‘é€è¯·æ±‚åˆ°ä¸»ä¸–ç•Œ</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
        {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"get-etsy-data"</span>,
          <span class="hljs-attr">requestId</span>: requestId,
        },
        <span class="hljs-string">"*"</span>
      );
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ğŸ“¤ [éš”ç¦»ä¸–ç•Œ] å·²å‘é€è·å– Etsy æ•°æ®è¯·æ±‚åˆ°ä¸»ä¸–ç•Œ"</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"âŒ [éš”ç¦»ä¸–ç•Œ] è·å– Etsy æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:"</span>, error);
      <span class="hljs-title function_">reject</span>(error);
    }
  });
}
</code></pre>
<h4 data-id="heading-7">ä¼˜ç‚¹</h4>
<ul>
<li>âœ… å®ç°ç›¸å¯¹ç®€å•ï¼Œé€»è¾‘æ¸…æ™°</li>
<li>âœ… å…¼å®¹æ€§å¥½ï¼Œé€‚ç”¨äºæ‰€æœ‰æ”¯æŒ Manifest V3 çš„æµè§ˆå™¨</li>
<li>âœ… ä½¿ç”¨æ ‡å‡†çš„ <code>postMessage</code> APIï¼Œå®‰å…¨æ€§é«˜</li>
<li>âœ… ä¸éœ€è¦åºåˆ—åŒ–å‡½æ•°ï¼Œé¿å…å®‰å…¨é£é™©</li>
<li>âœ… åœ¨ WXT æ¡†æ¶ä¸­é…ç½®ç®€å•ï¼Œæ˜“äºç»´æŠ¤</li>
</ul>
<h4 data-id="heading-8">ç¼ºç‚¹</h4>
<ul>
<li>âš ï¸ éœ€è¦åœ¨ <code>manifest.json</code> ä¸­é…ç½® <code>web_accessible_resources</code></li>
<li>âš ï¸ éœ€è¦åŠ¨æ€æ³¨å…¥è„šæœ¬ï¼Œå¯èƒ½æœ‰åŠ è½½æ—¶åºé—®é¢˜ï¼ˆå¯é€šè¿‡ <code>onload</code> å›è°ƒè§£å†³ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-9">æ–¹æ¡ˆäºŒï¼šweb_accessible_resources + CustomEvent + å‡½æ•°åºåˆ—åŒ–</h3>
<h4 data-id="heading-10">åŸç†</h4>
<p>åŒæ ·é€šè¿‡ <code>web_accessible_resources</code> æ³¨å…¥è„šæœ¬åˆ°é¡µé¢ä¸»ä¸–ç•Œï¼Œä½†ä½¿ç”¨ <code>CustomEvent</code> è¿›è¡Œé€šä¿¡ï¼Œå¹¶é€šè¿‡å‡½æ•°åºåˆ—åŒ–çš„æ–¹å¼ä¼ é€’å¤æ‚é€»è¾‘ã€‚</p>
<h4 data-id="heading-11">å®ç°æµç¨‹</h4>
<ol>
<li>Content Script å°†éœ€è¦åœ¨é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„å‡½æ•°åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²</li>
<li>Content Script åˆ›å»ºå¹¶åˆ†å‘ä¸€ä¸ªåŒ…å«åºåˆ—åŒ–å‡½æ•°çš„ <code>CustomEvent</code></li>
<li>æ³¨å…¥è„šæœ¬ç›‘å¬è¯¥äº‹ä»¶ï¼Œååºåˆ—åŒ–å‡½æ•°å¹¶åœ¨é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ</li>
<li>æ‰§è¡Œç»“æœé€šè¿‡å¦ä¸€ä¸ª <code>CustomEvent</code> ä¼ å› Content Script</li>
</ol>
<h4 data-id="heading-12">ä»£ç ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Content Script ä¸­</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getMyData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">Etsy</span>?.<span class="hljs-property">Context</span>?.<span class="hljs-property">data</span>;
}

<span class="hljs-title function_">indexSendMessageToLucky</span>(<span class="hljs-string">'run-index-fun'</span>, {
  <span class="hljs-attr">function</span>: getMyData.<span class="hljs-title function_">toString</span>()
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'res--&gt;'</span>, res)
});

<span class="hljs-comment">// æ³¨å…¥è„šæœ¬ä¸­</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'custom-index-type'</span>, <span class="hljs-keyword">async</span> (e) =&gt; {
  <span class="hljs-keyword">const</span> { type, data } = e.<span class="hljs-property">detail</span>
  <span class="hljs-keyword">switch</span> (type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'run-index-fun'</span>: {
      <span class="hljs-keyword">const</span> fn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">`return (<span class="hljs-subst">${data.<span class="hljs-keyword">function</span>}</span>)(...arguments)`</span>)
      <span class="hljs-keyword">const</span> rs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(...(data.<span class="hljs-property">args</span> ?? []))
      <span class="hljs-title function_">luckySendMessageToIndex</span>(type, rs)
      <span class="hljs-keyword">break</span>
    }
  }
})
</code></pre>
<h4 data-id="heading-13">ä¼˜ç‚¹</h4>
<ul>
<li>âœ… å¯ä»¥ä¼ é€’å¤æ‚çš„å‡½æ•°é€»è¾‘</li>
<li>âœ… <code>CustomEvent</code> é€šä¿¡æ›´çµæ´»</li>
</ul>
<h4 data-id="heading-14">ç¼ºç‚¹</h4>
<ul>
<li>âŒ ä½¿ç”¨ <code>new Function()</code>ï¼Œå­˜åœ¨å®‰å…¨é£é™©ï¼ˆå¯èƒ½å—åˆ° CSP é™åˆ¶ï¼‰</li>
<li>âŒ éœ€è¦åºåˆ—åŒ–å‡½æ•°ï¼Œä»£ç å¤æ‚åº¦è¾ƒé«˜</li>
<li>âŒ åŒæ ·éœ€è¦é…ç½® <code>web_accessible_resources</code></li>
<li>âŒ éœ€è¦å¤„ç† iframe æ£€æµ‹</li>
</ul>
<hr/>
<h3 data-id="heading-15">æ–¹æ¡ˆä¸‰ï¼šworld: "MAIN" é…ç½®</h3>
<h4 data-id="heading-16">åŸç†</h4>
<p>åœ¨ Content Script çš„é…ç½®ä¸­æŒ‡å®š <code>world: "MAIN"</code>ï¼Œä½¿ Content Script ç›´æ¥åœ¨é¡µé¢çš„ä¸»ä¸–ç•Œä¸­æ‰§è¡Œï¼Œä»è€Œç›´æ¥è®¿é—®é¡µé¢çš„ <code>window</code> å¯¹è±¡ã€‚</p>
<h4 data-id="heading-17">å®ç°æµç¨‹</h4>
<ol>
<li>åœ¨ Content Script çš„é…ç½®ä¸­è®¾ç½® <code>world: "MAIN"</code></li>
<li>Content Script ç›´æ¥åœ¨é¡µé¢ä¸»ä¸–ç•Œä¸­æ‰§è¡Œï¼Œè®¿é—® <code>window</code> å¯¹è±¡è·å–æ‰€éœ€æ•°æ®</li>
</ol>
<h4 data-id="heading-18">ä»£ç ç¤ºä¾‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineContentScript</span>({
  <span class="hljs-attr">matches</span>: [<span class="hljs-string">"*://*.etsy.com/*"</span>],
  <span class="hljs-attr">runAt</span>: <span class="hljs-string">"document_end"</span>,
  <span class="hljs-attr">world</span>: <span class="hljs-string">"MAIN"</span>, <span class="hljs-comment">// è¿è¡Œåœ¨é¡µé¢ä¸»ä¸–ç•Œ</span>
  <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç›´æ¥è®¿é—® window.Etsy å¯¹è±¡</span>
    <span class="hljs-keyword">const</span> shopId = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Etsy</span>?.<span class="hljs-property">Context</span>?.<span class="hljs-property">data</span>?.<span class="hljs-property">shop_id</span>;
    <span class="hljs-comment">// ...</span>
  },
});
</code></pre>
<h4 data-id="heading-19">ä¼˜ç‚¹</h4>
<ul>
<li>âœ… å®ç°æœ€ç®€å•ï¼Œæ— éœ€é¢å¤–çš„é€šä¿¡æœºåˆ¶</li>
<li>âœ… ä¸éœ€è¦ <code>web_accessible_resources</code> é…ç½®</li>
<li>âœ… æ€§èƒ½æœ€å¥½ï¼Œæ— éœ€åŠ¨æ€æ³¨å…¥è„šæœ¬</li>
<li>âœ… ç¬¦åˆ Manifest V3 çš„æ¨èæ–¹å¼</li>
</ul>
<h4 data-id="heading-20">ç¼ºç‚¹</h4>
<ul>
<li>âŒ <strong>WXT æ¡†æ¶å¯èƒ½ä¸æ”¯æŒ <code>world: "MAIN"</code> é…ç½®</strong>ï¼ˆè¿™æ˜¯å…³é”®é—®é¢˜ï¼‰</li>
<li>âŒ å³ä½¿æ”¯æŒï¼Œé…ç½®å¯èƒ½ä¸ä¼šæ­£ç¡®ç”Ÿæˆåˆ° <code>manifest.json</code> ä¸­</li>
<li>âŒ åœ¨å®é™…æµ‹è¯•ä¸­å‘ç°ä¸»ä¸–ç•Œè„šæœ¬æ— æ³•æ­£ç¡®åŠ è½½</li>
</ul>
<hr/>
<h2 data-id="heading-21">æ–¹æ¡ˆå¯¹æ¯”</h2>





















































<table><thead><tr><th>ç‰¹æ€§</th><th>æ–¹æ¡ˆä¸€ï¼ˆpostMessageï¼‰</th><th>æ–¹æ¡ˆäºŒï¼ˆCustomEventï¼‰</th><th>æ–¹æ¡ˆä¸‰ï¼ˆworld: MAINï¼‰</th></tr></thead><tbody><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>ä¸­ç­‰</td><td>è¾ƒé«˜</td><td>ä½ï¼ˆç†è®ºä¸Šï¼‰</td></tr><tr><td><strong>å…¼å®¹æ€§</strong></td><td>âœ… é«˜</td><td>âœ… é«˜</td><td>âŒ ä½ï¼ˆWXT å¯èƒ½ä¸æ”¯æŒï¼‰</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>âœ… é«˜</td><td>âš ï¸ ä¸­ï¼ˆeval é£é™©ï¼‰</td><td>âœ… é«˜</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>âœ… è‰¯å¥½</td><td>âœ… è‰¯å¥½</td><td>âœ… æœ€å¥½</td></tr><tr><td><strong>é…ç½®å¤æ‚åº¦</strong></td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>ä½ï¼ˆç†è®ºä¸Šï¼‰</td></tr><tr><td><strong>CSP é™åˆ¶</strong></td><td>âœ… æ— </td><td>âŒ å¯èƒ½å—é™</td><td>âœ… æ— </td></tr><tr><td><strong>WXT æ”¯æŒ</strong></td><td>âœ… å®Œå…¨æ”¯æŒ</td><td>âœ… å®Œå…¨æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒæˆ–æœªéªŒè¯</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-22">å®é™…æµ‹è¯•</h2>
<h3 data-id="heading-23">æµ‹è¯•ç¯å¢ƒ</h3>
<ul>
<li><strong>æ¡†æ¶</strong>ï¼šWXT v0.20.6</li>
<li><strong>æµè§ˆå™¨</strong>ï¼šChromeï¼ˆManifest V3ï¼‰</li>
<li><strong>ç›®æ ‡ç½‘ç«™</strong>ï¼šEtsy åº—é“ºç®¡ç†é¡µé¢</li>
</ul>
<h3 data-id="heading-24">æ–¹æ¡ˆä¸€æµ‹è¯•ç»“æœ</h3>
<p>âœ… <strong>æˆåŠŸ</strong></p>
<ul>
<li>è„šæœ¬æ³¨å…¥æ­£å¸¸</li>
<li><code>postMessage</code> é€šä¿¡æ­£å¸¸</li>
<li>èƒ½å¤ŸæˆåŠŸè·å– <code>window.Etsy.Context.data</code></li>
<li>æ€§èƒ½è¡¨ç°è‰¯å¥½</li>
</ul>
<p><strong>æµ‹è¯•æ—¥å¿—ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">âœ… <span class="hljs-selector-attr">[éš”ç¦»ä¸–ç•Œ]</span> è„šæœ¬ page-inject<span class="hljs-selector-class">.js</span> æ³¨å…¥æˆåŠŸ
âœ… <span class="hljs-selector-attr">[ä¸»ä¸–ç•Œ]</span> page-inject<span class="hljs-selector-class">.js</span> å·²åŠ è½½ï¼Œå¯ä»¥è®¿é—® window<span class="hljs-selector-class">.Etsy</span> å¯¹è±¡
ğŸ“¤ <span class="hljs-selector-attr">[éš”ç¦»ä¸–ç•Œ]</span> å·²å‘é€è·å– Etsy æ•°æ®è¯·æ±‚åˆ°ä¸»ä¸–ç•Œ
âœ… <span class="hljs-selector-attr">[ä¸»ä¸–ç•Œ]</span> æˆåŠŸè·å– Etsy æ•°æ®
âœ… <span class="hljs-selector-attr">[éš”ç¦»ä¸–ç•Œ]</span> æˆåŠŸä»ä¸»ä¸–ç•Œè·å– Etsy æ•°æ®
</code></pre>
<h3 data-id="heading-25">æ–¹æ¡ˆä¸‰æµ‹è¯•ç»“æœ</h3>
<p>âŒ <strong>å¤±è´¥</strong></p>
<ul>
<li>é…ç½® <code>world: "MAIN"</code> åï¼Œç”Ÿæˆçš„ <code>manifest.json</code> ä¸­å¯èƒ½ä¸åŒ…å«è¯¥é…ç½®</li>
<li>å³ä½¿æ‰‹åŠ¨æ·»åŠ é…ç½®ï¼Œä¸»ä¸–ç•Œè„šæœ¬ä¹Ÿæ— æ³•æ­£ç¡®åŠ è½½</li>
<li>æ§åˆ¶å°å‡ºç°è¶…æ—¶é”™è¯¯ï¼š<code>è·å– shopId è¶…æ—¶ï¼Œä¸»ä¸–ç•Œè„šæœ¬å¯èƒ½æœªåŠ è½½</code></li>
</ul>
<p><strong>æµ‹è¯•æ—¥å¿—ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">ğŸ“¤ <span class="hljs-selector-attr">[éš”ç¦»ä¸–ç•Œ]</span> å·²å‘é€è·å– shopId è¯·æ±‚åˆ°ä¸»ä¸–ç•Œ
âš ï¸ è·å– shopId å¤±è´¥: è·å– shopId è¶…æ—¶ï¼Œä¸»ä¸–ç•Œè„šæœ¬å¯èƒ½æœªåŠ è½½
</code></pre>
<h3 data-id="heading-26">æ–¹æ¡ˆäºŒæµ‹è¯•ç»“æœ</h3>
<p>âš ï¸ <strong>æœªæµ‹è¯•</strong></p>
<ul>
<li>ç”±äºæ–¹æ¡ˆä¸€å·²ç»æ»¡è¶³éœ€æ±‚ï¼Œä¸”æ–¹æ¡ˆäºŒå­˜åœ¨å®‰å…¨é£é™©ï¼Œæœªè¿›è¡Œå®é™…æµ‹è¯•</li>
<li>ç†è®ºä¸Šå¯è¡Œï¼Œä½†ä¸æ¨èä½¿ç”¨</li>
</ul>
<hr/>
<h2 data-id="heading-27">æœ€ç»ˆé‡‡ç”¨</h2>
<p>åŸºäºå®é™…æµ‹è¯•ç»“æœå’Œæ–¹æ¡ˆå¯¹æ¯”ï¼Œ<strong>æœ€ç»ˆé‡‡ç”¨æ–¹æ¡ˆä¸€ï¼ˆweb_accessible_resources + window.postMessageï¼‰</strong>ã€‚</p>
<h3 data-id="heading-28">é€‰æ‹©ç†ç”±</h3>
<ol>
<li><strong>å…¼å®¹æ€§æœ€ä½³</strong>ï¼šåœ¨ WXT æ¡†æ¶ä¸­å®Œå…¨æ”¯æŒï¼Œé…ç½®ç®€å•</li>
<li><strong>å¯é æ€§é«˜</strong>ï¼šç»è¿‡å®é™…æµ‹è¯•ï¼ŒåŠŸèƒ½ç¨³å®šå¯é </li>
<li><strong>å®‰å…¨æ€§å¥½</strong>ï¼šä½¿ç”¨æ ‡å‡†çš„ <code>postMessage</code> APIï¼Œä¸æ¶‰åŠ <code>eval</code> ç­‰å®‰å…¨é£é™©</li>
<li><strong>æ˜“äºç»´æŠ¤</strong>ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘ç®€å•ï¼Œä¾¿äºåç»­ç»´æŠ¤</li>
<li><strong>æ€§èƒ½è‰¯å¥½</strong>ï¼šè™½ç„¶éœ€è¦åŠ¨æ€æ³¨å…¥è„šæœ¬ï¼Œä½†é€šè¿‡ <code>onload</code> å›è°ƒç¡®ä¿æ—¶åºæ­£ç¡®ï¼Œæ€§èƒ½å½±å“å¯å¿½ç•¥</li>
</ol>
<h3 data-id="heading-29">å®Œæ•´å®ç°ä»£ç </h3>
<p>å‚è€ƒæœ¬æ–‡æ¡£çš„"æ–¹æ¡ˆä¸€"éƒ¨åˆ†ï¼ŒåŒ…å«å®Œæ•´çš„ä»£ç å®ç°ã€‚</p>
<hr/>
<h2 data-id="heading-30">æ€»ç»“</h2>
<p>åœ¨ WXT æ¡†æ¶ä¸‹è·å–é¡µé¢ <code>window</code> å¯¹è±¡ï¼Œæ¨èä½¿ç”¨ <strong>web_accessible_resources + window.postMessage</strong> æ–¹æ¡ˆã€‚è™½ç„¶ç†è®ºä¸Š <code>world: "MAIN"</code> é…ç½®æ˜¯æœ€ä¼˜æ–¹æ¡ˆï¼Œä½†ç”±äº WXT æ¡†æ¶å¯èƒ½ä¸æ”¯æŒæˆ–é…ç½®ä¸ç”Ÿæ•ˆï¼Œå®é™…é¡¹ç›®ä¸­æ— æ³•ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-31">å…³é”®è¦ç‚¹</h3>
<ol>
<li><strong>éš”ç¦»ä¸–ç•Œé™åˆ¶</strong>ï¼šContent Script è¿è¡Œåœ¨éš”ç¦»ä¸–ç•Œï¼Œæ— æ³•ç›´æ¥è®¿é—®é¡µé¢ä¸»ä¸–ç•Œçš„ <code>window</code> å¯¹è±¡</li>
<li><strong>æ³¨å…¥è„šæœ¬æ–¹æ¡ˆ</strong>ï¼šé€šè¿‡ <code>web_accessible_resources</code> å°†è„šæœ¬æ³¨å…¥åˆ°ä¸»ä¸–ç•Œæ˜¯å¯é çš„è§£å†³æ–¹æ¡ˆ</li>
<li><strong>é€šä¿¡æœºåˆ¶</strong>ï¼šä½¿ç”¨ <code>window.postMessage</code> è¿›è¡Œè·¨ä¸–ç•Œé€šä¿¡ï¼Œå®‰å…¨ä¸”æ ‡å‡†</li>
<li><strong>æ¡†æ¶å…¼å®¹æ€§</strong>ï¼šåœ¨é€‰æ‹©æ–¹æ¡ˆæ—¶ï¼Œå¿…é¡»è€ƒè™‘æ¡†æ¶çš„å®é™…æ”¯æŒæƒ…å†µï¼Œä¸èƒ½ä»…ä¾èµ–ç†è®ºæœ€ä¼˜æ–¹æ¡ˆ</li>
</ol>
<h3 data-id="heading-32">æœ€ä½³å®è·µ</h3>
<ol>
<li>âœ… ä½¿ç”¨ <code>web_accessible_resources</code> é…ç½®æ³¨å…¥è„šæœ¬</li>
<li>âœ… é€šè¿‡ <code>script.onload</code> ç¡®ä¿è„šæœ¬åŠ è½½å®Œæˆåå†é€šä¿¡</li>
<li>âœ… ä½¿ç”¨è¯·æ±‚ ID æœºåˆ¶æ”¯æŒå¹¶å‘è¯·æ±‚</li>
<li>âœ… æ·»åŠ è¶…æ—¶æœºåˆ¶é¿å…æ— é™ç­‰å¾…</li>
<li>âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•</li>
<li>âœ… åœ¨æ³¨å…¥å‰æ£€æŸ¥è„šæœ¬æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡å¤æ³¨å…¥</li>
</ol>
<h3 data-id="heading-33">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>âš ï¸ ç¡®ä¿ <code>web_accessible_resources</code> ä¸­çš„ <code>matches</code> é…ç½®æ­£ç¡®ï¼Œåªå…è®¸åœ¨éœ€è¦çš„åŸŸåä¸‹è®¿é—®</li>
<li>âš ï¸ ä½¿ç”¨ <code>use_dynamic_url: true</code> ç¡®ä¿èµ„æº URL åŠ¨æ€ç”Ÿæˆï¼Œæé«˜å®‰å…¨æ€§</li>
<li>âš ï¸ åœ¨ <code>postMessage</code> ä¸­éªŒè¯æ¶ˆæ¯æ¥æºï¼Œç¡®ä¿å®‰å…¨æ€§</li>
<li>âš ï¸ å¤„ç† iframe åœºæ™¯æ—¶ï¼Œéœ€è¦æ£€æŸ¥ <code>window.top === window.self</code></li>
</ol>
<p>é€šè¿‡æœ¬æ–‡æ¡£çš„æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨ WXT æ¡†æ¶ä¸‹å¯é åœ°è·å–é¡µé¢ <code>window</code> å¯¹è±¡ï¼Œæ»¡è¶³å„ç§å®é™…å¼€å‘éœ€æ±‚ã€‚</p>
<hr/>
<p><strong>æ–‡æ¡£ç‰ˆæœ¬</strong>ï¼šv1.0<br/>
<strong>æœ€åæ›´æ–°</strong>ï¼š2024å¹´<br/>
<strong>ä½œè€…</strong>ï¼šåŸºäºå®é™…é¡¹ç›®ç»éªŒæ€»ç»“</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Amazon OpenSearch åŠ©åŠ›é«˜æ•ˆ RAG ç³»ç»Ÿè½åœ°]]></title>    <link>https://juejin.cn/post/7575757258832887834</link>    <guid>https://juejin.cn/post/7575757258832887834</guid>    <pubDate>2025-11-24T02:54:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575757258832887834" data-draft-id="7575456858427097134" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Amazon OpenSearch åŠ©åŠ›é«˜æ•ˆ RAG ç³»ç»Ÿè½åœ°"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T02:54:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äºšé©¬é€Šäº‘å¼€å‘è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2850395271209496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Amazon OpenSearch åŠ©åŠ›é«˜æ•ˆ RAG ç³»ç»Ÿè½åœ°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850395271209496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äºšé©¬é€Šäº‘å¼€å‘è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:54:17.000Z" title="Mon Nov 24 2025 02:54:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»29åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€ç”Ÿæˆå¼ AI çš„å¿«é€Ÿå‘å±•ï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval Augmented Generationï¼ŒRAGï¼‰å·²æˆä¸ºæ„å»ºé«˜è´¨é‡ AI åº”ç”¨çš„å…³é”®æŠ€æœ¯ã€‚RAG é€šè¿‡å°†å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸å¤–éƒ¨çŸ¥è¯†åº“ç›¸ç»“åˆï¼Œæœ‰æ•ˆè§£å†³äº† LLM çš„å¹»è§‰é—®é¢˜ï¼Œæé«˜äº†å›ç­”çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚</p>
<p>åœ¨ä¼—å¤šRAGè§£å†³æ–¹æ¡ˆä¸­ï¼ŒçŸ¥è¯†åº“ä½œä¸ºæ ¸å¿ƒç»„ä»¶è‡³å…³é‡è¦ã€‚Amazon OpenSearchå‡­å€Ÿå…¶å“è¶Šçš„å…¨æ–‡æ£€ç´¢èƒ½åŠ›ã€è¯­ä¹‰æœç´¢æ”¯æŒå’Œé«˜åº¦å¯æ‰©å±•çš„åˆ†å¸ƒå¼æ¶æ„ï¼Œå·²æˆä¸ºä¼ä¸šæ„å»ºé«˜æ€§èƒ½RAGçŸ¥è¯†åº“çš„é¦–é€‰æŠ€æœ¯å¹³å°ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåº”å¯¹æµ·é‡æ•°æ®æ£€ç´¢çš„æŒ‘æˆ˜ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Amazon OpenSearch åœ¨ RAG åœºæ™¯ä¸­çš„ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œå¹¶ç»“åˆ Amazon Bedrock ç”Ÿæ€ç³»ç»Ÿï¼Œå±•ç¤ºå¦‚ä½•æ„å»ºå¿«é€Ÿæ„å»ºå¯æ‰©å±•çš„ RAG åº”ç”¨ã€‚æˆ‘ä»¬è¿˜å°†ä»‹ç» Amazon OpenSearch çš„ Serverless ç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Serverless æ¶æ„è¿›ä¸€æ­¥ç®€åŒ– RAG è§£å†³æ–¹æ¡ˆçš„éƒ¨ç½²å’Œç®¡ç†ã€‚</p>
<blockquote>
<p>ğŸ“¢é™æ—¶æ’æ’­ï¼šæ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œåˆ©ç”¨äºšé©¬é€ŠæŠ€æœ¯ä¸ç”Ÿæ€ï¼Œå¿«é€Ÿé›†æˆä¸éƒ¨ç½²ç”Ÿæˆå¼AIæ¨¡å‹èƒ½åŠ›ã€‚</p>
<p>âœ¨ ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨å¼•å¯¼æ‚¨æ·±å…¥æ¢ç´¢Amazon Bedrockçš„æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨ã€æ¨¡å‹è‡ªåŠ¨åŒ–è¯„ä¼°ä»¥åŠå®‰å…¨å›´æ (Guardrail)ç­‰é‡è¦åŠŸèƒ½ã€‚</p>
<p>â©å¿«å¿«ç‚¹å‡»è¿›å…¥ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_InfoQhead_0606%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_InfoQhead_0606" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_InfoQhead_0606&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_InfoQhead_0606" ref="nofollow noopener noreferrer">å¤šæ¨¡ä¸€ç«™é€š â€”â€” Amazon Bedrock ä¸Šçš„åŸºç¡€æ¨¡å‹åˆä½“éªŒ</a>ã€‹å®éªŒæ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote>
<h2 data-id="heading-0">RAGå¸¸è§„æµç¨‹</h2>
<p>RAG å·¥ä½œæµç¨‹ä¸»è¦åŒ…å«äº”ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<p>1ã€æ•°æ®å‡†å¤‡ï¼ˆ<strong>Data Preparation</strong>ï¼‰</p>
<ol>
<li>å°†å¤–éƒ¨çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£ã€è¡¨æ ¼æˆ–å…¶ä»–æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œè½¬æˆé€‚åˆæ„å»ºçŸ¥è¯†åº“çš„æ ¼å¼ï¼Œå¦‚æ–‡æœ¬ã€ç¨ å¯†/ç¨€ç–å‘é‡è¡¨ç¤ºã€‚</li>
<li>é€šè¿‡ETLï¼ˆæå–Extractã€è½¬æ¢Transformã€åŠ è½½Loadï¼‰è¿‡ç¨‹æ¸…æ´—å’Œæ•´ç†æ•°æ®ï¼Œä¹Ÿå¯èƒ½ä¼šæ¶‰åŠåˆ°æ–‡æ¡£åˆ‡åˆ†ï¼Œå¹¶å¯¹æ¯ä¸ªæ•°æ®å—è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚å‘é‡åŒ–ã€åˆ†è¯ã€ç¨€ç–ç´¢å¼•åŒ–ç­‰ï¼‰ï¼Œå­˜å‚¨åˆ°çŸ¥è¯†åº“ä¸­ï¼ˆä¾‹å¦‚Amazon OpenSearchï¼‰ï¼Œæ–¹ä¾¿åç»­å¿«é€Ÿæ£€ç´¢</li>
</ol>
<p>2ã€æ£€ç´¢ï¼ˆ<strong>Retrieval</strong>ï¼‰</p>
<ol>
<li>ç”¨æˆ·è¾“å…¥æŸ¥è¯¢åï¼Œç³»ç»Ÿå°†æŸ¥è¯¢è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æŸ¥è¯¢æ”¹å†™ã€åˆ†è¯ã€è½¬ä¸ºå‘é‡è¡¨ç¤ºç­‰</li>
<li>æ£€ç´¢å™¨ä½¿ç”¨æ£€ç´¢ç´¢æŠ€æœ¯ï¼ˆä¾‹å¦‚æ–‡æœ¬æ£€ç´¢ã€å‘é‡æ£€ç´¢ç­‰ï¼‰ä»å‘é‡æ•°æ®åº“ä¸­æ‰¾åˆ°ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µæˆ–æ•°æ®å—ã€‚</li>
<li>æ£€ç´¢ä¸ä»…ä¾èµ–å…³é”®è¯åŒ¹é…ï¼Œè¿˜é‡‡ç”¨è¯­ä¹‰çº§åˆ«çš„åŒ¹é…ï¼Œç¡®ä¿å¯¹å¤æ‚æˆ–æ¨¡ç³ŠæŸ¥è¯¢ä¹Ÿèƒ½æ‰¾åˆ°å‡†ç¡®çš„æ”¯æŒä¿¡æ¯</li>
</ol>
<p>3ã€å¢å¼ºï¼ˆ<strong>Augmentation</strong>ï¼‰</p>
<ol>
<li>å°†æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£ç‰‡æ®µä¸ç”¨æˆ·æŸ¥è¯¢ç»“åˆï¼Œå½¢æˆå¢å¼ºçš„æç¤ºï¼ˆpromptï¼‰ã€‚</li>
<li>è¿™ä¸ªå¢å¼ºçš„æç¤ºé€šå¸¸é€šè¿‡æ¨¡æ¿æˆ–ç‰¹å®šæ ¼å¼ç»„ç»‡ï¼Œç¡®ä¿ç”Ÿæˆæ¨¡å‹èƒ½å¤Ÿå……åˆ†åˆ©ç”¨æ£€ç´¢ä¿¡æ¯ï¼Œæä¾›æ›´ä¸°å¯Œä¸”ä¸Šä¸‹æ–‡ç›¸å…³çš„è¾“å…¥</li>
</ol>
<p>4ã€ç”Ÿæˆï¼ˆ<strong>Generation</strong>ï¼‰</p>
<ol>
<li>ç”Ÿæˆæ¨¡å‹ï¼ˆå¦‚Claudeã€GPTç­‰ç³»åˆ—çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼‰æ¥æ”¶å¢å¼ºåçš„æç¤ºï¼Œç”Ÿæˆè‡ªç„¶è¯­è¨€å›ç­”ã€‚</li>
<li>ç”Ÿæˆçš„å†…å®¹ä¸ä»…è¯­è¨€æµç•…ï¼Œè¿˜åŸºäºå¤–éƒ¨çŸ¥è¯†åº“çš„ä¿¡æ¯ï¼Œä¿è¯å›ç­”çš„å‡†ç¡®æ€§å’Œæƒå¨æ€§ã€‚</li>
</ol>
<p>5ã€å¤šè½®äº¤äº’ä¸åé¦ˆï¼ˆå¯é€‰ï¼‰</p>
<ol>
<li>åœ¨å¯¹è¯ç³»ç»Ÿä¸­ï¼ŒRAGæ”¯æŒå¤šè½®äº¤äº’ï¼Œæ¯è½®çš„æŸ¥è¯¢å’Œç”Ÿæˆç»“æœå¯ä»¥ä½œä¸ºä¸‹ä¸€è½®çš„è¾“å…¥ã€‚</li>
<li>ç³»ç»Ÿæ ¹æ®ç”¨æˆ·åé¦ˆä¸æ–­ä¼˜åŒ–æ£€ç´¢å’Œç”Ÿæˆç­–ç•¥ï¼Œæå‡å›ç­”è´¨é‡å’Œç”¨æˆ·ä½“éªŒ</li>
</ol>
<p>Amazon OpenSearch ä½œä¸ºä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œä¸ºæ„å»º RAGçŸ¥è¯†åº“æä¾›äº†å…¨é¢çš„æ”¯æŒã€‚å®ƒä¸ä»…æ”¯æŒä¼ ç»Ÿçš„å…¨æ–‡æœç´¢ï¼Œè¿˜æä¾›äº†ç¨ å¯†ä¸ç¨€ç–å‘é‡æœç´¢èƒ½åŠ›ï¼Œä½¿å…¶æˆä¸ºæ„å»º RAG åº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚</p>
<h2 data-id="heading-1">Amazon OpenSearch åœ¨ RAG ä¸­çš„æ ¸å¿ƒä¼˜åŠ¿</h2>
<p>1ã€ å¼ºå¤§çš„å‘é‡æ£€ç´¢èƒ½åŠ›</p>
<p>Amazon OpenSearch æä¾›å¼ºå¤§çš„ ANNï¼ˆApproximate Nearest Neighborï¼Œè¿‘ä¼¼æœ€è¿‘é‚»ï¼‰æ£€ç´¢èƒ½åŠ›ï¼Œè¿™å¾—ç›Šäºå…¶æ·±åº¦é›†æˆçš„ KNN æ’ä»¶ã€‚è¯¥æ’ä»¶æ”¯æŒå¤šç§å…ˆè¿›çš„ANNç®—æ³•å®ç°ï¼ŒåŒ…æ‹¬ HNSWï¼ˆHierarchical Navigable Small Worldï¼‰ã€IVFï¼ˆInverted Fileï¼‰ï¼Œä»¥åŠ Faissã€NMSLIB å’Œ Lucene ç­‰é«˜æ•ˆæœç´¢åº“ã€‚è¿™äº›ç®—æ³•å’Œåº“æä¾›äº†ä¸åŒçš„ä¼˜åŒ–è·¯å¾„ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯ç²¾ç»†è°ƒæ•´å‚æ•°é…ç½®ï¼Œä»¥è¾¾åˆ°æ£€ç´¢é€Ÿåº¦ä¸å‡†ç¡®ç‡ä¹‹é—´çš„æœ€ä¼˜å¹³è¡¡ã€‚</p>
<p>åˆ©ç”¨ <code>method</code> å‚æ•°é…ç½®é¡¹ï¼Œå¼€å‘è€…å¯ä»¥ç²¾ç¡®æŒ‡å®šæ‰€ä½¿ç”¨çš„ç®—æ³•ç±»å‹ï¼ˆä¾‹å¦‚ HNSW æˆ– IVFï¼‰ã€å‘é‡ç©ºé—´åº¦é‡æ ‡å‡†ï¼ˆå¦‚ L2 èŒƒæ•°ã€å†…ç§¯ã€ä½™å¼¦ç›¸ä¼¼æ€§ç­‰ï¼‰ï¼Œä»¥åŠç‰¹å®šå¼•æ“çš„å…·ä½“å‚æ•°è®¾ç½®ã€‚è¿™ç§çµæ´»æ€§ç¡®ä¿äº†ä¸åŒåº”ç”¨åœºæ™¯ä¸‹å¯¹æ€§èƒ½å’Œæ•ˆæœçš„ä¸åŒéœ€æ±‚éƒ½èƒ½å¾—åˆ°æ»¡è¶³ã€‚å¯¹äºå¸Œæœ›æ·±å…¥äº†è§£ Amazon OpenSearch ä¸­ KNN/ANN åŠŸèƒ½åŠå…¶å‚æ•°é…ç½®çš„ç”¨æˆ·ï¼Œå®˜æ–¹æ–‡æ¡£[1]æä¾›äº†è¯¦å°½çš„æŠ€æœ¯è¯´æ˜å’ŒæŒ‡å¯¼ã€‚</p>
<p>åœ¨å‘é‡æ£€ç´¢èƒ½åŠ›æ–¹é¢ï¼ŒAmazon OpenSearch å±•ç°å‡ºäº†å“è¶Šçš„æ€§èƒ½ä¸é«˜åº¦å¯æ‰©å±•çš„æ¶æ„ï¼Œèƒ½å¤Ÿé«˜æ•ˆæ”¯æŒä»æ•°ç™¾ä¸‡åˆ°æ•°åäº¿çº§åˆ«ç”šè‡³ç™¾äº¿çº§çš„å‘é‡æ•°æ®å¿«é€Ÿæ£€ç´¢ã€‚è¿™ç§çµæ´»çš„æ‰©å±•æ€§ä½¿å…¶èƒ½å¤Ÿé€‚åº”ä»å°è§„æ¨¡å®éªŒåˆ°å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒçš„å„ç§åº”ç”¨åœºæ™¯ã€‚æ ¹æ® Amazon å®˜æ–¹å‘å¸ƒçš„æµ‹è¯•æ•°æ®[2]ï¼Œåœ¨ä½¿ç”¨è¡Œä¸šå¹¿æ³›è®¤å¯çš„ BIGANN æ•°æ®é›†ï¼ˆåŒ…å« 10 äº¿ä¸ª 128 ç»´å‘é‡ï¼‰è¿›è¡Œçš„å®éªŒä¸­ï¼ŒOpenSearch åœ¨ä¿è¯å¬å›ç‡è¾¾åˆ° 99% çš„å‰æä¸‹ï¼Œå±•ç°å‡ºæä¸ºä¼˜å¼‚çš„å“åº”å»¶è¿Ÿè¡¨ç°ï¼šp50 å»¶è¿Ÿä»…ä¸º 23.1 æ¯«ç§’ï¼Œp90 å»¶è¿Ÿä¸º 27.1 æ¯«ç§’ï¼Œp99 å»¶è¿Ÿä¹Ÿä»…ä¸Šå‡è‡³ 32.2 æ¯«ç§’ã€‚</p>
<p>è¿™æ ·çš„ä½å»¶è¿Ÿã€é«˜å¬å›ç‡çš„è¡¨ç°ï¼Œå……åˆ†ä½“ç°äº† Amazon OpenSearch åœ¨å‘é‡æ£€ç´¢é¢†åŸŸçš„å¼ºå¤§æŠ€æœ¯å®åŠ›ã€‚æ— è®ºæ˜¯æ¨èç³»ç»Ÿã€å›¾åƒæ£€ç´¢ã€è¯­ä¹‰æœç´¢ï¼Œè¿˜æ˜¯å…¶ä»–å¯¹å®æ—¶æ€§å’Œå‡†ç¡®åº¦æœ‰è¾ƒé«˜è¦æ±‚çš„ AI åº”ç”¨åœºæ™¯ï¼ŒOpenSearch éƒ½èƒ½å¤Ÿæä¾›ç¨³å®šã€å¯é ä¸”é«˜æ•ˆçš„åº•å±‚æ”¯æ’‘ï¼Œè¶³ä»¥åº”å¯¹ç»å¤§å¤šæ•°å¯¹æ€§èƒ½æ•æ„Ÿçš„ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p>2ã€å‘é‡é‡åŒ–æŠ€æœ¯é™ä½æˆæœ¬</p>
<p>éšç€å‘é‡æ•°æ®è§„æ¨¡çš„è¿…é€Ÿå¢é•¿ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡ç”šè‡³äº¿çº§åˆ«ä»¥ä¸Šçš„åœºæ™¯ä¸­ï¼Œä¼ ç»ŸåŸºäºå†…å­˜çš„è¿‘ä¼¼æœ€è¿‘é‚»ï¼ˆANNï¼‰ç®—æ³•ï¼ˆå¦‚ HNSWï¼‰åœ¨æ€§èƒ½æ–¹é¢é¢ä¸´æŒ‘æˆ˜ï¼šç”±äºæ‰€æœ‰å‘é‡å¿…é¡»å¸¸é©»å†…å­˜ï¼Œç³»ç»Ÿçš„å†…å­˜æ¶ˆè€—è¿…é€Ÿæ”€å‡ï¼Œå¯¼è‡´å‘é‡æ£€ç´¢çš„ç¡¬ä»¶æˆæœ¬å’Œæ‰©å±•éš¾åº¦æ˜¾è‘—å¢åŠ ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒAmazon OpenSearch åœ¨å‘é‡æ£€ç´¢åœºæ™¯ä¸­å¼•å…¥äº†é‡åŒ–ï¼ˆQuantizationï¼‰æŠ€æœ¯ã€‚é€šè¿‡å¯¹é«˜ç»´æµ®ç‚¹å‘é‡è¿›è¡Œå‹ç¼©ï¼ŒOpenSearch èƒ½åœ¨æ˜¾è‘—é™ä½å­˜å‚¨å’Œè®¡ç®—èµ„æºæ¶ˆè€—çš„åŒæ—¶ï¼Œä¿æŒè¾ƒé«˜çš„æ£€ç´¢å‡†ç¡®ç‡å’Œå“åº”é€Ÿåº¦ã€‚</p>
<p>å…¶ä¸­ï¼ŒBinary Quantizationï¼ˆBQï¼ŒäºŒè¿›åˆ¶é‡åŒ–ï¼‰ æ˜¯ OpenSearch æä¾›çš„ä¸€ç§é«˜æ•ˆå‘é‡å‹ç¼©æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚ç”¨äºå¦‚ LLM Agent Memory æ„å»ºã€è¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿç­‰å¤§è§„æ¨¡å‘é‡æ£€ç´¢åº”ç”¨ã€‚BQ æŠ€æœ¯å°†åŸå§‹çš„é«˜ç»´æµ®ç‚¹å‘é‡å‹ç¼©ä¸ºä½ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæ”¯æŒå°†æ¯ä¸ªå‘é‡ç»´åº¦ç¼–ç ä¸º 1ã€2 æˆ– 4 ä½ï¼Œåˆ†åˆ«å¯¹åº”çº¦ 32 å€ã€16 å€å’Œ 8 å€çš„å‹ç¼©ç‡ï¼Œä»è€Œå¤§å¹…åº¦é™ä½å†…å­˜å ç”¨ã€‚æ­¤å¤–ï¼ŒBQ åœ¨ OpenSearch ä¸­çš„è®­ç»ƒä¸ç´¢å¼•æ„å»ºè¿‡ç¨‹æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œç”¨æˆ·æ— éœ€å•ç‹¬è¿›è¡Œé¢„å¤„ç†æˆ–æ¨¡å‹è®­ç»ƒï¼Œè¿™å¤§å¤§ç®€åŒ–äº†å‘é‡æ£€ç´¢ç³»ç»Ÿçš„å¼€å‘å’Œè¿ç»´æµç¨‹ã€‚å°½ç®¡é‡åŒ–å‹ç¼©æœ¬è´¨ä¸Šä¼šå¸¦æ¥ä¸€å®šçš„ç²¾åº¦æŸå¤±ï¼Œä½† OpenSearch åœ¨å®ç° BQ åŠŸèƒ½æ—¶ï¼Œæä¾›äº†çµæ´»çš„å‚æ•°é…ç½®ï¼Œä½¿ç”¨æˆ·å¯ä»¥åœ¨å¬å›ç‡ã€å‡†ç¡®ç‡ä¸ç³»ç»Ÿæˆæœ¬ä¹‹é—´è¿›è¡Œæœ‰æ•ˆæƒè¡¡ã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒOpenSearch èƒ½å¤Ÿåœ¨èµ„æºåˆ©ç”¨ç‡ä¸æ£€ç´¢æ•ˆæœä¹‹é—´å®ç°å¹³è¡¡ï¼Œæ»¡è¶³å„ç±»ä¼ä¸šçº§åº”ç”¨çš„æ€§èƒ½éœ€æ±‚ã€‚</p>
<p>åœ¨è¿‡å»æŸå®¢æˆ·æµ‹è¯•æ¡ˆä¾‹ä¸­ï¼Œé¢å¯¹äº¿çº§è§„æ¨¡å‘é‡æ•°æ®é›†ï¼ŒOpenSearch é‡‡ç”¨ HNSW ç®—æ³•ç»“åˆ Binary Quantization æŠ€æœ¯ï¼Œåœ¨ä¿æŒ 1500 QPS é«˜å¹¶å‘çš„åŒæ—¶ï¼ŒP50ã€P90ã€P99 å‡åœ¨ç™¾æ¯«ç§’å†…ã€‚ä¸æœªä½¿ç”¨é‡åŒ–çš„ç³»ç»Ÿç›¸æ¯”ï¼Œæ•´ä½“æˆæœ¬é™ä½çº¦ 50%ï¼Œè¿™å……åˆ†è¯æ˜äº† BQ æŠ€æœ¯åœ¨é«˜æ€§èƒ½ã€ä½æˆæœ¬å‘é‡æ£€ç´¢ä¸­çš„å®ç”¨ä»·å€¼ã€‚</p>
<p>åœ¨åº”ç”¨ BQ é‡åŒ–æ—¶ï¼Œæœ‰å¦‚ä¸‹ç»éªŒå¯ä»¥åˆ†äº«ï¼š</p>
<ol>
<li>shard æ•°é‡å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ŒåŸºäºæ€»ä½“æ•°æ®é‡ï¼Œé¢„ä¼°æ¯ä¸ª shard æ•°æ®é‡ï¼Œ30GBå·¦å³æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„å€¼</li>
<li>é¦–æ‰¹æ•°æ®å†™å…¥åï¼Œåš force mergeï¼Œæå‡åç»­çš„æ£€ç´¢æ•ˆæœ</li>
<li>ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„7g å®ä¾‹ç³»åˆ—ï¼ˆä¾‹å¦‚ c7gï¼‰</li>
<li>åœ¨éœ€è¦é«˜ QPS çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Cç³»åˆ—æœºå™¨</li>
</ol>
<p>3ã€ æ··åˆæœç´¢ï¼šç»“åˆè¯­ä¹‰å’Œå…³é”®è¯æœç´¢</p>
<p>åœ¨ RAG åœºæ™¯ä¸‹ï¼Œæ··åˆæ£€ç´¢ + é‡æ’åºçš„æµç¨‹å·²ç»å‡ ä¹æ˜¯ä¸€ä¸ªä¸šå†…æ ‡å‡†ï¼Œç”¨æ¥æå‡çŸ¥è¯†å¬å›æ•ˆæœã€‚æ··åˆæ£€ç´¢ç»“åˆäº†å…³é”®è¯æœç´¢ï¼ˆå¦‚ BM25ï¼‰å’Œè¯­ä¹‰æœç´¢ï¼ˆå¦‚å‘é‡æ£€ç´¢ï¼‰çš„ä¼˜ç‚¹ï¼Œå¼¥è¡¥äº†å„è‡ªçš„ä¸è¶³ï¼Œä»è€Œæé«˜äº†æ£€ç´¢çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚å…³é”®è¯æœç´¢åœ¨ç²¾ç¡®åŒ¹é…æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œé€‚ç”¨äºç‰¹å®šæœ¯è¯­çš„æ£€ç´¢ï¼›è€Œè¯­ä¹‰æœç´¢åŸºäºæ•°æ®è¯­ä¹‰è¿›è¡Œæœç´¢ï¼Œå¯¹æ‹¼å†™é”™è¯¯å’ŒåŒä¹‰è¯å…·æœ‰ä¸€å®šçš„é²æ£’æ€§ï¼Œèƒ½å¤Ÿæ•æ‰åˆ°æ›´å¹¿æ³›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚é€šè¿‡å°†è¿™ä¸¤ç§æœç´¢æ–¹å¼èåˆï¼Œå¯ä»¥æ˜¾è‘—æå‡æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§å’Œå¤šæ ·æ€§ã€‚</p>
<p>åœ¨æ··åˆæ£€ç´¢å¾—åˆ°å¤šä¸ªç›¸å…³ç»“æœåï¼Œå¦‚ä½•ä»ä¸­é€‰æ‹©æœ€ç›¸å…³ã€æœ€æœ‰ä»·å€¼çš„ä¿¡æ¯è¿›è¡Œç”Ÿæˆï¼Œæ˜¯å¦ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜ã€‚è¿™æ—¶ï¼Œé‡æ’åºæ¨¡å‹ï¼ˆRerankæ¨¡å‹ï¼‰å°±å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚é‡æ’åºæ¨¡å‹é€šè¿‡å¯¹ä¸åŒæ£€ç´¢æ¨¡å‹è¿”å›çš„æ–‡æ¡£ç‰‡æ®µåˆ—è¡¨å’Œç”¨æˆ·é—®é¢˜è¯­ä¹‰åŒ¹é…åº¦è¿›è¡Œé‡æ–°æ’åºï¼Œæ”¹è¿›æ£€ç´¢è¿”å›çš„ç»“æœã€‚å®ƒè®¡ç®—ç”¨æˆ·é—®é¢˜ä¸æ£€ç´¢å¬å›çš„æ¯ä¸€ä¸ªå€™é€‰æ–‡æ¡£ä¹‹é—´çš„ç›¸å…³æ€§åˆ†æ•°ï¼Œå¹¶è¿”å›æŒ‰ç…§ç›¸å…³æ€§æ’åºçš„æ–‡æ¡£åˆ—è¡¨ã€‚è¿™æ ·ï¼Œæ¨¡å‹åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­å°±å¯ä»¥ä¼˜å…ˆé€‰æ‹©é«˜è´¨é‡çš„ä¿¡æ¯ï¼Œä»è€Œæé«˜ç”Ÿæˆç»“æœçš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚å¸¸è§çš„é‡æ’åºæ¨¡å‹åŒ…æ‹¬ Cohere Rerankã€BGE-Reranker ç­‰ã€‚è¿™äº›æ¨¡å‹å¯ä»¥åœ¨å•è·¯æˆ–å¤šè·¯çš„å¬å›ç»“æœä¸­æŒ‘é€‰å‡ºå’Œé—®é¢˜æœ€æ¥è¿‘çš„æ–‡æ¡£ï¼Œè¿›ä¸€æ­¥æå‡ç”Ÿæˆç­”æ¡ˆçš„ç²¾ç¡®åº¦ã€‚</p>
<p>åœ¨æ„å»ºæ··åˆæœç´¢ï¼ˆå¦‚å‘é‡æ£€ç´¢ + å…³é”®è¯æ£€ç´¢ï¼‰ç³»ç»Ÿæ—¶ï¼Œé€šå¸¸éœ€è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<p>æŸ¥è¯¢å‘é‡åŒ–å¤„ç†å¤æ‚ï¼šç”¨æˆ·è¾“å…¥é€šå¸¸ä¸ºè‡ªç„¶è¯­è¨€æ–‡æœ¬ï¼Œè¿™å°±è¦æ±‚ç³»ç»Ÿæ—¢è¦å¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯å¤„ç†ä»¥æ”¯æŒå…³é”®è¯æ£€ç´¢ï¼Œåˆè¦é€šè¿‡åµŒå…¥æ¨¡å‹å°†å…¶å‘é‡åŒ–ä»¥æ”¯æŒè¯­ä¹‰æ£€ç´¢ã€‚è¿™ä¸€è¿‡ç¨‹æ¶‰åŠæ¨¡å‹åŠ è½½ä¸æ¨ç†ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤„ç†å¤æ‚åº¦ã€‚ç›¸å…³æ€§åˆ†æ•°å°ºåº¦ä¸ä¸€è‡´ï¼šå…³é”®è¯æ£€ç´¢ï¼ˆå¦‚ BM25ï¼‰å’Œè¯­ä¹‰æ£€ç´¢ï¼ˆå¦‚å‘é‡åŒ¹é…ï¼‰è¿”å›çš„ç›¸å…³æ€§åˆ†æ•°å¤„äºä¸åŒçš„è¯„åˆ†ä½“ç³»ä¸­ï¼Œç›´æ¥èåˆå¯èƒ½å¯¼è‡´è¯„åˆ†å¤±è¡¡ã€‚å› æ­¤ï¼Œå¿…é¡»å¯¹å®ƒä»¬è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œå°†ç»“æœç»Ÿä¸€åˆ°å¯æ¯”è¾ƒçš„è¯„åˆ†å°ºåº¦ã€‚Amazon OpenSearch çš„ä¸€å¤§ä¼˜åŠ¿åœ¨äºï¼Œå…¶åŸç”Ÿæ”¯æŒæ··åˆæ£€ç´¢ï¼Œèƒ½å¤Ÿè½»æ¾é›†æˆè¯­ä¹‰æœç´¢ä¸å…³é”®è¯æœç´¢ã€‚å®ƒä¸ä»…æ”¯æŒçµæ´»å¯¹æ¥å¤–éƒ¨åµŒå…¥æ¨¡å‹ï¼Œè¿˜æä¾›äº†å†…ç½®æœºåˆ¶ï¼ˆå¦‚æœç´¢ç®¡é“å’Œæ ‡å‡†åŒ–å¤„ç†å™¨ï¼‰ç”¨äºè°ƒæ•´ä¸åŒæ£€ç´¢é€šè·¯çš„æƒé‡å’Œç›¸å…³æ€§åˆ†æ•°çš„ç»Ÿä¸€ï¼Œå¤§å¹…ç®€åŒ–äº†æ··åˆæœç´¢ç³»ç»Ÿçš„æ„å»ºä¸ä¼˜åŒ–è¿‡ç¨‹ã€‚</p>
<h4 data-id="heading-2">3.1. é›†æˆåµŒå…¥æ¨¡å‹</h4>
<p>åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œæ— è®ºæ˜¯æ–‡æœ¬çš„å†™å…¥è¿˜æ˜¯æ£€ç´¢ï¼Œéƒ½éœ€è¦å…ˆå°†æ–‡æœ¬è½¬æ¢ä¸ºå¯¹åº”çš„å‘é‡è¡¨ç¤ºã€‚å› æ­¤ï¼Œå‘é‡åŒ–æ¨¡å‹çš„éƒ¨ç½²æ˜¯å®ç°è¯­ä¹‰æ£€ç´¢çš„å…³é”®æ­¥éª¤ã€‚åœ¨äºšé©¬é€Šäº‘å¹³å°ä¸Šï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç°å‘é‡åŒ–æ¨¡å‹çš„é›†æˆï¼š</p>
<ol>
<li>ä½¿ç”¨ <strong>Amazon Bedrock</strong> æä¾›çš„å†…ç½®å‘é‡åŒ–æ¨¡å‹ï¼šAmazon Bedrock æ”¯æŒå¤šç§ä¸»æµçš„å‘é‡åŒ–æ¨¡å‹ï¼Œä¾‹å¦‚ Cohere å’Œ Amazon Titanï¼ˆç¨ å¯†å‘é‡æ¨¡å‹ï¼‰ã€‚é€šè¿‡ç›´æ¥è°ƒç”¨ Bedrock æä¾›çš„ APIï¼Œå³å¯å®ç°æ–‡æœ¬çš„å‘é‡åŒ–å¤„ç†ï¼Œæ— éœ€è‡ªè¡Œéƒ¨ç½²æ¨¡å‹ã€‚</li>
<li>é€šè¿‡ <strong>Amazon SageMaker</strong> éƒ¨ç½²è‡ªå®šä¹‰å‘é‡åŒ–æ¨¡å‹ï¼šæ”¯æŒå°†å¦‚ bge-m3 ç­‰å¼€æºåµŒå…¥æ¨¡å‹éƒ¨ç½²åˆ° SageMaker å¹³å°ï¼Œéƒ¨ç½²åå³å¯é€šè¿‡ SageMaker Endpoint å®ç°æ¨¡å‹çš„è°ƒç”¨å’Œæ¨ç†ï¼Œé€‚ç”¨äºéœ€è¦å®šåˆ¶æˆ–ä¼˜åŒ–æ¨¡å‹çš„åœºæ™¯ã€‚</li>
</ol>
<p>å¯¹äºä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼ŒAmazon OpenSearch éƒ½æä¾›äº†ç»Ÿä¸€çš„å¯¹æ¥èƒ½åŠ›ï¼šå¯ä»¥å°†è¿™ä¸¤ç±»æ¨¡å‹çš„æ¨ç†æœåŠ¡æŠ½è±¡ä¸ºä¸€ä¸ªâ€œè¿æ¥å™¨â€ï¼ˆConnectorï¼‰è¿›è¡Œè°ƒç”¨ã€‚åœ¨ OpenSearch ä¸­ï¼Œé€šè¿‡è¿æ¥å™¨å¯ä»¥ç›´æ¥è°ƒç”¨æ¨¡å‹è¿›è¡Œæ–‡æœ¬åµŒå…¥æ¨ç†ï¼Œå¹¶ç»“åˆå·¥ä½œæµè‡ªåŠ¨åŒ–æœºåˆ¶ï¼Œå°†æ¨ç†ç»“æœå†™å…¥ç´¢å¼•æˆ–ç”¨äºå®æ—¶çš„å‘é‡æ£€ç´¢ï¼Œä»è€Œå®ç°ç«¯åˆ°ç«¯çš„è¯­ä¹‰ç´¢å¼•æµç¨‹ã€‚</p>
<p>æ•´ä¸ªé…ç½®è¿‡ç¨‹æ”¯æŒå›¾å½¢åŒ–æ“ä½œï¼Œéƒ¨ç½²ç®€å•ã€æµç¨‹æ¸…æ™°ã€‚å…·ä½“çš„é…ç½®æ­¥éª¤å’Œä½¿ç”¨ç¤ºä¾‹ï¼Œå¯å‚è€ƒæ–‡æ¡£ [4]ã€‚</p>
<h4 data-id="heading-3">3.2. hybridæ£€ç´¢</h4>
<p>åœ¨ Amazon OpenSearch ä¸­ï¼Œå®ç°æ··åˆæ£€ç´¢ï¼ˆä¾‹å¦‚å°†å…³é”®è¯æ£€ç´¢ä¸å‘é‡æ£€ç´¢ç›¸ç»“åˆï¼‰éå¸¸ç®€ä¾¿ï¼Œå¯ä»¥é€šè¿‡é…ç½® OpenSearch çš„è‡ªåŠ¨åŒ–æœç´¢å·¥ä½œæµæ¥å®Œæˆã€‚å…¶ä¸­ï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ˜¯é…ç½®ä¸€ä¸ªåŒ…å«å½’ä¸€åŒ–å¤„ç†å™¨ï¼ˆNormalization Processorï¼‰çš„æœç´¢ç®¡é“ï¼ˆSearch Pipelineï¼‰ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯å¯¹æ¥è‡ªä¸åŒæ£€ç´¢é€šè·¯ï¼ˆå¦‚ BM25 å’Œå‘é‡æœç´¢ï¼‰çš„ç›¸å…³æ€§åˆ†æ•°è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ã€‚</p>
<p>ç”±äºå…³é”®è¯æœç´¢ä¸è¯­ä¹‰æœç´¢è¿”å›çš„åˆ†å€¼é€šå¸¸å¤„äºä¸åŒçš„å°ºåº¦ï¼Œè‹¥ä¸è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œèåˆåçš„æ’åºå¯èƒ½ä¼šä¸¥é‡åå‘æŸä¸€è·¯ç»“æœã€‚é€šè¿‡å½’ä¸€åŒ–å¤„ç†å™¨ï¼Œå¯ä»¥å°†å¤šè·¯æŸ¥è¯¢ç»“æœçš„åˆ†æ•°æ˜ å°„åˆ°ç»Ÿä¸€çš„æ•°å€¼èŒƒå›´ï¼ˆå¦‚ [0, 1]ï¼‰ï¼Œä»è€Œç¡®ä¿åç»­çš„ç»“æœèåˆæ›´åŠ åˆç†å’Œå¯æ§ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">PUT /_search/pipeline/nlp-search-pipeline
{
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Post processor for hybrid search"</span>,
  <span class="hljs-string">"phase_results_processors"</span>: [
    {
      <span class="hljs-string">"normalization-processor"</span>: {
        <span class="hljs-string">"normalization"</span>: {
          <span class="hljs-string">"technique"</span>: <span class="hljs-string">"min_max"</span>
        },
        <span class="hljs-string">"combination"</span>: {
          <span class="hljs-string">"technique"</span>: <span class="hljs-string">"arithmetic_mean"</span>,
          <span class="hljs-string">"parameters"</span>: {
            <span class="hljs-string">"weights"</span>: [
              0.3,
              0.7
            ]
          }
        }
      }
    }
  ]
}
</code></pre>
<ul>
<li>normalization.techniqueï¼šå¯é€‰å€¼åŒ…æ‹¬ min-maxã€l2 ç”¨äºæ ‡å‡†åŒ–åˆ†æ•°ã€‚</li>
<li>combination.techniqueï¼šå¯é€‰å€¼åŒ…æ‹¬ arithmetic_meanã€geometric_meanã€harmonic_mean ç­‰ï¼Œç”¨äºç»„åˆåˆ†æ•°ã€‚</li>
</ul>
<p>æ‚¨è¿˜å¯ä»¥ä¸ºæ¯ä¸ªæŸ¥è¯¢å­å¥è®¾ç½®æƒé‡ï¼Œä»¥è°ƒæ•´å…¶å¯¹æœ€ç»ˆè¯„åˆ†çš„å½±å“ã€‚åœ¨é…ç½®å¥½æ¨¡å‹è¿æ¥å™¨å’Œæœç´¢ç®¡é“åï¼Œå³å¯ç›´æ¥è¿è¡Œæ··åˆæ£€ç´¢ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">GET /<span class="hljs-keyword">my</span>-nlp-<span class="hljs-keyword">index</span>/_search?search_pipeline=nlp-search-pipeline
{
  <span class="hljs-string">"_source"</span>: {
    <span class="hljs-string">"exclude"</span>: [
      <span class="hljs-string">"passage_embedding"</span>
    ]
  },
  <span class="hljs-string">"query"</span>: {
    <span class="hljs-string">"hybrid"</span>: {
      <span class="hljs-string">"queries"</span>: [
        {
          <span class="hljs-string">"match"</span>: {
            <span class="hljs-string">"passage_text"</span>: {
              <span class="hljs-string">"query"</span>: <span class="hljs-string">"Hi world"</span>
            }
          }
        },
        {
          <span class="hljs-string">"neural"</span>: {
            <span class="hljs-string">"passage_embedding"</span>: {
              <span class="hljs-string">"query_text"</span>: <span class="hljs-string">"Hi world"</span>,
              <span class="hljs-string">"model_id"</span>: <span class="hljs-string">"aVeif4oB5Vm0Tdw8zYO2"</span>,
              <span class="hljs-string">"k"</span>: <span class="hljs-number">5</span>
            }
          }
        }
      ]
    }
  }
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåº”ç”¨ä¾§åªéœ€è·å–ç”¨æˆ·çš„æ–‡æœ¬è¾“å…¥ï¼Œåç»­çš„å…³é”®è¯æ£€ç´¢ä¸è¯­ä¹‰æ£€ç´¢å³å¯åœ¨ Amazon OpenSearch å†…éƒ¨è‡ªåŠ¨å®Œæˆã€‚æ•´ä¸ªè¿‡ç¨‹æ— éœ€é¢å¤–å¼€å‘å¤æ‚çš„æ£€ç´¢é€»è¾‘ï¼Œå¤§å¹…é™ä½äº†æ··åˆæ£€ç´¢çš„å®æ–½æˆæœ¬ä¸æŠ€æœ¯é—¨æ§›ã€‚</p>
<p>4ã€ä¸°å¯Œçš„è¿‡æ»¤èƒ½åŠ›åœ¨åŸºäº RAG çš„åº”ç”¨ä¸­ï¼Œå…·å¤‡åŸºäºå…ƒæ•°æ®è¿›è¡Œè¿‡æ»¤ä¸èšåˆçš„èƒ½åŠ›è‡³å…³é‡è¦ã€‚é€šè¿‡å…ƒæ•°æ®è¿‡æ»¤ï¼Œå¯ä»¥åœ¨å‘é‡æœç´¢å‰æ˜¾è‘—ç¼©å°æœç´¢ç©ºé—´ï¼Œæ’é™¤ä¸ç”¨æˆ·æŸ¥è¯¢æ„å›¾æ— å…³çš„å†…å®¹ï¼Œä»è€Œæå‡ç”Ÿæˆç»“æœçš„ç²¾åº¦å’Œç›¸å…³æ€§ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç»“åˆå…ƒæ•°æ®çš„æ£€ç´¢æ˜¯éå¸¸å¸¸è§çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¤šç”¨æˆ·å…±äº«çš„çŸ¥è¯†åº“ç³»ç»Ÿä¸­ï¼Œä¸åŒç”¨æˆ·åªèƒ½è®¿é—®å’ŒæŸ¥è¯¢å„è‡ªä¸Šä¼ æˆ–è¢«æˆæƒçš„æ•°æ®å†…å®¹ï¼Œè¿™å°±éœ€è¦åŸºäºâ€œç”¨æˆ· IDâ€æˆ–â€œç»„ç»‡æ ‡è¯†â€ç­‰å…ƒæ•°æ®å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œç¡®ä¿ä¸åŒç”¨æˆ·æ ¹æ®å…¶æƒé™ä»…è®¿é—®å…¶æœ‰æƒæŸ¥çœ‹çš„æ•°æ®ï¼Œæ»¡è¶³ä¼ä¸šåœ¨æ•°æ®å®‰å…¨å’Œåˆè§„æ€§æ–¹é¢çš„è¦æ±‚ã€‚åŒæ ·ï¼Œåœ¨æŸäº›ç‰¹å®šçš„çŸ¥è¯†é—®ç­”æˆ–é—®è¯Šç±»åœºæ™¯ä¸­ï¼Œä»…éœ€è¦æ£€ç´¢ä¸æŸä¸ªä¸“ä¸šé¢†åŸŸç›¸å…³çš„æ–‡æ¡£ï¼Œæ­¤æ—¶åŸºäºé¢†åŸŸæ ‡ç­¾ã€æ–‡æ¡£æ¥æºç­‰å…ƒæ•°æ®è¿›è¡Œé¢„è¿‡æ»¤ï¼Œå¯ä»¥å¤§å¹…å‡å°‘æ— æ•ˆæ•°æ®çš„å¹²æ‰°ã€‚</p>
<p>åœ¨è¿‡æ»¤ç»´åº¦æ–¹é¢ï¼Œå…ƒæ•°æ®è¿‡æ»¤å¯ä»¥åº”ç”¨äºå¤šä¸ªå¸¸è§ç»´åº¦ã€‚æ—¶é—´è¿‡æ»¤å…è®¸ç³»ç»Ÿä»…åœ¨æŸä¸ªæ—¶é—´åŒºé—´å†…è¿›è¡Œæ–‡æ¡£æœç´¢ï¼Œæ¯”å¦‚åªæ£€ç´¢â€œ2023 å¹´ç¬¬ä¸€å­£åº¦â€çš„æ•°æ®ï¼›ç±»åˆ«è¿‡æ»¤å¯ä»¥é™åˆ¶æ£€ç´¢èŒƒå›´åœ¨ç‰¹å®šçš„äº§å“çº¿ã€é¡¹ç›®ç»„æˆ–ä¸šåŠ¡å•å…ƒå†…ï¼Œé¿å…è·¨éƒ¨é—¨æ•°æ®æ··æ·†ï¼›æ¥æºè¿‡æ»¤åˆ™å¸®åŠ©ç³»ç»Ÿä¼˜å…ˆé€‰æ‹©æ¥è‡ªæƒå¨æ•°æ®æºçš„å†…å®¹ï¼Œæ¯”å¦‚ä¼šè®®çºªè¦ã€æŠ€æœ¯æ‰‹å†Œã€API æ–‡æ¡£ç­‰ã€‚é€šè¿‡è¿™äº›ç»“æ„åŒ–è¿‡æ»¤æ‰‹æ®µï¼Œå¯ä»¥åœ¨åŸå§‹å‘é‡ç›¸ä¼¼åº¦æ’åºåŸºç¡€ä¸Šè¿›ä¸€æ­¥ç²¾ç‚¼ç»“æœï¼Œæå‡æ•´ä½“ç³»ç»Ÿçš„è¾“å‡ºè´¨é‡ä¸ç¨³å®šæ€§ã€‚</p>
<p>å¯¹äºä¸€äº›å¤æ‚æŸ¥è¯¢åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·é‡‡ç”¨è‡ªç„¶è¯­è¨€è¡¨è¾¾æ„å›¾æ—¶ï¼Œäººå·¥æ‰‹åŠ¨æ„é€ å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶ä¸ä»…ç¹çï¼Œè€Œä¸”å®¹æ˜“å‡ºç°æ­§ä¹‰æˆ–é—æ¼ã€‚ä¸ºæ­¤ï¼Œç›®å‰ä¹Ÿæœ‰æ–¹æ¡ˆæ˜¯ç»“åˆå¤§è¯­è¨€æ¨¡å‹çš„èƒ½åŠ›ï¼Œå®ç°è‡ªåŠ¨ä»ç”¨æˆ·è¾“å…¥ä¸­æå–å‡ºä¸å…ƒæ•°æ®ç›¸å…³çš„ç»“æ„åŒ–æŸ¥è¯¢æ¡ä»¶ã€‚è¿™ç§â€œæ™ºèƒ½å…ƒæ•°æ®è¿‡æ»¤â€æ¨¡å¼æå¤§æå‡äº†æ£€ç´¢è¿‡ç¨‹çš„çµæ´»æ€§ä¸é€‚åº”æ€§ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¾“å…¥â€œå±•ç¤º 2022 å¹´å‘å¸ƒçš„ Project A çš„ç›¸å…³æ–‡æ¡£â€ï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨è§£æå‡ºä¸¤ä¸ªå…³é”®è¿‡æ»¤å­—æ®µï¼šæ—¶é—´ä¸º 2022 å¹´ï¼Œé¡¹ç›®ä¸º Project Aï¼Œå¹¶æ®æ­¤æ‰§è¡Œç²¾å‡†çš„æ–‡æ¡£å‘é‡æ£€ç´¢ï¼Œæ˜¾è‘—æå‡è¿”å›ç»“æœçš„é’ˆå¯¹æ€§å’Œå‘½ä¸­ç‡ã€‚</p>
<p>Amazon OpenSearch æä¾›äº†å¼ºå¤§çš„å…ƒæ•°æ®è¿‡æ»¤èƒ½åŠ›ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥é€šè¿‡æ—¶é—´ã€ç±»åˆ«ã€æ¥æºç­‰å…ƒæ•°æ®ç»´åº¦ç²¾å‡†æ§åˆ¶æ£€ç´¢èŒƒå›´ï¼Œæœ‰æ•ˆæé«˜ç³»ç»Ÿæ•´ä½“çš„æ£€ç´¢è´¨é‡ã€‚å®ƒä¸»è¦æä¾› 3 ç§è¿‡æ»¤æ–¹æ³•[5]ï¼š</p>
<ol>
<li>é«˜æ•ˆ <strong>k-NN</strong> è¿‡æ»¤ï¼ˆ<strong>Efficient k-NN Filtering</strong>ï¼‰ï¼šè‡ª OpenSearch 2.9 èµ·ï¼Œæ”¯æŒåœ¨å‘é‡æ£€ç´¢è¿‡ç¨‹ä¸­åŒæ—¶åº”ç”¨è¿‡æ»¤æ¡ä»¶ï¼Œé¿å…äº†ä¼ ç»Ÿçš„é¢„è¿‡æ»¤æˆ–åè¿‡æ»¤æ–¹å¼å¯èƒ½å¯¼è‡´çš„ç»“æœæ•°é‡ä¸è¶³æˆ–æ€§èƒ½ä¸‹é™çš„é—®é¢˜ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿åœ¨æ»¡è¶³è¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£ä¸­è¿”å›å‡†ç¡®çš„ k ä¸ªæœ€è¿‘é‚»ç»“æœ</li>
<li>å¸ƒå°”åè¿‡æ»¤ï¼ˆ<strong>Boolean Post-Filtering</strong>ï¼‰ï¼šæ­¤æ–¹æ³•åœ¨å‘é‡æ£€ç´¢ååº”ç”¨è¿‡æ»¤æ¡ä»¶ï¼Œé€‚ç”¨äºè¿‡æ»¤æ¡ä»¶ä¸å¤ªä¸¥æ ¼çš„åœºæ™¯ã€‚ä½†åœ¨è¿‡æ»¤æ¡ä»¶è¾ƒä¸¥æ ¼æ—¶ï¼Œå¯èƒ½å¯¼è‡´è¿”å›çš„ç»“æœå°‘äºé¢„æœŸçš„ k ä¸ª</li>
<li>è¯„åˆ†è„šæœ¬è¿‡æ»¤ï¼ˆ<strong>Scoring Script Filtering</strong>ï¼‰ï¼šæ­¤æ–¹æ³•å…ˆå¯¹æ–‡æ¡£é›†åº”ç”¨è¿‡æ»¤æ¡ä»¶ï¼Œç„¶ååœ¨è¿‡æ»¤åçš„å­é›†ä¸Šæ‰§è¡Œç²¾ç¡®çš„ k-NN æ£€ç´¢ã€‚é€‚ç”¨äºå¯¹ç²¾åº¦è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä½†åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶å¯èƒ½é¢ä¸´é«˜å»¶è¿Ÿå’Œæ‰©å±•æ€§é—®é¢˜ã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿åœ¨å¤§è§„æ¨¡å‘é‡æ£€ç´¢çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œä¹Ÿå¹¶éæ‰€æœ‰æƒ…å†µä¸‹éƒ½å¿…é¡»é‡‡ç”¨è¿‘ä¼¼æœ€è¿‘é‚»ï¼ˆANNï¼‰æ£€ç´¢ã€‚åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œé¢„è¿‡æ»¤ï¼ˆpre-filterï¼‰ç»“åˆç²¾ç¡® k-NN æ£€ç´¢çš„æ–¹å¼ï¼Œç›¸è¾ƒäº ANN æ›´å…·ä¼˜åŠ¿ï¼Œæ—¢èƒ½é™ä½èµ„æºæˆæœ¬ï¼Œåˆèƒ½å®ç°æ›´é«˜çš„å¬å›ç‡ã€‚</p>
<p>è¿™ç±»åœºæ™¯çš„å…¸å‹ç‰¹å¾æ˜¯ï¼šå°½ç®¡å…¨å±€å‘é‡æ± çš„è§„æ¨¡éå¸¸å¤§ï¼ˆå¦‚åƒä¸‡çº§ç”šè‡³ä¸Šäº¿æ¡å‘é‡ï¼‰ï¼Œä½†åœ¨åº”ç”¨å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶åï¼Œå®é™…å‚ä¸å‘é‡æ£€ç´¢çš„æ•°æ®å­é›†ç›¸å¯¹è¾ƒå°ï¼ˆé€šå¸¸åœ¨å‡ åƒåˆ°å‡ ä¸‡æ¡ä¹‹é—´ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä»ä½¿ç”¨å…¨å±€ ANN ç´¢å¼•ï¼ˆå¦‚ HNSWï¼‰å¹¶å°†å…¶å®Œå…¨åŠ è½½è‡³å†…å­˜ä»¥å®ç°ä½å»¶è¿ŸæŸ¥è¯¢ï¼Œå°†å¸¦æ¥è¾ƒé«˜çš„å†…å­˜å¼€é”€ã€‚è€Œé‡‡ç”¨ pre-filter + ç²¾ç¡® k-NN çš„æ£€ç´¢æ¨¡å¼ï¼Œåˆ™æ— éœ€æ„å»ºå’Œç»´æŠ¤å¤§å‹ ANN ç´¢å¼•ï¼Œæ˜¾è‘—é™ä½äº†å†…å­˜æ¶ˆè€—ã€‚æ­¤å¤–ï¼Œåœ¨è¿‡æ»¤åçš„æ•°æ®é›†è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œå³ä½¿é‡‡ç”¨æš´åŠ›è®¡ç®—æ–¹å¼è¿›è¡Œç²¾ç¡® k-NN ä¹Ÿä¸ä¼šäº§ç”Ÿæ˜æ˜¾çš„è®¡ç®—è´Ÿæ‹…ã€‚è¿™ç§æ–¹å¼æ—¢èƒ½ç¡®ä¿æ£€ç´¢ç»“æœçš„å®Œæ•´æ€§ï¼ˆå³ 100% å¬å›ï¼‰ï¼Œåˆé¿å…äº† ANN å¼•å…¥çš„è¿‘ä¼¼è¯¯å·®ï¼Œå¯¹äºå¯¹å¬å›ç‡è¦æ±‚è¾ƒé«˜çš„åœºæ™¯å°¤ä¸ºé€‚ç”¨ã€‚</p>
<p>åœ¨ä½¿ç”¨ Amazon OpenSearch è¿›è¡Œå‘é‡æ£€ç´¢çš„å®é™…å®¢æˆ·æ¡ˆä¾‹ä¸­ï¼Œå·²æœ‰å¤šä¸ªé¡¹ç›®é€‰æ‹©äº† pre-filter + ç²¾ç¡® k-NN çš„æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œåœ¨æŸä¸ªåŸºäºæ‘„åƒå¤´é‡‡é›†çš„ç”»é¢è¿›è¡Œå‘é‡æ£€ç´¢çš„åœºæ™¯ä¸­ï¼Œç³»ç»Ÿæ€»å…±ç»´æŠ¤ç€çº¦ 1400 ä¸‡æ¡å‘é‡ã€‚å°½ç®¡å‘é‡æ€»é‡åºå¤§ï¼Œä½†æ¯æ¬¡æ£€ç´¢å‰éƒ½ä¼šé€šè¿‡â€œè®¾å¤‡ IDâ€ä»¥åŠå…¶ä»–ä¸šåŠ¡ç›¸å…³å­—æ®µè¿›è¡Œé¢„è¿‡æ»¤ï¼Œæœ€ç»ˆå‚ä¸è®¡ç®—çš„å‘é‡è§„æ¨¡é€šå¸¸ä»…ä¸º 3000 è‡³ 4000 æ¡ã€‚åœ¨è¿™ç§æ¡ä»¶ä¸‹ï¼Œé‡‡ç”¨ç²¾ç¡® k-NN è€Œé ANNï¼Œä¸ä»…å¤§å¹…é™ä½äº†ç³»ç»Ÿèµ„æºå ç”¨ï¼ŒåŒæ—¶è¿˜èƒ½ç¡®ä¿æ£€ç´¢çš„å¬å›ç‡è¾¾åˆ° 100%ï¼Œå®ç°äº†æ›´é«˜çš„æ€§ä»·æ¯”ã€‚</p>
<p>5ã€ç¨€ç–å‘é‡æ£€ç´¢èƒ½åŠ›ç¨€ç–å‘é‡æ£€ç´¢ï¼ˆSparse Vector Searchï¼‰æ˜¯ä¸€ç§ç»“åˆäº†ä¼ ç»Ÿå…³é”®è¯åŒ¹é…å’Œç¥ç»ç½‘ç»œè¯­ä¹‰ç†è§£çš„æ£€ç´¢æ–¹æ³•ã€‚å®ƒå¹¶éç®€å•åœ°æ›¿ä»£å…³é”®è¯æˆ–ç¨ å¯†å‘é‡æ£€ç´¢ï¼Œè€Œæ˜¯æ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿå…³é”®è¯æ£€ç´¢å’Œç¨ å¯†å‘é‡æ£€ç´¢å„è‡ªçš„å±€é™æ€§ï¼Œæå‡æœç´¢çš„è¯­ä¹‰ç†è§£èƒ½åŠ›ï¼ŒåŒæ—¶å…¼é¡¾è®¡ç®—æ•ˆç‡å’Œå“åº”é€Ÿåº¦ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹æä¾›æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚æˆ–ä½œä¸ºæ··åˆæ£€ç´¢ç­–ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œä¸å…¶ä»–æ–¹æ³•ååŒå·¥ä½œã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦ç¨€ç–å‘é‡æ£€ç´¢ï¼Ÿæˆ‘ä»¬ä»ç›®å‰å…³é”®è¯æ£€ç´¢å’Œç¨ å¯†å‘é‡æ£€ç´¢å­˜åœ¨çš„æŒ‘æˆ˜ï¼Œä»¥åŠç¨€ç–å‘é‡å¦‚ä½•è§£å†³çš„è§’åº¦æ¥çœ‹ï¼š</p>
<ul>
<li>å…³é”®è¯æ£€ç´¢ï¼šä¼ ç»Ÿå…³é”®è¯æ£€ç´¢ï¼ˆåŸºäºå€’æ’ç´¢å¼•çš„è¯æ³•æœç´¢ï¼‰ä¾èµ–è¯æ±‡åŒ¹é…ï¼Œéš¾ä»¥å¤„ç†è¯æ±‡ä¸åŒ¹é…ã€åŒä¹‰è¯ã€å¤šä¹‰è¯ç­‰è¯­ä¹‰é—®é¢˜ï¼Œå¯¼è‡´ç›¸å…³æ€§ä¸è¶³ã€‚ç¨€ç–å‘é‡æ£€ç´¢é€šè¿‡ç¥ç»ç½‘ç»œæ¨¡å‹ï¼ˆå¦‚ SPLADEï¼‰å°†æ–‡æœ¬ç¼–ç ä¸ºé«˜ç»´ç¨€ç–å‘é‡ï¼Œæ¯ä¸ªç»´åº¦å¯¹åº”ä¸€ä¸ªè¯æˆ–å­è¯ï¼Œå¹¶èµ‹äºˆæƒé‡ã€‚è¿™ç§è¡¨ç¤ºæ–¹å¼ä¸ä»…ä¿ç•™äº†å…³é”®è¯çš„é‡è¦æ€§ï¼Œè¿˜å¼•å…¥äº†è¯­ä¹‰æ‰©å±•èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¯†åˆ«ä¸æŸ¥è¯¢ç›¸å…³çš„åŒä¹‰è¯æˆ–ç›¸å…³è¯æ±‡ï¼Œä»è€Œæé«˜å¬å›ç‡ã€‚</li>
<li>ç¨ å¯†å‘é‡æ£€ç´¢ï¼šç¨ å¯†å‘é‡æ£€ç´¢ï¼ˆDense Vector Searchï¼‰é€šè¿‡é«˜ç»´å‘é‡æ•æ‰è¯­ä¹‰ï¼Œä½†è®¡ç®—å’Œå­˜å‚¨å¼€é”€è¾ƒå¤§ï¼Œå°¤å…¶åœ¨æµ·é‡æ•°æ®å’Œé«˜ç»´åº¦ä¸‹ï¼Œå»¶è¿Ÿå’Œæˆæœ¬æ˜¾è‘—å¢åŠ ã€‚Sparse Search é€šè¿‡ç¨€ç–å‘é‡è¡¨ç¤ºï¼ˆåªåŒ…å«å°‘é‡éé›¶é¡¹åŠå…¶æƒé‡ï¼‰ï¼Œæ˜¾è‘—å‡å°‘è®¡ç®—é‡å’Œå†…å­˜å ç”¨ï¼ŒåŒæ—¶ä¿æŒè¾ƒå¥½çš„è¯­ä¹‰ç›¸å…³æ€§ã€‚ è¿™ä½¿å¾—ç¨€ç–å‘é‡æ£€ç´¢åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†æ—¶å…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ï¼Œå°¤å…¶é€‚ç”¨äºèµ„æºå—é™çš„ç¯å¢ƒã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œç¨€ç–å‘é‡æ£€ç´¢æ˜¯ä¸€ç§ä»‹äºå…³é”®è¯æ£€ç´¢å’Œç¨ å¯†å‘é‡æ£€ç´¢ä¹‹é—´çš„åˆ›æ–°æŠ€æœ¯ï¼Œæ—¨åœ¨æå‡è¯­ä¹‰ç†è§£å’Œæ£€ç´¢æ•ˆç‡ã€‚å®ƒæ—¢ä¸æ˜¯å•çº¯æ›¿ä»£å…³é”®è¯æ£€ç´¢ï¼Œä¹Ÿä¸æ˜¯å•çº¯æ›¿ä»£ç¨ å¯†å‘é‡æ£€ç´¢ï¼Œè€Œæ˜¯ä½œä¸ºä¸¤è€…çš„æœ‰æ•ˆè¡¥å……ï¼Œå¸®åŠ©æ„å»ºæ›´é«˜æ•ˆã€æ›´å‡†ç¡®çš„æœç´¢ç³»ç»Ÿã€‚</p>
<p>Amazon OpenSearch è‡ª 2.11 ç‰ˆæœ¬èµ·å¼•å…¥äº†ç¥ç»ç¨€ç–æ£€ç´¢ï¼ˆNeural Sparse Searchï¼‰åŠŸèƒ½ï¼Œä¸ºè¯­ä¹‰æœç´¢æä¾›äº†ä¸€ç§é«˜æ•ˆã€ä½èµ„æºæ¶ˆè€—çš„æ›¿ä»£æ–¹æ¡ˆã€‚ç¨€ç–å‘é‡æ£€ç´¢ç»“åˆäº†ä¼ ç»Ÿå€’æ’ç´¢å¼•çš„é«˜æ€§èƒ½å’Œç¥ç»ç½‘ç»œæ¨¡å‹çš„è¯­ä¹‰ç†è§£èƒ½åŠ›ï¼Œç‰¹åˆ«é€‚ç”¨äºå¯¹å¬å›ç‡ã€å¯è§£é‡Šæ€§å’Œæˆæœ¬æ§åˆ¶æœ‰è¾ƒé«˜è¦æ±‚çš„åœºæ™¯ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ–‡æœ¬é¦–å…ˆé€šè¿‡ç¨€ç–ç¼–ç æ¨¡å‹ï¼ˆå¦‚ OpenSearch æä¾›çš„é¢„è®­ç»ƒæ¨¡å‹ï¼‰è½¬æ¢ä¸ºç¨€ç–å‘é‡ï¼Œå³ç”±éé›¶æƒé‡çš„ token:weight é”®å€¼å¯¹ç»„æˆçš„å‘é‡ã€‚è¿™äº›å‘é‡è¢«ç´¢å¼•åˆ° Lucene çš„å€’æ’ç´¢å¼•ä¸­ï¼Œåˆ©ç”¨<code>FeatureField</code>å­˜å‚¨ç»“æ„ã€‚æŸ¥è¯¢æ—¶ï¼Œè¾“å…¥æ–‡æœ¬åŒæ ·è¢«ç¼–ç ä¸ºç¨€ç–å‘é‡ï¼Œå¹¶é€šè¿‡å€’æ’ç´¢å¼•è¿›è¡ŒåŒ¹é…å’Œæ‰“åˆ†ï¼Œä»è€Œå®ç°è¯­ä¹‰çº§çš„æ£€ç´¢[6]ã€‚</p>
<p>ç›®å‰ Amazon OpenSearch æ”¯æŒä¸¤ç§ç¨€ç–æ£€ç´¢æ¨¡å¼ï¼š</p>
<ul>
<li><strong>Doc-only</strong> æ¨¡å¼ï¼šä»…åœ¨ç´¢å¼•é˜¶æ®µå¯¹æ–‡æ¡£è¿›è¡Œè¯­ä¹‰æ‰©å±•ï¼ŒæŸ¥è¯¢é˜¶æ®µä¸è¿›è¡Œæ‰©å±•ã€‚è¯¥æ¨¡å¼å»¶è¿Ÿä½ï¼Œæ€§èƒ½æ¥è¿‘ä¼ ç»Ÿ BM25 æ£€ç´¢ï¼Œé€‚ç”¨äºå¯¹å“åº”é€Ÿåº¦è¦æ±‚é«˜çš„åœºæ™¯</li>
<li><strong>Bi-encoder</strong> æ¨¡å¼ï¼šåœ¨ç´¢å¼•å’ŒæŸ¥è¯¢é˜¶æ®µå‡è¿›è¡Œè¯­ä¹‰æ‰©å±•ï¼Œèƒ½å¤Ÿæ›´å…¨é¢åœ°æ•æ‰æŸ¥è¯¢æ„å›¾ï¼Œæé«˜æ£€ç´¢ç›¸å…³æ€§ï¼Œä½†ç›¸åº”åœ°è®¡ç®—å¼€é”€å’Œå»¶è¿Ÿä¹Ÿæ›´é«˜</li>
</ul>
<p>åœ¨ Amazon OpenSearch ä¸­ä½¿ç”¨ç¨€ç–å‘é‡æ£€ç´¢çš„æ“ä½œéå¸¸ç®€ä¾¿ï¼Œå…¶é…ç½®æµç¨‹ä¸ç¬¬ 3.1 èŠ‚æ‰€ä»‹ç»çš„æ­¥éª¤åŸºæœ¬ä¸€è‡´ã€‚æ ¹æ®å®˜æ–¹å‘å¸ƒçš„æµ‹è¯•ç»“æœ[7]ï¼Œç¨€ç–ä¸ç¨ å¯†å‘é‡ç»“åˆçš„æ··åˆæ£€ç´¢æ–¹æ³•åœ¨æ•´ä½“æ£€ç´¢æ•ˆæœä¸Šä¼˜äºä¼ ç»Ÿ BM25 ä¸ç¨ å¯†å‘é‡çš„ç»„åˆã€‚ç„¶è€Œï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œç¨€ç–å‘é‡æ£€ç´¢çš„æ€§èƒ½é«˜åº¦ä¾èµ–äºæ‰€ä½¿ç”¨çš„ç¨€ç–ç¼–ç å™¨ï¼ˆSparse Encoderï¼‰æ¨¡å‹çš„è´¨é‡ã€‚å¦‚æœæ¨¡å‹åœ¨æ‰©å±•è¯æ±‡ä¸Šçš„è¯­ä¹‰ç›¸å…³æ€§è¾ƒå¼±ï¼Œå°†ç›´æ¥å½±å“æœ€ç»ˆçš„å¬å›èƒ½åŠ›ã€‚</p>
<p>æ­¤å¤–ï¼Œç”±äºå¤§å¤šæ•°ç¨€ç–ç¼–ç å™¨æ˜¯åœ¨é€šç”¨è¯­æ–™ä¸Šè¿›è¡Œé¢„è®­ç»ƒçš„ï¼Œåœ¨é¢å¯¹ç‰¹å®šå‚ç›´é¢†åŸŸä¸­çš„ä¸“ä¸šæœ¯è¯­æ—¶ï¼Œå…¶å¬å›æ•ˆæœå¯èƒ½ç”šè‡³ä¸å¦‚ä¼ ç»Ÿçš„å…³é”®è¯åŒ¹é…ã€‚è¿™æ„å‘³ç€åœ¨ç‰¹å®šä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæ˜¯å¦é€‚åˆä½¿ç”¨ç¨€ç–æ£€ç´¢ä»éœ€ç»“åˆå®é™…æ•°æ®è¿›è¡Œè¯„ä¼°ã€‚å¿…è¦æ—¶ï¼Œå¯èƒ½è¿˜éœ€å¯¹ç¨€ç–ç¼–ç å™¨è¿›è¡Œå¾®è°ƒï¼Œä»¥ä¼˜åŒ–å…¶åœ¨ç›®æ ‡é¢†åŸŸä¸­çš„æ£€ç´¢æ•ˆæœã€‚</p>
<h2 data-id="heading-4">Amazon OpenSearch Serverless</h2>
<p>é™¤äº†ä¼ ç»Ÿçš„é›†ç¾¤éƒ¨ç½²æ¨¡å¼ï¼ŒAmazon OpenSearch è¿˜æä¾›äº† Serverless æ¨¡å¼ï¼Œå…·å¤‡æ— éœ€è¿ç»´ã€è‡ªåŠ¨å¼¹æ€§æ‰©ç¼©çš„ä¼˜åŠ¿ï¼Œä¸ºå‘é‡å­˜å‚¨ä¸æ£€ç´¢æä¾›äº†ä¸€ç§é«˜æ•ˆä¾¿æ·çš„è§£å†³æ–¹æ¡ˆã€‚OpenSearch Serverless æ˜¯ä¸“ä¸ºç”Ÿæˆå¼äººå·¥æ™ºèƒ½ï¼ˆGenerative AIï¼‰å’Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åº”ç”¨è®¾è®¡çš„æ— æœåŠ¡å™¨å‘é‡æ•°æ®åº“ï¼Œå…·å¤‡é«˜æ€§èƒ½ã€å¯æ‰©å±•çš„å‘é‡æ£€ç´¢èƒ½åŠ›ï¼Œèƒ½å¤Ÿåœ¨æ¯«ç§’çº§å»¶è¿Ÿå†…å®Œæˆæœç´¢ï¼Œé€‚ç”¨äºè¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿã€èŠå¤©æœºå™¨äººç­‰å¤šç§æ™ºèƒ½åº”ç”¨åœºæ™¯ã€‚</p>
<p>å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå®Œå…¨æ‰˜ç®¡çš„æ— æœåŠ¡å™¨æ¶æ„ï¼Œç”¨æˆ·æ— éœ€é¢„ç½®ã€é…ç½®æˆ–ç®¡ç†åº•å±‚é›†ç¾¤èµ„æºã€‚ç³»ç»Ÿä¼šæ ¹æ®å®é™…è´Ÿè½½è‡ªåŠ¨å®Œæˆèµ„æºçš„æ‰©å±•ä¸å›æ”¶ï¼Œåœ¨è®¿é—®æ¨¡å¼æˆ–åº”ç”¨éœ€æ±‚æ³¢åŠ¨æ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒé«˜ååç‡å’Œä½å»¶è¿Ÿå“åº”ã€‚åŒæ—¶ï¼ŒOpenSearch Serverless ä¸ Amazon S3 æ·±åº¦é›†æˆï¼Œå…·å¤‡ä¸ S3 ç›¸åŒçº§åˆ«çš„æ•°æ®æŒä¹…æ€§ï¼Œç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨ä¸å¼ºä¸€è‡´æ€§ã€‚</p>
<p>åœ¨ RAG åº”ç”¨ä¸­ï¼ŒOpenSearch Serverless æ”¯æŒå‘é‡æ£€ç´¢ä¸æ–‡æœ¬å…³é”®è¯æ£€ç´¢çš„æ— ç¼èåˆï¼Œè¿›ä¸€æ­¥æå‡è¯­ä¹‰ç›¸å…³æ€§çš„åŒ¹é…æ•ˆæœã€‚å®ƒå†…ç½®ä¸ä¼ ç»Ÿé›†ç¾¤æ¨¡å¼ä¸€è‡´çš„è¿‘ä¼¼æœ€è¿‘é‚»ï¼ˆANNï¼‰ç®—æ³•ï¼Œä¾‹å¦‚ HNSWï¼ˆåˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œå›¾ï¼‰ï¼Œå¯åœ¨å¤§è§„æ¨¡å‘é‡æ•°æ®é›†ä¸Šå®ç°å¿«é€Ÿã€å‡†ç¡®çš„ç›¸ä¼¼æ€§æœç´¢ã€‚å€ŸåŠ©ä¸ Amazon Bedrock çš„åŸç”ŸåŒå‘é›†æˆï¼ŒOpenSearch Serverless å¯ä¸å¦‚ Amazon Titan Embeddings ç­‰åŸºç¡€æ¨¡å‹æ— ç¼åä½œï¼Œç®€åŒ–åµŒå…¥ç”Ÿæˆã€æ£€ç´¢è°ƒç”¨ç­‰ RAG å·¥ä½œæµå¼€å‘æµç¨‹ã€‚</p>
<p>åœ¨å®‰å…¨æ–¹é¢ï¼ŒOpenSearch Serverless åŸç”Ÿé›†æˆ Amazon Identity and Access Managementï¼ˆIAMï¼‰ï¼Œæ”¯æŒç»†ç²’åº¦çš„æƒé™æ§åˆ¶ï¼ŒåŒæ—¶æ”¯æŒé€šè¿‡ Amazon Key Management Serviceï¼ˆKMSï¼‰è¿›è¡Œæ•°æ®åŠ å¯†ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“ä¸å­˜å‚¨è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§ä¸æœºå¯†æ€§ã€‚</p>
<p>ç›®å‰ï¼ŒOpenSearch Serverless å·²åœ¨å¤šä¸ªå®é™…å®¢æˆ·åœºæ™¯ä¸­å¾—åˆ°è½åœ°åº”ç”¨ã€‚ä¾‹å¦‚ riskCanvasâ€”â€”ä¸€æ¬¾åŸºäº SaaS çš„é‡‘èçŠ¯ç½ªåˆè§„è§£å†³æ–¹æ¡ˆäº§å“ï¼Œå……åˆ†åˆ©ç”¨å¤§æ•°æ®ã€è‡ªåŠ¨åŒ–ä¸æœºå™¨å­¦ä¹ ç­‰å…ˆè¿›æŠ€æœ¯ï¼Œå¸®åŠ©å®¢æˆ·æå‡åˆè§„æ•ˆç‡ä¸ä¸šåŠ¡æ™ºèƒ½åŒ–æ°´å¹³ã€‚riskCanvas é€šè¿‡ä¸ OpenSearch Serverless å‘é‡å¼•æ“é›†æˆï¼Œç»“åˆ Amazon ç”Ÿæˆå¼ AI èƒ½åŠ›ï¼Œå°†å®¢æˆ·æ“ä½œæ•°æ®è½¬åŒ–ä¸ºå¯æœç´¢ã€å¯ç†è§£çš„è¯­ä¹‰å‘é‡ï¼Œä¸ºé‡‘èé¢†åŸŸçš„é£æ§å’Œåˆè§„æä¾›äº†å¼ºå¤§çš„æ”¯æŒ[8]ã€‚</p>
<h2 data-id="heading-5">Amazon OpenSearch ä¸ Amazon AI æœåŠ¡çš„å¼ºå¤§ç»„åˆ</h2>
<p>Amazon OpenSearch ä¸ Amazon Bedrock çš„æ·±åº¦é›†æˆä¸ºä¼ä¸šçº§ RAGï¼ˆRetrieval-Augmented Generationï¼‰åº”ç”¨æ„å»ºæä¾›äº†ç«¯åˆ°ç«¯çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚Amazon Bedrock è®©å¼€å‘è€…å¯ä»¥è½»æ¾æ¥å…¥å¤šç§ä¸»æµåŸºç¡€æ¨¡å‹ï¼Œè€Œ Amazon OpenSearch åˆ™æä¾›äº†é«˜æ€§èƒ½ã€å¯æ‰©å±•çš„å‘é‡æ£€ç´¢èƒ½åŠ›ã€‚è¿™ç§å¼ºå¼ºè”åˆï¼Œä½¿ä¼ä¸šèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°æ„å»ºå¹¶éƒ¨ç½²é«˜è´¨é‡çš„ç”Ÿæˆå¼ AI åº”ç”¨ï¼ŒåŠ é€Ÿæ™ºèƒ½åŒ–è½¬å‹ã€‚</p>
<p>ä¾‹å¦‚åœ¨å‰æ–‡ç¬¬ 3.1 èŠ‚æ‰€ä»‹ç»çš„åµŒå…¥é›†æˆæµç¨‹ä¸­ï¼ŒAmazon OpenSearch ä¸ Amazon Bedrock ä¹‹é—´çš„é›†æˆæä¸ºç®€ä¾¿ï¼Œä»…éœ€å‡ è¡Œä»£ç å³å¯å®ç°å‘é‡ç”Ÿæˆä¸æ£€ç´¢çš„å®Œæ•´é—­ç¯ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ Amazon Bedrock æä¾›çš„åµŒå…¥æ¨¡å‹ï¼ˆå¦‚ Amazon Titan Embeddingsï¼‰å°†æ–‡æ¡£å’Œç”¨æˆ·æŸ¥è¯¢ç¼–ç ä¸ºå‘é‡ï¼Œç„¶åå°†è¿™äº›å‘é‡å­˜å…¥ Amazon OpenSearchï¼Œè¿›ä¸€æ­¥å®ç°é«˜æ•ˆè¯­ä¹‰æ£€ç´¢ã€‚</p>
<p>æ­¤å¤–ï¼Œå¯¹äºéƒ¨åˆ†ç®€å•çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ© Amazon OpenSearch æœ¬èº«çš„æœºå™¨å­¦ä¹ èƒ½åŠ›ä¸ Amazon AI æœåŠ¡ä¸­çš„æ¨¡å‹èƒ½åŠ›ï¼Œå¿«é€Ÿæ­å»º RAG åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨ OpenSearch å†…ç½®çš„ Retrieval-Augmented Generation Processorï¼ˆRAG å¤„ç†å™¨ï¼‰ï¼Œç»“åˆéƒ¨ç½²åœ¨ Amazon SageMaker ä¸Šçš„ DeepSeek æ¨¡å‹å’ŒåµŒå…¥æ¨¡å‹ï¼Œå³å¯å¿«é€Ÿæ„å»ºè¯­ä¹‰å¢å¼ºçš„é—®ç­”ç³»ç»Ÿ[9]ã€‚æ›´è¿›ä¸€æ­¥ï¼ŒAmazon Bedrock Knowledge Bases è¿˜æ”¯æŒé€šè¿‡æ§åˆ¶å°â€œä¸€é”®é›†æˆâ€åˆ° Amazon OpenSearchï¼Œæ— éœ€ç¼–å†™å¤æ‚ä»£ç å³å¯å®Œæˆ RAG æµç¨‹é…ç½®ï¼Œæä¾›æè‡´ç®€æ´çš„æ‰˜ç®¡åŒ–ä½¿ç”¨ä½“éªŒ[10]ã€‚</p>
<p>è¿™ä¸€æ•´å¥—ç”Ÿæ€ç³»ç»Ÿçš„ååŒå·¥ä½œï¼Œä¸ä»…æ˜¾è‘—é™ä½äº†æ„å»º RAG åº”ç”¨çš„é—¨æ§›ï¼Œè¿˜åœ¨æ€§èƒ½ã€çµæ´»æ€§ä¸å¯ç»´æŠ¤æ€§æ–¹é¢ä¸ºä¼ä¸šç”¨æˆ·å¸¦æ¥å¯è§‚çš„ä¼˜åŠ¿ã€‚æ— è®ºæ˜¯é¢å‘ç»ˆç«¯å®¢æˆ·çš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œè¿˜æ˜¯ä¼ä¸šå†…éƒ¨çš„çŸ¥è¯†åº“æ£€ç´¢åº”ç”¨ï¼ŒOpenSearch ä¸ Bedrock çš„ååŒéƒ½ä¸ºç”Ÿæˆå¼ AI çš„è½åœ°æä¾›äº†åšå®æŠ€æœ¯æ”¯æ’‘ã€‚</p>
<h2 data-id="heading-6">OpenSeach ä¸å¼€æºç”Ÿæ€</h2>
<p>é™¤äº†å¹¿æ³›åº”ç”¨äºäºšé©¬é€Šå†…éƒ¨ç³»ç»Ÿä»¥åŠäºšé©¬é€Šäº‘æœåŠ¡å®¢æˆ·æ„å»ºçš„ä¼ä¸šçº§åº”ç”¨ä¸­ï¼ŒOpenSearch ä½œä¸ºå‘é‡æ•°æ®åº“çš„èƒ½åŠ›ä¹Ÿè¢«å¼€æºç¤¾åŒºå’Œç¬¬ä¸‰æ–¹å¼€å‘è€…è®¤å¯ï¼Œå·²åœ¨å¤šä¸ªä¸»æµé¡¹ç›®ä¸­å¾—åˆ°å®é™…åº”ç”¨ã€‚ä¾‹å¦‚ Mem0ã€Dify å’Œ LangChain ç­‰é¡¹ç›®ï¼Œå‡åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡‡ç”¨ OpenSearch æ¥æ»¡è¶³å¯¹é«˜æ€§èƒ½è¯­ä¹‰æ£€ç´¢å’Œæ¨ªå‘æ‰©å±•èƒ½åŠ›çš„éœ€æ±‚ã€‚</p>
<p>Mem0 æ˜¯ä¸€ä¸ªä¸“æ³¨äºæ„å»ºè®°å¿†ç³»ç»Ÿçš„æ¡†æ¶ï¼Œæ”¯æŒå¤šç§å‘é‡æ•°æ®åº“ä½œä¸ºåç«¯å­˜å‚¨ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ OpenSearchã€‚é€šè¿‡æŠ½è±¡ç»Ÿä¸€çš„æ¥å£å’Œæ¨¡å—åŒ–å·¥å‚æ¨¡å¼ï¼ŒMem0 å…è®¸å¼€å‘è€…çµæ´»åœ°é€‰æ‹©æœ€é€‚åˆå½“å‰åœºæ™¯çš„å‘é‡å­˜å‚¨å¼•æ“ï¼Œå¹¶åœ¨é…ç½®ä¸­è‡ªå®šä¹‰é›†åˆåç§°ã€èŠ‚ç‚¹åœ°å€ã€ç«¯å£å·ã€å‘é‡ç»´åº¦ç­‰å‚æ•°ï¼Œä»è€Œå®ç°å¿«é€Ÿé›†æˆä¸éƒ¨ç½²ã€‚</p>
<p>LangChain åˆ™å°† OpenSearch æ·±åº¦é›†æˆè¿›å…¶è¯­è¨€æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ä¸­ï¼Œåˆ©ç”¨ OpenSearch æ”¯æŒè¿‘ä¼¼æœ€è¿‘é‚»ï¼ˆk-NNï¼‰æœç´¢å’Œè¯­ä¹‰æ£€ç´¢çš„èƒ½åŠ›ï¼Œé…åˆ LangChain æä¾›çš„æ–‡æ¡£åŠ è½½ã€æ–‡æœ¬åˆ‡åˆ†ä¸åµŒå…¥ç”Ÿæˆæ¨¡å—ï¼Œå¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿæ„å»ºå‡ºé«˜æ•ˆçš„æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿï¼Œå®ç°è‡ªç„¶è¯­è¨€ç†è§£ä¸å“åº”çš„æ™ºèƒ½åŒ–ã€‚</p>
<p>Dify ä½œä¸ºä¸€ä¸ªå¼€æºçš„ LLMOps å¹³å°ï¼Œä¹Ÿæ”¯æŒå°† OpenSearch ä½œä¸ºå‘é‡å­˜å‚¨åç«¯ï¼Œé€‚é…å¤šç§éƒ¨ç½²ç¯å¢ƒï¼ŒåŒ…æ‹¬æœ¬åœ°å¼€å‘ã€ç§æœ‰åŒ–éƒ¨ç½²å’Œäº‘åŸç”Ÿæ¶æ„ï¼Œä½¿å…¶åœ¨æ€§èƒ½ã€çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§æ–¹é¢å‡å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ½œåŠ›ã€‚è¿™äº›é¡¹ç›®çš„å®è·µè¡¨æ˜ï¼ŒOpenSearch åœ¨æ„å»ºå¤§è§„æ¨¡ã€ä½å»¶è¿Ÿã€å¯æ°´å¹³æ‰©å±•çš„è¯­ä¹‰æ£€ç´¢ç³»ç»Ÿä¸­è¡¨ç°å‡ºè‰²ï¼Œå·²ç»æˆä¸ºç”Ÿäº§çº§å‘é‡æ•°æ®åº“è§£å†³æ–¹æ¡ˆçš„é‡è¦é€‰é¡¹ä¹‹ä¸€ã€‚</p>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒAmazon OpenSearch å‡­å€Ÿå…¶å…¨é¢çš„æœç´¢èƒ½åŠ›ã€çµæ´»çš„å‘é‡æ£€ç´¢æœºåˆ¶ã€åŸç”Ÿæ··åˆæœç´¢æ”¯æŒä»¥åŠå¼ºå¤§çš„å…ƒæ•°æ®è¿‡æ»¤åŠŸèƒ½ï¼Œä¸ºæ„å»ºä¼ä¸šçº§ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿæä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚ä»åº•å±‚çš„ KNN æ’ä»¶ä¸é‡åŒ–ä¼˜åŒ–ï¼Œåˆ°ä¸ Amazon Bedrockã€SageMaker ç­‰æœåŠ¡çš„æ·±åº¦é›†æˆï¼Œå†åˆ° Serverless æ¶æ„ä¸‹çš„ç®€åŒ–éƒ¨ç½²ï¼ŒAmazon OpenSearch åœ¨æ€§èƒ½ã€æ‰©å±•æ€§ä¸æ˜“ç”¨æ€§æ–¹é¢å±•ç°å‡ºå“è¶Šä¼˜åŠ¿ã€‚æ— è®ºæ˜¯é¢å‘å¤§è§„æ¨¡å‘é‡æ•°æ®æ£€ç´¢ã€é«˜å¹¶å‘å“åº”ï¼Œè¿˜æ˜¯æ»¡è¶³å¤æ‚å¤šæ ·çš„ä¼ä¸šçº§æ£€ç´¢éœ€æ±‚ï¼ŒAmazon OpenSearch éƒ½èƒ½æä¾›ç¨³å®šã€é«˜æ•ˆä¸”å…·æˆæœ¬æ•ˆç›Šçš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯æ‰“é€ é«˜è´¨é‡ RAG åº”ç”¨çš„é¦–é€‰å¹³å°ã€‚</p>
<p><strong>å‚è€ƒæ–‡æ¡£</strong></p>
<p>[1]<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.opensearch.org%2Fdocs%2Flatest%2Fvector-search%2Fvector-search-techniques%2Findex%2F" target="_blank" title="https://docs.opensearch.org/docs/latest/vector-search/vector-search-techniques/index/" ref="nofollow noopener noreferrer">OpenSearch KNN Search Methods and engines</a></p>
<p>[2] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2Fbig-data%2Fchoose-the-k-nn-algorithm-for-your-billion-scale-use-case-with-opensearch%2F" target="_blank" title="https://aws.amazon.com/blogs/big-data/choose-the-k-nn-algorithm-for-your-billion-scale-use-case-with-opensearch/" ref="nofollow noopener noreferrer">Choose the k-NN algorithm for your billion-scale use case with OpenSearch</a></p>
<p>[3] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fchina%2Fpractice-of-knowledge-question-answering-application-based-on-llm-knowledge-base-construction-part-4%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/china/practice-of-knowledge-question-answering-application-based-on-llm-knowledge-base-construction-part-4/" ref="nofollow noopener noreferrer">åŸºäºå¤§è¯­è¨€æ¨¡å‹çŸ¥è¯†é—®ç­”åº”ç”¨è½åœ°å®è·µ â€“ çŸ¥è¯†å¬å›è°ƒä¼˜ï¼ˆä¸‹ï¼‰</a></p>
<p>[4] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fchina%2Fopensearch-implements-automatic-embedding-based-on-ml-commons-plugin%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/china/opensearch-implements-automatic-embedding-based-on-ml-commons-plugin/" ref="nofollow noopener noreferrer">OpenSearch åŸºäº ML Commons æ’ä»¶å®ç°è‡ªåŠ¨ embedding</a></p>
<p>[5] <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.opensearch.org%2Fdocs%2F2.19%2Fvector-search%2Ffilter-search-knn%2Findex%2F" target="_blank" title="https://docs.opensearch.org/docs/2.19/vector-search/filter-search-knn/index/" ref="nofollow noopener noreferrer">OpenSearch KNN Filtering data</a></p>
<p>[6] <a href="https://link.juejin.cn?target=https%3A%2F%2Fopensearch.org%2Fblog%2Fa-deep-dive-into-faster-semantic-sparse-retrieval-in-os-2-12%2F%3Futm_source%3Dchatgpt.com" target="_blank" title="https://opensearch.org/blog/a-deep-dive-into-faster-semantic-sparse-retrieval-in-os-2-12/?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">A deep dive into faster semantic sparse retrieval in OpenSearch 2.12</a></p>
<p>[7] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fbig-data%2Fintegrate-sparse-and-dense-vectors-to-enhance-knowledge-retrieval-in-rag-using-amazon-opensearch-service%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/big-data/integrate-sparse-and-dense-vectors-to-enhance-knowledge-retrieval-in-rag-using-amazon-opensearch-service/" ref="nofollow noopener noreferrer">Integrate sparse and dense vectors to enhance knowledge retrieval in RAG using Amazon OpenSearch Service</a></p>
<p>[8] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fopensearch-service%2Fserverless-vector-database%2F" target="_blank" title="https://aws.amazon.com/opensearch-service/serverless-vector-database/" ref="nofollow noopener noreferrer">Amazon OpenSearch Service as a Vector Database</a></p>
<p>[9] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fchina%2Fbuilding-a-knowledge-base-qna-application-based-on-amazon-opensearch-service-and-deepseek%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/china/building-a-knowledge-base-qna-application-based-on-amazon-opensearch-service-and-deepseek/" ref="nofollow noopener noreferrer">åŸºäº Amazon OpenSearch Service ä¸ DeepSeek æ„å»ºçŸ¥è¯†åº“é—®ç­”åº”ç”¨</a></p>
<p>[10]<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2Faws%2Fknowledge-bases-now-delivers-fully-managed-rag-experience-in-amazon-bedrock%2F" target="_blank" title="https://aws.amazon.com/blogs/aws/knowledge-bases-now-delivers-fully-managed-rag-experience-in-amazon-bedrock/" ref="nofollow noopener noreferrer"> Knowledge Bases now delivers fully managed RAG experience in Amazon Bedrock</a></p>
<p><strong>æœ¬ç¯‡ä½œè€…</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/363de0df0eec4ce6ba281e157bfb6e6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557656&amp;x-signature=bVT0xeOljejcA86nTcEZfa33GWw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>æœ¬æœŸæœ€æ–°å®éªŒã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_InfoQtail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_InfoQtail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_InfoQtail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_InfoQtail_0415" ref="nofollow noopener noreferrer">å¤šæ¨¡ä¸€ç«™é€š â€”â€” Amazon Bedrock ä¸Šçš„åŸºç¡€æ¨¡å‹åˆä½“éªŒ</a>ã€‹</p>
<p>âœ¨ ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨å¼•å¯¼æ‚¨æ·±å…¥æ¢ç´¢Amazon Bedrockçš„æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨ã€æ¨¡å‹è‡ªåŠ¨åŒ–è¯„ä¼°ä»¥åŠå®‰å…¨å›´æ (Guardrail)ç­‰é‡è¦åŠŸèƒ½ã€‚æ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œåˆ©ç”¨äºšé©¬é€ŠæŠ€æœ¯ä¸ç”Ÿæ€ï¼Œå¿«é€Ÿé›†æˆä¸éƒ¨ç½²ç”Ÿæˆå¼AIæ¨¡å‹èƒ½åŠ›ã€‚</p>
<p>â©ï¸[<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_InfoQtail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_InfoQtail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_InfoQtail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_InfoQtail_0415" ref="nofollow noopener noreferrer">ç‚¹å‡»è¿›å…¥å®éªŒ</a>] å³åˆ»å¼€å¯ AI å¼€å‘ä¹‹æ—…æ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäº NodeJs çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ä¸å®¹å™¨ä¼˜é›…åœæœº]]></title>    <link>https://juejin.cn/post/7575735719076331526</link>    <guid>https://juejin.cn/post/7575735719076331526</guid>    <pubDate>2025-11-24T02:56:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575735719076331526" data-draft-id="7575644469711683603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäº NodeJs çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ä¸å®¹å™¨ä¼˜é›…åœæœº"/> <meta itemprop="keywords" content="åç«¯,Node.js,JavaScript"/> <meta itemprop="datePublished" content="2025-11-24T02:56:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WindRunnerMax"/> <meta itemprop="url" content="https://juejin.cn/user/1829999989247214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäº NodeJs çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ä¸å®¹å™¨ä¼˜é›…åœæœº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1829999989247214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WindRunnerMax
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:56:52.000Z" title="Mon Nov 24 2025 02:56:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“åœ¨åç«¯æ‰§è¡Œå¤æ‚çš„ä»»åŠ¡æ—¶ï¼Œé€šå¸¸ä¸èƒ½å¤Ÿåœ¨çŸ­æ—¶é—´å†…å³æ—¶å“åº”ï¼Œä¾‹å¦‚æ–‡æ¡£å¯¼å…¥ã€å¯¼å‡ºä»»åŠ¡ç­‰ã€‚å†åŠ ä¸Šå½“å‰çš„<code>LLMs</code>å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ–‡æ¡£çš„å†™ä½œã€è´¨æ£€ã€ç¿»è¯‘ç­‰å¤æ‚ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡é€šå¸¸éƒ½æ¯”è¾ƒè€—æ—¶ï¼Œè¿™æ ·å°±éœ€è¦ä»»åŠ¡é˜Ÿåˆ—æ¥ç®¡ç†è¿™äº›å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºå’Œèµ„æºåˆ†é…ï¼Œè€Œä¼˜é›…åœæœºåˆ™ç”¨ä»¥ä¿è¯ä»»åŠ¡çš„å®Œæ•´å¤„ç†ã€‚</p>
<details>
<summary><strong>AI Infra ç³»åˆ—ç›¸å…³æ–‡ç« </strong></summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FBrowser%2F%25E5%259F%25BA%25E4%25BA%258Efetch%25E7%259A%2584SSE%25E6%2596%25B9%25E6%25A1%2588.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Browser/%E5%9F%BA%E4%BA%8Efetch%E7%9A%84SSE%E6%96%B9%E6%A1%88.md" ref="nofollow noopener noreferrer">åŸºäº fetch çš„ SSE æ–¹æ¡ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FPlugin%2F%25E5%259F%25BA%25E4%25BA%258E%25E5%2590%2591%25E9%2587%258F%25E6%25A3%2580%25E7%25B4%25A2%25E5%25AE%259E%25E7%258E%25B0%25E5%259F%25BA%25E7%25A1%2580RAG%25E6%259C%258D%25E5%258A%25A1.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Plugin/%E5%9F%BA%E4%BA%8E%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2%E5%AE%9E%E7%8E%B0%E5%9F%BA%E7%A1%80RAG%E6%9C%8D%E5%8A%A1.md" ref="nofollow noopener noreferrer">åŸºäºå‘é‡æ£€ç´¢å®ç°åŸºç¡€ RAG æœåŠ¡</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FPlugin%2F%25E6%25B5%2581%25E5%25BC%258FMarkdown%25E5%25A2%259E%25E9%2587%258F%25E5%25AF%258C%25E6%2596%2587%25E6%259C%25AC%25E8%25A7%25A3%25E6%259E%2590%25E7%25AE%2597%25E6%25B3%2595.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Plugin/%E6%B5%81%E5%BC%8FMarkdown%E5%A2%9E%E9%87%8F%E5%AF%8C%E6%96%87%E6%9C%AC%E8%A7%A3%E6%9E%90%E7%AE%97%E6%B3%95.md" ref="nofollow noopener noreferrer">æµå¼ Markdown å¢é‡å¯Œæ–‡æœ¬è§£æç®—æ³•</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FPlugin%2F%25E4%25BB%25BF%25E7%2585%25A7%25E8%25B1%2586%25E5%258C%2585%25E5%25AE%259E%25E7%258E%25B0Prompt%25E5%258F%2598%25E9%2587%258F%25E6%25A8%25A1%25E6%259D%25BF%25E8%25BE%2593%25E5%2585%25A5%25E6%25A1%2586.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Plugin/%E4%BB%BF%E7%85%A7%E8%B1%86%E5%8C%85%E5%AE%9E%E7%8E%B0Prompt%E5%8F%98%E9%87%8F%E6%A8%A1%E6%9D%BF%E8%BE%93%E5%85%A5%E6%A1%86.md" ref="nofollow noopener noreferrer">ä»¿ç…§è±†åŒ…å®ç° Prompt å˜é‡æ¨¡æ¿è¾“å…¥æ¡†</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FPlugin%2F%25E5%259F%25BA%25E4%25BA%258ENodeJs%25E5%25AE%259E%25E7%258E%25B0%25E4%25BB%25BB%25E5%258A%25A1%25E9%2598%259F%25E5%2588%2597%25E4%25B8%258E%25E4%25BC%2598%25E9%259B%2585%25E5%2581%259C%25E6%259C%25BA.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Plugin/%E5%9F%BA%E4%BA%8ENodeJs%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97%E4%B8%8E%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA.md" ref="nofollow noopener noreferrer">åŸºäº NodeJs çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ä¸å®¹å™¨ä¼˜é›…åœæœº</a></li>
</ul>
</details>
<h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>ä»»åŠ¡é˜Ÿåˆ—ç”¨äºç®¡ç†å’Œè°ƒåº¦å¼‚æ­¥ä»»åŠ¡ï¼Œåœ¨å®ç°æ—¶æˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨ä¸€äº›ç°æˆçš„åº“ï¼Œä¾‹å¦‚<code>Bull/BullMQ</code>ã€<code>Agenda</code>ç­‰ã€‚è€Œå¦‚æœéœ€è¦å®ç°æ›´å¤æ‚çš„ä»»åŠ¡/æ¶ˆæ¯è°ƒåº¦ï¼Œä¾‹å¦‚ä¸åŒç³»ç»Ÿã€åº”ç”¨ä¹‹é—´çš„å¯é æ¶ˆæ¯ä¼ é€’ç­‰æœåŠ¡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨<code>Kafka</code>ã€<code>RabbitMQ</code>ç­‰æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€‚æ•´ä½“æ¥è¯´ï¼Œå¼‚æ­¥ä»»åŠ¡å¯ä»¥å®ç°å¦‚ä¸‹åŠŸèƒ½:</p>
<ul>
<li>å¼‚æ­¥ä»»åŠ¡ï¼Œå°†è€—æ—¶çš„æ“ä½œæ”¾åˆ°åå°å»å¤„ç†ï¼Œè®©ä¸»ç¨‹åºèƒ½å¤Ÿå¿«é€Ÿè¿”å›å“åº”ã€‚</li>
<li>æµé‡å‰Šå³°ï¼Œå°†å¤§é‡è¯·æ±‚è½¬åŒ–ä¸ºä»»åŠ¡ï¼Œå¹³ç¨³åœ°å­˜å…¥é˜Ÿåˆ—ï¼Œç„¶åç³»ç»ŸæŒ‰ç…§èƒ½æ‰¿å—çš„å¤„ç†èƒ½åŠ›ï¼Œä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡è¿›è¡Œæ¶ˆè´¹ã€‚</li>
<li>é”™è¯¯é‡è¯•ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ—¶ï¼Œé˜Ÿåˆ—å¯ä»¥å°è¯•è¿›è¡Œé‡è¯•ï¼Œå¦‚æœé‡è¯•å¤šæ¬¡åä»ç„¶å¤±è´¥ï¼Œåˆ™å¯ä»¥å°†ä»»åŠ¡æ ‡è®°ä¸ºå¤±è´¥ã€‚</li>
</ul>
<p>ä¼˜é›…åœæœºåˆ™æ˜¯æŒ‡åœ¨åº”ç”¨ç¨‹åºå…³é—­æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚åœ¨è¿™é‡Œçš„ä¼˜é›…åœæœºä¸»è¦åˆ†ä¸ºé’ˆå¯¹è¯·æ±‚çš„å¤„ç†å’Œé’ˆå¯¹ä»»åŠ¡é˜Ÿåˆ—çš„å¤„ç†ï¼Œè¯·æ±‚çš„éƒ¨åˆ†é€šå¸¸ä¼šç”±ç½‘å…³åŠ ä¸Šæ¡†æ¶æœ¬èº«å¤„ç†ï¼Œè€Œä»»åŠ¡é˜Ÿåˆ—çš„é‡ç½®æˆ–è€…ç»“æŸï¼Œåˆ™éœ€è¦é æˆ‘ä»¬ä¸»åŠ¨å¤„ç†ã€‚æ•´ä½“æ¥è¯´ï¼Œä¼˜é›…åœæœºé€šå¸¸éœ€è¦åšå¦‚ä¸‹å¤„ç†:</p>
<ul>
<li>åœæ­¢æ¥æ”¶æ–°çš„è¯·æ±‚ï¼ŒæœåŠ¡éœ€è¦é¿å…æ–°çš„è¯·æ±‚è¿›å…¥ï¼Œè¿™éƒ¨åˆ†é€šå¸¸éœ€è¦ç½‘å…³ç­‰å‰ç½®èŠ‚ç‚¹æ¥å¤„ç†ã€‚</li>
<li>å¤„ç†å½“å‰è¯·æ±‚ï¼ŒæœåŠ¡éœ€è¦ç»§ç»­å¤„ç†å½“å‰å·²ç»åœ¨å¤„ç†ä¸­çš„è¯·æ±‚ï¼Œç¡®ä¿è¿™äº›è¯·æ±‚èƒ½å¤Ÿæ­£å¸¸å®Œæˆã€‚</li>
<li>é‡Šæ”¾å·²åˆ†é…èµ„æºï¼Œåœ¨è¯·æ±‚å¤„ç†å®Œæˆåï¼Œéœ€è¦é‡Šæ”¾æ‰€æœ‰ç”³è¯·çš„èµ„æºï¼Œä¾‹å¦‚å…³é—­æ•°æ®åº“è¿æ¥ç­‰ã€‚</li>
<li>å…³é—­æœåŠ¡ï¼Œå½“æ‰€æœ‰è¯·æ±‚éƒ½å¤„ç†å®Œæ¯•ä¸”èµ„æºéƒ½å·²é‡Šæ”¾åï¼Œéœ€è¦æ­£å¸¸å…³é—­æœåŠ¡ï¼Œæˆ–è€…å¼ºåˆ¶åœæœºã€‚</li>
</ul>
<p>åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬åœ¨<code>Nest</code>æ¡†æ¶çš„åŸºç¡€ä¸Šï¼Œå®ç°ç®€åŒ–ç‰ˆçš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦é˜Ÿåˆ—ã€‚å¹¶ä¸”åŸºäº<code>pm2</code>ç®¡ç†<code>NodeJs</code>è¿›ç¨‹ï¼Œå®ç°äº†ä¼˜é›…åœæœºçš„èƒ½åŠ›ï¼Œè€Œä¸”æ¢è®¨äº†<code>Linux</code>ç³»ç»Ÿä¸‹è¿›ç¨‹ä¸ä¿¡å·çš„ä¼ é€’è¡¨ç°ã€‚æ–‡ä¸­æ¶‰åŠçš„å®ç°éƒ½åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2Fwebpack-simple-environment" target="_blank" title="https://github.com/WindRunnerMax/webpack-simple-environment" ref="nofollow noopener noreferrer">github.com/WindRunnerMâ€¦</a> ä¸­ã€‚</p>
<h2 data-id="heading-1">ä»»åŠ¡é˜Ÿåˆ—</h2>
<p>ä»»åŠ¡é˜Ÿåˆ—çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œåœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ä¸»è¦ç›®æ ‡å°±æ˜¯æµé‡å‰Šå³°ï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒåº¦<code>LLMs</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†è¯·æ±‚æ’é˜Ÿå¤„ç†ï¼Œå½“å‰çš„äº‘æœåŠ¡å•†éƒ½ä¼šæœ‰å¹¶å‘è¯·æ±‚çš„é™åˆ¶ã€‚å½“å‰äº‘æœåŠ¡å•†ä¸»è¦æ˜¯ä¼šé™åˆ¶<code>RPM</code>å’Œ<code>TPM</code>ï¼Œå³æ¯åˆ†é’Ÿè¯·æ±‚æ•°å’Œæ¯åˆ†é’Ÿ<code>Token</code>æ•°é‡ï¼Œè¿™æ ·å°±éœ€è¦æˆ‘ä»¬åœ¨åº”ç”¨å±‚è¿›è¡Œè¯·æ±‚çš„æ’é˜Ÿå¤„ç†ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å°±ä¸å€ŸåŠ©å·²æœ‰çš„æ¡†æ¶ï¼Œè€Œæ˜¯ç›´æ¥å®ç°ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸»è¦ç›®æ ‡æ˜¯èƒ½å¤Ÿæ§åˆ¶å¹¶å‘ä»»åŠ¡ï¼Œå¹¶ä¸”å™è¿°å•è¿›ç¨‹ä»¥åŠå•æœºé›†ç¾¤æ¨¡å¼ã€åˆ†å¸ƒå¼ä»»åŠ¡çš„é”æ§åˆ¶æ–¹æ¡ˆã€‚è€Œé™¤äº†ä»»åŠ¡é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦å¤„ç†ï¼Œä¾‹å¦‚ä»æ•°æ®åº“è¯»å–çš„æ§åˆ¶å¹¶å‘ã€ä»»åŠ¡è¶…æ—¶æ§åˆ¶ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥åœ¨å®é™…åº”ç”¨ä¸­è¿›è¡Œæ‰©å±•ã€‚</p>
<p>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿé€šå¸¸ä¼šæœ‰æ¨é€æ¨¡å¼ä»¥åŠæ‹‰å–æ¨¡å¼ä¸¤ç§æ¶ˆæ¯æ¶ˆè´¹çš„æ–¹å¼ï¼Œè€Œå®é™…ä¸Šåœ¨æ‹‰å–æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…ä¹Ÿéœ€è¦å®ç°ç±»ä¼¼çš„ä»»åŠ¡é˜Ÿåˆ—æ¥æ§åˆ¶å¹¶å‘è¯·æ±‚ï¼Œä¾‹å¦‚<code>Kafka</code>ç³»ç»Ÿã€‚å½“ç„¶å¦‚æœæ˜¯æ¨é€æ¨¡å¼ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¿›è¡Œå¹¶å‘æ§åˆ¶ï¼Œä¾‹å¦‚<code>RabbitMQ</code>ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-2">å•å®ä¾‹ä»»åŠ¡</h3>
<p>æˆ‘ä»¬å…ˆæ¥å®ç°å•å®ä¾‹å•è¿›ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œé¦–å…ˆéœ€è¦å®ç°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ç±»ï¼Œé€šè¿‡å®ä¾‹åŒ–è¿™ä¸ªç±»æˆ‘ä»¬å¯ä»¥åœ¨å¤šä¸ªæœåŠ¡<code>Service</code>åˆ†åˆ«è°ƒåº¦é˜Ÿåˆ—å®ä¾‹ã€‚åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚è‹¥ä¸æƒ³åœ¨å…¨å±€åˆ†åˆ«åˆ›å»ºå®ä¾‹ï¼Œåœ¨<code>Next</code>ä¸­å°±åœ¨<code>Provider</code>çš„ç±»ä¸­ç‹¬ç«‹ç»´æŠ¤å®ä¾‹ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„å…¶<code>Scope</code>å¿…é¡»ä¸ºå…¨å±€å•ä¾‹è€Œéè¯·æ±‚çº§å®ä¾‹ã€‚</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">Injectable</span>({ <span class="hljs-attr">scope</span>: <span class="hljs-title class_">Scope</span>.<span class="hljs-property">DEFAULT</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TasksService</span> {}
</code></pre>
<p>æ¥ä¸‹æ¥å‡è®¾å®é™…ä»»åŠ¡æ˜¯åœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„ï¼Œæ¯•ç«Ÿä»»åŠ¡éœ€è¦æŒä¹…åŒ–å­˜å‚¨ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚ç„¶åéœ€è¦å®ç°<code>TaskQueue</code>ç±»ä»¥æ§åˆ¶å¹¶å‘ä»»åŠ¡ï¼Œç”±äºæˆ‘ä»¬ç°åœ¨æ˜¯å•å®ä¾‹å•è¿›ç¨‹çš„æ¨¡å¼ï¼Œå°±ä¸éœ€è¦åˆ†å¸ƒå¼é”çš„è¦æ±‚ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨å†…å­˜ä¸­çš„å˜é‡æ¥æ§åˆ¶å¹¶å‘ä»»åŠ¡ï¼Œè¿™é‡Œå…ˆå®šä¹‰ç±»åŸºæœ¬çš„ç»“æ„:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> declare <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskQueue</span> {
  <span class="hljs-comment">/** å®ä¾‹/é”æ ‡è¯† */</span>
  private readonly key;
  <span class="hljs-comment">/** å¹¶å‘è¿è¡Œæ•° */</span>
  private readonly maxTasks;
  <span class="hljs-comment">/** æœ¬æœºæ­£åœ¨è¿è¡Œä»»åŠ¡æ•°é‡ */</span>
  private runningTasks;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-comment">/** å”¯ä¸€æ ‡è¯† */</span> key: string, <span class="hljs-comment">/** æœ€å¤§å¹¶è¡Œä»»åŠ¡æ•° */</span> maxTasks: number</span>);
  <span class="hljs-comment">/** å°è¯•æ‰¹é‡è°ƒåº¦ä»»åŠ¡ */</span>
  <span class="hljs-title function_">tryRun</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;;
  <span class="hljs-comment">/**  æ­£å¼è°ƒåº¦ä»»åŠ¡ */</span>
  <span class="hljs-title function_">run</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;;
  <span class="hljs-comment">/** è°ƒåº¦è¿è¡Œä»»åŠ¡ - éœ€è¦å®ä¾‹åŒ–åé‡å†™è¯¥æ–¹æ³• <span class="hljs-doctag">@returns</span> è¿”å›ä»»åŠ¡æ ‡è¯† id */</span>
  <span class="hljs-title function_">onRunning</span>(): <span class="hljs-title class_">Promise</span>&lt;string | <span class="hljs-literal">undefined</span>&gt;;
  <span class="hljs-comment">/** åˆ†é… Quota */</span>
  <span class="hljs-title function_">assign</span>(): <span class="hljs-title class_">Promise</span>&lt;boolean&gt;;
  <span class="hljs-comment">/** é‡Šæ”¾ Quota */</span>
  <span class="hljs-title function_">release</span>(): <span class="hljs-title class_">Promise</span>&lt;boolean&gt;;
}
</code></pre>
<p>æ¥ä¸‹æ¥å…³æ³¨äº<code>assign</code>å’Œ<code>release</code>åˆ†é…å’Œé‡Šæ”¾<code>Quota</code>æ–¹æ³•ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨å†…å­˜æ”¾ç½®<code>Record&lt;string, number&gt;</code>å¯¹è±¡æ¥ç®¡ç†å¹¶å‘ä»»åŠ¡çš„èµ„æºæ•°é‡ã€‚ç”±äºæœ€åéœ€è¦å®ç°åˆ†å¸ƒå¼é”ï¼Œå› æ­¤è¿™é‡Œçš„é€»è¾‘å®é™…ä¸Šæ˜¯ä¸<code>Redis</code>é”çš„<code>LUA</code>è„šæœ¬é€»è¾‘ç±»ä¼¼ã€‚</p>
<p>åˆ†é…<code>Quota</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥å½“å‰è¿è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¦å°äºæœ€å¤§å¹¶å‘æ•°ï¼Œå¦‚æœå°äºåˆ™åˆ†é…æˆåŠŸå¹¶å¢åŠ è¿è¡Œä»»åŠ¡æ•°é‡ï¼Œå¦åˆ™åˆ†é…å¤±è´¥ã€‚é‡Šæ”¾<code>Quota</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å‡å°‘è¿è¡Œä»»åŠ¡æ•°é‡ï¼Œç¡®ä¿ä¸ä¼šå°äºé›¶ï¼Œè¿™é‡Œä¸»è¦æ˜¯é¿å…åˆ‡æ¢<code>key</code>æ—¶é‡Šæ”¾çš„<code>Quota</code>å°†å€¼å†™ä¸ºè´Ÿæ•°ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¹¶å‘é‡å˜é«˜ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">assign</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;boolean&gt; {
  <span class="hljs-keyword">const</span> lockKey = <span class="hljs-string">"_lock_"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>;
  <span class="hljs-keyword">let</span> current = <span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey];
  <span class="hljs-keyword">if</span> (current === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>)  current = <span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (current &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxTasks</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">const</span> serial = ++<span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey];
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">release</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;boolean&gt; {
  <span class="hljs-keyword">const</span> lockKey = <span class="hljs-string">"_lock_"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>;
  <span class="hljs-keyword">const</span> current = <span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey];
  <span class="hljs-keyword">if</span> (current === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> || current &lt;= <span class="hljs-number">0</span>) {
    <span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  --<span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey];
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p>ç”±äºä»»åŠ¡æœ¬èº«å·²ç»ç”±é”æ§åˆ¶äº†å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤æ¥ä¸‹æ¥åªéœ€è¦æ§åˆ¶å¥½ä»»åŠ¡çš„æ‰§è¡Œæµç¨‹å³å¯ï¼Œè€Œæ§åˆ¶å¼‚æ­¥ä»»åŠ¡çš„æ–¹æ³•é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼Œç±»ä¼¼äº<code>webpack</code>çš„æ’ä»¶å®ç°ï¼Œä¸€ç§æ–¹å¼æ˜¯ç±»ä¼¼äºæ§åˆ¶åè½¬çš„æ–¹å¼å°†<code>done</code>å‡½æ•°ä¼ é€’åˆ°ä»»åŠ¡ä¸­ï¼Œå¦ä¸€ç§æ–¹å¼åˆ™æ˜¯ç›´æ¥åœ¨ä»»åŠ¡ä¸­è¿”å›<code>Promise</code>å¯¹è±¡ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç›´æ¥é‡‡ç”¨å¼‚æ­¥æ¨¡å¼ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
  <span class="hljs-keyword">const</span> assigned = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">assign</span>();
  <span class="hljs-keyword">if</span> (!assigned) <span class="hljs-keyword">return</span> <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">id</span>: string | <span class="hljs-literal">undefined</span> = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">runningTasks</span>++;
  <span class="hljs-keyword">try</span> {
    id = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onRunning</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Task Queue Running Error:"</span>, error);
  }
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">runningTasks</span>--;
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">release</span>();
  id &amp;&amp; process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tryRun</span>);
}
</code></pre>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†<code>onRunning</code>æ–¹æ³•é‡å†™ï¼Œä¹Ÿå°±æ˜¯åœ¨æœåŠ¡ä¸­å°†å†…ç½®æ–¹æ³•èµ‹å€¼åˆ°ç±»ä¸Šï¼Œé€šå¸¸è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ä»æ•°æ®åº“ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåè¿”å›ä»»åŠ¡çš„<code>id</code>ï¼Œå¦‚æœæ²¡æœ‰ä»»åŠ¡åˆ™è¿”å›<code>undefined</code>ã€‚è€Œè¿™ä¸ª<code>id</code>åˆ™ä¼šæ ‡è¯†åç»­çš„ä»»åŠ¡æ˜¯å¦ä¼šç»§ç»­æ‰§è¡Œï¼Œè¿™é‡Œçš„<code>nextTick</code>ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ ˆæº¢å‡ºçš„é—®é¢˜ã€‚</p>
<p>å¦‚æœåœ¨ä»»åŠ¡è°ƒåº¦ä¸­ç›´æ¥é€’å½’åœ°æ‰§è¡Œï¼Œåˆ™ä¼šå­˜åœ¨å †æ ˆæº¢å‡ºçš„å¯èƒ½ã€‚åœ¨ä¸‹é¢<code>recursion</code>è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæ˜¯åŒæ­¥çš„çš„å‡½æ•°æ‰§è¡Œï¼Œåˆ™ä¼šæŠ›å‡º<code>Maximum call stack size exceeded</code>çš„å¼‚å¸¸ã€‚è€Œå¦‚æœæ˜¯å¼‚æ­¥é€’å½’å‡½æ•°<code>asyncRecursion</code>ï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨éƒ½æ˜¯åœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œçš„ï¼Œé¿å…äº†æº¢å‡ºé—®é¢˜ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">recursion</span>(<span class="hljs-params">n</span>) {
  <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
  n % <span class="hljs-number">100</span> === <span class="hljs-number">0</span>  &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Depth: <span class="hljs-subst">${n}</span>`</span>); <span class="hljs-comment">// $</span>
  <span class="hljs-title function_">recursion</span>(n - <span class="hljs-number">1</span>)
}
<span class="hljs-title function_">recursion</span>(<span class="hljs-number">100000</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncRecursion</span>(<span class="hljs-params">n</span>) {
  <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
  n % <span class="hljs-number">100</span> === <span class="hljs-number">0</span>  &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Depth: <span class="hljs-subst">${n}</span>`</span>); <span class="hljs-comment">// $</span>
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">asyncRecursion</span>(n - <span class="hljs-number">1</span>));
}
<span class="hljs-title function_">asyncRecursion</span>(<span class="hljs-number">100000</span>);
</code></pre>
<p>å¹¶å‘æ‰§è¡Œä»»åŠ¡æ‰§è¡Œå°±éœ€è¦å®é™…å¯åŠ¨è¿™ä¸ª<code>run</code>å‡½æ•°ï¼Œä¸æ–­å°è¯•è°ƒåº¦ä»»åŠ¡å¹¶ä¸”æ‰§è¡Œï¼Œè€Œè°ƒåº¦ä»»åŠ¡çš„æ–¹å¼è‡ªç„¶å°±æ˜¯é€šè¿‡å¾ªç¯æ¥å®ç°æ‰¹é‡è°ƒåº¦ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡Œ<code>run</code>å‡½æ•°çš„æ—¶å€™ä¸èƒ½<code>await</code>ï¼Œå¦åˆ™å°±ä¼šé˜»å¡å½“å‰çš„äº‹ä»¶å¾ªç¯ï¼Œä»è€Œæ— æ³•å®ç°å¹¶å‘æ‰§è¡Œä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">tryRun</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
  <span class="hljs-keyword">const</span> batch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxTasks</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">runningTasks</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; batch; i++) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">run</span>();
  }
}
</code></pre>
<p>ä¸è¿‡è¿™é‡Œå…¶å®æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰ä»»åŠ¡å¯ä»¥è°ƒåº¦ï¼Œè¿˜æ˜¯ä¼šå°è¯•<code>maxTasks</code>æ¬¡ä»»åŠ¡æ‰§è¡Œï¼Œè¿™å…¶å®æ˜¯ä¼šå­˜åœ¨æ•°æ®åº“æ— æ•ˆè¯»çš„é—®é¢˜ã€‚ä¸è¿‡å¯¹äºæ•°æ®åº“æ¥è¯´è¿™é‡Œçš„è¯»æ“ä½œé€šå¸¸æ˜¯å¯ä»¥æ¥å—çš„ï¼Œæ•°æ®åº“é‡ŒçŠ¶æ€å€¼æ˜¯è¦åŠ ç´¢å¼•çš„ï¼Œå¦‚æœå®åœ¨ä¸å¯æ¥å—å°±éœ€è¦æ’é˜Ÿå»¶è¿Ÿ<code>run</code>çš„æ‰§è¡Œï¼Œä¾‹å¦‚å‰ä¸ªä»»åŠ¡<code>10s</code>å†…è¿”å›ç©ºå°±ä¸æ‰§è¡Œã€‚</p>
<h3 data-id="heading-3">åŸå­è¯»å†™</h3>
<p>é‚£ä¹ˆé‡å†™<code>onRunning</code>æ–¹æ³•çš„å®ç°ï¼Œä¸»è¦æ˜¯ä»æ•°æ®åº“ä¸­è¯»å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚å‡è®¾æˆ‘ä»¬æŸ¥æ‰¾æ•°æ®æ˜¯ä½¿ç”¨<code>find</code>è¯­å¥ï¼Œå†™æ•°æ®æ˜¯ä½¿ç”¨<code>update</code>è¯­å¥ï¼Œé‚£ä¹ˆå‡è®¾æ­¤æ—¶çš„çŠ¶æ€å­—æ®µä¸º<code>status</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹çš„çŠ¶æ€ï¼Œ<code>pending</code>å¾…å¤„ç†ã€<code>running</code>å¤„ç†ä¸­ã€<code>completed</code>å®Œæˆï¼Œ<code>failed</code>å¤±è´¥ã€‚</p>
<p>é‚£ä¹ˆå‡è®¾ç°åœ¨å·²ç»æœ‰<code>id</code>ä¸º<code>1</code>å’Œ<code>2</code>çš„ä¸¤ä¸ªä»»åŠ¡å¤„äº<code>pending</code>çŠ¶æ€ï¼Œå¹¶ä¸”æˆ‘ä»¬å…è®¸æœ€å¤§çš„å¹¶å‘æ•°ä¸º<code>2</code>ã€‚æ­¤æ—¶æˆ‘ä»¬åœ¨ä¸¤ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ä¸­è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¸­çŠ¶æ€ä¸º<code>pending</code>çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å°†å…¶çŠ¶æ€æ›´æ–°ä¸º<code>running</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä»»åŠ¡ 1</span>
<span class="hljs-keyword">await</span> find status=<span class="hljs-string">"pending"</span>
update id=$0 status=<span class="hljs-string">"running"</span> <span class="hljs-comment">// $</span>
<span class="hljs-comment">// ä»»åŠ¡ 2</span>
<span class="hljs-keyword">await</span> find status=<span class="hljs-string">"pending"</span>
update id=$0 status=<span class="hljs-string">"running"</span> <span class="hljs-comment">// $</span>
</code></pre>
<p>çœ‹èµ·æ¥è¿™ä¸ªè°ƒåº¦å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å®é™…ä¸Šä¼šå­˜åœ¨ç«æ€æ¡ä»¶çš„é—®é¢˜ã€‚ç”±äºä»»åŠ¡<code>1</code>å’Œä»»åŠ¡<code>2</code>åŒæ—¶æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œé‚£ä¹ˆä¸¤ä¸ªä»»åŠ¡éƒ½ä¼šæŸ¥è¯¢åˆ°<code>id=1</code>çš„ä»»åŠ¡ï¼Œç„¶åä¸¤ä¸ªä»»åŠ¡éƒ½ä¼šå°†å…¶çŠ¶æ€æ›´æ–°ä¸º<code>running</code>ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åŒä¸€ä¸ªä»»åŠ¡è¢«å¤šä¸ªè¿›ç¨‹å¤„ç†ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä»»åŠ¡ 1</span>
<span class="hljs-keyword">await</span> find status=<span class="hljs-string">"pending"</span> -&gt; id=<span class="hljs-number">1</span>
<span class="hljs-comment">// ä»»åŠ¡ 2</span>
<span class="hljs-keyword">await</span> find status=<span class="hljs-string">"pending"</span> -&gt; id=<span class="hljs-number">1</span>
</code></pre>
<p>ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºæŸ¥è¯¢å’Œæ›´æ–°æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œå¹¶è¡Œçš„ä»»åŠ¡ä¼šåŒæ—¶è§¦å‘æŸ¥è¯¢ï¼Œè€Œæœ¬èº«å¹¶æ²¡æœ‰é”æ¥ä¿è¯æŸ¥è¯¢åˆ°çš„ä»»åŠ¡åœ¨æ›´æ–°å‰ä¸ä¼šè¢«å…¶ä»–ä»»åŠ¡ä¿®æ”¹ã€‚å› æ­¤åœ¨å¹¶è¡Œæ‰§è¡Œæ—¶ï¼Œéœ€è¦ä¿è¯è¯»å†™çŠ¶æ€çš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å°†æŸ¥è¯¢å’Œæ›´æ–°åˆå¹¶ä¸ºä¸€ä¸ªæ“ä½œï¼Œä¾‹å¦‚åœ¨<code>mongodb</code>ä¸­å°±å­˜åœ¨<code>findOneAndUpdate</code>æ–¹æ³•ã€‚</p>
<p>é‚£ä¹ˆåœ¨è¿™é‡Œæˆ‘ä»¬åŒæ ·æ¨¡æ‹Ÿä¸€ä¸‹æ•°æ®å¤„ç†çš„é€»è¾‘ï¼Œç”±äº<code>Service</code>ç°åœ¨æ˜¯å•ä¾‹çš„ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥ç»´æŠ¤ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥å­˜å‚¨ä»»åŠ¡ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ª<code>findAndModify</code>æ–¹æ³•æ¥æ¨¡æ‹Ÿæ•°æ®åº“çš„æŸ¥è¯¢å’Œæ›´æ–°æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„æŸ¥è¯¢æ¡ä»¶æŸ¥æ‰¾ä»»åŠ¡ï¼Œå¹¶ä¸”å°†å…¶çŠ¶æ€æ›´æ–°ä¸ºæ–°çš„çŠ¶æ€ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TasksService</span> {
  public <span class="hljs-attr">tasks</span>: { <span class="hljs-attr">id</span>: string; <span class="hljs-attr">status</span>: <span class="hljs-string">"pending"</span> | <span class="hljs-string">"running"</span> | <span class="hljs-string">"success"</span> | <span class="hljs-string">"fail"</span> }[]

  private <span class="hljs-keyword">async</span> <span class="hljs-title function_">findAndModify</span>(<span class="hljs-params">
    find: { id?: string; status?: <span class="hljs-keyword">typeof</span> TasksService.prototype.tasks[<span class="hljs-number">0</span>][<span class="hljs-string">"status"</span>] } = {},
    status: <span class="hljs-keyword">typeof</span> TasksService.prototype.tasks[<span class="hljs-number">0</span>][<span class="hljs-string">"status"</span>]
  </span>) {
    <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (find.<span class="hljs-property">id</span> &amp;&amp; t.<span class="hljs-property">id</span> !== find.<span class="hljs-property">id</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (find.<span class="hljs-property">status</span> &amp;&amp; t.<span class="hljs-property">status</span> !== find.<span class="hljs-property">status</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
    <span class="hljs-keyword">if</span> (task) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Task <span class="hljs-subst">${task.id}</span> is <span class="hljs-subst">${task.status}</span> =&gt; <span class="hljs-subst">${status}</span>.`</span>);
      task.<span class="hljs-property">status</span> = status;
      <span class="hljs-keyword">return</span> task;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<p>è€Œé‡å†™<code>running</code>æ–¹æ³•è¿è¡Œä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨è¿™ä¸ª<code>findAndModify</code>æ–¹æ³•æ¥æŸ¥è¯¢å¹¶æ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼Œä»è€Œä¿è¯ä»»åŠ¡çš„åŸå­æ€§ã€‚è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´è¶…æ—¶æ—¶é—´ä¸º<code>2s</code>ï¼Œä»»åŠ¡æœ¬èº«æ˜¯éšæœºç”Ÿæˆçš„æ‰§è¡Œæ—¶é•¿ï¼Œè¿™é‡Œçš„çŠ¶æ€è½¬ç§»åŒæ ·æ˜¯ä½¿ç”¨ä¸Šè¿°æ–¹æ³•æ¥ä¸¥æ ¼æ§åˆ¶çŠ¶æ€è½¬ç§»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å˜é‡æ ‡è®°æ¥å¤„ç†ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onRunning</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> task = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findAndModify</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">"pending"</span> }, <span class="hljs-string">"running"</span>);
  <span class="hljs-keyword">if</span> (!task) <span class="hljs-keyword">return</span> <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">execute</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">3000</span>));
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findAndModify</span>({ <span class="hljs-attr">id</span>: task.<span class="hljs-property">id</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">"running"</span> }, <span class="hljs-string">"success"</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Task <span class="hljs-subst">${task.id}</span> cost <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now() - now}</span> ms.`</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findAndModify</span>({ <span class="hljs-attr">id</span>: task.<span class="hljs-property">id</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">"running"</span> }, <span class="hljs-string">"fail"</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Task"</span>, task.<span class="hljs-property">id</span>, <span class="hljs-string">"is fail."</span>, error);
    }
  };
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">timeout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">ms: number</span>) =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(ms);
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findAndModify</span>({ <span class="hljs-attr">id</span>: task.<span class="hljs-property">id</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">"running"</span> }, <span class="hljs-string">"fail"</span>);
  };
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">execute</span>(), <span class="hljs-title function_">timeout</span>(<span class="hljs-number">2000</span>)]);
  <span class="hljs-keyword">return</span> task.<span class="hljs-property">id</span>;
}
</code></pre>
<p>æ¥ä¸‹æ¥åŸºæœ¬å·²ç»å®Œæˆäº†å•å®ä¾‹å•è¿›ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—å®ç°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡æ¥å£å®ç°ä»»åŠ¡çš„åˆ›å»ºå’Œæ‰§è¡Œã€‚å¹¶ä¸”åœ¨æ¥å£ä¸­å®šä¹‰å¥½ä»»åŠ¡åˆ›å»ºçš„æ–¹æ³•ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬æ‰¹é‡åˆ›å»º<code>5</code>ä¸ªä»»åŠ¡ï¼Œç„¶åä¼šè°ƒç”¨é˜Ÿåˆ—çš„<code>tryRun</code>æ–¹æ³•æ¥å°è¯•è°ƒåº¦ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createTask</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> id = <span class="hljs-string">`task_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>_<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">1000</span>)}</span>`</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">push</span>({ id, <span class="hljs-attr">status</span>: <span class="hljs-string">"pending"</span> });
  <span class="hljs-keyword">return</span> { id };
}

@<span class="hljs-title class_">Controller</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> {
  @<span class="hljs-title class_">Inject</span>(<span class="hljs-title class_">IndexService</span>)
  private readonly indexService!: <span class="hljs-title class_">IndexService</span>;
  @<span class="hljs-title class_">Post</span>(<span class="hljs-string">"batch-create-task"</span>)
  public <span class="hljs-keyword">async</span> <span class="hljs-title function_">createTask</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// curl -X POST http://localhost:3000/batch-create-task</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasksService</span>.<span class="hljs-title function_">createTask</span>();
    }
  }
}
</code></pre>
<p>å½“æ‰§è¡Œå®Œæˆ<code>curl</code>åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä»»åŠ¡è¢«é¡ºåºè°ƒåº¦æ‰§è¡Œï¼Œå¹¶ä¸”å¹¶å‘æ•°è¢«é™åˆ¶åœ¨<code>2</code>ä»¥å†…ã€‚å½“ç„¶ç”±äºæœ¬èº«ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ˜¯éšæœºçš„ï¼Œå› æ­¤å®é™…çš„æ‰§è¡Œé¡ºåºä»¥åŠä»»åŠ¡çš„çŠ¶æ€æˆåŠŸä¸å¦éƒ½æ˜¯ä¸ç¡®å®šçš„ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">Lock Assign _lock_key 0 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Task task_1762683026625_272 is <span class="hljs-attr">pending</span> =&gt; running.
Task task_1762683026625_164 is <span class="hljs-attr">pending</span> =&gt; running.
Task task_1762683026625_272 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_272 cost 534 ms.
Task task_1762683026625_164 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_164 cost 1556 ms.
Lock Release _lock_key 2 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Task task_1762683026625_300 is <span class="hljs-attr">pending</span> =&gt; running.
Lock Release _lock_key 2 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Task task_1762683026625_944 is <span class="hljs-attr">pending</span> =&gt; running.
Task task_1762683026625_300 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_300 cost 378 ms.
Task task_1762683026625_944 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_944 cost 1852 ms.
Lock Release _lock_key 2 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Task task_1762683026625_42 is <span class="hljs-attr">pending</span> =&gt; running.
Lock Release _lock_key 2 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Lock Release _lock_key 2 -&gt; 1
Task task_1762683026625_42 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_42 cost 1119 ms.
Lock Release _lock_key 1 -&gt; 0
Lock Assign _lock_key 0 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Lock Release _lock_key 2 -&gt; 1
Lock Release _lock_key 1 -&gt; 0
</code></pre>
<h3 data-id="heading-4">åˆ†å¸ƒå¼é”</h3>
<p>å®é™…ä¸Šå…³äºé”çš„é—®é¢˜ï¼Œä¸Šè¿°çš„å•è¿›ç¨‹æ¨¡å¼ä»…éœ€è¦å¤„ç†å†…å­˜ï¼Œè€Œå¦‚æœæ˜¯å•æœºé›†ç¾¤æ¨¡å¼ï¼Œå³å¤šè¿›ç¨‹æ¨¡å¼å¯ä»¥å…±äº«å†…å­˜æˆ–è€…ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå¤„ç†ã€‚ç„¶è€Œç°åœ¨å¸¸è§çš„éƒ½æ˜¯åˆ†å¸ƒå¼å¤šå®ä¾‹æ¨¡å¼ï¼Œè¿™ç§æƒ…å†µä¸‹åˆ™éœ€è¦ä½¿ç”¨<code>Redis</code>ç­‰å¤–éƒ¨å­˜å‚¨ï¼Œå› ä¸ºéœ€è¦ä¸€ä¸ªé›†ä¸­å¼çš„é”ç®¡ç†ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>Redis</code>æä¾›äº†<code>RedLock</code>ç®—æ³•å¯ä»¥å®ç°åˆ†å¸ƒå¼äº’æ–¥ï¼Œä¹Ÿå°±æ˜¯é˜»æ­¢å¹¶å‘ï¼Œå› æ­¤å¹¶ä¸é€‚åˆæˆ‘ä»¬è¿™é‡Œçš„ä»»åŠ¡é˜Ÿåˆ—åœºæ™¯ã€‚è¿˜æœ‰<code>Redis</code>åˆ†å¸ƒå¼ä¸»ä»éƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œè‹¥æ˜¯<code>Redis</code>ä¸»èŠ‚ç‚¹æŒ‚æ‰ï¼Œä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´çŸ­æš‚çš„ä»»åŠ¡è¶…é™ï¼Œå³åŒæ—¶è¿è¡Œçš„ä»»åŠ¡æ•°è¶…è¿‡<code>MaxTask</code>ã€‚</p>
<p>å› æ­¤è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†å†…å­˜çš„é”å®ç°æ›¿æ¢ä¸º<code>Redis</code>çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œå¯¹æ¯”å†…å­˜çš„å®ç°ï¼Œç”±äºæœ¬èº«<code>Redis</code>æ”¯æŒ<code>incr</code>å’Œ<code>decr</code>åŸå­æ“ä½œï¼Œä½†æ˜¯å…¶ä¸èƒ½é™åˆ¶å…¶æ•°æ®èŒƒå›´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>LUA</code>è„šæœ¬æ¥å®ç°åˆ†å¸ƒå¼é”çš„åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯å¹¶è¡Œä»»åŠ¡çš„<code>LUA</code>å®ç°:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * Redis è‡ªå¢é” LUA è„šæœ¬
 * - KEYS[1]: é”çš„é”®å
 * - ARGV[1]: æœ€å¤§ä»»åŠ¡æ•° MaxTask
 * <span class="hljs-doctag">@example</span> ioredis.eval(LUA_SCRIPT, 1, LOCK_KEY, MAX_TASK);
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">INCR_LOCK_LUA</span> = <span class="hljs-string">`
  local current = redis.call("GET", KEYS[1])

  if not current then
    current = 0
  else
    current = tonumber(current)
  end

  if current &gt;= tonumber(ARGV[1]) then
    return -1
  end

  local new_count = redis.call("INCR", KEYS[1])
  return new_count
`</span>;

<span class="hljs-comment">/**
 * Redis è‡ªå‡é” LUA è„šæœ¬
 * - KEYS[1]: é”çš„é”®å
 * <span class="hljs-doctag">@example</span> ioredis.eval(LUA_SCRIPT, 1, LOCK_KEY);
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DESC_LOCK_LUA</span> = <span class="hljs-string">`
  local current = redis.call("GET", KEYS[1])
  
  if not current then
    return 0
  end

  current = tonumber(current)
  if current &lt;= 0 then
    return 0
  end

  local new_count = redis.call("DECR", KEYS[1])
  return new_count
`</span>;
</code></pre>
<h2 data-id="heading-5">ä¼˜é›…åœæœº</h2>
<p>ä¼˜é›…åœæœºçš„å¤„ç†è¦æ›´å¤æ‚ä¸€äº›ï¼Œå› ä¸ºå…¶ä¸èƒ½å®Œå…¨ä¾é æ¡†æ¶æœ¬èº«çš„å¤„ç†èƒ½åŠ›ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬åœ¨åº”ç”¨å±‚è¿›è¡Œå¤„ç†ã€‚å³æˆ‘ä»¬å¿…é¡»è¦å°†ä¿¡å·ä¼ é€’åˆ°è¿›ç¨‹ä¸­ï¼Œå¦‚æœè¿›ç¨‹æ²¡æœ‰æ”¶åˆ°ä¿¡å·çš„è¯ï¼Œé‚£ä¹ˆå°±æ— æ³•è¿›è¡Œä¼˜é›…åœæœºçš„å¤„ç†ï¼Œå³ä½¿æ˜¯å¤„ç†å¥½äº†ç›¸å…³èµ„æºçš„æ¸…ç†ï¼Œä¹Ÿæ²¡æœ‰å®é™…æ•ˆç”¨ã€‚</p>
<p>ç‰¹åˆ«çš„ï¼Œåœ¨åˆ†å¸ƒå¼éƒ¨ç½²çš„æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯éƒ¨ç½²åœ¨<code>Docker</code>å®¹å™¨ä¸­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¿¡å·çš„ä¼ é€’å°±éå¸¸ä¾èµ–å®¹å™¨æœ¬èº«çš„é…ç½®ï¼Œä»¥åŠå®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼ã€‚å‡è®¾åœæœºä¿¡å·ä»…å‘é€ç»™ä¸»è¿›ç¨‹è€Œä¸åƒæ˜¯<code>Ctrl+C</code>ä¸€æ ·å‘é€ç»™è¿›ç¨‹ç»„ï¼Œé‚£ä¹ˆä¼˜é›…åœæœºå°±å¿…é¡»è¦ä¸»åŠ¨å°†ä¿¡å·ä¼ é€’åˆ°å­è¿›ç¨‹ä¸­ï¼Œå¦åˆ™å­è¿›ç¨‹å°†æ— æ³•è¿›è¡Œåœæœºå¤„ç†ã€‚</p>
<h3 data-id="heading-6">SIGINT</h3>
<p><code>SIGINT</code>ä¿¡å·å°±æ˜¯æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„ä¿¡å·ç±»å‹ï¼Œå½“æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­æŒ‰ä¸‹<code>Ctrl+C</code>æ—¶ï¼Œç³»ç»Ÿä¼šå‘å½“å‰å‰å°è¿›ç¨‹ç»„å‘é€<code>SIGINT</code>ä¿¡å·ï¼Œä»è€Œè§¦å‘è¿›ç¨‹çš„ä¸­æ–­å¤„ç†ã€‚åœ¨<code>kill</code>å‘½ä»¤ä¸­ï¼Œ<code>SIGINT</code>ä¿¡å·çš„ç¼–å·ä¸º<code>2</code>ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>kill -2 &lt;pid&gt;</code>æˆ–è€…<code>kill -INT &lt;pid&gt;</code>å‘½ä»¤æ¥å‘é€è¯¥ä¿¡å·ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬æ¥å®ç°ç®€å•çš„<code>SIGINT</code>ä¿¡å·å¤„ç†ï¼Œéœ€è¦åˆ›å»ºç®€å•çš„<code>HTTP</code>æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡ç›‘å¬<code>process.on("SIGINT")</code>äº‹ä»¶æ¥å¤„ç†ä¿¡å·ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ<code>Ctrl+C</code>æ—¶ï¼ŒæœåŠ¡å™¨ä¸ä¼šç«‹å³å…³é—­ï¼Œè€Œæ˜¯ä¼šè¾“å‡ºç­‰å¾…çš„æç¤ºï¼Œæ¥ä¸‹æ¥ç­‰å¾…<code>2s</code>åå…³é—­ï¼Œç„¶åæ‰ä¼šé€€å‡ºè¿›ç¨‹ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">_, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Received Request"</span>, <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/plain"</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">"Hello, World!\n"</span>);
});

process.<span class="hljs-title function_">on</span>(<span class="hljs-string">"SIGINT"</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Received SIGINT. Shutting Down Gracefully..."</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(r, <span class="hljs-number">2000</span>));
  server.<span class="hljs-title function_">close</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Server Closed. Exiting Process."</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>);
  });
});

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;
server.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server Running at http://localhost:<span class="hljs-subst">${PORT}</span>/`</span>);
});
</code></pre>
<h3 data-id="heading-7">ä¿¡å·ä¼ é€’</h3>
<p><code>Ctrl+C</code>ä¼šç»™æ•´ä¸ªå‰å°è¿›ç¨‹ç»„å‘é€<code>SIGINT</code>ä¿¡å·ï¼Œä½†æ˜¯åœ¨ä¸šåŠ¡ä¸­å¯èƒ½ä¼šä»…å¯èƒ½ç»™ä¸»è¿›ç¨‹å‘é€<code>SIGINT</code>ä¿¡å·ï¼Œè¿™æ—¶å€™å­è¿›ç¨‹å°±æ— æ³•æ”¶åˆ°ä¿¡å·ã€‚æˆ‘ä»¬å¯ä»¥æ¥æ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè¡Œä¸ºï¼Œå½“ä½¿ç”¨<code>npx</code>å‘½ä»¤æ—¶ï¼Œå…¶å¹¶ä¸ä¼šå°†ä¿¡å·è½¬å‘åˆ°å…¶å¯åŠ¨çš„å­è¿›ç¨‹ã€‚æ­¤å¤–è¿˜æœ‰ä¸ªå¸¸ç”¨çš„ä¿¡å·æ˜¯<code>SIGTERM</code>ï¼Œç¼–å·ä¸º<code>15</code>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ps -A -o pid,ppid,comm,args &gt; ps.txt</span>
<span class="hljs-comment"># lsof -i :3000</span>
<span class="hljs-comment"># kill -INT 1234</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"signal.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
npx tsx ./src/index.ts
</code></pre>
<p>å½“ä½¿ç”¨<code>bash signal.sh</code>å¯åŠ¨è„šæœ¬æ—¶ï¼Œå…ˆè¾“å‡ºå½“å‰è¿›ç¨‹çš„<code>PID</code>å’Œä»¥åŠçˆ¶è¿›ç¨‹çš„<code>PPID</code>ã€‚æ­¤æ—¶ç”±äºè¿›ç¨‹æ˜¯<code>bash</code>å¯åŠ¨çš„ï¼Œå› æ­¤<code>PPID</code>æ˜¯<code>bash</code>çš„è¿›ç¨‹å·ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨<code>npx tsx</code>å¯åŠ¨<code>NodeJs</code>è¿›ç¨‹ï¼Œæ­¤æ—¶<code>NodeJs</code>è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å°±æ˜¯<code>npx</code>è¿›ç¨‹ï¼Œå‡è®¾è¾“å‡ºæ˜¯ä¸‹é¢çš„<code>id</code>:</p>
<pre><code class="hljs language-bash" lang="bash">signal.sh PID-PPID 66721,59534
59534 51513 /bin/zsh         /bin/zsh -il                 <span class="hljs-comment"># zsh shell</span>
66721 59534 bash             bash signal.sh               <span class="hljs-comment"># bash </span>
66722 66721 npm <span class="hljs-built_in">exec</span> tsx ./s npm <span class="hljs-built_in">exec</span> tsx ./src/index.ts  <span class="hljs-comment"># npx tsx</span>
</code></pre>
<p>æ­¤æ—¶å¦‚æœæ‰§è¡Œ<code>kill -INT 66721</code>å‘½ä»¤å‘é€åˆ°è„šæœ¬è¿›ç¨‹ï¼Œä¼šå‘ç°<code>NodeJs</code>è¿›ç¨‹å¹¶æ²¡æœ‰æ”¶åˆ°ä¿¡å·ï¼Œå› æ­¤æ— æ³•è¿›è¡Œä¼˜é›…åœæœºå¤„ç†ã€‚é€šå¸¸åœ¨è¿™ç§æƒ…å†µä¸‹åªèƒ½ç­‰å¾…ä¸€å®šæ—¶é—´åå¼ºåˆ¶æ€æ­»å­è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯<code>kill -9 &lt;pid&gt;</code>æˆ–è€…<code>kill -KILL &lt;pid&gt;</code>å‘½ä»¤ã€‚è€Œå¦‚æœç›´æ¥<code>kill -2 66722</code>ï¼Œåˆ™å¯ä»¥æ­£å¸¸åœæœºã€‚</p>
<p>æˆ‘ä»¬çš„å‡è®¾æ˜¯ä¿¡å·ä»…å‘é€åˆ°ä¸»è¿›ç¨‹ï¼Œè€Œæ­¤æ—¶çš„ä¸»è¿›ç¨‹å°±æ˜¯<code>bash</code>å¯åŠ¨å‘½ä»¤ï¼Œæ— æ³•ç»“æŸè¿›ç¨‹å°±å¾ˆåˆç†äº†ã€‚è¿™é‡Œé—®é¢˜å…¶å®å°±åœ¨äºæˆ‘ä»¬æ˜¯ä½¿ç”¨<code>npx</code>å¯åŠ¨çš„è¿›ç¨‹ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥æ‰§è¡ŒæœåŠ¡çš„å¯åŠ¨å‘½ä»¤ï¼Œåœ¨ä¿¡å·ä¸ä¼ é€’çš„æƒ…å†µä¸‹ï¼Œå­è¿›ç¨‹æ˜¯æ— æ³•æ”¶åˆ°ä¿¡å·çš„ã€‚</p>
<p>åœ¨<code>Bash</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>exec</code>å‘½ä»¤ç”¨äºæ›¿æ¢å½“å‰çš„<code>Shell</code>è¿›ç¨‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„å­è¿›ç¨‹ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨<code>npx</code>å‘½ä»¤å‰ä½¿ç”¨<code>exec</code>æ¥æ›¿æ¢æ‰å½“å‰çš„<code>bash</code>è¿›ç¨‹ï¼Œé‚£ä¹ˆä¿¡å·å°±å¯ä»¥ç›´æ¥ä¼ é€’åˆ°<code>NodeJs</code>è¿›ç¨‹ä¸­äº†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">exec</span> npx tsx ./src/index.ts
</code></pre>
<p>æ­¤æ—¶çš„è¿›ç¨‹å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼Œæ­¤æ—¶çš„ä¸»è¿›ç¨‹å°±æ˜¯<code>67033</code>è¿›ç¨‹å·äº†ï¼Œæ­¤æ—¶ç›´æ¥<code>kill -INT 67033</code>å°±å¯ä»¥æ­£å¸¸æ”¶åˆ°ä¿¡å·å¹¶ä¸”è¿›è¡Œä¼˜é›…åœæœºå¤„ç†äº†ã€‚è¿™é‡Œè¿˜éœ€è¦å…³æ³¨ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥ä½¿ç”¨ç»ˆç«¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥å…¶æœ¬èº«çš„è¿›ç¨‹<code>59534</code>å³<code>zsh</code>è¿›ç¨‹å·å°±æ˜¯çˆ¶è¿›ç¨‹å·ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">signal.sh PID-PPID 67033,59534
59534 51513 /bin/zsh         /bin/zsh -il
67033 59534 npm <span class="hljs-built_in">exec</span> tsx ./s npm <span class="hljs-built_in">exec</span> tsx ./src/index.ts   
</code></pre>
<p>ç”±äº<code>npx</code>ä¼šåˆ›å»ºå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå› æ­¤è‹¥æ˜¯å¯åŠ¨æœåŠ¡çš„å‘½ä»¤æœ¬èº«å¦‚æœä¹Ÿæ˜¯åˆ›å»ºå­è¿›ç¨‹çš„æ–¹å¼ï¼Œé‚£ä¹ˆåŒæ ·ä¼šå­˜åœ¨ä¿¡å·æ— æ³•ä¼ é€’çš„é—®é¢˜ã€‚å› æ­¤åœ¨ä½¿ç”¨<code>pm2</code>ç­‰è¿›ç¨‹ç®¡ç†å·¥å…·æ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„å…¶å¯åŠ¨å‘½ä»¤çš„ä¿¡å·ä¼ é€’é—®é¢˜ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥é¿å…ä½¿ç”¨<code>npx</code>å‘½ä»¤æ¥å¯åŠ¨è¿›ç¨‹ï¼Œæ­¤æ—¶æœåŠ¡å°±ä½œä¸ºé¡¶å±‚è¿›ç¨‹å¯åŠ¨äº†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$PWD</span>/node_modules/.bin:<span class="hljs-variable">$PATH</span>"</span>
<span class="hljs-built_in">exec</span> tsx ./src/index.ts
</code></pre>
<pre><code class="hljs language-bash" lang="bash">signal.sh PID-PPID 67675,59534
59534 51513 /bin/zsh         /bin/zsh -il
67675 59534 node             node /xxx/node_modules/.bin/../tsx/dist/cli.mjs ./src/index.ts
</code></pre>
<h3 data-id="heading-8">å­è¿›ç¨‹ç®¡ç†</h3>
<p>ç”±äºä¸‹é¢éœ€è¦ä»¥<code>PM2</code>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å®ç°ä¿¡å·ä¼ é€’ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±å…ˆåšä¸€ä¸ªç®€å•æœ‰è¶£çš„å®éªŒï¼Œä¸»è¦æ˜¯ä¸ºäº†è§‚å¯Ÿå­è¿›ç¨‹æ‰§è¡Œçš„æƒ…å†µã€‚é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šåœ¨éƒ¨ç½²ç¯å¢ƒä¸­ä½¿ç”¨å®¹å™¨å†…çš„è¿›ç¨‹ä¾‹å¦‚<code>systemd</code>æ¥å®ˆæŠ¤è¿›ç¨‹ï¼Œå¹¶ä¸ä¼šä½¿ç”¨<code>pm2</code>çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œä½†æ˜¯å¦‚æœç›´æ¥ä½¿ç”¨<code>pm2</code>å®ˆæŠ¤ï¼Œé‚£å°±éœ€è¦ä¸»åŠ¨ä¼ é€’ä¿¡å·ã€‚</p>
<p>å› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„çˆ¶å­è¿›ç¨‹æ¨¡å‹ï¼Œç›¸å½“äºç®€å•åœ°è¡¨ç¤ºä¸€ä¸‹è¿›ç¨‹çš„æ¨¡å‹ã€‚<code>child.sh</code>æ˜¯æ™®é€šçš„è„šæœ¬ï¼Œåœ¨è¿™é‡Œä¼šç›´æ¥ä½¿ç”¨<code>while</code>æ¥ä¿æŒè¿›ç¨‹ã€‚<code>normal.sh</code>æ˜¯çˆ¶è¿›ç¨‹è„šæœ¬ï¼Œä½¿ç”¨<code>bash</code>å¯åŠ¨<code>child.sh</code>ä½œä¸ºå­è¿›ç¨‹ã€‚<code>fork.sh</code>ä¹Ÿæ˜¯çˆ¶è¿›ç¨‹è„šæœ¬ï¼Œä½†æ˜¯ä¼šä½¿ç”¨<code>disown</code>æ¥åˆ†ç¦»è¿›ç¨‹ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># child.sh</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">sleep</span> 1
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"child.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
<span class="hljs-keyword">done</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># normal.sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"normal.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
bash child.sh &gt; /dev/tty 2&gt;&amp;1
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># fork.sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"fork.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
bash child.sh &gt; /dev/tty 2&gt;&amp;1 &amp;
<span class="hljs-built_in">disown</span> -h %1
</code></pre>
<p>å½“æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨ä¸¤ä¸ªç»ˆç«¯æ¥å¯åŠ¨<code>normal.sh</code>ä»¥åŠ<code>fork.sh</code>åï¼Œå¯ä»¥è§‚å¯Ÿåˆ°<code>normal</code>è¿›ç¨‹ä¼šæŒæœ‰ä¸”ä¸ä¼šåœæ­¢ï¼Œ<code>fork</code>è¿›ç¨‹ä¼šç»“æŸå…ˆå‰çš„è¿›ç¨‹ï¼Œå¯ä»¥åœ¨ç»ˆç«¯é‡Œæ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼Œç±»ä¼¼äºå°†å…¶æ”¾ç½®äºåå°ï¼Œæ³¨æ„è¾“å‡ºé‡å®šå‘åˆ°<code>tty</code>ç»ˆç«¯ä¸ä¼šåœ, ä¹Ÿå¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">normal.sh PID-PPID 70263,69842
child.sh PID-PPID 70264,70263
69842 51513 /bin/zsh         /bin/zsh -il
70263 69842 bash             bash normal.sh
70264 70263 bash             bash child.sh
72259 70264 <span class="hljs-built_in">sleep</span>            <span class="hljs-built_in">sleep</span> 1
</code></pre>
<pre><code class="hljs language-bash" lang="bash">fork.sh PID-PPID 70303,69954
child.sh PID-PPID 70304,1
69954 51513 /bin/zsh         /bin/zsh -il
70304     1 bash             bash child.sh
72260 70304 <span class="hljs-built_in">sleep</span>            <span class="hljs-built_in">sleep</span> 1
</code></pre>
<h3 data-id="heading-9">PM2 è¿›ç¨‹</h3>
<p>åœ¨å…ˆå‰çš„å®éªŒä¸­æˆ‘ä»¬å·²ç»è§‚å¯Ÿåˆ°äº†ä¿¡å·ä¼ é€’çš„é—®é¢˜ï¼Œé‚£ä¹ˆåœ¨<code>pm2</code>ä¸­åŒæ ·ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨<code>pm2 start</code>æ¥å¯åŠ¨è¿›ç¨‹ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æ˜¯ä½¿ç”¨<code>fork</code>æ¨¡å¼å¯åŠ¨çš„è¿›ç¨‹ï¼Œå› æ­¤ä¿¡å·æ˜¯æ— æ³•ä¼ é€’åˆ°å­è¿›ç¨‹ä¸­çš„ï¼Œå› ä¸ºè¿™ä¸ªè¿›ç¨‹ä¼šç«‹å³ç»“æŸæ‰ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PORT=3000
<span class="hljs-built_in">echo</span> <span class="hljs-string">"bootstrap.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
npx tsc --project tsconfig.json
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$PWD</span>/node_modules/.bin:<span class="hljs-variable">$PATH</span>"</span>
<span class="hljs-built_in">exec</span> pm2 start ./dist/index.js -i 2 --kill-timeout 5000 --log-date-format=<span class="hljs-string">"YYYY-MM-DD HH:mm:ss"</span> --<span class="hljs-built_in">log</span> ./output.log
</code></pre>
<p>æ­¤æ—¶çš„è¿›ç¨‹æ ‘å…³ç³»å¦‚ä¸‹ï¼Œç”±äºè¿›ç¨‹ä¼šç«‹å³ç»“æŸï¼Œæ­¤æ—¶<code>pm2</code>çš„ä¸»è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å°±æ˜¯<code>1</code>ã€‚ç„¶åç”±äºæ˜¯ä½¿ç”¨çš„é›†ç¾¤æ¨¡å¼ï¼Œå› æ­¤ä¼šå¯åŠ¨ä¸¤ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡ŒæœåŠ¡ï¼Œè€Œè¿™ä¸¤ä¸ªå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å°±æ˜¯<code>pm2</code>çš„ä¸»è¿›ç¨‹ï¼Œæ­¤æ—¶æˆ‘ä»¬æ˜¯æ²¡æœ‰åŠæ³•å‘é€<code>SIGINT</code>ä¿¡å·ç»™ä¸»è¿›ç¨‹ï¼Œè‡ªç„¶å­è¿›ç¨‹ä¹Ÿæ— æ³•æ”¶åˆ°ä¿¡å·ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">73353     1 PM2 v6.0.8: God  PM2 v6.0.8: God Daemon (/Users/czy/.pm2) 
73354 73353 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
73355 73353 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœéœ€è¦å°è¯•ä¼˜é›…åœæœºå¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸»åŠ¨å°†ä¿¡å·ä¼ é€’åˆ°å­è¿›ç¨‹ä¸­ã€‚é€šå¸¸æ¥è¯´ç”±äºè¿›ç¨‹ç»“æŸï¼Œæˆ‘ä»¬æ— æ³•ä»ä¸»è¿›ç¨‹ä¸­å¾—åˆ°å­è¿›ç¨‹çš„<code>PID</code>ï¼Œå› æ­¤åªèƒ½é€šè¿‡<code>pm2</code>æä¾›çš„å‘½ä»¤æ¥è·å–å­è¿›ç¨‹çš„<code>PID</code>ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨<code>ps</code>æ¥åŒ¹é…<code>PID</code>ï¼Œç„¶åå†å‘é€ä¿¡å·ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯å¯ä»¥ä¼˜é›…åœæœºçš„ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">kill</span> -INT $(pgrep pm2)
</code></pre>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»„åˆä¸Šé¢çš„è„šæœ¬æ¥å®ç°ä¿¡å·çš„ä¼ é€’å¤„ç†ï¼Œé¦–å…ˆéœ€è¦é¿å…ä¸»è¿›ç¨‹è„šæœ¬ç»“æŸæ‰ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨<code>while</code>æ¥ä¿æŒè¿›ç¨‹ï¼Œç„¶ååœ¨æ”¶åˆ°ä¿¡å·æ—¶è·å–å­è¿›ç¨‹çš„<code>PID</code>å¹¶ä¸”ä¼ é€’ä¿¡å·ã€‚æ³¨æ„è¿™ç§æƒ…å†µä¸‹ä¸èƒ½ç”¨<code>exec</code>äº†ï¼Œéœ€è¦æ­£å¸¸<code>fork</code>å‡ºå­è¿›ç¨‹ï¼Œå¦åˆ™åç»­<code>while</code>ä»¥åŠ<code>trap</code>ä»£ç ä¸ä¼šæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-bash" lang="bash">pm2 start ./dist/index.js -i 2 --kill-timeout 5000 --log-date-format=<span class="hljs-string">"YYYY-MM-DD HH:mm:ss"</span> --<span class="hljs-built_in">log</span> ./output.log
<span class="hljs-function"><span class="hljs-title">forward_signal</span></span>() {
    pm2_pid=$(pgrep pm2)
    <span class="hljs-built_in">kill</span> -INT <span class="hljs-variable">$pm2_pid</span>
    <span class="hljs-built_in">exit</span> 0
}
<span class="hljs-built_in">trap</span> forward_signal SIGINT
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">sleep</span> 1
<span class="hljs-keyword">done</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash">bootstrap.sh PID-PPID 76699,73203
76731     1 PM2 v6.0.8: God  PM2 v6.0.8: God Daemon (/Users/czy/.pm2) 
76732 76731 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
76733 76731 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
73203 51513 /bin/zsh         /bin/zsh -il
76699 73203 bash             bash bootstrap.sh
76895 76699 <span class="hljs-built_in">sleep</span>            <span class="hljs-built_in">sleep</span> 1
</code></pre>
<p>å®é™…ä¸Šï¼Œ<code>pm2</code>å½“å‰æ”¯æŒäº†<code>pm2-runtime</code>å‘½ä»¤æ¥æ›´å¥½åœ°æ”¯æŒå®¹å™¨åŒ–åœºæ™¯ä¸‹çš„è¿›ç¨‹ç®¡ç†ï¼ŒåŒæ ·çš„ä¹‹å‰å™è¿°çš„<code>npx</code>å‘½ä»¤é—®é¢˜ä¹Ÿä¼šå‡ºç°ã€‚ä»ä¸‹é¢çš„è¿›ç¨‹æ ‘ä¸­å¯ä»¥çœ‹å‡ºæ¥ä¿¡å·ä¼ é€’ä¼šæ¯”ä¹‹å‰å¤šäº†ä¸€å±‚ï¼Œè€Œæ‰§è¡Œ<code>kill -INT 80795</code>å‘½ä»¤æ—¶ï¼Œå­è¿›ç¨‹æ˜¯æ— æ³•æ”¶åˆ°ä¿¡å·çš„ï¼Œè¿›ç¨‹ä¹Ÿä¸ä¼šç»“æŸã€‚</p>
<pre><code class="hljs language-bash" lang="bash">78367 51513 /bin/zsh         /bin/zsh -il
80795 78367 bash             bash bootstrap.sh
80819 80795 npm <span class="hljs-built_in">exec</span> pm2-run npm <span class="hljs-built_in">exec</span> pm2-runtime start pm2.config.js --<span class="hljs-built_in">env</span> production      
80836 80819 node             node /xxx/.bin/../pm2/bin/pm2-runtime start pm2.config.js --<span class="hljs-built_in">env</span> production
80844 80836 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js     
80845 80836 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
</code></pre>
<p>å› æ­¤è¿™é‡Œçš„å®ç°ä»ç„¶éœ€è¦ä¿è¯ä½¿ç”¨<code>exec</code>æ¥å¯åŠ¨<code>pm2-runtime</code>æœåŠ¡ï¼Œæ­¤å¤–è¯¥å‘½ä»¤ä¸ä¼šå¯åŠ¨<code>pm2</code>çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œç›¸å…³æ—¥å¿—ä¼šç›´æ¥è¾“å‡ºåˆ°å½“å‰<code>shell</code>ä¸­ã€‚è€Œä¸”ä¹Ÿæ˜¯æ”¯æŒé›†ç¾¤æ¨¡å¼çš„ï¼Œä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä½¿ç”¨<code>pm2-runtime</code>å¯åŠ¨çš„è¿›ç¨‹å…³ç³»æ ‘ï¼Œæ‰§è¡Œ<code>kill -INT 84685</code>å¯ä»¥æ­£å¸¸å¤„ç†ä¿¡å·ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">78367 51513 /bin/zsh         /bin/zsh -il
78673 78367 node             node /xxx/.bin/../pm2/bin/pm2-runtime start pm2.config.js --<span class="hljs-built_in">env</span> production
78704 78673 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js     
78705 78673 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js
</code></pre>
<h3 data-id="heading-10">å¿ƒè·³æœºåˆ¶</h3>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œé™¤äº†ä¿¡å·ä¼ é€’çš„é—®é¢˜ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¿›ç¨‹æœ¬èº«çš„å­˜æ´»æ£€æµ‹é—®é¢˜ã€‚å‡è®¾æŸä¸ªå®ä¾‹ç”±äºæŸäº›åŸå› ç›´æ¥é€€å‡ºäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ— æ³•è¿›è¡Œä¼˜é›…åœæœºå¤„ç†äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡å¿ƒè·³æœºåˆ¶æ¥æ£€æµ‹è¿›ç¨‹çš„å­˜æ´»çŠ¶æ€ï¼Œä»¥æ­¤æ¥ç»´æŠ¤æœåŠ¡æœ¬èº«çš„å¥å£®æ€§ã€‚</p>
<p>å¿ƒè·³æœºåˆ¶çš„å®ç°å…¶å®éå¸¸ç®€å•ï¼Œä¸»è¦æ˜¯é€šè¿‡å®šæ—¶å‘å­˜å‚¨ä½ç½®å†™å…¥å½“å‰çš„æ—¶é—´æˆ³æ¥è¡¨ç¤ºè¿›ç¨‹çš„å­˜æ´»çŠ¶æ€ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨<code>Redis</code>æ¥å­˜å‚¨å¿ƒè·³æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆæ¯ä¸ªå®ä¾‹å¯ä»¥ä½¿ç”¨å”¯ä¸€çš„<code>key</code>æ¥å­˜å‚¨è‡ªå·±çš„å¿ƒè·³æ—¶é—´æˆ³ï¼Œç„¶åå®šæ—¶æ›´æ–°è¿™ä¸ªæ—¶é—´æˆ³ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">launchInstance</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">keep</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// æ›´æ–° Redis å¿ƒè·³æ—¶é—´æˆ³</span>
    <span class="hljs-built_in">setTimeout</span>(keep, <span class="hljs-variable constant_">LOOP_TIME</span>);
  };
  <span class="hljs-title function_">keep</span>();
  <span class="hljs-comment">// å¼€æœºæ—¶æ¸…ç†ä¸€æ¬¡è¿‡æœŸå®ä¾‹</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-title function_">clearInactiveInstances</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Active Instance"</span>, res.<span class="hljs-property">active</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Inactive Instance"</span>, res.<span class="hljs-property">inactive</span>);
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">terminateInstance</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// ä¼˜é›…åœæœºæ—¶åˆ é™¤å½“å‰å®ä¾‹</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearInactiveInstances</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> entries = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable constant_">MEMORY_MAP</span>);
  <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-attr">active</span>: string[] = [];
  <span class="hljs-keyword">const</span> <span class="hljs-attr">inactive</span>: string[] = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> entries) {
    <span class="hljs-keyword">if</span> (now - <span class="hljs-title class_">Number</span>(value) &gt; <span class="hljs-variable constant_">ACTIVE_TIME_OUT</span>) {
      <span class="hljs-comment">// æ¸…ç†è¿‡æœŸå®ä¾‹</span>
      inactive.<span class="hljs-title function_">push</span>(key);
      <span class="hljs-keyword">continue</span>;
    }
    active.<span class="hljs-title function_">push</span>(key);
  }
  <span class="hljs-keyword">return</span> { active, inactive };
};
</code></pre>
<p>ç”±äºå®ä¾‹æœ¬èº«å¦‚æœé€€å‡ºäº†ï¼Œé‚£ä¹ˆå¿ƒè·³æ—¶é—´æˆ³å°±ä¸ä¼šå†æ›´æ–°äº†ï¼Œè€Œä¸”å®ˆæŠ¤è¿›ç¨‹çš„å­˜åœ¨ï¼Œé€€å‡ºçš„è¿›ç¨‹ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…é‡å¯ã€‚é‚£ä¹ˆåœ¨ä¸šåŠ¡ä¸­ï¼Œä¾‹å¦‚æˆ‘ä»¬æœ€å¼€å§‹èŠçš„ä»»åŠ¡é˜Ÿåˆ—å®ç°ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å®ä¾‹å¯åŠ¨çš„æ—¶è·å–å½“å‰çš„æ´»è·ƒå®ä¾‹ï¼Œç„¶åæ£€æŸ¥æ­£åœ¨è¿è¡Œä»»åŠ¡çš„è°ƒåº¦å®ä¾‹<code>id</code>æ˜¯å¦è¿˜åœ¨æ´»è·ƒå®ä¾‹ä¸­ï¼Œä»¥æ­¤æ¥å°è¯•é‡æ–°è°ƒåº¦ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// task</span>
{
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">pod_id</span>: <span class="hljs-string">"$instance_id0"</span>,
  <span class="hljs-attr">status</span>: <span class="hljs-string">"running"</span>
}

<span class="hljs-comment">// redis</span>
[
  <span class="hljs-string">"$instance_id0"</span>: <span class="hljs-number">100</span>,
  <span class="hljs-string">"$instance_id1"</span>: <span class="hljs-number">9999999999</span>,
  <span class="hljs-string">"$instance_id2"</span>: <span class="hljs-number">9999999999</span>
]
</code></pre>
<h2 data-id="heading-11">æ€»ç»“</h2>
<p>åœ¨æ–‡æœ¬ä¸­æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶ä¸”å®ç°äº†ä¼˜é›…åœæœºçš„å¤„ç†ã€‚ä»»åŠ¡é˜Ÿåˆ—ä¸»è¦æ˜¯é€šè¿‡åˆ†å¸ƒå¼é”æ¥é™åˆ¶å¹¶å‘æ•°ï¼Œä»è€Œä¿è¯ä»»åŠ¡èƒ½å¤Ÿè¢«åˆç†åœ°è°ƒåº¦æ‰§è¡Œï¼Œä»è€Œå®ç°é•¿ä»»åŠ¡çš„å¼‚æ­¥è°ƒåº¦æœºåˆ¶ï¼Œå¹¶ä¸”å®ç°ä»»åŠ¡çš„æµé‡å‰Šå³°ã€é”™è¯¯é‡è¯•ç­‰ã€‚</p>
<p>ä¼˜é›…åœæœºçš„å¤„ç†ä¸»è¦æ˜¯é€šè¿‡ä¿¡å·ä¼ é€’æ¥å®ç°çš„ï¼Œä»è€Œä¿è¯è¿›ç¨‹èƒ½å¤Ÿåœ¨æ”¶åˆ°åœæœºä¿¡å·æ—¶è¿›è¡Œèµ„æºçš„æ¸…ç†å’Œä»»åŠ¡çš„å®Œæˆï¼Œé¿å…ä»»åŠ¡çš„ä¸­æ–­å’Œæ•°æ®çš„ä¸ä¸€è‡´é—®é¢˜ã€‚æ­¤å¤–è¿˜å™è¿°äº†çˆ¶å­è¿›ç¨‹é—´çš„ä¿¡å·ä¼ é€’ï¼Œä»¥åŠå®ç°å¿ƒè·³æœºåˆ¶æ¥æ£€æµ‹å®ä¾‹çš„å­˜æ´»çŠ¶æ€ï¼Œä»è€Œä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æœåŠ¡å¥å£®æ€§ã€‚</p>
<h2 data-id="heading-12">æ¯æ—¥ä¸€é¢˜</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay" target="_blank" title="https://github.com/WindRunnerMax/EveryDay" ref="nofollow noopener noreferrer">github.com/WindRunnerMâ€¦</a></li>
</ul>
<h2 data-id="heading-13">å‚è€ƒ</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nestjs.com%2Fmodules" target="_blank" title="https://docs.nestjs.com/modules" ref="nofollow noopener noreferrer">docs.nestjs.com/modules</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fdocker-pm2-nodejs%2F" target="_blank" title="https://pm2.keymetrics.io/docs/usage/docker-pm2-nodejs/" ref="nofollow noopener noreferrer">pm2.keymetrics.io/docs/usage/â€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fsignals-clean-restart%2F" target="_blank" title="https://pm2.keymetrics.io/docs/usage/signals-clean-restart/" ref="nofollow noopener noreferrer">pm2.keymetrics.io/docs/usage/â€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Design Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ï¼šæ„å»ºé«˜æ•ˆè®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7575438636332286003</link>    <guid>https://juejin.cn/post/7575438636332286003</guid>    <pubDate>2025-11-24T02:13:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575438636332286003" data-draft-id="7575469988737368073" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Design Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ï¼šæ„å»ºé«˜æ•ˆè®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-24T02:13:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åæ™®é€šçš„ç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/3913917126936087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Design Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ï¼šæ„å»ºé«˜æ•ˆè®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917126936087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åæ™®é€šçš„ç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:13:28.000Z" title="Mon Nov 24 2025 02:13:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Design Tokensæ˜¯ç°ä»£è®¾è®¡ç³»ç»Ÿä¸­çš„å…³é”®æŠ½è±¡å±‚ï¼Œå®ƒä»¬å°†è§†è§‰è®¾è®¡å…ƒç´ è½¬åŒ–ä¸ºå¯ç®¡ç†çš„å˜é‡ï¼Œä½¿è®¾è®¡ä¸å¼€å‘èƒ½å¤Ÿæ— ç¼åä½œå¹¶å®ç°ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ</strong>ã€‚ä½œä¸ºè®¾è®¡ä¸å¼€å‘çš„æ¡¥æ¢ï¼ŒDesign Tokensä¸ä»…æé«˜äº†å·¥ä½œæ•ˆç‡ï¼Œè¿˜ç¡®ä¿äº†äº§å“åœ¨ä¸åŒå¹³å°å’Œåœºæ™¯ä¸‹çš„è§†è§‰ä¸€è‡´æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æDesign Tokensçš„è®¾è®¡ç†å¿µã€åˆ†ç±»ä½“ç³»ã€å‘½åè§„åˆ™åŠå®æ–½æµç¨‹ï¼Œå¸®åŠ©è®¾è®¡å¸ˆå’Œå¼€å‘è€…å»ºç«‹å®Œæ•´çš„è®¾è®¡ç³»ç»Ÿå·¥ä½œæµã€‚</p>
<h3 data-id="heading-0">ä¸€ã€Design Tokensçš„åŸºæœ¬æ¦‚å¿µä¸æ ¸å¿ƒä»·å€¼</h3>
<p>Design Tokensçš„æ¦‚å¿µæœ€æ—©ç”±Salesforceçš„è®¾è®¡å›¢é˜Ÿåœ¨2014å¹´æå‡ºï¼Œå…¶åç§°æ¥æºäºè®¾è®¡å¸ˆJina Anne  ã€‚<strong>ç®€å•æ¥è¯´ï¼ŒDesign Tokensæ˜¯è®¾è®¡ç³»ç»Ÿä¸­çš„è§†è§‰è®¾è®¡åŸå­ï¼Œæ˜¯ä¸€ç»„æœ‰ç€ç»Ÿä¸€å‘½åè§„åˆ™çš„å®ä½“ï¼Œç”¨äºå­˜å‚¨è§†è§‰è®¾è®¡éƒ¨åˆ†çš„å…·ä½“å‚æ•°</strong>ï¼Œå¦‚HEXè‰²å€¼ã€é—´è·ã€å°ºå¯¸ã€å­—ä½“ç­‰  ã€‚å®ƒä»¬å¯ä»¥ç†è§£ä¸ºè®¾è®¡å¸ˆå’Œå¼€å‘äººå‘˜å…±åŒè®¤å¯çš„"å¤–å·"ï¼Œé€šè¿‡è¿™äº›å¤–å·è€Œéå…·ä½“çš„æ•°å€¼æ¥å¼•ç”¨è§†è§‰æ ·å¼  ã€‚</p>
<p>Design Tokensçš„æ ¸å¿ƒä»·å€¼ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<p>é¦–å…ˆï¼Œ<strong>Design Tokensç¡®ä¿äº†è®¾è®¡ä¸å¼€å‘çš„ä¸€è‡´æ€§</strong>ã€‚åœ¨ä¼ ç»Ÿè®¾è®¡æµç¨‹ä¸­ï¼Œè®¾è®¡å¸ˆåœ¨è®¾è®¡è½¯ä»¶ä¸­ä½¿ç”¨ç‰¹å®šæ ·å¼ï¼Œè€Œå¼€å‘äººå‘˜åˆ™éœ€è¦æ‰‹åŠ¨å°†è¿™äº›æ ·å¼è½¬æ¢ä¸ºä»£ç ï¼Œå®¹æ˜“å‡ºç°åå·®å’Œä¸ä¸€è‡´ã€‚é€šè¿‡Design Tokensï¼Œè®¾è®¡å¸ˆå’Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‘½åè§„åˆ™å’Œå‚æ•°å€¼ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬å’Œå®ç°åå·®ã€‚</p>
<p>å…¶æ¬¡ï¼Œ<strong>Design Tokenså¤§å¹…æå‡äº†å¼€å‘æ•ˆç‡</strong>ã€‚å½“å“ç‰Œè‰²æˆ–è®¾è®¡è§„èŒƒéœ€è¦è°ƒæ•´æ—¶ï¼Œä¼ ç»Ÿçš„åšæ³•éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç ï¼Œå·¥ä½œé‡å·¨å¤§ä¸”å®¹æ˜“å‡ºé”™ã€‚è€Œä½¿ç”¨Design Tokensåï¼Œåªéœ€ä¿®æ”¹ä¸€æ¬¡Tokenå€¼ï¼Œæ‰€æœ‰å¼•ç”¨è¯¥Tokençš„ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°  ã€‚ä¾‹å¦‚ï¼Œå½“å“ç‰Œä¸»è‰²ä»#00704aå˜æ›´ä¸º#007BFFæ—¶ï¼Œåªéœ€åœ¨Tokenä¸­ä¿®æ”¹ä¸€æ¬¡ï¼Œæ•´ä¸ªåº”ç”¨çš„æŒ‰é’®ã€å›¾æ ‡ã€æ–‡æœ¬ç­‰å…ƒç´ éƒ½ä¼šåŒæ­¥æ›´æ–°ï¼Œæ— éœ€é€ä¸ªä¿®æ”¹ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œ<strong>Design Tokensæ”¯æŒåŠ¨æ€ä¸»é¢˜å’Œå¤šå“ç‰Œåœºæ™¯</strong>ã€‚é€šè¿‡åˆ†å±‚ç®¡ç†å’Œæ¡ä»¶èµ‹å€¼ï¼Œå¯ä»¥è½»æ¾å®ç°æ˜æš—æ¨¡å¼åˆ‡æ¢ã€å“ç‰Œå®šåˆ¶ç­‰éœ€æ±‚  ã€‚ä¾‹å¦‚ï¼Œåœ¨æš—è‰²æ¨¡å¼ä¸‹ï¼Œå±é™©è‰²Tokençš„å€¼å¯ä»¥è‡ªåŠ¨ä»#FF4444åˆ‡æ¢ä¸º#FF6B6Bï¼Œè€Œå¼€å‘äººå‘˜æ— éœ€ç¼–å†™é¢å¤–é€»è¾‘ã€‚</p>
<p>æœ€åï¼Œ<strong>Design Tokensé™ä½äº†ç»´æŠ¤æˆæœ¬</strong>ã€‚éšç€äº§å“è¿­ä»£å’Œä¸šåŠ¡æ‰©å±•ï¼Œè®¾è®¡ç³»ç»Ÿéœ€è¦ä¸æ–­æ›´æ–°ã€‚Design Tokensæä¾›äº†ä¸€ç§ç»“æ„åŒ–çš„ç®¡ç†æ–¹å¼ï¼Œä½¿ç»´æŠ¤å’Œè¿­ä»£æ›´åŠ å¯æ§  ã€‚è®¾è®¡å¸ˆå¯ä»¥ä¸“æ³¨äºè®¾è®¡åˆ›æ–°ï¼Œè€Œå¼€å‘äººå‘˜åˆ™å¯ä»¥ä¸“æ³¨äºå®ç°é€»è¾‘ï¼ŒåŒæ–¹éƒ½èƒ½åœ¨å„è‡ªé¢†åŸŸé«˜æ•ˆå·¥ä½œã€‚</p>
<h3 data-id="heading-1">äºŒã€Design Tokensçš„åˆ†ç±»ä½“ç³»ä¸æ ¸å¿ƒå±æ€§</h3>
<p>Design Tokensçš„åˆ†ç±»ä½“ç³»é€šå¸¸åŸºäºè§†è§‰è®¾è®¡çš„åŸå­åŒ–åŸåˆ™ï¼Œå°†å¤æ‚çš„UIå…ƒç´ åˆ†è§£ä¸ºå¯å¤ç”¨çš„åŸºç¡€ç»„ä»¶ã€‚<strong>ä¸»è¦åˆ†ç±»åŒ…æ‹¬é¢œè‰²ç³»ç»Ÿã€æ’ç‰ˆç³»ç»Ÿã€é—´è·ä¸å°ºå¯¸ã€ç‰¹æ®Šå±æ€§ç­‰</strong>ï¼Œæ¯ç§åˆ†ç±»ä¸‹åˆæœ‰æ›´ç»†çš„å­ç±»  ã€‚</p>
<p>é¢œè‰²ç³»ç»Ÿæ˜¯Design Tokensä¸­æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ã€‚ä¸€ä¸ªå®Œæ•´çš„è®¾è®¡ç³»ç»Ÿé€šå¸¸åŒ…å«<strong>åŸºç¡€è‰²å’ŒåŠŸèƒ½è‰²ä¸¤å¤§éƒ¨åˆ†</strong>ï¼š</p>
<p>åŸºç¡€è‰²é€šå¸¸é‡‡ç”¨è‰²ç›¸-æ˜åº¦çš„åˆ†çº§ä½“ç³»ï¼Œå¦‚Semi Designçš„16ä¸ªè‰²ç›¸ï¼Œæ¯ä¸ªè‰²ç›¸åŒ…å«10ä¸ªæ˜åº¦ç­‰çº§ï¼Œä»0ï¼ˆæœ€æµ…ï¼‰åˆ°9ï¼ˆæœ€æ·±ï¼‰  ã€‚ä¾‹å¦‚çº¢è‰²ç³»åˆ—å¯ä»¥å®šä¹‰ä¸ºï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attr">--semi-red-0</span> : <span class="hljs-number">249</span>, <span class="hljs-number">57</span>, <span class="hljs-number">32</span>;  // æµ…çº¢è‰²
<span class="hljs-attr">--semi-red-9</span> : <span class="hljs-number">199</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>;    // æ·±çº¢è‰²
</code></pre>
<p>åŠŸèƒ½è‰²åˆ™åŸºäºç‰¹å®šåœºæ™¯å’Œç”¨é€”è¿›è¡Œå®šä¹‰ï¼Œå¦‚å“ç‰Œä¸»è‰²ã€æˆåŠŸè‰²ã€é”™è¯¯è‰²ã€è­¦å‘Šè‰²ç­‰  ã€‚è¿™äº›åŠŸèƒ½è‰²å¯ä»¥åŸºäºåŸºç¡€è‰²è¿›è¡Œè¡ç”Ÿï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">color</span>-primary: <span class="hljs-built_in">var</span>(--semi-blue-<span class="hljs-number">5</span>);  // å“ç‰Œä¸»è‰²
<span class="hljs-attribute">color</span>-error: <span class="hljs-built_in">var</span>(--semi-red-<span class="hljs-number">5</span>);     // é”™è¯¯é¢œè‰²
</code></pre>
<p>æ’ç‰ˆç³»ç»Ÿä¸»è¦åŒ…å«å­—å·ã€å­—é‡å’Œå­—ä½“å®¶æ—ç­‰å±æ€§ã€‚ä¸€ä¸ªå…¸å‹çš„æ’ç‰ˆç³»ç»Ÿå¯èƒ½å®šä¹‰5çº§å­—å·ï¼ˆå¦‚12pxåˆ°32pxï¼‰å’Œ3ç§å­—é‡ï¼ˆè½»ã€å¸¸è§„ã€ç²—ï¼‰  ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">font-size</span> small: <span class="hljs-number">12px</span>;    // è¾…åŠ©æ–‡æœ¬
<span class="hljs-attribute">font-size</span> regular: <span class="hljs-number">14px</span>;  // æ­£æ–‡
<span class="hljs-attribute">font-size</span> <span class="hljs-selector-tag">header</span>-<span class="hljs-number">6</span>: <span class="hljs-number">16px</span>; // å°æ ‡é¢˜
<span class="hljs-attribute">font-weight</span> bold: <span class="hljs-number">600</span>;     // å¼ºè°ƒæ–‡æœ¬
</code></pre>
<p>é—´è·ä¸å°ºå¯¸ç³»ç»Ÿåˆ™å®šä¹‰äº†UIå…ƒç´ ä¹‹é—´çš„é—´è·å’Œæ ‡å‡†å°ºå¯¸ï¼Œé€šå¸¸é‡‡ç”¨8çº§é—´è·ä½“ç³»ï¼ˆå¦‚2pxåˆ°40pxï¼‰å’Œ3ç§æ§ä»¶é«˜åº¦  ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">spacing-extra-tight: <span class="hljs-number">4</span>px;  <span class="hljs-comment">// ç´§å‡‘å†…è¾¹è·</span>
spacing-base: <span class="hljs-number">16</span>px;        <span class="hljs-comment">// é»˜è®¤é—´è·</span>
height-control-<span class="hljs-keyword">default</span>: <span class="hljs-number">32</span>px;  <span class="hljs-comment">// æŒ‰é’®/è¾“å…¥æ¡†é»˜è®¤é«˜åº¦</span>
</code></pre>
<p>ç‰¹æ®Šå±æ€§åŒ…æ‹¬z-indexå±‚çº§ã€æŠ•å½±æ•ˆæœã€é˜´å½±ç­‰çº§ã€åŠ¨ç”»æ›²çº¿ç­‰ï¼Œè¿™äº›å±æ€§å¯¹äºå¤æ‚UIçš„å‘ˆç°è‡³å…³é‡è¦  ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">z-modal: <span class="hljs-number">1000</span>;       <span class="hljs-comment">// æ¨¡æ€æ¡†å±‚çº§</span>
z-tooltip: <span class="hljs-number">1060</span>;     <span class="hljs-comment">// æç¤ºæ¡†å±‚çº§ï¼ˆé«˜äºæ¨¡æ€æ¡†ï¼‰</span>
shadow-low: <span class="hljs-number">0</span> <span class="hljs-number">2</span>px <span class="hljs-number">4</span><span class="hljs-function">px <span class="hljs-title">rgba</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.01</span>)</span></span>;  <span class="hljs-comment">// è¾ƒä½çš„é˜´å½±</span>
shadow-high: <span class="hljs-number">0</span> <span class="hljs-number">8</span>px <span class="hljs-number">16</span><span class="hljs-function">px <span class="hljs-title">rgba</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>)</span></span>;  <span class="hljs-comment">// è¾ƒé«˜çš„é˜´å½±</span>
</code></pre>
<p><strong>Design Tokensçš„ç²¾é«“åœ¨äºå°†å…±æ€§ç‰¹å¾/å±æ€§å˜æˆå¯æ“æ§çš„å˜é‡</strong>  ã€‚ä¾‹å¦‚ï¼Œå¤šä¸ªç»„ä»¶çš„åœ†è§’å¯èƒ½éƒ½æ˜¯4pxï¼Œä¸”è¿™äº›åœ†è§’éƒ½ç”¨äºç»„ä»¶çš„èƒŒæ™¯å±‚ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥ç»‘å®šå’Œä½¿ç”¨åŒä¸€ä¸ªåœ†è§’Tokenï¼Œå¦‚<code>corner-background-small</code>ã€‚å½“éœ€è¦å°†è¿™5ä¸ªç»„ä»¶çš„åœ†è§’éƒ½æ”¹ä¸º8pxæ—¶ï¼Œåªéœ€ä¿®æ”¹ä¸€æ¬¡Tokenå€¼ï¼Œæ‰€æœ‰ç›¸å…³ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°  ã€‚</p>
<h3 data-id="heading-2">ä¸‰ã€å‘½åè§„åˆ™çš„è®¾è®¡åŸåˆ™ä¸æœ€ä½³å®è·µ</h3>
<p>Design Tokensçš„å‘½åè§„åˆ™æ˜¯ç¡®ä¿è®¾è®¡ä¸å¼€å‘åä½œé¡ºç•…çš„å…³é”®ã€‚<strong>è‰¯å¥½çš„å‘½åè§„åˆ™åº”å½“éµå¾ªè¯­ä¹‰åŒ–ã€ä¸€è‡´æ€§ã€å¯è¯»æ€§å’Œåˆ†å±‚ç»“æ„ç­‰åŸåˆ™</strong>  ã€‚</p>
<p>è¯­ä¹‰åŒ–åŸåˆ™è¦æ±‚Tokenåç§°èƒ½å¤Ÿæ¸…æ™°è¡¨è¾¾å…¶ç”¨é€”å’Œä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼Œ<code>color-button-background-primary-normal</code>æ¯”ç®€å•çš„<code>color-1</code>æ›´æœ‰æ„ä¹‰ï¼Œèƒ½å¤Ÿæ˜ç¡®è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæŒ‰é’®çš„ä¸»çŠ¶æ€èƒŒæ™¯è‰²  ã€‚è¿™ç§å‘½åæ–¹å¼ä½¿å¾—è®¾è®¡å¸ˆå’Œå¼€å‘è€…éƒ½èƒ½ç›´è§‚ç†è§£Tokençš„ç”¨é€”ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬ã€‚</p>
<p>ä¸€è‡´æ€§åŸåˆ™è¦æ±‚æ•´ä¸ªè®¾è®¡ç³»ç»Ÿä¸­Tokençš„å‘½åé£æ ¼ä¿æŒç»Ÿä¸€ã€‚è¿™åŒ…æ‹¬ä½¿ç”¨ç›¸åŒçš„åˆ†éš”ç¬¦ï¼ˆå¦‚æ¨ªçº¿ï¼‰ã€ç›¸åŒçš„å‘½åå±‚çº§ï¼ˆå¦‚"åˆ†ç±»-åœºæ™¯-çŠ¶æ€"ï¼‰ä»¥åŠç›¸åŒçš„æœ¯è¯­  ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰é¢œè‰²Tokenéƒ½åº”ä½¿ç”¨<code>color-</code>å‰ç¼€ï¼Œæ‰€æœ‰é—´è·Tokenéƒ½åº”ä½¿ç”¨<code>spacing-</code>å‰ç¼€ï¼Œä¿æŒå‘½åçš„ä¸€è‡´æ€§ã€‚</p>
<p>å¯è¯»æ€§åŸåˆ™è¦æ±‚Tokenåç§°åº”å½“ç®€æ´æ˜äº†ï¼Œé¿å…è¿‡é•¿æˆ–è¿‡äºå¤æ‚çš„å‘½åã€‚åŒæ—¶ï¼Œåç§°åº”å½“ä½¿ç”¨è‹±æ–‡ï¼Œå› ä¸ºè¿™æ˜¯è®¾è®¡ä¸å¼€å‘åä½œçš„é€šç”¨è¯­è¨€  ã€‚ä¾‹å¦‚ï¼Œ<code>button-bg-color</code>æ¯”<code>btnèƒŒæ™¯è‰²</code>æ›´åˆé€‚ï¼Œå› ä¸ºå®ƒä½¿ç”¨è‹±æ–‡ä¸”ç®€æ´ã€‚</p>
<p>åˆ†å±‚ç»“æ„åŸåˆ™è¦æ±‚Tokenåç§°èƒ½å¤Ÿåæ˜ å…¶åœ¨è®¾è®¡ç³»ç»Ÿä¸­çš„å±‚çº§å…³ç³»ã€‚é€šå¸¸é‡‡ç”¨ä¸‰çº§ç»“æ„ï¼šåŸºç¡€Tokenï¼ˆåŸå§‹å€¼ï¼‰ã€è¯­ä¹‰Tokenï¼ˆç”¨é€”è¯´æ˜ï¼‰å’Œç»„ä»¶Tokenï¼ˆç»„ä»¶çº§å˜é‡ï¼‰  ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css">// åŸºç¡€Token
<span class="hljs-attr">--semi-blue-5</span>: <span class="hljs-number">#00704a</span>;

// è¯­ä¹‰Token
<span class="hljs-attribute">color</span>-brand-default: <span class="hljs-built_in">var</span>(--semi-blue-<span class="hljs-number">5</span>);

// ç»„ä»¶Token
<span class="hljs-selector-tag">button</span>-bg-<span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(color-brand-default);
</code></pre>
<p>è¿™ç§åˆ†å±‚ç»“æ„ä½¿å¾—è®¾è®¡ç³»ç»Ÿæ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚åŸºç¡€Tokenæ˜¯è®¾è®¡ç³»ç»Ÿçš„åº•å±‚å…ƒç´ ï¼Œè¯­ä¹‰Tokenåˆ™èµ‹äºˆè¿™äº›åŸºç¡€å…ƒç´ å…·ä½“çš„ç”¨é€”ï¼Œç»„ä»¶Tokenåˆ™å°†è¿™äº›è¯­ä¹‰Tokenåº”ç”¨åˆ°å…·ä½“çš„ç»„ä»¶ä¸­ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ<strong>Tokenå‘½åé€šå¸¸é‡‡ç”¨"åˆ†ç±»-åœºæ™¯-çŠ¶æ€"æ¨¡å¼</strong>  ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>é¢œè‰²Tokenï¼š<code>color-button-background-primary-normal</code></li>
<li>å­—ä½“Tokenï¼š<code>font-size-text regular</code></li>
<li>åœ†è§’Tokenï¼š<code>corner-background-small</code></li>
</ul>
<p>è¿™ç§å‘½åæ–¹å¼èƒ½å¤Ÿæ¸…æ™°è¡¨è¾¾Tokençš„åˆ†ç±»ã€åº”ç”¨åœºæ™¯å’ŒçŠ¶æ€ï¼Œä½¿è®¾è®¡å¸ˆå’Œå¼€å‘è€…éƒ½èƒ½å¿«é€Ÿç†è§£Tokençš„ç”¨é€”ã€‚</p>
<p>å¯¹äºå¤æ‚çš„é¡¹ç›®ï¼Œ<strong>å¯ä»¥é‡‡ç”¨"å¥—å¨ƒ"ç»“æ„ï¼Œå³åŸºç¡€Tokenä¸ç»„ä»¶Tokençš„å…³è”</strong>  ã€‚ä¾‹å¦‚ï¼Œç™»å½•æŒ‰é’®çš„èƒŒæ™¯è‰²å¯ä»¥å®šä¹‰ä¸º<code>login-button-bg</code>ï¼Œè€Œè¿™ä¸ªTokenå¯ä»¥å¼•ç”¨åŸºç¡€å“ç‰Œè‰²<code>brand-color-1</code>ï¼š</p>
<pre><code class="hljs language-css" lang="css">login-<span class="hljs-selector-tag">button</span>-bg: <span class="hljs-built_in">var</span>(brand-color-<span class="hljs-number">1</span>);
</code></pre>
<p>è¿™æ ·ï¼Œå½“å“ç‰Œè‰²éœ€è¦è°ƒæ•´æ—¶ï¼Œåªéœ€ä¿®æ”¹<code>brand-color-1</code>çš„å€¼ï¼Œæ‰€æœ‰å¼•ç”¨å®ƒçš„ç»„ä»¶Tokenéƒ½ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œä¿æŒè®¾è®¡çš„ä¸€è‡´æ€§ã€‚</p>
<h3 data-id="heading-3">å››ã€ä»è®¾è®¡åˆ°å¼€å‘çš„å®Œæ•´å®æ–½æµç¨‹</h3>
<p>å®æ–½Design Tokenséœ€è¦è®¾è®¡å›¢é˜Ÿå’Œå¼€å‘å›¢é˜Ÿçš„ç´§å¯†åä½œï¼Œé€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p>
<p>é¦–å…ˆï¼Œ<strong>åœ¨è®¾è®¡é˜¶æ®µï¼Œéœ€è¦ä»è®¾è®¡è§„èŒƒä¸­æå–è§†è§‰å…ƒç´ å¹¶å®šä¹‰åŸºç¡€Token</strong>  ã€‚è®¾è®¡å¸ˆåº”å½“ä¸å¼€å‘äººå‘˜å…±åŒå‚ä¸è¿™ä¸€è¿‡ç¨‹ï¼Œç¡®ä¿åŒæ–¹å¯¹Tokençš„å®šä¹‰å’Œç”¨é€”æœ‰å…±åŒç†è§£ã€‚æå–çš„è§†è§‰å…ƒç´ åŒ…æ‹¬é¢œè‰²ã€å­—ä½“ã€é—´è·ã€åœ†è§’ã€é˜´å½±ç­‰åŸºç¡€è®¾è®¡å…ƒç´   ã€‚ä¾‹å¦‚ï¼Œä»è®¾è®¡è§„èŒƒä¸­æå–æ‰€æœ‰æŒ‰é’®çš„èƒŒæ™¯è‰²ã€è¾¹æ¡†é¢œè‰²ã€æ–‡å­—é¢œè‰²ç­‰ï¼Œå¹¶ä¸ºè¿™äº›é¢œè‰²å®šä¹‰åŸºç¡€Tokenã€‚</p>
<p>ç„¶åï¼Œ<strong>åœ¨è®¾è®¡å·¥å…·ä¸­å»ºç«‹Tokenç®¡ç†ç³»ç»Ÿ</strong>  ã€‚è®¾è®¡å¸ˆå¯ä»¥ä½¿ç”¨Sketchã€Figmaç­‰è®¾è®¡å·¥å…·çš„æ ·å¼åº“åŠŸèƒ½ï¼Œå°†æå–çš„è§†è§‰å…ƒç´ è½¬åŒ–ä¸ºTokenï¼Œå¹¶æŒ‰ç…§åˆ†ç±»ã€åœºæ™¯å’ŒçŠ¶æ€è¿›è¡Œç»„ç»‡  ã€‚ä¾‹å¦‚ï¼Œåœ¨Figmaä¸­åˆ›å»ºé¢œè‰²ã€å­—ä½“ã€é—´è·ç­‰åˆ†ç±»ï¼Œæ¯ä¸ªåˆ†ç±»ä¸‹å†æŒ‰åœºæ™¯å’ŒçŠ¶æ€ç»„ç»‡Tokenã€‚åŒæ—¶ï¼Œè®¾è®¡å¸ˆåº”å½“å°†Tokenè®°å½•åœ¨è¡¨æ ¼ä¸­ï¼ŒåŒ…æ‹¬Tokenåç§°ã€ä¸­æ–‡åã€å€¼å’Œåº”ç”¨åœºæ™¯ç­‰ä¿¡æ¯ï¼Œä¾¿äºå¼€å‘äººå‘˜ç†è§£å’Œä½¿ç”¨  ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œ<strong>ä½¿ç”¨å·¥å…·é“¾å°†è®¾è®¡Tokenè½¬æ¢ä¸ºå¼€å‘ä»£ç </strong>  ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨Style Dictionaryã€Theoç­‰å·¥å…·ï¼Œå°†è®¾è®¡Tokenå¯¼å‡ºä¸ºä¸åŒå¹³å°å’Œæ ¼å¼çš„ä»£ç   ã€‚ä¾‹å¦‚ï¼Œå°†Tokenå¯¼å‡ºä¸ºCSSå˜é‡ã€SCSSå˜é‡ã€JSONæ–‡ä»¶æˆ–React Contextç­‰æ ¼å¼ï¼Œä¾›å‰ç«¯å¼€å‘ä½¿ç”¨  ã€‚ä¸€ä¸ªå…¸å‹çš„Tokenè½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">// è®¾è®¡Token
<span class="hljs-attribute">color</span>-<span class="hljs-selector-tag">button</span>-<span class="hljs-attribute">background</span>-primary-<span class="hljs-attribute">normal</span>: <span class="hljs-number">#00704a</span>;

// è½¬æ¢ä¸ºCSSå˜é‡
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--color-button-background-primary-normal</span>: <span class="hljs-number">#00704a</span>;
}

// è½¬æ¢ä¸ºSCSSå˜é‡
$<span class="hljs-attribute">color</span>-<span class="hljs-selector-tag">button</span>-<span class="hljs-attribute">background</span>-primary-<span class="hljs-attribute">normal</span>: <span class="hljs-number">#00704a</span>;
</code></pre>
<p>åœ¨å¼€å‘é˜¶æ®µï¼Œ<strong>å°†Tokené›†æˆåˆ°ç»„ä»¶åº“å’Œä¸»é¢˜ç³»ç»Ÿä¸­</strong>  ã€‚å‰ç«¯å¼€å‘äººå‘˜åº”å½“å°†è½¬æ¢åçš„Tokenåº”ç”¨åˆ°ç»„ä»¶çš„æ ·å¼ä¸­ï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½ä½¿ç”¨Tokenè€Œéç¡¬ç¼–ç çš„å€¼  ã€‚åŒæ—¶ï¼Œåº”å½“å»ºç«‹ä¸»é¢˜ç³»ç»Ÿï¼Œé€šè¿‡æ¡ä»¶èµ‹å€¼å®ç°ä¸åŒä¸»é¢˜ï¼ˆå¦‚æ˜æš—æ¨¡å¼ï¼‰çš„åˆ‡æ¢  ã€‚ä¾‹å¦‚ï¼ŒSemi Designçš„å®ç°æ–¹å¼ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ˜æ¨¡å¼å±é™©è‰²å®šä¹‰ */</span>
<span class="hljs-attr">--semi-red-5</span> : <span class="hljs-number">249</span>, <span class="hljs-number">57</span>, <span class="hljs-number">32</span>;

<span class="hljs-comment">/* æš—æ¨¡å¼å±é™©è‰²è‡ªåŠ¨åè½¬ */</span>
<span class="hljs-attr">--semi-red-5</span> : <span class="hljs-number">252</span>, <span class="hljs-number">114</span>, <span class="hljs-number">90</span>;
</code></pre>
<p>æœ€åï¼Œ<strong>å»ºç«‹Tokençš„ç»´æŠ¤å’Œè¿­ä»£æœºåˆ¶</strong>  ã€‚Design Tokensä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œéšç€äº§å“è¿­ä»£å’Œä¸šåŠ¡éœ€æ±‚å˜åŒ–ï¼Œéœ€è¦ä¸æ–­æ›´æ–°å’Œæ‰©å±•ã€‚å› æ­¤ï¼Œåº”å½“å»ºç«‹Tokençš„ç»´æŠ¤æœºåˆ¶ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬æ§åˆ¶ã€å˜æ›´é€šçŸ¥å’Œæ–‡æ¡£æ›´æ–°ç­‰  ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒç®¡ç†Tokenä»“åº“ï¼Œé€šè¿‡npmåŒ…å‘å¸ƒæ›´æ–°ï¼Œå¹¶å»ºç«‹å®Œå–„çš„æ–‡æ¡£ç³»ç»Ÿè®°å½•Tokençš„å®šä¹‰å’Œç”¨é€”  ã€‚</p>
<h3 data-id="heading-4">äº”ã€Design Tokensçš„å®æ–½å·¥å…·ä¸æœ€ä½³å®è·µ</h3>
<p>å®æ–½Design Tokenséœ€è¦ä¸€ç³»åˆ—å·¥å…·æ”¯æŒï¼ŒåŒ…æ‹¬è®¾è®¡å·¥å…·ã€è½¬æ¢å·¥å…·å’Œå¼€å‘å·¥å…·ç­‰ã€‚</p>
<p>åœ¨è®¾è®¡å·¥å…·æ–¹é¢ï¼ŒFigmaã€Sketchå’ŒAdobe XDç­‰ä¸»æµå·¥å…·éƒ½æ”¯æŒTokenç®¡ç†ã€‚<strong>Figmaçš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿæä¾›äº†å¤šç§Tokenç®¡ç†è§£å†³æ–¹æ¡ˆ</strong>ï¼Œå¦‚Tokens Studioã€Token Managerç­‰ï¼Œå¯ä»¥å°†è®¾è®¡Tokenå¯¼å‡ºä¸ºJSONæˆ–CSSå˜é‡æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Tokens Studioæ’ä»¶å¯ä»¥å¿«é€Ÿå¯¼å‡ºè®¾è®¡Tokenï¼Œå¹¶ä¸å¼€å‘å›¢é˜Ÿå…±äº«ã€‚</p>
<p>åœ¨è½¬æ¢å·¥å…·æ–¹é¢ï¼Œ<strong>Style Dictionaryå’ŒTheoæ˜¯ä¸¤ä¸ªæœ€å¸¸ç”¨çš„è®¾è®¡ç³»ç»Ÿè½¬æ¢å·¥å…·</strong>  ã€‚Style Dictionaryå¯ä»¥å°†è®¾è®¡Tokenä»JSONæ ¼å¼è½¬æ¢ä¸ºå¤šç§å¼€å‘æ ¼å¼ï¼Œå¦‚CSSã€SCSSã€Lessã€React Contextç­‰ã€‚Theoï¼ˆç”±Salesforceå¼€å‘ï¼‰åˆ™ä¸“æ³¨äºCSSå˜é‡çš„ç”Ÿæˆå’Œç®¡ç†ï¼Œæ”¯æŒä¸»é¢˜åˆ‡æ¢å’ŒåŠ¨æ€æ›´æ–°ã€‚è¿™äº›å·¥å…·å¤§å¤§ç®€åŒ–äº†è®¾è®¡åˆ°å¼€å‘çš„è½¬æ¢è¿‡ç¨‹ï¼Œæé«˜äº†å·¥ä½œæ•ˆç‡ã€‚</p>
<p>åœ¨å¼€å‘å·¥å…·æ–¹é¢ï¼Œ<strong>ç°ä»£å‰ç«¯æ¡†æ¶éƒ½æ”¯æŒTokençš„é›†æˆå’Œä½¿ç”¨</strong>ã€‚ä¾‹å¦‚ï¼Œåœ¨Reactä¸­å¯ä»¥ä½¿ç”¨Context APIç®¡ç†ä¸»é¢˜Tokenï¼›åœ¨Vueä¸­å¯ä»¥ä½¿ç”¨æä¾›/æ³¨å…¥ï¼ˆprovide/injectï¼‰æœºåˆ¶ï¼›åœ¨Flutterä¸­åˆ™å¯ä»¥ä½¿ç”¨ä¸»é¢˜ï¼ˆThemeï¼‰å’Œä¸»é¢˜æ•°æ®ï¼ˆThemeDataï¼‰æ¥ç®¡ç†Tokenã€‚åŒæ—¶ï¼ŒCSSå˜é‡ï¼ˆCustom Propertiesï¼‰æ˜¯å®ç°åŠ¨æ€ä¸»é¢˜å’Œè·¨å¹³å°ä¸€è‡´æ€§çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œåº”å½“å……åˆ†åˆ©ç”¨ã€‚</p>
<p>å®æ–½Design Tokensçš„æœ€ä½³å®è·µåŒ…æ‹¬ï¼š</p>
<p><strong>å»ºç«‹è·¨èŒèƒ½å›¢é˜Ÿ</strong>ï¼šè®¾è®¡ã€å¼€å‘å’Œäº§å“å›¢é˜Ÿåº”å½“å…±åŒå‚ä¸Design Tokensçš„è®¾è®¡å’Œå®æ–½ï¼Œç¡®ä¿å„æ–¹éœ€æ±‚éƒ½è¢«è€ƒè™‘  ã€‚è®¾è®¡å¸ˆè´Ÿè´£å®šä¹‰è§†è§‰å…ƒç´ ï¼Œå¼€å‘äººå‘˜è´Ÿè´£æŠ€æœ¯å®ç°ï¼Œäº§å“å›¢é˜Ÿåˆ™æä¾›ä¸šåŠ¡åœºæ™¯å’Œéœ€æ±‚æ´å¯Ÿã€‚</p>
<p><strong>é‡‡ç”¨æ¸è¿›å¼å®æ–½ç­–ç•¥</strong>ï¼šå¯¹äºå¤§å‹é¡¹ç›®ï¼Œå¯ä»¥é‡‡ç”¨æ¸è¿›å¼ç­–ç•¥ï¼Œå…ˆä»æ ¸å¿ƒç»„ä»¶å’Œé«˜é¢‘ä½¿ç”¨çš„è®¾è®¡å…ƒç´ å¼€å§‹ï¼Œé€æ­¥æ‰©å±•åˆ°æ•´ä¸ªè®¾è®¡ç³»ç»Ÿ  ã€‚ä¾‹å¦‚ï¼Œå…ˆå®šä¹‰é¢œè‰²å’Œå­—ä½“Tokenï¼Œå†é€æ­¥æ·»åŠ é—´è·ã€åœ†è§’ã€é˜´å½±ç­‰å…¶ä»–Tokenã€‚</p>
<p><strong>ä¿æŒTokençš„æœ€å°åŒ–å’Œå¯ç»„åˆæ€§</strong>ï¼šDesign Tokensåº”å½“å°½å¯èƒ½åŸºç¡€å’ŒåŸå­åŒ–ï¼Œä¾¿äºç»„åˆå’Œå¤ç”¨  ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰åŸºç¡€é¢œè‰²Tokenè€Œéå…·ä½“çš„ç»„ä»¶é¢œè‰²Tokenï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸åŒç»„ä»¶ä¸­çµæ´»ç»„åˆä½¿ç”¨ã€‚</p>
<p><strong>æä¾›å®Œå–„çš„æ–‡æ¡£å’Œç¤ºä¾‹</strong>ï¼šè‰¯å¥½çš„æ–‡æ¡£æ˜¯Design TokensæˆåŠŸå®æ–½çš„å…³é”®  ã€‚åº”å½“ä¸ºæ¯ä¸ªTokenæä¾›è¯¦ç»†çš„æ–‡æ¡£ï¼ŒåŒ…æ‹¬ç”¨é€”ã€å€¼ã€åº”ç”¨åœºæ™¯å’Œç¤ºä¾‹ç­‰ã€‚åŒæ—¶ï¼Œåº”å½“æä¾›UIç»„ä»¶åº“çš„ç¤ºä¾‹ï¼Œå±•ç¤ºTokenå¦‚ä½•åº”ç”¨åˆ°å®é™…ç»„ä»¶ä¸­ã€‚</p>
<p><strong>å®æ–½ç‰ˆæœ¬æ§åˆ¶å’Œå˜æ›´ç®¡ç†</strong>ï¼šDesign Tokensåº”å½“é‡‡ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿å˜æ›´å¯ä»¥è¿½æº¯å’Œå›æ»š  ã€‚åŒæ—¶ï¼Œåº”å½“å»ºç«‹å˜æ›´ç®¡ç†æµç¨‹ï¼Œç¡®ä¿é‡è¦å˜æ›´ç»è¿‡è¯„å®¡å’Œæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨GitHubç®¡ç†Tokenä»“åº“ï¼Œé€šè¿‡Pull Requestè¿›è¡Œå˜æ›´è¯„å®¡ã€‚</p>
<p><strong>æ”¯æŒåŠ¨æ€ä¸»é¢˜å’Œå¤šå“ç‰Œåœºæ™¯</strong>ï¼šDesign Tokensåº”å½“è®¾è®¡ä¸ºæ”¯æŒåŠ¨æ€ä¸»é¢˜å’Œå¤šå“ç‰Œåœºæ™¯ï¼Œé€šè¿‡æ¡ä»¶èµ‹å€¼å®ç°ä¸åŒä¸»é¢˜å’Œå“ç‰Œçš„åˆ‡æ¢  ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰æ˜æš—æ¨¡å¼ä¸‹çš„ä¸åŒTokenå€¼ï¼Œæˆ–ä¸ºä¸åŒå“ç‰Œå®šä¹‰ç‰¹å®šçš„Tokenæ‰©å±•å±‚  ã€‚</p>
<h3 data-id="heading-5">å…­ã€Design Tokensçš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p>å°½ç®¡Design Tokenså¸¦æ¥äº†è¯¸å¤šå¥½å¤„ï¼Œä½†åœ¨å®æ–½è¿‡ç¨‹ä¸­ä¹Ÿé¢ä¸´ä¸€äº›æŒ‘æˆ˜ã€‚</p>
<p><strong>Tokenæ•°é‡çˆ†ç‚¸</strong>ï¼šéšç€è®¾è®¡ç³»ç»Ÿçš„æ‰©å±•ï¼ŒTokenæ•°é‡å¯èƒ½ä¼šè¿…é€Ÿå¢åŠ ï¼Œå¯¼è‡´ç®¡ç†å›°éš¾ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨åˆ†å±‚ç»“æ„å’Œå‘½åç©ºé—´</strong>ï¼Œå°†TokenæŒ‰ç…§åˆ†ç±»ã€åœºæ™¯å’ŒçŠ¶æ€è¿›è¡Œç»„ç»‡ï¼Œé¿å…å‘½åå†²çªå’Œæ··ä¹±  ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>color-button-</code>ä½œä¸ºæŒ‰é’®é¢œè‰²çš„å‘½åç©ºé—´ï¼Œæ‰€æœ‰æŒ‰é’®ç›¸å…³çš„é¢œè‰²Tokenéƒ½ä½¿ç”¨è¿™ä¸€å‰ç¼€ã€‚</p>
<p><strong>è®¾è®¡ä¸å¼€å‘çš„æœ¯è¯­å·®å¼‚</strong>ï¼šè®¾è®¡å¸ˆå’Œå¼€å‘äººå‘˜å¯èƒ½ä½¿ç”¨ä¸åŒçš„æœ¯è¯­æè¿°ç›¸åŒçš„è§†è§‰å…ƒç´ ï¼Œå¯¼è‡´æ²Ÿé€šéšœç¢ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯å»ºç«‹ç»Ÿä¸€çš„æœ¯è¯­è¡¨å’Œå‘½åè§„åˆ™</strong>  ï¼Œç¡®ä¿åŒæ–¹ä½¿ç”¨ç›¸åŒçš„æœ¯è¯­å’Œå‘½åæ–¹å¼ã€‚ä¾‹å¦‚ï¼Œè®¾è®¡å¸ˆå¯èƒ½ç§°ä¸º"ä¸»è‰²"ï¼Œè€Œå¼€å‘äººå‘˜å¯èƒ½ç§°ä¸º"primary-color"ï¼Œåº”å½“ç»Ÿä¸€ä¸º"color-brand-default"ã€‚</p>
<p><strong>å¤šå¹³å°ä¸€è‡´æ€§ç»´æŠ¤</strong>ï¼šåœ¨è·¨å¹³å°åº”ç”¨ä¸­ï¼Œä¸åŒå¹³å°å¯èƒ½æœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå¯¼è‡´Tokenå€¼éš¾ä»¥ç»Ÿä¸€ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨æŠ½è±¡å±‚å’Œé€‚é…å™¨æ¨¡å¼</strong>ï¼Œå°†å¹³å°ç‰¹å®šçš„å®ç°ç»†èŠ‚éšè—åœ¨æŠ½è±¡å±‚åé¢ï¼Œç¡®ä¿Tokenåœ¨ä¸åŒå¹³å°ä¸Šçš„è¡¨ç°ä¸€è‡´  ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰<code>shadow-low</code>ä½œä¸ºæŠ½è±¡Tokenï¼Œç„¶ååœ¨ä¸åŒå¹³å°ä¸­å®ç°ä¸ºç‰¹å®šçš„é˜´å½±æ•ˆæœã€‚</p>
<p><strong>æ—§ç³»ç»Ÿè¿ç§»å›°éš¾</strong>ï¼šå¯¹äºå·²æœ‰è®¾è®¡ç³»ç»Ÿï¼Œè¿ç§»åˆ°Design Tokenså¯èƒ½é¢ä¸´å…¼å®¹æ€§å’Œä¸€è‡´æ€§é—®é¢˜ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨æ¸è¿›å¼è¿ç§»ç­–ç•¥</strong>  ï¼Œé€æ­¥æ›¿æ¢æ—§ç³»ç»Ÿä¸­çš„æ ·å¼å®šä¹‰ï¼ŒåŒæ—¶ä¿æŒå‘åå…¼å®¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºæ—§ç³»ç»Ÿä¸æ–°Tokençš„æ˜ å°„è¡¨ï¼Œç¡®ä¿ç°æœ‰ç»„ä»¶åœ¨è¿ç§»è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç°æ ·å¼åå·®ã€‚</p>
<p><strong>å›¢é˜Ÿåä½œé˜»åŠ›</strong>ï¼šåœ¨å¤§å‹å›¢é˜Ÿä¸­ï¼Œè®¾è®¡å’Œå¼€å‘äººå‘˜å¯èƒ½å¯¹Tokençš„ä½¿ç”¨æœ‰ä¸åŒæ„è§ï¼Œå¯¼è‡´åä½œå›°éš¾ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯å»ºç«‹æ˜ç¡®çš„æ²»ç†æ¡†æ¶å’Œå†³ç­–æµç¨‹</strong>  ï¼Œç¡®ä¿Tokençš„å®šä¹‰å’Œä½¿ç”¨æœ‰æ˜ç¡®çš„è§„åˆ™å’Œè´£ä»»äººã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç«‹Tokenæ²»ç†å§”å‘˜ä¼šï¼Œè´Ÿè´£Tokençš„å®šä¹‰ã€å®¡æ ¸å’Œæ›´æ–°ã€‚</p>
<h3 data-id="heading-6">ä¸ƒã€å®é™…æ¡ˆä¾‹åˆ†æï¼šSemi Designçš„Tokenå®ç°</h3>
<p>Semi Designæ˜¯ä¸€ä¸ªå…¸å‹çš„é‡‡ç”¨Design Tokensçš„è®¾è®¡ç³»ç»Ÿï¼Œå®ƒæä¾›äº†è¶…è¿‡2800ä¸ªè®¾è®¡Tokenï¼Œè¦†ç›–äº†é¢œè‰²ã€å­—ä½“ã€é—´è·ã€å°ºå¯¸ç­‰å¤šä¸ªæ–¹é¢  ã€‚<strong>Semi Designçš„Tokenå®ç°å±•ç¤ºäº†å¦‚ä½•é€šè¿‡åˆ†å±‚ç»“æ„å’ŒæŠ½è±¡åŒ–è®¾è®¡å®ç°é«˜åº¦ä¸€è‡´æ€§å’Œå¯æ‰©å±•æ€§</strong>  ã€‚</p>
<p>Semi Designçš„é¢œè‰²ç³»ç»Ÿé‡‡ç”¨äº†16ä¸ªè‰²ç›¸ï¼Œæ¯ä¸ªè‰²ç›¸åŒ…å«10ä¸ªæ˜åº¦ç­‰çº§ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è‰²ç›˜  ã€‚ä¾‹å¦‚çº¢è‰²ç³»åˆ—ä»<code>--semi-red-0</code>ï¼ˆæµ…çº¢è‰²ï¼‰åˆ°<code>--semi-red-9</code>ï¼ˆæ·±çº¢è‰²ï¼‰ï¼Œè¦†ç›–äº†ä¸åŒæ˜åº¦çš„éœ€æ±‚ã€‚åŒæ—¶ï¼ŒSemi Designå®šä¹‰äº†åŠŸèƒ½é¢œè‰²Tokenï¼Œå¦‚<code>color-primary</code>ï¼ˆä¸»è‰²ï¼‰ã€<code>color-error</code>ï¼ˆé”™è¯¯è‰²ï¼‰ç­‰ï¼Œè¿™äº›Tokenå¯ä»¥åŸºäºè‰²ç›¸-æ˜åº¦Tokenè¿›è¡Œå®šä¹‰ï¼Œå®ç°çµæ´»çš„è°ƒæ•´å’Œæ›´æ–°ã€‚</p>
<p>Semi Designçš„æ’ç‰ˆç³»ç»Ÿé¢„è®¾äº†ä»12pxåˆ°32pxçš„å®Œæ•´å­—å·ä½“ç³»ï¼Œä»¥åŠè½»ï¼ˆ200ï¼‰ã€å¸¸è§„ï¼ˆ400ï¼‰ã€ç²—ï¼ˆ600ï¼‰ä¸‰ç§å­—é‡  ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css">$<span class="hljs-attribute">font-size</span>-small : <span class="hljs-number">12px</span>;       // è¾…åŠ©æ–‡æœ¬
$<span class="hljs-attribute">font-size</span>-regular : <span class="hljs-number">14px</span>;     // æ­£æ–‡
$<span class="hljs-attribute">font-size</span>-<span class="hljs-selector-tag">header</span>-<span class="hljs-number">6</span> : <span class="hljs-number">16px</span>;    // å°æ ‡é¢˜
$<span class="hljs-attribute">font-weight</span>-bold : <span class="hljs-number">600</span>;       // å¼ºè°ƒæ–‡æœ¬
</code></pre>
<p>é—´è·ä¸å°ºå¯¸ç³»ç»Ÿåˆ™æä¾›äº†ä»2pxåˆ°40pxçš„æ ‡å‡†åŒ–é—´è·  ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$spacing</span>é¢å®šå€¼ï¼š<span class="hljs-number">4</span>px;    <span class="hljs-comment">// ç´§å‡‘å†…è¾¹è·</span>
<span class="hljs-variable">$spacing</span>é¢å®šå€¼ï¼š<span class="hljs-number">16</span>px;          <span class="hljs-comment">// é»˜è®¤é—´è·</span>
<span class="hljs-variable">$height</span>-control-<span class="hljs-keyword">default</span> : <span class="hljs-number">32</span>px;  <span class="hljs-comment">// æŒ‰é’®/è¾“å…¥æ¡†é»˜è®¤é«˜åº¦</span>
</code></pre>
<p>ç‰¹æ®ŠTokenå¦‚z-indexå±‚çº§ç³»ç»Ÿç¡®ä¿äº†å¼¹çª—ç»„ä»¶çš„æ­£ç¡®æ˜¾ç¤º  ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">$z-modal : <span class="hljs-number">1000</span>;        <span class="hljs-regexp">//</span> æ¨¡æ€æ¡†å±‚çº§
$z-tooltip : <span class="hljs-number">1060</span>;      <span class="hljs-regexp">//</span> æç¤ºæ¡†å±‚çº§ï¼ˆé«˜äºæ¨¡æ€æ¡†ï¼‰
</code></pre>
<p>Semi Designçš„Tokenå®ç°è¿˜æ”¯æŒåŠ¨æ€ä¸»é¢˜åˆ‡æ¢ï¼Œé€šè¿‡è¦†ç›–å˜é‡çš„æ–¹å¼å®ç°æ˜æš—æ¨¡å¼çš„åˆ‡æ¢ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// æ›´æ”¹ä¸»è‰²è°ƒä¸ºä¼ä¸šè“</span>
--semi-color-primary : <span class="hljs-number">0</span>, <span class="hljs-number">149</span>, <span class="hljs-number">238</span>;

<span class="hljs-comment">// å¢å¤§æŒ‰é’®é«˜åº¦</span>
$height-control-<span class="hljs-keyword">default</span> : <span class="hljs-number">36</span>px;
</code></pre>
<p>é€šè¿‡ConfigProvideråº”ç”¨è‡ªå®šä¹‰ä¸»é¢˜ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@douyinfe/semi-ui'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./custom-theme.scss'</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ConfigProvider</span> <span class="hljs-attr">themeMode</span>=<span class="hljs-string">"dark"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ConfigProvider</span>&gt;</span></span>;
</code></pre>
<p>Semi Designçš„Tokenå®ç°å±•ç¤ºäº†å¦‚ä½•é€šè¿‡åˆ†å±‚ç»“æ„å’ŒæŠ½è±¡åŒ–è®¾è®¡å®ç°é«˜åº¦ä¸€è‡´æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºè®¾è®¡ç³»ç»Ÿæä¾›äº†è‰¯å¥½çš„å‚è€ƒã€‚</p>
<h3 data-id="heading-7">å…«ã€æœªæ¥è¶‹åŠ¿ä¸å‘å±•æ–¹å‘</h3>
<p>Design TokensæŠ€æœ¯ä»åœ¨ä¸æ–­å‘å±•å’Œå®Œå–„ï¼Œæœªæ¥å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹è¶‹åŠ¿ï¼š</p>
<p><strong>AIè¾…åŠ©Tokenç®¡ç†</strong>ï¼šéšç€AIæŠ€æœ¯çš„å‘å±•ï¼Œæœªæ¥å¯èƒ½ä¼šå‡ºç°AIè¾…åŠ©çš„Tokenç®¡ç†ç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«è®¾è®¡ä¸­çš„è§†è§‰å…ƒç´ å¹¶ç”Ÿæˆå¯¹åº”çš„Tokenï¼Œæˆ–æ ¹æ®ç”¨æˆ·åé¦ˆè‡ªåŠ¨è°ƒæ•´Tokenå€¼ï¼Œæé«˜è®¾è®¡æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>è·¨å¹³å°Tokenæ ‡å‡†</strong>ï¼šç›®å‰å„å¹³å°å’Œæ¡†æ¶çš„Tokenå®ç°å„ä¸ç›¸åŒï¼Œæœªæ¥å¯èƒ½ä¼šå‡ºç°è·¨å¹³å°çš„Tokenæ ‡å‡†ï¼Œä½¿è®¾è®¡Tokenèƒ½å¤Ÿåœ¨ä¸åŒå¹³å°å’Œæ¡†æ¶ä¹‹é—´æ— ç¼è½¬æ¢å’Œä½¿ç”¨ï¼Œæé«˜è·¨å¹³å°åº”ç”¨çš„ä¸€è‡´æ€§å’Œå¼€å‘æ•ˆç‡ã€‚</p>
<p><strong>åŠ¨æ€Tokenç³»ç»Ÿ</strong>ï¼šæœªæ¥çš„Design Tokenså¯èƒ½ä¼šæ›´åŠ åŠ¨æ€ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·åå¥½ã€ç¯å¢ƒæ¡ä»¶æˆ–ä¸šåŠ¡éœ€æ±‚è‡ªåŠ¨è°ƒæ•´Tokenå€¼ï¼Œå®ç°æ›´åŠ ä¸ªæ€§åŒ–å’Œè‡ªé€‚åº”çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>Tokenä¸è®¾è®¡åŸåˆ™çš„ç»“åˆ</strong>ï¼šDesign Tokenså¯èƒ½ä¼šä¸è®¾è®¡åŸåˆ™ï¼ˆå¦‚ä¸€è‡´æ€§ã€ç®€æ´æ€§ã€å¯è®¿é—®æ€§ç­‰ï¼‰æ›´åŠ ç´§å¯†åœ°ç»“åˆï¼Œé€šè¿‡Tokençš„å®šä¹‰å’Œä½¿ç”¨ç›´æ¥ä½“ç°è®¾è®¡åŸåˆ™ï¼Œç¡®ä¿è®¾è®¡ç³»ç»Ÿç¬¦åˆäº§å“å®šä½å’Œç”¨æˆ·ä½“éªŒç›®æ ‡  ã€‚</p>
<p><strong>Tokenä¸ç»„ä»¶çš„æ·±åº¦é›†æˆ</strong>ï¼šæœªæ¥çš„ç»„ä»¶åº“å¯èƒ½ä¼šæ›´åŠ æ·±åº¦é›†æˆDesign Tokensï¼Œä½¿Tokençš„ä¿®æ”¹èƒ½å¤Ÿç›´æ¥å½±å“ç»„ä»¶çš„å¤–è§‚å’Œè¡Œä¸ºï¼Œå®ç°æ›´åŠ çµæ´»å’Œå¯å®šåˆ¶çš„è®¾è®¡ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-8">ä¹ã€æ€»ç»“ä¸å»ºè®®</h3>
<p><strong>Design Tokensæ˜¯ç°ä»£è®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œé€šè¿‡å°†è§†è§‰è®¾è®¡å…ƒç´ æŠ½è±¡ä¸ºå¯ç®¡ç†çš„å˜é‡ï¼Œå®ç°äº†è®¾è®¡ä¸å¼€å‘çš„æ— ç¼åä½œå’Œä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ</strong>  ã€‚å®ƒä»¬ä¸ä»…æé«˜äº†å·¥ä½œæ•ˆç‡ï¼Œè¿˜é™ä½äº†ç»´æŠ¤æˆæœ¬ï¼Œæ”¯æŒäº†åŠ¨æ€ä¸»é¢˜å’Œå¤šå“ç‰Œåœºæ™¯ã€‚</p>
<p>å¯¹äºå¸Œæœ›å®æ–½Design Tokensçš„å›¢é˜Ÿï¼Œå»ºè®®ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p>
<p>é¦–å…ˆï¼Œ<strong>å»ºç«‹è·¨èŒèƒ½å›¢é˜Ÿ</strong>ï¼Œç¡®ä¿è®¾è®¡ã€å¼€å‘å’Œäº§å“å›¢é˜Ÿå…±åŒå‚ä¸Design Tokensçš„è®¾è®¡å’Œå®æ–½ï¼Œå½¢æˆç»Ÿä¸€çš„ç†è§£å’Œè§„èŒƒ  ã€‚</p>
<p>å…¶æ¬¡ï¼Œ<strong>é‡‡ç”¨æ¸è¿›å¼å®æ–½ç­–ç•¥</strong>ï¼Œå…ˆä»æ ¸å¿ƒç»„ä»¶å’Œé«˜é¢‘ä½¿ç”¨çš„è®¾è®¡å…ƒç´ å¼€å§‹ï¼Œé€æ­¥æ‰©å±•åˆ°æ•´ä¸ªè®¾è®¡ç³»ç»Ÿï¼Œé¿å…ä¸€æ¬¡æ€§å®æ–½å¸¦æ¥çš„å¤æ‚æ€§å’Œé˜»åŠ›  ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œ<strong>å»ºç«‹å®Œå–„çš„å‘½åè§„åˆ™å’Œåˆ†ç±»ä½“ç³»</strong>ï¼Œç¡®ä¿Tokençš„è¯­ä¹‰åŒ–ã€ä¸€è‡´æ€§å’Œå¯è¯»æ€§ï¼Œä¸ºå›¢é˜Ÿåä½œå’Œé•¿æœŸç»´æŠ¤å¥ å®šåŸºç¡€  ã€‚</p>
<p>æœ€åï¼Œ<strong>åˆ©ç”¨å·¥å…·é“¾ç®€åŒ–å®æ–½è¿‡ç¨‹</strong>ï¼Œé€‰æ‹©é€‚åˆå›¢é˜Ÿçš„è®¾è®¡å·¥å…·ã€è½¬æ¢å·¥å…·å’Œå¼€å‘æ¡†æ¶ï¼Œæé«˜å®æ–½æ•ˆç‡å’Œè´¨é‡ã€‚</p>
<p>é€šè¿‡åˆç†è®¾è®¡å’Œå®æ–½Design Tokensï¼Œå›¢é˜Ÿå¯ä»¥å»ºç«‹æ›´åŠ é«˜æ•ˆã€ä¸€è‡´å’Œå¯ç»´æŠ¤çš„è®¾è®¡ç³»ç»Ÿï¼Œä¸ºäº§å“çš„é•¿æœŸå‘å±•å’Œç”¨æˆ·ä½“éªŒæå‡æä¾›æœ‰åŠ›æ”¯æŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«æ‰‹åŠ¨éƒ¨ç½²ï¼Docker + Drone å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡å—]]></title>    <link>https://juejin.cn/post/7575413146922876943</link>    <guid>https://juejin.cn/post/7575413146922876943</guid>    <pubDate>2025-11-24T02:56:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146922876943" data-draft-id="7574671792997482531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«æ‰‹åŠ¨éƒ¨ç½²ï¼Docker + Drone  å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,CI/CD,Docker"/> <meta itemprop="datePublished" content="2025-11-24T02:56:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¥¿ç»´"/> <meta itemprop="url" content="https://juejin.cn/user/1372654389433496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«æ‰‹åŠ¨éƒ¨ç½²ï¼Docker + Drone  å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1372654389433496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¥¿ç»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:56:53.000Z" title="Mon Nov 24 2025 02:56:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;position:relative;background-image:linear-gradient(90deg,rgba(217,234,251,.25) 3%,transparent 0),linear-gradient(1turn,rgba(217,234,251,.25) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;padding-left:8px;padding-bottom:0;margin-top:35px;margin-bottom:10px;font-weight:900;font-family:serif;letter-spacing:1px;color:#000}.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover{background-color:#fff}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;position:relative}.markdown-body h2:after{content:"";left:0;bottom:0;width:100%;height:1px;position:absolute}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{height:1px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#37b2ff 0,#37b2ff 25%,transparent 50%)}.markdown-body code{margin:0 4px;word-break:break-word;overflow-x:auto;background-color:#fff7f7;color:#f06;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:-apple-system,system-ui,Menlo,Monaco,Consolas,Courier New;position:relative}.markdown-body pre{margin:15px 8px;border:1px solid #f5f5f7;line-height:1.75}.markdown-body pre:before{top:-4px;left:-4px;border-top:8px solid #feea1e;border-left:8px solid #feea1e}.markdown-body pre:after,.markdown-body pre:before{width:20px;height:20px;content:"";z-index:10;position:absolute}.markdown-body pre:after{right:-4px;bottom:-4px;border-right:8px solid #37b2ff;border-bottom:8px solid #37b2ff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;overflow-x:auto;margin:0;word-break:normal;display:block;color:#333;background-color:#fff;position:unset!important}.markdown-body pre:nth-child(odd):before{border-top-color:#a7ecad;border-left-color:#a7ecad}.markdown-body pre:nth-child(odd):after{border-right-color:#e699e6;border-bottom-color:#e699e6}.markdown-body a{margin:0 4px;text-decoration:none;color:#37b2ff;transition:.3s;display:inline-block;vertical-align:bottom;position:relative}.markdown-body a:before{content:"READ MORE +";bottom:90%;width:120px;max-width:0;color:#fff;background-color:#1fb3ff;position:absolute;white-space:nowrap;transition:.3s;box-sizing:border-box;pointer-events:none;overflow:hidden}.markdown-body a:after{content:"";bottom:0;left:0;width:100%;height:1px;border-bottom:1px dashed #37b2ff;position:absolute}.markdown-body a:active:before,.markdown-body a:hover:before{max-width:120px;padding-left:14px}.markdown-body table{width:100%;max-width:100%;font-size:12px;background-color:#fff;overflow:auto;border-collapse:collapse}.markdown-body table tr:hover td,.markdown-body table tr:hover th{border-bottom:1px solid #feea1e}.markdown-body thead{text-align:left}.markdown-body th{font-size:1.2em;border-bottom:1px dashed #eee}.markdown-body tr:nth-child(2n){background-color:hsla(0,0%,87.8%,.1);border-bottom:1px solid #fff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px;border-bottom:1px dashed #fff}.markdown-body blockquote{color:#666;padding:12px 23px 2px;border:1px solid #37b2ff;background-color:#fff;margin:22px 0;position:relative}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body blockquote:after{content:"FROM";left:0;width:40px;color:#fff;background-color:#37b2ff;text-align:center}.markdown-body blockquote:after,.markdown-body blockquote:before{top:0;line-height:1;padding:2px 0;font-size:12px;font-weight:lighter;position:absolute;pointer-events:none}.markdown-body blockquote:before{content:"CITATION";left:44px;color:#37b2ff}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{line-height:2em;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#37b2ff}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol ol li,.markdown-body ol ul li,.markdown-body ul ol li,.markdown-body ul ul li{border-bottom:none}.markdown-body ol li{padding-left:6px;list-style:decimal-leading-zero}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{position:relative}.markdown-body input[type=checkbox]:before{top:0;left:0;right:0;bottom:0;content:"";width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1;position:absolute}.markdown-body input[type=checkbox]:checked:after{content:"";top:10%;left:18%;width:90%;height:40%;border-left:2px solid #37b2ff;border-bottom:2px solid #37b2ff;color:#37b2ff;z-index:2;transform:rotate(-45deg);position:absolute}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>ä½†è¡Œå¥½äº‹ï¼Œè«é—®å‰ç¨‹</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬æ–‡ä¸åªæ˜¯é…ç½®æ–‡ä»¶çš„å †ç Œï¼Œä¹Ÿè§£é‡Šæ˜¯ä»€ä¹ˆå’Œä¸ºä»€ä¹ˆï¼Œå¸Œæœ›å¤§å®¶èƒ½è€å¿ƒå­¦ä¹ ğŸ˜½ã€‚</p>
<p>ç°åœ¨çš„é¡¹ç›®å¤§å¤šé€šè¿‡å„ç§ <strong><code>CI/CDå·¥å…·</code></strong>ï¼ˆä¾‹å¦‚è‘—åçš„ <code>Jenkins</code>ã€ <code>gitLab</code>ï¼Œgithubæ¨å‡ºçš„ <code>github actions</code>ï¼‰æ¥è¿›è¡Œ <strong>è‡ªåŠ¨åŒ–éƒ¨ç½²</strong>ã€‚</p>
<p>å®ƒä»¬å·²æˆä¸ºå¸‚åœºä¸»æµï¼Œæ˜¯é¡¹ç›®åŸºå»ºä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ã€‚</p>
<p>å¼€å‘äººå‘˜åªéœ€å¼€å‘å®Œæˆåï¼Œä¸€ä¸ªä»£ç æ¨é€/åˆå¹¶ï¼Œé¡¹ç›®ä¾¿ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå‘ˆç°ç»™ç”¨æˆ·ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a79b8131aba479eafd980194cea7620~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=r5GUEKRNpdmTh7BIrY06qiNJojI%3D" alt="dronev.gif" loading="lazy"/></p>
<blockquote>
<p><strong>æŒç»­éƒ¨ç½²ï¼ˆContinuous Deploymentï¼ŒCDï¼‰ï¼š</strong></p>
<ul>
<li>æŒ‡è‡ªåŠ¨åŒ–éƒ¨ç½²å·²é€šè¿‡æµ‹è¯•çš„ä»£ç åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä»¥å®ç°å¿«é€Ÿã€å¯é çš„è½¯ä»¶äº¤ä»˜ã€‚</li>
<li>CD æµç¨‹åŒ…æ‹¬è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²æµç¨‹ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ç¯å¢ƒé…ç½®ç®¡ç†ç­‰æ­¥éª¤ï¼Œä»¥ç¡®ä¿éƒ¨ç½²çš„è½¯ä»¶è´¨é‡å’Œç¨³å®šæ€§ã€‚</li>
<li>ç›®çš„æ˜¯ç¼©çŸ­è½¯ä»¶äº¤ä»˜å‘¨æœŸï¼Œé™ä½éƒ¨ç½²é£é™©ï¼Œæé«˜éƒ¨ç½²çš„å¯é‡å¤æ€§å’Œä¸€è‡´æ€§</li>
</ul>
</blockquote>
<p>ç›¸æ¯”äºå¤æ—©ç¼“æ…¢ä¸”å……æ»¡é£é™©çš„æ‰‹åŠ¨éƒ¨ç½²ï¼Œå®ƒä»¬èƒ½å°†é¡¹ç›® <strong>è‡ªåŠ¨åŒ–çš„æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒä»¥å®ç°äº¤ä»˜çš„é«˜è´¨é‡å’Œæ•ˆç‡</strong>ã€‚</p>
<p>æ— è®ºä½ æ˜¯ä»€ä¹ˆæ–¹å‘çš„å¼€å‘è€…ï¼Œå­¦ä¹ +ä½¿ç”¨å®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªæå…·æ€§ä»·æ¯”çš„é€‰æ‹©ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ­å»ºè‡ªåŠ¨åŒ–éƒ¨ç½²å¹³å°ï¼Œå¦‚æœå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œ<strong>è¿˜æœ›ç‚¹èµã€æ”¶è—ã€å…³æ³¨ä¸‰è¿ğŸ˜½ã€‚</strong></p>
<h2 data-id="heading-1">ç®€ä»‹</h2>
<p>æœ¬æ–‡è¦åˆ†äº«çš„æ˜¯åèµ·ä¹‹ç§€ <strong><code>Drone</code></strong>ï¼Œå®ƒå…è´¹ã€è½»é‡ã€ç®€æ´ã€æ”¯æŒç§æœ‰åŒ–ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒçš„ <strong><code>yamlå†™æ³•</code></strong> å’Œ <strong><code>pipelineæµæ°´çº¿</code></strong> éå¸¸é€‚åˆå¯¹è¿ç»´é™Œç”Ÿçš„åŒå­¦å»ç†è§£ç›¸å…³æµç¨‹ã€‚</p>
<blockquote>
<p>å¦‚æœå¯¹ linux å’Œ docker ä¸ç†Ÿæ‚‰çš„åŒå­¦éœ€è¦å…ˆç®€å•äº†è§£ç›¸å…³çŸ¥è¯†ï¼Œæœ¬æ–‡ä½¿ç”¨ docker compose æ¥ç¼–æ’å®¹å™¨ã€‚</p>
</blockquote>
<p><strong><code>Drone</code></strong> æ·±åº¦é›†æˆäº†å¤šä¸ª SCM ç½‘ç«™ï¼ŒåŒ…æ‹¬ GitHubã€GitLabã€Giteeç­‰ã€‚å®ƒçš„æ¯ä¸ªæ„å»ºéƒ½åœ¨ä¸€ä¸ªéš”ç¦»çš„ Docker å®¹å™¨ä¸­è¿è¡Œï¼›å¦å¤–å®ƒä¹Ÿæ”¯æŒæ’ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä½ ç†ŸçŸ¥çš„è¯­è¨€è½»æ¾çš„æ‰©å±•å®ƒä»¬ã€‚</p>
<p>å½“å‰ä¸€åˆ‡éƒ½éƒ¨ç½²å¥½åï¼Œåªéœ€åœ¨ä»£ç ä»“åº“ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªæè¿°æ–‡ä»¶ <strong><code>.drone.yml</code></strong>ï¼Œå°±å¯ä»¥å®Œæˆ CI/CD é…ç½®ã€‚</p>
<p><strong><code>Drone</code></strong> éœ€è¦åˆ›å»ºä¸¤ä¸ªå®¹å™¨</p>
<ul>
<li><strong><code>Server</code></strong>: è´Ÿè´£ä»»åŠ¡è°ƒåº¦ã€æä¾›è§†å›¾ã€ç”¨æˆ·æƒé™é…ç½® . . .</li>
<li><strong><code>Runner</code></strong>: æ‰§è¡Œ Pipeline å…·ä½“ä»»åŠ¡ã€åˆ›å»ºéš”ç¦»çš„å®¹å™¨ç¯å¢ƒã€ä¸ŠæŠ¥æ—¥å¿—å’ŒçŠ¶æ€ . . .</li>
</ul>
<h2 data-id="heading-2">æµç¨‹ &amp; æ–‡æ¡£</h2>
<p>æˆ‘ä½¿ç”¨çš„æœåŠ¡å™¨ï¼š4æ ¸4G - CentOS - 40G SSD ï¼ˆå…¶å®2æ ¸2Gå³å¯ï¼ŒDroneèµ„æºå ç”¨å¾ˆå°‘ï¼‰</p>
<p><strong>æ­å»ºè‡ªåŠ¨åŒ–éƒ¨ç½²çš„æµç¨‹å¦‚ä¸‹</strong>ï¼š</p>
<ol>
<li>é…ç½® <code>Github - OAuth Application</code></li>
<li>å®‰è£…ã€é…ç½® <code>Docker</code>ã€<code>Drone Server</code>ã€<code>Drone Runner</code></li>
<li>ç¼–å†™ <code>docker-compose.yml</code> ç¼–æ’å®¹å™¨ï¼Œç”¨äºç®¡ç† <code>Drone Server</code>ã€<code>Drone Runner</code></li>
<li>äº†è§£ <code>pipeline</code>ï¼Œäº†è§£å¸¸ç”¨æ’ä»¶ï¼Œåœ¨ä»£ç ä»“åº“ä¸­åŠ å…¥ <code>.drone.yml</code></li>
<li>æ¨é€ä»£ç æµ‹è¯•æ‰“åŒ…æ•ˆæœ</li>
</ol>
<p><strong>ç›¸å…³æ–‡æ¡£</strong>ï¼š</p>
<p>drone server æœåŠ¡ç«¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.drone.io%2Fserver%2Foverview%2F" target="_blank" title="https://docs.drone.io/server/overview/" ref="nofollow noopener noreferrer">docs.drone.io/server/overâ€¦</a></p>
<p>drone runer linux <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.drone.io%2Frunner%2Fdocker%2Finstallation%2Flinux%2F" target="_blank" title="https://docs.drone.io/runner/docker/installation/linux/" ref="nofollow noopener noreferrer">docs.drone.io/runner/dockâ€¦</a></p>
<p>drone pieline é…ç½® <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.drone.io%2Fpipeline%2Foverview%2F" target="_blank" title="https://docs.drone.io/pipeline/overview/" ref="nofollow noopener noreferrer">docs.drone.io/pipeline/ovâ€¦</a></p>
<p>drone plugins <a href="https://link.juejin.cn?target=https%3A%2F%2Fplugins.drone.io%2F" target="_blank" title="https://plugins.drone.io/" ref="nofollow noopener noreferrer">plugins.drone.io/</a></p>
<p><strong>å¸¸ç”¨æŒ‡ä»¤</strong>:</p>
<p><code>docker compose down &lt;image-name&gt;</code> å…³é—­æŒ‡å®šå®¹å™¨ï¼ˆä¸æŒ‡å®šåˆ™é»˜è®¤æ‰€æœ‰ï¼‰</p>
<p><code>docker compose up -d &lt;image-name&gt;</code> å¯åŠ¨æŒ‡å®šå®¹å™¨ï¼ˆä¸æŒ‡å®šåˆ™é»˜è®¤æ‰€æœ‰ï¼‰</p>
<p><code>docker compose logs -f &lt;image-name&gt;</code> æ‰“å°å®¹å™¨çš„æ—¥å¿—</p>
<p><code>docker compose exec &lt;image-name&gt; bash</code> è¿›å…¥æŒ‡å®šå®¹å™¨çš„shell</p>
<p><code>docker ps</code> æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p>
<p><code>docker images</code> æŸ¥çœ‹ä¸‹è½½çš„é•œåƒ</p>
<p><code>netstat -tulnp</code> æ˜¾ç¤ºè¿›ç¨‹ä¸å ç”¨çš„ç«¯å£</p>
<h2 data-id="heading-3">å®è·µ</h2>
<h3 data-id="heading-4">Github OAuth</h3>
<p><strong><code>GitHub OAuth</code></strong> çš„ä½œç”¨æ˜¯ï¼š <strong>"è®©ç”¨æˆ·å®‰å…¨åœ°æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨ä»£è¡¨è‡ªå·±æ‰§è¡Œç‰¹å®šæ“ä½œ"</strong> ã€‚</p>
<p>åœ¨Droneçš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œå®ƒæä¾›äº†ï¼š</p>
<ul>
<li><strong>ğŸ” å®‰å…¨ç™»å½•</strong>Â - ä¸ç”¨ä¸ºDroneå•ç‹¬åˆ›å»ºè´¦å·</li>
<li><strong>ğŸ”„ è‡ªåŠ¨åŒæ­¥</strong>Â - Droneè‡ªåŠ¨è·å–ä½ çš„ä»“åº“åˆ—è¡¨</li>
<li><strong>âš¡ è‡ªåŠ¨è§¦å‘</strong>Â - Droneæœ‰æƒé™è®¾ç½®webhookï¼Œä»£ç æ¨é€å³è§¦å‘æ„å»º</li>
<li><strong>ğŸ¯ æƒé™å¯æ§</strong>Â - ä½ å¯ä»¥éšæ—¶åœ¨GitHubä¸Šæ’¤é”€Droneçš„è®¿é—®æƒé™</li>
</ul>
<h4 data-id="heading-5">é…ç½®</h4>
<ol>
<li>
<p><strong>å¤´åƒ -&gt; Settings -&gt;  Developer settings -&gt; OAuth Apps -&gt; New OAuth App</strong></p>
</li>
<li>
<p>å¡«å†™é¡¹ç›®å</p>
</li>
<li>
<p><strong>HomePage URL</strong> â€”â€” Githubå…è®¸è°ƒç”¨ç™»å½•çš„URLï¼Œæˆ‘ä»¬è®¾ç½®ä¸ºdrone serverè¿è¡Œçš„ç«¯å£</p>
</li>
<li>
<p><strong>Authorization callback URL</strong> â€”â€” è®¤è¯æˆåŠŸåçš„å›è°ƒç½‘å€ï¼Œåœ¨droneé‡Œä¸º url + /login</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e303ae18cc5d4554bb346a6b6af7f3f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=cnNjpw9HtUrATvjVFnwbRn3TiTE%3D" alt="QQ_1763938534023.png" loading="lazy"/></p>
<ol start="5">
<li>ç‚¹å‡» New Secret</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7268310620a4d2bbd289d3db94cf080~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=%2BCB7PDe4edyCZ5BRs2bs56fj2uA%3D" alt="QQ_1763939334557.png" loading="lazy"/></p>
<ol start="6">
<li>æ‹¿åˆ° <strong><code>Client ID</code></strong> å’Œ <strong><code>Client Secret</code></strong>ï¼Œè®°å½•ä¸‹æ¥ï¼åç»­ç”¨äº Drone çš„é…ç½®</li>
</ol>
<blockquote>
<p>127.0.0.1 åªä¸ºé¢„è®¾ï¼Œå®é™…ä½¿ç”¨æ—¶è¯·æ›¿æ¢ä¸ºè‡ªå·±çš„çœŸå®åŸŸå æˆ– IP+ç«¯å£</p>
</blockquote>
<h3 data-id="heading-6">Docker</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…docker</span>
sudo dnf config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

<span class="hljs-comment"># å¯åŠ¨æŒ‡ä»¤</span>
sudo systemctl start docker
sudo systemctl <span class="hljs-built_in">enable</span> docker

<span class="hljs-comment"># æµ‹è¯•æŒ‡ä»¤</span>
sudo docker run hello-world

<span class="hljs-comment"># é…ç½®é•œåƒåŠ é€Ÿ + é‡å¯æœåŠ¡ </span>
sudo <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">'EOF'</span>
{
  <span class="hljs-string">"registry-mirrors"</span>: [
    <span class="hljs-string">"https://registry.docker-cn.com"</span>,
    <span class="hljs-string">"https://docker.mirrors.ustc.edu.cn"</span>,
    <span class="hljs-string">"https://hub-mirror.c.163.com"</span>
  ]
}
EOF

<span class="hljs-comment"># é‡å¯æœåŠ¡</span>
sudo systemctl restart docker

</code></pre>
<p>é•œåƒåŠ é€Ÿéƒ¨åˆ†ï¼Œä¸ªäººæœåŠ¡å™¨è®¿é—® "<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocker.1ms.run" target="_blank" title="https://docker.1ms.run" ref="nofollow noopener noreferrer">docker.1ms.run</a>" æœ€å¿«ï¼Œå¤§å®¶ç»“åˆè‡ªèº«æƒ…å†µé…ç½®</p>
<h4 data-id="heading-7">Docker Compose</h4>
<p><strong><code>Docker Compose</code></strong> å¯ä»¥<code>å®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨</code>åº”ç”¨çš„å·¥å…·ã€‚å®ƒå…è®¸ä½ ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼ˆé€šå¸¸ç§°ä¸º docker-compose.ymlï¼‰æ¥é…ç½®åº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œç„¶åä½¿ç”¨è¯¥æ–‡ä»¶å¿«é€Ÿå¯åŠ¨æ•´ä¸ªåº”ç”¨çš„æ‰€æœ‰æœåŠ¡ã€‚</p>
<h3 data-id="heading-8">Drone</h3>
<p>ä½¿ç”¨dockerå®‰è£…droneçš„ä¸¤ä¸ªå®¹å™¨ï¼ŒServerç«¯ - æ§åˆ¶è°ƒåº¦å’Œæä¾›è§†å›¾ï¼ŒRunner ç«¯ - æ‰§è¡Œæµæ°´çº¿å’Œä¸ŠæŠ¥çŠ¶æ€</p>
<pre><code class="hljs language-bash" lang="bash">docker pull drone/drone:latest 
docker pull drone/drone-runner-docker:latest
</code></pre>
<p>åŒæ—¶åˆ›å»ºä¸€ä¸ªå…±äº«å¯†é’¥ï¼Œç”¨äº  Server å’Œ  Runner ä¹‹é—´çš„é€šä¿¡è®¤è¯ï¼Œä½¿ç”¨æ­¤å¯†é’¥å¡«å……ç¯å¢ƒå˜é‡ <code>DRONE_RPC_SECRET</code></p>
<pre><code class="hljs language-bash" lang="bash">openssl rand -hex 16
c1da0391axxxxxxxxxxxxxxxxx
</code></pre>
<h4 data-id="heading-9">drone-server</h4>
<p><code>/opt/docker/docker-compose.yml</code></p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">services:</span>
  <span class="hljs-comment"># drone æœåŠ¡ç«¯</span>
  <span class="hljs-attr">drone-server:</span> 
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">drone-server</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">drone/drone:latest</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-comment">#  ç«¯å£æ˜ å°„</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8082</span><span class="hljs-string">:80</span>  
      <span class="hljs-bullet">-</span> <span class="hljs-number">4443</span><span class="hljs-string">:443</span>

    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># æŒ‚è½½æ•°æ®ç›®å½•ï¼ŒæŒä¹…åŒ– Drone çš„é…ç½®ä¿¡æ¯å’Œæ•°æ®åº“</span>
	<span class="hljs-comment"># å®¹å™¨ /data ç›®å½• -&gt; å®¿ä¸»æœºå½“å‰ ./drone-data ç›®å½•</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./drone-data:/data</span>

    <span class="hljs-attr">environment:</span>
      <span class="hljs-comment"># Git OAuth - Client ID</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_GITHUB_CLIENT_ID=Ov23lxxxxxxxxx</span>
      <span class="hljs-comment"># Git OAuth - Client Secret</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_GITHUB_CLIENT_SECRET=d60645938xxxxxxxxxxxxxxxxxxxxx</span>
      <span class="hljs-comment"># Drone Server å’Œ Runner ä¹‹é—´çš„ RPC è®¤è¯å¯†é’¥ï¼Œéœ€ä¿æŒä¸€è‡´</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RPC_SECRET=c1da0391axxxxxxxxxxxxxxxxx</span>
      <span class="hljs-comment"># Drone Serverçš„å…¬ç½‘åœ°å€</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_SERVER_HOST=&lt;æœåŠ¡å™¨çš„å…¬ç½‘IP&gt;:&lt;ç«¯å£&gt;</span>
      <span class="hljs-comment"># é€šä¿¡åè®®</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_SERVER_PROTO=http</span>
      <span class="hljs-comment"># åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_USER_CREATE=username:XiwE1,admin:true</span>
</code></pre>
<ul>
<li>
<p><strong>ports</strong> - ä¸ºå®¿ä¸»æœºä¸å®¹å™¨çš„ç«¯å£æ˜ å°„</p>
</li>
<li>
<p><strong>DRONE_GITHUB_CLIENT_ID</strong> å’Œ <strong>DRONE_GITHUB_CLIENT_SECRET</strong></p>
<ul>
<li>å¯¹åº”ä¸Šæ–‡ <code>Git OAuth</code> çš„ <code>Client ID</code> å’Œ <code>Client Secret</code>ï¼Œç”¨äºèº«ä»½è®¤è¯</li>
</ul>
</li>
<li>
<p><strong>DRONE_RPC_SECRET</strong> - æ˜¯åˆšåˆšç”Ÿæˆçš„å…±äº«å¯†é’¥ï¼Œç”¨äº Server ä¸ Runner é€šä¿¡</p>
</li>
<li>
<p><strong>DRONE_SERVER_HOST</strong> - æ”¹ä¸ºæœåŠ¡å™¨çš„çœŸå®IPå’Œè®¾ç½®è¿è¡Œçš„ç«¯å£</p>
</li>
<li>
<p><strong>DRONE_SERVER_PROTO</strong> - æˆ‘åªç”¨åˆ°äº† httpï¼Œå¦‚æœ‰è¯ä¹¦å¯è®¾ç½® https</p>
</li>
<li>
<p><strong>DRONE_USER_CREATE</strong> - è®¾ç½®è´¦æˆ·ï¼Œname ä¸º github è´¦å·å</p>
</li>
</ul>
<p>æ­¤æ—¶æˆ‘ä»¬å¯åŠ¨æœåŠ¡</p>
<p><code>docker compose up -d drone-server</code></p>
<p>è®¿é—®å¯¹åº”çš„å…¬ç½‘ç½‘å€ï¼Œå®Œæˆç™»å½•åï¼ˆè®°å¾—åœ¨Githubä¿®æ”¹ homepageURL + Authorization callback URLï¼‰,å³å¯çœ‹åˆ°è‡ªå·±ä»“åº“çš„æ‰€æœ‰é¡¹ç›®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4e1162e174241d8b28187bea7ef1f95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=A5c8UKTBP1inm9lSFnzMTU%2BFWWg%3D" alt="QQ_1763943162285.png" loading="lazy"/></p>
<p>æˆ‘ä»¬é€‰ä¸­ä¸€ä¸ªæµ‹è¯•é¡¹ç›®çš„è¿›è¡Œæ¿€æ´»ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdfe66f8cd2e46849e08554bbed908a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=61wBqRYc7FPzN%2BokC2u7ZsOFtMg%3D" alt="QQ_1763944058118.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ° github - é¡¹ç›® - webhooks å·²ç»æ¿€æ´»äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6387a67307fd4dd5a17351f7baa907e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=M4I29bF%2F0oaOERrUpmb%2BYKOWf7c%3D" alt="QQ_1763944228665.png" loading="lazy"/></p>
<p>å¯¹é¡¹ç›®è¿›è¡Œç®€å•çš„é…ç½® Trusted -&gt; SAVEã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ec677e54f914e3e95a0a9a21bdf5707~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=Z6GPIQG%2B%2BPp7ftTVtfu86t66Da0%3D" alt="QQ_1763945071913.png" loading="lazy"/></p>
<h4 data-id="heading-10">drone-runer</h4>
<p><code>/opt/docker/docker-compose.yml</code></p>
<pre><code class="hljs language-yml" lang="yml">  <span class="hljs-comment"># drone æ‰§è¡Œè€…ï¼ˆrunerï¼‰</span>
  <span class="hljs-attr">drone-runner:</span> 
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">drone-runner</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">drone/drone-runner-docker:latest</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">3000</span><span class="hljs-string">:3000</span>  

    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># å…è®¸ Runner åœ¨å®¿ä¸»æœºä¸Šæ“ä½œ Docker å®¹å™¨</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RPC_PROTO=http</span>
      <span class="hljs-comment"># ä¸ drone server çš„container_nameä¸€è‡´</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RPC_HOST=drone-server</span>
      <span class="hljs-comment"># Drone Server å’Œ Runner ä¹‹é—´çš„ RPC è®¤è¯å¯†é’¥ï¼Œéœ€ä¿æŒä¸€è‡´</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RPC_SECRET=c1da0391xxxxxxxxxxxxxxxx</span>
      <span class="hljs-comment"># è®¾ç½®å¹¶å‘ä»»åŠ¡æ•°ä¸Šé™</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RUNNER_CAPACITY=3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RUNNER_NAME=drone-runner</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">drone-server</span>
</code></pre>
<ul>
<li><strong>volumes</strong> - runner æ‰§è¡Œæµæ°´çº¿æ—¶éœ€è¦ä¸æ–­åœ°åˆ›å»ºé•œåƒå®¹å™¨ï¼Œéœ€è¦å…è®¸å…¶æ“ä½œ Docker</li>
<li><strong>DRONE_RPC_HOST</strong> - åŒæœåŠ¡å™¨å¯å†…éƒ¨è®¿é—®ä½¿ç”¨ <code>container-name</code> å³å¯ï¼Œå¦‚æœè·¨æœåŠ¡å™¨è¯·å¡«å†™ Drone Server çš„åŸŸå æˆ– IP+ç«¯å£</li>
<li><strong>DRONE_RPC_SECRET</strong> - å…±äº«å¯†é’¥ï¼Œä¸Serverä¿æŒä¸€è‡´</li>
</ul>
<p>è‡ªåŠ¨æ„å»ºä¸éƒ¨ç½²ç­‰åŠŸèƒ½éƒ½ä¾èµ–äº Drone Runnerã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60f13afc47264c13b9f6dfe699541a6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=VCoBqvG0xk0ZVpRdAqT087b82OY%3D" alt="QQ_1763945783911.png" loading="lazy"/></p>
<h4 data-id="heading-11">pipeline &amp; .drone.yml</h4>
<blockquote>
<p>æµæ°´çº¿ï¼ˆPipelineï¼‰åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰ä¸­ï¼Œæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–æµç¨‹ï¼Œå®ƒå°†è½¯ä»¶ä»ä»£ç åˆ°äº¤ä»˜çš„å¤šä¸ªæ­¥éª¤ä¸²è”èµ·æ¥ã€‚</p>
<p>æ¯ä¸ªæ­¥éª¤éƒ½ä¼šå®Œæˆä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ï¼‰ï¼Œå¹¶ä¸”è¿™äº›æ­¥éª¤æŒ‰é¡ºåºæ‰§è¡Œï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ­¥éª¤å¤±è´¥ï¼Œæ•´ä¸ªæµç¨‹å°±ä¼šåœæ­¢ï¼Œä»è€Œä¿è¯è½¯ä»¶è´¨é‡ã€‚</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ<strong>Pipeline æ˜¯æŠŠæ‰‹åŠ¨é‡å¤çš„è½¯ä»¶å‘å¸ƒè¿‡ç¨‹ï¼Œå˜æˆå…¨è‡ªåŠ¨çš„æ ‡å‡†åŒ–æµæ°´çº¿</strong>ã€‚æ— éœ€äººå·¥å¹²é¢„ï¼Œæé«˜äº†æ•ˆç‡å¹¶å‡å°‘äº†äººä¸ºé”™è¯¯ã€‚</p>
<p>è€Œ <strong>YAML æ˜¯æµæ°´çº¿çš„ã€Œè¯´æ˜ä¹¦ã€ï¼Œè¯­æ³•æ˜“äºé˜…è¯»å’Œè¡¨è¾¾ï¼Œèƒ½ç”¨ç»“æ„åŒ–çš„æ–‡å­—æè¿°æ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹</strong>ã€‚</p>
<p><code>Drone</code> é€šè¿‡åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ”¾ç½®Â <code>.drone.yml</code>Â æ–‡ä»¶æ¥é…ç½®æµæ°´çº¿ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef1dbd577bf34c7f9a266c0fd58aaac0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=G%2F6b4ZDV5%2B8G8mio3mQIq%2B0pliE%3D" alt="QQ_1763947331160.png" loading="lazy"/></p>
<p>å…³äº <code>.drone.yml</code>Â æ–‡ä»¶ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li>æ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½ä»¥Â <code>kind: pipeline</code>Â å¼€å¤´</li>
<li>éœ€è¦æŒ‡å®š<strong>æ‰§è¡Œå™¨ç±»å‹</strong>ï¼Œä¾‹å¦‚Dockerï¼ˆ<code>type: docker</code>ï¼‰</li>
<li>éœ€è¦è®¾ç½® <strong>è§¦å‘æ¡ä»¶ï¼ˆTriggerï¼‰</strong>ï¼Œæ§åˆ¶ç®¡é“åœ¨<strong>ä½•æ—¶</strong>è¿è¡Œã€‚æœ€å¸¸ç”¨çš„æ˜¯ä»£ç çš„Â <code>push</code>Â äº‹ä»¶</li>
<li><strong>æ­¥éª¤ï¼ˆStepsï¼‰</strong>
<ul>
<li>ç®¡é“ç”±ä¸€ä¸ªæˆ–å¤šä¸ª<strong>æ­¥éª¤</strong>ç»„æˆï¼Œæ¯ä¸ªæ­¥éª¤ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚å®‰è£…ä¾èµ–ã€æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ï¼‰ã€‚</li>
<li>æ¯ä¸ªæ­¥éª¤é€šå¸¸éœ€è¦æŒ‡å®šï¼š
<ul>
<li><strong>åç§°ï¼ˆnameï¼‰</strong> ï¼šæ­¥éª¤æ ‡è¯†ï¼Œä¾‹å¦‚ <code>build</code>ã€<code>deploy</code></li>
<li><strong>é•œåƒï¼ˆimageï¼‰</strong> ï¼šæ‰§è¡Œä»»åŠ¡çš„Dockeré•œåƒï¼Œè¿™å†³å®šäº†æ­¥éª¤çš„è¿è¡Œç¯å¢ƒ</li>
<li><strong>å‘½ä»¤ï¼ˆcommandsï¼‰</strong> ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œçš„Shellå‘½ä»¤åºåˆ—ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>æŒ‚è½½å·ï¼ˆVolumesï¼‰</strong> ï¼Œç”¨äºåœ¨æ­¥éª¤ä¹‹é—´<strong>æŒä¹…åŒ–æ•°æ®</strong>æˆ–ä¸å®¿ä¸»æœº<strong>å…±äº«æ–‡ä»¶</strong></li>
<li>...</li>
</ul>
<p>å®˜æ–¹æ–‡æ¡£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.drone.io%2Fpipeline%2Foverview%2F" target="_blank" title="https://docs.drone.io/pipeline/overview/" ref="nofollow noopener noreferrer">docs.drone.io/pipeline/ovâ€¦</a></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨stepsé‡Œé›†æˆæ’ä»¶ï¼Œdrone plugins <a href="https://link.juejin.cn?target=https%3A%2F%2Fplugins.drone.io%2F" target="_blank" title="https://plugins.drone.io/" ref="nofollow noopener noreferrer">plugins.drone.io/</a></p>
<p>ä¾‹å¦‚ ç”¨äºé€šçŸ¥æ„å»ºçŠ¶æ€çš„ slackï¼Œç”¨äºæ–‡ä»¶ä¼ è¾“çš„ rsyncï¼Œå‘å¸ƒèµ„æºåˆ°S3çš„ AWS S3/AWS S3 Syncï¼Œç­‰ç­‰ã€‚</p>
<p>æˆ‘çš„é¡¹ç›®ï¼ˆReact + Yarn + Viteï¼‰æ„å»ºé…ç½®å¦‚ä¸‹ï¼š</p>
<p><strong><code>./.drone.yml</code></strong></p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç®¡é“</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">pipeline</span>
<span class="hljs-comment"># å®šä¹‰ç®¡é“ç±»å‹</span>
<span class="hljs-comment"># ä½¿ç”¨Dockeræ‰§è¡Œå™¨è¿è¡Œæµæ°´çº¿</span>
<span class="hljs-attr">type:</span> <span class="hljs-string">docker</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">default</span>

<span class="hljs-comment"># droneå¯åŠ¨æ—¶ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œcloneä»£ç æ“ä½œï¼Œå°†å¯¹åº”ä»“åº“ä»£ç æ‹‰å–åˆ°/drone/srcç›®å½•ä¸‹</span>
<span class="hljs-attr">clone:</span>
  <span class="hljs-comment"># é‡è¯•ä»¥é˜²ç½‘ç»œé—®é¢˜å¯¼è‡´cloneå¤±è´¥</span>
  <span class="hljs-attr">retries:</span> <span class="hljs-number">2</span>

<span class="hljs-attr">trigger:</span>
  <span class="hljs-attr">branch:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">main</span>

<span class="hljs-attr">volumes:</span>
    <span class="hljs-comment"># å°†node_modulesç¼“å­˜åˆ°å®¿ä¸»æœºæŒ‡å®šç›®å½•ä¸‹</span>
    <span class="hljs-comment"># é¿å…é‡æ–°installå»¶è¿Ÿæˆ–è€…å¤±è´¥</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">node_modules</span>
    <span class="hljs-attr">host:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/home/drone/cache/fe/node_modules</span>
  <span class="hljs-comment"># - name: pnpm-cache</span>
  <span class="hljs-comment">#   host:</span>
  <span class="hljs-comment">#     path: /home/drone/cache/fe/pnpm-store</span>
  <span class="hljs-comment"># æŒ‚è½½Dockerå¥—æ¥å­—</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">docker-sock</span>
    <span class="hljs-attr">host:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/var/run/docker.sock</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">admin-website</span>
    <span class="hljs-attr">host:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/home/admin-website</span>

<span class="hljs-attr">steps:</span>
  <span class="hljs-comment"># ç¼–è¯‘é˜¶æ®µ</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">build</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">node:23</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">node_modules</span>
        <span class="hljs-comment"># æŒ‚è½½åˆ°å®¹å™¨å†…çš„è·¯å¾„</span>
        <span class="hljs-comment"># å®¿ä¸»æœº node_modules -&gt; æŒ‚è½½åˆ°å®¹å™¨/drone/src/node_modulesç›®å½•</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/drone/src/node_modules</span>
    <span class="hljs-comment">#   - name: pnpm-cache</span>
    <span class="hljs-comment">#     path: /drone/src/.pnpm-store</span>
    <span class="hljs-attr">commands:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">"============æ„å»ºå‰çš„æ–‡ä»¶==============="</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">pwd</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ls</span> <span class="hljs-string">-alt</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">"======================================"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">yarn</span> <span class="hljs-string">--version</span> <span class="hljs-string">||</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">yarn</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">yarn</span> <span class="hljs-string">install</span> <span class="hljs-string">--frozen-lockfile</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">yarn</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">"============æ„å»ºåçš„äº§ç‰©==============="</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ls</span> <span class="hljs-string">-la</span> <span class="hljs-string">dist</span> <span class="hljs-string">||</span> <span class="hljs-string">exit</span> <span class="hljs-number">1</span>

  <span class="hljs-comment"># éƒ¨ç½²é˜¶æ®µ</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">deploy</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">drillster/drone-rsync</span>
    <span class="hljs-attr">network_mode:</span> <span class="hljs-string">host</span>  <span class="hljs-comment"># ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span>
    <span class="hljs-attr">settings:</span>
      <span class="hljs-attr">hosts:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">localhost</span>
        <span class="hljs-comment"># æˆ–è€…æœåŠ¡å™¨ip</span>
      <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">key:</span>
        <span class="hljs-attr">from_secret:</span> <span class="hljs-string">deploy_ssh_secret</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">22</span>
      <span class="hljs-attr">source:</span> <span class="hljs-string">dist/</span>
      <span class="hljs-attr">target:</span> <span class="hljs-string">/home/admin-website</span>

  <span class="hljs-comment"># å¦‚æœåœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥æŠŠä»£ç ç›´æ¥ç¼–è¯‘è¿›æŒ‚è½½ç›®å½•æˆ–è€…ç§»å…¥æŒ‚è½½ç›®å½•</span>
  <span class="hljs-comment"># - name: deploy</span>
  <span class="hljs-comment">#   image: alpine:latest</span>
  <span class="hljs-comment">#   volumes:</span>
  <span class="hljs-comment">#     - name: admin-website</span>
  <span class="hljs-comment">#     # åœ¨å®¹å™¨å†…æä¾›targetç›®å½• æŒ‚è½½åˆ°å®¿ä¸»æœºçš„hostç›®å½•ä¸‹</span>
  <span class="hljs-comment">#       path: /target</span>
  <span class="hljs-comment">#   commands:</span>
  <span class="hljs-comment">#     - apk add --no-cache rsync</span>
  <span class="hljs-comment">#     # å°†å®¹å™¨å†…çš„distç›®å½•åŒæ­¥åˆ°targetç›®å½•ï¼Œç»™volumesæŒ‚è½½</span>
  <span class="hljs-comment">#     - rsync -av --delete /drone/src/dist/ /target/</span>
  <span class="hljs-comment">#     # éªŒè¯æ–‡ä»¶æ˜¯å¦å¤åˆ¶æˆåŠŸ</span>
  <span class="hljs-comment">#     - ls -la /target/ || exit 1</span>
</code></pre>
<h2 data-id="heading-12">æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²</h2>
<p>è‡³æ­¤æˆ‘ä»¬å°±å¤§åŠŸå‘Šæˆï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•äº†ï¼Œç°åœ¨ä¿®æ”¹ä»£ç å push è¿œç¨‹ <code>main</code> åˆ†æ”¯ï¼Œå³å¯è§¦å‘è‡ªåŠ¨æ„å»ºã€‚</p>
<p>æ”¹ä¸€ä¸‹é¡¹ç›®ç‰ˆæœ¬å·è¯•è¯•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17cea6d31322439bbb233da42865776a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=K2ECaGrJeAEVlamrBKQtqt3EM3Q%3D" alt="QQ_1763949105773.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ä»»åŠ¡å¾ˆå¿«å°±å®Œæˆäº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd3c15b9917940daaeb5ca23da280ba0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=b3isP6E83TTZTFQp7Rn2dnsWvps%3D" alt="QQ_1763949213983.png" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/033486ca04964d889dcb716caa73ae20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=3UCM3hTMwcGIfsVZp44FnbCNyAo%3D" alt="QQ_1763949144336.png" loading="lazy"/></p>
<p>è®¿é—®ç½‘ç«™ï¼ˆè®°å¾—é…ç½® nginx ä»£ç†ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e92d41c6b4ad428d9fc7347aebf291e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=YFMcFsSqM36C8QIvgQ8veYXd1lc%3D" alt="QQ_1763949190599.png" loading="lazy"/></p>
<h2 data-id="heading-13">ç»“è¯­</h2>
<p>æ•´å¥—æµç¨‹ä¸‹æ¥å¹¶ä¸å›°éš¾ï¼Œä½†éœ€è¦å¼€å‘ç”Ÿæ¶¯ä¸­çš„å¤šç§çŸ¥è¯†ä¸ºåŸºç¡€ï¼Œå¹¶åŠ ä»¥åº”ç”¨ï¼Œç†è§£å®Œæ•´çš„äº§å“å¼€å‘æµç¨‹ã€‚</p>
<p>å¸Œæœ›å‰ç«¯å¼€å‘çš„æ€ç»´ä¸å†å±€é™äºç¼–ç ï¼Œä»å±€éƒ¨åˆ°å…¨å±€ï¼Œä»ç¼–ç åˆ°äº¤ä»˜ï¼Œåšä¸€ä¸ªèƒ½ç‹¬ç«‹äº¤ä»˜äº§å“çš„ç¨‹åºå‘˜ã€‚</p>
<p>å¦‚æœå…¬å¸é‡Œæ­£å¥½ç¼ºå°‘å¯¹åº”çš„åŸºå»ºï¼Œä¾¿æ˜¯ä½ å¤§å±•èº«æ‰‹çš„æœºä¼šã€‚</p>
<p>è¿˜æœ‰å¾ˆå¤šç»†èŠ‚å€¼å¾—æˆ‘ä»¬è®¨è®ºï¼š</p>
<ol>
<li>é•œåƒæ„å»ºæ—¶å¦‚ä½•ç¼“å­˜ï¼Œé¿å…é‡å¤çš„æ— æ•ˆæ„å»º</li>
<li>å¦‚ä½•å°†é¡¹ç›®ç›´æ¥éƒ¨ç½²åˆ°å¤šä¸ªæœåŠ¡å™¨è¿è¡Œï¼Œè€Œä¸éœ€è¦å¤šæ¬¡é…ç½®nginx</li>
<li>éƒ¨ç½²åå‡ºç°é—®é¢˜æ€ä¹ˆå¿«é€Ÿå›æ»š</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•</li>
<li>. . .</li>
</ol>
<p>å¤§å®¶æ„Ÿå…´è¶£çš„è¯ï¼Œå†å†™ä¸€æ–‡è®¨è®ºã€‚</p>
<p>ä¸è¦å…‰çœ‹ä¸å®è·µå“¦~ å¸Œæœ›æœ¬æ–‡èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©</p>
<p>æŒç»­æ›´æ–°å‰ç«¯çŸ¥è¯†ï¼Œè„šè¸å®åœ°ä¸æ°´æ–‡ï¼ŒçœŸçš„ä¸å…³æ³¨ä¸€ä¸‹å—~</p>
<p>å†™ä½œä¸æ˜“ï¼Œå¦‚æœæœ‰æ”¶è·è¿˜æœ› ç‚¹èµ+æ”¶è— ğŸŒ¹</p>
<blockquote>
<p>æ‰ç–å­¦æµ…ï¼Œå¦‚æœ‰é—®é¢˜æˆ–å»ºè®®è¿˜æœ›æŒ‡æ•™~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ Flutter + GetX ä¸­å®ç° Design Tokens çš„å®Œæ•´æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7575469988737433609</link>    <guid>https://juejin.cn/post/7575469988737433609</guid>    <pubDate>2025-11-24T02:15:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575469988737433609" data-draft-id="7575533124877795355" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ Flutter + GetX ä¸­å®ç° Design Tokens çš„å®Œæ•´æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-24T02:15:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åæ™®é€šçš„ç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/3913917126936087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ Flutter + GetX ä¸­å®ç° Design Tokens çš„å®Œæ•´æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917126936087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åæ™®é€šçš„ç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:15:40.000Z" title="Mon Nov 24 2025 02:15:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç»“åˆ<a href="https://juejin.cn/post/7575438636332286003" target="_blank" title="https://juejin.cn/post/7575438636332286003">ã€ŠDesign Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ï¼šæ„å»ºé«˜æ•ˆè®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯ã€‹</a>çš„æ ¸å¿ƒæ€æƒ³ï¼Œåœ¨ Flutter é¡¹ç›®ä¸­ä½¿ç”¨ GetX æ¡†æ¶å®ç° Design Tokens éœ€è¦ä»<strong>åˆ†å±‚æ¶æ„ã€ä¸»é¢˜ç®¡ç†ã€çŠ¶æ€æ§åˆ¶å’Œå·¥å…·é“¾é›†æˆ</strong>å››ä¸ªç»´åº¦è¿›è¡Œç³»ç»Ÿæ€§è®¾è®¡ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„å®ç°æ–¹æ¡ˆï¼š</p>
<h2 data-id="heading-0">ä¸€ã€Design Tokens çš„åˆ†å±‚æ¶æ„è®¾è®¡</h2>
<p>æ ¹æ®è®ºæ–‡ä¸­çš„åˆ†å±‚ç®¡ç†ç»“æ„ï¼ˆåŸºç¡€Token â†’ è¯­ä¹‰Token â†’ ç»„ä»¶Tokenï¼‰ï¼Œåœ¨ Flutter ä¸­åº”å»ºç«‹å¯¹åº”çš„ä¸‰å±‚æ¶æ„ï¼š</p>
<h3 data-id="heading-1">1. åŸºç¡€ Token å±‚ï¼ˆåŸå§‹å€¼å®šä¹‰ï¼‰</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/tokens/foundation/colors.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoundationColors</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Color&gt; palette = {
    <span class="hljs-comment">// åŸºç¡€è‰²ç³» - é‡‡ç”¨è‰²ç›¸-æ˜åº¦åˆ†çº§ä½“ç³»</span>
    <span class="hljs-string">'red-50'</span>: Color(<span class="hljs-number">0xFFF8D7DA</span>),
    <span class="hljs-string">'red-100'</span>: Color(<span class="hljs-number">0xFFF1B3B6</span>),
    <span class="hljs-string">'red-500'</span>: Color(<span class="hljs-number">0xFFD32F2F</span>),
    <span class="hljs-string">'red-700'</span>: Color(<span class="hljs-number">0xFFB71C1C</span>),
    
    <span class="hljs-string">'blue-50'</span>: Color(<span class="hljs-number">0xFFE3F2FD</span>),
    <span class="hljs-string">'blue-100'</span>: Color(<span class="hljs-number">0xFFBBDEFB</span>),
    <span class="hljs-string">'blue-500'</span>: Color(<span class="hljs-number">0xFF2196F3</span>),
    <span class="hljs-string">'blue-700'</span>: Color(<span class="hljs-number">0xFF1976D2</span>),
    
    <span class="hljs-string">'gray-50'</span>: Color(<span class="hljs-number">0xFFF5F5F5</span>),
    <span class="hljs-string">'gray-100'</span>: Color(<span class="hljs-number">0xFFE0E0E0</span>),
    <span class="hljs-string">'gray-300'</span>: Color(<span class="hljs-number">0xFF9E9E9E</span>),
    <span class="hljs-string">'gray-700'</span>: Color(<span class="hljs-number">0xFF616161</span>),
    <span class="hljs-string">'gray-900'</span>: Color(<span class="hljs-number">0xFF212121</span>),
  };
}

<span class="hljs-comment">// lib/tokens/foundation/spacing.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoundationSpacing</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> xs = <span class="hljs-number">4.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> sm = <span class="hljs-number">8.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> md = <span class="hljs-number">16.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> lg = <span class="hljs-number">24.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> xl = <span class="hljs-number">32.0</span>;
}

<span class="hljs-comment">// lib/tokens/foundation/typography.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoundationTypography</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> TextStyle bodySmall = TextStyle(
    fontSize: <span class="hljs-number">12.0</span>,
    fontWeight: FontWeight.w400,
    height: <span class="hljs-number">1.5</span>,
  );
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> TextStyle bodyMedium = TextStyle(
    fontSize: <span class="hljs-number">14.0</span>,
    fontWeight: FontWeight.w400,
    height: <span class="hljs-number">1.5</span>,
  );
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> TextStyle headlineSmall = TextStyle(
    fontSize: <span class="hljs-number">16.0</span>,
    fontWeight: FontWeight.w600,
    height: <span class="hljs-number">1.4</span>,
  );
}
</code></pre>
<h3 data-id="heading-2">2. è¯­ä¹‰ Token å±‚ï¼ˆç”¨é€”è¯´æ˜ï¼‰</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/tokens/semantic/colors.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SemanticColors</span> </span>{
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> primary =&gt; FoundationColors.palette[<span class="hljs-string">'blue-500'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> primaryDark =&gt; FoundationColors.palette[<span class="hljs-string">'blue-700'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> error =&gt; FoundationColors.palette[<span class="hljs-string">'red-500'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> background =&gt; FoundationColors.palette[<span class="hljs-string">'gray-50'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> surface =&gt; Colors.white;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> onSurface =&gt; FoundationColors.palette[<span class="hljs-string">'gray-900'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> onPrimary =&gt; Colors.white;
}

<span class="hljs-comment">// lib/tokens/semantic/spacing.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SemanticSpacing</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> contentPadding =&gt; FoundationSpacing.md;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> buttonSpacing =&gt; FoundationSpacing.sm;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> cardPadding =&gt; FoundationSpacing.lg;
}

<span class="hljs-comment">// lib/tokens/semantic/typography.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SemanticTypography</span> </span>{
  <span class="hljs-keyword">static</span> TextStyle <span class="hljs-keyword">get</span> bodyText =&gt; FoundationTypography.bodyMedium;
  <span class="hljs-keyword">static</span> TextStyle <span class="hljs-keyword">get</span> labelText =&gt; FoundationTypography.bodySmall;
  <span class="hljs-keyword">static</span> TextStyle <span class="hljs-keyword">get</span> titleText =&gt; FoundationTypography.headlineSmall;
}
</code></pre>
<h3 data-id="heading-3">3. ç»„ä»¶ Token å±‚ï¼ˆç»„ä»¶çº§å˜é‡ï¼‰</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/tokens/components/button_tokens.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ButtonTokens</span> </span>{
  <span class="hljs-comment">// ä¸»æŒ‰é’®æ ·å¼</span>
  <span class="hljs-keyword">static</span> ButtonStyle primaryButtonStyle = ButtonStyle(
    backgroundColor: MaterialStateProperty.all(SemanticColors.primary),
    foregroundColor: MaterialStateProperty.all(SemanticColors.onPrimary),
    padding: MaterialStateProperty.all(
      EdgeInsets.symmetric(horizontal: SemanticSpacing.md, vertical: SemanticSpacing.sm)
    ),
    textStyle: MaterialStateProperty.all(SemanticTypography.titleText),
    shape: MaterialStateProperty.all(
      RoundedRectangleBorder(borderRadius: BorderRadius.circular(<span class="hljs-number">8.0</span>))
    ),
  );
  
  <span class="hljs-comment">// æ¬¡è¦æŒ‰é’®æ ·å¼</span>
  <span class="hljs-keyword">static</span> ButtonStyle secondaryButtonStyle = ButtonStyle(
    backgroundColor: MaterialStateProperty.all(Colors.transparent),
    foregroundColor: MaterialStateProperty.all(SemanticColors.onSurface),
    side: MaterialStateProperty.all(
      BorderSide(color: SemanticColors.onSurface, width: <span class="hljs-number">1.0</span>)
    ),
    padding: MaterialStateProperty.all(
      EdgeInsets.symmetric(horizontal: SemanticSpacing.md, vertical: SemanticSpacing.sm)
    ),
    textStyle: MaterialStateProperty.all(SemanticTypography.titleText),
    shape: MaterialStateProperty.all(
      RoundedRectangleBorder(borderRadius: BorderRadius.circular(<span class="hljs-number">8.0</span>))
    ),
  );
}
</code></pre>
<h2 data-id="heading-4">äºŒã€åŸºäº GetX çš„ä¸»é¢˜çŠ¶æ€ç®¡ç†</h2>
<p>æ ¹æ®è®ºæ–‡ä¸­"åŠ¨æ€ä¸»é¢˜æ”¯æŒï¼šåªéœ€ä¿®æ”¹Tokenå€¼ï¼Œå³å¯å®ç°å…¨å±€ä¸»é¢˜åˆ‡æ¢"çš„ç†å¿µï¼Œä½¿ç”¨ GetX å®ç°ä¸»é¢˜çŠ¶æ€ç®¡ç†ï¼š</p>
<h3 data-id="heading-5">1. åˆ›å»º ThemeService æœåŠ¡å±‚</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/services/theme_service.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:get/get.dart'</span>;

<span class="hljs-keyword">enum</span> AppTheme { light, dark }

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThemeService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxService</span> </span>{
  <span class="hljs-keyword">final</span> Rx&lt;AppTheme&gt; _currentTheme = AppTheme.light.obs;
  
  AppTheme <span class="hljs-keyword">get</span> currentTheme =&gt; _currentTheme.value;
  Stream&lt;AppTheme&gt; <span class="hljs-keyword">get</span> themeStream =&gt; _currentTheme.stream;
  
  Future&lt;ThemeService&gt; toggleTheme() <span class="hljs-keyword">async</span> {
    _currentTheme.value = _currentTheme.value == AppTheme.light 
        ? AppTheme.dark 
        : AppTheme.light;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }
  
  ThemeData getThemeData() {
    <span class="hljs-keyword">return</span> currentTheme == AppTheme.light 
        ? _lightThemeData 
        : _darkThemeData;
  }
  
  <span class="hljs-comment">// æ˜äº®ä¸»é¢˜æ•°æ®</span>
  ThemeData <span class="hljs-keyword">get</span> _lightThemeData {
    <span class="hljs-keyword">return</span> ThemeData(
      brightness: Brightness.light,
      primaryColor: SemanticColors.primary,
      scaffoldBackgroundColor: SemanticColors.background,
      cardColor: SemanticColors.surface,
      textTheme: TextTheme(
        bodyMedium: SemanticTypography.bodyText,
        labelMedium: SemanticTypography.labelText,
        titleMedium: SemanticTypography.titleText,
      ),
      elevatedButtonTheme: ElevatedButtonThemeData(
        style: ButtonTokens.primaryButtonStyle,
      ),
      outlinedButtonTheme: OutlinedButtonThemeData(
        style: ButtonTokens.secondaryButtonStyle,
      ),
    );
  }
  
  <span class="hljs-comment">// æš—è‰²ä¸»é¢˜æ•°æ® - æ ¹æ®è®ºæ–‡ä¸­çš„åŠ¨æ€ä¸»é¢˜ç†å¿µè°ƒæ•´é¢œè‰²å€¼</span>
  ThemeData <span class="hljs-keyword">get</span> _darkThemeData {
    <span class="hljs-keyword">return</span> ThemeData(
      brightness: Brightness.dark,
      primaryColor: SemanticColors.primary,
      scaffoldBackgroundColor: Color(<span class="hljs-number">0xFF121212</span>), <span class="hljs-comment">// æ·±è‰²èƒŒæ™¯</span>
      cardColor: Color(<span class="hljs-number">0xFF1E1E1E</span>), <span class="hljs-comment">// æ·±è‰²å¡ç‰‡</span>
      textTheme: TextTheme(
        bodyMedium: SemanticTypography.bodyText.copyWith(color: Colors.white70),
        labelMedium: SemanticTypography.labelText.copyWith(color: Colors.white70),
        titleMedium: SemanticTypography.titleText.copyWith(color: Colors.white),
      ),
      elevatedButtonTheme: ElevatedButtonThemeData(
        style: ButtonTokens.primaryButtonStyle.copyWith(
          backgroundColor: MaterialStateProperty.all(SemanticColors.primary),
          foregroundColor: MaterialStateProperty.all(Colors.white),
        ),
      ),
      outlinedButtonTheme: OutlinedButtonThemeData(
        style: ButtonTokens.secondaryButtonStyle.copyWith(
          side: MaterialStateProperty.all(
            BorderSide(color: Colors.white70, width: <span class="hljs-number">1.0</span>)
          ),
          foregroundColor: MaterialStateProperty.all(Colors.white70),
        ),
      ),
    );
  }
}
</code></pre>
<h3 data-id="heading-6">2. åˆå§‹åŒ– ThemeService</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/main.dart</span>
<span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span> {
  WidgetsFlutterBinding.ensureInitialized();
  
  <span class="hljs-comment">// åˆå§‹åŒ–ä¸»é¢˜æœåŠ¡</span>
  <span class="hljs-keyword">await</span> Get.putAsync(() =&gt; ThemeService().then((service) =&gt; service));
  
  runApp(MyApp());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> GetMaterialApp(
      title: <span class="hljs-string">'Design Tokens Demo'</span>,
      theme: Get.find&lt;ThemeService&gt;().getThemeData(),
      home: HomePage(),
      <span class="hljs-comment">// ç›‘å¬ä¸»é¢˜å˜åŒ–</span>
      builder: (context, child) {
        <span class="hljs-keyword">return</span> Obx(
          () =&gt; Theme(
            data: Get.find&lt;ThemeService&gt;().getThemeData(),
            child: child!,
          ),
        );
      },
    );
  }
}
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€å¤šå“ç‰Œåœºæ™¯çš„æ‰©å±•å®ç°</h2>
<p>æ ¹æ®è®ºæ–‡ä¸­"å¤šå“ç‰Œåœºæ™¯ï¼šåˆ›å»ºå“ç‰Œæ‰©å±•å±‚Token"çš„å»ºè®®ï¼Œå®ç°å“ç‰Œå®šåˆ¶åŠŸèƒ½ï¼š</p>
<h3 data-id="heading-8">1. å“ç‰Œé…ç½®æ¥å£</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/models/brand_config.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BrandConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> name;
  <span class="hljs-keyword">final</span> Color primaryColor;
  <span class="hljs-keyword">final</span> Color secondaryColor;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> logoAsset;
  
  BrandConfig({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.primaryColor,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.secondaryColor,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.logoAsset,
  });
}

<span class="hljs-comment">// å“ç‰Œé…ç½®ä»“åº“</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BrandRepository</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, BrandConfig&gt; brands = {
    <span class="hljs-string">'default'</span>: BrandConfig(
      name: <span class="hljs-string">'Default'</span>,
      primaryColor: FoundationColors.palette[<span class="hljs-string">'blue-500'</span>]!,
      secondaryColor: FoundationColors.palette[<span class="hljs-string">'red-500'</span>]!,
      logoAsset: <span class="hljs-string">'assets/logos/default_logo.png'</span>,
    ),
    <span class="hljs-string">'brand_a'</span>: BrandConfig(
      name: <span class="hljs-string">'Brand A'</span>,
      primaryColor: Color(<span class="hljs-number">0xFF6200EE</span>), <span class="hljs-comment">// ç´«è‰²ä¸»é¢˜</span>
      secondaryColor: Color(<span class="hljs-number">0xFF03DAC6</span>), <span class="hljs-comment">// é’è‰²ä¸»é¢˜</span>
      logoAsset: <span class="hljs-string">'assets/logos/brand_a_logo.png'</span>,
    ),
    <span class="hljs-string">'brand_b'</span>: BrandConfig(
      name: <span class="hljs-string">'Brand B'</span>,
      primaryColor: Color(<span class="hljs-number">0xFFFF6B35</span>), <span class="hljs-comment">// æ©™è‰²ä¸»é¢˜</span>
      secondaryColor: Color(<span class="hljs-number">0xFF2EC4B6</span>), <span class="hljs-comment">// è“ç»¿è‰²ä¸»é¢˜</span>
      logoAsset: <span class="hljs-string">'assets/logos/brand_b_logo.png'</span>,
    ),
  };
}
</code></pre>
<h3 data-id="heading-9">2. æ‰©å±• ThemeService æ”¯æŒå¤šå“ç‰Œ</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// æ‰©å±• ThemeService</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThemeService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxService</span> </span>{
  <span class="hljs-keyword">final</span> Rx&lt;AppTheme&gt; _currentTheme = AppTheme.light.obs;
  <span class="hljs-keyword">final</span> Rx&lt;<span class="hljs-built_in">String</span>&gt; _currentBrand = <span class="hljs-string">'default'</span>.obs; <span class="hljs-comment">// å½“å‰å“ç‰Œ</span>
  
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> currentBrand =&gt; _currentBrand.value;
  AppTheme <span class="hljs-keyword">get</span> currentTheme =&gt; _currentTheme.value;
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; switchBrand(<span class="hljs-built_in">String</span> brandName) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">if</span> (BrandRepository.brands.containsKey(brandName)) {
      _currentBrand.value = brandName;
    }
  }
  
  <span class="hljs-comment">// è·å–å½“å‰å“ç‰Œçš„ä¸»è‰²</span>
  Color getBrandPrimaryColor() {
    <span class="hljs-keyword">return</span> BrandRepository.brands[currentBrand]!.primaryColor;
  }
  
  <span class="hljs-comment">// é‡å†™ä¸»é¢˜æ•°æ®ç”Ÿæˆæ–¹æ³•ï¼ŒåŒ…å«å“ç‰Œå®šåˆ¶</span>
  ThemeData getThemeData() {
    <span class="hljs-keyword">final</span> brandConfig = BrandRepository.brands[currentBrand]!;
    
    <span class="hljs-keyword">return</span> currentTheme == AppTheme.light 
        ? _createLightTheme(brandConfig)
        : _createDarkTheme(brandConfig);
  }
  
  ThemeData _createLightTheme(BrandConfig config) {
    <span class="hljs-keyword">return</span> ThemeData(
      brightness: Brightness.light,
      primaryColor: config.primaryColor,
      scaffoldBackgroundColor: SemanticColors.background,
      <span class="hljs-comment">// ... å…¶ä»–ä¸»é¢˜é…ç½®</span>
    );
  }
  
  ThemeData _createDarkTheme(BrandConfig config) {
    <span class="hljs-keyword">return</span> ThemeData(
      brightness: Brightness.dark,
      primaryColor: config.primaryColor,
      scaffoldBackgroundColor: Color(<span class="hljs-number">0xFF121212</span>),
      <span class="hljs-comment">// ... å…¶ä»–ä¸»é¢˜é…ç½®</span>
    );
  }
}
</code></pre>
<h2 data-id="heading-10">å››ã€ç»„ä»¶å±‚çš„ Token ä½¿ç”¨æœ€ä½³å®è·µ</h2>
<p>æ ¹æ®è®ºæ–‡ä¸­"ç»„ä»¶Tokenï¼šç»„ä»¶çº§å˜é‡"çš„ç†å¿µï¼Œåœ¨ UI ç»„ä»¶ä¸­æ­£ç¡®ä½¿ç”¨ Design Tokensï¼š</p>
<h3 data-id="heading-11">1. åŸºç¡€ç»„ä»¶å°è£…</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/components/app_button.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> text;
  <span class="hljs-keyword">final</span> VoidCallback onPressed;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isPrimary;
  
  <span class="hljs-keyword">const</span> AppButton({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.text,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onPressed,
    <span class="hljs-keyword">this</span>.isPrimary = <span class="hljs-keyword">true</span>,
  }) : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> ElevatedButton(
      onPressed: onPressed,
      style: isPrimary 
          ? ButtonTokens.primaryButtonStyle 
          : ButtonTokens.secondaryButtonStyle,
      child: Text(text),
    );
  }
}

<span class="hljs-comment">// lib/components/app_card.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppCard</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> Widget child;
  
  <span class="hljs-keyword">const</span> AppCard({Key? key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.child}) : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Card(
      margin: EdgeInsets.all(SemanticSpacing.md),
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(<span class="hljs-number">12.0</span>),
      ),
      child: Padding(
        padding: EdgeInsets.all(SemanticSpacing.cardPadding),
        child: child,
      ),
    );
  }
}
</code></pre>
<h3 data-id="heading-12">2. åœ¨é¡µé¢ä¸­ä½¿ç”¨ç»„ä»¶</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/views/home_page.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">final</span> themeService = Get.find&lt;ThemeService&gt;();
    
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: Text(<span class="hljs-string">'Design Tokens Demo'</span>),
        actions: [
          IconButton(
            icon: Icon(themeService.currentTheme == AppTheme.light 
                ? Icons.dark_mode 
                : Icons.light_mode),
            onPressed: () =&gt; themeService.toggleTheme(),
          ),
          PopupMenuButton&lt;<span class="hljs-built_in">String</span>&gt;(
            onSelected: (brand) =&gt; themeService.switchBrand(brand),
            itemBuilder: (context) =&gt; BrandRepository.brands.keys.map((brand) {
              <span class="hljs-keyword">return</span> PopupMenuItem(
                value: brand,
                child: Text(BrandRepository.brands[brand]!.name),
              );
            }).toList(),
          ),
        ],
      ),
      body: SingleChildScrollView(
        padding: EdgeInsets.all(SemanticSpacing.contentPadding),
        child: Column(
          children: [
            AppCard(
              child: Column(
                children: [
                  Text(
                    <span class="hljs-string">'Welcome to Design Tokens Demo'</span>,
                    style: SemanticTypography.titleText,
                  ),
                  SizedBox(height: SemanticSpacing.md),
                  Text(
                    <span class="hljs-string">'This demonstrates how to implement Design Tokens in Flutter with GetX.'</span>,
                    style: SemanticTypography.bodyText,
                  ),
                ],
              ),
            ),
            AppButton(
              text: <span class="hljs-string">'Primary Action'</span>,
              onPressed: () {},
              isPrimary: <span class="hljs-keyword">true</span>,
            ),
            SizedBox(height: SemanticSpacing.buttonSpacing),
            AppButton(
              text: <span class="hljs-string">'Secondary Action'</span>,
              onPressed: () {},
              isPrimary: <span class="hljs-keyword">false</span>,
            ),
          ],
        ),
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-13">äº”ã€æ€§èƒ½ä¼˜åŒ–ä¸å·¥å…·é“¾é›†æˆ</h2>
<h3 data-id="heading-14">1. æŒ‰éœ€åŠ è½½ä¸»é¢˜åŒ…</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/services/theme_loader.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThemeLoader</span> </span>{
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; loadThemeJson(<span class="hljs-built_in">String</span> themeName) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> jsonString = <span class="hljs-keyword">await</span> rootBundle.loadString(<span class="hljs-string">'assets/themes/<span class="hljs-subst">$themeName</span>.json'</span>);
    <span class="hljs-keyword">return</span> json.decode(jsonString);
  }
  
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; applyDynamicTheme(<span class="hljs-built_in">String</span> themeName) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> themeData = <span class="hljs-keyword">await</span> loadThemeJson(themeName);
    <span class="hljs-comment">// åŠ¨æ€åº”ç”¨ä¸»é¢˜é€»è¾‘</span>
  }
}
</code></pre>
<h3 data-id="heading-15">2. ç¼–è¯‘æ—¶ä¼˜åŒ–</h3>
<p>åœ¨ <code>pubspec.yaml</code> ä¸­é…ç½®èµ„æºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">flutter:</span>
  <span class="hljs-attr">assets:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/themes/</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/logos/</span>
</code></pre>
<h3 data-id="heading-16">3. å¼€å‘ç¯å¢ƒè°ƒè¯•å·¥å…·</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/utils/token_debugger.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TokenDebugger</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> printAllTokens() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'=== Foundation Colors ==='</span>);
    FoundationColors.palette.forEach((key, value) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">$key</span>: <span class="hljs-subst">${value.value}</span>'</span>);
    });
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'=== Semantic Colors ==='</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Primary: <span class="hljs-subst">${SemanticColors.primary.value}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Error: <span class="hljs-subst">${SemanticColors.error.value}</span>'</span>);
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'=== Spacing ==='</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'XS: <span class="hljs-subst">${FoundationSpacing.xs}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'SM: <span class="hljs-subst">${FoundationSpacing.sm}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'MD: <span class="hljs-subst">${FoundationSpacing.md}</span>'</span>);
  }
}
</code></pre>
<h2 data-id="heading-17">å…­ã€å®æ–½æ•ˆæœä¸ä¼˜åŠ¿æ€»ç»“</h2>
<p>é€šè¿‡ä¸Šè¿°å®ç°æ–¹æ¡ˆï¼Œæˆ‘ä»¬æˆåŠŸå°†ã€ŠDesign Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ã€‹ä¸­çš„æ ¸å¿ƒç†å¿µåº”ç”¨åˆ° Flutter + GetX é¡¹ç›®ä¸­ï¼š</p>
<h3 data-id="heading-18">å®ç°æ•ˆæœ</h3>
<ul>
<li><strong>è·¨å¹³å°ä¸€è‡´æ€§</strong>ï¼šæ‰€æœ‰ UI ç»„ä»¶éƒ½ä½¿ç”¨ç»Ÿä¸€çš„ Design Tokensï¼Œç¡®ä¿è§†è§‰ä¸€è‡´æ€§</li>
<li><strong>åŠ¨æ€ä¸»é¢˜æ”¯æŒ</strong>ï¼šé€šè¿‡ GetX çš„å“åº”å¼çŠ¶æ€ç®¡ç†ï¼Œå®ç°ä¸€é”®åˆ‡æ¢æ˜æš—ä¸»é¢˜</li>
<li><strong>å¤šå“ç‰Œæ‰©å±•</strong>ï¼šæ”¯æŒä¸åŒå“ç‰Œçš„å¿«é€Ÿå®šåˆ¶å’Œåˆ‡æ¢</li>
<li><strong>åˆ†å±‚ç®¡ç†</strong>ï¼šæ¸…æ™°çš„ä¸‰å±‚æ¶æ„ï¼ˆåŸºç¡€â†’è¯­ä¹‰â†’ç»„ä»¶ï¼‰ä¾¿äºç»´æŠ¤å’Œæ‰©å±•</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæŒ‰éœ€åŠ è½½ã€ç¼–è¯‘æ—¶ä¼˜åŒ–ç¡®ä¿åº”ç”¨æ€§èƒ½</li>
</ul>
<h3 data-id="heading-19">æ•ˆç‡æå‡æ•°æ®</h3>
<p>æ ¹æ®è®ºæ–‡ä¸­æåˆ°çš„æ•°æ®ï¼š"é€šè¿‡æ ‡å‡†åŒ–Design Tokenç®¡ç†ï¼Œå›¢é˜Ÿå¯å‡å°‘æ ·å¼å†—ä½™ä»£ç è¾¾40-60%ï¼Œä¸»é¢˜åˆ‡æ¢æ•ˆç‡æå‡300%ä»¥ä¸Š"ï¼Œåœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼š</p>
<ul>
<li><strong>ä»£ç å¤ç”¨ç‡æå‡</strong>ï¼šç»„ä»¶æ ·å¼å®šä¹‰å‡å°‘çº¦50%</li>
<li><strong>ä¸»é¢˜åˆ‡æ¢æ—¶é—´</strong>ï¼šä»åŸæ¥çš„æ•°åˆ†é’Ÿæ‰‹åŠ¨ä¿®æ”¹ï¼Œç¼©çŸ­åˆ°æ¯«ç§’çº§è‡ªåŠ¨åˆ‡æ¢</li>
<li><strong>ç»´æŠ¤æˆæœ¬é™ä½</strong>ï¼šæ ·å¼å˜æ›´åªéœ€ä¿®æ”¹ä¸€å¤„ Token å®šä¹‰</li>
<li><strong>å›¢é˜Ÿåä½œæ•ˆç‡</strong>ï¼šè®¾è®¡å¸ˆå’Œå¼€å‘è€…ä½¿ç”¨åŒä¸€å¥—å‘½åè§„èŒƒï¼Œæ²Ÿé€šæˆæœ¬å¤§å¹…é™ä½</li>
</ul>
<h3 data-id="heading-20">æœªæ¥æ‰©å±•æ–¹å‘</h3>
<ul>
<li><strong>Figma æ’ä»¶é›†æˆ</strong>ï¼šå¼€å‘ Figma æ’ä»¶è‡ªåŠ¨ç”Ÿæˆ Flutter Design Tokens ä»£ç </li>
<li><strong>CI/CD è‡ªåŠ¨åŒ–</strong>ï¼šåœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆå’ŒéªŒè¯ Design Tokens</li>
<li><strong>è¿è¡Œæ—¶ä¸»é¢˜ç¼–è¾‘å™¨</strong>ï¼šæä¾›å¯è§†åŒ–ç•Œé¢å®æ—¶è°ƒæ•´å’Œé¢„è§ˆä¸»é¢˜æ•ˆæœ</li>
<li><strong>å›½é™…åŒ–æ”¯æŒ</strong>ï¼šç»“åˆ GetX çš„å›½é™…åŒ–åŠŸèƒ½ï¼Œå®ç°å¤šè¯­è¨€+å¤šä¸»é¢˜çš„ç»„åˆ</li>
</ul>
<p>é€šè¿‡è¿™å¥—å®Œæ•´çš„å®ç°æ–¹æ¡ˆï¼ŒFlutter + GetX é¡¹ç›®èƒ½å¤Ÿå……åˆ†å‘æŒ¥ Design Tokens çš„ä¼˜åŠ¿ï¼Œæ„å»ºé«˜æ•ˆã€ä¸€è‡´ã€å¯ç»´æŠ¤çš„è®¾è®¡ç³»ç»Ÿï¼Œä¸ºäº§å“çš„é•¿æœŸå‘å±•å¥ å®šåšå®åŸºç¡€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Webpack æ’ä»¶å¼€å‘æŒ‡å—ï¼šæ·±å…¥ç†è§£ Compiler Hooks]]></title>    <link>https://juejin.cn/post/7575488180980678656</link>    <guid>https://juejin.cn/post/7575488180980678656</guid>    <pubDate>2025-11-24T02:42:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575488180980678656" data-draft-id="7575488180980596736" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Webpack æ’ä»¶å¼€å‘æŒ‡å—ï¼šæ·±å…¥ç†è§£ Compiler Hooks"/> <meta itemprop="keywords" content="å‰ç«¯,Webpack"/> <meta itemprop="datePublished" content="2025-11-24T02:42:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°‘å¿"/> <meta itemprop="url" content="https://juejin.cn/user/26044010879709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Webpack æ’ä»¶å¼€å‘æŒ‡å—ï¼šæ·±å…¥ç†è§£ Compiler Hooks
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044010879709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°‘å¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:42:03.000Z" title="Mon Nov 24 2025 02:42:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Webpack çš„æµ©ç€šå®‡å®™ä¸­ï¼Œ<strong>Pluginï¼ˆæ’ä»¶ï¼‰</strong> æ˜¯æœ€å¼ºå¤§çš„æ‰©å±•æœºåˆ¶ã€‚å¦‚æœè¯´ Loader åªæ˜¯è´Ÿè´£è½¬æ¢æ–‡ä»¶çš„â€œç¿»è¯‘å®˜â€ï¼Œé‚£ä¹ˆ Plugin å°±æ˜¯èƒ½æ§åˆ¶ Webpack æ•´ä¸ªæ„å»ºç”Ÿå‘½å‘¨æœŸçš„â€œæŒ‡æŒ¥å®˜â€ã€‚</p>
<p>è€Œè¦å¼€å‘ä¸€ä¸ª Pluginï¼Œç¬¬ä¸€æ­¥å°±æ˜¯ææ‡‚ <code>compiler.hooks</code>ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ æ ¸å¿ƒéšå–»ï¼šæµæ°´çº¿ä¸Šçš„â€œä¼ æ„Ÿå™¨â€</h2>
<p>ä¸ºäº†ç†è§£ Webpack çš„æ„å»ºè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªè¶…çº§å·¥å‚çš„<strong>æµæ°´çº¿</strong>ï¼š</p>
<ol>
<li><strong>Compiler (ç¼–è¯‘å™¨)</strong> ï¼šå°±æ˜¯è¿™ä¸ªå·¥å‚çš„ä¸»æ§ç”µè„‘ã€‚å®ƒåœ¨ Webpack å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œå…¨å±€å”¯ä¸€ï¼Œä¿å­˜äº†æ‰€æœ‰çš„é…ç½®ï¼ˆOptions, Loaders, Pluginsï¼‰ã€‚</li>
<li><strong>Hooks (é’©å­)</strong> ï¼šæµæ°´çº¿ä¸Šçš„ä¸€ä¸ªä¸ª<strong>å…³é”®èŠ‚ç‚¹</strong>ã€‚</li>
<li><strong>Tapable</strong>ï¼šWebpack å†…éƒ¨çš„äº‹ä»¶æµæœºåˆ¶ã€‚</li>
</ol>
<p>å½“æˆ‘ä»¬å¼€å‘æ’ä»¶æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šå®‰è£…â€œä¼ æ„Ÿå™¨â€æˆ–â€œæœºæ¢°è‡‚â€ã€‚å½“æµæ°´çº¿è¿è¡Œåˆ°æŸä¸ªèŠ‚ç‚¹ï¼ˆæ¯”å¦‚â€œå‡†å¤‡å†™å…¥æ–‡ä»¶â€æ—¶ï¼‰ï¼Œå°±ä¼šè§¦å‘æˆ‘ä»¬çš„é€»è¾‘ï¼Œè®©æˆ‘ä»¬æœ‰æœºä¼šä¿®æ”¹æ•°æ®ã€å¢åŠ æ–‡ä»¶æˆ–ç›‘æ§çŠ¶æ€ã€‚</p>
<h2 data-id="heading-1">äºŒã€ Compiler Hooks ç”Ÿå‘½å‘¨æœŸå…¨æ™¯å›¾</h2>
<p><code>compiler.hooks</code> åŒ…å«äº†å‡ åä¸ªé’©å­ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…¨éƒ¨èƒŒä¸‹æ¥ã€‚æŒ‰ç…§æ„å»ºæµç¨‹ï¼Œæˆ‘ä»¬å°†æœ€æ ¸å¿ƒçš„é’©å­åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p>
<h3 data-id="heading-2">1. åˆå§‹åŒ–é˜¶æ®µ (Initialization)</h3>
<p>å½“ Webpack è¯»å–é…ç½®å¹¶åˆå§‹åŒ–æ’ä»¶æ—¶è§¦å‘ã€‚</p>
<ul>
<li>
<p><strong><code>entryOption</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncBailHook</li>
<li><strong>ä½œç”¨</strong>ï¼šåœ¨å¤„ç† <code>entry</code> é…ç½®é¡¹ä¹‹åè§¦å‘ã€‚å¦‚æœä½ æƒ³åŠ¨æ€ä¿®æ”¹å…¥å£é…ç½®ï¼Œå°±åœ¨è¿™é‡ŒåŠ¨æ‰‹ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>afterPlugins</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ‰€æœ‰æ’ä»¶çš„ <code>apply</code> æ–¹æ³•æ‰§è¡Œå®Œä¹‹åã€‚é€‚åˆåšæ’ä»¶ä¹‹é—´çš„è”åŠ¨æ£€æŸ¥ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">2. ç¼–è¯‘æ„å»ºé˜¶æ®µ (Running &amp; Building)</h3>
<p>è¿™æ˜¯å·¥å‚å¼€å§‹è¿è½¬ï¼Œå¤„ç†æ¨¡å—ä¾èµ–çš„æ ¸å¿ƒé˜¶æ®µã€‚</p>
<ul>
<li>
<p><strong><code>run</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncSeriesHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ„å»ºçœŸæ­£å¼€å§‹å‰çš„â€œé¢„çƒ­â€é˜¶æ®µã€‚å¯ä»¥ç”¨äºæ¸…ç†ç¼“å­˜æˆ–è¯»å–å¤–éƒ¨è®°å½•ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>compile</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncHook</li>
<li><strong>ä½œç”¨</strong>ï¼šå‘Šè¯‰å¤§å®¶â€œæˆ‘è¦å¼€å§‹åˆ›å»ºç¼–è¯‘å¯¹è±¡äº†â€ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>compilation</code> (â­ æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ)</strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncHook</li>
<li><strong>ä½œç”¨</strong>ï¼š<code>compilation</code> å¯¹è±¡åˆ›å»ºå®Œæˆã€‚</li>
<li><strong>è¯¦è§£</strong>ï¼šè¿™æ˜¯ç»å¤§å¤šæ•°æ’ä»¶çš„å…¥å£ã€‚<code>compilation</code> ä»£è¡¨**â€œä»…ä»…è¿™ä¸€æ¬¡æ„å»ºâ€**çš„èµ„æºé›†åˆã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—® <code>compilation.hooks</code> è¿›ä¸€æ­¥æ·±å…¥åˆ°æ¨¡å—ï¼ˆModuleï¼‰å’Œä»£ç å—ï¼ˆChunkï¼‰çš„å¤„ç†ç»†èŠ‚ä¸­ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>make</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncParallelHook</li>
<li><strong>ä½œç”¨</strong>ï¼šç¼–è¯‘è¿‡ç¨‹æ­£å¼å¯åŠ¨ï¼Œå¼€å§‹ä» Entry é€’å½’åˆ†æä¾èµ–ã€‚è¿™æ˜¯æ·»åŠ é¢å¤–æ–‡ä»¶æˆ–æ¨¡å—çš„å¥½æ—¶æœºã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">3. è¾“å‡ºé˜¶æ®µ (Output)</h3>
<p>èµ„æºå·²ç»å¤„ç†å®Œæ¯•ï¼Œå‡†å¤‡æ‰“åŒ…ç”Ÿæˆçš„é˜¶æ®µã€‚</p>
<ul>
<li>
<p><strong><code>emit</code> (â­ æœ€å¸¸ç”¨)</strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncSeriesHook</li>
<li><strong>ä½œç”¨</strong>ï¼šèµ„æºå·²ç»è½¬æ¢å®Œæˆï¼Œæ”¾åœ¨å†…å­˜é‡Œï¼Œä½†<strong>è¿˜æ²¡å†™å…¥ç£ç›˜</strong>ã€‚</li>
<li><strong>å®æˆ˜</strong>ï¼šè¿™æ˜¯ä¿®æ”¹æœ€ç»ˆè¾“å‡ºæ–‡ä»¶çš„æœ€åæœºä¼šã€‚æ¯”å¦‚ï¼šç”Ÿæˆ <code>file-list.md</code>ã€å‹ç¼©å›¾ç‰‡ã€æ·»åŠ ç‰ˆæƒå¤´ä¿¡æ¯ç­‰ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>afterEmit</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncSeriesHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ–‡ä»¶å·²ç»å†™å…¥ç£ç›˜ä¹‹åã€‚å¸¸ç”¨äºæ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">4. ç»“æŸé˜¶æ®µ (Termination)</h3>
<ul>
<li>
<p><strong><code>done</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncSeriesHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ„å»ºå®Œæˆï¼ˆæ— è®ºæˆåŠŸè¿˜æ˜¯æœ‰è­¦å‘Šï¼‰ã€‚å¸¸ç”¨äºæ‰“å°ç»Ÿè®¡ä¿¡æ¯ï¼ˆStatsï¼‰æˆ–å‘é€æ„å»ºå®Œæˆé€šçŸ¥ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>failed</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ„å»ºå› é”™è¯¯è€Œå¤±è´¥ã€‚ç”¨äºé”™è¯¯ä¸ŠæŠ¥ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€ å®æˆ˜ï¼šå¦‚ä½•â€œæŒ‚è½½â€ä½ çš„é€»è¾‘ï¼Ÿ</h2>
<p>åœ¨æ’ä»¶ç±»çš„ <code>apply</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>.tap</code> ç³»åˆ—æ–¹æ³•æ¥æ³¨å†Œé’©å­ã€‚æ ¹æ®é’©å­çš„ç±»å‹ï¼ˆåŒæ­¥æˆ–å¼‚æ­¥ï¼‰ï¼Œæœ‰ä¸åŒçš„å†™æ³•ã€‚</p>
<h3 data-id="heading-7">1. åŒæ­¥é’©å­ (SyncHook)</h3>
<p>ä½¿ç”¨ <code>.tap()</code>ã€‚é€»è¾‘æ‰§è¡Œå®Œï¼Œæµæ°´çº¿ç»§ç»­ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStartPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    <span class="hljs-comment">// å‚æ•°1: æ’ä»¶åç§°ï¼ˆå»ºè®®å†™ç±»åï¼‰ï¼Œå‚æ•°2: å›è°ƒ</span>
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compile</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyStartPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'&gt;&gt;&gt; ç¼–è¯‘å™¨å¯åŠ¨ï¼Œå‡†å¤‡å¹²æ´»ï¼'</span>);
    });
  }
}
</code></pre>
<h3 data-id="heading-8">2. å¼‚æ­¥é’©å­ (AsyncHook)</h3>
<p>ç±»ä¼¼äº <code>emit</code> è¿™ç§æ¶‰åŠæ–‡ä»¶ I/O çš„æ“ä½œï¼Œé€šå¸¸æ˜¯å¼‚æ­¥çš„ã€‚ä½ æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<p>æ–¹å¼ Aï¼šå›è°ƒé£æ ¼ (tapAsync)</p>
<p>æ³¨æ„ï¼šåƒä¸‡åˆ«å¿˜äº†è°ƒç”¨ callback()ï¼Œå¦åˆ™æ„å»ºä¼šå¡æ­»ï¼</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileListPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">'FileListPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation, callback</span>) =&gt;</span> {
      <span class="hljs-comment">// 1. è¯»å–å½“å‰ç”Ÿæˆçš„æ‰€æœ‰èµ„æºåç§°</span>
      <span class="hljs-keyword">const</span> fileNames = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(compilation.<span class="hljs-property">assets</span>);
      <span class="hljs-keyword">const</span> content = <span class="hljs-string">`Generated files:\n <span class="hljs-subst">${fileNames.join(<span class="hljs-string">'\n'</span>)}</span>`</span>;

      <span class="hljs-comment">// 2. å‘è¾“å‡ºåˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡ä»¶</span>
      compilation.<span class="hljs-property">assets</span>[<span class="hljs-string">'file-list.txt'</span>] = {
        <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> content,
        <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> content.<span class="hljs-property">length</span>
      };

      <span class="hljs-comment">// 3. é€šçŸ¥ Webpack ç»§ç»­</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶åˆ—è¡¨å·²ç”Ÿæˆ'</span>);
      <span class="hljs-title function_">callback</span>(); 
    });
  }
}
</code></pre>
<p>æ–¹å¼ Bï¼šPromise é£æ ¼ (tapPromise)</p>
<p>è¿”å›ä¸€ä¸ª Promiseï¼ŒWebpack ä¼šç­‰å¾…å®ƒ resolveã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapPromise</span>(<span class="hljs-string">'MyPromisePlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¼‚æ­¥ä»»åŠ¡å®Œæˆ'</span>);
      <span class="hljs-title function_">resolve</span>();
    }, <span class="hljs-number">1000</span>);
  });
});
</code></pre>
<hr/>
<h2 data-id="heading-9">å››ã€ é¿å‘æŒ‡å—ï¼šCompiler vs Compilation</h2>
<p>åˆå­¦è€…æœ€å¤§çš„å›°æƒ‘å¾€å¾€æ˜¯ï¼š <strong>â€œæˆ‘åˆ°åº•è¯¥ç”¨ <code>compiler.hooks</code> è¿˜æ˜¯ <code>compilation.hooks</code>ï¼Ÿâ€</strong></p>























<table><thead><tr><th><strong>å¯¹è±¡</strong></th><th><strong>ä½œç”¨åŸŸ</strong></th><th><strong>å…³æ³¨ç‚¹</strong></th><th><strong>ä¸¾ä¾‹</strong></th></tr></thead><tbody><tr><td><strong>Compiler</strong></td><td><strong>å®è§‚</strong> (æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ)</td><td>æ„å»ºçš„èµ·æ­¢ã€é…ç½®ã€ç¯å¢ƒ</td><td>â€œä»€ä¹ˆæ—¶å€™å¼€å§‹è·‘ï¼Ÿâ€ã€â€œä»€ä¹ˆæ—¶å€™å†™å®Œæ–‡ä»¶ï¼Ÿâ€</td></tr><tr><td><strong>Compilation</strong></td><td><strong>å¾®è§‚</strong> (å•æ¬¡æ„å»º)</td><td>å…·ä½“çš„æ¨¡å—ã€ä¾èµ–ã€ä»£ç ç”Ÿæˆ</td><td>â€œå¦‚ä½•å‹ç¼©è¿™ä¸ª JSï¼Ÿâ€ã€â€œè¿™ä¸ª CSS çš„ Hash æ€ä¹ˆç®—ï¼Ÿâ€</td></tr></tbody></table>
<p>ä½¿ç”¨åŸåˆ™ï¼š</p>
<p>ä¸€èˆ¬æˆ‘ä»¬é€šè¿‡ compiler.hooks.compilation ä½œä¸ºå…¥å£ï¼Œæ‹¿åˆ° compilation å®ä¾‹ï¼Œç„¶åå†å»æ³¨å†Œ compilation.hooks æ¥å¤„ç†å…·ä½“çš„èµ„æºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {
  <span class="hljs-comment">// ç°åœ¨ä½ å¯ä»¥æ“ä½œå…·ä½“çš„æ¨¡å—é’©å­äº†</span>
  compilation.<span class="hljs-property">hooks</span>.<span class="hljs-property">optimizeChunkAssets</span>.<span class="hljs-title function_">tap</span>(...)
});
</code></pre>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>æŒæ¡ <code>compiler.hooks</code> æ˜¯é€šå¾€ Webpack é«˜çº§ç©æ³•çš„å¿…ç»ä¹‹è·¯ã€‚</p>
<ol>
<li><strong>EntryOption/Run</strong>: é…ç½®ä¸é¢„å¤„ç†ã€‚</li>
<li><strong>Compilation</strong>: æ·±å…¥æ¨¡å—å¤„ç†çš„å…¥å£ã€‚</li>
<li><strong>Emit</strong>: ä¿®æ”¹æœ€ç»ˆäº§ç‰©çš„æœ€åæœºä¼šï¼ˆæœ€å¸¸ç”¨ï¼‰ã€‚</li>
<li><strong>Done</strong>: ç»Ÿè®¡ä¸é€šçŸ¥ã€‚</li>
</ol>
<p>ç†è§£äº†è¿™æ¡æµæ°´çº¿ï¼Œä½ å°±æ‹¥æœ‰äº†éšæ„å®šåˆ¶å‰ç«¯æ„å»ºæµç¨‹çš„èƒ½åŠ›ã€‚ Happy Coding!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å·§å¦™æµè§ˆå™¨äº‹ä»¶ç›‘å¬APIï¼šaddEventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°]]></title>    <link>https://juejin.cn/post/7575735719076249606</link>    <guid>https://juejin.cn/post/7575735719076249606</guid>    <pubDate>2025-11-24T02:43:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575735719076249606" data-draft-id="7575937594339213353" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å·§å¦™æµè§ˆå™¨äº‹ä»¶ç›‘å¬APIï¼šaddEventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-24T02:43:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="X_hope"/> <meta itemprop="url" content="https://juejin.cn/user/4365481627355447"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å·§å¦™æµè§ˆå™¨äº‹ä»¶ç›‘å¬APIï¼šaddEventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4365481627355447/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    X_hope
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:43:36.000Z" title="Mon Nov 24 2025 02:43:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œ<code>addEventListener</code> æ˜¯æˆ‘ä»¬ç»‘å®šäº‹ä»¶ç›‘å¬å™¨çš„"è€æœ‹å‹"ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬ä¹ æƒ¯åªä¼ å…¥å‰ä¸¤ä¸ªå‚æ•°â€”â€”äº‹ä»¶ç±»å‹å’Œå›è°ƒå‡½æ•°ï¼Œå´å¸¸å¸¸å¿½ç•¥ç¬¬ä¸‰ä¸ªå‚æ•°çš„å¼ºå¤§èƒ½åŠ›ã€‚è¿™ä¸ªçœ‹ä¼¼"å¯é€‰"çš„å‚æ•°ï¼Œåœ¨ç°ä»£æµè§ˆå™¨çš„APIå‡çº§ä¸­æ—©å·²è¿›åŒ–æˆä¼˜åŒ–æ€§èƒ½ã€ç®€åŒ–é€»è¾‘çš„å…³é”®å·¥å…·ã€‚æœ¬æ–‡å°±å¸¦ä½ åƒé€å®ƒçš„ä¸¤ç§å½¢æ€ä¸æœ€æ–°ç”¨æ³•ï¼Œè®©äº‹ä»¶å¤„ç†æ›´ä¼˜é›…é«˜æ•ˆã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä»å¸ƒå°”å€¼åˆ°é…ç½®å¯¹è±¡ï¼šç¬¬ä¸‰ä¸ªå‚æ•°çš„è¿›åŒ–ä¹‹è·¯</h3>
<p>æ—©æœŸçš„ <code>addEventListener</code> ç¬¬ä¸‰ä¸ªå‚æ•°ä»…æ”¯æŒå¸ƒå°”å€¼ï¼ˆå‘½åä¸º <code>useCapture</code>ï¼‰ï¼Œç”¨äºæ§åˆ¶äº‹ä»¶ç›‘å¬å™¨åœ¨"æ•è·é˜¶æ®µ"è¿˜æ˜¯"å†’æ³¡é˜¶æ®µ"è§¦å‘ã€‚éšç€Webæ ‡å‡†çš„å‘å±•ï¼Œç°ä»£æµè§ˆå™¨ï¼ˆåŒ…æ‹¬Chrome 49+ã€Firefox 48+ç­‰ï¼‰å·²å…¨é¢æ”¯æŒä¼ å…¥<strong>é…ç½®å¯¹è±¡</strong>ï¼Œé™¤äº†å®ç°æ•è·æ§åˆ¶ï¼Œè¿˜æ‰©å±•äº†è¯¸å¤šå®ç”¨ç‰¹æ€§ã€‚</p>
<p>å½“å‰æœ€æ–°APIè§„èŒƒä¸­ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°çš„å®Œæ•´å®šä¹‰ä¸ºï¼šå¯é€‰å‚æ•°ï¼Œå¯ä¼ å…¥å¸ƒå°”å€¼æˆ–åŒ…å« <code>capture</code>ã€<code>once</code>ã€<code>passive</code>ã€<code>signal</code> å±æ€§çš„é…ç½®å¯¹è±¡ï¼Œç”¨äºç²¾ç¡®æ§åˆ¶äº‹ä»¶ç›‘å¬è¡Œä¸ºã€‚</p>
<h3 data-id="heading-2">äºŒã€æ ¸å¿ƒå‚æ•°è¯¦è§£ï¼šæ¯ä¸ªç‰¹æ€§éƒ½è—ç€å®ç”¨æŠ€å·§</h3>
<p>æ— è®ºæ˜¯å¸ƒå°”å€¼å½¢å¼è¿˜æ˜¯é…ç½®å¯¹è±¡å½¢å¼ï¼Œæ ¸å¿ƒèƒ½åŠ›éƒ½å›´ç»•äº‹ä»¶ä¼ æ’­æœºåˆ¶ä¸ç›‘å¬å™¨ç”Ÿå‘½å‘¨æœŸå±•å¼€ã€‚ä¸‹é¢ç»“åˆæœ€æ–°APIç‰¹æ€§ä¸å®æˆ˜åœºæ™¯é€ä¸€è§£æã€‚</p>
<h4 data-id="heading-3">1. captureï¼šæ§åˆ¶äº‹ä»¶è§¦å‘çš„"é˜¶æ®µ"</h4>
<p>è¿™æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°æœ€åŸºç¡€çš„èƒ½åŠ›ï¼Œå¯¹åº”æ—©æœŸå¸ƒå°”å€¼ç”¨æ³•çš„æ ¸å¿ƒåŠŸèƒ½ã€‚äº‹ä»¶åœ¨DOMä¸­ä¼ æ’­åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šæ•è·é˜¶æ®µï¼ˆä»æ ¹å…ƒç´ åˆ°ç›®æ ‡å…ƒç´ ï¼‰ã€ç›®æ ‡é˜¶æ®µï¼ˆäº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ ï¼‰ã€å†’æ³¡é˜¶æ®µï¼ˆä»ç›®æ ‡å…ƒç´ å›é€€åˆ°æ ¹å…ƒç´ ï¼‰ã€‚</p>
<ul>
<li><strong>capture: false</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šç›‘å¬å™¨åœ¨<strong>å†’æ³¡é˜¶æ®µ</strong>è§¦å‘ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼Œèƒ½è®©äº‹ä»¶è‡ªç„¶å‘ä¸Šä¼ æ’­</li>
<li><strong>capture: true</strong>ï¼šç›‘å¬å™¨åœ¨<strong>æ•è·é˜¶æ®µ</strong>è§¦å‘ï¼Œå¯å®ç°"æå‰æ‹¦æˆª"äº‹ä»¶çš„æ•ˆæœ</li>
</ul>
<p><strong>å®æˆ˜åœºæ™¯ï¼šç‚¹å‡»é®ç½©å…³é—­å¼¹çª—</strong>ï¼Œé€šè¿‡æ•è·é˜¶æ®µæå‰æ‹¦æˆªäº‹ä»¶ï¼Œé¿å…äº‹ä»¶å†’æ³¡åˆ°å¼¹çª—å†…éƒ¨å…ƒç´ æ—¶è¢«å¹²æ‰°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> mask = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'mask'</span>);
<span class="hljs-keyword">const</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modal'</span>);

<span class="hljs-comment">// æ•è·é˜¶æ®µç›‘å¬é®ç½©ç‚¹å‡»ï¼Œä¼˜å…ˆè§¦å‘</span>
mask.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
}, { <span class="hljs-attr">capture</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// å†’æ³¡é˜¶æ®µç›‘å¬å¼¹çª—å†…å®¹ç‚¹å‡»ï¼Œä¸ä¼šè¢«é®ç½©çš„æ•è·ç›‘å¬å¹²æ‰°</span>
modal.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  e.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// é˜»æ­¢äº‹ä»¶ç»§ç»­å†’æ³¡åˆ°é®ç½©</span>
});
</code></pre>
<h4 data-id="heading-4">2. onceï¼šè®©ç›‘å¬å™¨"è‡ªåŠ¨ç¦»èŒ"</h4>
<p>å½“ <code>once: true</code> æ—¶ï¼Œç›‘å¬å™¨åœ¨ç¬¬ä¸€æ¬¡è§¦å‘åä¼šè‡ªåŠ¨ä»å…ƒç´ ä¸Šç§»é™¤ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ <code>removeEventListener</code>ï¼Œç‰¹åˆ«é€‚åˆä¸€æ¬¡æ€§æ“ä½œåœºæ™¯ã€‚</p>
<p><strong>å®æˆ˜åœºæ™¯ï¼šè¡¨å•æäº¤é˜²é‡å¤ç‚¹å‡»</strong>ï¼Œé¿å…ç”¨æˆ·å¿«é€Ÿå¤šæ¬¡ç‚¹å‡»æäº¤æŒ‰é’®å¯¼è‡´é‡å¤è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">form</span> = document.getElementById(<span class="hljs-string">'myForm'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">submitBtn</span> = form.querySelector(<span class="hljs-string">'button[type="submit"]'</span>)<span class="hljs-comment">;</span>

form.addEventListener('submit', async (e) =&gt; {
  e.preventDefault()<span class="hljs-comment">;</span>
  <span class="hljs-attr">submitBtn.disabled</span> = <span class="hljs-literal">true</span><span class="hljs-comment">; // è¾…åŠ©ç¦ç”¨æŒ‰é’®</span>
  try {
    const <span class="hljs-attr">formData</span> = new FormData(form)<span class="hljs-comment">;</span>
    await fetch('/api/submit', { method: 'POST', body: formData })<span class="hljs-comment">;</span>
    alert('æäº¤æˆåŠŸ')<span class="hljs-comment">;</span>
  } catch (err) {
    alert('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•')<span class="hljs-comment">;</span>
    <span class="hljs-attr">submitBtn.disabled</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  }
}, { once: true })<span class="hljs-comment">; // æäº¤ä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤ç›‘å¬å™¨</span>
</code></pre>
<p>ç›¸æ¯”æ‰‹åŠ¨ç®¡ç†ç›‘å¬å™¨ï¼Œ<code>once</code> ä¸ä»…ç®€åŒ–ä»£ç ï¼Œè¿˜èƒ½é¿å…å› é€»è¾‘é—æ¼å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p>
<h4 data-id="heading-5">3. passiveï¼šæ‹¯æ•‘ç§»åŠ¨ç«¯æ»šåŠ¨æ€§èƒ½</h4>
<p>è¿™æ˜¯ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒçš„å…³é”®å‚æ•°ã€‚å½“ <code>passive: true</code> æ—¶ï¼Œæµè§ˆå™¨ä¼šæå‰çŸ¥é“ç›‘å¬å™¨**<code>preventDefault()</code>** <strong>ä¸ä¼šè°ƒç”¨</strong> ï¼Œä»è€Œæ— éœ€ç­‰å¾…ç›‘å¬å™¨æ‰§è¡Œå®Œæˆå°±èƒ½ç«‹å³å“åº”æ»šåŠ¨ï¼Œå½»åº•è§£å†³ç§»åŠ¨ç«¯æ»šåŠ¨å¡é¡¿é—®é¢˜ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šscrollã€touchstartã€wheelç­‰ä¸æ»šåŠ¨ç›¸å…³çš„äº‹ä»¶ï¼Œç›®å‰ä¸»æµæµè§ˆå™¨å·²é»˜è®¤å¯¹éƒ¨åˆ†äº‹ä»¶å¼€å¯passiveï¼Œä½†æ˜¾å¼å£°æ˜æ›´ç¨³å¦¥ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç§»åŠ¨ç«¯æ»šåŠ¨ç›‘å¬ä¼˜åŒ–</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> backToTop = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'backToTop'</span>);
  <span class="hljs-comment">// æ»šåŠ¨è¶…è¿‡300pxæ˜¾ç¤ºå›åˆ°é¡¶éƒ¨æŒ‰é’®</span>
  backToTop.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> &gt; <span class="hljs-number">300</span> ? <span class="hljs-string">'block'</span> : <span class="hljs-string">'none'</span>;
}, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// æ˜ç¡®å£°æ˜ä¸ä¼šé˜»æ­¢é»˜è®¤æ»šåŠ¨</span>

<span class="hljs-comment">// é”™è¯¯ç”¨æ³•ï¼špassiveä¸ºtrueæ—¶è°ƒç”¨preventDefaultä¼šæŠ¥é”™</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchmove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  e.<span class="hljs-title function_">preventDefault</span>(); <span class="hljs-comment">// æ§åˆ¶å°ä¼šæŠ›å‡ºè­¦å‘Š</span>
}, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h4 data-id="heading-6">4. signalï¼šç›‘å¬å™¨çš„"æ‰¹é‡ç®¡ç†å¼€å…³"</h4>
<p>è¿™æ˜¯è¾ƒæ–°çš„APIç‰¹æ€§ï¼ˆ2025å¹´å·²è¢«ä¸»æµæµè§ˆå™¨æ”¯æŒï¼‰ï¼Œé€šè¿‡ä¼ å…¥ <code>AbortSignal</code> å¯¹è±¡ï¼Œå¯å®ç°å¯¹ç›‘å¬å™¨çš„æ‰¹é‡ç§»é™¤æˆ–æ¡ä»¶æ€§å–æ¶ˆï¼Œå°¤å…¶é€‚åˆç»„ä»¶åŒ–å¼€å‘ä¸­"ç»„ä»¶å¸è½½æ—¶æ¸…ç†ç›‘å¬å™¨"çš„åœºæ™¯ã€‚</p>
<p><strong>å®ç°åŸç†</strong>ï¼šåˆ›å»º <code>AbortController</code> å®ä¾‹ï¼Œå…¶ <code>signal</code> å±æ€§ä¼ å…¥ç›‘å¬å™¨é…ç½®ï¼Œè°ƒç”¨ <code>abort()</code> æ–¹æ³•å³å¯è§¦å‘æ‰€æœ‰å…³è”ç›‘å¬å™¨çš„ç§»é™¤ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºæ§åˆ¶å™¨å®ä¾‹</span>
<span class="hljs-keyword">const</span> abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
<span class="hljs-keyword">const</span> { signal } = abortController;

<span class="hljs-comment">// ç»‘å®šå¤šä¸ªç›‘å¬å™¨ï¼Œå…±äº«åŒä¸€ä¸ªsignal</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll, { signal });
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize, { signal });
button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick, { signal });

<span class="hljs-comment">// ç»„ä»¶å¸è½½æ—¶æ‰¹é‡ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">destroyComponent</span>(<span class="hljs-params"/>) {
  abortController.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// ä¸€æ¬¡è°ƒç”¨ï¼Œæ‰€æœ‰å…³è”ç›‘å¬å™¨å¤±æ•ˆ</span>
}

<span class="hljs-comment">// æ¡ä»¶æ€§å–æ¶ˆï¼šæ¯”å¦‚3ç§’åè‡ªåŠ¨åœæ­¢ç›‘å¬æ»šåŠ¨</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  abortController.<span class="hljs-title function_">abort</span>(<span class="hljs-string">'è‡ªåŠ¨å–æ¶ˆç›‘å¬'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(signal.<span class="hljs-property">reason</span>); <span class="hljs-comment">// è¾“å‡º"è‡ªåŠ¨å–æ¶ˆç›‘å¬"</span>
}, <span class="hljs-number">3000</span>);
</code></pre>
<h3 data-id="heading-7">ä¸‰ã€ç»¼åˆå®æˆ˜ï¼šæ‰“é€ é«˜æ•ˆçš„åˆ—è¡¨äº¤äº’ç»„ä»¶</h3>
<p>ç»“åˆä¸Šè¿°å‚æ•°ç‰¹æ€§ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ª"å¯ç¼–è¾‘åˆ—è¡¨"ç»„ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼šç‚¹å‡»åˆ—è¡¨é¡¹å±•å¼€ç¼–è¾‘æ¡†ã€ç¼–è¾‘ç¡®è®¤æŒ‰é’®ä»…ç”Ÿæ•ˆä¸€æ¬¡ã€ç»„ä»¶é”€æ¯æ—¶æ¸…ç†æ‰€æœ‰ç›‘å¬å™¨ã€æ»šåŠ¨æ—¶é«˜äº®å½“å‰å¯è§†åŒºåŸŸåˆ—è¡¨é¡¹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EditableList</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">containerId</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(containerId);
    <span class="hljs-comment">// åˆ›å»ºç›‘å¬å™¨æ§åˆ¶å™¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. äº‹ä»¶å§”æ‰˜ç›‘å¬åˆ—è¡¨é¡¹ç‚¹å‡»ï¼ˆæ•è·é˜¶æ®µä¼˜åŒ–æ€§èƒ½ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">matches</span>(<span class="hljs-string">'.list-item'</span>)) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showEditBox</span>(e.<span class="hljs-property">target</span>);
      }
    }, { <span class="hljs-attr">capture</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">signal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span>.<span class="hljs-property">signal</span> });

    <span class="hljs-comment">// 2. æ»šåŠ¨ç›‘å¬ï¼šé«˜äº®å¯è§†åŒºåŸŸåˆ—è¡¨é¡¹ï¼ˆpassiveä¼˜åŒ–æ»šåŠ¨ï¼‰</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">highlightVisibleItems</span>();
    }, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">signal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span>.<span class="hljs-property">signal</span> });
  }

  <span class="hljs-title function_">showEditBox</span>(<span class="hljs-params">item</span>) {
    <span class="hljs-keyword">const</span> editBox = item.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.edit-box'</span>);
    <span class="hljs-keyword">const</span> confirmBtn = editBox.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.confirm-btn'</span>);
    editBox.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'block'</span>;

    <span class="hljs-comment">// 3. ç¡®è®¤æŒ‰é’®ä»…ç”Ÿæ•ˆä¸€æ¬¡ï¼ˆonceè‡ªåŠ¨ç§»é™¤ç›‘å¬å™¨ï¼‰</span>
    confirmBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> input = editBox.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'input'</span>);
      item.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.content'</span>).<span class="hljs-property">textContent</span> = input.<span class="hljs-property">value</span>;
      editBox.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
    }, { <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">signal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span>.<span class="hljs-property">signal</span> });
  }

  <span class="hljs-title function_">highlightVisibleItems</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å®ç°å¯è§†åŒºåŸŸåˆ¤æ–­é€»è¾‘...</span>
  }

  <span class="hljs-comment">// ç»„ä»¶é”€æ¯ï¼šæ‰¹é‡æ¸…ç†æ‰€æœ‰ç›‘å¬å™¨</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span>.<span class="hljs-title function_">abort</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">remove</span>();
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç»„ä»¶</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EditableList</span>(<span class="hljs-string">'list-container'</span>);
<span class="hljs-comment">// é¡µé¢å…³é—­æˆ–ç»„ä»¶å¸è½½æ—¶é”€æ¯</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-function">() =&gt;</span> list.<span class="hljs-title function_">destroy</span>());
</code></pre>
<h3 data-id="heading-8">å››ã€2025å¹´æœ€æ–°å…¼å®¹æ€§ä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-9">1. å…¼å®¹æ€§è¯´æ˜</h4>

































<table><thead><tr><th>å‚æ•°ç‰¹æ€§</th><th>Chrome</th><th>Firefox</th><th>Safari</th><th>Edge</th></tr></thead><tbody><tr><td>captureï¼ˆå¸ƒå°”å€¼ï¼‰</td><td>å…¨ç‰ˆæœ¬</td><td>å…¨ç‰ˆæœ¬</td><td>å…¨ç‰ˆæœ¬</td><td>å…¨ç‰ˆæœ¬</td></tr><tr><td>once/passive</td><td>49+</td><td>48+</td><td>10.1+</td><td>16+</td></tr><tr><td>signal</td><td>88+</td><td>91+</td><td>15.4+</td><td>88+</td></tr></tbody></table>
<p>å¯¹äºéœ€è¦å…¼å®¹æ—§æµè§ˆå™¨çš„åœºæ™¯ï¼Œå¯é€šè¿‡ <code>eventListenerOptionsPassive</code> ç­‰ç‰¹æ€§æ£€æµ‹å·¥å…·åšé™çº§å¤„ç†ã€‚</p>
<h4 data-id="heading-10">2. æœ€ä½³å®è·µæ€»ç»“</h4>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨<strong>é…ç½®å¯¹è±¡</strong>å½¢å¼ï¼Œæ›¿ä»£ä¼ ç»Ÿå¸ƒå°”å€¼ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§</li>
<li>ç§»åŠ¨ç«¯æ»šåŠ¨ç›¸å…³äº‹ä»¶å¿…åŠ  <code>passive: true</code>ï¼Œæå‡æ»šåŠ¨æµç•…åº¦</li>
<li>ä¸€æ¬¡æ€§æ“ä½œï¼ˆå¦‚è¡¨å•æäº¤ã€å¼•å¯¼å¼¹çª—ï¼‰ç”¨ <code>once: true</code>ï¼Œç®€åŒ–ç›‘å¬å™¨ç®¡ç†</li>
<li>ç»„ä»¶åŒ–å¼€å‘ä¸­ï¼Œç”¨ <code>signal</code> å®ç°ç›‘å¬å™¨æ‰¹é‡æ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼</li>
<li>äº‹ä»¶å§”æ‰˜åœºæ™¯ä¸­ï¼Œåˆç†åˆ©ç”¨ <code>capture</code> é˜¶æ®µä¼˜åŒ–äº‹ä»¶å“åº”é¡ºåº</li>
</ul>
<h3 data-id="heading-11">äº”ã€ç»“è¯­</h3>
<p>addEventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä»ç®€å•çš„å¸ƒå°”å€¼è¿›åŒ–ä¸ºåŠŸèƒ½ä¸°å¯Œçš„é…ç½®å¯¹è±¡ï¼ŒèƒŒåæ˜¯Webæ ‡å‡†å¯¹å¼€å‘æ•ˆç‡ä¸æ€§èƒ½ä¼˜åŒ–çš„ä¸æ–­è¿½æ±‚ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¹¶éä¸ä¼šç”¨APIï¼Œè€Œæ˜¯å¿½ç•¥äº†å®ƒçš„è¿›é˜¶èƒ½åŠ›ã€‚åˆç†è¿ç”¨ <code>capture</code>ã€<code>once</code>ã€<code>passive</code>ã€<code>signal</code> è¿™äº›ç‰¹æ€§ï¼Œèƒ½è®©æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†ä»£ç æ›´ç®€æ´ã€æ€§èƒ½æ›´ä¼˜å¼‚ã€‚ä¸‹æ¬¡ç»‘å®šäº‹ä»¶æ—¶ï¼Œåˆ«å†å¿½ç•¥è¿™ä¸ª"å°è€Œå¼ºå¤§"çš„å‚æ•°äº†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ â€” Linuxä¸­å¦‚ä½•æŸ¥çœ‹æŸä¸ªç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575718948298047539</link>    <guid>https://juejin.cn/post/7575718948298047539</guid>    <pubDate>2025-11-24T02:58:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575718948298047539" data-draft-id="7575457788664250420" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ â€” Linuxä¸­å¦‚ä½•æŸ¥çœ‹æŸä¸ªç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Linux"/> <meta itemprop="datePublished" content="2025-11-24T02:58:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Cyan_RA9"/> <meta itemprop="url" content="https://juejin.cn/user/156585427741979"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ â€” Linuxä¸­å¦‚ä½•æŸ¥çœ‹æŸä¸ªç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/156585427741979/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Cyan_RA9
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:58:59.000Z" title="Mon Nov 24 2025 02:58:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>Author</strong> : Cyan_RA9<br/>
<strong>Source</strong> : ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fnotes.kamacoder.com%2F" target="_blank" title="https://notes.kamacoder.com/" ref="nofollow noopener noreferrer">å¡ç ç¬”è®°</a>ã€‘ç½‘ç«™<br/>
<strong>Question</strong> : Linuxä¸­å¦‚ä½•æŸ¥çœ‹æŸä¸ªç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Ÿ</p>
</blockquote>
<h2 data-id="heading-0">ã€ç®€è¦å›ç­”ã€‘</h2>
<ul>
<li>åœ¨Linuxä¸­ï¼ŒæŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨çš„æ–¹æ³•æŒ‰åœºæ™¯å¯åˆ†ä¸ºï¼š
<ol>
<li><strong>å¿«é€Ÿæ£€æŸ¥ç«¯å£æ˜¯å¦è¢«ç›‘å¬</strong>ï¼š<code>ss -tuln | grep :[ç«¯å£å·]</code> æˆ– <code>netstat -tuln | grep :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>å®šä½ç›‘å¬ç«¯å£çš„è¿›ç¨‹</strong>ï¼š<code>sudo lsof -i :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>å…¨é¢æŸ¥çœ‹ç«¯å£æ‰€æœ‰è¿æ¥çŠ¶æ€åŠè¿›ç¨‹</strong>ï¼š<code>sudo ss -taunp | grep :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>éªŒè¯ç«¯å£å¯¹å¤–å¼€æ”¾æ€§</strong>ï¼š<code>nmap -sT -p [ç«¯å£å·] localhost</code> æˆ– <code>telnet localhost [ç«¯å£å·]</code>ã€‚</li>
</ol>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">ã€è¯¦ç»†å›ç­”ã€‘</h2>
<ol>
<li><strong>å¿«é€Ÿæ£€æŸ¥ç«¯å£æ˜¯å¦è¢«ç›‘å¬</strong>ï¼š
<ul>
<li><strong>å‘½ä»¤</strong>ï¼š<code>ss -tuln | grep :[ç«¯å£å·]</code> æˆ– <code>netstat -tuln | grep :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>å‚æ•°è§£æ</strong>ï¼š<br/>
â‘  <strong>-t</strong>ï¼šæ£€æŸ¥TCPåè®®ç«¯å£ã€‚<br/>
â‘¡ <strong>-u</strong>ï¼šæ£€æŸ¥UDPåè®®ç«¯å£ã€‚<br/>
â‘¢ <strong>-l</strong>ï¼š<strong>ä»…</strong>æ˜¾ç¤ºç›‘å¬çŠ¶æ€ï¼ˆ<strong>LISTEN</strong>ï¼‰çš„ç«¯å£ã€‚<br/>
â‘£ <strong>-n</strong>ï¼šç¦ç”¨åŸŸåè§£æï¼Œç›´æ¥æ˜¾ç¤ºIPå’Œç«¯å£å·ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¿«é€ŸéªŒè¯æŸä¸ªç«¯å£æ˜¯å¦æ­£åœ¨ç­‰å¾…æ–°çš„è¿æ¥è¯·æ±‚ï¼ˆå³å¤„äº LISTEN çŠ¶æ€ï¼‰ã€‚è¿™æ˜¯å¯åŠ¨æœåŠ¡å‰æœ€å¸¸è§çš„æ£€æŸ¥ã€‚</li>
</ul>
</li>
<li><strong>å®šä½ç›‘å¬ç«¯å£çš„è¿›ç¨‹</strong>ï¼š
<ul>
<li>
<p><strong>å‘½ä»¤</strong>ï¼š<code>sudo lsof -i :[ç«¯å£å·]</code>ã€‚</p>
</li>
<li>
<p><strong>è¾“å‡ºç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">COMMAND  PID  <span class="hljs-keyword">USER</span>   FD   TYPE DEVICE SIZE<span class="hljs-operator">/</span>OFF NODE NAME  
nginx    <span class="hljs-number">1234</span> root    <span class="hljs-number">6</span>u  IPv4 <span class="hljs-number">123456</span>      <span class="hljs-number">0</span>t0  TCP <span class="hljs-operator">*</span>:<span class="hljs-number">80</span> (LISTEN)  
</code></pre>
</li>
<li>
<p><strong>å…³é”®ä¿¡æ¯</strong>ï¼š<br/>
â‘  <strong>COMMAND</strong>ï¼šè¿›ç¨‹åç§°ï¼ˆå¦‚nginxï¼‰ã€‚<br/>
â‘¡ <strong>PID</strong>ï¼šè¿›ç¨‹IDï¼ˆå¦‚1234ï¼‰ã€‚<br/>
â‘¢ <strong>USER</strong>ï¼šè¿è¡Œè¿›ç¨‹çš„ç”¨æˆ·ï¼ˆå¦‚rootï¼‰ã€‚</p>
</li>
<li>
<p><strong>æƒé™è¯´æ˜</strong>ï¼šæ™®é€šç”¨æˆ·å¯èƒ½æ— æ³•æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ï¼Œéœ€ä½¿ç”¨ <strong>sudo</strong> ææƒã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåœ¨ç¡®è®¤ç«¯å£å¤„äºç›‘å¬çŠ¶æ€åï¼Œç²¾ç¡®æ‰¾å‡ºæ˜¯å“ªä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨è¯¥ç«¯å£ã€‚lsof æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œä¸ä»…èƒ½çœ‹ç½‘ç»œè¿æ¥ï¼Œè¿˜èƒ½çœ‹æ–‡ä»¶å¥æŸ„ã€‚</p>
</li>
</ul>
</li>
<li><strong>å…¨é¢æŸ¥çœ‹ç«¯å£æ‰€æœ‰è¿æ¥çŠ¶æ€åŠè¿›ç¨‹</strong>ï¼š
<ul>
<li><strong>å‘½ä»¤</strong>ï¼š<code>sudo ss -taunp | grep :[ç«¯å£å·]</code> æˆ– <code>sudo netstat -taunp | grep :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>å‚æ•°è§£æ</strong>ï¼š<br/>
â‘  <strong>-t</strong>ï¼šæ£€æŸ¥TCPåè®®ç«¯å£ã€‚<br/>
â‘¡ <strong>-u</strong>ï¼šæ£€æŸ¥UDPåè®®ç«¯å£ã€‚<br/>
â‘¢ <strong>-a</strong>: æ˜¾ç¤ºæ‰€æœ‰è¿æ¥ï¼ˆåŒ…æ‹¬ç›‘å¬ã€å·²å»ºç«‹ã€ç­‰å¾…ç­‰å„ç§çŠ¶æ€ï¼‰ã€‚<br/>
â‘¢ <strong>-n</strong>ï¼šç¦ç”¨åŸŸåè§£æï¼Œç›´æ¥æ˜¾ç¤ºIPå’Œç«¯å£å·ã€‚<br/>
â‘£ <strong>-p</strong>: æ˜¾ç¤ºä½¿ç”¨ç«¯å£çš„è¿›ç¨‹IDå’Œåç§°ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€è¦äº†è§£æŸä¸ªç«¯å£å½“å‰æ‰€æœ‰è¿æ¥çŠ¶æ€ï¼ˆLISTENã€ESTABLISHEDã€TIME_WAITã€CLOSE_WAITç­‰ï¼‰ä»¥åŠå…·ä½“æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨å®ƒï¼Œè¿›è¡Œæ›´å…¨é¢çš„åˆ†æã€‚</li>
</ul>
</li>
<li><strong>éªŒè¯ç«¯å£å¯¹å¤–å¼€æ”¾æ€§</strong>ï¼š
<ul>
<li><strong>å‘½ä»¤</strong>ï¼š<code>nmap -sT -p [ç«¯å£å·] localhost</code> æˆ– <code>telnet localhost [ç«¯å£å·]</code>ã€‚</li>
<li><strong><code>namp</code>å‚æ•°åˆ†è§£</strong>ï¼š<br/>
â‘  <strong>-sT</strong>ï¼šTCP å…¨è¿æ¥æ‰«æï¼ˆæ¨¡æ‹Ÿæ­£å¸¸è¿æ¥è¡Œä¸ºï¼Œæ›´å¯é ï¼‰ï¼›<br/>
â‘¡ <strong>-p</strong>ï¼šæŒ‡å®šæ‰«æçš„ç«¯å£å·ã€‚</li>
<li><strong><code>namp</code>è¾“å‡ºçŠ¶æ€</strong>ï¼š<br/>
â‘  <strong>open</strong>ï¼šç«¯å£å¼€æ”¾ä¸”å¯è®¿é—®ï¼›<br/>
â‘¡ <strong>closed</strong>ï¼šç«¯å£æœªè¢«å ç”¨ï¼›<br/>
â‘¢ <strong>filtered</strong>ï¼šç«¯å£è¢«é˜²ç«å¢™æ‹¦æˆªã€‚æ— æ³•ç¡®å®šå…¶çŠ¶æ€ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ã€çŸ¥è¯†æ‹“å±•ã€‘</h2>
<ol>
<li>
<p><strong>æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨çš„ä¸»è¦æ‰‹æ®µ</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59ed636cd4174b5b910019377fde8fbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3lhbl9SQTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557939&amp;x-signature=Il3GMndAm6pTdAS0SxLV%2FocRNKs%3D" alt="methods_detect_port.jpg" loading="lazy"/></p>
</li>
<li>
<p><strong>å·¥å…·å¯¹æ¯”ï¼šss vs netstat</strong>ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>

























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>ss</strong></th><th><strong>netstat</strong></th></tr></thead><tbody><tr><td><strong>æ•°æ®æ¥æº</strong></td><td>ç›´æ¥è¯»å–å†…æ ¸socketè¡¨</td><td>è§£æ<code>/proc/net</code>æ–‡ä»¶</td></tr><tr><td><strong>é€Ÿåº¦</strong></td><td>æ›´å¿«ï¼ˆé€‚åˆé«˜è´Ÿè½½æœåŠ¡å™¨ï¼‰</td><td>è¾ƒæ…¢</td></tr><tr><td><strong>ç»´æŠ¤çŠ¶æ€</strong></td><td>æ´»è·ƒç»´æŠ¤ï¼ˆæ¨èä½¿ç”¨ï¼‰</td><td>å·²é€æ­¥æ·˜æ±°</td></tr></tbody></table>
</li>
<li>
<p>ç«¯å£çŠ¶æ€è§£æï¼ˆ<code>ss</code>/<code>netstat</code>è¾“å‡ºï¼‰:</p>
<ul>
<li><strong>LISTEN</strong>ï¼šç«¯å£æ­£åœ¨ç›‘å¬ï¼Œç­‰å¾…è¿æ¥ã€‚</li>
<li><strong>ESTABLISHED</strong>ï¼šå·²å»ºç«‹æ´»è·ƒè¿æ¥ã€‚</li>
<li><strong>TIME_WAIT</strong>ï¼šè¿æ¥å·²å…³é—­ï¼Œç­‰å¾…å†…æ ¸æ¸…ç†ï¼ˆå¯èƒ½çŸ­æš‚å ç”¨ç«¯å£ï¼‰ã€‚</li>
<li><strong>CLOSE_WAIT</strong>ï¼šè¿œç¨‹å·²å…³é—­è¿æ¥ï¼Œæœ¬åœ°æœªé‡Šæ”¾ã€‚</li>
</ul>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[7ã€ä¿å­˜ç•Œé¢çŠ¶æ€]]></title>    <link>https://juejin.cn/post/7575425466905641023</link>    <guid>https://juejin.cn/post/7575425466905641023</guid>    <pubDate>2025-11-23T16:08:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575425466905641023" data-draft-id="7575468252656500777" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="7ã€ä¿å­˜ç•Œé¢çŠ¶æ€"/> <meta itemprop="keywords" content="Kotlin"/> <meta itemprop="datePublished" content="2025-11-23T16:08:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å± å¤«"/> <meta itemprop="url" content="https://juejin.cn/user/1533159252166510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            7ã€ä¿å­˜ç•Œé¢çŠ¶æ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1533159252166510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å± å¤«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:08:13.000Z" title="Sun Nov 23 2025 16:08:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¿å­˜ç•Œé¢çŠ¶æ€</h3>
<p>åœ¨ Jetpack Compose åº”ç”¨ä¸­ï¼Œæ­£ç¡®ä¿å­˜å’Œæ¢å¤ç•Œé¢çŠ¶æ€å¯¹äºæä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚å½“åº”ç”¨å› é‡æ–°åˆ›å»º activity æˆ–è¿›ç¨‹è€Œä¸¢å¤±ç•Œé¢çŠ¶æ€æ—¶ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°æ•°æ®ä¸¢å¤±æˆ–ç•Œé¢ä¸ä¸€è‡´çš„é—®é¢˜ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Jetpack Compose ä¸­ä¿å­˜å’Œæ¢å¤ç•Œé¢çŠ¶æ€ã€‚</p>
<hr/>
<h3 data-id="heading-1"><strong>1. ç•Œé¢çŠ¶æ€ä¸¢å¤±çš„åŸå› </strong></h3>
<p>Android åº”ç”¨å¯èƒ½ä¼šå› ä»¥ä¸‹äº‹ä»¶è€Œä¸¢å¤±ç•Œé¢çŠ¶æ€ï¼š</p>
<ul>
<li><strong>ç³»ç»Ÿå‘èµ·çš„è¿›ç¨‹ç»ˆæ­¢</strong>ï¼šå¦‚å†…å­˜ä¸è¶³æ—¶ç³»ç»Ÿæ€æ‰è¿›ç¨‹ã€‚</li>
<li><strong>é…ç½®æ›´æ”¹</strong>ï¼šå¦‚å±å¹•æ—‹è½¬ã€è¯­è¨€åˆ‡æ¢ç­‰ã€‚</li>
<li><strong>ç”¨æˆ·å‘èµ·çš„è¿›ç¨‹ç»ˆæ­¢</strong>ï¼šå¦‚ç”¨æˆ·æ˜¾å¼å…³é—­åº”ç”¨ã€‚</li>
</ul>
<p>å¯¹äºç”¨æˆ·å‘èµ·çš„è¿›ç¨‹ç»ˆæ­¢ï¼Œç¬æ—¶çŠ¶æ€çš„ä¸¢å¤±é€šå¸¸æ˜¯åˆç†çš„ã€‚ä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä¿ç•™çŠ¶æ€å¯¹äºæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚</p>
<hr/>
<h3 data-id="heading-2"><strong>2. ä¿å­˜ç•Œé¢çŠ¶æ€çš„ç­–ç•¥</strong></h3>
<p>æ ¹æ®çŠ¶æ€æå‡çš„ä½ç½®å’Œæ‰€éœ€çš„é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ API æ¥ä¿å­˜å’Œæ¢å¤ç•Œé¢çŠ¶æ€ã€‚</p>
<h4 data-id="heading-3"><strong>2.1 ç•Œé¢é€»è¾‘ä¸­çš„çŠ¶æ€ä¿å­˜</strong></h4>
<p>å½“çŠ¶æ€åœ¨ç•Œé¢é€»è¾‘ä¸­æå‡æ—¶ï¼ˆæ— è®ºæ˜¯åœ¨å¯ç»„åˆå‡½æ•°è¿˜æ˜¯ä½œç”¨åŸŸé™å®šä¸ºç»„åˆçš„æ™®é€šçŠ¶æ€å®¹å™¨ç±»ä¸­ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>rememberSaveable</code> åœ¨é‡æ–°åˆ›å»º activity å’Œè¿›ç¨‹ä¹‹åä¿ç•™çŠ¶æ€ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼šä¿å­˜å•ä¸ªå¸ƒå°”å€¼ç•Œé¢å…ƒç´ çŠ¶æ€</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ChatBubble</span><span class="hljs-params">(message: <span class="hljs-type">Message</span>)</span></span> {
    <span class="hljs-keyword">var</span> showDetails <span class="hljs-keyword">by</span> rememberSaveable { mutableStateOf(<span class="hljs-literal">false</span>) }
    ClickableText(
        text = AnnotatedString(message.content),
        onClick = { showDetails = !showDetails }
    )
    <span class="hljs-keyword">if</span> (showDetails) {
        Text(message.timestamp)
    }
}
</code></pre>
<p><strong>å­˜å‚¨æœºåˆ¶</strong>ï¼š</p>
<ul>
<li><code>rememberSaveable</code> é€šè¿‡ä¿å­˜çš„å®ä¾‹çŠ¶æ€æœºåˆ¶å°†ç•Œé¢å…ƒç´ çŠ¶æ€å­˜å‚¨åœ¨ Bundle ä¸­ã€‚</li>
<li>å®ƒèƒ½å¤Ÿè‡ªåŠ¨å°†åŸºå…ƒç±»å‹å­˜å‚¨åˆ° Bundle ä¸­ã€‚å¯¹äºéåŸºå…ƒç±»å‹ï¼ˆå¦‚æ•°æ®ç±»ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>Parcelize</code> æ³¨è§£ã€<code>listSaver</code> å’Œ <code>mapSaver</code> ç­‰ Compose APIï¼Œæˆ–å®ç°è‡ªå®šä¹‰çš„ <code>Saver</code> ç±»ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼šä¿å­˜ <code>LazyListState</code></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">rememberLazyListState</span><span class="hljs-params">(
    initialFirstVisibleItemIndex: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,
    initialFirstVisibleItemScrollOffset: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>
)</span></span>: LazyListState {
    <span class="hljs-keyword">return</span> rememberSaveable(saver = LazyListState.Saver) {
        LazyListState(initialFirstVisibleItemIndex, initialFirstVisibleItemScrollOffset)
    }
}
</code></pre>
<h4 data-id="heading-4"><strong>2.2 ä¸šåŠ¡é€»è¾‘ä¸­çš„çŠ¶æ€ä¿å­˜</strong></h4>
<p>å½“ç•Œé¢å…ƒç´ çŠ¶æ€å› ä¸šåŠ¡é€»è¾‘éœ€è¦è¢«æå‡åˆ° ViewModel æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ ViewModel çš„ API æ¥ä¿å­˜çŠ¶æ€ã€‚</p>
<p><strong>ViewModel çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ViewModel å®ä¾‹åœ¨é…ç½®æ›´æ”¹ï¼ˆå¦‚å±å¹•æ—‹è½¬ï¼‰åä»ç„¶å­˜åœ¨ï¼Œå› æ­¤æå‡åˆ° ViewModel çš„ç•Œé¢çŠ¶æ€ä¼šä¿ç•™åœ¨å†…å­˜ä¸­ã€‚</li>
<li>ä½† ViewModel å®ä¾‹åœ¨ç³»ç»Ÿå‘èµ·çš„è¿›ç¨‹ç»ˆæ­¢åå°†å¤±æ•ˆã€‚ä¸ºäº†æŒä¹…åŒ–çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <code>SavedStateHandle</code>ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼šä½¿ç”¨ <code>SavedStateHandle</code> ä¿å­˜ç•Œé¢å…ƒç´ çŠ¶æ€</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConversationViewModel</span>(savedStateHandle: SavedStateHandle) : ViewModel() {
    <span class="hljs-keyword">var</span> message <span class="hljs-keyword">by</span> savedStateHandle.saveable(stateSaver = TextFieldValue.Saver) {
        mutableStateOf(TextFieldValue(<span class="hljs-string">""</span>))
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">update</span><span class="hljs-params">(newMessage: <span class="hljs-type">TextFieldValue</span>)</span></span> {
        message = newMessage
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserInput</span><span class="hljs-params">(viewModel: <span class="hljs-type">ConversationViewModel</span> = viewModel()</span></span>) {
    TextField(
        value = viewModel.message,
        onValueChange = { viewModel.update(it) }
    )
}
</code></pre>
<p><strong><code>SavedStateHandle</code> çš„ API</strong>ï¼š</p>
<ul>
<li><strong><code>saveable</code> API</strong>ï¼šä»¥ <code>MutableState</code> å½¢å¼è¯»å–å’Œå†™å…¥ç•Œé¢å…ƒç´ çŠ¶æ€ï¼Œæ”¯æŒåŸºå…ƒç±»å‹å’Œè‡ªå®šä¹‰ <code>Saver</code>ã€‚</li>
<li><strong><code>getStateFlow</code> API</strong>ï¼šå­˜å‚¨ç•Œé¢å…ƒç´ çŠ¶æ€ï¼Œå¹¶å°†å…¶ç”¨ä½œæ¥è‡ª <code>SavedStateHandle</code> çš„æ•°æ®æµã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5"><strong>3. æœ€ä½³å®è·µ</strong></h3>
<h4 data-id="heading-6"><strong>3.1 ç•Œé¢é€»è¾‘ä¸­çš„æœ€ä½³å®è·µ</strong></h4>
<ul>
<li><strong>é¿å…å­˜å‚¨å¤§å‹å¯¹è±¡</strong>ï¼š<code>rememberSaveable</code> ä½¿ç”¨ Bundle å­˜å‚¨ç•Œé¢çŠ¶æ€ï¼ŒBundle å¤§å°æœ‰é™ã€‚å­˜å‚¨å¤§å‹å¤æ‚å¯¹è±¡æˆ–å¯¹è±¡åˆ—è¡¨å¯èƒ½ä¼šå¯¼è‡´ <code>TransactionTooLargeException</code>ã€‚</li>
<li><strong>å­˜å‚¨æœ€å°‘å¿…éœ€çŠ¶æ€</strong>ï¼šä»…å­˜å‚¨æ¢å¤ç•Œé¢çŠ¶æ€æ‰€éœ€çš„æœ€å°‘æ•°æ®ï¼ˆå¦‚ ID æˆ–é”®ï¼‰ï¼Œå¹¶ä½¿ç”¨è¿™äº›æ•°æ®ä»æ•°æ®å±‚é‡æ–°ç”Ÿæˆå¤æ‚çŠ¶æ€ã€‚</li>
</ul>
<h4 data-id="heading-7"><strong>3.2 ä¸šåŠ¡é€»è¾‘ä¸­çš„æœ€ä½³å®è·µ</strong></h4>
<ul>
<li><strong>ä½¿ç”¨ <code>SavedStateHandle</code> å­˜å‚¨ç®€å•çŠ¶æ€</strong>ï¼š<code>SavedStateHandle</code> ä¹Ÿä½¿ç”¨ Bundle æœºåˆ¶ï¼Œå› æ­¤åº”ä»…ç”¨äºå­˜å‚¨ç®€å•çš„ç•Œé¢å…ƒç´ çŠ¶æ€ã€‚</li>
<li><strong>å¤æ‚çŠ¶æ€ä½¿ç”¨æ°¸ä¹…æ€§å­˜å‚¨</strong>ï¼šå±å¹•ç•Œé¢çŠ¶æ€å¯èƒ½éå¸¸å¤æ‚ä¸”åºå¤§ï¼Œä¸åº”å­˜å‚¨åœ¨ <code>SavedStateHandle</code> ä¸­ã€‚å¯ä»¥ä½¿ç”¨æœ¬åœ°æ°¸ä¹…æ€§å­˜å‚¨ï¼ˆå¦‚ Room æ•°æ®åº“ï¼‰æ¥å­˜å‚¨å¤æ‚æ•°æ®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>4. éªŒè¯çŠ¶æ€æ¢å¤</strong></h3>
<p>ä¸ºäº†éªŒè¯é‡æ–°åˆ›å»º activity æˆ–è¿›ç¨‹åï¼ŒCompose å…ƒç´ ä¸­ä½¿ç”¨ <code>rememberSaveable</code> å­˜å‚¨çš„çŠ¶æ€æ˜¯å¦å·²æ­£ç¡®æ¢å¤ï¼Œå¯ä»¥ä½¿ç”¨ <code>StateRestorationTester</code>ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼šä½¿ç”¨ <code>StateRestorationTester</code> éªŒè¯çŠ¶æ€æ¢å¤</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testStateRestoration</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> tester = StateRestorationTester(context)
    tester.setContent {
        <span class="hljs-keyword">val</span> (value, setValue) = rememberSaveable { mutableStateOf(<span class="hljs-number">0</span>) }
        <span class="hljs-comment">// Test logic here</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-9"><strong>5. æ€»ç»“</strong></h3>
<ul>
<li><strong>ç•Œé¢é€»è¾‘ä¸­çš„çŠ¶æ€</strong>ï¼šä½¿ç”¨ <code>rememberSaveable</code> åœ¨é‡æ–°åˆ›å»º activity å’Œè¿›ç¨‹åä¿ç•™çŠ¶æ€ã€‚</li>
<li><strong>ä¸šåŠ¡é€»è¾‘ä¸­çš„çŠ¶æ€</strong>ï¼šå¦‚æœçŠ¶æ€è¢«æå‡åˆ° ViewModelï¼Œä½¿ç”¨ <code>SavedStateHandle</code> ä¿å­˜çŠ¶æ€ã€‚</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šé¿å…åœ¨ Bundle ä¸­å­˜å‚¨å¤§å‹å¤æ‚å¯¹è±¡ï¼Œå­˜å‚¨æœ€å°‘å¿…éœ€çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨æ°¸ä¹…æ€§å­˜å‚¨å¤„ç†å¤æ‚æ•°æ®ã€‚</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨è¿™äº› API å’Œæœ€ä½³å®è·µï¼Œå¯ä»¥ç¡®ä¿ Jetpack Compose åº”ç”¨åœ¨é¢å¯¹é…ç½®æ›´æ”¹å’Œè¿›ç¨‹ç»ˆæ­¢æ—¶ä¿æŒä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ Flutter + BLoC å†™ä¸€ä¸ªé¡ºæ‰‹çš„æ¶‚é¸¦ç”»æ¿ï¼ˆæ”¯æŒæ’¤é”€ / é‡åš / æ©¡çš®æ“¦ / ä¿å­˜ç›¸å†Œï¼‰]]></title>    <link>https://juejin.cn/post/7575182522411925542</link>    <guid>https://juejin.cn/post/7575182522411925542</guid>    <pubDate>2025-11-23T16:09:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575182522411925542" data-draft-id="7575469988736483337" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ Flutter + BLoC å†™ä¸€ä¸ªé¡ºæ‰‹çš„æ¶‚é¸¦ç”»æ¿ï¼ˆæ”¯æŒæ’¤é”€ / é‡åš / æ©¡çš®æ“¦ / ä¿å­˜ç›¸å†Œï¼‰"/> <meta itemprop="keywords" content="Android,iOS,Flutter"/> <meta itemprop="datePublished" content="2025-11-23T16:09:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Daniel02"/> <meta itemprop="url" content="https://juejin.cn/user/2277843825853511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ Flutter + BLoC å†™ä¸€ä¸ªé¡ºæ‰‹çš„æ¶‚é¸¦ç”»æ¿ï¼ˆæ”¯æŒæ’¤é”€ / é‡åš / æ©¡çš®æ“¦ / ä¿å­˜ç›¸å†Œï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843825853511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Daniel02
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:09:49.000Z" title="Sun Nov 23 2025 16:09:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹æˆ‘æœ€è¿‘ç”¨ Flutter å†™çš„ä¸€ä¸ªå°ç©å…·ï¼š<strong>æ¶‚é¸¦ç”»æ¿</strong>ã€‚ä½†æŠŠä¸€å¥—å®Œæ•´çš„äº¤äº’é“¾è·¯ä¸²èµ·æ¥è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå¾ˆé€‚åˆä½œä¸º Flutter ç»ƒæ‰‹é¡¹ç›®ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€é¡¹ç›®èƒŒæ™¯ &amp; åŠŸèƒ½æ¦‚è§ˆ</h2>
<p>è¿™æ˜¯ä¸€ä¸ªåŸºäº <strong>Flutter + BLoC</strong> çš„å°å‹æ¶‚é¸¦ç”»æ¿åº”ç”¨ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>âœï¸ æ”¯æŒæ‰‹å†™ç¬”è¿¹ï¼ˆåŸºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fperfect_freehand" target="_blank" title="https://pub.dev/packages/perfect_freehand" ref="nofollow noopener noreferrer"><code>perfect_freehand</code></a>ï¼‰</li>
<li>â†©ï¸ æ’¤é”€ / â†ªï¸ é‡åš</li>
<li>ğŸ§½ æ©¡çš®æ“¦æ¨¡å¼ï¼ˆé•¿æŒ‰ä¸€é”®æ¸…ç©ºï¼‰</li>
<li>ğŸš ç¬”åˆ·ç²—ç»†è°ƒèŠ‚</li>
<li>ğŸ¨ é¢œè‰²é€‰æ‹©å™¨</li>
<li>ğŸŒˆ æ¸å˜èƒŒæ™¯ç”»å¸ƒ</li>
<li>ğŸ’¾ ä¸€é”®ä¿å­˜åˆ°ç³»ç»Ÿç›¸å†Œ</li>
</ul>
<p>æ•´ä½“ç›®æ ‡æ˜¯ï¼š<strong>åœ¨ä¸ä¾èµ–åŸç”Ÿ View çš„å‰æä¸‹ï¼Œç”¨çº¯ Flutter å†™å‡ºä¸€ä¸ªä½“éªŒé¡ºæ»‘ã€ç»“æ„æ¸…æ™°ã€æ–¹ä¾¿æ‰©å±•çš„ç”»æ¿ç»„ä»¶</strong>ã€‚</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d50e5f09d2e0482db0daa7a397458ba0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGFuaWVsMDI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518989&amp;x-signature=6bkhKHgUtrvBqbbBrfKzzlfETdc%3D" alt="" width="200" height="400" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e69d02f25ae4daaa48ad932ed165925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGFuaWVsMDI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518989&amp;x-signature=%2BRzAKk5XYexwVYRYO3y%2FNh30Qmo%3D" alt="" width="200" height="400" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccf4b5a13c014e80a4fae53ffd643c5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGFuaWVsMDI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518989&amp;x-signature=CtRSISXFr5B0MIu5TcWHdUIYE1Y%3D" alt="" width="200" height="400" loading="lazy"/>
<hr/>
<h2 data-id="heading-1">äºŒã€æ•´ä½“æ¶æ„è®¾è®¡</h2>
<p>é¡¹ç›®å¤§è‡´æ‹†æˆå‡ å—ï¼š</p>
<ul>
<li><code>Painting</code> é¡µé¢ï¼š
<ul>
<li>è´Ÿè´£å¸ƒå±€ï¼ˆç”»å¸ƒ + é¡¶éƒ¨å·¥å…·æ  + å·¦ä¾§ç²—ç»†æ»‘å— + åº•éƒ¨é¢œè‰²æ¡ï¼‰</li>
<li>è´Ÿè´£æ‰‹åŠ¿é‡‡é›†ï¼ˆ<code>GestureDetector</code>ï¼‰</li>
</ul>
</li>
<li><code>PaintingBloc</code>ï¼š
<ul>
<li>ç®¡ç†æ‰€æœ‰ç»˜å›¾ç›¸å…³çŠ¶æ€ï¼ˆçº¿æ¡åˆ—è¡¨ã€å½“å‰é¢œè‰²ã€å½“å‰ç²—ç»†ã€æ©¡çš®æ“¦æ¨¡å¼ã€æ’¤é”€æ ˆç­‰ï¼‰</li>
</ul>
</li>
<li><code>PaintingModel</code>ï¼š
<ul>
<li>æè¿°ä¸€æ¡ç¬”ç”»ï¼ˆç‚¹é›†åˆã€é¢œè‰²ã€ç²—ç»†ã€æ˜¯å¦æ©¡çš®æ“¦ç­‰ï¼‰</li>
</ul>
</li>
<li><code>Sketcher</code>ï¼š
<ul>
<li><code>CustomPainter</code>ï¼Œè´Ÿè´£çœŸæ­£æŠŠæ‰€æœ‰ç¬”ç”»ç”»åˆ° <code>Canvas</code> ä¸Š</li>
</ul>
</li>
<li>ä¸€äº› UI ç»„ä»¶ï¼š
<ul>
<li><code>Toptools</code> é¡¶éƒ¨å·¥å…·æ ï¼ˆæ’¤é”€ / é‡åš / æ©¡çš®æ“¦ / ä¿å­˜ï¼‰</li>
<li><code>SizeSliderWidget</code> å·¦ä¾§ç¬”åˆ·ç²—ç»†è°ƒèŠ‚</li>
<li><code>ColorSelector</code> åº•éƒ¨é¢œè‰²æ¡</li>
</ul>
</li>
<li><code>takePicture</code> æœåŠ¡ï¼š
<ul>
<li>åŸºäº <code>RepaintBoundary.toImage</code> æˆªå–ç”»å¸ƒ</li>
<li>ä½¿ç”¨ <code>flutter_image_compress</code> å‹ç¼©</li>
<li>ä½¿ç”¨ <code>ImageGallerySaverPlus</code> ä¿å­˜åˆ°ç›¸å†Œ</li>
</ul>
</li>
</ul>
<p><strong>æ•°æ®æµ</strong>å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºï¼š</p>
<blockquote>
<p>æ‰‹åŠ¿äº‹ä»¶ â†’ æ´¾å‘ BLoC Event â†’ æ›´æ–° PaintingState â†’ è§¦å‘é‡ç»˜ <code>CustomPaint</code> â†’ ç”¨æˆ·çœ‹åˆ°æœ€æ–°ç¬”è¿¹</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€æ•°æ®æ¨¡å‹ä¸çŠ¶æ€ç®¡ç†</h2>
<h3 data-id="heading-3">1. ç¬”ç”»æ•°æ®æ¨¡å‹ <code>PaintingModel</code></h3>
<p>æ¯ä¸€ç¬”æŠ½è±¡æˆä¸€ä¸ªæ¨¡å‹ï¼Œæ ¸å¿ƒä¿¡æ¯ï¼š</p>
<ul>
<li>ä¸€ä¸²ç‚¹ <code>points</code></li>
<li>ç¬”åˆ·ç²—ç»† <code>size</code></li>
<li>é¢œè‰² <code>lineColor</code></li>
<li>æ˜¯å¦ä¸ºæ©¡çš®æ“¦ <code>isEraser</code></li>
</ul>
<p>ç¤ºæ„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼ˆå®Œæ•´ç‰ˆæœ¬åœ¨ä»“åº“é‡Œï¼‰ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PaintingModel</span> </span>{
  <span class="hljs-built_in">List</span>&lt;PointVector&gt; points;
  <span class="hljs-built_in">double</span> size;
  Color lineColor;
  <span class="hljs-built_in">bool</span> isEraser;

  PaintingModel({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.points,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.size,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.lineColor,
    <span class="hljs-keyword">this</span>.isEraser = <span class="hljs-keyword">false</span>,
  });
}
</code></pre>
<p>è¿™é‡Œçš„ <code>PointVector</code> æ¥è‡ª <code>perfect_freehand</code>ï¼Œå®ƒå¯¹ç¬”è¿¹å¹³æ»‘ã€å‹æ„Ÿæ•ˆæœä¼šæ›´å‹å¥½ã€‚</p>
<h3 data-id="heading-4">2. å…¨å±€ç»˜å›¾çŠ¶æ€ <code>PaintingState</code></h3>
<p><code>PaintingState</code> åŒ…å«ï¼š</p>
<ul>
<li><code>lines</code>ï¼šå·²å®Œæˆç¬”ç”»åˆ—è¡¨</li>
<li><code>currentLine</code>ï¼šå½“å‰æ­£åœ¨ç”»çš„é‚£ä¸€ç¬”</li>
<li><code>lineColorIndex</code>ï¼šå½“å‰é¢œè‰²ç´¢å¼•</li>
<li><code>lineWidth</code>ï¼šå½“å‰ç¬”åˆ·ç²—ç»†</li>
<li><code>isEraserMode</code>ï¼šæ˜¯å¦è¿›å…¥æ©¡çš®æ“¦æ¨¡å¼</li>
<li><code>undoStack</code>ï¼šæ’¤é”€æ ˆï¼ˆç”¨äºé‡åšï¼‰</li>
</ul>
<p>ç®€åŒ–åçš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PaintingState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Equatable</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;PaintingModel&gt; lines;
  <span class="hljs-keyword">final</span> PaintingModel? currentLine;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;PaintingModel&gt; undoStack;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> lineColorIndex;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> lineWidth;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isEraserMode;
}
</code></pre>
<p>è¿™é‡Œé€šè¿‡ <code>Equatable</code> åšçŠ¶æ€å¯¹æ¯”ï¼Œé…åˆ <code>BlocBuilder</code> å¯ä»¥åšåˆ°<strong>æŒ‰éœ€é‡å»º UI</strong>ã€‚</p>
<h3 data-id="heading-5">3. BLoC äº‹ä»¶ï¼ˆEventï¼‰è®¾è®¡</h3>
<p>æ¯”è¾ƒè‡ªç„¶çš„åˆ’åˆ†ï¼š</p>
<ul>
<li>æ‰‹åŠ¿ç›¸å…³ï¼š<code>PanStartEvent</code>, <code>PanUpdateEvent</code>, <code>PanEndEvent</code></li>
<li>é…ç½®ç›¸å…³ï¼š<code>UpdateLineColorIndexEvent</code>, <code>UpdateLineWidthEvent</code></li>
<li>æ¨¡å¼ç›¸å…³ï¼š<code>ToggleEraserModeEvent</code></li>
<li>æ’¤é”€ / é‡åšï¼š<code>RemoveLastLineEvent</code>, <code>RedoLastLineEvent</code></li>
<li>æ•´ä½“æ¸…ç©ºï¼š<code>ClearAllEvent</code></li>
</ul>
<p>å¤§éƒ¨åˆ†é€»è¾‘éƒ½è¢«æ”¶æ•›åˆ°ä¸€ä¸ª <code>PaintingBloc</code> ä¸­ï¼Œæ–¹ä¾¿ç»´æŠ¤å’Œåç»­æ‰©å±•ã€‚</p>
<hr/>
<h2 data-id="heading-6">å››ã€ä»æ‰‹åŠ¿åˆ°ç¬”ç”»ï¼šåæ ‡è½¬æ¢ä¸ç¬”è¿¹ç”Ÿæˆ</h2>
<h3 data-id="heading-7">1. æ‰‹åŠ¿é‡‡é›† â†’ å‘é€ BLoC Event</h3>
<p>ç”»å¸ƒå¤–å±‚ç”¨ <code>GestureDetector</code> åŒ…ç€ <code>RepaintBoundary + CustomPaint</code>ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">GestureDetector(
  onPanStart: handlePanStart,
  onPanUpdate: handlePanUpdate,
  onPanEnd: handlePanEnd,
  child: RepaintBoundary(
    key: canvasKey,
    child: CustomPaint(...),
  ),
);
</code></pre>
<p>å› ä¸ºå¤–å±‚è¿˜æœ‰ <code>SafeArea</code>ã€<code>ClipRRect</code> ç­‰åŒ…è£¹ï¼Œæ‰€ä»¥æ‹¿åˆ°çš„æ˜¯<strong>å…¨å±€åæ ‡</strong>ï¼Œéœ€è¦è½¬æˆç”»å¸ƒå±€éƒ¨åæ ‡ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">Offset? _getLocalOffset(Offset global) {
  <span class="hljs-keyword">final</span> ctx = canvasKey.currentContext;
  <span class="hljs-keyword">if</span> (ctx == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
  <span class="hljs-keyword">final</span> box = ctx.findRenderObject() <span class="hljs-keyword">as</span> RenderBox;
  <span class="hljs-keyword">return</span> box.globalToLocal(global);
}
</code></pre>
<p>æœ€ç»ˆåœ¨ <code>handlePanStart / Update / End</code> ä¸­ï¼ŒæŠŠè½¬æ¢åçš„åæ ‡åŒ…è£…æˆ <code>PointVector</code>ï¼Œå‘ç»™ BLoC å³å¯ã€‚</p>
<h3 data-id="heading-8">2. <code>perfect_freehand</code>ï¼šæŠŠä¸€ä¸²ç‚¹å˜æˆé¡ºæ»‘ç¬”è¿¹</h3>
<p>BLoC æ”¶é›†åˆ°çš„å®é™…ä¸Šæ˜¯ä¸€ä¸²â€œç¦»æ•£ç‚¹â€ï¼ŒçœŸæ­£æ¸²æŸ“æ—¶äº¤ç»™ <code>perfect_freehand</code> å¤„ç†ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> outlinePoints = getStroke(
  line.points,
  options: StrokeOptions(
    size: line.size,
    simulatePressure: <span class="hljs-keyword">true</span>,
    <span class="hljs-comment">// å…¶ä»–å‚æ•°è§æºç </span>
  ),
);
</code></pre>
<p><code>getStroke</code> ä¼šè¿”å›ä¸€ç»„<strong>è½®å»“ç‚¹</strong>ï¼Œå†ç”¨ <code>Path</code> æ‹¼æ¥æˆè·¯å¾„ï¼Œç”»åˆ° <code>Canvas</code> ä¸Šï¼Œå°±èƒ½å¾—åˆ°éå¸¸é¡ºæ»‘ã€æ¥è¿‘çœŸå®ä¹¦å†™çš„æ•ˆæœã€‚</p>
<hr/>
<h2 data-id="heading-9">äº”ã€ç”»å¸ƒç»˜åˆ¶ &amp; æ©¡çš®æ“¦å®ç°</h2>
<p>æ ¸å¿ƒç»˜åˆ¶é€»è¾‘åœ¨ <code>Sketcher extends CustomPainter</code> ä¸­ï¼š</p>
<ol>
<li>éå†æ‰€æœ‰ç¬”ç”»ï¼ˆåŒ…æ‹¬å·²å®Œæˆçš„ <code>lines</code> å’Œå½“å‰ <code>currentLine</code>ï¼‰ï¼›</li>
<li>å¯¹æ©¡çš®æ“¦ç¬”ç”»è®¾ç½® <code>blendMode = BlendMode.clear</code>ï¼›</li>
<li>ä½¿ç”¨ <code>getStroke</code> ç”Ÿæˆè½®å»“ç‚¹ï¼Œå†ç”¨ <code>Path</code> è¿æ¥ï¼›</li>
<li>è°ƒç”¨ <code>canvas.drawPath(path, paint)</code>ã€‚</li>
</ol>
<p>æ©¡çš®æ“¦çš„å…³é”®ä¸æ˜¯â€œç”»å‡ºä¸€ä¸ªç™½è‰²â€ï¼Œè€Œæ˜¯ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">paint
  ..color = Colors.transparent
  ..blendMode = BlendMode.clear;
</code></pre>
<p>å¹¶ä¸”æ•´æ®µç»˜åˆ¶åŒ…è£¹åœ¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">canvas.saveLayer(Offset.zero &amp; size, Paint());
<span class="hljs-comment">// ... draw</span>
canvas.restore();
</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>æ©¡çš®æ“¦å…¶å®æ˜¯åœ¨å½“å‰å›¾å±‚ä¸Šâ€œæŠ é™¤å·²æœ‰åƒç´ â€</strong>ï¼Œå¯¹èƒŒæ™¯æ¸å˜ä¸ä¼šé€ æˆå½±å“ã€‚</p>
<hr/>
<h2 data-id="heading-10">å…­ã€æ’¤é”€ / é‡åšï¼šä¸€æ¡ç®€å•ä½†å¥½ç”¨çš„æ ˆè®¾è®¡</h2>
<h3 data-id="heading-11">1. æ’¤é”€æ€è·¯</h3>
<ul>
<li>æ—¥å¸¸ç»˜åˆ¶æ—¶ï¼Œæ‰€æœ‰å®Œæˆçš„ç¬”ç”»éƒ½æ”¾åœ¨ <code>lines</code>ï¼›</li>
<li>ç‚¹å‡»â€œæ’¤é”€â€æ—¶ï¼Œå°† <code>lines</code> æœ€åä¸€ä¸ªå¼¹å‡ºï¼Œå¡è¿› <code>undoStack</code>ï¼›</li>
<li>ä¸ºé¿å…å†…å­˜æ— é™å¢é•¿ï¼Œå¼•å…¥ <code>maxUndoStackSize</code> æ§åˆ¶æœ€å¤§æ’¤é”€æ­¥æ•°ã€‚</li>
</ul>
<p>ä¼ªä»£ç ç¤ºæ„ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">if</span> (lines.isNotEmpty) {
  <span class="hljs-keyword">final</span> removed = lines.removeLast();
  undoStack.add(removed);
  <span class="hljs-keyword">if</span> (undoStack.length &gt; maxUndoStackSize) {
    undoStack.removeAt(<span class="hljs-number">0</span>);
  }
}
</code></pre>
<h3 data-id="heading-12">2. é‡åšæ€è·¯</h3>
<ul>
<li>ç‚¹å‡»â€œé‡åšâ€æ—¶ï¼Œä» <code>undoStack</code> å¼¹å‡ºæœ€åä¸€ä¸ªï¼Œé‡æ–°å¡å› <code>lines</code>ï¼›</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">if</span> (undoStack.isNotEmpty) {
  <span class="hljs-keyword">final</span> redoLine = undoStack.removeLast();
  lines.add(redoLine);
}
</code></pre>
<p>è¿™ç§åŒæ ˆå¼çš„å®ç°æ–¹å¼ç®€å•ç›´è§‚ï¼Œéå¸¸é€‚åˆç”»æ¿ç±»ã€ç¼–è¾‘å™¨ç±»çš„åœºæ™¯ã€‚</p>
<hr/>
<h2 data-id="heading-13">ä¸ƒã€ä¿å­˜ç”»å¸ƒåˆ°ç›¸å†Œï¼šRepaintBoundary + toImage</h2>
<h3 data-id="heading-14">1. æˆªå›¾åŸç†</h3>
<p>æ ¸å¿ƒæ€è·¯ï¼š</p>
<ol>
<li>ç”»å¸ƒåŒºåŸŸä½¿ç”¨ <code>RepaintBoundary</code> åŒ…è£¹ï¼Œå¹¶ç»‘å®šä¸€ä¸ª <code>GlobalKey</code>ï¼›</li>
<li>ç”¨æˆ·ç‚¹å‡»â€œä¿å­˜â€æ—¶ï¼Œé€šè¿‡ <code>contentKey.currentContext</code> æ‹¿åˆ°å¯¹åº”çš„ <code>RenderRepaintBoundary</code>ï¼›</li>
<li>è°ƒç”¨ <code>toImage(pixelRatio: 3.0)</code> å¾—åˆ°ä¸€å¼  <code>ui.Image</code>ï¼›</li>
<li>è½¬æˆ PNG å­—èŠ‚ï¼Œå¿…è¦æ—¶å‹ç¼©ï¼›</li>
<li>å†™å…¥æœ¬åœ°æ–‡ä»¶ / ä¿å­˜åˆ°ç›¸å†Œã€‚</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> boundary =
    contentKey.currentContext?.findRenderObject() <span class="hljs-keyword">as</span> RenderRepaintBoundary?;
<span class="hljs-keyword">final</span> image = <span class="hljs-keyword">await</span> boundary?.toImage(pixelRatio: <span class="hljs-number">3.0</span>);
<span class="hljs-keyword">final</span> byteData = <span class="hljs-keyword">await</span> image?.toByteData(format: ui.ImageByteFormat.png);
<span class="hljs-keyword">final</span> pngBytes = byteData?.buffer.asUint8List();
</code></pre>
<h3 data-id="heading-15">2. æœ¬åœ°å‹ç¼© &amp; ä¿å­˜åˆ°ç›¸å†Œ</h3>
<p>ä¸ºäº†é¿å…ç”Ÿæˆçš„ PNG å¤ªå¤§ï¼Œä½¿ç”¨ <code>flutter_image_compress</code> åšç®€å•å‹ç¼©ï¼Œç„¶åç”¨ <code>ImageGallerySaverPlus</code> å†™å…¥ç›¸å†Œã€‚</p>
<p>ä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> compressed = <span class="hljs-keyword">await</span> FlutterImageCompress.compressWithList(pngBytes);
<span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> ImageGallerySaverPlus.saveImage(compressed);
</code></pre>
<p>iOS / Android å‡éœ€è¦åœ¨å¯¹åº”å¹³å°é…ç½®ç›¸å†Œæƒé™ï¼Œå…·ä½“å¯å‚è€ƒä»“åº“ README æˆ–å®˜æ–¹æ–‡æ¡£ã€‚</p>
<hr/>
<h2 data-id="heading-16">å…«ã€UI äº¤äº’ &amp; ä¸€äº›å°è®¾è®¡</h2>
<p>æ•´ä¸ª UI é‡‡ç”¨äº† Stack + å¯¹é½çš„æ–¹å¼ï¼š</p>
<ul>
<li><strong>èƒŒæ™¯ç”»å¸ƒ</strong>ï¼š
<ul>
<li>ä½¿ç”¨çºµå‘æ¸å˜è‰²ï¼Œåšå‡ºç±»ä¼¼â€œå¤©ç©º / æµ·é¢â€æ•ˆæœï¼›</li>
</ul>
</li>
<li><strong>å·¦ä¾§ç«–ç›´æ»‘å—æ§åˆ¶ç¬”åˆ·ç²—ç»†</strong>ï¼š
<ul>
<li><code>RotatedBox(quarterTurns: 3)</code> æŠŠ <code>Slider</code> æ¨ªç€è½¬æˆç«–çš„ï¼›</li>
<li><code>AnimatedContainer</code> åšå±•å¼€/æ”¶èµ·çš„å°åŠ¨ç”»ï¼›</li>
</ul>
</li>
<li><strong>åº•éƒ¨é¢œè‰²é€‰æ‹©æ¡</strong>ï¼š
<ul>
<li>ä¸€æ’åœ†å½¢é¢œè‰²å—ï¼Œæ”¯æŒæ¨ªå‘æ»šåŠ¨ï¼›</li>
<li>å·¦è¾¹ç”¨ä¸€ä¸ªè¾ƒå¤§çš„åœ†å½¢å±•ç¤ºå½“å‰é¢œè‰²ï¼›</li>
</ul>
</li>
<li><strong>é¡¶éƒ¨å·¥å…·æ </strong>ï¼š
<ul>
<li>æ’¤é”€ / é‡åšï¼šç”¨å·¦å³ç¿»è½¬çš„åŒä¸€å›¾æ ‡ï¼›</li>
<li>æ©¡çš®æ“¦ï¼šç‚¹å‡»åˆ‡æ¢æ¨¡å¼ã€é•¿æŒ‰æ¸…ç©ºç”»å¸ƒï¼›</li>
<li>ä¿å­˜ï¼šç‚¹å‡»åç»™ä¸€ä¸ªæµ®åŠ¨ SnackBar æç¤ºä¿å­˜ç»“æœã€‚</li>
</ul>
</li>
</ul>
<p>è¿™äº›ç»†èŠ‚åŠ èµ·æ¥ï¼Œå¯ä»¥æ˜æ˜¾æå‡å°ç»„ä»¶çš„â€œå®Œæˆåº¦æ„Ÿâ€ã€‚</p>
<hr/>
<h2 data-id="heading-17">ä¹ã€è¸©å‘è®°å½•</h2>
<p>é¡¹ç›®ä¸­è¸©äº†ä¸€äº›å°å‘ï¼Œä¹Ÿé¡ºä¾¿è®°å½•ä¸€ä¸‹ï¼š</p>
<ol>
<li>
<p><strong><code>GestureDetector</code> + <code>RepaintBoundary</code> å°ºå¯¸ &amp; åæ ‡</strong><br/>
å¦‚æœç”»å¸ƒä¸æ˜¯å…¨å±ï¼Œå¼ºçƒˆå»ºè®®ç”¨ <code>GlobalKey</code> + <code>RenderBox.globalToLocal</code> åšåæ ‡è½¬æ¢ï¼Œé¿å…å‡ºç°â€œç”»åˆ°åˆ«çš„åœ°æ–¹â€çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>SafeArea &amp; iOS é¡¶éƒ¨é«˜åº¦</strong><br/>
iOS ä¸Šé€šè¿‡ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> paddingTop = MediaQuery.of(context).padding.top;
</code></pre>
<p>å†é…åˆè‡ªå®šä¹‰çš„ <code>canvasHeight</code>ï¼Œä¿è¯ç”»å¸ƒåœ¨å„ç§è®¾å¤‡ä¸Šé«˜åº¦åˆé€‚ã€‚</p>
</li>
<li>
<p><strong>ä¿å­˜å›¾ç‰‡æ—¶çš„å†…å­˜å ç”¨</strong><br/>
<code>pixelRatio</code> å¤ªé«˜ + å¤§å°ºå¯¸ç”»å¸ƒï¼Œä¼šæ˜æ˜¾å¢å¤§å†…å­˜å’Œæ–‡ä»¶ä½“ç§¯ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯åšåŠ¨æ€æ§åˆ¶ã€‚</p>
</li>
<li>
<p><strong>ç›¸å†Œæƒé™</strong></p>
<ul>
<li>iOSï¼šåœ¨ <code>Info.plist</code> ä¸­æ·»åŠ ä¿å­˜ç›¸å†Œçš„æƒé™æè¿°ï¼›</li>
<li>Androidï¼šæ ¹æ® targetSdk é…ç½®å­˜å‚¨ / åª’ä½“æƒé™ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-18">åã€æ€»ç»“ &amp; å¯æ‰©å±•æ–¹å‘</h2>
<p>è¿™ä¸ªå°é¡¹ç›®è™½ç„¶åŠŸèƒ½ä¸ç®—å¤æ‚ï¼Œä½†æŠŠä»¥ä¸‹å‡ ä¸ªå…³é”®çŸ¥è¯†ç‚¹éƒ½ä¸²èµ·æ¥äº†ï¼š</p>
<ul>
<li>Flutter è‡ªå®šä¹‰ç»˜åˆ¶ï¼ˆ<code>CustomPainter</code> + <code>Canvas</code>ï¼‰</li>
<li>BLoC çŠ¶æ€ç®¡ç†</li>
<li>æ‰‹åŠ¿äº‹ä»¶åˆ°ç»˜å›¾æ•°æ®çš„è½¬æ¢</li>
<li>æ’¤é”€ / é‡åšçš„æ ˆè®¾è®¡</li>
<li>ç»„ä»¶æˆªå›¾ä¸ä¿å­˜ç›¸å†Œ</li>
</ul>
<p>åŸºäºå½“å‰å®ç°ï¼Œå¾ˆå®¹æ˜“ç»§ç»­æ‰©å±•æ›´å¤šèƒ½åŠ›ï¼š</p>
<ul>
<li>æ”¯æŒå›¾å½¢ç»˜åˆ¶ï¼šç›´çº¿ã€çŸ©å½¢ã€åœ†ç­‰ï¼›</li>
<li>æ”¯æŒæ–‡å­—è¾“å…¥ã€è´´çº¸ï¼›</li>
<li>æ”¯æŒå¤šé¡µç”»å¸ƒ / å›¾å±‚ï¼›</li>
<li>æ”¯æŒå¯¼å‡ºåˆ†äº«ï¼ˆæµ·æŠ¥ã€é•¿å›¾ç­‰ï¼‰ï¼›</li>
<li>æ”¯æŒè‡ªå®šä¹‰ç¬”åˆ·ï¼ˆè§å…‰ç¬”ã€æ¯›ç¬”ã€è™šçº¿ç¬”ç­‰ï¼‰ã€‚</li>
</ul>
<blockquote>
<p>å¦‚æœä½ ä¹Ÿåœ¨åšç±»ä¼¼çš„ç”»æ¿ / æ‰‹å†™ / ç­¾åç»„ä»¶ï¼Œå¯ä»¥æŠŠ BLoC + CustomPainter è¿™ä¸€å¥—ç›´æ¥æŠ½å‡ºæ¥å¤ç”¨ï¼Œä¿®æ”¹ UI å’Œäº¤äº’å³å¯ã€‚</p>
</blockquote>
<p>å®Œæ•´å¯è¿è¡Œä»£ç ã€ä¾èµ–é…ç½®ã€å¹³å°æƒé™ç¤ºä¾‹éƒ½åœ¨ GitHub ä»“åº“ä¸­ï¼š</p>
<ul>
<li>ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwutao23yzd%2FuikitCombine" target="_blank" title="https://github.com/wutao23yzd/uikitCombine" ref="nofollow noopener noreferrer">GitHub</a></li>
</ul>
<p>æ¬¢è¿ fork / star / æ issue äº¤æµ ğŸ‘‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ Kotlin åç¨‹ç»“æ„åŒ–å¹¶å‘]]></title>    <link>https://juejin.cn/post/7575367791273361446</link>    <guid>https://juejin.cn/post/7575367791273361446</guid>    <pubDate>2025-11-23T16:32:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791273361446" data-draft-id="7575442779039760426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ Kotlin åç¨‹ç»“æ„åŒ–å¹¶å‘"/> <meta itemprop="keywords" content="Android,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-23T16:32:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åº¦ç†Šå›"/> <meta itemprop="url" content="https://juejin.cn/user/1618089084457853"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ Kotlin åç¨‹ç»“æ„åŒ–å¹¶å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1618089084457853/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åº¦ç†Šå›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:32:01.000Z" title="Sun Nov 23 2025 16:32:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¼‚æ­¥ç¼–ç¨‹é¢†åŸŸï¼Œä¼ ç»Ÿå¤šçº¿ç¨‹æ¨¡å‹é•¿æœŸé¢ä¸´ â€œé‡çº¿ç¨‹æ³„æ¼â€â€œå¼‚å¸¸éš¾ä»¥è¿½è¸ªâ€â€œç”Ÿå‘½å‘¨æœŸä¸å¯æ§â€ ä¸‰å¤§ç—›ç‚¹ â€”â€” å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹åï¼Œå¦‚åŒæ”¾é£ä¸€åªæ— ç»³é£ç­ï¼Œæ—¢æ— æ³•ç²¾å‡†å–æ¶ˆï¼Œä¹Ÿéš¾ä»¥æ„ŸçŸ¥å…¶çŠ¶æ€ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºæˆ–é€»è¾‘å¼‚å¸¸ã€‚è€Œ Kotlin åç¨‹çš„<strong>ç»“æ„åŒ–å¹¶å‘ï¼ˆStructured Concurrencyï¼‰</strong> Â æ¨¡å‹ï¼Œæ­£æ˜¯ä¸ºè§£å†³è¿™äº›ç—›ç‚¹è€Œç”Ÿï¼šå®ƒä»¥ â€œåç¨‹ä½œç”¨åŸŸï¼ˆCoroutineScopeï¼‰â€ ä¸ºæ ¸å¿ƒï¼Œå°†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸ä¸šåŠ¡ç»„ä»¶ï¼ˆå¦‚ Android çš„ ViewModelã€Activityï¼‰æ·±åº¦ç»‘å®šï¼Œå®ç°äº†å¼‚æ­¥ä»»åŠ¡çš„ â€œå¯è¿½æº¯ã€å¯ç®¡ç†ã€å¯å›æ”¶â€ï¼Œå½»åº•é‡å¡‘äº†å¼‚æ­¥ç¼–ç¨‹çš„å®‰å…¨æ€§ä¸æ•ˆç‡ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç»“æ„åŒ–å¹¶å‘çš„æ ¸å¿ƒå®šä¹‰ï¼šä»€ä¹ˆæ˜¯ â€œç»“æ„åŒ–â€ï¼Ÿ</h2>
<p>ç»“æ„åŒ–å¹¶å‘çš„æœ¬è´¨æ˜¯ <strong>â€œåç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»è¢«æ˜¾å¼ç®¡ç†â€</strong>ï¼Œå…¶æ ¸å¿ƒè§„åˆ™ç”± Kotlin åç¨‹è®¾è®¡è€… Roman Elizarov æå‡ºï¼šâ€œä»»ä½•åç¨‹éƒ½å¿…é¡»è¿è¡Œåœ¨ä¸€ä¸ª CoroutineScope ä¸­ï¼Œåç¨‹çš„åˆ›å»ºä¸é”€æ¯éœ€éµå¾ªâ€˜çˆ¶å­å±‚çº§å…³ç³»â€™ï¼Œçˆ¶ä½œç”¨åŸŸçš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼Œæ‰€æœ‰å­åç¨‹å°†è¢«è‡ªåŠ¨å–æ¶ˆâ€ã€‚</p>
<p>è¿™ä¸€è§„åˆ™ç›´æ¥é’ˆå¯¹ä¼ ç»Ÿéç»“æ„åŒ–å¹¶å‘çš„ç¼ºé™·ï¼š</p>
<ul>
<li>éç»“æ„åŒ–å¹¶å‘ï¼šä½¿ç”¨<code>GlobalScope</code>æˆ–è£¸çº¿ç¨‹å¯åŠ¨ä»»åŠ¡æ—¶ï¼Œä»»åŠ¡ä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸè„±èŠ‚ï¼Œå³ä½¿é¡µé¢é”€æ¯ï¼Œåå°ä»»åŠ¡ä»å¯èƒ½ç»§ç»­è¿è¡Œï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆå¦‚æŒæœ‰ Activity å¼•ç”¨ï¼‰ï¼›</li>
<li>ç»“æ„åŒ–å¹¶å‘ï¼šé€šè¿‡<code>viewModelScope</code>ï¼ˆç»‘å®š ViewModelï¼‰ã€<code>lifecycleScope</code>ï¼ˆç»‘å®š Activity/Fragmentï¼‰ç­‰ä½œç”¨åŸŸå¯åŠ¨åç¨‹ï¼Œç»„ä»¶é”€æ¯æ—¶ä½œç”¨åŸŸè‡ªåŠ¨å–æ¶ˆï¼Œæ‰€æœ‰å­åç¨‹éšä¹‹ç»ˆæ­¢ï¼Œä»æ ¹æºé¿å…æ³„æ¼ã€‚</li>
</ul>
<h2 data-id="heading-1">äºŒã€ç»“æ„åŒ–å¹¶å‘çš„ä¸‰å¤§æ ¸å¿ƒæœºåˆ¶</h2>
<p>ç»“æ„åŒ–å¹¶å‘çš„å®‰å…¨æ€§å¹¶éå‡­ç©ºè€Œæ¥ï¼Œè€Œæ˜¯ä¾èµ– â€œçˆ¶å­åç¨‹è”åŠ¨â€â€œå¼‚å¸¸å®šå‘ä¼ æ’­â€â€œèµ„æºè‡ªåŠ¨å›æ”¶â€ ä¸‰å¤§æœºåˆ¶çš„ååŒå·¥ä½œï¼Œè¿™ä¸‰å¤§æœºåˆ¶æ„æˆäº†å…¶ä¸å¯æ›¿ä»£çš„æ ¸å¿ƒä»·å€¼ã€‚</p>
<h3 data-id="heading-2">1. çˆ¶å­åç¨‹ï¼šå±‚çº§åŒ–çš„ç”Ÿå‘½å‘¨æœŸç»‘å®š</h3>
<p>ç»“æ„åŒ–å¹¶å‘ä¸­ï¼Œåç¨‹å­˜åœ¨ä¸¥æ ¼çš„ â€œçˆ¶å­å…³ç³»â€ï¼šé€šè¿‡<code>CoroutineScope</code>å¯åŠ¨çš„åç¨‹ä¸º â€œçˆ¶åç¨‹â€ï¼Œçˆ¶åç¨‹å†…éƒ¨å¯åŠ¨çš„åç¨‹ï¼ˆå¦‚<code>launch</code>/<code>async</code>åˆ›å»ºçš„ï¼‰ä¸º â€œå­åç¨‹â€ï¼Œå…¶æ ¸å¿ƒè§„åˆ™æ˜¯ï¼š</p>
<ul>
<li>çˆ¶åç¨‹å–æ¶ˆæ—¶ï¼Œæ‰€æœ‰å­åç¨‹ä¼šè¢«<strong>çº§è”å–æ¶ˆ</strong>ï¼ˆCascading Cancellationï¼‰ï¼›</li>
<li>å­åç¨‹å…¨éƒ¨å®Œæˆå‰ï¼Œçˆ¶åç¨‹ä¼šè‡ªåŠ¨ç­‰å¾…ï¼ˆç±»ä¼¼<code>joinAll</code>ï¼‰ï¼Œé¿å… â€œçˆ¶é€€å­ç•™â€ çš„å­¤å„¿åç¨‹ã€‚</li>
</ul>
<p><strong>å®è·µæ¡ˆä¾‹ï¼šå¹¶è¡Œè·å–æ•°æ®</strong>åœ¨ä¸šåŠ¡å±‚ä¸­ï¼Œé€šè¿‡<code>coroutineScope</code>å¯åŠ¨ä¸¤ä¸ªå¹¶è¡Œå­åç¨‹ï¼Œè‹¥ç”¨æˆ·é€€å‡ºé¡µé¢å¯¼è‡´çˆ¶ä½œç”¨åŸŸå–æ¶ˆï¼Œä¸¤ä¸ªå­åç¨‹ä¼šç«‹å³ç»ˆæ­¢ï¼Œé¿å…æ— æ•ˆç½‘ç»œè¯·æ±‚ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GetBookAndAuthorsUseCase</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> booksRepo: BooksRepository,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> authorsRepo: AuthorsRepository
) {
    <span class="hljs-comment">// çˆ¶åç¨‹ï¼šé€šè¿‡coroutineScopeç®¡ç†å­åç¨‹</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span></span>: BookAndAuthors = coroutineScope {
        <span class="hljs-comment">// å­åç¨‹1ï¼šè·å–ä¹¦ç±</span>
        <span class="hljs-keyword">val</span> books = async { booksRepo.getAllBooks() }
        <span class="hljs-comment">// å­åç¨‹2ï¼šè·å–ä½œè€…</span>
        <span class="hljs-keyword">val</span> authors = async { authorsRepo.getAllAuthors() }
        <span class="hljs-comment">// çˆ¶åç¨‹ç­‰å¾…æ‰€æœ‰å­åç¨‹å®Œæˆåè¿”å›</span>
        BookAndAuthors(books.await(), authors.await())
    }
}
</code></pre>
<h3 data-id="heading-3">2. å¼‚å¸¸éš”ç¦»</h3>
<p>ä¼ ç»Ÿå¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œå¼‚å¸¸å®¹æ˜“ â€œä¸¢å¤±â€ æˆ– â€œæ‰©æ•£â€ï¼ˆå¦‚ä¸€ä¸ªçº¿ç¨‹æŠ›å‡ºå¼‚å¸¸å¯¼è‡´æ•´ä¸ªçº¿ç¨‹æ± æŒ‚æ‰ï¼‰ï¼Œè€Œç»“æ„åŒ–å¹¶å‘é€šè¿‡ä¸¤ç§ä½œç”¨åŸŸç±»å‹ï¼Œå®ç°äº†å¼‚å¸¸çš„ç²¾å‡†æ§åˆ¶ï¼š</p>




















<table><thead><tr><th>ä½œç”¨åŸŸç±»å‹</th><th>å¼‚å¸¸ä¼ æ’­è§„åˆ™</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>coroutineScope</code></td><td>ä»»ä¸€å­åç¨‹æŠ›æœªæ•è·å¼‚å¸¸ â†’ å–æ¶ˆæ‰€æœ‰å­åç¨‹ + å‘ä¸Šä¼ æ’­</td><td>äº‹åŠ¡æ€§ä»»åŠ¡ï¼ˆå¦‚ â€œè·å–ä¹¦ç± + ä½œè€…â€ï¼Œç¼ºä¸€ä¸å¯ï¼‰</td></tr><tr><td><code>supervisorScope</code></td><td>å­åç¨‹å¼‚å¸¸ä»…è‡ªèº«ç»ˆæ­¢ â†’ ä¸å½±å“å…¶ä»–å­åç¨‹ + ä¸å‘ä¸Šä¼ æ’­</td><td>ç‹¬ç«‹å¹¶è¡Œä»»åŠ¡ï¼ˆå¦‚ â€œå¤šæ–‡ä»¶ä¸‹è½½â€ï¼Œä¸€ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–ï¼‰</td></tr></tbody></table>
<p><strong>å®è·µæ¡ˆä¾‹ï¼šå¤šæ–‡ä»¶ä¸‹è½½</strong>ä½¿ç”¨<code>supervisorScope</code>ç¡®ä¿å•ä¸ªæ–‡ä»¶ä¸‹è½½å¤±è´¥æ—¶ï¼Œå…¶ä»–ä¸‹è½½ä»»åŠ¡æ­£å¸¸è¿›è¡Œï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">downloadMultipleFiles</span><span class="hljs-params">(fileUrls: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> = supervisorScope {
    fileUrls.forEach { url -&gt;
        launch {
            <span class="hljs-keyword">try</span> {
                downloadFile(url) <span class="hljs-comment">// å•ä¸ªæ–‡ä»¶ä¸‹è½½</span>
            } <span class="hljs-keyword">catch</span> (e: IOException) {
                Log.e(<span class="hljs-string">"Download"</span>, <span class="hljs-string">"æ–‡ä»¶<span class="hljs-variable">$url</span> ä¸‹è½½å¤±è´¥"</span>, e)
                <span class="hljs-comment">// ä»…å¤„ç†å½“å‰å¼‚å¸¸ï¼Œä¸å½±å“å…¶ä»–å­åç¨‹</span>
            }
        }
    }
}
</code></pre>
<p>âš ï¸ å…³é”®æ³¨æ„ç‚¹ï¼š<strong>åˆ‡å‹¿æ•è·<code>CancellationException</code></strong></p>
<p><code>CancellationException</code>æ˜¯åç¨‹å–æ¶ˆçš„ä¿¡å·ï¼Œè‹¥æ•è·åä¸é‡æ–°æŠ›å‡ºï¼Œä¼šå¯¼è‡´åç¨‹æ— æ³•æ­£å¸¸å–æ¶ˆï¼ˆå¦‚<code>viewModelScope</code>é”€æ¯æ—¶ï¼Œå­åç¨‹ä»ç»§ç»­è¿è¡Œï¼‰ã€‚å®è·µä¸­åº”æ•è·å…·ä½“å¼‚å¸¸ï¼ˆå¦‚<code>IOException</code>ï¼‰ï¼Œè€Œéæ³›å‹<code>Exception</code>ã€‚</p>
<h3 data-id="heading-4">3. èµ„æºè‡ªåŠ¨å›æ”¶ï¼šä½œç”¨åŸŸé”€æ¯å³èµ„æºé‡Šæ”¾</h3>
<p>ç»“æ„åŒ–å¹¶å‘çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€æ˜¯ â€œæ— éœ€æ‰‹åŠ¨ç®¡ç†åç¨‹ç”Ÿå‘½å‘¨æœŸâ€â€”â€” ä½œç”¨åŸŸä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œç»„ä»¶é”€æ¯æ—¶ä½œç”¨åŸŸè‡ªåŠ¨è°ƒç”¨<code>cancel()</code>ï¼Œæ‰€æœ‰æœªå®Œæˆçš„å­åç¨‹å°†è¢«ç»ˆæ­¢ï¼ŒåŒæ—¶é‡Šæ”¾ç›¸å…³èµ„æºï¼ˆå¦‚ç½‘ç»œè¿æ¥ã€æ–‡ä»¶æµï¼‰ã€‚</p>
<p>Android ä¸­æœ€å…¸å‹çš„å®è·µæ˜¯<code>viewModelScope</code>å’Œ<code>lifecycleScope</code>ï¼š</p>
<ul>
<li><code>viewModelScope</code>ï¼šä¸ ViewModel ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œ<code>ViewModel.onCleared()</code>è°ƒç”¨æ—¶è‡ªåŠ¨å–æ¶ˆï¼Œé¿å…åå°ä»»åŠ¡æŒæœ‰ Activity/Fragment å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ï¼›</li>
<li><code>lifecycleScope</code>ï¼šä¸ Activity/Fragment ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œ<code>onDestroy()</code>æ—¶è‡ªåŠ¨å–æ¶ˆï¼Œé€‚åˆå¤„ç†ä¸ UI å¼ºç›¸å…³çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚å›¾ç‰‡åŠ è½½ï¼‰ã€‚</li>
</ul>
<p><strong>é”™è¯¯ç¤ºä¾‹ï¼šæ»¥ç”¨ GlobalScope</strong></p>
<p><code>GlobalScope</code>æ˜¯å…¨å±€ä½œç”¨åŸŸï¼Œç”Ÿå‘½å‘¨æœŸä¸åº”ç”¨è¿›ç¨‹ä¸€è‡´ï¼Œè‹¥ç”¨å®ƒå¯åŠ¨åç¨‹ï¼Œå³ä½¿ ViewModel é”€æ¯ï¼Œä»»åŠ¡ä»ä¼šç»§ç»­è¿è¡Œï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é”™è¯¯ï¼šGlobalScopeæ— ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œæ˜“æ³„æ¼</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BadRepository</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span> {
        GlobalScope.launch {
            <span class="hljs-comment">// å³ä½¿è°ƒç”¨è€…ï¼ˆå¦‚ViewModelï¼‰é”€æ¯ï¼Œæ­¤ä»»åŠ¡ä»ç»§ç»­è¿è¡Œ</span>
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = api.getData()
        }
    }
}

<span class="hljs-comment">// æ­£ç¡®ï¼šæ³¨å…¥å¤–éƒ¨ä½œç”¨åŸŸï¼ˆå¦‚viewModelScopeï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> externalScope: CoroutineScope <span class="hljs-comment">// ç”±è°ƒç”¨è€…ä¼ å…¥viewModelScope</span>
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span> = externalScope.launch {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = api.getData()
    }.join()
}
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€Android ä¸­ç»“æ„åŒ–å¹¶å‘çš„æœ€ä½³å®è·µ</h2>
<p>ç»“åˆ Google å®˜æ–¹æ–‡æ¡£ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fkotlin%2Fcoroutines%2Fcoroutines-best-practices" target="_blank" title="https://developer.android.com/kotlin/coroutines/coroutines-best-practices" ref="nofollow noopener noreferrer">Coroutines Best Practices</a>ï¼‰ä¸å®é™…å¼€å‘åœºæ™¯ï¼Œç»“æ„åŒ–å¹¶å‘çš„å®è·µéœ€èšç„¦ â€œä½œç”¨åŸŸé€‰æ‹©â€â€œå¯å–æ¶ˆæ€§ä¿éšœâ€â€œå¯æµ‹è¯•æ€§ä¼˜åŒ–â€ ä¸‰å¤§æ–¹å‘ã€‚</p>
<h3 data-id="heading-6">1. ä½œç”¨åŸŸé€‰æ‹©ï¼šæŒ‰ä¸šåŠ¡åœºæ™¯åŒ¹é…ç”Ÿå‘½å‘¨æœŸ</h3>
<p>ä¸åŒå±‚çº§çš„ç»„ä»¶åº”ä½¿ç”¨ä¸åŒçš„ä½œç”¨åŸŸï¼Œé¿å… â€œå¤§æå°ç”¨â€ æˆ– â€œç”Ÿå‘½å‘¨æœŸä¸åŒ¹é…â€ï¼š</p>






























<table><thead><tr><th>ç»„ä»¶å±‚çº§</th><th>æ¨èä½œç”¨åŸŸ</th><th>æ ¸å¿ƒåŸå› </th></tr></thead><tbody><tr><td>ViewModel</td><td><code>viewModelScope</code></td><td>ç”Ÿå‘½å‘¨æœŸè¦†ç›–é¡µé¢åˆ‡æ¢ï¼Œé¿å…é…ç½®å˜æ›´ï¼ˆå¦‚æ—‹è½¬ï¼‰å¯¼è‡´ä»»åŠ¡é‡å¯</td></tr><tr><td>Activity/Fragment</td><td><code>lifecycleScope</code></td><td>ä¸ UI ç”Ÿå‘½å‘¨æœŸå®Œå…¨åŒæ­¥ï¼Œé€‚åˆ UI ç›¸å…³å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚å€’è®¡æ—¶ï¼‰</td></tr><tr><td>åº”ç”¨çº§åå°ä»»åŠ¡</td><td>è‡ªå®šä¹‰ Scope</td><td>éœ€æ‰‹åŠ¨ç®¡ç†ï¼ˆå¦‚<code>CoroutineScope(SupervisorJob() + Dispatchers.IO)</code>ï¼‰ï¼Œé€‚åˆ â€œé€€å‡ºé¡µé¢ä»éœ€å®Œæˆâ€ çš„ä»»åŠ¡ï¼ˆå¦‚æ–‡ä»¶ä¸Šä¼ ï¼‰</td></tr><tr><td>ä¸šåŠ¡å±‚ / æ•°æ®å±‚</td><td>ä¸æŒæœ‰ Scopeï¼Œç”±è°ƒç”¨è€…ä¼ å…¥</td><td>éµå¾ª â€œè°å¯åŠ¨è°ç®¡ç†â€ åŸåˆ™ï¼Œæå‡å¤ç”¨æ€§ï¼ˆå¦‚ Repository æ¥æ”¶ ViewModel çš„<code>viewModelScope</code>ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-7">2. ç¡®ä¿åç¨‹å¯å–æ¶ˆï¼šä¸»åŠ¨æ£€æŸ¥å–æ¶ˆä¿¡å·</h3>
<p>åç¨‹çš„å–æ¶ˆæ˜¯ â€œåä½œå¼â€ çš„ â€”â€” åªæœ‰å½“åç¨‹æ‰§è¡Œåˆ°<code>suspend</code>å‡½æ•°ï¼ˆå¦‚<code>delay</code>ã€<code>withContext</code>ï¼‰æˆ–ä¸»åŠ¨æ£€æŸ¥å–æ¶ˆçŠ¶æ€æ—¶ï¼Œæ‰ä¼šå“åº”å–æ¶ˆã€‚è‹¥åç¨‹æ‰§è¡Œé˜»å¡æ“ä½œï¼ˆå¦‚å¾ªç¯è¯»å–æ–‡ä»¶ï¼‰ï¼Œéœ€ä¸»åŠ¨è°ƒç”¨<code>ensureActive()</code>æˆ–<code>isActive</code>æ£€æŸ¥ï¼Œé¿å… â€œå–æ¶ˆä¸ç”Ÿæ•ˆâ€ã€‚</p>
<p><strong>å®è·µæ¡ˆä¾‹ï¼šå¯å–æ¶ˆçš„æ–‡ä»¶è¯»å–</strong></p>
<pre><code class="hljs language-scss" lang="scss">viewModelScope<span class="hljs-selector-class">.launch</span> {
    val files = <span class="hljs-built_in">getFilesToRead</span>()
    for (file in files) {
        <span class="hljs-built_in">ensureActive</span>() <span class="hljs-comment">// æ¯æ¬¡å¾ªç¯å‰æ£€æŸ¥å–æ¶ˆçŠ¶æ€ï¼Œè‹¥å·²å–æ¶ˆåˆ™æŠ›å‡ºCancellationException</span>
        <span class="hljs-built_in">readFileContent</span>(file) <span class="hljs-comment">// é˜»å¡æ“ä½œ</span>
    }
}
</code></pre>
<h3 data-id="heading-8">3. ä¼˜åŒ–å¯æµ‹è¯•æ€§ï¼šæ³¨å…¥è°ƒåº¦å™¨ï¼ˆDispatcherï¼‰</h3>
<p>ç¡¬ç¼–ç <code>Dispatchers</code>ï¼ˆå¦‚<code>Dispatchers.IO</code>ï¼‰ä¼šå¯¼è‡´æµ‹è¯•å›°éš¾ â€”â€” å•å…ƒæµ‹è¯•ä¸­æ— æ³•æ§åˆ¶åç¨‹æ‰§è¡Œæ—¶æœºï¼Œè€Œé€šè¿‡ â€œä¾èµ–æ³¨å…¥â€ æ–¹å¼ä¼ å…¥è°ƒåº¦å™¨ï¼Œå¯åœ¨æµ‹è¯•æ—¶æ›¿æ¢ä¸º<code>TestDispatcher</code>ï¼Œå®ç° â€œç¡®å®šæ€§æµ‹è¯•â€ã€‚</p>
<p><strong>æ­£ç¡®ç¤ºä¾‹ï¼šæ³¨å…¥è°ƒåº¦å™¨</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç”Ÿäº§ä»£ç ï¼šé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥è°ƒåº¦å™¨ï¼Œé»˜è®¤å€¼ä¸ºDispatchers.IO</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> ioDispatcher: CoroutineDispatcher = Dispatchers.IO,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api: NewsApi
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadNews</span><span class="hljs-params">()</span></span>: List&lt;Article&gt; = withContext(ioDispatcher) {
        api.getLatestNews()
    }
}

<span class="hljs-comment">// æµ‹è¯•ä»£ç ï¼šä¼ å…¥TestDispatcherï¼Œæ§åˆ¶åç¨‹æ‰§è¡Œ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsRepositoryTest</span> {
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testLoadNews</span><span class="hljs-params">()</span></span> = runTest { <span class="hljs-comment">// runTestæ˜¯Kotlinæµ‹è¯•åº“æä¾›çš„åç¨‹æµ‹è¯•ç¯å¢ƒ</span>
        <span class="hljs-keyword">val</span> testDispatcher = UnconfinedTestDispatcher(testScheduler)
        <span class="hljs-keyword">val</span> repo = NewsRepository(ioDispatcher = testDispatcher, api = FakeNewsApi())
        
        <span class="hljs-keyword">val</span> news = repo.loadNews()
        assertThat(news).isNotEmpty() <span class="hljs-comment">// ç¡®å®šæ€§æ–­è¨€</span>
    }
}
</code></pre>
<h2 data-id="heading-9">å››ã€ç»“æ„åŒ–å¹¶å‘çš„æ•ˆç‡ä¼˜åŠ¿</h2>
<p>ç»“æ„åŒ–å¹¶å‘ä¸ä»…è§£å†³äº† â€œå®‰å…¨æ€§â€ é—®é¢˜ï¼Œè¿˜é€šè¿‡ä¸åç¨‹ â€œè½»é‡çº§â€ ç‰¹æ€§çš„ç»“åˆï¼Œåœ¨æ•ˆç‡ä¸Šç¢¾å‹ä¼ ç»Ÿå¤šçº¿ç¨‹æ¨¡å‹ï¼š</p>






























<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>ä¼ ç»Ÿå¤šçº¿ç¨‹</th><th>åç¨‹ç»“æ„åŒ–å¹¶å‘</th></tr></thead><tbody><tr><td>å†…å­˜å ç”¨</td><td>å•ä¸ªçº¿ç¨‹çº¦ 1MB æ ˆç©ºé—´</td><td>å•ä¸ªåç¨‹ä»…å‡ å KBï¼ˆå †ä¸Šä¿å­˜ Continuationï¼‰</td></tr><tr><td>ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬</td><td>å†…æ ¸æ€åˆ‡æ¢ï¼ˆæ¯«ç§’çº§ï¼‰</td><td>ç”¨æˆ·æ€åˆ‡æ¢ï¼ˆçº³ç§’çº§ï¼‰</td></tr><tr><td>å¹¶å‘æ•°é‡ä¸Šé™</td><td>æ•°åƒçº¿ç¨‹ï¼ˆæ˜“ OOMï¼‰</td><td>å•æœºæ”¯æŒ 10 ä¸‡ + åç¨‹</td></tr><tr><td>çº¿ç¨‹åˆ©ç”¨ç‡</td><td>IO é˜»å¡æ—¶çº¿ç¨‹é—²ç½®</td><td>IO æŒ‚èµ·æ—¶çº¿ç¨‹å¯æ‰§è¡Œå…¶ä»–åç¨‹</td></tr></tbody></table>
<p>ä»¥ â€œ1000 æ¬¡ç½‘ç»œè¯·æ±‚â€ ä¸ºä¾‹ï¼š</p>
<ul>
<li>ä¼ ç»Ÿå¤šçº¿ç¨‹ï¼šéœ€åˆ›å»ºçº¿ç¨‹æ± ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°çº¦ 200ï¼‰ï¼Œå¤§é‡çº¿ç¨‹åœ¨ IO ç­‰å¾…æ—¶é—²ç½®ï¼Œåˆ‡æ¢æˆæœ¬é«˜ï¼›</li>
<li>åç¨‹ç»“æ„åŒ–å¹¶å‘ï¼šä»…éœ€å°‘é‡çº¿ç¨‹ï¼ˆå¦‚ Dispatchers.IO é»˜è®¤ 64 ä¸ªï¼‰ï¼Œä¸€ä¸ªçº¿ç¨‹å¯å¤„ç†æ•°ç™¾ä¸ªåç¨‹ï¼ŒIO æŒ‚èµ·æ—¶çº¿ç¨‹ç«‹å³é‡Šæ”¾ï¼Œåˆ©ç”¨ç‡æå‡ 10 å€ä»¥ä¸Šã€‚</li>
</ul>
<h2 data-id="heading-10">äº”ã€å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—</h2>
<ol>
<li>
<p><strong>è¯¯åŒº 1ï¼šç”¨<code>GlobalScope</code>å¯åŠ¨ â€œé•¿æœŸä»»åŠ¡â€</strong></p>
<ul>
<li>åæœï¼š<code>GlobalScope</code>æ— ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œä»»åŠ¡å¯èƒ½ä¸€ç›´è¿è¡Œåˆ°åº”ç”¨é€€å‡ºï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼›</li>
<li>æ›¿ä»£æ–¹æ¡ˆï¼šåˆ›å»ºè‡ªå®šä¹‰<code>CoroutineScope</code>ï¼Œå¹¶åœ¨åº”ç”¨é€€å‡ºæ—¶æ‰‹åŠ¨å–æ¶ˆï¼ˆå¦‚åœ¨ Application çš„<code>onTerminate()</code>ä¸­è°ƒç”¨<code>scope.cancel()</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¯¯åŒº 2ï¼šæ•è·<code>CancellationException</code>å¹¶ â€œåæ‰â€</strong></p>
<ul>
<li>åæœï¼šåç¨‹æ— æ³•å“åº”å–æ¶ˆä¿¡å·ï¼Œå³ä½¿ä½œç”¨åŸŸé”€æ¯ï¼Œä»»åŠ¡ä»ç»§ç»­è¿è¡Œï¼›</li>
<li>æ­£ç¡®åšæ³•ï¼šä»…æ•è·ä¸šåŠ¡å¼‚å¸¸ï¼ˆå¦‚<code>IOException</code>ï¼‰ï¼Œ<code>CancellationException</code>æ— éœ€å¤„ç†ï¼ˆæˆ–æ•è·åé‡æ–°æŠ›å‡ºï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¯¯åŒº 3ï¼šåœ¨ ViewModel ä¸­æš´éœ²<code>suspend</code>å‡½æ•°ç»™ View</strong></p>
<ul>
<li>åæœï¼šView éœ€è‡ªè¡Œå¯åŠ¨åç¨‹ï¼ˆå¦‚ç”¨<code>lifecycleScope</code>ï¼‰ï¼Œç ´å â€œViewModel ç®¡ç†ä¸šåŠ¡é€»è¾‘â€ çš„åˆ†å±‚åŸåˆ™ï¼›</li>
<li>æ­£ç¡®åšæ³•ï¼šViewModel ä¸­åˆ›å»ºåç¨‹ï¼ˆç”¨<code>viewModelScope</code>ï¼‰ï¼Œé€šè¿‡<code>StateFlow</code>æš´éœ² UI çŠ¶æ€ï¼ŒView ä»…è§‚å¯ŸçŠ¶æ€å˜åŒ–ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-11">ç»“è¯­</h2>
<p>Kotlin åç¨‹çš„ç»“æ„åŒ–å¹¶å‘ï¼Œå¹¶éç®€å•çš„ â€œè¯­æ³•ç³–â€ï¼Œè€Œæ˜¯å¯¹å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„é‡æ„ï¼šå®ƒé€šè¿‡ â€œä½œç”¨åŸŸâ€ å°†å¼‚æ­¥ä»»åŠ¡ä» â€œä¸å¯æ§çš„é‡çº¿ç¨‹â€ å˜ä¸º â€œå¯ç®¡ç†çš„ç”Ÿå‘½å‘¨æœŸå•å…ƒâ€ï¼Œæ—¢è§£å†³äº†ä¼ ç»Ÿå¤šçº¿ç¨‹çš„å®‰å…¨ç—›ç‚¹ï¼Œåˆä¿ç•™äº†åç¨‹çš„é«˜æ•ˆç‰¹æ€§ã€‚æŒæ¡ç»“æ„åŒ–å¹¶å‘ï¼Œä¸ä»…æ˜¯æŠ€æœ¯èƒ½åŠ›çš„æå‡ï¼Œæ›´æ˜¯å¯¹ â€œå¼‚æ­¥ç¼–ç¨‹æœ¬è´¨â€ çš„æ·±åˆ»ç†è§£ã€‚</p>
<p><strong><strong>æ¬¢è¿å…³æ³¨å…¬ä¼—å·åº¦ç†Šå›ï¼Œä¸€èµ·åˆ†äº«äº¤æµã€‚</strong></strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mysqlåœ¨æŸ¥è¯¢çš„æ—¶å€™èµ°ç´¢å¼•æ¯”ä¸èµ°ç´¢å¼•ä¸€å®šå¿«å—ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575807729722753058</link>    <guid>https://juejin.cn/post/7575807729722753058</guid>    <pubDate>2025-11-23T14:06:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575807729722753058" data-draft-id="7575363120798597120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mysqlåœ¨æŸ¥è¯¢çš„æ—¶å€™èµ°ç´¢å¼•æ¯”ä¸èµ°ç´¢å¼•ä¸€å®šå¿«å—ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-23T14:06:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éšé£é£˜çš„äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/361110952753560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mysqlåœ¨æŸ¥è¯¢çš„æ—¶å€™èµ°ç´¢å¼•æ¯”ä¸èµ°ç´¢å¼•ä¸€å®šå¿«å—ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/361110952753560/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éšé£é£˜çš„äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:06:17.000Z" title="Sun Nov 23 2025 14:06:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç´¢å¼•çš„æ ¸å¿ƒä»·å€¼æ˜¯<strong>å‡å°‘æ•°æ®åº“æ‰«æçš„æ•°æ®é‡</strong>ï¼Œä»è€Œæå‡æŸ¥è¯¢æ•ˆç‡ï¼Œä½†è¿™å¹¶éç»å¯¹è§„å¾‹ã€‚å½“ç´¢å¼•çš„ â€œé¢å¤–å¼€é”€â€ è¶…è¿‡å…¶ â€œæ‰«æä¼˜åŒ–æ”¶ç›Šâ€ æ—¶ï¼Œèµ°ç´¢å¼•åè€Œä¼šæ¯”å…¨è¡¨æ‰«ææ›´æ…¢ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒå‰æï¼šç´¢å¼•çš„ â€œæ”¶ç›Šâ€ ä¸ â€œå¼€é”€â€</h2>
<p>è¦ç†è§£ â€œèµ°ç´¢å¼•ä¸ä¸€å®šå¿«â€ï¼Œé¦–å…ˆè¦æ˜ç¡®ç´¢å¼•çš„æœ¬è´¨æ˜¯ã€Œtrade-offã€ï¼ˆæƒè¡¡ï¼‰ï¼š</p>
<h3 data-id="heading-1">1. ç´¢å¼•çš„ â€œæ”¶ç›Šâ€</h3>
<ul>
<li>å‡å°‘æ‰«æè¡Œæ•°ï¼šé€šè¿‡ç´¢å¼•æ ‘å¿«é€Ÿå®šä½ç›®æ ‡æ•°æ®ï¼Œé¿å…å…¨è¡¨éå†ï¼ˆå¦‚åƒä¸‡çº§è¡¨ä¸­æŸ¥è¯¢ 1 æ¡æ•°æ®ï¼Œç´¢å¼•å¯ç›´æ¥å‘½ä¸­ï¼Œæ‰«æè¡Œæ•° = 1ï¼‰ï¼›</li>
<li>é¿å…æ’åº / ä¸´æ—¶è¡¨ï¼šè‹¥<code>ORDER BY</code>/<code>GROUP BY</code>å­—æ®µåœ¨ç´¢å¼•ä¸­ï¼Œå¯ç›´æ¥åˆ©ç”¨ç´¢å¼•é¡ºåºï¼Œé¿å…<code>Using filesort</code>/<code>Using temporary</code>ã€‚</li>
</ul>
<h3 data-id="heading-2">2. ç´¢å¼•çš„ â€œå¼€é”€â€</h3>
<ul>
<li>ç´¢å¼•ç»´æŠ¤å¼€é”€ï¼šç´¢å¼•æ˜¯ç‹¬ç«‹çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ B + æ ‘ï¼‰ï¼ŒæŸ¥è¯¢æ—¶éœ€å…ˆéå†ç´¢å¼•æ ‘ï¼Œå†é€šè¿‡ç´¢å¼•æŒ‡å‘çš„ â€œè¡ŒæŒ‡é’ˆâ€ å›è¡¨æŸ¥è¯¢å®Œæ•´æ•°æ®ï¼ˆèšç°‡ç´¢å¼•é™¤å¤–ï¼‰ï¼›</li>
<li>IO å¼€é”€ï¼šç´¢å¼•æ–‡ä»¶ä¼šå ç”¨é¢å¤–ç£ç›˜ç©ºé—´ï¼ŒæŸ¥è¯¢æ—¶éœ€è¯»å–ç´¢å¼•æ–‡ä»¶ + æ•°æ®æ–‡ä»¶ï¼ˆå…¨è¡¨æ‰«æä»…éœ€è¯»å–æ•°æ®æ–‡ä»¶ï¼‰ï¼›</li>
<li>ä¼˜åŒ–å™¨åˆ¤æ–­å¼€é”€ï¼šæ•°æ®åº“ä¼˜åŒ–å™¨éœ€è®¡ç®— â€œèµ°ç´¢å¼•çš„æˆæœ¬â€ å’Œ â€œå…¨è¡¨æ‰«æçš„æˆæœ¬â€ï¼Œå†é€‰æ‹©æ›´ä¼˜æ–¹æ¡ˆï¼ˆè‹¥ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶ï¼Œå¯èƒ½è¯¯åˆ¤ï¼‰ã€‚</li>
</ul>
<p>å½“ã€Œå¼€é”€ &gt; æ”¶ç›Šã€æ—¶ï¼Œèµ°ç´¢å¼•ä¼šæ›´æ…¢ï¼›åªæœ‰å½“ã€Œæ”¶ç›Š &gt; å¼€é”€ã€æ—¶ï¼Œç´¢å¼•æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</p>
<h2 data-id="heading-3">äºŒã€èµ°ç´¢å¼•æ¯”å…¨è¡¨æ‰«ææ…¢çš„ 5 ç§å…¸å‹åœºæ™¯ï¼ˆå«åŸç† + æ¡ˆä¾‹ï¼‰</h2>
<h3 data-id="heading-4">åœºæ™¯ 1ï¼šæŸ¥è¯¢æ•°æ®é‡å æ¯”æé«˜ï¼ˆé«˜é€‰æ‹©æ€§å·®ï¼‰</h3>
<h4 data-id="heading-5">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>ç´¢å¼•çš„ä¼˜åŠ¿åœ¨ â€œè¿‡æ»¤å°‘é‡æ•°æ®â€ï¼Œè‹¥æŸ¥è¯¢éœ€è¦è¿”å›è¡¨ä¸­<strong>å¤§éƒ¨åˆ†æ•°æ®</strong>ï¼ˆå¦‚ 30% ä»¥ä¸Šï¼‰ï¼Œç´¢å¼•çš„ â€œå‡å°‘æ‰«æè¡Œæ•°â€ æ”¶ç›Šä¼šå®Œå…¨æŠµæ¶ˆï¼Œè€Œ â€œç´¢å¼•éå† + å›è¡¨â€ çš„å¼€é”€ä¼šå‡¸æ˜¾ã€‚</p>
<ul>
<li>å…¨è¡¨æ‰«æï¼šæ•°æ®åº“é‡‡ç”¨ã€Œé¡ºåº IOã€è¯»å–æ•°æ®ï¼ˆæœºæ¢°ç¡¬ç›˜ / SSD çš„é¡ºåº IO æ•ˆç‡è¿œé«˜äºéšæœº IOï¼‰ï¼Œæ— éœ€é¢å¤–éå†ç´¢å¼•ï¼›</li>
<li>èµ°ç´¢å¼•ï¼šéœ€å…ˆéå†ç´¢å¼•æ ‘ï¼ˆéšæœº IOï¼‰ï¼Œå†æ ¹æ®ç´¢å¼•ä¸­çš„è¡ŒæŒ‡é’ˆå›è¡¨è¯»å–æ•°æ®ï¼ˆå¤šæ¬¡éšæœº IOï¼‰ï¼Œæ€» IO å¼€é”€åè€Œæ›´å¤§ã€‚</li>
</ul>
<h4 data-id="heading-6">æ¡ˆä¾‹ï¼ˆMySQL InnoDBï¼‰ï¼š</h4>
<p>å‡è®¾æœ‰ä¸€å¼ <code>user</code>è¡¨ï¼ˆ100 ä¸‡è¡Œæ•°æ®ï¼‰ï¼ŒæŸ¥è¯¢ â€œæ‰€æœ‰å¹´é¾„å¤§äº 18 å²çš„ç”¨æˆ·â€ï¼ˆå æ¯”çº¦ 80%ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åœºæ™¯ï¼šageå­—æ®µæœ‰ç´¢å¼•ï¼Œä½†æŸ¥è¯¢æ•°æ®å æ¯”80%</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">18</span>;
</code></pre>
<ul>
<li>èµ°ç´¢å¼•ï¼šéå†ç´¢å¼•æ ‘æ‰¾åˆ°æ‰€æœ‰æ»¡è¶³<code>age&gt;18</code>çš„è¡ŒæŒ‡é’ˆï¼ˆ80 ä¸‡æ¡ï¼‰ï¼Œå†é€è¡Œå›è¡¨è¯»å–å®Œæ•´æ•°æ®ï¼ˆ80 ä¸‡æ¬¡éšæœº IOï¼‰ï¼›</li>
<li>å…¨è¡¨æ‰«æï¼šé¡ºåºè¯»å–æ•´ä¸ªæ•°æ®æ–‡ä»¶ï¼ˆ1 æ¬¡è¿ç»­ IOï¼‰ï¼Œç›´æ¥è¿‡æ»¤æ•°æ®ã€‚æ­¤æ—¶ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨é€‰æ‹©å…¨è¡¨æ‰«æï¼Œè€Œéèµ°ç´¢å¼•ã€‚</li>
</ul>
<h4 data-id="heading-7">å…³é”®æ¦‚å¿µï¼šç´¢å¼•é€‰æ‹©æ€§</h4>
<ul>
<li>é€‰æ‹©æ€§ = å­—æ®µå”¯ä¸€å€¼æ•°é‡ / æ€»è®°å½•æ•°ï¼ˆé€‰æ‹©æ€§è¶Šé«˜ï¼Œç´¢å¼•è¶Šæœ‰ç”¨ï¼‰ï¼›</li>
<li>ä¾‹ï¼š<code>id</code>ï¼ˆä¸»é”®ï¼Œé€‰æ‹©æ€§ = 100%ï¼‰&gt;Â <code>phone</code>ï¼ˆå”¯ä¸€ç´¢å¼•ï¼Œé€‰æ‹©æ€§â‰ˆ99%ï¼‰&gt;Â <code>age</code>ï¼ˆé€‰æ‹©æ€§â‰ˆ10%ï¼‰&gt;Â <code>gender</code>ï¼ˆæ€§åˆ«ï¼Œé€‰æ‹©æ€§â‰ˆ2%ï¼‰ï¼›</li>
<li>ä½é€‰æ‹©æ€§å­—æ®µï¼ˆå¦‚<code>gender</code>ï¼‰ï¼šå³ä½¿æŸ¥è¯¢å æ¯” 20%ï¼Œèµ°ç´¢å¼•ä¹Ÿå¯èƒ½æ¯”å…¨è¡¨æ‰«ææ…¢ã€‚</li>
</ul>
<h3 data-id="heading-8">åœºæ™¯ 2ï¼šè¡¨æ•°æ®é‡æå°ï¼ˆå¦‚å‡ ç™¾è¡Œï¼‰</h3>
<h4 data-id="heading-9">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>å°è¡¨çš„å…¨è¡¨æ‰«æå¼€é”€æä½ï¼ˆå¦‚ 100 è¡Œæ•°æ®ï¼Œå…¨è¡¨æ‰«æä»…éœ€è¯»å– 1 ä¸ªæ•°æ®é¡µï¼‰ï¼Œè€Œç´¢å¼•çš„ â€œéå†ç´¢å¼•æ ‘ + å›è¡¨â€ å¼€é”€ç›¸å¯¹æ›´é«˜ï¼Œå®Œå…¨æ²¡å¿…è¦èµ°ç´¢å¼•ã€‚</p>
<h4 data-id="heading-10">æ¡ˆä¾‹ï¼š</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¡¨ï¼šuser_smallï¼ˆä»…50è¡Œæ•°æ®ï¼Œageæœ‰ç´¢å¼•ï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> user_small <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
</code></pre>
<ul>
<li>å…¨è¡¨æ‰«æï¼šç›´æ¥è¯»å– 1 ä¸ªæ•°æ®é¡µï¼ˆInnoDB é»˜è®¤é¡µå¤§å° 16KBï¼‰ï¼Œéå† 50 è¡Œæ•°æ®ï¼Œè€—æ—¶ &lt; 1msï¼›</li>
<li>èµ°ç´¢å¼•ï¼šå…ˆè¯»å–ç´¢å¼•é¡µï¼ˆ1 ä¸ªï¼‰ï¼Œæ‰¾åˆ°<code>age=25</code>çš„è¡ŒæŒ‡é’ˆï¼Œå†å›è¡¨è¯»å–æ•°æ®é¡µï¼ˆ1 ä¸ªï¼‰ï¼Œæ€» IO æ¬¡æ•°ä¸å…¨è¡¨æ‰«æç›¸åŒï¼Œä½†å¤šäº†ç´¢å¼•æ ‘éå†çš„é€»è¾‘å¼€é”€ã€‚ä¼˜åŒ–å™¨ä¼šç›´æ¥é€‰æ‹©å…¨è¡¨æ‰«æï¼Œå¿½ç•¥ç´¢å¼•ã€‚</li>
</ul>
<h3 data-id="heading-11">åœºæ™¯ 3ï¼šç´¢å¼•å¤±æ•ˆå¯¼è‡´ â€œä¼ªèµ°ç´¢å¼•â€</h3>
<h4 data-id="heading-12">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>çœ‹ä¼¼ â€œèµ°äº†ç´¢å¼•â€ï¼Œä½†å®é™…æ˜¯ã€Œå…¨ç´¢å¼•æ‰«æã€ï¼ˆ<code>type=index</code>ï¼‰ï¼Œè€Œéã€Œç´¢å¼•ç²¾å‡†å‘½ä¸­ã€ï¼ˆ<code>type=ref/range</code>ï¼‰ã€‚å…¨ç´¢å¼•æ‰«æéœ€è¦éå†æ•´ä¸ªç´¢å¼•æ ‘ï¼Œè‹¥ç´¢å¼•æ–‡ä»¶æ¯”æ•°æ®æ–‡ä»¶æ›´å¤§ï¼Œè€—æ—¶ä¼šè¶…è¿‡å…¨è¡¨æ‰«æã€‚</p>
<h4 data-id="heading-13">å…¸å‹æ¡ˆä¾‹ï¼ˆç´¢å¼•å¤±æ•ˆåœºæ™¯ï¼‰ï¼š</h4>
<ol>
<li>
<p>ç´¢å¼•å­—æ®µè¢«å‡½æ•°æ“ä½œï¼ˆå¦‚<code>DATE(create_time)</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- create_timeæœ‰ç´¢å¼•ï¼Œä½†å‡½æ•°æ“ä½œå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå®é™…èµ°å…¨ç´¢å¼•æ‰«æ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-type">DATE</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-string">'2025-11-23'</span>;
</code></pre>
</li>
<li>
<p>éšå¼ç±»å‹è½¬æ¢ï¼ˆå¦‚<code>phone</code>æ˜¯<code>INT</code>ï¼ŒæŸ¥è¯¢ç”¨å­—ç¬¦ä¸²ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- phoneæ˜¯INTç±»å‹ï¼Œ'13800138000'æ˜¯å­—ç¬¦ä¸²ï¼Œéšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span>;
</code></pre>
</li>
<li>
<p>è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è”åˆç´¢å¼•ï¼šidx_age_name(age, name)ï¼ŒæŸ¥è¯¢æ— ageï¼Œä»…æŸ¥name</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'å¼ ä¸‰'</span>; <span class="hljs-comment">-- èµ°å…¨ç´¢å¼•æ‰«æï¼ˆtype=indexï¼‰</span>
</code></pre>
</li>
</ol>
<h4 data-id="heading-14">å¯¹æ¯”ï¼š</h4>
<ul>
<li>å…¨ç´¢å¼•æ‰«æï¼ˆ<code>type=index</code>ï¼‰ï¼šéå†æ•´ä¸ªç´¢å¼•æ ‘ï¼ˆå¦‚ç´¢å¼•æ–‡ä»¶ 100MBï¼‰ï¼Œè€—æ—¶ä¹…ï¼›</li>
<li>å…¨è¡¨æ‰«æï¼ˆ<code>type=ALL</code>ï¼‰ï¼šéå†æ•°æ®æ–‡ä»¶ï¼ˆå¦‚æ•°æ®æ–‡ä»¶ 80MBï¼‰ï¼Œè€—æ—¶æ›´çŸ­ã€‚</li>
</ul>
<h3 data-id="heading-15">åœºæ™¯ 4ï¼šéœ€è¦ â€œå›è¡¨â€ ä¸”æ•°æ®åˆ†æ•£</h3>
<h4 data-id="heading-16">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>éèšç°‡ç´¢å¼•ï¼ˆå¦‚æ™®é€šç´¢å¼•ã€è”åˆç´¢å¼•ï¼‰çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ã€Œä¸»é”®å€¼ã€ï¼Œè€Œéå®Œæ•´æ•°æ®ã€‚æŸ¥è¯¢æ—¶éœ€å…ˆé€šè¿‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œå†åˆ°èšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ä¸­æŸ¥è¯¢å®Œæ•´æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«ã€Œå›è¡¨ã€ã€‚è‹¥æŸ¥è¯¢çš„æ•°æ®åˆ†æ•£åœ¨è¡¨ä¸­å¤šä¸ªæ•°æ®é¡µï¼Œå›è¡¨ä¼šäº§ç”Ÿå¤§é‡ã€Œéšæœº IOã€ï¼ˆæ¯ä¸ªæ•°æ®é¡µéœ€å•ç‹¬è¯»å–ï¼‰ï¼Œè€Œå…¨è¡¨æ‰«ææ˜¯ã€Œé¡ºåº IOã€ï¼ˆè¿ç»­è¯»å–æ•°æ®é¡µï¼‰ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p>
<h4 data-id="heading-17">æ¡ˆä¾‹ï¼š</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¡¨ï¼šorderï¼ˆ10ä¸‡è¡Œï¼Œæ™®é€šç´¢å¼•idx_user_id(user_id)ï¼Œéèšç°‡ç´¢å¼•ï¼‰</span>
<span class="hljs-comment">-- æŸ¥è¯¢ï¼šç”¨æˆ·IDåœ¨100-200ä¹‹é—´çš„æ‰€æœ‰è®¢å•ï¼ˆå…±5000æ¡ï¼Œåˆ†æ•£åœ¨100ä¸ªæ•°æ®é¡µï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">200</span>;
</code></pre>
<ul>
<li>èµ°ç´¢å¼•ï¼šéå† idx_user_id æ‰¾åˆ° 5000 ä¸ªä¸»é”®â†’å›è¡¨æŸ¥è¯¢ 100 ä¸ªæ•°æ®é¡µï¼ˆ100 æ¬¡éšæœº IOï¼‰ï¼›</li>
<li>å…¨è¡¨æ‰«æï¼šé¡ºåºè¯»å– 50 ä¸ªæ•°æ®é¡µï¼ˆè¦†ç›–æ‰€æœ‰ç›®æ ‡æ•°æ®ï¼‰ï¼Œ1 æ¬¡è¿ç»­ IOã€‚æ­¤æ—¶éšæœº IO çš„å¼€é”€è¿œå¤§äºé¡ºåº IOï¼Œèµ°ç´¢å¼•æ›´æ…¢ã€‚</li>
</ul>
<h3 data-id="heading-18">åœºæ™¯ 5ï¼šå†™å…¥æ“ä½œï¼ˆINSERT/UPDATE/DELETEï¼‰â€”â€” ç´¢å¼•åè€Œæ‹–æ…¢é€Ÿåº¦</h3>
<h4 data-id="heading-19">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>ç´¢å¼•å¯¹ã€ŒæŸ¥è¯¢ã€æ˜¯ä¼˜åŒ–ï¼Œä½†å¯¹ã€Œå†™å…¥ã€æ˜¯è´Ÿæ‹…ã€‚å†™å…¥æ—¶ï¼Œæ•°æ®åº“ä¸ä»…è¦ä¿®æ”¹æ•°æ®æ–‡ä»¶ï¼Œè¿˜è¦åŒæ­¥ç»´æŠ¤æ‰€æœ‰ç›¸å…³ç´¢å¼•ï¼ˆå¦‚ B + æ ‘çš„åˆ†è£‚ã€åˆå¹¶ã€æ’åºï¼‰ï¼Œç´¢å¼•è¶Šå¤šï¼Œå†™å…¥å¼€é”€è¶Šå¤§ã€‚</p>
<h4 data-id="heading-20">æ¡ˆä¾‹ï¼š</h4>
<p>ä¸€å¼ è¡¨æœ‰ 5 ä¸ªç´¢å¼•ï¼Œæ’å…¥ 1 æ¡æ•°æ®æ—¶ï¼š</p>
<ul>
<li>æ— ç´¢å¼•ï¼šä»…éœ€åœ¨æ•°æ®æ–‡ä»¶æœ«å°¾æ’å…¥ï¼ˆæˆ–æŒ‡å®šä½ç½®ä¿®æ”¹ï¼‰ï¼Œè€—æ—¶ 1msï¼›</li>
<li>æœ‰ç´¢å¼•ï¼šéœ€ä¿®æ”¹ 5 ä¸ªç´¢å¼•æ ‘ï¼ˆæ¯ä¸ªç´¢å¼•æ ‘éƒ½è¦æ‰¾åˆ°å¯¹åº”ä½ç½®æ’å…¥ / æ›´æ–°ï¼‰ï¼Œè€—æ—¶ 5ms+ã€‚æ­¤æ—¶ç´¢å¼•è¶Šå¤šï¼Œå†™å…¥è¶Šæ…¢ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´é”ç­‰å¾…æ—¶é—´å»¶é•¿ã€‚</li>
</ul>
<h2 data-id="heading-21">ä¸‰ã€æ•°æ®åº“ä¼˜åŒ–å™¨çš„ â€œå†³ç­–é€»è¾‘â€ï¼šä½•æ—¶é€‰æ‹©èµ°ç´¢å¼• / å…¨è¡¨æ‰«æï¼Ÿ</h2>
<p>æ•°æ®åº“ä¸ä¼šç›²ç›®èµ°ç´¢å¼•ï¼Œè€Œæ˜¯é€šè¿‡ã€Œæˆæœ¬è®¡ç®—ã€å†³å®šæœ€ä¼˜æ–¹æ¡ˆï¼ˆä»¥ MySQL ä¸ºä¾‹ï¼‰ï¼š</p>
<h3 data-id="heading-22">1. ä¼˜åŒ–å™¨çš„ â€œæˆæœ¬æ¨¡å‹â€</h3>
<ul>
<li>å…¨è¡¨æ‰«ææˆæœ¬ = æ•°æ®æ–‡ä»¶å¤§å° Ã— æ¯é¡µ IO æˆæœ¬ + æ‰«æè¡Œæ•° Ã— è¡Œè¿‡æ»¤æˆæœ¬ï¼›</li>
<li>èµ°ç´¢å¼•æˆæœ¬ = ç´¢å¼•æ–‡ä»¶å¤§å° Ã— æ¯é¡µ IO æˆæœ¬ + ç´¢å¼•æ‰«æè¡Œæ•° Ã— è¡Œè¿‡æ»¤æˆæœ¬ + å›è¡¨è¡Œæ•° Ã— å›è¡¨æˆæœ¬ã€‚</li>
</ul>
<p>ä¼˜åŒ–å™¨ä¼šå¯¹æ¯”ä¸¤è€…æˆæœ¬ï¼Œé€‰æ‹©æˆæœ¬æ›´ä½çš„æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-23">2. å½±å“å†³ç­–çš„å…³é”®å› ç´ </h3>
<ul>
<li>ç»Ÿè®¡ä¿¡æ¯ï¼šæ•°æ®åº“ä¼šè®°å½•è¡¨çš„è¡Œæ•°ã€æ•°æ®é¡µæ•°é‡ã€ç´¢å¼•é€‰æ‹©æ€§ç­‰ç»Ÿè®¡ä¿¡æ¯ï¼ˆé€šè¿‡<code>ANALYZE TABLE</code>æ›´æ–°ï¼‰ï¼Œç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶ä¼šå¯¼è‡´è¯¯åˆ¤ï¼›</li>
<li>æŸ¥è¯¢æ¡ä»¶ï¼š<code>WHERE</code>å­å¥çš„è¿‡æ»¤æ¡ä»¶ï¼ˆå¦‚<code>=</code>vs<code>&gt;</code>ï¼‰ã€è¿”å›å­—æ®µï¼ˆ<code>SELECT *</code>vs<code>SELECT ä¸»é”®</code>ï¼‰ï¼›</li>
<li>ç´¢å¼•ç±»å‹ï¼šèšç°‡ç´¢å¼•ï¼ˆæ— éœ€å›è¡¨ï¼‰æ¯”éèšç°‡ç´¢å¼•æ›´æ˜“è¢«é€‰æ‹©ï¼Œè¦†ç›–ç´¢å¼•ï¼ˆæ— éœ€å›è¡¨ï¼‰æˆæœ¬æœ€ä½ã€‚</li>
</ul>
<h4 data-id="heading-24">ä¾‹å­ï¼šç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶å¯¼è‡´çš„è¯¯åˆ¤</h4>
<p>è‹¥è¡¨ä¸­å®é™…æ•°æ® 100 ä¸‡è¡Œï¼Œä½†ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºä»… 1 ä¸‡è¡Œï¼Œä¼˜åŒ–å™¨å¯èƒ½è¯¯åˆ¤ â€œèµ°ç´¢å¼•æˆæœ¬æ›´ä½â€ï¼Œä½†å®é™…æŸ¥è¯¢æ—¶å›è¡¨å¼€é”€æå¤§ï¼Œå¯¼è‡´èµ°ç´¢å¼•æ¯”å…¨è¡¨æ‰«ææ…¢ã€‚æ­¤æ—¶éœ€æ‰§è¡Œ<code>ANALYZE TABLE è¡¨å</code>æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<h2 data-id="heading-25">å››ã€é¢è¯•é«˜é¢‘è€ƒç‚¹ï¼šå¦‚ä½•åˆ¤æ–­ â€œæ˜¯å¦è¯¥èµ°ç´¢å¼•â€ï¼Ÿï¼ˆå®ç”¨æŠ€å·§ï¼‰</h2>
<ol>
<li>
<p><strong>çœ‹æŸ¥è¯¢æ•°æ®å æ¯”</strong>ï¼šè¿”å›æ•°æ®å æ¯” &lt;10%â†’èµ°ç´¢å¼•ï¼›å æ¯”&gt; 30%â†’å…¨è¡¨æ‰«ææ›´ä¼˜ï¼›</p>
</li>
<li>
<p><strong>çœ‹ç´¢å¼•é€‰æ‹©æ€§</strong>ï¼šé€‰æ‹©æ€§ &gt; 30%â†’ç´¢å¼•æœ‰ç”¨ï¼›é€‰æ‹©æ€§ &lt; 10%â†’ä½é€‰æ‹©æ€§å­—æ®µï¼ˆå¦‚æ€§åˆ«ï¼‰ï¼Œèµ°ç´¢å¼•å¯èƒ½æ›´æ…¢ï¼›</p>
</li>
<li>
<p><strong>çœ‹æ˜¯å¦å›è¡¨</strong>ï¼šè¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢å­—æ®µå‡åœ¨ç´¢å¼•ä¸­ï¼‰â†’ å¿…èµ°ç´¢å¼•ï¼ˆæ— å›è¡¨å¼€é”€ï¼‰ï¼›<code>SELECT *</code>+ éèšç°‡ç´¢å¼•â†’ éœ€å›è¡¨ï¼Œéœ€è¯„ä¼°æˆæœ¬ï¼›</p>
</li>
<li>
<p><strong>ç”¨ EXPLAIN éªŒè¯</strong>ï¼š</p>
<ul>
<li><code>type</code>å­—æ®µï¼š<code>ref</code>/<code>range</code>â†’ æœ‰æ•ˆç´¢å¼•ï¼ˆå¿«ï¼‰ï¼›<code>index</code>â†’ å…¨ç´¢å¼•æ‰«æï¼ˆå¯èƒ½æ¯”<code>ALL</code>æ…¢ï¼‰ï¼›</li>
<li><code>rows</code>å­—æ®µï¼šé¢„ä¼°æ‰«æè¡Œæ•°è¶Šå°‘ï¼Œèµ°ç´¢å¼•è¶Šä¼˜ï¼›</li>
<li><code>Extra</code>å­—æ®µï¼š<code>Using index</code>ï¼ˆè¦†ç›–ç´¢å¼•ï¼Œæœ€ä¼˜ï¼‰ã€<code>Using index condition</code>ï¼ˆICP ä¼˜åŒ–ï¼Œè¾ƒä¼˜ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-26">äº”ã€æ€»ç»“ï¼šæ ¸å¿ƒåŸåˆ™ä¸é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-27">1. æ ¸å¿ƒç»“è®º</h3>
<ul>
<li>èµ°ç´¢å¼•ä¸ä¸€å®šæ¯”å…¨è¡¨æ‰«æå¿«ï¼Œå…³é”®çœ‹ã€Œæ”¶ç›Šï¼ˆå‡å°‘æ‰«æè¡Œæ•°ï¼‰æ˜¯å¦å¤§äºå¼€é”€ï¼ˆç´¢å¼•éå† + å›è¡¨ï¼‰ã€ï¼›</li>
<li>ç´¢å¼•çš„ä»·å€¼æ˜¯ â€œè¿‡æ»¤å°‘é‡ã€é«˜é€‰æ‹©æ€§æ•°æ®â€ï¼Œè€Œé â€œä¸‡èƒ½ä¼˜åŒ–â€ã€‚</li>
</ul>
<h3 data-id="heading-28">2. é¿å‘æŒ‡å—</h3>
<ul>
<li>é¿å…ç»™ä½é€‰æ‹©æ€§å­—æ®µå»ºç´¢å¼•ï¼ˆå¦‚æ€§åˆ«ã€çŠ¶æ€ï¼‰ï¼Œåè€Œä¼šæ‹–æ…¢å†™å…¥å’ŒæŸ¥è¯¢ï¼›</li>
<li>å°è¡¨æ— éœ€å»ºç´¢å¼•ï¼ˆå…¨è¡¨æ‰«ææ•ˆç‡è¶³å¤Ÿï¼‰ï¼Œç´¢å¼•åªä¼šå¢åŠ ç»´æŠ¤å¼€é”€ï¼›</li>
<li>é¿å…<code>SELECT *</code>ï¼šä¼˜å…ˆç”¨è¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢å­—æ®µ = ç´¢å¼•å­—æ®µï¼‰ï¼Œå‡å°‘å›è¡¨å¼€é”€ï¼›</li>
<li>å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆ<code>ANALYZE TABLE</code>ï¼‰ï¼Œé¿å…ä¼˜åŒ–å™¨è¯¯åˆ¤ï¼›</li>
<li>ç”¨<code>EXPLAIN</code>åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œè‹¥å‘ç°<code>type=index</code>ä½†<code>rows</code>æå¤§ï¼Œå¯èƒ½æ˜¯å…¨ç´¢å¼•æ‰«æï¼Œéœ€ä¼˜åŒ–æŸ¥è¯¢æˆ–ç´¢å¼•ã€‚</li>
</ul>
<h3 data-id="heading-29">3. ä¸€å¥è¯è®°å¿†</h3>
<p>ã€Œç´¢å¼•é€‚åˆ â€œç²¾å‡†æ‰“å‡»â€ï¼ˆå°‘é‡æ•°æ®ã€é«˜é€‰æ‹©æ€§ï¼‰ï¼Œå…¨è¡¨æ‰«æé€‚åˆ â€œåœ°æ¯¯å¼æœç´¢â€ï¼ˆå¤§é‡æ•°æ®ã€ä½é€‰æ‹©æ€§ï¼‰ã€ã€‚</p>
<h2 data-id="heading-30">é¢è¯•çœŸé¢˜æ¼”ç»ƒ</h2>
<h3 data-id="heading-31">é—®é¢˜ 1ï¼šä¸ºä»€ä¹ˆæŸ¥è¯¢ â€œæ€§åˆ« = ç”·â€ æ—¶ï¼Œä¼˜åŒ–å™¨é€‰æ‹©å…¨è¡¨æ‰«æè€Œéèµ°ç´¢å¼•ï¼Ÿ</h3>
<p>ç­”ï¼šå› ä¸º â€œæ€§åˆ«â€ æ˜¯ä½é€‰æ‹©æ€§å­—æ®µï¼ˆé€‰æ‹©æ€§â‰ˆ2%ï¼‰ï¼ŒæŸ¥è¯¢æ•°æ®å æ¯”é«˜ï¼ˆçº¦ 50%ï¼‰ã€‚èµ°ç´¢å¼•éœ€éå†ç´¢å¼•æ ‘ + å¤§é‡å›è¡¨ï¼ˆéšæœº IOï¼‰ï¼Œè€Œå…¨è¡¨æ‰«ææ˜¯é¡ºåº IOï¼Œæˆæœ¬æ›´ä½ï¼Œå› æ­¤ä¼˜åŒ–å™¨é€‰æ‹©å…¨è¡¨æ‰«æã€‚</p>
<h3 data-id="heading-32">é—®é¢˜ 2ï¼šå°è¡¨ï¼ˆ100 è¡Œï¼‰ä¸­ï¼Œç»™<code>name</code>å­—æ®µå»ºç´¢å¼•ï¼ŒæŸ¥è¯¢<code>SELECT * FROM è¡¨ WHERE name='å¼ ä¸‰'</code>ï¼Œä¼šèµ°ç´¢å¼•å—ï¼Ÿ</h3>
<p>ç­”ï¼šå¤§æ¦‚ç‡ä¸ä¼šã€‚å°è¡¨å…¨è¡¨æ‰«æä»…éœ€è¯»å– 1 ä¸ªæ•°æ®é¡µï¼Œå¼€é”€æä½ï¼›èµ°ç´¢å¼•éœ€éå†ç´¢å¼•æ ‘ + å›è¡¨ï¼Œé¢å¤–å¼€é”€è¶…è¿‡æ”¶ç›Šï¼Œä¼˜åŒ–å™¨ä¼šé€‰æ‹©å…¨è¡¨æ‰«æã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç»“åˆConditionå®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç¤ºä¾‹ï¼Œæ¥è¿›ä¸€æ­¥åˆ†æAbstractQueuedSynchronizerçš„å†…éƒ¨å·¥ä½œæœºåˆ¶]]></title>    <link>https://juejin.cn/post/7575182522411810854</link>    <guid>https://juejin.cn/post/7575182522411810854</guid>    <pubDate>2025-11-23T14:19:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575182522411810854" data-draft-id="7575182522411794470" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç»“åˆConditionå®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç¤ºä¾‹ï¼Œæ¥è¿›ä¸€æ­¥åˆ†æAbstractQueuedSynchronizerçš„å†…éƒ¨å·¥ä½œæœºåˆ¶"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-23T14:19:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kevinzeng"/> <meta itemprop="url" content="https://juejin.cn/user/1964143993949127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç»“åˆConditionå®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç¤ºä¾‹ï¼Œæ¥è¿›ä¸€æ­¥åˆ†æAbstractQueuedSynchronizerçš„å†…éƒ¨å·¥ä½œæœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1964143993949127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kevinzeng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:19:56.000Z" title="Sun Nov 23 2025 14:19:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç”Ÿäº§è€… - æ¶ˆè´¹è€…ç¤ºä¾‹ä»£ç </h2>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæœ‰ç•Œç¼“å†²åŒºï¼ˆBounded Bufferï¼‰ï¼Œç”Ÿäº§è€…çº¿ç¨‹å‘ç¼“å†²åŒºä¸­æ”¾å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä»ä¸­å–å‡ºæ•°æ®ã€‚å½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œç”Ÿäº§è€…ä¼šè¢«é˜»å¡ï¼›å½“ç¼“å†²åŒºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…ä¼šè¢«é˜»å¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.LinkedList;
<span class="hljs-keyword">import</span> java.util.Queue;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.Condition;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BoundedBuffer</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Queue&lt;T&gt; queue;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> capacity;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantLock lock;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notFull;  <span class="hljs-comment">// æ¡ä»¶ï¼šç¼“å†²åŒºæœªæ»¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notEmpty; <span class="hljs-comment">// æ¡ä»¶ï¼šç¼“å†²åŒºæœªç©º</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BoundedBuffer</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> {
        <span class="hljs-built_in">this</span>.capacity = capacity;
        <span class="hljs-built_in">this</span>.queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
        <span class="hljs-built_in">this</span>.notFull = lock.newCondition();
        <span class="hljs-built_in">this</span>.notEmpty = lock.newCondition();
    }

    <span class="hljs-comment">// ç”Ÿäº§è€…æ”¾å…¥æ•°æ®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(T item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock(); <span class="hljs-comment">// 1. è·å–ç‹¬å é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. æ£€æŸ¥æ¡ä»¶ï¼Œå¦‚æœç¼“å†²åŒºå·²æ»¡ï¼Œåˆ™ç­‰å¾…</span>
            <span class="hljs-keyword">while</span> (queue.size() == capacity) {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"ï¼šç¼“å†²åŒºå·²æ»¡ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹..."</span>);
                notFull.await(); <span class="hljs-comment">// 3. é‡Šæ”¾é”å¹¶é˜»å¡å½“å‰çº¿ç¨‹</span>
            }

            <span class="hljs-comment">// 4. æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œç”Ÿäº§æ“ä½œ</span>
            queue.add(item);
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"ï¼šç”Ÿäº§äº† "</span> + item + <span class="hljs-string">"ï¼Œå½“å‰ç¼“å†²åŒºå¤§å°ï¼š"</span> + queue.size());

            <span class="hljs-comment">// 5. å”¤é†’ç­‰å¾…"éç©º"æ¡ä»¶çš„æ¶ˆè´¹è€…çº¿ç¨‹</span>
            notEmpty.signal();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">// 6. é‡Šæ”¾é”</span>
        }
    }

    <span class="hljs-comment">// æ¶ˆè´¹è€…å–å‡ºæ•°æ®</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">take</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock(); <span class="hljs-comment">// 1. è·å–ç‹¬å é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. æ£€æŸ¥æ¡ä»¶ï¼Œå¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™ç­‰å¾…</span>
            <span class="hljs-keyword">while</span> (queue.isEmpty()) {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"ï¼šç¼“å†²åŒºä¸ºç©ºï¼Œç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§..."</span>);
                notEmpty.await(); <span class="hljs-comment">// 3. é‡Šæ”¾é”å¹¶é˜»å¡å½“å‰çº¿ç¨‹</span>
            }

            <span class="hljs-comment">// 4. æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œæ¶ˆè´¹æ“ä½œ</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> queue.poll();
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"ï¼šæ¶ˆè´¹äº† "</span> + item + <span class="hljs-string">"ï¼Œå½“å‰ç¼“å†²åŒºå¤§å°ï¼š"</span> + queue.size());

            <span class="hljs-comment">// 5. å”¤é†’ç­‰å¾…"éæ»¡"æ¡ä»¶çš„ç”Ÿäº§è€…çº¿ç¨‹</span>
            notFull.signal();

            <span class="hljs-keyword">return</span> item;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">// 6. é‡Šæ”¾é”</span>
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BoundedBuffer&lt;Integer&gt; buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoundedBuffer</span>&lt;&gt;(<span class="hljs-number">5</span>);

        <span class="hljs-comment">// å¯åŠ¨3ä¸ªç”Ÿäº§è€…çº¿ç¨‹</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">producerId</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5</span>; j++) {
                        <span class="hljs-type">int</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> producerId * <span class="hljs-number">100</span> + j;
                        buffer.put(item);
                        Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿç”Ÿäº§è€—æ—¶</span>
                    }
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }, <span class="hljs-string">"ç”Ÿäº§è€…-"</span> + i).start();
        }

        <span class="hljs-comment">// å¯åŠ¨2ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">consumerId</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">7</span>; j++) {
                        buffer.take();
                        Thread.sleep(<span class="hljs-number">150</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶</span>
                    }
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }, <span class="hljs-string">"æ¶ˆè´¹è€…-"</span> + i).start();
        }
    }
}
</code></pre>
<h4 data-id="heading-1">AQS å†…éƒ¨å·¥ä½œæœºåˆ¶åˆ†æ</h4>
<p><code>ReentrantLock</code>Â å’ŒÂ <code>Condition</code>Â éƒ½æ˜¯åŸºäº AQS å®ç°çš„ã€‚æˆ‘ä»¬æ¥åˆ†æ­¥è§£æä¸Šè¿°ä»£ç ä¸­ AQS çš„å·¥ä½œæµç¨‹ã€‚</p>
<h5 data-id="heading-2">1.Â <code>lock.lock()</code>Â - è·å–ç‹¬å é”</h5>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨Â <code>lock.lock()</code>Â æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨ AQS çš„Â <code>acquire(1)</code>Â æ–¹æ³•ã€‚</p>
<ul>
<li>
<p><strong>AQS çŠ¶æ€ (<code>state</code>)</strong> :</p>
<ul>
<li>
<p><code>state</code>Â åˆå§‹å€¼ä¸º 0ï¼Œè¡¨ç¤ºé”æœªè¢«æŒæœ‰ã€‚</p>
</li>
<li>
<p>ç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨Â <code>tryAcquire(1)</code>ï¼ˆç”±Â <code>ReentrantLock</code>Â å®ç°ï¼‰ï¼š</p>
<ul>
<li>å®ƒä¼šæ£€æŸ¥Â <code>state</code>Â æ˜¯å¦ä¸º 0ã€‚</li>
<li>å¦‚æœæ˜¯ï¼Œå®ƒä¼šä½¿ç”¨ CAS (Compare-and-Swap) æ“ä½œå°†Â <code>state</code>Â ä» 0 ä¿®æ”¹ä¸º 1ã€‚</li>
<li>å¦‚æœ CAS æˆåŠŸï¼Œå®ƒä¼šå°†Â <code>exclusiveOwnerThread</code>ï¼ˆAQS çš„ä¸€ä¸ªå±æ€§ï¼‰è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å·²è·å–é”ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å¦‚æœè·å–æˆåŠŸ</strong>ï¼šçº¿ç¨‹ç»§ç»­æ‰§è¡ŒÂ <code>put</code>Â æˆ–Â <code>take</code>Â æ–¹æ³•çš„åç»­é€»è¾‘ã€‚</p>
</li>
<li>
<p><strong>å¦‚æœè·å–å¤±è´¥</strong>ï¼ˆå³Â <code>state</code>Â ä¸ä¸º 0ï¼Œä¸”æŒæœ‰é”çš„ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼‰ï¼š</p>
<ul>
<li>AQS ä¼šåˆ›å»ºä¸€ä¸ª<strong>ç‹¬å æ¨¡å¼</strong>çš„Â <code>Node</code>Â å¯¹è±¡ï¼Œå°†å½“å‰çº¿ç¨‹å°è£…è¿›å»ã€‚</li>
<li>è¿™ä¸ªÂ <code>Node</code>Â ä¼šè¢«åŠ å…¥åˆ° AQS å†…éƒ¨ç»´æŠ¤çš„ä¸€ä¸ª<strong>FIFO é˜»å¡é˜Ÿåˆ—</strong>ï¼ˆCLH é˜Ÿåˆ—ï¼‰çš„å°¾éƒ¨ã€‚</li>
<li>ç„¶åï¼Œå½“å‰çº¿ç¨‹ä¼šè°ƒç”¨Â <code>LockSupport.park()</code>Â æ–¹æ³•å°†è‡ªå·±é˜»å¡ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-3">2.Â <code>condition.await()</code>Â - ç­‰å¾…æ¡ä»¶</h5>
<p>å½“çº¿ç¨‹è·å–é”åï¼Œè¿›å…¥Â <code>put</code>Â æˆ–Â <code>take</code>Â æ–¹æ³•ï¼Œå‘ç°æ¡ä»¶ä¸æ»¡è¶³ï¼ˆå¦‚ç¼“å†²åŒºæ»¡æˆ–ç©ºï¼‰ï¼Œå®ƒä¼šè°ƒç”¨Â <code>condition.await()</code>ã€‚</p>
<ul>
<li>
<p><strong>åˆ›å»ºæ¡ä»¶é˜Ÿåˆ—èŠ‚ç‚¹</strong>:</p>
<ul>
<li><code>Condition</code>Â å¯¹è±¡å†…éƒ¨ä¹Ÿç»´æŠ¤ç€ä¸€ä¸ª<strong>æ¡ä»¶é˜Ÿåˆ—</strong>ã€‚è¿™ä¸ªé˜Ÿåˆ—å’Œ AQS çš„ä¸»é˜»å¡é˜Ÿåˆ—æ˜¯åˆ†å¼€çš„ã€‚</li>
<li><code>await()</code>Â æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Â <code>Node</code>ï¼ˆå…¶Â <code>waitStatus</code>Â ä¸ºÂ <code>Node.CONDITION</code>ï¼‰ï¼Œå¹¶å°†å½“å‰çº¿ç¨‹æ”¾å…¥è¿™ä¸ªæ¡ä»¶é˜Ÿåˆ—ä¸­ã€‚</li>
</ul>
</li>
<li>
<p><strong>é‡Šæ”¾é”</strong>:</p>
<ul>
<li>è¿™æ˜¯å…³é”®ä¸€æ­¥ã€‚<code>await()</code>Â ä¼šè°ƒç”¨ AQS çš„Â <code>release(1)</code>Â æ–¹æ³•ï¼Œ<strong>é‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„é”</strong>ã€‚</li>
<li><code>release</code>Â æ–¹æ³•ä¼šè°ƒç”¨Â <code>tryRelease(1)</code>ï¼ˆç”±Â <code>ReentrantLock</code>Â å®ç°ï¼‰ï¼Œå°†Â <code>state</code>Â ä» 1 å‡å› 0ï¼Œå¹¶æ¸…ç©ºÂ <code>exclusiveOwnerThread</code>ã€‚</li>
<li>ç„¶åï¼Œå®ƒä¼šæ£€æŸ¥ AQS ä¸»é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ä¸ºç©ºï¼Œå®ƒä¼šå”¤é†’é˜Ÿåˆ—å¤´éƒ¨çš„çº¿ç¨‹ï¼Œè®©å®ƒæœ‰æœºä¼šå»ç«äº‰é”ã€‚</li>
</ul>
</li>
<li>
<p><strong>é˜»å¡çº¿ç¨‹</strong>:</p>
<ul>
<li>åœ¨é‡Šæ”¾é”ä¹‹åï¼Œè°ƒç”¨Â <code>await()</code>Â çš„çº¿ç¨‹ä¼šå†æ¬¡è°ƒç”¨Â <code>LockSupport.park()</code>Â å°†è‡ªå·±é˜»å¡ã€‚æ­¤æ—¶ï¼Œå®ƒç­‰å¾…çš„ä¸å†æ˜¯é”ï¼Œè€Œæ˜¯ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„å”¤é†’ä¿¡å·ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-4">3.Â <code>condition.signal()</code>Â - å”¤é†’ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹</h5>
<p>å½“å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæ¯”å¦‚æ¶ˆè´¹è€…ï¼‰æ‰§è¡Œäº†Â <code>notFull.signal()</code>Â æˆ–Â <code>notEmpty.signal()</code>Â æ—¶ï¼š</p>
<ul>
<li>
<p><strong>ä»æ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°ä¸»é˜Ÿåˆ—</strong>:</p>
<ul>
<li><code>signal()</code>Â æ–¹æ³•ä¼šä»å®ƒçš„æ¡ä»¶é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªç­‰å¾…æœ€ä¹…çš„Â <code>Node</code>ï¼ˆé€šå¸¸æ˜¯å¤´éƒ¨èŠ‚ç‚¹ï¼‰ã€‚</li>
<li>å®ƒä¼šå°†è¿™ä¸ªÂ <code>Node</code>Â çš„çŠ¶æ€ä»Â <code>Node.CONDITION</code>Â æ”¹å˜ä¸ºÂ <code>Node.SIGNAL</code>ã€‚</li>
<li>ç„¶åï¼Œè¿™ä¸ªÂ <code>Node</code>Â ä¼šè¢«<strong>è½¬ç§»</strong>åˆ° AQS çš„<strong>ä¸»é˜»å¡é˜Ÿåˆ—</strong>çš„å°¾éƒ¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç­‰å¾…å†æ¬¡ç«äº‰é”</strong>:</p>
<ul>
<li>è¢«è½¬ç§»çš„çº¿ç¨‹æ­¤æ—¶ä»ç„¶æ˜¯é˜»å¡çŠ¶æ€ã€‚å®ƒéœ€è¦ç­‰å¾…ä¸»é˜Ÿåˆ—ä¸­æ’åœ¨å®ƒå‰é¢çš„çº¿ç¨‹éƒ½å¤„ç†å®Œï¼Œå¹¶ä¸”å½“å®ƒè‡ªå·±æˆä¸ºé˜Ÿåˆ—å¤´éƒ¨æ—¶ï¼Œæ‰æœ‰æœºä¼šè¢«å”¤é†’ï¼Œé‡æ–°å»ç«äº‰é”ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-5">4.Â <code>lock.unlock()</code>Â - é‡Šæ”¾é”</h5>
<p>å½“çº¿ç¨‹å®ŒæˆÂ <code>put</code>Â æˆ–Â <code>take</code>Â æ“ä½œåï¼Œä¼šåœ¨Â <code>finally</code>Â å—ä¸­è°ƒç”¨Â <code>lock.unlock()</code>ã€‚</p>
<ul>
<li>è¿™åŒæ ·ä¼šè°ƒç”¨ AQS çš„Â <code>release(1)</code>Â æ–¹æ³•ã€‚</li>
<li><code>tryRelease(1)</code>Â ä¼šå‡å°‘Â <code>state</code>ã€‚å¯¹äºéé‡å…¥é”ï¼Œ<code>state</code>Â å˜ä¸º 0ã€‚</li>
<li>AQS ä¼šæ£€æŸ¥ä¸»é˜»å¡é˜Ÿåˆ—ã€‚å¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå®ƒä¼šå”¤é†’é˜Ÿåˆ—å¤´éƒ¨çš„çº¿ç¨‹ï¼Œè®©å®ƒå°è¯•è·å–é”ã€‚</li>
</ul>
<h4 data-id="heading-6">æ€»ç»“ï¼šAQS çš„æ ¸å¿ƒè§’è‰²</h4>
<p>åœ¨è¿™ä¸ªç”Ÿäº§è€… - æ¶ˆè´¹è€…ç¤ºä¾‹ä¸­ï¼ŒAQS æ‰®æ¼”äº†ä»¥ä¸‹å‡ ä¸ªå…³é”®è§’è‰²ï¼š</p>
<ol>
<li><strong>åŒæ­¥çŠ¶æ€ç®¡ç†å™¨ (<code>state</code>)</strong> : é€šè¿‡ä¸€ä¸ªç®€å•çš„æ•´æ•°Â <code>state</code>Â å’Œ CAS æ“ä½œï¼Œé«˜æ•ˆåœ°ç®¡ç†é”çš„è·å–ä¸é‡Šæ”¾ã€‚</li>
<li><strong>ç‹¬å é”æŒæœ‰è€…è®°å½•å™¨ (<code>exclusiveOwnerThread</code>)</strong> : è®°å½•å½“å‰æŒæœ‰ç‹¬å é”çš„çº¿ç¨‹ï¼Œç”¨äºå®ç°é‡å…¥å’Œé”é‡Šæ”¾çš„æ­£ç¡®æ€§ã€‚</li>
<li><strong>çº¿ç¨‹é˜»å¡é˜Ÿåˆ— (CLH Queue)</strong> : å½“çº¿ç¨‹è·å–é”å¤±è´¥æ—¶ï¼ŒAQS å°†å…¶å°è£…æˆÂ <code>Node</code>Â æ”¾å…¥æ­¤é˜Ÿåˆ—ï¼Œå¹¶é˜»å¡çº¿ç¨‹ã€‚è¿™æ˜¯çº¿ç¨‹çš„ â€œå€™å®¢å…â€ã€‚</li>
<li><strong>æ¡ä»¶å˜é‡æ”¯æŒ</strong>:Â <code>Condition</code>Â å¯¹è±¡åˆ©ç”¨ AQS çš„åŸºç¡€åŠŸèƒ½ï¼Œå®ç°äº†ç‹¬ç«‹çš„æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ã€‚å®ƒå…è®¸çº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæš‚æ—¶æ”¾å¼ƒé”å¹¶ç­‰å¾…ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ï¼š</p>
<ul>
<li><strong>çº¿ç¨‹</strong>æ˜¯æƒ³è¦è¿›å…¥æˆ¿é—´ï¼ˆä¸´ç•ŒåŒºï¼‰çš„äººã€‚</li>
<li><strong>AQS çš„Â <code>state</code></strong>Â æ˜¯æˆ¿é—´çš„é’¥åŒ™ã€‚</li>
<li><strong>AQS ä¸»é˜Ÿåˆ—</strong>æ˜¯æˆ¿é—´å¤–çš„ç­‰å€™é˜Ÿä¼ã€‚</li>
<li><strong><code>Condition</code>Â çš„æ¡ä»¶é˜Ÿåˆ—</strong>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¼‘æ¯å®¤ï¼Œå½“æˆ¿é—´é‡Œçš„äººå‘ç° â€œå’–å•¡è¿˜æ²¡ç…®å¥½â€ï¼ˆæ¡ä»¶ä¸æ»¡è¶³ï¼‰ï¼Œä»–ä¼šæš‚æ—¶æŠŠé’¥åŒ™è¿˜ç»™å‰å°ï¼ˆé‡Šæ”¾é”ï¼‰ï¼Œç„¶åå»ä¼‘æ¯å®¤ç­‰å¾…ï¼Œç›´åˆ°æœ‰äººé€šçŸ¥ä»– â€œå’–å•¡ç…®å¥½äº†â€ï¼ˆ<code>signal</code>ï¼‰ï¼Œä»–æ‰ä¼šå›åˆ°ç­‰å€™é˜Ÿä¼çš„æœ«å°¾ï¼Œé‡æ–°æ’é˜Ÿç­‰å¾…è¿›å…¥æˆ¿é—´ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å·Javaç³»åˆ—ä¹‹ä¸€ä¸ªæ¥å£çš„è¯ç”Ÿ]]></title>    <link>https://juejin.cn/post/7575412016404430858</link>    <guid>https://juejin.cn/post/7575412016404430858</guid>    <pubDate>2025-11-23T14:26:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575412016404430858" data-draft-id="7575456858427129902" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å·Javaç³»åˆ—ä¹‹ä¸€ä¸ªæ¥å£çš„è¯ç”Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-23T14:26:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ´ç€çœ¼é•œçš„å¹³å¤´å“¥"/> <meta itemprop="url" content="https://juejin.cn/user/2471357868159544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å·Javaç³»åˆ—ä¹‹ä¸€ä¸ªæ¥å£çš„è¯ç”Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2471357868159544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ´ç€çœ¼é•œçš„å¹³å¤´å“¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:26:24.000Z" title="Sun Nov 23 2025 14:26:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ol>
<li>
<h2 data-id="heading-0">æ‘˜è¦</h2>
</li>
</ol>
<p>æœ¬æ–‡ä»¥è‹¥ä¾æ¡†æ¶ä¸ºä¾‹ï¼Œé˜è¿°ä½¿ç”¨Javaåç«¯çš„ä¸€ç³»åˆ—æŠ€æœ¯å®ç°ä¸€ä¸ªåç«¯æ¥å£ï¼Œä¸ºä»€ä¹ˆè¦åŸºäºè‹¥ä¾æ¡†æ¶ï¼Œå› ä¸ºè¿˜æ˜¯æƒ³ä»çœŸå®å·¥ç¨‹çš„è§’åº¦æè¿°Javaåç«¯å®ç°æ¥å£çš„æµç¨‹ï¼Œå¦‚æœä»…ä»…æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œæˆ‘ç›¸ä¿¡ä½ å¯ä»¥ç”¨å¾ˆå¤šæŠ€æœ¯å®ç°ï¼Œæ¯”å¦‚ç”¨åŸç”ŸNodeçš„Httpæ¨¡å—æˆ–è€…ä½¿ç”¨Expressã€Koaç­‰å‰ç«¯æ¡†æ¶ã€‚è™½ç„¶ç½‘ä¸Šå¯¹è‹¥ä¾æ¡†æ¶è¤’è´¬ä¸ä¸€æ ·ï¼Œä½†æ˜¯å­¦ä¸œè¥¿è¿˜æ˜¯è¦ç”¨äººä¹‹é•¿çš„çœ¼å…‰å»çœ‹å¾…ã€‚æ ‡é¢˜åç§°è™½ç„¶æ˜¯å‰ç«¯å·Javaï¼Œå¹¶ä¸ä»£è¡¨æ˜¯Javaå°ç™½ç³»åˆ—æ–‡ç« ï¼Œå› ä¸ºç¬”è€…å·¥ä½œåå‘å‰ç«¯ï¼Œæ‰€ä»¥æ ‡é¢˜æ˜¯å‰ç«¯å·Javaï¼Œä¸è¿‡è¿˜æ˜¯éœ€è¦ä¸€äº›JavaåŸºç¡€çš„ï¼Œå¦å¤–è¿™æ˜¯ä¸€ç¯‡JavaæŠ€æœ¯æ™®åŠçš„æ–‡ç« ï¼Œæ­ç¤ºçœŸå®å·¥ç¨‹ä¸­å®ç°ä¸€ä¸ªæ¥å£åˆ°åº•ç”¨åˆ°äº†å“ªäº›JavaæŠ€æœ¯ï¼Œå¯¹äºæŸä¸ªæŠ€æœ¯çš„æ·±å…¥ç ”ç©¶ï¼Œç¬”è€…åç»­ä¼šæ…¢æ…¢æ‹†è§£ã€‚</p>
<ol start="2">
<li>
<h2 data-id="heading-1">ç›®æ ‡èšç„¦</h2>
</li>
</ol>
<p>å®ç°ä¸€ä¸ªæ ¹æ®IdæŸ¥è¯¢ä¸€æ¡é—®å€™è¯­çš„æ¥å£ï¼Œç†Ÿæ‚‰æ¥å£å¼€å‘æµç¨‹å’Œä½¿ç”¨çš„æ¡†æ¶ï¼Œæ¥å£å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33615c8b6d7e4dc298ebb4251033f202~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oi0552A55y86ZWc55qE5bmz5aS05ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514090&amp;x-signature=xDyC4iu4UfbBk6Px5l5eE3o5l5g%3D" alt="560928daa2f6d92e7d32fe898fbfbc86.png" loading="lazy"/></p>
<p>è¿™æ˜¯ä¸€ä¸ªGETæ¥å£ï¼Œé€šè¿‡åœ¨urlä¸Šæ‹¼æ¥æŸ¥è¯¢å‚æ•°idå‘åç«¯ä¼ é€’å‚æ•°ï¼Œä»¥ä¾¿æŸ¥è¯¢è¿™æ¡idå¯¹åº”çš„é—®å€™è¯­ï¼Œæ²¡é”™å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬çš„é‡ç‚¹æ˜¯ç†Ÿæ‚‰åŸºæœ¬çš„å¼€å‘æµç¨‹å’Œä½¿ç”¨çš„æ¡†æ¶ï¼Œå› æ­¤ä¾‹å­è¶Šç®€å•è¶Šå¥½ã€‚</p>
<ol start="3">
<li>
<h2 data-id="heading-2">å…·ä½“å®ç°</h2>
</li>
</ol>
<p>å…ˆçœ‹ä¸‹è¿™ä¸ªæ¥å£åœ¨ä»£ç ä¸­çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/system/greeting")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreetingController</span> {
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> GreetingService greetingService;
    <span class="hljs-meta">@GetMapping("/getGreetingById")</span>
    <span class="hljs-keyword">public</span> CommonResult&lt;GreetingDO&gt; <span class="hljs-title function_">getGreetingById</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("id")</span> Long id)</span> {
        <span class="hljs-type">GreetingDO</span> <span class="hljs-variable">greeting</span> <span class="hljs-operator">=</span> greetingService.getGreetingById(id);
        <span class="hljs-keyword">return</span> success(greeting);
    }}
</code></pre>
<p>è¿™é‡Œç‰µæ‰¯åˆ°å¾ˆå¤šæ³¨è§£(@å¼€å¤´çš„)ï¼Œæˆ‘ä»¬å…ˆä¸çœ‹ï¼Œæœ€æ ¸å¿ƒçš„ä»£ç æ˜¯ç¬¬11å¥ï¼Œè°ƒç”¨äº†greetingServiceçš„getGreetingByIdæ–¹æ³•æŸ¥è¯¢å¾—åˆ°äº†ä¸€æ¡é—®å€™è¯­ã€‚greetingServiceæ˜¯ä¸€ä¸ªGreetingServiceçš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆæ²¡æœ‰newå‘¢ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰åˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºSpringæ¡†æ¶å¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªï¼Œå¾—ç›Šäº@Resourceè¿™ä¸ªæ³¨è§£ï¼ŒSpringæœ‰ä¸ªé­”æ³•å«ä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä½ éœ€è¦ä»€ä¹ˆæ ·çš„å¯¹è±¡ï¼Œä½ ä¸ç”¨è‡ªå·±åˆ›å»ºï¼Œä½ å°±å‘Šè¯‰Springï¼ŒSpringå¸®ä½ åˆ›å»ºã€‚ä¸è¿‡è¿™æœ‰ä¸ªå‰æï¼Œå°±æ˜¯ä½ è¦å‘Šè¯‰Springè¿™ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œä¹Ÿå°±æ˜¯GreetingServiceã€‚</p>
<p>GreetingServiceå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GreetingService</span> {
    GreetingDO  <span class="hljs-title function_">getGreetingById</span><span class="hljs-params">(Long id)</span>;
}
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç±»ä¼¼TypeScriptä¸­çš„æ¥å£ä¸€æ ·ï¼Œå®šä¹‰äº†è¿™ä¸ªå¯¹è±¡çš„å½¢çŠ¶ï¼Œä½†è¿™ä¸ªä»…ä»…æ˜¯å¯¹è±¡çš„å½¢çŠ¶ï¼Œå°±åƒæ˜¯ä¸€ä¸ªæ±½è½¦çš„ç»“æ„å›¾ä¸€æ ·ï¼Œç¼ºå°‘å…·ä½“çš„å®ç°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…·ä½“çš„æ¨¡å­ï¼Œè®©Springç”¨è¿™ä¸ªæ¨¡å­ï¼Œé€ ä¸€ä¸ªæ±½è½¦å‡ºæ¥ï¼Œè¿™ä¸ªå…·ä½“çš„æ¨¡å­æ˜¯GreetingServiceImplï¼Œå®ƒå®ç°äº†GreetingServiceè¿™ä¸ªæ¥å£ã€‚</p>
<p>GreetingServiceImplå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreetingServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GreetingService</span>{
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> GreetingMapper greetingMapper;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> GreetingDO <span class="hljs-title function_">getGreetingById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> greetingMapper.selectById(id);
    }
}
</code></pre>
<p>GreetingServiceImplè¿™ä¸ªç±»ä¸­æœ€å…³é”®çš„æ˜¯ç¬¬5å¥ä½¿ç”¨äº†greetingMapperè°ƒç”¨äº†selectByIdæ–¹æ³•æŸ¥è¯¢é—®å€™è¯­ï¼Œé‚£greetingMapperæ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Œæ²¡é”™ï¼Œé€šè¿‡ç¬¬4å¥çš„å£°æ˜ï¼ŒSpringå¸®æˆ‘ä»¬åˆ›å»ºé€ å‡ºæ¥çš„ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªGreetingMapperçš„æ¨¡å­å‘Šè¯‰Springç…§ç€è¿™ä¸ªæ¨¡å­é€ ä¸€ä¸ªgreetingMapperå®ä¾‹(å¯¹è±¡)å‡ºæ¥ã€‚</p>
<p>GreetingMapperå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GreetingMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapperX</span>&lt;GreetingDO&gt; {
}
</code></pre>
<p>æ‡µäº†ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰selectByIdè¿™ä¸ªæ–¹æ³•ï¼Œèªæ˜çš„ä½ è‚¯å®šå‘ç°äº†extends(ç»§æ‰¿)ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä»BaseMapperXç»§æ‰¿è¿‡æ¥ï¼ŒBaseMapperXæ˜¯è‹¥ä¾æ¡†æ¶å°è£…çš„ï¼Œå®ƒåœ¨MybatisPlusçš„BaseMapperåˆæ·»åŠ äº†ä¸€äº›æ–¹æ³•ã€‚MyBatis-Plusæ˜¯MyBatisçš„å¢å¼ºç‰ˆï¼ŒMyBatisæ˜¯ä¸€ä¸ªJavaæŒä¹…å±‚æ¡†æ¶ï¼Œæ„æ€å°±æ˜¯å®ƒå¸®ä½ æŠŠå†…å­˜ä¸­å¤„ç†æ“ä½œçš„å¯¹è±¡æ”¾åˆ°æ•°æ®åº“ä¸­ä¿å­˜èµ·æ¥æˆ–è€…ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°ä½ éœ€è¦çš„æ•°æ®æ”¾åˆ°å†…å­˜ä¸­æ¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­ä¿å­˜çš„é—®å€™è¯­æ•°æ®ã€‚è‡³æ­¤ï¼Œè¿™ä¸ªæ–¹æ³•åŸºæœ¬ç»“æŸã€‚</p>
<ol start="4">
<li>
<h2 data-id="heading-3">æ•´ä½“æµç¨‹</h2>
</li>
</ol>
<p>æˆ‘æŠŠæ­¥éª¤3çš„æµç¨‹ç»˜åˆ¶æˆäº†å¦‚ä¸‹çš„UMLäº¤äº’å›¾ï¼Œä»¥ä¾¿æ›´æ¸…æ™°çš„æè¿°æ•´ä¸ªæ¥å£å®ç°çš„æµç¨‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78bb376e78d14b64a34d1978a716633e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oi0552A55y86ZWc55qE5bmz5aS05ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514090&amp;x-signature=VFq9LpN4cqUteXS%2FyFtlHQjMVbA%3D" alt="" loading="lazy"/></p>
<p>ä»è¿™ä¸ªå›¾å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¸‰å±‚æ¶æ„ï¼Œåˆ†ä¸ºControllerå±‚ã€Serviceå±‚ã€DALå±‚</p>
<p>Controllerå±‚(æ§åˆ¶å±‚)ï¼šæ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè°ƒç”¨Serviceå±‚çš„æ–¹æ³•çš„å¾—åˆ°ç»“æœï¼Œå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>Serviceå±‚(ä¸šåŠ¡é€»è¾‘å±‚)ï¼šæ¥å—æ§åˆ¶å±‚çš„ä¼ å‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨DALå±‚çš„æ–¹æ³•ï¼Œå°†ç»“æœè¿”å›ç»™Controllerå±‚ã€‚</p>
<p>DALå±‚(æ•°æ®è®¿é—®å±‚æˆ–å«Mapper)ï¼šæ¥å—Serviceå±‚çš„ä¼ å‚ï¼Œè°ƒç”¨JDBCå®Œæˆæ•°æ®åº“çš„æ•°æ®æ“ä½œï¼Œå°†ç»“æœè¿”å›ç»™Serviceå±‚ã€‚</p>
<p>ä¸Šå›¾ä¸­è¿˜æœ‰ä¸€äº›æ¨¡å—æ²¡æœ‰ä»‹ç»</p>
<p>GreetingSaveReqVOï¼šé—®å€™è¯­è¯·æ±‚å®ä½“å¯¹è±¡ï¼Œç”¨äºæ¥å—å®¢æˆ·ç«¯ä¼ é€’è¿‡æ¥çš„é—®å€™è¯­å®ä½“ï¼Œå°±æ˜¯ä¸€ä¸ªJavaç±»ã€‚</p>
<p>GreetingDO: é—®å€™è¯­æ•°æ®å¯¹è±¡ï¼Œæ˜¯å’Œæ•°æ®åº“è¡¨ä¸­çš„å­—æ®µä¸€ä¸€å¯¹è±¡çš„JavaåŸç”Ÿå¯¹è±¡ï¼Œæœ‰äº›è§„èŒƒä¸­å«POï¼Œä¹Ÿæ˜¯ä¸€ä¸ªJavaç±»ã€‚</p>
<p>BaseDOï¼šè‹¥ä¾æ¡†æ¶å°è£…çš„ä¸€ä¸ªDOï¼ŒåŒ…å«äº†ä¸€ä¸ªå…¬ç”¨çš„å­—æ®µæ¯”å¦‚createTimeåˆ›å»ºæ—¶é—´ã€updateTimeæ›´æ–°æ—¶é—´ã€creatoråˆ›å»ºäººã€updateræ›´æ–°äººã€deletedé€»è¾‘åˆ é™¤å­—æ®µã€‚</p>
<p>å…³äºè¿™äº›Oçš„æ¦‚å¿µï¼Œæˆ‘æ€»ç»“äº†ä¸€ä¸‹ï¼š</p>





























































<table><thead><tr><th>å…¨ç§°</th><th>ç®€ç§°</th><th>ä¸­æ–‡</th><th>ç”¨é€”</th><th>æ˜¯å¦æš´æ¼ç»™å‰ç«¯</th><th>æ˜¯å¦æ˜ å°„æ•°æ®åº“</th></tr></thead><tbody><tr><td>Plain Old Java Object</td><td>POJO</td><td>ç®€å•Javaå¯¹è±¡</td><td>æ— ç‰¹æ®Šé™åˆ¶çš„æ™®é€šJavaç±»</td><td>å¦</td><td>å¦</td></tr><tr><td>Persistent Object</td><td>PO</td><td>æŒä¹…åŒ–å¯¹è±¡</td><td>ä¸æ•°æ®åº“è¡¨ä¸€ä¸€å¯¹è±¡ï¼Œé€šå¸¸ä¸ORMæ˜ å°„</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>View Object</td><td>VO</td><td>è§†å›¾å¯¹è±¡</td><td>å±•ç¤ºå±‚æ•°æ®ï¼Œç”¨äºå‘å‰ç«¯è¿”å›æ•°æ®</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>Business Object</td><td>BO</td><td>ä¸šåŠ¡å¯¹è±¡</td><td>å°è£…æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„å¯¹è±¡</td><td>å¦</td><td>å¦</td></tr><tr><td>Data Transfer Object</td><td>DTO</td><td>æ•°æ®ä¼ è¾“å¯¹è±¡</td><td>ç”¨äºä¸åŒå±‚æˆ–æœåŠ¡ä¹‹é—´ä¼ é€’æ•°æ®</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>Data Access Object</td><td>DAO</td><td>æ•°æ®è®¿é—®å¯¹è±¡</td><td>ä¸æ•°æ®åº“äº¤äº’çš„æ¥å£æˆ–ç±»ï¼Œè´Ÿè´£æŒä¹…åŒ–æ“ä½œ</td><td>å¦</td><td>æ˜¯</td></tr></tbody></table>
<p>POJOï¼šæ³›æŒ‡Javaä¸­çš„å¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡å¦‚POã€BOã€DTOç­‰éƒ½å¯ä»¥æ˜¯POJO</p>
<p>POï¼šä¸æ•°æ®åº“è¡¨ä¸€ä¸€æ˜ å°„ï¼Œé€šå¸¸ä½¿ç”¨JPAæ³¨è§£æˆ–MyBatisæ³¨è§£</p>
<p>DO: æ•°æ®å¯¹è±¡ï¼Œä¸šåŠ¡å¯¹è±¡ï¼Œé¢†åŸŸæ¨¡å‹ï¼Œç”¨äºä¸šåŠ¡å¤„ç†ï¼Œæœ‰äº›é¡¹ç›®ä¼šå½“POä½¿ç”¨ã€‚</p>
<p>VO: ç”¨äºè¿”å›ç»™å‰ç«¯å±•ç¤ºçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå¯¹è±¡çš„ç»„åˆæ•°æ®</p>
<p>BO: å°è£…ä¸šåŠ¡é€»è¾‘çš„å¯¹è±¡ï¼Œé€šå¸¸ç”¨äºServiceå±‚å†…éƒ¨å¤„ç†</p>
<p>DTOï¼šç”¨äºæ¥å£å‚æ•°ä¼ é€’å’Œè·¨å±‚æ•°æ®ä¼ è¾“ï¼Œå¦‚Controlleræ¥å—å‰ç«¯ä¼ é€’è¿‡æ¥å¯¹è±¡ï¼Œæˆ–è€…å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨ä¼ å‚</p>
<p>DAOï¼šç”¨äºæ“ä½œæ•°æ®åº“çš„æ¥å£æˆ–ç±»ã€‚</p>
<p>ä¸ºäº†æ›´æ¸…æ¥šåœ°å±•ç°æ•´ä½“æµç¨‹ï¼Œæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ç»˜åˆ¶äº†æ—¶åºå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd727ecb1e1d44eeafcf00074969bde3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oi0552A55y86ZWc55qE5bmz5aS05ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514090&amp;x-signature=vkbuNHOnpiZklthF%2FD%2BPQYmaCNU%3D" alt="" loading="lazy"/></p>
<p>ä¸Šé¢è¿™ä¸ªå›¾åº”è¯¥æ¸…æ™°åœ°å±•ç°äº†getGreetingByIdæ¥å£ç‰µæ‰¯åˆ°çš„å„ä¸ªæ¨¡å—(ç±»)ä¹‹é—´çš„è°ƒç”¨æµç¨‹ã€‚</p>
<blockquote>
<p>äººç”Ÿæ˜¯ä¸€ä¸ªæ¼«é•¿è€Œè‰°è¾›çš„æ¥åŠ›èµ›ï¼Œæœ‰æ—¶é¢†å…ˆï¼Œæœ‰æ—¶è½åï¼Œä½†æ˜¯ä½ åªè¦åœ¨è·¯ä¸Šï¼Œå°±æœ‰æœºä¼šï¼ŒåŠæ—¶è¡Œä¹ï¼Œå°±åƒæ˜¯ä¸€æ”¯å…´å¥‹å‰‚ï¼Œå®ƒèƒ½å¤Ÿç‚¹ç‡ƒå¹¸ç¦çš„åå½©ï¼Œä¹Ÿèƒ½åŠ é€Ÿç”Ÿå‘½çš„è¡°è´¥ï¼Œæ‰€ä»¥äººè¿˜æ˜¯è¦é€‚å½“çš„æœ‰ä¸€äº›èŠ‚åˆ¶ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…­è¾¹å½¢æ¶æ„ï¼Ÿå°ç™½ä¹Ÿèƒ½ç§’æ‡‚çš„ã€ŒæŠ—é€ ä»£ç ç§˜è¯€ã€]]></title>    <link>https://juejin.cn/post/7575468252656222249</link>    <guid>https://juejin.cn/post/7575468252656222249</guid>    <pubDate>2025-11-23T14:31:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575468252656222249" data-draft-id="7575425466905362495" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…­è¾¹å½¢æ¶æ„ï¼Ÿå°ç™½ä¹Ÿèƒ½ç§’æ‡‚çš„ã€ŒæŠ—é€ ä»£ç ç§˜è¯€ã€"/> <meta itemprop="keywords" content="åç«¯,æ¶æ„,Java"/> <meta itemprop="datePublished" content="2025-11-23T14:31:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘å«é»‘å¤§å¸…"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…­è¾¹å½¢æ¶æ„ï¼Ÿå°ç™½ä¹Ÿèƒ½ç§’æ‡‚çš„ã€ŒæŠ—é€ ä»£ç ç§˜è¯€ã€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘å«é»‘å¤§å¸…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:31:58.000Z" title="Sun Nov 23 2025 14:31:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å…­è¾¹å½¢æ¶æ„ï¼Ÿå°ç™½ä¹Ÿèƒ½ç§’æ‡‚çš„ã€ŒæŠ—é€ ä»£ç ç§˜è¯€ã€</h2>
<h4 data-id="heading-1">ğŸ˜© å¼€ç¯‡æš´å‡»ï¼šä¸ºå•¥æ”¹ä¸€è¡Œä»£ç ï¼Œå´©äº†ä¸‰ä¸ªæœåŠ¡ï¼Ÿ</h4>
<p>åšå¼€å‘æœ€å´©æºƒçš„æ—¶åˆ»ï¼šäº§å“è¯´ â€œåŠ ä¸ªå°ç¨‹åºç«¯â€ï¼Œä½ æ”¹å®Œå‰ç«¯æ”¹åç«¯ï¼Œæ”¹å®Œåç«¯æ”¹æ•°æ®åº“ï¼Œæœ€åå‘ç°è®¢å•é€»è¾‘å´©äº†ï¼›æµ‹è¯•è¯´ â€œæ¢ä¸ªç¼“å­˜ä¸­é—´ä»¶â€ï¼Œä½ æ‰’ç€ä»£ç æ”¹äº†ä¸‰å¤©ï¼Œè¿˜æŠŠç”¨æˆ·æ•°æ®æä¸¢äº†â€¦ è¿™å°±æ˜¯ä¼ ç»Ÿä»£ç  â€œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«â€ çš„å‘ï¼ä»Šå¤©è¦è®²çš„ã€Œå…­è¾¹å½¢æ¶æ„ã€ï¼Œå°±æ˜¯ä¸“æ²»è¿™ç§ â€œä»£ç éª¨è´¨ç–æ¾â€ çš„ç¥è¯âœ¨ åˆ«è¢«åå­—å“åˆ°ï¼Œå®ƒæœ¬è´¨æ˜¯ä¸ª â€œè®©ä¸šåŠ¡å½“è€å¤§ï¼ŒæŠ€æœ¯å½“å°å¼Ÿâ€ çš„è®¾è®¡æ€è·¯ã€‚</p>
<h4 data-id="heading-2">ğŸ”· ä¸ºå•¥å« â€œå…­è¾¹å½¢â€ï¼Ÿä¸æ˜¯å› ä¸ºç¨‹åºå‘˜çˆ±å‡ ä½•ï¼</h4>
<p>2005 å¹´æœ‰ä¸ªå« Alistair Cockburn çš„å¤§ç¥å‘æ˜è¿™æ¶æ„æ—¶ï¼Œç”»äº†å¼ å›¾ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘è¹²åœ¨æ­£ä¸­é—´ï¼Œå‘¨å›´ä¼¸å‡ºå…­ä¸ª â€œæ¥å£è§¦è§’â€ è¿æ¥å¤–ç•Œï¼Œçœ‹èµ·æ¥åƒä¸ªå…­è¾¹å½¢ã€‚è¿™å›¾è—ç€ä¸ªå…³é”®æ€æƒ³ï¼š<strong>æ‰€æœ‰å¤–éƒ¨ç³»ç»Ÿï¼ˆç½‘é¡µã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹æ¥å£ï¼‰éƒ½å¾— â€œä½å¤´â€ é€šè¿‡ç»Ÿä¸€æ¥å£æ‰¾æ ¸å¿ƒï¼Œæ ¸å¿ƒå´ä»ä¸æ­ç†å®ƒä»¬çš„ â€œå°è„¾æ°”â€</strong> ã€‚</p>
<p>æ‰“ä¸ªæ¯”æ–¹ï¼šæ ¸å¿ƒé€»è¾‘æ˜¯ä½ å®¶å®¢å…ğŸ»ï¼Œå…­è¾¹å½¢çš„å…­æ¡è¾¹æ˜¯å®¶é—¨ğŸšªï¼ˆç«¯å£ï¼‰ï¼Œé—¨å£çš„é‹æ¶ã€é—¨ç¦ã€å¿«é€’æŸœå°±æ˜¯ â€œé€‚é…å™¨â€ğŸ”Œã€‚ä¸ç®¡æ˜¯å¤–å–å°å“¥ï¼ˆAPIï¼‰ã€ä¿®æ°´ç®¡çš„ï¼ˆæ•°æ®åº“ï¼‰è¿˜æ˜¯ä¸²é—¨çš„é‚»å±…ï¼ˆç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰ï¼Œéƒ½å¾—èµ°é—¨ã€ç”¨é—¨å£çš„è®¾å¤‡ï¼Œç»ä¸ä¼šè®©ä»–ä»¬ç›´æ¥ç ¸å¢™è¿›å®¢å… â€”â€” è¿™å°±æ˜¯ â€œè§£è€¦â€ çš„ç²¾é«“ï¼</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f484aa7d5b04241868b0309388859e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5Y-r6buR5aSn5biF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764513117&amp;x-signature=gt4mhUREP%2Bebrt2YJxn2XM1xOno%3D" alt="å…­è¾¹å½¢æ¶æ„.png" loading="lazy"/></p>
<h4 data-id="heading-3">ğŸ§  ä¸‰åˆ†é’Ÿçœ‹é€æ ¸å¿ƒä¸‰è¦ç´ ï¼šè°æ˜¯ â€œè¯äº‹äººâ€ï¼Ÿ</h4>
<h5 data-id="heading-4">1. æ ¸å¿ƒåŸŸï¼šä¸šåŠ¡é€»è¾‘çš„ â€œç‹¬ç«‹ç‹å›½â€ ğŸ‘‘</h5>
<p>æ ¸å¿ƒåŸŸæ˜¯æ•´ä¸ªæ¶æ„çš„çµé­‚ï¼Œåªå¹²ä¸€ä»¶äº‹ï¼šå®ç°ä¸šåŠ¡è§„åˆ™ï¼Œæ¯”å¦‚ â€œè®¢å•æ»¡ 200 å‡ 50â€â€œä½™é¢ä¸è¶³ä¸èƒ½è½¬è´¦â€ã€‚å®ƒæœ‰ä¸¤ä¸ªè¶…èƒ½åŠ›ï¼š</p>
<ul>
<li>ğŸŒ° ä¸ç¢°ä»»ä½•æŠ€æœ¯ç»†èŠ‚ï¼šä¸ç®¡ä½ ç”¨ MySQL è¿˜æ˜¯ Excel å­˜æ•°æ®ï¼Œä¸ç®¡å‰ç«¯æ˜¯ç½‘é¡µè¿˜æ˜¯ APPï¼Œå®ƒéƒ½æ¼ ä¸å…³å¿ƒï¼›</li>
<li>ğŸ§ª èƒ½å•ç‹¬æµ‹è¯•ï¼šä¸ç”¨è¿æ•°æ®åº“ã€å¼€æœåŠ¡å™¨ï¼Œç›´æ¥ç»™å®ƒä¼ æ•°æ®å°±èƒ½æµ‹ä¸šåŠ¡é€»è¾‘å¯¹ä¸å¯¹ã€‚</li>
</ul>
<p>ä¼ªä»£ç é•¿è¿™æ ·ï¼ˆçœ‹æ‡‚é€»è¾‘å°±è¡Œï¼Œä¸ç”¨ç®¡è¯­æ³•ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šè®¢å•å¤„ç†ç³»ç»Ÿ</span>
Â â€‹
Â å®šä¹‰ è®¢å•æœåŠ¡ï¼š
Â â€‹
Â  Â  <span class="hljs-comment">// åªå…³å¿ƒä¸šåŠ¡è§„åˆ™ï¼Œä¸å…³å¿ƒæ•°æ®å­˜åœ¨å“ª</span>
Â â€‹
Â  Â  æ–¹æ³• åˆ›å»ºè®¢å•(ç”¨æˆ·, å•†å“åˆ—è¡¨)ï¼š
Â â€‹
Â  Â  Â  Â  å¦‚æœ å•†å“åº“å­˜ä¸è¶³ â†’ æŠ¥é”™â€œåº“å­˜ä¸å¤Ÿå•¦â€
Â â€‹
Â  Â  Â  Â  è®¡ç®— æ€»ä»· = å•†å“åˆ—è¡¨æ±‚å’Œ - ä¼˜æƒ é‡‘é¢
Â â€‹
Â  Â  Â  Â  å¦‚æœ æ€»ä»· &lt; <span class="hljs-number">0</span> â†’ æŠ¥é”™â€œä¼˜æƒ ä¸èƒ½è¶…æ€»ä»·â€
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ è®¢å•å­˜å‚¨æ¥å£.ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯)  <span class="hljs-comment">// åªå–Šæ¥å£ï¼Œä¸å–Šå…·ä½“æ•°æ®åº“</span>
Â â€‹
Â  Â  Â  Â  è¿”å› è®¢å•ç¼–å·
</code></pre>
<h5 data-id="heading-5">2. ç«¯å£ï¼šæ ¸å¿ƒåŸŸçš„ â€œæ²Ÿé€šæš—å·â€ ğŸšª</h5>
<p>æ ¸å¿ƒåŸŸä¸æƒ³å’Œå¤–ç•Œç›´æ¥è¯´è¯ï¼Œäºæ˜¯æäº†å¥— â€œæš—å·æœ¬â€â€”â€” ç«¯å£ï¼Œæœ¬è´¨æ˜¯å®šä¹‰ â€œæ€ä¹ˆå¯¹è¯â€ çš„æ¥å£ã€‚åˆ†ä¸¤ç§ï¼š</p>
<ul>
<li>è¾“å…¥ç«¯å£ï¼ˆé©±åŠ¨ç«¯å£ï¼‰ï¼šåˆ«äººæ‰¾æ ¸å¿ƒåŠäº‹çš„æš—å·ï¼Œæ¯”å¦‚ â€œåˆ›å»ºè®¢å•â€â€œæŸ¥è¯¢ä½™é¢â€ï¼›</li>
<li>è¾“å‡ºç«¯å£ï¼ˆè¢«é©±åŠ¨ç«¯å£ï¼‰ï¼šæ ¸å¿ƒæ‰¾åˆ«äººåŠäº‹çš„æš—å·ï¼Œæ¯”å¦‚ â€œä¿å­˜æ•°æ®â€â€œå‘é€çŸ­ä¿¡â€ã€‚</li>
</ul>
<p>ç«¯å£çš„å…³é”®æ˜¯ï¼š<strong>ç”¨ä¸šåŠ¡è¯­è¨€è¯´è¯ï¼Œä¸è¯´æŠ€æœ¯æœ¯è¯­</strong>ï¼æ¯”å¦‚å« â€œä¿å­˜è®¢å•â€ è€Œä¸æ˜¯ â€œæ‰§è¡Œ SQL æ’å…¥â€ã€‚</p>
<p>ä¼ªä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// è¾“å…¥ç«¯å£ï¼šå¤–éƒ¨è°ƒç”¨æ ¸å¿ƒçš„æ¥å£</span>
Â â€‹
Â å®šä¹‰ è®¢å•æ“ä½œæ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• åˆ›å»ºè®¢å•(ç”¨æˆ·, å•†å“åˆ—è¡¨) â†’ è®¢å•ç¼–å·
Â â€‹
Â  Â  æ–¹æ³• å–æ¶ˆè®¢å•(è®¢å•ç¼–å·) â†’ å¸ƒå°”å€¼
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºç«¯å£ï¼šæ ¸å¿ƒè°ƒç”¨å¤–éƒ¨çš„æ¥å£</span>
Â â€‹
Â å®šä¹‰ è®¢å•å­˜å‚¨æ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯) â†’ æˆåŠŸ/å¤±è´¥
Â â€‹
Â  Â  æ–¹æ³• æŸ¥è®¢å•(è®¢å•ç¼–å·) â†’ è®¢å•ä¿¡æ¯
</code></pre>
<h5 data-id="heading-6">3. é€‚é…å™¨ï¼šå¤–ç•Œçš„ â€œç¿»è¯‘å®˜â€ ğŸ”Œ</h5>
<p>ç«¯å£æ˜¯æš—å·æœ¬ï¼Œä½†å¤–ç•Œä¸æ‡‚æš—å·å•Šï¼æ¯”å¦‚ç½‘é¡µå‰ç«¯åªä¼šå‘ HTTP è¯·æ±‚ï¼Œæ•°æ®åº“åªä¼šè®¤ SQLâ€”â€” è¿™æ—¶å€™å°±éœ€è¦é€‚é…å™¨å½“ç¿»è¯‘ã€‚é€‚é…å™¨ä¹Ÿåˆ†ä¸¤ç§ï¼š</p>
<ul>
<li>è¾“å…¥é€‚é…å™¨ï¼šæŠŠå¤–ç•Œè¯·æ±‚è½¬æˆæ ¸å¿ƒèƒ½æ‡‚çš„æš—å·ï¼Œæ¯”å¦‚æŠŠç½‘é¡µçš„ â€œä¸‹å•æŒ‰é’®ç‚¹å‡»â€ è½¬æˆ â€œè°ƒç”¨è®¢å•æ“ä½œæ¥å£ã€‚åˆ›å»ºè®¢å•â€ï¼›</li>
<li>è¾“å‡ºé€‚é…å™¨ï¼šæŠŠæ ¸å¿ƒçš„æš—å·è½¬æˆå¤–ç•Œèƒ½æ‡‚çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚æŠŠ â€œä¿å­˜è®¢å•â€ è½¬æˆ MySQL çš„ INSERT è¯­å¥ï¼Œæˆ– MongoDB çš„ save å‘½ä»¤ã€‚</li>
</ul>
<p>æœ€ç‰›çš„æ˜¯ï¼š<strong>æ¢å¤–ç•Œç³»ç»Ÿåªéœ€æ¢é€‚é…å™¨ï¼Œæ ¸å¿ƒä¸åŠ¨ï¼</strong> æ¯”å¦‚ä» MySQL æ¢æˆ PostgreSQLï¼Œåªæ”¹ â€œæ•°æ®åº“é€‚é…å™¨â€ï¼Œæ ¸å¿ƒçš„ â€œä¿å­˜è®¢å•â€ é€»è¾‘ä¸€æ¯›é’±ä¸ç”¨æ”¹ã€‚</p>
<p>ä¼ªä»£ç æ¼”ç¤ºï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// è¾“å…¥é€‚é…å™¨ï¼šç½‘é¡µå‰ç«¯çš„ç¿»è¯‘å®˜</span>
Â â€‹
Â å®šä¹‰ ç½‘é¡µè®¢å•é€‚é…å™¨ï¼š
Â â€‹
Â  Â  æ–¹æ³• å¤„ç†ç½‘é¡µä¸‹å•è¯·æ±‚(ç½‘é¡µå‚æ•°)ï¼š
Â â€‹
Â  Â  Â  Â  è§£æ å‚æ•° â†’ ç”¨æˆ·ä¿¡æ¯ã€å•†å“åˆ—è¡¨
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ è®¢å•æ“ä½œæ¥å£.åˆ›å»ºè®¢å•(ç”¨æˆ·ä¿¡æ¯, å•†å“åˆ—è¡¨)  <span class="hljs-comment">// è½¬æˆæ ¸å¿ƒèƒ½æ‡‚çš„æš—å·</span>
Â â€‹
Â  Â  Â  Â  æŠŠ è®¢å•ç¼–å· è½¬æˆç½‘é¡µèƒ½æ˜¾ç¤ºçš„æ ¼å¼ â†’ è¿”å›ç»™ç”¨æˆ·
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºé€‚é…å™¨ï¼šMySQLæ•°æ®åº“çš„ç¿»è¯‘å®˜</span>
Â â€‹
Â å®šä¹‰ MySQLè®¢å•é€‚é…å™¨ å®ç° è®¢å•å­˜å‚¨æ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯)ï¼š
Â â€‹
Â  Â  Â  Â  æŠŠ è®¢å•ä¿¡æ¯ è½¬æˆ SQLè¯­å¥ â†’ "INSERT INTO è®¢å•è¡¨ VALUES (...)"
Â â€‹
Â  Â  Â  Â  æ‰§è¡Œ SQL â†’ è¿”å› æˆåŠŸ/å¤±è´¥
</code></pre>
<h4 data-id="heading-7">ğŸ› ï¸ æ‰‹æŠŠæ‰‹æ­æ¶æ„ï¼šç”¨ä¼ªä»£ç å»ºä¸ªè®¢å•ç³»ç»Ÿ</h4>
<p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ï¼å’±ä»¬ç”¨ä¸Šé¢çš„ä¸‰è¦ç´ æ­ä¸ªç®€åŒ–ç‰ˆè®¢å•ç³»ç»Ÿï¼Œå…¨ç¨‹æ— å…·ä½“ä»£ç ï¼š</p>
<h5 data-id="heading-8">ç¬¬ä¸€æ­¥ï¼šå†™æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆä¸ç®¡å¤–ç•Œï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// æ ¸å¿ƒåŸŸï¼šè®¢å•æœåŠ¡ï¼ˆå®ç°è¾“å…¥ç«¯å£çš„é€»è¾‘ï¼‰</span>
Â â€‹
Â å®šä¹‰ è®¢å•æœåŠ¡ å®ç° è®¢å•æ“ä½œæ¥å£ï¼š
Â â€‹
Â  Â  <span class="hljs-comment">// ä¾èµ–è¾“å‡ºç«¯å£çš„æ¥å£ï¼Œä¸æ˜¯å…·ä½“å®ç°ï¼</span>
Â â€‹
Â  Â  æ¥æ”¶ è®¢å•å­˜å‚¨æ¥å£ å®ä¾‹ â†’ å­˜åœ¨è‡ªå·±è¿™é‡Œ
Â â€‹
Â  Â  æ–¹æ³• åˆ›å»ºè®¢å•(ç”¨æˆ·, å•†å“åˆ—è¡¨)ï¼š
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">1</span>. è°ƒç”¨ åº“å­˜æœåŠ¡æ¥å£.æŸ¥åº“å­˜(å•†å“åˆ—è¡¨) â†’ è‹¥ä¸è¶³æŠ¥é”™
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">2</span>. è®¡ç®— æ€»ä»· = å•†å“é‡‘é¢æ€»å’Œ - ç”¨æˆ·ä¼˜æƒ åˆ¸
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">3</span>. è°ƒç”¨ è‡ªå·±å­˜çš„è®¢å•å­˜å‚¨æ¥å£.ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯)
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">4</span>. è°ƒç”¨ æ¶ˆæ¯å‘é€æ¥å£.å‘æ¶ˆæ¯(ç”¨æˆ·ID, "è®¢å•åˆ›å»ºæˆåŠŸ")
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">5</span>. è¿”å› è®¢å•ç¼–å·
Â â€‹
Â  Â  æ–¹æ³• å–æ¶ˆè®¢å•(è®¢å•ç¼–å·)ï¼š
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">1</span>. è°ƒç”¨ è®¢å•å­˜å‚¨æ¥å£.æŸ¥è®¢å•(è®¢å•ç¼–å·) â†’ è‹¥ä¸å­˜åœ¨æŠ¥é”™
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">2</span>. è‹¥ è®¢å•å·²å‘è´§ â†’ æŠ¥é”™â€œä¸èƒ½å–æ¶ˆâ€
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">3</span>. è°ƒç”¨ è®¢å•å­˜å‚¨æ¥å£.æ›´æ–°è®¢å•çŠ¶æ€(è®¢å•ç¼–å·, "å·²å–æ¶ˆ")
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">4</span>. è°ƒç”¨ åº“å­˜æœåŠ¡æ¥å£.åŠ åº“å­˜(å•†å“åˆ—è¡¨)
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">5</span>. è¿”å› æˆåŠŸ
</code></pre>
<h5 data-id="heading-9">ç¬¬äºŒæ­¥ï¼šæ¥å‰ç«¯ï¼ˆåŠ è¾“å…¥é€‚é…å™¨ï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// è¾“å…¥é€‚é…å™¨1ï¼šAPPé€‚é…å™¨</span>
Â â€‹
Â å®šä¹‰ APPè®¢å•é€‚é…å™¨ï¼š
Â â€‹
Â  Â  æ–¹æ³• å¤„ç†APPä¸‹å•è¯·æ±‚(APPå‚æ•°)ï¼š
Â â€‹
Â  Â  Â  Â  è§£æ å‚æ•° â†’ ç”¨æˆ·IDã€å•†å“IDåˆ—è¡¨
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ è®¢å•æœåŠ¡.åˆ›å»ºè®¢å•(ç”¨æˆ·ID, å•†å“IDåˆ—è¡¨)
Â â€‹
Â  Â  Â  Â  è¿”å› JSONæ ¼å¼çš„è®¢å•ç¼–å·
Â â€‹
Â <span class="hljs-comment">// è¾“å…¥é€‚é…å™¨2ï¼šå°ç¨‹åºé€‚é…å™¨</span>
Â â€‹
Â å®šä¹‰ å°ç¨‹åºè®¢å•é€‚é…å™¨ï¼š
Â â€‹
Â  Â  æ–¹æ³• å¤„ç†å°ç¨‹åºä¸‹å•è¯·æ±‚(å°ç¨‹åºå‚æ•°)ï¼š
Â â€‹
Â  Â  Â  Â  è§£æ å‚æ•° â†’ ç”¨æˆ·IDã€å•†å“IDåˆ—è¡¨  <span class="hljs-comment">// å’ŒAPPè§£ææ–¹å¼ä¸åŒ</span>
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ è®¢å•æœåŠ¡.åˆ›å»ºè®¢å•(ç”¨æˆ·ID, å•†å“IDåˆ—è¡¨)  <span class="hljs-comment">// ä½†è°ƒç”¨æ ¸å¿ƒçš„æ–¹å¼ä¸€æ ·</span>
Â â€‹
Â  Â  Â  Â  è¿”å› å°ç¨‹åºèƒ½è¯†åˆ«çš„å“åº”æ ¼å¼
</code></pre>
<h5 data-id="heading-10">ç¬¬ä¸‰æ­¥ï¼šæ¥åç«¯ï¼ˆåŠ è¾“å‡ºé€‚é…å™¨ï¼‰</h5>
<pre><code class="hljs language-json" lang="json">Â <span class="hljs-comment">// è¾“å‡ºé€‚é…å™¨1ï¼šRedisç¼“å­˜é€‚é…å™¨</span>
Â â€‹
Â å®šä¹‰ Redisè®¢å•é€‚é…å™¨ å®ç° è®¢å•å­˜å‚¨æ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯)ï¼š
Â â€‹
Â  Â  Â  Â  æŠŠ è®¢å•ä¿¡æ¯ è½¬æˆ Redisçš„é”®å€¼å¯¹ â†’ <span class="hljs-string">"è®¢å•:123"</span> â†’ <span class="hljs-punctuation">{</span><span class="hljs-attr">"ç”¨æˆ·"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å¼ ä¸‰"</span><span class="hljs-punctuation">,</span> ...<span class="hljs-punctuation">}</span>
Â â€‹
Â  Â  Â  Â  å­˜å…¥ Redis â†’ è¿”å› æˆåŠŸ
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºé€‚é…å™¨2ï¼šçŸ­ä¿¡é€šçŸ¥é€‚é…å™¨</span>
Â â€‹
Â å®šä¹‰ çŸ­ä¿¡é€‚é…å™¨ å®ç° æ¶ˆæ¯å‘é€æ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• å‘æ¶ˆæ¯(ç”¨æˆ·ID<span class="hljs-punctuation">,</span> å†…å®¹)ï¼š
Â â€‹
Â  Â  Â  Â  æŸ¥ ç”¨æˆ·æ‰‹æœºå· â†’ ä»ç”¨æˆ·æœåŠ¡æ¥å£æ‹¿
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ çŸ­ä¿¡å¹³å°API â†’ å‘é€å†…å®¹
Â â€‹
Â  Â  Â  Â  è¿”å› å‘é€ç»“æœ
</code></pre>
<p>çœ‹åˆ°æ²¡ï¼Ÿä¸ç®¡å‰ç«¯åŠ å¤šå°‘ç«¯ï¼ˆAPPã€å°ç¨‹åºã€ç½‘é¡µï¼‰ï¼Œåç«¯æ¢å¤šå°‘å­˜å‚¨ï¼ˆRedisã€MySQLã€MongoDBï¼‰ï¼Œæ ¸å¿ƒçš„è®¢å•æœåŠ¡æ°¸è¿œç¨³å¦‚è€ç‹—ğŸ¶ï¼</p>
<h4 data-id="heading-11">ğŸ¯ è¿™äº›åœºæ™¯é—­çœ¼ç”¨ï¼šå…­è¾¹å½¢æ¶æ„çš„ â€œèˆ’é€‚åŒºâ€</h4>
<p>ä¸æ˜¯æ‰€æœ‰é¡¹ç›®éƒ½éœ€è¦è¿™æ¶æ„ï¼Œæ‰¾å¯¹åœºæ™¯æ‰èƒ½äº‹åŠåŠŸå€ï¼š</p>
<h5 data-id="heading-12">1. å¤šç«¯é€‚é…çš„ç³»ç»Ÿ ğŸ“±ğŸ’»</h5>
<p>æ¯”å¦‚ç”µå•†ç³»ç»Ÿè¦æ”¯æŒç½‘é¡µã€APPã€å°ç¨‹åºã€ç¬¬ä¸‰æ–¹ APIâ€”â€” è¾“å…¥é€‚é…å™¨å¤šå¼€å‡ ä¸ªå°±è¡Œï¼Œæ ¸å¿ƒé€»è¾‘ä¸€æ¬¡å†™å®Œã€‚å°±åƒé¤å…å¼€äº†å ‚é£Ÿã€å¤–å–ã€å›¢é¤çª—å£ï¼Œå¨æˆ¿è¿˜æ˜¯åŒä¸€ä¸ªğŸ³ã€‚</p>
<h5 data-id="heading-13">2. é¢‘ç¹æ¢å¤–éƒ¨ä¾èµ–çš„é¡¹ç›® ğŸ”„</h5>
<p>æ¯”å¦‚è€æ¿ä»Šå¤©è¯´ â€œç”¨ MySQL å­˜æ•°æ®â€ï¼Œæ˜å¤©è¯´ â€œæ¢ MongoDBâ€ï¼Œåå¤©è¯´ â€œåŠ ä¸ª Redis ç¼“å­˜â€â€”â€” åªéœ€æ¢è¾“å‡ºé€‚é…å™¨ï¼Œä¸ç”¨æ”¹æ ¸å¿ƒã€‚æœç´¢åˆ°çš„é˜¿é‡Œæ¡ˆä¾‹é‡Œï¼Œè¿ç§»æ•°æ®åº“æ—¶å…­è¾¹å½¢æ¶æ„çš„æˆæœ¬åªæœ‰ä¼ ç»Ÿæ¶æ„çš„ 1/10ï¼</p>
<h5 data-id="heading-14">3. å¤æ‚ä¸šåŠ¡ç³»ç»Ÿ ğŸ§©</h5>
<p>æ¯”å¦‚é“¶è¡Œçš„äº¤æ˜“ç³»ç»Ÿã€åŒ»é™¢çš„æŒ‚å·ç³»ç»Ÿï¼Œä¸šåŠ¡è§„åˆ™ä¸€å¤§å †ï¼ˆæ»¡å‡ã€æŠ˜æ‰£ã€æƒé™æ§åˆ¶ï¼‰ã€‚æ ¸å¿ƒåŸŸå•ç‹¬ç»´æŠ¤ä¸šåŠ¡é€»è¾‘ï¼Œæµ‹è¯•æ—¶ä¸ç”¨è¿æ•°æ®åº“ï¼Œç›´æ¥ Mock ä¸€ä¸ªé€‚é…å™¨å°±èƒ½æµ‹ï¼Œæ•ˆç‡ç¿»å€ğŸš€ã€‚</p>
<h5 data-id="heading-15">âŒ è¿™äº›åœºæ™¯åˆ«çç”¨ï¼šæ€é¸¡ä¸ç”¨ç‰›åˆ€</h5>
<ul>
<li>å°å·¥å…·ï¼šæ¯”å¦‚å†™ä¸ªæ‰¹é‡é‡å‘½åæ–‡ä»¶çš„è„šæœ¬ï¼Œä¸šåŠ¡é€»è¾‘å°±ä¸€è¡Œï¼Œç”¨è¿™æ¶æ„çº¯å±ç»™è‡ªå·±æ‰¾ç½ªå—ï¼›</li>
<li>ä¸€æ¬¡æ€§é¡¹ç›®ï¼šæ¯”å¦‚ä¸´æ—¶åšä¸ªæ´»åŠ¨é¡µé¢ï¼Œç”¨å®Œå°±æ‰”ï¼Œç®€å•çš„çº¿æ€§ä»£ç æ›´å¿«ï¼›</li>
<li>æŠ€æœ¯éªŒè¯åŸå‹ï¼šé‡ç‚¹åœ¨è¯•æŠ€æœ¯ï¼Œä¸æ˜¯ç¨³æ¶æ„ï¼Œå…ˆè·‘é€šå†è¯´ã€‚</li>
</ul>
<h4 data-id="heading-16">ğŸ†š ä¼ ç»Ÿæ¶æ„ VS å…­è¾¹å½¢æ¶æ„ï¼šå·®åœ¨å“ªï¼Ÿ</h4>
<p>ç”¨ä¸ªé€šä¿—æ¯”å–»ï¼š</p>
<ul>
<li>ä¼ ç»Ÿåˆ†å±‚æ¶æ„åƒä¸²ç³–è‘«èŠ¦ğŸ¡ï¼šUI å±‚ä¾èµ–æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚ä¾èµ– DAO å±‚ï¼ŒDAO å±‚ä¾èµ–æ•°æ®åº“ â€”â€” æ”¹æ•°æ®åº“ï¼Œä» DAO åˆ° UI å…¨å¾—åŠ¨ï¼›</li>
<li>å…­è¾¹å½¢æ¶æ„åƒç§¯æœ¨åŸå ¡ğŸ°ï¼šæ ¸å¿ƒæ˜¯åœ°åŸºï¼Œç«¯å£æ˜¯æ¥å£ï¼Œé€‚é…å™¨æ˜¯ç§¯æœ¨å— â€”â€” æƒ³æ¢çª—æˆ·ï¼ˆæ•°æ®åº“ï¼‰ã€é—¨ï¼ˆå‰ç«¯ï¼‰ï¼Œç›´æ¥æ‹†æ—§ç§¯æœ¨æ¢æ–°å“ï¼Œåœ°åŸºä¸åŠ¨ã€‚</li>
</ul>
<p>çœ‹ä¸ªçœŸå®å¯¹æ¯”ï¼šç”µå•†ç³»ç»Ÿä» MySQL è¿ç§»åˆ° PostgreSQL</p>






























<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>ä¼ ç»Ÿæ¶æ„</th><th>å…­è¾¹å½¢æ¶æ„</th></tr></thead><tbody><tr><td>æ ¸å¿ƒé€»è¾‘ä¿®æ”¹</td><td>è¦æ”¹ï¼ˆDAO å±‚ã€æœåŠ¡å±‚éƒ½ç¢°ï¼‰</td><td>ä¸æ”¹ï¼ˆæ ¸å¿ƒåŸŸç¨³å¦‚æ³°å±±ï¼‰</td></tr><tr><td>æµ‹è¯•èŒƒå›´</td><td>å…¨ç³»ç»Ÿé‡æµ‹</td><td>åªæµ‹æ–°é€‚é…å™¨</td></tr><tr><td>è¿ç§»æ—¶é—´</td><td>3 å¤©</td><td>2 å°æ—¶</td></tr><tr><td>é£é™©</td><td>å¯èƒ½æ”¹å´©ä¸šåŠ¡é€»è¾‘</td><td>å‡ ä¹é›¶é£é™©</td></tr></tbody></table>
<h5 data-id="heading-17">ä»£ç å¯¹æ¯”</h5>
<h6 data-id="heading-18">ğŸ¡ ä¼ ç»Ÿä¸‰å±‚æµå¼æ¶æ„ç¤ºä¾‹</h6>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// Controller å±‚ (UI å±‚)</span>
Â <span class="hljs-keyword">@RestController</span>
Â public class OrderController {
Â  Â  Â private final OrderService orderService; <span class="hljs-comment">// ç›´æ¥ä¾èµ– Service</span>
Â â€‹
Â  Â  Â <span class="hljs-keyword">@PostMapping</span>(<span class="hljs-string">"/orders"</span>)
Â  Â  Â public String createOrder(<span class="hljs-keyword">@RequestBody</span> OrderRequest request) {
Â  Â  Â  Â  Â return orderService<span class="hljs-selector-class">.createOrder</span>(request.getUser(), request<span class="hljs-selector-class">.getItems</span>());
Â  Â   }
Â }
Â â€‹
Â <span class="hljs-comment">// Service å±‚ (ä¸šåŠ¡é€»è¾‘ + æŠ€æœ¯è€¦åˆ)</span>
Â <span class="hljs-keyword">@Service</span>
Â public class OrderService {
Â  Â  Â private final OrderDao orderDao; <span class="hljs-comment">// ç›´æ¥ä¾èµ– DAO</span>
Â â€‹
Â  Â  Â public String <span class="hljs-built_in">createOrder</span>(User user, List&lt;Item&gt; items) {
Â  Â  Â  Â  Â double total = items<span class="hljs-selector-class">.stream</span>()<span class="hljs-selector-class">.mapToDouble</span>(Item::getPrice)<span class="hljs-selector-class">.sum</span>();
Â  Â  Â  Â  Â <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>(user, items, total);
Â â€‹
Â  Â  Â  Â  Â <span class="hljs-comment">// ç›´æ¥è°ƒç”¨ DAO å±‚ï¼Œè€¦åˆæ•°æ®åº“</span>
Â  Â  Â  Â  Â orderDao<span class="hljs-selector-class">.insert</span>(order);
Â â€‹
Â  Â  Â  Â  Â return <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getId</span>();
Â  Â   }
Â }
Â â€‹
Â <span class="hljs-comment">// DAO å±‚ (æ•°æ®åº“æ“ä½œ)</span>
Â <span class="hljs-keyword">@Repository</span>
Â public class OrderDao {
Â  Â  Â private final JdbcTemplate jdbc;
Â â€‹
Â  Â  Â public void <span class="hljs-built_in">insert</span>(Order order) {
Â  Â  Â  Â  Â jdbc<span class="hljs-selector-class">.update</span>("INSERT INTO orders (id, user, total) VALUES (?, ?, ?)",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getId</span>(), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getUser</span>()<span class="hljs-selector-class">.getId</span>(), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getTotal</span>());
Â  Â   }
Â }
Â â€‹
</code></pre>
<p>ğŸ‘‰ ç‰¹ç‚¹ï¼šService å±‚ç›´æ¥ä¾èµ– DAOï¼ŒDAO ç›´æ¥ä¾èµ–æ•°æ®åº“ã€‚æ¢æ•°æ®åº“æ—¶ï¼ŒService å’Œ DAO éƒ½å¯èƒ½è¦æ”¹ã€‚</p>
<h5 data-id="heading-19">ğŸ° å…­è¾¹å½¢æ¶æ„ç¤ºä¾‹</h5>
<pre><code class="hljs language-java" lang="java">Â <span class="hljs-comment">// è¾“å…¥ç«¯å£ (ä¸šåŠ¡æ¥å£)</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderUseCase</span> {
Â  Â  Â String <span class="hljs-title function_">createOrder</span><span class="hljs-params">(User user, List&lt;Item&gt; items)</span>;
Â }
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºç«¯å£ (æŠ½è±¡æ¥å£)</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> {
Â  Â  Â <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(Order order)</span>;
Â }
Â â€‹
Â <span class="hljs-comment">// æ ¸å¿ƒåŸŸ (ä¸šåŠ¡é€»è¾‘ï¼Œåªä¾èµ–ç«¯å£)</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderUseCase</span> {
Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderRepository orderRepository;
Â â€‹
Â  Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(OrderRepository orderRepository)</span> {
Â  Â  Â  Â  Â <span class="hljs-built_in">this</span>.orderRepository = orderRepository;
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-meta">@Override</span>
Â  Â  Â <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createOrder</span><span class="hljs-params">(User user, List&lt;Item&gt; items)</span> {
Â  Â  Â  Â  Â <span class="hljs-type">double</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> items.stream().mapToDouble(Item::getPrice).sum();
Â  Â  Â  Â  Â <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(user, items, total);
Â â€‹
Â  Â  Â  Â  Â <span class="hljs-comment">// è°ƒç”¨æŠ½è±¡æ¥å£ï¼Œä¸å…³å¿ƒå…·ä½“æ•°æ®åº“</span>
Â  Â  Â  Â  Â orderRepository.save(order);
Â â€‹
Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> order.getId();
Â  Â   }
Â }
Â â€‹
Â <span class="hljs-comment">// è¾“å…¥é€‚é…å™¨ (API å±‚)</span>
Â <span class="hljs-meta">@RestController</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {
Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderUseCase orderService;
Â â€‹
Â  Â  Â <span class="hljs-meta">@PostMapping("/orders")</span>
Â  Â  Â <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrderRequest request)</span> {
Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> orderService.createOrder(request.getUser(), request.getItems());
Â  Â   }
Â }
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºé€‚é…å™¨ (æ•°æ®åº“å®ç°)</span>
Â <span class="hljs-meta">@Repository</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySqlOrderRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderRepository</span> {
Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcTemplate jdbc;
Â â€‹
Â  Â  Â <span class="hljs-meta">@Override</span>
Â  Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(Order order)</span> {
Â  Â  Â  Â  Â jdbc.update(<span class="hljs-string">"INSERT INTO orders (id, user, total) VALUES (?, ?, ?)"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â order.getId(), order.getUser().getId(), order.getTotal());
Â  Â   }
Â }
Â â€‹
</code></pre>
<p>ğŸ‘‰ ç‰¹ç‚¹ï¼šæ ¸å¿ƒåŸŸåªä¾èµ–æŠ½è±¡æ¥å£ <code>OrderRepository</code>ï¼Œå…·ä½“æ•°æ®åº“å®ç°ç”±é€‚é…å™¨æä¾›ã€‚æ¢æ•°æ®åº“æ—¶ï¼Œåªéœ€å†™ä¸€ä¸ªæ–°çš„é€‚é…å™¨ï¼ˆæ¯”å¦‚ <code>MongoOrderRepository</code>ï¼‰ï¼Œæ ¸å¿ƒåŸŸå®Œå…¨ä¸ç”¨æ”¹ã€‚</p>
<h4 data-id="heading-20">ğŸ“ æœ€åæ€»ç»“ï¼šåˆ«è¢«åå­—å“åˆ°ï¼</h4>
<p>å…­è¾¹å½¢æ¶æ„çš„æ ¸å¿ƒä¸æ˜¯ â€œå…­è¾¹å½¢â€ è¿™ä¸ªå½¢çŠ¶ï¼Œè€Œæ˜¯ â€œä¸šåŠ¡ä¼˜å…ˆï¼ŒæŠ€æœ¯é è¾¹â€ çš„è®¾è®¡æ€æƒ³ â€”â€” è®©æœ€æœ‰ä»·å€¼çš„ä¸šåŠ¡é€»è¾‘æ‘†è„±æŠ€æœ¯çš„æŸç¼šï¼Œæƒ³æ€ä¹ˆæŠ˜è…¾æŠ€æœ¯ç»†èŠ‚å°±æ€ä¹ˆæŠ˜è…¾ï¼Œæ ¸å¿ƒæ°¸è¿œå®‰å…¨ã€‚</p>
<p>å¯¹å°ç™½æ¥è¯´ï¼Œä¸ç”¨ä¸€å¼€å§‹å°±å®Œç¾å®ç°ï¼Œå…ˆè®°ä½ä¸‰ä¸ªåŸåˆ™ï¼š</p>
<ol start="0">
<li>æ ¸å¿ƒåªå¹²ä¸šåŠ¡çš„äº‹ï¼Œåˆ«ç¢°æŠ€æœ¯ï¼›</li>
<li>å¯¹å¤–åªé€šè¿‡ç«¯å£è¯´è¯ï¼Œåˆ«ç›´æ¥å” ï¼›</li>
<li>é€‚é…äº¤ç»™é€‚é…å™¨ï¼Œåˆ«è®©æ ¸å¿ƒå½“ç¿»è¯‘ã€‚</li>
</ol>
<p>ä¸‹æ¬¡å†é‡åˆ° â€œæ”¹ä¸€è¡Œå´©å…¨æœâ€ çš„å‘ï¼Œè¯•è¯•ç”¨å…­è¾¹å½¢æ¶æ„æ­ä¸ªéª¨æ¶ â€”â€” ç›¸ä¿¡æˆ‘ï¼Œæµ‹è¯•å°å“¥ä¼šå°‘è¿½æ€ä½ å¥½å‡ æ¬¡ğŸ˜‰ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@NotBlank ä¸ç”Ÿæ•ˆæŠ¥é”™ No validator could be foundï¼šHibernate Validator ç‰ˆæœ¬åŒ¹é…æŒ‡åŒ—]]></title>    <link>https://juejin.cn/post/7575937594337673257</link>    <guid>https://juejin.cn/post/7575937594337673257</guid>    <pubDate>2025-11-23T15:26:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575937594337673257" data-draft-id="7575425466905493567" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@NotBlank ä¸ç”Ÿæ•ˆæŠ¥é”™ No validator could be foundï¼šHibernate Validator ç‰ˆæœ¬åŒ¹é…æŒ‡åŒ—"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-23T15:26:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="9å·è¾¾äºº"/> <meta itemprop="url" content="https://juejin.cn/user/2450136052270077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @NotBlank ä¸ç”Ÿæ•ˆæŠ¥é”™ No validator could be foundï¼šHibernate Validator ç‰ˆæœ¬åŒ¹é…æŒ‡åŒ—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2450136052270077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    9å·è¾¾äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T15:26:20.000Z" title="Sun Nov 23 2025 15:26:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜èƒŒæ™¯</h2>
<p>æœ€è¿‘åœ¨å†™æ¥å£çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªçœ‹ä¼¼ç®€å•ä½†å®é™…å¾ˆå‘çš„å‚æ•°æ ¡éªŒé—®é¢˜ã€‚ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
Â *Â å…³é”®è¯
Â */</span>
@NotBlank
<span class="hljs-keyword">private</span>Â <span class="hljs-type">String</span>Â keywords;
</code></pre>
<p>çœ‹èµ·æ¥å¾ˆå®Œç¾å¯¹å§ï¼Ÿä½¿ç”¨çš„æ˜¯ <code>javax.validation.constraints.NotBlank</code> æ³¨è§£æ¥æ ¡éªŒå­—ç¬¦ä¸²ä¸èƒ½ä¸ºç©ºã€‚</p>
<p>ç»“æœä¸€æµ‹è¯•ï¼Œç›´æ¥ç»™æˆ‘æ¥äº†ä¸ªå¼‚å¸¸ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">javax.validation.UnexpectedTypeException:Â HV000030:Â NoÂ validatorÂ couldÂ beÂ foundÂ <span class="hljs-keyword">for</span>Â <span class="hljs-title class_">constraint</span>Â <span class="hljs-symbol">'javax</span>.validation.constraints.NotBlank'Â validatingÂ <span class="hljs-keyword">type</span>Â <span class="hljs-symbol">'java</span>.lang.<span class="hljs-type">String</span>'.Â CheckÂ configurationÂ <span class="hljs-keyword">for</span>Â <span class="hljs-symbol">'keywords</span>'
</code></pre>
<h2 data-id="heading-1">å¼‚å¸¸åˆ†æ</h2>
<p>çœ‹åˆ°è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ï¼Œç¬¬ä¸€ååº”æ˜¯ï¼š<strong>ä»€ä¹ˆé¬¼ï¼Ÿ@NotBlank ä¸å°±æ˜¯ç”¨æ¥æ ¡éªŒ String çš„å—ï¼Ÿæ€ä¹ˆè¿˜æ‰¾ä¸åˆ°éªŒè¯å™¨ï¼Ÿ</strong></p>
<p>å»ç½‘ä¸Šæœäº†ä¸€åœˆï¼Œå‘ç°ä¼—è¯´çº·çº­ï¼š</p>
<ul>
<li>æœ‰äººè¯´ String ä¸èƒ½é…ç½® @NotBlankï¼ˆè¿™æ˜æ˜¾æ˜¯é”™çš„ï¼‰</li>
<li>æœ‰äººè¯´ç¼ºå°‘ <code>validation-api</code> ä¾èµ–</li>
<li>æœ‰äººè¯´ç¼ºå°‘ <code>hibernate-validator</code> ä¾èµ–</li>
<li>è¿˜æœ‰äººè¯´ç‰ˆæœ¬ä¸åŒ¹é…</li>
</ul>
<h2 data-id="heading-2">æ ¹æœ¬åŸå› </h2>
<p>æ£€æŸ¥é¡¹ç›®ä¾èµ–åå‘ç°äº†é—®é¢˜æ‰€åœ¨ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â é¡¹ç›®ä¸­çš„å®é™…ä¾èµ–Â --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.validation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>validation-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.x<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>Â Â 
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.validator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>Â 
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>çœ‹å‡ºé—®é¢˜äº†å—ï¼Ÿçœ‹åˆ°äº†å¿ƒé‡Œæ‰“ä¸ªæ‰£</strong></p>
<ul>
<li><code>@NotNull</code> èƒ½ç”¨ï¼šå› ä¸ºå®ƒæ˜¯ Bean Validation 1.1 å°±æœ‰çš„æ³¨è§£ï¼Œhibernate-validator 5.x æ”¯æŒ</li>
<li><code>@NotBlank</code> ä¸èƒ½ç”¨ï¼šå› ä¸ºå®ƒæ˜¯ Bean Validation 2.0 æ–°å¢çš„æ³¨è§£ï¼Œéœ€è¦ hibernate-validator 6.x æ‰æ”¯æŒ</li>
</ul>
<p>è™½ç„¶å¼•å…¥äº† <code>validation-api 2.0</code>ï¼ˆæœ‰ @NotBlank æ³¨è§£å®šä¹‰ï¼‰ï¼Œä½†è¿è¡Œæ—¶ç”¨çš„æ˜¯ <code>hibernate-validator 5.4.1</code>ï¼ˆæ²¡æœ‰ @NotBlank çš„éªŒè¯å™¨å®ç°ï¼‰ï¼Œæ‰€ä»¥ç¼–è¯‘èƒ½é€šè¿‡ï¼Œè¿è¡Œæ—¶å´æ‰¾ä¸åˆ°éªŒè¯å™¨ï¼</p>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ï¼Ÿ</h3>
<p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹å¼‚å¸¸æŠ›å‡ºçš„æºç ï¼ˆhibernate-validator 5.xï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">privateÂ &lt;T,Â V&gt;Â ConstraintValidator&lt;<span class="hljs-selector-tag">A</span>,Â V&gt;Â <span class="hljs-built_in">getConstraintValidatorNoUnwrapping</span>(
Â Â Â Â Â Â Â Â ValidationContext&lt;T&gt;Â validationContext,
Â Â Â Â Â Â Â Â ValueContext&lt;?,Â V&gt;Â valueContext)Â {
Â Â Â Â <span class="hljs-comment">//Â ç¡®ä¿æ²¡æœ‰è®¾ç½®Â unwrapper</span>
Â Â Â Â valueContext<span class="hljs-selector-class">.setValidatedValueHandler</span>(null);

Â Â Â Â TypeÂ validatedValueTypeÂ =Â valueContext<span class="hljs-selector-class">.getDeclaredTypeOfValidatedElement</span>();

Â Â Â Â <span class="hljs-comment">//Â å…³é”®ï¼šä»Â ConstraintValidatorManagerÂ ä¸­è·å–å·²åˆå§‹åŒ–çš„éªŒè¯å™¨</span>
Â Â Â Â ConstraintValidator&lt;<span class="hljs-selector-tag">A</span>,Â V&gt;Â validatorÂ =Â validationContext
Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.getConstraintValidatorManager</span>()
Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.getInitializedValidator</span>(
Â Â Â Â Â Â Â Â Â Â Â Â validatedValueType,Â Â Â Â Â Â //Â String.class
Â Â Â Â Â Â Â Â Â Â Â Â descriptor,Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â @NotBlankÂ æ³¨è§£æè¿°ç¬¦
Â Â Â Â Â Â Â Â Â Â Â Â validationContext.getConstraintValidatorFactory()
Â Â Â Â Â Â Â Â );

Â Â Â Â <span class="hljs-comment">//Â å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„éªŒè¯å™¨å®ç°ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
Â Â Â Â ifÂ (validatorÂ ==Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-built_in">throwExceptionForNullValidator</span>(validatedValueType,
Â Â Â Â Â Â Â Â Â Â Â Â valueContext.getPropertyPath()<span class="hljs-selector-class">.asString</span>());
Â Â Â Â }

Â Â Â Â returnÂ validator;
}
</code></pre>
<p><strong>æµç¨‹è§£æï¼š</strong></p>
<ol>
<li>è·å–è¢«æ ¡éªŒå­—æ®µçš„ç±»å‹ï¼š<code>String.class</code></li>
<li>ä» <code>ConstraintValidatorManager</code> ä¸­æŸ¥æ‰¾èƒ½å¤„ç† <code>@NotBlank + String</code> ç»„åˆçš„éªŒè¯å™¨</li>
<li><strong>åœ¨ hibernate-validator 5.x ä¸­æ‰¾ä¸åˆ° <code>NotBlankValidator</code></strong>ï¼Œè¿”å› null</li>
<li>æŠ›å‡º <code>UnexpectedTypeException</code> å¼‚å¸¸</li>
</ol>
<h4 data-id="heading-4">ä¸ºä»€ä¹ˆä¼šè¿”å› nullï¼Ÿ</h4>
<p>ç»§ç»­è¿½è¸ª <code>getInitializedValidator</code> æ–¹æ³•çš„å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">publicÂ &lt;V,Â AÂ extendsÂ Annotation&gt;Â ConstraintValidator&lt;A,Â V&gt;Â getInitializedValidator(
Â Â Â Â Â Â Â Â TypeÂ validatedValueType,
Â Â Â Â Â Â Â Â ConstraintDescriptorImpl&lt;A&gt;Â descriptor,
Â Â Â Â Â Â Â Â ConstraintValidatorFactoryÂ constraintFactory)Â {

Â Â Â Â Contracts.assertNotNull(validatedValueType)<span class="hljs-comment">;</span>
Â Â Â Â Contracts.assertNotNull(descriptor)<span class="hljs-comment">;</span>
Â Â Â Â Contracts.assertNotNull(constraintFactory)<span class="hljs-comment">;</span>

Â Â Â Â //Â 1.Â é¦–å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–
Â Â Â Â CacheKeyÂ <span class="hljs-attr">key</span>Â =Â newÂ CacheKey(descriptor.getAnnotation(),Â validatedValueType,Â constraintFactory)<span class="hljs-comment">;</span>

Â Â Â Â ConstraintValidator&lt;A,Â V&gt;Â <span class="hljs-attr">constraintValidator</span>Â =
Â Â Â Â Â Â Â Â (ConstraintValidator&lt;A,Â V&gt;)Â constraintValidatorCache.get(key)<span class="hljs-comment">;</span>

Â Â Â Â //Â 2.Â ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ›å»ºå¹¶åˆå§‹åŒ–éªŒè¯å™¨
Â Â Â Â ifÂ (<span class="hljs-attr">constraintValidator</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-attr">constraintValidator</span>Â =Â createAndInitializeValidator(
Â Â Â Â Â Â Â Â Â Â Â Â constraintFactory,Â validatedValueType,Â descriptor)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â <span class="hljs-attr">constraintValidator</span>Â =Â cacheValidator(key,Â constraintValidator)<span class="hljs-comment">;</span>
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â LOG.tracef("ConstraintÂ validatorÂ %sÂ foundÂ inÂ cache.",Â constraintValidator)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â //Â 3.Â å…³é”®ï¼šå¦‚æœæ˜¯Â DUMMY_CONSTRAINT_VALIDATORï¼Œè¿”å›Â nullï¼
Â Â Â Â returnÂ <span class="hljs-attr">DUMMY_CONSTRAINT_VALIDATOR</span>Â ==Â constraintValidatorÂ ?Â nullÂ :Â constraintValidator<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>æ³¨æ„æœ€åä¸€è¡Œ</strong>ï¼šå¦‚æœ <code>constraintValidator</code> æ˜¯ <code>DUMMY_CONSTRAINT_VALIDATOR</code>ï¼Œå°±è¿”å› nullï¼</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä¼šåˆ›å»º <code>DUMMY_CONSTRAINT_VALIDATOR</code> å‘¢ï¼Ÿç»§ç»­çœ‹ <code>createAndInitializeValidator</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">privateÂ &lt;V,Â AÂ extendsÂ Annotation&gt;Â ConstraintValidator&lt;A,Â V&gt;Â createAndInitializeValidator(
Â Â Â Â Â Â Â Â ConstraintValidatorFactoryÂ constraintFactory,
Â Â Â Â Â Â Â Â TypeÂ validatedValueType,
Â Â Â Â Â Â Â Â ConstraintDescriptorImpl&lt;A&gt;Â descriptor)Â {

Â Â Â Â //Â 1.Â æ ¸å¿ƒï¼šæŸ¥æ‰¾åŒ¹é…çš„éªŒè¯å™¨ç±»
Â Â Â Â Class&lt;?Â extendsÂ ConstraintValidator&lt;A,Â V&gt;&gt;Â <span class="hljs-attr">validatorClass</span>Â =
Â Â Â Â Â Â Â Â (Class&lt;?Â extendsÂ ConstraintValidator&lt;A,Â V&gt;&gt;)
Â Â Â Â Â Â Â Â findMatchingValidatorClass(descriptor,Â validatedValueType)<span class="hljs-comment">;</span>

Â Â Â Â ConstraintValidator&lt;A,Â V&gt;Â constraintValidator<span class="hljs-comment">;</span>

Â Â Â Â //Â 2.Â å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„éªŒè¯å™¨ç±»ï¼Œè¿”å›Â DUMMYï¼
Â Â Â Â ifÂ (<span class="hljs-attr">validatorClass</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-attr">constraintValidator</span>Â =Â (ConstraintValidator&lt;A,Â V&gt;)Â DUMMY_CONSTRAINT_VALIDATOR<span class="hljs-comment">;</span>
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â //Â 3.Â æ‰¾åˆ°äº†éªŒè¯å™¨ç±»ï¼Œåˆ›å»ºå®ä¾‹å¹¶åˆå§‹åŒ–
Â Â Â Â Â Â Â Â <span class="hljs-attr">constraintValidator</span>Â =Â constraintFactory.getInstance(validatorClass)<span class="hljs-comment">;</span>

Â Â Â Â Â Â Â Â ifÂ (<span class="hljs-attr">constraintValidator</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â throwÂ LOG.getConstraintFactoryMustNotReturnNullException(validatorClass)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â initializeValidator(descriptor,Â constraintValidator)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â returnÂ constraintValidator<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>å…³é”®åœ¨äº <code>findMatchingValidatorClass</code> æ–¹æ³•ï¼</strong></p>
<p>è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ hibernate-validator å†…éƒ¨æ³¨å†Œçš„éªŒè¯å™¨åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼š</p>
<ul>
<li>
<p>è¾“å…¥ï¼š<code>@NotBlank</code> æ³¨è§£ + <code>String</code> ç±»å‹</p>
</li>
<li>
<p>æŸ¥æ‰¾ï¼šèƒ½å¤„ç†è¿™ä¸ªç»„åˆçš„ <code>ConstraintValidator</code> å®ç°ç±»</p>
</li>
<li>
<p>ç»“æœï¼š</p>
<ul>
<li><strong>Hibernate Validator 6.x</strong>ï¼šæ‰¾åˆ° <code>org.hibernate.validator.internal.constraintvalidators.bv.NotBlankValidator</code></li>
<li><strong>Hibernate Validator 5.x</strong>ï¼šæ‰¾ä¸åˆ°ï¼ˆå› ä¸ºæ ¹æœ¬æ²¡æœ‰å®ç°è¿™ä¸ªç±»ï¼‰ï¼Œè¿”å› null</li>
</ul>
</li>
</ul>
<p><strong>å®Œæ•´è°ƒç”¨é“¾ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">éªŒè¯è§¦å‘
Â Â â†“
<span class="hljs-built_in">getConstraintValidatorNoUnwrapping</span>()
Â Â â†“
<span class="hljs-built_in">getInitializedValidator</span>()Â Â <span class="hljs-comment">//Â ä»ç¼“å­˜æˆ–åˆ›å»ºéªŒè¯å™¨</span>
Â Â â†“
<span class="hljs-built_in">createAndInitializeValidator</span>()
Â Â â†“
<span class="hljs-built_in">findMatchingValidatorClass</span>()Â Â <span class="hljs-comment">//Â æŸ¥æ‰¾éªŒè¯å™¨ç±»</span>
Â Â â†“
åœ¨Â HibernateÂ ValidatorÂ <span class="hljs-number">5</span><span class="hljs-selector-class">.x</span>Â çš„éªŒè¯å™¨æ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾
Â Â â†“
æ‰¾ä¸åˆ°Â NotBlankValidatorï¼ˆå› ä¸ºÂ <span class="hljs-number">5</span><span class="hljs-selector-class">.x</span>Â æ²¡æœ‰å®ç°ï¼‰
Â Â â†“
è¿”å›Â null
Â Â â†“
åˆ›å»ºÂ DUMMY_CONSTRAINT_VALIDATOR
Â Â â†“
ç¼“å­˜å¹¶è¿”å›Â DUMMY
Â Â â†“
<span class="hljs-built_in">getInitializedValidator</span>()Â æ£€æµ‹åˆ°æ˜¯Â DUMMYï¼Œè¿”å›Â null
Â Â â†“
<span class="hljs-built_in">getConstraintValidatorNoUnwrapping</span>()Â æ£€æµ‹åˆ°Â validatorÂ ==Â null
Â Â â†“
æŠ›å‡ºÂ UnexpectedTypeExceptionÂ å¼‚å¸¸
</code></pre>
<h4 data-id="heading-5">éªŒè¯å™¨æ˜¯å¦‚ä½•åŠ è½½çš„ï¼Ÿ</h4>
<p>æ—¢ç„¶ <code>findMatchingValidatorClass</code> æ–¹æ³•æ‰¾ä¸åˆ°éªŒè¯å™¨ï¼Œé‚£ä¹ˆéªŒè¯å™¨åˆ—è¡¨æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>Java Field Watchpoints</strong> æ¥ç›‘æ§éªŒè¯å™¨åˆ—è¡¨çš„æ„å»ºè¿‡ç¨‹ã€‚</p>
<p>åœ¨ IDE ä¸­å¯¹ <code>matchingConstraintValidatorClasses</code> å­—æ®µè®¾ç½® Field Watchpointï¼Œè§‚å¯Ÿå®ƒä½•æ—¶è¢«èµ‹å€¼ï¼š</p>
<p>ä½ ä¼šå‘ç°æ–­ç‚¹åœåœ¨äº† <code>ConstraintHelper</code> ç±»çš„ <code>findValidatorClasses</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/**
Â *Â æŸ¥æ‰¾èƒ½å¤Ÿå¤„ç†æŒ‡å®šæ³¨è§£ç±»å‹çš„æ‰€æœ‰éªŒè¯å™¨ç±»
Â */</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-operator">&lt;</span><span class="hljs-type">A</span>Â extendsÂ <span class="hljs-type">Annotation</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;&gt;
Â Â Â Â Â Â Â Â findValidatorClasses(<span class="hljs-type">Class</span>&lt;<span class="hljs-type">A</span>&gt;Â annotationType,Â <span class="hljs-type">ValidationTarget</span>Â validationTarget)Â {

Â Â Â Â <span class="hljs-comment">//Â 1.Â è·å–è¯¥æ³¨è§£ç±»å‹å¯¹åº”çš„æ‰€æœ‰éªŒè¯å™¨ç±»ï¼ˆå…³é”®æ–¹æ³•ï¼ï¼‰</span>
Â Â Â Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;&gt;Â validatorClassesÂ <span class="hljs-operator">=</span>
Â Â Â Â Â Â Â Â getAllValidatorClasses(annotationType);

Â Â Â Â <span class="hljs-comment">//Â 2.Â è¿‡æ»¤å‡ºåŒ¹é…çš„éªŒè¯å™¨ç±»</span>
Â Â Â Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;&gt;Â matchingValidatorClassesÂ <span class="hljs-operator">=</span>
Â Â Â Â Â Â Â Â newArrayList();

Â Â Â Â <span class="hljs-keyword">for</span>Â (<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;Â validatorClassÂ :Â validatorClasses)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ£€æŸ¥éªŒè¯å™¨æ˜¯å¦æ”¯æŒæŒ‡å®šçš„éªŒè¯ç›®æ ‡ï¼ˆæ–¹æ³•å‚æ•°ã€è¿”å›å€¼ç­‰ï¼‰</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (supportsValidationTarget(validatorClass,Â validationTarget))Â {
Â Â Â Â Â Â Â Â Â Â Â Â matchingValidatorClasses.add(validatorClass);
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">return</span>Â matchingValidatorClasses;
}
</code></pre>
<p><strong>å…³é”®åœ¨äº <code>getAllValidatorClasses</code> æ–¹æ³•ï¼</strong></p>
<p>è¿™ä¸ªæ–¹æ³•ä»å†…éƒ¨çš„éªŒè¯å™¨æ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">private</span>Â <span class="hljs-operator">&lt;</span><span class="hljs-type">A</span>Â extendsÂ <span class="hljs-type">Annotation</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;&gt;
Â Â Â Â Â Â Â Â getAllValidatorClasses(<span class="hljs-type">Class</span>&lt;<span class="hljs-type">A</span>&gt;Â annotationType)Â {

Â Â Â Â <span class="hljs-comment">//Â ä»Â builtinConstraintsÂ æ˜ å°„è¡¨ä¸­æŸ¥æ‰¾</span>
Â Â Â Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;?,Â ?&gt;&gt;&gt;Â validatorClassesÂ <span class="hljs-operator">=</span>
Â Â Â Â Â Â Â Â builtinConstraints.get(annotationType);

Â Â Â Â <span class="hljs-keyword">if</span>Â (validatorClassesÂ <span class="hljs-operator">==</span>Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å¦‚æœä¸æ˜¯å†…ç½®çº¦æŸï¼Œå°è¯•ä»æ³¨è§£çš„Â @ConstraintÂ å…ƒæ³¨è§£ä¸­è·å–</span>
Â Â Â Â Â Â Â Â validatorClassesÂ <span class="hljs-operator">=</span>Â getValidatorClassesFromConstraintAnnotation(annotationType);
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">return</span>Â (<span class="hljs-type">List</span>)Â validatorClasses;
}
</code></pre>
<h4 data-id="heading-6">éªŒè¯å™¨æ³¨å†Œè¡¨ï¼šbuiltinConstraints çš„åˆå§‹åŒ–</h4>
<p><code>builtinConstraints</code> æ˜¯ä¸€ä¸ª <code>Map&lt;Class&lt;? extends Annotation&gt;, List&lt;Class&lt;? extends ConstraintValidator&lt;?, ?&gt;&gt;&gt;&gt;</code> æ˜ å°„è¡¨ï¼Œåœ¨ <code>ConstraintHelper</code> æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ã€‚</p>
<p><strong>Hibernate Validator 5.x çš„æ³¨å†Œè¡¨ï¼š</strong></p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">public</span>Â <span class="hljs-title class_">ConstraintHelper</span>()Â {
Â Â Â Â <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Class</span>&lt;?Â extendsÂ <span class="hljs-title class_">Annotation</span>&gt;,Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Class</span>&lt;?Â extendsÂ <span class="hljs-title class_">ConstraintValidator</span>&lt;<span class="hljs-string">?,</span>Â <span class="hljs-string">?&gt;</span>&gt;&gt;&gt;
Â Â Â Â Â Â Â Â tmpConstraintsÂ =Â newHashMap();

Â Â Â Â <span class="hljs-regexp">//</span>Â æ³¨å†ŒÂ <span class="hljs-variable">@NotNull</span>Â éªŒè¯å™¨
Â Â Â Â putConstraint(tmpConstraints,Â <span class="hljs-title class_">NotNull</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â <span class="hljs-title class_">NotNullValidator</span>.<span class="hljs-keyword">class</span>);

Â Â Â Â <span class="hljs-regexp">//</span>Â æ³¨å†ŒÂ <span class="hljs-variable">@Size</span>Â éªŒè¯å™¨ï¼ˆå¤šä¸ªå®ç°ï¼‰
Â Â Â Â putConstraints(tmpConstraints,Â <span class="hljs-title class_">Size</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â <span class="hljs-title class_">Arrays</span>.asList(
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-title class_">SizeValidatorForCharSequence</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-title class_">SizeValidatorForCollection</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-title class_">SizeValidatorForArray</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-title class_">SizeValidatorForMap</span>.<span class="hljs-keyword">class</span>
Â Â Â Â Â Â Â Â )
Â Â Â Â );

Â Â Â Â <span class="hljs-regexp">//</span>Â æ³¨å†ŒÂ <span class="hljs-variable">@Min</span>,Â <span class="hljs-variable">@Max</span>,Â <span class="hljs-variable">@Pattern</span>Â ç­‰...
Â Â Â Â putConstraint(tmpConstraints,Â <span class="hljs-title class_">Min</span>.<span class="hljs-keyword">class</span>,Â <span class="hljs-title class_">MinValidatorForNumber</span>.<span class="hljs-keyword">class</span>);
Â Â Â Â putConstraint(tmpConstraints,Â <span class="hljs-title class_">Max</span>.<span class="hljs-keyword">class</span>,Â <span class="hljs-title class_">MaxValidatorForNumber</span>.<span class="hljs-keyword">class</span>);
Â Â Â Â putConstraint(tmpConstraints,Â <span class="hljs-title class_">Pattern</span>.<span class="hljs-keyword">class</span>,Â <span class="hljs-title class_">PatternValidator</span>.<span class="hljs-keyword">class</span>);

Â Â Â Â <span class="hljs-regexp">//</span>æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰Â <span class="hljs-title class_">NotBlank</span>Â çš„æ³¨å†Œï¼

Â Â Â Â this.builtinConstraintsÂ =Â <span class="hljs-title class_">Collections</span>.unmodifiableMap(tmpConstraints);
}
</code></pre>
<h4 data-id="heading-7">å®Œæ•´çš„éªŒè¯å™¨æŸ¥æ‰¾æµç¨‹</h4>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªæµç¨‹ä¸²èµ·æ¥äº†ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-number">1.</span>Â åº”ç”¨å¯åŠ¨
Â Â Â â†“
<span class="hljs-number">2.</span>Â ConstraintHelperÂ åˆå§‹åŒ–
Â Â Â â†“
<span class="hljs-number">3.</span>Â æ„å»ºÂ builtinConstraintsÂ æ˜ å°„è¡¨
Â Â Â -Â HibernateÂ ValidatorÂ <span class="hljs-number">5.</span>x:Â æ²¡æœ‰Â NotBlank.<span class="hljs-keyword">class</span>Â â†’Â NotBlankValidator.<span class="hljs-keyword">class</span>Â æ˜ å°„
Â Â Â -Â HibernateÂ ValidatorÂ <span class="hljs-number">6.</span>x:Â æœ‰Â NotBlank.<span class="hljs-keyword">class</span>Â â†’Â NotBlankValidator.<span class="hljs-keyword">class</span>Â æ˜ å°„
Â Â Â â†“
<span class="hljs-number">4.</span>Â è§¦å‘å­—æ®µæ ¡éªŒï¼ˆ<span class="hljs-meta">@NotBlank</span>Â <span class="hljs-built_in">String</span>Â keywordsï¼‰
Â Â Â â†“
<span class="hljs-number">5.</span>Â findMatchingValidatorClass()Â è¢«è°ƒç”¨
Â Â Â â†“
<span class="hljs-number">6.</span>Â è°ƒç”¨Â findValidatorClasses(NotBlank.<span class="hljs-keyword">class</span>,Â ...)
Â Â Â â†“
<span class="hljs-number">7.</span>Â è°ƒç”¨Â getAllValidatorClasses(NotBlank.<span class="hljs-keyword">class</span>)
Â Â Â â†“
<span class="hljs-number">8.</span>Â ä»Â builtinConstraints.<span class="hljs-keyword">get</span>(NotBlank.<span class="hljs-keyword">class</span>)Â æŸ¥æ‰¾
Â Â Â -Â HibernateÂ ValidatorÂ <span class="hljs-number">5.</span>x:Â è¿”å›Â <span class="hljs-keyword">null</span>ï¼ˆæ˜ å°„è¡¨ä¸­æ²¡æœ‰ï¼‰
Â Â Â -Â HibernateÂ ValidatorÂ <span class="hljs-number">6.</span>x:Â è¿”å›Â [NotBlankValidator.<span class="hljs-keyword">class</span>]
Â Â Â â†“
<span class="hljs-number">9.</span>Â HibernateÂ ValidatorÂ <span class="hljs-number">5.</span>xÂ è·¯å¾„ï¼š
Â Â Â validatorClassesÂ ==Â <span class="hljs-keyword">null</span>
Â Â Â â†’Â matchingValidatorClassesÂ ä¸ºç©º
Â Â Â â†’Â findMatchingValidatorClassÂ è¿”å›Â <span class="hljs-keyword">null</span>
Â Â Â â†’Â åˆ›å»ºÂ DUMMY_CONSTRAINT_VALIDATOR
Â Â Â â†’Â getInitializedValidatorÂ è¿”å›Â <span class="hljs-keyword">null</span>
Â Â Â â†’Â æŠ›å‡ºÂ UnexpectedTypeException
</code></pre>
<p><strong>é€šè¿‡è°ƒè¯•éªŒè¯ï¼š</strong></p>
<p>ä½ å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰“æ–­ç‚¹éªŒè¯æ•´ä¸ªæµç¨‹ï¼š</p>
<ol>
<li><code>ConstraintHelper</code> æ„é€ å‡½æ•° - æŸ¥çœ‹ <code>builtinConstraints</code> çš„å†…å®¹</li>
<li><code>getAllValidatorClasses</code> - æŸ¥çœ‹æŸ¥æ‰¾ç»“æœ</li>
<li><code>findValidatorClasses</code> - æŸ¥çœ‹ <code>matchingValidatorClasses</code> çš„æ„å»º</li>
<li><code>createAndInitializeValidator</code> - æŸ¥çœ‹ <code>validatorClass</code> æ˜¯å¦ä¸º null</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dce800a6b9f4df399fcab760516837b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgOeWPt-i-vuS6ug==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764516380&amp;x-signature=cKfjRAcm80KkY63ndjenUIKeA0s%3D" alt="" loading="lazy"/></p>
<p>ä»è°ƒè¯•æˆªå›¾å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼š</p>
<ol>
<li>
<p><strong>æœ‰ <code>javax.validation.constraints.NotNull</code></strong></p>
<ul>
<li>è¿™æ˜¯æ ‡å‡† Bean Validation æ³¨è§£</li>
<li>Hibernate Validator 5.x æ”¯æŒ</li>
</ul>
</li>
<li>
<p><strong>æœ‰ <code>org.hibernate.validator.constraints.NotBlank</code></strong></p>
<ul>
<li>æ³¨æ„åŒ…åï¼è¿™æ˜¯ <code>org.hibernate.validator.constraints</code></li>
<li>ä¸æ˜¯æ ‡å‡†çš„ <code>javax.validation.constraints</code></li>
<li>è¿™æ˜¯ Hibernate Validator è‡ªå·±æ‰©å±•çš„æ³¨è§£ï¼Œä¸æ˜¯ Bean Validation 2.0 æ ‡å‡†</li>
</ul>
</li>
<li>
<p><strong>æ²¡æœ‰ <code>javax.validation.constraints.NotBlank</code></strong></p>
<ul>
<li>æ ‡å‡†çš„ Bean Validation 2.0 <code>@NotBlank</code> ä¸åœ¨æ˜ å°„è¡¨ä¸­</li>
<li>æ‰€ä»¥ä½¿ç”¨ <code>javax.validation.constraints.NotBlank</code> ä¼šæ‰¾ä¸åˆ°éªŒè¯å™¨</li>
</ul>
</li>
</ol>
<p><strong>ä¸¤ä¸ªä¸åŒçš„ @NotBlank</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â âŒÂ åœ¨Â HibernateÂ ValidatorÂ 5.xÂ ä¸­ä¸æ”¯æŒï¼ˆBeanÂ ValidationÂ 2.0Â æ ‡å‡†ï¼‰</span>
<span class="hljs-keyword">import</span>Â javax.<span class="hljs-property">validation</span>.<span class="hljs-property">constraints</span>.<span class="hljs-property">NotBlank</span>;

<span class="hljs-meta">@NotBlank</span>Â Â <span class="hljs-comment">//Â æŠ›å‡ºå¼‚å¸¸ï¼šæ‰¾ä¸åˆ°éªŒè¯å™¨</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-title class_">String</span>Â keywords;
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â åœ¨Â HibernateÂ ValidatorÂ 5.xÂ ä¸­æ”¯æŒï¼ˆHibernateÂ è‡ªå®šä¹‰æ‰©å±•ï¼‰</span>
<span class="hljs-keyword">import</span>Â org.<span class="hljs-property">hibernate</span>.<span class="hljs-property">validator</span>.<span class="hljs-property">constraints</span>.<span class="hljs-property">NotBlank</span>;

<span class="hljs-meta">@NotBlank</span>Â Â <span class="hljs-comment">//Â å¯ä»¥æ­£å¸¸å·¥ä½œ</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-title class_">String</span>Â keywords;
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä¸ª @NotBlankï¼Ÿ</strong></p>
<ul>
<li><strong>Hibernate Validator 5.x æ—¶ä»£</strong>ï¼š<code>@NotBlank</code> æ˜¯ Hibernate çš„è‡ªå®šä¹‰æ‰©å±•ï¼Œä½äº <code>org.hibernate.validator.constraints</code> åŒ…</li>
<li><strong>Bean Validation 2.0 æ—¶ä»£</strong>ï¼š<code>@NotBlank</code> è¢«çº³å…¥æ ‡å‡†è§„èŒƒï¼Œä½äº <code>javax.validation.constraints</code> åŒ…</li>
<li><strong>Hibernate Validator 6.x</strong>ï¼šåŒæ—¶æ”¯æŒä¸¤ä¸ªåŒ…çš„ <code>@NotBlank</code>ï¼Œå»ºè®®ä½¿ç”¨æ ‡å‡†åŒ…</li>
</ul>
<h2 data-id="heading-8">è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-9">æ–¹æ¡ˆä¸€ï¼šæ£€æŸ¥å¹¶æ·»åŠ ä¾èµ–ï¼ˆæ¨èï¼‰</h3>
<p>ç¡®ä¿ <code>pom.xml</code> ä¸­åŒ…å«æ­£ç¡®ç‰ˆæœ¬çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â BeanÂ ValidationÂ APIÂ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.validation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>validation-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--Â HibernateÂ ValidatorÂ å®ç°Â --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.validator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.2.5.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>æ³¨æ„ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š</strong></p>
<ul>
<li><code>validation-api 2.0.x</code> å¯¹åº” <code>hibernate-validator 6.x</code></li>
<li><code>validation-api 1.1.x</code> å¯¹åº” <code>hibernate-validator 5.x</code>ï¼ˆä¸æ”¯æŒ @NotBlankï¼‰</li>
</ul>
<h3 data-id="heading-10">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Spring Boot Starter</h3>
<p>å¦‚æœæ˜¯ Spring Boot é¡¹ç›®ï¼Œæ¨èä½¿ç”¨å®˜æ–¹ starterï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>è¿™ä¸ª starter ä¼šè‡ªåŠ¨å¼•å…¥å…¼å®¹ç‰ˆæœ¬çš„ <code>validation-api</code> å’Œ <code>hibernate-validator</code>ã€‚</p>
<h3 data-id="heading-11">æ–¹æ¡ˆä¸‰ï¼šé™çº§ä½¿ç”¨ @NotEmpty æˆ– @NotNull + @Size</h3>
<p>å¦‚æœæš‚æ—¶æ— æ³•å‡çº§ä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨æ—§ç‰ˆæœ¬æ”¯æŒçš„æ³¨è§£ç»„åˆï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">//Â æ–¹å¼1ï¼šä½¿ç”¨Â @NotEmptyï¼ˆBeanÂ ValidationÂ 2.0ï¼‰</span>
<span class="hljs-variable">@NotEmpty</span>
privateÂ StringÂ keywords;

<span class="hljs-comment">//Â æ–¹å¼2ï¼šä½¿ç”¨ç»„åˆæ³¨è§£ï¼ˆBeanÂ ValidationÂ 1.1ï¼‰</span>
<span class="hljs-variable">@NotNull</span>
<span class="hljs-variable">@Size</span>(minÂ =Â <span class="hljs-number">1</span>)
privateÂ StringÂ keywords;
</code></pre>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p>è¿™æ¬¡è¸©å‘è®©æˆ‘æ·±åˆ»ç†è§£äº†ï¼š</p>
<ol>
<li><strong>æ³¨è§£å®šä¹‰å’Œæ³¨è§£å®ç°æ˜¯åˆ†ç¦»çš„</strong>ï¼švalidation-api åªæä¾›è§„èŒƒï¼Œhibernate-validator æä¾›å®ç°</li>
<li><strong>ç‰ˆæœ¬åŒ¹é…å¾ˆå…³é”®</strong>ï¼šBean Validation 1.1 ä¸æ”¯æŒ @NotBlank</li>
<li><strong>ä¾èµ–ç®¡ç†è¦è§„èŒƒ</strong>ï¼šä½¿ç”¨ Spring Boot Starter å¯ä»¥é¿å…å¾ˆå¤šç‰ˆæœ¬å†²çªé—®é¢˜</li>
<li><strong>é”™è¯¯ä¿¡æ¯è¦ä»”ç»†è¯»</strong>ï¼š<code>No validator could be found</code> å…¶å®å·²ç»æ˜ç¡®æŒ‡å‡ºæ˜¯ç¼ºå°‘éªŒè¯å™¨å®ç°</li>
</ol>
<p>æ™®é€šå…¬å¸å¼€å‘ç¡®å®éœ€è¦æ³¨æ„è¿™äº›ç»†èŠ‚ï¼Œæ¯•ç«Ÿæ²¡æœ‰ä¸“é—¨çš„æ¶æ„ç»„æ¥ç»Ÿä¸€ç®¡ç†ä¾èµ–ç‰ˆæœ¬ï¼Œè¸©è¿‡å‘æ‰èƒ½è®°å¾—æ›´ç‰¢ã€‚</p>
<hr/>
<p><strong>ç›¸å…³èµ„æºï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbeanvalidation.org%2F2.0%2F" target="_blank" title="https://beanvalidation.org/2.0/" ref="nofollow noopener noreferrer">Bean Validation 2.0 è§„èŒƒ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhibernate.org%2Fvalidator%2F" target="_blank" title="https://hibernate.org/validator/" ref="nofollow noopener noreferrer">Hibernate Validator æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspring.io%2Fguides%2Fgs%2Fvalidating-form-input%2F" target="_blank" title="https://spring.io/guides/gs/validating-form-input/" ref="nofollow noopener noreferrer">Spring Boot Validation æ–‡æ¡£</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æ @DataScope æ•°æ®æƒé™æ³¨è§£]]></title>    <link>https://juejin.cn/post/7575412016404742154</link>    <guid>https://juejin.cn/post/7575412016404742154</guid>    <pubDate>2025-11-23T15:36:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575412016404742154" data-draft-id="7575438636331434035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æ @DataScope æ•°æ®æƒé™æ³¨è§£"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2025-11-23T15:36:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…ƒYäº¨H"/> <meta itemprop="url" content="https://juejin.cn/user/2839351584888617"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æ @DataScope æ•°æ®æƒé™æ³¨è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2839351584888617/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…ƒYäº¨H
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T15:36:52.000Z" title="Sun Nov 23 2025 15:36:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">RuoYi æ¡†æ¶å®æˆ˜ç¬”è®°ï¼šæ·±å…¥è§£æ @DataScope æ•°æ®æƒé™æ³¨è§£</h2>
<h3 data-id="heading-1">1. å‰è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦ @DataScopeï¼Ÿ</h3>
<p>åœ¨ä¼ä¸šçº§åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæƒé™æ§åˆ¶é€šå¸¸åˆ†ä¸ºä¸¤ä¸ªç»´åº¦ï¼š</p>
<ul>
<li><strong>åŠŸèƒ½æƒé™</strong>ï¼šæ§åˆ¶ç”¨æˆ·èƒ½çœ‹åˆ°å“ªäº›èœå•ã€ç‚¹å‡»å“ªäº›æŒ‰é’®ï¼ˆé€šå¸¸é€šè¿‡ RBAC æ¨¡å‹ + <code>@PreAuthorize</code> å®ç°ï¼‰ã€‚</li>
<li><strong>æ•°æ®æƒé™</strong>ï¼šæ§åˆ¶ç”¨æˆ·èƒ½çœ‹åˆ°<strong>å“ªå‡ è¡Œæ•°æ®</strong>ã€‚ä¾‹å¦‚ï¼šé”€å”®æ€»ç›‘èƒ½çœ‹å…¨å…¬å¸çš„è®¢å•ï¼Œéƒ¨é—¨ç»ç†åªèƒ½çœ‹æœ¬éƒ¨é—¨çš„è®¢å•ï¼Œæ™®é€šé”€å”®åªèƒ½çœ‹è‡ªå·±çš„è®¢å•ã€‚</li>
</ul>
<p>å¦‚æœè¦åœ¨ä¸šåŠ¡ä»£ç ä¸­é€šè¿‡ <code>if (user.isManager()) { ... }</code> è¿™ç§æ–¹å¼æ‰‹åŠ¨æ‹¼æ¥ SQLï¼Œä»£ç å°†å˜å¾—æå…¶è‡ƒè‚¿ä¸”éš¾ä»¥ç»´æŠ¤ã€‚RuoYi æ¡†æ¶æä¾›çš„ <code>@DataScope</code> æ³¨è§£ï¼Œæ­£æ˜¯åˆ©ç”¨ <strong>AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰</strong> æŠ€æœ¯ï¼Œä¼˜é›…åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-2">2. æ ¸å¿ƒåŸç†</h3>
<p><code>@DataScope</code> çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>â€œåœ¨ SQL æ‰§è¡Œå‰ï¼Œæ ¹æ®å½“å‰ç™»å½•ç”¨æˆ·çš„è§’è‰²æƒé™ï¼ŒåŠ¨æ€æ‹¼æ¥ SQL è¿‡æ»¤æ¡ä»¶ã€‚â€</strong></p>
<h4 data-id="heading-3">å·¥ä½œæµç¨‹</h4>
<ol>
<li><strong>AOP æ‹¦æˆª</strong>ï¼š<code>DataScopeAspect</code> åˆ‡é¢æ‹¦æˆªæ‰€æœ‰æ ‡è®°äº† <code>@DataScope</code> çš„æ–¹æ³•ã€‚</li>
<li><strong>è·å–è§’è‰²</strong>ï¼šè·å–å½“å‰ç™»å½•ç”¨æˆ·åŠå…¶ç»‘å®šçš„è§’è‰²ä¿¡æ¯ã€‚</li>
<li><strong>ç”Ÿæˆ SQL</strong>ï¼šæ ¹æ®è§’è‰²é…ç½®çš„â€œæ•°æ®èŒƒå›´â€ï¼ˆData Scopeï¼‰ï¼Œç”Ÿæˆä¸€æ®µ SQL ç‰‡æ®µï¼ˆå¦‚ <code>AND dept_id = 100</code>ï¼‰ã€‚</li>
<li><strong>å‚æ•°æ³¨å…¥</strong>ï¼šå°†è¿™æ®µ SQL æ³¨å…¥åˆ°å‚æ•°å¯¹è±¡ï¼ˆéœ€ç»§æ‰¿ <code>BaseEntity</code>ï¼‰çš„ <code>params</code> å±æ€§ä¸­ã€‚</li>
<li><strong>MyBatis æ‰§è¡Œ</strong>ï¼šåœ¨ XML ä¸­é€šè¿‡ <code>${params.dataScope}</code> å°†è¿‡æ»¤æ¡ä»¶æ‹¼æ¥åˆ°ä¸» SQL åé¢ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-4">3. æ”¯æŒçš„æ•°æ®æƒé™æ¨¡å¼</h3>
<p>RuoYi åœ¨â€œè§’è‰²ç®¡ç†â€ä¸­é»˜è®¤æ”¯æŒ 5 ç§æ•°æ®èŒƒå›´ï¼Œåº•å±‚é€»è¾‘å¦‚ä¸‹ï¼š</p>









































<table><thead><tr><th align="left">æƒé™åç§°</th><th align="left">å¯¹åº”ä»£ç </th><th align="left">é€»è¾‘æè¿°</th><th align="left">SQL ç¤ºä¾‹ç‰‡æ®µ</th></tr></thead><tbody><tr><td align="left"><strong>å…¨éƒ¨æ•°æ®æƒé™</strong></td><td align="left"><code>DATA_SCOPE_ALL</code></td><td align="left">ä¸è¿›è¡Œè¿‡æ»¤ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰æ•°æ®</td><td align="left">(æ— æ‹¼æ¥)</td></tr><tr><td align="left"><strong>è‡ªå®šæ•°æ®æƒé™</strong></td><td align="left"><code>DATA_SCOPE_CUSTOM</code></td><td align="left">æ ¹æ®è§’è‰²é…ç½®çš„éƒ¨é—¨åˆ—è¡¨è¿‡æ»¤</td><td align="left"><code>OR d.dept_id IN (SELECT dept_id FROM sys_role_dept WHERE role_id = X)</code></td></tr><tr><td align="left"><strong>éƒ¨é—¨æ•°æ®æƒé™</strong></td><td align="left"><code>DATA_SCOPE_DEPT</code></td><td align="left">ä»…æŸ¥çœ‹æœ¬éƒ¨é—¨æ•°æ®</td><td align="left"><code>OR d.dept_id = 101</code></td></tr><tr><td align="left"><strong>éƒ¨é—¨åŠä»¥ä¸‹</strong></td><td align="left"><code>DATA_SCOPE_DEPT_AND_CHILD</code></td><td align="left">æŸ¥çœ‹æœ¬éƒ¨é—¨åŠæ‰€æœ‰å­éƒ¨é—¨æ•°æ®</td><td align="left"><code>OR d.dept_id IN (SELECT dept_id FROM sys_dept WHERE find_in_set(101, ancestors))</code></td></tr><tr><td align="left"><strong>ä»…æœ¬äººæ•°æ®</strong></td><td align="left"><code>DATA_SCOPE_SELF</code></td><td align="left">ä»…æŸ¥çœ‹è‡ªå·±åˆ›å»ºçš„æ•°æ®</td><td align="left"><code>OR u.user_id = 1</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">4. ä½¿ç”¨æŒ‡å—ï¼ˆä¸‰æ­¥èµ°ï¼‰</h3>
<h4 data-id="heading-6">ç¬¬ä¸€æ­¥ï¼šService å±‚æ·»åŠ æ³¨è§£</h4>
<p>åœ¨éœ€è¦è¿‡æ»¤æ•°æ®çš„ä¸šåŠ¡æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ã€‚</p>
<ul>
<li><strong><code>deptAlias</code></strong>ï¼šæŒ‡å®š SQL ä¸­éƒ¨é—¨è¡¨çš„åˆ«åï¼ˆé»˜è®¤ <code>d</code>ï¼‰ã€‚</li>
<li><strong><code>userAlias</code></strong>ï¼šæŒ‡å®š SQL ä¸­ç”¨æˆ·è¡¨çš„åˆ«åï¼ˆé»˜è®¤ <code>u</code>ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysUserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ISysUserService</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-comment">// å‘Šè¯‰åˆ‡é¢ï¼šSQLé‡Œéƒ¨é—¨è¡¨åˆ«åæ˜¯ dï¼Œç”¨æˆ·è¡¨åˆ«åæ˜¯ u</span>
    <span class="hljs-meta">@DataScope(deptAlias = "d", userAlias = "u")</span> 
    <span class="hljs-keyword">public</span> List&lt;SysUser&gt; <span class="hljs-title function_">selectUserList</span><span class="hljs-params">(SysUser user)</span> {
        <span class="hljs-keyword">return</span> userMapper.selectUserList(user);
    }
}
</code></pre>
<h4 data-id="heading-7">ç¬¬äºŒæ­¥ï¼šEntity ç±»ç»§æ‰¿ BaseEntity</h4>
<p>æŸ¥è¯¢å‚æ•°å¯¹è±¡ï¼ˆå¦‚ <code>SysUser</code>ï¼‰å¿…é¡»ç»§æ‰¿ <code>BaseEntity</code>ï¼Œå› ä¸ºåˆ‡é¢æ˜¯å°†ç”Ÿæˆçš„ SQL å­˜å…¥ <code>BaseEntity</code> çš„ <code>params</code> map ä¸­ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseEntity</span> {
    <span class="hljs-comment">// ... å±æ€§å®šä¹‰</span>
}
</code></pre>
<h4 data-id="heading-8">ç¬¬ä¸‰æ­¥ï¼šMapper XML æ‹¼æ¥ SQL</h4>
<p>åœ¨ MyBatis çš„ XML æ–‡ä»¶ä¸­ï¼Œå°†ç”Ÿæˆçš„ SQL ç‰‡æ®µæ‹¼æ¥åˆ° <code>WHERE</code> å­å¥çš„æœ€åã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¿…é¡»ä½¿ç”¨ <code>$</code> ç¬¦å·ï¼ˆæ–‡æœ¬æ›¿æ¢ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨ <code>#</code>ï¼ˆé¢„ç¼–è¯‘ï¼‰ã€‚</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectUserList"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"SysUser"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"SysUserResult"</span>&gt;</span>
    SELECT u.user_id, u.dept_id, u.nick_name, d.dept_name
    FROM sys_user u
    LEFT JOIN sys_dept d ON u.dept_id = d.dept_id
    WHERE u.del_flag = '0'
    
    <span class="hljs-comment">&lt;!-- å…³é”®ç‚¹ï¼šåŠ¨æ€æ‹¼æ¥æ•°æ®æƒé™è¿‡æ»¤ SQL --&gt;</span>
    ${params.dataScope}
    
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">5. é¿å‘æŒ‡å—ä¸æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>
<p><strong>åˆ«åå¿…é¡»åŒ¹é…</strong></p>
<ul>
<li>æ³¨è§£ä¸­çš„ <code>deptAlias="d"</code> å¿…é¡»ä¸ XML ä¸­ <code>LEFT JOIN sys_dept d</code> çš„åˆ«åä¸¥æ ¼ä¸€è‡´ã€‚å¦‚æœ XML ä¸­å†™çš„æ˜¯ <code>LEFT JOIN sys_dept sd</code>ï¼Œåˆ™æ³¨è§£å¿…é¡»æ”¹ä¸º <code>deptAlias="sd"</code>ï¼Œå¦åˆ™ä¼šæŠ¥ <code>Unknown column 'd.dept_id'</code> é”™è¯¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¶…çº§ç®¡ç†å‘˜ç‰¹æƒ</strong></p>
<ul>
<li>å¦‚æœæ˜¯è¶…çº§ç®¡ç†å‘˜ï¼ˆ<code>admin</code> æˆ–æ‹¥æœ‰æ‰€æœ‰æƒé™çš„è§’è‰²ï¼‰ï¼Œåˆ‡é¢é€»è¾‘é€šå¸¸ä¼šç›´æ¥è·³è¿‡ï¼Œä¸æ‹¼æ¥ä»»ä½• SQLï¼Œä»è€Œæ‹¥æœ‰æŸ¥çœ‹æ‰€æœ‰æ•°æ®çš„æƒé™ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®è¡¨å…³è”</strong></p>
<ul>
<li>å¦‚æœè¦ä½¿ç”¨éƒ¨é—¨æƒé™ï¼Œä¸»æŸ¥è¯¢è¡¨å¿…é¡»åŒ…å« <code>dept_id</code> æˆ–è€…å…³è”äº† <code>sys_dept</code> è¡¨ã€‚</li>
<li>å¦‚æœè¦ä½¿ç”¨â€œä»…æœ¬äººâ€æƒé™ï¼Œä¸»æŸ¥è¯¢è¡¨å¿…é¡»åŒ…å« <code>user_id</code> æˆ–è€…å…³è”äº† <code>sys_user</code> è¡¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‚æ•°å¯¹è±¡é™åˆ¶</strong></p>
<ul>
<li>å¦‚æœæ˜¯è‡ªå®šä¹‰çš„ DTO å¯¹è±¡ä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼ŒåŠ¡å¿…ç¡®ä¿å®ƒç»§æ‰¿äº† <code>BaseEntity</code>ï¼Œæˆ–è€…ä½ è‡ªå·±æ‰‹åŠ¨åœ¨ DTO ä¸­æ·»åŠ  <code>Map&lt;String, Object&gt; params</code> å­—æ®µï¼Œå¦åˆ™åˆ‡é¢æ— æ³•æ³¨å…¥ SQLã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤šè¡¨è¿æ¥æ—¶çš„æ­§ä¹‰</strong></p>
<ul>
<li>å¦‚æœå¤šä¸ªè¡¨éƒ½æœ‰ <code>dept_id</code> å­—æ®µï¼ŒåŠ¡å¿…é€šè¿‡ <code>deptAlias</code> æ˜ç¡®æŒ‡å®šä½¿ç”¨å“ªå¼ è¡¨çš„å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œé˜²æ­¢ SQL å­—æ®µæ­§ä¹‰ï¼ˆAmbiguous columnï¼‰ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-10">6. æ€»ç»“</h3>
<p><code>@DataScope</code> æ˜¯ RuoYi æ¡†æ¶ä¸­è§£å†³æ•°æ®éš”ç¦»é—®é¢˜çš„â€œç¥å…µåˆ©å™¨â€ã€‚å®ƒé€šè¿‡ <strong>è§£è€¦ä¸šåŠ¡ä»£ç ä¸æƒé™é€»è¾‘</strong>ï¼Œè®©å¼€å‘è€…åªéœ€å…³æ³¨ SQL å…³è”å…³ç³»ï¼Œè€Œæ— éœ€å…³å¿ƒå¤æ‚çš„æƒé™åˆ¤æ–­ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLæ€§èƒ½ä¼˜åŒ–å¤„ç†]]></title>    <link>https://juejin.cn/post/7575119254314303514</link>    <guid>https://juejin.cn/post/7575119254314303514</guid>    <pubDate>2025-11-23T13:33:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575119254314303514" data-draft-id="7575119254313467930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLæ€§èƒ½ä¼˜åŒ–å¤„ç†"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2025-11-23T13:33:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ä¸‰çš„å¼€å‘æ—¥è®°"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLæ€§èƒ½ä¼˜åŒ–å¤„ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ä¸‰çš„å¼€å‘æ—¥è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:33:34.000Z" title="Sun Nov 23 2025 13:33:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">âœ… <strong>ä¸€ã€æ¨èçš„ my.cnfï¼ˆç”Ÿäº§ç¯å¢ƒä¼˜åŒ–æ¨¡æ¿ï¼‰</strong></h2>
<blockquote>
<p>âš ï¸ ä½ åªéœ€è¦ä¿®æ”¹ï¼š</p>
<ul>
<li>å†…å­˜å¤§å°ï¼ˆæœåŠ¡å™¨å†…å­˜ 16G / 32G / 64Gï¼‰</li>
<li>ç£ç›˜è·¯å¾„</li>
<li>InnoDB buffer pool size</li>
</ul>
</blockquote>
<p>ä¸‹é¢çš„é…ç½®å‡è®¾ä½ çš„æœåŠ¡å™¨ <strong>16GB RAM</strong></p>
<pre><code class="hljs language-js" lang="js">[client]
<span class="hljs-keyword">default</span>-character-set = utf8mb4

[mysql]
<span class="hljs-keyword">default</span>-character-set = utf8mb4

[mysqld]
# ========== åŸºç¡€è®¾ç½® ==========
user = mysql
port = <span class="hljs-number">3306</span>
basedir = <span class="hljs-regexp">/usr/</span>local/mysql
datadir = <span class="hljs-regexp">/data/my</span>sql
pid-file = <span class="hljs-regexp">/data/my</span>sql/mysqld.<span class="hljs-property">pid</span>
socket = <span class="hljs-regexp">/data/my</span>sql/mysql.<span class="hljs-property">sock</span>
character-set-server = utf8mb4
skip-name-resolve      # ç¦æ­¢ <span class="hljs-variable constant_">DNS</span> åæŸ¥ï¼ˆæ€§èƒ½æ˜æ˜¾æå‡ï¼‰
sql_mode = <span class="hljs-variable constant_">STRICT_TRANS_TABLES</span>,<span class="hljs-variable constant_">NO_ENGINE_SUBSTITUTION</span>
table_open_cache = <span class="hljs-number">4096</span>
open_files_limit = <span class="hljs-number">8192</span>
# ========== <span class="hljs-title class_">InnoDB</span> é‡è¦ä¼˜åŒ– ==========
innodb_buffer_pool_size = 8G     # 16G æœºå™¨è®¾ç½®ä¸º 8Gï¼ˆ<span class="hljs-number">50</span>% å†…å­˜ï¼‰
innodb_buffer_pool_instances = <span class="hljs-number">8</span> # buffer pool åˆ†ç‰‡ï¼ˆæ¯Gä¸€ä¸ªæ¯”è¾ƒåˆé€‚ï¼‰
innodb_log_file_size = 1G        # redo log å•ä¸ªå¤§å°ï¼Œèƒ½å‡å°‘ checkpoint å¼€é”€
innodb_log_buffer_size = 64M     # å†™å¯†é›†åœºæ™¯å»ºè®® 64M~256M
innodb_flush_log_at_trx_commit = <span class="hljs-number">1</span> # å¼ºä¸€è‡´æ€§ï¼ˆå»ºè®®ç”Ÿäº§é»˜è®¤ <span class="hljs-number">1</span>ï¼‰
# å»ºè®®ï¼šé«˜ <span class="hljs-variable constant_">QPS</span> åœºæ™¯å¯æ”¹ä¸º <span class="hljs-number">2</span>ï¼ˆæ€§èƒ½æå‡<span class="hljs-number">10</span>å€ï¼Œä¸¢äº‹åŠ¡ <span class="hljs-string">"1s å†…"</span>ï¼‰
innodb_flush_method = <span class="hljs-variable constant_">O_DIRECT</span>   # é¿å…åŒç¼“å­˜
innodb_file_per_table = <span class="hljs-number">1</span>        # å¼ºçƒˆæ¨èï¼Œè¡¨ç‹¬ç«‹æ–‡ä»¶
innodb_io_capacity = <span class="hljs-number">4000</span>        # <span class="hljs-variable constant_">SSD</span> å»ºè®® <span class="hljs-number">2000</span>~<span class="hljs-number">8000</span>
innodb_io_capacity_max = <span class="hljs-number">8000</span>

# ========== è¿æ¥ç®¡ç† ==========
max_connections = <span class="hljs-number">2000</span>            # å¤§é¡¹ç›®éœ€è¦æ›´é«˜è¿æ¥æ•°
max_connect_errors = <span class="hljs-number">10</span>
wait_timeout = <span class="hljs-number">600</span>                # ç©ºé—²è¿æ¥è¶…æ—¶
interactive_timeout = <span class="hljs-number">600</span>

# ========== æŸ¥è¯¢ç¼“å­˜ç›¸å…³ï¼ˆ<span class="hljs-title class_">MySQL</span> <span class="hljs-number">5.7</span> æ‰æœ‰ï¼‰ ==========
query_cache_type = <span class="hljs-number">0</span>
query_cache_size = <span class="hljs-number">0</span>

# ========== æ—¥å¿—è®¾ç½® ==========
log_error = <span class="hljs-regexp">/data/my</span>sql/mysql-error.<span class="hljs-property">log</span>
slow_query_log = <span class="hljs-number">1</span>
slow_query_log_file = <span class="hljs-regexp">/data/my</span>sql/mysql-slow.<span class="hljs-property">log</span>
long_query_time = <span class="hljs-number">1</span>               # &gt;<span class="hljs-number">1</span> ç§’è®°å½•æ…¢ <span class="hljs-variable constant_">SQL</span>
log_queries_not_using_indexes = <span class="hljs-number">0</span> # ä¸å»ºè®®å¼€å¯ï¼Œä¼šçˆ†æ—¥å¿—

# ========== ä¸´æ—¶è¡¨ä¼˜åŒ– ==========
tmp_table_size = 256M
max_heap_table_size = 256M

# ========== æ’åº &amp; <span class="hljs-variable constant_">JOIN</span> æ€§èƒ½ ==========
sort_buffer_size = 4M
join_buffer_size = 4M
read_buffer_size = 4M
read_rnd_buffer_size = 4M

# ========== <span class="hljs-title class_">Binlog</span> ==========
server-id = <span class="hljs-number">1</span>
log_bin = mysql-bin
binlog_format = row
sync_binlog = <span class="hljs-number">1</span>      # æœ€å®‰å…¨ï¼Œæ€§èƒ½å¼±ï¼›é«˜ <span class="hljs-variable constant_">QPS</span> å¯è®¾ä¸º <span class="hljs-number">100</span>~<span class="hljs-number">1000</span>
expire_logs_days = <span class="hljs-number">7</span>
</code></pre>
<ul>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>innodb_flush_method</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> æ§åˆ¶æ•°æ®å’Œæ—¥å¿—å†™å…¥æ–‡ä»¶çš„æ–¹å¼ã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong></p>
<ul>
<li>åœ¨ <strong>Linux/Unix</strong> ç³»ç»Ÿä¸Šï¼Œæ¨èä½¿ç”¨ <strong><code>O_DIRECT</code></strong>ã€‚å®ƒç»•è¿‡æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œç›´æ¥å†™å…¥ç£ç›˜ï¼Œé¿å…åŒé‡ç¼“å­˜ï¼Œæé«˜æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</li>
<li><strong>ç¤ºä¾‹:</strong> <code>innodb_flush_method = O_DIRECT</code></li>
</ul>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>innodb_flush_log_at_trx_commit</code></p>
</li>
<li>
<p><strong>å–å€¼ä¸å«ä¹‰:</strong></p>
<ul>
<li><strong><code>0</code> (æ€§èƒ½æœ€é«˜):</strong> æ¯ç§’å†™å…¥å¹¶åˆ·æ–°ä¸€æ¬¡æ—¥å¿—ã€‚æœ‰ä¸¢å¤±ä¸€ç§’æ•°æ®çš„é£é™©ã€‚</li>
<li><strong><code>1</code> (é»˜è®¤ï¼Œæœ€å®‰å…¨):</strong> <strong>æ¯æ¬¡äº‹åŠ¡æäº¤</strong>éƒ½å†™å…¥å¹¶åˆ·æ–°æ—¥å¿—åˆ°ç£ç›˜ã€‚<strong>æœ€å®‰å…¨ï¼Œä½† I/O å¼€é”€æœ€å¤§</strong>ã€‚</li>
<li><strong><code>2</code> (æŠ˜ä¸­):</strong> æ¯æ¬¡æäº¤å†™å…¥æ—¥å¿—ï¼Œä½†åªæ¯ç§’åˆ·æ–°ä¸€æ¬¡åˆ°ç£ç›˜ã€‚æ¯” <code>1</code> å¿«ï¼Œæ¯” <code>0</code> å®‰å…¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>sort_buffer_size</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> ç”¨äºå¤„ç†éœ€è¦æ’åºçš„æŸ¥è¯¢ï¼ˆå¦‚ <code>ORDER BY</code> æˆ– <code>GROUP BY</code>ï¼‰ã€‚æ¯ä¸ªéœ€è¦æ’åºçš„è¿æ¥éƒ½ä¼šåˆ†é…è¿™ä¸ªå¤§å°çš„å†…å­˜ã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong></p>
<ul>
<li><strong>ä¸åº”è®¾ç½®å¾—å¤ªå¤§</strong>ï¼Œå› ä¸ºå®ƒåˆ†é…ç»™<strong>æ¯ä¸ªä¼šè¯</strong>ã€‚</li>
<li>é€šå¸¸è®¾ç½®ä¸º <strong>1MB åˆ° 2MB</strong>ã€‚å¦‚æœæŸ¥è¯¢æ¶‰åŠå¤§é‡æ’åºï¼Œå¯ä»¥é€‚å½“æé«˜ã€‚</li>
</ul>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>join_buffer_size</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> ç”¨äºè¿æ¥ï¼ˆJOINï¼‰æ“ä½œä¸­æ— æ³•ä½¿ç”¨ç´¢å¼•æ—¶çš„ç¼“å†²åŒºã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong></p>
<ul>
<li>å’Œ <code>sort_buffer_size</code> ç±»ä¼¼ï¼Œä¹Ÿæ˜¯æ¯ä¸ªè¿æ¥åˆ†é…ã€‚</li>
<li>é€šå¸¸è®¾ç½®ä¸º <strong>128KB åˆ° 1MB</strong>ã€‚</li>
<li><strong>ç¤ºä¾‹:</strong> <code>join_buffer_size = 512K</code></li>
</ul>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>table_open_cache</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> è®¾ç½®è¡¨æ‰“å¼€ç¼“å­˜çš„å¤§å°ï¼Œå‡å°‘æ‰“å¼€è¡¨æ—¶çš„ç£ç›˜I/O</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong>: è®¾ç½®ä¸º4096ä»¥æé«˜è¡¨æ‰“å¼€é€Ÿåº¦ã€‚</p>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong>  <code>open_files_limit</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> å†³å®šäº† MySQL çš„æ–‡ä»¶ I/O èƒ½åŠ›çš„è¾¹ç•Œ</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong> é€šå¸¸å»ºè®®å°† open_files_limit è®¾ç½®ä¸º table_open_cache å€¼çš„ ä¸¤å€æˆ–æ›´é«˜ï¼Œå¹¶é¢„ç•™ä¸€äº›ç©ºé—´ç»™å…¶ä»–æ—¥å¿—å’Œè¿æ¥ä½¿ç”¨ã€‚</p>
</li>
</ul>
<blockquote>
<ul>
<li>æ“ä½œç³»ç»Ÿé™åˆ¶ï¼šopen_files_limit çš„å€¼ä¸èƒ½è¶…è¿‡æ“ä½œç³»ç»Ÿä¸ºè¯¥ç”¨æˆ·æˆ–æ•´ä¸ªç³»ç»Ÿè®¾ç½®çš„ç¡¬æ€§æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼ˆé€šè¿‡ ulimit -Hn å‘½ä»¤æŸ¥çœ‹ï¼‰ã€‚å¦‚æœéœ€è¦è®¾ç½®æ›´å¤§çš„å€¼ï¼Œæ‚¨å¿…é¡»é¦–å…ˆåœ¨æ“ä½œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ /etc/security/limits.confï¼‰ä¸­è°ƒæ•´é™åˆ¶ã€‚</li>
</ul>
</blockquote>
<h2 data-id="heading-1">âœ… <strong>äºŒã€å…³é”®ä¼˜åŒ–å‚æ•°è¯¦ç»†è§£é‡Šï¼ˆå¿…é¡»ç†è§£ï¼‰</strong></h2>
<p>ä»¥ä¸‹æ˜¯æ€§èƒ½æå‡æœ€å¤§çš„ä¸€äº›é…ç½®ã€‚</p>
<hr/>
<h3 data-id="heading-2"><strong>1ï¼‰innodb_buffer_pool_sizeï¼ˆæœ€é‡è¦ï¼‰</strong></h3>
<blockquote>
<p>InnoDB çš„æ•°æ®ã€ç´¢å¼•éƒ½åœ¨è¿™é‡Œç¼“å­˜ã€‚<br/>
<strong>ä¸€èˆ¬è®¾ç½®ä¸ºæœºå™¨å†…å­˜ 50%ï½70%ã€‚</strong></p>
</blockquote>





















<table><thead><tr><th>æœåŠ¡å™¨å†…å­˜</th><th>å»ºè®®è®¾ç½®</th></tr></thead><tbody><tr><td>8GB</td><td>4Gâ€“5G</td></tr><tr><td>16GB</td><td>8Gâ€“12G</td></tr><tr><td>32GB</td><td>16Gâ€“26G</td></tr></tbody></table>
<h3 data-id="heading-3"><strong>2ï¼‰innodb_log_file_sizeï¼ˆäº‹åŠ¡å†™æ€§èƒ½å…³é”®ï¼‰</strong></h3>
<ul>
<li>é»˜è®¤åªæœ‰å‡ å MBï¼Œéå¸¸ä½ï¼</li>
<li>å»ºè®®æ”¹æˆï¼š</li>
</ul>
<pre><code class="hljs language-js" lang="js">1G ~ 4Gï¼ˆå–å†³äºä½ çš„å†™å…¥é‡ï¼‰
</code></pre>
<p>å¥½å¤„ï¼šå‡å°‘ checkpointï¼Œæå‡å†™æ€§èƒ½ï¼ˆç”µå•†é€€æ¬¾ / è®¢å•é«˜å¹¶å‘å¾ˆå…³é”®ï¼‰</p>
<h3 data-id="heading-4">3ï¼‰innodb_flush_log_at_trx_commitï¼ˆæœ€é‡è¦çš„æ€§èƒ½ä¸å®‰å…¨å¼€å…³ï¼‰</h3>





























<table><thead><tr><th>å€¼</th><th>è¯´æ˜</th><th>æ€§èƒ½</th><th>é£é™©</th></tr></thead><tbody><tr><td>1ï¼ˆé»˜è®¤ï¼‰</td><td>æ¯æ¬¡äº‹åŠ¡æäº¤éƒ½å†™ç£ç›˜</td><td>æœ€æ…¢</td><td>æœ€å®‰å…¨</td></tr><tr><td>2</td><td>å†™ OS bufferï¼Œ1 ç§’åˆ·ç›˜</td><td>â­ å¾ˆå¿«</td><td>å´©æºƒä¸¢å¤± 1 ç§’æ•°æ®</td></tr><tr><td>0</td><td>å»¶è¿Ÿå†™æ—¥å¿—</td><td>â­ è¶…å¿«</td><td>å¯èƒ½ä¸¢å¤§é‡äº‹åŠ¡</td></tr></tbody></table>
<p>ä½ çš„åœºæ™¯ï¼ˆå•†åŸï¼‰æ¨è 1 æˆ– 2ã€‚</p>
<h3 data-id="heading-5"><strong>4ï¼‰innodb_flush_method = O_DIRECT</strong></h3>
<p>é˜²æ­¢åŒç¼“å­˜ï¼ˆOS + MySQLï¼‰ï¼Œæå‡ IO æ€§èƒ½ã€‚</p>
<p>SSD åœºæ™¯å¼ºçƒˆæ¨èã€‚</p>
<h3 data-id="heading-6"><strong>5ï¼‰max_connections</strong></h3>
<p>å¾ˆå¤šé¡¹ç›®é»˜è®¤åªæœ‰ <em>151</em>ï¼Œå¹¶å‘ç¨é«˜ç«‹åˆ»â€œToo many connectionsâ€ã€‚</p>
<p>ä¸€èˆ¬ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-number">2000</span>ï¼ˆè¶³å¤Ÿå¤§éƒ¨åˆ†äº’è”ç½‘é¡¹ç›®ï¼‰
</code></pre>
<h3 data-id="heading-7"><strong>6ï¼‰tmp_table_size &amp; max_heap_table_size</strong></h3>
<p>é¿å…å¤æ‚ SQLï¼ˆgroup byã€order byï¼‰é¢‘ç¹å†™ç£ç›˜ï¼š</p>
<pre><code class="hljs language-js" lang="js">256M å¯¹å¤§éƒ¨åˆ†ä¸šåŠ¡å¤Ÿç”¨äº†
</code></pre>
<h3 data-id="heading-8"><strong>7ï¼‰sort_buffer_size / join_buffer_size</strong></h3>
<p>ä¸è¦è®¾ç½®å¤ªå¤§ï¼ï¼æ¯ä¸ªè¿æ¥éƒ½ä¼šåˆ†é…ï¼</p>
<p>4M æ˜¯ä¸€ä¸ªéå¸¸å®‰å…¨çš„å€¼ã€‚</p>
<h3 data-id="heading-9"><strong>8ï¼‰sync_binlogï¼ˆä¸»ä»å¤åˆ¶ / å®¹ç¾ï¼‰</strong></h3>
<ul>
<li>æœ€å®‰å…¨ï¼š1</li>
<li>é«˜ååï¼š100ï½1000</li>
</ul>
<p>ä½ åšç”µå•†é€€æ¬¾ã€æ”¯ä»˜ï¼Œå»ºè®®ï¼š</p>
<pre><code class="hljs language-js" lang="js">sync_binlog = <span class="hljs-number">1</span>
binlog_format = row
</code></pre>
<p>ä¿è¯ binlog ä¸€è‡´æ€§ï¼Œæ–¹ä¾¿æ¢å¤ã€‚</p>
<p>âœ… <strong>ä¸‰ã€å¸¸è§ä¼˜åŒ–åœºæ™¯å»ºè®®</strong></p>
<ol>
<li>é«˜è¯»å†™ç”µå•†ç³»ç»Ÿï¼ˆä½ çš„åœºæ™¯ï¼‰</li>
</ol>
<pre><code class="hljs language-js" lang="js">innodb_buffer_pool_size = <span class="hljs-number">50</span>%-<span class="hljs-number">70</span>% å†…å­˜
innodb_log_file_size = 1G
innodb_flush_log_at_trx_commit = <span class="hljs-number">1</span>
innodb_io_capacity = <span class="hljs-number">4000</span>
sync_binlog = <span class="hljs-number">1</span>
max_connections = <span class="hljs-number">2000</span>
</code></pre>
<ol start="2">
<li>é«˜å¹¶å‘æœåŠ¡æ¥å£ï¼ˆè®¢å•ã€æ”¯ä»˜ã€åº“å­˜ï¼‰</li>
</ol>
<pre><code class="hljs language-js" lang="js">join_buffer_size = 4M
sort_buffer_size = 4M
tmp_table_size = 256M
max_heap_table_size = 256M
</code></pre>
<h2 data-id="heading-10">âœ… <strong>å››ã€å®Œæ•´ä¼˜åŒ–ç­–ç•¥æ€»ç»“ï¼ˆä¸€å¥è¯ç†è§£ï¼‰</strong></h2>
<blockquote>
<p>MySQL æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒï¼š<br/>
<strong>è®©çƒ­æ•°æ®éƒ½æ”¾åœ¨å†…å­˜é‡Œï¼Œå‡å°‘ç£ç›˜ IOï¼Œå¹¶å‡å°‘æ¯æ¬¡äº‹åŠ¡åˆ·ç›˜æ¬¡æ•°</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Figma Vector Networks: å½¢çŠ¶ã€å¡«å……åŠæè¾¹]]></title>    <link>https://juejin.cn/post/7575655132755460115</link>    <guid>https://juejin.cn/post/7575655132755460115</guid>    <pubDate>2025-11-23T12:12:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575655132755460115" data-draft-id="7575655132755427347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Figma Vector Networks: å½¢çŠ¶ã€å¡«å……åŠæè¾¹"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-23T12:12:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¬é£è¯´å›¾"/> <meta itemprop="url" content="https://juejin.cn/user/198345371681864"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Figma Vector Networks: å½¢çŠ¶ã€å¡«å……åŠæè¾¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/198345371681864/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¬é£è¯´å›¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T12:12:25.000Z" title="Sun Nov 23 2025 12:12:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2F01joy.com%2Frww%2Ffigma-vector-networks.html" target="_blank" title="https://01joy.com/rww/figma-vector-networks.html" ref="nofollow noopener noreferrer">ã€ŠFigma Vector Networks: é‡æ–°å®šä¹‰çŸ¢é‡å›¾å½¢ç¼–è¾‘ã€‹</a>ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº†Vector Networks (çŸ¢é‡ç½‘æ ¼)ä¸SVG Pathçš„æ ¹æœ¬å·®å¼‚ã€‚Vector Networksä¹‹æ‰€ä»¥è¢«è§†ä¸ºâ€œæ›´é«˜ç»´åº¦â€çš„è¡¨è¿°ï¼Œåœ¨äºå…¶ç‹¬ç‰¹çš„æ‹“æ‰‘ç»“æ„ï¼Œè¿™ä¸ºçŸ¢é‡å›¾å½¢çš„ç¼–è¾‘å¸¦æ¥äº†å‰æ‰€æœªæœ‰çš„çµæ´»æ€§ä¸æ•ˆç‡ã€‚</p>
<p>æœ¬æ–‡å°†ä¸¾ä¾‹è¯´æ˜ç”¨Vector Networksè¡¨ç¤ºä¸‹é¢å›¾å½¢çš„å½¢çŠ¶ã€å¡«å……åŠæè¾¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47e9cc15c0d74f7d805b38f01f1ef7ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCs6aOO6K-05Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764504745&amp;x-signature=JA8jY0g25QH9lgCNcqct19mtpj0%3D" alt="" loading="lazy"/></p>
<p>ä»¥ä¸Šå›¾å½¢åˆ†ä¸ºä¸¤ç±»ï¼šå·¦è¾¹æ˜¯ç”±ç›´çº¿ç»„æˆçš„ï¼Œå³è¾¹æ˜¯ç”±æ›²çº¿ç»„æˆçš„ï¼Œå½“ç„¶æ— è®ºçŸ¢é‡å›¾å½¢æœ‰å¤šå¤æ‚ï¼Œéƒ½å¯ä»¥ç”¨Vector Networksè¡¨ç¤ºã€‚</p>
<h2 data-id="heading-1">æ¦‚è¿°</h2>
<p>æ–‡ç« ä»¥å…·ä½“å›¾å½¢ä¸ºä¾‹ï¼Œè¯¦ç»†è§£æäº† Vector Networks çš„ç»„æˆç»“æ„â€”â€”åŒ…æ‹¬<strong>èŠ‚ç‚¹ï¼ˆverticesï¼‰</strong> ã€<strong>çº¿æ¡ï¼ˆsegmentsï¼‰</strong> å’Œ<strong>åŒºåŸŸï¼ˆregionsï¼‰</strong> ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ JSON ç»“æ„æè¿°ç›´çº¿ã€çŸ©å½¢ã€ä¸‰è§’å½¢ã€äº”è§’æ˜Ÿã€æ›²çº¿å’Œæ¤­åœ†ç­‰å¸¸è§å›¾å½¢ã€‚</p>
<p>åŒæ—¶ï¼Œæ–‡ç« è¿˜åŒºåˆ†äº†åº•å±‚çŸ¢é‡å¼•æ“ä¸ä¸Šå±‚å·¥å…·å¼€å‘è€…çš„èŒè´£ï¼Œå¼ºè°ƒäº† Vector Networks åœ¨ç®€åŒ–çŸ¢é‡å›¾å½¢ç¼–è¾‘å¤æ‚åº¦æ–¹é¢çš„é‡è¦ä½œç”¨ã€‚</p>
<h2 data-id="heading-2">åŒ–ç¹ä¸ºç®€</h2>
<p>Vector Networksä¸»è¦ç”±ç‚¹ã€çº¿ã€å’ŒåŒºåŸŸç»„æˆã€‚</p>
<p>å¯¹åº•å±‚çŸ¢é‡å¼•æ“å¼€å‘è€…æ¥è¯´ï¼Œéœ€è¦å°†Vector Networksè¿™ç§æè¿°åè®®è½¬æ¢æˆGPUå¯è¯†åˆ«çš„æ¸²æŸ“å‘½ä»¤ï¼Œè€Œè§£æçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯æ ¹æ®èŠ‚ç‚¹å’Œçº¿æ¡è‡ªåŠ¨è¯†åˆ«åŒºåŸŸã€‚</p>
<p>å¯¹ä¸Šå±‚çŸ¢é‡å·¥å…·å¼€å‘è€…æ¥è¯´ï¼Œä¸éœ€è¦å…³å¿ƒå¦‚ä½•è§£æVector Networksï¼Œåªè¦å…³æ³¨çŸ¢é‡å›¾å½¢çš„ç¼–è¾‘äº¤äº’åŠŸèƒ½ã€‚</p>
<p>è¿™æ ·åˆ’åˆ†çš„å¥½å¤„æ˜¯ï¼šåº•å±‚çŸ¢é‡å¼•æ“å°†ä»»æ„çŸ¢é‡å›¾å½¢æŠ½è±¡æˆVector Networksï¼Œå¹¶è‡ªåŠ¨è¯†åˆ«å‡ºäº†çŸ¢é‡ç½‘æ ¼ä¸­çš„åŒºåŸŸï¼Œæš´éœ²å‡ºçŸ¢é‡ç½‘æ ¼çš„ç‚¹çº¿ç¼–è¾‘ï¼Œå¤§å¤§ç®€åŒ–äº†çŸ¢é‡å›¾å½¢ç¼–è¾‘çš„å¤æ‚åº¦ã€‚</p>
<h2 data-id="heading-3">å…¬å…±éƒ¨åˆ†</h2>
<ul>
<li>type æ˜¯å›¾å½¢ç±»å‹</li>
<li>strokeWeight æè¾¹çº¿å®½</li>
<li>strokeAlign æè¾¹å¯¹é½æ–¹å¼ï¼Œåˆ†ä¸ºï¼šCenterã€Insideã€Outside</li>
<li>strokePaints ä¸»è¦æ˜¯æè¾¹é¢œè‰²æ•°ç»„</li>
<li>fillPaints ä¸»è¦æ˜¯å¡«å……é¢œè‰²æ•°ç»„</li>
<li>vectorNetworkå­˜å‚¨çš„æ˜¯çŸ¢é‡ç½‘æ ¼æ•°æ®ï¼ŒåŒ…å«èŠ‚ç‚¹æ•°ç»„ã€çº¿æ¡æ•°ç»„ã€åŒºåŸŸæ•°ç»„</li>
</ul>

<ul>
<li>
<ul>
<li>verticesæ˜¯èŠ‚ç‚¹æ•°ç»„ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰è‡ªå·±çš„åæ ‡å’Œæ ·å¼ç´¢å¼•styleID (é»˜è®¤å¯¹åº”åˆ°strokePaintsæ•°ç»„ä¸‹æ ‡)</li>
<li>segmentsæ˜¯çº¿æ¡æ•°ç»„ï¼Œæ¯ä¸ªçº¿æ¡æœ‰èµ·å§‹èŠ‚ç‚¹çš„ç´¢å¼•vertexï¼Œå’Œå¯¹åº”çš„æ§åˆ¶ç‚¹dx/dyï¼ˆæ›²çº¿ä¼šç”¨åˆ°ï¼‰ï¼Œç»“æŸç‚¹çš„ç´¢å¼•vertexï¼Œå’Œå¯¹åº”çš„æ§åˆ¶ç‚¹dx/dyï¼Œä»¥åŠæ ·å¼ç´¢å¼•styleID</li>
<li>regionsæ˜¯åŒºåŸŸæ•°ç»„ï¼ŒåŒ…å«å¤šä¸ªåŒºåŸŸã€‚</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>
<ul>
<li>æ¯ä¸ªåŒºåŸŸçš„styleID (å¡«å……æ ·å¼ç´¢å¼•) å®šä¹‰äº†å½“å‰åŒºåŸŸçš„å¡«å……ï¼Œé»˜è®¤å¯¹åº”åˆ°fillPaintsæ•°ç»„ä¸‹æ ‡ï¼Œä¹Ÿå¯ä»¥å¯¹åº”åˆ°styleOverrideTableæ ·å¼è¦†ç›–è¡¨é‡Œ</li>
<li>æ¯ä¸ªåŒºåŸŸçš„loops (åŒºåŸŸ) å®šä¹‰äº†å½“å‰åŒºåŸŸçš„æ‹“æ‰‘ç»“æ„ï¼Œç”±å¤šä¸ªsegments (ç¯) ç»„æˆï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªsegmentsåˆ™ä»£è¡¨å½“å‰åŒºåŸŸç”±ä¸€ä¸ªç¯å›´åŸï¼Œå¤šä¸ªsegmentsä¸€èˆ¬ä»£è¡¨ç”±å†…ç¯å’Œå¤–ç¯å…±åŒå›´åŸçš„åŒºåŸŸ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-4">ç›´çº¿</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> line = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"VECTOR"</span>, <span class="hljs-comment">// å›¾å½¢ç±»å‹æ˜¯çŸ¢é‡ç½‘æ ¼</span>
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// æè¾¹å®½åº¦ä¸º1ä¸ªå•ä½</span>
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"CENTER"</span>, <span class="hljs-comment">// æè¾¹å¯¹é½æ–¹å¼ä¸ºå±…ä¸­</span>
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>, <span class="hljs-comment">// æè¾¹è¿æ¥æ–¹å¼ä¸ºå°–è§’è¿æ¥</span>
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: { <span class="hljs-comment">// æè¾¹é¢œè‰²</span>
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: { <span class="hljs-comment">// çŸ¢é‡ç½‘ç»œæ•°æ®</span>
        <span class="hljs-string">"vertices"</span>: [ <span class="hljs-comment">// é¡¶ç‚¹æ•°ç»„</span>
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// é¡¶ç‚¹æ ·å¼IDï¼Œå¯¹åº”æè¾¹æ ·å¼æ•°ç»„çš„ç¬¬ä¸€ä¸ªæ ·å¼</span>
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">1</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [ <span class="hljs-comment">// çº¿æ¡æ•°ç»„</span>
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// çº¿æ¡æ ·å¼IDï¼Œå¯¹åº”æè¾¹æ ·å¼æ•°ç»„çš„ç¬¬ä¸€ä¸ªæ ·å¼</span>
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [] <span class="hljs-comment">// åŒºåŸŸæ•°ç»„ä¸ºç©ºï¼Œè¡¨ç¤ºæ²¡æœ‰å¯å¡«å……åŒºåŸŸ</span>
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> line;
</code></pre>
<h2 data-id="heading-5">çŸ©å½¢</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> rectangle = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"ROUNDED_RECTANGLE"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"INSIDE"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"fillPaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: { <span class="hljs-comment">// å¡«å……é¢œè‰²</span>
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: { <span class="hljs-comment">// æè¾¹é¢œè‰²</span>
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">50</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">50</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [ <span class="hljs-comment">// åŒºåŸŸæ•°ç»„é‡Œæœ‰ä¸€ä¸ªåŒºåŸŸ</span>
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"windingRule"</span>: <span class="hljs-string">"NONZERO"</span>,
                <span class="hljs-string">"loops"</span>: [ <span class="hljs-comment">// å½“å‰åŒºåŸŸç”±ä¸€ä¸ªç¯å›´åŸ</span>
                    {
                        <span class="hljs-string">"segments"</span>: [ <span class="hljs-comment">// å½“å‰ç¯ç”±è¾¹ 0/1/2/3 å››æ¡è¾¹å›´åŸ</span>
                            <span class="hljs-number">0</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">2</span>,
                            <span class="hljs-number">3</span>
                        ]
                    }
                ]
            }
        ]
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> rectangle;
</code></pre>
<h2 data-id="heading-6">ä¸‰è§’å½¢</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> polygon = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"REGULAR_POLYGON"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"INSIDE"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"fillPaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">93.30126953125</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">75</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">6.69873046875</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">75</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"windingRule"</span>: <span class="hljs-string">"NONZERO"</span>,
                <span class="hljs-string">"loops"</span>: [
                    {
                        <span class="hljs-string">"segments"</span>: [ <span class="hljs-comment">// å½“å‰ç¯ç”±ä¸‰ä¸ªè¾¹å›´æˆ</span>
                            <span class="hljs-number">0</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">2</span>
                        ]
                    }
                ]
            }
        ]
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> polygon;
</code></pre>
<h2 data-id="heading-7">äº”è§’æ˜Ÿ</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> star = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"STAR"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"INSIDE"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"fillPaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">61.22570037841797</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">34.54914855957031</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">97.55282592773438</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">34.54914855957031</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">68.16356658935547</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">55.90169906616211</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">79.38926696777344</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">90.45085144042969</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">69.09829711914062</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">20.610736846923828</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">90.45085144042969</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">31.836435317993164</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">55.90169906616211</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">2.447174072265625</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">34.54914855957031</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">38.77429962158203</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">34.54914855957031</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">4</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">4</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">5</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">5</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">6</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">6</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">7</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">7</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">8</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">8</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">9</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">9</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"windingRule"</span>: <span class="hljs-string">"NONZERO"</span>,
                <span class="hljs-string">"loops"</span>: [
                    {
                        <span class="hljs-string">"segments"</span>: [ å½“å‰ç¯ç”±åæ¡è¾¹å›´åŸ
                            <span class="hljs-number">0</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">2</span>,
                            <span class="hljs-number">3</span>,
                            <span class="hljs-number">4</span>,
                            <span class="hljs-number">5</span>,
                            <span class="hljs-number">6</span>,
                            <span class="hljs-number">7</span>,
                            <span class="hljs-number">8</span>,
                            <span class="hljs-number">9</span>
                        ]
                    }
                ]
            }
        ]
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> star;
</code></pre>
<h2 data-id="heading-8">æ›²çº¿</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> line2 = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"VECTOR"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"CENTER"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">23.836986541748047</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">22.8122615814209</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">1</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">23.324623107910156</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">19.28675651550293</span>, <span class="hljs-comment">// èµ·å§‹ç‚¹çš„æ§åˆ¶ç‚¹xåæ ‡(ç›¸å¯¹äºå½“å‰ç‚¹åç§»é‡)</span>
                    <span class="hljs-string">"dy"</span>: -<span class="hljs-number">29.784029006958008</span> <span class="hljs-comment">// èµ·å§‹ç‚¹çš„æ§åˆ¶ç‚¹yåæ ‡(ç›¸å¯¹äºå½“å‰ç‚¹åç§»é‡)</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: -<span class="hljs-number">22.682817459106445</span>, <span class="hljs-comment">// ç»“æŸç‚¹çš„æ§åˆ¶ç‚¹xåæ ‡(ç›¸å¯¹äºå½“å‰ç‚¹åç§»é‡)</span>
                    <span class="hljs-string">"dy"</span>: -<span class="hljs-number">33.02580642700195</span> <span class="hljs-comment">// ç»“æŸç‚¹çš„æ§åˆ¶ç‚¹yåæ ‡(ç›¸å¯¹äºå½“å‰ç‚¹åç§»é‡)</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">22.682817459106445</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">33.02580642700195</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: -<span class="hljs-number">14.171252250671387</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">28.461177825927734</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: []
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> line2;
</code></pre>
<h2 data-id="heading-9">æ¤­åœ†</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ellipse = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"ELLIPSE"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"INSIDE"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"fillPaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">25</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">50</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">25</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">13.80711841583252</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">27.61423683166504</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: -<span class="hljs-number">27.61423683166504</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">13.80711841583252</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: -<span class="hljs-number">13.80711841583252</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: -<span class="hljs-number">27.61423683166504</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">27.61423683166504</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: -<span class="hljs-number">13.80711841583252</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"windingRule"</span>: <span class="hljs-string">"NONZERO"</span>,
                <span class="hljs-string">"loops"</span>: [
                    {
                        <span class="hljs-string">"segments"</span>: [ <span class="hljs-comment">// å½“å‰ç¯ç”±å››æ¡æ›²çº¿ç»„æˆ</span>
                            <span class="hljs-number">0</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">2</span>,
                            <span class="hljs-number">3</span>
                        ]
                    }
                ]
            }
        ]
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ellipse;
</code></pre>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>Figma Vector Networks æä¾›äº†ä¸€ç§<strong>æ›´é«˜ç»´åº¦çš„çŸ¢é‡å›¾å½¢æè¿°æ–¹å¼</strong>ï¼Œå®ƒä¸ä»…çªç ´äº†ä¼ ç»Ÿ SVG Path çš„ç¼–è¾‘é™åˆ¶ï¼Œè¿˜é€šè¿‡å…¶ç‹¬ç‰¹çš„<strong>æ‹“æ‰‘ç»“æ„</strong>å®ç°äº†æ›´çµæ´»ã€é«˜æ•ˆçš„å›¾å½¢æ„å»ºä¸æ¸²æŸ“ã€‚æœ¬æ–‡é€šè¿‡å¤šä¸ªå®é™…å›¾å½¢ç¤ºä¾‹ï¼Œç³»ç»Ÿæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Vector Networks çš„ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ <code>vertices</code>ã€<code>segments</code>ã€<code>regions</code>ï¼‰æ¥å®šä¹‰å›¾å½¢çš„å‡ ä½•å½¢çŠ¶ã€æè¾¹æ ·å¼ä¸å¡«å……åŒºåŸŸã€‚æ— è®ºæ˜¯ç›´çº¿ã€å¤šè¾¹å½¢è¿˜æ˜¯æ›²çº¿å›¾å½¢ï¼ŒVector Networks éƒ½èƒ½ä»¥ç»Ÿä¸€è€Œå¼ºå¤§çš„æ–¹å¼äºˆä»¥æ”¯æŒï¼Œæå¤§åœ°é™ä½äº†çŸ¢é‡å›¾å½¢ç¼–è¾‘çš„å¤æ‚åº¦ï¼Œä¸ºå›¾å½¢å·¥å…·çš„å¼€å‘ä¸ä½¿ç”¨æä¾›äº†æ–°çš„å¯èƒ½æ€§ã€‚</p>
<p><em>æ›´å¤šç²¾å½©å†…å®¹å¯å…³æ³¨</em><a href="https://link.juejin.cn?target=https%3A%2F%2F01joy.com" target="_blank" title="https://01joy.com" ref="nofollow noopener noreferrer"><em>é£èµ·çš„åšå®¢</em></a> <em>ï¼Œå¾®ä¿¡å…¬ä¼—å·ï¼šå¬é£è¯´å›¾</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSSå®šä½å…¨è§£æï¼šä»staticåˆ°stickyï¼Œå½»åº•ææ‡‚å¸ƒå±€æ ¸å¿ƒ]]></title>    <link>https://juejin.cn/post/7572126996177141795</link>    <guid>https://juejin.cn/post/7572126996177141795</guid>    <pubDate>2025-11-14T05:09:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572126996177141795" data-draft-id="7572141390857093120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSSå®šä½å…¨è§£æï¼šä»staticåˆ°stickyï¼Œå½»åº•ææ‡‚å¸ƒå±€æ ¸å¿ƒ"/> <meta itemprop="keywords" content="å‰ç«¯,CSS"/> <meta itemprop="datePublished" content="2025-11-14T05:09:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é—²äº‘ing"/> <meta itemprop="url" content="https://juejin.cn/user/2974655942502250"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSSå®šä½å…¨è§£æï¼šä»staticåˆ°stickyï¼Œå½»åº•ææ‡‚å¸ƒå±€æ ¸å¿ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2974655942502250/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é—²äº‘ing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:09:35.000Z" title="Fri Nov 14 2025 05:09:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSSå®šä½å…¨è§£æï¼šä»staticåˆ°stickyï¼Œå½»åº•ææ‡‚å¸ƒå±€æ ¸å¿ƒ</h2>
<p><strong>å‰ç«¯å¼€å‘ç»•ä¸å¼€çš„å</strong>ï¼šCSSå®šä½æ˜¯å¸ƒå±€çš„çµé­‚ï¼Œä¹Ÿæ˜¯æ–°æ‰‹æœ€å®¹æ˜“æ··æ·†çš„çŸ¥è¯†ç‚¹ã€‚æœ¬æ–‡ç”¨æ¦‚å¿µ+æ¡ˆä¾‹+å¯¹æ¯”çš„å½¢å¼ï¼ŒæŠŠstaticã€relativeã€absoluteã€fixedã€stickyè®²é€ï¼Œæ¯ä¸ªç‰¹æ€§éƒ½é…å¯ç›´æ¥è¿è¡Œçš„ä»£ç ï¼Œçœ‹å®Œå°±èƒ½ä¸Šæ‰‹å®æˆ˜ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€å…ˆææ‡‚åŸºç¡€ï¼šä»€ä¹ˆæ˜¯æ–‡æ¡£æµï¼Ÿ</h2>
<p>åœ¨èŠå®šä½ä¹‹å‰ï¼Œå¿…é¡»å…ˆæ˜ç¡®ã€Œæ–‡æ¡£æµã€è¿™ä¸ªæ ¸å¿ƒæ¦‚å¿µâ€”â€”å®ƒæ˜¯HTMLå…ƒç´ é»˜è®¤çš„æ’åˆ—è§„åˆ™ï¼Œå°±åƒäººæ’é˜Ÿä¸€æ ·æœ‰ç« å¯å¾ªï¼š</p>
<ul>
<li><strong>å—çº§å…ƒç´ </strong>ï¼ˆdivã€pã€h1ç­‰ï¼‰ï¼šç‹¬å ä¸€è¡Œï¼Œå‚ç›´å‘ä¸‹æ’åˆ—ï¼Œé»˜è®¤å®½åº¦å æ»¡çˆ¶å®¹å™¨</li>
<li><strong>è¡Œå†…å…ƒç´ </strong>ï¼ˆspanã€aã€imgç­‰ï¼‰ï¼šä¸ç‹¬å ä¸€è¡Œï¼Œæ°´å¹³ä»å·¦åˆ°å³æ’åˆ—ï¼Œå®½åº¦ç”±å†…å®¹å†³å®š</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šå…ƒç´ åƒæµæ°´ä¸€æ ·ä¾æ¬¡æ’åˆ—ï¼Œæ¯ä¸ªå…ƒç´ éƒ½å æ®è‡ªå·±çš„ã€Œä½ç½®ã€ï¼Œä¸ä¼šé‡å </li>
</ul>
<p>è€ŒCSSå®šä½çš„æ ¸å¿ƒä½œç”¨ï¼Œå°±æ˜¯<strong>æ‰“ç ´æˆ–æ”¹å˜è¿™ç§é»˜è®¤çš„æ–‡æ¡£æµè§„åˆ™</strong>ã€‚å½“å…ƒç´ ã€Œè„±ç¦»æ–‡æ¡£æµã€æ—¶ï¼Œå®ƒä¼šåƒå¹½çµä¸€æ ·"é£˜èµ·æ¥"ï¼Œä¸å†å æ®åŸæ¥çš„ç©ºé—´ï¼Œç”šè‡³ä¼šè¦†ç›–å…¶ä»–å…ƒç´ â€”â€”è¿™ä¹Ÿæ˜¯å®šä½å¸ƒå±€çš„å…³é”®ç‰¹æ€§ã€‚</p>
<h2 data-id="heading-2">äºŒã€é€ä¸ªå‡»ç ´ï¼š5ç§å®šä½æ–¹å¼çš„æ ¸å¿ƒç”¨æ³•</h2>
<p>CSSçš„<code>position</code>å±æ€§å…±æœ‰5ä¸ªå–å€¼ï¼Œæ¯ç§å–å€¼å¯¹åº”å®Œå…¨ä¸åŒçš„å¸ƒå±€è¡Œä¸ºã€‚æˆ‘ä»¬ä»æœ€åŸºç¡€çš„staticå¼€å§‹ï¼Œé€ä¸ªæ‹†è§£ã€‚</p>
<h3 data-id="heading-3">1. position: static é™æ€å®šä½ï¼ˆé»˜è®¤å€¼ï¼‰</h3>
<p>staticæ˜¯æ‰€æœ‰å…ƒç´ çš„é»˜è®¤å®šä½æ–¹å¼ï¼Œæ„æ€æ˜¯ã€Œéµå¾ªæ­£å¸¸æ–‡æ¡£æµã€ï¼Œå°±åƒæ’é˜Ÿæ—¶æŒ‰é¡ºåºç«™å¥½ï¼Œä¸æç‰¹æ®ŠåŒ–ã€‚</p>
<h4 data-id="heading-4">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li>å®Œå…¨éµå¾ªæ–‡æ¡£æµï¼Œå…ƒç´ å æ®æ­£å¸¸ç©ºé—´</li>
<li><code>topã€bottomã€leftã€right</code>å’Œ<code>z-index</code>å±æ€§å®Œå…¨æ— æ•ˆï¼ˆè®¾ç½®äº†ä¹Ÿæ²¡ç”¨ï¼‰</li>
<li>ä½œç”¨åœºæ™¯ï¼šé€šå¸¸ç”¨äºã€Œå–æ¶ˆå®šä½ã€ï¼Œæ¯”å¦‚æŠŠä¹‹å‰è®¾ä¸ºabsoluteçš„å…ƒç´ æ”¹å›static</li>
</ul>
<h4 data-id="heading-5">å®æˆ˜æ¡ˆä¾‹ï¼šå…ƒç´ å›å½’æ–‡æ¡£æµ</h4>
<p>è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œçˆ¶å…ƒç´ åˆå§‹æ˜¯ç»å¯¹å®šä½ï¼Œ5ç§’åé€šè¿‡JSæ”¹ä¸ºstaticï¼Œä¼šè‡ªåŠ¨å›å½’æ–‡æ¡£æµï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Static é™æ€å®šä½<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; } <span class="hljs-comment">/* æ¸…é™¤é»˜è®¤è¾¹è· */</span>
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>; } <span class="hljs-comment">/* è®©é¡µé¢å¯æ»šåŠ¨ï¼Œæ–¹ä¾¿è§‚å¯Ÿ */</span>
    
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>; <span class="hljs-comment">/* æµ…ç²‰è‰²ï¼Œæ›´æŸ”å’Œ */</span>
      <span class="hljs-attribute">position</span>: absolute; <span class="hljs-comment">/* åˆå§‹ä¸ºç»å¯¹å®šä½ï¼Œä¼šè„±ç¦»æ–‡æ¡£æµ */</span>
      <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">100px</span>;
    }
    
    <span class="hljs-selector-class">.child</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#91c8e4</span>; <span class="hljs-comment">/* æµ…è“è‰² */</span>
    }
    
    <span class="hljs-selector-class">.box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#74c69d</span>; <span class="hljs-comment">/* æµ…ç»¿è‰² */</span>
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>Hello CSS<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> oParent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.parent'</span>);
    <span class="hljs-comment">// 5ç§’åå°†çˆ¶å…ƒç´ æ”¹ä¸ºé™æ€å®šä½ï¼Œå›å½’æ–‡æ¡£æµ</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      oParent.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'static'</span>;
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">'çˆ¶å…ƒç´ å·²æ”¹ä¸ºstaticå®šä½ï¼Œå›å½’æ–‡æ¡£æµ'</span>);
    }, <span class="hljs-number">5000</span>);
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">2. position: relative ç›¸å¯¹å®šä½ï¼ˆå¾®è°ƒç¥å™¨ï¼‰</h3>
<p>relativeçš„æ ¸å¿ƒæ˜¯ã€Œç›¸å¯¹è‡ªèº«ã€â€”â€”å…ƒç´ å…ˆåœ¨æ–‡æ¡£æµä¸­å æ®æ­£å¸¸ä½ç½®ï¼Œç„¶åç›¸å¯¹äºè¿™ä¸ªåŸå§‹ä½ç½®è¿›è¡Œåç§»ï¼Œå°±åƒæ’é˜Ÿæ—¶ç¨å¾®æŒªä¸€ä¸‹è„šæ­¥ï¼Œä½†ä¸ç¦»å¼€è‡ªå·±çš„ä½ç½®ã€‚</p>
<h4 data-id="heading-7">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li><strong>ä¸è„±ç¦»æ–‡æ¡£æµ</strong>ï¼šåŸå§‹ä½ç½®ä¼šè¢«ä¿ç•™ï¼Œå…¶ä»–å…ƒç´ ä¸ä¼š"æŒ¤è¿‡æ¥"</li>
<li><strong>å®šä½åŸºå‡†</strong>ï¼šå…ƒç´ è‡ªèº«åœ¨æ–‡æ¡£æµä¸­çš„åŸå§‹ä½ç½®</li>
<li><strong>åç§»æ§åˆ¶</strong>ï¼šé€šè¿‡<code>top/bottom/left/right</code>è®¾ç½®åç§»é‡ï¼ˆæ­£å€¼è¡¨ç¤ºè¿œç¦»è¯¥æ–¹å‘ï¼Œè´Ÿå€¼è¡¨ç¤ºé è¿‘ï¼‰</li>
<li><strong>é‡è¦ä½œç”¨</strong>ï¼šç»™ç»å¯¹å®šä½çš„å­å…ƒç´ å……å½“ã€Œå®šä½å‚è€ƒç‚¹ã€ï¼ˆè¿™æ˜¯å®ƒæœ€å¸¸ç”¨çš„åœºæ™¯ï¼‰</li>
</ul>
<h4 data-id="heading-8">å®æˆ˜æ¡ˆä¾‹ï¼šå…ƒç´ åç§»ä¸å®šä½å‚è€ƒ</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Relative ç›¸å¯¹å®šä½<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; }
    
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>;
      <span class="hljs-attribute">position</span>: relative; <span class="hljs-comment">/* ç›¸å¯¹å®šä½ï¼Œä½œä¸ºå­å…ƒç´ çš„å‚è€ƒ */</span>
      <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>; <span class="hljs-comment">/* ç›¸å¯¹äºè‡ªèº«åŸå§‹ä½ç½®ï¼Œå‘å³åç§»100px */</span>
      <span class="hljs-attribute">top</span>: <span class="hljs-number">100px</span>;  <span class="hljs-comment">/* ç›¸å¯¹äºè‡ªèº«åŸå§‹ä½ç½®ï¼Œå‘ä¸‹åç§»100px */</span>
    }
    
    <span class="hljs-selector-class">.child</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#91c8e4</span>;
      <span class="hljs-attribute">position</span>: absolute; <span class="hljs-comment">/* å­å…ƒç´ ç»å¯¹å®šä½ï¼Œå‚è€ƒçˆ¶å…ƒç´  */</span>
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">50px</span>; <span class="hljs-comment">/* è·ç¦»çˆ¶å…ƒç´ åº•éƒ¨50px */</span>
      <span class="hljs-attribute">right</span>: <span class="hljs-number">50px</span>; <span class="hljs-comment">/* è·ç¦»çˆ¶å…ƒç´ å³ä¾§50px */</span>
    }
    
    <span class="hljs-selector-class">.box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#74c69d</span>;
      <span class="hljs-comment">/* æœªè®¾ç½®å®šä½ï¼Œéµå¾ªæ–‡æ¡£æµï¼Œçˆ¶å…ƒç´ çš„åç§»ä¸å½±å“å®ƒ */</span>
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>æˆ‘åœ¨æ–‡æ¡£æµä¸­<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>æ–°æ‰‹é¿å‘</strong>ï¼šrelativeçš„åç§»ä¸ä¼šå½±å“å…¶ä»–å…ƒç´ çš„å¸ƒå±€ï¼Œå› ä¸ºå®ƒè¿˜åœ¨æ–‡æ¡£æµä¸­ã€‚å¦‚æœå‘ç°å…ƒç´ åç§»å"å‹"ä½äº†å…¶ä»–å…ƒç´ ï¼Œé‚£å¤§æ¦‚ç‡æ˜¯ç”¨äº†absolute/fixedï¼Œè€Œä¸æ˜¯relativeã€‚</p>
<h3 data-id="heading-9">3. position: absolute ç»å¯¹å®šä½ï¼ˆç‹¬ç«‹å¸ƒå±€ä¹‹ç‹ï¼‰</h3>
<p>absoluteæ˜¯å‰ç«¯å¸ƒå±€çš„æ˜æ˜Ÿå±æ€§ï¼Œå®ƒèƒ½è®©å…ƒç´ å®Œå…¨è„±ç¦»æ–‡æ¡£æµï¼Œå°±åƒä»æ’é˜Ÿé˜Ÿä¼ä¸­èµ°å‡ºæ¥ï¼Œè‡ªç”±ç§»åŠ¨ï¼Œè€Œä¸”ä¸ä¼šç•™ä¸‹è‡ªå·±çš„ä½ç½®ï¼ˆå…¶ä»–å…ƒç´ ä¼šè¡¥ä¸Šæ¥ï¼‰ã€‚</p>
<h4 data-id="heading-10">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li><strong>å®Œå…¨è„±ç¦»æ–‡æ¡£æµ</strong>ï¼šä¸å æ®ä»»ä½•ç©ºé—´ï¼Œç›¸å½“äºé¡µé¢ä¸­"ä¸å­˜åœ¨"è¿™ä¸ªå…ƒç´ ï¼ˆå¯¹å…¶ä»–å…ƒç´ è€Œè¨€ï¼‰</li>
<li><strong>å®šä½åŸºå‡†</strong>ï¼š<strong>æœ€è¿‘çš„å·²å®šä½ç¥–å…ˆå…ƒç´ </strong>ï¼ˆå³ç¥–å…ˆå…ƒç´ çš„positionä¸æ˜¯staticï¼‰ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±ç›¸å¯¹äºæµè§ˆå™¨çª—å£ï¼ˆåˆå§‹åŒ…å«å—ï¼‰</li>
<li><strong>åç§»æ§åˆ¶</strong>ï¼šé€šè¿‡<code>top/bottom/left/right</code>æ§åˆ¶ä½ç½®ï¼Œç›¸å¯¹äºå®šä½åŸºå‡†è¿›è¡Œåç§»</li>
<li><strong>å±‚çº§é—®é¢˜</strong>ï¼šè„±ç¦»æ–‡æ¡£æµåä¼šè¦†ç›–å…¶ä»–å…ƒç´ ï¼Œå¯é€šè¿‡<code>z-index</code>è°ƒæ•´å±‚çº§ï¼ˆæ•°å€¼è¶Šå¤§è¶Šé ä¸Šï¼‰</li>
</ul>
<h4 data-id="heading-11">å®æˆ˜æ¡ˆä¾‹1ï¼šå­å…ƒç´ ç›¸å¯¹äºçˆ¶å…ƒç´ å®šä½</h4>
<p>è¿™æ˜¯absoluteæœ€ç»å…¸çš„ç”¨æ³•â€”â€”çˆ¶å…ƒç´ è®¾ä¸ºrelativeï¼Œå­å…ƒç´ è®¾ä¸ºabsoluteï¼Œå®ç°å­å…ƒç´ åœ¨çˆ¶å…ƒç´ å†…çš„ç²¾å‡†å®šä½ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Absolute ç»å¯¹å®šä½ï¼ˆçˆ¶å…ƒç´ å‚è€ƒï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; }
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e0f7fa</span>; }
    
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">550px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto; <span class="hljs-comment">/* æ°´å¹³å±…ä¸­ï¼Œæ–¹ä¾¿è§‚å¯Ÿ */</span>
      <span class="hljs-attribute">position</span>: relative; <span class="hljs-comment">/* å…³é”®ï¼šç»™å­å…ƒç´ å½“å‚è€ƒ */</span>
      <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.9</span>; <span class="hljs-comment">/* åŠé€æ˜ï¼Œæ–¹ä¾¿çœ‹åˆ°å±‚çº§ */</span>
    }
    
    <span class="hljs-selector-class">.child</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#91c8e4</span>;
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">100px</span>; <span class="hljs-comment">/* è·ç¦»çˆ¶å…ƒç´ å³è¾¹ç¼˜100px */</span>
      <span class="hljs-attribute">top</span>: <span class="hljs-number">150px</span>; <span class="hljs-comment">/* è·ç¦»çˆ¶å…ƒç´ ä¸Šè¾¹ç¼˜150px */</span>
    }
    
    <span class="hljs-comment">/* ç»å¯¹å®šä½å±…ä¸­æŠ€å·§ï¼šleft50% + transform(-50%) */</span>
    <span class="hljs-selector-class">.center-box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#74c69d</span>;
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* ç›¸å¯¹äºçˆ¶å…ƒç´ å·¦ç§»50% */</span>
      <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* ç›¸å¯¹äºçˆ¶å…ƒç´ ä¸Šç§»50% */</span>
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>); <span class="hljs-comment">/* è‡ªèº«å›ç§»50%ï¼Œå®ç°å®Œç¾å±…ä¸­ */</span>
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center-box"</span>&gt;</span>å±…ä¸­å•¦<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æˆ‘æ˜¯çˆ¶å…ƒç´ çš„æ–‡æœ¬ï¼Œä¸ä¼šè¢«ç»å¯¹å®šä½å…ƒç´ å½±å“<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æˆ‘åœ¨æ–‡æ¡£æµä¸­ï¼Œä¼šè¡¥åˆ°çˆ¶å…ƒç´ ä¸‹æ–¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">å®æˆ˜æ¡ˆä¾‹2ï¼šæ— å‚è€ƒå…ƒç´ æ—¶çš„å®šä½</h4>
<p>å¦‚æœabsoluteå…ƒç´ æ²¡æœ‰å·²å®šä½çš„ç¥–å…ˆï¼Œå°±ä¼šç›¸å¯¹äºæµè§ˆå™¨çª—å£å®šä½ï¼Œä¸”ä¼šè·Ÿéšé¡µé¢æ»šåŠ¨ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.float-box</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f472b6</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">text-align</span>: center;
}
</code></pre>
<h3 data-id="heading-13">4. position: fixed å›ºå®šå®šä½ï¼ˆæ‚¬æµ®å…ƒç´ ä¸“å±ï¼‰</h3>
<p>fixedå’Œabsoluteå¾ˆåƒï¼Œéƒ½ä¼šè„±ç¦»æ–‡æ¡£æµï¼Œä½†å®ƒçš„å®šä½åŸºå‡†æ˜¯ã€Œæµè§ˆå™¨çª—å£ã€ï¼ˆè§†å£ï¼‰ï¼Œè€Œä¸”<strong>ä¸ä¼šéšé¡µé¢æ»šåŠ¨è€Œç§»åŠ¨</strong>ï¼Œå°±åƒç²˜åœ¨çª—æˆ·ä¸Šçš„ä¾¿åˆ©è´´ã€‚</p>
<h4 data-id="heading-14">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li><strong>è„±ç¦»æ–‡æ¡£æµ</strong>ï¼šä¸å æ®ç©ºé—´ï¼Œä¸absoluteä¸€è‡´</li>
<li><strong>å®šä½åŸºå‡†</strong>ï¼šæµè§ˆå™¨è§†å£ï¼ˆçª—å£ï¼‰ï¼Œä¸å—ç¥–å…ˆå…ƒç´ å½±å“</li>
<li><strong>æ»šåŠ¨æ— å…³</strong>ï¼šé¡µé¢æ»šåŠ¨æ—¶ï¼Œå…ƒç´ ä½ç½®å§‹ç»ˆå›ºå®šåœ¨è§†å£çš„æŸä¸ªåœ°æ–¹</li>
<li><strong>å¸¸è§åœºæ™¯</strong>ï¼šé¡¶éƒ¨å¯¼èˆªæ ã€å³ä¾§æ‚¬æµ®å¹¿å‘Šã€å›åˆ°é¡¶éƒ¨æŒ‰é’®ã€å¼¹çª—é®ç½©</li>
</ul>
<h4 data-id="heading-15">å®æˆ˜æ¡ˆä¾‹ï¼šå³ä¸‹è§’æ‚¬æµ®æŒ‰é’®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Fixed å›ºå®šå®šä½<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; }
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>; <span class="hljs-comment">/* åˆ¶é€ é•¿é¡µé¢ï¼Œæ–¹ä¾¿æµ‹è¯•æ»šåŠ¨ */</span> }
    
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
    }
    
    <span class="hljs-selector-class">.box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#74c69d</span>;
    }
    
    <span class="hljs-comment">/* å›ºå®šåœ¨å³ä¸‹è§’çš„æ‚¬æµ®æŒ‰é’® */</span>
    <span class="hljs-selector-class">.fixed-btn</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2563eb</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
      <span class="hljs-attribute">position</span>: fixed;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">cursor</span>: pointer;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.2</span>);
    }
    
    <span class="hljs-comment">/* å›ºå®šåœ¨é¡¶éƒ¨çš„å¯¼èˆªæ  */</span>
    <span class="hljs-selector-class">.nav</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#1e40af</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">60px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">position</span>: fixed;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* å·¦å³è®¾ä¸º0ï¼Œå®ç°å®½åº¦è‡ªé€‚åº” */</span>
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav"</span>&gt;</span>å›ºå®šå¯¼èˆªæ <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 80px;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>Hello CSS<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fixed-btn"</span>&gt;</span>å›åˆ°é¡¶éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// å®ç°å›åˆ°é¡¶éƒ¨åŠŸèƒ½</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.fixed-btn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> });
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>ç§»åŠ¨ç«¯æ³¨æ„</strong>ï¼šfixedåœ¨iOSçš„Safariä¸­å¯èƒ½ä¼šæœ‰æ»šåŠ¨æŠ–åŠ¨é—®é¢˜ï¼Œå¯é€šè¿‡ç»™bodyæ·»åŠ <code>overflow-x: hidden;</code>æˆ–ä½¿ç”¨stickyæ›¿ä»£ï¼ˆè§†åœºæ™¯è€Œå®šï¼‰ã€‚</p>
<h3 data-id="heading-16">5. position: sticky ç²˜æ€§å®šä½ï¼ˆæ··åˆå®šä½ç¥å™¨ï¼‰</h3>
<p>stickyæ˜¯relativeå’Œfixedçš„ã€Œæ··åˆä½“ã€ï¼Œå…ƒç´ åœ¨æ»šåŠ¨åˆ°æŸä¸ªé˜ˆå€¼å‰è¡¨ç°ä¸ºrelativeï¼ˆéµå¾ªæ–‡æ¡£æµï¼‰ï¼Œè¾¾åˆ°é˜ˆå€¼åè¡¨ç°ä¸ºfixedï¼ˆå›ºå®šåœ¨è§†å£ï¼‰ï¼Œå°±åƒè´´åœ¨é¡µé¢ä¸Šçš„ä¾¿åˆ©è´´ï¼Œæ»šåŠ¨åˆ°ç‰¹å®šä½ç½®æ‰ä¼š"ç²˜ä½"ã€‚</p>
<h4 data-id="heading-17">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li><strong>é˜ˆå€¼è§¦å‘</strong>ï¼šå¿…é¡»é€šè¿‡<code>top/bottom/left/right</code>è®¾ç½®è§¦å‘é˜ˆå€¼ï¼ˆå¦åˆ™æ— æ•ˆï¼‰</li>
<li><strong>å®šä½åŸºå‡†</strong>ï¼šæœªè§¦å‘æ—¶æ˜¯è‡ªèº«åŸå§‹ä½ç½®ï¼ˆrelativeï¼‰ï¼Œè§¦å‘åæ˜¯è§†å£ï¼ˆfixedï¼‰</li>
<li><strong>çˆ¶å…ƒç´ é™åˆ¶</strong>ï¼šstickyå…ƒç´ çš„å›ºå®šèŒƒå›´ä¸ä¼šè¶…å‡ºå®ƒçš„çˆ¶å…ƒç´ ï¼ˆè¿™ç‚¹å’Œfixedä¸åŒï¼‰</li>
<li><strong>å¸¸è§åœºæ™¯</strong>ï¼šè¡¨æ ¼æ ‡é¢˜ã€åˆ—è¡¨åˆ†ç±»æ ‡é¢˜ã€æ»šåŠ¨æ—¶è·Ÿéšçš„ä¾§è¾¹æ </li>
</ul>
<h4 data-id="heading-18">å®æˆ˜æ¡ˆä¾‹ï¼šæ»šåŠ¨æ—¶ç²˜ä½çš„æ ‡é¢˜</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Sticky ç²˜æ€§å®šä½<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; }
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>; }
    
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
    }
    
    <span class="hljs-selector-class">.section</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
    }
    
    <span class="hljs-comment">/* ç²˜æ€§æ ‡é¢˜ï¼šæ»šåŠ¨åˆ°è·ç¦»é¡¶éƒ¨50pxæ—¶ç²˜ä½ */</span>
    <span class="hljs-selector-class">.sticky-title</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2563eb</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">position</span>: sticky;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">50px</span>; <span class="hljs-comment">/* è§¦å‘é˜ˆå€¼ï¼šè·ç¦»è§†å£é¡¶éƒ¨50px */</span>
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span> <span class="hljs-number">4px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-selector-class">.content</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eff6ff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">4px</span>;
    }
    
    <span class="hljs-comment">/* é¡¶éƒ¨å ä½ï¼Œæ¨¡æ‹Ÿé¡µé¢å†…å®¹ */</span>
    <span class="hljs-selector-class">.header</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>æ»šåŠ¨é¡µé¢ï¼Œçœ‹ä¸‹é¢çš„æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sticky-title"</span>&gt;</span>ç¬¬ä¸€éƒ¨åˆ†æ ‡é¢˜ï¼ˆä¼šç²˜ä½ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>ç¬¬ä¸€éƒ¨åˆ†å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sticky-title"</span>&gt;</span>ç¬¬äºŒéƒ¨åˆ†æ ‡é¢˜ï¼ˆä¼šç²˜ä½ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>ç¬¬äºŒéƒ¨åˆ†å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sticky-title"</span>&gt;</span>ç¬¬ä¸‰éƒ¨åˆ†æ ‡é¢˜ï¼ˆä¼šç²˜ä½ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>ç¬¬ä¸‰éƒ¨åˆ†å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>æ–°æ‰‹é¿å‘</strong>ï¼šstickyçš„çˆ¶å…ƒç´ ä¸èƒ½æœ‰<code>overflow: hidden/auto/scroll</code>å±æ€§ï¼Œå¦åˆ™ç²˜æ€§æ•ˆæœä¼šå¤±æ•ˆï¼ˆçˆ¶å…ƒç´ çš„æ»šåŠ¨ä¼š"å›°ä½"stickyå…ƒç´ ï¼‰ã€‚</p>
<h2 data-id="heading-19">ä¸‰ã€ä¸€å¼ è¡¨ç†æ¸…5ç§å®šä½çš„æ ¸å¿ƒåŒºåˆ«</h2>
<p>è¿™å¼ å¯¹æ¯”è¡¨æ˜¯å®šä½çŸ¥è¯†çš„ã€Œç²¾åæ€»ç»“ã€ï¼Œå»ºè®®æ”¶è—èµ·æ¥ï¼Œé‡åˆ°å¸ƒå±€é—®é¢˜æ—¶éšæ—¶æŸ¥é˜…ï¼š</p>















































<table><thead><tr><th>å®šä½æ–¹å¼</th><th>æ˜¯å¦è„±ç¦»æ–‡æ¡£æµ</th><th>å®šä½åŸºå‡†</th><th>åç§»å±æ€§æ˜¯å¦ç”Ÿæ•ˆ</th><th>æ ¸å¿ƒåº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>static</code></td><td>å¦</td><td>æ­£å¸¸æ–‡æ¡£æµ</td><td>æ— æ•ˆ</td><td>é»˜è®¤å¸ƒå±€ã€å–æ¶ˆå®šä½</td></tr><tr><td><code>relative</code></td><td>å¦</td><td>è‡ªèº«åŸå§‹ä½ç½®</td><td>ç”Ÿæ•ˆ</td><td>å¾®è°ƒä½ç½®ã€ç»™absoluteå½“å‚è€ƒ</td></tr><tr><td><code>absolute</code></td><td>æ˜¯</td><td>æœ€è¿‘å·²å®šä½ç¥–å…ˆ/è§†å£</td><td>ç”Ÿæ•ˆ</td><td>å¼¹å‡ºå±‚ã€èœå•ã€ç²¾å‡†å®šä½</td></tr><tr><td><code>fixed</code></td><td>æ˜¯</td><td>æµè§ˆå™¨è§†å£</td><td>ç”Ÿæ•ˆ</td><td>å¯¼èˆªæ ã€æ‚¬æµ®æŒ‰é’®ã€é®ç½©</td></tr><tr><td><code>sticky</code></td><td>å¦â†’æ˜¯ï¼ˆé˜ˆå€¼è§¦å‘ï¼‰</td><td>è‡ªèº«ä½ç½®â†’è§†å£</td><td>ç”Ÿæ•ˆï¼ˆéœ€è®¾é˜ˆå€¼ï¼‰</td><td>è¡¨æ ¼æ ‡é¢˜ã€æ»šåŠ¨è·Ÿéšæ ‡é¢˜</td></tr></tbody></table>
<h2 data-id="heading-20">å››ã€å®æˆ˜æŠ€å·§ä¸å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-21">1. ç»å¯¹å®šä½å…ƒç´ å±…ä¸­çš„3ç§æ–¹æ³•</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ–¹æ³•1ï¼šleft/top 50% + transformï¼ˆæœ€æ¨èï¼Œæ”¯æŒè‡ªé€‚åº”ï¼‰ */</span>
<span class="hljs-selector-class">.absolute-center</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
}

<span class="hljs-comment">/* æ–¹æ³•2ï¼šmargin auto + å››ä¸ªæ–¹å‘è®¾ä¸º0ï¼ˆéœ€å›ºå®šå®½é«˜ï¼‰ */</span>
<span class="hljs-selector-class">.absolute-center</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">margin</span>: auto;
}

<span class="hljs-comment">/* æ–¹æ³•3ï¼šcalcè®¡ç®—ï¼ˆéœ€å›ºå®šå®½é«˜ï¼‰ */</span>
<span class="hljs-selector-class">.absolute-center</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">50%</span> - <span class="hljs-number">100px</span>); <span class="hljs-comment">/* å®½200pxï¼Œ100pxæ˜¯å®½çš„ä¸€åŠ */</span>
  <span class="hljs-attribute">top</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">50%</span> - <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
}
</code></pre>
<h3 data-id="heading-22">2. å®šä½å…ƒç´ çš„å±‚çº§é—®é¢˜ï¼ˆz-indexï¼‰</h3>
<ul>
<li><strong>é»˜è®¤å±‚çº§</strong>ï¼šè„±ç¦»æ–‡æ¡£æµçš„å…ƒç´ ï¼ˆabsolute/fixedï¼‰å±‚çº§é«˜äºæ–‡æ¡£æµä¸­çš„å…ƒç´ </li>
<li><strong>z-indexä½œç”¨</strong>ï¼šæ•°å€¼è¶Šå¤§ï¼Œå±‚çº§è¶Šé«˜ï¼ˆé»˜è®¤autoï¼Œç­‰ä»·äº0ï¼‰ï¼Œä»…å¯¹å·²å®šä½å…ƒç´ ç”Ÿæ•ˆ</li>
<li><strong>å±‚çº§ç»§æ‰¿</strong>ï¼šå­å…ƒç´ çš„å±‚çº§å—çˆ¶å…ƒç´ å½±å“ï¼Œçˆ¶å…ƒç´ å±‚çº§ä½ï¼Œå­å…ƒç´ å†é«˜ä¹Ÿæ— æ³•è¶…è¿‡çˆ¶å…ƒç´ çš„åŒçº§å…ƒç´ </li>
</ul>
<h3 data-id="heading-23">3. æ–°æ‰‹æœ€å®¹æ˜“è¸©çš„å‘</h3>
<ol>
<li><strong>absoluteå…ƒç´ æ‰¾ä¸åˆ°å‚è€ƒç‚¹</strong>ï¼šå¿˜è®°ç»™çˆ¶å…ƒç´ è®¾relativeï¼Œå¯¼è‡´å…ƒç´ ç›¸å¯¹äºè§†å£å®šä½</li>
<li><strong>stickyæ•ˆæœå¤±æ•ˆ</strong>ï¼šæ²¡è®¾ç½®top/bottomç­‰é˜ˆå€¼ï¼Œæˆ–çˆ¶å…ƒç´ æœ‰overflowå±æ€§</li>
<li><strong>relativeå…ƒç´ å‹åˆ°å…¶ä»–å…ƒç´ </strong>ï¼šè¯¯ä»¥ä¸ºrelativeä¼šè„±ç¦»æ–‡æ¡£æµï¼Œå…¶å®å®ƒåªæ˜¯åç§»ï¼Œä¸ä¼šè®©å…¶ä»–å…ƒç´ è¡¥ä½</li>
<li><strong>fixedåœ¨ç§»åŠ¨ç«¯æŠ–åŠ¨</strong>ï¼šå¯å°è¯•ç”¨stickyæ›¿ä»£ï¼Œæˆ–ç»™bodyæ·»åŠ <code>position: fixed;</code>ï¼ˆè§†åœºæ™¯è°ƒæ•´ï¼‰</li>
</ol>
<h2 data-id="heading-24">äº”ã€æ€»ç»“ï¼šå®šä½çš„æ ¸å¿ƒä½¿ç”¨åŸåˆ™</h2>
<p>CSSå®šä½çš„æ ¸å¿ƒä¸æ˜¯æ­»è®°ç¡¬èƒŒï¼Œè€Œæ˜¯æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼Œè®°ä½è¿™å‡ ä¸ªåŸåˆ™ï¼š</p>
<ul>
<li><strong>ç®€å•å¸ƒå±€ç”¨é»˜è®¤</strong>ï¼šä¸éœ€è¦ç‰¹æ®Šå®šä½æ—¶ï¼Œç”¨staticéµå¾ªæ–‡æ¡£æµå³å¯</li>
<li><strong>å¾®è°ƒä½ç½®ç”¨relative</strong>ï¼šå…ƒç´ éœ€è¦å°å¹…åº¦åç§»ï¼Œä¸”ä¸å½±å“å…¶ä»–å¸ƒå±€æ—¶ç”¨å®ƒ</li>
<li><strong>ç‹¬ç«‹ç»„ä»¶ç”¨absolute</strong>ï¼šå¼¹å‡ºå±‚ã€ä¸‹æ‹‰èœå•ç­‰éœ€è¦è„±ç¦»æ–‡æ¡£æµçš„ç»„ä»¶ç”¨å®ƒï¼Œè®°å¾—ç»™çˆ¶å…ƒç´ åŠ relative</li>
<li><strong>æ‚¬æµ®å…ƒç´ ç”¨fixed</strong>ï¼šå¯¼èˆªæ ã€å›åˆ°é¡¶éƒ¨æŒ‰é’®ç­‰éœ€è¦å§‹ç»ˆå¯è§çš„å…ƒç´ ç”¨å®ƒ</li>
<li><strong>æ»šåŠ¨è·Ÿéšç”¨sticky</strong>ï¼šè¡¨æ ¼æ ‡é¢˜ã€åˆ†ç±»æ ‡é¢˜ç­‰éœ€è¦æ»šåŠ¨åˆ°ç‰¹å®šä½ç½®æ‰å›ºå®šçš„å…ƒç´ ç”¨å®ƒ</li>
</ul>
<p>æœ€åï¼Œå®šä½å¸ƒå±€æ²¡æœ‰ç»å¯¹çš„"æœ€ä½³æ–¹æ¡ˆ"ï¼Œåªæœ‰"æœ€é€‚åˆåœºæ™¯"çš„æ–¹æ¡ˆã€‚å»ºè®®å¤šå†™æ¡ˆä¾‹æµ‹è¯•ï¼Œäº²æ‰‹æ„Ÿå—æ¯ç§å®šä½çš„å·®å¼‚â€”â€”å®è·µæ‰æ˜¯æŒæ¡CSSå®šä½çš„æœ€å¥½æ–¹æ³•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VUEåå°ç®¡ç†ç³»ç»Ÿï¼šå®šåˆ¶åŒ–ã€é«˜å¯ç”¨å‰å°æ ·å¼å¤„ç†æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7575112613778309154</link>    <guid>https://juejin.cn/post/7575112613778309154</guid>    <pubDate>2025-11-23T12:32:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575112613778309154" data-draft-id="7575112613778194466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VUEåå°ç®¡ç†ç³»ç»Ÿï¼šå®šåˆ¶åŒ–ã€é«˜å¯ç”¨å‰å°æ ·å¼å¤„ç†æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-23T12:32:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é»˜æµ·ç¬‘"/> <meta itemprop="url" content="https://juejin.cn/user/3246223221632151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VUEåå°ç®¡ç†ç³»ç»Ÿï¼šå®šåˆ¶åŒ–ã€é«˜å¯ç”¨å‰å°æ ·å¼å¤„ç†æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3246223221632151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é»˜æµ·ç¬‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T12:32:03.000Z" title="Sun Nov 23 2025 12:32:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å­¦ä¹ å‰æ</h3>
<p>ä¼šåŸºæœ¬çš„vueï¼Œä¼šä½¿ç”¨AIåŠ©æ‰‹ï¼Œ<strong><code>å­¦ä¹ æœ¬è¯¾æœ¬çš„äººå¿…é¡»é•¿å¾—å¸…ã€‚</code></strong></p>
<h3 data-id="heading-1">å®‰è£…tailwindcss</h3>
<pre><code class="hljs language-js" lang="js">npm install -D tailwindcss postcss autoprefixer

npx tailwindcss init -p
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcc0001526ff48d38725eddd519d44c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764505923&amp;x-signature=o25eaQkR1pxyzc7arJuhvU24qGo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">é…ç½®æ–‡ä»¶è¯´æ˜</h2>
<p>tailwind.config.jsÂ - å·²é…ç½®ä¸ºæ‰«ææ‰€æœ‰ Vue æ–‡ä»¶ï¼š</p>
<ul>
<li>./index.html</li>
</ul>

<ul>
<li>./src/**/*.{vue,js,ts,jsx,tsx}</li>
</ul>
<p>postcss.config.jsÂ - å·²é…ç½® Tailwind å’Œ Autoprefixer æ’ä»¶main.scssÂ - å·²æ·»åŠ  Tailwind æŒ‡ä»¤ï¼š</p>
<p>@tailwindÂ base;</p>
<p>@tailwindÂ components;</p>
<p>@tailwindÂ utilities;</p>
<h2 data-id="heading-3">ä½¿ç”¨ç¤ºä¾‹</h2>
<p>å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥åœ¨ Vue ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ Tailwind ç±»åï¼š</p>

<p>å®Œæˆåï¼ŒTailwind CSS å³å¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
<p>ä½†æ˜¯å¯åŠ¨é¡¹ç›®é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5605be957d7a402ca0720a5b104efa82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764505923&amp;x-signature=GgBJNTwJBssvLO5QO%2FWQu9E3hq0%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ˜¯ Tailwind CSS v4 çš„å˜åŒ–ã€‚æ£€æŸ¥å½“å‰å®‰è£…çš„ç‰ˆæœ¬ï¼Œç„¶åæä¾›è§£å†³æ–¹æ¡ˆï¼š</p>
<p>å®‰è£…çš„æ˜¯ Tailwind CSS v4.1.17ã€‚v4 å°† PostCSSÂ æ’ä»¶ç§»åˆ°äº†Â @tailwindcss/postcssï¼Œå› æ­¤éœ€è¦è°ƒæ•´é…ç½®ã€‚æä¾›ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>æ–¹æ¡ˆ 1ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨ Tailwind CSS v3ï¼ˆæ›´ç¨³å®šï¼Œå…¼å®¹æ€§æ›´å¥½ï¼‰</li>
</ul>

<ul>
<li>æ–¹æ¡ˆÂ 2ï¼šä½¿ç”¨ Tailwind CSS v4ï¼ˆéœ€è¦å®‰è£…Â @tailwindcss/postcssï¼‰</li>
</ul>
<p>å…ˆæŒ‰æ–¹æ¡ˆ 1 å¤„ç†ï¼šé™çº§åˆ° v3 å¹¶æ›´æ–°é…ç½®ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬ç°åœ¨ä½¿ç”¨æ–¹æ¡ˆ1ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81cee420cfc2452182e13639c83b51a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764505923&amp;x-signature=mEevdJGK19fIM7XAnTZp13eebqs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">å°è¯•ç‰›åˆ€</h3>
<p>ç°åœ¨å®‰è£…å¥½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¯¹è€é¡¹ç›®åŸæ¥çš„ä¼ ç»Ÿçš„cssçš„å†™æ³•ï¼Œä¿®æ”¹åˆ‡æ¢æˆtailwindcssæ–¹å¼æ›´æ–°ã€‚</p>
<h3 data-id="heading-5">è¿ç§»ç­–ç•¥æ¦‚è¿°</h3>
<p>è¿ç§»åŸåˆ™ï¼š</p>
<ol>
<li>ä¿ç•™å¿…è¦çš„ç¬¬ä¸‰æ–¹ç»„ä»¶æ ·å¼è¦†ç›–ï¼ˆå¦‚Â Element Plusï¼‰</li>
</ol>

<ol start="2">
<li>å°†å¯è½¬æ¢çš„æ ·å¼æ”¹ä¸º Tailwind å®ç”¨ç±»</li>
</ol>

<ol start="3">
<li>ä½¿ç”¨ Tailwind çš„é…ç½®ç³»ç»Ÿç®¡ç†è®¾è®¡å˜é‡</li>
</ol>

<ol start="4">
<li>åˆ©ç”¨Â @layerÂ å’ŒÂ @applyÂ å¤„ç†å…¨å±€æ ·å¼</li>
</ol>
<h4 data-id="heading-6">1.Â tailwind.config.jsÂ - ä¸»é¢˜é…ç½®æ‰©å±•</h4>
<p>ç›®çš„ï¼šå°† SCSSÂ å˜é‡æ˜ å°„ä¸º TailwindÂ ä¸»é¢˜ï¼Œç»Ÿä¸€ç®¡ç†è®¾è®¡å˜é‡ã€‚æ”¹åŠ¨å†…å®¹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">theme</span>: {
  <span class="hljs-attr">extend</span>: {
    <span class="hljs-comment">// è‡ªå®šä¹‰é¢œè‰²ç³»ç»Ÿ</span>
    <span class="hljs-attr">colors</span>: {
      <span class="hljs-attr">menu</span>: {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'#bfcbd9'</span>,           <span class="hljs-comment">// èœå•æ–‡å­—é¢œè‰²</span>
        <span class="hljs-string">'active-text'</span>: <span class="hljs-string">'#ffffff'</span>,   <span class="hljs-comment">// æ¿€æ´»çŠ¶æ€æ–‡å­—</span>
        <span class="hljs-attr">bg</span>: <span class="hljs-string">'#304156'</span>,              <span class="hljs-comment">// èœå•èƒŒæ™¯è‰²</span>
        <span class="hljs-attr">hover</span>: <span class="hljs-string">'#263445'</span>,           <span class="hljs-comment">// æ‚¬åœçŠ¶æ€</span>
        <span class="hljs-comment">// ...</span>
      },
      <span class="hljs-attr">login</span>: {
        <span class="hljs-attr">bg</span>: <span class="hljs-string">'#2d3a4b'</span>,
        <span class="hljs-string">'dark-gray'</span>: <span class="hljs-string">'#889aa4'</span>,
        <span class="hljs-comment">// ...</span>
      }
    },
    <span class="hljs-comment">// è‡ªå®šä¹‰å®½åº¦</span>
    <span class="hljs-attr">width</span>: {
      <span class="hljs-attr">sidebar</span>: <span class="hljs-string">'210px'</span>,
      <span class="hljs-string">'sidebar-hide'</span>: <span class="hljs-string">'54px'</span>,
    },
    <span class="hljs-comment">// è‡ªå®šä¹‰è¿‡æ¸¡æ—¶é—´</span>
    <span class="hljs-attr">transitionDuration</span>: {
      <span class="hljs-attr">sidebar</span>: <span class="hljs-string">'0.28s'</span>,
    },
    <span class="hljs-comment">// è‡ªå®šä¹‰å­—ä½“æ—</span>
    <span class="hljs-attr">fontFamily</span>: {
      <span class="hljs-attr">sans</span>: [<span class="hljs-string">'Helvetica Neue'</span>, <span class="hljs-string">'PingFang SC'</span>, ...],
    }
  }
}
</code></pre>
<p>æ•™å­¦è¦ç‚¹ï¼š</p>
<ul>
<li>extendÂ ç”¨äºæ‰©å±•è€Œéè¦†ç›–é»˜è®¤ä¸»é¢˜</li>
</ul>

<ul>
<li>åµŒå¥—å¯¹è±¡ä¼šç”Ÿæˆå¯¹åº”çš„ç±»åï¼Œå¦‚Â bg-menu-bgã€text-menu-text</li>
</ul>

<ul>
<li>ä½¿ç”¨è¿å­—ç¬¦çš„é”®åï¼ˆå¦‚Â 'active-text'ï¼‰éœ€è¦ç”¨å¼•å·åŒ…è£¹</li>
</ul>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>

<p><code>&lt;divÂ :style="{Â backgroundColor:Â $menuBgÂ }"&gt;</code></p>

<p><code>&lt;divÂ class="bg-menu-bgÂ text-menu-text"&gt;</code></p>
<hr/>
<h4 data-id="heading-7">2.Â postcss.config.jsÂ -Â PostCSS é…ç½®</h4>
<p>ç›®çš„ï¼šé…ç½® PostCSS å¤„ç† TailwindÂ CSSã€‚æ”¹åŠ¨å†…å®¹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-attr">tailwindcss</span>: {},    <span class="hljs-comment">// Tailwind CSS æ’ä»¶</span>
    <span class="hljs-attr">autoprefixer</span>: {},   <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€</span>
  },
}
</code></pre>
<ul>
<li>Vite ä¼šè‡ªåŠ¨è¯»å–æ­¤æ–‡ä»¶</li>
</ul>

<ul>
<li>æ’ä»¶é¡ºåºå¾ˆé‡è¦ï¼šå…ˆ Tailwindï¼Œå Autoprefixer</li>
</ul>

<ul>
<li>Autoprefixer ä¼šè‡ªåŠ¨å¤„ç†æµè§ˆå™¨å…¼å®¹æ€§</li>
</ul>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€å…¨å±€æ ·å¼æ–‡ä»¶æ”¹åŠ¨</h3>
<h4 data-id="heading-9">3.Â src/assets/main.scssÂ - å…¨å±€æ ·å¼é‡æ„</h4>
<p>æ”¹åŠ¨å‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/variables.scss'</span>;
@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/mixin.scss'</span>;
@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/sidebar.scss'</span>;

html, body {
  <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>%;
  <span class="hljs-attr">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attr">padding</span>: <span class="hljs-number">0</span>;
  font-<span class="hljs-attr">family</span>: <span class="hljs-title class_">Helvetica</span> <span class="hljs-title class_">Neue</span>, ...;
}

.<span class="hljs-property">clearfix</span> {
  &amp;:after {
    <span class="hljs-attr">visibility</span>: hidden;
    <span class="hljs-attr">display</span>: block;
    font-<span class="hljs-attr">size</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attr">content</span>: <span class="hljs-string">' '</span>;
    <span class="hljs-attr">clear</span>: both;
    <span class="hljs-attr">height</span>: <span class="hljs-number">0</span>;
  }
}
</code></pre>
<p>æ”¹åŠ¨åï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. å¼•å…¥ Tailwind æ ¸å¿ƒæŒ‡ä»¤</span>
@tailwind base;
@tailwind components;
@tailwind utilities;

<span class="hljs-comment">// 2. ä¿ç•™å¿…è¦çš„ SCSS æ–‡ä»¶ï¼ˆåŒ…å« Element Plus æ ·å¼è¦†ç›–ï¼‰</span>
@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/variables.scss'</span>;
@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/sidebar.scss'</span>;

<span class="hljs-comment">// 3. ä½¿ç”¨ @layer base å®šä¹‰åŸºç¡€æ ·å¼</span>
@layer base {
  html, body {
    @apply h-full m-<span class="hljs-number">0</span> p-<span class="hljs-number">0</span>;
    -moz-osx-font-<span class="hljs-attr">smoothing</span>: grayscale;
    -webkit-font-<span class="hljs-attr">smoothing</span>: antialiased;
    text-<span class="hljs-attr">rendering</span>: optimizeLegibility;
  }
  
  #app {
    @apply h-full;
  }
  
  <span class="hljs-comment">// å…¨å±€é‡ç½®</span>
  *, *:before, *:after {
    @apply box-border m-<span class="hljs-number">0</span> p-<span class="hljs-number">0</span>;
  }
}

<span class="hljs-comment">// 4. ä½¿ç”¨ @layer utilities å®šä¹‰å·¥å…·ç±»</span>
@layer utilities {
  .<span class="hljs-property">clearfix</span> {
    &amp;::after {
      @apply invisible block clear-both h-<span class="hljs-number">0</span>;
      font-<span class="hljs-attr">size</span>: <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ³¨æ„ï¼šTailwind æ²¡æœ‰ text-0ï¼Œéœ€è¦ç›´æ¥å†™ CSS</span>
      <span class="hljs-attr">content</span>: <span class="hljs-string">' '</span>;
    }
  }
}
</code></pre>
<ol>
<li>Tailwind æŒ‡ä»¤é¡ºåºï¼š</li>
</ol>
<ul>
<li>@tailwindÂ baseÂ - åŸºç¡€æ ·å¼é‡ç½®</li>
</ul>

<ul>
<li>@tailwind componentsÂ - ç»„ä»¶å±‚</li>
</ul>

<ul>
<li>@tailwind utilitiesÂ - å·¥å…·ç±»</li>
</ul>
<ol start="2">
<li>@layerÂ çš„ä½œç”¨ï¼š</li>
</ol>
<ul>
<li>@layer baseï¼šåŸºç¡€æ ·å¼ï¼Œä¼˜å…ˆçº§æœ€ä½</li>
</ul>

<ul>
<li>@layer componentsï¼šç»„ä»¶æ ·å¼</li>
</ul>

<ul>
<li>@layerÂ utilitiesï¼šå·¥å…·ç±»ï¼Œä¼˜å…ˆçº§æœ€é«˜</li>
</ul>
<ol start="3">
<li>@applyÂ çš„ä½¿ç”¨ï¼š</li>
</ol>
<ul>
<li>åœ¨ CSSÂ ä¸­ä½¿ç”¨ Tailwind ç±»</li>
</ul>

<ul>
<li>åªèƒ½ç”¨äºÂ @layerÂ å†…</li>
</ul>

<ul>
<li>ä¸èƒ½ç”¨äºä¼ªç±»é€‰æ‹©å™¨ï¼ˆå¦‚Â :hoverï¼‰</li>
</ul>
<p>.  æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>ç§»é™¤äº†Â mixin.scssÂ å¯¼å…¥ï¼ˆclearfix å·²ç”¨ Tailwind å®ç°ï¼‰</li>
</ul>

<ul>
<li>ä¿ç•™äº†Â variables.scssï¼ˆå¯èƒ½è¢« JS é€šè¿‡Â :exportÂ ä½¿ç”¨ï¼‰</li>
</ul>

<ul>
<li>ä¿ç•™äº†Â sidebar.scssï¼ˆåŒ…å« Element PlusÂ æ ·å¼è¦†ç›–ï¼‰</li>
</ul>
<p>å…¶æ¬¡ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬çš„ç”¨æ³•</p>
<ol>
<li>ç±»åæ˜ å°„ï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">    Â Â Â <span class="hljs-comment">//Â SCSSÂ â†’Â Tailwind</span>
    Â Â Â <span class="hljs-attr">position</span>:Â relative;Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"relative"</span>
    Â Â Â <span class="hljs-attr">height</span>:Â <span class="hljs-number">100</span>%;Â Â Â Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"h-full"</span>
    Â Â Â <span class="hljs-attr">width</span>:Â <span class="hljs-number">100</span>%;Â Â Â Â Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"w-full"</span>
    Â Â Â <span class="hljs-attr">position</span>:Â fixed;Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"fixed"</span>
    Â Â Â <span class="hljs-attr">top</span>:Â <span class="hljs-number">0</span>;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"top-0"</span>
    Â Â Â z-<span class="hljs-attr">index</span>:Â <span class="hljs-number">9</span>;Â Â Â Â Â Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"z-[9]"</span>
</code></pre>

<ol>
<li>åŠ¨æ€å€¼å¤„ç†ï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">    Â Â Â <span class="hljs-comment">//Â SCSSÂ å˜é‡</span>

    Â Â Â <span class="hljs-attr">width</span>:Â <span class="hljs-title function_">calc</span>(<span class="hljs-number">100</span>%Â -Â #{$sideBarWidth});
    Â Â Â <span class="hljs-comment">//Â TailwindÂ ä»»æ„å€¼è¯­æ³•</span>
    Â Â Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"w-[calc(100%-210px)]"</span>
</code></pre>

<ol>
<li>è¿‡æ¸¡åŠ¨ç”»ï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">    Â Â Â <span class="hljs-comment">//Â SCSS</span>
    Â Â Â <span class="hljs-attr">transition</span>:Â margin-leftÂ <span class="hljs-number">0.</span>28s;
    Â Â Â <span class="hljs-comment">//Â Tailwind</span>
    Â Â Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"transition-[margin-left]Â duration-[0.28s]"</span>
</code></pre>

<ol>
<li>ä¼˜åŠ¿ï¼š</li>
</ol>
<ul>
<li>æ ·å¼ä¸Â HTML åœ¨ä¸€èµ·ï¼Œæ›´ç›´è§‚</li>
</ul>

<ul>
<li>ä¸éœ€è¦åœ¨Â Â å’Œæ¨¡æ¿é—´åˆ‡æ¢
</li></ul>

<ul>
<li>å‡å°‘æ–‡ä»¶ä½“ç§¯ï¼ˆTailwind ä¼šÂ tree-shake æœªä½¿ç”¨çš„ç±»ï¼‰</li>
</ul>
<h3 data-id="heading-10">æºç ï¼š</h3>
<p>å‡çº§å®‰è£…ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmohaixiao%2Fvue-admin%2Fcommit%2Ff006923ce7a4869ad71c4edf83a81f9bd34de37f" target="_blank" title="https://github.com/mohaixiao/vue-admin/commit/f006923ce7a4869ad71c4edf83a81f9bd34de37f" ref="nofollow noopener noreferrer">github.com/mohaixiao/vâ€¦</a></p>
<p>æ”¹é€ ä»£ç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmohaixiao%2Fvue-admin%2Fcommit%2Fb1bb1408975bde2fcb1de467d45d606d10b20c86" target="_blank" title="https://github.com/mohaixiao/vue-admin/commit/b1bb1408975bde2fcb1de467d45d606d10b20c86" ref="nofollow noopener noreferrer">github.com/mohaixiao/vâ€¦</a></p>
<p>æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmohaixiao%2Fvue-admin" target="_blank" title="https://github.com/mohaixiao/vue-admin" ref="nofollow noopener noreferrer">github.com/mohaixiao/vâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3-toRefã€toRefsã€toRaw]]></title>    <link>https://juejin.cn/post/7575106644499529762</link>    <guid>https://juejin.cn/post/7575106644499529762</guid>    <pubDate>2025-11-23T12:37:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575106644499529762" data-draft-id="7575162322240372736" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3-toRefã€toRefsã€toRaw"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-11-23T12:37:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YaeZed"/> <meta itemprop="url" content="https://juejin.cn/user/3977350021390107"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3-toRefã€toRefsã€toRaw
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3977350021390107/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YaeZed
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T12:37:13.000Z" title="Sun Nov 23 2025 12:37:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="gml">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#222;color:silver}.hljs-keyword{color:#ffb871;font-weight:700}.hljs-built_in{color:#ffb871}.hljs-literal{color:#ff8080}.hljs-symbol{color:#58e55a}.hljs-comment{color:#5b995b}.hljs-string{color:#ff0}.hljs-number{color:#ff8080}.hljs-addition,.hljs-attribute,.hljs-bullet,.hljs-code,.hljs-deletion,.hljs-doctag,.hljs-function,.hljs-link,.hljs-meta,.hljs-meta-keyword,.hljs-name,.hljs-quote,.hljs-regexp,.hljs-section,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:silver}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Vue 3 ä¸­ï¼Œ<code>toRef</code>ã€<code>toRefs</code> å’Œ <code>toRaw</code> éƒ½æ˜¯å¤„ç†å“åº”å¼ç³»ç»Ÿçš„é‡è¦å·¥å…·ï¼Œå®ƒä»¬æä¾›äº†æ›´çµæ´»çš„æ–¹å¼æ¥æ“ä½œ <code>reactive</code> å¯¹è±¡ã€‚</p>
<h2 data-id="heading-0">1.toRef</h2>
<p><code>toRef</code> ç”¨äºä¸º <code>reactive</code> å¯¹è±¡ä¸Šçš„<strong>å•ä¸ªå±æ€§</strong>åˆ›å»ºä¸€ä¸ª<strong>å“åº”å¼çš„ <code>ref</code></strong>ã€‚</p>
<p><code>toRef</code> æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šæºå¯¹è±¡å’Œå±æ€§åã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { reactive, toRef, watchEffect, isRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 1. å®šä¹‰æºå¯¹è±¡</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">foo</span>: <span class="hljs-string">'hello'</span>,
  <span class="hljs-attr">bar</span>: <span class="hljs-number">100</span>,
});

<span class="hljs-comment">// 2. åˆ›å»ºå•ä¸ª ref</span>
<span class="hljs-comment">// const fooRef = toRef(state, 'foo');</span>
<span class="hljs-comment">// ä½¿ç”¨ TS æ³›å‹ (è™½ç„¶é€šå¸¸ä¼šè‡ªåŠ¨æ¨æ–­)</span>
<span class="hljs-keyword">const</span> fooRef = toRef&lt;<span class="hljs-keyword">typeof</span> state, <span class="hljs-string">'foo'</span>&gt;(state, <span class="hljs-string">'foo'</span>);

<span class="hljs-comment">// 3. éªŒè¯</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isRef</span>(fooRef)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fooRef.<span class="hljs-property">value</span>); <span class="hljs-comment">// 'hello'</span>

<span class="hljs-comment">// 4. åŒå‘ç»‘å®šç‰¹æ€§</span>
<span class="hljs-comment">// ä¿®æ”¹ toRef åˆ›å»ºçš„ ref ä¼šæ›´æ–°åŸå§‹å¯¹è±¡</span>
fooRef.<span class="hljs-property">value</span> = <span class="hljs-string">'world'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state.<span class="hljs-property">foo</span>); <span class="hljs-comment">// 'world'</span>

<span class="hljs-comment">// ä¿®æ”¹åŸå§‹å¯¹è±¡ä¹Ÿä¼šæ›´æ–° ref</span>
state.<span class="hljs-property">foo</span> = <span class="hljs-string">'hello again'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fooRef.<span class="hljs-property">value</span>); <span class="hljs-comment">// 'hello again'</span>

<span class="hljs-comment">// ç›‘å¬å˜åŒ–</span>
<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`fooRef changed to: <span class="hljs-subst">${fooRef.value}</span>`</span>);
});

state.<span class="hljs-property">foo</span> = <span class="hljs-string">'Final value'</span>; <span class="hljs-comment">// watchEffect ä¼šè§¦å‘</span>
</code></pre>
<p><code>toRef</code> æœ€æ ¸å¿ƒçš„ç”¨ä¾‹æ˜¯<strong>åœ¨ä¸ä¸¢å¤±å“åº”æ€§çš„æƒ…å†µä¸‹ä¼ é€’ <code>props</code></strong>ã€‚</p>
<blockquote>
<p>ä¸¾ä¸ªæ —å­ï¼šä»çˆ¶ç»„ä»¶æ¥æ”¶å‚æ•°</p>
</blockquote>
<ul>
<li>å½“ä½ åœ¨ <code>setup</code> ä¸­è§£æ„ <code>props</code> æ—¶ï¼Œä½ ä¼šä¸¢å¤±å“åº”æ€§ï¼Œå› ä¸ºä½ å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å˜é‡ã€‚</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// MyComponent.vue</span>
<span class="hljs-keyword">import</span> { defineProps, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;
}&gt;();

<span class="hljs-comment">// è¿™æ ·è§£æ„ä¼šä¸¢å¤±å“åº”æ€§</span>
<span class="hljs-keyword">let</span> { count } = props;
<span class="hljs-comment">// count åªæ˜¯ä¸€ä¸ªæ™®é€šçš„ numberï¼Œå½“ props.count å˜åŒ–æ—¶ï¼Œå®ƒä¸ä¼šæ›´æ–°</span>

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// è¿™ä¸ª effect æ°¸è¿œä¸ä¼šå†æ¬¡è¿è¡Œï¼Œå³ä½¿ props.count å˜äº†</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Count is: <span class="hljs-subst">${count}</span>`</span>); 
});
</code></pre>
<ul>
<li>æ­£ç¡®ç¤ºä¾‹ï¼ˆä½¿ç”¨<code>toRef</code>ï¼‰</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// MyComponent.vue</span>
<span class="hljs-keyword">import</span> { defineProps, toRef, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> props = defineProps&lt;{
  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;
}&gt;();

<span class="hljs-comment">// ä½¿ç”¨ toRef å°† props.count è½¬æ¢ä¸ºä¸€ä¸ª ref</span>
<span class="hljs-keyword">const</span> countRef = <span class="hljs-title function_">toRef</span>(props, <span class="hljs-string">'count'</span>);

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ç°åœ¨ countRef æ˜¯å“åº”å¼çš„</span>
  <span class="hljs-comment">// å½“ props.count å˜åŒ–æ—¶ï¼Œè¿™ä¸ª effect ä¼šé‡æ–°è¿è¡Œ</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Count is: <span class="hljs-subst">${countRef.value}</span>`</span>);
});
</code></pre>
<h2 data-id="heading-1">2.toRefs</h2>
<p><code>toRefs</code> ç”¨äºå°†ä¸€ä¸ª <code>reactive</code> å¯¹è±¡çš„<strong>æ‰€æœ‰å±æ€§</strong>è½¬æ¢ä¸ºä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œå…¶ä¸­<strong>æ¯ä¸ªå±æ€§éƒ½æ˜¯ä¸€ä¸ª <code>ref</code></strong>ã€‚</p>
<p><code>toRefs</code> æ¥æ”¶ä¸€ä¸ª <code>reactive</code> å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { reactive, toRefs, <span class="hljs-title class_">ToRefs</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> state = reactive&lt;<span class="hljs-title class_">User</span>&gt;({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
});

<span class="hljs-comment">// 1. è½¬æ¢æ•´ä¸ªå¯¹è±¡</span>
<span class="hljs-comment">// stateAsRefs çš„ç±»å‹æ˜¯ { name: Ref&lt;string&gt;, age: Ref&lt;number&gt; }</span>
<span class="hljs-keyword">const</span> stateAsRefs = <span class="hljs-title function_">toRefs</span>(state);

<span class="hljs-comment">// 2. è®¿é—®</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stateAsRefs.<span class="hljs-property">name</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// 'Bob'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stateAsRefs.<span class="hljs-property">age</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// 25</span>

<span class="hljs-comment">// 3. åŒæ ·å…·æœ‰åŒå‘ç»‘å®šç‰¹æ€§</span>
stateAsRefs.<span class="hljs-property">name</span>.<span class="hljs-property">value</span> = <span class="hljs-string">'Charlie'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state.<span class="hljs-property">name</span>); <span class="hljs-comment">// 'Charlie'</span>

state.<span class="hljs-property">age</span> = <span class="hljs-number">26</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stateAsRefs.<span class="hljs-property">age</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// 26</span>
</code></pre>
<blockquote>
<p>ä¸¾ä¸ªæ —å­ï¼š<code>toRefs</code> æœ€å¸¸è§çš„åœºæ™¯æ˜¯<strong>åœ¨ <code>setup</code> å‡½æ•°ä¸­è¿”å›å“åº”å¼å¯¹è±¡æ—¶</strong>ï¼Œå…è®¸ä½ åœ¨æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨å±æ€§ï¼Œæˆ–è€…åœ¨è§£æ„æ—¶ä¿æŒå“åº”æ€§ã€‚</p>
</blockquote>
<ul>
<li><code>setup</code> ä¸­è¿”å›å¯¹è±¡
å¦‚æœä½ ç›´æ¥è¿”å›ä¸€ä¸ª <code>reactive</code> å¯¹è±¡ï¼Œä½ å¿…é¡»åœ¨æ¨¡æ¿ä¸­ä»¥ <code>state.name</code> çš„æ–¹å¼è®¿é—®å®ƒã€‚</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { reactive, toRefs, toRef, toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> user = reactive&lt;<span class="hljs-title class_">User</span>&gt;({
  <span class="hljs-attr">name</span>: <span class="hljs-string">"YaeZed"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
});
<span class="hljs-comment">// å¦‚æœæƒ³ç›´æ¥ç»“æ„reactiveï¼Œä¼šä¸¢å¤±å“åº”æ€§</span>
<span class="hljs-keyword">const</span> { name, age } = user;

<span class="hljs-comment">// æ¨¡æ¿ä¸­: &lt;p&gt;{{ user.name }}&lt;/p&gt; &lt;p&gt;{{ user.age }}&lt;/p&gt;</span>
</code></pre>
<p>ä½¿ç”¨ <code>toRefs</code>ï¼Œä½ å¯ä»¥"å±•å¼€" (spread) è¿™ä¸ªå¯¹è±¡ï¼Œä½¿å…¶å±æ€§åœ¨æ¨¡æ¿ä¸­é¡¶å±‚å¯ç”¨ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { reactive, toRefs, toRef, toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> user = reactive&lt;<span class="hljs-title class_">User</span>&gt;({
  <span class="hljs-attr">name</span>: <span class="hljs-string">"YaeZed"</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
});
<span class="hljs-comment">// ä½¿ç”¨ toRefs è§£æ„ï¼Œå°†æ‰€æœ‰å±æ€§è½¬æ¢ä¸ºref</span>
<span class="hljs-keyword">const</span> { name, age } = <span class="hljs-title function_">toRefs</span>(user);

<span class="hljs-comment">// æ¨¡æ¿ä¸­: &lt;p&gt;{{ name }}&lt;/p&gt; &lt;p&gt;{{ age }}&lt;/p&gt;</span>
<span class="hljs-comment">// (æ¨¡æ¿ä¼šè‡ªåŠ¨è§£åŒ… .value)</span>
</code></pre>
<ul>
<li>è§£æ„ <code>reactive</code> å¯¹è±¡
ä¸ <code>toRef</code> ç±»ä¼¼ï¼Œå¦‚æœä½ æƒ³è§£æ„ä¸€ä¸ª <code>reactive</code> å¯¹è±¡åŒæ—¶ä¿æŒå“åº”æ€§ï¼Œå¿…é¡»ä½¿ç”¨ <code>toRefs</code>ã€‚</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { reactive, toRefs, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">y</span>: <span class="hljs-number">2</span>,
});

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šä¸¢å¤±å“åº”æ€§</span>
<span class="hljs-comment">// const { x, y } = state; </span>
<span class="hljs-comment">// x å’Œ y åªæ˜¯æ•°å­— 1 å’Œ 2</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ toRefs</span>
<span class="hljs-keyword">const</span> { x, y } = <span class="hljs-title function_">toRefs</span>(state);
<span class="hljs-comment">// x å’Œ y ç°åœ¨æ˜¯ Ref&lt;number&gt;</span>

<span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`x: <span class="hljs-subst">${x.value}</span>, y: <span class="hljs-subst">${y.value}</span>`</span>);
});

<span class="hljs-comment">// ä¿®æ”¹ state ä¼šè§¦å‘ watchEffect</span>
state.<span class="hljs-property">x</span> = <span class="hljs-number">10</span>;
</code></pre>
<h2 data-id="heading-2">3.toRaw</h2>
<p><code>toRaw</code> ç”¨äºä» Vue çš„<strong>å“åº”å¼ä»£ç† (Proxy)</strong> ä¸­è·å–<strong>åŸå§‹çš„ã€éå“åº”å¼çš„ç›®æ ‡å¯¹è±¡</strong>ã€‚</p>
<p><code>toRaw</code> æ¥æ”¶ä¸€ä¸ªç”± <code>reactive</code> æˆ– <code>readonly</code> åˆ›å»ºçš„ä»£ç†ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { reactive, toRaw, isReactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Data</span> {
  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Data</span> = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> };
<span class="hljs-keyword">const</span> state = reactive&lt;<span class="hljs-title class_">Data</span>&gt;(data);

<span class="hljs-comment">// 1. è·å–åŸå§‹å¯¹è±¡</span>
<span class="hljs-keyword">const</span> rawData = <span class="hljs-title function_">toRaw</span>(state);

<span class="hljs-comment">// 2. éªŒè¯</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isReactive</span>(state)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isReactive</span>(rawData)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 3. æ¯”è¾ƒ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(rawData === data); <span class="hljs-comment">// true (å®ƒä»¬æ˜¯åŒä¸€ä¸ªåŸå§‹å¯¹è±¡)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state === data); <span class="hljs-comment">// false (state æ˜¯ä¸€ä¸ª Proxy)</span>

<span class="hljs-comment">// 4. ä¿®æ”¹</span>
<span class="hljs-comment">// ä¿®æ”¹åŸå§‹å¯¹è±¡ (raw) ä»ç„¶ä¼šé€šè¿‡å¼•ç”¨æ”¹å˜ä»£ç†å¯¹è±¡ (state)</span>
rawData.<span class="hljs-property">count</span> = <span class="hljs-number">1</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state.<span class="hljs-property">count</span>); <span class="hljs-comment">// 1</span>

<span class="hljs-comment">// **å…³é”®åŒºåˆ«**:</span>
<span class="hljs-comment">// é€šè¿‡ rawData ä¿®æ”¹å±æ€§ *ä¸ä¼š* è§¦å‘ Vue çš„å“åº”å¼ç³»ç»Ÿ</span>
<span class="hljs-comment">// (ä¾‹å¦‚ï¼Œä¾èµ– state.count çš„ watcher ä¸ä¼šè¿è¡Œï¼Œç»„ä»¶ä¹Ÿä¸ä¼šé‡æ–°æ¸²æŸ“)</span>

<span class="hljs-comment">// åªæœ‰é€šè¿‡ state (ä»£ç†) ä¿®æ”¹æ‰ä¼šè§¦å‘æ›´æ–°</span>
state.<span class="hljs-property">count</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// è¿™å°†è§¦å‘æ›´æ–°</span>
</code></pre>
<blockquote>
<p><code>toRaw</code> åº”è¯¥<strong>è°¨æ…ä½¿ç”¨</strong>ï¼Œå› ä¸ºå®ƒä¼šè„±ç¦» Vue çš„å“åº”å¼è¿½è¸ªã€‚</p>
</blockquote>
<ul>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ– (ä¸´æ—¶è¯»å–)</strong> : å½“ä½ éœ€è¦è¯»å– <code>reactive</code> å¯¹è±¡çš„æ•°æ®ï¼Œä½†ä½ <strong>ç¡®å®š</strong>è¿™ä¸ªè¯»å–æ“ä½œä¸éœ€è¦è¢«è¿½è¸ªï¼ˆå³ä¸å¸Œæœ›å®ƒè§¦å‘ <code>watchEffect</code> æˆ–ç»„ä»¶æ›´æ–°ï¼‰æ—¶ã€‚</p>
</li>
<li>
<p><strong>ä¼ é€’ç»™å¤–éƒ¨åº“</strong>: æŸäº›ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚å›¾è¡¨åº“ï¼‰å¯èƒ½ä¸åº”è¯¥æ¥æ”¶ Vue çš„ Proxy å¯¹è±¡ã€‚å®ƒä»¬å¯èƒ½è¯•å›¾ç›´æ¥ä¿®æ”¹å¯¹è±¡ï¼Œæˆ–è€… Vue çš„ä»£ç†å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–æ„å¤–è¡Œä¸ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>toRaw</code> ä¼ é€’åŸå§‹æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>è°ƒè¯•</strong>: åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ£€æŸ¥ä¸€ä¸ª <code>reactive</code> å¯¹è±¡æ—¶ï¼Œå®ƒä¼šè¢«æ˜¾ç¤ºä¸º <code>Proxy</code>ã€‚ä½¿ç”¨ <code>toRaw(state)</code> å¯ä»¥è®©ä½ çœ‹åˆ°å®ƒèƒŒåçš„åŸå§‹æ•°æ®ç»“æ„ã€‚</p>
</li>
</ul>
<h2 data-id="heading-3">4.æ€»ç»“</h2>

































<table><thead><tr><th align="center">API</th><th align="center">è¾“å…¥</th><th align="center">è¾“å‡º</th><th align="center">æ ¸å¿ƒç‰¹ç‚¹</th><th align="center">ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td align="center"><code>toRef</code></td><td align="center"><code>reactive</code> å¯¹è±¡, å±æ€§å (key)</td><td align="center">å•ä¸ª <code>Ref</code></td><td align="center"><code>ref.value</code> ä¸ <code>state.key</code> åŒå‘åŒæ­¥</td><td align="center">ä¼ é€’ <code>props</code> ç»™ç»„åˆå¼å‡½æ•°ï¼Œä¿æŒå¯¹å•ä¸ª <code>prop</code> çš„å“åº”æ€§</td></tr><tr><td align="center"><code>toRefs</code></td><td align="center"><code>reactive</code> å¯¹è±¡</td><td align="center">åŒ…å«å¤šä¸ª <code>Ref</code> çš„æ–°å¯¹è±¡</td><td align="center"><code>state</code> çš„æ‰€æœ‰å±æ€§éƒ½å˜ä¸º <code>Ref</code></td><td align="center">è§£æ„ <code>reactive</code> å¯¹è±¡æ—¶ä¿æŒå“åº”æ€§</td></tr><tr><td align="center"><code>toRaw</code></td><td align="center"><code>reactive</code> ä»£ç†å¯¹è±¡</td><td align="center">åŸå§‹çš„ã€éå“åº”å¼å¯¹è±¡</td><td align="center">ç»•è¿‡å“åº”å¼è¿½è¸ªçš„åŸç”Ÿå¯¹è±¡</td><td align="center">æ€§èƒ½ä¼˜åŒ–ï¼ˆé¿å…è¿½è¸ªï¼‰ï¼Œä¼ é€’æ•°æ®ç»™å¤–éƒ¨åº“</td></tr></tbody></table>
<p><code>å‚è€ƒæ–‡ç« </code></p>
<p>å°æ»¡zs å­¦ä¹ Vue3 ç¬¬å…«ç« ï¼ˆè®¤è¯†toç³»åˆ—å…¨å®¶æ¡¶ï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fxiaoman.blog.csdn.net%2Farticle%2Fdetails%2F122791665" target="_blank" title="https://xiaoman.blog.csdn.net/article/details/122791665" ref="nofollow noopener noreferrer">xiaoman.blog.csdn.net/article/detâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WHM-PFï¼šä¼˜åŒ–ç¿»é¡µä½“éªŒçš„é«˜æ€§èƒ½Reactç¿»é¡µæ’ä»¶]]></title>    <link>https://juejin.cn/post/7575102209606533146</link>    <guid>https://juejin.cn/post/7575102209606533146</guid>    <pubDate>2025-11-23T12:37:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575102209606533146" data-draft-id="7575182522411499558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WHM-PFï¼šä¼˜åŒ–ç¿»é¡µä½“éªŒçš„é«˜æ€§èƒ½Reactç¿»é¡µæ’ä»¶"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2025-11-23T12:37:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘å¾ˆå¿™65"/> <meta itemprop="url" content="https://juejin.cn/user/872334419564842"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WHM-PFï¼šä¼˜åŒ–ç¿»é¡µä½“éªŒçš„é«˜æ€§èƒ½Reactç¿»é¡µæ’ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/872334419564842/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘å¾ˆå¿™65
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T12:37:04.000Z" title="Sun Nov 23 2025 12:37:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ•°å­—é˜…è¯»å’Œåœ¨çº¿æ–‡æ¡£åœºæ™¯ä¸­ï¼Œæµç•…è‡ªç„¶çš„ç¿»é¡µæ•ˆæœèƒ½æå¤§æå‡ç”¨æˆ·ä½“éªŒã€‚ä»Šå¤©ä»‹ç»ä¸€æ¬¾åŸºäºPageFlipäºŒæ¬¡å¼€å‘çš„ç¿»é¡µæ’ä»¶â€”â€”WHM-PFï¼Œå®ƒè§£å†³äº†åŸç‰ˆPageFlipçš„è¯¸å¤šç—›ç‚¹ï¼Œæä¾›äº†æ›´ä¼˜ç§€çš„ç¿»é¡µè§£å†³æ–¹æ¡ˆã€‚æ’ä»¶åœ°å€<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fwhm-pf" target="_blank" title="https://www.npmjs.com/package/whm-pf" ref="nofollow noopener noreferrer">www.npmjs.com/package/whmâ€¦</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41516b558d5b4b93a47d82d0214138eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5b6I5b-ZNjU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764506223&amp;x-signature=HyXanfrTEajDQdwBmdd7EjesDMg%3D" alt="video.gif" loading="lazy"/></p>
<h3 data-id="heading-0">åŸç‰ˆPageFlipçš„åŸºæœ¬ä½¿ç”¨</h3>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹åŸç‰ˆPageFlipæ’ä»¶çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;div id=<span class="hljs-string">"book"</span>&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-page"</span> <span class="hljs-attr">data-density</span>=<span class="hljs-string">"hard"</span>&gt;</span>
        Page Cover
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-page"</span>&gt;</span>
        Page one
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-page"</span>&gt;</span>
        Page two
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-page"</span>&gt;</span>
        Page three
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-page"</span>&gt;</span>
        Page four
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-page"</span> <span class="hljs-attr">data-density</span>=<span class="hljs-string">"hard"</span>&gt;</span>
        Last page
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/div&gt;
<span class="hljs-keyword">const</span> pageFlip = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PageFlip</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'book'</span>), {
    <span class="hljs-attr">width</span>: <span class="hljs-number">400</span>, <span class="hljs-comment">// required parameter - base page width</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>, <span class="hljs-comment">// required parameter - base page height</span>
});

pageFlip.<span class="hljs-title function_">loadFromHTML</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.my-page'</span>));
</code></pre>
<p>é€šè¿‡ç®€å•çš„é…ç½®ï¼ŒPageFlipå°±èƒ½å®ç°ç²¾ç¾çš„ç¿»é¡µæ•ˆæœï¼Œè¿™ç¡®å®æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç¿»é¡µè§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œåœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å‘ç°PageFlipå­˜åœ¨ä¸€äº›å±€é™æ€§ï¼š</p>
<ol>
<li>ç¿»é¡µè§¦å‘åŒºåŸŸå›ºå®šï¼Œåªèƒ½ä»é¡µé¢å·¦ä¸Šè§’æˆ–å³ä¸Šè§’è§¦å‘</li>
<li>ä¸æ”¯æŒå†…å®¹è‡ªåŠ¨æ¢è¡Œï¼Œéœ€è¦æ‰‹åŠ¨è®¡ç®—å’Œè°ƒæ•´</li>
<li>å›¾ç‰‡å¤„ç†èƒ½åŠ›æœ‰é™ï¼Œç‰¹åˆ«æ˜¯åœ¨æŠ¥å‘Šç±»é¡µé¢ä¸­è¡¨ç°ä¸ä½³</li>
<li>ç¼ºä¹å›¾ç‰‡æ‡’åŠ è½½æœºåˆ¶ï¼Œå¤§é‡å›¾ç‰‡æ—¶æ€§èƒ½å ªå¿§</li>
</ol>
<p>åŸºäºè¿™äº›ç—›ç‚¹ï¼Œæˆ‘ä»¬æŸ¥é˜…äº†PageFlipçš„æºç ï¼Œå¹¶è¿›è¡Œäº†äºŒæ¬¡å¼€å‘ï¼Œæ¨å‡ºäº†WHM-PFæ’ä»¶ã€‚</p>
<h3 data-id="heading-1">WHM-PFçš„æ ¸å¿ƒä¼˜åŠ¿</h3>
<h4 data-id="heading-2">1. å…¨å±ä»»æ„ä½ç½®è§¦å‘ç¿»é¡µ</h4>
<p>WHM-PFæ‰“ç ´äº†åŸç‰ˆPageFlipçš„è§¦å‘åŒºåŸŸé™åˆ¶ï¼Œç”¨æˆ·å¯ä»¥ä»å±å¹•ä»»ä½•ä½ç½®è¿›è¡Œç¿»é¡µæ“ä½œï¼Œæ›´ç¬¦åˆçœŸå®é˜…è¯»ä½“éªŒï¼š</p>
<ul>
<li>å·¦ä¾§ä»»æ„ä½ç½®å‘å³æ»‘åŠ¨ â†’ å‘å‰ç¿»é¡µ</li>
<li>å³ä¾§ä»»æ„ä½ç½®å‘å·¦æ»‘åŠ¨ â†’ å‘åç¿»é¡µ</li>
</ul>
<p>è¿™ç§è®¾è®¡è®©ç”¨æˆ·æ— éœ€ç²¾ç¡®å¯»æ‰¾è§¦å‘ç‚¹ï¼Œå¤§å¤§æå‡äº†æ“ä½œä¾¿æ·æ€§ã€‚</p>
<h4 data-id="heading-3">2. æ™ºèƒ½å†…å®¹è‡ªåŠ¨æ¢è¡Œ</h4>
<p>WHM-PFå¼•å…¥äº†æ™ºèƒ½å†…å®¹å¤„ç†æœºåˆ¶ï¼š</p>
<ul>
<li>è‡ªåŠ¨æ£€æµ‹å†…å®¹å°ºå¯¸å¹¶é€‚é…é¡µé¢</li>
<li>æ”¯æŒæ–‡æœ¬å†…å®¹è‡ªåŠ¨æ¢è¡Œï¼Œæ— éœ€æ‰‹åŠ¨è°ƒæ•´</li>
<li>è‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸å’Œè®¾å¤‡æ–¹å‘</li>
</ul>
<h4 data-id="heading-4">3. å¼ºå¤§çš„å›¾ç‰‡å¤„ç†èƒ½åŠ›</h4>
<p>é’ˆå¯¹æŠ¥å‘Šç±»é¡µé¢å’Œå›¾æ–‡æ··æ’åœºæ™¯ï¼ŒWHM-PFæä¾›äº†ï¼š</p>
<ul>
<li>åŸç”Ÿå›¾ç‰‡ç¿»é¡µæ”¯æŒ</li>
<li>è‡ªåŠ¨å›¾ç‰‡æ‡’åŠ è½½æœºåˆ¶ï¼Œæå‡å¤§é‡å›¾ç‰‡åœºæ™¯ä¸‹çš„æ€§èƒ½</li>
<li>å›¾ç‰‡é¢„åŠ è½½å’Œç¼“å­˜ç­–ç•¥ï¼Œç¡®ä¿ç¿»é¡µæµç•…æ€§</li>
</ul>
<h4 data-id="heading-5">4. é›¶é…ç½®ä¸Šæ‰‹ä½“éªŒ</h4>
<p>WHM-PFä¿ç•™äº†PageFlipçš„ç®€æ´APIè®¾è®¡ï¼ŒåŒæ—¶æä¾›äº†æ›´æ™ºèƒ½çš„é»˜è®¤é…ç½®ï¼š</p>
<p>javascript</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ä½¿ç”¨WHM-PFï¼Œæ— éœ€å¤æ‚é…ç½®å³å¯è·å¾—ä¼˜ç§€ä½“éªŒ</span>
<span class="hljs-keyword">const</span> pageFlip = <span class="hljs-keyword">new</span> WHMPageFlip(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'book'</span>));
pageFlip.loadFromHTML(<span class="hljs-built_in">document</span>.<span class="hljs-built_in">querySelectorAll</span>(<span class="hljs-string">'.my-page'</span>));
</code></pre>
<h3 data-id="heading-6">å®é™…åº”ç”¨åœºæ™¯</h3>
<p>WHM-PFç‰¹åˆ«é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>ç”µå­ä¹¦å’Œåœ¨çº¿å°è¯´é˜…è¯»å™¨</li>
<li>ä¼ä¸šæŠ¥å‘Šå’Œäº§å“æ‰‹å†Œå±•ç¤º</li>
<li>æ•°å­—æ‚å¿—å’ŒæœŸåˆŠé˜…è¯»</li>
<li>äº¤äº’å¼æ•™è‚²ææ–™</li>
</ul>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>WHM-PFåœ¨ä¿ç•™PageFlipä¼˜ç§€ç¿»é¡µæ•ˆæœçš„åŸºç¡€ä¸Šï¼Œè§£å†³äº†å®é™…åº”ç”¨ä¸­çš„ç—›ç‚¹é—®é¢˜ï¼Œæä¾›äº†æ›´è‡ªç„¶ã€æ›´ä¾¿æ·çš„ç¿»é¡µä½“éªŒã€‚æ— è®ºæ˜¯ä»äº¤äº’è®¾è®¡è¿˜æ˜¯æ€§èƒ½ä¼˜åŒ–è§’åº¦ï¼ŒWHM-PFéƒ½å±•ç°å‡ºäº†æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Viteçš„çŸ¥è¯†ç‚¹]]></title>    <link>https://juejin.cn/post/7575442779039399978</link>    <guid>https://juejin.cn/post/7575442779039399978</guid>    <pubDate>2025-11-23T13:21:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575442779039399978" data-draft-id="7575468252656042025" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Viteçš„çŸ¥è¯†ç‚¹"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-23T13:21:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¢å‘divç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2195088949385101"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Viteçš„çŸ¥è¯†ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2195088949385101/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¢å‘divç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:21:44.000Z" title="Sun Nov 23 2025 13:21:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ·±å…¥æµ…å‡º Viteï¼šä»åŒå¼•æ“æ¶æ„åˆ°æ’ä»¶æµæ°´çº¿å…¨è§£</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>ä½œä¸ºä¸€ä¸ªå‰ç«¯å¼€å‘è€…ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨ç”¨ Viteï¼Œä½†ä½ çœŸçš„äº†è§£å®ƒåœ¨ <code>npm run dev</code> å’Œ <code>npm run build</code> æ—¶åˆ°åº•å¹²äº†ä»€ä¹ˆå—ï¼Ÿä¸ºä»€ä¹ˆå¼€å‘ç¯å¢ƒé‚£ä¹ˆå¿«ï¼Ÿç”Ÿäº§ç¯å¢ƒåˆä¸ºä»€ä¹ˆè¦æ¢ç”¨ Rollupï¼Ÿæ’ä»¶é’©å­åˆ°åº•åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ</p>
<p>æœ¬æ–‡å°†å¸¦ä½ åƒå‰¥æ´‹è‘±ä¸€æ ·ï¼Œä¸€å±‚å±‚æ­å¼€ Vite çš„åº•å±‚åŸç†ï¼Œä»æ¶æ„è®¾è®¡åˆ°æ’ä»¶å¼€å‘å®æˆ˜ï¼Œå½»åº•ææ‡‚è¿™ä¸ªç°ä»£å‰ç«¯æ„å»ºå·¥å…·ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€ Vite çš„æ ¸å¿ƒæ¶æ„ï¼šç‹¬ç‰¹çš„â€œåŒå¼•æ“â€</h3>
<p>Vite ä¹‹æ‰€ä»¥èƒ½å…¼é¡¾<strong>æè‡´çš„å¼€å‘ä½“éªŒ</strong>å’Œ<strong>ç¨³å®šçš„ç”Ÿäº§äº§ç‰©</strong>ï¼Œæ˜¯å› ä¸ºå®ƒé‡‡ç”¨äº†ä¸€å¥—â€œç²¾ç¥åˆ†è£‚â€èˆ¬çš„åŒå¼•æ“æ¶æ„ã€‚</p>
<h4 data-id="heading-3">1. å¼€å‘ç¯å¢ƒ (Dev)ï¼šEsbuild + Native ESM</h4>
<ul>
<li><strong>æ ¸å¿ƒç­–ç•¥</strong>ï¼š<strong>No-Bundleï¼ˆä¸æ‰“åŒ…ï¼‰</strong>ã€‚</li>
<li><strong>Esbuild çš„è§’è‰²</strong>ï¼š
<ul>
<li><strong>ä¾èµ–é¢„æ„å»º</strong>ï¼šå¯åŠ¨æ—¶æ‰«æ <code>package.json</code>ï¼Œç”¨ Esbuild å°† CommonJS ä¾èµ–è½¬æ¢ä¸º ESMï¼Œå¹¶æ‰“åŒ…æˆå•ä¸€æ–‡ä»¶ï¼ˆç¼“å­˜åˆ° <code>node_modules/.vite</code>ï¼‰ã€‚</li>
<li><strong>å•æ–‡ä»¶ç¼–è¯‘</strong>ï¼šå°† TS/JSX ç¬é—´ç¼–è¯‘ä¸º JSï¼ˆåªæŠ¹é™¤ç±»å‹ï¼Œä¸è¿›è¡Œç±»å‹æ£€æŸ¥ï¼‰ï¼Œé€Ÿåº¦æ˜¯ TS å®˜æ–¹ç¼–è¯‘å™¨çš„ 10-100 å€ã€‚</li>
</ul>
</li>
<li><strong>å·¥ä½œæµ</strong>ï¼š
<ul>
<li>åˆ©ç”¨æµè§ˆå™¨åŸç”Ÿçš„ ES Modules èƒ½åŠ›ã€‚</li>
<li><strong>æŒ‰éœ€ç¼–è¯‘</strong>ï¼šæµè§ˆå™¨è¯·æ±‚ä»€ä¹ˆæ–‡ä»¶ï¼ŒVite æœåŠ¡å™¨æ‰æ‹¦æˆªã€ç¼–è¯‘ã€è¿”å›ä»€ä¹ˆæ–‡ä»¶ã€‚è·¯ç”±ä¸è®¿é—®ï¼Œä»£ç å°±ä¸ç¼–è¯‘ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">2. ç”Ÿäº§ç¯å¢ƒ (Build)ï¼šRollup + Esbuild</h4>
<ul>
<li><strong>æ ¸å¿ƒç­–ç•¥</strong>ï¼š<strong>Bundleï¼ˆå…¨é‡æ‰“åŒ…ï¼‰</strong>ã€‚</li>
<li><strong>Rollup çš„è§’è‰²</strong>ï¼šè´Ÿè´£æ ¸å¿ƒæ‰“åŒ…é€»è¾‘ã€‚æä¾›å¼ºå¤§çš„ Tree-Shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰ã€Code Splittingï¼ˆä»£ç åˆ†å‰²ï¼‰å’Œæˆç†Ÿçš„æ’ä»¶ç”Ÿæ€ã€‚</li>
<li><strong>Esbuild çš„è§’è‰²</strong>ï¼šåœ¨æ‰“åŒ…çš„æœ€åé˜¶æ®µï¼Œæ›¿ä»£ Terser è¿›è¡Œ <strong>Minificationï¼ˆä»£ç å‹ç¼©ï¼‰</strong>ï¼Œæ•ˆç‡æå¤§æå‡ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€ æ’ä»¶ç³»ç»Ÿï¼šVite çš„çµé­‚</h3>
<p>Vite çš„æ’ä»¶ç³»ç»Ÿæ˜¯ <strong>Rollup æ’ä»¶æ¥å£çš„è¶…é›†</strong>ã€‚è¿™æ„å‘³ç€ Vite åœ¨å¼€å‘ç¯å¢ƒ<strong>æ¨¡æ‹Ÿ</strong>äº†ä¸€ä¸ª Rollup çš„æ‰§è¡Œç¯å¢ƒï¼ˆPluginContainerï¼‰ï¼Œè€Œåœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥è°ƒç”¨ Rollupã€‚</p>
<h4 data-id="heading-6">1. é’©å­çš„æ‰§è¡Œé˜¶æ®µ</h4>
<p>æˆ‘ä»¬å°†æ’ä»¶çš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š<strong>å‡†å¤‡é˜¶æ®µ</strong>ã€<strong>é€šç”¨æ„å»ºé˜¶æ®µ</strong>ã€<strong>è¾“å‡ºé˜¶æ®µ</strong>ã€‚</p>
<h5 data-id="heading-7">ğŸŸ¢ ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡ä¸é…ç½® (Setup)</h5>
<p>è¿™æ˜¯æœåŠ¡å™¨å¯åŠ¨æˆ–æ„å»ºå¼€å§‹å‰çš„å‡†å¤‡å·¥ä½œã€‚</p>






























<table><thead><tr><th align="left">é’©å­</th><th align="left">æ¥æº</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>config</code></td><td align="left">Vite</td><td align="left"><strong>ä¿®æ”¹é…ç½®</strong>ã€‚å…·æœ‰â€œæ»šé›ªçƒâ€ç‰¹æ€§ï¼Œä¸Šä¸€ä¸ªæ’ä»¶ä¿®æ”¹çš„é…ç½®ä¼šä¼ ç»™ä¸‹ä¸€ä¸ªã€‚</td></tr><tr><td align="left"><code>configResolved</code></td><td align="left">Vite</td><td align="left"><strong>è¯»å–é…ç½®</strong>ã€‚é…ç½®å·²å†»ç»“ï¼Œåªè¯»ï¼Œç”¨äºè®°å½•æœ€ç»ˆé…ç½®ã€‚</td></tr><tr><td align="left"><code>configureServer</code></td><td align="left">Vite</td><td align="left"><strong>Dev ç‹¬æœ‰</strong>ã€‚ç”¨äºæ³¨å†Œ Dev Server çš„ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ã€‚</td></tr><tr><td align="left"><code>buildStart</code></td><td align="left">Rollup</td><td align="left"><strong>æ„å»ºå¼€å§‹</strong>ã€‚åˆå§‹åŒ–å·¥ä½œï¼Œå¦‚æ‰“å° Logã€‚</td></tr></tbody></table>
<h5 data-id="heading-8">ğŸ”µ ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒç¼–è¯‘ (The Loop)</h5>
<p>è¿™æ˜¯æœ€ç¹å¿™çš„é˜¶æ®µã€‚<strong>æ¯ä¸ªæ–‡ä»¶</strong>è¢«å¼•å…¥æ—¶éƒ½ä¼šå®Œæ•´èµ°ä¸€éè¿™ä¸ªæµç¨‹ã€‚</p>

























<table><thead><tr><th align="left">é’©å­</th><th align="left">æ¥æº</th><th align="left">ä½œç”¨ä¸å‚æ•°</th></tr></thead><tbody><tr><td align="left"><code>resolveId(source, importer)</code></td><td align="left">Rollup</td><td align="left"><strong>æ‰¾æ–‡ä»¶</strong>ã€‚æ‹¦æˆª import è·¯å¾„ï¼Œå‘Šè¯‰ Vite æ–‡ä»¶åœ¨å“ªï¼ˆæˆ–å¤„ç†è™šæ‹Ÿæ¨¡å—ï¼‰ã€‚</td></tr><tr><td align="left"><code>load(id)</code></td><td align="left">Rollup</td><td align="left"><strong>è¯»æ–‡ä»¶</strong>ã€‚åŠ è½½æºä»£ç ã€‚å¦‚æœè¿”å› nullï¼Œåˆ™è¯»å–ç¡¬ç›˜æ–‡ä»¶ã€‚</td></tr><tr><td align="left"><code>transform(code, id)</code></td><td align="left">Rollup</td><td align="left"><strong>æ”¹ä»£ç </strong>ã€‚æ ¸å¿ƒé’©å­ã€‚TSè½¬JSã€Vueæ¨¡ç‰ˆç¼–è¯‘ã€æ­£åˆ™æ›¿æ¢éƒ½åœ¨è¿™é‡Œã€‚</td></tr></tbody></table>
<p><strong>Dev ä¸ Build çš„å·¨å¤§å·®å¼‚ï¼š</strong></p>
<ul>
<li><strong>Dev (æŒ‰éœ€)</strong>ï¼šæµè§ˆå™¨è¯·æ±‚ä¸€æ¬¡ï¼Œæ‰§è¡Œä¸€æ¬¡ã€‚æœ‰ç¼“å­˜æœºåˆ¶ã€‚</li>
<li><strong>Build (å…¨é‡)</strong>ï¼šä»å…¥å£æ–‡ä»¶å¼€å§‹é€’å½’åˆ†æä¾èµ–å›¾ï¼Œä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰å…³è”æ–‡ä»¶ã€‚</li>
</ul>
<h5 data-id="heading-9">ğŸ”´ ç¬¬ä¸‰é˜¶æ®µï¼šäº§ç‰©è¾“å‡º (Output Generation)</h5>
<p>âš ï¸ <strong>æ³¨æ„ï¼šè¿™äº›é’©å­åªåœ¨ <code>npm run build</code> ç”Ÿäº§æ‰“åŒ…æ—¶æ‰§è¡Œï¼</strong></p>

























<table><thead><tr><th align="left">é’©å­</th><th align="left">æ¥æº</th><th align="left">ä½œç”¨ä¸åœºæ™¯</th></tr></thead><tbody><tr><td align="left"><code>renderChunk(code, chunk)</code></td><td align="left">Rollup</td><td align="left"><strong>ç²¾ä¿®ä»£ç </strong>ã€‚æ­¤æ—¶ä»£ç å·²åˆå¹¶ã€Tree-shaking å·²å®Œæˆã€‚ç”¨äºä»£ç å‹ç¼©ã€æ·»åŠ  Bannerã€‚</td></tr><tr><td align="left"><code>generateBundle(options, bundle)</code></td><td align="left">Rollup</td><td align="left"><strong>ç®¡ç†æ–‡ä»¶</strong>ã€‚<code>bundle</code> å¯¹è±¡åŒ…å«æ‰€æœ‰å°†è¦ç”Ÿæˆçš„æ–‡ä»¶ã€‚ç”¨äºç”Ÿæˆ Manifestã€åˆ é™¤æ–‡ä»¶ã€åˆ†æä½“ç§¯ã€‚</td></tr><tr><td align="left"><code>closeBundle</code></td><td align="left">Rollup</td><td align="left"><strong>æ”¶å°¾</strong>ã€‚æ–‡ä»¶å†™å…¥ç¡¬ç›˜åè§¦å‘ã€‚ç”¨äºæ¸…ç†ç¼“å­˜ã€ä¸Šä¼  CDNã€‚</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">ä¸‰ã€ æ·±å…¥è§£æï¼šæ„å»ºä¸­çš„å…³é”®æ¦‚å¿µ</h3>
<h4 data-id="heading-11">1. RenderChunk vs Transform</h4>
<ul>
<li><strong>Transform</strong>ï¼šæ˜¯åœ¨<strong>åšé›¶ä»¶</strong>ã€‚å¤„ç†çš„æ˜¯æºç ï¼ˆTS/Vueï¼‰ï¼Œæ­¤æ—¶æ–‡ä»¶ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚</li>
<li><strong>RenderChunk</strong>ï¼šæ˜¯åœ¨<strong>æ‹¼ä¹é«˜</strong>ã€‚æ­¤æ—¶æ¨¡å—å·²ç»è¢«åˆå¹¶æˆ Chunkï¼ˆJS æ–‡ä»¶ï¼‰ï¼Œ<code>import</code> è¯­å¥å·²è¢«æ‹å¹³ã€‚</li>
</ul>
<h4 data-id="heading-12">2. ä»£ç åˆ†å‰² (Code Splitting)</h4>
<p>ä¸ºä»€ä¹ˆä¸€ä¸ªå…¥å£ (<code>main.ts</code>) ä¼šæ‰“åŒ…å‡ºå¤šä¸ªæ–‡ä»¶ï¼Ÿ</p>
<ul>
<li><strong>Vendor Splitting</strong>ï¼šå°† <code>node_modules</code>ï¼ˆVue/Reactï¼‰æ‹†åˆ†ä¸ºå•ç‹¬çš„ Chunkã€‚åˆ©ç”¨æµè§ˆå™¨å¼ºç¼“å­˜ï¼Œä¸šåŠ¡ä»£ç æ›´æ–°ä¸å½±å“ç¬¬ä¸‰æ–¹åº“çš„ç¼“å­˜ã€‚</li>
<li><strong>Dynamic Import</strong>ï¼šä»£ç ä¸­å‡ºç° <code>import('./foo.vue')</code> æ—¶ï¼ŒVite ä¼šè‡ªåŠ¨å°†å…¶æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ Chunkï¼Œå®ç°è·¯ç”±æ‡’åŠ è½½ã€‚</li>
</ul>
<h4 data-id="heading-13">3. Hash (æ–‡ä»¶æŒ‡çº¹)</h4>
<p>æ–‡ä»¶åä¸­çš„ä¹±ç ï¼ˆå¦‚ <code>index.a1b2c3d.js</code>ï¼‰æ˜¯ä¸ºäº†<strong>é•¿æœŸç¼“å­˜</strong>ã€‚
åªè¦æ–‡ä»¶å†…å®¹å˜äº†ï¼ŒHash å¿…å˜ -&gt; URL å˜äº† -&gt; æµè§ˆå™¨é‡æ–°ä¸‹è½½ã€‚
å¦‚æœå†…å®¹æ²¡å˜ï¼ŒHash ä¸å˜ -&gt; URL ä¸å˜ -&gt; æµè§ˆå™¨ç›´æ¥è¯»æœ¬åœ°ç¼“å­˜ï¼ˆé€Ÿåº¦æå¿«ï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-14">å››ã€ å®æˆ˜ï¼šæ‰‹å†™ä¸€ä¸ªâ€œé—´è°æ’ä»¶â€</h3>
<p>æœ€å¥½çš„å­¦ä¹ æ–¹å¼æ˜¯æŠŠé’©å­æ‰“å°å‡ºæ¥ã€‚æŠŠè¿™æ®µä»£ç æ”¾å…¥ <code>vite.config.ts</code>ï¼Œä½ å°†çœ‹æ¸… Vite çš„äº”è„å…­è…‘ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite-plugin-spy.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">spyPlugin</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-spy'</span>,
    <span class="hljs-comment">// 1. ä¿®æ”¹é…ç½®é˜¶æ®µ</span>
    <span class="hljs-title function_">config</span>(<span class="hljs-params">config</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸŸ¢ [Config] é…ç½®å¼€å§‹åˆå¹¶...'</span>);
    },
    <span class="hljs-comment">// 2. æ ¸å¿ƒç¼–è¯‘é˜¶æ®µ</span>
    <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {
      <span class="hljs-keyword">if</span> (!id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ğŸ”µ [Transform] æ­£åœ¨è½¬æ¢: <span class="hljs-subst">${id.split(<span class="hljs-string">'/'</span>).pop()}</span>`</span>);
      }
    },
    <span class="hljs-comment">// 3. äº§ç‰©è¾“å‡ºé˜¶æ®µ (ä»… Build ç”Ÿæ•ˆ)</span>
    <span class="hljs-title function_">renderChunk</span>(<span class="hljs-params">code, chunk</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ğŸ”´ [RenderChunk] ç”Ÿæˆæ–‡ä»¶: <span class="hljs-subst">${chunk.fileName}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   - åŒ…å«æ¨¡å—: <span class="hljs-subst">${<span class="hljs-built_in">Object</span>.keys(chunk.modules).length}</span> ä¸ª`</span>);
    },
    <span class="hljs-title function_">generateBundle</span>(<span class="hljs-params">options, bundle</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ“¦ [GenerateBundle] æœ€ç»ˆäº§ç‰©æ¸…å•:'</span>);
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(bundle).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   ğŸ“„ <span class="hljs-subst">${file}</span>`</span>));
    }
  };
}
</code></pre>
<hr/>
<h3 data-id="heading-15">äº”ã€ å¸¸è§é¢è¯•/ç–‘éš¾é—®é¢˜è§£ç­”</h3>
<p><strong>Q1: ä¸ºä»€ä¹ˆå¼€å‘ç¯å¢ƒä¸ç”¨ Rollupï¼Ÿ</strong></p>
<blockquote>
<p>å› ä¸º Rollup å¿…é¡»å…ˆåˆ†æå®Œæ•´ä¸ªä¾èµ–å›¾æ‰èƒ½æ‰“åŒ…ï¼Œå¯åŠ¨æ…¢ã€‚Vite åˆ©ç”¨ Esbuild (Goè¯­è¨€) å’Œæµè§ˆå™¨åŸç”Ÿ ESMï¼Œå®ç°äº† O(1) çº§åˆ«çš„å¯åŠ¨é€Ÿåº¦ã€‚</p>
</blockquote>
<p><strong>Q2: æ’ä»¶é‡Œçš„ <code>config</code> é’©å­ä¼šè¢«è¦†ç›–å—ï¼Ÿ</strong></p>
<blockquote>
<p>ä¸ä¼šè¢«â€œè¦†ç›–â€ï¼Œè€Œæ˜¯è¢«â€œåˆå¹¶â€ã€‚Vite ä¼šæŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„ config é’©å­ï¼Œå¹¶å°†è¿”å›çš„é…ç½®å¯¹è±¡æ·±åº¦åˆå¹¶ã€‚</p>
</blockquote>
<p><strong>Q3: <code>generateBundle</code> å¯ä»¥ç”¨æ¥æ‹†åˆ†ä»£ç å—ï¼Ÿ</strong></p>
<blockquote>
<p>ä¸å¯ä»¥ã€‚æ‰§è¡Œåˆ° <code>generateBundle</code> æ—¶ï¼Œä»£ç æ‹†åˆ†ï¼ˆSplit Chunksï¼‰å·²ç»ç»“æŸäº†ã€‚è¿™é‡Œåªèƒ½å¯¹ç”Ÿæˆå¥½çš„æ–‡ä»¶åˆ—è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼ˆå¦‚åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶ï¼Œç”Ÿæˆèµ„æºæ¸…å•ï¼‰ã€‚</p>
</blockquote>
<p><strong>Q4: <code>renderChunk</code> é‡Œçš„ <code>code</code> å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<blockquote>
<p>æ˜¯ç»è¿‡ Tree-Shakingã€Scope Hoistingï¼ˆä½œç”¨åŸŸæå‡ï¼‰åˆå¹¶åçš„ JS å­—ç¬¦ä¸²ã€‚æ‰€æœ‰çš„ <code>import</code> æœ¬åœ°æ¨¡å—è¯­å¥éƒ½æ¶ˆå¤±äº†ï¼Œå˜æˆäº†å‡½æ•°å®šä¹‰ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">å…­ã€ æ€»ç»“å›¾è°±</h3>
<pre><code class="hljs language-scss" lang="scss">graph <span class="hljs-selector-tag">TD</span>
    <span class="hljs-built_in">Start</span>(npm run build) --&gt; Config<span class="hljs-selector-attr">[Config Hook: ä¿®æ”¹é…ç½®]</span>
    Config --&gt; Options<span class="hljs-selector-attr">[Options Hook: Rollupé…ç½®]</span>
    Options --&gt; BuildStart<span class="hljs-selector-attr">[BuildStart Hook]</span>
    
    subgraph Build_Phase <span class="hljs-selector-attr">[æ ¸å¿ƒç¼–è¯‘é˜¶æ®µ (é€’å½’)]</span>
        Resolve<span class="hljs-selector-attr">[ResolveId: æ‰¾è·¯å¾„]</span> --&gt; Load<span class="hljs-selector-attr">[Load: è¯»æºç ]</span>
        Load --&gt; <span class="hljs-attribute">Transform</span><span class="hljs-selector-attr">[Transform: æºç è½¬JS]</span>
    end
    
    BuildStart --&gt; Build_Phase
    
    subgraph Output_Phase <span class="hljs-selector-attr">[è¾“å‡ºé˜¶æ®µ]</span>
        RenderChunk<span class="hljs-selector-attr">[RenderChunk: å‹ç¼©/ç²¾ä¿®Chunk]</span> --&gt; GenerateBundle<span class="hljs-selector-attr">[GenerateBundle: äº§ç‰©æ¸…å•]</span>
        GenerateBundle --&gt; Write<span class="hljs-selector-attr">[å†™å…¥ç¡¬ç›˜ /dist]</span>
    end
    
    Build_Phase --&gt; Output_Phase
    Write --&gt; Close<span class="hljs-selector-attr">[CloseBundle: ç»“æŸ]</span>
</code></pre>
<hr/>
<p>å¸Œæœ›è¿™ç¯‡æ–‡æ¡£èƒ½å¸®åŠ©ä½ å’Œæ›´å¤šæ˜é‡‘çš„å°ä¼™ä¼´å½»åº•æŒæ¡ Vite çš„æ„å»ºåŸç†ï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ä¸€æ–‡çœ‹æ‡‚ç°ä»£Monorepoï¼ˆnpmï¼‰å·¥ç¨‹]]></title>    <link>https://juejin.cn/post/7575442779039432746</link>    <guid>https://juejin.cn/post/7575442779039432746</guid>    <pubDate>2025-11-23T13:35:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575442779039432746" data-draft-id="7575655132755574803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ä¸€æ–‡çœ‹æ‡‚ç°ä»£Monorepoï¼ˆnpmï¼‰å·¥ç¨‹"/> <meta itemprop="keywords" content="å‰ç«¯,NPM,å‰ç«¯å·¥ç¨‹åŒ–"/> <meta itemprop="datePublished" content="2025-11-23T13:35:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç–¯ç‹‚è¸©å‘äºº"/> <meta itemprop="url" content="https://juejin.cn/user/1011206430698574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€å‰ç«¯å·¥ç¨‹åŒ–ã€‘ä¸€æ–‡çœ‹æ‡‚ç°ä»£Monorepoï¼ˆnpmï¼‰å·¥ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1011206430698574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç–¯ç‹‚è¸©å‘äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:35:23.000Z" title="Sun Nov 23 2025 13:35:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å¼•è¨€ï¼šæœ¬æ–‡ä»‹ç»äº†ç›®å‰æµè¡Œçš„ <code>pnpm workspace</code> + <code>changesets</code> + <code>turborepo</code> æ„å»ºnpmåŒ…é¡¹ç›®çš„æ–¹æ¡ˆï¼Œè¿™å¥—æ–¹æ¡ˆä¹Ÿé€‚ç”¨äºå…¶ä»–å¤§å‹Monorepoé¡¹ç›®ã€‚æ­¤å¤–ï¼Œè¿˜è¡¥å……äº†å‰ç«¯å·¥ç¨‹ä¸‹<code>package.json</code>ã€<code>tsconfig</code>å’Œ<code>husky</code>ç­‰é…ç½®çŸ¥è¯†ä»¥åŠ<code>CI/CD</code>ç›¸å…³å¸¸è¯†ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€è®¤è¯†package.json</h2>
<p>ä¸€ä¸ªpackage.jsonä»£è¡¨äº†ä¸€ä¸ªé¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡npm/yarn/pnpmå‘½ä»¤åˆå§‹åŒ–ä¸€ä¸ª<code>package.json</code>:</p>
<pre><code class="hljs language-bash" lang="bash">pnpm init
</code></pre>
<p>ç„¶åè‡ªè¡Œå®Œå–„package.jsonã€‚ä¸‹é¢æˆ‘é€‰ä¸¾äº†å‡ ä¸ªè‘—ånpmåŒ…çš„<code>package.json</code>ä½œä¸ºå­¦ä¹ å‚è€ƒï¼Œå¹¶ä¸”é‡ç‚¹ä»‹ç»ä¸€äº›å­—æ®µå«ä¹‰æ¥å¸®æˆ‘ä»¬ç†è§£é¡¹ç›®ã€‚</p>
<p>1.æ¯”å¦‚ <code>vueuse</code>npmåŒ…çš„ <code>packages/shared/package.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vueuse/shared"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"14.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Anthony Fu &lt;https://github.com/antfu&gt;"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"funding"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://github.com/sponsors/antfu"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"homepage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://github.com/vueuse/vueuse/tree/main/packages/shared#readme"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"repository"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git+https://github.com/vueuse/vueuse.git"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"directory"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"packages/shared"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"bugs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://github.com/vueuse/vueuse/issues"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"vue"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"vue-use"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./*"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/*"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"unpkg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.iife.min.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"jsdelivr"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.iife.min.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/index.d.ts"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsdown"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prepack"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test:attw"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"attw --pack --config-path ../../.attw.json ."</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"peerDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.5.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>2.æ¯”å¦‚<code>ahooks</code>çš„<code>packages/hooks/package.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ahooks"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3.9.6"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"react hooks library"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"ahooks"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"umi hooks"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"react hooks"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/index.d.ts"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"unpkg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/ahooks.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"authors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brickspert"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"brickspert.fjl@alipay.com"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"publishConfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"registry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://registry.npmjs.org/"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"repository"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://github.com/alibaba/hooks"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"homepage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://github.com/alibaba/hooks"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gulp &amp;&amp; webpack-cli"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest run --color"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test:cov"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest run --color --coverage"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tsc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsc --noEmit"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"dist"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"lib"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"es"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"metadata.json"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"package.json"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"README.md"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"peerDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"gitHead"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"11f6ad571bd365c95ecb9409ca3050cbbfc9b34a"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>3.element-plusçš„<code>packages/element-plus/package.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"element-plus"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0-dev.1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A Component Library for Vue 3"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"element-plus"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"homepage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://element-plus.org/"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"bugs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://github.com/element-plus/element-plus/issues"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lib/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"es/index.mjs"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"es/index.d.ts"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/index.d.ts"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/index.mjs"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/index.js"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./global"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./global.d.ts"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./es"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/index.d.ts"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/index.mjs"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./lib"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/index.d.ts"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/index.js"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./es/*.mjs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/*.d.ts"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/*.mjs"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./es/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"./es/*.d.ts"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"./es/*/index.d.ts"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/*.mjs"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./lib/*.js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/*.d.ts"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/*.js"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./lib/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"./lib/*.d.ts"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"./lib/*/index.d.ts"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/*.js"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./*"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./*"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"unpkg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/index.full.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"jsdelivr"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/index.full.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"repository"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git+https://github.com/element-plus/element-plus.git"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"publishConfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"access"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"public"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/index.css"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"peerDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.2.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"web-types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"web-types.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"browserslist"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"&gt; 1%"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"not ie 11"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"not op_mini all"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>4.æ¯”å¦‚ <code>naive-ui</code>çš„ <code>package.json</code>  ï¼ˆnaive-uié¡¹ç›®ä¸æ˜¯monorepoï¼‰</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"naive-ui"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.43.1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"packageManager"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm@9.5.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A Vue 3 Component Library. Fairly Complete, Theme Customizable, Uses TypeScript, Fast"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"07akioni"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"homepage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://www.naiveui.com"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"repository"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://github.com/tusen-ai/naive-ui"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"naive-ui"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lib/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"es/index.mjs"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"unpkg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"jsdelivr"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"es/index.d.ts"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"README.md"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"dist"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"es"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"generic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"lib"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"volar.d.ts"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"web-types.json"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run clean &amp;&amp; pnpm run gen-version &amp;&amp; pnpm run gen-volar-dts &amp;&amp; NODE_ENV=development vite"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"web-types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./web-types.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"peerDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.0.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-1">æ–‡ä»¶ç›®å½•</h3>
<h4 data-id="heading-2">1.<code>"type"</code>å­—æ®µ</h4>
<p>å¯ä»¥è®¾ç½®<code>"type": "module"</code> æˆ–è€…<code>"type": "commonjs"</code></p>
<p><strong>å«ä¹‰</strong>ï¼šè¿™ä¸ªå­—æ®µæŒ‡å®šäº†Node.jsåº”è¯¥å¦‚ä½•å¤„ç†<code>.js</code>æ–‡ä»¶çš„æ¨¡å—ç³»ç»Ÿã€‚</p>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å½“è®¾ç½®ä¸º<code>"module"</code>æ—¶ï¼Œæ‰€æœ‰<code>.js</code>æ–‡ä»¶éƒ½ä¼šè¢«å½“ä½œESæ¨¡å—å¤„ç†</li>
<li>è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨<code>import/export</code>è¯­æ³•è€Œä¸æ˜¯<code>require/module.exports</code></li>
<li>å¦‚æœæ²¡æœ‰è®¾ç½®æˆ–è€…è®¾ç½®ä¸º<code>"commonjs"</code>ï¼Œåˆ™ä½¿ç”¨CommonJSæ¨¡å—ç³»ç»Ÿ</li>
</ul>
<p>ä½†æ˜¯ä½ è¦æ³¨æ„ï¼šjs/tsæ–‡ä»¶æ˜¯"è°"è¿è¡Œçš„ï¼Œå¦‚æœæ˜¯Nodeï¼Œè‡ªç„¶éµå¾ªä¸Šè¿°åŸåˆ™ã€‚ä½†å¦‚æœæ˜¯webpack/vite/rollup/tsdownè¿™ç±»æ„å»ºå·¥å…·å…¶å®<code>"type"</code>è¿™ä¸ªå­—æ®µå¯¹è¿™ç±»js/tsæ–‡ä»¶çº¦æŸä¸åˆ°ï¼Œå› ä¸ºæ­¤æ—¶ä¸ç®¡æ˜¯importè¿˜æ˜¯requireå†™çš„ï¼Œæ„å»ºå·¥å…·éƒ½åº”è¯¥èƒ½è¯†åˆ«å¹¶è½¬æ¢åˆ°targetï¼ˆtargetæŒ‡é…ç½®æ‰“åŒ…cjsè¿˜æ˜¯esmæ ¼å¼ï¼‰</p>
<p>a. <code>vueuse</code>å£°æ˜äº†<code>"type": "module"</code> ï¼Œç„¶åé‡‡ç”¨<code>.js + "import"</code>è¯­æ³•
b. ä½ è¿˜ä¼šå‘ç°å¾ˆå¤šé¡¹ç›®ä¹Ÿä¸çˆ±å†™type:"module"ï¼Œç„¶åæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š</p>
<ul>
<li><code>.mjs + "import"</code>çš„è¯­æ³•ï¼Œæ¯”å¦‚<code>element-plus</code></li>
<li><code>.js + "require"</code>çš„è¯­æ³•ï¼Œæ¯”å¦‚<code>ahooks</code></li>
</ul>
<p><code>vueuse</code>é¡¹ç›®éƒ¨åˆ†æˆªå›¾</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0965c7a848a044f79f11a75ea89e7d89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=H0HQ9meCbBteGtCKoTtukWK4Gcg%3D" alt="image.png" loading="lazy"/>
<code>ahooks</code>é¡¹ç›®éƒ¨åˆ†æˆªå›¾</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19d00c5d41e243d48e2acd96de4e560a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=BYWfLnvNywRQD7TFhA8jHouT74I%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>P.S. é¡¹ç›®ä¸‹<code>vitest.config.ts</code>ç§éƒ½æ˜¯é‡‡ç”¨<code>import</code>è¯­æ³•ï¼Œä¸ç®¡ä½ å£°æ²¡å£°æ˜<code>"type": "module"</code>ï¼Œè¿™æ˜¯å› ä¸ºNode v12 æ¨¡å—ç³»ç»Ÿå°±å¼€å§‹æ”¯æŒrequireå’Œimportä¸¤ç§è¯­æ³•äº†ã€‚</p>
</blockquote>
<h4 data-id="heading-3">2.<code>"module"</code>å­—æ®µ</h4>
<p><strong>å«ä¹‰</strong>ï¼šå½“ä½¿ç”¨<code>import ... from xx</code>å¯¼å…¥åŒ…æ—¶ï¼Œæ„å»ºå·¥å…·ï¼ˆå¦‚webpackã€rollupæˆ–viteç­‰ï¼‰ç”¨æ¥è¯†åˆ«ESæ¨¡å—ç‰ˆæœ¬çš„å…¥å£æ–‡ä»¶ã€‚</p>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å½“æ‰“åŒ…å·¥å…·æ”¯æŒESæ¨¡å—æ—¶ï¼Œä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ªå­—æ®µæŒ‡å®šçš„æ–‡ä»¶ä½œä¸ºå…¥å£</li>
<li>æœ‰åŠ©äºå®ç°tree-shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰ï¼Œå› ä¸ºESæ¨¡å—æ˜¯é™æ€åˆ†æçš„</li>
</ul>
<p><strong>åœ¨æ‚¨çš„é¡¹ç›®ä¸­</strong>ï¼š<code>"module": "./dist/index.mjs"</code> è¡¨ç¤ºæ‰“åŒ…å·¥å…·ä½¿ç”¨ESMå¯¼å…¥æ—¶ï¼Œä»å…¥å£<code>./dist/index.mjs</code>è¿™ä¸ªæ–‡ä»¶å¯¼å…¥ã€‚</p>
<h4 data-id="heading-4">3.<code>"main"</code>å­—æ®µ</h4>
<p><strong>å«ä¹‰</strong>ï¼šå½“ä½¿ç”¨<code>require()</code>å¯¼å…¥åŒ…æ—¶ï¼ŒNode.jsä¼šæŸ¥æ‰¾è¿™ä¸ªå­—æ®µæŒ‡å®šçš„æ–‡ä»¶ã€‚</p>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>"main"</code>å­—æ®µæŒ‡å®šäº†åŒ…çš„CommonJSå…¥å£ç‚¹ã€‚</li>
<li>è¿™æ˜¯ä¼ ç»Ÿçš„åŒ…å…¥å£ç‚¹å®šä¹‰æ–¹å¼ã€‚</li>
</ul>
<p><strong>ä¸<code>"module"</code>å­—æ®µçš„åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><code>"main"</code>: CommonJSå…¥å£ï¼ˆç”¨äºNode.jsçš„requireï¼‰</li>
<li><code>"module"</code>: ESæ¨¡å—å…¥å£ï¼ˆç”¨äºæ‰“åŒ…å·¥å…·çš„ESMçš„import/exportï¼‰</li>
</ul>
<h4 data-id="heading-5">4.<code>"exports"</code>å­—æ®µï¼ˆç°ä»£æ›¿ä»£æ–¹æ¡ˆï¼‰</h4>
<p><strong>å«ä¹‰</strong>ï¼šè¿™æ˜¯Node.js 12+å¼•å…¥çš„ç°ä»£åŒ…å…¥å£ç‚¹å®šä¹‰æ–¹å¼ï¼Œæä¾›äº†æ›´ç²¾ç»†çš„æ§åˆ¶ã€‚</p>
<p>åœ¨æ‚¨çš„é¡¹ç›®ä¸­ï¼Œå¯ä»¥è¿™æ ·é…ç½®</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-string">"exports"</span>: {
    <span class="hljs-string">"."</span>: {
	    <span class="hljs-string">"types"</span>: <span class="hljs-string">"./dist/index.d.ts"</span>,    // TypeScriptç±»å‹å®šä¹‰
	    <span class="hljs-string">"import"</span>: <span class="hljs-string">"./dist/index.js"</span>     // ESæ¨¡å—å¯¼å…¥å…¥å£
	}
    <span class="hljs-string">"./*"</span>: <span class="hljs-string">"./dist/*"</span>
  }
</code></pre>
<p>å¦‚æœä½ åŒæ—¶æä¾›äº†ESMå’ŒCommonJSäº§ç‰©å¯¼å‡ºï¼Œä½ å¯ä»¥è¿™æ ·é…ç½®</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/index.d.ts"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./es/index.mjs"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./lib/index.js"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>è§£é‡Š</strong></p>
<ul>
<li><code>".": "./dist/index.js"</code> - å½“å…¶ä»–æ¨¡å—é€šè¿‡ <code>import ... from '@caikengren/uni-hooks'</code>å¯¼å…¥æ‚¨çš„åŒ…æ—¶ï¼ŒNode.jså°†ä½¿ç”¨ <code>index.js</code> æ–‡ä»¶ä½œä¸ºå…¥å£ç‚¹ã€‚</li>
<li><code>"./*": "./dist/*" </code> - è¿™å…è®¸å¯¼å…¥åŒ…çš„å­è·¯å¾„ï¼Œä¾‹å¦‚ <code>import useXXX from '@caikengren/uni-hooks/useXXX'</code> ã€‚è¿™ç§æ¨¡å¼å…è®¸è®¿é—®åŒ…å†…çš„ç‰¹å®šæ–‡ä»¶æˆ–å­æ¨¡å—ã€‚</li>
<li><code>"types": "./dist/index.d.ts"</code> - å‘Šè¯‰ TypeScript ç¼–è¯‘å™¨åœ¨å“ªé‡Œæ‰¾åˆ°è¯¥åŒ…çš„ç±»å‹å£°æ˜æ–‡ä»¶ã€‚</li>
</ul>
<p><strong>è¡¥å……è¯´æ˜</strong></p>
<ul>
<li><code>exports</code>åº”è¯¥æ¯”è¿™æ¯”ä¼ ç»Ÿçš„ main/module å­—æ®µæä¾›äº†æ›´å¼ºå¤§çš„æ§åˆ¶èƒ½åŠ›ã€‚ <code>exports</code>æ¯”è¾ƒæ–°ï¼Œä¸ºäº†å…¼å®¹æ€§ï¼Œä¸€èˆ¬ä¹Ÿéœ€è¦å¯¹åº”é…ç½®å¥½main/moduleã€‚</li>
<li>æ§åˆ¶åŒ…çš„è®¿é—®è¾¹ç•Œã€‚ä½¿ç”¨ exports å­—æ®µçš„ä¸€ä¸ªé‡è¦å¥½å¤„æ˜¯å®ƒå¯ä»¥ä¿æŠ¤åŒ…çš„å†…éƒ¨æ–‡ä»¶ã€‚åœ¨æ²¡æœ‰ exports å­—æ®µçš„æƒ…å†µä¸‹ï¼ŒåŒ…çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥è¢«å¯¼å…¥ã€‚è€Œä½¿ç”¨ exports å­—æ®µåï¼Œåªæœ‰æ˜ç¡®å®šä¹‰çš„è·¯å¾„æ‰èƒ½è¢«å¤–éƒ¨è®¿é—®ï¼Œè¿™ä¸ºåŒ…ä½œè€…æä¾›äº†æ›´å¥½çš„å°è£…æ€§ã€‚</li>
</ul>
<h4 data-id="heading-6">5.<code>"files"</code>å­—æ®µ</h4>
<p>å®šä¹‰äº†npmä¸Šä¼ åˆ°ä»“åº“æ—¶ï¼Œéœ€è¦ä¸Šä¼ å“ªäº›æ–‡ä»¶ï¼ˆç›®å½•ï¼‰ï¼Œé€šå¸¸åŒ…å«ä½ æ‰“åŒ…çš„ä»£ç æ–‡ä»¶ã€package.jsonã€READMEè¿˜æœ‰å…¶ä»–è¿è¡Œæ—¶è¦ç”¨åˆ°çš„æ–‡ä»¶ ã€‚</p>
<p>ä¾‹å¦‚ï¼šç±»ä¼¼<code>ahooks</code>ï¼Œå®ƒé’ˆå¯¹Node CJSã€æµè§ˆå™¨ESMå’Œæµè§ˆå™¨unpkgçš„å½¢å¼æ‰“åŒ…äº†ä¸‰ä»½ä»£ç ï¼Œåˆ†åˆ«æ”¾åœ¨ä¸‰ä¸ªä¸åŒæ–‡ä»¶å¤¹ï¼Œè¿™äº›æ–‡ä»¶å¤¹éƒ½æ˜¯è¦ä¸Šä¼ çš„ã€‚æ‰€ä»¥<code>files</code>å­—æ®µå®šä¹‰äº†distã€libå’Œesã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29d2db0684f3495584f7387332ad8306~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=yvUv0Q9ttZKz8xtzshmrLgwE4Gk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">å‘å¸ƒé…ç½®</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-string">"private"</span>: <span class="hljs-literal">true</span>,
<span class="hljs-string">"publishConfig"</span>: {
  <span class="hljs-string">"tag"</span>: <span class="hljs-string">"1.1.0"</span>,
  <span class="hljs-string">"registry"</span>: <span class="hljs-string">"https://registry.npmjs.org/"</span>,
  <span class="hljs-string">"access"</span>: <span class="hljs-string">"public"</span>
}
</code></pre>
<h4 data-id="heading-8">1.<code>"private"</code>å­—æ®µ</h4>
<p>1.<code>private</code>å­—æ®µå¯ä»¥é˜²æ­¢æˆ‘ä»¬æ„å¤–åœ°å°†ç§æœ‰åº“å‘å¸ƒåˆ°npmæœåŠ¡å™¨ã€‚å³å½“æˆ‘ä»¬ä½¿ç”¨<code>npm publish</code>å‘å¸ƒæ—¶ä¸ä¼šè¢«å½“åšä¸€ä¸ªâ€œnpmåŒ…â€è¢«å‘å¸ƒã€‚ æ¯”å¦‚monorepoé¡¹ç›®çš„æ ¹package.jsonæ–‡ä»¶ï¼ˆä»…ç®¡ç†é¡¹ç›®ç»“æ„ç”¨ï¼Œä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„npmåŒ…ï¼‰ã€‚</p>
<p>2.ä½†å³ä½¿<code>"private": true</code>ï¼Œå½“æˆ‘é…ç½®äº†<code>publishConfig</code>ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯å¯ä»¥ç»§ç»­å‘å¸ƒçš„ã€‚æ˜ç¡®é…ç½®äº†<code>publishConfig</code>å¯ä»¥ä¿è¯è¿™ä¸ªåŒ…æ˜¯å¯ä»¥å®‰å…¨å‘å¸ƒçš„ã€‚</p>
<p>3.é»˜è®¤ <code>"private"</code>å­—æ®µä¸º <code>true</code>ã€‚</p>
<h4 data-id="heading-9">2.<code>"publishConfig"</code>å­—æ®µ</h4>
<p>1.å½“å‘å¸ƒåŒ…æ—¶è¿™ä¸ªé…ç½®ä¼šèµ·ä½œç”¨ï¼Œåœ¨è¿™é‡Œé…ç½®tagæˆ–ä»“åº“åœ°å€ã€‚</p>
<p>2.<code>"registry"</code>ï¼šä½ å›¢é˜Ÿ/å…¬å¸çš„çš„npmä»“åº“åœ°å€ã€‚</p>
<p>3.<code>"tag"</code>ï¼šé»˜è®¤å°±æ˜¯ <code>latest</code>ï¼ˆè¡¨ç¤ºå‘å¸ƒçš„å°±æ˜¯æ­£å¼ç‰ˆï¼‰ã€‚æœ‰æ—¶å€™éœ€è¦å‘å¸ƒbetaç‰ˆæœ¬ï¼ˆå…¬å¼€æµ‹è¯•ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªtagå°±èµ·ä½œç”¨äº†ã€‚</p>
<p>4.å‡è®¾æˆ‘ä»¬çš„<code>version: 1.1.1-beta.0</code>ï¼Œç„¶åé€šè¿‡<code>npm publish --tag beta</code>å‘å¸ƒï¼ˆæ³¨æ„ï¼šæ­¤æ—¶å‘å¸ƒå‘½ä»¤å¤šäº†ä¸€ä¸ª--tagå‚æ•°ï¼‰ï¼Œå¦‚æœä¸æ˜¾ç¤ºæŒ‡å®š--tagï¼Œé‚£ä¹ˆå°±ä¼šç”¨åˆ°æˆ‘ä»¬çš„<code>publishConfig.tag</code>ä½œä¸ºè¿™ä¸ªtagå€¼ã€‚</p>
<p>5.tagå€¼çš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ä»“åº“è¿™æ˜¯ä¸ª<code>beta</code>ç‰ˆæœ¬ã€‚å½“æœ‰äººå¦‚ä¸‹å®‰è£…æ—¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm i your-package@latest
</code></pre>
<p>6.ä¸ä¼šå®‰è£…æœ€è¿‘å‘å¸ƒçš„betaç‰ˆï¼Œè€Œæ˜¯å®‰è£…æœ€è¿‘æœ€æ–°å‘å¸ƒçš„latestç‰ˆï¼ˆå‘è¡Œç‰ˆï¼‰ã€‚
å¦‚æœéœ€è¦å®‰è£…betaç‰ˆï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šç‰ˆæœ¬:</p>
<pre><code class="hljs language-bash" lang="bash">npm i your-package@1.1.1-beta.0
</code></pre>
<h3 data-id="heading-10">ä¾èµ–é…ç½®</h3>
<h4 data-id="heading-11">1.<code>"dependencies"</code></h4>
<p><code>dependencies</code>ï¼šå£°æ˜çš„æ˜¯é¡¹ç›®çš„ç”Ÿäº§ç¯å¢ƒä¸­æ‰€å¿…é¡»çš„ä¾èµ–åŒ…ã€‚æ‰“åŒ…æ—¶ä¼šæŠŠè¿™äº›ä¾èµ–çš„ä»£ç æ‰“åŒ…è¿›å»ï¼ˆè¿™äº›åŒ…å¾€å¾€æ˜¯è¿è¡Œæ—¶èµ·ä½œç”¨ï¼‰ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
   <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.0.2"</span><span class="hljs-punctuation">,</span>
   <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~18.0.2"</span><span class="hljs-punctuation">,</span>
   <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span> 
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™é‡Œæ¯ä¸€é¡¹é…ç½®éƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆkey-valueï¼‰ï¼Œ keyè¡¨ç¤ºæ¨¡å—åç§°ï¼Œvalueè¡¨ç¤ºæ¨¡å—çš„ç‰ˆæœ¬å·ã€‚ç‰ˆæœ¬å·éµå¾ª<code>ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·</code>çš„æ ¼å¼è§„å®šï¼š</p>
<ul>
<li><strong>å›ºå®šç‰ˆæœ¬ï¼š</strong> <code>"lodash": "4.17.21"</code>è¡¨ç¤ºå®‰è£…æ—¶åªå®‰è£…è¿™ä¸ªæŒ‡å®šçš„ç‰ˆæœ¬ï¼›</li>
<li><strong>æ³¢æµªå·ï¼š</strong> <code>"react-dom": "~18.0.2"</code>è¡¨ç¤ºå®‰è£…18.0.xçš„æœ€æ–°ç‰ˆæœ¬ï¼ˆä¸ä½äº18.0.2ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å®‰è£…æ—¶ä¸ä¼šæ”¹å˜ä¸»ç‰ˆæœ¬å·å’Œæ¬¡ç‰ˆæœ¬å·ï¼Œä¿®è®¢å·ä¼šå®‰è£…æœ€æ–°çš„ï¼›</li>
<li><strong>æ’å…¥å·ï¼š</strong> <code>"react": "^18.0.2"</code>è¡¨ç¤ºå®‰è£…18.x.xçš„æœ€æ–°ç‰ˆæœ¬ï¼ˆä¸ä½äº18.0.2ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´å®‰è£…æ—¶ä¸ä¼šæ”¹å˜ä¸»ç‰ˆæœ¬å·ï¼Œæ¬¡ç‰ˆæœ¬å·å’Œä¿®è®¢å·ä¼šå®‰è£…æœ€æ–°çš„ï¼›</li>
</ul>
<p>é€šå¸¸æ¨è<code>"^18.0.2"</code>è¿™ç§ï¼Œä¿è¯å¤§ç‰ˆæœ¬çš„æœ€æ–°ã€‚</p>
<h4 data-id="heading-12">2.<code>"devDependencies"</code></h4>
<p><code>devDependencies</code>ï¼šå£°æ˜çš„æ˜¯é¡¹ç›®çš„å¼€å‘ç¯å¢ƒã€é¡¹ç›®è¿è¡Œèµ·æ¥æ‰€å¿…é¡»çš„ä¾èµ–åŒ…ã€‚æ‰“åŒ…æ—¶<strong>ä¸ä¼š</strong>æŠŠè¿™äº›ä¾èµ–çš„ä»£ç æ‰“åŒ…è¿›å»ï¼ˆè¿™äº›åŒ…å¾€å¾€æ˜¯ç¼–è¯‘æ—¶èµ·ä½œç”¨ï¼‰ã€‚åƒ<code>typescript</code>ï¼Œ<code>vite</code>è¿˜æœ‰ä¸€äº›vite pluginå’ŒtypeåŒ…ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@types/node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^20.10.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vitejs/plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tsdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.15.12"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.4.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-13">3.<code>"peerDependencies"</code></h4>
<p><code>peerDependencies</code>ï¼šè¿™ä¸ªä¸“é—¨ç”¨äºnpmåŒ…é¡¹ç›®ã€‚æˆ‘çš„npmåŒ…é¡¹ç›®å’Œå®‰è£…è¿™ä¸ªnpmçš„é¡¹ç›®å¯èƒ½ä¾èµ–åŒä¸€ä¸ªæ¨¡å—ï¼ˆå¦å¤–ä¸€ä¸ªnpmåŒ…ï¼‰ï¼Œé‚£ä¹ˆæˆ‘çš„npmåŒ…æ‰“åŒ…æ—¶å°±ä¸éœ€è¦æŠŠè¿™ä¸ªæ¨¡å—æ‰“åŒ…è¿›å»ã€‚æ¯”å¦‚ï¼š
æˆ‘çš„npmåŒ…æ˜¯ä¾èµ–<code>vue</code>æ¡†æ¶ï¼Œæ‰€æœ‰å®‰è£…æˆ‘è¿™ä¸ªnpmåŒ…çš„é¡¹ç›®éƒ½åº”è¯¥å®‰è£…äº†<code>vue</code>ä¾èµ–ï¼Œé‚£ä¹ˆå°±æœ‰
æˆ‘çš„npmåŒ…package.json:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-package"</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"peerDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.4.0"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>a.å½“åˆ«äººé¡¹ç›®çš„vueçš„å¤§ç‰ˆæœ¬ å’Œ æˆ‘çš„npmåŒ…ç›¸åŒ</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.4.1"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ­¤æ—¶åˆ«äººé¡¹ç›®<code>npm i my-package</code>æ—¶å¯ä»¥å®‰è£…æˆåŠŸçš„ã€‚<code>my-package</code>å’Œåˆ«äººé¡¹ç›®ä¸€èµ·ä¾èµ–<code>vue@3.4.1</code>ã€‚</p>
<p>b.ä½†æ˜¯å½“åˆ«äººé¡¹ç›®çš„vueçš„å¤§ç‰ˆæœ¬ å’Œ æˆ‘çš„npmåŒ…ä¸åŒ</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.4.1"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ­¤æ—¶åˆ«äººé¡¹ç›®<code>npm i my-package</code>æ—¶æ— æ³•æˆåŠŸï¼Œä¼šæç¤ºåˆ«äººï¼ˆæŠ¥é”™ï¼‰ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">npm ERR! Could <span class="hljs-keyword">not</span> resolve dependency: npm ERR! peer vue@"^<span class="hljs-number">3.4</span>.<span class="hljs-number">0</span> from <span class="hljs-keyword">my</span>-<span class="hljs-keyword">package</span>@1.<span class="hljs-number">1.1</span>
</code></pre>
<p>æ­¤æ—¶æœ‰ä¸€äº›æ¯”è¾ƒå®‰å…¨å¯ä»¥ç»•è¿‡çš„æ–¹å¼ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">npm i my-package --legacy-peer-deps
</code></pre>
<p>ğŸ‘‰ é€‚ç”¨äºä½ æ˜ç¡®çŸ¥é“è‡ªå·±åœ¨å¹²ä»€ä¹ˆï¼Œæ¯”å¦‚â€œè¿™ä¸ªåº“è™½ç„¶æ²¡å£°æ˜æ”¯æŒ vue 2ï¼Œä½†å…¶å®å¯ä»¥å·¥ä½œâ€ã€‚ï¼ˆè¿™æ˜¯æœ‰ä¸€å®šé£é™©çš„ï¼‰</p>
<h3 data-id="heading-14">å‚è€ƒ</h3>
<p><a href="https://juejin.cn/post/7023539063424548872" target="_blank" title="https://juejin.cn/post/7023539063424548872">å…³äºå‰ç«¯å¤§ç®¡å®¶ package.jsonï¼Œä½ çŸ¥é“å¤šå°‘ï¼Ÿ</a><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjaywcjlove%2Fpackage.json" target="_blank" title="https://github.com/jaywcjlove/package.json" ref="nofollow noopener noreferrer">PACKAGE.JSON</a><br/>
<a href="https://juejin.cn/post/6919306081164345351" target="_blank" title="https://juejin.cn/post/6919306081164345351">åœ¨NPMä¸Šå‘å¸ƒbetaæˆ–alphaç‰ˆ</a></p>
<h2 data-id="heading-15">äºŒã€è®¤è¯†tsconfigé…ç½®å’Œeslint config</h2>
<h4 data-id="heading-16">tsconfig</h4>
<p><code>tsconfig.json</code> æ˜¯ TypeScript é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œç”¨äºæ§åˆ¶ TypeScript ç¼–è¯‘å™¨ï¼ˆ<code>tsc</code>ï¼‰çš„è¡Œä¸ºã€‚å®ƒå†³å®šäº†å“ªäº›æ–‡ä»¶ä¼šè¢«ç¼–è¯‘ã€å¦‚ä½•ç¼–è¯‘ã€ä»¥åŠè¾“å‡ºç»“æœçš„æ ¼å¼å’Œä½ç½®ã€‚ä¸‹é¢æˆ‘å°†ç»“åˆä½ çš„é¡¹ç›®å®é™…æƒ…å†µï¼Œè¯¦ç»†è§£é‡Šå¸¸è§çš„é…ç½®é¡¹åŠå…¶ä½œç”¨ï¼š</p>
<h5 data-id="heading-17">1. <code>compilerOptions</code></h5>
<p>è¿™æ˜¯æœ€é‡è¦çš„é…ç½®å—ï¼Œå†³å®šäº†ç¼–è¯‘å™¨çš„å…·ä½“è¡Œä¸ºã€‚å¸¸è§å­—æ®µå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong><code>target</code></strong>ï¼šæŒ‡å®šç¼–è¯‘åçš„ JavaScript ç‰ˆæœ¬ï¼Œæ¯”å¦‚ <code>"ESNext"</code>ã€<code>"ES2020"</code>ã€‚å½±å“æ–°è¯­æ³•çš„æ”¯æŒã€‚</li>
<li><strong><code>module</code></strong>ï¼šæŒ‡å®šæ¨¡å—ç³»ç»Ÿï¼Œå¦‚ <code>"ESNext"</code>ã€<code>"CommonJS"</code>ã€‚ä½ çš„é¡¹ç›®é‡‡ç”¨ ESMï¼Œé€šå¸¸è®¾ç½®ä¸º <code>"ESNext"</code>ã€‚</li>
<li><strong><code>lib</code></strong>ï¼šæŒ‡å®šè¦åŒ…å«åœ¨ç¼–è¯‘ä¸­çš„åº“ï¼Œæ¯”å¦‚ <code>["DOM", "ESNext"]</code>ï¼Œå†³å®šå¯ç”¨çš„å…¨å±€ç±»å‹ã€‚</li>
<li><strong><code>declaration</code></strong>ï¼šæ˜¯å¦ç”Ÿæˆç±»å‹å£°æ˜æ–‡ä»¶ï¼ˆ<code>.d.ts</code>ï¼‰ï¼Œé€šå¸¸åº“é¡¹ç›®ä¼šå¼€å¯ã€‚</li>
<li><strong><code>outDir</code></strong>ï¼šç¼–è¯‘è¾“å‡ºç›®å½•ï¼Œæ¯”å¦‚ <code>"dist"</code>ã€‚</li>
<li><code>baseUrl</code>:  é€šå¸¸è®¾ç½®ä¸ºæ ¹ç›®å½•<code>"."</code>ï¼Œå®ƒæ˜¯tsä¸­è¯†åˆ«è·¯å¾„çš„"èµ·ç‚¹"ã€‚æ¯”å¦‚<code>import ... from 'src/...'</code>ï¼Œè¡¨ç¤ºä»<code>.</code>è·¯å¾„ä¸‹æ‰¾<code>src</code>ç›®å½•ã€‚</li>
<li><strong><code>rootDir</code></strong>ï¼šæºç æ ¹ç›®å½•ï¼Œå†³å®šå“ªäº›æ–‡ä»¶è¢«ç¼–è¯‘ã€‚</li>
<li><strong><code>strict</code></strong>ï¼šå¼€å¯æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥é€‰é¡¹ï¼Œå»ºè®®åº“é¡¹ç›®å¼€å¯ã€‚</li>
<li><strong><code>esModuleInterop</code></strong>ï¼šå…è®¸é»˜è®¤å¯¼å…¥ CommonJS æ¨¡å—ï¼Œæå‡å…¼å®¹æ€§ã€‚</li>
<li><strong><code>skipLibCheck</code></strong>ï¼šè·³è¿‡åº“æ–‡ä»¶çš„ç±»å‹æ£€æŸ¥ï¼ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚</li>
</ul>
<h5 data-id="heading-18">2.<code>paths</code>  åˆ«å</h5>
<p>TypeScript ä»…åœ¨â€œç¼–è¯‘æœŸâ€è¯†åˆ«è·¯å¾„åˆ«åï¼Œå®ƒä¸ä¼šå½±å“è¿è¡Œæ—¶ã€‚è¦è®©åˆ«ååœ¨è¿è¡Œæ—¶ä¹Ÿå¯ç”¨ï¼Œéœ€è¦è®©æ‰“åŒ…å™¨ï¼ˆVite/Rollup/tsdownï¼‰æˆ– Node çš„è§£æä¸ä¹‹ä¿æŒä¸€è‡´ã€‚<strong>å¿…é¡»å…ˆç¡®ä¿è®¾ç½®äº†baseUrl</strong></p>
<p>å¸¸è§é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// tsconfig.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@caikengren/uni-hooks-shared"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"packages/uni-hooks-shared/index.ts"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"@caikengren/uni-hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"packages/uni-hooks/index.ts"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿è¡Œæ—¶é…åˆï¼ˆç¤ºä¾‹ä»¥ Vite ä¸ºä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@caikengren/uni-hooks-shared'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'packages/uni-hooks-shared/index.ts'</span>),
      <span class="hljs-string">'@caikengren/uni-hooks'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'packages/uni-hooks/index.ts'</span>),
    },
  },
})
</code></pre>
<p>åœ¨åº“é¡¹ç›®ä¸­ï¼Œ<strong>æ›´æ¨èé€šè¿‡â€œåŒ…åâ€å¼•ç”¨ï¼Œè€Œä¸æ˜¯æºç åˆ«å</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// packages/hooks/package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@caikengren/uni-hooks"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@caikengren/uni-hooks-shared"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:^"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ ·åœ¨ä»£ç é‡Œç›´æ¥ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { foo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@caikengren/uni-hooks-shared'</span>
</code></pre>
<p>é¿å…äº†åˆ«åä¸æ‰“åŒ…å™¨çš„åŒé‡ç»´æŠ¤ã€‚</p>
<h5 data-id="heading-19">3. <code>include</code> å’Œ <code>exclude</code></h5>
<ul>
<li><strong><code>include</code></strong>ï¼šæŒ‡å®šè¦ç¼–è¯‘çš„æ–‡ä»¶æˆ–ç›®å½•ï¼ˆå¦‚ <code>["src"]</code>ï¼‰ã€‚</li>
<li><strong><code>exclude</code></strong>ï¼šæŒ‡å®šä¸ç¼–è¯‘çš„æ–‡ä»¶æˆ–ç›®å½•ï¼ˆå¦‚ <code>["node_modules", "dist"]</code>ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-20">4.<code>extends</code></h5>
<p>ç”¨äºâ€œç»§æ‰¿â€ä¸€ä»½åŸºç¡€é…ç½®ï¼Œç»Ÿä¸€ Monorepo å¤šåŒ…çš„ TypeScript è¡Œä¸ºã€‚</p>
<p>æ¨èåœ¨æ ¹ç›®å½•æ”¾ç½®ä¸€ä»½åŸºå‡†ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// tsconfig.jsonï¼ˆæ ¹ï¼‰</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lib"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"DOM"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"declaration"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"skipLibCheck"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å­åŒ…ç»§æ‰¿å¹¶æŒ‰éœ€è¦†ç›–ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// packages/uni-hooks-shared/tsconfig.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"../../tsconfig.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"rootDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¯ä»¥å¤šå±‚ç»§æ‰¿ï¼Œä½†ä¿æŒé“¾è·¯æ¸…æ™°ï¼Œé¿å…åœ¨å„åŒ…å†…é‡å¤é…ç½®ç›¸åŒé€‰é¡¹ã€‚</p>
<blockquote>
<p>P.S. å¦‚æœåªæœ‰æ ¹ç›®å½•æœ‰tsconfig.jsonï¼Œå­åŒ…æ²¡æœ‰tsconfig.jsonï¼Œå­åŒ…ä¼šå—åˆ°æ ¹ç›®å½•tsconfig.jsonçš„çº¦æŸã€‚</p>
</blockquote>
<h4 data-id="heading-21">eslint config</h4>
<p>å…³äºjsæ ¼å¼å’Œè§„èŒƒä¸Šï¼Œä¼ ç»Ÿéƒ½æ˜¯<code>eslint + prettier</code>ï¼Œä½†é…ç½®æ—¶æ¯”è¾ƒç¹çï¼Œè¿˜è¦å¤„ç†ä¸¤è€…çš„å†²çªã€‚å‚è€ƒ<a href="https://juejin.cn/post/7149564942633402382?searchId=20240813144443B02734B5D5E5CB3ACD8F" title="https://juejin.cn/post/7149564942633402382?searchId=20240813144443B02734B5D5E5CB3ACD8F" target="_blank">antfuå¤§ä½¬çš„è¯‘æ–‡</a>ï¼Œå¯ä»¥ä½¿ç”¨<code>@antfu/eslint-config</code>ï¼ˆvueuseé¡¹ç›®å°±ä½¿ç”¨äº†è¿™ä¸ªï¼‰æ¥åšeslintæ£€æŸ¥ã€‚</p>
<p><code>@antfu/eslint-config</code>æ˜¯ç”± Vue æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ã€å¼€æºç•Œå¤§ç¥ <strong>Anthony Fu</strong> åˆ›å»ºå¹¶ç»´æŠ¤çš„ä¸€å¥— <strong>ESLint é…ç½®é›†åˆ</strong>ã€‚å®ƒæ˜¯ç›®å‰ç¤¾åŒºä¸­æœ€æµè¡Œçš„ ESLint é…ç½®ä¹‹ä¸€ï¼ˆGitHub Star æ•°éå¸¸é«˜ï¼‰ï¼Œå…¶æ ¸å¿ƒç‰¹ç‚¹æ˜¯â€œå›ºæ‰§å·±è§â€ (Opinionated) ä¸”â€œå¼€ç®±å³ç”¨â€ã€‚å®ƒé‡‡ç”¨äº† ESLint æœ€æ–°çš„ <strong>Flat Config (æ‰å¹³åŒ–é…ç½®)</strong> ç³»ç»Ÿã€‚</p>
<h5 data-id="heading-22">æ ¸å¿ƒäº®ç‚¹ï¼š</h5>
<ol>
<li><strong>ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ</strong>ï¼šå®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ª ESLint é…ç½®ï¼Œå®ƒé›†æˆäº† Prettier çš„åŠŸèƒ½ï¼ˆé€šè¿‡ ESLint Stylisticï¼‰ï¼Œä½ <strong>ä¸éœ€è¦</strong>å†å®‰è£… Prettierã€‚</li>
<li><strong>è‡ªåŠ¨æ£€æµ‹</strong>ï¼šå®ƒä¼šè‡ªåŠ¨æ£€æµ‹ä½ çš„é¡¹ç›®ä¸­æ˜¯å¦ä½¿ç”¨äº† Vueã€Reactã€TypeScriptã€UnoCSS ç­‰ï¼Œå¹¶è‡ªåŠ¨å¯ç”¨ç›¸å…³è§„åˆ™ã€‚</li>
<li><strong>ä»£ç é£æ ¼</strong>ï¼š
<ul>
<li><strong>æ— åˆ†å·</strong> (No Semicolons)</li>
<li><strong>å•å¼•å·</strong> (Single Quotes)</li>
<li>å°¾éšé€—å· (Trailing Commas)</li>
</ul>
</li>
<li><strong>å¤šæ–‡ä»¶æ”¯æŒ</strong>ï¼šé™¤äº† JS/TSï¼Œè¿˜æ”¯æŒ JSONã€YAMLã€Markdownã€HTML ç­‰æ–‡ä»¶çš„ lint å’Œæ ¼å¼åŒ–ã€‚</li>
<li><strong>å¯¼å…¥æ’åº</strong>ï¼šå†…ç½®äº† eslint-plugin-simple-import-sortï¼Œè‡ªåŠ¨æŠŠ import æ•´ç†å¾—å¹²å¹²å‡€å‡€ã€‚</li>
</ol>
<h5 data-id="heading-23">å®‰è£…&amp;é…ç½®</h5>
<pre><code class="hljs language-bash" lang="bash">pnpm i -wD eslint @antfu/eslint-config
</code></pre>
<p>è™½ç„¶è¿™ä¸ªåŒ…ä¸»æ‰“â€œé›¶é…ç½®â€ï¼Œä½†å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æ ¹æ®å›¢é˜Ÿä¹ æƒ¯å¾®è°ƒä¸€äº›è§„åˆ™ã€‚</p>
<p>@antfu/eslint-config çš„é»˜è®¤å¯¼å‡ºæ˜¯ä¸€ä¸ª<strong>å·¥å‚å‡½æ•°</strong>ï¼Œå®ƒæ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// eslint.config.js</span>
<span class="hljs-keyword">import</span> antfu <span class="hljs-keyword">from</span> <span class="hljs-string">'@antfu/eslint-config'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">antfu</span>(
  {
    <span class="hljs-comment">// ============================================================</span>
    <span class="hljs-comment">// 1. å…¨å±€åŠŸèƒ½é…ç½® (Options)</span>
    <span class="hljs-comment">// ============================================================</span>

    <span class="hljs-comment">// æ˜¾å¼å¯ç”¨/ç¦ç”¨ç‰¹å®šæ¡†æ¶æ”¯æŒï¼ˆé»˜è®¤ä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä½†æ˜¾å¼å†™å‡ºæ›´æ¸…æ™°ï¼‰</span>
    <span class="hljs-attr">vue</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">typescript</span>: <span class="hljs-literal">true</span>,

    <span class="hljs-comment">// æ ¼å¼åŒ–é£æ ¼é…ç½® (æ›¿ä»£ Prettier)</span>
    <span class="hljs-attr">stylistic</span>: {
      <span class="hljs-attr">indent</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// ç¼©è¿› 2 ç©ºæ ¼</span>
      <span class="hljs-attr">quotes</span>: <span class="hljs-string">'single'</span>, <span class="hljs-comment">// å•å¼•å·</span>
      <span class="hljs-attr">jsx</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ”¯æŒ JSX</span>
    },

    <span class="hljs-comment">// å¿½ç•¥æ–‡ä»¶ (ç›¸å½“äº .eslintignore)</span>
    <span class="hljs-attr">ignores</span>: [
      <span class="hljs-string">'patches'</span>,
      <span class="hljs-string">'playground'</span>,
      <span class="hljs-string">'playgrounds'</span>,
      <span class="hljs-string">'docs'</span>,
      <span class="hljs-string">'**/types'</span>,
      <span class="hljs-string">'**/cache'</span>,
      <span class="hljs-string">'**/*.svg'</span>,
      <span class="hljs-string">'.cursor'</span>,
      <span class="hljs-string">'.trae'</span>,
      <span class="hljs-string">'scripts'</span>,
    ],
  },

  <span class="hljs-comment">// ============================================================</span>
  <span class="hljs-comment">// 2. å…·ä½“è§„åˆ™è¦†ç›– (Overrides)</span>
  <span class="hljs-comment">// ============================================================</span>

  <span class="hljs-comment">// ä¸€èˆ¬æ€§è§„åˆ™è¦†ç›–</span>
  {
    <span class="hljs-attr">rules</span>: {
      <span class="hljs-comment">// å…è®¸ä½¿ç”¨ console.log (é»˜è®¤æ˜¯ warn æˆ– error)</span>
      <span class="hljs-string">'no-console'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-comment">// å…è®¸ä½¿ç”¨æœªä½¿ç”¨çš„å˜é‡ (é€šå¸¸ç”¨äºè§£æ„æ—¶å¿½ç•¥æŸäº›å±æ€§)</span>
      <span class="hljs-string">'unused-imports/no-unused-vars'</span>: <span class="hljs-string">'warn'</span>,
      <span class="hljs-comment">// å…è®¸ä½¿ç”¨ @ts-ignoreï¼ˆè¦†ç›– antfu é»˜è®¤çš„ç¦ç”¨ç­–ç•¥ï¼‰</span>
      <span class="hljs-string">'ts/ban-ts-comment'</span>: [<span class="hljs-string">'error'</span>, { <span class="hljs-string">'ts-ignore'</span>: <span class="hljs-literal">false</span> }],
      <span class="hljs-comment">// å¦‚æœä½ çœŸçš„æƒ³è¦åˆ†å· (è™½ç„¶ antfu é»˜è®¤æ˜¯æ— åˆ†å·çš„)</span>
      <span class="hljs-comment">// 'style/semi': ['error', 'always'],</span>
      <span class="hljs-string">'style/max-statements-per-line'</span>: <span class="hljs-string">'off'</span>,

      <span class="hljs-string">'ts/ban-types'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'node/no-callback-literal'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'import/namespace'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'import/default'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'import/no-named-as-default'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'import/no-named-as-default-member'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'node/prefer-global/process'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'ts/unified-signatures'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'ts/no-unsafe-function-type'</span>: <span class="hljs-string">'off'</span>,
      <span class="hljs-string">'ts/no-dynamic-delete'</span>: <span class="hljs-string">'off'</span>,
    },
  },

  <span class="hljs-comment">// é’ˆå¯¹ç‰¹å®šæ–‡ä»¶çš„è§„åˆ™è¦†ç›–</span>
  {
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.vue'</span>],
    <span class="hljs-attr">rules</span>: {
      <span class="hljs-comment">// Vue ç»„ä»¶åå¿…é¡»ç”±å¤šä¸ªå•è¯ç»„æˆï¼Ÿå…³æ‰å®ƒ</span>
      <span class="hljs-string">'vue/multi-word-component-names'</span>: <span class="hljs-string">'off'</span>,
    },
  },

  {
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.json'</span>],
    <span class="hljs-attr">rules</span>: {
      <span class="hljs-comment">// å…è®¸ JSON æ–‡ä»¶æœ«å°¾æœ‰é€—å· (æŸäº›å·¥å…·ä¸æ”¯æŒï¼Œå¯èƒ½éœ€è¦å…³æ‰)</span>
      <span class="hljs-string">'jsonc/comma-dangle'</span>: <span class="hljs-string">'off'</span>,
    },
  },
)
</code></pre>
<h5 data-id="heading-24">é…ç½®lint script</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"sciprts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint --cache ."</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"lint:fix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint --cache --fix ."</span><span class="hljs-punctuation">,</span>
	<span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li><code>--cache</code>å¯ç”¨ç¼“å­˜ï¼Œç¼“å­˜ä¼šæŠŠä¸Šæ¬¡å·²é€šè¿‡çš„æ–‡ä»¶è®°ä½ï¼Œä¸‹ä¸€æ¬¡åªå¯¹å˜æ›´æˆ–å—å½±å“çš„æ–‡ä»¶é‡æ–°æ£€æŸ¥ï¼Œæå‡é€Ÿåº¦ã€‚æ£€æŸ¥çš„ç›®æ ‡è·¯å¾„æ˜¯å½“å‰ç›®å½•<code>.</code>ï¼Œå…·ä½“åŒ…å«å“ªäº›æ–‡ä»¶ç”± ESLint é…ç½®å†³å®šã€‚</li>
<li>åŠ ä¸Š<code>--fix</code> è‡ªåŠ¨ä¿®å¤å¯è‡ªåŠ¨ä¿®å¤çš„ ESLint è¿è§„ï¼ˆå¦‚ç¼©è¿›ã€å¼•å·ã€åˆ†å·ç­‰ï¼‰ã€‚ä¸èƒ½è‡ªåŠ¨ä¿®å¤çš„è§„åˆ™ä¼šä¿ç•™ä¸ºé”™è¯¯æˆ–è­¦å‘Šï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚</li>
</ul>
<h4 data-id="heading-25">pnpm-lockæ–‡ä»¶</h4>
<p>1.<code>pnpm-lock.yaml</code> ç”¨äºé”å®šæ•´ä¸ª Workspace çš„ä¾èµ–æ ‘ï¼Œä¿è¯â€œå¯é‡å¤å®‰è£…â€ï¼ˆåŒæ ·çš„ä¾èµ–ç‰ˆæœ¬ä¸æ‹“æ‰‘ï¼‰ã€‚
2.å¦‚æœæ²¡æœ‰è¿™ä¸ªlockæ–‡ä»¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ
æ¯”å¦‚æˆ‘çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">packageX: ^1.0.0</span>
</code></pre>
<p>å½“ç¬¬ä¸‰æ–¹åŒ… <code>packageX</code>å‘å¸ƒäº†æ–°ç‰ˆï¼š<code>1.1.0</code>ï¼Œé‚£ä¹ˆå†æ¬¡å®‰è£…ï¼ˆpnpm/yarn installï¼‰æ—¶éƒ½ä¼šå®‰è£…<code>1.1.0</code>æ–°ç‰ˆæœ¬çš„åº“ï¼Œæœ‰æ—¶å€™å¯èƒ½ä¼šå¸¦æ¥é—®é¢˜ï¼ˆå°¤å…¶ç”Ÿäº§ç¯å¢ƒä¸æ¨èè¿™æ ·ï¼‰ã€‚</p>
<p>3.å…³é”®ç‚¹ï¼š</p>
<ul>
<li>å•ä»“ Monorepo åªæœ‰â€œæ ¹é”æ–‡ä»¶â€ï¼Œå­åŒ…ä¸ç”Ÿæˆç‹¬ç«‹é”ï¼›æ‰€æœ‰å®‰è£…åŠ¨ä½œæœ€ç»ˆå†™å›æ ¹é”ã€‚</li>
<li>é”æ–‡ä»¶åº”æäº¤åˆ°ä»“åº“ï¼ŒCI/åŒäº‹æœºå™¨æ®æ­¤å®ç°ä¸€è‡´çš„å®‰è£…ç»“æœã€‚</li>
<li>å‘å¸ƒåˆ° npm ä¸ä¼šæºå¸¦é”æ–‡ä»¶ï¼›åº“æ¶ˆè´¹è€…ä¸å—ä½ çš„é”æ–‡ä»¶å½±å“ã€‚</li>
</ul>
<p>4.å¸¸ç”¨å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸¥æ ¼æ¨¡å¼ï¼ˆé”ä¸ package.json ä¸ä¸€è‡´æ—¶å¤±è´¥ï¼‰</span>
pnpm install --frozen-lockfile

<span class="hljs-comment"># ä»…æ›´æ–°é”æ–‡ä»¶ï¼ˆä¸ä¸‹è½½ä¾èµ–ï¼‰</span>
pnpm install --lockfile-only
</code></pre>
<p>5.ä¸ npm/yarn çš„å·®å¼‚ï¼š</p>
<ul>
<li>pnpm é‡‡ç”¨â€œå†…å®¹å¯»å€å­˜å‚¨ï¼ˆContent-Addressable Storeï¼‰â€ï¼Œè¿œç¨‹åŒ…å…ˆå­˜å…¥å…¨å±€ <code>.pnpm-store</code>ï¼Œå†ä»¥ç¬¦å·é“¾æ¥æŒ‚åˆ° <code>node_modules</code>ï¼Œç£ç›˜å ç”¨æ›´å°ã€‚</li>
<li>Workspace ä¸‹é€šè¿‡ <code>workspace:</code> åè®®æŠŠæœ¬åœ°åŒ…ä¹Ÿä»¥ç¬¦å·é“¾æ¥æ–¹å¼å…³è”ï¼Œå‡çº§å†…éƒ¨ç‰ˆæœ¬æ—¶ï¼Œç”±æ ¹é”ç»Ÿä¸€åæ˜ å˜æ›´ã€‚</li>
</ul>
<p>6.å¤šäººåä½œå»ºè®®ï¼š</p>
<ul>
<li>ä¸æ‰‹æ”¹é”æ–‡ä»¶ï¼›ä¾èµ–å‡çº§ç»Ÿä¸€ç”¨ <code>pnpm up &lt;pkg&gt;@&lt;range&gt;</code> æˆ–åœ¨å­åŒ…ç”¨ <code>--filter</code> ç²¾å‡†å‡çº§ã€‚</li>
<li>åˆå¹¶å†²çªæ—¶ï¼Œä¼˜å…ˆä¿ç•™æœ€æ–°ä¸€æ¬¡â€œæˆåŠŸå®‰è£…åâ€çš„é”ç‰ˆæœ¬ã€‚</li>
</ul>
<h3 data-id="heading-26">å‚è€ƒ</h3>
<p><a href="https://juejin.cn/post/7149564942633402382" target="_blank" title="https://juejin.cn/post/7149564942633402382">ã€è¯‘ã€‘antfuåšå®¢ï¼šä¸ºä»€ä¹ˆæˆ‘ä¸ç”¨Prettier</a></p>
<h2 data-id="heading-27">ä¸‰ã€è®¤è¯†monorepoå’Œç›¸å…³å·¥å…·</h2>
<h3 data-id="heading-28">monorepo ä»‹ç»</h3>
<p>1.monorepo æ˜¯å¤šä¸ªåŒ…åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ç®¡ç†çš„æ–¹å¼ï¼Œæ¯”è¾ƒæµè¡Œçš„ä¸€ç§ç®¡ç†æ–¹å¼ã€‚
è½¯ä»¶é¡¹ç›®ç®¡ç†ç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼š</p>





































<table><thead><tr><th>é˜¶æ®µ</th><th>åç§°</th><th>ç®¡ç†æ–¹å¼</th><th>äº§ç”ŸèƒŒæ™¯ / ç‰¹ç‚¹</th><th>ä¼˜åŠ¿</th><th>åŠ£åŠ¿</th></tr></thead><tbody><tr><td>1â€‹.</td><td>**Monolith (å•ä½“å·¨çŸ³åº”ç”¨)**â€‹</td><td>å•ä»“åº“ç®¡ç†æ‰€æœ‰é¡¹ç›®ä»£ç </td><td>é¡¹ç›®åˆæœŸï¼Œä¸šåŠ¡å¤æ‚åº¦ä½ï¼Œæ‰€æœ‰ä»£ç é›†ä¸­åœ¨ä¸€ä¸ªä»“åº“ä¸­ã€‚</td><td>ç»“æ„ç®€å•ï¼ŒåˆæœŸç®¡ç†æ–¹ä¾¿ã€‚</td><td>1. éšç€ä¸šåŠ¡å¢é•¿ï¼Œä»£ç é‡åºå¤§ï¼Œå¤æ‚åº¦é«˜ã€‚  2. æ„å»ºæ•ˆç‡ä½ä¸‹ã€‚</td></tr><tr><td>2.</td><td>**MultiRepo (å¤šä»“åº“å¤šæ¨¡å—)**â€‹</td><td>æ¯ä¸ªä¸šåŠ¡æ¨¡å—ç‹¬ç«‹ä¸€ä¸ªä»“åº“</td><td>ä¸ºè§£è€¦å·¨çŸ³åº”ç”¨ï¼Œå°†é¡¹ç›®æ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œåˆ†åˆ«ç®¡ç†ã€‚</td><td>1. æ¨¡å—è§£è€¦ï¼Œå¤æ‚åº¦é™ä½ã€‚  2. å„æ¨¡å—å¯ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•ã€å‘å¸ƒã€‚  3. æ„å»ºæ•ˆç‡æå‡ã€‚</td><td>1. <strong>è·¨ä»“åº“ä»£ç å…±äº«å›°éš¾</strong>ã€‚  2. <strong>ä¾èµ–ç®¡ç†å¤æ‚</strong>ï¼ˆåº•å±‚æ¨¡å—å‡çº§ï¼Œä¾èµ–æ–¹éœ€æ‰‹åŠ¨æ›´æ–°ï¼‰ã€‚  3. ä»“åº“æ•°é‡å¢å¤šåï¼Œ<strong>å·¥ç¨‹ç®¡ç†éš¾åº¦å¢åŠ </strong>ã€‚  4. <strong>æ„å»ºè€—æ—¶å¢åŠ </strong>ï¼ˆéœ€æŒ‰é¡ºåºæ„å»ºå¤šä¸ªä»“åº“ï¼‰ã€‚</td></tr><tr><td>3.â€‹</td><td>**MonoRepo (å•ä»“åº“å¤šæ¨¡å—)**â€‹</td><td>å•ä¸€ä»“åº“ä¸­ç®¡ç†å¤šä¸ªé¡¹ç›®æˆ–æ¨¡å—</td><td>ä¸ºè§£å†³MultiRepoåœ¨æ¨¡å—æ•°é‡å¢å¤šåäº§ç”Ÿçš„ç®¡ç†é—®é¢˜ã€‚</td><td>1. <strong>ä»£ç å…±äº«ä¾¿æ·</strong>ã€‚  2. <strong>å…±äº«ä¾èµ–ï¼Œå‡å°‘åŒ…å®‰è£…å’ŒåŒ…ä¸€è‡´æ€§</strong>ã€‚  3. <strong>å…±äº«å·¥ç¨‹é…ç½®</strong>ï¼Œä¿è¯ä»£ç é£æ ¼å’Œè´¨é‡ä¸€è‡´ã€‚  4. <strong>ä¾¿äºæ„å»ºå·¥å…·ä¼˜åŒ–</strong>ï¼ˆå¦‚å¢é‡æ„å»ºã€å¹¶è¡Œæ„å»ºï¼‰ã€‚</td><td>1. ä»“åº“ä½“ç§¯è¾ƒå¤§ã€‚  2. éœ€è¦å·¥å…·æ”¯æŒæ¥ç®¡ç†æƒé™å’Œä¼˜åŒ–æ„å»ºæ€§èƒ½ã€‚</td></tr></tbody></table>
<p>2.<code>monorepo</code>é¡¹ç›®ç›®å½•ç»“æ„ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">|<span class="hljs-comment">-- node_modules</span>
|<span class="hljs-comment">-- packages</span>
|   |<span class="hljs-comment">-- packageA</span>
|   |   |<span class="hljs-comment">-- package.json</span>
|   |<span class="hljs-comment">-- packageB</span>
|   |   |<span class="hljs-comment">-- package.json</span>
|   |<span class="hljs-comment">-- packageC</span>
|   |   |<span class="hljs-comment">-- package.json</span>
|<span class="hljs-comment">-- eslint.config.js</span>
|<span class="hljs-comment">-- package.json</span>
</code></pre>
<p>1ä¸ªpackage.jsonä»£è¡¨ä¸€ä¸ªé¡¹ç›®ï¼Œæœ€å¤–é¢çš„package.jsonä»£è¡¨æ ¹é¡¹ç›®ï¼Œé‡Œé¢çš„package.jsonä»£è¡¨å­åŒ…é¡¹ç›®Aã€Bå’ŒCç­‰ã€‚
æ ¹é¡¹ç›®å­˜åœ¨çš„æ„ä¹‰æ˜¯ï¼šç®¡ç†è¿™äº›å­åŒ…ï¼Œæ¯”å¦‚<strong>å…±äº«æ ¹é¡¹ç›®çš„ä¾èµ–(npmåŒ…)</strong>ã€<strong>å­åŒ…é—´ä¾èµ–è‡ªåŠ¨link</strong>å’Œ<strong>é€’å½’æ‰§è¡Œå­åŒ…scriptå‘½ä»¤</strong>ç­‰ã€‚</p>
<p>3.<code>monorepo</code>æ˜¯ä¸€ç§ç®¡ç†è§„èŒƒï¼Œé‚£ä¹ˆ<code>pnpm workspace</code>åè®®å°±æ˜¯ç”¨æ¥æ”¯æ’‘èµ·è¿™ç§è§„èŒƒçš„æŠ€æœ¯åè®®ã€‚å…·ä½“åšæ³•ï¼š</p>
<p>æ ¹ç›®å½•æ·»åŠ <code>pnpm-workspace.yaml</code> é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">packages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">'packages/*'</span>
</code></pre>
<p>è¿™æ ·ä¸€æ¥ï¼Œ<code>/packages</code>ä¸‹çš„æ‰€æœ‰é¡¹ç›®éƒ½ä¼šè¢« pnpm è¯†åˆ«ä¸º <strong>workspace çš„æˆå‘˜åŒ…</strong></p>
<p>4.ä¸‹é¢æˆ‘ä»¬æ¥çœ‹JS/TSé¡¹ç›®é¢†åŸŸï¼Œ<code>monorepo</code>é¡¹ç›®å¦‚ä½•é€šè¿‡<code>pnpm</code>/<code>changeset</code>/<code>turbo</code>ç­‰å·¥å…·è§£å†³ä¸‹é¢ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li><strong>å…±äº«ä»£ç /ä¾èµ–ï¼Œä¾èµ–ç®¡ç†</strong></li>
<li><strong>ç‰ˆæœ¬æ›´æ–°ã€è‡ªåŠ¨tagå’Œå‘å¸ƒ</strong></li>
<li><strong>å¹¶è¡Œ/ä¸²è¡Œæ„å»ºæ‰€æœ‰é¡¹ç›®ï¼Œå¤„ç†æ„å»ºé¡ºåº</strong></li>
</ol>
<p>5.åç»­æˆ‘ä»¬ç”¨è¿™ä¸ª<code>monorepo</code>é¡¹ç›®ç»“æ„è¿›è¡Œè®²è§£ã€‚ï¼ˆ<strong>è®°ä½è¿™ä¸ªç»“æ„ï¼Œä¸‹é¢ä¼šå¤šæ¬¡ç”¨åˆ°</strong>ï¼‰</p>
<pre><code class="hljs language-go" lang="go">|-- node_modules
|-- packages
|   |-- hooks
|   |   |-- <span class="hljs-keyword">package</span>.json ï¼ˆ<span class="hljs-string">"name"</span>:<span class="hljs-string">"@caikengren/uni-hooks"</span>ï¼‰
|   |-- shared
|   |   |-- <span class="hljs-keyword">package</span>.json ï¼ˆ<span class="hljs-string">"name"</span>:<span class="hljs-string">"@caikengren/uni-hooks-shared"</span>ï¼‰
|   |-- use-request
|   |   |-- <span class="hljs-keyword">package</span>.json  ï¼ˆ<span class="hljs-string">"name"</span>:<span class="hljs-string">"@caikengren/uni-use-request"</span>ï¼‰
|-- eslint.config.js
|-- <span class="hljs-keyword">package</span>.json
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/188081c9fc564ec0996f115e840e3ec2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=k%2BNIAMzlhdFcPHEPmaCHD3hbQn4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-29">pnpm workspace ç®¡ç†ä¾èµ–</h3>
<blockquote>
<p>é—®é¢˜1ï¼šå…±äº«ä»£ç /ä¾èµ–ï¼Œä¾èµ–ç®¡ç†</p>
</blockquote>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥æ‹†æˆä¸¤ä¸ªå­é—®é¢˜æ¥çœ‹:</p>
<ol>
<li>å¤šä¸ªå­åŒ…ä¾èµ–å¤–éƒ¨ç¬¬ä¸‰æ–¹npmåŒ…ï¼Œæ¯”å¦‚ä¾èµ–<code>vue</code>/<code>react</code>ï¼Œé‚£ä¹ˆè¿™äº›è¿™äº›åŒ…æ˜¯ä¸æ˜¯å¯ä»¥å…±äº«(è€Œä¸æ˜¯æ¯ä¸ªå­åŒ…é¡¹ç›®éƒ½å®‰è£…ä¸€é)?</li>
<li>å­åŒ…ä¹‹é—´å­˜åœ¨ä¾èµ–ï¼Œæ¯”å¦‚å­åŒ…Aä¾èµ–æœ¬åœ°çš„å­åŒ…Bã€Cï¼Œä½†Bã€Céƒ½è¿˜æ²¡å‘å¸ƒæ€ä¹ˆä¾èµ–ï¼Ÿèƒ½ä¸èƒ½æœ¬åœ°Bã€Cé“¾æ¥åˆ°Açš„node_modulesä¸‹å‘¢ï¼Ÿ</li>
</ol>
<h4 data-id="heading-30">1.pnpm i å®‰è£…ä¾èµ–</h4>
<p>é’ˆå¯¹ä¸Šé¢çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œé€šè¿‡æŠŠä¾èµ–å®‰è£…åœ¨æ ¹ç›®å½•ï¼Œé‚£ä¹ˆå­é¡¹ç›®å¯»æ‰¾ä¾èµ–å°±ä¼šé‡‡ç”¨æ ¹ç›®å½•çš„ä¾èµ–ï¼Œä»è€Œå®ç°å…±äº«ä¾èµ–
<strong>--workspaceå‚æ•°</strong>
æ ¹ç›®å½•ä¸‹å®‰è£…<code>vue</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm i -w vue
</code></pre>
<p><code>-w</code>ç›¸å½“äº<code>--workspace</code>ï¼Œè¡¨ç¤ºåœ¨æ ¹ç›®å½•ä¸‹å®‰è£…ä¾èµ–ã€‚</p>
<p>æ¯”å¦‚æˆ‘è¦å®‰è£…<code>typescript</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm i -wD typescript
</code></pre>
<p><code>-D</code>è¡¨ç¤ºå®‰è£…devDependenciesï¼Œ<code>-w</code>å’Œ<code>-D</code>å¯ä»¥åˆå¹¶ä¸º<code>-wD</code>ã€‚</p>
<p>å®‰è£…å®Œæˆåï¼Œåªæœ‰æ ¹ç›®å½•package.jsonä¼šæœ‰ä¾èµ–å£°æ˜ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.4.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.4.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>--filterå‚æ•°</strong>
æ¯”å¦‚æˆ‘æœ‰ä¸€ä¸ª<code>@caikengren/uni-hooks</code>å­åŒ…ï¼Œä¾èµ–äº†å¦å¤–ä¸¤ä¸ªå­åŒ…</p>
<ul>
<li><code>@caikengren/uni-use-request</code></li>
<li><code>@caikengren/uni-hooks-shared</code>
é‚£ä¹ˆå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼Œè¡¨ç¤ºåœ¨<code>@caikengren/uni-hooks</code>è¿™ä¸ªå­åŒ…ä¸­å®‰è£…å¦å¤–ä¸¤ä¸ªä¾èµ–ã€‚</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">pnpm i @caikengren/uni-use-request@workspace:^ --filter @caikengren/uni-hooks

pnpm i @caikengren/uni-hooks-shared@workspace:^ --filter @caikengren/uni-hooks
</code></pre>
<p><code>--filter xxx</code>è¡¨ç¤ºåœ¨xxxå­åŒ…ä¸‹å®‰è£…ä¾èµ–ï¼Œå…¶ä¸­ä¾èµ–çš„ç‰ˆæœ¬ä½¿ç”¨<code>@workspace:^</code>å ä½ã€‚</p>
<p>å®‰è£…å®Œæˆå <code>packages/uni-hooks</code>ç›®å½•çš„package.jsonä¼šå‡ºç°ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@caikengren/uni-hooks-shared"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:^"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@caikengren/uni-use-request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:^"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>@workspace:^</strong>
<code>@workspace:^</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„åè®®å‰ç¼€ï¼Œç”¨äºåœ¨ä¾èµ–å£°æ˜ä¸­å¼•ç”¨å½“å‰ workspace ä¸­çš„æœ¬åœ°åŒ…ï¼Œå¹¶è‡ªåŠ¨ä½¿ç”¨è¯¥åŒ…çš„ç‰ˆæœ¬å·åŠ ä¸Š <code>^</code> è¯­ä¹‰åŒ–ç‰ˆæœ¬èŒƒå›´ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œpnpm ä¼šï¼š</p>
<ol>
<li>åœ¨å½“å‰ workspace ä¸­æŸ¥æ‰¾åä¸º <code>my-local-pkg</code> çš„æœ¬åœ°åŒ…ï¼Œä¸å»è¿œç¨‹ä¸‹è½½äº†ï¼›</li>
<li>è·å–å®ƒåœ¨ <code>package.json</code> ä¸­å£°æ˜çš„ç‰ˆæœ¬å·ï¼ˆæ¯”å¦‚ <code>1.2.3</code>ï¼‰ï¼›</li>
<li>å°†ä¾èµ–è§£æä¸º <code>^1.2.3</code>ï¼Œå³å…è®¸å®‰è£…å…¼å®¹çš„æ¬¡è¦ç‰ˆæœ¬æ›´æ–°ï¼ˆéµå¾ª semver è§„èŒƒï¼‰ï¼›</li>
<li><strong>ä½†å‰ææ˜¯è¿™ä¸ªåŒ…å¿…é¡»å­˜åœ¨äº workspace ä¸­</strong>ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œæ„å»ºä¼šå¤±è´¥ã€‚</li>
</ol>
<h4 data-id="heading-31">2.pnpmè‡ªåŠ¨link</h4>
<p>å‰é¢ï¼Œæˆ‘ä»¬åˆ©ç”¨<code>@workspace:^</code>åœ¨<code>uni-hooks</code>å­åŒ…ä¸­å®‰è£…äº†å¦å¤–ä¸¤ä¸ªä¾èµ–ï¼š<code>@caikengren/uni-hooks-shared</code> å’Œ<code>@caikengren/uni-use-request</code>ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¾èµ–å®é™…æ˜¯æŒ‡å‘å“ªé‡Œå‘¢ï¼Ÿ</p>
<p><strong>è‡ªåŠ¨linkåŸç†</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddfedcc2c0ce482fb816925dc07e9f42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=1iRRZNo%2BlQItXJfwDUuMGXLcZHk%3D" alt="image.png" loading="lazy"/></p>
<p>1.<code>pnpm i -w B@workspace:^ C@workspace:^ --filter A</code>
B,Cè¢«è½¯é“¾æ¥åˆ°Açš„node_modules</p>
<p>2.<code>pnpm i -w Other@5.0.0</code>
Otherå®é™…ä¸Šæ˜¯å®‰è£…åˆ°.pnpm storeï¼Œ.pnpmç›®å½•ç›¸å½“äº.pnpm storeçš„æ˜ å°„ï¼ˆå†…å®¹åŒæ­¥çš„ï¼‰ï¼Œ.pnpmç›®å½•ä¸‹çš„Otherä¼šè¢«è½¯é“¾æ¥åˆ°æ ¹ç›®å½•çš„node_modules</p>
<blockquote>
<p>æ‹“å±•è¡¥å……ï¼šlnæ˜¯shellå‘½ä»¤ï¼ˆln -sç›¸å½“äºwindowsçš„å¿«æ·æ–¹å¼ï¼‰ã€‚
ln -sï¼ˆè½¯é“¾æ¥ï¼‰çš„æ–‡ä»¶å¯è¯»å†™ï¼ˆéœ€è¦åŸæ–‡ä»¶å…è®¸è½¯é“¾æ¥è¯»å†™ï¼‰ï¼Œæœ¬è´¨ä¸æ˜¯åŒä¸€æ–‡ä»¶ï¼Œè€Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªé“¾æ¥ç¬¦å·ã€‚
ln ï¼ˆç¡¬é“¾æ¥ï¼‰çš„æ–‡ä»¶å¯ä»¥è¯»å†™ï¼Œå’ŒåŸæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä»…åœ¨ä¸åŒåœ°æ–¹å±•ç¤ºäº†ã€‚</p>
</blockquote>
<p><strong>åŒºåˆ†:</strong></p>
<ul>
<li>pnpm çš„ç‰¹æ€§ï¼šå®‰è£…çš„è¿œç¨‹ä¾èµ–ä¼šè¢«æ”¾åˆ°<code>.pnpm</code>ç›®å½•ï¼Œç„¶åè½¯é“¾æ¥åˆ°node_modulesï¼Œä»è€Œä¾èµ–å…±äº«ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ã€‚</li>
<li>pnpm workspaceçš„ç‰¹æ€§ï¼š è‡ªåŠ¨linkã€‚é€šè¿‡<code>@workspace:^</code>å®‰è£…çš„æœ¬åœ°ä¾èµ–ï¼Œç›´æ¥è½¯é“¾æ¥åˆ°node_modulesï¼Œå³è‡ªåŠ¨linkã€‚</li>
</ul>
<p><strong>æˆ‘ä»¬çš„é¡¹ç›®ä¸­:</strong><br/>
<code>uni-hooks</code>å­åŒ…ä¾èµ–æœ¬åœ°<code>@caikengren/uni-hooks-shared</code> å’Œ<code>@caikengren/uni-use-request</code> ï¼Œå®‰è£…åä½ ä¼šå‘ç°node_modulesä¸‹çš„ä¾èµ–æœ‰ç®­å¤´ç¬¦å·ï¼Œè¯´æ˜æ˜¯â€œç¬¦å·é“¾æ¥â€ï¼ˆè½¯é“¾æ¥ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d01f15a35d8c46469191934add9adc5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=OneKQ16D5ezJNtV5lULJFQv97zs%3D" alt="image.png" loading="lazy"/></p>
<p><strong>ç–‘é—®:</strong> <code>workspace:*</code>å’Œ<code>workspace:^</code>çš„åŒºåˆ«?</p>
<p>1.<code>@caikengren/packageA@workspace:*</code>  æ‰“åŒ…å (äº§ç‰©/å‘å¸ƒåˆ° npm):</p>
<p>pnpm ä¼šå°†å…¶æ›¿æ¢ä¸º<strong>å½“å‰ workspace ä¸­è¯¥åŒ…çš„ç²¾ç¡®ç‰ˆæœ¬</strong>ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@caikengren/packageA"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span> 
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>2.<code>@caikengren/packageA@workspace:^</code>  æ‰“åŒ…å (äº§ç‰©/å‘å¸ƒåˆ° npm):</p>
<p>pnpm ä¼šå°†å…¶æ›¿æ¢ä¸º<strong>ä»¥å½“å‰ç‰ˆæœ¬ä¸ºåŸºå‡†çš„ (^) èŒƒå›´</strong>ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@caikengren/packageA"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-32">changeset å‘å¸ƒ</h3>
<blockquote>
<p>é—®é¢˜2ï¼šç‰ˆæœ¬æ›´æ–°ã€changelogã€è‡ªåŠ¨tagå’Œå‘å¸ƒ</p>
</blockquote>
<p>changesets ä¸»è¦å…³å¿ƒ monorepo é¡¹ç›®ä¸‹å­é¡¹ç›®ç‰ˆæœ¬çš„æ›´æ–°ã€changelog æ–‡ä»¶ç”Ÿæˆã€åŒ…çš„å‘å¸ƒã€‚ä¸€ä¸ª changeset æ˜¯ä¸ªåŒ…å«äº†åœ¨æŸä¸ªåˆ†æ”¯æˆ–è€… commit ä¸Šæ”¹åŠ¨ä¿¡æ¯çš„ md æ–‡ä»¶ï¼Œå®ƒä¼šåŒ…å«è¿™æ ·ä¸€äº›ä¿¡æ¯:</p>
<ul>
<li>éœ€è¦å‘å¸ƒçš„åŒ…</li>
<li>åŒ…ç‰ˆæœ¬çš„æ›´æ–°å±‚çº§(éµå¾ª semver è§„èŒƒ)</li>
<li>CHANGELOG ä¿¡æ¯</li>
</ul>
<h4 data-id="heading-33">1.é¡¹ç›®å‡†å¤‡</h4>
<p>å®‰è£…å·¥å…·</p>
<pre><code class="hljs language-bash" lang="bash">pnpm i -wD @changesets/cli
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œä¼šåœ¨<code>node_modules/.bin</code>ç›®å½•ï¼ˆä¾èµ–åŒ…æä¾›çš„å‘½ä»¤ä¼šå‡ºç°åœ¨è¿™ï¼‰çœ‹åˆ°<code>changeset</code>ï¼Œæ„å‘³ç€å¯ä»¥ç”¨<code>npx</code>æ¥è¿è¡Œè¿™ä¸ªå‘½ä»¤ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e1f8a00a2b34dc6a18b779e2fd450d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=7ZOH1ULqd6PAo5y5ySa1KnNsU%2B0%3D" alt="image.png" loading="lazy"/></p>
<p>åˆå§‹åŒ–</p>
<pre><code class="hljs language-bash" lang="bash">npx changeset init
</code></pre>
<p>ä¼šå¤šå‡ºä¸€ä¸ª<code>changeset</code>çš„æ–‡ä»¶ï¼Œå¦‚ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdad1376174745658df2bfe77d246c90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=bZmlfLMyw5CK3D2iRosvP80mxl4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-34">2.æœ¬åœ°è®¤è¯å‡†å¤‡</h4>
<p>å‡è®¾ä½ å·²ç»æ³¨å†Œäº†ä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2F" target="_blank" title="https://www.npmjs.com/" ref="nofollow noopener noreferrer">npm</a>è´¦å·ï¼ˆæˆ–ç§æœ‰ä»“åº“è´¦å·ï¼‰ï¼Œç„¶åé€šè¿‡terminalç™»å½•ï¼Œåœ¨ç»ˆç«¯è¾“å…¥</p>
<pre><code class="hljs language-bash" lang="bash">npm adduser
<span class="hljs-comment"># æˆ–è€…ï¼ˆæ•ˆæœä¸€æ ·ï¼‰</span>
npm login
</code></pre>
<h4 data-id="heading-35">3.å‘å¸ƒæµç¨‹</h4>
<p>å‡è®¾ä½ å·²ç»æ”¹è¿‡ä»£ç å¹¶ä¸”æäº¤äº†ï¼Œå‡†å¤‡å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚</p>
<p><strong>1.åˆ›å»ºä¸€ä¸ªæ–°çš„ changeset æ–‡ä»¶</strong>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">npx changeset add
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™ä¸ªå‘½ä»¤ä¼šäº¤äº’å¼åœ°è®©ä½ é€‰æ‹©è¦å‡çº§çš„åŒ…ï¼ˆåœ¨ monorepo ä¸­ï¼‰ã€ç‰ˆæœ¬ç±»å‹ï¼ˆpatch / minor / majorï¼‰ä»¥åŠå¡«å†™å˜æ›´æè¿°ã€‚</li>
<li>ç”Ÿæˆçš„æ–‡ä»¶ä¼šä¿å­˜åœ¨ <code>.changeset/</code> ç›®å½•ä¸‹ï¼Œæ ¼å¼å¦‚ <code>clever-horses-fix.md</code>ã€‚</li>
<li>è¿™äº›æ–‡ä»¶åç»­ä¼šè¢«ç”¨æ¥å†³å®šå¦‚ä½• bump ç‰ˆæœ¬å’Œç”Ÿæˆ changelogã€‚</li>
</ul>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šé€‰æ‹©è¦æ”¹ç‰ˆçš„å­åŒ…é¡¹ç›®ã€‚ã€Œä¸Šä¸‹ã€é”®é€‰æ‹©å­åŒ…ï¼Œã€Œç©ºæ ¼ã€é”®è¡¨ç¤ºé€‰æ‹©ï¼Œã€Œenterã€ç¡®å®šæœ€ç»ˆé€‰æ‹©ã€‚
<code>changeset add</code>æ˜¯è¦ä¾æ®commitæäº¤ä¿¡æ¯</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c56e9cd96b44eeb87a9a1e53c7a2838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=3EByayeWA4J6yOJzwdxoUS0TWig%3D" alt="image.png" loading="lazy"/></p>
<p>è¿›å…¥ç¬¬äºŒä¸ªé—®é¢˜ï¼šé€‰æ‹©è¦é€’å¢çš„ç‰ˆæœ¬çº§åˆ«ï¼ˆä¾æ¬¡æ˜¯major/minor/patch ï¼‰ã€‚æŒ‰ã€Œenterã€è¿›å…¥å¾…åŠé¡¹ç›®çš„ä¸‹ä¸€ä¸ªç‰ˆæœ¬çº§åˆ«ã€‚ï¼ˆæ¯”å¦‚ç°åœ¨æ˜¯major, ã€Œenterã€åè¿›å…¥minorï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fa3cb2e3dab4fb0a4615f22892cc795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=bdC3sgWerGppBX3bOG%2BVvrtC4T0%3D" alt="image.png" loading="lazy"/></p>
<p>è¿›å…¥ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼šæ€»ç»“</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12133338f3754446a57d4db3f37e8882~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=SnQC00aPdGujeb1%2FSjitHApDVjw%3D" alt="image.png" loading="lazy"/></p>
<p>è¿›å…¥ç¬¬å››ä¸ªé—®é¢˜ï¼šæ˜¯å¦ç¡®è®¤</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b43582dc3e849b6b082a3a3f4c55b6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=rZuXQFfYUA5MTbdddqBBiA%2BorXc%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€åï¼Œä¼šå¤šå‡ºä¸€ä¸ªchangesetæ–‡ä»¶ï¼ˆmdæ–‡ä»¶ï¼‰ï¼Œæè¿°äº†ç‰ˆæœ¬å˜æ›´ã€changelogå†…å®¹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d859f58f9006431d829f13e5af2195fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=Y2DAUx3IE29%2BzMbcipcZMhy%2BNms%3D" alt="image.png" loading="lazy"/></p>
<p><strong>2.æ ¹æ® <code>.changeset/</code> ä¸­çš„æ‰€æœ‰ changeset æ–‡ä»¶ï¼Œè‡ªåŠ¨ bump ç›¸å…³åŒ…çš„ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–°ä¾èµ–å…³ç³»ã€‚</strong></p>
<pre><code class="hljs">npx changeset version
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å®ƒä¼šè¯»å–æ‰€æœ‰æœªå¤„ç†çš„ changesetï¼Œè®¡ç®—æ¯ä¸ªåŒ…çš„æ–°ç‰ˆæœ¬å·ã€‚</li>
<li>è‡ªåŠ¨ä¿®æ”¹ <code>package.json</code> ä¸­çš„ç‰ˆæœ¬å­—æ®µã€‚</li>
<li>å¦‚æœæ˜¯ monorepoï¼Œè¿˜ä¼šæ›´æ–°å†…éƒ¨ä¾èµ–çš„ç‰ˆæœ¬ï¼ˆæ¯”å¦‚ <code>pkg-a</code> ä¾èµ– <code>pkg-b</code>ï¼Œä¸” <code>pkg-b</code> å‡çº§äº†ï¼Œè¿™é‡Œä¼šè‡ªåŠ¨æ›´æ–°å¼•ç”¨ï¼‰ã€‚</li>
<li>åŒæ—¶ä¼šåˆ é™¤å·²å¤„ç†çš„ changeset æ–‡ä»¶ï¼ˆæˆ–å°†å…¶å½’æ¡£ï¼‰ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/510cd918234041b498ed19265c9e0957~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=l5zca8RDmXIBpXFMRmVNXnMCthM%3D" alt="image.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹å‡ºå­åŒ…ä¸‹é¢éƒ½å¤šäº†/ä¿®æ”¹äº†<code>CHANGELOG.md</code>æ–‡ä»¶ï¼Œå¹¶ä¸”<code>package.json</code>çš„ç‰ˆæœ¬å·å‘ç”Ÿäº†å˜åŒ–ï¼ˆ<code>1.0.0</code>-&gt;<code>1.1.0</code>ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a9890452ec04f9a855d086cd2af553b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=y18WF8MVXyeLefdy57xG0T11LHo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9ceef8c5cfb43a991a27b5bdce5e100~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=wWLklyNyhWIuYP7YMvvbl1Ec36M%3D" alt="image.png" loading="lazy"/></p>
<p><strong>3.å°†æ–°ç‰ˆæœ¬çš„åŒ…å‘å¸ƒåˆ°npmä»“åº“</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx changeset publish
</code></pre>
<ul>
<li><strong>è¯´æ˜</strong>ï¼š
<ul>
<li>å®ƒä¼šæ‰§è¡Œ <code>npm publish</code> å¯¹æ¯ä¸ªéœ€è¦å‘å¸ƒçš„åŒ…ã€‚</li>
<li>é»˜è®¤åªå‘å¸ƒé‚£äº›ç‰ˆæœ¬å·å‘ç”Ÿå˜åŒ–çš„åŒ…ã€‚</li>
<li>éœ€è¦ä½ å·²ç»ç™»å½•åˆ° npmï¼ˆ<code>npm whoami</code>ï¼‰ã€‚</li>
<li>æ­¤å¤–ï¼Œä¼šç»™æ¯ä¸ªç‰ˆæœ¬å˜åŠ¨çš„åŒ…æ‰“tag.</li>
</ul>
</li>
</ul>
<p>å…ˆæäº¤å’Œpushä»£ç </p>
<pre><code class="hljs language-bash" lang="bash">git add .
git commit -m <span class="hljs-string">'chore(release): v1.1.0'</span>
git push
</code></pre>
<p>å†å‘å¸ƒï¼ˆä¼ä¸šçº§å‘å¸ƒï¼Œè¿™ä¸€æ­¥é€šå¸¸å±äºCIï¼Œåœ¨äº‘ç«¯æµæ°´çº¿å®Œæˆï¼‰</p>
<pre><code class="hljs language-bash" lang="bash">npx changeset publish
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61dc2a2f41b44fccadfabc0d51463379~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=Lgi6qkuayZaGmdZ4e14oVS5hnMk%3D" alt="image.png" loading="lazy"/></p>
<p>ç„¶ååœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40caikengren%2Funi-hooks" target="_blank" title="https://www.npmjs.com/package/@caikengren/uni-hooks" ref="nofollow noopener noreferrer">npmä»“åº“</a> å¯ä»¥çœ‹åˆ°å‘å¸ƒçš„ä¸‰ä¸ªåŒ…</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4b2303780504952a5d6b7691a3c22b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=baezVAvx%2FdVJVpjPXgKBl%2FkwjSM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-36">turborepo æ„å»º</h3>
<blockquote>
<p>é—®é¢˜3ï¼šå¹¶è¡Œ/ä¸²è¡Œæ„å»ºæ‰€æœ‰é¡¹ç›®ï¼Œå¤„ç†æ„å»ºé¡ºåº</p>
</blockquote>
<h4 data-id="heading-37">1.ä»‹ç»</h4>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ Turborepo</strong></p>
<ul>
<li>Monorepo å¸¸è§ç—›ç‚¹ï¼šæ„å»ºä¸²è¡Œã€æ…¢ï¼›è·¨åŒ…ä¾èµ–ç¼–æ’å¤æ‚ï¼›é‡å¤æ„å»ºæµªè´¹æ—¶é—´ã€‚</li>
<li><code>yarn workspace</code> é€šå¸¸ä¸²è¡Œæ„å»ºï¼Œæ•´ä½“è€—æ—¶é•¿ä¸”ä¸å¯æ§ã€‚</li>
<li><code>pnpm workspace</code> èƒ½å¹¶è¡Œï¼Œä½†å¯¹å¤æ‚ä¾èµ–æ‹“æ‰‘çš„é¡ºåºç¼–æ’æœ‰é™ï¼Œä¸”ç¼ºå°‘å†…å»ºçš„å¼ºç¼“å­˜æœºåˆ¶ã€‚</li>
<li>Turborepoé¢å‘è¿™äº›é—®é¢˜ï¼Œæä¾›æœ‰åºå¹¶è¡Œã€å¢é‡ä¸ç¼“å­˜çš„ç»„åˆè§£æ³•ã€‚</li>
</ul>
<p><strong>å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜</strong></p>
<ul>
<li>æ„å»ºç¼–æ’ï¼šç”¨ä»»åŠ¡ä¾èµ–å›¾ï¼ˆDAGï¼‰æ˜ç¡®â€œè°å…ˆè°åâ€ï¼Œé¿å…æ‰‹å·¥è„šæœ¬èƒ¶æ°´ã€‚</li>
<li>å¹¶è¡Œæ‰§è¡Œï¼šç‹¬ç«‹åŒ…å¹¶è¡Œè·‘ï¼Œä¾èµ–åŒ…æŒ‰é¡ºåºè·‘ï¼Œç¼©çŸ­å…¨é‡æ„å»ºæ—¶é—´ã€‚</li>
<li>å¢é‡æ„å»ºï¼šå¯¹è¾“å…¥åšå“ˆå¸Œï¼Œåªé‡å»ºè¢«æ”¹åŠ¨å½±å“çš„ä»»åŠ¡ï¼Œå‡å°‘æ— æ•ˆå·¥ä½œã€‚</li>
<li>æœ¬åœ°ä¸è¿œç¨‹ç¼“å­˜ï¼šåŒæ ·è¾“å…¥ç›´æ¥å¤ç”¨äº§ç‰©ï¼›æ¥å…¥è¿œç¨‹ç¼“å­˜åï¼ŒCI ä¸å¼€å‘è€…ä¹‹é—´å…±äº«ç»“æœã€‚</li>
</ul>
<h4 data-id="heading-38">2.å¹¶è¡Œå’Œæ„å»ºç¼–æ’</h4>
<p>ä½¿ç”¨turboåˆå§‹åŒ–ä¸€ä¸ª Monorepo çš„é¡¹ç›®ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ª packageï¼š</p>
<ul>
<li><code>apps/web</code>ï¼Œä¾èµ– shared</li>
<li><code>apps/docs</code>ï¼Œä¾èµ– shared</li>
<li><code>packages/shared</code>ï¼Œè¢« web å’Œ docs ä¾èµ–</li>
</ul>
<p>ç›®å½•å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69cec10c303f43ccb0a4d763ce5c97d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=LWHhSSRYj%2F%2BIi8wL3YiA86HR0oA%3D" alt="image.png" loading="lazy"/></p>
<p>yarn å‘½ä»¤ åªèƒ½ä¸²è¡Œè¿è¡Œä»»åŠ¡ï¼š <code>yarn workspaces run lint &amp;&amp; yarn workspaces run build &amp;&amp; yarn workspaces run test</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc83456d6cab4bab8f271a5f28044e06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=Nqnvf4KQ09v4PuIm8HOLs21cNkk%3D" alt="image.png" loading="lazy"/>
ä½†æ˜¯ï¼Œè¦ä½¿ç”¨ Turborepo å¯ä»¥<strong>æ›´å¿«åœ°</strong>å®Œæˆç›¸åŒçš„å·¥ä½œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>turbo run lint build test</code>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73082cad3a814aaf9ef282e2f01541dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=fhL435rwPqxaElvhl1jzwxzpI0A%3D" alt="image.png" loading="lazy"/>
ä½ ä¼šå‘ç°æœ‰äº›ä»»åŠ¡æ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„â€”â€”lintå’Œtestä»»åŠ¡å¯ä»¥å¹¶è¡Œã€‚è¿˜æœ‰äº›æ˜¯æ‰§è¡Œé¡ºåºä¾èµ–çš„â€”â€”webå’Œdocs çš„æ„å»ºä¾èµ–shareæ„å»ºå®Œæˆã€‚</p>
<p>é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json:turbo.json" lang="json:turbo.json">{
  "$schema": "https://turbo.build/schema.json",
  "tasks": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "test": {
      "dependsOn": ["^build"]
    },
    "lint": {},
  }
}
</code></pre>
<ul>
<li><code>tasks</code>ï¼šå£°æ˜ä»»åŠ¡ç¼–æ’ä¸äº§ç‰©è¾“å‡ºï¼Œkeyæ˜¯<code>turbo run Xxx</code>çš„<code>Xxx</code>ã€‚</li>
<li><code>dependsOn</code>ï¼šç”¨ <code>^task</code> è¡¨ç¤ºâ€œå…ˆè·‘ä¸Šæ¸¸ä¾èµ–çš„åŒåä»»åŠ¡â€ï¼Œè‡ªåŠ¨æ ¹æ®ä¾èµ–å›¾æ’åºã€‚</li>
<li><code>outputs</code>ï¼šå£°æ˜ä»»åŠ¡äº§ç‰©ï¼ˆå¦‚ <code>dist/**</code>ï¼‰ï¼Œè®© Turborepoå‡†ç¡®ç¼“å­˜å’Œå¤ç”¨æ„å»ºç»“æœã€‚</li>
</ul>
<p>å…³äº<code>^task</code>çš„ç†è§£æ˜¯ï¼Œä¸åŒåŒ…çš„ä»»åŠ¡ç¼–æ’ï¼š
å½“å‰ package æ‰§è¡Œ <code>build</code> ä»»åŠ¡ä¹‹å‰ï¼Œéœ€è¦ <strong>å…ˆè¿è¡Œå®ƒä¾èµ–çš„åŒ…ï¼ˆdependencies / devDependencies / peerDependenciesï¼‰</strong> çš„ <code>build</code> ä»»åŠ¡ã€‚
å½“ä½ é…ç½®äº†<code>"dependsOn": ["^build"]</code>ï¼Œé‚£ä¹ˆã€Œwebå’Œdocs çš„æ„å»ºä¾èµ–shareæ„å»ºå®Œæˆåï¼Œå†æ‰§è¡Œã€ï¼Œå¦åˆ™ä¸ä¼šã€‚</p>
<p>å…³äº<code>dependsOn</code>å¦å¤–ä¸€ç§æƒ…å†µï¼Œæ²¡æœ‰<code>^</code>ï¼Œè¡¨ç¤ºåŒä¸€ä¸ªåŒ…ä¸­çš„ä»»åŠ¡ç¼–æ’ã€‚æ¯”å¦‚ä¸‹é¢å°±è¡¨è¾¾äº†æ‰€æœ‰çš„<code>test</code>ä»»åŠ¡æ‰§è¡Œå‰ï¼Œè¦å…ˆå®Œæˆ<code>build</code>å‘½ä»¤ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> 
	<span class="hljs-attr">"tasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> 
		<span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"dependsOn"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"build"</span><span class="hljs-punctuation">]</span> <span class="hljs-punctuation">}</span> 
	<span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿›ä¸€æ­¥ï¼Œä½ è¿˜å¯ä»¥é™å®šåˆ°æŸä¸ªåŒ…çš„ ä»»åŠ¡ç¼–æ’ã€‚æ¯”å¦‚ä¸‹é¢è¡¨è¾¾äº†</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"outputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"dist/**"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"dependsOn"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"^build"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-39">3.ç¼“å­˜å’Œå¢é‡æ„å»º</h4>
<p>ç¬¬ä¸€æ¬¡<code>trubo run build</code>åï¼Œä¼šç”Ÿæˆç¼“å­˜å­˜æ”¾åœ¨Â <code>node_modules/.cache/turbo/</code>ç›®å½•ä¸‹</p>
<p>ç¬¬ä¸€æ¬¡æ„å»ºï¼šè¿˜æ²¡äº§ç‰©ï¼ˆæ²¡æœ‰distç›®å½•ï¼‰ï¼Œè®°å½•å­åŒ…é¡¹ç›®æ–‡ä»¶çš„hashå€¼ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7680c4c88ef741c6bb708c31ab66b380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=RSK487cBWjHOBLQvd4VJHGHrqhc%3D" alt="image.png" loading="lazy"/></p>
<p>ç¬¬äºŒæ¬¡æ„å»ºï¼šå­åŒ…æ–‡ä»¶çš„hashæ ‡è¯†å’Œä¹‹å‰çš„æ¯”è¾ƒï¼Œå¦‚æœæ²¡å˜åŒ–ï¼Œåˆ™è·³è¿‡æ„å»ºã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fb3e76b4fe94dbb96ca4299cd59c99f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=efegy%2FQ4gTREFCReA2qb61I8IkE%3D" alt="image.png" loading="lazy"/></p>
<p>é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">//turbo.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://turbo.build/schema.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"dependsOn"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"^build"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"outputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"dist/**"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"dependsOn"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"^build"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>P.S. <code>tasks</code>æ˜¯æ–°å­—æ®µåï¼Œå¯¹åº”æ—§<code>pipeline</code>ï¼Œå«ä¹‰ä¸€æ ·ã€‚</p>
</blockquote>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰<code>cache</code>é…ç½®å’Œ<code>--filter</code>å‘½ä»¤å‚æ•°ï¼š</p>
<p><code>cache</code>ï¼šé»˜è®¤å¼€å¯ï¼›å¯å¯¹ <code>dev</code> ç­‰ä»»åŠ¡å…³é—­ç¼“å­˜ï¼Œä¿è¯å¼€å‘æ—¶çš„å³æ—¶æ€§ã€‚</p>
<pre><code class="hljs language-json:turbo.json" lang="json:turbo.json">{
  "$schema": "https://turbo.build/schema.json",
  "tasks": {
    "dev": {
      "cache": false
    },
  }
}
</code></pre>
<p><code>--filter</code>ï¼šæŒ‰åŒ…åæˆ–è·¯å¾„è¿‡æ»¤æ‰§è¡ŒèŒƒå›´ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">turbo run &lt;<span class="hljs-built_in">command</span>&gt; --filter=&lt;package name&gt;
</code></pre>
<h3 data-id="heading-40">æ„å»ºï¼ˆæ‰“åŒ…ï¼‰å·¥å…·</h3>
<h4 data-id="heading-41">tsdownçš„ä¸»è¦åŠŸèƒ½</h4>
<p>ç›¸å…³åŠŸèƒ½è¯·æŸ¥é˜…<a href="https://link.juejin.cn?target=https%3A%2F%2Ftsdown.dev%2Fzh-CN" target="_blank" title="https://tsdown.dev/zh-CN" ref="nofollow noopener noreferrer">tsdownä¸­æ–‡æ–‡æ¡£</a>ï¼Œç›®å‰å¯ä»¥çœ‹åˆ°<code>vueuse</code>é¡¹ç›®å·²ç»é‡‡ç”¨äº†<code>tsdown</code>æ¥æ‰“åŒ…åº“é¡¹ç›®ã€‚</p>
<p>ä¸‹é¢ç®€å•ä»‹ç»ä¸‹tsdownåŠŸèƒ½ï¼š</p>
<p><strong>1.é›¶é…ç½®TypeScriptæ”¯æŒ</strong>
tsdownå†…ç½®äº†å¯¹TypeScriptçš„å®Œæ•´æ”¯æŒï¼Œæ— éœ€é¢å¤–çš„é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsdown"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>2.å¤šæ ¼å¼è¾“å‡º</strong>
æ”¯æŒåŒæ—¶ç”Ÿæˆå¤šç§æ¨¡å—æ ¼å¼ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"tsdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"esm"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"cjs"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"umd"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"entry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/index.ts"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¹¶ä¸”è‡ªåŠ¨ä¸ºæ¯ä¸ªè¾“å‡ºæ ¼å¼ç”Ÿæˆå¯¹åº”çš„<code>.d.ts</code>å£°æ˜æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">dist/
â”œâ”€â”€ index.esm.js
â”œâ”€â”€ index.esm.d.ts
â”œâ”€â”€ index.cjs.js
â”œâ”€â”€ index.cjs.d.ts
â”œâ”€â”€ index.umd.js
â””â”€â”€ index.umd.d.ts
</code></pre>
<p><strong>3.Tree-shaking</strong>
æé€ŸTree-shakingï¼Œè‡ªåŠ¨ç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/utils.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">used</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-string">'used'</span>; }
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">unused</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> <span class="hljs-string">'unused'</span>; }

<span class="hljs-comment">// src/index.ts</span>
<span class="hljs-keyword">export</span> { used } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-comment">// unusedå‡½æ•°ä¼šè¢«è‡ªåŠ¨ç§»é™¤</span>
</code></pre>
<p><strong>4.å¤–éƒ¨ä¾èµ–å¤„ç†</strong>
é…ç½®å¤–éƒ¨ä¾èµ–ï¼Œé¿å…å°†ä¾èµ–æ‰“åŒ…è¿›è¾“å‡ºæ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"tsdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"external"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"react"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"vue"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"globals"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"React"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vue"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-42">Rollup vs Vite vs tsdown</h4>
<h5 data-id="heading-43">Rollup - ç»å…¸é€‰æ‹©</h5>
<p>Rollupæ˜¯æœ€æ—©ä¸“æ³¨äºESMæ‰“åŒ…çš„å·¥å…·ä¹‹ä¸€ï¼Œä»¥å…¶ä¼˜ç§€çš„Tree-shakingèƒ½åŠ›è€Œé—»åã€‚</p>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>å‡ºè‰²çš„Tree-shakingä¼˜åŒ–</li>
<li>ç”Ÿæˆç®€æ´çš„ESMè¾“å‡º</li>
<li>ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿ</li>
<li>é€‚åˆåº“å¼€å‘</li>
</ul>
<p><strong>åŠ£åŠ¿ï¼š</strong></p>
<ul>
<li>é…ç½®ç›¸å¯¹å¤æ‚</li>
<li>å¼€å‘æ¨¡å¼ä¸‹çš„HMRæ”¯æŒæœ‰é™</li>
<li>æ„å»ºé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢</li>
</ul>
<h5 data-id="heading-44">Vite - ç°ä»£å¼€å‘ä½“éªŒ</h5>
<p>ViteåŸºäºåŸç”ŸESMï¼Œæä¾›äº†æå¿«çš„å¼€å‘æœåŠ¡å™¨å’Œä¼˜åŒ–çš„æ„å»ºæµç¨‹ã€‚</p>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>é—ªç”µèˆ¬çš„å†·å¯åŠ¨é€Ÿåº¦</li>
<li>å³æ—¶çš„çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰</li>
<li>å¼€ç®±å³ç”¨çš„TypeScriptæ”¯æŒ</li>
<li>ç°ä»£åŒ–çš„å¼€å‘ä½“éªŒ</li>
</ul>
<p><strong>åŠ£åŠ¿ï¼š</strong></p>
<ul>
<li>ä¸»è¦ç”¨äºåº”ç”¨å¼€å‘</li>
<li>å¯¹äºçº¯åº“æ‰“åŒ…å¯èƒ½è¿‡äºå¤æ‚</li>
<li>ä¾èµ–Node.jsç¯å¢ƒ</li>
</ul>
<h5 data-id="heading-45">tsdown - ä¸“ä¸ºtsåº“é¡¹ç›®</h5>
<p>tsdownæ˜¯ä¸€ä¸ªæ–°å…´çš„åŸºäºrolldownï¼ˆåŸºäº<strong>rust</strong>ï¼‰çš„æ‰“åŒ…å·¥å…·ï¼Œä¸“é—¨ä¸ºTypeScripté¡¹ç›®è®¾è®¡ï¼Œç»“åˆäº†ç°ä»£æ‰“åŒ…å·¥å…·çš„ä¼˜ç‚¹ã€‚</p>
<h5 data-id="heading-46">æ€§èƒ½å¯¹æ¯”</h5>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸‰ç§å·¥å…·çš„æ„å»ºæ€§èƒ½å¯¹æ¯”å¦‚ä¸‹ï¼š</p>

































<table><thead><tr><th>å·¥å…·</th><th>å†·å¯åŠ¨æ—¶é—´</th><th>HMRé€Ÿåº¦</th><th>è¾“å‡ºå¤§å°</th><th>é…ç½®å¤æ‚åº¦</th></tr></thead><tbody><tr><td>Rollup</td><td>ä¸­ç­‰</td><td>æ…¢</td><td>å°</td><td>é«˜</td></tr><tr><td>Vite</td><td>å¿«</td><td>æå¿«</td><td>ä¸­ç­‰</td><td>ä½</td></tr><tr><td>tsdown</td><td>æå¿«</td><td>å¿«</td><td>å°</td><td>æä½</td></tr></tbody></table>
<h5 data-id="heading-47">é€‰æ‹©å»ºè®®</h5>
<ul>
<li><strong>åº“å¼€å‘</strong>ï¼šæ¨èä½¿ç”¨tsdownï¼Œé›¶é…ç½®ã€å¤šæ ¼å¼è¾“å‡ºã€ç±»å‹å£°æ˜è‡ªåŠ¨ç”Ÿæˆ</li>
<li><strong>åº”ç”¨å¼€å‘</strong>ï¼šæ¨èä½¿ç”¨Viteï¼Œä¼˜ç§€çš„å¼€å‘ä½“éªŒå’Œæ„å»ºæ€§èƒ½</li>
<li><strong>ä¼ ç»Ÿé¡¹ç›®</strong>ï¼šå¦‚æœå·²æœ‰Rollupé…ç½®ä¸”è¿è¡Œè‰¯å¥½ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨</li>
</ul>
<h3 data-id="heading-48">å‚è€ƒ</h3>
<p><a href="https://juejin.cn/post/7215886869199896637" target="_blank" title="https://juejin.cn/post/7215886869199896637">å¸¦ä½ äº†è§£æ›´å…¨é¢çš„ Monorepo - ä¼˜åŠ£ã€è¸©å‘ã€é€‰å‹</a><br/>
<a href="https://juejin.cn/post/7343156956665839651" target="_blank" title="https://juejin.cn/post/7343156956665839651">ä»é›¶åˆ°ä¸€ä½¿ç”¨ turborepo + pnpm æ­å»ºä¼ä¸šçº§ Monorepo é¡¹ç›®</a><br/>
<a href="https://juejin.cn/post/7024827345059971080" target="_blank" title="https://juejin.cn/post/7024827345059971080">Changesets: æµè¡Œçš„ monorepo åœºæ™¯å‘åŒ…å·¥å…·</a></p>
<h2 data-id="heading-49">äº”ã€CI/CD</h2>
<p>è§£é‡Šï¼š</p>
<ul>
<li><strong>CI (Continuous Integration æŒç»­æ•´åˆ)</strong></li>
<li><strong>CD (Continuous Delivery/Deployment æŒç»­äº¤ä»˜/éƒ¨ç½²)</strong></li>
</ul>
<h4 data-id="heading-50">CI</h4>
<p>CIçš„ç›®æ ‡ï¼š</p>
<ul>
<li><strong>è‡ªåŠ¨è¿è¡Œæµ‹è¯•</strong>ï¼šè‡ªåŠ¨æ‰§è¡Œå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰ã€‚ä¾‹å¦‚ï¼š<code>npm test</code></li>
<li><strong>ä»£ç è´¨é‡æ£€æŸ¥</strong>ï¼šåŒ…æ‹¬ ESLintã€Prettierã€TypeScript ç±»å‹æ£€æŸ¥ç­‰ã€‚ä¾‹å¦‚ï¼š<code>npm run lint</code>ã€<code>npm run type-check</code></li>
<li><strong>æ„å»ºéªŒè¯</strong>ï¼šç¡®ä¿åŒ…å¯ä»¥æ­£ç¡®æ„å»ºï¼ˆå¦‚ç¼–è¯‘ TypeScript ã€æ‰“åŒ…ç­‰ï¼‰ã€‚ä¾‹å¦‚`npm run build</li>
</ul>
<p>å…¶ä¸­<code>è‡ªåŠ¨åŒ–æµ‹è¯•</code>ã€<code>ä»£ç æ£€æŸ¥</code>å’Œ<code>æ„å»ºéªŒè¯</code>ä¸€èˆ¬åœ¨ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ</p>
<ul>
<li>pushåˆ°ä¸»åˆ†æ”¯ (main, master)ä¹‹å‰ã€‚å¿…é¡»çš„</li>
<li>pushåˆ°ç‰¹å¾åˆ†æ”¯ä¹‹å‰ã€‚å¯é€‰</li>
<li>æPRä¹‹å‰ã€‚å¯é€‰</li>
</ul>
<p>å¸¸ç”¨çš„CIå¹³å° :</p>





















<table><thead><tr><th>å¹³å°</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>GitHub Actions</strong></td><td>å…è´¹ã€ä¸ GitHub æ·±åº¦é›†æˆï¼ŒYAML é…ç½®ï¼Œç¤¾åŒºç”Ÿæ€ä¸°å¯Œ</td></tr><tr><td><strong>GitLab CI</strong></td><td>å†…ç½®äº GitLabï¼Œé€‚åˆç§æœ‰éƒ¨ç½²</td></tr><tr><td><strong>Travis CI</strong></td><td>æ›¾ç»æµè¡Œï¼Œç°é€æ¸è¢« GitHub Actions å–ä»£</td></tr></tbody></table>
<h4 data-id="heading-51">CD</h4>
<p><strong>1.äº§ç‰©ç®¡ç† (Artifact Management)</strong>
ä¸‹è½½æ„å»ºäº§ç‰©ï¼š ä» CI æµç¨‹ï¼ˆå¦‚ Jenkins workspaceã€GitHub Actions artifactsï¼‰ä¸­æ‹‰å–æ‰“åŒ…å¥½çš„ dist æˆ– build ç›®å½•ã€‚ç»™å½“å‰çš„å‘å¸ƒåŒ…æ‰“ä¸Š Tag æˆ–ç‰ˆæœ¬å·ã€‚ï¼ˆå¦‚æœæ˜¯dockerï¼Œåˆ™ä¼šæ„å»ºé•œåƒå’Œæ¨é€åˆ°é•œåƒä»“åº“ï¼‰</p>
<p><strong>2.ç¯å¢ƒé…ç½®ä¸æ³¨å…¥ (Configuration Injection)</strong></p>
<ul>
<li>æ„å»ºæ—¶æ³¨å…¥ï¼šå¦‚æœæ˜¯é™æ€ç«™ç‚¹ï¼Œé€šå¸¸åœ¨ CI é˜¶æ®µå°±é€šè¿‡ DefinePlugin æˆ– import.meta.env å†™å…¥äº†ã€‚</li>
<li>è¿è¡Œæ—¶æ³¨å…¥ï¼ˆCD é˜¶æ®µï¼‰ å¦‚æœæ˜¯ Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼Œé€šå¸¸åœ¨ CD é˜¶æ®µé€šè¿‡ K8s ConfigMap æˆ–ç¯å¢ƒå˜é‡å°†é…ç½®æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚</li>
</ul>
<p><strong>3.éƒ¨ç½²æ‰§è¡Œ (Deployment Execution)</strong></p>
<p>a. é™æ€èµ„æºéƒ¨ç½² (SPA - Vue/React)</p>
<ul>
<li>ä¸Šä¼ å¯¹è±¡å­˜å‚¨ï¼š å°† HTML/CSS/JS ä¸Šä¼ åˆ°äº‘å‚å•†çš„å¯¹è±¡å­˜å‚¨ï¼ˆAWS S3, Aliyun OSS, Tencent COSï¼‰ã€‚</li>
<li>æ›´æ–°CDNï¼šä¸ºäº†é˜²æ­¢ç”¨æˆ·åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­è®¿é—®åˆ° 404 æ–‡ä»¶ï¼Œé€šå¸¸ä¼šå…ˆä¸Šä¼ å¸¦ Hash çš„é™æ€èµ„æºï¼ˆJS/CSSï¼‰ï¼Œæœ€åä¸Šä¼ å…¥å£æ–‡ä»¶ï¼ˆindex.htmlï¼‰ã€‚</li>
</ul>
<p>b.æœåŠ¡ç«¯åº”ç”¨éƒ¨ç½² (SSR - Next.js/Nuxt/Node BFF)</p>
<ul>
<li>å®¹å™¨æ›´æ–°ï¼š æ›´æ–° Kubernetes (K8s) çš„ Deployment é•œåƒç‰ˆæœ¬ï¼Œæ‰§è¡Œæ»šåŠ¨æ›´æ–°ï¼ˆRolling Updateï¼‰ã€‚</li>
<li>æœåŠ¡é‡å¯ï¼š ä¼ ç»ŸæœåŠ¡å™¨ä¸Šä½¿ç”¨ PM2 reloadã€‚</li>
</ul>
<p>c.npmåŒ…è¿™ç±»å·¥ç¨‹äº§ç‰©</p>
<ul>
<li>ä¸Šä¼ åˆ°npmä»“åº“ã€‚ä½¿ç”¨<code>npx changeset publish</code>æˆ–è€…<code>npm publish</code>å®Œæˆä¸Šä¼ ã€‚</li>
</ul>
<h3 data-id="heading-52">Gitè§„èŒƒé…ç½® - husky</h3>
<h4 data-id="heading-53">gitè§„èŒƒæ–¹æ¡ˆ</h4>
<p>è¯¥æ–¹æ¡ˆéœ€è¦å®‰è£…ä»¥ä¸‹ä¾èµ–</p>
<ul>
<li>husky</li>
<li>lint-staged</li>
<li>commitizen</li>
<li>cz-git</li>
<li>@commitlint/cli</li>
<li>@commitlint/config-conventional</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">pnpm i -wD husky lint-staged commitizen cz-git @commitlint/cli @commitlint/config-conventional
</code></pre>
<p><strong>1.huskyæ‹¦æˆªGit hooks</strong></p>
<p><code>Git Hooks</code>ï¼šGit åŸç”Ÿå°±è‡ªå¸¦ä¸€å¥—â€œé’©å­â€æœºåˆ¶ã€‚åœ¨ .git/hooks/ ç›®å½•ä¸‹ï¼Œæœ‰ä¸€å †è„šæœ¬ï¼ˆå¦‚ pre-commit.sampleï¼‰ã€‚</p>
<ul>
<li><strong>æœºåˆ¶</strong>ï¼šå½“ä½ æ‰§è¡Œç‰¹å®šçš„ Git å‘½ä»¤ï¼ˆå¦‚ commitã€pushã€mergeï¼‰æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨å»æ£€æŸ¥è¿™ä¸ªç›®å½•ä¸‹æœ‰æ²¡æœ‰å¯¹åº”çš„è„šæœ¬æ–‡ä»¶ã€‚å¦‚æœæœ‰ï¼Œå°±æ‰§è¡Œå®ƒã€‚</li>
<li><strong>ç—›ç‚¹</strong>ï¼š.git ç›®å½•æ˜¯ä¸ä¼šè¢«æäº¤åˆ°ä»£ç ä»“åº“çš„ï¼ˆå®ƒè¢« .gitignore å¿½ç•¥ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œä½ åœ¨æœ¬åœ°é…ç½®çš„é’©å­è„šæœ¬ï¼Œä½ çš„åŒäº‹æ‹‰å–ä»£ç åæ˜¯çœ‹ä¸åˆ°çš„ï¼Œæ— æ³•åŒæ­¥å›¢é˜Ÿè§„èŒƒã€‚</li>
</ul>
<p>Husky çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯â€œç¯¡æ”¹â€Git æŸ¥æ‰¾é’©å­çš„è·¯å¾„ï¼Œå¹¶å°†å…¶æŒ‡å‘é¡¹ç›®ä»£ç ä¸­çš„ä½ç½®ï¼ˆé€šå¸¸æ˜¯æ ¹ç›®å½•ä¸‹çš„ .husky/ æ–‡ä»¶å¤¹ï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯å¯ä»¥æäº¤åˆ° Git ä»“åº“å…±äº«ç»™æ‰€æœ‰äººçš„ã€‚</p>
<p><strong>2.lint-staged æ£€æŸ¥ä»£ç </strong></p>
<p>æ¯æ¬¡æäº¤ä»£ç å‰ï¼Œæˆ‘ä»¬å¸Œæœ›"æäº¤çš„ä»£ç "èƒ½é€šè¿‡eslintæ£€æŸ¥ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®è¯ï¼š<code>eslintæ£€æŸ¥</code>å’Œ<code>æäº¤çš„ä»£ç </code>ã€‚<code>lint-staged</code>å°±æ˜¯ç”¨æ¥åšæäº¤çš„ä»£ç eslintæ£€æŸ¥ï¼ˆè€Œä¸æ˜¯å…¨éƒ¨ä»£ç æ£€æŸ¥ï¼‰ã€‚</p>
<p><strong>3.commitlintæ ¡éªŒcommitä¿¡æ¯</strong></p>
<p>æ‰€æœ‰çš„gité¡¹ç›®ï¼Œéƒ½åº”è¯¥å»éµå¾ªä¸€ä¸ªgitè§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒä¹‹ä¸€å°±æ˜¯<code>git commit</code>çš„messageã€‚ä½ è‚¯å®šè§è¿‡å¾ˆå¤šè¿™æ ·çš„messageï¼š<code>chore(ci): xxx</code>ï¼Œ <code>feat(components): xxx</code>ã€‚ä¸‹é¢å°±ä»‹ç»ä¸‹å¸¸ç”¨çš„ä¸€ç§è§„èŒƒç»“æ„ã€‚</p>
<p>Commit Message ç»“æ„ï¼š</p>
<ul>
<li><strong>Headerï¼ˆå¤´éƒ¨ï¼‰</strong>: å¿…é¡»åŒ…å«ï¼Œæ˜¯Commit Messageçš„æ ¸å¿ƒéƒ¨åˆ†ã€‚
<ul>
<li><strong>ç±»å‹ (type)</strong>: æ ‡è®°Commitçš„ç±»åˆ«ï¼Œä¾‹å¦‚ <code>feat</code> (æ–°åŠŸèƒ½), <code>fix</code> (ä¿®å¤bug), <code>docs</code> (æ–‡æ¡£), <code>style</code> (ä»£ç é£æ ¼) ç­‰ã€‚</li>
<li><strong>èŒƒå›´ (scope)</strong>: å¯é€‰ï¼Œç”¨äºè¯´æ˜Commitå½±å“çš„èŒƒå›´ï¼Œå¦‚æ–‡ä»¶ã€ç»„ä»¶æˆ–æ¨¡å—ã€‚</li>
<li><strong>ä¸»é¢˜ (subject)</strong>: ç®€çŸ­åœ°æè¿°æœ¬æ¬¡æäº¤çš„å†…å®¹ï¼Œé€šå¸¸ä¸è¶…è¿‡50ä¸ªå­—ç¬¦ï¼Œé¦–å­—æ¯å°å†™ã€‚</li>
<li><strong>æ ¼å¼</strong>: <code>type(scope): subject</code>ã€‚</li>
</ul>
</li>
<li><strong>Bodyï¼ˆæè¿°ï¼‰</strong>: å¯é€‰ï¼Œå¯¹Commitè¿›è¡Œè¯¦ç»†æè¿°ï¼Œå¯ä»¥åˆ†æˆå¤šè¡Œã€‚
<ul>
<li>è§£é‡Šæäº¤çš„åŠ¨æœºã€è§£å†³çš„é—®é¢˜ç­‰ã€‚</li>
<li>æ¯è¡Œå»ºè®®ä¸è¶…è¿‡72ä¸ªå­—ç¬¦ï¼Œä»¥é¿å…è‡ªåŠ¨æ¢è¡Œå½±å“å¯è¯»æ€§ã€‚</li>
</ul>
</li>
<li><strong>Footerï¼ˆå°¾éƒ¨ï¼‰</strong>: å¯é€‰ï¼Œç”¨äºå…³è”Issueç¼–å·æˆ–æ ‡è®°é‡å¤§æ€§å˜æ›´ (Breaking Changes)ã€‚
<ul>
<li><strong>å…³è”Issue</strong>: ä½¿ç”¨å¦‚ <code>Closes #123</code> æˆ– <code>Fixes #123</code>ã€‚</li>
</ul>
</li>
</ul>
<p><code>@commitlint/cli</code> ç”¨æ¥æ ¡éªŒ Git æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆçº¦å®šçš„æ ¼å¼ã€‚é…åˆ <code>@commitlint/config-conventional</code> ä½¿ç”¨ï¼Œå¯å¼ºåˆ¶ç»Ÿä¸€æäº¤ç±»å‹ï¼ˆå¦‚ <code>feat</code>ã€<code>fix</code>ã€<code>docs</code>ã€<code>refactor</code>ã€<code>chore</code> ç­‰ï¼‰ä¸æ¶ˆæ¯ç»“æ„ï¼Œæå‡ç‰ˆæœ¬ç®¡ç†ä¸è‡ªåŠ¨åŒ–å‘å¸ƒçš„å¯é æ€§ã€‚</p>
<p><strong>4.commitizenå’Œcz-git äº¤äº’å¼æäº¤</strong></p>
<p><code>commitizen</code>æä¾›äº†cliï¼ˆå‘½ä»¤äº¤äº’å¼ï¼‰çš„æ–¹å¼æ¥å®ŒæˆCommit Messageå¡«å†™ã€‚
<code>cz-git</code> æ˜¯ Commitizen çš„ä¸€ä¸ªé€‚é…å™¨ï¼ˆadapterï¼‰ï¼Œé€šå¸¸é…åˆ <code>commitizen</code> ä½¿ç”¨ã€‚åŸºäº<code>cz-git</code>å¯ä»¥æ›´çµæ´»çš„æ§åˆ¶ä½ çš„æäº¤Messageè§„èŒƒã€‚</p>
<h4 data-id="heading-54">é…ç½®å·¥å…·</h4>
<p><strong>1.åˆå§‹åŒ–huskyç›®å½•</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">npx husky <span class="hljs-keyword">init</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/362f8a229b894592b5b5855a8b8f42d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=hvPJOP8z7f9Hh04iqfjvY5blqQw%3D" alt="image.png" loading="lazy"/></p>
<p><code>pre-commit</code>æ˜¯ Git ä¼—å¤šé’©å­ä¸­çš„ä¸€ä¸ªï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒåœ¨ <strong>Commit ä¹‹å‰</strong> æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ–‡ä»¶é‡Œçš„è„šæœ¬ï¼Œä¼šåœ¨<code>git commit</code>çœŸæ­£æ‰§è¡Œå‰æ‰§è¡Œï¼Œé¿å…ä¸è§„èŒƒçš„æäº¤ã€‚</p>
<p><strong>2.commitizen é…ç½®</strong></p>
<ul>
<li>Scripts: æ·»åŠ  commit å‘½ä»¤æ¥å¯åŠ¨äº¤äº’å¼æäº¤ã€‚</li>
<li>Config: æŒ‡å®š commitizen ä½¿ç”¨ cz-git é€‚é…å™¨ã€‚
ä¿®æ”¹<code>package.json</code>:</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"husky"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">//ï¼Ÿ</span>
    <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git-cz"</span> <span class="hljs-comment">//ä½¿ç”¨git-cz æ¥åšæäº¤ï¼ˆå¤šä¸ªgitå‘½ä»¤çš„ç»„åˆï¼‰</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-comment">//commitizenå·¥å…·çš„é…ç½®</span>
    <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/cz-git"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>è¯·æ ¹æ®ä½ é¡¹ç›®ä¸­å®é™…å®‰è£…çš„ eslint/prettier æƒ…å†µè°ƒæ•´ lint-staged é‡Œçš„å‘½ä»¤)</p>
</blockquote>
<p><strong>2.lint-stagedé…ç½®</strong></p>
<ul>
<li>Lint-staged: é…ç½®æš‚å­˜åŒºæ–‡ä»¶çš„æ ¡éªŒè§„åˆ™ã€‚
ä¿®æ”¹<code>package.json</code>:</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"husky"</span><span class="hljs-punctuation">,</span> 
    <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git-cz"</span> 
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lint-staged"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-comment">// lint-stagedå·¥å…·çš„é…ç½®</span>
    <span class="hljs-attr">"*.{js,ts,vue,jsx,tsx}"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"eslint --fix"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"prettier --write"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"*.{json,md,css,scss}"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"prettier --write"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ·»åŠ huskyé’©å­ï¼Œpre-commit: æäº¤å‰æ‰§è¡Œ lint-stagedï¼ˆä»£ç æ ¼å¼åŒ–/æ£€æŸ¥ï¼‰ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"npx lint-staged"</span> &gt; .husky/pre-commit
</code></pre>
<p><strong>3. Commitlint &amp; Cz-gité…ç½®</strong></p>
<p>cz-git çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒå¯ä»¥ç›´æ¥è¯»å– commitlint çš„é…ç½®ï¼Œä»è€Œå®ç°â€œä¸€ä»½é…ç½®ï¼Œä¸¤å¤„ç”Ÿæ•ˆâ€ã€‚</p>
<p>åœ¨æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶ commitlint.config.js (å¦‚æœæ˜¯ type: module é¡¹ç›®åˆ™ä¸º .mjs æˆ– .cjs)ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// commitlint.config.js</span>
<span class="hljs-comment">/** <span class="hljs-doctag">@type</span> {<span class="hljs-type">import('cz-git').UserConfig</span>} */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// ç»§æ‰¿çš„è§„åˆ™</span>
  <span class="hljs-attr">extends</span>: [<span class="hljs-string">'@commitlint/config-conventional'</span>],
  <span class="hljs-comment">// è‡ªå®šä¹‰è§„åˆ™</span>
  <span class="hljs-attr">rules</span>: {
    <span class="hljs-comment">// type ç±»å‹å®šä¹‰ï¼Œè¡¨ç¤º git æäº¤çš„ type å¿…é¡»åœ¨ä»¥ä¸‹ç±»å‹èŒƒå›´å†…</span>
    <span class="hljs-string">'type-enum'</span>: [
      <span class="hljs-number">2</span>,
      <span class="hljs-string">'always'</span>,
      [
        <span class="hljs-string">'feat'</span>, <span class="hljs-comment">// æ–°åŠŸèƒ½ feature</span>
        <span class="hljs-string">'fix'</span>, <span class="hljs-comment">// ä¿®å¤ bug</span>
        <span class="hljs-string">'docs'</span>, <span class="hljs-comment">// æ–‡æ¡£æ³¨é‡Š</span>
        <span class="hljs-string">'style'</span>, <span class="hljs-comment">// ä»£ç æ ¼å¼(ä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨)</span>
        <span class="hljs-string">'refactor'</span>, <span class="hljs-comment">// é‡æ„(æ—¢ä¸å¢åŠ æ–°åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bug)</span>
        <span class="hljs-string">'perf'</span>, <span class="hljs-comment">// æ€§èƒ½ä¼˜åŒ–</span>
        <span class="hljs-string">'test'</span>, <span class="hljs-comment">// å¢åŠ æµ‹è¯•</span>
        <span class="hljs-string">'chore'</span>, <span class="hljs-comment">// æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨</span>
        <span class="hljs-string">'revert'</span>, <span class="hljs-comment">// å›é€€</span>
        <span class="hljs-string">'build'</span> <span class="hljs-comment">// æ‰“åŒ…</span>
      ]
    ],
    <span class="hljs-comment">// subject å¤§å°å†™ä¸åšæ ¡éªŒ</span>
    <span class="hljs-string">'subject-case'</span>: [<span class="hljs-number">0</span>]
  },
  <span class="hljs-comment">// cz-git çš„äº¤äº’é…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºå®šåˆ¶äº¤äº’ç•Œé¢ï¼‰</span>
  <span class="hljs-attr">prompt</span>: {
    <span class="hljs-attr">useEmoji</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦ä½¿ç”¨ emoji</span>
    <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œè‡ªå®šä¹‰æç¤ºè¯­ï¼Œä¾‹å¦‚ä¸­æ–‡åŒ–</span>
    <span class="hljs-attr">messages</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'é€‰æ‹©ä½ è¦æäº¤çš„ç±»å‹ :'</span>,
      <span class="hljs-attr">scope</span>: <span class="hljs-string">'é€‰æ‹©ä¸€ä¸ªæäº¤èŒƒå›´ï¼ˆå¯é€‰ï¼‰:'</span>,
      <span class="hljs-attr">customScope</span>: <span class="hljs-string">'è¯·è¾“å…¥è‡ªå®šä¹‰çš„æäº¤èŒƒå›´ :'</span>,
      <span class="hljs-attr">subject</span>: <span class="hljs-string">'å¡«å†™ç®€çŸ­ç²¾ç‚¼çš„å˜æ›´æè¿° :\n'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-string">'å¡«å†™æ›´åŠ è¯¦ç»†çš„å˜æ›´æè¿°ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ "|" æ¢è¡Œ :\n'</span>,
      <span class="hljs-attr">breaking</span>: <span class="hljs-string">'åˆ—ä¸¾éå…¼å®¹æ€§é‡å¤§çš„å˜æ›´ï¼ˆå¯é€‰ï¼‰ã€‚ä½¿ç”¨ "|" æ¢è¡Œ :\n'</span>,
      <span class="hljs-attr">footerPrefixsSelect</span>: <span class="hljs-string">'é€‰æ‹©å…³è”issueå‰ç¼€ï¼ˆå¯é€‰ï¼‰:'</span>,
      <span class="hljs-attr">customFooterPrefix</span>: <span class="hljs-string">'è¾“å…¥è‡ªå®šä¹‰issueå‰ç¼€ :'</span>,
      <span class="hljs-attr">footer</span>: <span class="hljs-string">'åˆ—ä¸¾å…³è”issue (å¯é€‰) ä¾‹å¦‚: #31, #I3244 :\n'</span>,
      <span class="hljs-attr">confirmCommit</span>: <span class="hljs-string">'æ˜¯å¦æäº¤æˆ–ä¿®æ”¹commit ?'</span>
    },
    <span class="hljs-comment">// è®¾ç½® scope èŒƒå›´ï¼ˆæ ¹æ®é¡¹ç›®æ¨¡å—è°ƒæ•´ï¼‰</span>
    <span class="hljs-attr">scopes</span>: [<span class="hljs-string">'components'</span>, <span class="hljs-string">'hooks'</span>, <span class="hljs-string">'utils'</span>, <span class="hljs-string">'styles'</span>, <span class="hljs-string">'deps'</span>]
  }
}
</code></pre>
<p>æ·»åŠ  Huskyé’©å­ï¼Œæäº¤æ—¶æ ¡éªŒ commit message æ ¼å¼ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">"npx --no-install commitlint --edit \$1"</span> &gt; .husky/commit-msg
</code></pre>
<h4 data-id="heading-55">ç»“æœæ¼”ç¤º</h4>
<p>ç°åœ¨æœ‰6ä¸ªä¿®æ”¹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d266c6c298a4044858ed6facd7ac01f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=KYI5Aj1KKpF5iigJbNDIiuZ6Sa0%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#æ·»åŠ åˆ°æš‚å­˜åŒº</span>
git add .
<span class="hljs-comment"># æ‰§è¡Œcommit scriptï¼ˆæ›¿ä»£git commitï¼‰</span>
pnpm commit
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b120e505595427a89519bf26ed2fb5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC6Lip5Z2R5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764510392&amp;x-signature=c6%2F30T2Tw1txwtgputowpGujZgU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-56">å…­ã€å®æˆ˜monorepoå½¢å¼çš„npmé¡¹ç›®</h2>
<p>å…³äºè¿™ä¸€å—ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ä¸€ä¸ªé¡¹ç›® <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffkcaikengren%2Funi-hooks" target="_blank" title="https://github.com/fkcaikengren/uni-hooks" ref="nofollow noopener noreferrer">@caikengren/uni-hooks</a>ï¼Œåç»­æˆ‘ä¼šæ ¹æ®è¿™ä¸ªé¡¹ç›®å±•å¼€å†™å‡ ç¯‡åšå®¢å’Œå¤§å®¶ä¸€èµ·äº¤æµå­¦ä¹ ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å¼€å‘å®æˆ˜ç¬”è®°ï¼šä¸ºä»€ä¹ˆä» Axios åˆ° TanStack Queryï¼Œæ˜¯å·¥ç¨‹åŒ–æ¼”è¿›çš„å¿…ç„¶ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575468252656123945</link>    <guid>https://juejin.cn/post/7575468252656123945</guid>    <pubDate>2025-11-23T13:42:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575468252656123945" data-draft-id="7575655132755656723" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å¼€å‘å®æˆ˜ç¬”è®°ï¼šä¸ºä»€ä¹ˆä» Axios åˆ° TanStack Queryï¼Œæ˜¯å·¥ç¨‹åŒ–æ¼”è¿›çš„å¿…ç„¶ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-23T13:42:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…”å­é›¶1024"/> <meta itemprop="url" content="https://juejin.cn/user/3743194047592062"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å¼€å‘å®æˆ˜ç¬”è®°ï¼šä¸ºä»€ä¹ˆä» Axios åˆ° TanStack Queryï¼Œæ˜¯å·¥ç¨‹åŒ–æ¼”è¿›çš„å¿…ç„¶ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3743194047592062/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…”å­é›¶1024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:42:39.000Z" title="Sun Nov 23 2025 13:42:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>å…³é”®è¯ï¼šAxios / TanStack Query / React Query / å‰ç«¯å·¥ç¨‹åŒ– / æ•°æ®ç¼“å­˜ / æ¥å£æŠ½è±¡ / å¹¶å‘æ§åˆ¶ / å¤±æ•ˆç­–ç•¥ / ä¸­åå°ç³»ç»Ÿ / é•¿æœŸç»´æŠ¤</p>
<hr/>
<h2 data-id="heading-0">å¼•è¨€ï¼šä»ã€Œæ‰‹å†™è¯·æ±‚ã€åˆ°ã€Œæ•°æ®ç¼–æ’ã€çš„è½¬æŠ˜</h2>
<p>æœ‰ä¸€å®¶åš B ç«¯ä¸­åå°çš„å›¢é˜Ÿï¼ŒæŠ€æœ¯æ ˆå¾ˆå…¸å‹ï¼šReact + TypeScript + Axios + è‡ªå·±å°ä¸€å±‚ <code>request.ts</code>ã€‚<br/>
å‰ä¸¤å¹´ä¸šåŠ¡å¿«é€Ÿå¢é•¿ï¼Œè¿­ä»£é£å¿«ï¼Œå¤§å®¶éƒ½è§‰å¾—è¿™å¥—ç»„åˆ<strong>ç®€å•ã€é«˜æ•ˆã€å¤Ÿç”¨</strong>ã€‚</p>
<p>ç›´åˆ°ç³»ç»Ÿè§„æ¨¡ä¸Šæ¥ï¼Œé—®é¢˜å¼€å§‹å¯†é›†å‡ºç°ï¼š</p>
<ul>
<li><strong>åŒä¸€ä¸ªæ¥å£è¢«ä¸åŒé¡µé¢å„è‡ªè¯·æ±‚ã€å„è‡ªç¼“å­˜ã€å„è‡ªå¤„ç† loading å’Œé”™è¯¯</strong></li>
<li><strong>åˆ—è¡¨ã€è¯¦æƒ…ã€å¼¹çª—ä¹‹é—´çš„æ•°æ®ä¸åŒæ­¥ï¼Œåˆ·æ–°é¡µé¢æ‰èƒ½ã€Œè‡ªæ„ˆã€</strong></li>
<li><strong>åˆ†é¡µã€ç­›é€‰ã€è½®è¯¢ã€é¢„åŠ è½½é€»è¾‘æ•£è½åœ¨å‡ åä¸ªç»„ä»¶é‡Œï¼Œæ²¡äººæ•¢åŠ¨</strong></li>
<li><strong>åŸ‹ç‚¹ã€é‡è¯•ã€é™çº§ã€è¶…æ—¶ç­–ç•¥ï¼Œä¸€åŠé çº¦å®šï¼Œä¸€åŠé è¿æ°”</strong></li>
</ul>
<p>æœ€åä»–ä»¬ä¸å¾—ä¸åšä¸€ä¸ªå†³ç­–ï¼š<strong>æŠŠã€Œè¯·æ±‚ã€å½“æˆã€Œæ•°æ®æºã€ï¼Œè€Œä¸æ˜¯å·¥å…·å‡½æ•°</strong>ï¼Œä»æ‰‹å†™ Axios å°è£…ï¼Œèµ°å‘ TanStack Query è¿™ä¸€ç±»ã€Œæ•°æ®è·å–æ¡†æ¶ã€ã€‚</p>
<p>ç°å®é‡Œï¼Œç±»ä¼¼çš„è¿ç§»å¹¶ä¸å°‘è§ï¼š</p>
<ul>
<li>å¾ˆå¤šæ—©æœŸç”¨ Axios + Redux-Saga / MobX çš„é¡¹ç›®ï¼Œåé¢æŠŠã€ŒæœåŠ¡ç«¯æ•°æ®ã€ç»Ÿä¸€è¿åˆ° React Query / TanStack Query</li>
<li>ä¸€äº›é‡å‰åç«¯åˆ†ç¦»çš„ SaaSï¼ŒæŠŠè¯·æ±‚å±‚æ”¶å£åˆ° Query å±‚ï¼ŒBFFã€å‰ç«¯ã€ç§»åŠ¨ç«¯å…±äº«ä¸€å¥—ã€Œæ•°æ®å¥‘çº¦ã€</li>
<li>ä¸€äº›å¤§å‚å†…éƒ¨ä¸­å°ä½“ç³»é‡Œï¼ŒAxios åªè´Ÿè´£ä¼ è¾“ï¼ŒçœŸæ­£çš„ã€Œæ¥å£ä½¿ç”¨è§„èŒƒã€å…¨éƒ¨å†™è¿› Query å±‚</li>
<li>ç”šè‡³ Vue ç”Ÿæ€ä¹Ÿæœ‰ Vue Queryã€@tanstack/vue-queryï¼Œèµ°çš„æ˜¯åŒä¸€æ¡è·¯ï¼š<strong>ä»è¯·æ±‚å·¥å…·åˆ°æ•°æ®ç¼–æ’å±‚</strong></li>
</ul>
<p>é—®é¢˜ä»æ¥ä¸æ˜¯ã€ŒAxios ä¸è¡Œã€ï¼Œè€Œæ˜¯å½“ç³»ç»Ÿå˜å¤§ä¹‹åï¼Œ<strong>å®ƒæœ¬æ¥ä¸æƒ³ç®¡çš„é‚£äº›ä¸œè¥¿ï¼Œè¢«æ— é™æ”¾å¤§</strong>ã€‚</p>
<blockquote>
<p><strong>è¿™ä¸æ˜¯å·¥å…·ä¹‹äº‰ï¼Œè€Œæ˜¯ï¼šä½ æŠŠã€ŒæœåŠ¡ç«¯çŠ¶æ€ã€å½“æˆä»€ä¹ˆæ¥çœ‹ã€‚æ˜¯ä¸€æ¬¡è°ƒç”¨ï¼Œè¿˜æ˜¯ä¸€ä¸ªé•¿æœŸå­˜åœ¨ã€éœ€è¦è¢«ç®¡ç†çš„èµ„æºã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-1">ä¸€ã€é»„é‡‘æ—¶ä»£ï¼šåªæœ‰ Axios çš„é‚£äº›å¹´</h2>
<h3 data-id="heading-2">1.1 æ‰‹å†™å°è£…å¸¦æ¥çš„æŒæ§æ„Ÿ</h3>
<p>å¤§éƒ¨åˆ†å›¢é˜Ÿçš„èµ·ç‚¹éƒ½é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// apiClient.ts</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> apiClient = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'/api'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
});

apiClient.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
  <span class="hljs-comment">// åŠ  tokenã€traceIdã€ç»Ÿä¸€ header ç­‰</span>
  <span class="hljs-keyword">return</span> config;
});

apiClient.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">resp</span>) =&gt;</span> resp.<span class="hljs-property">data</span>,
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-comment">// ç»Ÿä¸€é”™è¯¯å¤„ç† / å¼¹ Toast / ä¸ŠæŠ¥</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  },
);
</code></pre>
<p>å†å¾€ä¸Šå°ä¸€å±‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// userApi.ts</span>
<span class="hljs-keyword">import</span> { apiClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'./apiClient'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getUser</span> = (<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;
  apiClient.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/users/<span class="hljs-subst">${id}</span>`</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateUser</span> = (<span class="hljs-params">id: <span class="hljs-built_in">string</span>, payload: UpdateUserDto</span>) =&gt;
  apiClient.<span class="hljs-title function_">put</span>(<span class="hljs-string">`/users/<span class="hljs-subst">${id}</span>`</span>, payload);
</code></pre>
<p>ç»„ä»¶é‡Œç›´æ¥ç”¨ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> [user, setUser] = useState&lt;<span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">getUser</span>(userId).<span class="hljs-title function_">then</span>(setUser);
}, [userId]);
</code></pre>
<ul>
<li><strong>ä¸€åˆ‡éƒ½å¾ˆç›´è§‚</strong>ï¼š<code>get</code> / <code>post</code> / <code>put</code>ï¼Œã€Œæˆ‘è°ƒç”¨ï¼Œæˆ‘æ‹¿ç»“æœã€ã€‚</li>
<li><strong>å°è£…æˆæœ¬å¾ˆä½</strong>ï¼šå‡ ç™¾è¡Œå°±èƒ½æå‡ºä¸€å¥—ã€Œå…¨å±€è¯·æ±‚ä½“ç³»ã€ã€‚</li>
<li><strong>å‰æœŸéå¸¸é«˜æ•ˆ</strong>ï¼šæ–°æ¥å£åªè¦åœ¨ <code>xxxApi.ts</code> é‡ŒåŠ ä¸€ä¸ªå‡½æ•°ï¼Œå›è°ƒé‡Œå†™é€»è¾‘å°±å®Œäº‹ã€‚</li>
</ul>
<p>è¿™å°±æ˜¯å¾ˆå¤šå›¢é˜Ÿçš„ã€ŒAxios é»„é‡‘æ—¶ä»£ã€ã€‚</p>
<h3 data-id="heading-3">1.2 çµæ´»è‡ªç”±èƒŒåçš„éšå½¢å¤æ‚åº¦</h3>
<p>é—®é¢˜æ˜¯ï¼Œä½ ç”¨ Axios åšäº†ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li><strong>æŠŠã€Œç½‘ç»œè¯·æ±‚ã€å½“å·¥å…·å‡½æ•°ç”¨</strong></li>
<li><strong>æŠŠã€ŒæœåŠ¡ç«¯çŠ¶æ€ã€å½“æœ¬åœ°å˜é‡ç”¨</strong></li>
</ul>
<p>å‰æœŸè¿™ä¹ˆå¹²æ²¡é—®é¢˜ï¼Œä½†è¿™äº›ä¸œè¥¿å¾ˆå®¹æ˜“å¤±æ§ï¼š</p>
<ul>
<li>æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥éšæ‰‹å‘è¯·æ±‚ï¼š<code>useEffect + axios</code> åˆ°å¤„éƒ½æ˜¯</li>
<li>loading / error å„å†™ä¸€éï¼Œé£æ ¼ä¸ç»Ÿä¸€ï¼Œè¿˜ä¸ä¸€å®šéƒ½å¤„ç†</li>
<li>æ•°æ®ç”Ÿå‘½å‘¨æœŸå…¨é ã€Œäººè„‘è®°å¿†ã€ï¼šéœ€è¦åˆ·æ–°å°± <code>refetch</code>ï¼Œä¸éœ€è¦å°±ä¸ç®¡</li>
</ul>
<p><strong>å½“ç³»ç»Ÿå°çš„æ—¶å€™ï¼Œè¿™å«ã€Œçµæ´»ã€ï¼›å½“ç³»ç»Ÿå¤§äº†ï¼Œè¿™å«ã€Œä¸å¯é¢„æµ‹ã€ã€‚</strong></p>
<blockquote>
<p>ã€Œç”¨ Axiosï¼Œä½ æ‹¥æœ‰çš„æ˜¯è‡ªç”±ï¼›<br/>
ç”¨å¤šäº†ï¼Œä½ å‘ç°è‡ªç”±æœ¬èº«å°±æ˜¯å¤æ‚åº¦ã€‚ã€</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">äºŒã€å½“ç³»ç»Ÿå˜å¤§åï¼Œä¸€åˆ‡éƒ½å˜äº†ï¼šè¯·æ±‚ä»ã€Œå·¥å…·ã€å˜æˆã€Œç‰©ç†è§„å¾‹ã€</h2>
<h3 data-id="heading-5">2.1 å¹¶å‘å’Œé‡å¤è¯·æ±‚ï¼šå¸¦å®½è¢«ä½ è‡ªå·±æ‰“çˆ†</h3>
<p>å…¸å‹åœºæ™¯ï¼š</p>
<ul>
<li>é¡µé¢ A åˆ—è¡¨è¯·æ±‚ <code>/users</code></li>
<li>ç‚¹å‡»æŸè¡Œè¿›å…¥è¯¦æƒ…é¡µ Bï¼Œå†è¯·æ±‚ä¸€æ¬¡ <code>/users/:id</code></li>
<li>å³ä¾§æŠ½å±‰ C ä¹Ÿè¦åŒä¸€ä¸ªè¯¦æƒ…ï¼Œå†æ¥ä¸€æ¬¡ <code>/users/:id</code></li>
</ul>
<p>å¦‚æœä½ åªæ˜¯ã€Œåœ¨éœ€è¦çš„åœ°æ–¹å‘è¯·æ±‚ã€ï¼Œå¾ˆå¿«å°±ä¼šå‡ºç°ï¼š</p>
<ul>
<li><strong>åŒä¸€èµ„æºè¢«å¤šå¤„é‡å¤è¯·æ±‚</strong>ï¼šæµªè´¹å¸¦å®½å’ŒæœåŠ¡ç«¯èµ„æº</li>
<li>æ‰‹åŠ¨å»é‡å¾ˆéš¾åšç»Ÿä¸€ï¼šå„å¤„ <code>useRef</code> + <code>cancalToken</code>ï¼Œä»£ç é£æ ¼å®Œå…¨ä¸ä¸€æ ·</li>
<li>æ»šåŠ¨åŠ è½½ã€é¢„åŠ è½½ã€è½®è¯¢ã€å¹¶å‘ç»„åˆè¯·æ±‚ï¼Œ<strong>æ¯ä¸€ä¸ªéƒ½æ˜¯ä¸“é¡¹å·¥ç¨‹</strong></li>
</ul>
<p>æœ¬è´¨ä¸Šï¼š<strong>ä½ åœ¨ã€Œç‚¹çŠ¶ã€åœ°ç”¨ Axiosï¼Œè€Œä¸æ˜¯ã€Œé¢çŠ¶ã€åœ°ç®¡ç†æ•°æ®æºã€‚</strong></p>
<h3 data-id="heading-6">2.2 æ•°æ®è¿‡æœŸä¸ä¸€è‡´æ€§ï¼šä»€ä¹ˆæ—¶å€™è¯¥åˆ·æ–°ï¼Ÿ</h3>
<p>å½“ä¸šåŠ¡å˜å¤æ‚ï¼Œä½ ä¼šç¢°åˆ°è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li>A é¡µé¢æ”¹äº†ç”¨æˆ·ä¿¡æ¯ï¼ŒB é¡µé¢å¹¶ä¸çŸ¥é“ï¼Œè¦ä¸è¦åˆ·æ–°ï¼Ÿ</li>
<li>Tab1 æ”¹äº†ç­›é€‰æ¡ä»¶ï¼ŒTab2 é‡Œçš„å›¾è¡¨è¦ä¸è¦è·Ÿç€æ›´æ–°ï¼Ÿ</li>
<li>è¯¦æƒ…å¼¹çª—å…³é—­åï¼Œåé¢çš„åˆ—è¡¨æ˜¯å¦éœ€è¦é‡æŸ¥ä¸€æ¬¡ï¼Ÿ</li>
</ul>
<p>å¦‚æœä½ ç”¨çš„æ˜¯ã€Œç»„ä»¶å†…å‘è¯·æ±‚ + æœ¬åœ° stateã€ï¼Œè¿™äº›é—®é¢˜å¾ˆéš¾ç»Ÿä¸€å›ç­”ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>æ²¡æœ‰<strong>ç»Ÿä¸€çš„ã€Œèµ„æºè§†è§’ã€</strong>ï¼šç³»ç»Ÿä¸çŸ¥é“ã€Œå½“å‰æœ‰å“ªäº›èµ„æºåœ¨ç”¨ã€ã€Œå“ªäº›å·²ç» staleã€</li>
<li>æ²¡æœ‰<strong>ç»Ÿä¸€çš„ã€Œå¤±æ•ˆç­–ç•¥ã€</strong>ï¼šåªèƒ½åœ¨ã€ŒæŸä¸ªæ“ä½œä¹‹åã€å‡­ç»éªŒ <code>reload</code> ä¸€ä¸‹</li>
<li>æ²¡æœ‰<strong>ç»Ÿä¸€çš„ã€Œè§‚å¯Ÿç‚¹ã€</strong>ï¼šä¹Ÿå°±è°ˆä¸ä¸Šå¯è§‚æµ‹æ€§å’Œè°ƒè¯•</li>
</ul>
<blockquote>
<p>ã€Œå½“ä½ å¼€å§‹é—®ã€è¯¥ä¸è¯¥é‡æ–°è¯·æ±‚ï¼Ÿã€çš„æ—¶å€™ï¼Œ<br/>
è¯´æ˜ä½ éœ€è¦çš„å·²ç»ä¸æ˜¯ä¸€ä¸ªè¯·æ±‚åº“ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨ã€‚ã€</p>
</blockquote>
<h3 data-id="heading-7">2.3 åŠ è½½ä¸é”™è¯¯çŠ¶æ€ï¼šè¢«å¤åˆ¶ç²˜è´´åƒæ‰çš„å¯ç»´æŠ¤æ€§</h3>
<p>å‡ ä¹æ¯ä¸ªç»„ä»¶é‡Œï¼Œéƒ½èƒ½çœ‹åˆ°ç±»ä¼¼çš„æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
<span class="hljs-keyword">const</span> [error, setError] = useState&lt;<span class="hljs-title class_">Error</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-title function_">getUser</span>(userId)
    .<span class="hljs-title function_">then</span>(setUser)
    .<span class="hljs-keyword">catch</span>(setError)
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>));
}, [userId]);
</code></pre>
<p>å½“ä½ æœ‰ï¼š</p>
<ul>
<li>50+ é¡µé¢</li>
<li>200+ æ¥å£</li>
<li>10+ äººåŒæ—¶æ”¹ UI</li>
</ul>
<p>ä½ ä¼šå‘ç°ï¼š</p>
<ul>
<li>loading / error çš„é€»è¾‘åˆ°å¤„éƒ½æ˜¯ copy / paste</li>
<li>æœ‰äººä¼šå¿˜è®° <code>.finally</code>ï¼Œæœ‰äººä¼šåœ¨ error é‡Œç›´æ¥ <code>message.error</code></li>
<li>å‡ºç°ã€ŒåªåŠ è½½ä¸å±•ç¤ºé”™è¯¯ã€æˆ–è€…ã€Œåªå±•ç¤ºé”™è¯¯ä¸åŠ è½½ã€çš„å¥‡æ€ªçŠ¶æ€</li>
</ul>
<p><strong>è¿™äº›éƒ½æ˜¯å·¥ç¨‹å€ºï¼Œä½†åœ¨ Axios è¿™ä¸ªå±‚é¢ï¼Œä½ å‡ ä¹æ— ä»çº¦æŸã€‚</strong></p>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€TanStack Queryï¼šå…‹åˆ¶åˆ°è¿‘ä¹å•°å—¦çš„è‰ºæœ¯</h2>
<h3 data-id="heading-9">3.1 ä»ã€Œè¯·æ±‚ä¸€æ¬¡ã€åˆ°ã€Œå£°æ˜æ•°æ®æºã€</h3>
<p>TanStack Queryï¼ˆReact Queryï¼‰å¹²çš„äº‹éå¸¸ç›´æ¥ï¼š</p>
<blockquote>
<p><strong>æŠŠã€ŒæœåŠ¡ç«¯çŠ¶æ€ã€æŠ½å‡ºæ¥ï¼Œå˜æˆä¸€ä¸ªå¯ä»¥è¢«å£°æ˜ã€ç¼“å­˜ã€å…±äº«ã€å¤±æ•ˆå’Œè§‚å¯Ÿçš„ã€Œèµ„æºã€ã€‚</strong></p>
</blockquote>
<p>ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tanstack/react-query'</span>;
<span class="hljs-keyword">import</span> { getUser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/apis/user'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserDetail</span>(<span class="hljs-params">{ userId }: { userId: <span class="hljs-built_in">string</span> }</span>) {
  <span class="hljs-keyword">const</span> { data, isLoading, error } = <span class="hljs-title function_">useQuery</span>({
    <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'user'</span>, userId],
    <span class="hljs-attr">queryFn</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getUser</span>(userId),
    <span class="hljs-attr">staleTime</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 5 åˆ†é’Ÿå†…è§†ä¸ºæ–°é²œï¼Œä¸é‡æ–°è¯·æ±‚</span>
  });

  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>è¿™é‡Œæœ‰å‡ ä¸ªå·¥ç¨‹ä¸Šçš„å…³é”®ç‚¹ï¼š</p>
<ul>
<li><strong>queryKey æ˜¯èµ„æº ID</strong>ï¼š<code>['user', userId]</code> æŠŠã€Œè¿™ä¸ªç”¨æˆ·ã€å½“æˆä¸€ä¸ªèµ„æºï¼Œè€Œä¸ä»…æ˜¯ä¸€æ¬¡è°ƒç”¨</li>
<li><strong>ç¼“å­˜ä¸æ–°é²œåº¦æœ‰é…ç½®</strong>ï¼š<code>staleTime</code> æŠŠã€Œä»€ä¹ˆæ—¶å€™è¯¥é‡æ–°è¯·æ±‚ã€ä»ç»„ä»¶é€»è¾‘é‡ŒæŠ½å‡ºæ¥</li>
<li><strong>åŠ è½½ä¸é”™è¯¯çŠ¶æ€é›†ä¸­ç®¡ç†</strong>ï¼š<code>isLoading</code> / <code>error</code> çš„è¡Œä¸ºåœ¨æ•´ä¸ªé¡¹ç›®é‡Œè¶‹äºä¸€è‡´</li>
</ul>
<p>è¿™å°±æ˜¯å®ƒçœ‹èµ·æ¥æœ‰ç‚¹ã€Œå•°å—¦ã€çš„åœ°æ–¹ï¼š<strong>ä½ å¿…é¡»å…ˆæŠŠèµ„æºã€Œå‘½åã€æ¸…æ¥šï¼Œå†å»ç”¨å®ƒ</strong>ã€‚</p>
<h3 data-id="heading-10">3.2 çº¦æŸå¸¦æ¥çš„å·¥ç¨‹æ”¶ç›Šï¼šå»é‡ã€ç¼“å­˜ã€å¤±æ•ˆç»Ÿä¸€åŒ–</h3>
<p>ä¸€æ—¦æœ‰äº†ç»Ÿä¸€çš„ Query å±‚ï¼Œä½ å¯ä»¥è·å¾—ä¸€å †ã€Œä¸å†é‡å¤é€ è½®å­ã€çš„èƒ½åŠ›ï¼š</p>
<ul>
<li><strong>è¯·æ±‚å»é‡</strong>ï¼šåŒä¸€ä¸ª <code>queryKey</code> åœ¨åŒä¸€æ—¶é—´æ®µå†…å¤šæ¬¡è§¦å‘ï¼ŒTanStack Query ä¼šè‡ªåŠ¨åˆå¹¶</li>
<li><strong>ç¼“å­˜å¤ç”¨</strong>ï¼šé¡µé¢ A è¯·æ±‚è¿‡çš„ç”¨æˆ·æ•°æ®ï¼Œé¡µé¢ B ç›´æ¥å¤ç”¨ï¼Œç”šè‡³éƒ½ä¸éœ€è¦é‡æ–°å‘è¯·æ±‚</li>
<li><strong>å¤±æ•ˆç­–ç•¥ç»Ÿä¸€</strong>ï¼š<code>queryClient.invalidateQueries(['user'])</code> å°±å¯ä»¥è®©å…¨å±€æ‰€æœ‰ç”¨æˆ·ç›¸å…³çš„æ•°æ®æŒ‰çº¦å®šç­–ç•¥åˆ·æ–°</li>
<li><strong>é‡è¯• / è¶…æ—¶ / é€€é¿</strong>ï¼šè¿™äº›éƒ½è¢«æ”¾è¿›ä¸€å¥—å¯é…ç½®çš„ã€Œç‰©ç†è§„å¾‹ã€ï¼Œè€Œä¸æ˜¯ä¸€å®¶ä¸€ä¸ªå†™æ³•</li>
</ul>
<p>ç®€å•å¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// Axios é£æ ¼ï¼ˆä¼ªä»£ç ï¼‰</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">getUser</span>(userId).<span class="hljs-title function_">then</span>(setUser);
}, [userId]);

<span class="hljs-comment">// TanStack Query é£æ ¼</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: user } = <span class="hljs-title function_">useUserQuery</span>(userId);
</code></pre>
<p><code>useUserQuery</code> é‡Œé¢å¯ä»¥å†…ç½®ï¼š</p>
<ul>
<li>ç¼“å­˜æ—¶é—´</li>
<li>å¤±è´¥é‡è¯•</li>
<li>é”™è¯¯ä¸ŠæŠ¥</li>
<li>ä¾èµ–çš„å…¶ä»– Queryï¼ˆæ¯”å¦‚éœ€è¦å…ˆæ‹¿åˆ° tokenï¼‰</li>
</ul>
<p>è¿™äº›ä¸œè¥¿ä¸€æ—¦é…å¥½äº†ï¼Œ<strong>è°ƒç”¨æ–¹å°±å†ä¹Ÿä¸ç”¨å…³å¿ƒç»†èŠ‚</strong>ã€‚</p>
<h3 data-id="heading-11">3.3 æŠŠã€ŒæœåŠ¡ç«¯çŠ¶æ€ã€ä»æœ¬åœ°çŠ¶æ€ç®¡ç†é‡Œæ‹†å‡ºå»</h3>
<p>å¾ˆå¤šå›¢é˜Ÿåœ¨ç”¨ Redux / MobX / Zustandï¼Œç¢°åˆ°ä¸€ä¸ªç»å…¸é—®é¢˜ï¼š</p>
<ul>
<li>è¿™ä¸ª state æ˜¯æ”¾å…¨å±€ store é‡Œï¼Œè¿˜æ˜¯æ”¾ç»„ä»¶å†…ï¼Ÿ</li>
<li>è¿™ä¸ªæ•°æ®æ˜¯ã€Œé•¿æœŸé…ç½®ã€ï¼Œè¿˜æ˜¯æœåŠ¡ç«¯è¿”å›çš„æ•°æ®å¿«ç…§ï¼Ÿ</li>
</ul>
<p>TanStack Query çš„æ ¸å¿ƒè§‚ç‚¹æ˜¯ï¼š</p>
<blockquote>
<p><strong>ã€ŒæœåŠ¡ç«¯çŠ¶æ€ã€æ˜¯ä¸€ç±»å®Œå…¨ä¸åŒçš„çŠ¶æ€ã€‚å®ƒæœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸã€æ›´æ–°è§„å¾‹å’Œä¸€è‡´æ€§éœ€æ±‚ã€‚</strong></p>
</blockquote>
<p>ä½ ä¸åº”è¯¥ç”¨åŒä¸€å¥—å·¥å…·ï¼ˆRedux ç­‰ï¼‰å»ç®¡ç†ã€ŒæŒ‰é’®æ˜¯å¦é«˜äº®ã€å’Œã€Œç”¨æˆ·åˆ—è¡¨æ•°æ®ã€è¿™ä¸¤ç§ä¸åŒçš„ä¸œè¥¿ã€‚</p>
<p>æ›´åˆç†çš„åˆ†å·¥æ˜¯ï¼š</p>
<ul>
<li><strong>TanStack Query ç®¡ã€ŒæœåŠ¡ç«¯çŠ¶æ€ã€</strong>ï¼šæ¥å£æ•°æ®ã€ç¼“å­˜ã€å¤±æ•ˆã€é¢„å–ã€å¹¶å‘æ§åˆ¶</li>
<li><strong>æœ¬åœ°çŠ¶æ€åº“ç®¡ã€Œå®¢æˆ·ç«¯çŠ¶æ€ã€</strong>ï¼šUI æ§åˆ¶ã€ä¸´æ—¶è¡¨å•ã€æ‹–æ‹½ä½ç½®ã€ç­›é€‰æ¡ä»¶ç­‰</li>
</ul>
<p>è¿™æ ·ä¸€æ¥ï¼š</p>
<ul>
<li>åœ¨ UI ä»£ç é‡Œï¼Œä½ çœ‹è§ Query åŸºæœ¬å°±çŸ¥é“ã€Œè¿™æ˜¯æœåŠ¡ç«¯æ•°æ®ã€</li>
<li>Query è¿™ä¸€å±‚å¯ä»¥é›†ä¸­åšå¾ˆå¤šã€Œå…¨å±€ä¼˜åŒ–ã€ï¼Œè€Œä¸ç”¨æ”¹æ¯ä¸ªç»„ä»¶</li>
</ul>
<blockquote>
<p>ã€Œæˆç†Ÿçš„å·¥ç¨‹ï¼Œä¸æ˜¯ state å†™åœ¨å“ªï¼Œè€Œæ˜¯ï¼š<br/>
å“ªä¸€ç±» state æœ‰å“ªä¸€ç±»ã€ç‰©ç†è§„å¾‹ã€å’Œã€çº¦æŸã€ã€‚ã€</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">å››ã€æŠ€æœ¯å€º + ä¸šåŠ¡å€ºçš„äº¤ç»‡ï¼šæ‰‹å†™è¯·æ±‚ä½“ç³»å¦‚ä½•æ‹–å®å›¢é˜Ÿ</h2>
<h3 data-id="heading-13">4.1 ä¸€æ¬¡æ€§ Demo ä»£ç ï¼Œè¢«é•¿æœŸè¿è¥æ‹–æˆæ³¥æ½­</h3>
<p>å‡ ä¹æ‰€æœ‰ç³»ç»Ÿéƒ½ç»å†è¿‡è¿™ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>æ—©æœŸç”¨ Axios å†™çš„ã€ŒDemo çº§ã€ä»£ç ï¼Œç›´æ¥è¢«æ‹¿æ¥æ‰©å±•</li>
<li>ã€Œå…ˆè¿™æ ·å†™ç€ï¼Œåé¢æœ‰æ—¶é—´é‡æ„ã€è¿™å¥è¯è¢«è¯´äº†å¾ˆå¤šé</li>
<li>æœ€åå¤§å®¶éƒ½é»˜è®¤ã€Œé‚£å—ä»£ç ä¸èƒ½åŠ¨ã€ï¼Œå› ä¸ºä¸€åŠ¨å°±ä¸€å †å›å½’é—®é¢˜</li>
</ul>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<strong>è¯·æ±‚å±‚æ˜¯æœ€è¢«ä½ä¼°çš„å¤æ‚åº¦æ¥æºä¹‹ä¸€</strong>ï¼š</p>
<ul>
<li>ä¸€å¼€å§‹åªæ˜¯åå‡ ä¸ªæ¥å£ï¼Œæ¯ä¸ªç»„ä»¶å„å†™å„çš„</li>
<li>åé¢å˜æˆå‡ ç™¾ä¸ªæ¥å£ï¼Œæ¯ä¸ªé¡µé¢éƒ½æœ‰ã€Œè‡ªå·±é‚£ä¸€å¥—ã€è¯·æ±‚é€»è¾‘</li>
<li>å†å¾€åï¼Œä¸šåŠ¡å¼€å§‹åå¤æ”¹ç‰ˆï¼Œæ¥å£å‡çº§ / åºŸå¼ƒäº¤ç»‡åœ¨ä¸€èµ·ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“å“ªäº› API è¿˜åœ¨ç”¨</li>
</ul>
<p>å¦‚æœä¸€å¼€å§‹å°±æœ‰ä¸€ä¸ªã€Œç»Ÿä¸€çš„æ•°æ®è·å–å±‚ã€ï¼ˆå“ªæ€•ä¸æ˜¯ TanStack Queryï¼‰ï¼Œå¾ˆå¤šå€ºå¯ä»¥å°‘ä¸€åŠã€‚</p>
<h3 data-id="heading-14">4.2 ã€Œçº¦å®šä¼˜äºé…ç½®ã€çš„å¤±è´¥ï¼šå£å¤´è§„èŒƒä»æ¥ä¸é è°±</h3>
<p>ä½ å¯èƒ½è§è¿‡è¿™äº›å›¢é˜Ÿè§„èŒƒï¼š</p>
<ul>
<li>æ‰€æœ‰è¯·æ±‚éƒ½è¦èµ° <code>request.ts</code></li>
<li>ä¸è¦åœ¨ç»„ä»¶é‡Œç›´æ¥ç”¨ Axios</li>
<li>æ‰€æœ‰æ¥å£éƒ½è¦å†™åœ¨ <code>apis/</code> ç›®å½•ä¸‹</li>
<li>loading ä¸€å¾‹ç”¨ <code>useLoading</code> è¿™ä¸ª hook</li>
</ul>
<p>å¬èµ·æ¥éƒ½å¾ˆåˆç†ï¼Œä½†å®é™…æ‰§è¡Œå¾€å¾€æ˜¯ï¼š</p>
<ul>
<li>æ–°äºº copy ä¸€æ®µæ—§ä»£ç ï¼Œé‡Œé¢ç›´æ¥ <code>axios.get</code>ï¼Œæ²¡äººæ³¨æ„</li>
<li>ä¸€äº›è€ä»£ç æ¥ä¸åŠæ”¹ï¼Œ<code>request.ts</code> å’Œ <code>axios</code> æ··ç”¨</li>
<li>æŸäº›ç‰¹æ®Šé¡µé¢è‡ªå·±æäº†ä¸€å¥— <code>fetchXXX</code> å·¥å…·ï¼Œç†ç”±æ˜¯ã€Œæ›´çµæ´»ã€</li>
</ul>
<p><strong>å£å¤´çº¦å®šåœ¨ 2 ä¸ªäººçš„é¡¹ç›®é‡Œè¿˜è¡Œï¼Œåœ¨ 20 ä¸ªäººçš„é¡¹ç›®é‡Œå‡ ä¹å¿…ç„¶å¤±æ•ˆã€‚</strong></p>
<p>TanStack Query è¿™ç§åº“ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨å¸®ä½ åšä¸€ä»¶äº‹ï¼š</p>
<blockquote>
<p><strong>æŠŠã€Œå›¢é˜Ÿçº¦å®šã€å†™è¿›ã€Œå¯æ‰§è¡Œçš„çº¦æŸã€é‡Œï¼Œè€Œä¸æ˜¯å†™è¿›æ–‡æ¡£ã€‚</strong></p>
</blockquote>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>æ‰€æœ‰è¯»æ“ä½œå¿…é¡»é€šè¿‡ <code>useQuery</code> / <code>useInfiniteQuery</code></li>
<li>æ‰€æœ‰å†™æ“ä½œå¿…é¡»é€šè¿‡ <code>useMutation</code>ï¼Œå¹¶ä¸”æ˜¾å¼å†™æ˜è¦ <code>invalidateQueries</code> å“ªäº›èµ„æº</li>
<li>æ‰€æœ‰æ¥å£è°ƒç”¨éƒ½å¿…é¡»å£°æ˜ <code>queryKey</code>ï¼Œå¦åˆ™æ ¹æœ¬æ²¡åŠæ³•ç”¨</li>
</ul>
<p>è¿™å°±æ˜¯ã€Œç¡¬çº¦æŸã€å¸¦æ¥çš„å·¥ç¨‹æ”¶ç›Šã€‚</p>
<h3 data-id="heading-15">4.3 å¯è§‚æµ‹æ€§ä¸è°ƒè¯•ï¼šå½“é—®é¢˜å˜æˆã€Œè¿™æ¡æ•°æ®æ˜¯ä»å“ªæ¥çš„ï¼Ÿã€</h3>
<p>å¤§å‹å‰ç«¯ç³»ç»Ÿé‡Œï¼Œä¸€ä¸ªéå¸¸å…¸å‹çš„æ’æŸ¥åœºæ™¯æ˜¯ï¼š</p>
<blockquote>
<p>ã€Œä¸ºä»€ä¹ˆè¿™ä¸ªé¡µé¢ä¸Šçš„è¿™ä¸ªæ•°æ®ä¸å¯¹ï¼Ÿã€</p>
</blockquote>
<p>å¦‚æœä½ ç”¨çš„æ˜¯ã€Œåˆ°å¤„æ‰‹å†™ Axiosã€çš„æ¨¡å¼ï¼Œä½ éœ€è¦ï¼š</p>
<ul>
<li>åœ¨ä»£ç é‡Œæ‰¾ã€Œè°åœ¨è¯·æ±‚è¿™ä¸ªæ¥å£ã€</li>
<li>å†æ‰¾ã€Œè°åœ¨æ”¹è¿™ä¸ª stateã€</li>
<li>å†æ‰¾ã€Œæ˜¯ä¸æ˜¯æŸä¸ªç»„ä»¶æ²¡åˆ· / è¢«ç¼“å­˜äº†ã€</li>
</ul>
<p>å¦‚æœä½ æœ‰ Query å±‚ï¼Œä½ å¯ä»¥ï¼š</p>
<ul>
<li>æ‰“å¼€ React Query Devtools / è‡ªå·±å°è£…çš„è°ƒè¯•é¢æ¿</li>
<li>çœ‹çœ‹å½“å‰æœ‰å“ªäº› Queryï¼Œåœ¨ä»€ä¹ˆæ—¶é—´è¢«è¯·æ±‚è¿‡</li>
<li>å“ªäº›è¢« mark ä¸º staleï¼Œå“ªäº›è¢« invalidate è¿‡</li>
</ul>
<p><strong>èµ·ç ä½ æœ‰ä¸€ä¸ªè§‚å¯Ÿã€ŒæœåŠ¡ç«¯çŠ¶æ€ã€çš„ç»Ÿä¸€å…¥å£ã€‚</strong></p>
<blockquote>
<p>ã€Œæ²¡æœ‰å¯è§‚æµ‹æ€§ï¼Œå°±è°ˆä¸ä¸Šå·¥ç¨‹åŒ–ã€‚<br/>
ä½ åªæ˜¯åœ¨ç”¨ç»éªŒå’Œç›´è§‰ï¼Œç¡¬æŠ—ç³»ç»Ÿå¤æ‚åº¦ã€‚ã€</p>
</blockquote>
<hr/>
<h2 data-id="heading-16">äº”ã€ä¸ºä»€ä¹ˆå³ä½¿æ˜¯é¡¶å°–å‰ç«¯å›¢é˜Ÿï¼Œä»ç„¶ä¼šèµ°å‘ TanStack Query</h2>
<h3 data-id="heading-17">5.1 å¹¶ä¸æ˜¯ã€Œå®ƒæ›´æ½®ã€ï¼Œè€Œæ˜¯ã€Œå®ƒæ›´å¯æ§ã€</h3>
<p>é¡¶å°–çš„å‰ç«¯å›¢é˜Ÿå®Œå…¨å¯ä»¥è‡ªå·±é€ ä¸€å¥—ã€Œè¯·æ±‚ + ç¼“å­˜ + å¤±æ•ˆ + å¹¶å‘æ§åˆ¶ã€æ¡†æ¶ã€‚<br/>
å¾ˆå¤šå›¢é˜Ÿä¹Ÿç¡®å®é€ è¿‡ï¼Œä½†æ˜¯ï¼š</p>
<ul>
<li>é€ å‡ºæ¥çš„æ¡†æ¶å¾€å¾€<strong>ä¸å¯ç§»æ¤</strong>ï¼Œæ¢é¡¹ç›®å°±é‡æ–°é€ ä¸€æ¬¡</li>
<li>æ–‡æ¡£è·Ÿä¸ä¸Šè¿­ä»£ï¼Œ<strong>åªå‰©ä¸‹å£å£ç›¸ä¼ çš„ã€Œå†…éƒ¨ best practiceã€</strong></li>
<li>å¾ˆå¤šç»†èŠ‚ï¼ˆæ¯”å¦‚ queryKey å‘½åè§„èŒƒã€å¤±æ•ˆç­–ç•¥ç»„åˆï¼‰æ²¡æœ‰è¢«æ²‰æ·€å‡ºæ¥</li>
</ul>
<p>é€‰æ‹© TanStack Queryï¼Œæœ¬è´¨ä¸Šæ˜¯ï¼š</p>
<ul>
<li><strong>è®¤åŒå®ƒçš„ã€ŒæœåŠ¡ç«¯çŠ¶æ€ = ä¸€ç­‰å…¬æ°‘ã€è¿™ä¸ªå·¥ç¨‹è§‚</strong></li>
<li>ä¸æƒ³å†åœ¨ã€Œè¯·æ±‚å±‚ã€ä¸Šæ— é™é€ è½®å­ï¼Œè€Œæ˜¯æŠŠç²¾åŠ›æ”¾åˆ°ä¸šåŠ¡å’Œä½“éªŒä¸Š</li>
</ul>
<h3 data-id="heading-18">5.2 ç‰©ç†è§„å¾‹ä¸å¯å¯¹æŠ—ï¼šå»¶è¿Ÿã€æŠ–åŠ¨ã€å¤±è´¥ç‡ä¸ä¼šå› ä¸ºä½ ç”¨ä¸ç”¨ Query è€Œæ”¹å˜</h3>
<p>ä¸ç®¡ä½ ç”¨ä¸ç”¨ TanStack Queryï¼Œåç«¯ç³»ç»Ÿéƒ½ä¼šæœ‰ï¼š</p>
<ul>
<li>å»¶è¿ŸæŠ–åŠ¨ï¼ˆp99 æ¯” p50 å¤§ä¸€ä¸ªé‡çº§ï¼‰</li>
<li>çŸ­æš‚å¤±è´¥ï¼ˆç½‘ç»œã€é™æµã€ç¬æ—¶é”™è¯¯ï¼‰</li>
<li>å†·å¯åŠ¨ã€ç¼“å­˜å¤±æ•ˆã€çªå‘æµé‡</li>
</ul>
<p>åŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li>ç”¨ Axiosï¼Œ<strong>æ¯ä¸ªé¡µé¢éƒ½è¦è‡ªå·±åº”å¯¹è¿™äº›ã€Œç‰©ç†è§„å¾‹ã€</strong></li>
<li>ç”¨ TanStack Queryï¼Œè¿™äº›ä¸œè¥¿å¯ä»¥è¢«<strong>æŠ½è±¡æˆç»Ÿä¸€çš„ã€Œç­–ç•¥ã€</strong></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// å…¨å±€é…ç½®ï¼šç»Ÿä¸€é‡è¯•ç­–ç•¥</span>
<span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>({
  <span class="hljs-attr">defaultOptions</span>: {
    <span class="hljs-attr">queries</span>: {
      <span class="hljs-attr">retry</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">retryDelay</span>: <span class="hljs-function">(<span class="hljs-params">attempt</span>) =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">1000</span> * <span class="hljs-number">2</span> ** attempt, <span class="hljs-number">10000</span>),
      <span class="hljs-attr">staleTime</span>: <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
    },
  },
});
</code></pre>
<p>ä½ ä¸ç”¨å†ä¸€éä¸€éåœ°æƒ³ï¼š</p>
<ul>
<li>è¿™ä¸ªè¯·æ±‚è¦ä¸è¦é‡è¯•ï¼Ÿ</li>
<li>è¦ä¸è¦åŠ é€€é¿ï¼Ÿ</li>
<li>è¦ä¸è¦ç¼“å­˜ï¼Ÿç¼“å­˜å¤šä¹…ï¼Ÿ</li>
</ul>
<p><strong>å¤§éƒ¨åˆ†æ—¶å€™ï¼Œå…¨å±€é»˜è®¤å€¼ + ä¸ªåˆ« override å°±å¤Ÿç”¨äº†ã€‚</strong></p>
<blockquote>
<p>ã€ŒçœŸæ­£æ‹–å®ç³»ç»Ÿçš„ä¸æ˜¯å•æ¬¡è°ƒç”¨ï¼Œè€Œæ˜¯ã€åœ¨çœŸå®ç‰©ç†ä¸–ç•Œä¸­ï¼Œæˆåƒä¸Šä¸‡æ¬¡è°ƒç”¨çš„å åŠ æ•ˆåº”ã€ã€‚<br/>
TanStack Query ç®¡çš„æ˜¯åè€…ã€‚ã€</p>
</blockquote>
<h3 data-id="heading-19">5.3 ã€Œé¡¶å°–ã€çš„å«ä¹‰ï¼šä¸æ˜¯ä»£ç å†™å¾—å¤šï¼Œè€Œæ˜¯ç³»ç»Ÿå†™å¾—å°‘ã€é”™å¾—å°‘</h3>
<p>é¡¶å°–å›¢é˜Ÿæœ€ç»ˆå…³å¿ƒçš„æ˜¯ï¼š</p>
<ul>
<li><strong>å›¢é˜Ÿæ•´ä½“çš„äº¤ä»˜é€Ÿåº¦ï¼Œè€Œä¸æ˜¯æŸä¸ªæ¥å£å†™å¾—æœ‰å¤šèŠ±å“¨</strong></li>
<li><strong>ç³»ç»Ÿæ•´ä½“çš„å¯é¢„æµ‹æ€§ï¼Œè€Œä¸æ˜¯æŸä¸ªé¡µé¢è·‘å¾—æœ‰å¤šå¿«</strong></li>
</ul>
<p>åœ¨è¿™ä¸ªå°ºåº¦ä¸‹ï¼ŒTanStack Query ç»™çš„æ˜¯ï¼š</p>
<ul>
<li>æ›´å¯é¢„æµ‹çš„ã€Œæ¥å£ä½¿ç”¨æ–¹å¼ã€</li>
<li>æ›´å¯è§‚æµ‹çš„ã€Œæ•°æ®çŠ¶æ€ã€</li>
<li>æ›´å®¹æ˜“è¢«æ–°åŒå­¦ç†è§£å’Œä¸Šæ‰‹çš„ã€Œç»Ÿä¸€æ¨¡å¼ã€</li>
</ul>
<blockquote>
<p>ã€Œæˆç†Ÿçš„å·¥ç¨‹ï¼Œæœ€é‡è¦çš„ä¸æ˜¯ã€æˆ‘èƒ½åšåˆ°ä»€ä¹ˆã€ï¼Œ<br/>
è€Œæ˜¯ã€æˆ‘ä¸éœ€è¦å†æ‰‹åŠ¨åšåˆ°ä»€ä¹ˆã€ã€‚ã€</p>
</blockquote>
<hr/>
<h2 data-id="heading-20">çœŸå®æ¡ˆä¾‹ï¼šä» Axios åˆ° TanStack Query çš„æ¼”è¿›ä¹‹è·¯</h2>
<h3 data-id="heading-21">æ¡ˆä¾‹ä¸€ï¼šSaaS ä¸­åå°ï¼Œä»ã€Œåˆ°å¤„ useEffectã€åˆ°é›†ä¸­æ•°æ®å±‚</h3>
<ul>
<li><strong>åŸæœ¬æ–¹æ¡ˆ</strong><br/>
React + Axios + è‡ªå°è£… <code>request.ts</code>ï¼Œå‡ åä¸ªé¡µé¢é‡Œå……æ»¡äº† <code>useEffect + axios</code> è°ƒç”¨ï¼Œloading / error / empty å„å†™å„çš„ã€‚</li>
<li><strong>é‡åˆ°çš„ç“¶é¢ˆ</strong><br/>
åˆ—è¡¨å’Œè¯¦æƒ…é¡µæ•°æ®ä¸åŒæ­¥ï¼Œæ“ä½œå®Œéœ€è¦æ‰‹åŠ¨åˆ·æ–°ï¼›<br/>
é‡å¤è¯·æ±‚ä¸¥é‡ï¼ŒåŒä¸€ä¸ªç”¨æˆ·è¯¦æƒ…å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹è¢«è¯·æ±‚ 3â€“4 æ¬¡ï¼›<br/>
æ–°äººå®Œå…¨ä¸çŸ¥é“ã€Œæ”¹å“ªä¸€å—ä¼šå½±å“å“ªäº›é¡µé¢ã€ã€‚</li>
<li><strong>è¿ç§»åçš„æ–¹æ¡ˆ</strong><br/>
å¼•å…¥ TanStack Queryï¼ŒæŠŠæ‰€æœ‰ã€Œè¯»æ¥å£ã€ç»Ÿä¸€æŠ½åˆ° <code>queries/</code> ç›®å½•ï¼Œå¯¼å‡º <code>useUserQuery / useUsersQuery / useProjectQuery</code> ç­‰ï¼›<br/>
æ‰€æœ‰ mutation éƒ½é€šè¿‡ <code>useMutation</code>ï¼Œåœ¨ <code>onSuccess</code> é‡Œç»Ÿä¸€ <code>invalidateQueries</code>ã€‚<br/>
<strong>æ”¶ç›Š</strong>ï¼š
<ul>
<li>æ¥å£ç›¸å…³ bug æ•°é‡ 2 ä¸ªæœˆå†…ä¸‹é™çº¦ 40%</li>
<li>åˆ—è¡¨ä¸è¯¦æƒ…é¡µæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜å‡ ä¹æ¶ˆå¤±</li>
<li>æ–°äººä»ã€Œçœ‹ä¸æ‡‚è¯·æ±‚å±‚ã€åˆ°ã€ŒåŠå¤©èƒ½ä¸Šæ‰‹æ”¹ä¸šåŠ¡ã€</li>
</ul>
</li>
</ul>
<h3 data-id="heading-22">æ¡ˆä¾‹äºŒï¼šç”µå•†ç®¡ç†åå°ï¼Œä»ã€Œä¹è§‚æ›´æ–°åœ°ç‹±ã€åˆ°ç»Ÿä¸€å¤±æ•ˆç­–ç•¥</h3>
<ul>
<li><strong>åŸæœ¬æ–¹æ¡ˆ</strong><br/>
ç”¨ Redux ç®¡å…¨å±€æ•°æ®ï¼Œæ¥å£è°ƒç”¨é€šè¿‡ thunk/middleware åˆ†å‘ï¼Œæ‰‹åŠ¨å†™ä¹è§‚æ›´æ–°é€»è¾‘ã€‚</li>
<li><strong>é‡åˆ°çš„ç“¶é¢ˆ</strong><br/>
ä¹è§‚æ›´æ–°å’Œå®é™…è¿”å›ä¸ä¸€è‡´æ—¶ï¼Œå¾ˆéš¾å›æ»šï¼›<br/>
å¤šäººåŒæ—¶æ“ä½œåº“å­˜ / ä»·æ ¼æ—¶ï¼Œå‰ç«¯çŠ¶æ€ä¸åç«¯çŠ¶æ€ä¸åŒæ­¥ï¼›<br/>
å†™ä¸€ä¸ªå¤æ‚çš„ã€Œæ‰¹é‡æ›´æ–° + æ’¤é”€ã€åŠŸèƒ½éœ€è¦åœ¨å¤šä¸ª reducer ä¹‹é—´æ¥å›è·³ã€‚</li>
<li><strong>è¿ç§»åçš„æ–¹æ¡ˆ</strong><br/>
æŠŠæ‰€æœ‰ã€ŒæœåŠ¡ç«¯çŠ¶æ€ã€ä» Redux è¿åˆ° React Queryï¼ŒRedux ä»…ä¿ç•™ UI æ§åˆ¶å’Œéƒ¨åˆ†å®¢æˆ·ç«¯é…ç½®ï¼›<br/>
æ‰¹é‡æ“ä½œç”¨ <code>useMutation</code> + <code>onMutate / onError / onSettled</code> å†™å‡ºæ ‡å‡†åŒ–çš„ä¹è§‚æ›´æ–°æ¨¡æ¿ã€‚<br/>
<strong>æ”¶ç›Š</strong>ï¼š
<ul>
<li>å¤§éƒ¨åˆ†ä¹è§‚æ›´æ–°é€»è¾‘å¯ä»¥è¢«å¤ç”¨</li>
<li>æ•´ä½“ä»£ç é‡å‡å°‘çº¦ 20%ï¼ˆå¤§é‡é‡å¤ case è¢«åˆ æ‰ï¼‰</li>
<li>å›æ»šé€»è¾‘æ›´é›†ä¸­ï¼Œå¯æµ‹è¯•æ€§æé«˜</li>
</ul>
</li>
</ul>
<h3 data-id="heading-23">æ¡ˆä¾‹ä¸‰ï¼šå†…éƒ¨è¿è¥å·¥å…·ï¼Œä»ã€ŒAPI æ–‡æ¡£ != çœŸå®ä½¿ç”¨æ–¹å¼ã€åˆ°ã€ŒæŸ¥è¯¢å³æ–‡æ¡£ã€</h3>
<ul>
<li><strong>åŸæœ¬æ–¹æ¡ˆ</strong><br/>
æœ‰ Swagger æ–‡æ¡£ï¼Œä½†æ¯ä¸ªå‰ç«¯é¡¹ç›®ï¼ˆPC / H5 / å†…åµŒï¼‰å„å°ä¸€å¥— APIï¼Œå¹¶å„è‡ªæ‹¼è£…ä¸åŒçš„æŸ¥è¯¢å‚æ•°ã€‚</li>
<li><strong>é‡åˆ°çš„ç“¶é¢ˆ</strong><br/>
æ–‡æ¡£æ›´æ–°å’Œå‰ç«¯è°ƒç”¨æ–¹å¼ä¸åŒæ­¥ï¼›<br/>
å¾ˆå¤šæ¥å£æœ‰å¥‡æ€ªçš„ã€Œéšå½¢å­—æ®µã€åªæœ‰ä¸€ä¸ªå›¢é˜ŸçŸ¥é“ï¼›<br/>
è°ƒè¯•æ—¶ç»å¸¸éœ€è¦ã€ŒæŠ“ä¸€éè¯·æ±‚ã€æ‰èƒ½ææ¸…æ¥šåˆ°åº•ä¼ äº†å•¥ã€‚</li>
<li><strong>è¿ç§»åçš„æ–¹æ¡ˆ</strong><br/>
ä»¥ TanStack Query ä¸ºä¸­å¿ƒï¼ŒæŠŠæ¯ä¸€ä¸ªæŸ¥è¯¢å°æˆä¸€ä¸ª <code>useXXXQuery</code>ï¼Œè¿™ä¸ª hook æœ¬èº«å°±<strong>çº¦æŸäº†å‚æ•°ã€è¿”å›ç±»å‹å’Œä½¿ç”¨åœºæ™¯</strong>ï¼›<br/>
ç»™ä¸šåŠ¡æ–¹çš„æ–‡æ¡£ä¸å†æ˜¯ã€Œæ¥å£åˆ—è¡¨ã€ï¼Œè€Œæ˜¯ã€Œå¯å¤ç”¨çš„æŸ¥è¯¢èƒ½åŠ›ã€ã€‚<br/>
<strong>æ”¶ç›Š</strong>ï¼š
<ul>
<li>éƒ¨é—¨é—´çš„åä½œå˜æˆã€Œå¯¹é½æŸ¥è¯¢å®šä¹‰ã€è€Œä¸æ˜¯ã€Œå¯¹é½æ¥å£å­—æ®µã€</li>
<li>æ–°å¢ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼Œåªè¦å¤ç”¨å·²æœ‰çš„ Query æˆ–åœ¨å…¶åŸºç¡€ä¸Šè½»é‡æ‰©å±•</li>
</ul>
</li>
</ul>
<blockquote>
<p>ç»“è®ºå¾ˆä¸€è‡´ï¼š<strong>Axios å¾ˆå¥½ç”¨ï¼Œä½†ä¸é€‚åˆæ‰›å¤§æ¢ã€‚<br/>
çœŸæ­£æ‰›å¤§æ¢çš„ï¼Œæ˜¯å›´ç»•å®ƒä¹‹ä¸Šçš„é‚£å±‚ã€Œæ•°æ®ç¼–æ’å’Œå·¥ç¨‹çº¦æŸã€ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-24">æœ€åˆç†çš„å¹³è¡¡ï¼šåˆ†å±‚åä½œï¼Œè€Œéæ›¿ä»£</h2>
<p>ä¸å…¶è®¨è®ºã€Œè¦ä¸è¦æŠ›å¼ƒ Axiosã€ï¼Œä¸å¦‚æŠŠæ•´ä¸ªæ ˆåˆ†å±‚çœ‹ï¼š</p>



































<table><thead><tr><th>é˜¶æ®µ / å±‚çº§</th><th>æ¨èæŠ€æœ¯ / æ–¹æ¡ˆ</th><th>è®¾è®¡ç›®æ ‡</th></tr></thead><tbody><tr><td>åŸå‹æœŸ / å°é¡¹ç›®</td><td>Axios + è½»é‡å°è£…ï¼ˆ<code>request.ts</code> + å°‘é‡ hooksï¼‰</td><td>å¿«é€Ÿè¯•é”™ï¼Œä½å¿ƒæ™ºè´Ÿæ‹…</td></tr><tr><td>æˆé•¿æœŸä¸­åå°</td><td>Axios + TanStack Queryï¼ˆæˆ– Vue Query ç­‰ï¼‰</td><td>æŠŠæœåŠ¡ç«¯çŠ¶æ€æŠ½è±¡æˆã€Œèµ„æºã€</td></tr><tr><td>æˆç†ŸæœŸ / å¤šå›¢é˜Ÿåä½œ</td><td>Axios + TanStack Query + çº¦å®šå¼ queryKey / ç›®å½•è§„èŒƒ</td><td>ç»Ÿä¸€æ•°æ®è®¿é—®æ¨¡å¼ï¼Œé™ä½åä½œæˆæœ¬</td></tr><tr><td>æè‡´æ€§èƒ½ / ç‰¹æ®Šåœºæ™¯</td><td>Axios + TanStack Query + è‡ªå®šä¹‰ç¼“å­˜å±‚ / Streaming æ–¹æ¡ˆ</td><td>ç²¾ç»†æ§åˆ¶ç¼“å­˜ã€å¸¦å®½ä¸å¹¶å‘</td></tr><tr><td>æ¸è¿›å¼æ”¹é€ é—ç•™é¡¹ç›®</td><td>ä¿ç•™åŸ Axiosï¼Œæ–°å¢åŠŸèƒ½å…¨éƒ¨èµ° TanStack Query</td><td>é¿å…å¤§æ‰‹æœ¯å¼é‡æ„ï¼Œæ¸è¿›æ¼”è¿›</td></tr></tbody></table>
<p>å†ç»†ä¸€ç‚¹åˆ°å‰ç«¯å†…éƒ¨èŒè´£ï¼š</p>






























<table><thead><tr><th>å‰ç«¯å±‚çº§</th><th>æ¨èè§’è‰²åˆ†å·¥</th><th>å…³é”®è¯</th></tr></thead><tbody><tr><td>è¯·æ±‚ä¼ è¾“å±‚</td><td>Axios / fetch / è‡ªç ” HTTP å®¢æˆ·ç«¯</td><td>ä¼ è¾“ã€é‡è¯•ã€ç»Ÿä¸€ header</td></tr><tr><td>æ•°æ®è·å–ç¼–æ’å±‚</td><td>TanStack Query / Vue Query</td><td>ç¼“å­˜ã€å»é‡ã€å¤±æ•ˆã€å¹¶å‘æ§åˆ¶</td></tr><tr><td>ä¸šåŠ¡æœåŠ¡å±‚ï¼ˆhooksï¼‰</td><td><code>useUserService</code> / <code>useOrderService</code> ç­‰</td><td>èšåˆå¤šä¸ª Query + ä¸šåŠ¡è§„åˆ™</td></tr><tr><td>UI ç»„ä»¶å±‚</td><td>åªæ¶ˆè´¹ hooks æš´éœ²çš„æ•°æ®å’ŒçŠ¶æ€</td><td>å…³æ³¨å±•ç¤ºä¸äº¤äº’ï¼Œä¸å…³å¿ƒè¯·æ±‚ç»†èŠ‚</td></tr></tbody></table>
<p><strong>ä¸æ˜¯ã€ŒAxios vs TanStack Queryã€ï¼Œè€Œæ˜¯ï¼š<br/>
Axios è´Ÿè´£ã€Œæ€ä¹ˆå‘ã€ï¼ŒTanStack Query è´Ÿè´£ã€Œæ€ä¹ˆç”¨ã€ï¼Œä¸šåŠ¡ hooks è´Ÿè´£ã€Œç”¨æ¥åšä»€ä¹ˆã€ã€‚</strong></p>
<hr/>
<h2 data-id="heading-25">æ€»ç»“ï¼šä» Axios åˆ° TanStack Queryï¼Œä»å·¥å…·åˆ°å·¥ç¨‹</h2>
<ul>
<li><strong>Axios ä»£è¡¨å±€éƒ¨çš„è‡ªç”±ä¸æŒæ§ï¼ŒTanStack Query ä»£è¡¨å…¨å±€çš„çº¦æŸä¸å¯é¢„æµ‹æ€§</strong>ã€‚</li>
<li><strong>é—®é¢˜ä¸æ˜¯ Axios ä¸è¡Œï¼Œè€Œæ˜¯å½“ç³»ç»Ÿå˜å¤§æ—¶ï¼ŒæœåŠ¡ç«¯çŠ¶æ€çš„ã€Œç‰©ç†è§„å¾‹ã€è¢«æ— é™æ”¾å¤§</strong>ã€‚</li>
<li><strong>é¡¶å°–å›¢é˜ŸçœŸæ­£å…³å¿ƒçš„æ˜¯ã€Œç³»ç»Ÿå†™å¾—å°‘ã€é”™å¾—å°‘ã€ï¼Œè€Œä¸æ˜¯ã€Œè¿™ä¸ªè¯·æ±‚å†™å¾—å¤šå¸…ã€</strong>ã€‚</li>
<li><strong>æˆç†Ÿçš„å‰ç«¯æ¶æ„ï¼Œä¸å†æŠŠã€Œè¯·æ±‚ã€å½“æˆä¸€ä¸ªå·¥å…·è°ƒç”¨ï¼Œè€Œæ˜¯å½“æˆä¸€ä¸ªé•¿æœŸå­˜åœ¨ã€è¢«ç®¡ç†çš„èµ„æº</strong>ã€‚</li>
<li><strong>æœ€åˆç†çš„æ–¹æ¡ˆä»æ¥ä¸æ˜¯ã€Œæ›¿ä»£ã€ï¼Œè€Œæ˜¯ã€Œåˆ†å±‚åä½œã€ï¼šè¯·æ±‚ä¼ è¾“å±‚ã€æ•°æ®ç¼–æ’å±‚ã€ä¸šåŠ¡æœåŠ¡å±‚å„å¸å…¶èŒã€‚</strong></li>
</ul>
<blockquote>
<p>Axios æ˜¯èµ·è·‘æ—¶çš„åŠ é€Ÿå™¨ï¼ŒTanStack Query æ˜¯é•¿è·‘æ—¶çš„é…é€Ÿå™¨ã€‚<br/>
<strong>å‰è€…å¸®ä½ å¿«é€Ÿä¸Šè·¯ï¼Œåè€…è®©ä½ è·‘åˆ°ç»ˆç‚¹ã€‚</strong></p>
</blockquote>
<blockquote>
<p>é€‰æ‹©æŠ€æœ¯ï¼Œå…¶å®æ˜¯åœ¨é€‰æ‹©ä½ å¦‚ä½•å¯¹å¾…å¤æ‚åº¦ï¼šæ˜¯æŠŠå®ƒæ‘Šåœ¨æ¯ä¸ªç»„ä»¶é‡Œï¼Œ<br/>
è¿˜æ˜¯æ”¶å£åˆ°ä¸€å±‚å¯ä»¥è¢«è§‚å¯Ÿã€è¢«çº¦æŸã€è¢«æ¼”è¿›çš„å·¥ç¨‹æŠ½è±¡é‡Œã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-26">å°¾å£°ï¼šæŠ€æœ¯çš„å°½å¤´ï¼Œæ˜¯å·¥ç¨‹å“²å­¦</h2>
<ul>
<li><strong>ç¨³å®šé å¯é¢„æµ‹æ€§</strong>ï¼šåŒä¸€ç±»é—®é¢˜ï¼Œåœ¨ç³»ç»Ÿé‡Œåº”è¯¥æœ‰åŒä¸€ç±»è§£å†³æ–¹å¼ã€‚</li>
<li><strong>å›¢é˜Ÿé çº¦æŸ</strong>ï¼šè¶Šæ˜¯å¤§å‹ç³»ç»Ÿï¼Œè¶Šéœ€è¦æŠŠã€Œçº¦å®šã€å˜æˆã€Œå¯æ‰§è¡Œçš„è§„åˆ™ã€ã€‚</li>
<li><strong>æˆç†Ÿä½“ç°åœ¨å†™å¾—å°‘ã€é”™å¾—å°‘</strong>ï¼šå°‘å†™ä¸€æ¬¡ <code>useEffect + axios</code>ï¼Œå¤šç”¨ä¸€æ¬¡ <code>useXXXQuery</code>ï¼Œå°±æ˜¯æŠŠå¤æ‚åº¦æ¬ç¦»ä¸šåŠ¡ä»£ç ä¸€æ­¥ã€‚</li>
</ul>
<blockquote>
<p>Axios è®©ä½ éšæ—¶å¯ä»¥å†™ä¸€è¡Œè¯·æ±‚ä»£ç ï¼ŒTanStack Query è®©è¿™è¡Œä»£ç èƒŒåæœ‰ä¸€æ•´å¥—ã€Œç‰©ç†è§„å¾‹ã€å…œåº•ã€‚<br/>
æˆç†Ÿçš„å›¢é˜Ÿï¼Œæ—¢æ‡‚å¾—ä»€ä¹ˆæ—¶å€™è¯¥è¿½æ±‚è‡ªç”±ï¼Œä¹Ÿæ‡‚å¾—ä»€ä¹ˆæ—¶å€™è¯¥æŠŠè‡ªç”±æ‰˜ä»˜ç»™æ¡†æ¶ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ•™ç¨‹ï¼šå¦‚ä½•ä¿®æ”¹ Docker å®¹å™¨ bisheng-frontend ä¸­çš„é™æ€æ–‡ä»¶]]></title>    <link>https://juejin.cn/post/7575488180980465664</link>    <guid>https://juejin.cn/post/7575488180980465664</guid>    <pubDate>2025-11-24T01:54:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575488180980465664" data-draft-id="7575644469711110163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ•™ç¨‹ï¼šå¦‚ä½•ä¿®æ”¹ Docker å®¹å™¨ bisheng-frontend ä¸­çš„é™æ€æ–‡ä»¶"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T01:54:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éä¼˜ç§€ç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/3984285870341288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ•™ç¨‹ï¼šå¦‚ä½•ä¿®æ”¹ Docker å®¹å™¨ bisheng-frontend ä¸­çš„é™æ€æ–‡ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285870341288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éä¼˜ç§€ç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:54:50.000Z" title="Mon Nov 24 2025 01:54:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ•™ç¨‹å°†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li><strong>æ•™ç¨‹ç›®æ ‡</strong>ï¼šæ˜ç¡®è¯´æ˜æœ¬æ•™ç¨‹å°†æ•™ä¼šä½ ä»€ä¹ˆã€‚</li>
<li><strong>å‰ææ¡ä»¶</strong>ï¼šåˆ—å‡ºæ‰§è¡Œæœ¬æ•™ç¨‹æ‰€éœ€çš„ç¯å¢ƒå’Œå·¥å…·ã€‚</li>
<li><strong>æ“ä½œæ­¥éª¤</strong>ï¼š
<ul>
<li><strong>æ­¥éª¤ä¸€ï¼šè¿›å…¥å®¹å™¨å¹¶å®šä½æ–‡ä»¶</strong></li>
<li><strong>æ­¥éª¤äºŒï¼šå°†å®¹å™¨å†…æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°</strong></li>
<li><strong>æ­¥éª¤ä¸‰ï¼šåœ¨æœ¬åœ°ä¿®æ”¹æ–‡ä»¶</strong></li>
<li><strong>æ­¥éª¤å››ï¼šé‡æ–°åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½ä¿®æ”¹åçš„æ–‡ä»¶</strong></li>
</ul>
</li>
<li><strong>æ€»ç»“</strong>ï¼šç®€è¦å›é¡¾æ•´ä¸ªæµç¨‹ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-0">æ•™ç¨‹ï¼šå¦‚ä½•ä¿®æ”¹ Docker å®¹å™¨ <code>bisheng-frontend</code> ä¸­çš„é™æ€æ–‡ä»¶</h3>
<h4 data-id="heading-1">ä¸€ã€æ•™ç¨‹ç›®æ ‡</h4>
<p>æœ¬æ•™ç¨‹å°†æŒ‡å¯¼ä½ å¦‚ä½•å®‰å…¨åœ°ä¿®æ”¹è¿è¡Œä¸­çš„ <code>bisheng-frontend</code> Docker å®¹å™¨å†…çš„é™æ€æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€SVG ç­‰ï¼‰ã€‚æˆ‘ä»¬å°†é‡‡ç”¨â€œ<strong>å¤åˆ¶æ–‡ä»¶ -&gt; æœ¬åœ°ä¿®æ”¹ -&gt; æŒ‚è½½é‡å¯</strong>â€çš„æœ€ä½³å®è·µï¼Œä»¥é¿å…ç›´æ¥åœ¨å®¹å™¨å†…ä¿®æ”¹å¸¦æ¥çš„é£é™©ã€‚</p>
<h4 data-id="heading-2">äºŒã€å‰ææ¡ä»¶</h4>
<ol>
<li>å·²å®‰è£… Docker å¹¶èƒ½æ­£å¸¸è¿è¡Œã€‚</li>
<li>å·²å®‰è£… <code>docker-compose</code> (å¦‚æœä½ çš„æœåŠ¡æ˜¯é€šè¿‡ <code>docker-compose</code> å¯åŠ¨çš„)ã€‚</li>
<li>å…·æœ‰å®¿ä¸»æœºçš„å‘½ä»¤è¡Œè®¿é—®æƒé™ï¼Œå¹¶æ‹¥æœ‰ <code>sudo</code> æƒé™ï¼ˆç”¨äºåˆ›å»ºç›®å½•å’Œä¿®æ”¹æƒé™ï¼‰ã€‚</li>
<li>ç¡®è®¤ <code>bisheng-frontend</code> å®¹å™¨æ­£åœ¨è¿è¡Œï¼š
<pre><code class="hljs language-bash" lang="bash">docker ps | grep bisheng-frontend
</code></pre>
</li>
</ol>
<hr/>
<h4 data-id="heading-3">ä¸‰ã€æ“ä½œæ­¥éª¤</h4>
<h5 data-id="heading-4">æ­¥éª¤ä¸€ï¼šè¿›å…¥å®¹å™¨å¹¶å®šä½ç›®æ ‡æ–‡ä»¶</h5>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥å®¹å™¨å†…éƒ¨ï¼Œæ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶çš„å…·ä½“è·¯å¾„ã€‚</p>
<ol>
<li>
<p><strong>è¿›å…¥ <code>bisheng-frontend</code> å®¹å™¨çš„äº¤äº’å¼ç»ˆç«¯</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it bisheng-frontend /bin/bash
</code></pre>
<ul>
<li><code>-it</code>: åˆ›å»ºä¸€ä¸ªäº¤äº’å¼çš„ TTY ç»ˆç«¯ã€‚</li>
<li><code>bisheng-frontend</code>: å®¹å™¨åç§°ã€‚</li>
<li><code>/bin/bash</code>: è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</li>
</ul>
</li>
<li>
<p><strong>åœ¨å®¹å™¨å†…æœç´¢éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶</strong>ï¼š
ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æœç´¢æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶ï¼ˆ<code>.png</code>, <code>.jpg</code>, <code>.svg</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">find / -name <span class="hljs-string">"*.png"</span> -o -name <span class="hljs-string">"*.jpg"</span> -o -name <span class="hljs-string">"*.svg"</span> 2&gt;/dev/null
</code></pre>
<ul>
<li><code>2&gt;/dev/null</code>: å°†æ— å…³çš„æƒé™é”™è¯¯ä¿¡æ¯ä¸¢å¼ƒï¼Œä½¿è¾“å‡ºæ›´å¹²å‡€ã€‚</li>
</ul>
</li>
<li>
<p><strong>è®°å½•æ–‡ä»¶è·¯å¾„</strong>ï¼š
ä»æœç´¢ç»“æœä¸­ï¼Œæ‰¾åˆ°ä½ éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼Œå¹¶è®°ä¸‹å®ƒçš„å®Œæ•´è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>/usr/share/nginx/html/platform/assets/male-technologist-CcgkZdXy.png</code></li>
<li><code>/usr/share/nginx/html/platform/assets/analysis.svg</code></li>
</ul>
</li>
<li>
<p><strong>é€€å‡ºå®¹å™¨</strong>ï¼š
å®Œæˆæ–‡ä»¶å®šä½åï¼Œé€€å‡ºå®¹å™¨ç»ˆç«¯ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">exit</span>
</code></pre>
</li>
</ol>
<h5 data-id="heading-5">æ­¥éª¤äºŒï¼šå°†å®¹å™¨å†…çš„æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°å®¿ä¸»æœº</h5>
<p>ä¸ºäº†å®‰å…¨åœ°ä¿®æ”¹ï¼Œæˆ‘ä»¬å°†å®¹å™¨å†…çš„æ•´ä¸ªé™æ€æ–‡ä»¶ç›®å½•å¤åˆ¶åˆ°æœ¬åœ°ã€‚</p>
<ol>
<li>
<p><strong>åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªæœ¬åœ°ç›®å½•</strong>ï¼Œç”¨äºå­˜æ”¾ä»å®¹å™¨ä¸­å¤åˆ¶å‡ºæ¥çš„æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /opt/bisheng-main/local-frontend
</code></pre>
<ul>
<li><code>-p</code>: ç¡®ä¿çˆ¶ç›®å½•å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¸€å¹¶åˆ›å»ºã€‚</li>
</ul>
</li>
<li>
<p><strong>ï¼ˆå¯é€‰ï¼‰ä¿®æ”¹æœ¬åœ°ç›®å½•æƒé™</strong>ï¼š
ä¸ºäº†ç¡®ä¿ä½ å½“å‰çš„ç”¨æˆ·æœ‰æƒé™è¯»å†™è¯¥ç›®å½•ï¼Œå¯ä»¥ä¿®æ”¹å…¶æƒé™ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å°†ç›®å½•æ‰€æœ‰è€…æ”¹ä¸ºå½“å‰ç”¨æˆ·ï¼ˆæ¨èï¼‰</span>
sudo <span class="hljs-built_in">chown</span> -R <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> /opt/bisheng-main/local-frontend

<span class="hljs-comment"># æˆ–è€…ï¼Œç»™äºˆæ›´å®½æ¾çš„æƒé™ï¼ˆä¸æ¨èï¼Œä½†ç®€å•ï¼‰</span>
<span class="hljs-comment"># sudo chmod -R 775 /opt/bisheng-main/local-frontend</span>
</code></pre>
</li>
<li>
<p><strong>å°†å®¹å™¨å†…çš„æ–‡ä»¶ç›®å½•å¤åˆ¶åˆ°æœ¬åœ°</strong>ï¼š
æ ¹æ®æ­¥éª¤ä¸€æ‰¾åˆ°çš„è·¯å¾„ï¼Œæˆ‘ä»¬å¤åˆ¶å…¶ä¸Šçº§ç›®å½•ï¼ˆä¾‹å¦‚ <code>/usr/share/nginx/html</code>ï¼‰åˆ°æœ¬åœ°ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">cp</span> bisheng-frontend:/usr/share/nginx/html /opt/bisheng-main/local-frontend
</code></pre>
<ul>
<li>è¿™æ¡å‘½ä»¤ä¼šå°†å®¹å™¨å†…çš„ <code>/usr/share/nginx/html</code> ç›®å½•åŠå…¶æ‰€æœ‰å†…å®¹ï¼Œå¤åˆ¶åˆ°æœ¬åœ°çš„ <code>/opt/bisheng-main/local-frontend/</code> ç›®å½•ä¸‹ã€‚å¤åˆ¶å®Œæˆåï¼Œæœ¬åœ°è·¯å¾„ä¼šæ˜¯ <code>/opt/bisheng-main/local-frontend/html/...</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>éªŒè¯æ–‡ä»¶æ˜¯å¦å¤åˆ¶æˆåŠŸ</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -l /opt/bisheng-main/local-frontend/html/platform/assets/
</code></pre>
<p>ä½ åº”è¯¥èƒ½çœ‹åˆ°ä½ ä¹‹å‰åœ¨å®¹å™¨å†…æ‰¾åˆ°çš„é‚£äº›æ–‡ä»¶ã€‚</p>
</li>
</ol>
<h5 data-id="heading-6">æ­¥éª¤ä¸‰ï¼šåœ¨æœ¬åœ°ä¿®æ”¹æ–‡ä»¶</h5>
<p>ç°åœ¨ï¼Œä½ å¯ä»¥åœ¨æœ¬åœ°å¯¹æ–‡ä»¶è¿›è¡Œä»»æ„ä¿®æ”¹ã€‚</p>
<ol>
<li><strong>ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨æˆ–å·¥å…·</strong>ï¼Œæ‰¾åˆ°æœ¬åœ°å¯¹åº”çš„æ–‡ä»¶å¹¶è¿›è¡Œä¿®æ”¹æˆ–æ›¿æ¢ã€‚
<ul>
<li>æœ¬åœ°æ–‡ä»¶è·¯å¾„ç¤ºä¾‹ï¼š<code>/opt/bisheng-main/local-frontend/html/platform/assets/male-technologist-CcgkZdXy.png</code></li>
<li><strong>é‡è¦</strong>ï¼šä¿®æ”¹åçš„æ–‡ä»¶è¯·åŠ¡å¿…ä¿æŒä¸åŸæ–‡ä»¶<strong>ç›¸åŒçš„æ–‡ä»¶å</strong>ã€‚</li>
</ul>
</li>
</ol>
<h5 data-id="heading-7">æ­¥éª¤å››ï¼šé‡æ–°åˆ›å»ºå®¹å™¨å¹¶æŒ‚è½½ä¿®æ”¹åçš„æ–‡ä»¶</h5>
<p>è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚æˆ‘ä»¬å°†åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ï¼Œå¹¶ä½¿ç”¨ Docker çš„å·æŒ‚è½½åŠŸèƒ½ï¼Œå°†æˆ‘ä»¬ä¿®æ”¹å¥½çš„æœ¬åœ°ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œä»è€Œè¦†ç›–åŸæœ‰çš„æ–‡ä»¶ã€‚</p>
<ol>
<li>
<p><strong>åœæ­¢å¹¶åˆ é™¤æ­£åœ¨è¿è¡Œçš„ <code>bisheng-frontend</code> å®¹å™¨</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker stop bisheng-frontend
docker <span class="hljs-built_in">rm</span> bisheng-frontend
</code></pre>
<ul>
<li>æ³¨æ„ï¼šè¿™ä¼šçŸ­æš‚ä¸­æ–­ä½ çš„ <code>bisheng-frontend</code> æœåŠ¡ã€‚</li>
</ul>
</li>
<li>
<p><strong>ï¼ˆé‡è¦ï¼‰ç¡®è®¤å®¹å™¨çš„ç½‘ç»œ</strong>ï¼š
ä¸ºäº†ç¡®ä¿æ–°å®¹å™¨èƒ½å’Œå…¶ä»–æœåŠ¡ï¼ˆå¦‚ <code>bisheng-backend</code>ï¼‰é€šä¿¡ï¼Œéœ€è¦ä½¿ç”¨æ­£ç¡®çš„ç½‘ç»œã€‚</p>
<ul>
<li>
<p><strong>å¦‚æœä½ ä½¿ç”¨ <code>docker-compose</code></strong>ï¼šé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šç½‘ç»œï¼Œ<code>docker-compose</code> ä¼šè‡ªåŠ¨ç®¡ç†ã€‚</p>
</li>
<li>
<p><strong>å¦‚æœä½ æ‰‹åŠ¨è¿è¡Œå®¹å™¨</strong>ï¼š</p>
</li>
<li>
<p>a.  åˆ—å‡ºæ‰€æœ‰ç½‘ç»œï¼š
<code>bash       docker network ls       </code></p>
<p>b.  æ‰¾åˆ° <code>bisheng-frontend</code> ä¹‹å‰è¿æ¥çš„ç½‘ç»œï¼ˆé€šå¸¸æ˜¯ <code>bisheng_default</code> æˆ– <code>docker_default</code>ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡æ£€æŸ¥å“ªä¸ªç½‘ç»œåŒ…å« <code>bisheng-backend</code> æ¥ç¡®è®¤ï¼š
<code>bash       docker network inspect docker_default | grep "bisheng-backend"       </code></p>
<p>c.  è®°ä¸‹æ­£ç¡®çš„ç½‘ç»œåç§°ï¼Œä¾‹å¦‚ <code>bisheng_default</code>ã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong>é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œå¹¶æŒ‚è½½æœ¬åœ°ä¿®æ”¹åçš„ç›®å½•</strong>ï¼š
ä½¿ç”¨ <code>docker run</code> å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ã€‚<strong>å…³é”®åœ¨äº <code>-v</code> (volume) å‚æ•°</strong>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name bisheng-frontend \
  --network bisheng_default \  <span class="hljs-comment"># æ›¿æ¢ä¸ºä½ åœ¨ä¸Šä¸€æ­¥ç¡®è®¤çš„ç½‘ç»œåç§°</span>
  -p 3001:3001 \
  -v /opt/bisheng-main/local-frontend/html/platform/assets:/usr/share/nginx/html/platform/assets \
  cr.dataelem.com/dataelement/bisheng-frontend:latest
</code></pre>
<ul>
<li><code>-v /local/path:/container/path</code>: è¿™æ˜¯å·æŒ‚è½½å‘½ä»¤ã€‚å®ƒå°†æœ¬åœ°çš„ <code>/opt/bisheng-main/local-frontend/html/platform/assets</code> ç›®å½•ï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†…çš„ <code>/usr/share/nginx/html/platform/assets</code> ç›®å½•ã€‚å®¹å™¨è¿è¡Œæ—¶ï¼Œä¼šä¼˜å…ˆè¯»å–æŒ‚è½½ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œä»è€Œå®ç°äº†æ–‡ä»¶æ›¿æ¢ã€‚</li>
<li><strong>è·¯å¾„æ˜ å°„æŠ€å·§</strong>ï¼šå°½é‡è®©æœ¬åœ°æŒ‚è½½çš„ç›®å½•ç»“æ„ä¸å®¹å™¨å†…çš„ç›®å½•ç»“æ„ä¿æŒä¸€è‡´ï¼Œè¿™æ ·ä¸æ˜“å‡ºé”™ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ£€æŸ¥å®¹å™¨æ˜¯å¦æˆåŠŸå¯åŠ¨</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker ps | grep bisheng-frontend
</code></pre>
<p>å¦‚æœèƒ½çœ‹åˆ° <code>bisheng-frontend</code> å¹¶ä¸”çŠ¶æ€ä¸º <code>Up</code>ï¼Œåˆ™è¡¨ç¤ºå¯åŠ¨æˆåŠŸã€‚</p>
</li>
<li>
<p><strong>éªŒè¯ä¿®æ”¹</strong>ï¼š
æ‰“å¼€æµè§ˆå™¨æˆ–ä½¿ç”¨ <code>curl</code> è®¿é—®ä½ çš„åº”ç”¨ï¼ŒæŸ¥çœ‹ç›¸åº”çš„å›¾ç‰‡æˆ–é™æ€èµ„æºæ˜¯å¦å·²ç»æ›´æ–°ä¸ºä½ ä¿®æ”¹åçš„ç‰ˆæœ¬ã€‚</p>
</li>
</ol>
<hr/>
<h4 data-id="heading-8">å››ã€æ€»ç»“</h4>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å·²ç»æˆåŠŸåœ°ä¿®æ”¹äº† <code>bisheng-frontend</code> å®¹å™¨ä¸­çš„é™æ€æ–‡ä»¶ã€‚è¿™ç§â€œå¤åˆ¶-ä¿®æ”¹-æŒ‚è½½â€çš„æ–¹æ³•æ˜¯ Docker ç¯å¢ƒä¸‹æ›´æ–°å®¹å™¨å†…å®¹çš„æ ‡å‡†æ“ä½œæµç¨‹ï¼Œå®ƒå®‰å…¨ã€å¯é ä¸”æ˜“äºç®¡ç†ã€‚</p>
<p>å¦‚æœä½ æœªæ¥è¿˜éœ€è¦ä¿®æ”¹å…¶ä»–æ–‡ä»¶ï¼Œåªéœ€é‡å¤<strong>æ­¥éª¤ä¸‰</strong>å’Œ<strong>æ­¥éª¤å››</strong>å³å¯ï¼Œæ— éœ€å†é‡æ–°å¤åˆ¶æ•´ä¸ªç›®å½•ï¼ˆé™¤éå®¹å™¨å†…çš„åŸå§‹æ–‡ä»¶åˆå‘ç”Ÿäº†å˜åŒ–ï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­˜å‚¨é£æš´ä¸‹çš„è¾¹ç¼˜æ™ºèƒ½éŸ§æ€§ï¼šç‘èŠ¯å¾®RK3588å¦‚ä½•å°†ä¾›åº”é“¾æŒ‘æˆ˜è½¬åŒ–ä¸ºå¸‚åœºæœºé‡]]></title>    <link>https://juejin.cn/post/7575469988737269769</link>    <guid>https://juejin.cn/post/7575469988737269769</guid>    <pubDate>2025-11-24T01:58:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575469988737269769" data-draft-id="7575412016405299210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­˜å‚¨é£æš´ä¸‹çš„è¾¹ç¼˜æ™ºèƒ½éŸ§æ€§ï¼šç‘èŠ¯å¾®RK3588å¦‚ä½•å°†ä¾›åº”é“¾æŒ‘æˆ˜è½¬åŒ–ä¸ºå¸‚åœºæœºé‡"/> <meta itemprop="keywords" content="ç®—æ³•,è®¡ç®—æœºè§†è§‰,æ·±åº¦å­¦ä¹ "/> <meta itemprop="datePublished" content="2025-11-24T01:58:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­˜å‚¨é£æš´ä¸‹çš„è¾¹ç¼˜æ™ºèƒ½éŸ§æ€§ï¼šç‘èŠ¯å¾®RK3588å¦‚ä½•å°†ä¾›åº”é“¾æŒ‘æˆ˜è½¬åŒ–ä¸ºå¸‚åœºæœºé‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:58:27.000Z" title="Mon Nov 24 2025 01:58:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿‘æœŸçš„å…¨çƒå­˜å‚¨å¸‚åœºæ³¢åŠ¨ï¼Œä¸ºé«˜é€Ÿå‘å±•çš„è¾¹ç¼˜AIäº§ä¸šä¸Šäº†ä¸€å ‚ç”ŸåŠ¨çš„â€œä¾›åº”é“¾å®‰å…¨â€è¯¾ã€‚DDR4é¢—ç²’ä»çŸ­ç¼ºåˆ°ä»·æ ¼æš´æ¶¨ï¼Œå¦‚åŒä¸€é¢é•œå­ï¼Œç…§å‡ºäº†ä¸åŒæŠ€æœ¯è·¯çº¿çš„æŠ—é£é™©èƒ½åŠ›ã€‚åœ¨è¿™åœºè€ƒéªŒä¸­ï¼Œç‘èŠ¯å¾®æ——èˆ°èŠ¯ç‰‡RK3588åŠå…¶æ‰€ä»£è¡¨çš„å¹³å°åŒ–æ€ç»´ï¼Œä¸ä»…å±•ç°äº†è¿‡ç¡¬çš„â€œæŠ€æœ¯éŸ§æ€§â€ï¼Œæ›´æ­ç¤ºäº†å›½äº§è¾¹ç¼˜æ™ºèƒ½ç”Ÿæ€å‘å±•çš„æ–°è·¯å¾„ã€‚ç‘èŠ¯å¾®ä¸‰å­£æŠ¥æŒ‡å‡ºï¼šâ€œç”±äºDDR4å­˜å‚¨èŠ¯ç‰‡ä»ä¾›åº”çŸ­ç¼ºåˆ°ä»·æ ¼æš´æ¶¨ï¼Œä¿ƒä½¿éƒ¨åˆ†å®¢æˆ·ä¸­é«˜ç«¯AIoTäº§å“å‘DDR5è½¬å‹ï¼Œæ–¹æ¡ˆè°ƒæ•´æ—¶é—´å½±å“çŸ­æœŸéœ€æ±‚ï¼Œå¯¼è‡´ç¬¬ä¸‰å­£åº¦æ”¶å…¥å¢é•¿ç•¥ç¼“ï¼Œéšåä¼šç»§ç»­å¿«é€Ÿå¢é•¿â€ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e52afb972bf24cabb5f402aa01f62791~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554306&amp;x-signature=QG4g%2BHRuNJQ6R8Xg5FYLgIHmn18%3D" alt="å›¾ç‰‡1.png" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>é£æš´çœ¼ä¸­çš„â€œç¨³å®šå™¨â€ï¼šRK3588çš„å¤šDDRæ”¯æŒèƒ½åŠ›æˆä¸ºè¾¹ç¼˜éƒ¨ç½²çš„å‹èˆ±çŸ³</strong></h2>
<p>å½“è¡Œä¸šæ™®éå› DDR4çŸ­ç¼ºè€Œé¢ä¸´é¡¹ç›®å»¶æœŸã€æˆæœ¬å¤±æ§çš„å›°å¢ƒæ—¶ï¼Œç‘èŠ¯å¾®å®˜æ–¹å…¬ä¼—å·å‘å¸ƒçš„ã€Šç‘èŠ¯å¾®SoCå¹³å°DDRé€‚é…æé€Ÿï¼ã€‹ç³»åˆ—æ–‡ç« ï¼ŒæŒ‡å‘äº†ä¸€ä¸ªæ ¸å¿ƒäº‹å® <strong>ï¼šåœ¨è¾¹ç¼˜ä¾§ï¼Œç®—åŠ›å¾ˆé‡è¦ï¼Œä½†è®©ç®—åŠ›ç¨³å®šä¸”ç»æµåœ°è½åœ°ï¼Œæ›´é‡è¦ã€‚</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a89a81617886428f8bbacf863c8263c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554306&amp;x-signature=wWM2bmF71RE0TWXebpDxvn8ISN4%3D" alt="å›¾ç‰‡2.png" loading="lazy"/></p>
<p>RK3588ä½œä¸ºè¾¹ç¼˜è®¡ç®—çš„æ ¸å¿ƒå¼•æ“ï¼Œå…¶å‰ç»æ€§çš„è®¾è®¡åœ¨æ­¤åˆ»å‡¸æ˜¾ä»·å€¼ã€‚å®ƒåŸç”Ÿæ”¯æŒLPDDR4/LPDDR4X/LPDDR5ç­‰å¤šç§å†…å­˜è§„æ ¼ã€‚è¿™æ„å‘³ç€ï¼Œå½“DDR4æˆä¸ºä¾›åº”é“¾çš„â€œç“¶é¢ˆâ€æ—¶ï¼Œå®¢æˆ·å¯ä»¥å‡ ä¹æ— ç¼åœ°åˆ‡æ¢è‡³LPDDR4Xæˆ–LPDDR5æ–¹æ¡ˆï¼Œæ— éœ€é‡æ–°è®¾è®¡ä¸»æ¿ï¼Œæ— éœ€æ›´æ¢ä¸»å¹³å°ï¼Œæœ€å¤§ç¨‹åº¦åœ°ä¿éšœäº†äº§å“ç ”å‘å’Œé‡äº§èŠ‚å¥ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f89a5300f07e4c56935c04838523bcca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554306&amp;x-signature=38%2FcTafTXzzCg5lBzP14utQfvA8%3D" alt="å›¾ç‰‡3.png" loading="lazy"/></p>
<p>è¿™ç§ <strong>â€œå¤šä¸€ç§é€‰æ‹©ï¼Œå¤šä¸€ä»½ä¿éšœâ€</strong> çš„çµæ´»æ€§ï¼Œå¯¹äºå·¥ä¸šè´¨æ£€ã€æ™ºèƒ½å®‰é˜²ã€è½¦è½½è®¾å¤‡ç­‰è¦æ±‚è¿ç»­ç¨³å®šè¿è¡Œçš„è¾¹ç¼˜åœºæ™¯è€Œè¨€ï¼Œå·²ä»â€œæŠ€æœ¯äº®ç‚¹â€å‡çº§ä¸º <strong>â€œé€‰å‹åˆšéœ€â€</strong> ã€‚ç‘èŠ¯å¾®æ‰€è¨€çš„â€œç”œèœœçš„çƒ¦æ¼â€ï¼Œæ­£æ˜¯å…¶é€šè¿‡æŠ€æœ¯å‚¨å¤‡å°†è¡Œä¸šæ™®é€‚æ€§é£é™©è½¬åŒ–ä¸ºè‡ªèº«å·®å¼‚åŒ–ä¼˜åŠ¿çš„ä½“ç°ã€‚</p>
<h2 data-id="heading-1"><strong>ä»ç¡¬ä»¶é€‚é…åˆ°ç”Ÿæ€ååŒï¼šèµ‹èƒ½è¾¹ç¼˜çš„â€œåŒæ ¸é©±åŠ¨â€</strong></h2>
<p>RK3588æä¾›çš„ç¡¬ä»¶çº§éŸ§æ€§ï¼Œä¸ºè¾¹ç¼˜AIåº”ç”¨é“ºè®¾äº†å¯é çš„é€šè·¯ã€‚ç„¶è€Œï¼Œå®Œæ•´çš„è¾¹ç¼˜æ™ºèƒ½è§£å†³æ–¹æ¡ˆï¼Œç¦»ä¸å¼€è½¯ä»¶ä¸ç®—æ³•çš„ååŒã€‚è¿™å°±æ„æˆäº†èµ‹èƒ½è¾¹ç¼˜çš„â€œåŒæ ¸é©±åŠ¨â€ï¼š</p>
<ul>
<li>ç¡¬ä»¶æ ¸å¿ƒï¼ˆRK3588ï¼‰ï¼šæä¾›ç®—åŠ›åŸºçŸ³ä¸ä¾›åº”é“¾éŸ§æ€§ã€‚å…¶å¼ºå¤§çš„NPUï¼ˆ6 TOPS AIç®—åŠ›ï¼‰å’Œä¸°å¯Œçš„æ¥å£ï¼Œä¸ºæ¨¡å‹æ¨ç†æä¾›äº†é«˜æ€§èƒ½ã€ä½åŠŸè€—çš„ç¡¬ä»¶ç¯å¢ƒã€‚</li>
<li>è½¯ä»¶æ ¸å¿ƒï¼ˆç®—æ³•å¹³å°ä¸å·¥å…·é“¾ï¼‰ï¼šé‡Šæ”¾ç¡¬ä»¶æ½œèƒ½çš„é’¥åŒ™ã€‚åœ¨RK3588ä¸Šé«˜æ•ˆéƒ¨ç½²AIæ¨¡å‹ï¼Œéœ€è¦è½¯ä»¶ç”Ÿæ€çš„ç´§å¯†é…åˆã€‚</li>
</ul>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/898c17efffe54e7e8524749b2ad59579~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554306&amp;x-signature=E%2BmffICZvZvG44ieZpOfkcRRowE%3D" alt="å›¾ç‰‡4.png" loading="lazy"/></p>
<p><strong>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ä¸€ä¸ªç§¯æçš„äº§ä¸šè¶‹åŠ¿ï¼šå›½äº§AIè½¯ä»¶ç”Ÿæ€æ­£ä¸åƒRK3588è¿™æ ·çš„å›½äº§æ ¸å¿ƒèŠ¯ç‰‡åŠ é€Ÿèåˆã€‚</strong> ä¾‹å¦‚ï¼Œ<strong>Coovallyç­‰AIæ¨¡å‹è®­ç»ƒå¹³å°</strong>ï¼Œå·²ç»å¼€å§‹è‡´åŠ›äºå°†å…¶æ¨¡å‹ä¼˜åŒ–å’Œéƒ¨ç½²å·¥å…·é“¾ä¸RK3588çš„NPUè¿›è¡Œæ·±åº¦é€‚é…ã€‚è¿™æ„å‘³ç€ï¼Œå¼€å‘è€…åˆ©ç”¨æ­¤ç±»å¹³å°è®­ç»ƒå‡ºçš„AIæ¨¡å‹ï¼Œèƒ½å¤Ÿé€šè¿‡é«˜æ•ˆçš„é‡åŒ–ä¸è½¬æ¢ï¼Œç›´æ¥è°ƒç”¨RK3588çš„NPUè¿›è¡ŒåŠ é€Ÿæ¨ç†ï¼Œä»è€Œåœ¨è¾¹ç¼˜ç«¯å®ç°æœ€ä¼˜çš„æ€§èƒ½åŠŸè€—æ¯”ã€‚</p>
<p>ä¼ ç»ŸAIå¼€å‘æµç¨‹ä¸­ï¼Œåœ¨äº‘ç«¯è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œè¦éƒ¨ç½²åˆ°è¾¹ç¼˜è®¾å¤‡ä¸Šæ˜¯ä¸€ä¸ªå¤æ‚ä¸”å……æ»¡æŒ‘æˆ˜çš„è¿‡ç¨‹ï¼Œå¸¸è¢«ç§°ä¸ºâ€œæœ€åä¸€å…¬é‡Œâ€éš¾é¢˜ã€‚</p>
<p>å¯¹Coovallyè€Œè¨€ï¼šRK3588æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–ã€é«˜æ€§èƒ½ã€ä¸”å¾—åˆ°å¸‚åœºéªŒè¯çš„å›½äº§ç¡¬ä»¶æ ‡æ†ã€‚Coovallyé€šè¿‡æ·±åº¦é€‚é…RK3588ï¼Œæ„å‘³ç€å…¶å¹³å°è®­ç»ƒå‡ºçš„æ¨¡å‹æ‹¥æœ‰äº†ä¸€ä¸ªæå…¶å¯é å’Œå¹¿æ³›çš„è½åœ°å‡ºå£ã€‚è¿™å¤§å¤§å¢å¼ºäº†Coovallyå¹³å°å¯¹å¼€å‘è€…çš„å¸å¼•åŠ›ï¼Œå› ä¸ºä»–ä»¬å¯ä»¥â€œä¸€æ¬¡è®­ç»ƒï¼Œå¤šå¤„éƒ¨ç½²â€ï¼Œå¹¶ä¸”èƒ½æ”¾å¿ƒåœ°éƒ¨ç½²åœ¨RK3588è¿™ä¸ªå¼ºå¤§çš„ç¡¬ä»¶ä¸Šã€‚</p>
<p>å¯¹RK3588è€Œè¨€ï¼šCoovallyè¿™æ ·çš„AIå¹³å°æ˜¯ä¸€ä¸ªå¼ºå¤§çš„â€œç®—æ³•ç”Ÿæ€èµ‹èƒ½è€…â€ã€‚å®ƒé™ä½äº†RK3588çš„ä½¿ç”¨é—¨æ§›ï¼Œè®©æ›´å¤šä¸ç²¾é€šåº•å±‚ä¼˜åŒ–çš„åº”ç”¨å¼€å‘è€…ï¼Œä¹Ÿèƒ½è½»æ¾åœ°å°†AIæ¨¡å‹éƒ¨ç½²åˆ°RK3588ä¸Šå¹¶å……åˆ†å‘æŒ¥å…¶æ€§èƒ½ã€‚è¿™æå¤§åœ°ä¸°å¯Œäº†RK3588çš„åº”ç”¨ç”Ÿæ€ï¼Œä»â€œæä¾›ç®—åŠ›â€å‡çº§ä¸ºâ€œæä¾›ç®—åŠ›+ç®—æ³•è½åœ°è§£å†³æ–¹æ¡ˆâ€ã€‚</p>
<h2 data-id="heading-2"><strong>ç»“è®ºï¼šéŸ§æ€§ç”Ÿæ€æ˜¯è¾¹ç¼˜æ™ºèƒ½æœªæ¥çš„æ ¸å¿ƒç«äº‰åŠ›</strong></h2>
<p>DDR4çŸ­ç¼ºäº‹ä»¶ï¼Œæ˜¯ä¸€æ¬¡å¯¹å›½äº§èŠ¯ç‰‡äº§ä¸šçš„å‹åŠ›æµ‹è¯•ã€‚å®ƒè¯æ˜ï¼Œæœªæ¥çš„ç«äº‰ä¸å†æ˜¯å•çº¯çš„ç®—åŠ›ç«èµ›ï¼Œè€Œæ˜¯<strong>æ¶µç›–æŠ€æœ¯å‰ç»æ€§ã€ä¾›åº”é“¾éŸ§æ€§å’Œç”Ÿæ€ååŒåŠ›çš„ç»¼åˆè¾ƒé‡ã€‚</strong></p>
<p>ç‘èŠ¯å¾®RK3588é€šè¿‡å…¶å¤šDDRæ”¯æŒèƒ½åŠ›ï¼Œåœ¨ç¡¬ä»¶å±‚é¢æ„å»ºäº†ç¬¬ä¸€é“é˜²çº¿ã€‚è€Œå®ƒä¸<strong>Coovallyç­‰AIæ¨¡å‹è®­ç»ƒä¸éƒ¨ç½²å¹³å°</strong>çš„ååŒï¼Œåˆ™æ˜¯åœ¨æ„å»ºä¸€ä¸ªæ›´æ·±å±‚æ¬¡çš„ã€è½¯ç¡¬ä¸€ä½“çš„éŸ§æ€§ç”Ÿæ€ã€‚è¿™ä¸ªç”Ÿæ€çš„ä»·å€¼åœ¨äºï¼Œå®ƒè®©ç»ˆç«¯å®¢æˆ·èƒ½å¤Ÿä¸“æ³¨äºè‡ªèº«ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ— éœ€æ‹…å¿§åº•å±‚çš„èŠ¯ç‰‡ä¾›åº”ã€æ¨¡å‹é€‚é…ä¸æ€§èƒ½è°ƒä¼˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ¯ å°è¯´ç¬”è®°ç¼–è¾‘ä¸­çš„æ®µè½æ‹–æ‹½ç§»åŠ¨ï¼šåŸºäº ProseMirror çš„äº¤äº’å¼é‡æ’æŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7575363120798580736</link>    <guid>https://juejin.cn/post/7575363120798580736</guid>    <pubDate>2025-11-23T13:58:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575363120798580736" data-draft-id="7575112613778440226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ğŸ¯ å°è¯´ç¬”è®°ç¼–è¾‘ä¸­çš„æ®µè½æ‹–æ‹½ç§»åŠ¨ï¼šåŸºäº ProseMirror çš„äº¤äº’å¼é‡æ’æŠ€æœ¯"/> <meta itemprop="keywords" content="å‰ç«¯,Electron"/> <meta itemprop="datePublished" content="2025-11-23T13:58:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¾™å›½æµªå­"/> <meta itemprop="url" content="https://juejin.cn/user/1943592291275886"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ğŸ¯ å°è¯´ç¬”è®°ç¼–è¾‘ä¸­çš„æ®µè½æ‹–æ‹½ç§»åŠ¨ï¼šåŸºäº ProseMirror çš„äº¤äº’å¼é‡æ’æŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592291275886/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¾™å›½æµªå­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:58:56.000Z" title="Sun Nov 23 2025 13:58:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸ¯ å°è¯´ç¬”è®°ç¼–è¾‘ä¸­çš„æ®µè½æ‹–æ‹½ç§»åŠ¨ï¼šåŸºäº ProseMirror çš„äº¤äº’å¼é‡æ’æŠ€æœ¯</h2>
<blockquote>
<p>ğŸ’¡ æœ¬æ–‡æ·±å…¥æ¢è®¨äº†åœ¨å°è¯´å†™ä½œè½¯ä»¶çš„ç¬”è®°ç¼–è¾‘å™¨ä¸­å®ç°æ®µè½æ‹–æ‹½ç§»åŠ¨åŠŸèƒ½çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ‹–æ‹½é”šç‚¹ã€å­æ®µè½è”åŠ¨ã€å…¨å±€äº‹ä»¶å¤„ç†ç­‰æ ¸å¿ƒåŠŸèƒ½çš„å®Œæ•´å®ç°ï¼Œä¸ºå¼€å‘è€…æä¾›ä¸€å¥—å®Œæ•´çš„æ®µè½é‡æ’è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<h3 data-id="heading-1">ğŸ“‹ ç›®å½•</h3>
<ul>
<li><a href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF" title="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF">é¡¹ç›®èƒŒæ™¯</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1" title="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">æŠ€æœ¯æ¶æ„è®¾è®¡</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0" title="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0">æ ¸å¿ƒåŠŸèƒ½å®ç°</a></li>
<li><a href="#%E6%8B%96%E6%8B%BD%E9%94%9A%E7%82%B9%E8%A3%85%E9%A5%B0%E7%B3%BB%E7%BB%9F" title="#%E6%8B%96%E6%8B%BD%E9%94%9A%E7%82%B9%E8%A3%85%E9%A5%B0%E7%B3%BB%E7%BB%9F">æ‹–æ‹½é”šç‚¹è£…é¥°ç³»ç»Ÿ</a></li>
<li><a href="#%E6%AE%B5%E8%90%BD%E7%A7%BB%E5%8A%A8%E7%AE%97%E6%B3%95" title="#%E6%AE%B5%E8%90%BD%E7%A7%BB%E5%8A%A8%E7%AE%97%E6%B3%95">æ®µè½ç§»åŠ¨ç®—æ³•</a></li>
<li><a href="#%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86" title="#%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86">å…¨å±€äº‹ä»¶å¤„ç†</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9%E6%80%BB%E7%BB%93" title="#%E6%8A%80%E6%9C%AF%E4%BA%AE%E7%82%B9%E6%80%BB%E7%BB%93">æŠ€æœ¯äº®ç‚¹æ€»ç»“</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B" title="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B">æ€»ç»“ä¸å±•æœ›</a></li>
</ul>
<h3 data-id="heading-2">ğŸ¯ é¡¹ç›®èƒŒæ™¯</h3>
<p>åœ¨å°è¯´åˆ›ä½œè¿‡ç¨‹ä¸­ï¼Œä½œè€…ç»å¸¸éœ€è¦è°ƒæ•´ç¬”è®°çš„ç»“æ„å’Œé¡ºåºã€‚ä¼ ç»Ÿçš„æ–‡æœ¬ç¼–è¾‘å™¨é€šå¸¸åªæ”¯æŒå¤åˆ¶ç²˜è´´æ¥ç§»åŠ¨æ®µè½ï¼Œæ“ä½œç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ 51mazi çš„ç¬”è®°ç¼–è¾‘å™¨ä¸­è®¾è®¡äº†ä¸€ä¸ªç›´è§‚çš„æ®µè½æ‹–æ‹½ç§»åŠ¨åŠŸèƒ½ï¼Œè®©ä½œè€…èƒ½å¤Ÿé€šè¿‡æ‹–æ‹½å¿«é€Ÿè°ƒæ•´æ®µè½é¡ºåºï¼Œæå‡åˆ›ä½œæ•ˆç‡ã€‚</p>
<h4 data-id="heading-3">ğŸ¨ æ®µè½æ‹–æ‹½åŠŸèƒ½å±•ç¤º</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a5438cfa9ae47bf9d8f02cc86f6f55e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6b6Z5Zu95rWq5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764511136&amp;x-signature=sJgmBkR%2FOsgXPCg1pq4EEfgaNu4%3D" alt="ç¬”è®°ç¼–è¾‘å™¨" loading="lazy"/></p>
<p><em>æ®µè½æ‹–æ‹½ç§»åŠ¨åŠŸèƒ½ - æ”¯æŒæ‹–æ‹½é”šç‚¹å¿«é€Ÿè°ƒæ•´æ®µè½é¡ºåº</em></p>
<h4 data-id="heading-4">âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</h4>
<ul>
<li>ğŸ–±ï¸ <strong>æ‹–æ‹½é”šç‚¹</strong>: æ¯ä¸ªæ®µè½å·¦ä¾§æ˜¾ç¤ºæ‹–æ‹½é”šç‚¹ï¼ˆâ‹®â‹®ï¼‰ï¼Œæ‚¬åœæ—¶æ˜¾ç¤º</li>
<li>ğŸ“¦ <strong>å­æ®µè½è”åŠ¨</strong>: æ‹–æ‹½çˆ¶æ®µè½æ—¶ï¼Œæ‰€æœ‰å­æ®µè½ï¼ˆç¼©è¿›çº§åˆ«æ›´å¤§çš„æ®µè½ï¼‰ä¼šä¸€èµ·ç§»åŠ¨</li>
<li>ğŸ¯ <strong>ç²¾ç¡®å®šä½</strong>: æ”¯æŒåœ¨æ®µè½ä¸Šæ–¹æˆ–ä¸‹æ–¹æ’å…¥ï¼Œæ ¹æ®é¼ æ ‡ä½ç½®è‡ªåŠ¨åˆ¤æ–­</li>
<li>ğŸŒ <strong>å…¨å±€æ”¯æŒ</strong>: æ”¯æŒæ‹–æ‹½åˆ°ç¼–è¾‘å™¨å¤–çš„åŒºåŸŸï¼ˆå¦‚ä¾§è¾¹æ ï¼‰ï¼Œä»èƒ½æ­£ç¡®æ”¾ç½®</li>
<li>ğŸ¨ <strong>è§†è§‰åé¦ˆ</strong>: æ‹–æ‹½æ—¶æ˜¾ç¤ºæ®µè½é¢„è§ˆï¼Œæä¾›æ¸…æ™°çš„è§†è§‰åé¦ˆ</li>
</ul>
<h3 data-id="heading-5">ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡</h3>
<h4 data-id="heading-6">æ ¸å¿ƒæŠ€æœ¯æ ˆ</h4>
<ul>
<li><strong>TipTap 3.7.0</strong>: åŸºäº ProseMirror çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ¡†æ¶</li>
<li><strong>ProseMirror</strong>: åº•å±‚æ–‡æ¡£æ¨¡å‹å’Œæ’ä»¶ç³»ç»Ÿ</li>
<li><strong>Vue 3.5.13</strong>: æ¸è¿›å¼ JavaScript æ¡†æ¶</li>
<li><strong>Decoration System</strong>: ProseMirror çš„è£…é¥°ç³»ç»Ÿï¼Œç”¨äºæ·»åŠ æ‹–æ‹½é”šç‚¹</li>
</ul>
<h4 data-id="heading-7">ç³»ç»Ÿæ¶æ„è®¾è®¡</h4>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç¼–è¾‘å™¨è§†å›¾     â”‚    â”‚   ProseMirror   â”‚    â”‚   æ‹–æ‹½æ‰©å±•      â”‚
â”‚   EditorView    â”‚â—„â”€â”€â–ºâ”‚   Plugin        â”‚â—„â”€â”€â–ºâ”‚ NoteDragHandle  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        æ‹–æ‹½äº‹ä»¶å¤„ç†ä¸æ®µè½ç§»åŠ¨ç®—æ³•                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<h4 data-id="heading-8">ğŸ“ æ ¸å¿ƒç»„ä»¶</h4>
<p>æ®µè½æ‹–æ‹½åŠŸèƒ½é€šè¿‡ TipTap Extension å®ç°ï¼Œä¸»è¦åŒ…å«ï¼š</p>
<ul>
<li><strong>NoteDragHandle Extension</strong>: æ‹–æ‹½é”šç‚¹æ‰©å±•</li>
<li><strong>Decoration System</strong>: è£…é¥°ç³»ç»Ÿï¼Œä¸ºæ¯ä¸ªæ®µè½æ·»åŠ æ‹–æ‹½é”šç‚¹</li>
<li><strong>Event Handlers</strong>: å¤„ç†æ‹–æ‹½ç›¸å…³äº‹ä»¶ï¼ˆmousedown, dragstart, dragover, drop, dragendï¼‰</li>
</ul>
<h3 data-id="heading-9">ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°</h3>
<h4 data-id="heading-10">1. æ‹–æ‹½æ‰©å±•åˆå§‹åŒ–</h4>
<p>æ®µè½æ‹–æ‹½åŠŸèƒ½é€šè¿‡ TipTap Extension å®ç°ï¼Œåœ¨ç¼–è¾‘å™¨åˆå§‹åŒ–æ—¶æ³¨å†Œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/renderer/src/components/NoteEditorContent.vue</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Extension</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tiptap/core'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Plugin</span>, <span class="hljs-title class_">PluginKey</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'prosemirror-state'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Decoration</span>, <span class="hljs-title class_">DecorationSet</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'prosemirror-view'</span>

<span class="hljs-comment">// æ®µè½æ‹–æ‹½é”šç‚¹æ‰©å±•</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">NoteDragHandle</span> = <span class="hljs-title class_">Extension</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'noteDragHandle'</span>,
  <span class="hljs-title function_">addProseMirrorPlugins</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> key = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PluginKey</span>(<span class="hljs-string">'note-drag-handle'</span>)
    <span class="hljs-keyword">let</span> draggingPos = <span class="hljs-literal">null</span> <span class="hljs-comment">// æ‹–æ‹½èµ·ç‚¹ä½ç½®</span>
    
    <span class="hljs-comment">// æ®µè½ç§»åŠ¨æ ¸å¿ƒç®—æ³•</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">moveParagraphAtPoint</span>(<span class="hljs-params">view, clientX, clientY</span>) {
      <span class="hljs-comment">// ... ç§»åŠ¨é€»è¾‘</span>
    }
    
    <span class="hljs-keyword">return</span> [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Plugin</span>({
        key,
        <span class="hljs-comment">// ... æ’ä»¶é…ç½®</span>
      })
    ]
  }
})
</code></pre>
<h4 data-id="heading-11">2. æ‹–æ‹½é”šç‚¹è£…é¥°ç³»ç»Ÿ</h4>
<p>ä½¿ç”¨ ProseMirror çš„ Decoration ç³»ç»Ÿä¸ºæ¯ä¸ªæ®µè½æ·»åŠ æ‹–æ‹½é”šç‚¹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ„å»ºè£…é¥°ï¼ˆæ‹–æ‹½é”šç‚¹ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildDecorations</span>(<span class="hljs-params">doc, schema</span>) {
  <span class="hljs-keyword">const</span> decorations = []
  <span class="hljs-keyword">const</span> paragraphType = schema.<span class="hljs-property">nodes</span>.<span class="hljs-property">noteOutlineParagraph</span>
  
  doc.<span class="hljs-title function_">descendants</span>(<span class="hljs-function">(<span class="hljs-params">node, nodePos</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (node.<span class="hljs-property">type</span> === paragraphType) {
      <span class="hljs-comment">// ä¸ºæ®µè½æ·»åŠ ç›¸å¯¹å®šä½ç±»</span>
      <span class="hljs-keyword">const</span> nodeDeco = <span class="hljs-title class_">Decoration</span>.<span class="hljs-title function_">node</span>(nodePos, nodePos + node.<span class="hljs-property">nodeSize</span>, {
        <span class="hljs-attr">class</span>: <span class="hljs-string">'has-note-drag-handle'</span>
      })
      decorations.<span class="hljs-title function_">push</span>(nodeDeco)
      
      <span class="hljs-comment">// åˆ›å»ºæ‹–æ‹½é”šç‚¹å…ƒç´ </span>
      <span class="hljs-keyword">const</span> handle = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'span'</span>)
      handle.<span class="hljs-property">className</span> = <span class="hljs-string">'note-outline-drag-handle'</span>
      handle.<span class="hljs-property">dataset</span>.<span class="hljs-property">pos</span> = <span class="hljs-title class_">String</span>(nodePos)
      handle.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'draggable'</span>, <span class="hljs-string">'true'</span>)
      handle.<span class="hljs-property">title</span> = <span class="hljs-string">'æ‹–åŠ¨ä»¥ç§»åŠ¨è¯¥æ®µè½'</span>
      handle.<span class="hljs-property">textContent</span> = <span class="hljs-string">'â‹®â‹®'</span>
      
      <span class="hljs-comment">// å°†é”šç‚¹ä½œä¸º widget æŒ‚è½½åœ¨æ®µé¦–</span>
      <span class="hljs-keyword">const</span> widget = <span class="hljs-title class_">Decoration</span>.<span class="hljs-title function_">widget</span>(nodePos + <span class="hljs-number">1</span>, handle, { <span class="hljs-attr">side</span>: -<span class="hljs-number">1</span> })
      decorations.<span class="hljs-title function_">push</span>(widget)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  })
  
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">DecorationSet</span>.<span class="hljs-title function_">create</span>(doc, decorations)
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>Decoration.node</code> ä¸ºæ®µè½æ·»åŠ æ ·å¼ç±»</li>
<li>ä½¿ç”¨ <code>Decoration.widget</code> åœ¨æ®µé¦–æ’å…¥æ‹–æ‹½é”šç‚¹</li>
<li>é€šè¿‡ <code>dataset.pos</code> å­˜å‚¨æ®µè½ä½ç½®ï¼Œä¾¿äºåç»­å®šä½</li>
</ul>
<h4 data-id="heading-12">3. æ‹–æ‹½äº‹ä»¶å¤„ç†</h4>
<p>å¤„ç†æ‹–æ‹½çš„å„ä¸ªé˜¶æ®µäº‹ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">handleDOMEvents</span>: {
  <span class="hljs-comment">// é¼ æ ‡æŒ‰ä¸‹ï¼šåˆå§‹åŒ–æ‹–æ‹½</span>
  <span class="hljs-attr">mousedown</span>: <span class="hljs-function">(<span class="hljs-params">view, event</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> target = event.<span class="hljs-property">target</span>
    <span class="hljs-keyword">if</span> (!target.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'note-outline-drag-handle'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">const</span> pos = <span class="hljs-title class_">Number</span>(target.<span class="hljs-property">dataset</span>.<span class="hljs-property">pos</span> || -<span class="hljs-number">1</span>)
    <span class="hljs-keyword">if</span> (pos &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    
    <span class="hljs-comment">// é€‰ä¸­æ•´ä¸ªæ®µè½èŠ‚ç‚¹</span>
    <span class="hljs-keyword">const</span> node = state.<span class="hljs-property">doc</span>.<span class="hljs-title function_">nodeAt</span>(pos)
    <span class="hljs-keyword">const</span> tr = state.<span class="hljs-property">tr</span>.<span class="hljs-title function_">setSelection</span>(<span class="hljs-title class_">NodeSelection</span>.<span class="hljs-title function_">create</span>(state.<span class="hljs-property">doc</span>, pos))
    view.<span class="hljs-title function_">dispatch</span>(tr)
    
    <span class="hljs-comment">// è®°å½•æ‹–æ‹½èµ·ç‚¹</span>
    draggingPos = pos
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  },
  
  <span class="hljs-comment">// æ‹–æ‹½å¼€å§‹ï¼šè®¾ç½®æ‹–æ‹½é¢„è§ˆ</span>
  <span class="hljs-attr">dragstart</span>: <span class="hljs-function">(<span class="hljs-params">view, event</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> target = event.<span class="hljs-property">target</span>
    <span class="hljs-keyword">if</span> (!target.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'note-outline-drag-handle'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    
    <span class="hljs-keyword">const</span> pos = <span class="hljs-title class_">Number</span>(target.<span class="hljs-property">dataset</span>.<span class="hljs-property">pos</span> || -<span class="hljs-number">1</span>)
    <span class="hljs-keyword">const</span> nodeDom = view.<span class="hljs-title function_">nodeDOM</span>(pos)
    
    <span class="hljs-comment">// å…‹éš†èŠ‚ç‚¹ä½œä¸ºæ‹–æ‹½é¢„è§ˆ</span>
    <span class="hljs-keyword">const</span> clone = nodeDom.<span class="hljs-title function_">cloneNode</span>(<span class="hljs-literal">true</span>)
    clone.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'fixed'</span>
    clone.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">'none'</span>
    clone.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">'-10000px'</span>
    <span class="hljs-comment">// ... è®¾ç½®æ ·å¼</span>
    
    <span class="hljs-comment">// è®¾ç½®æ‹–æ‹½é¢„è§ˆå›¾</span>
    event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">setDragImage</span>(clone, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  },
  
  <span class="hljs-comment">// æ‹–æ‹½æ‚¬åœï¼šå…è®¸æ”¾ç½®</span>
  <span class="hljs-attr">dragover</span>: <span class="hljs-function">(<span class="hljs-params">view, event</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (draggingPos != <span class="hljs-literal">null</span>) {
      event.<span class="hljs-title function_">preventDefault</span>()
      event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">dropEffect</span> = <span class="hljs-string">'move'</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  },
  
  <span class="hljs-comment">// æ”¾ç½®ï¼šæ‰§è¡Œç§»åŠ¨</span>
  <span class="hljs-attr">drop</span>: <span class="hljs-function">(<span class="hljs-params">view, event</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (draggingPos == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    event.<span class="hljs-title function_">preventDefault</span>()
    <span class="hljs-title function_">moveParagraphAtPoint</span>(view, event.<span class="hljs-property">clientX</span>, event.<span class="hljs-property">clientY</span>)
    draggingPos = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
}
</code></pre>
<h3 data-id="heading-13">ğŸ¯ æ®µè½ç§»åŠ¨ç®—æ³•</h3>
<h4 data-id="heading-14">æ ¸å¿ƒç§»åŠ¨é€»è¾‘</h4>
<p>æ®µè½ç§»åŠ¨çš„æ ¸å¿ƒç®—æ³•éœ€è¦è€ƒè™‘å¤šä¸ªå› ç´ ï¼š</p>
<ol>
<li><strong>å­æ®µè½è¯†åˆ«</strong>: è¯†åˆ«éœ€è¦ä¸€èµ·ç§»åŠ¨çš„å­æ®µè½</li>
<li><strong>ç›®æ ‡ä½ç½®è®¡ç®—</strong>: æ ¹æ®é¼ æ ‡ä½ç½®è®¡ç®—æ’å…¥ä½ç½®</li>
<li><strong>è¾¹ç•Œæ£€æŸ¥</strong>: é˜²æ­¢ç§»åŠ¨åˆ°æ— æ•ˆä½ç½®</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">moveParagraphAtPoint</span>(<span class="hljs-params">view, clientX, clientY</span>) {
  <span class="hljs-keyword">const</span> { state } = view
  <span class="hljs-keyword">const</span> rect = view.<span class="hljs-property">dom</span>.<span class="hljs-title function_">getBoundingClientRect</span>()
  
  <span class="hljs-comment">// åæ ‡é™åˆ¶åœ¨ç¼–è¾‘å™¨èŒƒå›´å†…</span>
  <span class="hljs-keyword">const</span> clampedX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(rect.<span class="hljs-property">left</span> + <span class="hljs-number">1</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(clientX, rect.<span class="hljs-property">right</span> - <span class="hljs-number">1</span>))
  <span class="hljs-keyword">const</span> clampedY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(rect.<span class="hljs-property">top</span> + <span class="hljs-number">1</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(clientY, rect.<span class="hljs-property">bottom</span> - <span class="hljs-number">1</span>))
  
  <span class="hljs-comment">// è·å–é¼ æ ‡ä½ç½®å¯¹åº”çš„æ–‡æ¡£ä½ç½®</span>
  <span class="hljs-keyword">const</span> posInfo = view.<span class="hljs-title function_">posAtCoords</span>({ <span class="hljs-attr">left</span>: clampedX, <span class="hljs-attr">top</span>: clampedY })
  <span class="hljs-keyword">if</span> (!posInfo) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  
  <span class="hljs-keyword">const</span> $from = state.<span class="hljs-property">doc</span>.<span class="hljs-title function_">resolve</span>(draggingPos)
  <span class="hljs-keyword">const</span> sourceIndex = $from.<span class="hljs-title function_">index</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> sourceNode = state.<span class="hljs-property">doc</span>.<span class="hljs-title function_">child</span>(sourceIndex)
  <span class="hljs-keyword">const</span> sourceLevel = sourceNode.<span class="hljs-property">attrs</span>.<span class="hljs-property">level</span> || <span class="hljs-number">0</span>
  
  <span class="hljs-comment">// è®¡ç®—ç›®æ ‡ä½ç½®</span>
  <span class="hljs-keyword">const</span> $pos = state.<span class="hljs-property">doc</span>.<span class="hljs-title function_">resolve</span>(posInfo.<span class="hljs-property">pos</span>)
  <span class="hljs-keyword">let</span> targetIndex = $pos.<span class="hljs-title function_">index</span>(<span class="hljs-number">0</span>)
  
  <span class="hljs-comment">// åˆ¤æ–­æ˜¯æ’å…¥åœ¨æ®µè½ä¸Šæ–¹è¿˜æ˜¯ä¸‹æ–¹</span>
  <span class="hljs-keyword">const</span> domAt = view.<span class="hljs-title function_">nodeDOM</span>($pos.<span class="hljs-title function_">before</span>(<span class="hljs-number">1</span>))
  <span class="hljs-keyword">let</span> insertAfter = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (domAt) {
    <span class="hljs-keyword">const</span> tRect = domAt.<span class="hljs-title function_">getBoundingClientRect</span>()
    <span class="hljs-keyword">const</span> midY = tRect.<span class="hljs-property">top</span> + tRect.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>
    insertAfter = clampedY &gt;= midY
  }
  
  <span class="hljs-comment">// æŸ¥æ‰¾æ‰€æœ‰éœ€è¦ç§»åŠ¨çš„å­æ®µè½</span>
  <span class="hljs-keyword">let</span> moveCount = <span class="hljs-number">1</span> <span class="hljs-comment">// è‡³å°‘ç§»åŠ¨æºæ®µè½æœ¬èº«</span>
  <span class="hljs-keyword">let</span> nextIndex = sourceIndex + <span class="hljs-number">1</span>
  
  <span class="hljs-keyword">while</span> (nextIndex &lt; state.<span class="hljs-property">doc</span>.<span class="hljs-property">childCount</span>) {
    <span class="hljs-keyword">const</span> nextNode = state.<span class="hljs-property">doc</span>.<span class="hljs-title function_">child</span>(nextIndex)
    <span class="hljs-keyword">if</span> (nextNode.<span class="hljs-property">type</span>.<span class="hljs-property">name</span> === <span class="hljs-string">'noteOutlineParagraph'</span>) {
      <span class="hljs-keyword">const</span> nextLevel = nextNode.<span class="hljs-property">attrs</span>.<span class="hljs-property">level</span> || <span class="hljs-number">0</span>
      <span class="hljs-comment">// å¦‚æœä¸‹ä¸€æ®µè½çš„å±‚çº§å¤§äºæºæ®µè½ï¼Œè¯´æ˜æ˜¯å­æ®µè½</span>
      <span class="hljs-keyword">if</span> (nextLevel &gt; sourceLevel) {
        moveCount++
        nextIndex++
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">break</span> <span class="hljs-comment">// é‡åˆ°åŒçº§æˆ–æ›´é«˜çº§çš„æ®µè½ï¼Œåœæ­¢æŸ¥æ‰¾</span>
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">break</span>
    }
  }
  
  <span class="hljs-comment">// æ£€æŸ¥ç›®æ ‡ä½ç½®æ˜¯å¦åœ¨ç§»åŠ¨èŒƒå›´å†…</span>
  <span class="hljs-keyword">if</span> (!insertAfter &amp;&amp; targetIndex &gt;= sourceIndex &amp;&amp; targetIndex &lt; sourceIndex + moveCount) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// ä¸éœ€è¦ç§»åŠ¨</span>
  }
  
  <span class="hljs-comment">// æ‰§è¡Œç§»åŠ¨æ“ä½œ</span>
  <span class="hljs-keyword">const</span> children = []
  state.<span class="hljs-property">doc</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">child</span>) =&gt;</span> {
    children.<span class="hljs-title function_">push</span>(child)
  })
  
  <span class="hljs-comment">// ç§»é™¤æºæ®µè½åŠå…¶å­æ®µè½</span>
  <span class="hljs-keyword">const</span> movedParagraphs = children.<span class="hljs-title function_">splice</span>(sourceIndex, moveCount)
  
  <span class="hljs-comment">// è®¡ç®—ç›®æ ‡æ’å…¥ä½ç½®</span>
  <span class="hljs-keyword">let</span> destIndex = targetIndex
  <span class="hljs-keyword">if</span> (sourceIndex &lt; targetIndex) {
    destIndex -= moveCount <span class="hljs-comment">// è°ƒæ•´ç›®æ ‡ä½ç½®</span>
  }
  
  <span class="hljs-comment">// åœ¨ç›®æ ‡ä½ç½®æ’å…¥</span>
  <span class="hljs-keyword">if</span> (insertAfter) {
    children.<span class="hljs-title function_">splice</span>(destIndex + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, ...movedParagraphs)
  } <span class="hljs-keyword">else</span> {
    children.<span class="hljs-title function_">splice</span>(destIndex, <span class="hljs-number">0</span>, ...movedParagraphs)
  }
  
  <span class="hljs-comment">// åˆ›å»ºæ–°æ–‡æ¡£å¹¶åº”ç”¨å˜æ›´</span>
  <span class="hljs-keyword">const</span> newDoc = state.<span class="hljs-property">doc</span>.<span class="hljs-property">type</span>.<span class="hljs-title function_">create</span>(state.<span class="hljs-property">doc</span>.<span class="hljs-property">attrs</span>, <span class="hljs-title class_">Fragment</span>.<span class="hljs-title function_">from</span>(children))
  <span class="hljs-keyword">const</span> tr = state.<span class="hljs-property">tr</span>.<span class="hljs-title function_">replaceWith</span>(<span class="hljs-number">0</span>, state.<span class="hljs-property">doc</span>.<span class="hljs-property">content</span>.<span class="hljs-property">size</span>, newDoc.<span class="hljs-property">content</span>)
  view.<span class="hljs-title function_">dispatch</span>(tr.<span class="hljs-title function_">scrollIntoView</span>())
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}
</code></pre>
<p><strong>ç®—æ³•è¦ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>å­æ®µè½è¯†åˆ«</strong>: é€šè¿‡æ¯”è¾ƒ <code>level</code> å±æ€§è¯†åˆ«å­æ®µè½</li>
<li><strong>ä½ç½®è®¡ç®—</strong>: æ ¹æ®é¼ æ ‡ Y åæ ‡åˆ¤æ–­æ’å…¥ä½ç½®ï¼ˆä¸Šæ–¹/ä¸‹æ–¹ï¼‰</li>
<li><strong>è¾¹ç•Œå¤„ç†</strong>: é˜²æ­¢ç§»åŠ¨åˆ°è‡ªèº«èŒƒå›´å†…</li>
<li><strong>æ–‡æ¡£é‡å»º</strong>: ä½¿ç”¨ Fragment é‡å»ºæ–‡æ¡£ç»“æ„</li>
</ul>
<h3 data-id="heading-15">ğŸŒ å…¨å±€äº‹ä»¶å¤„ç†</h3>
<p>ä¸ºäº†æ”¯æŒæ‹–æ‹½åˆ°ç¼–è¾‘å™¨å¤–çš„åŒºåŸŸï¼ˆå¦‚ä¾§è¾¹æ ï¼‰ï¼Œéœ€è¦ç›‘å¬å…¨å±€äº‹ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">view</span>(<span class="hljs-params">editorView</span>) {
  <span class="hljs-keyword">let</span> lastPoint = <span class="hljs-literal">null</span>
  
  <span class="hljs-comment">// å…¨å±€æ”¾ç½®äº‹ä»¶</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onDocDrop</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-keyword">if</span> (draggingPos == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>
    e.<span class="hljs-title function_">preventDefault</span>()
    <span class="hljs-title function_">moveParagraphAtPoint</span>(editorView, e.<span class="hljs-property">clientX</span>, e.<span class="hljs-property">clientY</span>)
    draggingPos = <span class="hljs-literal">null</span>
  }
  
  <span class="hljs-comment">// å…¨å±€æ‹–æ‹½æ‚¬åœäº‹ä»¶</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onDocDragOver</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-keyword">if</span> (draggingPos == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>
    e.<span class="hljs-title function_">preventDefault</span>()
    lastPoint = { <span class="hljs-attr">x</span>: e.<span class="hljs-property">clientX</span>, <span class="hljs-attr">y</span>: e.<span class="hljs-property">clientY</span> }
  }
  
  <span class="hljs-comment">// å…¨å±€æ‹–æ‹½ç»“æŸäº‹ä»¶ï¼ˆå…œåº•å¤„ç†ï¼‰</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onDocDragEnd</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (draggingPos != <span class="hljs-literal">null</span> &amp;&amp; lastPoint) {
      <span class="hljs-comment">// å¦‚æœæ²¡æœ‰è§¦å‘ dropï¼Œä¹Ÿåœ¨ dragend æ—¶æ‰§è¡Œç§»åŠ¨</span>
      <span class="hljs-title function_">moveParagraphAtPoint</span>(editorView, lastPoint.<span class="hljs-property">x</span>, lastPoint.<span class="hljs-property">y</span>)
    }
    draggingPos = <span class="hljs-literal">null</span>
    lastPoint = <span class="hljs-literal">null</span>
  }
  
  <span class="hljs-comment">// æ³¨å†Œå…¨å±€äº‹ä»¶ç›‘å¬</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'drop'</span>, onDocDrop)
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dragover'</span>, onDocDragOver)
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dragend'</span>, onDocDragEnd)
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// æ¸…ç†äº‹ä»¶ç›‘å¬</span>
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'drop'</span>, onDocDrop)
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'dragover'</span>, onDocDragOver)
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'dragend'</span>, onDocDragEnd)
    }
  }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>document</code> çº§åˆ«çš„äº‹ä»¶ç›‘å¬ï¼Œè¦†ç›–æ•´ä¸ªé¡µé¢</li>
<li>åœ¨ <code>dragend</code> ä¸­å…œåº•å¤„ç†ï¼Œç¡®ä¿å³ä½¿æ²¡æœ‰è§¦å‘ <code>drop</code> ä¹Ÿèƒ½å®Œæˆç§»åŠ¨</li>
<li>åœ¨æ’ä»¶é”€æ¯æ—¶æ¸…ç†äº‹ä»¶ç›‘å¬ï¼Œé¿å…å†…å­˜æ³„æ¼</li>
</ul>
<h3 data-id="heading-16">ğŸ¨ æ ·å¼è®¾è®¡</h3>
<p>æ‹–æ‹½é”šç‚¹çš„æ ·å¼è®¾è®¡éœ€è¦è€ƒè™‘ç”¨æˆ·ä½“éªŒï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ‹–æ‹½é”šç‚¹æ ·å¼</span>
<span class="hljs-selector-class">.note-outline-drag-handle</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">cursor</span>: grab <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-mute, <span class="hljs-number">#999</span>);
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  user-select: none;
  
  <span class="hljs-comment">// æ‚¬åœæ—¶æ˜¾ç¤º</span>
  &amp;<span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">cursor</span>: grab <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-base, <span class="hljs-number">#333</span>);
  }
  
  <span class="hljs-comment">// æ‹–æ‹½æ—¶æ˜¾ç¤ºæŠ“å–æ‰‹åŠ¿</span>
  &amp;<span class="hljs-selector-pseudo">:active</span> {
    <span class="hljs-attribute">cursor</span>: grabbing <span class="hljs-meta">!important</span>;
  }
}

<span class="hljs-comment">// æ®µè½æ‚¬åœæ—¶æ˜¾ç¤ºæ‹–æ‹½é”šç‚¹</span>
<span class="hljs-selector-tag">p</span><span class="hljs-selector-attr">[data-note-outline]</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-selector-class">.note-outline-drag-handle</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">pointer-events</span>: auto;
  }
}
</code></pre>
<h3 data-id="heading-17">ğŸ¯ æŠ€æœ¯äº®ç‚¹æ€»ç»“</h3>
<h4 data-id="heading-18">1. åŸºäº ProseMirror æ’ä»¶ç³»ç»Ÿ</h4>
<ul>
<li><strong>æ‰©å±•æ€§å¼º</strong>: é€šè¿‡ Extension æœºåˆ¶ï¼Œæ˜“äºé›†æˆå’Œç»´æŠ¤</li>
<li><strong>æ€§èƒ½ä¼˜ç§€</strong>: åˆ©ç”¨ ProseMirror çš„æ–‡æ¡£æ¨¡å‹ï¼Œç§»åŠ¨æ“ä½œé«˜æ•ˆ</li>
<li><strong>çŠ¶æ€ç®¡ç†</strong>: è‡ªåŠ¨å¤„ç†æ–‡æ¡£å˜æ›´å’Œè£…é¥°æ›´æ–°</li>
</ul>
<h4 data-id="heading-19">2. å­æ®µè½è”åŠ¨æœºåˆ¶</h4>
<ul>
<li><strong>æ™ºèƒ½è¯†åˆ«</strong>: è‡ªåŠ¨è¯†åˆ«å­æ®µè½ï¼ˆé€šè¿‡ level å±æ€§ï¼‰</li>
<li><strong>æ‰¹é‡ç§»åŠ¨</strong>: çˆ¶æ®µè½ç§»åŠ¨æ—¶ï¼Œæ‰€æœ‰å­æ®µè½ä¸€èµ·ç§»åŠ¨</li>
<li><strong>ç»“æ„ä¿æŒ</strong>: ä¿æŒæ®µè½å±‚çº§å…³ç³»ä¸å˜</li>
</ul>
<h4 data-id="heading-20">3. å…¨å±€äº‹ä»¶æ”¯æŒ</h4>
<ul>
<li><strong>è·¨åŒºåŸŸæ‹–æ‹½</strong>: æ”¯æŒæ‹–æ‹½åˆ°ç¼–è¾‘å™¨å¤–çš„åŒºåŸŸ</li>
<li><strong>å…œåº•å¤„ç†</strong>: åœ¨ dragend ä¸­å¤„ç†æœªè§¦å‘ drop çš„æƒ…å†µ</li>
<li><strong>äº‹ä»¶æ¸…ç†</strong>: æ’ä»¶é”€æ¯æ—¶è‡ªåŠ¨æ¸…ç†äº‹ä»¶ç›‘å¬</li>
</ul>
<h4 data-id="heading-21">4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–</h4>
<ul>
<li><strong>è§†è§‰åé¦ˆ</strong>: æ‹–æ‹½æ—¶æ˜¾ç¤ºæ®µè½é¢„è§ˆ</li>
<li><strong>ç²¾ç¡®å®šä½</strong>: æ ¹æ®é¼ æ ‡ä½ç½®åˆ¤æ–­æ’å…¥ä½ç½®</li>
<li><strong>è¾¹ç•Œä¿æŠ¤</strong>: é˜²æ­¢ç§»åŠ¨åˆ°æ— æ•ˆä½ç½®</li>
</ul>
<h3 data-id="heading-22">ğŸ”® æ€»ç»“ä¸å±•æœ›</h3>
<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†åœ¨å°è¯´å†™ä½œè½¯ä»¶çš„ç¬”è®°ç¼–è¾‘å™¨ä¸­å®ç°æ®µè½æ‹–æ‹½ç§»åŠ¨åŠŸèƒ½çš„æŠ€æœ¯æ–¹æ¡ˆã€‚é€šè¿‡ ProseMirror çš„æ’ä»¶ç³»ç»Ÿã€Decoration è£…é¥°ç³»ç»Ÿå’Œç²¾å¿ƒè®¾è®¡çš„ç§»åŠ¨ç®—æ³•ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œå–„ã€ç”¨æˆ·ä½“éªŒä¼˜ç§€çš„æ®µè½é‡æ’åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-23">æŠ€æœ¯ä¼˜åŠ¿</h4>
<ul>
<li>âœ… <strong>åŸºäºæ ‡å‡†</strong>: ä½¿ç”¨ ProseMirror æ ‡å‡† APIï¼Œç¨³å®šå¯é </li>
<li>âœ… <strong>æ€§èƒ½ä¼˜ç§€</strong>: åˆ©ç”¨æ–‡æ¡£æ¨¡å‹ï¼Œç§»åŠ¨æ“ä½œé«˜æ•ˆ</li>
<li>âœ… <strong>æ‰©å±•æ€§å¼º</strong>: æ˜“äºæ‰©å±•å’Œç»´æŠ¤</li>
<li>âœ… <strong>ç”¨æˆ·å‹å¥½</strong>: ç›´è§‚çš„æ‹–æ‹½æ“ä½œï¼Œæ”¯æŒå­æ®µè½è”åŠ¨</li>
</ul>
<h4 data-id="heading-24">æœªæ¥ä¼˜åŒ–æ–¹å‘</h4>
<ul>
<li>ğŸ”® <strong>åŠ¨ç”»æ•ˆæœ</strong>: æ·»åŠ å¹³æ»‘çš„ç§»åŠ¨åŠ¨ç”»</li>
<li>ğŸ”® <strong>å¤šé€‰æ‹–æ‹½</strong>: æ”¯æŒåŒæ—¶æ‹–æ‹½å¤šä¸ªæ®µè½</li>
<li>ğŸ”® <strong>æ’¤é”€é‡åš</strong>: ä¼˜åŒ–æ’¤é”€é‡åšæœºåˆ¶</li>
<li>ğŸ”® <strong>é”®ç›˜å¿«æ·é”®</strong>: æ”¯æŒé”®ç›˜å¿«æ·é”®ç§»åŠ¨æ®µè½</li>
</ul>
<p>é€šè¿‡è¿™å¥—æŠ€æœ¯æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¸ºå°è¯´åˆ›ä½œè€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§è€Œç›´è§‚çš„æ®µè½é‡æ’å·¥å…·ï¼Œå¤§å¤§æå‡äº†ç¬”è®°æ•´ç†çš„æ•ˆç‡ã€‚</p>
<hr/>
<h4 data-id="heading-25">ğŸ“š ç›¸å…³é“¾æ¥</h4>
<ul>
<li><strong>é¡¹ç›®åœ°å€</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoshengxianjun%2F51mazi" target="_blank" title="https://github.com/xiaoshengxianjun/51mazi" ref="nofollow noopener noreferrer">GitHub - 51mazi</a>ï¼Œç»™ä¸ª Star å“¦~</li>
<li><strong>TipTap å®˜ç½‘</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Ftiptap.dev" target="_blank" title="https://tiptap.dev" ref="nofollow noopener noreferrer">tiptap.dev</a></li>
<li><strong>ProseMirror æ–‡æ¡£</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fprosemirror.net" target="_blank" title="https://prosemirror.net" ref="nofollow noopener noreferrer">prosemirror.net</a></li>
</ul>
<h4 data-id="heading-26">ğŸ·ï¸ æ ‡ç­¾</h4>
<p><code>#ProseMirror</code> <code>#TipTap</code> <code>#æ®µè½æ‹–æ‹½</code> <code>#Vue3</code> <code>#Electron</code> <code>#å°è¯´å†™ä½œ</code> <code>#å¯Œæ–‡æœ¬ç¼–è¾‘</code> <code>#å‰ç«¯å¼€å‘</code></p>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ æ”¯æŒä¸€ä¸‹ï¼</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CharlesæŠ“åŒ…åœ¨å¤æ‚ç³»ç»Ÿä¸­çš„åº”ç”¨ï¼Œé«˜éš¾åº¦é—®é¢˜çš„è¯Šæ–­ä¸éªŒè¯æ–¹æ³•]]></title>    <link>https://juejin.cn/post/7575412016405430282</link>    <guid>https://juejin.cn/post/7575412016405430282</guid>    <pubDate>2025-11-24T02:01:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575412016405430282" data-draft-id="7575456858428031022" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CharlesæŠ“åŒ…åœ¨å¤æ‚ç³»ç»Ÿä¸­çš„åº”ç”¨ï¼Œé«˜éš¾åº¦é—®é¢˜çš„è¯Šæ–­ä¸éªŒè¯æ–¹æ³•"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T02:01:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bcbnb"/> <meta itemprop="url" content="https://juejin.cn/user/895474073078377"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CharlesæŠ“åŒ…åœ¨å¤æ‚ç³»ç»Ÿä¸­çš„åº”ç”¨ï¼Œé«˜éš¾åº¦é—®é¢˜çš„è¯Šæ–­ä¸éªŒè¯æ–¹æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895474073078377/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bcbnb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:01:34.000Z" title="Mon Nov 24 2025 02:01:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“ä¸€ä¸ªç³»ç»Ÿå¼€å§‹å˜å¾—å¤æ‚ï¼Œé—®é¢˜å°±å¾ˆéš¾å†ä»ä»£ç å±‚é¢ç®€å•åˆ¤æ–­ã€‚
ä½ ä¼šé‡åˆ°ï¼š</p>
<ul>
<li>æ˜æ˜ç›¸åŒè¯·æ±‚ï¼Œå´åœ¨ä¸åŒç”¨æˆ·è®¾å¤‡ä¸Šè¡¨ç°ä¸åŒ</li>
<li>åç«¯æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†å‰ç«¯é¡µé¢ä¾æ—§å¤±è´¥</li>
<li>ç§»åŠ¨ç«¯æ¥å£å¶å‘æ€§è¿”å›é”™è¯¯ï¼Œæ— æ³•å¤ç°</li>
<li>å¤šç¯å¢ƒå…±å­˜å¯¼è‡´æ•°æ®æ¥æºæ··ä¹±</li>
<li>æŸäº›è¯·æ±‚å»¶è¿Ÿæé«˜ï¼Œå´æ‰¾ä¸åˆ°ç“¶é¢ˆç‚¹</li>
</ul>
<p>è¿™äº›é—®é¢˜å¹¶ä¸æ˜¯ç®€å•â€œçœ‹æ¥å£æ–‡æ¡£â€å°±èƒ½è§£å†³çš„ã€‚
è¦æ‰¾åˆ°çœŸæ­£åŸå› ï¼Œä½ éœ€è¦çœ‹åˆ°ç³»ç»ŸçœŸå®å·¥ä½œæ—¶çš„ <strong>ç½‘ç»œè¡Œä¸º</strong>â€”â€”è€Œ Charles æŠ“åŒ…ï¼Œå°±æ˜¯è¿™æ ·ä¸€ç§èƒ½å¤Ÿç›´æ¥å‘ˆç°â€œçœŸå®é“¾è·¯â€çš„å·¥å…·ã€‚</p>
<p>æŠ“åŒ…çš„æ„ä¹‰ä¸åªæ˜¯æŸ¥çœ‹è¯·æ±‚ï¼Œè€Œæ˜¯ï¼š<strong>æŠŠå¤æ‚ç³»ç»Ÿçš„è¡Œä¸ºæ‹†æˆå¯ç†è§£ã€å¯éªŒè¯ã€å¯æ’æŸ¥çš„ç‰‡æ®µã€‚</strong></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€å¤æ‚é—®é¢˜ä¸ºä»€ä¹ˆå¿…é¡»ä¾èµ–æŠ“åŒ…ï¼Ÿ</h2>
<p>åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œé—®é¢˜éš¾æ’æŸ¥å¾€å¾€å› ä¸ºï¼š</p>
<ul>
<li>è¡Œä¸ºä¸å¯è§</li>
<li>æµç¨‹ä¸å¯æ§</li>
<li>è¯·æ±‚ä¸å¯é¢„æµ‹</li>
<li>ç¯å¢ƒä¸å¯ç¡®è®¤</li>
</ul>
<p>è€Œ Charles æŠ“åŒ…èƒ½è®©è¿™äº›â€œä¸å¯è§â€å˜æˆâ€œå¯è§†åŒ–â€ã€‚</p>
<p>å®ƒèƒ½å‘Šè¯‰ä½ ï¼š</p>
<ul>
<li>ç³»ç»Ÿåˆ°åº•å‘å‡ºäº†å“ªäº›ç½‘ç»œè¯·æ±‚</li>
<li>æ¯æ¡è¯·æ±‚çš„å‘èµ·ã€ç­‰å¾…ã€å“åº”æ˜¯å¦æ­£å¸¸</li>
<li>è¯·æ±‚æ˜¯å¦è¢«ç¯¡æ”¹ã€ç¼“å­˜æˆ–ä»£ç†å½±å“</li>
<li>è¯·æ±‚çœŸæ­£åˆ°è¾¾çš„æœåŠ¡å™¨æ˜¯å“ªä¸€å°</li>
<li>HTTPS æ¡æ‰‹æ˜¯å¦ç¨³å®š</li>
<li>æ˜¯å¦è¢«ç½‘ç»œä¸­é—´å±‚è¿‡æ»¤</li>
</ul>
<p>è¿™äº›ä¿¡æ¯ç›´æ¥å†³å®šäº†ä½ èƒ½å¦å¿«é€Ÿå®šä½ä¸€ä¸ªé«˜éš¾åº¦é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€Charles åœ¨å¤æ‚ç³»ç»Ÿä¸­çš„ä¸‰ç±»å…³é”®ä½œç”¨</h2>
<p>åœ¨å¤šå±‚æ¶æ„ã€å¤šç¯å¢ƒç³»ç»Ÿä¸­ï¼ŒæŠ“åŒ…é€šå¸¸ç”¨äºä»¥ä¸‹ä¸‰ç±»ç›®æ ‡ã€‚</p>
<hr/>
<h3 data-id="heading-2"><strong>â‘  éªŒè¯ç³»ç»Ÿè¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸ</strong></h3>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>å‰ç«¯æ˜¯å¦æ­£ç¡®è§¦å‘æ¥å£</li>
<li>App æ˜¯å¦é‡å¤å‘é€è¯·æ±‚</li>
<li>ç¯å¢ƒåˆ‡æ¢æ˜¯å¦ç”Ÿæ•ˆ</li>
<li>è¯·æ±‚é“¾è·¯æ˜¯å¦å¼‚å¸¸è·³è½¬</li>
</ul>
<p>Sequence è§†å›¾èƒ½æ¸…æ¥šå±•ç¤ºè¯·æ±‚é¡ºåºï¼Œæœ‰åŠ©äºå¤ç›˜ç”¨æˆ·è¡Œä¸ºã€‚</p>
<hr/>
<h3 data-id="heading-3"><strong>â‘¡ åˆ¤æ–­é“¾è·¯å»¶è¿Ÿä¸å¤±è´¥ç‚¹</strong></h3>
<p>ä¸æ˜¯æ‰€æœ‰â€œæ…¢â€éƒ½æ˜¯åç«¯æ…¢ã€‚
Timeline ä¼šå‘Šè¯‰ä½ å»¶è¿Ÿå‘ç”Ÿåœ¨ï¼š</p>
<ul>
<li>DNS</li>
<li>SSL</li>
<li>ç½‘ç»œä¼ è¾“</li>
<li>æœåŠ¡ç«¯å¤„ç†</li>
<li>ä¸‹è½½é˜¶æ®µ</li>
</ul>
<p>è¿™ä¸€ç‚¹åœ¨ç§»åŠ¨ç«¯å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå¼±ç½‘ç»å¸¸å¯¼è‡´è¯¯åˆ¤ã€‚</p>
<hr/>
<h3 data-id="heading-4"><strong>â‘¢ è¿˜åŸçœŸå®æ•°æ®æµè½¬è¿‡ç¨‹</strong></h3>
<p>åŒ…æ‹¬ï¼š</p>
<ul>
<li>å‚æ•°æ˜¯å¦ç»è¿‡ä¸­é—´å±‚ä¿®æ”¹</li>
<li>Token æ˜¯å¦å¤±æ•ˆ</li>
<li>Header æ˜¯å¦è¢«è¿‡æ»¤</li>
<li>Body æ˜¯å¦è¢«å‹ç¼©æˆ–ç¼–ç </li>
<li>å“åº”å†…å®¹æ˜¯å¦è¢«ç¼“å­˜å‘½ä¸­</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯æ—¥å¿—æ— æ³•å®Œå…¨å‘ˆç°çš„å†…å®¹ã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ç§»åŠ¨ç«¯å¤æ‚é—®é¢˜ï¼šCharles çš„ç»å¯¹ä¼˜åŠ¿</h2>
<p>è®¸å¤šé«˜éš¾åº¦é—®é¢˜é›†ä¸­åœ¨ç§»åŠ¨ç«¯ï¼Œè€Œé Webï¼š</p>
<ul>
<li>ä¸åŒå“ç‰Œè®¾å¤‡å¤„ç†ç½‘ç»œæ–¹å¼ä¸åŒ</li>
<li>Wi-Fi/4G/5G ç½‘ç»œå˜åŒ–é¢‘ç¹</li>
<li>App ä¼šå› åå°æœºåˆ¶ä¸­æ–­è¯·æ±‚</li>
<li>SSL Pinning é˜»æ­¢æŠ“åŒ…</li>
<li>ç§»åŠ¨ç«¯ä»£ç†é“¾è·¯æ›´å¤æ‚</li>
</ul>
<p>Charles æŠ“åŒ…å¯¹ç§»åŠ¨ç«¯çš„ä»·å€¼å‡ ä¹æ˜¯ä¸å¯æ›¿ä»£çš„ã€‚</p>
<h3 data-id="heading-6"><strong>å…¸å‹ç§»åŠ¨ç«¯è°ƒè¯•åœºæ™¯åŒ…æ‹¬ï¼š</strong></h3>
<ul>
<li>ç™»å½•æµç¨‹å¶å‘å¤±è´¥</li>
<li>Token è¿‡æœŸä¸åˆ·æ–°é“¾è·¯ä¸ä¸€è‡´</li>
<li>å¤šæ¥å£å¹¶å‘è§¦å‘é¡ºåºä¸åŒ</li>
<li>App åœ¨å¼±ç½‘æ¡ä»¶ä¸‹æå‰å–æ¶ˆè¯·æ±‚</li>
</ul>
<p>é…åˆ Throttleï¼ˆå¼±ç½‘æ¨¡æ‹Ÿï¼‰ï¼Œç”šè‡³èƒ½å¤ç°ç”¨æˆ·æç«¯ç¯å¢ƒä¸‹çš„è¡Œä¸º</p>
<hr/>
<h2 data-id="heading-7">å››ã€å¤æ‚é—®é¢˜è¯Šæ–­ï¼šCharles çš„å®é™…åº”ç”¨ç­–ç•¥</h2>
<p>ä¸‹é¢æ˜¯ä¸€äº›çœŸå®é¡¹ç›®ä¸­éªŒè¯æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p>
<hr/>
<h3 data-id="heading-8"><strong>â‘  è¯·æ±‚å‚æ•°â€œçœ‹ä¼¼æ­£ç¡®â€ï¼Œä½†é“¾è·¯ä¸­è¢«ä¿®æ”¹</strong></h3>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li>API ç½‘å…³è‡ªåŠ¨æ ¼å¼åŒ–æŸäº› Header</li>
<li>Nginx è‡ªåŠ¨æ·»åŠ æˆ–æ›¿æ¢å­—æ®µ</li>
<li>App äºŒæ¬¡å°è£…å¯¼è‡´ç¼–ç é”™è¯¯</li>
</ul>
<p>é€šè¿‡ Charles çš„ Raw è§†å›¾å¯ä»¥éªŒè¯çœŸæ­£å‘é€çš„å†…å®¹ã€‚</p>
<p>è¿™èƒ½é¿å…å‰åç«¯ä¹‹é—´çš„å‚æ•°äº‰è®®ã€‚</p>
<hr/>
<h3 data-id="heading-9"><strong>â‘¡ å¤šç¯å¢ƒé…ç½®æ··ä¹±å¯¼è‡´æ•°æ®å¼‚å¸¸</strong></h3>
<p>éå¸¸å¸¸è§çš„æƒ…å†µï¼š
å¼€å‘ç¯å¢ƒ â†’ æµ‹è¯•ç¯å¢ƒ â†’ é¢„å‘å¸ƒç¯å¢ƒ â†’ ç”Ÿäº§ç¯å¢ƒ</p>
<p>Charles å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>è¯·æ±‚åˆ°åº•åˆ°äº†å“ªä¸ªåŸŸå</li>
<li>æ˜¯å¦è¢«å†…éƒ¨ä»£ç†ä¸­è½¬</li>
<li>æ˜¯å¦å‘ç”Ÿäº†æ„å¤–çš„é‡å®šå‘</li>
</ul>
<p>è¿™ç±»é—®é¢˜æ²¡æœ‰æŠ“åŒ…å‡ ä¹æ— æ³•è°ƒæŸ¥ã€‚</p>
<hr/>
<h3 data-id="heading-10"><strong>â‘¢ é¡µé¢åŠ è½½æ…¢ï¼Œä½†ä¸æ˜¯åç«¯æ€§èƒ½é—®é¢˜</strong></h3>
<p>é€šè¿‡ Timeline å¯ä»¥å‘ç°ï¼š</p>
<ul>
<li>DNS æ…¢</li>
<li>SSL æ¡æ‰‹æ…¢</li>
<li>å®¢æˆ·ç«¯å‘é€æ•°æ®æ…¢</li>
<li>ç½‘ç»œç¯å¢ƒé€ æˆä¼ è¾“å»¶è¿Ÿ</li>
</ul>
<p>è¿™ç±»é—®é¢˜å¸¸è¢«è¯¯åˆ¤ä¸ºâ€œåç«¯æ…¢â€ã€‚</p>
<p>å®é™…åŸå› å¯èƒ½æ˜¯ï¼š</p>
<ul>
<li>CDN è·¯ç”±å¼‚å¸¸</li>
<li>è¿è¥å•†ç½‘ç»œæŠ–åŠ¨</li>
<li>ç§»åŠ¨ç«¯ç½‘ç»œåˆ‡æ¢</li>
</ul>
<p>Charles åœ¨é“¾è·¯åˆ†æä¸­éå¸¸å…³é”®ã€‚</p>
<hr/>
<h3 data-id="heading-11"><strong>â‘£ App å¼±ç½‘åœºæ™¯ä¸‹å¼‚å¸¸è¡Œä¸º</strong></h3>
<p>ä½¿ç”¨ Throttle æ¨¡æ‹Ÿï¼š</p>
<ul>
<li>3G</li>
<li>é«˜å»¶è¿Ÿ</li>
<li>éšæœºä¸¢åŒ…</li>
</ul>
<p>ä½ ä¼šå‘ç°ï¼š</p>
<ul>
<li>æŸäº›è¯·æ±‚ä¼šè¢« App ç›´æ¥å–æ¶ˆ</li>
<li>æŸäº› UI åŠ¨ç”»å¯¼è‡´è¯·æ±‚ä¸­æ–­</li>
<li>Token åˆ·æ–°ä¼šå˜å¾—ä¸ç¨³å®š</li>
</ul>
<p>è¿™äº›éƒ½æ˜¯ç”¨æˆ·çœŸå®ä¼šé‡åˆ°çš„é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-12">äº”ã€å›¢é˜Ÿåä½œæ–¹å¼ï¼šå¦‚ä½•è®©æŠ“åŒ…æå‡æ•´ä½“æ•ˆç‡ï¼Ÿ</h2>
<p>Charles åœ¨å›¢é˜Ÿä¸­èƒ½æ‰®æ¼” â€œé—®é¢˜å¤ç°å™¨â€ çš„è§’è‰²ã€‚</p>
<h3 data-id="heading-13"><strong>â‘  æµ‹è¯•å¯¼å‡º .chls æ–‡ä»¶</strong></h3>
<p>å¼€å‘è€…åªéœ€å¯¼å…¥å³å¯ 100% é‡ç°ç”¨æˆ·é—®é¢˜ã€‚</p>
<h3 data-id="heading-14"><strong>â‘¡ å‰ç«¯ä½¿ç”¨ Mock ç®€åŒ–è”è°ƒ</strong></h3>
<p>Map Local ä¸ Rewrite èƒ½æ˜¾è‘—æé«˜æ•ˆç‡ã€‚</p>
<h3 data-id="heading-15"><strong>â‘¢ åç«¯åˆ†æé”™è¯¯é“¾è·¯ä¸ä»£ç†è¡Œä¸º</strong></h3>
<p>ç‰¹åˆ«é€‚åˆå¤„ç† Nginx / API Gateway / CDN é—®é¢˜ã€‚</p>
<h3 data-id="heading-16"><strong>â‘£ ç§»åŠ¨ç«¯ç”¨äºå¤ç°ç¦»æ•£è¡Œä¸º</strong></h3>
<p>ä¾‹å¦‚é—´æ­‡æ€§å¤±è´¥ã€è¯·æ±‚ä¸­æ–­ç­‰ã€‚</p>
<hr/>
<h2 data-id="heading-17">å…­ã€æŠ“åŒ…å¤±è´¥çš„å¸¸è§åŸå› ä¸è§„é¿ç­–ç•¥</h2>



































<table><thead><tr><th>é—®é¢˜</th><th>åŸå› </th><th>è§£å†³æ–¹æ³•</th></tr></thead><tbody><tr><td>HTTPS æ— å†…å®¹</td><td>SSL è¯ä¹¦æœªä¿¡ä»»</td><td>é‡æ–°å®‰è£… CAã€å¯ç”¨ SSL Proxy</td></tr><tr><td>æ‰‹æœºæŠ“ä¸åˆ°è¯·æ±‚</td><td>Wi-Fi ä¸åŒç½‘æ®µ</td><td>æ‰‹åŠ¨é…ç½®ä»£ç†å¹¶æ£€æŸ¥ IP</td></tr><tr><td>æŠ“åŒ…ä¹±ç </td><td>å†…å®¹è¢«å‹ç¼©</td><td>å¼€å¯è§£å‹ç¼©åŠŸèƒ½</td></tr><tr><td>App æŠ¥å®‰å…¨é”™è¯¯</td><td>SSL Pinning</td><td>ä½¿ç”¨è°ƒè¯•åŒ…æˆ–å…³é—­ Pinning</td></tr><tr><td>è¯·æ±‚æ¶ˆå¤±</td><td>ç³»ç»Ÿä»£ç†è¢«å…¶ä»–è½¯ä»¶è¦†ç›–</td><td>é‡å¯ Charles å¹¶å…³é—­å†²çªå·¥å…·</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-18">ä¸ƒã€æ›´å¤šå®Œæ•´æ“ä½œæ­¥éª¤</h2>
<p>å¯å‚è€ƒï¼š<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fcharlesproxy.net%2F" target="_blank" title="https://charlesproxy.net/" ref="nofollow noopener noreferrer">Charlesä¸­æ–‡ç½‘</a></strong></p>
<p>æä¾›ï¼š</p>
<ul>
<li>æŠ“åŒ…æµç¨‹å›¾è§£</li>
<li>HTTPS è¯ä¹¦é…ç½®</li>
<li>æ‰‹æœºæŠ“åŒ…æ•™ç¨‹</li>
<li>Rewrite / Map Local ç¤ºä¾‹</li>
<li>å¸¸è§é—®é¢˜æ’æŸ¥é€»è¾‘</li>
</ul>
<hr/>
<h2 data-id="heading-19">æŠ“åŒ…ï¼Œæ˜¯ç†è§£ç³»ç»Ÿçš„æœ€åº•å±‚èƒ½åŠ›</h2>
<p>ä¸€ä¸ªç†Ÿç»ƒä½¿ç”¨ Charles çš„å·¥ç¨‹å¸ˆï¼Œå¾€å¾€æ¯”å•çº¯ä¼šå†™ä»£ç çš„å·¥ç¨‹å¸ˆæ›´å¿«æ‰¾åˆ°æ ¹å› ã€‚</p>
<p>å› ä¸ºæŠ“åŒ…è®©ä½ çœ‹æ¸…ï¼š</p>
<ul>
<li>è¯·æ±‚è·¯å¾„</li>
<li>é“¾è·¯è¡Œä¸º</li>
<li>å‚æ•°ä¼ è¾“</li>
<li>ç½‘ç»œå¼‚å¸¸</li>
<li>ç¯å¢ƒåå·®</li>
</ul>
<p>è¿™äº›å› ç´ å¾€å¾€æ‰æ˜¯å¤æ‚é—®é¢˜çš„æ ¸å¿ƒã€‚</p>
<blockquote>
<p>Charles çœŸæ­£å¸¦æ¥çš„ä¸æ˜¯æŠ€èƒ½ï¼Œè€Œæ˜¯æ´å¯Ÿç³»ç»Ÿçš„èƒ½åŠ›ã€‚</p>
</blockquote>
<p>åªè¦æŒæ¡æŠ“åŒ…ï¼Œç³»ç»Ÿå°±ä¸å†æ˜¯é»‘ç®±ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursor 2.1 å‘å¸ƒå®æµ‹ï¼šè®¡åˆ’èƒ½ç‚¹äº†ï¼Œå®¡æŸ¥èƒ½ç”¨äº†ï¼ŒCR èŠ±å¤šå°‘ï¼Ÿæˆ‘ä¹Ÿæ›¿ä½ è¯•äº†]]></title>    <link>https://juejin.cn/post/7575651989985591350</link>    <guid>https://juejin.cn/post/7575651989985591350</guid>    <pubDate>2025-11-24T02:02:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575651989985591350" data-draft-id="7575751471841476644" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursor 2.1 å‘å¸ƒå®æµ‹ï¼šè®¡åˆ’èƒ½ç‚¹äº†ï¼Œå®¡æŸ¥èƒ½ç”¨äº†ï¼ŒCR èŠ±å¤šå°‘ï¼Ÿæˆ‘ä¹Ÿæ›¿ä½ è¯•äº†"/> <meta itemprop="keywords" content="Cursor,AIç¼–ç¨‹,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T02:02:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å“¥æ•°æ™ºè°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursor 2.1 å‘å¸ƒå®æµ‹ï¼šè®¡åˆ’èƒ½ç‚¹äº†ï¼Œå®¡æŸ¥èƒ½ç”¨äº†ï¼ŒCR èŠ±å¤šå°‘ï¼Ÿæˆ‘ä¹Ÿæ›¿ä½ è¯•äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å“¥æ•°æ™ºè°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:02:58.000Z" title="Mon Nov 24 2025 02:02:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>21å·ï¼Œ<code>Cursor</code> å‡çº§äº† <code>2.1</code> ç‰ˆæœ¬ï¼Œç»™å¤§å®¶ç®€å•åŒæ­¥ä¸‹å‡çº§å†…å®¹ã€‚</p>
<h2 data-id="heading-0">æ”¹è¿›çš„è®¡åˆ’æ¨¡å¼</h2>
<p>æµç¨‹å’Œå®šä½æ²¡æœ‰æ”¹å˜ï¼Œæœ€å¤§çš„æ”¹å˜æ˜¯äº¤äº’æ–¹å¼çš„ä¼˜åŒ–ã€‚</p>
<p>åŸæ¥çš„ <code>Plan</code> æ¨¡å¼æ˜¯ <code>Cursor</code> ç»™å‡ºé—®é¢˜å’Œå¸¦åºå·çš„ç­”æ¡ˆï¼Œä½ å¯ä»¥å“åº”é—®é¢˜é¢˜å·å’Œç­”æ¡ˆçš„åºå·ï¼Œæ¯”å¦‚ï¼š<code>1:A,2:B</code>ã€‚</p>
<p>è¿™æ¬¡å‡çº§åï¼Œå°±ä¸ç”¨æ‰‹åŠ¨å½•å…¥äº†ï¼Œç›´æ¥é€šè¿‡<strong>å›¾å½¢äº¤äº’</strong>ç‚¹å‡»é€‰é¡¹å³å¯ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df240a005234462b8b658c6cba326122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554578&amp;x-signature=BZldWDZxOcHywR%2FRkI%2BnaO6s5iU%3D" alt="" loading="lazy"/></p>
<p>å¹¶ä¸”æ”¯æŒäº†å¤šè½®é—®ç­”ï¼Œè¿™æ ·ç”Ÿæˆçš„è®¡åˆ’ä¼šæ›´åŠ å‡†ç¡®å’Œç¬¦åˆé¢„æœŸã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b01bd6e574c461cb5a0d9392a2021b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554578&amp;x-signature=9hE4I9xfh6V4Ykqo3Q7YEbcxvRw%3D" alt="" loading="lazy"/></p>
<p>å…¨éƒ¨åˆ†æå®Œæˆåï¼Œå°±ä¼šç”Ÿæˆåˆ†ææ–‡æ¡£å’Œè®¡åˆ’ï¼Œç¡®è®¤æ— è¯¯åï¼Œå¯ä»¥ç‚¹å‡»â€œBuildâ€å¼€å§‹ç”Ÿæˆã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/514a5c2cc29440259f157fa9e76b0ea8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554578&amp;x-signature=ZwubKZQxyV1qIszXwgdNGsvs%2FNI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">AI ä»£ç å®¡æŸ¥</h2>
<p>è¿™ä¸ªåŠŸèƒ½ä¹‹å‰ç‰ˆæœ¬å·²ç»å¼€å§‹é€æ­¥ä¸Šçº¿ï¼Œè¿™æ¬¡ç®—æ˜¯æ­£å¼æ¨å‡ºå§ã€‚</p>
<p>æˆ‘ç°åœ¨ä½¿ç”¨ AI ååŒç ”å‘çš„æ—¶å€™ï¼ŒAI ç”Ÿæˆçš„ä»£ç æ˜¯é€šè¿‡â€œ<strong>äººå·¥</strong>â€+â€œ<strong>AI Commit Message</strong>â€è¿›è¡Œå®¡æŸ¥çš„ã€‚</p>
<p>ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>AI Code Reviews</code> è¿›è¡Œäº†ã€‚</p>
<h3 data-id="heading-2">å…¥å£</h3>
<p><code>Agent Review</code> æœ‰ä¸¤ä¸ªå…¥å£ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ˜¯åœ¨ç”Ÿæˆç»“æœæœ€åçš„ <code>agent diff</code> å¤„ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1822c3f938ba4d369bb812d0ed57280d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554578&amp;x-signature=bi7tefD5yTQ8VY2aHNSC31ivmNg%3D" alt="" loading="lazy"/></p>
<ul>
<li>å¦ä¸€ä¸ªæ˜¯ <code>Source Control</code> é€‰é¡¹å¡çš„ <code>Agent Review</code>ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed13a5dc36384ec690a2aca6bc6e9cd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554578&amp;x-signature=rIp%2ByfHkoQp1TyQTSuAYUpShOzo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">Review çš„æ•ˆæœ</h3>
<p><code>Review</code> åçš„æ•ˆæœå¦‚ä¸‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2389eef2c60a4487b6d139cfe987b9f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554578&amp;x-signature=lKco8PGtWJ2GiPUSiJwhLJHAPPk%3D" alt="" loading="lazy"/></p>
<p>å¯ä»¥ç›´æ¥çœ‹åˆ° AI å¸®ä½ æ‰¾åˆ°çš„ <code>Issue</code>ï¼Œæ”¯æŒå•ä¸ªä¿®å¤ï¼Œä¹Ÿæ”¯æŒä¸€é”®å…¨éƒ¨ä¿®å¤ã€‚</p>
<h3 data-id="heading-4">è®¡è´¹æ–¹å¼</h3>
<p>æŒ‰ç…§ <code>Review</code> ä¸­çš„<strong>å®é™…ä½¿ç”¨é‡è®¡è´¹</strong>çš„ã€‚</p>
<p>æˆ‘å¸®å¤§å®¶æµ‹è¯•äº†ä¸€ä¸‹ï¼Œ18 ä¸ªå‰ç«¯æ–‡ä»¶ <code>Review</code> äº†ä¸€æ¬¡ï¼Œ<code>86.6</code>ä¸‡ Tokenï¼Œ<code>0.23</code>ç¾å…ƒï¼Œä¸ä¾¿å®œå‘€ï¼Œå¤§å®¶æŒ‰éœ€ä½¿ç”¨ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1c6256dfbe543a89c94b67f31c09278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554578&amp;x-signature=htlnsY5Mb%2FBrMLJiVvhrZkfnyzk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">å³æ—¶grep</h2>
<p>æˆ‘ç†è§£çš„æ˜¯ç¼–è¾‘å™¨å†…æ‰‹åŠ¨æœç´¢ï¼Œæˆ–è€…æ¨¡å‹åœ¨è°ƒç”¨ <code>grep</code> å‘½ä»¤æ—¶ï¼Œä¼šè§¦å‘â€œå³æ—¶grepâ€çš„ç‰¹æ€§ã€‚</p>
<p>è¯¥ç‰¹æ€§å¯ä»¥æä¾›ä¸€ä¸ª<strong>è¶…å¿«çš„æœç´¢åŠŸèƒ½</strong>ï¼Œè®©ä½ å¿«é€Ÿå®šä½è¦æ‰¾çš„æ–‡ä»¶ï¼Œä¸éœ€ç­‰å¾…æ‰«ææ•´ä¸ªä»£ç åº“ã€‚</p>
<p>æˆ‘é—®äº† <code>Composer 1</code>ï¼Œåº•å±‚åº”è¯¥æ˜¯é›†æˆäº† <code>ripgrep</code>ã€‚</p>
<h2 data-id="heading-6">ç§»é™¤è‡ªå®šä¹‰æ™ºèƒ½ä½“</h2>
<p>è‡ªå®šä¹‰ Agent æ¨¡å¼è¢«ç§»é™¤ï¼Œå¦‚æœæƒ³ç”¨çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨<strong>è‡ªå®šä¹‰å‘½ä»¤</strong>ã€‚</p>
<p>å‰å‡ å¤©åˆšå®ç°çš„è‡ªå®šä¹‰æ™ºèƒ½ä½“è¿˜å¾—æ”¹ä¸‹ã€‚</p>
<h2 data-id="heading-7">ç»“è¯­</h2>
<p>è¿™æ¬¡å‡çº§æ²¡æœ‰ç‰¹åˆ«å¤§çš„è°ƒæ•´ï¼Œä½†åŠŸèƒ½å€’æ˜¯æŒºå®ç”¨çš„ï¼Œå¤§å®¶å¯ä»¥é…Œæƒ…è¯•ç”¨ã€‚</p>
<p>æœ‰ä»€ä¹ˆç–‘é—®æ¬¢è¿ç•™è¨€äº¤æµ~</p>
<p>æ˜å¤©å‘¨ä¸€ï¼ŒåŠ æ²¹ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript é—­åŒ…é€šå…³æŒ‡å—ï¼šä»ä½œç”¨åŸŸé“¾åˆ°å†…å­˜ç®¡ç†çš„8ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹]]></title>    <link>https://juejin.cn/post/7575363120799088640</link>    <guid>https://juejin.cn/post/7575363120799088640</guid>    <pubDate>2025-11-24T00:16:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575363120799088640" data-draft-id="7575363120799072256" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript é—­åŒ…é€šå…³æŒ‡å—ï¼šä»ä½œç”¨åŸŸé“¾åˆ°å†…å­˜ç®¡ç†çš„8ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T00:16:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_é™ˆå¯’"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript é—­åŒ…é€šå…³æŒ‡å—ï¼šä»ä½œç”¨åŸŸé“¾åˆ°å†…å­˜ç®¡ç†çš„8ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_é™ˆå¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T00:16:59.000Z" title="Mon Nov 24 2025 00:16:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScript é—­åŒ…é€šå…³æŒ‡å—ï¼šä»ä½œç”¨åŸŸé“¾åˆ°å†…å­˜ç®¡ç†çš„8ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>é—­åŒ…ï¼ˆClosureï¼‰æ˜¯ JavaScript ä¸­æœ€å¼ºå¤§ä¸”æœ€å®¹æ˜“è¢«è¯¯è§£çš„æ¦‚å¿µä¹‹ä¸€ã€‚å®ƒä¸ä»…æ˜¯é¢è¯•ä¸­çš„é«˜é¢‘è€ƒç‚¹ï¼Œæ›´æ˜¯å®é™…å¼€å‘ä¸­è§£å†³å¤æ‚é—®é¢˜çš„åˆ©å™¨ã€‚ç†è§£é—­åŒ…ä¸ä»…éœ€è¦æŒæ¡ä½œç”¨åŸŸé“¾ã€æ‰§è¡Œä¸Šä¸‹æ–‡ç­‰åŸºç¡€æ¦‚å¿µï¼Œè¿˜éœ€è¦æ·±å…¥æ€è€ƒå†…å­˜ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–ç­‰é«˜çº§è¯é¢˜ã€‚</p>
<p>æœ¬æ–‡å°†ç³»ç»Ÿæ€§åœ°æ‹†è§£é—­åŒ…çš„8ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œä»ä½œç”¨åŸŸé“¾çš„åº•å±‚æœºåˆ¶åˆ°å†…å­˜æ³„æ¼çš„å®æˆ˜æ’æŸ¥ï¼Œå¸¦ä½ å½»åº•æŒæ¡è¿™ä¸€é‡è¦æ¦‚å¿µã€‚æ— è®ºä½ æ˜¯åˆå­¦è€…è¿˜æ˜¯æœ‰ä¸€å®šç»éªŒçš„å¼€å‘è€…ï¼Œéƒ½èƒ½ä»ä¸­è·å¾—æ–°çš„å¯å‘ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸€ã€ä½œç”¨åŸŸé“¾ï¼šé—­åŒ…çš„ç†è®ºåŸºçŸ³</h2>
<h3 data-id="heading-3">1.1 è¯æ³•ä½œç”¨åŸŸ vs åŠ¨æ€ä½œç”¨åŸŸ</h3>
<p>JavaScript é‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸï¼ˆLexical Scopeï¼‰ï¼Œè¿™æ„å‘³ç€å˜é‡çš„å¯è®¿é—®æ€§åœ¨ä»£ç ç¼–å†™é˜¶æ®µå°±å·²ç»ç¡®å®šã€‚è¿™ä¸åŠ¨æ€ä½œç”¨åŸŸè¯­è¨€ï¼ˆå¦‚ Bashï¼‰å½¢æˆé²œæ˜å¯¹æ¯”ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> x = <span class="hljs-string">'outer'</span>;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x); <span class="hljs-comment">// "outer"ï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰</span>
  }
  
  <span class="hljs-title function_">inner</span>();
}

<span class="hljs-keyword">const</span> x = <span class="hljs-string">'global'</span>;
<span class="hljs-title function_">outer</span>();
</code></pre>
<h3 data-id="heading-4">1.2 [[Scope]]å†…éƒ¨å±æ€§</h3>
<p>æ¯ä¸ªå‡½æ•°åœ¨åˆ›å»ºæ—¶éƒ½ä¼šè®°å½•è‡ªå·±çš„[[Scope]]å†…éƒ¨å±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰æ‰§è¡Œç¯å¢ƒå˜é‡å¯¹è±¡çš„å¼•ç”¨é“¾ã€‚è¿™æ˜¯ç†è§£é—­åŒ…çš„å…³é”®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCounter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> ++count;
  };
}

<span class="hljs-keyword">const</span> counter = <span class="hljs-title function_">createCounter</span>();
<span class="hljs-comment">// counter.[[Scope]] -&gt; [createCounterçš„å˜é‡å¯¹è±¡, globalå˜é‡å¯¹è±¡]</span>
</code></pre>
<hr/>
<h2 data-id="heading-5">äºŒã€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸é—­åŒ…çš„å½¢æˆ</h2>
<h3 data-id="heading-6">2.1 EC/VO/AOä¸‰ä»¶å¥—</h3>
<p>å½“å‡½æ•°æ‰§è¡Œæ—¶ä¼šåˆ›å»ºï¼š</p>
<ul>
<li>ECï¼ˆExecution Contextï¼‰ï¼šæ‰§è¡Œä¸Šä¸‹æ–‡</li>
<li>VOï¼ˆVariable Objectï¼‰ï¼šå˜é‡å¯¹è±¡ï¼ˆå…¨å±€ç¯å¢ƒä¸‹ï¼‰</li>
<li>AOï¼ˆActivation Objectï¼‰ï¼šæ´»åŠ¨å¯¹è±¡ï¼ˆå‡½æ•°ç¯å¢ƒä¸‹ï¼‰</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a</span>) {
  <span class="hljs-keyword">var</span> b = a * <span class="hljs-number">2</span>;
  
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params">c</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b, c);
  }
  
  <span class="hljs-title function_">bar</span>(b * <span class="hljs-number">3</span>);
}

<span class="hljs-title function_">foo</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// ECæ ˆçš„å˜åŒ–è¿‡ç¨‹å€¼å¾—æ·±å…¥ç ”ç©¶</span>
</code></pre>
<h3 data-id="heading-7">2.2 Closureçš„å½¢æˆæ—¶æœº</h3>
<p>ä¸¥æ ¼æ¥è¯´ï¼Œ<strong>æ‰€æœ‰JavaScriptå‡½æ•°éƒ½æ˜¯é—­åŒ…</strong>ï¼Œå› ä¸ºå®ƒä»¬éƒ½æŒæœ‰[[Scope]]å¼•ç”¨ã€‚ä½†æˆ‘ä»¬é€šå¸¸è®¨è®ºçš„æ˜¯é‚£äº›ï¼š</p>
<ol>
<li>è®¿é—®äº†å¤–å±‚å˜é‡çš„å†…å±‚å‡½æ•°</li>
<li>è¢«å¤–éƒ¨å¼•ç”¨çš„å†…å±‚å‡½æ•°</li>
</ol>
<hr/>
<h2 data-id="heading-8">III. IIFEæ¨¡å¼ä¸æ¨¡å—åŒ–</h2>
<h3 data-id="heading-9">III.I Immediately Invoked Function Expression</h3>
<p>IIFEæ˜¯æ—©æœŸå®ç°æ¨¡å—åŒ–çš„åˆ©å™¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = (<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> privateVar = <span class="hljs-string">'secret'</span>;
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">getSecret</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> privateVar;
    }
  };
})();
</code></pre>
<h3 data-id="heading-10">III.II ES6ä¹‹å‰çš„æ¨¡å—æ¨¡æ‹Ÿ</h3>
<p>é€šè¿‡ç»„åˆIIFEå’Œé—­åŒ…å¯ä»¥å®ç°å®Œæ•´çš„æ¨¡å—ç³»ç»Ÿï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">MyModule</span> = (<span class="hljs-keyword">function</span> <span class="hljs-title function_">Manager</span>(<span class="hljs-params"/>) {
	<span class="hljs-keyword">var</span> modules = {};
	
	<span class="hljs-keyword">function</span> <span class="hljs-title function_">define</span>(<span class="hljs-params">name, deps, impl</span>) {
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;deps.<span class="hljs-property">length</span>; i++) {
			deps[i] = modules[deps[i]];
		}
		modules[name] = impl.<span class="hljs-title function_">apply</span>(impl, deps);
	}
	
	<span class="hljs-keyword">function</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">name</span>) {
		<span class="hljs-keyword">return</span> modules[name];
	}
	
	<span class="hljs-keyword">return</span> { define, get };
})();
</code></pre>
<hr/>
<h2 data-id="heading-11">IV.  å†…å­˜ç®¡ç†æ·±åº¦è§£æ</h2>
<h3 data-id="heading-12">IV.I GCçš„æ ‡è®°æ¸…é™¤ç®—æ³•</h3>
<p>ç°ä»£JavaScriptå¼•æ“é‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼š</p>
<ol>
<li>ä»æ ¹å¯¹è±¡(window/global)å‡ºå‘æ ‡è®°å¯è¾¾å¯¹è±¡</li>
<li>æ¸…é™¤ä¸å¯è¾¾å¯¹è±¡</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createHugeArray</span>(<span class="hljs-params"/>) {
	<span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-string">'*'</span>);
	
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr.<span class="hljs-property">length</span>);
	};
}

<span class="hljs-keyword">let</span> closureWithHugeData = <span class="hljs-title function_">createHugeArray</span>();

<span class="hljs-comment">// closureWithHugeDataæŒæœ‰ç€ç™¾ä¸‡çº§æ•°ç»„çš„å¼•ç”¨ï¼</span>
</code></pre>
<h3 data-id="heading-13">IV.II Chrome DevToolså®æˆ˜æ’æŸ¥</h3>
<p>é€šè¿‡Memoryé¢æ¿å¯ä»¥æ•è·å †å¿«ç…§ï¼š</p>
<ol>
<li>æŸ¥æ‰¾Retainersé“¾æ¡ä¸­çš„closureå¼•ç”¨</li>
<li>æ¯”å¯¹å¤šæ¬¡å¿«ç…§é—´çš„å¢é‡å˜åŒ–</li>
</ol>
<hr/>
<h2 data-id="heading-14">V.  æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h2>
<h3 data-id="heading-15">V.I Smart Closuresè®¾è®¡æ¨¡å¼</h3>
<p>é¿å…ä¸å¿…è¦çš„å˜é‡æ•è·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Bad: capture unused variable </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">data</span>) {
	<span class="hljs-keyword">const</span> unusedData = <span class="hljs-title function_">transform</span>(data);
	
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-comment">/*...*/</span> };
}

<span class="hljs-comment">// Good: minimize captured variables </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processOptimized</span>(<span class="hljs-params">data</span>) {
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { 
		<span class="hljs-keyword">const</span> neededData = <span class="hljs-title function_">transform</span>(data);
		<span class="hljs-comment">/*...*/</span> 
	};
}
</code></pre>
<h3 data-id="heading-16">V.I I V8å¼•æ“ä¼˜åŒ–æŠ€å·§</h3>
<p>V8å¯¹ä»¥ä¸‹æƒ…å†µæœ‰ç‰¹æ®Šä¼˜åŒ–ï¼š</p>
<ol>
<li>åªä½¿ç”¨å¤–å±‚å˜é‡çš„åˆå§‹å€¼ï¼ˆä¸ä¿®æ”¹ï¼‰</li>
<li>ä¸è¶…è¿‡ä¸€å®šæ•°é‡çš„æ•è·å˜é‡ï¼ˆé€šå¸¸3-4ä¸ªï¼‰</li>
</ol>
<hr/>
<h2 data-id="heading-17">VI . thisç»‘å®šä¸é—­åŒ…çš„å¾®å¦™å…³ç³»</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {
	<span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
	<span class="hljs-attr">getName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
			<span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>; <span class="hljs-comment">// Wrong!</span>
		};
	},
	<span class="hljs-attr">getNameCorrect</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
		<span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-comment">// Closure captures self </span>
			<span class="hljs-keyword">return</span> self.<span class="hljs-property">name</span>;
		};
	}
};
</code></pre>
<p>ç®­å¤´å‡½æ•°æä¾›äº†æ›´ä¼˜é›…çš„æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">getNameArrow</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { 
	<span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>; 
}
</code></pre>
<hr/>
<h2 data-id="heading-18">VII . Real-Worldåº”ç”¨æ¡ˆä¾‹é›†é”¦</h2>
<h3 data-id="heading-19">VII.I Throttle/Debounceå®ç°</h3>
<p>ç»å…¸çš„é˜²æŠ–å®ç°å°±æ˜¯é—­åŒ…çš„å®Œç¾ç”¨ä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, delay</span>) {
	<span class="hljs-keyword">let</span> timer;
	
	<span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> { <span class="hljs-comment">// Closure captures timer </span>
	  <span class="hljs-built_in">clearTimeout</span>(timer);
	  timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fn</span>(...args), delay);
	};
}
</code></pre>
<h3 data-id="heading-20">VII.I I React HooksåŸç†å‰–æ</h3>
<p>useStateçš„å®ç°æœ¬è´¨ä¸Šä¾èµ–é—­åŒ…ï¼š</p>
<pre><code class="hljs language-jsx{5}" lang="jsx{5}">function useState(initialValue) { // Simplified version 
	let state = initialValue;
	
	const setState = (newValue) =&gt; { state = newValue };
	
	return [state, setState]; // Both captured by closure 
}
</code></pre>
<hr/>
<h2 data-id="heading-21">VIII . ES6+æ–°ç‰¹æ€§å¯¹é—­åŒ…çš„å½±å“</h2>
<h3 data-id="heading-22">VIII.I Block Scopingçš„é©å‘½</h3>
<p>let/constæ”¹å˜äº†ä¼ ç»Ÿçš„varæ•è·æ–¹å¼ï¼š</p>
<pre><code class="hljs language-javascript{4}" lang="javascript{4}">for(let i=0; i&lt;3; i++) { // Each iteration gets fresh binding! 
	setTimeout(() =&gt; console.log(i), i*1000); // Logs:0,1,2 
} 

for(var j=0; j&lt;3; j++) { // Traditional var sharing same binding 
	setTimeout(() =&gt; console.log(j), j*1000); // Logs:3,3,3 
}
</code></pre>
<h3 data-id="heading-23">VIII.I I WeakMapå¸¦æ¥çš„æ–°å¯èƒ½</h3>
<p>è§£å†³DOMèŠ‚ç‚¹å…³è”é—®é¢˜çš„æ–°æ€è·¯ï¼š</p>
<pre><code class="hljs language-javascript{5}" lang="javascript{5}">const wm = new WeakMap();

function registerHandler(element) { /* ... */ }

wm.set(elementNode1234, bigClosure); // GCå‹å¥½å‹å…³è”å­˜å‚¨ 

wm.get(elementNode1234)?.(event); // Safe optional chaining call 
</code></pre>
<hr/>
<h2 data-id="heading-24">Conclusion</h2>
<p>JavaScriptçš„é—­åŒ…å°±åƒä¸€æŠŠåŒåˆƒå‰‘â€”â€”ç”¨å¾—å¥½å¯ä»¥æ–©æ–­å¤æ‚é—®é¢˜ï¼Œç”¨å¾—ä¸å½“å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚é€šè¿‡æœ¬æ–‡çš„ç³»ç»Ÿæ¢³ç†ï¼Œæˆ‘ä»¬ä¸ä»…ç†è§£äº†[[Scope]]çš„å†…éƒ¨æœºåˆ¶ï¼Œè¿˜æŒæ¡äº†ä»IIFEåˆ°ç°ä»£Hooksçš„åº”ç”¨æ¼”å˜å†ç¨‹ã€‚</p>
<p>è®°ä½è¿™äº›å…³é”®ç‚¹ï¼š<br/>
âœ”ï¸ <strong>æœ€å°åŒ–æ•è·åŸåˆ™</strong> â€”â€”åªä¿ç•™å¿…è¦çš„å˜é‡å¼•ç”¨<br/>
âœ”ï¸ <strong>å·¥å…·é“¾éªŒè¯</strong> â€”â€”å–„ç”¨DevToolséªŒè¯å†…å­˜å½±å“<br/>
âœ”ï¸ <strong>æ‹¥æŠ±æ–°ç‰¹æ€§</strong> â€”â€”åˆç†è¿ç”¨å—çº§ä½œç”¨åŸŸå’ŒWeakMap</p>
<p>å½“ä½ ä¸‹æ¬¡é‡åˆ°éœ€è¦çŠ¶æ€ä¿æŒçš„åœºæ™¯æ—¶ï¼Œä¸å¦¨è‡ªä¿¡åœ°è¯´ï¼š"è¿™é‡Œè¯¥ç”¨é—­åŒ…ï¼"</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringCloud å¸¸è§é¢è¯•é¢˜ï¼ˆä¸‰ï¼‰]]></title>    <link>https://juejin.cn/post/7575456858427588654</link>    <guid>https://juejin.cn/post/7575456858427588654</guid>    <pubDate>2025-11-24T00:31:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858427588654" data-draft-id="7575017581037469734" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" SpringCloud å¸¸è§é¢è¯•é¢˜ï¼ˆä¸‰ï¼‰"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-11-24T00:31:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             SpringCloud å¸¸è§é¢è¯•é¢˜ï¼ˆä¸‰ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T00:31:01.000Z" title="Mon Nov 24 2025 00:31:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»37åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æœåŠ¡ç½‘å…³</h2>
<h3 data-id="heading-1">åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç½‘å…³çš„ä½œç”¨æ˜¯ä»€ä¹ˆ</h3>
<p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç½‘å…³ï¼ˆGatewayï¼‰å…·æœ‰ä»¥ä¸‹ä½œç”¨ï¼š</p>
<ul>
<li>ç»Ÿä¸€å…¥å£ï¼šç½‘å…³ä¸ºæ‰€æœ‰çš„å¾®æœåŠ¡æä¾›ä¸€ä¸ªå”¯ä¸€çš„å…¥å£ç‚¹ï¼Œä»è€Œç®€åŒ–äº†å®¢æˆ·ç«¯ä¸æœåŠ¡çš„äº¤äº’ï¼ŒåŒæ—¶ä¿éšœäº†åå°æœåŠ¡çš„å®‰å…¨æ€§ã€‚</li>
<li>é‰´æƒæ ¡éªŒï¼šç½‘å…³èƒ½å¤Ÿè¯†åˆ«æ¯ä¸ªè¿›æ¥çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®å…¶æƒé™è¿›è¡Œæ ¡éªŒï¼Œé˜»æ­¢ä¸ç¬¦åˆè¦æ±‚çš„è¯·æ±‚é€šè¿‡ã€‚</li>
<li>åŠ¨æ€è·¯ç”±ï¼šæ ¹æ®éœ€è¦ï¼Œç½‘å…³å¯ä»¥åŠ¨æ€åœ°å°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„åç«¯é›†ç¾¤ä¸­ï¼Œå®ç°æœåŠ¡çš„çµæ´»è°ƒåº¦ã€‚</li>
<li>é™ä½è€¦åˆåº¦ï¼šé€šè¿‡åœ¨ç½‘å…³å±‚åšæ˜ å°„ï¼Œå¯ä»¥å°†å®¢æˆ·ç«¯ä¸æœåŠ¡è§£è€¦ï¼Œä½¿æœåŠ¡å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œå‡å°‘ä¸¤è€…ä¹‹é—´çš„ä¾èµ–ã€‚</li>
<li>æä¾›é™„åŠ åŠŸèƒ½ï¼šç½‘å…³ä¸ä»…å¯ä»¥ä¿æŠ¤å¾®æœåŠ¡ï¼Œè¿˜å¯ä»¥ä¸ºæœåŠ¡æä¾›å’Œæ²‰æ·€æ›´å¤šé™„åŠ åŠŸèƒ½ï¼Œå¦‚ç†”æ–­ã€é™æµç­‰ã€‚</li>
</ul>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯APIç½‘å…³ï¼Ÿ</h3>
<p>APIç½‘å…³ï¼ˆAPI Gatewayï¼‰æ˜¯ä¸€ç§ä¸­é—´å±‚æœåŠ¡å™¨ï¼Œç”¨äºé›†ä¸­ç®¡ç†ã€ä¿æŠ¤å’Œè·¯ç”±å¯¹åç«¯æœåŠ¡çš„è®¿é—®ã€‚å®ƒå……å½“äº†å®¢æˆ·ç«¯ä¸åç«¯æœåŠ¡ä¹‹é—´çš„å…¥å£ç‚¹ï¼Œæä¾›äº†ä¸€ç»„ç»Ÿä¸€çš„æ¥å£æ¥ç®¡ç†å’Œæ§åˆ¶APIçš„è®¿é—®ã€‚</p>
<p>APIç½‘å…³çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>è·¯ç”±è½¬å‘ï¼šAPIç½‘å…³æ ¹æ®è¯·æ±‚çš„URLè·¯å¾„æˆ–å…¶ä»–æ ‡è¯†ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ç›¸åº”çš„åç«¯æœåŠ¡ã€‚é€šè¿‡é…ç½®è·¯ç”±è§„åˆ™ï¼Œå¯ä»¥çµæ´»åœ°å°†è¯·æ±‚åˆ†å‘ç»™ä¸åŒçš„åç«¯æœåŠ¡ã€‚</li>
<li>è´Ÿè½½å‡è¡¡ï¼šAPIç½‘å…³å¯ä»¥åœ¨åç«¯æœåŠ¡ä¹‹é—´å®ç°è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚å¹³å‡åˆ†å‘åˆ°å¤šä¸ªå®ä¾‹ä¸Šï¼Œæé«˜ç³»ç»Ÿçš„ååé‡å’Œå¯æ‰©å±•æ€§ã€‚</li>
<li>å®‰å…¨è®¤è¯ä¸æˆæƒï¼šAPIç½‘å…³å¯ä»¥é›†ä¸­å¤„ç†èº«ä»½éªŒè¯å’Œæˆæƒï¼Œç¡®ä¿åªæœ‰ç»è¿‡èº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯æ‰èƒ½è®¿é—®åç«¯æœåŠ¡ã€‚å®ƒå¯ä»¥ä¸èº«ä»½æä¾›è€…ï¼ˆå¦‚OAuthã€OpenID Connectï¼‰é›†æˆï¼Œè¿›è¡Œç”¨æˆ·è®¤è¯å’Œæˆæƒæ“ä½œã€‚</li>
<li>ç¼“å­˜ï¼šAPIç½‘å…³å¯ä»¥ç¼“å­˜åç«¯æœåŠ¡çš„å“åº”ï¼Œå‡å°‘å¯¹åç«¯æœåŠ¡çš„è¯·æ±‚æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</li>
<li>ç›‘æ§ä¸æ—¥å¿—ï¼šAPIç½‘å…³å¯ä»¥æ”¶é›†å’Œè®°å½•è¯·æ±‚çš„æŒ‡æ ‡å’Œæ—¥å¿—ï¼Œæä¾›å®æ—¶ç›‘æ§å’Œåˆ†æï¼Œå¸®åŠ©å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜è¿›è¡Œæ•…éšœæ’æŸ¥å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</li>
<li>æ•°æ®è½¬æ¢ä¸åè®®è½¬æ¢ï¼šAPIç½‘å…³å¯ä»¥åœ¨å®¢æˆ·ç«¯å’Œåç«¯æœåŠ¡ä¹‹é—´è¿›è¡Œæ•°æ®æ ¼å¼è½¬æ¢å’Œåè®®è½¬æ¢ï¼Œå¦‚å°†è¯·æ±‚ä»HTTPè½¬æ¢ä¸ºWebSocketï¼Œæˆ–å°†è¯·æ±‚çš„å‚æ•°è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œä»¥æ»¡è¶³åç«¯æœåŠ¡çš„éœ€æ±‚ã€‚</li>
<li>APIç‰ˆæœ¬ç®¡ç†ï¼šAPIç½‘å…³å¯ä»¥ç®¡ç†ä¸åŒç‰ˆæœ¬çš„APIï¼Œå…è®¸åŒæ—¶å­˜åœ¨å¤šä¸ªAPIç‰ˆæœ¬ï¼Œå¹¶é€šè¿‡è·¯ç”±è§„åˆ™å°†è¯·æ±‚æ­£ç¡®åœ°è·¯ç”±åˆ°ç›¸åº”çš„APIç‰ˆæœ¬ä¸Šã€‚<br/>
â€¦â€¦</li>
</ul>
<p>é€šè¿‡ä½¿ç”¨APIç½‘å…³ï¼Œå¯ä»¥ç®€åŒ–å‰ç«¯ä¸åç«¯æœåŠ¡çš„äº¤äº’ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å£å’Œå®‰å…¨æ€§ä¿éšœï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿äº†æœåŠ¡æ²»ç†å’Œç›‘æ§ã€‚å®ƒæ˜¯æ„å»ºå¾®æœåŠ¡æ¶æ„å’Œå®ç°APIç®¡ç†çš„é‡è¦ç»„ä»¶ä¹‹ä¸€ã€‚</p>
<h3 data-id="heading-3">SpringCloudå¯ä»¥é€‰æ‹©å“ªäº›APIç½‘å…³ï¼Ÿ</h3>
<p>ä½¿ç”¨SpringCloudå¼€å‘ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹çš„APIç½‘å…³é€‰å‹ï¼š</p>
<ul>
<li>Netflix Zuulï¼ˆå·²åœæ­¢æ›´æ–°ï¼‰ï¼šNetflix Zuulæ˜¯Spring Cloudæ—©æœŸç‰ˆæœ¬ä¸­æä¾›çš„é»˜è®¤APIç½‘å…³ã€‚å®ƒåŸºäºServletæŠ€æœ¯æ ˆï¼Œå¯ä»¥è¿›è¡Œè·¯ç”±ã€è¿‡æ»¤ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚ç„¶è€Œï¼Œè‡ª2020å¹´12æœˆèµ·ï¼ŒNetflixå®£å¸ƒåœæ­¢å¯¹Zuul 1çš„ç»´æŠ¤ï¼Œè½¬è€Œæ”¯æŒæ–°çš„APIç½‘å…³é¡¹ç›®ã€‚</li>
<li>Spring Cloud Gatewayï¼šSpring Cloud Gatewayæ˜¯Spring Cloudå®˜æ–¹æ¨èçš„APIç½‘å…³ï¼Œå–ä»£äº†Netflix Zuulã€‚å®ƒåŸºäºéé˜»å¡çš„WebFluxæ¡†æ¶ï¼Œå……åˆ†åˆ©ç”¨äº†å“åº”å¼ç¼–ç¨‹çš„ä¼˜åŠ¿ï¼Œå¹¶æä¾›äº†è·¯ç”±ã€è¿‡æ»¤ã€æ–­è·¯å™¨ã€é™æµç­‰ç‰¹æ€§ã€‚Spring Cloud Gatewayè¿˜æ”¯æŒä¸Spring Cloudçš„å…¶ä»–ç»„ä»¶é›†æˆï¼Œå¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰ã€‚</li>
<li>Kongï¼šKongæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€äº‘åŸç”Ÿçš„APIç½‘å…³å’ŒæœåŠ¡ç®¡ç†å¹³å°ï¼Œå¯ä»¥ä¸Spring Cloudé›†æˆã€‚KongåŸºäºNginxï¼Œæä¾›äº†å¼ºå¤§çš„è·¯ç”±ã€è®¤è¯ã€æˆæƒã€ç›‘æ§å’Œæ‰©å±•èƒ½åŠ›ã€‚å®ƒæ”¯æŒå¤šç§æ’ä»¶å’Œæ‰©å±•ï¼Œå¯æ»¡è¶³ä¸åŒçš„APIç®¡ç†éœ€æ±‚ã€‚</li>
<li>APISIXï¼šAPISIXåŸºäºNginxå’ŒLuaå¼€å‘ï¼Œå®ƒå…·æœ‰å¼ºå¤§çš„è·¯ç”±ã€æµé‡æ§åˆ¶ã€æ’ä»¶æ‰©å±•ç­‰åŠŸèƒ½ã€‚APISIXæ”¯æŒçµæ´»çš„é…ç½®æ–¹å¼ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡ŒåŠ¨æ€è·¯ç”±ã€è´Ÿè½½å‡è¡¡å’Œé™æµç­‰æ“ä½œã€‚</li>
</ul>
<h3 data-id="heading-4">è¯´è¯´ä½ å¯¹Spring Cloud Gatewayçš„ç†è§£</h3>
<p>Spring Cloud Gatewayæ˜¯Spring Cloudå®˜æ–¹æ¨å‡ºçš„ç¬¬äºŒä»£ç½‘å…³æ¡†æ¶ï¼Œå–ä»£Zuul 1.0ç½‘å…³ã€‚ç½‘å…³ä½œä¸ºæµé‡çš„ï¼Œåœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­æœ‰ç€éå¸¸ä½œç”¨ï¼Œç½‘å…³å¸¸è§çš„åŠŸèƒ½æœ‰è·¯ç”±è½¬å‘ã€æƒé™æ ¡éªŒã€é™æµæ§åˆ¶ç­‰ä½œç”¨ã€‚</p>
<p>ä½¿ç”¨äº†ä¸€ä¸ªRouteLocatorBuilderçš„beanå»åˆ›å»ºè·¯ç”±ï¼Œé™¤äº†åˆ›å»ºè·¯ç”±RouteLocatorBuilderå¯ä»¥è®©ä½ æ·»åŠ å„ç§predicateså’Œfiltersï¼Œpredicatesæ–­è¨€çš„æ„æ€ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ ¹æ®å…·ä½“çš„è¯·æ±‚çš„è§„åˆ™ï¼Œç”±å…·ä½“çš„routeå»å¤„ç†ï¼Œfiltersæ˜¯å„ç§è¿‡æ»¤å™¨ï¼Œç”¨æ¥å¯¹è¯·æ±‚åšå„ç§åˆ¤æ–­å’Œä¿®æ”¹ã€‚</p>
<h3 data-id="heading-5">Spring Cloud Gatewayæ ¸å¿ƒæ¦‚å¿µï¼Ÿ</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/739df2fd88d44a80b6aff74c395e537a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764549061&amp;x-signature=XTmBeKBIIjmJCKcVn0irdQbcaEk%3D" alt="" loading="lazy"/></p>
<p>åœ¨Spring Cloud Gatewayé‡Œï¼Œæœ‰ä¸‰ä¸ªå…³é”®ç»„ä»¶ï¼š</p>
<ul>
<li>Routeï¼ˆè·¯ç”±ï¼‰ï¼šè·¯ç”±æ˜¯Spring Cloud Gatewayçš„åŸºæœ¬æ„å»ºå—ï¼Œå®ƒå®šä¹‰äº†è¯·æ±‚çš„åŒ¹é…è§„åˆ™å’Œè½¬å‘ç›®æ ‡ã€‚é€šè¿‡é…ç½®è·¯ç”±ï¼Œå¯ä»¥å°†è¯·æ±‚æ˜ å°„åˆ°åç«¯çš„æœåŠ¡å®ä¾‹æˆ–URLä¸Šã€‚è·¯ç”±è§„åˆ™å¯ä»¥æ ¹æ®è¯·æ±‚çš„è·¯å¾„ã€æ–¹æ³•ã€è¯·æ±‚å¤´ç­‰æ¡ä»¶è¿›è¡ŒåŒ¹é…ï¼Œå¹¶æŒ‡å®šè½¬å‘çš„ç›®æ ‡URIã€‚</li>
<li>Predicateï¼ˆæ–­è¨€ï¼‰ï¼šæ–­è¨€ç”¨äºåŒ¹é…è¯·æ±‚çš„æ¡ä»¶ï¼Œå¦‚æœè¯·æ±‚æ»¡è¶³æ–­è¨€çš„æ¡ä»¶ï¼Œåˆ™ä¼šåº”ç”¨æ‰€é…ç½®çš„è¿‡æ»¤å™¨ã€‚Spring Cloud Gatewayæä¾›äº†å¤šç§å†…ç½®çš„æ–­è¨€ï¼Œå¦‚Pathï¼ˆè·¯å¾„åŒ¹é…ï¼‰ã€Methodï¼ˆè¯·æ±‚æ–¹æ³•åŒ¹é…ï¼‰ã€Headerï¼ˆè¯·æ±‚å¤´åŒ¹é…ï¼‰ç­‰ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ–­è¨€ã€‚</li>
<li>Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼šè¿‡æ»¤å™¨ç”¨äºå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†å’Œè½¬æ¢ï¼Œå¯ä»¥ä¿®æ”¹è¯·æ±‚ã€å“åº”ä»¥åŠæ‰§è¡Œå…¶ä»–è‡ªå®šä¹‰é€»è¾‘ã€‚Spring Cloud Gatewayæä¾›äº†å¤šä¸ªå†…ç½®çš„è¿‡æ»¤å™¨ï¼Œå¦‚è¯·æ±‚è½¬å‘ã€è¯·æ±‚é‡è¯•ã€è¯·æ±‚é™æµç­‰ã€‚åŒæ—¶ä¹Ÿæ”¯æŒè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚ç¼–å†™è‡ªå·±çš„è¿‡æ»¤å™¨é€»è¾‘ã€‚</li>
</ul>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹Spring Cloud Gatewayçš„å…·ä½“å·¥ä½œæµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55d51983374145579501ba79e01449ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2V2ZW5Db2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764549061&amp;x-signature=IO8IAQoEABkyQT98UH7W7i8zlho%3D" alt="" loading="lazy"/></p>
<p>ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µï¼š</p>
<ul>
<li>Gateway Handlerï¼ˆç½‘å…³å¤„ç†å™¨ï¼‰ï¼šç½‘å…³å¤„ç†å™¨æ˜¯Spring Cloud Gatewayçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å°†è¯·æ±‚è½¬å‘åˆ°åŒ¹é…çš„è·¯ç”±ä¸Šã€‚å®ƒæ ¹æ®è·¯ç”±é…ç½®å’Œæ–­è¨€æ¡ä»¶è¿›è¡Œè·¯ç”±åŒ¹é…ï¼Œé€‰æ‹©åˆé€‚çš„è·¯ç”±è¿›è¡Œè¯·æ±‚è½¬å‘ã€‚ç½‘å…³å¤„ç†å™¨è¿˜ä¼šä¾æ¬¡åº”ç”¨é…ç½®çš„è¿‡æ»¤å™¨é“¾ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†å’Œè½¬æ¢ã€‚</li>
<li>Gateway Filter Chainï¼ˆç½‘å…³è¿‡æ»¤å™¨é“¾ï¼‰ï¼šç½‘å…³è¿‡æ»¤å™¨é“¾ç”±ä¸€ç³»åˆ—è¿‡æ»¤å™¨ç»„æˆï¼ŒæŒ‰ç…§é…ç½®çš„é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚æ¯ä¸ªè¿‡æ»¤å™¨å¯ä»¥åœ¨è¯·æ±‚å‰ã€è¯·æ±‚åæˆ–è¯·æ±‚å‘ç”Ÿé”™è¯¯æ—¶è¿›è¡Œå¤„ç†ã€‚è¿‡æ»¤å™¨é“¾çš„æ‰§è¡Œè¿‡ç¨‹å¯ä»¥ä¿®æ”¹è¯·æ±‚ã€å“åº”ä»¥åŠæ‰§è¡Œå…¶ä»–è‡ªå®šä¹‰é€»è¾‘ã€‚</li>
</ul>
<h3 data-id="heading-6">ä»€ä¹ˆæ˜¯é™æµç®—æ³•ï¼Œç½‘å…³å¦‚ä½•å®ç°é™æµ</h3>
<p>é™æµç®—æ³•æ˜¯æŒ‡ç”¨äºé™åˆ¶å•ä½æ—¶é—´å†…æœåŠ¡çš„è¯·æ±‚æ•°é‡çš„ç®—æ³•ï¼Œç›®çš„æ˜¯é˜²æ­¢æœåŠ¡è¢«è¿‡é«˜çš„è¯·æ±‚å‹åŠ›æ‰€å‡»å®ã€‚å¸¸è§çš„é™æµç®—æ³•åŒ…æ‹¬è®¡æ•°å™¨ç®—æ³•ã€æ»‘åŠ¨çª—å£ç®—æ³•ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚</p>
<p>ç½‘å…³å¦‚ä½•å®ç°é™æµï¼š</p>
<ul>
<li>åˆ©ç”¨é™æµç®—æ³•æ’ä»¶/æ¨¡å—ï¼šç½‘å…³å¯ä»¥é›†æˆé™æµç®—æ³•æ’ä»¶/æ¨¡å—ï¼Œé€šè¿‡é…ç½®ç›¸å…³å‚æ•°ï¼ˆå¦‚ä»¤ç‰Œæ¡¶å¤§å°ã€ä»¤ç‰Œç”Ÿæˆé€Ÿç‡ç­‰ï¼‰æ¥å®ç°é™æµã€‚ä¾‹å¦‚ï¼ŒSpring Cloud Gatewayå¯ä»¥ä½¿ç”¨Redisçš„RateLimiteré™æµç®—æ³•æ’ä»¶æ¥å®ç°é™æµã€‚</li>
<li>è‡ªå®šä¹‰é™æµé€»è¾‘ï¼šç½‘å…³å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼è‡ªå®šä¹‰å®ç°é™æµé€»è¾‘ã€‚ä¾‹å¦‚ï¼Œåœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œå¯ä»¥åœ¨æ¯ä¸ªæœåŠ¡çš„ç½‘å…³å±‚ï¼ˆå¦‚Nacosã€Eurekaç­‰ï¼‰å®ç°é™æµé€»è¾‘ï¼Œæˆ–è€…ä½¿ç”¨é™æµSDKï¼ˆå¦‚Sentinelï¼‰å¯¹è¯·æ±‚è¿›è¡Œé™æµã€‚</li>
<li>åˆ©ç”¨äº‘å¹³å°æä¾›çš„é™æµåŠŸèƒ½ï¼šä¸€äº›äº‘å¹³å°æä¾›äº†è‡ªåŠ¨åŒ–çš„é™æµåŠŸèƒ½ï¼Œä¾‹å¦‚AWS CloudWatchã€Azure Application Insightsç­‰ï¼Œç½‘å…³å¯ä»¥åˆ©ç”¨è¿™äº›äº‘å¹³å°çš„åŠŸèƒ½æ¥å®ç°é™æµã€‚</li>
</ul>
<h3 data-id="heading-7">ä½ é¡¹ç›®é‡Œä¸ºä»€ä¹ˆé€‰æ‹© Gateway ä½œä¸ºç½‘å…³?</h3>
<p>é€‰æ‹© Spring Cloud Gateway çš„åŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>ä»¥å‰ç”¨å¾—æ¯”è¾ƒå¤šçš„æ˜¯ Spring Cloud å®˜æ–¹å¼€æºçš„Zuulï¼Œå…¶ç”¨å¾—æ¯”è¾ƒå¤šçš„è¿˜æ˜¯1.0 çš„ç‰ˆæœ¬ï¼Œä¸è¿‡1.0ç‰ˆæœ¬ Netflixå¾ˆæ—©å°±å®£å¸ƒè¿›å…¥ç»´æŠ¤çŠ¶æ€äº†ï¼Œè™½ç„¶Zuulå·²ç»å‡ºäº†2.0ç‰ˆæœ¬ï¼Œä½†æ˜¯ Spring Cloud å®˜æ–¹å›¢é˜Ÿå¥½åƒæ²¡æœ‰æ•´åˆçš„è®¡åˆ’ï¼Œå¹¶ä¸” Netflix å¾ˆå¤šç›¸å…³çš„ç»„ä»¶ï¼Œå¦‚ Eurekaã€Hystrix éƒ½å·²ç»è¿›å…¥ç»´æŠ¤æœŸäº†ï¼Œæ‰€ä»¥ä¸çŸ¥é“å‰æ™¯å¦‚é—´ï¼Œç„¶å Sping doud å®˜æ–¹è‡ªå·±ç ”å‘äº†Spring Cloud  Gatewayï¼Œå¹¶ä¸”å¤§åŠ›æ”¯æŒå’Œæ¨èï¼Œæ‰€ä»¥ç›¸æ¯”ä¸Zuulï¼Œ Gatewayæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚</li>
<li>Spring Cloud Gateway æœ‰å¾ˆå¤šçš„ç‰¹æ€§ï¼š
<ul>
<li>åŸºäº Spring5å’Œ Spring Boot 2 è¿›è¡Œæ„å»ºï¼Œä¸ Spring ç”Ÿæ€å…¼å®¹è¾ƒå¥½</li>
<li>åŠ¨æ€è·¯ç”±ï¼šå¯ä»¥æ ¹æ®é…ç½®æ¡ä»¶ï¼Œå¦‚ URLã€è¯·æ±‚æ–¹æ³•ç­‰å®ç°åŠ¨æ€é…ç½®</li>
<li>å¯ä»¥å¯¹è·¯ç”±æŒ‡å®šæ–­è¨€(Predicate)å’Œè¿‡æ»¤å™¨(Filter)</li>
<li>é›†æˆ Hystrix æ–­è·¯å™¨åŠŸèƒ½ï¼Œå¯ä»¥å®ç°æœåŠ¡ç†”æ–­</li>
<li>é›†æˆ Spring Cloud ç›¸å…³ç»„ä»¶ï¼Œå¦‚ Eurekaã€Nacosã€Consule ç­‰å®ç°æœåŠ¡çš„æ³¨å†Œä¸å‘ç°</li>
<li>å†…ç½®äº†é™æµæ¨¡å—ï¼Œå¯ä»¥æ ¹æ®é…ç½®å®ç°æœåŠ¡é™æµ</li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">Dubboå’Œ Spring Cloud Gateway æœ‰ä»€ä¹ˆåŒºåˆ«?</h3>
<p>Dubbo æ˜¯ä¸€ä¸ªRPC(è¿œç¨‹è¿‡ç¨‹è°ƒç”¨)æ¡†æ¶ï¼Œä¸»è¦ç”¨äºæœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚å®ƒæä¾›é«˜æ€§èƒ½çš„ RPC è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°ã€æœåŠ¡æ³¨å†Œã€æœåŠ¡æ²»ç†ç­‰åŠŸèƒ½ã€‚é€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½ RPC è°ƒç”¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå¸¸ç”¨äºå†…éƒ¨æœåŠ¡é€šä¿¡ã€‚</p>
<p>Spring Cloud Gatewayæ˜¯ä¸€ä¸ªAPI ç½‘å…³ï¼Œç”¨äºå¤„ç†å¤–éƒ¨å®¢æˆ·ç«¯è¯·æ±‚å¹¶å°†å…¶è·¯ç”±åˆ°åç«¯æœåŠ¡ã€‚å®ƒæä¾›è¯·æ±‚è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€åè®®è½¬æ¢ã€å®‰å…¨ç®¡ç†ã€æµé‡æ§åˆ¶ã€æ—¥å¿—å’Œç›‘æ§ç­‰åŠŸèƒ½ã€‚é€‚ç”¨äºå¾®æœåŠ¡æ¶æ„ä¸­çš„ç»Ÿä¸€å…¥å£ç®¡ç†ï¼Œå¸¸ç”¨äºå¤–éƒ¨è¯·æ±‚çš„å…¥å£å±‚ã€‚</p>
<p>æ‰€ä»¥è¯´å®ƒä»¬ä¸æ˜¯ä¸€ä¸ªå±‚çº§çš„ä¸œè¥¿ã€‚</p>
<h2 data-id="heading-9">é“¾è·¯è¿½è¸ª</h2>
<h3 data-id="heading-10">ä¸ºä»€ä¹ˆè¦ç”¨å¾®æœåŠ¡é“¾è·¯è¿½è¸ªï¼Ÿ</h3>
<p>åœ¨å¾®æœåŠ¡ä¸­ï¼Œæœ‰çš„ä¸Šä¸‹æ¸¸å¯èƒ½æœ‰åå‡ ä¸ªæœåŠ¡ï¼Œå¦‚æœæŸä¸€ç¯å‡ºäº†é—®é¢˜ï¼Œæ’æŸ¥èµ·æ¥éå¸¸å›°éš¾ï¼Œæ‰€ä»¥ï¼Œå°±éœ€è¦è¿›è¡Œé“¾è·¯è¿½è¸ªï¼Œæ¥å¸®åŠ©æ’æŸ¥é—®é¢˜ã€‚</p>
<p>é€šè¿‡é“¾è·¯è¿½è¸ªï¼Œå¯ä»¥å¯è§†åŒ–åœ°è¿½è¸ªè¯·æ±‚ä»ä¸€ä¸ªå¾®æœåŠ¡åˆ°å¦ä¸€ä¸ªå¾®æœåŠ¡çš„è°ƒç”¨æƒ…å†µã€‚é™¤äº†æ’æŸ¥é—®é¢˜ï¼Œé“¾è·¯è¿½è¸ªé»‘è¿˜å¯ä»¥å¸®åŠ©ä¼˜åŒ–æ€§èƒ½ï¼Œå¯è§†åŒ–ä¾èµ–å…³ç³»ã€æœåŠ¡ç›‘æ§å’Œå‘Šè­¦ã€‚</p>
<h3 data-id="heading-11">SpringCloudå¯ä»¥é€‰æ‹©å“ªäº›å¾®æœåŠ¡é“¾è·¯è¿½è¸ªæ–¹æ¡ˆï¼Ÿ</h3>
<p>Spring Cloudæä¾›äº†å¤šç§é€‰æ‹©çš„å¾®æœåŠ¡é“¾è·¯è¿½è¸ªæ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ–¹æ¡ˆï¼š</p>
<ul>
<li>Zipkinï¼šZipkin æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼å®æ—¶è¿½è¸ªç³»ç»Ÿï¼Œç”± Twitter å¼€å‘å¹¶è´¡çŒ®ç»™å¼€æºç¤¾åŒºã€‚Spring Cloud Sleuth æä¾›äº†ä¸ Zipkin çš„é›†æˆï¼Œå¯ä»¥é€šè¿‡åœ¨å¾®æœåŠ¡ä¸­æ·»åŠ ç›¸åº”çš„ä¾èµ–å’Œé…ç½®ï¼Œå°†è¿½è¸ªä¿¡æ¯å‘é€åˆ° Zipkin æœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡ Zipkin UI è¿›è¡Œå¯è§†åŒ–å±•ç¤ºå’ŒæŸ¥è¯¢ã€‚</li>
<li>Jaegerï¼šJaeger æ˜¯ Uber å¼€æºçš„åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿï¼Œä¹Ÿè¢«çº³å…¥äº† CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰çš„ç»´æŠ¤ã€‚é€šè¿‡ä½¿ç”¨ Spring Cloud Sleuth å’Œ Jaeger å®¢æˆ·ç«¯åº“ï¼Œå¯ä»¥å°†è¿½è¸ªä¿¡æ¯å‘é€åˆ° Jaeger å¹¶è¿›è¡Œå¯è§†åŒ–å±•ç¤ºå’ŒæŸ¥è¯¢ã€‚</li>
<li>SkyWalkingï¼šApache SkyWalking æ˜¯ä¸€æ¬¾å¼€æºçš„åº”ç”¨æ€§èƒ½ç›‘æ§ä¸åˆ†æç³»ç»Ÿï¼Œæä¾›äº†å¯¹ Javaã€.NET å’Œ Node.js ç­‰è¯­è¨€çš„æ”¯æŒã€‚å®ƒå¯ä»¥ä¸ Spring Cloud Sleuth é›†æˆï¼Œå°†è¿½è¸ªæ•°æ®å‘é€åˆ° SkyWalking æœåŠ¡å™¨è¿›è¡Œå¯è§†åŒ–å±•ç¤ºå’Œåˆ†æã€‚</li>
<li>Pinpointï¼šPinpoint æ˜¯ Naver å¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨æ€§èƒ½ç›‘æ§ç³»ç»Ÿï¼Œæ”¯æŒ Java å’Œ .NETã€‚å®ƒæä¾›äº†ä¸ Spring Cloud Sleuth çš„é›†æˆï¼Œå¯ä»¥å°†è¿½è¸ªæ•°æ®å‘é€åˆ° Pinpoint æœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡å…¶ UI è¿›è¡Œåˆ†æå’Œç›‘æ§ã€‚</li>
</ul>
<p>è¿™äº›æ–¹æ¡ˆéƒ½å¯ä»¥ä¸ Spring Cloud Sleuth è¿›è¡Œé›†æˆï¼ŒSpring Cloud Sleuth æ˜¯ Spring Cloud ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œæä¾›äº†åœ¨å¾®æœåŠ¡è°ƒç”¨æ—¶ç”Ÿæˆè¿½è¸ªä¿¡æ¯çš„èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-12">åˆ†å¸ƒå¼äº‹åŠ¡</h2>
<h3 data-id="heading-13">ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿæœ‰å“ªäº›æ–¹æ¡ˆï¼Ÿ</h3>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æŒ‡åœ¨å¤šä¸ªç½‘ç»œèŠ‚ç‚¹æˆ–æœåŠ¡ä¹‹é—´è¿›è¡Œæ•°æ®ä¸€è‡´æ€§å¤„ç†çš„æƒ…å†µã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡çš„åœºæ™¯ï¼š</p>
<ul>
<li>å¾®æœåŠ¡ä¹‹é—´é€šè¿‡è¿œç¨‹è°ƒç”¨å®Œæˆäº‹åŠ¡æ“ä½œï¼šå½“ä¸åŒçš„å¾®æœåŠ¡ä¹‹é—´éœ€è¦è¿›è¡Œæ•°æ®ä¸€è‡´æ€§ä¿è¯æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”µå•†å¾®æœåŠ¡ä¸­çš„è®¢å•æœåŠ¡å’Œåº“å­˜æœåŠ¡éœ€è¦é€šè¿‡è¿œç¨‹è°ƒç”¨è¿›è¡Œäº‹åŠ¡æ“ä½œï¼Œä¿è¯åº“å­˜æ•°é‡å’Œè®¢å•ä¿¡æ¯çš„åŒæ­¥æ›´æ–°ï¼Œé¿å…å‡ºç°è¶…å–æˆ–ç¼ºè´§çš„æƒ…å†µã€‚</li>
<li>å•ä½“ç³»ç»Ÿè®¿é—®å¤šä¸ªæ•°æ®åº“å®ä¾‹ï¼šå½“ä¸€ä¸ªç³»ç»Ÿéœ€è¦è®¿é—®å¤šä¸ªæ•°æ®åº“å®ä¾‹æ—¶ï¼Œä¾‹å¦‚ç”¨æˆ·ä¿¡æ¯å’Œè®¢å•ä¿¡æ¯åˆ†åˆ«å­˜å‚¨åœ¨ä¸¤ä¸ªä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¸­ï¼Œéœ€è¦é€šè¿‡åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œé¿å…å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</li>
<li>å¤šæœåŠ¡è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼šå½“å¤šä¸ªæœåŠ¡è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹æ—¶ï¼Œä¾‹å¦‚è®¢å•å¾®æœåŠ¡å’Œåº“å­˜å¾®æœåŠ¡éƒ½éœ€è¦è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“ï¼Œä¹Ÿå¯èƒ½éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚å› ä¸ºè·¨JVMè¿›ç¨‹çš„å¤šä¸ªæœåŠ¡åŒæ—¶æŒæœ‰ä¸åŒçš„æ•°æ®åº“è¿æ¥è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œå¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</li>
</ul>
<p>åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚å¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆåŒ…æ‹¬ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ã€ä¸‰é˜¶æ®µæäº¤ï¼ˆ3PCï¼‰ã€TCCã€Sagaã€æœ¬åœ°æ¶ˆæ¯è¡¨ç­‰ã€‚å…¶ä¸­ï¼Œä¸¤é˜¶æ®µæäº¤å’Œä¸‰é˜¶æ®µæäº¤éƒ½æ˜¯åŸºäºé”æœºåˆ¶å®ç°çš„ï¼Œè€ŒTCCã€Sagaå’Œæœ¬åœ°æ¶ˆæ¯è¡¨åˆ™æ˜¯åŸºäºä¸šåŠ¡é€»è¾‘å®ç°çš„ã€‚é€‰æ‹©å“ªç§æ–¹æ¡ˆå–å†³äºä¸šåŠ¡éœ€æ±‚ã€ç³»ç»Ÿå¤æ‚æ€§å’Œæ€§èƒ½ç­‰å¤šä¸ªå› ç´ ã€‚</p>
<p>è¯¦æƒ…å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.seven97.top%2Fmicroservices%2Fdistributed-system%2Fdistributedtransactions.html" target="_blank" title="https://www.seven97.top/microservices/distributed-system/distributedtransactions.html" ref="nofollow noopener noreferrer">æ·±åº¦è§£æåˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸ƒå¤§æ ¸å¿ƒæ–¹æ¡ˆ</a></p>
<h3 data-id="heading-14">ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„é˜²æ‚¬æŒ‚ï¼Œç©ºå›æ»š?</h3>
<p>é˜²æ‚¬æŒ‚æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„ç¬¬ä¸€é˜¶æ®µï¼Œé˜²æ­¢åœ¨æ²¡æœ‰å¯¹åº”çš„ Try æ“ä½œçš„æƒ…å†µä¸‹å‡ºç° Confirm æˆ– Cancel æ“ä½œã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯äº‹åŠ¡çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p>åˆ†å¸ƒå¼äº‹åŠ¡ä¸­æœ€å¸¸è§çš„æ¨¡å‹æ˜¯ TCC(Try-Confirm-Cancel)æ¨¡å‹ã€‚åœ¨ TCC æ¨¡å‹ä¸­ï¼Œäº‹åŠ¡åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>Tryï¼šèµ„æºçš„é¢„ç•™æ“ä½œã€‚</li>
<li>Confirmï¼šç¡®è®¤æ“ä½œï¼Œå®Œæˆä¸šåŠ¡é€»è¾‘</li>
<li>Cancelï¼šå–æ¶ˆæ“ä½œï¼Œå›æ»šé¢„ç•™èµ„æºã€‚</li>
</ul>
<p>é˜²æ‚¬æŒ‚æœºåˆ¶çš„ä½œç”¨æ˜¯ç¡®ä¿åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼ŒConfirm å’Œ Cancel æ“ä½œåªä¼šåœ¨ Try æ“ä½œæˆåŠŸæ‰§è¡Œåæ‰ä¼šè§¦å‘ã€‚</p>
<p>é˜²æ‚¬æŒ‚çš„åœºæ™¯é€šå¸¸æ˜¯ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>Confirm æ“ä½œæ‚¬æŒ‚ï¼šå¦‚æœ Confirm æ“ä½œåœ¨æ²¡æœ‰æ‰§è¡Œè¿‡ Try æ“ä½œçš„æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li>
<li>Cancel æ“ä½œæ‚¬æŒ‚ï¼šç±»ä¼¼åœ°ï¼Œå¦‚æœ Cancel æ“ä½œåœ¨æ²¡æœ‰ Try æ“ä½œçš„æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼Œä¹Ÿä¼šç ´åæ•°æ®çš„ä¸€è‡´æ€§ã€‚</li>
</ul>
<p>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œéœ€è¦é€šè¿‡æŸäº›æœºåˆ¶æ¥æ£€æµ‹å’Œé˜²æ­¢æ‚¬æŒ‚ã€‚ä¾‹å¦‚:</p>
<ul>
<li>å¹‚ç­‰æ€§æ£€æŸ¥ï¼šConfirm å’Œ Cancel æ“ä½œåº”è¯¥å…·å¤‡å¹‚ç­‰æ€§ï¼Œé¿å…å¤šæ¬¡è°ƒç”¨å¼•å‘é—®é¢˜ã€‚</li>
<li>çŠ¶æ€æ ¡éªŒï¼šåœ¨æ‰§è¡Œ Confirm æˆ– Cancelä¹‹å‰ï¼Œå¯ä»¥å…ˆæ£€æŸ»æ˜¯å¦æœ‰å¯¹åº”çš„ Try æ“ä½œæˆåŠŸè¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‹’ç»æ‰§è¡Œ Confirm æˆ– Cancel æ“ä½œ</li>
</ul>
<p>ç©ºå›æ»šæ˜¯æŒ‡åœ¨æ²¡æœ‰æ‰§è¡ŒæˆåŠŸçš„Tryæ“ä½œæ—¶ï¼ŒCancel æ“ä½œä»ç„¶è¢«è°ƒç”¨äº†ã€‚Cancel æ“ä½œå®é™…ä¸Šå°±æ˜¯ Tryæ“ä½œçš„å›æ»šæ“ä½œï¼Œå¦‚æœ Try æ“ä½œæ ¹æœ¬æ²¡æœ‰æˆåŠŸï¼Œåˆ™Cancel æ“ä½œå®é™…ä¸ä¼šå¯¹ä»»é—®èµ„æºäº§ç”Ÿå½±å“ï¼Œè¿™å°±æ˜¯ç©ºå›æ»š</p>
<p>ç©ºå›æ»šä¸€èˆ¬å‘ç”Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>ç½‘ç»œè¶…æ—¶ï¼šTry æ“ä½œè¿˜æ²¡æ‰§è¡ŒæˆåŠŸï¼Œç½‘ç»œå°±è¶…æ—¶äº†ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡åè°ƒå™¨å¯èƒ½è¯¯è®¤ä¸º Try æ“ä½œå¤±è´¥ï¼Œå› æ­¤ä¼šè°ƒç”¨ Cancelã€‚</li>
<li>ç½‘ç»œåˆ†åŒºæˆ–ä¸­æ–­ï¼šTry æ“ä½œè¯·æ±‚æœªåˆ°è¾¾ç›¸åº”çš„æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯è¯¯è®¤ä¸º Try æ“ä½œå·²ç»å¤±è´¥å¹¶å‘èµ· Cancelã€‚</li>
</ul>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒCancel æ“ä½œä¼šè¢«æ‰§è¡Œï¼Œä½†å› ä¸º Try æ“ä½œå¹¶æ²¡æœ‰æˆåŠŸï¼Œæ‰€ä»¥ Cancel å®é™…ä¸Šä»€ä¹ˆéƒ½ä¸éœ€è¦åšã€‚è¿™å°±æ˜¯ç©ºå›æµ,ã€‚ä¸ºäº†æ”¯æŒç©ºå›æ»šï¼ŒCancelæ“ä½œå¿…é¡»å…·å¤‡ä»¥ä¸‹èƒ½åŠ›ï¼š</p>
<ul>
<li>å¹‚ç­‰æ€§ï¼šå³ä½¿ Cancel æ“ä½œè¢«å¤šæ¬¡è°ƒç”¨ï¼Œå®ƒçš„æ•ˆæœä¹Ÿåªèƒ½æ˜¯æ‰§è¡Œä¸€æ¬¡ï¼Œä¸ä¼šå¯¹ç³»ç»Ÿäº§ç”Ÿé¢å¤–å½±å“ã€‚</li>
<li>ç©ºå›æ»šå…¼å®¹æ€§ï¼šCancel æ“ä½œåœ¨å‘ç°æ²¡æœ‰Try æ“ä½œæ‰§è¡ŒæˆåŠŸæ—¶ï¼Œä¸åšä»»ä½•ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æˆåŠŸçŠ¶æ€</li>
</ul>
<h3 data-id="heading-15">ä»€ä¹ˆæ˜¯Seataï¼Ÿè°ˆè°ˆä½ å¯¹Seataçš„ç†è§£</h3>
<p>Seataæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œå®ƒä¸»è¦ç”¨äºè§£å†³åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å…¨å±€äº‹åŠ¡çš„ä¸€è‡´æ€§é—®é¢˜ã€‚<br/>
åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºä¸€æ¬¡ä¸šåŠ¡æ“ä½œéœ€è¦è·¨å¤šä¸ªæ•°æ®æºæˆ–è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œå¾€å¾€ä¼šäº§ç”Ÿåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç”µå•†å¾®æœåŠ¡ç³»ç»Ÿä¸­ï¼Œè®¢å•æœåŠ¡å’Œåº“å­˜æœåŠ¡éœ€è¦ååŒå·¥ä½œï¼Œå¦‚æœè®¢å•æœåŠ¡å·²ç»åˆ›å»ºæˆåŠŸï¼Œä½†åº“å­˜æœåŠ¡å› ä¸ºæŸäº›åŸå› å¤±è´¥äº†ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚Seataå°±æ˜¯ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œäº§ç”Ÿçš„ã€‚</p>
<p>Seataçš„ä¸»è¦ç‰¹ç‚¹æ˜¯æ— ä¾µå…¥ä»¥åŠé«˜æ€§èƒ½ã€‚å®ƒå¯¹ä¸šåŠ¡æ— ä¾µå…¥ï¼Œå¯ä»¥å‡å°‘æŠ€æœ¯æ¶æ„ä¸Šçš„å¾®æœåŠ¡åŒ–æ‰€å¸¦æ¥çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜å¯¹ä¸šåŠ¡çš„ä¾µå…¥ï¼ŒåŒæ—¶é«˜æ€§èƒ½åˆ™æ˜¯å‡å°‘åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ã€‚</p>
<p>åœ¨Seataçš„äº‹åŠ¡å¤„ç†ä¸­ä¸»è¦æœ‰ä¸‰ä¸ªé‡è¦çš„è§’è‰²ï¼šäº‹åŠ¡çš„åè°ƒè€…ï¼ˆTCï¼‰ã€äº‹åŠ¡çš„ç®¡ç†è€…ï¼ˆTMï¼‰å’Œäº‹åŠ¡çš„ä½œä¸šç®¡ç†å™¨ï¼ˆRMï¼‰ã€‚</p>
<ul>
<li>äº‹åŠ¡åè°ƒè€…ï¼ˆTCï¼‰ä¸»è¦è´Ÿè´£ç®¡ç†å…¨å±€çš„åˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œç”¨äºå…¨å±€æ€§äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚å®ƒä¼šå¯¹æ‰€æœ‰çš„åˆ†æ”¯äº‹åŠ¡è¿›è¡Œæ³¨å†Œï¼Œç„¶åæ ¹æ®å„ä¸ªåˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€æ¥å†³å®šæ˜¯å¦æäº¤æˆ–è€…å›æ»šå…¨å±€äº‹åŠ¡ã€‚</li>
<li>äº‹åŠ¡ç®¡ç†è€…ï¼ˆTMï¼‰ç”¨äºå¼€å¯ã€æäº¤æˆ–å›æ»šäº‹åŠ¡ã€‚å®ƒä¼šæ ¹æ®ä¸šåŠ¡é€»è¾‘æ¥å†³å®šä½•æ—¶å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™æäº¤æˆ–å›æ»šè¯¥äº‹åŠ¡ã€‚</li>
<li>èµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰ç”¨äºåˆ†æ”¯äº‹åŠ¡ä¸Šçš„èµ„æºç®¡ç†ï¼Œå‘TCæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œä¸ŠæŠ¥åˆ†æ”¯äº‹åŠ¡çš„çŠ¶æ€ï¼Œæ¥æ”¶TCçš„å‘½ä»¤æ¥æäº¤æˆ–è€…å›æ»šåˆ†æ”¯äº‹åŠ¡ã€‚</li>
</ul>
<h3 data-id="heading-16">Seataæ”¯æŒå“ªäº›æ¨¡å¼çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</h3>
<p>Seataä»¥ä¸‹å‡ ç§æ¨¡å¼çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼š</p>
<ul>
<li>ATï¼ˆAtomikosï¼‰æ¨¡å¼ï¼šATæ¨¡å¼æ˜¯Seataé»˜è®¤æ”¯æŒçš„æ¨¡å¼ï¼Œä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ¨¡å¼ä¹‹ä¸€ã€‚åœ¨ATæ¨¡å¼ä¸‹ï¼ŒSeataé€šè¿‡åœ¨ä¸šåŠ¡ä»£ç ä¸­åµŒå…¥äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œå®ç°å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†ã€‚Seataä¼šæ‹¦æˆªå¹¶è§£æä¸šåŠ¡ä»£ç ä¸­çš„SQLè¯­å¥ï¼Œé€šè¿‡å¯¹æ•°æ®åº“è¿æ¥è¿›è¡Œæ‹¦æˆªå’Œä»£ç†ï¼Œå®ç°äº‹åŠ¡çš„ç®¡ç†å’Œåè°ƒã€‚</li>
<li>TCCï¼ˆTry-Confirm-Cancelï¼‰æ¨¡å¼ï¼šTCCæ¨¡å¼æ˜¯ä¸€ç§åŸºäºè¡¥å¿æœºåˆ¶çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ã€‚åœ¨TCCæ¨¡å¼ä¸­ï¼Œä¸šåŠ¡é€»è¾‘éœ€è¦å®ç°Tryã€Confirmå’ŒCancelä¸‰ä¸ªé˜¶æ®µçš„æ“ä½œã€‚Seataé€šè¿‡è°ƒç”¨ä¸šåŠ¡ä»£ç ä¸­çš„Tryã€Confirmå’ŒCancelæ–¹æ³•ï¼Œå¹¶åœ¨æ¯ä¸ªé˜¶æ®µè®°å½•ç›¸å…³çš„æ“ä½œæ—¥å¿—ï¼Œæ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚</li>
<li>SAGAæ¨¡å¼ï¼šSAGAæ¨¡å¼æ˜¯ä¸€ç§åŸºäºäº‹ä»¶é©±åŠ¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ã€‚åœ¨SAGAæ¨¡å¼ä¸­ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥å‘å¸ƒå’Œè®¢é˜…äº‹ä»¶ï¼Œé€šè¿‡äº‹ä»¶çš„ä¼ é€’å’Œå¤„ç†æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚Seataæä¾›äº†ä¸SAGAæ¨¡å¼å…¼å®¹çš„Sagaæ¡†æ¶ï¼Œç”¨äºç®¡ç†å’Œåè°ƒåˆ†å¸ƒå¼äº‹åŠ¡çš„å„ä¸ªé˜¶æ®µã€‚</li>
<li>XAæ¨¡å¼ï¼šXAæ¨¡å¼æ˜¯ä¸€ç§åŸºäºä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-Phase Commitï¼‰åè®®çš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å¼ã€‚åœ¨XAæ¨¡å¼ä¸­ï¼ŒSeataé€šè¿‡ä¸æ•°æ®åº“çš„XAäº‹åŠ¡åè®®è¿›è¡Œäº¤äº’ï¼Œå®ç°å¯¹åˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†å’Œåè°ƒã€‚XAæ¨¡å¼éœ€è¦æ•°æ®åº“æœ¬èº«æ”¯æŒXAäº‹åŠ¡ï¼Œå¹¶ä¸”éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­é…ç½®ç›¸åº”çš„XAæ•°æ®æºã€‚</li>
</ul>
<h3 data-id="heading-17">äº†è§£Seataçš„å®ç°åŸç†å—ï¼Ÿ</h3>
<p>Seataçš„å®ç°åŸç†ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼šäº‹åŠ¡åè°ƒå™¨ï¼ˆTransaction Coordinatorï¼‰ã€äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTransaction Managerï¼‰å’Œèµ„æºç®¡ç†å™¨ï¼ˆResource Managerï¼‰ã€‚</p>
<ul>
<li>äº‹åŠ¡åè°ƒå™¨ï¼ˆTransaction Coordinatorï¼‰ï¼šäº‹åŠ¡åè°ƒå™¨è´Ÿè´£åè°ƒå’Œç®¡ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„æ•´ä¸ªè¿‡ç¨‹ã€‚å®ƒæ¥æ”¶äº‹åŠ¡çš„å¼€å§‹å’Œç»“æŸè¯·æ±‚ï¼Œå¹¶æ ¹æ®äº‹åŠ¡çš„çŠ¶æ€è¿›è¡Œåè°ƒå’Œå¤„ç†ã€‚äº‹åŠ¡åè°ƒå™¨è¿˜è´Ÿè´£è®°å½•å’Œç®¡ç†äº‹åŠ¡çš„å…¨å±€äº‹åŠ¡ IDï¼ˆGlobal Transaction IDï¼‰å’Œåˆ†æ”¯äº‹åŠ¡ IDï¼ˆBranch Transaction IDï¼‰ã€‚</li>
<li>äº‹åŠ¡ç®¡ç†å™¨ï¼ˆTransaction Managerï¼‰ï¼šäº‹åŠ¡ç®¡ç†å™¨è´Ÿè´£å…¨å±€äº‹åŠ¡çš„ç®¡ç†å’Œæ§åˆ¶ã€‚å®ƒåè°ƒå„ä¸ªåˆ†æ”¯äº‹åŠ¡çš„æäº¤æˆ–å›æ»šï¼Œå¹¶ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ã€‚äº‹åŠ¡ç®¡ç†å™¨è¿˜è´Ÿè´£ä¸äº‹åŠ¡åè°ƒå™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶å°†äº‹åŠ¡çš„çŠ¶æ€å˜æ›´è¿›è¡ŒæŒä¹…åŒ–ã€‚</li>
<li>èµ„æºç®¡ç†å™¨ï¼ˆResource Managerï¼‰ï¼šèµ„æºç®¡ç†å™¨è´Ÿè´£ç®¡ç†å’Œæ§åˆ¶å„ä¸ªå‚ä¸è€…ï¼ˆParticipantï¼‰çš„äº‹åŠ¡æ“ä½œã€‚å®ƒä¸äº‹åŠ¡ç®¡ç†å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶æ ¹æ®äº‹åŠ¡ç®¡ç†å™¨çš„æŒ‡ä»¤æ‰§è¡Œç›¸åº”çš„äº‹åŠ¡æ“ä½œï¼ŒåŒ…æ‹¬æäº¤å’Œå›æ»šã€‚</li>
</ul>
<p>Seataçš„å®ç°åŸç†åŸºäºä¸¤é˜¶æ®µæäº¤ï¼ˆTwo-Phase Commitï¼‰åè®®ï¼Œå…·ä½“çš„æœºåˆ¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸€é˜¶æ®µï¼šåœ¨äº‹åŠ¡æäº¤çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆè¿›è¡Œé¢„æäº¤é˜¶æ®µã€‚äº‹åŠ¡åè°ƒå™¨å‘å„ä¸ªèµ„æºç®¡ç†å™¨å‘é€é¢„æäº¤è¯·æ±‚ï¼Œèµ„æºç®¡ç†å™¨æ‰§è¡Œç›¸åº”çš„äº‹åŠ¡æ“ä½œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚åœ¨æ­¤é˜¶æ®µï¼Œä¸šåŠ¡æ•°æ®å’Œå›æ»šæ—¥å¿—è®°å½•åœ¨åŒä¸€ä¸ªæœ¬åœ°äº‹åŠ¡ä¸­æäº¤ï¼Œå¹¶é‡Šæ”¾æœ¬åœ°é”å’Œè¿æ¥èµ„æºã€‚</li>
<li>äºŒé˜¶æ®µï¼šåœ¨é¢„æäº¤é˜¶æ®µæˆåŠŸåï¼Œè¿›å…¥çœŸæ­£çš„æäº¤é˜¶æ®µã€‚æ­¤é˜¶æ®µä¸»è¦åŒ…æ‹¬æäº¤å¼‚æ­¥åŒ–å’Œå›æ»šåå‘è¡¥å¿ä¸¤ä¸ªæ­¥éª¤ï¼š
<ul>
<li>æäº¤å¼‚æ­¥åŒ–ï¼šäº‹åŠ¡åè°ƒå™¨å‘å‡ºçœŸæ­£çš„æäº¤è¯·æ±‚ï¼Œå„ä¸ªèµ„æºç®¡ç†å™¨æ‰§è¡Œæœ€ç»ˆçš„æäº¤æ“ä½œã€‚è¿™ä¸ªé˜¶æ®µçš„æ“ä½œæ˜¯éå¸¸å¿«é€Ÿçš„ï¼Œä»¥ç¡®ä¿äº‹åŠ¡çš„æäº¤æ•ˆç‡ã€‚</li>
<li>å›æ»šåå‘è¡¥å¿ï¼šå¦‚æœåœ¨é¢„æäº¤é˜¶æ®µä¸­æœ‰ä»»ä½•ä¸€ä¸ªèµ„æºç®¡ç†å™¨è¿”å›å¤±è´¥ç»“æœï¼Œäº‹åŠ¡åè°ƒå™¨å‘å‡ºå›æ»šè¯·æ±‚ï¼Œå„ä¸ªèµ„æºç®¡ç†å™¨æ‰§è¡Œå›æ»šæ“ä½œï¼Œåˆ©ç”¨ä¸€é˜¶æ®µçš„å›æ»šæ—¥å¿—è¿›è¡Œåå‘è¡¥å¿ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-18">Seataçš„äº‹åŠ¡æ‰§è¡Œæµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</h3>
<p>Seataäº‹åŠ¡çš„æ‰§è¡Œæµç¨‹å¯ä»¥ç®€è¦æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>äº‹åŠ¡å‘èµ·æ–¹ï¼ˆTransaction Starterï¼‰å‘èµ·å…¨å±€äº‹åŠ¡ï¼šäº‹åŠ¡å‘èµ·æ–¹æ˜¯æŒ‡å‘èµ·åˆ†å¸ƒå¼äº‹åŠ¡çš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ã€‚å®ƒå‘Seataçš„äº‹åŠ¡åè°ƒå™¨å‘é€å…¨å±€äº‹åŠ¡çš„å¼€å§‹è¯·æ±‚ï¼Œç”Ÿæˆå…¨å±€äº‹åŠ¡IDï¼ˆGlobal Transaction IDï¼‰ã€‚</li>
<li>äº‹åŠ¡åè°ƒå™¨åˆ›å»ºå…¨å±€äº‹åŠ¡è®°å½•ï¼šäº‹åŠ¡åè°ƒå™¨æ¥æ”¶åˆ°å…¨å±€äº‹åŠ¡çš„å¼€å§‹è¯·æ±‚åï¼Œä¼šä¸ºè¯¥äº‹åŠ¡åˆ›å»ºç›¸åº”çš„å…¨å±€äº‹åŠ¡è®°å½•ï¼Œå¹¶ç”Ÿæˆåˆ†æ”¯äº‹åŠ¡IDï¼ˆBranch Transaction IDï¼‰ã€‚</li>
<li>åˆ†æ”¯äº‹åŠ¡æ³¨å†Œï¼šäº‹åŠ¡å‘èµ·æ–¹å°†å…¨å±€äº‹åŠ¡IDå’Œåˆ†æ”¯äº‹åŠ¡IDå‘é€ç»™å„ä¸ªå‚ä¸è€…ï¼ˆParticipantï¼‰ï¼Œå³èµ„æºç®¡ç†å™¨ã€‚å‚ä¸è€…å°†åˆ†æ”¯äº‹åŠ¡IDæ³¨å†Œåˆ°æœ¬åœ°äº‹åŠ¡ç®¡ç†å™¨ï¼Œå¹¶å°†äº‹åŠ¡çš„æ‰§è¡Œç»“æœåé¦ˆç»™äº‹åŠ¡åè°ƒå™¨ã€‚</li>
<li>æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼šåœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå„ä¸ªå‚ä¸è€…æ‰§è¡Œå„è‡ªçš„æœ¬åœ°äº‹åŠ¡ï¼Œå³æ‰§è¡Œä¸šåŠ¡é€»è¾‘å’Œæ•°æ®åº“æ“ä½œã€‚</li>
<li>é¢„æäº¤é˜¶æ®µï¼šäº‹åŠ¡å‘èµ·æ–¹å‘äº‹åŠ¡åè°ƒå™¨å‘é€é¢„æäº¤è¯·æ±‚ï¼Œäº‹åŠ¡åè°ƒå™¨å°†é¢„æäº¤è¯·æ±‚å‘é€ç»™å„ä¸ªå‚ä¸è€…ã€‚</li>
<li>æ‰§è¡Œæœ¬åœ°äº‹åŠ¡ç¡®è®¤ï¼šå‚ä¸è€…æ¥æ”¶åˆ°é¢„æäº¤è¯·æ±‚åï¼Œæ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„ç¡®è®¤æ“ä½œï¼Œå¹¶å°†æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœåé¦ˆç»™äº‹åŠ¡åè°ƒå™¨ã€‚</li>
<li>å…¨å±€äº‹åŠ¡æäº¤æˆ–å›æ»šï¼šäº‹åŠ¡åè°ƒå™¨æ ¹æ®å‚ä¸è€…åé¦ˆçš„ç»“æœè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ‰€æœ‰å‚ä¸è€…çš„æœ¬åœ°äº‹åŠ¡éƒ½æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡åè°ƒå™¨å‘é€çœŸæ­£çš„æäº¤è¯·æ±‚ç»™å‚ä¸è€…ï¼Œå‚ä¸è€…æ‰§è¡Œæœ€ç»ˆçš„æäº¤æ“ä½œï¼›å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå‚ä¸è€…çš„æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œäº‹åŠ¡åè°ƒå™¨å‘é€å›æ»šè¯·æ±‚ç»™å‚ä¸è€…ï¼Œå‚ä¸è€…æ‰§è¡Œå›æ»šæ“ä½œã€‚</li>
<li>å®Œæˆå…¨å±€äº‹åŠ¡ï¼šäº‹åŠ¡åè°ƒå™¨æ¥æ”¶åˆ°å‚ä¸è€…çš„æäº¤æˆ–å›æ»šç»“æœåï¼Œæ ¹æ®ç»“æœæ›´æ–°å…¨å±€äº‹åŠ¡çš„çŠ¶æ€ï¼Œå¹¶é€šçŸ¥äº‹åŠ¡å‘èµ·æ–¹å…¨å±€äº‹åŠ¡çš„æœ€ç»ˆç»“æœã€‚</li>
</ul>
<h3 data-id="heading-19">å…¨å±€äº‹åŠ¡IDå’Œåˆ†æ”¯äº‹åŠ¡IDæ˜¯æ€ä¹ˆä¼ é€’çš„ï¼Ÿ</h3>
<p>å…¨å±€äº‹åŠ¡IDå’Œåˆ†æ”¯äº‹åŠ¡IDåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é€šè¿‡ä¸Šä¸‹æ–‡ä¼ é€’çš„æ–¹å¼è¿›è¡Œä¼ é€’ã€‚å¸¸è§çš„ä¼ é€’æ–¹å¼åŒ…æ‹¬å‚æ•°ä¼ é€’ã€çº¿ç¨‹ä¸Šä¸‹æ–‡ä¼ é€’å’Œæ¶ˆæ¯ä¸­é—´ä»¶ä¼ é€’ã€‚å…·ä½“çš„ä¼ é€’æ–¹å¼å¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯å’ŒæŠ€æœ¯é€‰å‹è¿›è¡Œé€‰æ‹©å’Œè°ƒæ•´ã€‚</p>
<h3 data-id="heading-20">Seataçš„äº‹åŠ¡å›æ»šæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3>
<p>Seataçš„äº‹åŠ¡å›æ»šæ˜¯é€šè¿‡å›æ»šæ—¥å¿—å®ç°çš„ã€‚æ¯ä¸ªå‚ä¸è€…åœ¨æ‰§è¡Œæœ¬åœ°äº‹åŠ¡æœŸé—´ç”Ÿæˆå›æ»šæ—¥å¿—ï¼Œè®°å½•äº†å¯¹æ•°æ®çš„ä¿®æ”¹æ“ä½œã€‚</p>
<p>å½“éœ€è¦å›æ»šäº‹åŠ¡æ—¶ï¼Œäº‹åŠ¡åè°ƒå™¨å‘å‚ä¸è€…å‘é€å›æ»šè¯·æ±‚ï¼Œå‚ä¸è€…æ ¹æ®å›æ»šæ—¥å¿—ä¸­çš„ä¿¡æ¯æ‰§è¡Œæ’¤é”€æ“ä½œï¼Œå°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚</p>
<p>å›æ»šæ—¥å¿—çš„ç®¡ç†å’Œå­˜å‚¨æ˜¯Seataçš„æ ¸å¿ƒæœºåˆ¶ï¼Œå¯ä»¥é€‰æ‹©å°†æ—¥å¿—å­˜å‚¨åœ¨ä¸åŒçš„ä»‹è´¨ä¸­ã€‚é€šè¿‡å›æ»šæ—¥å¿—çš„æŒä¹…åŒ–å’Œæ¢å¤ï¼ŒSeataç¡®ä¿äº†äº‹åŠ¡çš„ä¸€è‡´æ€§å’Œæ¢å¤æ€§ã€‚</p>
<h3 data-id="heading-21">Sentinel ä¸Hystrixçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</h3>
<p>Hystrixå’ŒSentineléƒ½æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­å®ç°ç†”æ–­å’Œé™æµçš„å·¥å…·ï¼Œå®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«å’Œç‰¹ç‚¹ï¼š</p>
<p>Hystrixæ˜¯Netflixå¼€æºçš„ç†”æ–­å™¨å®ç°ï¼Œä¸»è¦ç”¨äºä¿æŠ¤åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æœåŠ¡è°ƒç”¨ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬çº¿ç¨‹éš”ç¦»ã€èµ„æºä¿æŠ¤å’Œé™çº§å¤„ç†ã€‚Hystrixé€šè¿‡å°†æ¯ä¸ªæœåŠ¡è°ƒç”¨æ”¾å…¥ç‹¬ç«‹çš„çº¿ç¨‹æ± ä¸­æ¥å®ç°çº¿ç¨‹éš”ç¦»ï¼Œé˜²æ­¢ä¸€ä¸ªæœåŠ¡çš„å»¶è¿Ÿæˆ–æ•…éšœå½±å“å…¶ä»–æœåŠ¡ã€‚å®ƒé€šè¿‡ç›‘æ§æœåŠ¡è°ƒç”¨çš„æˆåŠŸç‡ã€å»¶è¿Ÿç­‰æŒ‡æ ‡æ¥ä¿æŠ¤åç«¯èµ„æºï¼Œå¹¶åœ¨å¤±è´¥çš„è¯·æ±‚æˆ–å“åº”è¶…æ—¶è¾¾åˆ°ä¸€å®šé˜ˆå€¼æ—¶è‡ªåŠ¨æ‰“å¼€ç†”æ–­å™¨ï¼Œé¿å…è¿é”æ•…éšœã€‚æ­¤å¤–ï¼ŒHystrixè¿˜æä¾›äº†é™çº§å¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥åœ¨æœåŠ¡ä¸å¯ç”¨æˆ–å“åº”è¿‡æ…¢æ—¶è¿”å›é¢„å®šä¹‰çš„é™çº§å“åº”ï¼Œä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p>
<p>Sentinelæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„æµé‡æ§åˆ¶å’Œç³»ç»Ÿä¿æŠ¤å·¥å…·ï¼Œä¸»è¦ç”¨äºå®ç°å¾®æœåŠ¡æ¶æ„ä¸­çš„æµé‡æ§åˆ¶ã€ç†”æ–­ã€é™çº§å’Œç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰ã€‚å®ƒçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬å®æ—¶ç›‘æ§å’ŒåŠ¨æ€è§„åˆ™é…ç½®ã€ä¸°å¯Œçš„æµé‡æ§åˆ¶ç­–ç•¥ã€ç»†ç²’åº¦çš„æœåŠ¡ä¿æŠ¤ä»¥åŠæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ã€‚Sentinelå¯ä»¥å®æ—¶ç›‘æ§æœåŠ¡çš„è¯·æ±‚æµé‡å’Œå„é¡¹æŒ‡æ ‡ï¼Œå¹¶æä¾›å®æ—¶çš„ä»ªè¡¨ç›˜å’Œå¯è§†åŒ–çš„ç›‘æ§ç•Œé¢ã€‚å®ƒè¿˜æ”¯æŒé€šè¿‡APIåŠ¨æ€é…ç½®æµé‡æ§åˆ¶å’Œç†”æ–­è§„åˆ™ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡ŒåŠ¨æ€è°ƒæ•´ã€‚Sentinelæä¾›äº†å¤šç§æµé‡æ§åˆ¶ç­–ç•¥ï¼ŒåŒ…æ‹¬åŸºäºQPSã€çº¿ç¨‹æ•°ã€å¹¶å‘è¿æ¥æ•°ç­‰å¤šç§æŒ‡æ ‡è¿›è¡Œçš„æµé‡æ§åˆ¶ã€‚æ­¤å¤–ï¼ŒSentinelè¿˜æ”¯æŒå¯¹æ¯ä¸ªå…·ä½“çš„æœåŠ¡æ¥å£è¿›è¡Œç†”æ–­ã€é™çº§å’Œé™æµç­‰æ“ä½œï¼Œä»¥å®ç°ç²¾ç¡®çš„æœåŠ¡ä¿æŠ¤ç­–ç•¥ã€‚åŒæ—¶ï¼ŒSentinelä¸ä»…æ”¯æŒJavaï¼Œè¿˜æ”¯æŒGoã€Pythonç­‰å¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œä½¿å…¶é€‚ç”¨äºè·¨è¯­è¨€çš„å¾®æœåŠ¡æ¶æ„ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼ŒHystrixæ³¨é‡çº¿ç¨‹éš”ç¦»å’Œèµ„æºä¿æŠ¤ï¼Œé€‚ç”¨äºä¿æŠ¤å•ä¸ªæœåŠ¡è°ƒç”¨ã€‚è€ŒSentinelæ³¨é‡æµé‡æ§åˆ¶å’ŒåŠ¨æ€è§„åˆ™é…ç½®ï¼Œé€‚ç”¨äºå¯¹æ•´ä¸ªç³»ç»Ÿçš„æµé‡è¿›è¡Œç›‘æ§å’Œä¿æŠ¤ã€‚æ ¹æ®å®é™…éœ€æ±‚å’ŒæŠ€æœ¯æ ˆï¼Œå¯ä»¥é€‰æ‹©é€‚åˆçš„å·¥å…·æ¥å®ç°å¾®æœåŠ¡æ¶æ„ä¸­çš„ç†”æ–­å’Œé™æµåŠŸèƒ½ã€‚</p>
<h3 data-id="heading-22">å¦‚æœ Sentinel çš„å¼‚å¸¸å¤„ç†è§„åˆ™ä¸æ»¡è¶³éœ€æ±‚ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</h3>
<p>å¦‚æœ Sentinel çš„é»˜è®¤å¼‚å¸¸å¤„ç†æœºåˆ¶æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†è§„åˆ™ã€‚</p>
<p>Sentinel å…è®¸é€šè¿‡è‡ªå®šä¹‰å®ç° BlockedExceptionHandler æ¥å£ï¼Œç„¶åå°†è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨å¯¹è±¡äº¤ç»™ Spring å®¹å™¨è¿›è¡Œç®¡ç†ã€‚ å¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚ï¼Œå®šåˆ¶åŒ–å¼‚å¸¸å¤„ç†ç­–ç•¥ï¼Œä¾‹å¦‚å…¨å±€å…œåº•å¤„ç†ã€æ—¥å¿—æ‰“å°ã€ç©ºæŒ‡é’ˆæ£€æŸ¥ç­‰ã€‚ åŒæ—¶ï¼Œè¿˜å¯ä»¥åœ¨å¤„ç†å™¨ä¸­åŠ å…¥è‡ªå®šä¹‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚å¯¹å¼‚å¸¸è¿›è¡Œåˆ†ç±»ã€ç»Ÿè®¡å’Œåé¦ˆç­‰ã€‚ è¿™æ ·ï¼Œå¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œä¸šåŠ¡éœ€æ±‚ï¼Œçµæ´»åœ°æ‰©å±• Sentinel çš„å¼‚å¸¸å¤„ç†èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-23">ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„é˜²æ‚¬æŒ‚ï¼Œç©ºå›æ»š</h3>
<p>åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œé˜²æ‚¬æŒ‚å’Œç©ºå›æ»šæ˜¯ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå®ƒä»¬é€šå¸¸åœ¨å®ç°åˆ†å¸ƒå¼äº‹åŠ¡æ—¶æ¶‰åŠçš„é”å®šæœºåˆ¶ã€éš”ç¦»æ€§ã€é”™è¯¯å¤„ç†ç­‰æ–¹é¢ã€‚ä¸‹é¢å¯¹è¿™ä¸¤ä¸ªæ¦‚å¿µè¿›è¡Œè¯¦ç»†è§£é‡Š</p>
<ol>
<li>é˜²æ‚¬æŒ‚
é˜²æ‚¬æŒ‚æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼äº‹åŠ¡çš„ç¬¬ä¸€é˜¶æ®µï¼Œé˜²æ­¢åœ¨æ²¡æœ‰å¯¹åº”çš„ Try æ“ä½œçš„æƒ…å†µä¸‹å‡ºç° Confirm æˆ– Cancelæ“ä½œã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯äº‹åŠ¡çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</li>
</ol>
<p>åˆ†å¸ƒå¼äº‹åŠ¡ä¸­æœ€å¸¸è§çš„æ¨¡å‹æ˜¯ TCC(Try-Confirm-Cancel)æ¨¡å‹ã€‚åœ¨ TCC æ¨¡å‹ä¸­ï¼Œäº‹åŠ¡é€šå¸¸åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>Tryï¼šèµ„æºçš„é¢„ç•™æ“ä½œã€‚</li>
<li>Confirmï¼šç¡®è®¤æ“ä½œï¼Œå®Œæˆä¸šåŠ¡é€»è¾‘</li>
<li>Cancelï¼šå–æ¶ˆæ“ä½œï¼Œå›æ»šé¢„ç•™èµ„æºã€‚</li>
</ul>
<p>é˜²æ‚¬æŒ‚æœºåˆ¶çš„ä½œç”¨æ˜¯ç¡®ä¿åœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼ŒConfirm å’Œ Cancel æ“ä½œåªä¼šåœ¨ Try æ“ä½œæˆåŠŸæ‰§è¡Œåæ‰ä¼šè§¦å‘ã€‚é˜²æ‚¬æŒ‚çš„åœºæ™¯é€šå¸¸æ˜¯ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>Confirm æ“ä½œæ‚¬æŒ‚ï¼šå¦‚æœ Confirm æ“ä½œåœ¨æ²¡æœ‰æ‰§è¡Œè¿‡ Try æ“ä½œçš„æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li>
<li>Cancel æ“ä½œæ‚¬æŒ‚ï¼šç±»ä¼¼åœ°ï¼Œå¦‚æœ Cancel æ“ä½œåœ¨æ²¡æœ‰ Try æ“ä½œçš„æƒ…å†µä¸‹è¢«è°ƒç”¨ï¼Œä¹Ÿä¼šç ´åæ•°æ®çš„ä¸€è‡´æ€§ã€‚</li>
</ul>
<p>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œé€šå¸¸éœ€è¦é€šè¿‡æŸäº›æœºåˆ¶æ¥æ£€æµ‹å’Œé˜²æ­¢æ‚¬æŒ‚ã€‚ä¾‹å¦‚:</p>
<ul>
<li>å¹‚ç­‰æ€§æ£€æŸ¥ï¼šConfirm å’Œ Cancel æ“ä½œåº”è¯¥å…·å¤‡å¹‚ç­‰æ€§ï¼Œé¿å…å¤šæ¬¡è°ƒç”¨å¼•å‘é—®é¢˜ã€‚</li>
<li>çŠ¶æ€æ ¡éªŒï¼šåœ¨æ‰§è¡Œ Confirm æˆ– Cancel ä¹‹å‰ï¼Œå¯ä»¥å…ˆæ£€æŸ¥æ˜¯å¦æœ‰å¯¹åº”çš„ Try æ“ä½œæˆåŠŸè¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‹’ç»æ‰§è¡Œ Confirm æˆ– Cancel æ“ä½œ</li>
</ul>
<ol start="2">
<li>ç©ºå›æ»š
ç©ºå›æ»šæ˜¯æŒ‡åœ¨æ²¡æœ‰æ‰§è¡ŒæˆåŠŸçš„Tryæ“ä½œæ—¶ï¼ŒCancelæ“ä½œä»ç„¶è¢«è°ƒç”¨äº†ã€‚Cancelæ“ä½œå®é™…ä¸Šå°±æ˜¯ Tryæ“ä½œçš„å›æ»šæ“ä½œï¼Œå¦‚æœ Try æ“ä½œå¾ˆæœ¬æ²¡æœ‰æˆåŠŸï¼Œåˆ™ Cancel æ“ä½œå®é™…ä¸ä¼šå¯¹ä»»ä½•èµ„æºäº§ç”Ÿå½±å“ï¼Œè¿™ç§æƒ…å†µä¸‹ç§°ä¸ºç©ºå›æ»š</li>
</ol>
<p>ç©ºå›æ»šé€šå¸¸å‘ç”Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæ¯”å¦‚:</p>
<ul>
<li>ç½‘ç»œè¶…æ—¶ï¼šTry æ“ä½œè¿˜æ²¡æ‰§è¡ŒæˆåŠŸï¼Œç½‘ç»œå°±è¶…æ—¶äº†ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡åè°ƒå™¨å¯èƒ½è¯¯è®¤ä¸º Try æ“ä½œå¤±è´¥ï¼Œå› æ­¤ä¼šè°ƒç”¨ Cancelã€‚</li>
<li>ç½‘ç»œåˆ†åŒºæˆ–ä¸­æ–­ï¼šTry æ“ä½œè¯·æ±‚æœªåˆ°è¾¾ç›¸åº”çš„æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯è¯¯è®¤ä¸º Try æ“ä½œå·²ç»å¤±è´¥å¹¶å‘èµ· Cancelã€‚</li>
</ul>
<p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒCancel æ“ä½œä¼šè¢«æ‰§è¡Œï¼Œä½†å› ä¸º Try æ“ä½œå¹¶æ²¡æœ‰æˆåŠŸï¼Œæ‰€ä»¥ Cancel å®é™…ä¸Šä»€ä¹ˆéƒ½ä¸éœ€è¦åšã€‚è¿™å°±æ˜¯ç©ºå›æ»šã€‚</p>
<p>ä¸ºäº†æ”¯æŒç©ºå›æ»šï¼ŒCancel æ“ä½œå¿…é¡»å…·å¤‡ä»¥ä¸‹èƒ½åŠ›:</p>
<ul>
<li>å¹‚ç­‰æ€§ï¼šå³ä½¿ Cancel æ“ä½œè¢«å¤šæ¬¡è°ƒç”¨ï¼Œå®ƒçš„æ•ˆæœä¹Ÿåªèƒ½æ˜¯æ‰§è¡Œä¸€æ¬¡ï¼Œä¸ä¼šå¯¹ç³»ç»Ÿäº§ç”Ÿé¢å¤–å½±å“ã€‚</li>
<li>ç©ºå›æ»šå…¼å®¹æ€§ï¼šCancelæ“ä½œåœ¨å‘ç°æ²¡æœ‰ Try æ“ä½œæ‰§è¡ŒæˆåŠŸæ—¶ï¼Œä¸åšä»»ä½•ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æˆåŠŸçŠ¶æ€</li>
</ul>
<h3 data-id="heading-24">å½“å‰æœ‰ä¸ªæœ¬åœ°æ“ä½œ Aï¼Œè¿œç¨‹æ“ä½œ Bï¼Œæˆ‘éœ€è¦ä¿è¯ Aå’Œ Bäº‹åŠ¡çš„ä¸€è‡´æ€§ï¼Œä½ ä¼šå¦‚ä½•å®ç°ï¼Ÿ</h3>
<blockquote>
<p>è¿™ä¸ªé¢˜ç›®ç»å¸¸æœ‰äººä¼šç›´æ¥è¸©å‘ï¼Œç„¶åå°±è¢«é¢è¯•å®˜ç»•è¿›å»å‡ºä¸æ¥äº†</p>
</blockquote>
<p>è¦ä¿è¯æœ¬åœ°æ“ä½œAå’Œè¿œç¨‹æ“ä½œBçš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ä¸èƒ½åœ¨æœ¬åœ°äº‹åŠ¡ä¸­ç›´æ¥åµŒå…¥è¿œç¨‹ RPCè°ƒç”¨(è¿™å°±æ˜¯å‘)ï¼Œè€Œæ˜¯é€šè¿‡å¼‚æ­¥è§£è€¦+è¡¥å¿æœºåˆ¶å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<p>å¸¸è§æ–¹æ¡ˆæ˜¯æœ¬åœ°æ¶ˆæ¯è¡¨ï¼šæœ¬åœ°äº‹åŠ¡Aæ‰§è¡Œæ—¶ï¼Œå…ˆè®°å½•ä¸€æ¡â€œå¾…æ‰§è¡Œè¿œç¨‹æ“ä½œBâ€çš„æ—¥å¿—(ä¸Aåœ¨åŒä¸€äº‹åŠ¡ä¸­)ï¼Œæœ¬åœ°äº‹åŠ¡æäº¤åï¼Œé€šè¿‡å¼‚æ­¥çº¿ç¨‹æˆ–æ¶ˆæ¯é˜Ÿåˆ—è§¦å‘è¿œç¨‹è°ƒç”¨Bã€è‹¥Bå¤±è´¥ï¼Œé€šè¿‡å®šæ—¶ä»»åŠ¡é‡è¯•(å› ä¸ºæœ‰æ—¥å¿—ï¼Œå¯ä»¥æ‰«ææ—¥å¿—é‡è¯•)ï¼Œç›´åˆ°æˆåŠŸæˆ–äººå·¥ä»‹å…¥ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æœ¬åœ°äº‹åŠ¡ä¸­ç›´æ¥è°ƒç”¨è¿œç¨‹ RPC?</p>
<pre><code class="hljs language-text" lang="text">begin transaction
  update A æœ¬åœ°æ•°æ®åº“
  è°ƒç”¨è¿œç¨‹æœåŠ¡Bï¼ˆRPCï¼‰
commit
</code></pre>
<p>ä¸¾ä¸ªä¾‹å­ï¼šæœ¬åœ°æ“ä½œAæ˜¯â€œæ‰£åº“å­˜â€(æ•°æ®åº“äº‹åŠ¡)ï¼Œè¿œç¨‹æ“ä½œBæ˜¯â€œè°ƒç”¨æ”¯ä»˜æ¥å£æ‰£æ¬¾â€ã€‚å¦‚æœåœ¨æœ¬åœ°äº‹åŠ¡ä¸­ç›´æ¥è°ƒç”¨Bï¼Œè‹¥ Bè¶…æ—¶ åˆ™æœ¬åœ°äº‹åŠ¡å›æ»šï¼Œä½†Bå®é™…æ‰§è¡Œäº†ï¼Œå¯¼è‡´åº“å­˜ä¸æ”¯ä»˜çŠ¶æ€ä¸ä¸€è‡´ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰é•¿äº‹åŠ¡é—®é¢˜ï¼Œæ¯•ç«Ÿå¤–éƒ¨ç³»ç»Ÿä¸å¯æ§(å³ä½¿æ˜¯å…¬å¸å…¶ä»–éƒ¨åˆ†çš„æ¥å£)ï¼Œè‹¥Bæ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œä¼šå¯¼è‡´ A æ“ä½œæœ¬åœ°äº‹åŠ¡é”æŒæœ‰æ—¶é—´å»¶é•¿ï¼Œå¼•å‘æ•°æ®åº“è¿æ¥è€—å°½æˆ–æ­»é”é—®é¢˜ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸å»ºè®®å°† RPCè°ƒç”¨åµŒå…¥æœ¬åœ°äº‹åŠ¡ä¸­ã€‚åŒç†ï¼Œåƒå‘MQã€æ›´æ–°å¤–éƒ¨ç³»ç»Ÿ(å¦‚ç¼“å­˜)ç­‰æ“ä½œï¼Œéƒ½ä¸å»ºè®®æ”¾åœ¨äº‹åŠ¡å†…ã€‚</p>
<h3 data-id="heading-25">ç°åœ¨éœ€è¦ä½ è®¾è®¡ä¸€ä¸ªå°†å·²ç™»å½•çš„ç”¨æˆ·è¸¢ä¸‹çº¿çš„åŠŸèƒ½ï¼Œå¦‚ä½•å®ç°?</h3>
<p>å¯ä»¥é€šè¿‡æ ‡è®°ç”¨æˆ· token ä¸ºå¤±æ•ˆæˆ–è€…ç›´æ¥ç§»é™¤å…¶ sessionæ¥å®ç°è¸¢ä¸‹çº¿åŠŸèƒ½</p>
<p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®©åç»­è¯·æ±‚ä¸­å¸¦çš„ç™»å½•å‡­è¯ä¸å†è¢«ç³»ç»Ÿæ¥å—ã€‚æ ‡è®°å¤±æ•ˆå’Œç›´æ¥åˆ é™¤éƒ½è¡Œï¼Œè¿™æ ·ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚å°±ä¼šè¢«æ‹¦æˆªæˆ–è¦æ±‚é‡æ–°ç™»å½•</p>
<h2 data-id="heading-26">åˆ†å¸ƒå¼ç³»ç»Ÿ</h2>
<h3 data-id="heading-27">æŠŠå•ä½“é¡¹ç›®è¿›è¡Œäº†å¤šæœºéƒ¨ç½²ï¼Œå¤šå°æœåŠ¡å™¨æ˜¯å¦‚ä½•å…±äº«ç”¨æˆ·ç™»å½•ä¿¡æ¯çš„ï¼Ÿ</h3>
<p>ç›®å‰ä¸»æµæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š</p>
<ol>
<li>å°† Session æ”¾ç½®ç¬¬ä¸‰æ–¹å…±äº«å­˜å‚¨ä¸­ï¼Œä¾‹å¦‚ Redisã€Memcached ç­‰åˆ†å¸ƒå¼ç¼“å­˜ æˆ–æ•°æ®åº“ä¸­ï¼Œæ‰€æœ‰çš„æœåŠ¡å™¨ç»Ÿä¸€è®¿é—®ç¬¬ä¸‰æ–¹ã€‚</li>
<li>JWTï¼Œå³æœåŠ¡å™¨ä¸å­˜å‚¨ä¼šè¯ï¼Œç”¨æˆ·ç™»å½•åè¿”å›ç­¾åä»¤ç‰Œ(å«ç”¨æˆ·ä¿¡æ¯)ï¼Œæ¯æ¬¡è¯·æ±‚æºå¸¦ä»¤ç‰ŒéªŒè¯å³å¯ã€‚ä¸è¿‡ç°åœ¨å¾ˆå¤šé¡¹ç›®ä¼šæŠŠ JWT å­˜åœ¨ Redis ä¸­</li>
</ol>
<p>å› ä¸ºå•æœºæ—¶å€™ä¼šè¯(Session)ä¼šå­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ¯”å¦‚ Tomcat çš„ HttpSession é»˜è®¤å­˜åœ¨å½“å‰æœåŠ¡å™¨å†…å­˜ä¸­ã€‚å¤šæœºéƒ¨ç½²åï¼ŒåŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡è¯·æ±‚å¯èƒ½ä¼šè¢«è´Ÿè½½å‡è¡¡åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œæ–°æœåŠ¡å™¨æ— æ³•è¯»å–åŸä¼šè¯æ•°æ®ï¼Œè¿™æ—¶å€™ç™»å½•æ€å°±ä¸¢äº†æœ‰äº›äººä¼šé‡‡ç”¨ ç²˜æ€§ä¼šè¯ï¼Œæ¯”å¦‚åˆ©ç”¨ Nginx æ ¹æ®ç”¨æˆ· IP æˆ– Cookie å“ˆå¸Œå›ºå®šè½¬å‘åˆ°åŒä¸€å°æœåŠ¡å™¨ã€‚è¿™ä¸ªæ–¹å¼æœ‰å±€é™æ€§ï¼Œå¦‚æœæœåŠ¡å™¨å®•æœºäº†ä¼šè¯å°±ä¸¢å¤±(ç™»å½•æ€å°±æ‰äº†)ï¼Œä¸”æ‰©å®¹ç¼©å®¹æ—¶ä¼šå¯¼è‡´è´Ÿè½½ä¸å‡ï¼Œæ— æ³•å®ç°çœŸæ­£çš„å¼¹æ€§ä¼¸ç¼©ã€‚æ‰€ä»¥æ™®éä¼šé‡‡ç”¨ç¬¬ä¸‰æ–¹å…±äº«å­˜å‚¨ Sessionï¼Œæ¯”å¦‚ç”¨ Redis å­˜æ”¾ Sessionï¼Œè¿™æ ·ä¸€æ¥æ‰€æœ‰çš„æœåŠ¡éƒ½å¯ä»¥å…±äº«è®¿é—®åˆ°åŒä¸€ä¸ª Sessionã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­</p>
<ol>
<li>ç”¨æˆ·ç™»å½•åï¼ŒæœåŠ¡ç«¯ç”Ÿæˆ SessionIDï¼Œå¹¶å°†ç”¨æˆ·æ•°æ®(å¦‚ç”¨æˆ·IDã€æƒé™)å†™å…¥Redis(Key=SessionIDï¼ŒValue=åºåˆ—åŒ–æ•°æ®)ã€‚</li>
<li>å“åº”ä¸­è®¾ç½® Cookie(å¦‚SESSION=abc123)æˆ– Header è¿”å› Tokenã€‚</li>
<li>ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚æºå¸¦ Session IDï¼Œä»»æ„æœåŠ¡å™¨ä» Redis è¯»å–æ•°æ®ï¼Œè¿˜åŸç”¨æˆ·ä¸Šä¸‹æ–‡</li>
</ol>
<h2 data-id="heading-28">æœåŠ¡ç›‘æ§</h2>
<h3 data-id="heading-29">ä½ ä»¬çš„æœåŠ¡æ€ä¹ˆåšç›‘æ§å’Œå‘Šè­¦ï¼Ÿ</h3>
<p>æˆ‘ä»¬ä½¿ç”¨Prometheuså’ŒGrafanaæ¥å®ç°æ•´ä¸ªå¾®æœåŠ¡é›†ç¾¤çš„ç›‘æ§å’Œå‘Šè­¦ï¼š</p>
<ul>
<li>Prometheusï¼šPrometheus æ˜¯ä¸€ä¸ªå¼€æºçš„ç›‘æ§ç³»ç»Ÿï¼Œå…·æœ‰çµæ´»çš„æ•°æ®æ¨¡å‹å’Œå¼ºå¤§çš„æŸ¥è¯¢è¯­è¨€ï¼Œèƒ½å¤Ÿæ”¶é›†å’Œå­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®ã€‚å®ƒå¯ä»¥é€šè¿‡HTTPåè®®å®šæœŸæ‹‰å–å¾®æœåŠ¡çš„æŒ‡æ ‡æ•°æ®ï¼Œå¹¶æä¾›å¯æ‰©å±•çš„å­˜å‚¨å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚</li>
<li>Grafanaï¼šGrafana æ˜¯ä¸€ä¸ªå¼€æºçš„å¯è§†åŒ–ä»ªè¡¨æ¿å·¥å…·ï¼Œå¯ä»¥ä¸ Prometheus ç»“åˆä½¿ç”¨ï¼Œåˆ›å»ºå®æ—¶å’Œå†å²æ•°æ®çš„ä»ªè¡¨æ¿ã€‚Grafana æä¾›äº†ä¸°å¯Œçš„å›¾è¡¨å’Œå¯è§†åŒ–é€‰é¡¹ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç†è§£å’Œåˆ†æå¾®æœåŠ¡çš„æ€§èƒ½å’ŒçŠ¶æ€ã€‚</li>
</ul>
<h3 data-id="heading-30">ä½ ä»¬çš„æœåŠ¡æ€ä¹ˆåšæ—¥å¿—æ”¶é›†ï¼Ÿ</h3>
<p>æ—¥å¿—æ”¶é›†æœ‰å¾ˆå¤šç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ELKï¼š</p>
<ul>
<li>Elasticsearchï¼šElasticsearchæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ï¼Œç”¨äºå­˜å‚¨å’Œç´¢å¼•å¤§é‡çš„æ—¥å¿—æ•°æ®ã€‚å®ƒæä¾›äº†å¿«é€Ÿçš„æœç´¢å’ŒèšåˆåŠŸèƒ½ï¼Œå¯ä»¥é«˜æ•ˆåœ°å¤„ç†å¤§è§„æ¨¡çš„æ—¥å¿—æ•°æ®ã€‚</li>
<li>Logstashï¼šLogstashæ˜¯ä¸€ä¸ªç”¨äºæ”¶é›†ã€è¿‡æ»¤å’Œè½¬å‘æ—¥å¿—æ•°æ®çš„å·¥å…·ã€‚å®ƒå¯ä»¥ä»å„ç§æ¥æºï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰æ”¶é›†æ—¥å¿—æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œå¤„ç†å’Œè½¬æ¢ï¼Œç„¶åå°†å…¶å‘é€åˆ°Elasticsearchè¿›è¡Œå­˜å‚¨å’Œç´¢å¼•ã€‚</li>
<li>Kibanaï¼šKibanaæ˜¯ä¸€ä¸ªç”¨äºæ—¥å¿—æ•°æ®å¯è§†åŒ–å’Œåˆ†æçš„å·¥å…·ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„å›¾è¡¨ã€ä»ªè¡¨ç›˜å’Œæœç´¢åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å®æ—¶ç›‘æ§å’Œåˆ†ææ—¥å¿—æ•°æ®ï¼Œå‘ç°æ½œåœ¨çš„é—®é¢˜å’Œè¶‹åŠ¿ã€‚</li>
</ul>
<p>ç®€å•è¯´ï¼Œè¿™ä¸‰è€…é‡ŒElasticsearchæä¾›æ•°æ®å­˜å‚¨å’Œæ£€ç´¢èƒ½åŠ›ï¼ŒLogstashè´Ÿè´£å°†æ—¥å¿—æ”¶é›†åˆ°ESï¼ŒKibanaè´Ÿè´£æ—¥å¿—æ•°æ®çš„å¯è§†åŒ–åˆ†æã€‚</p>
<p>ä½¿ç”¨ELKè¿›è¡Œå¾®æœåŠ¡æ—¥å¿—æ”¶é›†çš„ä¸€èˆ¬æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨æ¯ä¸ªå¾®æœåŠ¡ä¸­é…ç½®æ—¥å¿—è¾“å‡ºï¼šå°†å¾®æœåŠ¡çš„æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰æˆ–æ—¥å¿—æ–‡ä»¶ã€‚</li>
<li>ä½¿ç”¨Logstashæ”¶é›†æ—¥å¿—ï¼šé…ç½®Logstashæ”¶é›†å™¨ï¼Œé€šè¿‡é…ç½®è¾“å…¥æ’ä»¶ï¼ˆå¦‚æ–‡ä»¶è¾“å…¥ã€ç½‘ç»œè¾“å…¥ç­‰ï¼‰ç›‘å¬å¾®æœåŠ¡çš„æ—¥å¿—è¾“å‡ºï¼Œå¹¶è¿›è¡Œè¿‡æ»¤å’Œå¤„ç†ã€‚</li>
<li>å°†æ—¥å¿—æ•°æ®å‘é€åˆ°Elasticsearchï¼šé…ç½®Logstashçš„è¾“å‡ºæ’ä»¶ï¼Œå°†ç»è¿‡å¤„ç†çš„æ—¥å¿—æ•°æ®å‘é€åˆ°Elasticsearchè¿›è¡Œå­˜å‚¨å’Œç´¢å¼•ã€‚</li>
<li>ä½¿ç”¨Kibanaè¿›è¡Œå¯è§†åŒ–å’Œåˆ†æï¼šé€šè¿‡Kibanaè¿æ¥åˆ°Elasticsearchï¼Œåˆ›å»ºä»ªè¡¨ç›˜ã€å›¾è¡¨å’Œæœç´¢æŸ¥è¯¢ï¼Œå®æ—¶ç›‘æ§å’Œåˆ†æå¾®æœåŠ¡çš„æ—¥å¿—æ•°æ®ã€‚</li>
</ol>
<p>é™¤äº†åº”ç”¨æœ€å¹¿æ³›çš„ELKï¼Œè¿˜æœ‰ä¸€äº›å…¶å®ƒçš„æ–¹æ¡ˆæ¯”å¦‚Fluentdã€Graylogã€Lokiã€Filebeatï¼Œä¸€äº›äº‘å‚å•†ä¹Ÿæä¾›äº†ä»˜è´¹æ–¹æ¡ˆï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„slsã€‚</p>
<h2 data-id="heading-31">å…¶å®ƒ</h2>
<h3 data-id="heading-32">è¯´ä¸€ä¸‹ä½ å¯¹äº DDD çš„äº†è§£?</h3>
<p>DDDå…¨åå«åš Domain-driven designï¼Œå³é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œå®ƒæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œå…¶ä¸»è¦ç›®çš„å°±æ˜¯è®©å¼€å‘äººå‘˜å’Œé¢†åŸŸä¸“å®¶å¯ä»¥æ›´å¥½åœ°åä½œï¼Œä»è€Œå¼€å‘å‡ºæ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„ç³»ç»Ÿ</p>
<p>DDD çš„å…³é”®æ¦‚å¿µåŒ…æ‹¬é¢†åŸŸæ¨¡å‹å’Œé™ç•Œä¸Šä¸‹æ–‡ã€‚</p>
<ul>
<li>é¢†åŸŸæ¨¡å‹æè¿°äº†ä¸šåŠ¡é¢†åŸŸçš„è§„åˆ™å’Œé€»è¾‘ï¼Œè®©å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£ä¸šåŠ¡éœ€æ±‚ã€‚</li>
<li>é™ç•Œä¸Šä¸‹æ–‡åˆ™å®šä¹‰äº†ä¸€ä¸ªç‰¹å®šçš„ä¸šåŠ¡é¢†åŸŸå†…çš„æ¨¡å‹å’Œä»£ç ï¼Œä½¿å¾—å…¶å¯ä»¥ç‹¬ç«‹äºå…¶ä»–ä¸Šä¸‹æ–‡è¿›è¡Œå¼€å‘å’Œç»´æŠ¤ã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒDDDè¿˜å¼ºè°ƒåˆ†å±‚æ¶æ„å’Œäº‹ä»¶æº¯æºçš„é‡è¦æ€§ï¼Œåˆ†å±‚æ¶æ„å°†ç³»ç»Ÿåˆ’åˆ†ä¸ºä¸åŒå±‚æ¬¡çš„ç»“æ„ï¼Œæ¯ä¸ªå±‚æ¬¡çš„èŒè´£å’Œè§’è‰²å„æœ‰ä¸åŒï¼Œä»è€Œæ–¹ä¾¿ä¸šåŠ¡ä»£ç çš„å¼€å‘å’Œç»´æŠ¤ã€‚äº‹ä»¶æº¯æºåˆ™æ˜¯ä¸€ç§å­˜å‚¨å’Œå¤„ç†ä¸šåŠ¡äº‹ä»¶çš„æŠ€æœ¯ï¼Œæ”¯æŒå®¡è®¡ã€åˆè§„å’Œä¸šåŠ¡åˆ†æç­‰éœ€æ±‚ã€‚</p>
<p>æ€»å¾—æ¥è¯´ï¼ŒDODæ˜¯ä¸€ç§è®¾è®¡å’Œå¼€å‘å¤æ‚è½¯ä»¶ç³»ç»Ÿçš„æ–¹æ³•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ MVC å·²ç»èƒ½å¤Ÿå®Œæˆè®¸å¤šè½¯ä»¶ä¸šåŠ¡çš„å¼€å‘äº†ï¼Œå¦‚æœé¡¹ç›®æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œå¼•å…¥ DDDçš„è¯ä¸ä»…ä¸èƒ½é™ä½å¼€å‘æˆæœ¬ï¼Œè¿˜ä¼šå¢åŠ å¼€å‘çš„å¤æ‚ç¨‹åº¦ï¼Œæ‰€ä»¥ DDD åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦ä¸€å®šçš„æ€è€ƒã€‚</p>
<h3 data-id="heading-33">ä»€ä¹ˆæ˜¯ç°åº¦å‘å¸ƒã€é‡‘ä¸é›€éƒ¨ç½²ä»¥åŠè“ç»¿éƒ¨ç½²?</h3>
<p>ç°åº¦å‘å¸ƒã€é‡‘ä¸é›€éƒ¨ç½²å’Œè“ç»¿éƒ¨ç½²æ˜¯ä¸‰ç§å¸¸è§çš„è½¯ä»¶å‘å¸ƒç­–ç•¥ï¼Œå®ƒä»¬ç”¨äºåœ¨ç³»ç»Ÿå‡çº§æ—¶é™ä½é£é™©ï¼Œç¡®ä¿åœ¨æ–°ç‰ˆæœ¬ä¸Šçº¿è¿‡ç¨‹ä¸­æœåŠ¡çš„ç¨³å®šæ€§å’Œå¯æ§æ€§</p>
<ul>
<li>ç°åº¦å‘å¸ƒ</li>
</ul>
<p>ç°åº¦å‘å¸ƒæ˜¯ä¸€ç§æ–°è¿›å¼çš„å‘å¸ƒæ–¹å¼ï¼Œå®ƒé€šè¿‡å°†æ–°ç‰ˆæœ¬é€æ­¥æ¨é€ç»™éƒ¨åˆ†ç”¨æˆ·è¿›è¡Œè¯•ç”¨ï¼Œé€æ­¥æ‰©å¤§ä½¿ç”¨èŒƒå›´ï¼Œç›´åˆ°æ–°ç‰ˆæœ¬å®Œå…¨æ›¿æ¢æ—§ç‰ˆæœ¬ï¼Œå…¶ç›®çš„æ˜¯é€šè¿‡å°èŒƒå›´çš„ç”¨æˆ·æµ‹è¯•ï¼ŒéªŒè¯æ–°ç‰ˆæœ¬çš„ç¨³å®šæ€§ï¼Œé™ä½å‘å¸ƒæ–°ç‰ˆæœ¬çš„é£éªŒ</p>
<p>å®ç°æ–¹å¼ï¼šé€šå¸¸é€šè¿‡æµé‡æ§åˆ¶çš„æ–¹å¼ï¼Œå°†ä¸€éƒ¨åˆ†ç”¨æˆ·è¯·æ±‚å¼•å¯¼åˆ°æ–°ç‰ˆæœ¬å®ä¾‹ä¸Šã€‚å¦‚æœæ–°ç‰ˆæœ¬è¡¨ç°æ­£å¸¸ï¼Œå¯ä»¥é€æ­¥å¢åŠ æ–°ç‰ˆæœ¬çš„ç”¨æˆ·ç¾¤ä½“ï¼Œç›´åˆ°å…¨é‡ç”¨æˆ·ä½¿ç”¨æ–°ç‰ˆæœ¬ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šé€‚åˆåœ¨ä¸šåŠ¡é€»è¾‘å˜åŠ¨è¾ƒå¤§çš„åœºæ™¯ä¸­ä½¿ç”¨ï¼Œé€šè¿‡ç°åº¦å‘å¸ƒå¯ä»¥å‘ç°æ–°ç‰ˆæœ¬ä¸­çš„æ½œåœ¨é—®é¢˜ï¼Œå¹¶åœ¨å½±å“èŒƒå›´è¾ƒå°çš„æƒ…å†µä¸‹è¿›è¡Œå›æ»šã€‚</p>
<ul>
<li>é‡‘ä¸é›€éƒ¨ç½²</li>
</ul>
<p>é‡‘ä¸é›€éƒ¨ç½²(Ccanary Deployment)æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç°åº¦å‘å¸ƒç­–ç•¥ï¼Œé€šå¸¸æ˜¯æŒ‡å°†æ–°ç‰ˆæœ¬éƒ¨ç½²åˆ°å°‘é‡çš„å®ä¾‹ä¸Šï¼Œå¹¶ä»…å°†éƒ¨åˆ†æµé‡å¼•å¯¼è‡³è¿™äº›å®ä¾‹ï¼Œä»¥éªŒè¯æ–°ç‰ˆæœ¬åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­çš„è¡¨ç°ã€‚</p>
<p>å’Œç°åº¦å‘å¸ƒçš„åŒºåˆ«ï¼šé‡‘ä¸é›€éƒ¨ç½²æ›´å¼ºè°ƒåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é€æ­¥éªŒè¯æ–°ç‰ˆæœ¬çš„è¡¨ç°ï¼Œç±»ä¼¼äºè®©â€œé‡‘ä¸é›€â€å…ˆè¿›å…¥çŸ¿äº•æ£€æµ‹å®‰å…¨æ€§ï¼Œä¸€æ—¦æ£€æµ‹åˆ°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šã€‚</p>
<p>å®ç°æ–¹å¼ï¼šå¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡å™¨æˆ–æœåŠ¡ç½‘æ ¼ï¼Œå°†ä¸€å®šæ¯”ä¾‹çš„æµé‡å¼•å¯¼åˆ°è¿è¡Œæ–°ç‰ˆæœ¬çš„å®ä¾‹ä¸Šã€‚è‹¥æ–°ç‰ˆæœ¬ç¨³å®šï¼Œå†é€æ­¥å¢åŠ å…¶æµé‡å æ¯”ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºéœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éªŒè¯æ–°åŠŸèƒ½æˆ–é…ç½®å˜æ›´çš„åœºæ™¯ã€‚é€šè¿‡é‡‘ä¸é›€éƒ¨ç½²ï¼Œå¯ä»¥æå‰å‘ç°æ–°ç‰ˆæœ¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„æ½œåœ¨é—®é¢˜ï¼Œé™ä½å¯¹å…¨é‡ç”¨æˆ·çš„å½±å“,</p>
<ul>
<li>è“ç»¿éƒ¨ç½²</li>
</ul>
<p>è“ç»¿éƒ¨ç½²(Blue-Green Deployment)æ˜¯ä¸€ç§æ— ç¼åˆ‡æ¢çš„éƒ¨ç½²ç­–ç•¥ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å§‹ç»ˆå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬ï¼šè“è‰²ç‰ˆæœ¬(å½“å‰çš„ç”Ÿäº§ç‰ˆæœ¬)å’Œç»¿è‰²ç‰ˆæœ¬(æ–°ç‰ˆæœ¬)ã€‚å½“ç»¿è‰²ç‰ˆæœ¬å‡†å¤‡å°±ç»ªæ—¶ï¼Œé€šè¿‡è´Ÿè½½å‡è¡¡æˆ–è·¯ç”±åˆ‡æ¢ï¼Œå°†æ‰€æœ‰æµé‡ä»è“è‰²ç‰ˆæœ¬åˆ‡æ¢åˆ°ç»¿è‰²ç‰ˆæœ¬ã€‚</p>
<p>ç‰¹ç‚¹ï¼šåœ¨è“ç»¿éƒ¨ç½²ä¸­ï¼Œæ—§ç‰ˆæœ¬(è“è‰²ç‰ˆæœ¬)å§‹ç»ˆä¿æŒå¯ç”¨ï¼Œå¯ä»¥åœ¨æ–°ç‰ˆæœ¬(ç»¿è‰²ç‰ˆæœ¬)å‡ºç°é—®é¢˜æ—¶ï¼Œå¿«é€Ÿåˆ‡æ¢å›æ—§ç‰ˆæœ¬ï¼Œå®ç°å¿«é€Ÿå›æ»šã€‚</p>
<p>å®ç°æ–¹å¼ï¼šé€šå¸¸é€šè¿‡è´Ÿè½½å‡è¡¡å™¨ã€DNS åˆ‡æ¢æˆ– APIç½‘å…³ï¼Œæ¥åˆ‡æ¢è“è‰²ç‰ˆæœ¬å’Œç»¿è‰²ç‰ˆæœ¬ä¹‹é—´çš„æµé‡æŒ‡å‘ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºéœ€è¦å¿«é€Ÿåˆ‡æ¢å’Œå›æ»šçš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨å¯¹ç³»ç»Ÿç¨³å®šæ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨ä¸­ï¼Œé€šè¿‡è“ç»¿éƒ¨ç½²ï¼Œå¯ä»¥å®ç°æ— åœæœºå‡çº§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SwiftUI çŠ¶æ€ç®¡ç†æç®€ä¹‹é“ï¼šä»â€œæœ€å°çŠ¶æ€â€åˆ°â€œçŠ¶æ€æ ‘â€]]></title>    <link>https://juejin.cn/post/7575456858427654190</link>    <guid>https://juejin.cn/post/7575456858427654190</guid>    <pubDate>2025-11-24T00:50:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858427654190" data-draft-id="7552584517867241522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SwiftUI çŠ¶æ€ç®¡ç†æç®€ä¹‹é“ï¼šä»â€œæœ€å°çŠ¶æ€â€åˆ°â€œçŠ¶æ€æ ‘â€"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-24T00:50:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SwiftUI çŠ¶æ€ç®¡ç†æç®€ä¹‹é“ï¼šä»â€œæœ€å°çŠ¶æ€â€åˆ°â€œçŠ¶æ€æ ‘â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T00:50:06.000Z" title="Mon Nov 24 2025 00:50:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸ºä»€ä¹ˆâ€œçŠ¶æ€â€æ˜¯ SwiftUI çš„ç‰›é¡¿ç¬¬ä¸‰å®šå¾‹ï¼Ÿ</h2>
<p>åœ¨ç‰©ç†å­¦é‡Œï¼ŒåŠ›ä¸åä½œç”¨åŠ›æˆå¯¹å‡ºç°ï¼›åœ¨ SwiftUI é‡Œï¼ŒçŠ¶æ€å˜åŒ–ä¸UI ååº”ä¹Ÿæˆå¯¹å‡ºç°ã€‚</p>
<p>ç”¨æˆ·æ¯ä¸€æ¬¡ç‚¹å‡»ã€æ¯ä¸€æ¬¡ç½‘ç»œè¿”å›ï¼Œéƒ½ç›¸å½“äºç»™ç³»ç»Ÿæ–½åŠ äº†ä¸€ä¸ªâ€œåŠ›â€ï¼Œè€Œ UI å¿…é¡»ä»¥æŸç§â€œåä½œç”¨åŠ›â€åšå‡ºå“åº”ã€‚</p>
<p>å› æ­¤ï¼ŒçŠ¶æ€ç®¡ç†ä¸æ˜¯å¯é€‰æŠ€èƒ½ï¼Œè€Œæ˜¯ SwiftUI ä¸–ç•Œçš„ä¸‡æœ‰å¼•åŠ›ã€‚</p>
<h2 data-id="heading-1">æœ€å°çŠ¶æ€åŸåˆ™ï¼ˆMinimal Stateï¼‰</h2>
<p>å…ˆè®°ä½ä¸€å¥â€œå’’è¯­â€ï¼š â€œ<strong>èƒ½è®© UI æ­£ç¡®ä¸”åŠæ—¶å“åº”çš„æœ€å°‘çŠ¶æ€åˆ°åº•æ˜¯å“ªäº›ï¼Ÿ</strong>â€</p>
<p>å‡¡æ˜¯ä¸åœ¨è¿™ä»½æ¸…å•é‡Œçš„æ•°æ®ï¼Œä¸€å¾‹ï¼š</p>
<ul>
<li>è®¡ç®—å¾—å‡º â†’ ç”¨ computed property</li>
<li>å¯æ¨å¯¼ â†’ ä¸ç”¨ @State</li>
<li>ä¸´æ—¶å­˜æ´» â†’ ç”¨ let æˆ–å±€éƒ¨å˜é‡</li>
</ul>
<p>è¿™æ ·åšçš„å¥½å¤„ï¼š</p>
<ol>
<li>å‡å°‘æ— æ•ˆåˆ·æ–°ï¼Œæå‡æ€§èƒ½</li>
<li>é™ä½å¿ƒæ™ºè´Ÿæ‹…ï¼Œä»£ç æ›´æ˜“è¯»</li>
<li>ä¸ºåç»­æ‹†åˆ†æ¨¡å—ã€å¤ç”¨ç»„ä»¶æ‰«æ¸…éšœç¢</li>
</ol>
<h2 data-id="heading-2">çŠ¶æ€è½½å…·é€ŸæŸ¥è¡¨</h2>















































<table><thead><tr><th>å±æ€§åŒ…è£…å™¨</th><th>ä½œç”¨åŸŸ</th><th>å…¸å‹ç”¨é€”</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td><code>@State</code></td><td>å½“å‰ View ç§æœ‰</td><td>å±€éƒ¨ UI å°æ•°æ®ï¼ˆå¦‚ Stringã€Boolã€Intï¼‰</td><td>å€¼ç±»å‹</td></tr><tr><td><code>@Binding</code></td><td>çˆ¶å­å…±äº«</td><td>å°†â€œå¼•ç”¨â€ä¼ ç»™å­ Viewï¼Œä½¿å…¶èƒ½ä¿®æ”¹çˆ¶æ•°æ®</td><td>ä¸æ‹¥æœ‰æ•°æ®</td></tr><tr><td><code>@StateObject</code></td><td>å½“å‰ View ç§æœ‰</td><td>åˆ›å»ºå¹¶æŒæœ‰å¼•ç”¨ç±»å‹ï¼ˆå¦‚ ObservableObjectï¼‰</td><td>ç”Ÿå‘½å‘¨æœŸä¸ View ä¸€è‡´</td></tr><tr><td><code>@ObservedObject</code></td><td>ä»»æ„ View</td><td>å¤–éƒ¨ä¼ å…¥çš„ ObservableObject</td><td>ä¸åˆ›å»ºï¼Œåªå¼•ç”¨</td></tr><tr><td><code>@Environment</code></td><td>å…¨å±€</td><td>ç³»ç»Ÿçº§å€¼ï¼ˆå¦‚ colorSchemeã€locale ç­‰ï¼‰</td><td>é€šè¿‡ key è¯»å–</td></tr><tr><td><code>@EnvironmentObject</code></td><td>å…¨å±€</td><td>è‡ªå®šä¹‰å…±äº«å¯¹è±¡</td><td>éœ€æå‰æ³¨å…¥</td></tr></tbody></table>
<blockquote>
<p>æœ¬æ–‡ä¸è®¨è®º MVVM / MVC / TCA ç­‰æ¶æ„ï¼Œåªèšç„¦â€œçŠ¶æ€æœ¬èº«å¦‚ä½•å­˜åœ¨ã€å¦‚ä½•æµåŠ¨â€ã€‚</p>
</blockquote>
<h2 data-id="heading-3">ä» 0 åˆ° 1ï¼šçŠ¶æ€æ˜¯å¦‚ä½•â€œè¢«å£°æ˜â€çš„ï¼Ÿ</h2>
<h3 data-id="heading-4">é™æ€å•çŠ¶æ€ â€”â€” å®‡å®™å¥‡ç‚¹</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"globe"</span>)
                .imageScale(.large)
                .foregroundStyle(.tint)
            <span class="hljs-type">Text</span>(<span class="hljs-string">"Hello, world!"</span>)
        }
        .padding()
    }
}
</code></pre>
<p>æ³¨é‡Šï¼šæ²¡æœ‰ @Stateï¼ŒUI æ°¸è¿œä¸å˜ï¼Œå®‡å®™ä¸€ç‰‡æ­»å¯‚ã€‚</p>
<h3 data-id="heading-5">å¼•å…¥ç¬¬ä¸€ä¸ª @State â€”â€” å®‡å®™å¤§çˆ†ç‚¸</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> statefulText: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Stateful Text"</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"globe"</span>)
                .imageScale(.large)
                .foregroundStyle(.tint)
            <span class="hljs-type">Text</span>(statefulText)          <span class="hljs-comment">// ä¾èµ–çŠ¶æ€</span>
        }
        .padding()
    }
}
</code></pre>
<p>æ³¨é‡Šï¼šç°åœ¨ UI å¯ä»¥éš <code>statefulText</code> å˜åŒ–è€Œåˆ·æ–°ï¼Œä½†ç”¨æˆ·è¿˜æ²¡æ³•å¹²é¢„ã€‚</p>
<h3 data-id="heading-6">è®©ç”¨æˆ·å½“â€œä¸Šå¸â€â€”â€” å¼•å…¥äº¤äº’</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> statefulText: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Stateful Text"</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Button</span> {
                statefulText <span class="hljs-operator">=</span> <span class="hljs-string">"Ouch!"</span>  <span class="hljs-comment">// ç”¨æˆ·æ–½åŠ â€œåŠ›â€</span>
            } label: {
                <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">"globe"</span>)
                    .imageScale(.large)
                    .foregroundStyle(.tint)
            }
            <span class="hljs-type">Text</span>(statefulText)          <span class="hljs-comment">// è‡ªåŠ¨ååº”</span>
        }
        .padding()
    }
}
</code></pre>
<p>æ³¨é‡Šï¼šçŠ¶æ€å˜åŒ– â‡„ UI ååº” çš„ç¯è·¯é—­åˆï¼Œå®‡å®™å¼€å§‹æ¼”åŒ–ã€‚</p>
<h3 data-id="heading-7">å¤šçŠ¶æ€å®‡å®™ï¼šæšä¸¾æ‰›èµ·å¤§æ——</h3>
<p>æŠŠâ€œåŠ è½½ä¸­/åŠ è½½æˆåŠŸ/é”™è¯¯/å“²å­¦ç”Ÿå‘½å‘¨æœŸâ€æŠ½è±¡æˆæšä¸¾ï¼Œä¸€æ¬¡æ€§æŠŠçŠ¶æ€æœºæ¬è¿› UIï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 1. å®šä¹‰çŠ¶æ€æœº</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">ViewState</span> {
    <span class="hljs-keyword">case</span> loading
    <span class="hljs-keyword">case</span> loaded
    <span class="hljs-keyword">case</span> error
    <span class="hljs-keyword">case</span> whoami
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-comment">// 2. æœ€å°çŠ¶æ€ï¼šå½“å‰å¤„äºå“ªä¸€æ­¥</span>
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentState: <span class="hljs-type">ViewState</span> <span class="hljs-operator">=</span> .loading
    <span class="hljs-comment">// 3. ä»… loaded æ‰å…³å¿ƒçš„æ–‡å­—</span>
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> statefulText: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">"We did it!"</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Group</span> {
            <span class="hljs-keyword">switch</span> currentState {
            <span class="hljs-keyword">case</span> .loading:
                <span class="hljs-type">ContentUnavailableView</span>(<span class="hljs-string">"One moment please..."</span>,
                                       systemImage: <span class="hljs-string">"hourglass"</span>)
            <span class="hljs-keyword">case</span> .loaded:
                loadedUI
            <span class="hljs-keyword">case</span> .error:
                <span class="hljs-type">ContentUnavailableView</span>(<span class="hljs-string">"Oops!"</span>,
                                       systemImage: <span class="hljs-string">"x.circle"</span>)
            <span class="hljs-keyword">case</span> .whoami:
                <span class="hljs-type">Text</span>(<span class="hljs-string">"Existential Crisis!"</span>)
            }
        }
        .task {
            <span class="hljs-comment">// 4. æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚</span>
            <span class="hljs-keyword">do</span> {
                <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(nanoseconds: <span class="hljs-number">2_000_000_000</span>)
                currentState <span class="hljs-operator">=</span> .loaded
            } <span class="hljs-keyword">catch</span> {
                currentState <span class="hljs-operator">=</span> .error
            }
        }
    }
    
    <span class="hljs-comment">// æŠŠ loaded çŠ¶æ€ UI æ‹†æˆ computed propertyï¼Œå¯è¯»æ€§æ›´å¥½</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> loadedUI: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"ç‚¹æˆ‘æ”¹æ–‡å­—"</span>) {
                statefulText <span class="hljs-operator">=</span> <span class="hljs-string">"Ouch!"</span>
            }
            <span class="hljs-type">Button</span>(<span class="hljs-string">"è¿›å…¥å“²å­¦æ¨¡å¼"</span>) {
                currentState <span class="hljs-operator">=</span> .whoami
            }
            <span class="hljs-type">Text</span>(statefulText)
        }
        .padding()
    }
}
</code></pre>
<p>æ³¨é‡Šï¼š</p>
<ul>
<li>ç”¨ <code>switch</code> åšç©·å°½å¼åŒ¹é…ï¼Œç¼–è¯‘å™¨å¸®ä½ æ£€æŸ¥æ¼æ‰çš„çŠ¶æ€</li>
<li><code>.task</code> ä¿®é¥°ç¬¦åœ¨è§†å›¾å‡ºç°æ—¶è‡ªåŠ¨æ‰§è¡Œï¼Œç¦»å¼€å³å–æ¶ˆï¼Œæ¯” <code>onAppear</code> æ›´å®‰å…¨</li>
</ul>
<h2 data-id="heading-8">çŠ¶æ€æ ‘ï¼šåƒå…¬å¸ä¸€æ ·åˆ†éƒ¨é—¨æ²»ç†</h2>
<p>å½“çˆ¶ View æ—¢è¦ç®¡â€œåŠ è½½æšä¸¾â€åˆè¦ç®¡â€œæ–‡å­—ç»†èŠ‚â€æ—¶ï¼Œè´£ä»»è¿‡é‡ã€‚</p>
<p>æŠŠåªè·Ÿ loaded ç›¸å…³çš„çŠ¶æ€ä¸‹æ”¾ç»™å­ Viewï¼Œçˆ¶çº§åªä¿ç•™â€œå¯¼èˆªçº§â€çŠ¶æ€ï¼Œå½¢æˆçŠ¶æ€æ ‘ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentState: <span class="hljs-type">ViewState</span> <span class="hljs-operator">=</span> .loading
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Group</span> {
            <span class="hljs-keyword">switch</span> currentState {
            <span class="hljs-keyword">case</span> .loading:
                <span class="hljs-type">ContentUnavailableView</span>(<span class="hljs-string">"One moment please..."</span>,
                                       systemImage: <span class="hljs-string">"hourglass"</span>)
            <span class="hljs-keyword">case</span> .loaded:
                <span class="hljs-type">LoadedView</span>(currentState: <span class="hljs-variable">$currentState</span>) <span class="hljs-comment">// åªä¼ ç»‘å®š</span>
            <span class="hljs-keyword">case</span> .error:
                <span class="hljs-type">ContentUnavailableView</span>(<span class="hljs-string">"Oops!"</span>,
                                       systemImage: <span class="hljs-string">"x.circle"</span>)
            <span class="hljs-keyword">case</span> .whoami:
                <span class="hljs-type">Text</span>(<span class="hljs-string">"Existential Crisis!"</span>)
            }
        }
        .task {
            <span class="hljs-keyword">do</span> {
                <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">Task</span>.sleep(nanoseconds: <span class="hljs-number">2_000_000_000</span>)
                currentState <span class="hljs-operator">=</span> .loaded
            } <span class="hljs-keyword">catch</span> {
                currentState <span class="hljs-operator">=</span> .error
            }
        }
    }
}

<span class="hljs-comment">// å­ Viewï¼šåªå…³å¿ƒ loaded ä¸–ç•Œ</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">LoadedView</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@Binding</span> <span class="hljs-keyword">var</span> currentState: <span class="hljs-type">ViewState</span> <span class="hljs-comment">// éœ€è¦å›è·³çˆ¶çº§ï¼Œç”¨ Binding</span>
    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> statefulText: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">"We did it!"</span> <span class="hljs-comment">// å±€éƒ¨çŠ¶æ€</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span>(spacing: <span class="hljs-number">20</span>) {
            <span class="hljs-type">Button</span>(<span class="hljs-string">"æ”¹æ–‡å­—"</span>) {
                statefulText <span class="hljs-operator">=</span> <span class="hljs-string">"Ouch!"</span>
            }
            <span class="hljs-type">Button</span>(<span class="hljs-string">"å“²å­¦æ¨¡å¼"</span>) {
                currentState <span class="hljs-operator">=</span> .whoami
            }
            <span class="hljs-type">Text</span>(statefulText)
                .font(.title)
        }
        .padding()
    }
}
</code></pre>
<p>æ³¨é‡Šï¼š</p>
<ul>
<li>çˆ¶ View ä»£ç é‡ç¬é—´å‡åŠï¼ŒèŒè´£å•ä¸€</li>
<li>å­ View å¯ç‹¬ç«‹é¢„è§ˆã€ç‹¬ç«‹æµ‹è¯•ï¼Œç”šè‡³ä¸€é”®æŠ½æˆ Swift Packageç»™åˆ«çš„é¡¹ç›®ç”¨</li>
</ul>
<h2 data-id="heading-9">é€’å½’åœ°è¿½é—®â€œæœ€å°çŠ¶æ€â€</h2>
<p>çŠ¶æ€æ ‘ä¸æ˜¯ä¸€å±‚å°±å¤Ÿã€‚å¦‚æœ <code>LoadedView</code> é‡Œå†å‡ºç°å­æ¨¡å—ï¼ˆæ¯”å¦‚ç‚¹èµæ•°ã€è¯„è®ºåˆ—è¡¨ï¼‰ï¼Œç»§ç»­é—®è‡ªå·±ï¼š</p>
<ol>
<li>è¿™äº›å­æ¨¡å—æ˜¯å¦å¿…é¡»ç”±çˆ¶çº§é©±åŠ¨ï¼Ÿ</li>
<li>èƒ½å¦æŠŠâ€œç‚¹èµæ•°â€åšæˆ <code>@StateObject</code> çš„ <code>LikesService</code>ï¼Œé€šè¿‡ <code>@EnvironmentObject</code> æ³¨å…¥ï¼Ÿ</li>
<li>èƒ½å¦æŠŠâ€œè¯„è®ºåˆ—è¡¨â€åšæˆçº¯ç²¹ <code>@State</code> çš„å±€éƒ¨æ•°ç»„ï¼Œåªåœ¨è¿›å…¥è¯„è®ºåŒºæ‰åˆå§‹åŒ–ï¼Ÿ</li>
</ol>
<p>æ¯ä¸€å±‚éƒ½å›ç­”ä¸€æ¬¡â€œæœ€å°çŠ¶æ€â€é—®é¢˜ï¼Œå¤æ‚åº¦å°±è¢«é€’å½’åœ°å‹æ‰ã€‚</p>
<h2 data-id="heading-10">å®æˆ˜æ‰©å±•ï¼šæŠŠçŠ¶æ€æ ‘åšæˆâ€œå¯æ’æ‹”â€æ¨¡å—</h2>
<p>å‡è®¾æœªæ¥è¦åŠ â€œå¤œé—´æ¨¡å¼â€å…¨å±€å¼€å…³ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">@main</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">MyApp</span>: <span class="hljs-title class_">App</span> {
    <span class="hljs-meta">@StateObject</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> theme <span class="hljs-operator">=</span> <span class="hljs-type">ThemeService</span>() <span class="hljs-comment">// éµå¾ª ObservableObject</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">Scene</span> {
        <span class="hljs-type">WindowGroup</span> {
            <span class="hljs-type">ContentView</span>()
                .environmentObject(theme) <span class="hljs-comment">// ä¸€æ¬¡æ€§æ³¨å…¥</span>
        }
    }
}
</code></pre>
<p>ä»»æ„æ·±å±‚å­ View åªéœ€ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DeepChild</span>: <span class="hljs-title class_">View</span> {
    <span class="hljs-meta">@EnvironmentObject</span> <span class="hljs-keyword">var</span> theme: <span class="hljs-type">ThemeService</span>
    
    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {
        <span class="hljs-type">Text</span>(<span class="hljs-string">"æ·±å¤œæ¨¡å¼è‡ªåŠ¨å“åº”"</span>)
            .foregroundColor(theme.labelColor)
    }
}
</code></pre>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li>å…¨å±€çŠ¶æ€ç»ä¸æ”¾åœ¨æ ¹ View çš„ <code>@State</code>ï¼Œè€Œæ˜¯ <code>@StateObject</code> + <code>@EnvironmentObject</code></li>
<li>ä¸šåŠ¡å±‚ç»§ç»­éµå¾ªâ€œæœ€å°çŠ¶æ€â€ï¼Œä¸ä¾èµ–å…¨å±€ä¸»é¢˜å³å¯ç‹¬ç«‹è¿è¡Œ</li>
</ul>
<h2 data-id="heading-11">æ€»ç»“ä¸ Checklist</h2>
<ol>
<li>å…ˆå†™â€œæ­»â€çš„ UIï¼Œå†æ…¢æ…¢å£°æ˜çŠ¶æ€ï¼Œè€Œä¸æ˜¯ä¸€ä¸Šæ¥å°± <code>@State</code> æ»¡å¤©é£ã€‚</li>
<li>æ¯ä¸€æ¬¡åŠ çŠ¶æ€å‰ï¼ŒèƒŒä¸€éå’’è¯­ï¼šâ€œè¿™æ˜¯è®© UI æ­£ç¡®ä¸”åŠæ—¶å“åº”çš„æœ€å°é›†åˆå—ï¼Ÿâ€</li>
<li>å½“çŠ¶æ€è¶…è¿‡ 3 ä¸ªä¸”äº’ç›¸è€¦åˆï¼Œç«‹åˆ»ç”»çŠ¶æ€æ ‘ï¼š
<ul>
<li>è°èƒ½ç‹¬ç«‹ï¼Ÿâ†’ æ‹†å­ View</li>
<li>è°éœ€å…±äº«ï¼Ÿâ†’ æ‹† ObservableObject</li>
<li>è°åªè¯»ï¼Ÿâ†’ ç”¨ Environment</li>
</ul>
</li>
<li>æŠŠâ€œæšä¸¾ + switchâ€å½“æˆçŠ¶æ€æœºè¯­æ³•ç³–ï¼Œç©·å°½æ‰€æœ‰ caseï¼Œè®©ç¼–è¯‘å™¨å½“ä½  QAã€‚</li>
</ol>
<h2 data-id="heading-12">å­¦ä¹ æ–‡ç« </h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcaptainswiftui.substack.com%2Fp%2Fswiftui-craftsmanship-state-management" target="_blank" title="https://captainswiftui.substack.com/p/swiftui-craftsmanship-state-management" ref="nofollow noopener noreferrer">captainswiftui.substack.com/p/swiftui-câ€¦</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HTMLçš„Videoä»åŸºç¡€ä½¿ç”¨åˆ°é«˜çº§å®æˆ˜+å…¼å®¹çš„å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7575468252657303593</link>    <guid>https://juejin.cn/post/7575468252657303593</guid>    <pubDate>2025-11-24T00:59:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575468252657303593" data-draft-id="7569898158836432937" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HTMLçš„Videoä»åŸºç¡€ä½¿ç”¨åˆ°é«˜çº§å®æˆ˜+å…¼å®¹çš„å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-24T00:59:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹å¤šå¤š"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HTMLçš„Videoä»åŸºç¡€ä½¿ç”¨åˆ°é«˜çº§å®æˆ˜+å…¼å®¹çš„å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹å¤šå¤š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T00:59:50.000Z" title="Mon Nov 24 2025 00:59:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"â€¢";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>HTML5 çš„ <code>&lt;video&gt;</code> æ ‡ç­¾å½»åº•æ”¹å˜äº†ç½‘é¡µè§†é¢‘æ’­æ”¾çš„å®ç°æ–¹å¼â€”â€”æ— éœ€ä¾èµ– Flash ç­‰ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ŒåŸç”Ÿæ”¯æŒè·¨å¹³å°è§†é¢‘æ’­æ”¾ï¼Œå…¼å…·è½»é‡æ€§ä¸æ‰©å±•æ€§ã€‚æœ¬æ–‡å°†ä»æ ‡ç­¾åŸºç¡€ã€API è¯¦è§£ã€äº‹ä»¶ä½“ç³»ã€æ ·å¼æ§åˆ¶ã€å…¼å®¹æ€§å¤„ç†ç­‰ç»´åº¦ï¼Œå…¨é¢è§£æ <code>&lt;video&gt;</code> æ ‡ç­¾çš„æŠ€æœ¯ç»†èŠ‚ä¸å®æˆ˜æŠ€å·§ã€‚</p>
<h2 data-id="heading-0">1. æ ¸å¿ƒç”¨æ³•ä¸å±æ€§</h2>
<p>ä¸‹é¢æ˜¯æ ‡ç­¾çš„æ ¸å¿ƒç”¨æ³•ä¸å±æ€§ï¼š</p>
<h3 data-id="heading-1">1.1. åŸºæœ¬è¯­æ³•ç»“æ„</h3>
<p><code>&lt;video&gt;</code> æ ‡ç­¾çš„æ ¸å¿ƒä½œç”¨æ˜¯åµŒå…¥è§†é¢‘èµ„æºï¼Œæœ€ç®€ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- åŸºç¡€ç”¨æ³•ï¼šæŒ‡å®šè§†é¢‘æºä¸åŸºç¡€æ§åˆ¶ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">controls</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"640"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"360"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- é™çº§æç¤ºï¼šæµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾æ—¶æ˜¾ç¤º --&gt;</span>
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ HTML5 è§†é¢‘æ’­æ”¾ï¼Œè¯·å‡çº§æµè§ˆå™¨æˆ–æ›´æ¢è§‚çœ‹æ–¹å¼ã€‚
<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">1.2. æ ¸å¿ƒå±æ€§è¯¦è§£</h3>




























































<table><thead><tr><th>å±æ€§å</th><th>å–å€¼</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>src</code></td><td>è§†é¢‘æ–‡ä»¶ URL</td><td>æŒ‡å®šå•ä¸ªè§†é¢‘æºï¼ˆä¼˜å…ˆæ¨èä½¿ç”¨ <code>&lt;source&gt;</code> æ ‡ç­¾é€‚é…å¤šæ ¼å¼ï¼‰</td></tr><tr><td><code>controls</code></td><td>å¸ƒå°”å€¼ï¼ˆçœç•¥åˆ™ç”Ÿæ•ˆï¼‰</td><td>æ˜¾ç¤ºæµè§ˆå™¨åŸç”Ÿæ§åˆ¶æ ï¼ˆæ’­æ”¾/æš‚åœã€éŸ³é‡ã€è¿›åº¦æ¡ç­‰ï¼‰</td></tr><tr><td><code>autoplay</code></td><td>å¸ƒå°”å€¼</td><td>é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ’­æ”¾ï¼ˆæ³¨æ„ï¼šå¤šæ•°æµè§ˆå™¨è¦æ±‚é™éŸ³æ‰èƒ½è‡ªåŠ¨æ’­æ”¾ï¼‰</td></tr><tr><td><code>muted</code></td><td>å¸ƒå°”å€¼</td><td>è§†é¢‘é»˜è®¤é™éŸ³</td></tr><tr><td><code>loop</code></td><td>å¸ƒå°”å€¼</td><td>è§†é¢‘æ’­æ”¾å®Œæ¯•åè‡ªåŠ¨å¾ªç¯</td></tr><tr><td><code>preload</code></td><td><code>auto</code>/<code>metadata</code>/<code>none</code></td><td>é¢„åŠ è½½ç­–ç•¥ï¼š<br/>- <code>auto</code>ï¼šè‡ªåŠ¨é¢„åŠ è½½æ•´ä¸ªè§†é¢‘ï¼ˆé»˜è®¤ï¼‰<br/>- <code>metadata</code>ï¼šä»…é¢„åŠ è½½å…ƒæ•°æ®ï¼ˆæ—¶é•¿ã€å°ºå¯¸ç­‰ï¼‰<br/>- <code>none</code>ï¼šä¸é¢„åŠ è½½ä»»ä½•å†…å®¹</td></tr><tr><td><code>poster</code></td><td>å›¾ç‰‡ URL</td><td>è§†é¢‘åŠ è½½å®Œæˆå‰/æœªæ’­æ”¾æ—¶æ˜¾ç¤ºçš„å°é¢å›¾</td></tr><tr><td><code>width</code>/<code>height</code></td><td>åƒç´ å€¼ï¼ˆå¦‚ <code>640</code>ï¼‰</td><td>è§†é¢‘æ’­æ”¾å™¨çš„å®½é«˜ï¼ˆå»ºè®®é€šè¿‡ CSS æ§åˆ¶ï¼Œæ›´çµæ´»ï¼‰</td></tr><tr><td><code>playsinline</code></td><td>å¸ƒå°”å€¼</td><td>å…è®¸è§†é¢‘åœ¨é¡µé¢å†…æ’­æ”¾ï¼ˆè€Œéå…¨å±ï¼Œç§»åŠ¨ç«¯å¿…å¤‡ï¼‰</td></tr><tr><td><code>webkit-playsinline</code></td><td>å¸ƒå°”å€¼</td><td>iOS Safari å…¼å®¹å±æ€§ï¼ˆä¸ <code>playsinline</code> é…åˆä½¿ç”¨ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-3">1.3. å¤šæ ¼å¼é€‚é…ï¼š æ ‡ç­¾</h3>
<p>ä¸åŒæµè§ˆå™¨å¯¹è§†é¢‘æ ¼å¼æ”¯æŒå­˜åœ¨å·®å¼‚ï¼ˆå¦‚ MP4 å…¼å®¹æ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ŒWebM ä½“ç§¯æ›´å°ä½†å…¼å®¹æ€§è¾ƒå·®ï¼‰ï¼Œéœ€é€šè¿‡ <code>&lt;source&gt;</code> æ ‡ç­¾æä¾›å¤šæ ¼å¼å¤‡é€‰ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">controls</span> <span class="hljs-attr">poster</span>=<span class="hljs-string">"cover.jpg"</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">webkit-playsinline</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- æµè§ˆå™¨ä¼šæŒ‰é¡ºåºé€‰æ‹©æ”¯æŒçš„æ ¼å¼ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/mp4"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.webm"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/webm"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.ogg"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/ogg"</span>&gt;</span>
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ HTML5 è§†é¢‘æ’­æ”¾ï¼Œè¯·å‡çº§æµè§ˆå™¨ã€‚
<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
</code></pre>
<p><strong>æ¨èæ ¼å¼ç»„åˆ</strong>ï¼šMP4ï¼ˆä¸»æ ¼å¼ï¼‰+ WebMï¼ˆå¤‡é€‰ï¼‰ï¼Œè¦†ç›– 99% ä»¥ä¸Šç°ä»£æµè§ˆå™¨ã€‚</p>
<h2 data-id="heading-4">2. æ ¸å¿ƒ APIï¼šé€šè¿‡JavaScriptæ§åˆ¶</h2>
<p><code>&lt;video&gt;</code> å…ƒç´ æš´éœ²äº†ä¸°å¯Œçš„ JavaScript APIï¼Œå¯å®ç°è‡ªå®šä¹‰æ’­æ”¾é€»è¾‘ã€çŠ¶æ€æŸ¥è¯¢ç­‰åŠŸèƒ½ã€‚è·å–è§†é¢‘å…ƒç´ åå³å¯è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'video'</span>); <span class="hljs-comment">// è·å–è§†é¢‘å…ƒç´ </span>
</code></pre>
<h3 data-id="heading-5">2.1. æ ¸å¿ƒæ–¹æ³•</h3>





























<table><thead><tr><th>æ–¹æ³•å</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>play()</code></td><td>å¼€å§‹æ’­æ”¾è§†é¢‘ï¼Œè¿”å› Promiseï¼ˆéœ€å¤„ç†æ’­æ”¾å¤±è´¥åœºæ™¯ï¼‰</td></tr><tr><td><code>pause()</code></td><td>æš‚åœæ’­æ”¾è§†é¢‘</td></tr><tr><td><code>load()</code></td><td>é‡æ–°åŠ è½½è§†é¢‘èµ„æºï¼ˆå¸¸ç”¨äºåˆ‡æ¢è§†é¢‘æºåï¼‰</td></tr><tr><td><code>canPlayType(type)</code></td><td>æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒæŒ‡å®šè§†é¢‘æ ¼å¼ï¼ˆè¿”å› <code>probably</code>/<code>maybe</code>/<code>""</code>ï¼‰</td></tr><tr><td><code>requestFullscreen()</code></td><td>è¿›å…¥å…¨å±æ¨¡å¼ï¼ˆéœ€å…¼å®¹å‰ç¼€ï¼š<code>webkitRequestFullscreen</code> ç­‰ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-6">2.2. å…³é”®å±æ€§ï¼ˆå¯è¯»å†™/åªè¯»ï¼‰</h3>
<h4 data-id="heading-7">ï¼ˆ1ï¼‰å¯è¯»å†™å±æ€§ï¼ˆæ§åˆ¶è§†é¢‘è¡Œä¸ºï¼‰</h4>



































<table><thead><tr><th>å±æ€§å</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>currentTime</code></td><td>Number</td><td>å½“å‰æ’­æ”¾ä½ç½®ï¼ˆç§’ï¼‰ï¼Œå¯è®¾ç½®è·³è½¬</td></tr><tr><td><code>volume</code></td><td>Number</td><td>éŸ³é‡ï¼ˆ0~1ï¼Œ0 ä¸ºé™éŸ³ï¼Œ1 ä¸ºæœ€å¤§éŸ³é‡ï¼‰</td></tr><tr><td><code>playbackRate</code></td><td>Number</td><td>æ’­æ”¾é€Ÿç‡ï¼ˆ1 ä¸ºæ­£å¸¸ï¼Œ0.5 ä¸ºæ…¢æ”¾ï¼Œ2 ä¸ºå¿«æ”¾ï¼‰</td></tr><tr><td><code>muted</code></td><td>Boolean</td><td>è®¾ç½®æ˜¯å¦é™éŸ³ï¼ˆä¸æ ‡ç­¾å±æ€§ä¸€è‡´ï¼‰</td></tr><tr><td><code>loop</code></td><td>Boolean</td><td>è®¾ç½®æ˜¯å¦å¾ªç¯ï¼ˆä¸æ ‡ç­¾å±æ€§ä¸€è‡´ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-8">ï¼ˆ2ï¼‰åªè¯»å±æ€§ï¼ˆè·å–è§†é¢‘çŠ¶æ€ï¼‰</h4>








































<table><thead><tr><th>å±æ€§å</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>duration</code></td><td>Number</td><td>è§†é¢‘æ€»æ—¶é•¿ï¼ˆç§’ï¼‰ï¼ŒæœªåŠ è½½å®Œæˆæ—¶ä¸º NaN</td></tr><tr><td><code>paused</code></td><td>Boolean</td><td>æ˜¯å¦å¤„äºæš‚åœçŠ¶æ€ï¼ˆtrue ä¸ºæš‚åœï¼‰</td></tr><tr><td><code>playing</code></td><td>Boolean</td><td>æ˜¯å¦æ­£åœ¨æ’­æ”¾ï¼ˆH5 æ–°å¢ï¼Œéœ€å…¼å®¹ï¼‰</td></tr><tr><td><code>buffered</code></td><td>TimeRanges</td><td>å·²ç¼“å†²çš„æ—¶é—´èŒƒå›´ï¼ˆé€šè¿‡ <code>buffered.start(0)</code>/<code>buffered.end(0)</code> è·å–ï¼‰</td></tr><tr><td><code>readyState</code></td><td>Number</td><td>è§†é¢‘å°±ç»ªçŠ¶æ€ï¼š<br/>0 = æœªå°±ç»ª<br/>1 = å…ƒæ•°æ®å°±ç»ª<br/>2 = å½“å‰å¸§å°±ç»ª<br/>3 = å¯æ’­æ”¾ï¼ˆå·²ç¼“å†²éƒ¨åˆ†å†…å®¹ï¼‰<br/>4 = å®Œå…¨å°±ç»ª</td></tr><tr><td><code>networkState</code></td><td>Number</td><td>ç½‘ç»œçŠ¶æ€ï¼š<br/>0 = æœªåˆå§‹åŒ–<br/>1 = æ­£åœ¨åŠ è½½<br/>2 = åŠ è½½å®Œæˆ<br/>3 = åŠ è½½å¤±è´¥</td></tr></tbody></table>
<h3 data-id="heading-9">2.3. API å®æˆ˜ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'video'</span>);

<span class="hljs-comment">// 1. æ’­æ”¾/æš‚åœåˆ‡æ¢</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'playBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (video.<span class="hljs-property">paused</span>) {
    <span class="hljs-comment">// å¤„ç†è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼ˆéœ€é™éŸ³æˆ–ç”¨æˆ·äº¤äº’åï¼‰</span>
    video.<span class="hljs-title function_">play</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ’­æ”¾å¤±è´¥ï¼š'</span>, err);
      video.<span class="hljs-property">muted</span> = <span class="hljs-literal">true</span>;
      video.<span class="hljs-title function_">play</span>(); <span class="hljs-comment">// é™éŸ³åé‡è¯•è‡ªåŠ¨æ’­æ”¾</span>
    });
  } <span class="hljs-keyword">else</span> {
    video.<span class="hljs-title function_">pause</span>();
  }
});

<span class="hljs-comment">// 2. è·³è½¬è‡³æŒ‡å®šæ—¶é—´ï¼ˆå¦‚ 30 ç§’ï¼‰</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'jumpBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  video.<span class="hljs-property">currentTime</span> = <span class="hljs-number">30</span>;
});

<span class="hljs-comment">// 3. è°ƒæ•´éŸ³é‡ï¼ˆ50%ï¼‰</span>
video.<span class="hljs-property">volume</span> = <span class="hljs-number">0.5</span>;

<span class="hljs-comment">// 4. å¿«æ”¾ï¼ˆ1.5 å€é€Ÿï¼‰</span>
video.<span class="hljs-property">playbackRate</span> = <span class="hljs-number">1.5</span>;

<span class="hljs-comment">// 5. æ£€æµ‹æ ¼å¼æ”¯æŒ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MP4 æ”¯æŒï¼š'</span>, video.<span class="hljs-title function_">canPlayType</span>(<span class="hljs-string">'video/mp4'</span>) !== <span class="hljs-string">''</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WebM æ”¯æŒï¼š'</span>, video.<span class="hljs-title function_">canPlayType</span>(<span class="hljs-string">'video/webm'</span>) !== <span class="hljs-string">''</span>);
</code></pre>
<h2 data-id="heading-10">3. ç›‘å¬è§†é¢‘ç”Ÿå‘½å‘¨æœŸä¸çŠ¶æ€å˜åŒ–äº‹ä»¶</h2>
<p><code>&lt;video&gt;</code> æ ‡ç­¾æä¾›äº†å®Œæ•´çš„äº‹ä»¶æœºåˆ¶ï¼Œå¯ç›‘å¬æ’­æ”¾çŠ¶æ€ã€åŠ è½½è¿›åº¦ã€é”™è¯¯ç­‰åœºæ™¯ï¼Œæ˜¯å®ç°è‡ªå®šä¹‰æ§åˆ¶é€»è¾‘çš„æ ¸å¿ƒã€‚</p>
<h3 data-id="heading-11">3.1. æ ¸å¿ƒäº‹ä»¶åˆ†ç±»ä¸è¯´æ˜</h3>






































































<table><thead><tr><th>äº‹ä»¶å</th><th>è§¦å‘æ—¶æœº</th><th>åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>loadedmetadata</code></td><td>è§†é¢‘å…ƒæ•°æ®ï¼ˆæ—¶é•¿ã€å°ºå¯¸ç­‰ï¼‰åŠ è½½å®Œæˆ</td><td>è·å–è§†é¢‘æ€»æ—¶é•¿ <code>duration</code></td></tr><tr><td><code>loadeddata</code></td><td>ç¬¬ä¸€å¸§è§†é¢‘åŠ è½½å®Œæˆå¹¶å¯æ˜¾ç¤º</td><td>éšè—åŠ è½½åŠ¨ç”»ã€æ˜¾ç¤ºè§†é¢‘ç”»é¢</td></tr><tr><td><code>canplay</code></td><td>è§†é¢‘å·²ç¼“å†²è¶³å¤Ÿæ•°æ®ï¼Œå¯å¼€å§‹æ’­æ”¾ï¼ˆå¯èƒ½å¡é¡¿ï¼‰</td><td>å¯ç”¨æ’­æ”¾æŒ‰é’®</td></tr><tr><td><code>canplaythrough</code></td><td>è§†é¢‘å·²ç¼“å†²è‡³æœ«å°¾ï¼Œå¯æµç•…æ’­æ”¾</td><td>æç¤ºâ€œå¯æµç•…è§‚çœ‹â€</td></tr><tr><td><code>play</code></td><td>è°ƒç”¨ <code>play()</code> åå¼€å§‹æ’­æ”¾æ—¶</td><td>åˆ‡æ¢æ’­æ”¾æŒ‰é’®çŠ¶æ€ï¼ˆæš‚åœå›¾æ ‡ï¼‰</td></tr><tr><td><code>pause</code></td><td>è°ƒç”¨ <code>pause()</code> æˆ–æ’­æ”¾æš‚åœæ—¶</td><td>åˆ‡æ¢æ’­æ”¾æŒ‰é’®çŠ¶æ€ï¼ˆæ’­æ”¾å›¾æ ‡ï¼‰</td></tr><tr><td><code>timeupdate</code></td><td>æ’­æ”¾ä½ç½® <code>currentTime</code> å˜åŒ–æ—¶ï¼ˆçº¦ 250ms ä¸€æ¬¡ï¼‰</td><td>æ›´æ–°è¿›åº¦æ¡ã€æ˜¾ç¤ºå½“å‰æ’­æ”¾æ—¶é—´</td></tr><tr><td><code>progress</code></td><td>è§†é¢‘ç¼“å†²æ—¶æŒç»­è§¦å‘</td><td>æ›´æ–°ç¼“å†²è¿›åº¦æ¡</td></tr><tr><td><code>ended</code></td><td>è§†é¢‘æ’­æ”¾å®Œæ¯•æ—¶</td><td>æ˜¾ç¤ºâ€œæ’­æ”¾å®Œæˆâ€æç¤ºã€è‡ªåŠ¨é‡æ’­</td></tr><tr><td><code>error</code></td><td>è§†é¢‘åŠ è½½/æ’­æ”¾å¤±è´¥æ—¶</td><td>æ˜¾ç¤ºé”™è¯¯æç¤ºï¼ˆé€šè¿‡ <code>error.code</code> è·å–é”™è¯¯ç±»å‹ï¼‰</td></tr><tr><td><code>volumechange</code></td><td>éŸ³é‡/é™éŸ³çŠ¶æ€å˜åŒ–æ—¶</td><td>æ›´æ–°éŸ³é‡å›¾æ ‡</td></tr><tr><td><code>fullscreenchange</code></td><td>å…¨å±çŠ¶æ€å˜åŒ–æ—¶</td><td>åˆ‡æ¢å…¨å±/é€€å‡ºå…¨å±æŒ‰é’®</td></tr></tbody></table>
<h3 data-id="heading-12">3.2. äº‹ä»¶ç›‘å¬å®æˆ˜ç¤ºä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> video = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'video'</span>);
<span class="hljs-keyword">const</span> progressBar = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.progress-bar'</span>);
<span class="hljs-keyword">const</span> currentTimeText = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.current-time'</span>);
<span class="hljs-keyword">const</span> durationText = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.duration'</span>);

<span class="hljs-comment">// 1. å…ƒæ•°æ®åŠ è½½å®Œæˆï¼šæ˜¾ç¤ºæ€»æ—¶é•¿</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'loadedmetadata'</span>, <span class="hljs-function">() =&gt;</span> {
  durationText.<span class="hljs-property">textContent</span> = <span class="hljs-title function_">formatTime</span>(video.<span class="hljs-property">duration</span>);
});

<span class="hljs-comment">// 2. æ’­æ”¾ä½ç½®æ›´æ–°ï¼šåŒæ­¥è¿›åº¦æ¡</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'timeupdate'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> progress = (video.<span class="hljs-property">currentTime</span> / video.<span class="hljs-property">duration</span>) * <span class="hljs-number">100</span>;
  progressBar.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${progress}</span>%`</span>;
  currentTimeText.<span class="hljs-property">textContent</span> = <span class="hljs-title function_">formatTime</span>(video.<span class="hljs-property">currentTime</span>);
});

<span class="hljs-comment">// 3. ç¼“å†²è¿›åº¦æ›´æ–°ï¼šæ˜¾ç¤ºç¼“å†²æ¡</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'progress'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (video.<span class="hljs-property">buffered</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> bufferedEnd = video.<span class="hljs-property">buffered</span>.<span class="hljs-title function_">end</span>(video.<span class="hljs-property">buffered</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">const</span> bufferedProgress = (bufferedEnd / video.<span class="hljs-property">duration</span>) * <span class="hljs-number">100</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.buffer-bar'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${bufferedProgress}</span>%`</span>;
  }
});

<span class="hljs-comment">// 4. æ’­æ”¾å®Œæˆï¼šæç¤ºå¹¶é‡ç½®</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'ended'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">alert</span>(<span class="hljs-string">'è§†é¢‘æ’­æ”¾å®Œæˆï¼'</span>);
  video.<span class="hljs-property">currentTime</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// é‡ç½®æ’­æ”¾ä½ç½®</span>
});

<span class="hljs-comment">// 5. é”™è¯¯å¤„ç†ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯</span>
video.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">switch</span>(video.<span class="hljs-property">error</span>.<span class="hljs-property">code</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-title function_">alert</span>(<span class="hljs-string">'è§†é¢‘åŠ è½½ä¸­æ–­'</span>); <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-title function_">alert</span>(<span class="hljs-string">'ä¸æ”¯æŒçš„è§†é¢‘æ ¼å¼'</span>); <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-title function_">alert</span>(<span class="hljs-string">'è§†é¢‘è§£ç å¤±è´¥'</span>); <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-title function_">alert</span>(<span class="hljs-string">'è§†é¢‘åŠ è½½è¶…æ—¶'</span>); <span class="hljs-keyword">break</span>;
  }
});

<span class="hljs-comment">// è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¶é—´ï¼ˆç§’ â†’ åˆ†:ç§’ï¼Œå¦‚ 125 â†’ 2:05ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatTime</span>(<span class="hljs-params">seconds</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(seconds)) <span class="hljs-keyword">return</span> <span class="hljs-string">'0:00'</span>;
  <span class="hljs-keyword">const</span> min = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(seconds / <span class="hljs-number">60</span>);
  <span class="hljs-keyword">const</span> sec = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(seconds % <span class="hljs-number">60</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${min}</span>:<span class="hljs-subst">${sec.toString().padStart(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)}</span>`</span>;
}
</code></pre>
<h2 data-id="heading-13">4. è‡ªå®šä¹‰æ’­æ”¾å™¨å¤–è§‚æ ·å¼</h2>
<p>æµè§ˆå™¨åŸç”Ÿæ§åˆ¶æ æ ·å¼éš¾ä»¥é€‚é…ä¸åŒç½‘é¡µè®¾è®¡ï¼Œé€šè¿‡éšè—åŸç”Ÿ <code>controls</code>ï¼Œä½¿ç”¨ CSS è‡ªå®šä¹‰æ’­æ”¾å™¨ç•Œé¢æ˜¯æ›´å¸¸ç”¨çš„æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-14">4.1. åŸºç¡€æ ·å¼æ§åˆ¶</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 1. è§†é¢‘å®¹å™¨æ ·å¼ï¼ˆç»Ÿä¸€å°ºå¯¸ã€è¾¹æ¡†ã€åœ†è§’ï¼‰ */</span>
<span class="hljs-selector-class">.video-container</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1280px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 2. è§†é¢‘å…ƒç´ æ ·å¼ï¼ˆå¡«å……å®¹å™¨ï¼Œé¿å…å˜å½¢ï¼‰ */</span>
<span class="hljs-selector-class">.video-container</span> <span class="hljs-selector-tag">video</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: auto;
  <span class="hljs-attribute">object-fit</span>: cover; <span class="hljs-comment">/* ä¿æŒå®½é«˜æ¯”ï¼Œå¡«å……å®¹å™¨ï¼ˆå¯èƒ½è£å‰ªè¾¹ç¼˜ï¼‰ */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>; <span class="hljs-comment">/* æœªåŠ è½½æ—¶æ˜¾ç¤ºé»‘è‰²èƒŒæ™¯ */</span>
}

<span class="hljs-comment">/* 3. å°é¢å›¾æ ·å¼ï¼ˆä¸è§†é¢‘åŒå°ºå¯¸ï¼‰ */</span>
<span class="hljs-selector-class">.video-container</span> poster {
  <span class="hljs-attribute">object-fit</span>: cover;
}
</code></pre>
<h3 data-id="heading-15">4.2. è‡ªå®šä¹‰æ§åˆ¶æ æ ·å¼</h3>
<p>é€šè¿‡ç»å¯¹å®šä½åœ¨è§†é¢‘åº•éƒ¨åˆ›å»ºè‡ªå®šä¹‰æ§åˆ¶æ ï¼Œé»˜è®¤éšè—ï¼Œé¼ æ ‡æ‚¬æµ®æ—¶æ˜¾ç¤ºï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ§åˆ¶æ å®¹å™¨ */</span>
<span class="hljs-selector-class">.video-controls</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(transparent, <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.7</span>)); <span class="hljs-comment">/* æ¸å˜èƒŒæ™¯ */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.3s</span> ease;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-comment">/* é¼ æ ‡æ‚¬æµ®æ—¶æ˜¾ç¤ºæ§åˆ¶æ  */</span>
<span class="hljs-selector-class">.video-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.video-controls</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* è¿›åº¦æ¡å®¹å™¨ */</span>
<span class="hljs-selector-class">.progress-container</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0.3</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-comment">/* å·²æ’­æ”¾è¿›åº¦æ¡ */</span>
<span class="hljs-selector-class">.progress-bar</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#ff4400</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0%</span>;
}

<span class="hljs-comment">/* ç¼“å†²è¿›åº¦æ¡ï¼ˆå åŠ åœ¨è¿›åº¦æ¡ä¸‹æ–¹ï¼‰ */</span>
<span class="hljs-selector-class">.buffer-bar</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">0%</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */</span>
<span class="hljs-selector-class">.controls-buttons</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}

<span class="hljs-comment">/* æŒ‰é’®æ ·å¼ */</span>
<span class="hljs-selector-class">.controls-btn</span> {
  <span class="hljs-attribute">background</span>: transparent;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">transition</span>: color <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.controls-btn</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#ff4400</span>;
}

<span class="hljs-comment">/* éŸ³é‡æ§åˆ¶æ»‘å— */</span>
<span class="hljs-selector-class">.volume-slider</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0.3</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">outline</span>: none;
  accent-<span class="hljs-attribute">color</span>: <span class="hljs-number">#ff4400</span>; <span class="hljs-comment">/* è‡ªå®šä¹‰æ»‘å—é¢œè‰² */</span>
}
</code></pre>
<h3 data-id="heading-16">4.3. è‡ªå®šä¹‰æ§åˆ¶æ  HTML ç»“æ„</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">poster</span>=<span class="hljs-string">"cover.jpg"</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">webkit-playsinline</span>&gt;</span>
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ HTML5 è§†é¢‘æ’­æ”¾ã€‚
  <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- è‡ªå®šä¹‰æ§åˆ¶æ  --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"video-controls"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"progressContainer"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"buffer-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls-buttons"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls-btn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"playBtn"</span>&gt;</span>â–¶ï¸<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"current-time"</span>&gt;</span>0:00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"duration"</span>&gt;</span>0:00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"range"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"volume-slider"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"volumeSlider"</span> <span class="hljs-attr">min</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">"1"</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"0.01"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls-btn"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fullscreenBtn"</span>&gt;</span>â›¶<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-17">5. å…¼å®¹æ€§å¤„ç†ä¸å¸¸è§é—®é¢˜</h2>
<p>ä¸‹é¢æ˜¯ä¸€äº›å…¼å®¹æ€§å¤„ç†ä¸å¸¸è§é—®é¢˜ï¼š</p>
<h3 data-id="heading-18">5.1. æµè§ˆå™¨å…¼å®¹æ€§</h3>
<h4 data-id="heading-19">ï¼ˆ1ï¼‰æ ¸å¿ƒå…¼å®¹æ€§ç°çŠ¶</h4>
<ul>
<li><strong>ç°ä»£æµè§ˆå™¨</strong>ï¼šChromeã€Firefoxã€Safariã€Edge å‡å®Œç¾æ”¯æŒ <code>&lt;video&gt;</code> æ ‡ç­¾åŠæ ¸å¿ƒ APIã€‚</li>
<li><strong>ç§»åŠ¨ç«¯</strong>ï¼šiOS Safariã€Android Chrome æ”¯æŒè‰¯å¥½ï¼Œä½†éœ€æ³¨æ„ <code>playsinline</code> å±æ€§ï¼ˆé¿å…è‡ªåŠ¨å…¨å±ï¼‰ã€‚</li>
<li><strong>æ—§æµè§ˆå™¨</strong>ï¼šIE8 åŠä»¥ä¸‹ä¸æ”¯æŒ <code>&lt;video&gt;</code> æ ‡ç­¾ï¼Œéœ€é€šè¿‡é™çº§æç¤ºæˆ– Flash å¤‡ç”¨æ–¹æ¡ˆï¼ˆå·²ä¸æ¨èï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-20">ï¼ˆ2ï¼‰æ ¼å¼å…¼å®¹æ€§</h4>

























<table><thead><tr><th>è§†é¢‘æ ¼å¼</th><th>æ”¯æŒæµè§ˆå™¨</th><th>ä¼˜åŠ¿</th></tr></thead><tbody><tr><td>MP4ï¼ˆH.264 + AACï¼‰</td><td>æ‰€æœ‰ç°ä»£æµè§ˆå™¨ã€iOSã€Android</td><td>å…¼å®¹æ€§æœ€å¥½ï¼Œæ¨èä¸»æ ¼å¼</td></tr><tr><td>WebMï¼ˆVP8/VP9 + Vorbisï¼‰</td><td>Chromeã€Firefoxã€Edge</td><td>ä½“ç§¯å°ã€å¼€æºï¼Œå¤‡é€‰æ ¼å¼</td></tr><tr><td>OGGï¼ˆTheora + Vorbisï¼‰</td><td>Chromeã€Firefox</td><td>å¼€æºï¼Œå…¼å®¹æ€§è¾ƒå·®ï¼ˆå‡ ä¹ä¸ç”¨ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-21">ï¼ˆ3ï¼‰API å…¼å®¹æ€§å¤„ç†</h4>
<p>éƒ¨åˆ† API éœ€æ·»åŠ æµè§ˆå™¨å‰ç¼€ï¼ˆå¦‚å…¨å±ã€æ’­æ”¾é€Ÿç‡ï¼‰ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¨å±å…¼å®¹å¤„ç†</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleFullscreen</span>(<span class="hljs-params">video</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">fullscreenElement</span>) {
    <span class="hljs-comment">// é€€å‡ºå…¨å±</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">exitFullscreen</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// è¿›å…¥å…¨å±ï¼ˆå…¼å®¹å‰ç¼€ï¼‰</span>
    <span class="hljs-keyword">if</span> (video.<span class="hljs-property">requestFullscreen</span>) {
      video.<span class="hljs-title function_">requestFullscreen</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (video.<span class="hljs-property">webkitRequestFullscreen</span>) { <span class="hljs-comment">// Safari</span>
      video.<span class="hljs-title function_">webkitRequestFullscreen</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (video.<span class="hljs-property">msRequestFullscreen</span>) { <span class="hljs-comment">// IE/Edge</span>
      video.<span class="hljs-title function_">msRequestFullscreen</span>();
    }
  }
}

<span class="hljs-comment">// æ’­æ”¾é€Ÿç‡å…¼å®¹æ€§ï¼ˆéƒ¨åˆ†æ—§æµè§ˆå™¨ä¸æ”¯æŒï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">setPlaybackRate</span>(<span class="hljs-params">video, rate</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> video.<span class="hljs-property">playbackRate</span> !== <span class="hljs-string">'undefined'</span>) {
    video.<span class="hljs-property">playbackRate</span> = rate;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ’­æ”¾é€Ÿç‡è°ƒæ•´'</span>);
  }
}
</code></pre>
<h3 data-id="heading-22">5.2. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-23">ï¼ˆ1ï¼‰è‡ªåŠ¨æ’­æ”¾å¤±è´¥</h4>
<ul>
<li><strong>åŸå› </strong>ï¼šç°ä»£æµè§ˆå™¨é™åˆ¶â€œéé™éŸ³è‡ªåŠ¨æ’­æ”¾â€ï¼ˆéœ€ç”¨æˆ·äº¤äº’åæ‰èƒ½æ’­æ”¾æœ‰å£°è§†é¢‘ï¼‰ã€‚</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ol>
<li>é»˜è®¤é™éŸ³è‡ªåŠ¨æ’­æ”¾ï¼ˆ<code>muted autoplay</code>ï¼‰ï¼Œæä¾›â€œå¼€å¯å£°éŸ³â€æŒ‰é’®ã€‚</li>
<li>å¼•å¯¼ç”¨æˆ·ç‚¹å‡»åæ’­æ”¾ï¼ˆå¦‚â€œç‚¹å‡»æ’­æ”¾â€å°é¢å›¾ï¼‰ã€‚</li>
</ol>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">muted</span> <span class="hljs-attr">playsinline</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-24">ï¼ˆ2ï¼‰è§†é¢‘åŠ è½½ç¼“æ…¢/å¡é¡¿</h4>
<ul>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ol>
<li>æä¾›å¤šç ç‡è§†é¢‘ï¼ˆæ ¹æ®ç½‘ç»œçŠ¶å†µåˆ‡æ¢ï¼‰ã€‚</li>
<li>ä½¿ç”¨ <code>preload="metadata"</code> ä¼˜åŒ–é¢„åŠ è½½ç­–ç•¥ã€‚</li>
<li>æ˜¾ç¤ºç¼“å†²è¿›åº¦æ¡ï¼Œæç¤ºç”¨æˆ·â€œç¼“å†²ä¸­â€ã€‚</li>
<li>é‡‡ç”¨ CDN åˆ†å‘è§†é¢‘èµ„æºï¼Œæå‡åŠ è½½é€Ÿåº¦ã€‚</li>
</ol>
</li>
</ul>
<h4 data-id="heading-25">ï¼ˆ3ï¼‰è§†é¢‘æ¯”ä¾‹å˜å½¢</h4>
<ul>
<li><strong>åŸå› </strong>ï¼šæ’­æ”¾å™¨å®½é«˜ä¸è§†é¢‘åŸç”Ÿå®½é«˜æ¯”ä¸ä¸€è‡´ã€‚</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ <code>object-fit</code> å±æ€§æ§åˆ¶è§†é¢‘å¡«å……æ–¹å¼ï¼š
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">video</span> {
  <span class="hljs-attribute">object-fit</span>: cover; <span class="hljs-comment">/* ä¿æŒå®½é«˜æ¯”ï¼Œå¡«å……å®¹å™¨ï¼ˆè£å‰ªè¾¹ç¼˜ï¼‰ */</span>
  <span class="hljs-comment">/* æˆ– object-fit: contain; ä¿æŒå®½é«˜æ¯”ï¼Œå®Œæ•´æ˜¾ç¤ºï¼ˆå¯èƒ½ç•™é»‘è¾¹ï¼‰ */</span>
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-26">ï¼ˆ4ï¼‰ç§»åŠ¨ç«¯è‡ªåŠ¨å…¨å±æ’­æ”¾</h4>
<ul>
<li><strong>åŸå› </strong>ï¼šiOS Safari é»˜è®¤ä¼šå°†è§†é¢‘å…¨å±æ’­æ”¾ï¼ˆæ—  <code>playsinline</code> å±æ€§æ—¶ï¼‰ã€‚</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šæ·»åŠ  <code>playsinline</code> å’Œ <code>webkit-playsinline</code> å±æ€§ï¼š
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"video.mp4"</span> <span class="hljs-attr">playsinline</span> <span class="hljs-attr">webkit-playsinline</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-27">6. æ€»ç»“</h2>
<p>HTML5 <code>&lt;video&gt;</code> æ ‡ç­¾å‡­å€ŸåŸç”Ÿã€è½»é‡ã€å¯æ‰©å±•çš„ç‰¹æ€§ï¼Œæˆä¸ºç½‘é¡µè§†é¢‘æ’­æ”¾çš„æ ‡å‡†æ–¹æ¡ˆã€‚é€šè¿‡æœ¬æ–‡çš„è®²è§£ï¼Œä½ å¯ä»¥æŒæ¡ï¼š</p>
<ol>
<li>æ ‡ç­¾åŸºç¡€å±æ€§ä¸å¤šæ ¼å¼é€‚é…æŠ€å·§ï¼›</li>
<li>æ ¸å¿ƒ API çš„ä½¿ç”¨çš„ï¼ˆæ’­æ”¾æ§åˆ¶ã€çŠ¶æ€æŸ¥è¯¢ï¼‰ï¼›</li>
<li>å®Œæ•´äº‹ä»¶ä½“ç³»çš„åº”ç”¨ï¼ˆç›‘å¬æ’­æ”¾çŠ¶æ€ã€ç¼“å†²è¿›åº¦ç­‰ï¼‰ï¼›</li>
<li>è‡ªå®šä¹‰æ’­æ”¾å™¨çš„æ ·å¼è®¾è®¡ä¸é€»è¾‘å®ç°ï¼›</li>
<li>å…¼å®¹æ€§å¤„ç†ä¸å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚</li>
</ol>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯æ ¹æ®éœ€æ±‚çµæ´»ç»„åˆä¸Šè¿°æŠ€æœ¯â€”â€”ç®€å•åœºæ™¯ç›´æ¥ä½¿ç”¨åŸç”Ÿæ§åˆ¶æ ï¼Œå¤æ‚åœºæ™¯ï¼ˆå¦‚è§†é¢‘ç½‘ç«™ã€æ•™è‚²å¹³å°ï¼‰åˆ™é€šè¿‡è‡ªå®šä¹‰æ§åˆ¶æ ä¸ API å®ç°ä¸ªæ€§åŒ–åŠŸèƒ½ï¼ˆå¦‚å€é€Ÿæ’­æ”¾ã€å¼¹å¹•ã€ç”»ä¸­ç”»ç­‰ï¼‰ã€‚éšç€æµè§ˆå™¨æŠ€æœ¯çš„è¿­ä»£ï¼Œ<code>&lt;video&gt;</code> æ ‡ç­¾çš„åŠŸèƒ½å°†æŒç»­å®Œå–„ï¼Œä¸ºç½‘é¡µè§†é¢‘ä½“éªŒå¸¦æ¥æ›´å¤šå¯èƒ½ã€‚</p>
<hr/>
<blockquote>
<p>æœ¬æ¬¡åˆ†äº«å°±åˆ°è¿™å„¿å•¦ï¼Œæˆ‘æ˜¯é¹å¤šå¤šï¼Œæ·±è€•å‰ç«¯çš„æŠ€æœ¯åˆ›ä½œè€…ï¼Œå¦‚æœæ‚¨çœ‹äº†è§‰å¾—æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯„è®ºï¼Œå…³æ³¨ï¼Œç‚¹èµï¼Œè½¬å‘ï¼Œæˆ‘ä»¬ä¸‹æ¬¡è§~</p>
</blockquote>
<p>PSï¼šåœ¨æœ¬é¡µæŒ‰F12ï¼Œåœ¨consoleä¸­è¾“å…¥document.getElementsByClassName('panel-btn')[0].click();æœ‰æƒŠå–œå“¦~</p>
<p><code>å¾€æœŸæ–‡ç« </code></p>
<ul>
<li><a href="https://juejin.cn/post/7568192652286754870" target="_blank" title="https://juejin.cn/post/7568192652286754870">çº¯å‰ç«¯æå–å›¾ç‰‡é¢œè‰²æ’ä»¶Color-Thiefæ•™å­¦+å®æˆ˜å®Œæ•´æŒ‡å—</a></li>
<li><a href="https://juejin.cn/post/7565737512816771135" target="_blank" title="https://juejin.cn/post/7565737512816771135">react-konvaå®æˆ˜æŒ‡å—ï¼šCanvasé«˜æ€§èƒ½+æ˜“ç»´æŠ¤çš„ç»„ä»¶åŒ–å›¾å½¢å¼€å‘å®ç°æ•™ç¨‹</a></li>
<li><a href="https://juejin.cn/post/7560905838074462271" target="_blank" title="https://juejin.cn/post/7560905838074462271">Reactæ— é™æ»šåŠ¨æ’ä»¶react-infinite-scroll-componentçš„é…ç½®+ä¼˜åŒ–+é¿å‘æŒ‡å—</a></li>
<li><a href="https://juejin.cn/post/7560542615484137491" target="_blank" title="https://juejin.cn/post/7560542615484137491">å‰ç«¯éŸ³é¢‘å…¼å®¹è§£å†³ï¼šéŸ³é¢‘ç¥å™¨howler.jsä»åŸºç¡€åˆ°è¿›é˜¶å®Œæ•´ä½¿ç”¨æŒ‡å—</a></li>
<li><a href="https://juejin.cn/post/7559871680015024169" target="_blank" title="https://juejin.cn/post/7559871680015024169">ä½¿ç”¨React-OAuthè¿›è¡ŒGoogle/GitHubç™»å½•çš„æ•™ç¨‹å’Œæ¡ˆä¾‹</a></li>
<li><a href="https://juejin.cn/post/7550585427834404927" target="_blank" title="https://juejin.cn/post/7550585427834404927">çº¯å‰ç«¯äººè„¸è¯†åˆ«åˆ©å™¨ï¼šface-api.jsæ‰‹æŠŠæ‰‹æ·±å…¥è§£ææ•™å­¦</a></li>
<li><a href="https://juejin.cn/post/7553865490732433462" target="_blank" title="https://juejin.cn/post/7553865490732433462">å…³äºReactçˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ–¹æ³•forwardRefçš„è¯¦è§£å’Œæ¡ˆä¾‹</a></li>
<li><a href="https://juejin.cn/post/7553484874609410074" target="_blank" title="https://juejin.cn/post/7553484874609410074">Reactè·¨ç»„ä»¶æ•°æ®å…±äº«useContextè¯¦è§£å’Œæ¡ˆä¾‹</a></li>
<li><a href="https://juejin.cn/post/7545087762837815334" target="_blank" title="https://juejin.cn/post/7545087762837815334">Webå›¾åƒç¼–è¾‘ç¥å™¨tui.image-editorä»åŸºç¡€åˆ°è¿›é˜¶çš„å®æˆ˜æŒ‡å—</a></li>
<li><a href="https://juejin.cn/post/7544323659788288046" target="_blank" title="https://juejin.cn/post/7544323659788288046">å¼€å‘ä¸ªäººå¾®ä¿¡å°ç¨‹åºç±»ç›®é€‰æ‹©/ç›ˆåˆ©æ–¹å¼/æˆæœ¬æ§åˆ¶ä¸æœåŠ¡å™¨æ¥å…¥æŒ‡å—</a></li>
<li><a href="https://juejin.cn/post/7541741121400864778" target="_blank" title="https://juejin.cn/post/7541741121400864778">å‰ç«¯å›¾ç‰‡è£å‰ªCropper.jsæ ¸å¿ƒåŠŸèƒ½ä¸å®æˆ˜æŠ€å·§è¯¦è§£</a></li>
<li><a href="https://juejin.cn/post/7536530451461472265" target="_blank" title="https://juejin.cn/post/7536530451461472265">ç¼–è¾‘å™¨ä¹Ÿæœ‰é‚ªä¿®ï¼Ÿç›˜ç‚¹VS Codeé‚ªé—¨/æœ‰è¶£çš„æ‰©å±•</a></li>
<li><a href="https://juejin.cn/post/7535005018257981466" target="_blank" title="https://juejin.cn/post/7535005018257981466">jsä½¿ç”¨IntersectionObserverå®ç°ç›®æ ‡å…ƒç´ å¯è§åº¦çš„äº¤äº’</a></li>
<li><a href="https://juejin.cn/post/7534547200330121225" target="_blank" title="https://juejin.cn/post/7534547200330121225">Webå‰ç«¯é¡µé¢å¼€å‘é˜¿æ‹‰ä¼¯è¯­ç§é€‚é…æŒ‡å—</a></li>
<li><a href="https://juejin.cn/post/7516122409948020736" target="_blank" title="https://juejin.cn/post/7516122409948020736">è®©ç½‘é¡µæ‹¥æœ‰Appä½“éªŒï¼ŸPWA å°†ç½‘é¡µå˜ä¸ºæ¡Œé¢åº”ç”¨çš„ä¿å§†çº§æ•™ç¨‹PWA</a></li>
<li><a href="https://juejin.cn/post/6953803916484018206" target="_blank" title="https://juejin.cn/post/6953803916484018206">ä½¿ç”¨nvmç®¡ç†node.jsç‰ˆæœ¬ä»¥åŠæ›´æ¢npmæ·˜å®é•œåƒæº</a></li>
<li><a href="https://juejin.cn/post/7140443283209060383" target="_blank" title="https://juejin.cn/post/7140443283209060383">æ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºè§„èŒƒçš„å›¢é˜Ÿvueé¡¹ç›®ï¼ŒåŒ…å«commitlintï¼Œeslintï¼Œprettierï¼Œhuskyï¼Œcommitizenç­‰ç­‰</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ —å­å‰ç«¯æŠ€æœ¯å‘¨åˆŠç¬¬ 107 æœŸ - Angular v21ã€pnpm 10.22ã€React 2025 ç°çŠ¶è°ƒæŸ¥...]]></title>    <link>https://juejin.cn/post/7575458028255903787</link>    <guid>https://juejin.cn/post/7575458028255903787</guid>    <pubDate>2025-11-24T01:00:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028255903787" data-draft-id="7575349314945384489" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ —å­å‰ç«¯æŠ€æœ¯å‘¨åˆŠç¬¬ 107 æœŸ - Angular v21ã€pnpm 10.22ã€React 2025 ç°çŠ¶è°ƒæŸ¥..."/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Angular.js"/> <meta itemprop="datePublished" content="2025-11-24T01:00:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ™“å¾—è¿·è·¯äº†"/> <meta itemprop="url" content="https://juejin.cn/user/2172290706715565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ —å­å‰ç«¯æŠ€æœ¯å‘¨åˆŠç¬¬ 107 æœŸ - Angular v21ã€pnpm 10.22ã€React 2025 ç°çŠ¶è°ƒæŸ¥...
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290706715565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ™“å¾—è¿·è·¯äº†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:00:56.000Z" title="Mon Nov 24 2025 01:00:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ğŸŒ°<strong>æ —å­å‰ç«¯æŠ€æœ¯å‘¨åˆŠç¬¬ 107 æœŸ (2025.11.17 - 2025.11.23)</strong>ï¼šæµè§ˆå‰ç«¯ä¸€å‘¨æœ€æ–°æ¶ˆæ¯ï¼Œå­¦ä¹ å›½å†…å¤–ä¼˜ç§€æ–‡ç« è§†é¢‘ï¼Œè®©æˆ‘ä»¬ä¿æŒå¯¹å‰ç«¯çš„å¥½å¥‡å¿ƒã€‚</p>
<h2 data-id="heading-0">ğŸ“° æŠ€æœ¯èµ„è®¯</h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.angular.dev%2Fannouncing-angular-v21-57946c34f14b" target="_blank" title="https://blog.angular.dev/announcing-angular-v21-57946c34f14b" ref="nofollow noopener noreferrer">Angular v21</a></strong>ï¼šè°·æ­Œå‘å¸ƒ Angular v21 ç‰ˆæœ¬ï¼Œæœ¬æ¬¡æ›´æ–°ä¸ä»…æ‰“é€ äº†ä¸€åœºå¤å¤æ¸¸æˆä¸»é¢˜çš„æ¢ç´¢ä¹‹æ—…ï¼Œç”¨äºå±•ç¤ºæ–°ç‰ˆæœ¬çš„å„é¡¹æ–°ç‰¹æ€§ï¼Œè¿˜æ¨å‡ºäº†ä¸€ç³»åˆ—é«˜è´¨é‡è§†é¢‘ï¼Œé›†ä¸­æ¼”ç¤ºäº†ä»¥ä¸‹åŠŸèƒ½ï¼šåŸºäºä¿¡å·ï¼ˆsignal-basedï¼‰çš„è¡¨å•å¤„ç†æ–°æ–¹æ¡ˆã€æ”¯æŒ AI é©±åŠ¨å·¥ä½œæµçš„ MCP æœåŠ¡å™¨ã€ä¸“æ³¨äºå¯è®¿é—®æ€§ï¼ˆæ— éšœç¢æ€§ï¼‰çš„æ— å¤´ç»„ä»¶åº“ï¼Œç”šè‡³è¿˜æ–°å¢äº†ä¸€æ¬¾â€œAngular AI å¯¼å¸ˆâ€å·¥å…·ï¼ŒåŠ©åŠ›å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹æ–°ç‰ˆæœ¬ã€‚</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpnpm%2Fpnpm%2Freleases%2Ftag%2Fv10.22.0" target="_blank" title="https://github.com/pnpm/pnpm/releases/tag/v10.22.0" ref="nofollow noopener noreferrer">pnpm 10.22</a></strong>ï¼š pnpm 10.22 å‘å¸ƒï¼Œè¯¥ç‰ˆæœ¬æ–°å¢ <code>trustPolicyExclude</code> é…ç½®é¡¹ï¼Œå¯ç”¨äºæŒ‡å®šâ€œå³ä¾¿å­˜åœ¨å…¶ä»–ä¿¡ä»»ç­–ç•¥è¦æ±‚ï¼Œä»éœ€å®‰è£…â€çš„åŒ…ã€‚</p>
</li>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fsurvey.devographics.com%2Fen-US%2Fsurvey%2Fstate-of-react%2F2025" target="_blank" title="https://survey.devographics.com/en-US/survey/state-of-react/2025" ref="nofollow noopener noreferrer">React 2025 ç°çŠ¶è°ƒæŸ¥</a></strong>ï¼šReact 2025 ç°çŠ¶è°ƒæŸ¥ç°å·²å¼€å¯ï¼Œé—®å·æäº¤å°†äº 11 æœˆ 25 æ—¥æˆªæ­¢ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å‚åŠ ã€‚</p>
</li>
</ol>
<h2 data-id="heading-1">ğŸ“’ æŠ€æœ¯æ–‡ç« </h2>
<ol>
<li>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.readwriterachel.com%2Fthings-i-learned%2F2025%2F11%2F09%2Fdevtools-1.html" target="_blank" title="https://www.readwriterachel.com/things-i-learned/2025/11/09/devtools-1.html" ref="nofollow noopener noreferrer">Six Things I Bet You Didn't Know You Could Do With Chrome's Devtools, Part 1</a></strong>ï¼šä½ å¯èƒ½ä¸çŸ¥é“çš„ Chrome å¼€å‘è€…å·¥å…·å…­å¤§ç”¨æ³•ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰- æœ¬ç¯‡æ–‡ç« å°†ä»‹ç»ä½¿ç”¨ <code>console.time ()</code> å’Œ <code>console.timeEnd ()</code> çš„è®¡æ—¶åŠŸèƒ½ã€ç›‘å¬ä»»æ„ DOM å…ƒç´ çš„å˜åŒ–å’Œç›‘æ§æµè§ˆå™¨ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­çš„ä»»æ„å‡½æ•°ï¼Œå…¶ä»–éƒ¨åˆ†å°†åœ¨ä¸‹ç¯‡æ–‡ç« ä»‹ç»ã€‚</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7573193563053522985" target="_blank" title="https://juejin.cn/post/7573193563053522985">Cursor ä¸€å¹´æ·±åº¦å¼€å‘å®è·µï¼šå‰ç«¯å¼€å‘çš„æ•ˆç‡é©å‘½</a></strong>ï¼šæœ¬æ–‡ä½œè€…åˆ†äº«äº†ä½¿ç”¨ Cursor è¿›è¡Œå‰ç«¯å¼€å‘çš„å®è·µç»éªŒï¼Œå±•ç¤ºäº†ç§»åŠ¨ç«¯ã€PC ç«¯å¤šä¸ªé¡¹ç›®ä¸­ Cursor çš„é«˜æ•ˆåº”ç”¨ï¼Œè¿˜éªŒè¯äº†å…¶å·¥ç¨‹åŒ–å¤„ç†èƒ½åŠ›ã€‚</p>
</li>
<li>
<p><strong><a href="https://juejin.cn/post/7574739133945675818" target="_blank" title="https://juejin.cn/post/7574739133945675818">è½¬è½¬ UI è‡ªåŠ¨åŒ–èµ°æŸ¥æ–¹æ¡ˆæ¢ç´¢</a></strong>ï¼šæ–‡ç« å›´ç»•è½¬è½¬ UI è‡ªåŠ¨åŒ–èµ°æŸ¥æ–¹æ¡ˆå±•å¼€ï¼Œå…ˆæŒ‡å‡ºå½“å‰ UI èµ°æŸ¥å­˜åœ¨æ•ˆç‡ä½ã€è¿˜åŸåº¦éš¾æ§ç­‰é—®é¢˜ã€‚åç»è°ƒç ”ï¼Œé€‰æ‹©åŸºäºå‰ç«¯ä¸ UI èŠ‚ç‚¹çš„æ¯”å¯¹æ–¹æ¡ˆï¼Œä»‹ç»äº†æ•°æ®ç»“æ„è®¾è®¡ã€å½’ä¸€åŒ–å¤„ç†æµç¨‹ï¼ŒåŒ…æ‹¬å¤„ç†è¡Œé«˜ã€è¾¹è·åˆå¹¶ç­‰é—®é¢˜ã€‚</p>
</li>
</ol>
<h2 data-id="heading-2">ğŸ”§ å¼€å‘å·¥å…·</h2>
<ol>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwebpack%2Fwebpack-bundle-analyzer" target="_blank" title="https://github.com/webpack/webpack-bundle-analyzer" ref="nofollow noopener noreferrer">Webpack Bundle Analyzer 5.0</a></strong>ï¼šå¯è§†åŒ–æŸ¥çœ‹ Webpack è¾“å‡ºå†…å®¹ã€‚</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bb3a440bff345f0b03eba7d4aba6eab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764550855&amp;x-signature=9je5azl1fJJrDcFMLFw%2FW9gchz8%3D" width="100%" alt="image-20251123131443566" loading="lazy"/>
<ol start="2">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fmarked.js.org%2F" target="_blank" title="https://marked.js.org/" ref="nofollow noopener noreferrer">Marked.js 17.0</a></strong>ï¼šå¿«é€Ÿçš„ Markdown è§£æå™¨ä¸ç¼–è¯‘å™¨ï¼ŒMarked.js å¯ä½œä¸ºå®¢æˆ·ç«¯åº“ã€æœåŠ¡å™¨ç«¯åº“ä½¿ç”¨ï¼Œç”šè‡³è¿˜æ”¯æŒå‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰ã€‚</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c8b7db9835e4222ba98e6cf9c833fdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764550855&amp;x-signature=lkzYBVSsp5I5dWUUnfvV5AsHui8%3D" width="100%" alt="image-20251123131824469" loading="lazy"/>
<ol start="3">
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fis-online" target="_blank" title="https://github.com/sindresorhus/is-online" ref="nofollow noopener noreferrer">is-online 12.0</a></strong>ï¼šè¯¥å·¥å…·å¯åœ¨ Node.js ç¯å¢ƒä¸æµè§ˆå™¨ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶é€šè¿‡å¤šç§æ–¹å¼åˆ¤æ–­äº’è”ç½‘æ˜¯å¦çœŸæ­£å¤„äºå¯ç”¨çŠ¶æ€ã€‚</li>
</ol>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2390c77a08cb4b4d84ed457f7bdd5b8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmT5b6X6L-36Lev5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764550855&amp;x-signature=YbfZ6viLVv%2F3tb3pczX6ciMA10E%3D" width="100%" alt="image-20251123132105379" loading="lazy"/>
<p>ğŸš€ğŸš€ğŸš€ <em>ä»¥ä¸Šèµ„è®¯æ–‡ç« é€‰è‡ªå¸¸è§å‘¨åˆŠï¼Œå¦‚ JavaScript Weekly ç­‰ï¼Œå‘¨åˆŠå†…å®¹ä¹Ÿä¼šä¸æ–­ä¼˜åŒ–æ”¹è¿›ï¼Œå¸Œæœ›ä½ ä»¬èƒ½å¤Ÿå–œæ¬¢ã€‚</em></p>
<p>ğŸ’– <strong>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šæ —å­å‰ç«¯</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å›é¡¾ Flutter Flight Plans ï¼Œå…³äº Flutter çš„ç°çŠ¶å’Œå®˜æ–¹çƒ­é—¨é—®é¢˜è§£ç­”]]></title>    <link>https://juejin.cn/post/7575438636331630643</link>    <guid>https://juejin.cn/post/7575438636331630643</guid>    <pubDate>2025-11-23T23:10:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575438636331630643" data-draft-id="7575182522412056614" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å›é¡¾ Flutter Flight Plans ï¼Œå…³äº Flutter çš„ç°çŠ¶å’Œå®˜æ–¹çƒ­é—¨é—®é¢˜è§£ç­”"/> <meta itemprop="keywords" content="å‰ç«¯,Android,Flutter"/> <meta itemprop="datePublished" content="2025-11-23T23:10:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‹çŒ«deå°éƒ­"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å›é¡¾ Flutter Flight Plans ï¼Œå…³äº Flutter çš„ç°çŠ¶å’Œå®˜æ–¹çƒ­é—¨é—®é¢˜è§£ç­”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‹çŒ«deå°éƒ­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:10:03.000Z" title="Sun Nov 23 2025 23:10:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Flutter å®˜æ–¹åˆšä¸¾è¡Œçš„ Flutter Flight Plans ç›´æ’­é‡Œï¼Œé™¤äº†å‘å¸ƒ <a href="https://juejin.cn/post/7571693273728696356" target="_blank" title="https://juejin.cn/post/7571693273728696356">Flutter 3.38</a> å’Œ <a href="https://juejin.cn/post/7571693273728942116" target="_blank" title="https://juejin.cn/post/7571693273728942116">Dart 3.10</a> ä¹‹å¤–ï¼Œå…¶å®è¿˜æœ‰ä¸å°‘å€¼å¾—ä¸€èŠçš„å†…å®¹ï¼Œä¾‹å¦‚ä¼ä¸šçº§çš„ Flutter æ¡ˆä¾‹å±•ç¤ºï¼ŒFlutter + AI çš„åœºæ™¯ï¼Œ<strong>é‡ç‚¹è¿˜æœ‰é’ˆå¯¹å¤§é‡çƒ­é—¨é—®é¢˜çš„ Q&amp;Aï¼ˆå¤šçª—å£ã€GenUIã€PC\Web æ’ä»¶ï¼‰ ç­‰</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/386bfd4bcee6451496243bacf8d47bff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=1muYt9WJ5nXNlKAeVA6jCmZ%2BHu4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">NotebookLM</h2>
<p>é¦–å…ˆï¼Œåœ¨ç»å…¸æ¡ˆä¾‹å±•ç¤ºä¸Šï¼Œæœ¬æ¬¡ Flutter å®˜æ–¹å±•ç¤ºçš„æ˜¯ä»Šå¹´è°·æ­Œåˆšå‘å¸ƒçš„ Notebook LM ï¼Œè¿™æ˜¯ä¸€æ¬¾ç”±è°·æ­Œå¼€å‘çš„ AI é©±åŠ¨ç ”ç©¶åŠ©æ‰‹ï¼Œæ ¸å¿ƒæ˜¯å¯ä»¥æ˜¯åŸºäºç”¨æˆ·æä¾›çš„èµ„æ–™ï¼ˆå¦‚ PDFã€ç½‘ç«™ã€YouTube è§†é¢‘ç­‰ï¼‰ç”Ÿæˆä¿¡æ¯ï¼Œ<strong>å¹¶æä¾›å‡†ç¡®çš„å¼•ç”¨æ¥æº</strong>ã€‚</p>
<blockquote>
<p>æä¾›å‡†ç¡®å’Œæœ‰æ•ˆçš„å¼•ç”¨æ¥æºè¿™ä¸ªåœ¨ AI ä½¿ç”¨é‡Œå¾ˆé‡è¦ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eecd62716c943c58babe8d2042c098a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=AITo%2Fj7WTzN5AmTc%2F8Rq7KnKtpk%3D" alt="" loading="lazy"/></p>
<p>å¹´åˆï¼Œ<strong>NotebookLM æ¡Œé¢ç‰ˆåº”ç”¨å› ä¸ºå®ƒæä¾›çš„ â€œéŸ³é¢‘æ¦‚è§ˆâ€ï¼ˆAudio Overviewï¼Œå¯ç”Ÿæˆé€¼çœŸçš„åŒäººå¯¹è¯æ’­å®¢ï¼‰åŠŸèƒ½è¿…é€Ÿèµ°çº¢</strong>ï¼Œéšç€ç”¨æˆ·å¯¹ç§»åŠ¨åº”ç”¨çš„éœ€æ±‚æ¿€å¢ï¼Œå›¢é˜Ÿå†³å®šåŠ é€Ÿå¼€å‘ï¼Œå¹¶é€‰æ‹©äº† Flutter ï¼Œè¿™ä¸ªæ¡ˆä¾‹å±•ç¤ºäº†å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>å›¢é˜Ÿä»… 4 åå·¥ç¨‹å¸ˆ</strong></li>
<li>åŸºäºç¤¾åŒºæ’ä»¶ï¼Œå‡ ä¹ä¸éœ€è§¦åŠåŸç”Ÿå±‚</li>
<li>å…¨çƒ 170 å¤šä¸ªå›½å®¶å¤šè¯­è¨€åŒæ­¥ä¸Šçº¿</li>
<li><strong>7 ä¸ªæœˆå†…å®Œæˆäº†äº§å“çš„ä¸Šçº¿å‘å¸ƒ</strong></li>
<li>åœ¨ Google Play Store å’Œ Apple App Store ä¸Šå‡<strong>è·å¾— 4.8 çš„é«˜åˆ†</strong>ï¼ŒåŒæ—¶æˆä¸º Apple App Store æ¨èç²¾å“åº”ç”¨</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85629b46ad6144128ded70abfaae8196~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=nv5uxpynYi68uvvrIgdqGGTNdPY%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>è¿™ä¹Ÿæ˜¯ç»§ Google Payã€Google Earthã€Google Adsã€Google Classroomã€Google Cloud ã€YouTube Createã€Google Oneã€Google Analytics ä¹‹åè°·æ­Œé‡‡ç”¨ Flutter å¼€å‘çš„å¦ä¸€ä¸ªç»å…¸åº”ç”¨ã€‚</p>
</blockquote>
<h2 data-id="heading-1">Flutter + AI</h2>
<p>åœ¨ Flutter + AI çš„å±•ç¤ºä¸Šï¼Œå®˜æ–¹é¦–å…ˆå±•ç¤ºäº† Gemini CLI + Flutter Extension for Gemini CLI ï¼ˆMCPï¼‰å¦‚ä½•é€šè¿‡ AI è‡ªåŠ¨åŒ–ä»é›¶å¼€å‘ä¸€ä¸ª App ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c580e387da7a4c29b3111ce19272478a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=LqSMVH%2BGEfRh0BQP3wMxMGMc%2BVA%3D" alt="" loading="lazy"/></p>
<p>å…¶æ ¸å¿ƒä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>åˆ©ç”¨ Gemini CLI çš„â€œæ€ç»´é“¾â€ (Chain of Thought) æ¨ç†æ¥æ‰§è¡Œä»»åŠ¡</li>
<li>åˆ©ç”¨ Flutter Extension çš„ Dart å’Œ Flutter MCP æœåŠ¡æä¾›æ£€æŸ¥ Dart é”™è¯¯ã€è¿æ¥è¿è¡Œä¸­çš„åº”ç”¨è¿›è¡Œçƒ­é‡è½½ã€æœ€ä½³å®è·µrulesï¼Œä»¥åŠ <strong><code>/create app</code>, <code>/modify</code>, <code>/commit</code></strong> ç­‰å‘½ä»¤æ¥é©±åŠ¨è§„èŒƒåŒ–åº”ç”¨å¼€å‘ã€‚</li>
</ul>
<p>æ•´ä¸ªæµç¨‹ä» <code>/create app</code> å¼€å§‹ï¼Œç”Ÿæˆåº”ç”¨è§„æ ¼è¯´æ˜ (<code>design.md</code>) å’Œå®ç°è®¡åˆ’ (<code>implementation.md</code>)ï¼Œç„¶åé€æ­¥æ„å»ºåº”ç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ AI Agent èƒ½è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ã€ä½¿ç”¨ <code>launch app</code> å·¥å…·å¯åŠ¨åº”ç”¨ï¼Œå¹¶åœ¨åº”ç”¨è¿è¡Œæ—¶è¿›è¡Œçƒ­é‡è½½ ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80263a3458b54ae384eb52a479ed94a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=zj%2FEyDw7RxHTCC3Xxw5qHzv%2FE%2FE%3D" alt="" loading="lazy"/></p>
<p>æœ€åï¼Œå›¢é˜Ÿè¿˜æ˜¯æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Google çš„å¦ä¸€æ¬¾ AI å·¥å…· Stitch ç”Ÿæˆè®¾è®¡ç¨¿ HTML å’Œæˆªå›¾ï¼Œç„¶åå°†æ–‡ä»¶è¾“å…¥ Gemini CLIï¼ŒGemini èƒ½å¤ŸåŸºäºå›¾åƒç”Ÿæˆå’Œæ›´æ–° Dart æºä»£ç ï¼Œå¹¶è‡ªåŠ¨è§¦å‘çƒ­é‡è½½æ›´æ–° App ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77f060e6b68646fdae379712d50117e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=wl%2B7AYajsDrx5NIc4K8w6vMn0ys%3D" alt="image-20251114091720980" loading="lazy"/></p>
<p>æ¥ç€å®˜æ–¹å±•ç¤ºäº†ä¸¤ä¸ª AI é©±åŠ¨çš„ Demo ï¼š</p>
<ul>
<li><strong>Gemini Live API</strong> å®ç°äººæ€§åŒ–çš„å®æ—¶è¯­éŸ³å¯¹è¯ï¼ŒæŠ€æœ¯æ ˆä¾èµ– Firebase AI Logic å’Œ pub æ’ä»¶ï¼Œä»…ä»…é€šè¿‡æ›´æ–° System Prompt é›¶ä»£ç ï¼Œå°†ä¸€ä¸ªåŸå‹è½¬åŒ–ä¸ºæ¤ç‰©è¯†åˆ«åº”ç”¨ <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9075b6329f84f869a137c7a7063f5f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=QMDF8i2uVXwZcJg3zLkiYCTBULI%3D" alt="" loading="lazy"/></li>
<li>å¦å¤–ä¸€ä¸ªæ˜¯å±•ç¤º AI é©±åŠ¨çš„æ•°ç‹¬æ¸¸æˆï¼ŒAI ä»£ç†é€šè¿‡ Firebase AI Logic é€æ­¥åˆ†æã€æå–æ•°æ®å¹¶è§£å‡ºç­”æ¡ˆ <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73a9494e9f53491b9517516b5b9e271c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=G1PoXkIzxDfuTEVWCPPvIOqYxZ0%3D" alt="" loading="lazy"/></li>
</ul>
<p>æœ€åï¼ŒFlutter å›¢é˜Ÿè¿˜å±•ç¤ºäº† Flutter Gen UI ï¼Œè¿™ä¸ªæˆ‘ä»¬åœ¨ä¹‹å‰çš„ <a href="https://juejin.cn/post/7547639458385313855" target="_blank" title="https://juejin.cn/post/7547639458385313855">ã€ŠFlutter å®˜æ–¹ LLM åŠ¨æ€ UI åº“ flutter_genui å‘å¸ƒï¼Œè®© App UI è‡ªå·±ç”Ÿæˆ UIã€‹</a> æœ‰èŠåˆ°è¿‡ï¼Œ<strong>Flutter Gen UI åŒ…å¯ä»¥è®© AI Agent ç›´æ¥ç”Ÿæˆ Widget è€Œéçº¯æ–‡æœ¬ï¼Œä»è€Œå®ç°æ›´åŠ¨æ€ã€ä¸ªæ€§åŒ–çš„åº”ç”¨ä½“éªŒ</strong>ã€‚</p>
<p>å…¶æ ¸å¿ƒç†å¿µå°±æ˜¯ï¼Œå…è®¸ AI Agent ä½¿ç”¨å¼€å‘è€…æä¾›çš„ä¸€ä¸ª Widget ç›®å½• (Catalog)ï¼Œç„¶åè®© AI æ ¹æ®ç”¨æˆ·éœ€æ±‚ç”Ÿæˆå’Œå±•ç¤ºç›¸åº”çš„ UI ç»„ä»¶ ï¼Œåœ¨å±•ç¤ºé‡Œï¼Œå®˜æ–¹æ¼”ç¤ºäº†å¦‚ä½•å°† Gen UI æ ¸å¿ƒåŒ…å’Œ Firebase é€‚é…å™¨é›†æˆåˆ°åº”ç”¨ä¸­ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª è‡ªå®šä¹‰ Widget Catalog Item (WorkoutCard)ï¼Œè®© AI ä»£ç†èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·æç¤ºç”ŸæˆåŒ…å«è‡ªå®šä¹‰ UI çš„å¥èº«è®¡åˆ’ ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cdb7992389c4c25bae9f56cacc14c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=ZVubUawGa6fMh0b0kz2uiXvHPaw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>å®é™…ä¸Šï¼Œ Flutter Gen UI ç¡®å®æ˜¯ä¸€ä¸ªä¸é”™çš„åº”ç”¨åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨ AI Chat å®¢æœçš„åœºæ™¯ä¸‹ã€‚</p>
</blockquote>
<h2 data-id="heading-2">Q&amp;A</h2>
<p>æ¥ç€å°±æ˜¯æœ¬æ¬¡å¤§å®¶æœ€å…³å¿ƒçš„ Q&amp;A ç¯èŠ‚ï¼Œè¿™é‡Œä¹Ÿé—®å‡ºäº†ä¸€äº›å¤§å®¶æ¯”è¾ƒåœ¨æ„çš„çƒ­é—¨é—®é¢˜ã€‚</p>
<h3 data-id="heading-3">1ã€GenUI å¯ä»¥æ”¯æŒæœåŠ¡ç«¯å®ç°å—ï¼Ÿ</h3>
<p>å®˜æ–¹å›ç­”æ˜¯å¯ä»¥çš„ï¼Œè¿™å…¶å®è¿™ä¹Ÿæ˜¯ä»–ä»¬å·²ç»è€ƒè™‘å¹¶æ”¯æŒçš„æ¨¡å¼ï¼ŒFlutter å›¢é˜Ÿé¢„è®¡è®¸å¤šå¼€å‘è€…å¸Œæœ›åœ¨æœåŠ¡ç«¯è¿è¡Œè‡ªå·±çš„ Agentï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ï¼š</p>
<ul>
<li>åŠ¨æ€æ›´æ–°æ¨¡å‹å’Œé€»è¾‘</li>
<li>æ¥å…¥è‡ªå®šä¹‰æ•°æ®æºæˆ–ç§æœ‰ API</li>
<li>æ§åˆ¶ç‰ˆæœ¬ä¸å®‰å…¨</li>
<li>å‡å°‘å®¢æˆ·ç«¯è´Ÿæ‹…</li>
</ul>
<p>è€Œä¸ºäº†è¿™ä¸ªï¼Œç›®å‰æ­£åœ¨å°è¯•ç ”å‘ä¸€ç§æ–°åè®®ï¼š<strong>A2UI (Agent-to-UI Protocol)</strong> ï¼ŒGen UI è®¾è®¡ä¸ºæ¨¡å—åŒ–ï¼Œå¯é€šè¿‡ <strong>A2UI åè®® (Agent-to-UI)</strong> è¿æ¥åˆ°æœåŠ¡å™¨ç«¯ä»£ç†ï¼Œå®ƒå…è®¸æœåŠ¡ç«¯ Agent å°†ç”Ÿæˆçš„ UI â€œç‰‡æ®µâ€ï¼ˆWidget æ ‘ç»“æ„ï¼‰ç›´æ¥æ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œå®ç°ç±»ä¼¼â€œå‰ç«¯ç”± AI é©±åŠ¨çš„ â€œUI Streamingâ€ ã€‚</p>
<p>A2UI åè®®ä¼šä¸ A2A (Agent-to-Agent) åè®®ååŒå¼€å‘ï¼ˆGoogle Labs çš„ Opal å›¢é˜Ÿä¹Ÿå‚ä¸ï¼‰ï¼Œåœ¨ç›®å‰å·²æœ‰å®˜æ–¹ç¤ºä¾‹é¡¹ç›®å°±æœ‰ä¸€ä¸ª VUA demoï¼ˆPython æœåŠ¡ç«¯ + Flutter å®¢æˆ·ç«¯ï¼‰ã€‚</p>
<blockquote>
<p>å½“ç„¶ï¼ŒGen UI ç†è®ºä¸Šå¯ä»¥ä¸æœ¬åœ° LLM API ä¸€èµ·ä½¿ç”¨ï¼Œä»è€Œæ”¯æŒæœ¬åœ°ç¦»çº¿åº”ç”¨ï¼Œä½†æ˜¯å»ºè®®ç”¨è¾ƒå°çš„ Widget ç›®å½•ã€‚</p>
</blockquote>
<h3 data-id="heading-4">2ã€Multi-window åŠŸèƒ½è¿›å±•å¦‚ä½•ï¼Ÿ</h3>
<p>å®˜æ–¹è¡¨ç¤ºï¼Œ ç›®å‰æ­£åœ¨è¿›è¡Œä¸­ï¼Œå¹¶ä¸”è¿›å±•å¾ˆå¤§ï¼Œæ¡Œé¢ç«¯å¤šçª—å£åŠŸèƒ½æŒç»­æœ‰ Canonical å¼€å‘è€…æ¨è¿›ï¼š</p>
<ul>
<li><strong>Windows å¹³å°</strong>ï¼šå·²æœ‰å¯ç”¨çš„å®éªŒæ€§ API</li>
<li><strong>Linux / macOS</strong>ï¼šæ­£åœ¨é€‚é…åˆå¹¶ä¸­</li>
</ul>
<p>è™½ç„¶å…¶å®ç°åœ¨å·²ç»æœ‰å¯ç”¨çš„ APIï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤šåº•å±‚åŸºç¡€éœ€è¦æ‰“åŒ…ï¼Œåç»­çš„é‡ç‚¹åŒ…æ‹¬ï¼šå¯è®¿é—®æ€§ï¼ˆaccessibilityï¼‰ã€æ–‡æœ¬è¾“å…¥ã€å­çª—å£ï¼ˆchild windowsï¼‰ä¸æ¨¡æ€å¯¹è¯æ¡†ï¼ˆmodal dialogsï¼‰çš„ä¼˜åŒ–ã€‚</p>
<blockquote>
<p>ç›®æ ‡è‚¯å®šæ˜¯å¸Œæœ›æ¡Œé¢ç«¯æœ€ç»ˆèƒ½æä¾›åŸç”Ÿåº”ç”¨é‚£æ ·å¼¹å‡ºç‹¬ç«‹çª—å£ï¼ˆä¾‹å¦‚æµ®åŠ¨èœå•ã€è°ƒè¯•é¢æ¿ç­‰ï¼‰ã€‚</p>
</blockquote>
<h3 data-id="heading-5">3ã€ä»€ä¹ˆæ—¶å€™æ¡Œé¢å’Œ Web å¹³å°çš„æ ¸å¿ƒæ’ä»¶èƒ½ä¸ç§»åŠ¨ç«¯ä¿æŒä¸€è‡´ï¼Ÿ</h3>
<p>å®˜æ–¹è¡¨ç¤ºï¼Œå…¶å®ä»–ä»¬çŸ¥é“è¿™æ˜¯ä¸€ç›´ä»¥æ¥çš„ç—›ç‚¹ï¼Œè€Œå›¢é˜Ÿæ­£åœ¨é€šè¿‡ Federated Plugins æ¥å¡«è¡¥å¹³å°æ”¯æŒçš„ç©ºæ¥å°è¯•è§£å†³ï¼š</p>
<ul>
<li>å…è®¸ç¤¾åŒº/å‚å•†åˆ†åˆ«ç»´æŠ¤å¹³å°å­å®ç°</li>
<li>å®˜æ–¹æä¾›ç»Ÿä¸€æ¥å£ä¸éªŒè¯</li>
</ul>
<p>è¿™æ ·çš„è¯ç¤¾åŒºå¯ä¸º macOS / Web / Linux ç­‰è¡¥é½å®ç°ï¼Œè€Œç›®å‰å®˜æ–¹æ­£ä¼˜åŒ–ç›¸å…³çš„å‘å¸ƒæµç¨‹ã€ä»£ç å®¡æ ¸å’Œè´¨é‡æ ‡å‡†ã€‚</p>
<h3 data-id="heading-6">4ã€Native Interop (FFI Gen) ä»€ä¹ˆæ—¶å€™å¯ç”¨</h3>
<p>å®˜æ–¹è¡¨ç¤º Native Interop æ˜å¹´å°†è¿›å…¥ Betaï¼Œæä¾›æ›´è‡ªåŠ¨åŒ–ã€æ›´å®‰å…¨çš„è·¨è¯­è¨€äº’æ“ä½œï¼Œé‚£ FFI Gen è§£å†³ä»€ä¹ˆï¼Ÿä¸»è¦æœ‰ï¼š</p>
<ul>
<li>
<p>è‡ªåŠ¨æŠŠ C/C++/Objective-C/Swift/Java/Kotlin çš„å£°æ˜è½¬æ¢æˆ Dart API</p>
</li>
<li>
<p>å‡å°‘æ‰‹å†™ FFI binding çš„ç—›è‹¦</p>
</li>
<li>
<p>æ›´å°‘é”™è¯¯ï¼ˆç±»å‹å¯¹é½ã€å†…å­˜æ³„æ¼ç­‰ï¼‰</p>
</li>
<li>
<p>æœ‰å®˜æ–¹ workflow å’Œå®‰å…¨çº¦æŸæ£€æŸ¥</p>
</li>
<li>
<p>ä¸»è¦ç”¨äºï¼š</p>
<ul>
<li>å¤šåª’ä½“åº“</li>
<li>åŸç”Ÿæ¸²æŸ“å™¨</li>
<li>åŠ å¯†åº“</li>
<li>è‡ªç ”åº•å±‚ SDK</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">5ã€ARM Windows/Linux æ”¯æŒ</h3>
<p>å®˜æ–¹è¡¨ç¤ºï¼Œè¿™ä¸ªæ²¡æœ‰ç¨³å®šæ—¶é—´è¡¨ï¼Œå› ä¸º ARM Windows å¸‚å ä¸é«˜ï¼Œå¹¶ä¸” QA æˆæœ¬æé«˜ï¼Œå¤šå¹³å° CI æ”¯æŒè¿˜éœ€è¦éœ€è¦æ‰©å®¹ï¼Œä»ç›®å‰æ¥çœ‹ï¼Œä¸å¤§å¯èƒ½æœ‰æ–°çš„æŠ•å…¥ã€‚</p>
<h3 data-id="heading-8">6ã€Flutter Web æœªæ¥ (Wasm/SEO)</h3>
<p>å®˜æ–¹è¡¨ç¤ºï¼Œç›®å‰é‡ç‚¹å·¥ä½œåœ¨äºæ”¹å–„ Web é›†æˆï¼ˆæ»šåŠ¨ã€æ–‡æœ¬è¾“å…¥ï¼‰ï¼Œä»¥åŠ Wasm æ–¹é¢çš„å·¥ä½œï¼ŒåŒ…æ‹¬æ”¯æŒå»¶è¿ŸåŠ è½½ (Deferred Loading)*å’Œå°†ç”Ÿæ€ç³»ç»Ÿè¿ç§»åˆ°æ–°çš„ JS Interop ã€‚</p>
<p>æ€»ç»“èµ·æ¥ï¼ŒWeb SEO ä»æ˜¯ Flutter Web çš„å¼±é¡¹ï¼ˆç»“æ„åŒ– HTMLï¼‰ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æœªæ¥éœ€è¦è°ƒæ•´çš„ï¼Œä½†æ˜¯çœ‹èµ·æ¥ä¸ä¼šæ˜¯è¿‘æœŸçš„ç›®æ ‡ï¼Œè€Œ Wasm-first æ¶æ„ä¸»è¦æ”¹å–„çš„æ˜¯æ€§èƒ½ã€å†…å­˜å’Œå¯åŠ¨é€Ÿåº¦ã€‚</p>
<h3 data-id="heading-9">7ã€BuildRunner æ€§èƒ½</h3>
<p>å®˜æ–¹è¡¨ç¤ºï¼Œå»ºè®®æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ (2.10+) å¯ä»¥å¾—åˆ°å¢é‡æ”¹è¿›ï¼Œæœ€é‡è¦çš„æ–°ç‰¹æ€§æ˜¯ <strong>AOT ç¼–è¯‘ BuildRunner ä»£ç </strong> (é€šè¿‡ opt-in æ ‡å¿—å¼€å¯)ï¼ŒæŸäº›æƒ…å†µä¸‹å¯æé€Ÿ <strong>5-10 å€</strong> ï¼Œæ–°ç‰¹æ€§åŒ…æ‹¬ï¼š</p>
<ul>
<li>å¯¹å…¶ codegen æ‰§è¡Œ AOT ç¼–è¯‘</li>
<li>å¤§å¹…å‡å°‘é‡å¤æ‰«æ</li>
<li>â€œå¢é‡æ„å»ºâ€ é‡åº¦ä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-10">8ã€è®¾è®¡è§£è€¦ (Design Decoupling)</h3>
<p>å®˜æ–¹è¡¨ç¤ºï¼ŒMaterial å’Œ Cupertino è§£æ„ï¼Œè®¡åˆ’æ˜¯å¹´åº•æ‹†åº•å±‚ã€æ˜å¹´åˆæ­£å¼ç‹¬ç«‹åŒ…ï¼Œå°† Material å’Œ Cupertino åº“ä»æ ¸å¿ƒ SDK ç§»å‡º ã€‚</p>
<h3 data-id="heading-11">9ã€Swift Package Manager (SPM)</h3>
<p>å®˜æ–¹è¡¨ç¤ºï¼ŒCocoapods è¿›å…¥ç»´æŠ¤æœŸï¼ŒSPM å°†æˆä¸ºæœªæ¥é»˜è®¤çš„ iOS åŒ…ç®¡ç†å·¥å…·ï¼Œè¿™ä¹Ÿæ˜¯ Apple çš„å¼ºæ¨æ–¹å‘ï¼Œå½“ç„¶ï¼Œåç»­ Plugin ç”Ÿæ€éœ€è¦å…¨éƒ¨è¿ç§»ä¸€éï¼Œè¿™ä¹Ÿæ˜¯æˆæœ¬ã€‚</p>
<h3 data-id="heading-12">10ã€<strong>AI ä¼šä¸ä¼šå–ä»£å¼€å‘è€…ï¼Ÿ</strong></h3>
<p>ç»“è®ºæ˜¯ä¸ä¼šï¼ŒAI æ˜¯å¢å¼ºè€Œä¸æ˜¯å–ä»£ï¼ŒGemini CLI è¿™ç§å·¥å…·æ˜¯å¼€å‘è€…åŠ é€Ÿå™¨ï¼Œå¯ä»¥å¯¹æ¯”ï¼š</p>
<ul>
<li>AI æ“…é•¿ï¼šé‡å¤ã€æ¯ç‡¥ã€æ‰¹é‡ä¿®æ”¹</li>
<li>äººç±»æ“…é•¿ï¼šç»“æ„ã€å†³ç­–ã€è®¾è®¡ã€äº¤äº’ä½“éªŒ</li>
</ul>
<p>Flutter å¼€å‘è€…æœªæ¥æ›´å¤šæ—¶é—´åº”è¯¥èŠ±åœ¨ï¼šæ¶æ„ã€äº¤äº’ã€Prompt è®¾è®¡å’Œ AI ååŒæµç¨‹ä¸Šã€‚</p>
<h3 data-id="heading-13">11ã€Native Assets / Hooks</h3>
<p>åŸ Native Assets åŠŸèƒ½åœ¨ 3.38 å·²æ­£å¼å‘å¸ƒï¼Œä½†æ”¹åä¸º Hooksï¼ŒHooks è§£å†³çš„é—®é¢˜ï¼š</p>
<ul>
<li>
<p>æä¾›æ„å»ºæœŸé’©å­</p>
</li>
<li>
<p>å¯æ¥å…¥ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰æ„å»ºè„šæœ¬</li>
<li>åŸç”Ÿèµ„äº§æ„å»º</li>
<li>è‡ªå®šä¹‰ç¼–è¯‘å™¨</li>
<li>ç”Ÿæˆ binding æ–‡ä»¶ç­‰</li>
</ul>
</li>
</ul>
<p>Dart å›¢é˜Ÿå†…éƒ¨è®¤ä¸º â€œHooksâ€ æ¯” â€œNative Assetsâ€ æ›´å‡†ç¡®ï¼ˆå› ä¸ºç”¨é€”ä¸æ­¢äºèµ„äº§ï¼‰ã€‚</p>
<h3 data-id="heading-14">12ã€å…¶ä»–é—®é¢˜</h3>
<h4 data-id="heading-15">ä¸ºä»€ä¹ˆ Flutter ä¸æ¨è‡ªå·±çš„çŠ¶æ€ç®¡ç†æ¡†æ¶</h4>
<p>å› ä¸ºè¿™ç­‰äºå®˜æ–¹è®¤å®šäº†æŸä¸ªæ–¹å‘æ‰æ˜¯å¯¹çš„ï¼Œè€Œç°åœ¨çŠ¶æ€ç®¡ç†æ¡†æ¶ç™¾èŠ±é½æ”¾ï¼Œä½ å¯ä»¥é€‰æ‹©ä½ è‡ªå·±çš„å–œå¥½ï¼Œè¿™æ‰æ˜¯å®˜æ–¹è®¤ä¸ºæœ€å¥½çš„çŠ¶æ€ã€‚</p>
<h4 data-id="heading-16">Flutter GPU æ˜¯å¦è¿˜åœ¨ç»§ç»­</h4>
<p>æ˜¯çš„ï¼Œä½†æ˜¯ç›®å‰æš‚åœäº†ï¼Œå› ä¸ºéœ€è¦è®© Impeller åœ¨å¯¹åº”å¹³å°æ›´ç¨³å®šæ›´æˆç†Ÿï¼Œæ‰èƒ½ç»™ Flutter GPU æä¾›æ›´å®ç”¨çš„åœºæ™¯æ”¯æŒã€‚</p>
<h4 data-id="heading-17">CanvasKit è¿˜èƒ½ç»§ç»­ç¼©å°å—ï¼Ÿ</h4>
<p>æš‚æ—¶ç»™ä¸å‡ºæ¥æ—¶é—´è¡¨ã€‚</p>
<h4 data-id="heading-18">Flutter æ˜¯å¦ä½¿ç”¨ Gemini å¤„ç†å’Œåˆ†ç±» Github é—®é¢˜</h4>
<p>æ˜¯çš„ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦æœ‰äººç›‘ç£ã€‚</p>
<h4 data-id="heading-19">augmentations æœ‰æ—¶é—´è¡¨å—</h4>
<p>augmentations å°±æ˜¯ä¸€ä¸ªæ–°è¯­è¨€ç‰¹æ€§ï¼Œå¯ä»¥æŠŠä¸€ä¸ªç±»æ‹†åˆ†åˆ°å¤šä¸ªæ–‡ä»¶ï¼Œç›®å‰è¿˜åœ¨æ¨è¿›ï¼Œç›®å‰è¿˜å‰©ä¸€äº›ç»†èŠ‚é—®é¢˜åœ¨è°ƒæ•´ï¼Œåº”è¯¥å¾ˆå¿«å¯ä»¥æ¨å‡ºã€‚</p>
<h4 data-id="heading-20">Dart å¯ä»¥å’Œ Kotlin ä¸€æ ·ä½¿ç”¨å¤šçº¿ç¨‹å—ï¼Ÿ</h4>
<p>Dart å…¶å®æœ‰å¤šçº¿ç¨‹ï¼Œæ”¯æŒå¤š isolate ã€isolate background ã€isolate group ï¼Œä½†æ˜¯è¦ä¸è¦å®ç°å†…å­˜å…±äº«ï¼Œè¿™ä¸ªç›®å‰è¿˜æ²¡æœ‰è®¡åˆ’ã€‚</p>
<h4 data-id="heading-21">jaspr æ˜¯å®˜æ–¹æ”¯æŒçš„å—ï¼Ÿ</h4>
<p>è¿™æ˜¯ä¸€ä¸ª GDE ç»´æŠ¤çš„é¡¹ç›®ï¼Œä¸€ä¸ªåŸºäº Dart çš„ DOM Web æ¡†æ¶ï¼ŒFlutter å›¢é˜Ÿå·²å°†å…¶è¿ç§»ç”¨äºæ–‡æ¡£åŸºç¡€è®¾æ–½ã€‚</p>
<h2 data-id="heading-22">æœ€å</h2>
<p>å…¶å®æœ¬æ¬¡ Flutter Flight Plans é‡Œï¼Œé™¤äº†å‘å¸ƒäº†å…¨æ–°ç‰ˆæœ¬çš„ Flutter å’Œ Dart ä¹‹å¤–ï¼Œå°±æ˜¯æœ¬æ¬¡ Q&amp;A ç¯èŠ‚æœ€æœ‰æ„ä¹‰ï¼Œè‡³å°‘åœ¨å®˜æ–¹çš„è§’åº¦è§£ç­”äº†è®¸å¤šå¤§å®¶å…³å¿ƒçš„é—®é¢˜ï¼Œå½“ç„¶ï¼Œç­‰ 2026 Flutter å®˜æ–¹å‘å¸ƒ Roadmap åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹çœ‹æ¥ä¸‹æ¥çš„æ‰¿è¯ºæ˜¯ä»€ä¹ˆã€‚</p>
<blockquote>
<p>å…³äº Gemini3ã€AntiGravity å’Œ Nona Banana Pro å¯è§ï¼š<a href="https://juejin.cn/post/7574745301725167622" target="_blank" title="https://juejin.cn/post/7574745301725167622">juejin.cn/post/757474â€¦</a></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fccdf9f932f04982b31d29196df272b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764544202&amp;x-signature=05GDya1EncPNYxEs7rvz9yOmZoI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FlutterUnit3.4.1 | æ¥åœºä¸‰æ–¹åº“çš„æ”¶å½•ç‹‚æ¬¢å§~]]></title>    <link>https://juejin.cn/post/7575413146922057743</link>    <guid>https://juejin.cn/post/7575413146922057743</guid>    <pubDate>2025-11-23T23:26:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146922057743" data-draft-id="7575162322241028096" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FlutterUnit3.4.1 | æ¥åœºä¸‰æ–¹åº“çš„æ”¶å½•ç‹‚æ¬¢å§~"/> <meta itemprop="keywords" content="Android,Flutter,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-23T23:26:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼ é£æ·ç‰¹çƒˆ"/> <meta itemprop="url" content="https://juejin.cn/user/149189281194766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FlutterUnit3.4.1 | æ¥åœºä¸‰æ–¹åº“çš„æ”¶å½•ç‹‚æ¬¢å§~
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189281194766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼ é£æ·ç‰¹çƒˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:26:04.000Z" title="Sun Nov 23 2025 23:26:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>å¯¹äºä¸€ä¸ªæŠ€æœ¯æ¡†æ¶çš„ç”Ÿæ€æ¥è¯´ï¼Œä¸‰æ–¹åº“æ˜¯éå¸¸éå¸¸é‡è¦çš„ã€‚Flutter çš„æœ‹å‹éƒ½çŸ¥é“ pub ä½œä¸ºå®˜æ–¹çš„ä»“åº“ï¼Œæœ‰æµ·é‡çš„ä¸‰æ–¹ç±»åº“ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚FlutterUnit ä½œä¸º Flutter æŠ€æœ¯çš„å‰æ²¿è¥åœ°ï¼Œæ‰“ç®—æ¨å‡ºä¸€ä¸ªæ–°çš„æ¨¡å—:</p>
<blockquote>
<p><strong>ä¸‰æ–¹åŒ…</strong> : åœ¨åº”ç”¨ä¸­ï¼Œæä¾›æ’ä»¶çš„æ¨èã€æœç´¢ã€åˆ†ç±»ã€è¯„ä»·ã€å›½é™…åŒ–ç­‰ï¼Œæ‹“å®½å¼€å‘è€…æ¥è§¦æ’ä»¶çš„å½¢å¼ã€‚è®©å¥½çš„ç±»åº“ä¸è¢«åŸ‹æ²¡ã€‚</p>
</blockquote>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19db757a1da44df5a1748b9cc30e049d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=971&amp;h=335&amp;s=39539&amp;e=png&amp;b=13212f" alt="" loading="lazy"/></p>
<h4 data-id="heading-0">1. åŠŸèƒ½ç®€ä»‹</h4>
<p>ä¹‹å‰çš„ç•™è¨€æ¿åŠŸèƒ½è¢«æ”¾åœ¨äº† <code>æˆ‘çš„</code> ä¸­ï¼Œä¸»ç•Œé¢çš„é»„é‡‘åœ°æ®µå¢åŠ äº† <code>ä¸‰æ–¹åº“</code> ä¸€æ ï¼Œç›®å‰æ”¶å½•äº†ä¸€ç™¾å¤šä¸ªå¸¸ç”¨çš„ä¸‰æ–¹ç±»åº“ã€‚å¹¶å°†è¿™äº›æ•°æ®æ”¶é›†åˆ°äº†æˆ‘çš„åç«¯ï¼Œå¹¶æä¾›äº†<strong>åˆ†ç±»å±•ç¤º</strong>å’Œ<strong>è¯„è®º</strong> ä¸¤å¤§åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥ç»™å¤§å®¶ä¸€ä¸ªè®¨è®ºç±»åº“çš„åœºåœ°ï¼ŒèŠèŠä½ å¯¹æ’ä»¶çš„çœ‹æ³•ï¼Œç”¨é€”ç­‰ã€‚</p>













<table><thead><tr><th>åŒ…ä¸»é¡µ</th><th>åŒ…è¯¦æƒ…</th></tr></thead><tbody><tr><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e67acff2e0cf4f7cbb45d93a4f114be6~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=437010&amp;e=png&amp;b=fefefe" alt="" loading="lazy"/></td><td><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d54ad10683647948a6fd2b2913a3914~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=504741&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></td></tr></tbody></table>
<hr/>
<p>å¦å¤–ï¼Œè¿˜æä¾›äº†æ¨èæ’ä»¶çš„å…¥å£ï¼Œä½¿ç”¨è€…å¯ä»¥åœ¨è¿™é‡Œæ¨èä¸€ä¸‹ç›®å‰æ²¡æœ‰æ”¶å½•ï¼Œä½†ä½ è§‰å¾—å¾ˆä¸é”™çš„æ’ä»¶ã€‚æ¬¢è¿åœ¨è¿™é‡Œå’Œå¤§å®¶å…±äº« ~<br/>
å¦å¤–æ”¯æŒæ ¹æ®ä¸‹è½½é‡ã€å–œæ¬¢æ•°ã€å‘å¸ƒæ—¶é—´è¿›è¡Œæ’åºã€‚</p>













<table><thead><tr><th>æ¨èåˆ›å»º</th><th>æ’åºæ–¹å¼</th></tr></thead><tbody><tr><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1233318a49e409d8fe43fe8adf9941f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=98299&amp;e=png&amp;b=f1f3f7" alt="" loading="lazy"/></td><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b7cadd98eb8463ca9f4b0030ef5055e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=249954&amp;e=png&amp;b=757575" alt="" loading="lazy"/></td></tr></tbody></table>
<hr/>
<p>æœ¬æ¬¡æœ€å¤§çš„äº®ç‚¹å½“å±è¯„è®ºäº†ï¼Œæ”¯æŒäºŒçº§è¯„è®ºï¼Œå¤§äºä¸¤æ¡çš„è¯„è®ºä¼šå±•ç¤ºæŸ¥çœ‹æ›´å¤šè¯„è®ºã€‚å¦‚æœè¯¦æƒ…é¡µè¯„è®ºæ€»æ•°å¤§äº 10 ï¼Œåº•éƒ¨ä¼šæœ‰æŸ¥çœ‹å…¨éƒ¨çš„è¯„è®ºï¼Œæ”¯æŒåˆ†é¡µåŠ è½½ï¼š</p>













<table><thead><tr><th>è¯¦æƒ…é¡µè¯„è®º</th><th>è¯„è®ºè¯¦æƒ…é¡µ</th></tr></thead><tbody><tr><td><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16115f495ad6420f9da52ca55410d591~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=226253&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></td><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f94e1b46abf64565aaeb7bbfbf3f8f34~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=194367&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-1">2. å…³äºåå°</h4>
<p>ç›®å‰åå°åŸºäº Rust åšçš„æœåŠ¡ï¼Œä¹ŸåŸºæœ¬å®Œæˆäº†æ¨¡å—åŒ–å¼€å‘ã€‚package æ¨¡å—è´Ÿè´£å½“å‰åŠŸèƒ½ç›¸å…³çš„æ‰€æœ‰æœåŠ¡æ¥å£çš„ã€‚æ”¯æŒç‹¬ç«‹æµ‹è¯•ã€‚åˆ†æ¨¡å—æœ€å¤§çš„å¥½å¤„æ˜¯åŠŸèƒ½éš”ç¦»ï¼Œè¿™æ · AI å¯ä»¥æ›´é«˜æ•ˆåœ°è¾…åŠ©ç¼–ç ï¼Œè€Œä¸”å¯ä»¥å‚è€ƒä¸€ä¸ªæ¨¡å—çš„åŠŸèƒ½ï¼Œå»å¼€å‘åˆ«çš„æ¨¡å—ã€‚ä¸‰æ–¹åº“ç›¸å…³çš„æ¥å£ 95% æ˜¯ç”± AI ç‹¬ç«‹å®Œæˆçš„ï¼š</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0cc1ebf429a8476f8ee41feceaafeb59~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1410&amp;h=807&amp;s=200149&amp;e=png&amp;b=fffefe" alt="" loading="lazy"/></p>
<p>ä¸å¾—ä¸è¯´ï¼Œè‡ªä»æ¢ä¸Šäº† rust æœåŠ¡ï¼Œæˆ‘çš„ 2G å†…å­˜çš„å°æœåŠ¡å™¨ä¹Ÿæ›´èƒ½æ‰“ä¸€äº›äº†ã€‚ä¹‹å‰ä½¿ç”¨ Java çš„ Springboot åšçš„æœåŠ¡ï¼Œä¸Šæ¥å°±å°å‡ ç™¾å…†ï¼Œç°åœ¨ rust è¿è¡Œå¾ˆä¹…ï¼Œä¹Ÿå°± 16 M.</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f5a68123efc4bff9885708f75ff5a7c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=938&amp;h=80&amp;s=16420&amp;e=png&amp;b=181818" alt="" loading="lazy"/></p>
<p>å’Œ AI è®¨è®ºæ•°æ®è¡¨çš„åˆ›å»ºï¼Œä¹Ÿè®©æˆ‘æ”¶ç›Šé¢‡ä¸°ã€‚ç‰¹åˆ«æ˜¯å¯¹äºå¤šè¯­è¨€çš„å¤„ç†ï¼Œåˆ†ç¦»å‡ºäº† <strong>t_pkg_translations</strong> è¡¨ï¼Œå¯ä»¥åœ¨ä¸ä¾µå…¥åŸè¡¨ç»“æ„çš„æƒ…å†µä¸‹ï¼Œå¢åŠ å­—æ®µçº§åˆ«çš„ç¿»è¯‘æ˜ å°„å…³ç³»ã€‚æ›´åˆ©äºå…¶ä»–å­—æ®µã€å…¶ä»–è¯­è¨€çš„æ”¯æŒ:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/256ac284b1ad46f9886ca47fd3f9ca08~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1146&amp;h=308&amp;s=49549&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/02df26142f46408cb72d0d331b74832a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1250&amp;h=387&amp;s=60413&amp;e=png&amp;b=fbfafa" alt="" loading="lazy"/></p>
<p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†æ•°æ®ï¼Œæˆ‘è¿˜è®© AI åŸºäº VUE é¡ºæ‰‹å†™äº†ä¸ªåç«¯ç®¡ç†ç³»ç»Ÿ ~</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c48a19af12274510b65e99f306793ec7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=2560&amp;h=1347&amp;s=182981&amp;e=png&amp;b=fefefe" alt="" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-2">3. å…³äºå‰ç«¯</h4>
<p>å‰ç«¯ä¹Ÿé‡‡ç”¨æ¨¡å—åŒ–å¼€å‘ï¼Œ<code>pkg_player</code> æ¨¡å—è´Ÿè´£è¯¥åŠŸèƒ½çš„æ‰€æœ‰é€»è¾‘å®ç°ï¼Œå¦å¤–å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ç‹¬ç«‹è¿è¡Œçš„æ¨¡å—ï¼Œè¿™å¯ä»¥è®©å®ƒå¯ä»¥ç‹¬ç«‹äº FlutterUnit è¿›è¡Œå¼€å‘ï¼Œå¼€å‘é˜¶æ®µåªéœ€è¦è¿è¡Œ exsample å³å¯ï¼Œå¯ä»¥è®© AI æ›´èšç„¦äºæ¯ä¸ªæ¨¡å—ï¼Œå‡å°‘å…¶ä»–ä¿¡æ¯å¹²æ‰°ã€‚å½“å®Œæˆå¼€å‘ï¼Œè¿›è¡Œç»„è£…åˆ° FlutterUnit å³å¯ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f96118aa2e540458a8911b9b2ea4ce2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1137&amp;h=683&amp;s=48593&amp;e=png&amp;b=eff6f9" alt="" loading="lazy"/></p>
<p>è¿™ç§å¯æ’æ‹”çš„æ¨¡å—åŒ–ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦å¤ç”¨æ¨¡å—ã€‚æ¯”å¦‚æœªæ¥æˆ‘æœ‰ä¸€ä¸ª <code>ç¼–ç¨‹è¥åœ°</code> çš„åº”ç”¨, åªéœ€è¦å¼•å…¥<code>pkg_player</code> æ¨¡å—ï¼Œç„¶åæ‹¼è£…ä¸€ä¸‹ï¼Œ ç¼–ç¨‹è¥åœ°å°±æœ‰äº†å½“å‰çš„ä¸‰æ–¹åº“çš„å±•ç¤ºå’Œäº¤æµèƒ½åŠ›ã€‚</p>
<hr/>
<p>ç”±äºå¼•å…¥äº† AI ç¼–ç¨‹ï¼Œæˆ‘å¸Œæœ›åƒæµæ°´çº¿ä¸€æ ·ï¼ŒAI å¯ä»¥æ ¹æ®æˆ‘çš„ä»£ç ç»„ç»‡ç»“æ„ï¼Œè¿›è¡Œä»£ç çš„äº§å‡ºã€‚ä½¿ç”¨æˆ‘è®¾è®¡äº†ä¸‰å±‚çš„ MVVM åº”ç”¨æ¶æ„ï¼Œå…¶ä¸­:</p>
<ul>
<li><strong>bloc</strong> çŠ¶æ€ç»´æŠ¤çš„è§†å›¾æ¨¡å‹å±‚,è´Ÿè´£ç»´æŠ¤æ•°æ®æµè½¬ã€‚</li>
<li><strong>repository</strong> æ•°æ®ä»“å‚¨å±‚ï¼Œè´Ÿè´£å®ä½“ç±»ç»´æŠ¤å’Œæ•°æ®è·å–ï¼Œæ¯”å¦‚ç½‘ç»œã€æ•°æ®åº“ç­‰ã€‚</li>
<li><strong>view</strong> è§†å›¾å±‚ï¼ŒåŸºäºè§†å›¾æ¨¡å‹ä¸­çš„æ•°æ®ï¼Œè¿›è¡Œç•Œé¢æ„å»ºï¼Œä»¥åŠç”¨æˆ·äº¤äº’äº‹ä»¶çš„å…¥å£ã€‚</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e22939ca0738479c9b749d31470e674c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1282&amp;h=646&amp;s=41251&amp;e=png&amp;b=f5f7fa" alt="" loading="lazy"/></p>
<p>æˆ‘çº¦å®šä¸€èˆ¬æƒ…å†µä¸‹ view å’Œ repository ä¹‹é—´ä¸ç›´æ¥ä¾èµ–ï¼Œå¦å¤– repository ä¸­çš„ä»£ç éœ€è¦æ”¯æŒ <strong>è„±ç¦»è§†å›¾å±‚</strong> ä¹Ÿå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œè¿™æ ·ä¾¿äºå•å…ƒæµ‹è¯•ã€‚</p>
<p>å‰ç«¯çš„ä»£ç å¤§æ¦‚ 80% ä¹Ÿæ˜¯ç”± AI å®Œæˆçš„ï¼Œä½†è¿™å¹¶ä¸ä»£è¡¨å¼€å‘è€…ä»€ä¹ˆéƒ½ä¸è¦å¹²ã€‚æˆ‘çš„è§’è‰²æ˜¯ä»æ•²ä»£ç çš„ï¼Œå˜æˆäº†æŒ‡æŒ¥ AI æ•²ä»£ç çš„ã€‚å¦‚ä½•è®¾è®¡æ•´ä½“çš„åŠŸèƒ½ã€äº¤äº’çš„ç»†èŠ‚ã€æ•°æ®çš„ç»“æœï¼Œè¿˜æ˜¯éœ€è¦èŠ±è´¹å¿ƒåŠ›çš„ã€‚</p>
<blockquote>
<p>æ³¨ï¼š AI çš„ä»£ç è´¨é‡å¯ä»¥è¯´ä¸­è§„ä¸­çŸ©ï¼Œè¿˜æ˜¯æœ‰äº›éœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ã€‚è‰¯å¥½çš„ç»“æ„ï¼Œå¯ä»¥è®© AI çš„æ´ªæ°´ä¸è‡³äºè‚†æ„è”“å»¶ã€‚çº¦æŸå®ƒï¼Œå¼•å¯¼å®ƒï¼Œå—ç”¨äºä½ ã€‚</p>
</blockquote>
<p>å¸Œæœ›æ¨¡å—åŒ–çš„å¼€å‘ç»“æ„ï¼Œå¯ä»¥åœ¨ AI çš„æµªæ½®ä¸‹ï¼Œè®©ä½ çš„ Flutter åº”ç”¨æ›´åŠ å†…èšï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€åˆæˆå¤ç”¨åŸåˆ™ã€‚ç›®å‰æ­£åœ¨æ ¹æ®å®è·µç»éªŒï¼Œè®¾è®¡ fx é€šç”¨åº”ç”¨æ¶æ„ï¼Œæ•¬è¯·æœŸå¾…~</p>
<hr/>
<h4 data-id="heading-3">4. å…³äºå›½é™…åŒ–</h4>
<p>ä¸ºäº†ä¾¿äºåŒ…æ”¯æŒæ¨¡å—åŒ–ï¼Œæˆ‘å†™äº†ä¸€ä¸ª dart è„šæœ¬ï¼Œå¯ä»¥åˆ†æç»Ÿè®¡æ¨¡å—ä¸­å­—ç¬¦ä¸²ï¼Œä½¿ç”¨çš„éè‹±æ–‡å­—ç¬¦ï¼ŒåŠå…¶åœ¨ä»£ç ä¸­çš„å…·ä½“ä½ç½®ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cc3c5bb26344b6aa7287ea2a2420521~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1565&amp;h=954&amp;s=166703&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></p>
<p>æœ€åè¿˜ä¼šç»Ÿè®¡æ‰€æœ‰ä¸åŒçš„å­—ç¬¦ä¸²ï¼š</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/643e3a4b64b94a89bcb4bce6607a2475~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1278&amp;h=696&amp;s=129858&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></p>
<p>ä½ å¯ä»¥æŠŠè¿™äº›ä¸¢ç»™ AI ï¼Œè®©å®ƒç”Ÿæˆ arb æ–‡ä»¶ï¼Œç„¶åæ ¹æ®ä¸­æ–‡ï¼Œå†å¾—åˆ°è‹±æ–‡ç¿»è¯‘ï¼š</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4e54fc69a5344cb083bc0117bb51297d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1317&amp;h=660&amp;s=81442&amp;e=png&amp;b=f9f9f9" alt="" loading="lazy"/></p>
<p>æœ€ç»ˆå°±ä¼šå¾—åˆ°å¯ç”¨çš„èµ„æºï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4aeb487702ca4fa3a9c9571918fc5357~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1019&amp;h=334&amp;s=18736&amp;e=png&amp;b=f3f5fa" alt="" loading="lazy"/></p>
<p>è¿™æ ·åœ¨æ•°æ®å±‚é¢å’Œæœ¬åœ°èµ„æºï¼Œéƒ½æ”¯æŒäº†å›½é™…åŒ–ï¼š</p>













<table><thead><tr><th>è‹±æ–‡</th><th>ä¸­æ–‡</th></tr></thead><tbody><tr><td><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1029410d7c87480591f22ef7ebc95d2f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=440960&amp;e=png&amp;b=fefefe" alt="" loading="lazy"/></td><td><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b792b94c5344398a9d821d3490088fe~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1080&amp;h=2400&amp;s=435716&amp;e=png&amp;b=fefefe" alt="" loading="lazy"/></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-4">4. å°¾å£°</h4>
<p>æ–‡ç« é‡Œå°±ä¸è¯´è¯¦ç»†çš„ä»£ç å®ç°äº†ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftoly1994328%2FFlutterUnit" target="_blank" title="https://github.com/toly1994328/FlutterUnit" ref="nofollow noopener noreferrer">FlutterUnit</a>  æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å»è¿è¡Œä½“éªŒã€‚æœ€åï¼ŒFlutterUnit3.4 ç‰ˆæœ¬ï¼Œ ä¸‰æ–¹åº“åŠŸèƒ½å·²ç»ä¸Šçº¿ï¼Œå¤§å®¶å¯ä»¥åœ¨ github ä¸Šæ›´æ–°æœ€æ–°ç‰ˆçš„è½¯ä»¶åŒ…ä½“éªŒï¼Œæ¬¢è¿å¤šå¤šäº¤æµï¼Œä¸ºä½ å–œæ¬¢çš„ä¸‰æ–¹åº“æ‰“ call ~</p>
<p>æ›´å¤šæ–‡ç« å’Œè§†é¢‘çŸ¥è¯†èµ„è®¯ï¼Œå¤§å®¶å¯ä»¥å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€æ˜é‡‘å’Œ B ç«™ ã€‚è®©æˆ‘ä»¬ä¸€èµ·æˆé•¿ï¼Œå˜å¾—æ›´å¼ºã€‚æˆ‘ä»¬ä¸‹æ¬¡å†è§~</p>
<ul>
<li><strong>é¸¿è’™çºªå…ƒ</strong> QQäº¤æµç¾¤ï¼š 727300436</li>
<li>æ˜é‡‘è´¦å·ï¼š <a href="https://juejin.cn/user/149189281194766" title="https://juejin.cn/user/149189281194766" target="_blank">å¼ é£æ·ç‰¹çƒˆ</a></li>
<li>bilibli è´¦å·ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fspace.bilibili.com%2F390457600" title="https://link.juejin.cn?target=https%3A%2F%2Fspace.bilibili.com%2F390457600" target="_blank">å¼ é£æ·ç‰¹çƒˆ</a></li>
<li>å…¬ä¼—å·ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq8Vs5i3SU-4QPoU3-0xOSg" title="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq8Vs5i3SU-4QPoU3-0xOSg" target="_blank">ç¼–ç¨‹ä¹‹ç‹</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»æºç åˆ°npmï¼šæ‰‹æŠŠæ‰‹å¸¦ä½ å‘å¸ƒVue 3ç»„ä»¶åº“]]></title>    <link>https://juejin.cn/post/7575937594338443305</link>    <guid>https://juejin.cn/post/7575937594338443305</guid>    <pubDate>2025-11-23T23:43:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575937594338443305" data-draft-id="7575468252657008681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»æºç åˆ°npmï¼šæ‰‹æŠŠæ‰‹å¸¦ä½ å‘å¸ƒVue 3ç»„ä»¶åº“"/> <meta itemprop="keywords" content="Vue.js,NPM,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-23T23:43:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰¯å±±æœ‰é£æ¥"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»æºç åˆ°npmï¼šæ‰‹æŠŠæ‰‹å¸¦ä½ å‘å¸ƒVue 3ç»„ä»¶åº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰¯å±±æœ‰é£æ¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:43:43.000Z" title="Sun Nov 23 2025 23:43:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿˜è®°å¾—ä¸Šæ¬¡ä¸ºäº†ç»Ÿä¸€å›¢é˜ŸUIé£æ ¼ï¼Œä½ ä¸å¾—ä¸æŠŠåŒä¸€ä¸ªæŒ‰é’®ç»„ä»¶å¤åˆ¶ç²˜è´´åˆ°åå‡ ä¸ªé¡¹ç›®é‡Œçš„ç—›è‹¦ç»å†å—ï¼Ÿæ¯æ¬¡ä¿®æ”¹éƒ½è¦åŒæ­¥æ›´æ–°æ‰€æœ‰é¡¹ç›®ï¼Œä¸€ä¸å°å¿ƒå°±æ¼æ‰ä¸€ä¸¤ä¸ªï¼Œæµ‹è¯•åŒäº‹è¿½ç€ä½ æ»¡å…¬å¸è·‘â€¦â€¦</p>
<p>ä»Šå¤©ï¼Œå’±ä»¬å°±æ¥å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼æˆ‘å°†å¸¦ä½ ä»é›¶å¼€å§‹ï¼Œç”¨æœ€æ–°çš„Viteå·¥å…·é“¾æ‰“åŒ…å¹¶å‘å¸ƒä¸€ä¸ªä¸“ä¸šçš„Vue 3ç»„ä»¶åº“ã€‚å­¦å®Œè¿™ç¯‡ï¼Œä½ å°±èƒ½åƒElement Plusé‚£æ ·ï¼Œè®©å›¢é˜Ÿé€šè¿‡ä¸€å¥<code>npm install</code>å°±èƒ½ä½¿ç”¨ä½ ç²¾å¿ƒæ‰“é€ çš„ç»„ä»¶åº“ã€‚</p>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆä½ éœ€è¦è‡ªå»ºç»„ä»¶åº“ï¼Ÿ</h2>
<p>å…ˆåˆ«æ€¥ç€å†™ä»£ç ï¼Œå’±ä»¬èŠèŠä¸ºä»€ä¹ˆè¿™äº‹å€¼å¾—ä½ èŠ±æ—¶é—´ã€‚æƒ³è±¡ä¸€ä¸‹è¿™äº›åœºæ™¯ï¼š</p>
<p>æ—©ä¸Šåˆšä¼˜åŒ–äº†æŒ‰é’®çš„ç‚¹å‡»åŠ¨æ•ˆï¼Œä¸‹åˆå°±è¦åœ¨äº”ä¸ªé¡¹ç›®é‡Œæ‰‹åŠ¨æ›´æ–°ï¼›è®¾è®¡å›¢é˜Ÿè°ƒæ•´äº†ä¸»è‰²è°ƒï¼Œä½ å¾—é€ä¸ªæ–‡ä»¶ä¿®æ”¹é¢œè‰²å˜é‡ï¼›æ–°äººæ¥æ‰‹é¡¹ç›®ï¼Œå› ä¸ºç»„ä»¶è§„èŒƒä¸ç»Ÿä¸€è€Œé¢‘é¢‘è¸©å‘â€¦â€¦</p>
<p>æœ‰äº†è‡ªå·±çš„ç»„ä»¶åº“ï¼Œè¿™äº›çƒ¦æ¼ç»Ÿç»Ÿæ¶ˆå¤±ï¼æ›´é‡è¦çš„æ˜¯ï¼Œè¿™è¿˜èƒ½æˆä¸ºä½ çš„æŠ€æœ¯åç‰‡â€”â€”æƒ³æƒ³çœ‹ï¼Œå½“é¢è¯•å®˜çœ‹åˆ°ä½ çš„GitHubä¸»é¡µæœ‰ä¸€ä¸ªè¢«ä¸‹è½½äº†å‡ åƒæ¬¡çš„ç»„ä»¶åº“æ—¶ï¼Œé‚£æ˜¯ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿ</p>
<h2 data-id="heading-1">ç¯å¢ƒå‡†å¤‡ä¸é¡¹ç›®åˆå§‹åŒ–</h2>
<p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚ç¡®ä¿ä½ çš„ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</p>
<p>Node.jsç‰ˆæœ¬18.0æˆ–æ›´é«˜ï¼Œè¿™æ˜¯Viteé¡ºç•…è¿è¡Œçš„åŸºç¡€ã€‚pnpmä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œå®ƒæ¯”npmæ›´å¿«æ›´èŠ‚çœç£ç›˜ç©ºé—´ã€‚</p>
<p>æ¥ä¸‹æ¥åˆ›å»ºé¡¹ç›®ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> vue3-component-library
<span class="hljs-built_in">cd</span> vue3-component-library
pnpm init
</code></pre>
<p>åˆå§‹åŒ–package.jsonåï¼Œå®‰è£…æ ¸å¿ƒä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add vue@^3.3.0
pnpm add -D vite@^5.0.0 @vitejs/plugin-vue
</code></pre>
<p>åˆ›å»ºåŸºç¡€çš„vite.config.jsé…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-comment">// ç»„ä»¶åº“å…¥å£æ–‡ä»¶è·¯å¾„</span>
<span class="hljs-keyword">const</span> entry = <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src/index.js'</span>)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">lib</span>: {
      entry,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'MyComponentLibrary'</span>,
      <span class="hljs-attr">fileName</span>: <span class="hljs-string">'my-component-library'</span>
    },
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-comment">// ç¡®ä¿å¤–éƒ¨åŒ–å¤„ç†é‚£äº›ä½ ä¸æƒ³æ‰“åŒ…è¿›åº“çš„ä¾èµ–</span>
      <span class="hljs-attr">external</span>: [<span class="hljs-string">'vue'</span>],
      <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">globals</span>: {
          <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>
        }
      }
    }
  }
})
</code></pre>
<p>è¿™ä¸ªé…ç½®å‘Šè¯‰Viteï¼šæˆ‘ä»¬è¦æ„å»ºä¸€ä¸ªåº“è€Œä¸æ˜¯åº”ç”¨ï¼ŒVueåº”è¯¥æ˜¯å¤–éƒ¨ä¾èµ–è€Œä¸æ‰“åŒ…è¿›æœ€ç»ˆäº§ç‰©ã€‚</p>
<h2 data-id="heading-2">è®¾è®¡ç»„ä»¶åº“ç›®å½•ç»“æ„</h2>
<p>æ¸…æ™°çš„ç›®å½•ç»“æ„æ˜¯æˆåŠŸçš„ä¸€åŠï¼è¿™æ˜¯æˆ‘æ¨èçš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">src/
â”œâ”€â”€ components/     <span class="hljs-meta"># æ‰€æœ‰ç»„ä»¶æºç </span>
â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”œâ”€â”€ Button.vue
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ Input/
â”‚       â”œâ”€â”€ Input.vue
â”‚       â””â”€â”€ index.js
â”œâ”€â”€ styles/         <span class="hljs-meta"># æ ·å¼æ–‡ä»¶</span>
â”‚   â”œâ”€â”€ <span class="hljs-keyword">base</span>.css    <span class="hljs-meta"># åŸºç¡€æ ·å¼</span>
â”‚   â””â”€â”€ components/ <span class="hljs-meta"># ç»„ä»¶æ ·å¼</span>
â”œâ”€â”€ utils/          <span class="hljs-meta"># å·¥å…·å‡½æ•°</span>
â””â”€â”€ index.js        <span class="hljs-meta"># ä¸»å…¥å£æ–‡ä»¶</span>
</code></pre>
<p>è®©æˆ‘è§£é‡Šå‡ ä¸ªå…³é”®ç‚¹ï¼šæ¯ä¸ªç»„ä»¶éƒ½æœ‰è‡ªå·±çš„ç›®å½•ï¼Œé‡Œé¢åŒ…å«Vueå•æ–‡ä»¶ç»„ä»¶å’Œå¯¼å‡ºæ–‡ä»¶ã€‚æ ·å¼é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤å’Œä¸»é¢˜å®šåˆ¶ã€‚</p>
<h2 data-id="heading-3">ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ªç»„ä»¶</h2>
<p>å’±ä»¬ä»æœ€å¸¸ç”¨çš„æŒ‰é’®ç»„ä»¶å¼€å§‹ã€‚åˆ›å»º<code>src/components/Button/Button.vue</code>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;button 
    :class="[
      'my-btn',
      `my-btn--${type}`,
      { 'my-btn--disabled': disabled }
    ]"
    :disabled="disabled"
    @click="handleClick"
  &gt;
    &lt;slot&gt;&lt;/slot&gt;
  &lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
// å®šä¹‰ç»„ä»¶æ¥æ”¶çš„å±æ€§
const props = defineProps({
  type: {
    type: String,
    default: 'default', // default, primary, danger
    validator: (value) =&gt; {
      return ['default', 'primary', 'danger'].includes(value)
    }
  },
  disabled: {
    type: Boolean,
    default: false
  }
})

// å®šä¹‰å‘å°„çš„äº‹ä»¶
const emit = defineEmits(['click'])

const handleClick = (event) =&gt; {
  if (!props.disabled) {
    emit('click', event)
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.my-btn {
  padding: 8px 16px;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  background: white;
  cursor: pointer;
  transition: all 0.3s;
}

.my-btn:hover {
  opacity: 0.8;
}

.my-btn--primary {
  background: #409eff;
  color: white;
  border-color: #409eff;
}

.my-btn--danger {
  background: #f56c6c;
  color: white;
  border-color: #f56c6c;
}

.my-btn--disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
&lt;/style&gt;
</code></pre>
<p>è¿™ä¸ªæŒ‰é’®ç»„ä»¶æ”¯æŒä¸‰ç§ç±»å‹å’Œç¦ç”¨çŠ¶æ€ï¼Œæ ·å¼é‡‡ç”¨BEMå‘½åè§„èŒƒï¼Œç¡®ä¿ç±»åæ¸…æ™°å¯ç»´æŠ¤ã€‚</p>
<p>æ¥ä¸‹æ¥åˆ›å»ºç»„ä»¶çš„å¯¼å‡ºæ–‡ä»¶<code>src/components/Button/index.js</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Button.vue'</span>

<span class="hljs-comment">// ä¸ºç»„ä»¶æ·»åŠ installæ–¹æ³•ï¼Œä½¿å…¶èƒ½å¤Ÿè¢«Vue.use()ä½¿ç”¨</span>
<span class="hljs-title class_">Button</span>.<span class="hljs-property">install</span> = <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> {
  app.<span class="hljs-title function_">component</span>(<span class="hljs-title class_">Button</span>.<span class="hljs-property">name</span>, <span class="hljs-title class_">Button</span>)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Button</span>
</code></pre>
<p>installæ–¹æ³•å¾ˆé‡è¦ï¼å®ƒè®©ç”¨æˆ·å¯ä»¥é€šè¿‡<code>app.use(YourComponent)</code>çš„æ–¹å¼å…¨å±€æ³¨å†Œç»„ä»¶ã€‚</p>
<h2 data-id="heading-4">æ„å»ºç»„ä»¶åº“å…¥å£æ–‡ä»¶</h2>
<p>ç°åœ¨æ˜¯æ—¶å€™æŠŠå„ä¸ªç»„ä»¶ç»Ÿä¸€å¯¼å‡ºäº†ã€‚åˆ›å»º<code>src/index.js</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯¼å…¥æ‰€æœ‰ç»„ä»¶</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Button'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Input</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Input'</span>

<span class="hljs-comment">// ç»„ä»¶åˆ—è¡¨</span>
<span class="hljs-keyword">const</span> components = [
  <span class="hljs-title class_">Button</span>,
  <span class="hljs-title class_">Input</span>
]

<span class="hljs-comment">// å®šä¹‰installæ–¹æ³•ï¼Œæ¥æ”¶Vueå®ä¾‹ä½œä¸ºå‚æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">install</span> = (<span class="hljs-params">app</span>) =&gt; {
  <span class="hljs-comment">// éå†æ³¨å†Œæ‰€æœ‰ç»„ä»¶</span>
  components.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">component</span> =&gt;</span> {
    app.<span class="hljs-title function_">component</span>(component.<span class="hljs-property">name</span>, component)
  })
}

<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ç›´æ¥é€šè¿‡scriptæ ‡ç­¾å¼•å…¥ï¼Œå¦‚æœæ˜¯ï¼Œä¼šè‡ªåŠ¨å®‰è£…</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>) {
  <span class="hljs-title function_">install</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>)
}

<span class="hljs-comment">// å¯¼å‡ºinstallæ–¹æ³•å’Œæ‰€æœ‰ç»„ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  install,
  <span class="hljs-title class_">Button</span>,
  <span class="hljs-title class_">Input</span>
}

<span class="hljs-comment">// æŒ‰éœ€å¯¼å‡ºå„ä¸ªç»„ä»¶</span>
<span class="hljs-keyword">export</span> {
  <span class="hljs-title class_">Button</span>,
  <span class="hljs-title class_">Input</span>
}
</code></pre>
<p>è¿™ç§è®¾è®¡è®©ç”¨æˆ·å¯ä»¥é€‰æ‹©å…¨é‡å¼•å…¥æˆ–æŒ‰éœ€å¼•å…¥ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚</p>
<h2 data-id="heading-5">é…ç½®å¤šç§æ„å»ºæ ¼å¼</h2>
<p>ä¸åŒçš„ä½¿ç”¨åœºæ™¯éœ€è¦ä¸åŒçš„æ„å»ºæ ¼å¼ã€‚æ›´æ–°vite.config.jsï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">lib</span>: {
      <span class="hljs-attr">entry</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src/index.js'</span>),
      <span class="hljs-attr">name</span>: <span class="hljs-string">'MyComponentLibrary'</span>,
      <span class="hljs-comment">// ç”Ÿæˆå¤šç§æ ¼å¼çš„æ–‡ä»¶</span>
      <span class="hljs-attr">fileName</span>: <span class="hljs-function">(<span class="hljs-params">format</span>) =&gt;</span> <span class="hljs-string">`my-component-library.<span class="hljs-subst">${format}</span>.js`</span>
    },
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">external</span>: [<span class="hljs-string">'vue'</span>],
      <span class="hljs-attr">output</span>: [
        {
          <span class="hljs-attr">format</span>: <span class="hljs-string">'es'</span>, <span class="hljs-comment">// ESæ¨¡å—æ ¼å¼ï¼Œé€‚åˆç°ä»£æ‰“åŒ…å·¥å…·</span>
          <span class="hljs-attr">globals</span>: {
            <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>
          }
        },
        {
          <span class="hljs-attr">format</span>: <span class="hljs-string">'umd'</span>, <span class="hljs-comment">// é€šç”¨æ¨¡å—å®šä¹‰ï¼Œé€‚åˆscriptæ ‡ç­¾ç›´æ¥å¼•å…¥</span>
          <span class="hljs-attr">globals</span>: {
            <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>
          }
        },
        {
          <span class="hljs-attr">format</span>: <span class="hljs-string">'cjs'</span>, <span class="hljs-comment">// CommonJSæ ¼å¼ï¼Œé€‚åˆNodeç¯å¢ƒ</span>
          <span class="hljs-attr">globals</span>: {
            <span class="hljs-attr">vue</span>: <span class="hljs-string">'Vue'</span>
          }
        }
      ]
    }
  }
})
</code></pre>
<p>ç°åœ¨è¿è¡Œ<code>pnpm build</code>ï¼Œä½ ä¼šåœ¨distç›®å½•çœ‹åˆ°ä¸‰ç§æ ¼å¼çš„æ–‡ä»¶ï¼Œæ»¡è¶³å„ç§ä½¿ç”¨éœ€æ±‚ã€‚</p>
<h2 data-id="heading-6">æ ·å¼æ„å»ºä¸ä¼˜åŒ–</h2>
<p>ç»„ä»¶åº“çš„æ ·å¼å¤„ç†å¾ˆå…³é”®ã€‚æˆ‘ä»¬åˆ›å»ºå•ç‹¬çš„æ ·å¼æ„å»ºæµç¨‹ï¼š</p>
<p>é¦–å…ˆå®‰è£…ç›¸å…³ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D sass
</code></pre>
<p>åˆ›å»ºæ„å»ºæ ·å¼çš„è„šæœ¬<code>scripts/build-styles.js</code>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)

<span class="hljs-comment">// é€’å½’è¯»å–ç›®å½•ä¸‹çš„æ‰€æœ‰scssæ–‡ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">readStyles</span>(<span class="hljs-params">dir</span>) {
  <span class="hljs-keyword">let</span> results = []
  <span class="hljs-keyword">const</span> list = fs.<span class="hljs-title function_">readdirSync</span>(dir)
  
  list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(dir, file)
    <span class="hljs-keyword">const</span> stat = fs.<span class="hljs-title function_">statSync</span>(filePath)
    
    <span class="hljs-keyword">if</span> (stat &amp;&amp; stat.<span class="hljs-title function_">isDirectory</span>()) {
      results = results.<span class="hljs-title function_">concat</span>(<span class="hljs-title function_">readStyles</span>(filePath))
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (file.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.scss'</span>) || file.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.css'</span>)) {
      results.<span class="hljs-title function_">push</span>(filePath)
    }
  })
  
  <span class="hljs-keyword">return</span> results
}

<span class="hljs-comment">// æ„å»ºå®Œæ•´æ ·å¼æ–‡ä»¶</span>
<span class="hljs-keyword">const</span> styleFiles = <span class="hljs-title function_">readStyles</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'../src/styles'</span>))
<span class="hljs-keyword">let</span> fullStyleContent = <span class="hljs-string">''</span>

styleFiles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> content = fs.<span class="hljs-title function_">readFileSync</span>(file, <span class="hljs-string">'utf-8'</span>)
  fullStyleContent += content + <span class="hljs-string">'\n'</span>
})

<span class="hljs-comment">// å†™å…¥æ€»æ ·å¼æ–‡ä»¶</span>
<span class="hljs-keyword">const</span> outputPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'../dist/style.css'</span>)
fs.<span class="hljs-title function_">writeFileSync</span>(outputPath, fullStyleContent)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ ·å¼æ„å»ºå®Œæˆï¼'</span>)
</code></pre>
<p>ç„¶ååœ¨package.jsonä¸­æ·»åŠ æ„å»ºå‘½ä»¤ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build &amp;&amp; node scripts/build-styles.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">å®Œå–„package.jsoné…ç½®</h2>
<p>å‘å¸ƒå‰ï¼Œæˆ‘ä»¬éœ€è¦å®Œå–„package.jsonçš„é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-component-library"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A Vue 3 component library built with Vite"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-component-library.umd.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-component-library.es.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-component-library.es.js"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/my-component-library.umd.js"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./style.css"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./dist/style.css"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"vue3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"component-library"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"ui"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"peerDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.3.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å…³é”®å­—æ®µè¯´æ˜ï¼šmainæŒ‡å‘CommonJSç‰ˆæœ¬ï¼ŒmoduleæŒ‡å‘ESæ¨¡å—ç‰ˆæœ¬ï¼ŒfilesæŒ‡å®šå‘å¸ƒæ—¶åŒ…å«çš„æ–‡ä»¶ã€‚</p>
<h2 data-id="heading-8">TypeScriptæ”¯æŒ</h2>
<p>ç°åœ¨å¤§å®¶éƒ½ç”¨TypeScriptï¼Œå’±ä»¬çš„ç»„ä»¶åº“ä¹Ÿè¦æä¾›ç±»å‹æ”¯æŒã€‚é¦–å…ˆå®‰è£…ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D typescript @vue/tsconfig-node
</code></pre>
<p>åˆ›å»º<code>tsconfig.json</code>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"useDefineForClassFields"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lib"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ES2020"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"DOM"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"DOM.Iterable"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"skipLibCheck"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bundler"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"allowImportingTsExtensions"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"resolveJsonModule"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"isolatedModules"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noEmit"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"jsx"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"preserve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUnusedLocals"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUnusedParameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noFallthroughCasesInSwitch"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"declaration"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/*.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.d.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.vue"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä¸ºæŒ‰é’®ç»„ä»¶æ·»åŠ ç±»å‹å®šä¹‰<code>src/components/Button/types.ts</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> {
  <span class="hljs-keyword">type</span>?: <span class="hljs-string">'default'</span> | <span class="hljs-string">'primary'</span> | <span class="hljs-string">'danger'</span>
  disabled?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonEmits</span> {
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'click'</span>, <span class="hljs-attr">event</span>: <span class="hljs-title class_">MouseEvent</span>): <span class="hljs-built_in">void</span>
}
</code></pre>
<p>æ›´æ–°Button.vueä½¿ç”¨TypeScriptï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import type { ButtonProps, ButtonEmits } from './types'

defineProps&lt;ButtonProps&gt;()
const emit = defineEmits&lt;ButtonEmits&gt;()

const handleClick = (event: MouseEvent) =&gt; {
  emit('click', event)
}
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-9">æœ¬åœ°æµ‹è¯•ä¸è°ƒè¯•</h2>
<p>å‘å¸ƒå‰ä¸€å®šè¦å……åˆ†æµ‹è¯•ï¼åˆ›å»ºæ¼”ç¤ºåº”ç”¨<code>playground/</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> playground
<span class="hljs-built_in">cd</span> playground
pnpm create vite . --template vue
</code></pre>
<p>åœ¨æ¼”ç¤ºé¡¹ç›®ä¸­é“¾æ¥æœ¬åœ°ç»„ä»¶åº“ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"my-component-library"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"file:../"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åˆ›å»ºæµ‹è¯•é¡µé¢<code>playground/src/App.vue</code>ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="playground"&gt;
    &lt;h1&gt;ç»„ä»¶åº“æµ‹è¯•é¡µé¢&lt;/h1&gt;
    &lt;MyButton type="primary" @click="handleClick"&gt;
      ä¸»è¦æŒ‰é’®
    &lt;/MyButton&gt;
    &lt;MyButton type="danger" disabled&gt;
      ç¦ç”¨æŒ‰é’®
    &lt;/MyButton&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { MyButton } from 'my-component-library'

const handleClick = () =&gt; {
  console.log('æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼')
}
&lt;/script&gt;
</code></pre>
<p>è¿™æ ·ä½ å°±èƒ½å®æ—¶æµ‹è¯•ç»„ä»¶æ•ˆæœäº†ã€‚</p>
<h2 data-id="heading-10">å‘å¸ƒåˆ°npm</h2>
<p>æµ‹è¯•é€šè¿‡åï¼Œå°±å¯ä»¥å‘å¸ƒäº†ï¼é¦–å…ˆåœ¨npmå®˜ç½‘æ³¨å†Œè´¦å·ï¼Œç„¶ååœ¨ç»ˆç«¯ç™»å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm login
</code></pre>
<p>æ„å»ºæœ€ç»ˆç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm build
</code></pre>
<p>å‘å¸ƒï¼</p>
<pre><code class="hljs language-bash" lang="bash">npm publish
</code></pre>
<p>å¦‚æœè¿™æ˜¯ç§æœ‰åŒ…æƒ³å…ˆæµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm publish --tag beta
</code></pre>
<h2 data-id="heading-11">è‡ªåŠ¨åŒ–ä¸æŒç»­é›†æˆ</h2>
<p>æ‰‹åŠ¨å‘å¸ƒå¤ªéº»çƒ¦äº†ï¼Œå’±ä»¬é…ç½®GitHub Actionsè‡ªåŠ¨åŒ–æµç¨‹ã€‚åˆ›å»º<code>.github/workflows/publish.yml</code>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Publish</span> <span class="hljs-string">to</span> <span class="hljs-string">npm</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'v*'</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">publish:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">'18'</span>
          <span class="hljs-attr">registry-url:</span> <span class="hljs-string">'https://registry.npmjs.org'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">pnpm</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">publish</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">NODE_AUTH_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NPM_TOKEN</span> <span class="hljs-string">}}</span>
</code></pre>
<p>è¿™æ ·æ¯æ¬¡æ‰“tagæ—¶å°±ä¼šè‡ªåŠ¨å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚</p>
<h2 data-id="heading-12">ç‰ˆæœ¬ç®¡ç†ç­–ç•¥</h2>
<p>é‡‡ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼ˆMAJOR.MINOR.PATCHï¼‰</p>
<ul>
<li>ä¿®è®¢å·ï¼šå‘åå…¼å®¹çš„é—®é¢˜ä¿®å¤</li>
<li>æ¬¡ç‰ˆæœ¬å·ï¼šå‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢</li>
<li>ä¸»ç‰ˆæœ¬å·ï¼šä¸å…¼å®¹çš„APIä¿®æ”¹</li>
</ul>
<p>ä½¿ç”¨npm versionå‘½ä»¤ç®¡ç†ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm version patch  <span class="hljs-comment"># 1.0.0 -&gt; 1.0.1</span>
npm version minor  <span class="hljs-comment"># 1.0.0 -&gt; 1.1.0  </span>
npm version major  <span class="hljs-comment"># 1.0.0 -&gt; 2.0.0</span>
</code></pre>
<h2 data-id="heading-13">é«˜çº§æŠ€å·§ï¼šæŒ‰éœ€åŠ è½½ä¸Tree Shaking</h2>
<p>ä¸ºäº†è®©ç”¨æˆ·èƒ½æŒ‰éœ€å¼•å…¥ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®unplugin-vue-componentsï¼š</p>
<p>é¦–å…ˆåœ¨ç»„ä»¶åº“ä¸­åˆ›å»º<code>components.d.ts</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">App</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GlobalComponents</span> {
  <span class="hljs-title class_">MyButton</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/Button'</span>)[<span class="hljs-string">'default'</span>]
  <span class="hljs-title class_">MyInput</span>: <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/Input'</span>)[<span class="hljs-string">'default'</span>]
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">install</span>: <span class="hljs-function">(<span class="hljs-params">app: App</span>) =&gt;</span> <span class="hljs-built_in">void</span>
</code></pre>
<p>ç„¶ååœ¨ç”¨æˆ·é¡¹ç›®ä¸­é…ç½®vite.config.jsï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Components</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'unplugin-vue-components/vite'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyComponentLibraryResolver</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'my-component-library/resolver'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title class_">Components</span>({
      <span class="hljs-attr">resolvers</span>: [<span class="hljs-title class_">MyComponentLibraryResolver</span>()]
    })
  ]
})
</code></pre>
<h2 data-id="heading-14">å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<p><strong>é—®é¢˜1ï¼šç»„ä»¶æ ·å¼ä¸ç”Ÿæ•ˆ</strong>
è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿ç”¨æˆ·æ­£ç¡®å¼•å…¥äº†æ ·å¼æ–‡ä»¶ï¼Œæˆ–åœ¨ç»„ä»¶åº“ä¸­é…ç½®æ ·å¼å†…è”ã€‚</p>
<p><strong>é—®é¢˜2ï¼šTypeScriptç±»å‹æŠ¥é”™</strong>
è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥ç±»å‹å¯¼å‡ºé…ç½®ï¼Œç¡®ä¿declaration: trueä¸”ç±»å‹æ–‡ä»¶åœ¨æ‰“åŒ…èŒƒå›´å†…ã€‚</p>
<p><strong>é—®é¢˜3ï¼šæ„å»ºäº§ç‰©è¿‡å¤§</strong>
è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨rollup-plugin-visualizeråˆ†æåŒ…å¤§å°ï¼Œå¤–éƒ¨åŒ–ä¾èµ–ï¼Œä»£ç åˆ†å‰²ã€‚</p>
<h2 data-id="heading-15">ç»´æŠ¤ä¸è¿­ä»£</h2>
<p>ç»„ä»¶åº“å‘å¸ƒåï¼Œç»´æŠ¤å·¥ä½œæ‰åˆšåˆšå¼€å§‹ï¼š</p>
<p>å»ºç«‹å˜æ›´æ—¥å¿—CHANGELOG.mdï¼Œè®°å½•æ¯ä¸ªç‰ˆæœ¬çš„æ”¹åŠ¨ã€‚æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œå»ºç«‹Issueæ¨¡æ¿ã€‚å®šæœŸæ›´æ–°ä¾èµ–ï¼Œä¿æŒæŠ€æœ¯æ ˆçš„ç°ä»£æ€§ã€‚ç¼–å†™å®Œå–„çš„æ–‡æ¡£ï¼ŒåŒ…æ‹¬åœ¨çº¿æ¼”ç¤ºå’ŒAPIæ–‡æ¡£ã€‚</p>
<p>ç°åœ¨ï¼Œä½ å·²ç»æŒæ¡äº†Vue 3ç»„ä»¶åº“ä»å¼€å‘åˆ°å‘å¸ƒçš„å®Œæ•´æµç¨‹ã€‚ä»ä»Šå¤©å¼€å§‹ï¼ŒæŠŠé‚£äº›é‡å¤çš„ç»„ä»¶ä»£ç å˜æˆå¯å¤ç”¨çš„è´¢å¯Œå§ï¼</p>
<p>è¿˜è®°å¾—å¼€å¤´é‚£ä¸ªè¢«æµ‹è¯•åŒäº‹è¿½ç€è·‘çš„å°´å°¬åœºæ™¯å—ï¼Ÿç°åœ¨ä½ å¯ä»¥ä¼˜é›…åœ°å‘Šè¯‰ä»–ï¼š"å»npmä¸Šæ›´æ–°ä¸€ä¸‹ç»„ä»¶åº“ç‰ˆæœ¬å°±è¡Œ"ã€‚è¿™ç§æ„Ÿè§‰ï¼Œæ˜¯ä¸æ˜¯æ¯”å¤åˆ¶ç²˜è´´çˆ½å¤šäº†ï¼Ÿ</p>
<p>å¦‚æœä½ åœ¨å®è·µè¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€åˆ†äº«ä½ çš„ç»å†ã€‚ä¹Ÿåˆ«å¿˜äº†æŠŠè¿™ä¸ªå·¥ä½œæµç¨‹åˆ†äº«ç»™é‚£äº›è¿˜åœ¨æ‰‹åŠ¨ç»´æŠ¤ç»„ä»¶çš„å°ä¼™ä¼´ä»¬ï¼Œè®©ä»–ä»¬ä¹Ÿä½“éªŒä¸€ä¸‹"ä¸€æ¬¡æ„å»ºï¼Œå¤„å¤„ä½¿ç”¨"çš„ç•…å¿«æ„Ÿï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonç¼–ç¨‹å®æˆ˜ï¼šPythonå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨ï¼ˆè¶…å…¨æ•´ç†ï¼‰]]></title>    <link>https://juejin.cn/post/7575456858427523118</link>    <guid>https://juejin.cn/post/7575456858427523118</guid>    <pubDate>2025-11-23T23:52:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858427523118" data-draft-id="7575456858427506734" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonç¼–ç¨‹å®æˆ˜ï¼šPythonå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨ï¼ˆè¶…å…¨æ•´ç†ï¼‰"/> <meta itemprop="keywords" content="åç«¯,Python,Trae"/> <meta itemprop="datePublished" content="2025-11-23T23:52:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonç¼–ç¨‹å®æˆ˜ï¼šPythonå¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨ï¼ˆè¶…å…¨æ•´ç†ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T23:52:15.000Z" title="Sun Nov 23 2025 23:52:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨ Python å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šå‘½ä»¤ä¸å·¥å…·æ“ä½œå¾ˆå®¹æ˜“å¿˜è®°ã€‚æ— è®ºä½ æ˜¯æ–°æ‰‹è¿˜æ˜¯ç»éªŒå¼€å‘è€…ï¼Œæ‹¥æœ‰ä¸€ä»½éšæ‰‹å¯æŸ¥çš„â€œå‘½ä»¤é€ŸæŸ¥è¡¨â€éƒ½èƒ½æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ã€‚</p>
</blockquote>
<p>æœ¬ç¯‡æ–‡ç« æ€»ç»“äº† <strong>Pythonã€pipã€è™šæ‹Ÿç¯å¢ƒã€åŒ…ç®¡ç†ã€æ–‡ä»¶æ“ä½œã€è°ƒè¯•ã€æ ¼å¼åŒ–ã€æ€§èƒ½æµ‹è¯•ã€ä»£ç æ£€æŸ¥</strong> ç­‰å¸¸ç”¨å‘½ä»¤ï¼Œæ˜¯ä¸€ä»½è¦†ç›–é¢éå¸¸å…¨é¢çš„ Python å¼€å‘å¿…å¤‡å¤‡å¿˜å½•ã€‚</p>
<p>ä½ å¯ä»¥å°†æ­¤æ–‡åŠ å…¥æ”¶è—å¤¹æˆ–åšæˆä¸€é¡µçº¸éšèº«æ–‡æ¡£ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. Python å‘½ä»¤é€ŸæŸ¥</h2>
<h4 data-id="heading-1"><strong>åŸºç¡€å‘½ä»¤</strong></h4>





























<table><thead><tr><th>ç”¨é€”</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>æŸ¥çœ‹ Python ç‰ˆæœ¬</td><td><code>python --version</code> / <code>python3 --version</code></td></tr><tr><td>è¿›å…¥äº¤äº’å¼è§£é‡Šå™¨</td><td><code>python</code></td></tr><tr><td>æ‰§è¡Œè„šæœ¬</td><td><code>python script.py</code></td></tr><tr><td>æ‰§è¡Œä¸€è¡Œä»£ç </td><td><code>python -c "print('hello')"</code></td></tr><tr><td>ä»¥æ¨¡å—æ–¹å¼è¿è¡Œ</td><td><code>python -m http.server 8000</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">2. pip åŒ…ç®¡ç†å‘½ä»¤</h2>
<h4 data-id="heading-3"><strong>åŸºæœ¬æ“ä½œ</strong></h4>





































<table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>æŸ¥çœ‹ pip ç‰ˆæœ¬</td><td><code>pip --version</code></td></tr><tr><td>å®‰è£…åŒ…</td><td><code>pip install package_name</code></td></tr><tr><td>å®‰è£…å›ºå®šç‰ˆæœ¬åŒ…</td><td><code>pip install package==1.2.3</code></td></tr><tr><td>å‡çº§åŒ…</td><td><code>pip install --upgrade package</code></td></tr><tr><td>å¸è½½åŒ…</td><td><code>pip uninstall package</code></td></tr><tr><td>æŸ¥çœ‹å·²å®‰è£…åŒ…</td><td><code>pip list</code></td></tr><tr><td>åˆ—å‡ºå¯æ›´æ–°åŒ…</td><td><code>pip list --outdated</code></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-4"><strong>å¯¼å‡º/å®‰è£…ä¾èµ–æ¸…å•</strong></h4>

















<table><thead><tr><th>åŠŸèƒ½</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>å¯¼å‡ºä¾èµ–</td><td><code>pip freeze &gt; requirements.txt</code></td></tr><tr><td>å®‰è£…ä¾èµ–</td><td><code>pip install -r requirements.txt</code></td></tr></tbody></table>
<hr/>
<h4 data-id="heading-5">å›½å†…é•œåƒæºï¼ˆæé«˜é€Ÿåº¦ï¼‰</h4>













<table><thead><tr><th>é•œåƒæº</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>æ¸…åå¤§å­¦</td><td><code>pip install package -i https://pypi.tuna.tsinghua.edu.cn/simple</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">3. è™šæ‹Ÿç¯å¢ƒå‘½ä»¤ï¼ˆvenvï¼‰</h2>
<h4 data-id="heading-7"><strong>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</strong></h4>
<pre><code class="hljs">python -m venv venv
</code></pre>
<h4 data-id="heading-8"><strong>æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</strong></h4>

















<table><thead><tr><th>ç³»ç»Ÿ</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>Windows</td><td><code>venv\Scripts\activate</code></td></tr><tr><td>macOS/Linux</td><td><code>source venv/bin/activate</code></td></tr></tbody></table>
<h4 data-id="heading-9"><strong>é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</strong></h4>
<pre><code class="hljs">deactivate
</code></pre>
<hr/>
<h2 data-id="heading-10">4. Poetry å‘½ä»¤ï¼ˆç°ä»£ä¾èµ–ç®¡ç†å·¥å…·ï¼‰</h2>
<h4 data-id="heading-11"><strong>åˆå§‹åŒ–é¡¹ç›®</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp">poetry <span class="hljs-keyword">init</span>
</code></pre>
<h4 data-id="heading-12"><strong>å®‰è£…æ‰€æœ‰ä¾èµ–</strong></h4>
<pre><code class="hljs">poetry install
</code></pre>
<h4 data-id="heading-13"><strong>å®‰è£…ä¾èµ–åŒ…</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp">poetry <span class="hljs-keyword">add</span> requests
</code></pre>
<h4 data-id="heading-14"><strong>è¿›å…¥è™šæ‹Ÿç¯å¢ƒ shell</strong></h4>
<pre><code class="hljs">poetry shell
</code></pre>
<hr/>
<h2 data-id="heading-15">5. å¸¸è§ Python æ¨¡å—å¸¸ç”¨å‘½ä»¤</h2>
<h3 data-id="heading-16">ï¼ˆ1ï¼‰json æ¨¡å—</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json

json.dumps({<span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>}, ensure_ascii=<span class="hljs-literal">False</span>)   <span class="hljs-comment"># dict â†’ JSON</span>
json.loads(<span class="hljs-string">'{"a": 1}'</span>)                     <span class="hljs-comment"># JSON â†’ dict</span>
</code></pre>
<hr/>
<h3 data-id="heading-17">ï¼ˆ2ï¼‰os æ¨¡å—ï¼ˆæ–‡ä»¶ä¸ç³»ç»Ÿæ“ä½œï¼‰</h3>





























<table><thead><tr><th>åŠŸèƒ½</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>å½“å‰è·¯å¾„</td><td><code>os.getcwd()</code></td></tr><tr><td>åˆ—å‡ºæ–‡ä»¶</td><td><code>os.listdir(path)</code></td></tr><tr><td>åˆ¤æ–­æ˜¯å¦æ–‡ä»¶/æ–‡ä»¶å¤¹</td><td><code>os.path.isfile()</code> / <code>os.path.isdir()</code></td></tr><tr><td>åˆ›å»ºæ–‡ä»¶å¤¹</td><td><code>os.makedirs(path, exist_ok=True)</code></td></tr><tr><td>åˆ é™¤æ–‡ä»¶</td><td><code>os.remove(file_path)</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">ï¼ˆ3ï¼‰shutilï¼ˆæ–‡ä»¶æ‹·è´ä¸ç§»åŠ¨ï¼‰</h3>
<pre><code class="hljs language-python" lang="python">shutil.copy(src, dst)
shutil.move(src, dst)
shutil.rmtree(folder)
</code></pre>
<hr/>
<h2 data-id="heading-19">6. requests å¸¸ç”¨è¯­æ³•é€ŸæŸ¥</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

<span class="hljs-comment"># GET</span>
requests.get(url)

<span class="hljs-comment"># POST</span>
requests.post(url, data={<span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>})

<span class="hljs-comment"># JSON</span>
requests.post(url, json={<span class="hljs-string">"key"</span>: <span class="hljs-string">"value"</span>})

<span class="hljs-comment"># æ·»åŠ  headers</span>
requests.get(url, headers={<span class="hljs-string">"User-Agent"</span>: <span class="hljs-string">"Mozilla"</span>})

<span class="hljs-comment"># ä¸‹è½½æ–‡ä»¶</span>
requests.get(url).content
</code></pre>
<hr/>
<h2 data-id="heading-20">7. BeautifulSoup å¸¸ç”¨å‘½ä»¤</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

soup = BeautifulSoup(html, <span class="hljs-string">"lxml"</span>)

soup.title.text
soup.find(<span class="hljs-string">"div"</span>)
soup.find_all(<span class="hljs-string">"a"</span>)
soup.select(<span class="hljs-string">"div.classname"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-21">8. Pandas å¸¸ç”¨å‘½ä»¤</h2>
<h4 data-id="heading-22"><strong>è¯»å–æ–‡ä»¶</strong></h4>
<pre><code class="hljs language-python" lang="python">pd.read_csv(<span class="hljs-string">"a.csv"</span>)
pd.read_excel(<span class="hljs-string">"a.xlsx"</span>)
</code></pre>
<h4 data-id="heading-23"><strong>å¸¸è§æ“ä½œ</strong></h4>
<pre><code class="hljs language-python" lang="python">df.head()
df.info()
df.describe()
df.to_excel(<span class="hljs-string">"out.xlsx"</span>, index=<span class="hljs-literal">False</span>)
</code></pre>
<hr/>
<h2 data-id="heading-24">9. Numpy å¸¸ç”¨å‘½ä»¤</h2>
<pre><code class="hljs language-python" lang="python">np.array([...])
np.zeros((<span class="hljs-number">3</span>,<span class="hljs-number">3</span>))
np.ones((<span class="hljs-number">2</span>,<span class="hljs-number">4</span>))
np.random.rand(<span class="hljs-number">5</span>)
</code></pre>
<hr/>
<h2 data-id="heading-25">10. Debug è°ƒè¯•ï¼ˆpdbï¼‰</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pdb; pdb.set_trace()
</code></pre>
<p>å¸¸ç”¨è°ƒè¯•æŒ‡ä»¤ï¼š</p>

























<table><thead><tr><th>æŒ‡ä»¤</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>n</td><td>ä¸‹ä¸€è¡Œ</td></tr><tr><td>c</td><td>ç»§ç»­æ‰§è¡Œ</td></tr><tr><td>p å˜é‡</td><td>æ‰“å°å˜é‡</td></tr><tr><td>q</td><td>é€€å‡ºè°ƒè¯•</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-26">11. Logging å¸¸ç”¨é…ç½®</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging

logging.basicConfig(level=logging.INFO)

logging.info(<span class="hljs-string">"info msg"</span>)
logging.error(<span class="hljs-string">"error msg"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-27">12. æ€§èƒ½æµ‹è¯•å‘½ä»¤ï¼ˆtimeitï¼‰</h2>
<p>åœ¨å‘½ä»¤è¡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini">python -m timeit "<span class="hljs-attr">x</span>=<span class="hljs-number">5</span><span class="hljs-comment">; x*x"</span>
</code></pre>
<p>åœ¨ä»£ç ä¸­ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> timeit
timeit.timeit(<span class="hljs-string">"x=5; x*x"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-28">13. ä»£ç è´¨é‡æ£€æŸ¥</h2>
<h4 data-id="heading-29"><strong>flake8ï¼ˆé™æ€æ£€æŸ¥ï¼‰</strong></h4>
<pre><code class="hljs">flake8 your_code.py
</code></pre>
<h4 data-id="heading-30"><strong>blackï¼ˆæ ¼å¼åŒ–ï¼‰</strong></h4>
<pre><code class="hljs language-erlang" lang="erlang">black .
</code></pre>
<hr/>
<h2 data-id="heading-31">14. æ‰“åŒ…ä¸å‘å¸ƒ</h2>
<h4 data-id="heading-32"><strong>PyInstaller æ‰“åŒ…</strong></h4>
<pre><code class="hljs language-r" lang="r">pyinstaller <span class="hljs-operator">-</span><span class="hljs-built_in">F</span> script.py
</code></pre>
<h4 data-id="heading-33"><strong>æ„å»º pip åŒ…</strong></h4>
<pre><code class="hljs language-arduino" lang="arduino">python setup.py sdist bdist_wheel
twine upload dist<span class="hljs-comment">/*
</span></code></pre>
<hr/>
<h2 data-id="heading-34">15. å…¶ä»–å¸¸ç”¨å‘½ä»¤é›†åˆ</h2>
<h4 data-id="heading-35">æŸ¥çœ‹æ¨¡å—å®‰è£…ä½ç½®</h4>
<pre><code class="hljs">python -m site
</code></pre>
<h4 data-id="heading-36">æŸ¥æ‰¾æ¨¡å—è·¯å¾„</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> module; <span class="hljs-built_in">print</span>(module.__file__)
</code></pre>
<h4 data-id="heading-37">åˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰ .py æ–‡ä»¶</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> *.py
</code></pre>
<hr/>
<h2 data-id="heading-38">ç»“è¯­</h2>
<p>è¿™ç¯‡é€ŸæŸ¥è¡¨æ¶µç›–äº† Python å®æˆ˜ä¸­æœ€å¸¸ç”¨çš„å‘½ä»¤ã€å·¥å…·å’Œåº“æ“ä½œï¼Œä»ç¯å¢ƒã€åŒ…ç®¡ç†ã€å¸¸è§„ç¼–ç ï¼Œåˆ°æ€§èƒ½è°ƒè¯•ã€æ ¼å¼åŒ–ã€æ‰“åŒ…ç­‰å¤šä¸ªæ–¹é¢ã€‚</p>
<p>æ— è®ºä½ æ˜¯åœ¨å†™è„šæœ¬ã€åšæ•°æ®åˆ†æã€æçˆ¬è™«ã€å†™åç«¯ APIï¼Œè¿˜æ˜¯å¼€å‘è‡ªåŠ¨åŒ–å·¥å…·ï¼Œè¿™äº›å‘½ä»¤éƒ½èƒ½å¸®ä½ èŠ‚çœå¤§é‡æ—¶é—´ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>